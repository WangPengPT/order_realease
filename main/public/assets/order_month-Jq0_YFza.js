import{u as R,w as U,F as z,V as K}from"./VDatePicker-CAgHHpw3.js";import{_ as Y,D as w,E as t,r as p,w as G,L,m as I,H as f,f as l,I as i,h as r,S as s,J as V,F as S,K as P,N as A}from"./index-DcV8-Ct_.js";import{V as N,x as H,G as J,y as Q,z as W}from"./scopeId-BPgLC_dr.js";import{V as X,a as Z}from"./VApp-D6VAtvu7.js";import{V as $}from"./VMain-BkYNPBcy.js";import{V as g}from"./VRow-C6PY1vzA.js";import{V as u}from"./VCol-CeQ9xx2-.js";import{g as O,d as h,a as ee,V as te,c as le}from"./VDialog-DG6O94az.js";import{a as ae,V as T,d as oe,j as ne,b as re,e as se}from"./VTextField-CnOBcYrW.js";import{V as B}from"./VSpacer-CZ-s5Nk8.js";import{V as ie,a as de,b as ue}from"./VList-BbVf4WQV.js";const ce=[{title:"paid"},{title:"pending"},{title:"expired"},{title:"voided"}],me={name:"ExportExcelComponent",setup(){const E=p(!1),e=p(null),v=p(!1),a=p(!1),C=p(null),F=n=>{console.log(n),C.value=n,a.value=!0};G(e,(n,d)=>{if(console.log("selectedMonth 发生了变化",n,d),n!=null){const _=new Date(n),b=_.getFullYear(),D=_.getMonth()+1,M={year:b,month:D};L.getOrderMonthList(M,k=>{console.log("getOrderMonthList",k),k.result&&(m.value=k.data)})}});const o=p([{title:"ID",key:"name",align:"center"},{title:"餐馆",key:"restaurant",align:"left"},{title:"客户",key:"pay_type",align:"center"},{title:"金额",key:"total_price",align:"right"},{title:"日期",key:"pickupDate",align:"center"},{title:"支付方式",key:"pay_type",align:"center"},{title:"状态",key:"pay_state",align:"center"}]),c=n=>{if(!n)return"";const d=new Date(n);return`${d.getFullYear()}年${d.getMonth()+1}月`},m=p([]),x=n=>{const d={sc_sushi:"test",sc_amadora:"Amadora",sc_setubal:"Setúbal",sc_expo:"Expo Sul",sc_marques:"Marquês Pombal",sc_coimbra:"Coimbra",sc_roma:"Roma",sc_campodeorique:"Campo de Ourique",sc_oeiras:"Oeiras",sc_almada:"Almada",sc_cascais:"Cascais",sc_linda_a_velha:"Linda-a-Velha",sc_laranjeiras:"Laranjeiras",sc_odivelas:"Odivelas",sc_saldanha:"Saldanha"};return d[n]?d[n]:n};return{monthMenu:E,selectedMonth:e,headers:o,filteredData:m,loading:v,formatDisplayMonth:c,exportToExcel:async()=>{if(m.value.length){v.value=!0;try{const n=R.book_new(),d=m.value.map(y=>({ID:y.name,餐馆:x(y.restaurant),金额:y.total_price,日期:y.pickupDate,支付方式:y.pay_type,状态:y.pay_state})),_=R.json_to_sheet(d),b=[{wch:8},{wch:20},{wch:15},{wch:12},{wch:15},{wch:10}];_["!cols"]=b;const D=c(e.value);R.book_append_sheet(n,_,`${D}数据`);const M=new Date().toISOString().slice(0,19).replace(/:/g,"-"),k=`数据导出_${D.replace("年","").replace("月","")}_${M}.xlsx`,j=U(n,{bookType:"xlsx",type:"array"}),q=new Blob([j],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});z.saveAs(q,k),console.log(`成功导出 ${m.value.length} 条数据`)}catch(n){console.error("导出失败:",n)}finally{v.value=!1}}},clearMonth:()=>{e.value=null},changeState:n=>{},getStatusColor:n=>n=="paid"?"green":n=="pending"?"blue":n=="expired"?"red":n=="voided"?"blank":"success",mergeProps:I,statusItems:ce,changePayState:(n,d)=>{console.log("change state",n.id,d),L.call("order_change_state",{id:n.id,value:d},_=>{_.success&&(n.pay_state=d)})},handleRowClick:F,detailDlgActive:a,currentRow:C}}},fe={key:0},_e={key:1};function pe(E,e,v,a,C,F){return f(),w(X,null,{default:t(()=>[l($,null,{default:t(()=>[l(Z,null,{default:t(()=>[l(g,{class:"mb-6"},{default:t(()=>[l(u,{cols:"12",sm:"6"},{default:t(()=>[l(O,{modelValue:a.monthMenu,"onUpdate:modelValue":e[3]||(e[3]=o=>a.monthMenu=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[l(ae,I({modelValue:a.selectedMonth,"onUpdate:modelValue":e[0]||(e[0]=c=>a.selectedMonth=c),label:"选择月份","prepend-icon":"mdi-calendar",readonly:""},o,{clearable:"","onClick:clear":a.clearMonth}),null,16,["modelValue","onClick:clear"])]),default:t(()=>[l(K,{modelValue:a.selectedMonth,"onUpdate:modelValue":[e[1]||(e[1]=o=>a.selectedMonth=o),e[2]||(e[2]=o=>a.monthMenu=!1)],type:"month"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(u,{cols:"12",sm:"6",class:"d-flex align-center"},{default:t(()=>[l(N,{color:"primary",disabled:!a.selectedMonth||!a.filteredData.length,onClick:a.exportToExcel,class:"ml-2"},{default:t(()=>[l(H,{left:""},{default:t(()=>e[6]||(e[6]=[i("mdi-microsoft-excel")])),_:1,__:[6]}),e[7]||(e[7]=i(" 导出Excel "))]),_:1,__:[7]},8,["disabled","onClick"])]),_:1})]),_:1}),l(T,null,{default:t(()=>[l(oe,null,{default:t(()=>[r("span",null,"数据预览 ("+s(a.filteredData.length)+" 条记录)",1),l(B),l(h,{color:"primary",variant:"outlined"},{default:t(()=>[i(s(a.selectedMonth?a.formatDisplayMonth(a.selectedMonth):"请选择月份"),1)]),_:1})]),_:1}),l(ee,{headers:a.headers,items:a.filteredData,"items-per-page":10,class:"elevation-1"},{"item.total_price":t(({item:o})=>[l(h,{color:"green",variant:"outlined"},{default:t(()=>[i(" €"+s(o.total_price.toLocaleString()),1)]),_:2},1024)]),"item.pay_state":t(({item:o})=>[l(J,{mode:"out-in"},{default:t(()=>[l(h,{size:"small",color:"#9F209F",class:"mr-1",onClick:c=>a.handleRowClick(o)},{default:t(()=>e[8]||(e[8]=[i(" details ")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024),l(O,null,{activator:t(({props:c})=>[l(h,I({size:"small",color:a.getStatusColor(o.pay_state)},a.mergeProps(c),{class:"mr-1",style:{width:"60px","min-width":"60px"}}),{default:t(()=>[i(s(o.pay_state),1)]),_:2},1040,["color"])]),default:t(()=>[l(ie,null,{default:t(()=>[(f(!0),V(S,null,P(a.statusItems,(c,m)=>(f(),w(de,{key:m,value:m,onClick:x=>a.changePayState(o,c.title)},{default:t(()=>[l(ue,null,{default:t(()=>[i(s(c.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items"])]),_:1}),l(ne,{"model-value":a.loading,class:"align-center justify-center"},{default:t(()=>[l(T,{class:"pa-4"},{default:t(()=>[l(Q,{indeterminate:"",color:"primary",class:"mb-2"}),e[9]||(e[9]=r("div",null,"正在导出数据...",-1))]),_:1,__:[9]})]),_:1},8,["model-value"]),l(te,{modelValue:a.detailDlgActive,"onUpdate:modelValue":e[5]||(e[5]=o=>a.detailDlgActive=o),width:"600"},{default:t(()=>[l(T,{title:"Order Details"},{default:t(()=>[a.currentRow?(f(),w(re,{key:0},{default:t(()=>[l(g,null,{default:t(()=>[l(u,{cols:"6"},{default:t(()=>[e[10]||(e[10]=r("strong",null,"ID:",-1)),i(" "+s(a.currentRow.name),1)]),_:1,__:[10]}),l(u,{cols:"6"},{default:t(()=>[e[11]||(e[11]=r("strong",null,"Restaurant:",-1)),i(" "+s(a.currentRow.restaurant),1)]),_:1,__:[11]})]),_:1}),l(g,null,{default:t(()=>[l(u,{cols:"6"},{default:t(()=>[e[12]||(e[12]=r("strong",null,"Pickup Date:",-1)),i(" "+s(a.currentRow.pickupDate),1)]),_:1,__:[12]}),l(u,{cols:"6"},{default:t(()=>[e[13]||(e[13]=r("strong",null,"Pickup Time:",-1)),i(" "+s(a.currentRow.pickupTime),1)]),_:1,__:[13]})]),_:1}),l(g,null,{default:t(()=>[l(u,{cols:"6"},{default:t(()=>{var o;return[e[14]||(e[14]=r("strong",null,"Customer:",-1)),i(" "+s((o=a.currentRow.customer)==null?void 0:o.name),1)]}),_:1,__:[14]}),l(u,{cols:"6"},{default:t(()=>{var o;return[e[15]||(e[15]=r("strong",null,"Phone:",-1)),i(" "+s((o=a.currentRow.customer)==null?void 0:o.phone),1)]}),_:1,__:[15]})]),_:1}),l(g,null,{default:t(()=>[l(u,{cols:"6"},{default:t(()=>{var o;return[e[16]||(e[16]=r("strong",null,"email:",-1)),i(" "+s((o=a.currentRow.customer)==null?void 0:o.email),1)]}),_:1,__:[16]}),l(u,{cols:"6"},{default:t(()=>[e[17]||(e[17]=r("strong",null,"Total Price:",-1)),i(" "+s(a.currentRow.total_price),1)]),_:1,__:[17]})]),_:1}),l(g,null,{default:t(()=>[l(u,{cols:"6"},{default:t(()=>[e[18]||(e[18]=r("strong",null,"Payment State:",-1)),i(" "+s(a.currentRow.pay_state),1)]),_:1,__:[18]}),l(u,{cols:"6"},{default:t(()=>[e[19]||(e[19]=r("strong",null,"Payment Type:",-1)),i(" "+s(a.currentRow.pay_type),1)]),_:1,__:[19]})]),_:1}),a.currentRow.line_items&&a.currentRow.line_items.length?(f(),w(g,{key:0},{default:t(()=>[l(u,{cols:"12"},{default:t(()=>[l(W,{class:"my-4"}),e[21]||(e[21]=r("h3",{class:"text-h6"},"Item Details",-1)),l(le,{density:"compact"},{default:t(()=>[e[20]||(e[20]=r("thead",null,[r("tr",null,[r("th",null,"SKU"),r("th",null,"Product Name"),r("th",null,"Quantity"),r("th",null,"Price"),r("th",null,"Properties")])],-1)),r("tbody",null,[(f(!0),V(S,null,P(a.currentRow.line_items,(o,c)=>(f(),V("tr",{key:c},[r("td",null,s(o.sku),1),r("td",null,s(o.name),1),r("td",null,s(o.quantity),1),r("td",null,s(o.price),1),r("td",null,[o.properties&&o.properties.length?(f(),V("span",fe,[(f(!0),V(S,null,P(o.properties,(m,x)=>(f(),w(h,{key:x,size:"small",class:"ma-1"},{default:t(()=>[i(s(m.name)+": "+s(m.value),1)]),_:2},1024))),128))])):(f(),V("span",_e,"None"))])]))),128))])]),_:1,__:[20]})]),_:1,__:[21]})]),_:1})):A("",!0)]),_:1})):A("",!0),l(se,null,{default:t(()=>[l(B),l(N,{color:"primary",onClick:e[4]||(e[4]=o=>a.detailDlgActive=!1)},{default:t(()=>e[22]||(e[22]=[i("Close")])),_:1,__:[22]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const Ie=Y(me,[["render",pe],["__scopeId","data-v-01f9a0b7"]]);export{Ie as default};
