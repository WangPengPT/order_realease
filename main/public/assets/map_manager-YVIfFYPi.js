import{r as i,o as T,L as p,J as B,f as t,E as s,F as j,H as g,h as M,I as V,M as O,D as w,N as x,O as L}from"./index-DLtJvdwC.js";import{V as R,a as u,b as J}from"./VTextField-BQedP5D3.js";import{V as P,a as H}from"./VDialog-D84eXri-.js";import{V as k}from"./scopeId-BJksvrU9.js";import{V as q}from"./VForm-DY-BBunY.js";import"./VList-B0M-pk7X.js";const Z={__name:"map_manager",setup(z){const m=i(!1),c=i(""),I=[{key:"id",title:"Id"},{align:"start",key:"name",sortable:!1,title:"Restaurant"},{key:"rates",title:"Rates"},{key:"likes",title:"Likes"},{key:"address",title:"Address"},{key:"city",title:"City"},{key:"postalCode",title:"Postal Code"},{key:"phone",title:"Contact"},{key:"takeReserveRef",title:"Take Reserve Ref"},{key:"schedule",title:"Schedule"},{key:"latitude",title:"Latitude"},{key:"longitude",title:"Longitude"}],b=i(null),d=i([]);T(()=>{p.getAllRestaurants(o=>{o.result&&(d.value=o.datas)})});let v=i(!1);const a=i({});function N(o,e){console.log(o,e),v.value=!1,m.value=!0,a.value={...e.item}}function S(){m.value=!1;const o={...a.value};if(v.value){p.addRestaurant(o,l=>{l.result?d.value.push(o):console.error("Failed to add restaurant.")});return}const e=d.value.findIndex(l=>l.id===o.id);if(e!==-1){const l=d.value[e];let r=!1;for(const n in o)if(o[n]!==l[n]){r=!0;break}r&&p.setRestaurant(o,n=>{n.result?(console.log("Success updated"),d.value.splice(e,1,o)):console.error("Failed to update restaurant.")})}}function A(){m.value=!0,a.value={id:"",name:"",rates:0,likes:0,address:"",city:"",postalCode:"",phone:"",email:"",takeReserveRef:"",schedule:"",latitude:"",longitude:""},v.value=!0}function E(){p.getAllRestaurants(o=>{if(o.result){const e=JSON.stringify(o.datas,null,2),l=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(l),n=document.createElement("a");n.href=r,n.download="restaurants_export.json",n.click(),URL.revokeObjectURL(r)}else console.error("Failed to fetch data from server for export.")})}function F(){b.value.click()}function D(o){const e=o.target.files[0];if(!e){console.warn("No file selected.");return}const l=new FileReader;l.onload=r=>{try{const n=JSON.parse(r.target.result);if(!Array.isArray(n))throw new Error("Invalid format: Expected an array of restaurants.");const C=new Set(d.value.map(f=>f.name.trim().toLowerCase()));n.forEach(f=>{var U;const y=(U=f.name)==null?void 0:U.trim().toLowerCase();!y||C.has(y)||(p.addRestaurant(f),d.value.push(f),C.add(y))}),console.log("Import successful:",n)}catch(n){console.error("Failed to import file:",n.message)}},l.readAsText(e)}return(o,e)=>(g(),B(j,null,[t(R,{title:"Map Manager",flat:""},{text:s(()=>[t(u,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"]),t(k,{class:"ma-2",onClick:A,color:"indigo-darken-3"},{default:s(()=>e[16]||(e[16]=[V("Add Restaurant")])),_:1,__:[16]}),t(k,{class:"ma-2",onClick:E,color:"green-darken-3"},{default:s(()=>e[17]||(e[17]=[V("Export")])),_:1,__:[17]}),t(k,{class:"ma-2",onClick:F,color:"blue-darken-3"},{default:s(()=>e[18]||(e[18]=[V("Import")])),_:1,__:[18]}),M("input",{type:"file",ref_key:"fileInput",ref:b,accept:".json",onChange:D,style:{display:"none"}},null,544)]),default:s(()=>[t(H,{headers:I,items:d.value,search:c.value,"onClick:row":N},null,8,["items","search"])]),_:1}),t(P,{modelValue:m.value,"onUpdate:modelValue":e[15]||(e[15]=l=>m.value=l),width:"500"},{default:s(()=>[t(R,{title:"Edit Info"},{default:s(()=>[t(J),t(q,{"fast-fail":"",onSubmit:O(S,["prevent"])},{default:s(()=>[t(u,{class:"ma-3",modelValue:a.value.id,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.id=l),variant:"outlined",label:"Id"},null,8,["modelValue"]),L(v)?(g(),w(u,{key:0,class:"ma-3",modelValue:a.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.name=l),variant:"outlined",label:"Restaurant Name"},null,8,["modelValue"])):x("",!0),L(v)?x("",!0):(g(),w(u,{key:1,class:"ma-3",modelValue:a.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.name=l),variant:"outlined",label:"Restaurant Name",readonly:""},null,8,["modelValue"])),t(u,{class:"ma-3",modelValue:a.value.rates,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.rates=l),variant:"outlined",label:"Rates"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.likes,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.likes=l),variant:"outlined",label:"Likes"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.address,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.address=l),variant:"outlined",label:"Address"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.city,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.city=l),variant:"outlined",label:"City"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.postalCode,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.postalCode=l),variant:"outlined",label:"Postal Code"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.phone,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.phone=l),variant:"outlined",label:"Contact"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.email,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.email=l),variant:"outlined",label:"Email"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.takeReserveRef,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.takeReserveRef=l),variant:"outlined",label:"Take Reserve Ref"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.schedule,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.schedule=l),variant:"outlined",label:"Schedule"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.latitude,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.latitude=l),variant:"outlined",label:"Latitude"},null,8,["modelValue"]),t(u,{class:"ma-3",modelValue:a.value.longitude,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.longitude=l),variant:"outlined",label:"Longitude"},null,8,["modelValue"]),t(R,{class:"text-center"},{default:s(()=>[t(k,{width:"200",class:"mb-3",type:"submit",color:"indigo-darken-3"},{default:s(()=>e[19]||(e[19]=[V("Submit")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Z as default};
