import{u as k,w as B,F as O,V as j}from"./VDatePicker-D-usmiyi.js";import{_ as q,D as b,E as t,r as g,w as U,L as T,m as M,H as v,f as l,I as s,h as d,S as r,J as X,F as z,K as Y,N as G}from"./index-B2J4yjCD.js";import{V as E,x as H,G as J,y as K}from"./scopeId-DeazmFcF.js";import{V as W,a as Q}from"./VApp-BZfWzhwB.js";import{V as Z}from"./VMain-Btx-vv74.js";import{V as p}from"./VRow-Cd6gs7oU.js";import{V as c}from"./VCol-BVyobXn1.js";import{g as F,d as y,a as $,V as ee}from"./VDialog-D8qIZB5x.js";import{a as te,V as D,d as le,j as ae,b as oe,e as ne}from"./VTextField-COqhsqxo.js";import{V as I}from"./VSpacer-Dgp6qxLB.js";import{V as se,a as re,b as ie}from"./VList-BsZyB_Jj.js";const de=[{title:"paid"},{title:"pending"},{title:"expired"},{title:"voided"}],ue={name:"ExportExcelComponent",setup(){const R=g(!1),e=g(null),h=g(!1),a=g(!1),w=g(null),P=o=>{console.log(o),w.value=o,a.value=!0};U(e,(o,i)=>{if(console.log("selectedMonth 发生了变化",o,i),o!=null){const f=new Date(o),S=f.getFullYear(),x=f.getMonth()+1,C={year:S,month:x};T.getReserveMonthList(C,V=>{console.log("getReserveMonthList",V),V.result&&(m.value=V.data)})}});const n=g([{title:"ID",key:"name",align:"center"},{title:"餐馆",key:"restaurant",align:"left"},{title:"客户",key:"customerName",align:"center"},{title:"人数",key:"numberPeople",align:"right"},{title:"日期",key:"date",align:"center"},{title:"时间",key:"time",align:"center"},{title:"状态",key:"status",align:"center"}]),u=o=>{if(!o)return"";const i=new Date(o);return`${i.getFullYear()}年${i.getMonth()+1}月`},m=g([]),N=o=>{const i={sc_sushi:"test",sc_amadora:"Sushicome Amadora",sc_setubal:" Sushicome Setúbal",sc_expo:"Sushicome Parque das Nações Sul",sc_marques:"Sushicome Marquês de Pombal",sc_coimbra:"Sushicome Coimbra",sc_roma:"Sushicome Roma",sc_campodeorique:"Sushicome Campo Ourique",sc_oeiras:"Sushicome Oeiras",sc_almada:"Sushicome Almada",sc_cascais:"Sushicome Cascais",sc_linda_a_velha:"Sushicome Linda Velha",sc_laranjeiras:"Sushicome Laranjeiras",sc_odivelas:"Sushicome Odivelas",sc_saldanha:"Sushicome Saldanha",xx_saldanha:"Xiaoxiong Saldanha",xx_entrecampos:"Xiaoxiong Entrecampos",xx_odivelas:"Xiaoxiong Odivelas",xx_expo:"Xiaoxiong Expo"};return i[o]?i[o]:o};return{monthMenu:R,selectedMonth:e,headers:n,filteredData:m,loading:h,formatDisplayMonth:u,exportToExcel:async()=>{if(m.value.length){h.value=!0;try{const o=k.book_new(),i=m.value.map(_=>({ID:_.name,餐馆:N(_.restaurant),人数:_.numberPeople,客户:_.customerName,日期:_.date,时间:_.time,状态:_.status})),f=k.json_to_sheet(i),S=[{wch:8},{wch:20},{wch:8},{wch:30},{wch:16},{wch:16},{wch:16}];f["!cols"]=S;const x=u(e.value);k.book_append_sheet(o,f,`${x}数据`);const C=new Date().toISOString().slice(0,19).replace(/:/g,"-"),V=`数据导出_${x.replace("年","").replace("月","")}_${C}.xlsx`,L=B(o,{bookType:"xlsx",type:"array"}),A=new Blob([L],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});O.saveAs(A,V),console.log(`成功导出 ${m.value.length} 条数据`)}catch(o){console.error("导出失败:",o)}finally{h.value=!1}}},clearMonth:()=>{e.value=null},changeState:o=>{},getStatusColor:o=>o=="paid"?"green":o=="pending"?"blue":o=="expired"?"red":o=="voided"?"blank":"success",mergeProps:M,statusItems:de,changePayState:(o,i)=>{console.log("change state",o.id,i),T.call("reserve_change_state",{id:o.id,value:i},f=>{f.success&&(o.status=i)})},handleRowClick:P,detailDlgActive:a,currentRow:w}}};function ce(R,e,h,a,w,P){return v(),b(W,null,{default:t(()=>[l(Z,null,{default:t(()=>[l(Q,null,{default:t(()=>[l(p,{class:"mb-6"},{default:t(()=>[l(c,{cols:"12",sm:"6"},{default:t(()=>[l(F,{modelValue:a.monthMenu,"onUpdate:modelValue":e[3]||(e[3]=n=>a.monthMenu=n),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:n})=>[l(te,M({modelValue:a.selectedMonth,"onUpdate:modelValue":e[0]||(e[0]=u=>a.selectedMonth=u),label:"选择月份","prepend-icon":"mdi-calendar",readonly:""},n,{clearable:"","onClick:clear":a.clearMonth}),null,16,["modelValue","onClick:clear"])]),default:t(()=>[l(j,{modelValue:a.selectedMonth,"onUpdate:modelValue":[e[1]||(e[1]=n=>a.selectedMonth=n),e[2]||(e[2]=n=>a.monthMenu=!1)],type:"month"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"d-flex align-center"},{default:t(()=>[l(E,{color:"primary",disabled:!a.selectedMonth||!a.filteredData.length,onClick:a.exportToExcel,class:"ml-2"},{default:t(()=>[l(H,{left:""},{default:t(()=>e[6]||(e[6]=[s("mdi-microsoft-excel")])),_:1,__:[6]}),e[7]||(e[7]=s(" 导出Excel "))]),_:1,__:[7]},8,["disabled","onClick"])]),_:1})]),_:1}),l(D,null,{default:t(()=>[l(le,null,{default:t(()=>[d("span",null,"数据预览 ("+r(a.filteredData.length)+" 条记录)",1),l(I),l(y,{color:"primary",variant:"outlined"},{default:t(()=>[s(r(a.selectedMonth?a.formatDisplayMonth(a.selectedMonth):"请选择月份"),1)]),_:1})]),_:1}),l($,{headers:a.headers,items:a.filteredData,"items-per-page":10,class:"elevation-1"},{"item.total_price":t(({item:n})=>[l(y,{color:"green",variant:"outlined"},{default:t(()=>[s(" €"+r(n.total_price.toLocaleString()),1)]),_:2},1024)]),"item.status":t(({item:n})=>[l(J,{mode:"out-in"},{default:t(()=>[l(y,{size:"small",color:"#9F209F",class:"mr-1",onClick:u=>a.handleRowClick(n)},{default:t(()=>e[8]||(e[8]=[s(" details ")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024),l(F,null,{activator:t(({props:u})=>[l(y,M({size:"small",color:a.getStatusColor(n.status)},a.mergeProps(u),{class:"mr-1",style:{width:"60px","min-width":"60px"}}),{default:t(()=>[s(r(n.status),1)]),_:2},1040,["color"])]),default:t(()=>[l(se,null,{default:t(()=>[(v(!0),X(z,null,Y(a.statusItems,(u,m)=>(v(),b(re,{key:m,value:m,onClick:N=>a.changePayState(n,u.title)},{default:t(()=>[l(ie,null,{default:t(()=>[s(r(u.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items"])]),_:1}),l(ae,{"model-value":a.loading,class:"align-center justify-center"},{default:t(()=>[l(D,{class:"pa-4"},{default:t(()=>[l(K,{indeterminate:"",color:"primary",class:"mb-2"}),e[9]||(e[9]=d("div",null,"正在导出数据...",-1))]),_:1,__:[9]})]),_:1},8,["model-value"]),l(ee,{modelValue:a.detailDlgActive,"onUpdate:modelValue":e[5]||(e[5]=n=>a.detailDlgActive=n),width:"600"},{default:t(()=>[l(D,{title:"Order Details"},{default:t(()=>[a.currentRow?(v(),b(oe,{key:0},{default:t(()=>[l(p,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[10]||(e[10]=d("strong",null,"ID:",-1)),s(" "+r(a.currentRow.name),1)]),_:1,__:[10]}),l(c,{cols:"6"},{default:t(()=>[e[11]||(e[11]=d("strong",null,"Restaurant:",-1)),s(" "+r(a.currentRow.restaurant),1)]),_:1,__:[11]})]),_:1}),l(p,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[12]||(e[12]=d("strong",null,"Date:",-1)),s(" "+r(a.currentRow.date),1)]),_:1,__:[12]}),l(c,{cols:"6"},{default:t(()=>[e[13]||(e[13]=d("strong",null,"Time:",-1)),s(" "+r(a.currentRow.time),1)]),_:1,__:[13]})]),_:1}),l(p,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[14]||(e[14]=d("strong",null,"Customer:",-1)),s(" "+r(a.currentRow.customerName),1)]),_:1,__:[14]}),l(c,{cols:"6"},{default:t(()=>[e[15]||(e[15]=d("strong",null,"Phone:",-1)),s(" "+r(a.currentRow.phone),1)]),_:1,__:[15]})]),_:1}),l(p,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[16]||(e[16]=d("strong",null,"email:",-1)),s(" "+r(a.currentRow.email),1)]),_:1,__:[16]}),l(c,{cols:"6"},{default:t(()=>[e[17]||(e[17]=d("strong",null,"NumberPeople:",-1)),s(" "+r(a.currentRow.reserveNumberPeople),1)]),_:1,__:[17]})]),_:1}),l(p,null,{default:t(()=>[e[18]||(e[18]=d("strong",null,"note:",-1)),s(" "+r(a.currentRow.note),1)]),_:1,__:[18]})]),_:1})):G("",!0),l(ne,null,{default:t(()=>[l(I),l(E,{color:"primary",onClick:e[4]||(e[4]=n=>a.detailDlgActive=!1)},{default:t(()=>e[19]||(e[19]=[s("Close")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const Me=q(ue,[["render",ce],["__scopeId","data-v-6baccef9"]]);export{Me as default};
