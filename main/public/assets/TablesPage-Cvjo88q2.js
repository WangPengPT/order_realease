import{s as X}from"./index-Dg-AHglt.js";import{s as ae}from"./index-C2fzDdVt.js";import{b as I}from"./index-DYNmNny4.js";import{q as Q,s as z,f as q,o as y,w as T,a as u,d as o,h as k,n as S,c as O,e as E,F,E as G,t as x,l as N,A as Y,z as de,u as se,x as ee,i as ne,H as ue,C as L,J as le}from"./index-o69WxluX.js";import{s as ce}from"./index-GY8iq-pg.js";import{s as oe}from"./index-CUNLmFKm.js";import{s as pe}from"./index-BmNE5byV.js";import{s as me}from"./index-w6lVZSMl.js";import{s as be}from"./index-Ck5RIfCc.js";import{s as ve}from"./index-CY4GHa92.js";import{Q as fe,C as W}from"./CodeMaker-IOgtdCDu.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as ge}from"./index-CP7isHfY.js";import{a as ie,s as re}from"./index-kwUNF4UK.js";import"./index-B5o_wBIN.js";import"./index-DahG91ZI.js";import"./index-CqzwrS7Q.js";import"./index-DLz5yzPn.js";import"./index-DjgY_FDZ.js";import"./index-BTZwoJoq.js";import"./index-DNwOR0tF.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./index-78Aa1u3w.js";import"./index-CL9e39r4.js";import"./index-BTfBiVkT.js";import"./index-DHsnhpjT.js";import"./index-yRDwiwb0.js";import"./index-Rx6L6d9y.js";const he={class:"p-menuitem-content"},Te={__name:"TableMenuBar",props:{filterStatu:String},setup(M){const{t:p}=Q(),l=z(()=>[{label:p("tablesPage.all"),value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:p("tablesPage.available"),value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:p("tablesPage.dining"),value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:p("tablesPage.reserved"),value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:p("tablesPage.paid"),value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(h,b)=>{const v=I,g=ce;return y(),q(g,{model:l.value,breakpoint:"355px",class:"border-0"},{item:T(({item:i})=>[u("div",he,[o(v,{label:i.label,icon:i.icon,severity:i.severity,variant:"outlined",raised:"",onClick:_=>h.$emit("update:filterStatu",i.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},_e={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},Pe={class:"grid m-2"},$e={class:"flex justify-content-center align-items-center w-100"},we={class:"relative"},xe={class:"text-center text-2xl font-bold"},ke={key:0},Ce={class:"text-center"},Se={class:"text-center text-lg"},Ne={class:"text-center text-lg font-bold"},Oe={key:1,class:"flex flex-wrap justify-content-center"},Me={class:"font-bold text-xl"},Ee={class:"ont-bold"},De={class:"flex flex-wrap justify-content-end mt-3"},Ve={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(M,{emit:p}){const{t:l}=Q(),h=k(!1),b=k(),v=k(!1),g=k({}),i=z(()=>[{label:l("tablesPage.available"),value:"Livre"},{label:l("tablesPage.dining"),value:"Ocupado"},{label:l("tablesPage.reserved"),value:"Reservado"},{label:l("tablesPage.paid"),value:"Pago"}]);function _(c){return i.value.find(r=>r.value===c)}function C(c){return Number(c.peopleType.children)+Number(c.peopleType.adults)}function n(c){return!c||!Array.isArray(c)?0:parseFloat(c.reduce((r,$)=>r+$.price*$.quantity,0).toFixed(2))}function P(c){const r=S.getCurrentPeoplePrice();return Number(c.peopleType.children)*r.children+Number(c.peopleType.adults)*r.adults}function D(c){return(n(c.order)+P(c)).toFixed(2)}function V(c){const r="m-1 border-3 border-gray-500 ";let $="";switch(c){case"Livre":break;case"Ocupado":$="border-red-300 bg-red-100";break;case"Reservado":$="border-blue-300 bg-blue-100";break;case"Pago":$="border-purple-300 bg-purple-100";break;default:$="border-gray-500 bg-gray-100"}return r+$}function A(c,r){r=="pay"?(g.value=c.nif_note,v.value=!0):c["msg_"+r]=!1,S.socket.emit("click_msg",c.id,r)}function H(){document.getElementById("tipsAudio").play()}return S.playSoundFun=H,(c,r)=>{const $=I,U=pe,B=ae,j=X,R=oe;return y(),O(F,null,[u("div",_e,[u("div",Pe,[r[7]||(r[7]=u("audio",{id:"tipsAudio",src:"/sound/tips.mp3",preload:"auto"},null,-1)),M.editMode?(y(),q(U,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:r[0]||(r[0]=f=>h.value=!0)},{content:T(()=>[u("div",$e,[o($,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):E("",!0),(y(!0),O(F,null,G(M.filteredTables,f=>(y(),q(U,{class:de(V(f.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:e=>M.editMode?"":c.$emit("openTableDetail",f.id)},{header:T(()=>[u("div",we,[f.msg_pay?(y(),q($,{key:0,onClick:Y(e=>A(f,"pay"),["stop"]),icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"}},null,8,["onClick"])):E("",!0),f.msg_call?(y(),q($,{key:1,onClick:Y(e=>A(f,"call"),["stop"]),icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"}},null,8,["onClick"])):E("",!0)])]),content:T(()=>[u("p",xe,x(N(l)("tablesPage.tableNum"))+": "+x(f.id),1),M.editMode?E("",!0):(y(),O("div",ke,[u("p",Ce,x(_(f.status).label),1),u("p",Se,x(C(f)+" "+N(l)("tablesPage.people")),1),u("p",Ne,x(D(f))+"€",1)])),M.editMode?(y(),O("div",Oe,[o($,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:Y(e=>c.$emit("removeTable",f.id),["stop"])},null,8,["onClick"])])):E("",!0)]),_:2},1032,["class","onClick"]))),256))])]),o(j,{visible:v.value,"onUpdate:visible":r[1]||(r[1]=f=>v.value=f),modal:!0,dismissableMask:!0,header:c.$t("tablesPage.payInfo"),style:{"min-width":"300px","max-width":"450px"},onHide:r[2]||(r[2]=f=>g.value={nif:void 0,note:void 0})},{default:T(()=>{var f,e;return[u("label",Me,"NIF:"+x((f=g.value)!=null&&f.nif?g.value.nif:N(l)("tablesPage.noNif")),1),o(B),u("label",Ee,x(N(l)("tablesPage.note"))+": "+x((e=g.value)!=null&&e.note?g.value.note:N(l)("tablesPage.noNote")),1)]}),_:1},8,["visible","header"]),o(j,{visible:h.value,"onUpdate:visible":r[5]||(r[5]=f=>h.value=f),modal:!0,dismissableMask:!0,header:c.$t("tablesPage.addTable"),onHide:r[6]||(r[6]=f=>b.value=void 0)},{default:T(()=>[o(R,{modelValue:b.value,"onUpdate:modelValue":r[3]||(r[3]=f=>b.value=f),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:`${N(l)("tablesPage.tableNum")}：${b.value<10?"0":""}`,step:1,min:1,max:9999,placeholder:c.$t("tablesPage.enterTable"),fluid:""},{incrementbuttonicon:T(()=>r[8]||(r[8]=[u("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:T(()=>r[9]||(r[9]=[u("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix","placeholder"]),u("div",De,[o($,{label:c.$t("tablesPage.createTable"),onClick:r[4]||(r[4]=f=>{c.$emit("addNewTable",b.value),h.value=!1})},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},qe={class:"flex flex-column justify-content-center align-items-center"},Ae={for:"Total"},je={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Re={for:"Adult"},Ue={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Be={for:"Children"},Le={class:"flex flex-wrap justify-content-center align-items-center m-2"},Fe={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},ze={class:"m-2"},He={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Je={key:1,class:"flex flex-wrap justify-content-between align-items-center"},Ie={class:"flex flex-column"},Qe={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(M,{emit:p}){const{t:l}=Q();let h=!1;const b=se(),v=k(!1),g=k(!1),i=M,_=p;function C(){_("onEdit",i.selectedTable.id,e=>{n.value=JSON.parse(JSON.stringify(e)),v.value=!0})}const n=k(JSON.parse(JSON.stringify(i.selectedTable))),P=k([{label:l("tablesPage.available"),value:"Livre",severity:"success"},{label:l("tablesPage.dining"),value:"Ocupado",severity:"danger"},{label:l("tablesPage.reserved"),value:"Reservado",severity:"info"},{label:l("tablesPage.paid"),value:"Pago",severity:"help"}]);function D(){h||(g.value=!1,n.value=JSON.parse(JSON.stringify(i.selectedTable))),h=!1}const V=z(()=>Number(n.value.peopleType.children)+Number(n.value.peopleType.adults));function A(){n.value.status?(_("tableEditConfirm",n.value,e=>{(e==null?void 0:e.success)==!0?(b.add({severity:"success",summary:l("common.success"),detail:e.message,life:3e3}),v.value=!1):b.add({severity:"error",summary:l("common.error"),detail:e.message,life:3e3})}),g.value=!1,h=!0):b.add({severity:"error",summary:l("common.error"),detail:l("tablesPage.stateError"),life:3e3})}function H(){g.value=!0}function c(){v.value=!1,n.value=JSON.parse(JSON.stringify(i.selectedTable))}function r(){return P.value.find(e=>e.value===n.value.status)}function $(e,a){const t=Number(a);if(e==="Adult"){Number(n.value.peopleType.adults)+t<=0?n.value.peopleType.adults=0:n.value.peopleType.adults=Number(n.value.peopleType.adults)+t,n.value.people=Number(n.value.peopleType.adults)+Number(n.value.peopleType.children);return}if(e==="Children"){n.value.peopleType.children+t<=0?n.value.peopleType.children=0:n.value.peopleType.children=Number(n.value.peopleType.children)+t,n.value.people=Number(n.value.peopleType.adults)+Number(n.value.peopleType.children);return}}const U=ee(),B=()=>{U.require({message:l("tablesPage.clearMsg.1")+n.value.id+l("tablesPage.clearMsg.2"),header:l("tablesPage.confirmClear"),icon:"pi pi-info-circle",rejectLabel:l("common.cancel"),rejectProps:{label:l("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:l("common.confirm"),severity:"danger"},accept:()=>{_("cleanTable",n.value.id,e=>{(e==null?void 0:e.success)===!1?b.add({severity:"error",summary:l("common.error"),detail:e.message,life:3e3}):(e==null?void 0:e.success)===!0&&b.add({severity:"success",summary:l("common.success"),detail:`${l("tablesPage.clearSucMsg.1")}${n.value.id}${l("tablesPage.clearSucMsg.2")}`,life:3e3})})},reject:()=>{b.add({severity:"error",summary:l("common.operation"),detail:`${l("tablesPage.clearCancelMsg.1")}${n.value.id}${l("tablesPage.clearCancelMsg.2")}`,life:3e3})}})},j=k(null);function R(){window.open(window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),"_blank")}const f=async()=>{if(j.value)try{await fe.toCanvas(j.value,window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(e){console.error("生成二维码失败:",e)}};return ne(()=>{f()}),ue(()=>window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),f),(e,a)=>{var J,Z;const t=ve,s=be,d=I,w=me,K=X;return y(),O(F,null,[u("div",qe,[u("div",null,[o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(t,{id:"Total",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=m=>V.value=m),autocomplete:"off",disabled:""},null,8,["modelValue"]),u("label",Ae,x(N(l)("tablesPage.totalPeople")),1)]),_:1})]),v.value?(y(),O("div",je,[o(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:a[1]||(a[1]=m=>$("Adult",-1))}),o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(t,{id:"Adult",modelValue:n.value.peopleType.adults,"onUpdate:modelValue":a[2]||(a[2]=m=>n.value.peopleType.adults=m),autocomplete:"off"},null,8,["modelValue"]),u("label",Re,x(N(l)("tablesPage.adult")),1)]),_:1}),o(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:a[3]||(a[3]=m=>$("Adult",1))})])):E("",!0),v.value?(y(),O("div",Ue,[o(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:a[4]||(a[4]=m=>$("Children",-1))}),o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(t,{id:"Children",modelValue:n.value.peopleType.children,"onUpdate:modelValue":a[5]||(a[5]=m=>n.value.peopleType.children=m),autocomplete:"off"},null,8,["modelValue"]),u("label",Be,x(N(l)("tablesPage.child")),1)]),_:1}),o(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:a[6]||(a[6]=m=>$("Children",1))})])):E("",!0)]),u("div",Le,[v.value?E("",!0):(y(),q(d,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(J=r())==null?void 0:J.label,severity:(Z=r())==null?void 0:Z.severity,onClick:H},null,8,["label","severity"])),v.value?(y(),q(w,{key:1,modelValue:n.value.status,"onUpdate:modelValue":a[7]||(a[7]=m=>n.value.status=m),options:P.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:n.value.status===null},null,8,["modelValue","options","invalid"])):E("",!0)]),u("div",Fe,[u("canvas",{ref_key:"qrCanvas",ref:j,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:R},null,512)]),u("div",ze,[v.value?E("",!0):(y(),O("div",He,[o(d,{label:e.$t("tablesPage.orderDetails"),severity:"success",onClick:a[8]||(a[8]=()=>e.$emit("showTableOrders"))},null,8,["label"]),o(d,{label:e.$t("tablesPage.clear"),onClick:B,severity:"danger",class:"m-1"},null,8,["label"]),o(d,{label:e.$t("tablesPage.edit"),onClick:C,class:"m-1"},null,8,["label"])])),v.value?(y(),O("div",Je,[o(d,{label:e.$t("tablesPage.cancelEdit"),severity:"danger",raised:"",class:"m-2",onClick:c},null,8,["label"]),o(d,{label:e.$t("tablesPage.saveEdit"),severity:"success",raised:"",class:"m-2",onClick:A},null,8,["label"])])):E("",!0)]),o(K,{visible:g.value,"onUpdate:visible":a[10]||(a[10]=m=>g.value=m),modal:"",header:e.$t("tablesPage.editState"),closable:!0,dismissableMask:!0,onHide:D},{default:T(()=>[u("div",Ie,[o(w,{modelValue:n.value.status,"onUpdate:modelValue":a[9]||(a[9]=m=>n.value.status=m),options:P.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:n.value.status===null},null,8,["modelValue","options","invalid"]),o(d,{label:e.$t("common.confirm"),class:"mt-3",onClick:A},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},Ze=ye(Qe,[["__scopeId","data-v-fd40c96d"]]);function Ge(M){const p=new Date(M),l=n=>String(n).padStart(2,"0"),h=new Date(p.toLocaleString("en-US",{timeZone:"Europe/Lisbon"})),b=h.getFullYear(),v=l(h.getMonth()+1),g=l(h.getDate()),i=l(h.getHours()),_=l(h.getMinutes()),C=l(h.getSeconds());return`${b}-${v}-${g} ${i}:${_}:${C}`}const Ke={class:"font-bold",style:{"min-width":"100px"}},Ye={__name:"TableOrderTimeLine",props:{table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},setup(M){const p=M,l=k([]),h=z(()=>{const i=p.table.order;return Array.isArray(i)?Array.from(new Set(i.flatMap(_=>Array.isArray(_.orderIds)?_.orderIds:[]))):[]}),b=z(()=>{const i=S.orders.value,_=h.value;return Array.isArray(i)?i.filter(C=>_.includes(C.id)).sort((C,n)=>C.timestamp-n.timestamp):[]}),v=[{field:"id",header:"订单号"},{field:"table",header:"桌号"},{field:"status",header:"状态"},{field:"timestamp",header:"时间",body:i=>Ge(i.timestamp)}],g=[{field:"dishid",header:"编号"},{field:"quantity",header:"数量"},{field:"name",header:"名称",body:i=>S.getDishName(i)}];return ne(()=>{l.value=b.value.map(i=>i.id)}),(i,_)=>{const C=ie,n=re;return y(),q(n,{value:b.value,dataKey:"id",expandedRows:l.value,"onUpdate:expandedRows":_[0]||(_[0]=P=>l.value=P),expandableRows:""},{expansion:T(P=>[(y(!0),O(F,null,G(P.data.items,D=>(y(),O("div",{key:D.dishid,class:"p-3 mb-2 border-round bg-gray-100"},[(y(),O(F,null,G(g,V=>u("div",{key:V.field,class:"flex gap-2 mb-1"},[u("span",Ke,x(V.header)+":",1),u("span",null,x(typeof V.body=="function"?V.body(D):D[V.field]),1)])),64))]))),128))]),default:T(()=>[o(C,{expander:"",style:{width:"3rem"}}),(y(),O(F,null,G(v,P=>o(C,{key:P.field,field:P.field,header:P.header,sortable:""},{body:T(D=>[L(x(typeof P.body=="function"?P.body(D.data):D.data[P.field]),1)]),_:2},1032,["field","header"])),64))]),_:1},8,["value","expandedRows"])}}},We={key:0},Xe={class:"flex flex-column"},et={key:0},tt=["disabled","onClick"],lt={class:"text-center py-5"},at={class:"text-gray-500"},st={key:1},nt={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},ot={class:"font-bold"},it={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(M,{emit:p}){var a;const{t:l}=Q(),h=M,b=p,v=k((a=h.selectedTable.order)==null?void 0:a.sort((t,s)=>s.price-t.price).filter(t=>t.quantity!=0)),g=k(v.value.filter(t=>t.price!=0)),i=k([]),_=k(!1),C=k(!1),n=k(!1),P=k();D();function D(){S.getPeoplePricesData(P,h.selectedTable.id)}const V=z(()=>{const t=A(),s=v.value.reduce((d,w)=>d+w.price*w.quantity,0);return(t+s).toFixed(2)});function A(){if(!P.value)return 0;let t=0;for(const s in P.value)t+=Number(P.value[s].totalPrice);return t}const H=z(()=>{for(const t in P.value)if(P.value[t].price!=0)return!0;return!1});function c(t){let s=0;return t.forEach(d=>{s+=d.price*d.quantity}),s.toFixed(2)}function r(){_.value=!_.value,!_.value&&i.value.length>0&&e()}function $(t){if(i.value.find(s=>s.dishid===t.dishid))i.value.find(s=>s.dishid===t.dishid).quantity+=1;else{const s={...t,quantity:1};i.value.push(s)}t.quantity-=1}function U(){let t="| ";return i.value.forEach(s=>{const d=v.value.find(w=>w.dishid===s.dishid);d&&(t+=s.dishid+"-"+S.getDishName(s)+" "+(d.quantity+s.quantity)+" -> "+d.quantity+` | 
`)}),t}function B(t){b("cancelOrderEdit"),b("showToast","error",l("common.operation"),l("tablesPage.editCancelMsg")+`
`+t),i.value.forEach(s=>{v.value.find(d=>d.dishid===s.dishid).quantity+=s.quantity}),i.value=[]}function j(t){var s;b("saveOrder",i.value),b("showToast","info",l("common.operation"),l("tablesPage.ediSucMsg")+`
`+t),i.value=[],v.value=(s=h.selectedTable.order)==null?void 0:s.sort((d,w)=>w.price-d.price).filter(d=>d.quantity!=0)}const R=ee();function f(t){return Array.isArray(t)?t.map(le):le(t)}const e=()=>{let t=!1;const s=f(U());R.require({message:s,escape:!0,header:l("tablesPage.editOrder"),rejectLabel:l("common.cancel"),rejectProps:{label:l("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:l("common.save"),severity:"danger"},accept:()=>{t=!0,j(s)},reject:()=>{t=!0,B(s)},onHide:()=>{t||B(s)}})};return(t,s)=>{const d=ie,w=re,K=oe,J=ge,Z=I;return y(),O(F,null,[n.value?(y(),O("div",st,[o(Ye,{table:M.selectedTable},null,8,["table"])])):(y(),O("div",We,[u("div",Xe,[H.value?(y(),q(w,{key:0,value:P.value},{default:T(()=>[o(d,{field:"peopleType",header:N(l)("tablesPage.peopleType")},{body:T(({data:m})=>[L(x(N(l)("tablesPage."+(m.peopleType.toLowerCase().includes("adult")?"adult":"child"))),1)]),_:1},8,["header"]),o(d,{field:"price",header:N(l)("tablesPage.price")},null,8,["header"]),o(d,{field:"quantity",header:N(l)("tablesPage.quantity")},null,8,["header"]),o(d,{field:"totalPrice",header:N(l)("tablesPage.totalPrice")},null,8,["header"])]),_:1},8,["value"])):E("",!0)]),o(w,{value:C.value?g.value:v.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:T(()=>[u("div",lt,[u("p",at,x(t.$t("tablesPage.noOrder")),1)])]),default:T(()=>[o(d,{field:"dishid",header:"ID"}),o(d,{header:t.$t("tablesPage.name")},{body:T(m=>[L(x(N(S).getDishName(m.data)),1)]),default:T(()=>[s[3]||(s[3]=L(" > ",-1))]),_:1,__:[3]},8,["header"]),o(d,{field:"price",header:t.$t("tablesPage.price")},null,8,["header"]),o(d,{field:"quantity",header:t.$t("tablesPage.quantity")},{body:T(m=>[_.value?E("",!0):(y(),O("label",et,x(m.data.quantity),1)),_.value?(y(),q(K,{key:1,modelValue:m.data.quantity,"onUpdate:modelValue":te=>m.data.quantity=te,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:T(()=>s[4]||(s[4]=[u("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:T(()=>[u("span",{class:"p-inputnumber-button-icon",disabled:m.data.quantity<=0,onClick:te=>$(m.data)},s[5]||(s[5]=[u("i",{class:"pi pi-angle-down"},null,-1)]),8,tt)]),_:2},1032,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:1},8,["header"]),o(d,{header:t.$t("tablesPage.totalPrice")},{body:T(m=>[L(x(c([m.data])),1)]),default:T(()=>[s[6]||(s[6]=L(" > ",-1))]),_:1,__:[6]},8,["header"])]),_:1},8,["value"])])),u("div",nt,[u("label",ot,x(t.$t("tablesPage.total")+": ")+" "+x(V.value),1),u("label",null,[o(J,{modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=m=>C.value=m)},null,8,["modelValue"]),L(" "+x(t.$t("tablesPage.showNonZero")),1)]),u("label",null,[o(J,{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=m=>n.value=m)},null,8,["modelValue"]),L(" "+x(t.$t("tablesPage.timeLine")),1)]),o(Z,{label:_.value?t.$t("common.save"):t.$t("common.edit"),onClick:s[2]||(s[2]=m=>r())},null,8,["label"])])],64)}}},rt={class:"flex flex-wrap justify-content-between align-items-center m-1"},jt={__name:"TablesPage",setup(M){const{t:p}=Q(),l=ee(),h=k("Todos"),b=k(!1),v=k(!1),g=k({id:0}),i=k(!1),_=k({}),C=z(()=>h.value==="Todos"?S.tables.value:S.tables.value.filter(e=>e.status===h.value));function n(){b.value=!0}function P(){b.value==!0&&(b.value=!1)}function D(e){l.require({message:p("tablesPage.removeTableMsg.1")+e+p("tablesPage.removeTableMsg.2"),header:p("tablesPage.removeTableHeader"),icon:"pi pi-trash",rejectProps:{label:p("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:p("common.confirm"),severity:"danger"},accept:()=>{const a=S.deleteTable(e);a!=null?R.add({severity:"error",summary:a.title,detail:a.message,life:3e3}):R.add({severity:"info",summary:p("common.success"),detail:p("tablesPage.removeSucMsg.1")+e+p("tablesPage.removeSucMsg.2"),life:3e3})},reject:()=>{}})}async function V(e){e<10&&(e="0"+e);const a=await S.addNewTable(e);a!==void 0?R.add({severity:"error",summary:a.title,detail:a.message,life:3e3}):R.add({severity:"info",summary:p("common.success"),detail:p("tablesPage.createSucMsg.1")+e+p("tablesPage.createSucMsg.2"),life:3e3})}function A(e){const a=S.tables.value.find(t=>t.id===e);g.value={...a,order:(a==null?void 0:a.order)||[]}}function H(e,a){const t=S.tables.value.find(s=>s.id===e);g.value={...t,order:(t==null?void 0:t.order)||[]},a(g.value)}function c(e){A(e),v.value=!0}function r(e,a){const t={id:e.id,status:e.status,peopleType:{adults:e.peopleType.adults,children:e.peopleType.children}},s=S.updateTable(t);A(e.id),a(s?{success:!1,message:p("tablesPage.updateFailMsg")}:{success:!0,message:p("tablesPage.updateSucMsg")})}function $(e,a){const t=S.tableClean(e);t?(console.log("cleanTable Error:",t),a({success:!1,message:p("tablesPage.updateFailMsg")})):(v.value=!1,a({success:!0,message:p("tablesPage.updateSucMsg")}))}function U(){const e=g.value.id;A(e),i.value=!0}function B(e){S.deleteOrders(g.value.id,e),_.value.order&&(S.deleteOrder(_.value),_.value={})}function j(){S.refreshTables()}const R=se();function f(e,a,t,s){R.add({severity:e||"",summary:a||"",detail:t||"",life:s||3e3})}return(e,a)=>{const t=I,s=ae,d=X;return y(),O(F,null,[u("div",rt,[o(Te,{filterStatu:h.value,"onUpdate:filterStatu":a[0]||(a[0]=w=>h.value=w)},null,8,["filterStatu"]),b.value?E("",!0):(y(),q(t,{key:0,icon:"pi pi-pencil",label:N(p)("tablesPage.editTables"),class:"mr-3 unchange_white_text_button",onClick:n},null,8,["label"])),b.value?(y(),q(t,{key:1,label:N(p)("tablesPage.closeEdit"),class:"mr-3",onClick:P},null,8,["label"])):E("",!0)]),o(s,{class:"m-0"}),o(Ve,{filteredTables:C.value,"onUpdate:filteredTables":a[1]||(a[1]=w=>C.value=w),editMode:b.value,"onUpdate:editMode":a[2]||(a[2]=w=>b.value=w),onOpenTableDetail:c,onRemoveTable:D,onAddNewTable:V},null,8,["filteredTables","editMode"]),o(d,{visible:v.value,"onUpdate:visible":a[3]||(a[3]=w=>v.value=w),header:N(p)("tablesPage.tableNum")+": "+g.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:T(()=>[o(Ze,{selectedTable:g.value,onTableEditConfirm:r,onCleanTable:$,onShowTableOrders:U,onOnEdit:H},null,8,["selectedTable"])]),_:1},8,["visible","header"]),o(d,{visible:i.value,"onUpdate:visible":a[4]||(a[4]=w=>i.value=w),modal:!0,dismissableMask:!0,header:N(p)("tablesPage.orderDetails"),style:{"min-width":"350px","max-width":"550px"},onHide:a[5]||(a[5]=w=>j())},{default:T(()=>[o(it,{selectedTable:g.value,onSaveOrder:B,onCancelOrderEdit:j,onShowToast:f},null,8,["selectedTable"])]),_:1},8,["visible","header"])],64)}}};export{jt as default};
