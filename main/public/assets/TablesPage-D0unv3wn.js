import{s as ae}from"./index-D0AciArL.js";import{s as ue}from"./index-C6tRekBG.js";import{a as X}from"./index-B_YKiWus.js";import{q as ee,h as C,s as G,c as P,o as u,a as e,b as i,w as p,t as v,C as J,F as B,n as j,f as q,e as E,E as K,l as S,z as Q,A as Z,u as ce,x as se,i as oe,H as te,J as de}from"./index-B-1Cs4Uy.js";import{b as fe,a as pe,s as ve}from"./index-DvjN8Ok5.js";import{s as ge}from"./index-BZW3Yl_9.js";import{s as ye}from"./index-CxyQ8QUE.js";import{a as be}from"./index-BeGUpNxR.js";import{s as he}from"./index-BLsm8HDp.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as _e}from"./index-DTf1LjPM.js";import{s as xe}from"./index-C1xYaV8I.js";import{s as Te}from"./index-dTwvkRQi.js";import{Q as $e,C as le}from"./CodeMaker-IOgtdCDu.js";import{s as ke}from"./index-CR_Uz7wA.js";import"./index-BSqrLTsS.js";import"./index-n1EPC5Sr.js";import"./index-DOlfR-ub.js";import"./index-DQ54BhAZ.js";import"./index-7Gu1yr94.js";import"./index-B8_8ifBy.js";import"./index-BvWvKpue.js";import"./index-0eSHf2I-.js";import"./_commonjsHelpers-gnU0ypJ3.js";const we={class:"hidden sm:block md:block lg:block"},Pe={class:"p-menuitem-content"},Ce={class:"text-center"},Se={class:"block sm:hidden md:hidden lg:hidden w-full ml-2"},Ne={__name:"TableMenuBar",props:{filterStatu:String},setup(D){const{t:y}=ee(),h=C(D.filterStatu),b=G(()=>[{label:y("tablesPage.all"),value:"Todos",icon:"pi pi-circle-fill",severity:"contrast",message_severity:"contrast"},{label:y("tablesPage.available"),value:"Livre",icon:"pi pi-circle-fill",severity:"success",message_severity:"success"},{label:y("tablesPage.dining"),value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger",message_severity:"error"},{label:y("tablesPage.reserved"),value:"Reservado",icon:"pi pi-circle-fill",severity:"info",message_severity:"info"},{label:y("tablesPage.paid"),value:"Pago",icon:"pi pi-circle-fill",severity:"help",message_severity:"secondary"}]);function m(f){return b.value.find(c=>c.value===f)}return(f,c)=>{const k=X,V=ye,N=ge,w=fe;return u(),P(B,null,[e("div",we,[i(V,{model:b.value,breakpoint:"319px",class:"border-0"},{item:p(({item:x})=>[e("div",Pe,[i(k,{label:x.label,icon:x.icon,severity:x.severity,variant:"outlined",raised:"",class:"border-round-lg p-2",onClick:z=>f.$emit("update:filterStatu",x.value)},{default:p(()=>[e("label",Ce,"● "+v(x.label),1)]),_:2},1032,["label","icon","severity","onClick"])])]),_:1},8,["model"])]),e("div",Se,[i(w,{modelValue:h.value,"onUpdate:modelValue":[c[0]||(c[0]=x=>h.value=x),c[1]||(c[1]=x=>f.$emit("update:filterStatu",h.value))],options:b.value,optionValue:"value",checkmark:"",highlightOnSelect:!1,class:"flex align-items-center",size:"small",style:{width:"200px",height:"40px"}},{value:p(x=>[i(N,{class:"text-center",severity:m(x.value).message_severity,variant:"simple"},{default:p(()=>[J("● "+v(m(x.value).label),1)]),_:2},1032,["severity"])]),option:p(x=>[i(N,{class:"text-center",severity:x.option.message_severity,variant:"simple"},{default:p(()=>[J(v(x.option.label),1)]),_:2},1032,["severity"])]),_:1},8,["modelValue","options"])])],64)}}},Me={class:"overflow-auto",style:{height:"calc(100vh - 200px)"}},Oe={class:"hidden sm:block md:block lg:block"},De={class:"grid m-2"},Ee={class:"relative"},Ve={class:"flex flex-column justify-content-center align-items-center",style:{height:"144px"}},je={class:"flex justify-content-center align-items-center",style:{height:"30%"}},Ae={class:"text-2xl font-bold"},qe={key:0,class:"flex flex-column align-items-center",style:{height:"70%"}},ze={class:"text-center text-lg"},Ue={class:"text-center text-2xl font-bold"},Re=["onClick"],Le={class:"block sm:hidden md:hidden lg:hidden"},Be={class:"grid m-2"},Fe={class:"col-12"},Je={class:"col-12"},He={class:"relative"},Ie={class:"flex flex-row p-0"},Ge={class:"flex justify-content-center align-items-center relative",style:{width:"30%",height:"74px"}},Qe={class:"absolute top-0 left-0 pl-1 text-xs"},Ze={class:"font-bold text-4xl"},Ke={key:0,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"}},Ye={class:"flex relative",style:{width:"30%",height:"74px"}},We={class:"absolute top-0 left-0 pl-1 text-xs"},Xe={class:"flex justify-content-center align-items-center w-full"},et={class:"font-bold text-2xl"},tt={class:"flex relative",style:{width:"70%",height:"74px"}},lt={class:"absolute top-0 left-0 pl-1 text-xs"},at={class:"flex justify-content-center align-items-center w-full"},st={class:"font-bold text-2xl"},ot=["onClick"],nt={class:"font-bold text-xl"},it={class:"ont-bold"},rt={class:"flex flex-wrap justify-content-end mt-3"},dt={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(D,{emit:y}){const{t:l}=ee(),h=C(!1),b=C(),m=C(!1),f=C({}),c=G(()=>[{label:l("tablesPage.available"),value:"Livre"},{label:l("tablesPage.dining"),value:"Ocupado"},{label:l("tablesPage.reserved"),value:"Reservado"},{label:l("tablesPage.paid"),value:"Pago"}]);function k(g){return c.value.find(r=>r.value===g)}function V(g){return Number(g.peopleType.children)+Number(g.peopleType.adults)}function N(g){return!g||!Array.isArray(g)?0:parseFloat(g.reduce((r,A)=>r+A.price*A.quantity,0).toFixed(2))}function w(g){const r=j.getCurrentPeoplePrice();return Number(g.peopleType.children)*r.children+Number(g.peopleType.adults)*r.adults}function x(g){return(N(g.order)+w(g)).toFixed(2)}function z(g,r){let M="";switch(g){case"Livre":M="text-green-600";break;case"Ocupado":M="text-red-600";break;case"Reservado":M="text-blue-700";break;case"Pago":M="text-purple-600";break;default:M="text-gray-600"}return""+M}function U(g,r=3){const A="border-"+r+" border-gray-500 ";let M="";switch(g){case"Livre":break;case"Ocupado":M="border-red-300 bg-red-50";break;case"Reservado":M="border-blue-300 bg-blue-50";break;case"Pago":M="border-purple-300 bg-purple-50";break;default:M="border-gray-500"}return A+M}function d(g,r){r=="pay"?(f.value=g.nif_note,m.value=!0):g["msg_"+r]=!1,j.socket.emit("click_msg",g.id,r)}function H(){document.getElementById("tipsAudio").play()}return j.playSoundFun=H,(g,r)=>{const A=he,M=X,I=ue,R=ae,F=be;return u(),P(B,null,[e("div",Me,[r[12]||(r[12]=e("audio",{id:"tipsAudio",src:"/sound/tips.mp3",preload:"auto"},null,-1)),e("div",Oe,[e("div",De,[D.editMode?(u(),q(A,{key:0,class:"m-1 border-3 border-gray-500 border-round-3xl flex justify-content-center align-items-center",style:{width:"150px",height:"150px"},onClick:r[0]||(r[0]=t=>h.value=!0)},{content:p(()=>r[8]||(r[8]=[e("div",{class:"flex justify-content-center align-items-center"},[e("i",{class:"pi pi-plus text-3xl text-gray-600"})],-1)])),_:1})):E("",!0),(u(!0),P(B,null,K(D.filteredTables,t=>(u(),q(A,{class:Q([U(t.status),"m-1 border-round-3xl flex flex-column justify-content-center align-items-center"]),style:{width:"150px",height:"150px"},onClick:n=>D.editMode?"":g.$emit("openTableDetail",t.id)},{header:p(()=>[e("div",Ee,[t.msg_pay?(u(),q(M,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"0px","z-index":"10"},onClick:Z(n=>d(t,"pay"),["stop"])},null,8,["onClick"])):E("",!0),t.msg_call?(u(),q(M,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"30px","z-index":"10"},onClick:Z(n=>d(t,"call"),["stop"])},null,8,["onClick"])):E("",!0)])]),content:p(()=>[e("div",Ve,[e("div",je,[e("label",Ae,v(S(l)("tablesPage.tableNum"))+": "+v(t.id),1)]),D.editMode?E("",!0):(u(),P("div",qe,[e("label",{class:Q(["text-center text-sm",z(t.status)])},v(k(t.status).label),3),e("p",ze,v(V(t)+" "+S(l)("tablesPage.people")),1),e("p",Ue,v(x(t))+"€",1)])),D.editMode?(u(),P("div",{key:1,class:Q(U(t.status,1)),style:{width:"144px"}},null,2)):E("",!0),D.editMode?(u(),P("div",{key:2,class:"flex flex-wrap justify-content-center align-items-center w-full",style:{height:"70%"},onClick:Z(n=>g.$emit("removeTable",t.id),["stop"])},r[9]||(r[9]=[e("i",{class:"pi pi-trash text-3xl text-red-400"},null,-1)]),8,Re)):E("",!0)])]),_:2},1032,["class","onClick"]))),256))])]),e("div",Le,[e("div",Be,[e("div",Fe,[D.editMode?(u(),q(A,{key:0,class:"border-3 border-gray-500 flex align-items-center justify-content-center",onClick:r[1]||(r[1]=t=>h.value=!0),style:{height:"80px"}},{content:p(()=>r[10]||(r[10]=[e("div",{class:"flex justify-content-center align-items-center"},[e("i",{class:"pi pi-plus text-2xl text-gray-600",size:"large"})],-1)])),_:1})):E("",!0)]),(u(!0),P(B,null,K(D.filteredTables,t=>(u(),P("div",Je,[i(A,{class:Q([U(t.status),"flex justify-content-center border-round-2xl"]),style:{height:"80px"},onClick:n=>D.editMode?"":g.$emit("openTableDetail",t.id)},{header:p(()=>[e("div",He,[t.msg_pay?(u(),q(M,{key:0,icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"},onClick:Z(n=>d(t,"pay"),["stop"])},null,8,["onClick"])):E("",!0),t.msg_call?(u(),q(M,{key:1,icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"},onClick:Z(n=>d(t,"call"),["stop"])},null,8,["onClick"])):E("",!0)])]),content:p(()=>[e("div",Ie,[e("div",Ge,[e("small",Qe,v(S(l)("tablesPage.tableNum")),1),e("label",Ze,v(t.id),1)]),e("div",{class:Q(U(t.status,1))},null,2),D.editMode?E("",!0):(u(),P("div",Ke,[e("div",Ye,[e("small",We,v(S(l)("tablesPage.peopleNum")),1),e("div",Xe,[e("label",et,v(V(t)),1)])]),e("div",{class:Q([U(t.status,1),"h-full"])},null,2),e("div",tt,[e("small",lt,v(S(l)("tablesPage.costNum")),1),e("div",at,[e("label",st,v(x(t))+" €",1)])])])),D.editMode?(u(),P("div",{key:1,class:"flex flex-row justify-content-center align-items-center",style:{width:"70%",height:"74px"},onClick:Z(n=>g.$emit("removeTable",t.id),["stop"])},r[11]||(r[11]=[e("i",{class:"pi pi-trash text-2xl text-gray-600",size:"large"},null,-1)]),8,ot)):E("",!0)])]),_:2},1032,["class","onClick"])]))),256))])])]),i(R,{visible:m.value,"onUpdate:visible":r[2]||(r[2]=t=>m.value=t),modal:!0,dismissableMask:!0,header:S(l)("tablesPage.payInfo"),style:{"min-width":"300px","max-width":"450px"},onHide:r[3]||(r[3]=t=>f.value={nif:void 0,note:void 0})},{default:p(()=>{var t,n;return[e("label",nt,"NIF:"+v((t=f.value)!=null&&t.nif?f.value.nif:S(l)("tablesPage.noNif")),1),i(I),e("label",it,v(S(l)("tablesPage.note"))+": "+v((n=f.value)!=null&&n.note?f.value.note:S(l)("tablesPage.noNote")),1)]}),_:1},8,["visible","header"]),i(R,{visible:h.value,"onUpdate:visible":r[6]||(r[6]=t=>h.value=t),modal:!0,dismissableMask:!0,header:S(l)("tablesPage.addTable"),onHide:r[7]||(r[7]=t=>b.value=void 0)},{default:p(()=>[i(F,{modelValue:b.value,"onUpdate:modelValue":r[4]||(r[4]=t=>b.value=t),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:`${S(l)("tablesPage.tableNum")}：${b.value<10?"0":""}`,step:1,min:1,max:9999,placeholder:S(l)("tablesPage.enterTable"),fluid:""},{incrementbuttonicon:p(()=>r[13]||(r[13]=[e("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:p(()=>r[14]||(r[14]=[e("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix","placeholder"]),e("div",rt,[i(M,{label:S(l)("tablesPage.createTable"),onClick:r[5]||(r[5]=t=>{g.$emit("addNewTable",b.value),h.value=!1})},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},ut=me(dt,[["__scopeId","data-v-3714826b"]]),ct={class:"flex flex-column justify-content-center align-items-center"},pt={for:"Total"},vt={key:0,class:"flex flex-wrap justify-content-center align-items-center"},bt={for:"Adult"},mt={key:1,class:"flex flex-wrap justify-content-center align-items-center"},ft={for:"Children"},gt={class:"flex flex-wrap justify-content-center align-items-center m-2"},yt={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},ht={class:"m-2"},_t={key:0,class:"flex flex-wrap justify-content-between align-items-center"},xt={class:"flex flex-column"},Tt={class:"flex flex-row"},$t={key:1,class:"flex flex-wrap justify-content-between align-items-center"},kt={class:"flex flex-column"},wt={key:0,class:"flex flex-column gap-3"},Pt={class:"flex flex-column"},Ct={class:"font-bold"},St={class:"text-sm text-500"},Nt={key:1,class:"text-center p-4"},Mt={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(D,{emit:y}){const{t:l}=ee();let h=!1;const b=ce(),m=C(!1),f=C(!1),c=C(!1),k=C(null),V=C(j.getSettingsValue("useAuth")),N=D,w=y;function x(){c.value=!0}async function z(s){k.value=s.id;try{await j.updateUserAuth(d.value.id,s.id,!s.authorized),b.add({severity:"success",summary:l("common.success"),detail:l("tablesPage.updateSucMsg"),life:3e3}),s.authorized=!s.authorized}catch(T){b.add({severity:"error",summary:l("common.error"),detail:T,life:3e3})}finally{k.value=null}}function U(){w("onEdit",N.selectedTable.id,s=>{d.value=JSON.parse(JSON.stringify(s)),m.value=!0})}const d=C(JSON.parse(JSON.stringify(N.selectedTable))),H=C([{label:l("tablesPage.available"),value:"Livre",severity:"success"},{label:l("tablesPage.dining"),value:"Ocupado",severity:"danger"},{label:l("tablesPage.reserved"),value:"Reservado",severity:"info"},{label:l("tablesPage.paid"),value:"Pago",severity:"help"}]);function g(){h||(f.value=!1,d.value=JSON.parse(JSON.stringify(N.selectedTable))),h=!1}const r=G(()=>Number(d.value.peopleType.children)+Number(d.value.peopleType.adults));function A(){d.value.status?(w("tableEditConfirm",d.value,s=>{(s==null?void 0:s.success)==!0?(b.add({severity:"success",summary:l("common.success"),detail:s.message,life:3e3}),m.value=!1):b.add({severity:"error",summary:l("common.error"),detail:s.message,life:3e3})}),f.value=!1,h=!0):b.add({severity:"error",summary:l("common.error"),detail:l("tablesPage.stateError"),life:3e3})}function M(){f.value=!0}function I(){m.value=!1,d.value=JSON.parse(JSON.stringify(N.selectedTable))}function R(){return H.value.find(s=>s.value===d.value.status)}function F(s,T){const L=Number(T);if(s==="Adult"){Number(d.value.peopleType.adults)+L<=0?d.value.peopleType.adults=0:d.value.peopleType.adults=Number(d.value.peopleType.adults)+L,d.value.people=Number(d.value.peopleType.adults)+Number(d.value.peopleType.children);return}if(s==="Children"){d.value.peopleType.children+L<=0?d.value.peopleType.children=0:d.value.peopleType.children=Number(d.value.peopleType.children)+L,d.value.people=Number(d.value.peopleType.adults)+Number(d.value.peopleType.children);return}}const t=se(),n=()=>{t.require({message:l("tablesPage.clearMsg.1")+d.value.id+l("tablesPage.clearMsg.2"),header:l("tablesPage.confirmClear"),icon:"pi pi-info-circle",rejectLabel:l("common.cancel"),rejectProps:{label:l("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:l("common.confirm"),severity:"danger"},accept:()=>{w("cleanTable",d.value.id,s=>{(s==null?void 0:s.success)===!1?b.add({severity:"error",summary:l("common.error"),detail:s.message,life:3e3}):(s==null?void 0:s.success)===!0&&b.add({severity:"success",summary:l("common.success"),detail:`${l("tablesPage.clearSucMsg.1")}${d.value.id}${l("tablesPage.clearSucMsg.2")}`,life:3e3})})},reject:()=>{b.add({severity:"error",summary:l("common.operation"),detail:`${l("tablesPage.clearCancelMsg.1")}${d.value.id}${l("tablesPage.clearCancelMsg.2")}`,life:3e3})}})},a=C(null);function o(){window.open(window.env.QR_ADDR+le.SimpleEncode(N.selectedTable.id),"_blank")}const _=async()=>{if(a.value)try{await $e.toCanvas(a.value,window.env.QR_ADDR+le.SimpleEncode(N.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(s){console.error("生成二维码失败:",s)}};return oe(()=>{_()}),te(()=>N.selectedTable,s=>{m.value||(d.value=JSON.parse(JSON.stringify(s)))},{deep:!0}),te(()=>window.env.QR_ADDR+le.SimpleEncode(N.selectedTable.id),_),(s,T)=>{var ie,re;const L=Te,Y=xe,$=X,W=_e,ne=ae;return u(),P(B,null,[e("div",ct,[e("div",null,[i(Y,{class:"m-2",variant:"on"},{default:p(()=>[i(L,{id:"Total",modelValue:r.value,"onUpdate:modelValue":T[0]||(T[0]=O=>r.value=O),autocomplete:"off",disabled:""},null,8,["modelValue"]),e("label",pt,v(S(l)("tablesPage.totalPeople")),1)]),_:1})]),m.value?(u(),P("div",vt,[i($,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:T[1]||(T[1]=O=>F("Adult",-1))}),i(Y,{class:"m-2",variant:"on"},{default:p(()=>[i(L,{id:"Adult",modelValue:d.value.peopleType.adults,"onUpdate:modelValue":T[2]||(T[2]=O=>d.value.peopleType.adults=O),autocomplete:"off"},null,8,["modelValue"]),e("label",bt,v(S(l)("tablesPage.adult")),1)]),_:1}),i($,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:T[3]||(T[3]=O=>F("Adult",1))})])):E("",!0),m.value?(u(),P("div",mt,[i($,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:T[4]||(T[4]=O=>F("Children",-1))}),i(Y,{class:"m-2",variant:"on"},{default:p(()=>[i(L,{id:"Children",modelValue:d.value.peopleType.children,"onUpdate:modelValue":T[5]||(T[5]=O=>d.value.peopleType.children=O),autocomplete:"off"},null,8,["modelValue"]),e("label",ft,v(S(l)("tablesPage.child")),1)]),_:1}),i($,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:T[6]||(T[6]=O=>F("Children",1))})])):E("",!0)]),e("div",gt,[m.value?E("",!0):(u(),q($,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(ie=R())==null?void 0:ie.label,severity:(re=R())==null?void 0:re.severity,onClick:M},null,8,["label","severity"])),m.value?(u(),q(W,{key:1,modelValue:d.value.status,"onUpdate:modelValue":T[7]||(T[7]=O=>d.value.status=O),options:H.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:d.value.status===null},null,8,["modelValue","options","invalid"])):E("",!0)]),e("div",yt,[e("canvas",{ref_key:"qrCanvas",ref:a,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:o},null,512)]),e("div",ht,[m.value?E("",!0):(u(),P("div",_t,[e("div",xt,[V.value?(u(),q($,{key:0,label:s.$t("tablesPage.guests"),severity:"info",onClick:x},null,8,["label"])):E("",!0),e("div",Tt,[i($,{label:s.$t("tablesPage.orderDetails"),severity:"success",onClick:T[8]||(T[8]=()=>s.$emit("showTableOrders"))},null,8,["label"]),i($,{label:s.$t("tablesPage.clear"),onClick:n,severity:"danger"},null,8,["label"]),i($,{label:s.$t("tablesPage.edit"),onClick:U},null,8,["label"])])])])),m.value?(u(),P("div",$t,[i($,{label:s.$t("tablesPage.cancelEdit"),severity:"danger",raised:"",class:"m-2",onClick:I},null,8,["label"]),i($,{label:s.$t("tablesPage.saveEdit"),severity:"success",raised:"",class:"m-2",onClick:A},null,8,["label"])])):E("",!0)]),i(ne,{visible:f.value,"onUpdate:visible":T[10]||(T[10]=O=>f.value=O),modal:"",header:s.$t("tablesPage.editState"),closable:!0,dismissableMask:!0,onHide:g},{default:p(()=>[e("div",kt,[i(W,{modelValue:d.value.status,"onUpdate:modelValue":T[9]||(T[9]=O=>d.value.status=O),options:H.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:d.value.status===null},null,8,["modelValue","options","invalid"]),i($,{label:s.$t("common.confirm"),class:"mt-3",onClick:A},null,8,["label"])])]),_:1},8,["visible","header"]),i(ne,{visible:c.value,"onUpdate:visible":T[11]||(T[11]=O=>c.value=O),modal:"",header:s.$t("tablesPage.guestManagement"),closable:!0,dismissableMask:!0,style:{"min-width":"300px","max-width":"500px"}},{default:p(()=>[d.value.users&&d.value.users.length>0?(u(),P("div",wt,[(u(!0),P(B,null,K(d.value.users,O=>(u(),P("div",{key:O.id,class:"flex justify-content-between align-items-center p-2 border-bottom-1 border-300"},[e("div",Pt,[e("span",Ct,v(O.username),1),e("span",St,v(O.authorized?s.$t("tablesPage.authorized"):s.$t("tablesPage.unauthorized")),1)]),i($,{label:O.authorized?s.$t("tablesPage.revoke"):s.$t("tablesPage.authorize"),severity:O.authorized?"danger":"success",size:"small",onClick:Kt=>z(O),loading:k.value===O.id},null,8,["label","severity","onClick","loading"])]))),128))])):(u(),P("div",Nt,v(s.$t("tablesPage.noGuests")),1))]),_:1},8,["visible","header"])],64)}}},Ot=me(Mt,[["__scopeId","data-v-a2c05308"]]);function Dt(D){const y=new Date(D),l=N=>String(N).padStart(2,"0"),h=new Date(y.toLocaleString("en-US",{timeZone:"Europe/Lisbon"})),b=h.getFullYear(),m=l(h.getMonth()+1),f=l(h.getDate()),c=l(h.getHours()),k=l(h.getMinutes()),V=l(h.getSeconds());return`${b}-${m}-${f} ${c}:${k}:${V}`}const Et={class:"font-bold",style:{"min-width":"100px"}},Vt={__name:"TableOrderTimeLine",props:{table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},setup(D){const y=D,l=C([]),h=G(()=>{const c=y.table.order;return Array.isArray(c)?Array.from(new Set(c.flatMap(k=>Array.isArray(k.orderIds)?k.orderIds:[]))):[]}),b=G(()=>{const c=j.orders.value,k=h.value;return Array.isArray(c)?c.filter(V=>k.includes(V.id)).sort((V,N)=>V.timestamp-N.timestamp):[]}),m=[{field:"id",header:"订单号"},{field:"table",header:"桌号"},{field:"status",header:"状态"},{field:"timestamp",header:"时间",body:c=>Dt(c.timestamp)}],f=[{field:"dishid",header:"编号"},{field:"quantity",header:"数量"},{field:"name",header:"名称",body:c=>j.getDishName(c)}];return oe(()=>{l.value=b.value.map(c=>c.id)}),(c,k)=>{const V=pe,N=ve;return u(),q(N,{value:b.value,dataKey:"id",expandedRows:l.value,"onUpdate:expandedRows":k[0]||(k[0]=w=>l.value=w),expandableRows:""},{expansion:p(w=>[(u(!0),P(B,null,K(w.data.items,x=>(u(),P("div",{key:x.dishid,class:"p-3 mb-2 border-round bg-gray-100"},[(u(),P(B,null,K(f,z=>e("div",{key:z.field,class:"flex gap-2 mb-1"},[e("span",Et,v(z.header)+":",1),e("span",null,v(typeof z.body=="function"?z.body(x):x[z.field]),1)])),64))]))),128))]),default:p(()=>[i(V,{expander:"",style:{width:"3rem"}}),(u(),P(B,null,K(m,w=>i(V,{key:w.field,field:w.field,header:w.header,sortable:""},{body:p(x=>[J(v(typeof w.body=="function"?w.body(x.data):x.data[w.field]),1)]),_:2},1032,["field","header"])),64))]),_:1},8,["value","expandedRows"])}}},jt={key:0},At={class:"flex flex-column"},qt={key:0},zt=["disabled","onClick"],Ut={class:"text-center py-5"},Rt={class:"text-gray-500"},Lt={key:1},Bt={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},Ft={class:"font-bold"},Jt={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(D,{emit:y}){var n;const{t:l}=ee(),h=D,b=y,m=C((n=h.selectedTable.order)==null?void 0:n.sort((a,o)=>o.price-a.price).filter(a=>a.quantity!=0));te(()=>h.selectedTable.order,a=>{k.value||(m.value=(a==null?void 0:a.sort((o,_)=>_.price-o.price).filter(o=>o.quantity!=0))||[],f.value=m.value.filter(o=>o.price!=0))},{deep:!0});const f=C(m.value.filter(a=>a.price!=0)),c=C([]),k=C(!1),V=C(!1),N=C(!1),w=C();oe(()=>{x()});function x(){j.getPeoplePricesData(w,h.selectedTable.id)}const z=G(()=>{const a=U(),o=m.value.reduce((_,s)=>_+s.price*s.quantity,0);return(a+o).toFixed(2)});function U(){if(!w.value)return 0;let a=0;for(const o in w.value)a+=Number(w.value[o].totalPrice);return a}const d=G(()=>{for(const a in w.value)if(w.value[a].price!=0)return!0;return!1});function H(a){let o=0;return a.forEach(_=>{o+=_.price*_.quantity}),o.toFixed(2)}function g(){k.value=!k.value,!k.value&&c.value.length>0&&t()}function r(a){if(c.value.find(o=>o.dishid===a.dishid))c.value.find(o=>o.dishid===a.dishid).quantity+=1;else{const o={...a,quantity:1};c.value.push(o)}a.quantity-=1}function A(){let a="| ";return c.value.forEach(o=>{const _=m.value.find(s=>s.dishid===o.dishid);_&&(a+=o.dishid+"-"+j.getDishName(o)+" "+(_.quantity+o.quantity)+" -> "+_.quantity+` | 
`)}),a}function M(a){b("cancelOrderEdit"),b("showToast","error",l("common.operation"),l("tablesPage.editCancelMsg")+`
`+a),c.value.forEach(o=>{m.value.find(_=>_.dishid===o.dishid).quantity+=o.quantity}),c.value=[]}function I(a){var o;b("saveOrder",c.value),b("showToast","info",l("common.operation"),l("tablesPage.ediSucMsg")+`
`+a),c.value=[],m.value=(o=h.selectedTable.order)==null?void 0:o.sort((_,s)=>s.price-_.price).filter(_=>_.quantity!=0)}const R=se();function F(a){return Array.isArray(a)?a.map(de):de(a)}const t=()=>{let a=!1;const o=F(A());R.require({message:o,escape:!0,header:l("tablesPage.editOrder"),rejectLabel:l("common.cancel"),rejectProps:{label:l("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:l("common.save"),severity:"danger"},accept:()=>{a=!0,I(o)},reject:()=>{a=!0,M(o)},onHide:()=>{a||M(o)}})};return(a,o)=>{const _=pe,s=ve,T=be,L=ke,Y=X;return u(),P(B,null,[N.value?(u(),P("div",Lt,[i(Vt,{table:D.selectedTable},null,8,["table"])])):(u(),P("div",jt,[e("div",At,[d.value?(u(),q(s,{key:0,value:w.value},{default:p(()=>[i(_,{field:"peopleType",header:S(l)("tablesPage.peopleType")},{body:p(({data:$})=>[J(v(S(l)("tablesPage."+($.peopleType.toLowerCase().includes("adult")?"adult":"child"))),1)]),_:1},8,["header"]),i(_,{field:"price",header:S(l)("tablesPage.price")},null,8,["header"]),i(_,{field:"quantity",header:S(l)("tablesPage.quantity")},null,8,["header"]),i(_,{field:"totalPrice",header:S(l)("tablesPage.totalPrice")},null,8,["header"])]),_:1},8,["value"])):E("",!0)]),i(s,{value:V.value?f.value:m.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:p(()=>[e("div",Ut,[e("p",Rt,v(a.$t("tablesPage.noOrder")),1)])]),default:p(()=>[i(_,{field:"dishid",header:"ID"}),i(_,{header:a.$t("tablesPage.name")},{body:p($=>[J(v(S(j).getDishName($.data)),1)]),default:p(()=>[o[3]||(o[3]=J(" > ",-1))]),_:1,__:[3]},8,["header"]),i(_,{field:"price",header:a.$t("tablesPage.price")},null,8,["header"]),i(_,{field:"quantity",header:a.$t("tablesPage.quantity")},{body:p($=>[k.value?E("",!0):(u(),P("label",qt,v($.data.quantity),1)),k.value?(u(),q(T,{key:1,modelValue:$.data.quantity,"onUpdate:modelValue":W=>$.data.quantity=W,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:p(()=>o[4]||(o[4]=[e("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:p(()=>[e("span",{class:"p-inputnumber-button-icon",disabled:$.data.quantity<=0,onClick:W=>r($.data)},o[5]||(o[5]=[e("i",{class:"pi pi-angle-down"},null,-1)]),8,zt)]),_:2},1032,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:1},8,["header"]),i(_,{header:a.$t("tablesPage.totalPrice")},{body:p($=>[J(v(H([$.data])),1)]),default:p(()=>[o[6]||(o[6]=J(" > ",-1))]),_:1,__:[6]},8,["header"])]),_:1},8,["value"])])),e("div",Bt,[e("label",Ft,v(a.$t("tablesPage.total")+": ")+" "+v(z.value),1),e("label",null,[i(L,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=$=>V.value=$)},null,8,["modelValue"]),J(" "+v(a.$t("tablesPage.showNonZero")),1)]),e("label",null,[i(L,{modelValue:N.value,"onUpdate:modelValue":o[1]||(o[1]=$=>N.value=$)},null,8,["modelValue"]),J(" "+v(a.$t("tablesPage.timeLine")),1)]),i(Y,{label:k.value?a.$t("common.save"):a.$t("common.edit"),onClick:o[2]||(o[2]=$=>g())},null,8,["label"])])],64)}}},Ht={class:"flex flex-wrap justify-content-between align-items-center m-1"},It={class:""},Gt={class:"m-2"},Qt={class:"hidden sm:block md:block lg:block"},Zt={class:"hidden sm:block md:block lg:block"},xl={__name:"TablesPage",setup(D){const{t:y}=ee(),l=se(),h=C("Todos"),b=C(!1),m=C(!1),f=C({id:0}),c=C(!1),k=C({});te(()=>j.tables.value,t=>{(m.value||c.value)&&f.value.id!==0&&U(f.value.id)},{deep:!0});const V=G(()=>h.value==="Todos"?j.tables.value:j.tables.value.filter(t=>t.status===h.value));function N(){b.value=!0}function w(){b.value==!0&&(b.value=!1)}function x(t){l.require({message:y("tablesPage.removeTableMsg.1")+t+y("tablesPage.removeTableMsg.2"),header:y("tablesPage.removeTableHeader"),icon:"pi pi-trash",rejectProps:{label:y("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:y("common.confirm"),severity:"danger"},accept:()=>{const n=j.deleteTable(t);n!=null?R.add({severity:"error",summary:n.title,detail:n.message,life:3e3}):R.add({severity:"info",summary:y("common.success"),detail:y("tablesPage.removeSucMsg.1")+t+y("tablesPage.removeSucMsg.2"),life:3e3})},reject:()=>{}})}async function z(t){t<10&&(t="0"+t);const n=await j.addNewTable(t);n!==void 0?R.add({severity:"error",summary:n.title,detail:n.message,life:3e3}):R.add({severity:"info",summary:y("common.success"),detail:y("tablesPage.createSucMsg.1")+t+y("tablesPage.createSucMsg.2"),life:3e3})}function U(t){const n=j.tables.value.find(a=>a.id===t);f.value={...n,order:(n==null?void 0:n.order)||[]}}function d(t,n){const a=j.tables.value.find(o=>o.id===t);f.value={...a,order:(a==null?void 0:a.order)||[]},n(f.value)}function H(t){U(t),m.value=!0}function g(t,n){const a={id:t.id,status:t.status,peopleType:{adults:t.peopleType.adults,children:t.peopleType.children}},o=j.updateTable(a);U(t.id),n(o?{success:!1,message:y("tablesPage.updateFailMsg")}:{success:!0,message:y("tablesPage.updateSucMsg")})}function r(t,n){const a=j.tableClean(t);a?(console.log("cleanTable Error:",a),n({success:!1,message:y("tablesPage.updateFailMsg")})):(m.value=!1,n({success:!0,message:y("tablesPage.updateSucMsg")}))}function A(){const t=f.value.id;U(t),c.value=!0}function M(t){j.deleteOrders(f.value.id,t),k.value.order&&(j.deleteOrder(k.value),k.value={})}function I(){j.refreshTables()}const R=ce();function F(t,n,a,o){R.add({severity:t||"",summary:n||"",detail:a||"",life:o||3e3})}return(t,n)=>{const a=X,o=ue,_=ae;return u(),P(B,null,[e("div",Ht,[e("div",It,[i(Ne,{filterStatu:h.value,"onUpdate:filterStatu":n[0]||(n[0]=s=>h.value=s),style:{padding:"0"}},null,8,["filterStatu"])]),e("div",Gt,[b.value?E("",!0):(u(),q(a,{key:0,class:"unchange_white_text_button",onClick:N},{default:p(()=>[n[6]||(n[6]=e("i",{class:"pi pi-pencil"},null,-1)),e("label",Qt,v(S(y)("tablesPage.editTables")),1)]),_:1,__:[6]})),b.value?(u(),q(a,{key:1,class:"unchange_white_text_button",onClick:w},{default:p(()=>[n[7]||(n[7]=e("i",{class:"pi pi-arrow-left"},null,-1)),e("label",Zt,v(S(y)("tablesPage.closeEdit")),1)]),_:1,__:[7]})):E("",!0)])]),i(o,{class:"m-0"}),i(ut,{filteredTables:V.value,"onUpdate:filteredTables":n[1]||(n[1]=s=>V.value=s),editMode:b.value,"onUpdate:editMode":n[2]||(n[2]=s=>b.value=s),onOpenTableDetail:H,onRemoveTable:x,onAddNewTable:z},null,8,["filteredTables","editMode"]),i(_,{visible:m.value,"onUpdate:visible":n[3]||(n[3]=s=>m.value=s),header:S(y)("tablesPage.tableNum")+": "+f.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:p(()=>[i(Ot,{selectedTable:f.value,onTableEditConfirm:g,onCleanTable:r,onShowTableOrders:A,onOnEdit:d},null,8,["selectedTable"])]),_:1},8,["visible","header"]),i(_,{visible:c.value,"onUpdate:visible":n[4]||(n[4]=s=>c.value=s),modal:!0,dismissableMask:!0,header:S(y)("tablesPage.orderDetails"),style:{"min-width":"350px","max-width":"550px"},onHide:n[5]||(n[5]=s=>I())},{default:p(()=>[i(Jt,{selectedTable:f.value,onSaveOrder:M,onCancelOrderEdit:I,onShowToast:F},null,8,["selectedTable"])]),_:1},8,["visible","header"])],64)}}};export{xl as default};
