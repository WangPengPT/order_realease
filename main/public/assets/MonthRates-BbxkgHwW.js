import{s as G}from"./index-zuixQpAF.js";import{s as I,a as O}from"./index-3qmRMy-X.js";import{s as W,a as q,b as J,c as K}from"./index-CyxEeD_l.js";import{s as Q}from"./index-RVcTUFwK.js";import{s as X}from"./index-BMh2bsXb.js";import{b as ee}from"./index-BApRYYkm.js";import{h as d,G as te,n as x,c as m,d as l,a as p,w as o,j as ae,o as r,l as le,F as y,A as k,f as v,z as h,t as _,e as oe}from"./index-B7ldv59F.js";import"./index-AQ3C9tYn.js";import"./index-CEujosyQ.js";import"./index-D1RHvCj8.js";import"./index-Cw15LwKQ.js";import"./index-SlBXek8c.js";import"./index-BXiU1ugA.js";import"./index-WJc8gqs_.js";const se={class:"flex flex-column w-full",style:{position:"fixed",top:"0",left:"0"}},re={class:"flex flex-wrap justify-content-center align-items-center gap-1 ml-2"},ne={class:"card flex flex-column",style:{height:"calc(100vh - 200px)"}},P=2025,ie=1,Me={__name:"MonthRates",setup(ue){const z=ae(),n=d();H();const b=d(!0),D=new Date,g=D.getFullYear(),R=D.getMonth()+1;te(b,()=>{$(i.value,w.value)});const M=d([{id:0,value:0,label:"总评分"}]);S();function S(){for(let e=P;e<=g;e++)M.value.push({id:e,value:e,label:e})}function A(e){return!e.rates||!e.likes?0:e.likes/e.rates*5}function $(e,t){i.value=e,w.value=t,n.value=[],i.value===0?E(()=>{V()}):N(n,e,t,()=>{V()}),n.value=n.value.filter(s=>s.category)}function N(e,t,s,c){t==g&&s==R?e.value=x.menuData.value:x.getMonthRatesWithDate(e,t,s,()=>{c()}),c()}function E(e){for(let t=P;t<=g;t++)for(let s=ie;s<=R;s++){const c=d([]);N(c,t,s,()=>{c.value.forEach(C=>n.value.push(C))})}e()}function V(){b.value&&(n.value=n.value.filter(e=>e.rates))}async function H(){try{await x.refreshMenu(),n.value=x.menuData.value.filter(e=>e.category).filter(e=>e.rates)}catch(e){console.error("获取评分失败:",e),toast.add({severity:"error",summary:"错误",detail:"获取评分失败",life:3e3})}}const T=d([]);L();function L(){const e=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"];for(let t=0;t<e.length;t++)T.value.push({id:t+1,value:e[t],label:t+1+" - "+e[t].toUpperCase()})}const i=d(g),w=d(R);return(e,t)=>{const s=ee,c=X,C=Q,j=J,B=q,Y=K,F=W,f=O,U=I,Z=G;return r(),m("div",se,[l(C,{class:"bg-primary text-white p-2"},{start:o(()=>[l(s,{icon:"pi pi-arrow-left",class:"p-button-text text-white",label:"主页",onClick:t[0]||(t[0]=a=>le(z).push("/"))}),p("div",re,[l(c,{modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=a=>b.value=a),class:"green-toggle"},null,8,["modelValue"]),t[2]||(t[2]=p("label",null,"隐藏评分为0的菜品",-1))])]),_:1}),p("div",null,[l(F,{value:i.value},{default:o(()=>[l(B,null,{default:o(()=>[(r(!0),m(y,null,k(M.value,a=>(r(),v(j,{key:a.id,value:a.id,onClick:u=>$(a.id,w.value)},{default:o(()=>[h(_(a.label),1)]),_:2},1032,["value","onClick"]))),128))]),_:1}),(r(!0),m(y,null,k(M.value,a=>(r(),v(Y,{key:a.id,value:a.id},{default:o(()=>[i.value!==0?(r(),v(F,{key:0,value:w.value,scrollable:""},{default:o(()=>[l(B,null,{default:o(()=>[(r(!0),m(y,null,k(T.value,u=>(r(),v(j,{key:u.id,value:u.id,onClick:ce=>$(a.id,u.id)},{default:o(()=>[h(_(u.label),1)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024),(r(!0),m(y,null,k(T.value,u=>(r(),v(Y,{key:u.id,value:u.id},null,8,["value"]))),128))]),_:2},1032,["value"])):oe("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),p("div",ne,[l(U,{value:n.value,stripedRows:"",scrollable:"",scrollHeight:"flex",paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],tableStyle:"min-width: 50rem"},{empty:o(()=>t[3]||(t[3]=[p("div",{class:"text-center py-5"},[p("i",{class:"pi pi-search",style:{"font-size":"3rem",color:"#ccc"}}),p("p",{class:"mt-3 text-gray-500"},"未找到评分")],-1)])),default:o(()=>[l(f,{field:"id",header:"ID",sortable:""}),l(f,{field:"category",header:"类型",sortable:""}),l(f,{field:"name",header:"菜名"}),l(f,{field:"monthRates",header:(i.value===0?"":"当月")+"综合评分"},{body:o(({data:a})=>[h(_(A(a).toFixed(2)),1)]),_:1},8,["header"]),l(f,{field:"monthRates",header:(i.value===0?"":"当月")+"点赞数"},{body:o(({data:a})=>[h(_(a.likes?a.likes:0),1)]),_:1},8,["header"]),l(f,{field:"monthRates",header:(i.value===0?"":"当月")+"评分总数"},{body:o(({data:a})=>[h(_(a.rates?a.rates:0),1)]),_:1},8,["header"])]),_:1},8,["value"])])]),l(Z)])}}};export{Me as default};
