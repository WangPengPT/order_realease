import{s as D}from"./index-RExTw6Rx.js";import{s as z}from"./index-BtAr9kHO.js";import{s as I}from"./index-Bmi0JjVe.js";import{s as N}from"./index-BWn8x0Ui.js";import{b as U}from"./index-5ZZNUr_T.js";import{q as F,j as O,h as v,s as R,f as H,o as _,w,a,d as i,l as d,t as k,x as W,u as G,i as J,n as c,c as A,F as T,E as K,e as Q}from"./index-Cp7MK5GH.js";import{s as X}from"./index-Cg5mZie6.js";import{s as Y}from"./index-DLCP0lTf.js";import{_ as Z}from"./main-C8Q1gxG8.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-BOVrHiKk.js";import"./index-BKUb7z73.js";import"./index-D7UCpOy8.js";import"./index-D8OWP6uQ.js";import"./index-CVDPUBfE.js";import"./index-Bun3Cj71.js";import"./index-B7fHUpY8.js";const te={class:"relative"},ae={class:"absolute bottom-0 surface-800 left-0 w-full p-3 bg-black bg-opacity-50 text-white"},oe={class:"text-xl font-semibold"},se={class:"text-sm"},ie={class:"flex justify-content-end"},le={__name:"EditablePageCard",props:{page:Object},emits:[],setup(y,{emit:e}){const{t:n}=F(),o=O(),r=y,p=e;function m(g){o.push(`/editablePages/${g}`)}function u(){p("deletePage",r.page.id)}function P(){p("applypage",r.page.id)}function b(){p("exportPage",r.page.id)}const x=v(),$=R(()=>[{label:n("optionPages.option"),items:[{label:n("optionPages.apply"),icon:"pi pi-check-square",command:P},{label:n("common.delete"),icon:"pi pi-times",command:u},{label:n("common.export"),icon:"pi pi-file-export",command:b}]}]),j=g=>{x.value.toggle(g)};return(g,f)=>{const h=U,M=Y,C=X;return _(),H(C,{style:{width:"250px"},class:"relative"},{header:w(()=>[i(h,{type:"button",icon:"pi pi-ellipsis-v",class:"absolute top-2 right-0 z-5",onClick:j,"aria-haspopup":"true","aria-controls":"overlay_menu"}),i(M,{ref_key:"menu",ref:x,model:$.value,popup:!0},null,8,["model"]),a("div",te,[f[1]||(f[1]=a("img",{src:Z,style:{width:"100%",height:"150px","object-fit":"cover"}},null,-1)),a("div",ae,[a("div",oe,k(y.page.name),1),a("div",se,k(y.page.description),1)])])]),footer:w(()=>[a("div",ie,[i(h,{label:d(n)("common.edit"),text:"",onClick:f[0]||(f[0]=V=>m(y.page.id))},null,8,["label"])])]),_:1})}}},ne={class:"p-4"},re={class:"flex flex-wrap gap-4"},pe={class:"flex justify-center"},ce={class:"flex items-center gap-4 mb-4"},de={for:"name",class:"font-semibold w-24"},me={class:"flex items-center gap-4 mb-8"},ue={for:"description",class:"font-semibold w-24"},ge={class:"flex justify-end gap-2"},fe={class:"card flex justify-center"},ve={__name:"EditablePages",setup(y){const{t:e}=F(),n=W(),o=G(),r=v(""),p=v("");let m=null;const u=v(!1),P=v(!1),b=v("");async function x(){if(!r.value.trim()){o.add({severity:"warn",summary:e("common.error"),detail:e("optionPages.enterNameMsg"),life:3e3});return}await c.pageApi.addPage(r.value,p.value),await c.pageApi.getPages(),u.value=!1,r.value="",p.value=""}J(async()=>{b.value=sessionStorage.getItem("token"),await c.pageApi.getPages()});function $(l){n.require({message:e("optionPages.deletePageMsg"),header:e("optionPages.deletePageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.delete"),rejectLabel:e("common.cancel"),acceptClass:"p-button-danger",accept:async()=>{try{await c.pageApi.deletePage(l),o.add({severity:"success",summary:e("optionPages.deletedMsg"),detail:e("optionPages.deleteSucMsg"),life:3e3})}catch(t){o.add({severity:"error",summary:e("optionPages.notDeletedMsg"),detail:t.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{o.add({severity:"info",summary:e("optionPages.cancelMsg"),detail:e("optionPages.operationCancelMsg"),life:3e3})}})}function j(l){n.require({message:e("optionPages.applyPageMsg"),header:e("optionPages.applyPageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.confirm"),rejectLabel:e("common.cancel"),accept:async()=>{try{await c.pageApi.applyWelcomePage(l),o.add({severity:"success",summary:e("optionPages.applyMsg"),detail:e("optionPages.applySucMsg"),life:3e3})}catch(t){o.add({severity:"error",summary:e("optionPages.applyFailMsg"),detail:t.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{console.log("取消应用")}})}function g(l){n.require({message:e("optionPages.exportPageMsg"),header:e("optionPages.applyPageHeader"),icon:"pi pi-exclamation-triangle",acceptLabel:e("common.confirm"),rejectLabel:e("common.cancel"),accept:async()=>{try{await c.dataTransfer.exportPage(l),o.add({severity:"success",summary:e("optionPages.exportMsg"),detail:e("optionPages.exportSucMsg"),life:3e3})}catch(t){o.add({severity:"error",summary:e("optionPages.exportFailMsg"),detail:t.message||e("optionPages.serverErrorMsg"),life:3e3})}},reject:()=>{console.log("取消应用")}})}function f(){P.value=!0}function h(){m=setTimeout(()=>{f()},2e3)}function M(){m&&(clearTimeout(m),m=null)}function C(){M()}function V(l){var t;((t=l==null?void 0:l.xhr)==null?void 0:t.status)===200?o.value.add({severity:"success",summary:"成功",detail:"上传完成",life:3e3}):o.value.add({severity:"error",summary:"失败",detail:"上传失败",life:3e3})}return(l,t)=>{const E=U,B=N,L=I,S=z,q=D;return _(),A(T,null,[a("div",ne,[a("div",re,[(_(!0),A(T,null,K(d(c).pageApi.pages.value,s=>(_(),A("div",{key:s.title},[i(le,{page:s,onDeletePage:$,onApplypage:j,onExportPage:g},null,8,["page"])]))),128)),a("div",pe,[i(E,{style:{width:"200px",height:"200px"},icon:"pi pi-plus",onClick:t[0]||(t[0]=s=>u.value=!0),onMousedown:h,onMouseup:C,onMouseleave:M})])])]),i(L,{visible:u.value,"onUpdate:visible":t[4]||(t[4]=s=>u.value=s),modal:"",header:d(e)("optionPages.createPage"),style:{width:"25rem"}},{default:w(()=>[a("div",ce,[a("label",de,k(d(e)("optionPages.name")),1),i(B,{id:"name",class:"flex-auto",modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=s=>r.value=s),autocomplete:"off"},null,8,["modelValue"])]),a("div",me,[a("label",ue,k(d(e)("optionPages.description")),1),i(B,{id:"description",class:"flex-auto",modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=s=>p.value=s),autocomplete:"off"},null,8,["modelValue"])]),a("div",ge,[i(E,{type:"button",label:d(e)("common.cancel"),severity:"secondary",onClick:t[3]||(t[3]=s=>l.visible=!1)},null,8,["label"]),i(E,{type:"button",label:d(e)("common.save"),onClick:x},null,8,["label"])])]),_:1},8,["visible","header"]),i(L,{visible:P.value,"onUpdate:visible":t[5]||(t[5]=s=>P.value=s),header:"上传主页模板",modal:""},{default:w(()=>[a("div",fe,[i(S,{ref_key:"toast",ref:o},null,512),b.value?(_(),H(q,{key:0,mode:"basic",name:"page",url:"/api/import/page",headers:{authorization:`Bearer ${b.value}`},accept:".zip",maxFileSize:1e6,auto:!0,chooseLabel:"Browse",onUpload:V},null,8,["headers"])):Q("",!0)])]),_:1},8,["visible"])],64)}}},Te=ee(ve,[["__scopeId","data-v-a314ef34"]]);export{Te as default};
