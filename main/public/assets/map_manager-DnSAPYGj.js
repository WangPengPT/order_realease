import{r as i,o as F,L as v,J as M,f as o,E as u,F as T,H as k,h as j,I as V,M as O,D as x,N as U,O as I}from"./index-UMjGVMiU.js";import{V as b,a as s,b as H}from"./VTextField-DH4vsLrH.js";import{V as P,a as J}from"./VDialog-rI4KEimM.js";import{V as c}from"./scopeId-DOqiFFyj.js";import{V as h}from"./VForm-C1-h4WEz.js";import"./VList-DyWM5fp9.js";const Y={__name:"map_manager",setup(G){const m=i(!1),g=i(""),S=[{align:"start",key:"name",sortable:!1,title:"Restaurant"},{key:"address",title:"Address"},{key:"city",title:"City"},{key:"postalCode",title:"Postal Code"},{key:"phone",title:"Contact"},{key:"latitude",title:"Latitude"},{key:"longitude",title:"Longitude"}],C=i(null),r=i([{name:"Mountain Grill",address:"789 Hill Road",city:"Sintra",postalCode:"2710-591",phone:"+351564738291",latitude:"38.8029",longitude:"-9.3817"}]);F(()=>{v.getAllRestaurants(t=>{console.log("serverAPI.getAllRestaurants",t),t.result&&(r.value=t.datas)})});let f=i(!1);const l=i({});function N(t,e){console.log(t,e),f.value=!1,m.value=!0,l.value={...e.item}}function A(){m.value=!1;let t=l.value;if(console.log("THIS IS WHEN SUBMIT PRESSED, :",t),f.value){v.addRestaurant(t),r.value.push(t);return}const e=r.value.findIndex(a=>a.id===t.id);if(e!==-1){let a=r.value[e],d=!1;for(const n in l.value)if(t[n]!=a[e]){d=!0;break}d&&(v.setRestaurant(t),r.value.splice(e,1,l.value))}}function E(){m.value=!0,l.value={name:"",address:"",city:"",postalCode:"",phone:"",latitude:"",longitude:""},f.value=!0}function L(){v.getAllRestaurants(t=>{if(t.result){const e=JSON.stringify(t.datas,null,2),a=new Blob([e],{type:"application/json"}),d=URL.createObjectURL(a),n=document.createElement("a");n.href=d,n.download="restaurants_export.json",n.click(),URL.revokeObjectURL(d)}else console.error("Failed to fetch data from server for export.")})}function D(){C.value.click()}function B(t){const e=t.target.files[0];if(!e){console.warn("No file selected.");return}const a=new FileReader;a.onload=d=>{try{const n=JSON.parse(d.target.result);if(!Array.isArray(n))throw new Error("Invalid format: Expected an array of restaurants.");const R=new Set(r.value.map(p=>p.name.trim().toLowerCase()));n.forEach(p=>{var w;const y=(w=p.name)==null?void 0:w.trim().toLowerCase();!y||R.has(y)||(v.addRestaurant(p),r.value.push(p),R.add(y))}),console.log("Import successful:",n)}catch(n){console.error("Failed to import file:",n.message)}},a.readAsText(e)}return(t,e)=>(k(),M(T,null,[o(b,{title:"Map Manager",flat:""},{text:u(()=>[o(s,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"]),o(c,{class:"ma-2",onClick:E,color:"indigo-darken-3"},{default:u(()=>e[10]||(e[10]=[V("Add Restaurant")])),_:1,__:[10]}),o(c,{class:"ma-2",onClick:L,color:"green-darken-3"},{default:u(()=>e[11]||(e[11]=[V("Export")])),_:1,__:[11]}),o(c,{class:"ma-2",onClick:D,color:"blue-darken-3"},{default:u(()=>e[12]||(e[12]=[V("Import")])),_:1,__:[12]}),j("input",{type:"file",ref_key:"fileInput",ref:C,accept:".json",onChange:B,style:{display:"none"}},null,544)]),default:u(()=>[o(J,{headers:S,items:r.value,search:g.value,"onClick:row":N},null,8,["items","search"])]),_:1}),o(P,{modelValue:m.value,"onUpdate:modelValue":e[9]||(e[9]=a=>m.value=a),width:"500"},{default:u(()=>[o(b,{title:"Edit Info"},{default:u(()=>[o(H),o(h,{"fast-fail":"",onSubmit:O(A,["prevent"])},{default:u(()=>[I(f)?(k(),x(s,{key:0,class:"ma-3",modelValue:l.value.name,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.name=a),variant:"outlined",label:"Restaurant Name"},null,8,["modelValue"])):U("",!0),I(f)?U("",!0):(k(),x(s,{key:1,class:"ma-3",modelValue:l.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.name=a),variant:"outlined",label:"Restaurant Name",readonly:""},null,8,["modelValue"])),o(s,{class:"ma-3",modelValue:l.value.address,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.address=a),variant:"outlined",label:"Address"},null,8,["modelValue"]),o(s,{class:"ma-3",modelValue:l.value.city,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.city=a),variant:"outlined",label:"City"},null,8,["modelValue"]),o(s,{class:"ma-3",modelValue:l.value.postalCode,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.postalCode=a),variant:"outlined",label:"Postal Code"},null,8,["modelValue"]),o(s,{class:"ma-3",modelValue:l.value.phone,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.phone=a),variant:"outlined",label:"Contact"},null,8,["modelValue"]),o(s,{class:"ma-3",modelValue:l.value.latitude,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.latitude=a),variant:"outlined",label:"Latitude"},null,8,["modelValue"]),o(s,{class:"ma-3",modelValue:l.value.longitude,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.longitude=a),variant:"outlined",label:"Longitude"},null,8,["modelValue"]),o(b,{class:"text-center"},{default:u(()=>[o(c,{width:"200",class:"mb-3",type:"submit",color:"indigo-darken-3"},{default:u(()=>e[13]||(e[13]=[V("Submit")])),_:1,__:[13]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Y as default};
