import{u as b,w as B,F as O,V as j}from"./VDatePicker-CuyuI5Wd.js";import{_ as q,D,E as t,r as _,w as U,L as E,m as R,H as w,f as l,I as r,h as d,S as s,J as z,F as Y,K as G,N as H}from"./index-DVFL-tUX.js";import{V as F,x as J,G as K,y as W}from"./scopeId-BsoYstxX.js";import{V as Q,a as X}from"./VApp-BdIBpUdj.js";import{V as Z}from"./VMain-BITkmG0o.js";import{V as g}from"./VRow-cPxJR682.js";import{V as c}from"./VCol-CnL0iwoJ.js";import{g as I,d as x,a as $,V as ee}from"./VDialog-DlARyElG.js";import{a as te,V as M,d as le,j as ae,b as oe,e as ne}from"./VTextField-DivJZr3_.js";import{V as L}from"./VSpacer-DlJbCv1n.js";import{V as re,a as se,b as ie}from"./VList-Decq91wO.js";const de=[{title:"paid"},{title:"pending"},{title:"expired"},{title:"voided"}],ue={name:"ExportExcelComponent",setup(){const S=_(!1),e=_(null),V=_(!1),a=_(!1),C=_(null),P=o=>{console.log(o),C.value=o,a.value=!0};U(e,(o,i)=>{if(console.log("selectedMonth 发生了变化",o,i),o!=null){const f=new Date(o),h=f.getFullYear(),v=f.getMonth()+1,k={year:h,month:v};E.getReserveMonthList(k,p=>{console.log("getReserveMonthList",p),p.result&&(m.value=p.data)})}});const n=_([{title:"ID",key:"name",align:"center"},{title:"餐馆",key:"restaurant",align:"left"},{title:"客户",key:"customerName",align:"center"},{title:"人数",key:"numberPeople",align:"right"},{title:"日期",key:"date",align:"center"},{title:"时间",key:"time",align:"center"},{title:"状态",key:"status",align:"center"}]),u=o=>{if(!o)return"";const i=new Date(o);return`${i.getFullYear()}年${i.getMonth()+1}月`},m=_([]),T=o=>{const i={sc_sushi:"test",sc_amadora:"Amadora",sc_setubal:"Setúbal",sc_expo:"Expo Sul",sc_marques:"Marquês Pombal",sc_coimbra:"Coimbra",sc_roma:"Roma",sc_campodeorique:"Campo de Ourique",sc_oeiras:"Oeiras",sc_almada:"Almada",sc_cascais:"Cascais",sc_linda_a_velha:"Linda-a-Velha",sc_laranjeiras:"Laranjeiras",sc_odivelas:"Odivelas",sc_saldanha:"Saldanha"};return i[o]?i[o]:o};return{monthMenu:S,selectedMonth:e,headers:n,filteredData:m,loading:V,formatDisplayMonth:u,exportToExcel:async()=>{if(m.value.length){V.value=!0;try{const o=b.book_new(),i=m.value.map(y=>({ID:y.name,餐馆:T(y.restaurant),人数:y.numberPeople,日期:y.customerDate})),f=b.json_to_sheet(i),h=[{wch:8},{wch:20},{wch:15},{wch:12}];f["!cols"]=h;const v=u(e.value);b.book_append_sheet(o,f,`${v}数据`);const k=new Date().toISOString().slice(0,19).replace(/:/g,"-"),p=`数据导出_${v.replace("年","").replace("月","")}_${k}.xlsx`,N=B(o,{bookType:"xlsx",type:"array"}),A=new Blob([N],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});O.saveAs(A,p),console.log(`成功导出 ${m.value.length} 条数据`)}catch(o){console.error("导出失败:",o)}finally{V.value=!1}}},clearMonth:()=>{e.value=null},changeState:o=>{},getStatusColor:o=>o=="paid"?"green":o=="pending"?"blue":o=="expired"?"red":o=="voided"?"blank":"success",mergeProps:R,statusItems:de,changePayState:(o,i)=>{console.log("change state",o.id,i),E.call("reserve_change_state",{id:o.id,value:i},f=>{f.success&&(o.status=i)})},handleRowClick:P,detailDlgActive:a,currentRow:C}}};function ce(S,e,V,a,C,P){return w(),D(Q,null,{default:t(()=>[l(Z,null,{default:t(()=>[l(X,null,{default:t(()=>[l(g,{class:"mb-6"},{default:t(()=>[l(c,{cols:"12",sm:"6"},{default:t(()=>[l(I,{modelValue:a.monthMenu,"onUpdate:modelValue":e[3]||(e[3]=n=>a.monthMenu=n),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:n})=>[l(te,R({modelValue:a.selectedMonth,"onUpdate:modelValue":e[0]||(e[0]=u=>a.selectedMonth=u),label:"选择月份","prepend-icon":"mdi-calendar",readonly:""},n,{clearable:"","onClick:clear":a.clearMonth}),null,16,["modelValue","onClick:clear"])]),default:t(()=>[l(j,{modelValue:a.selectedMonth,"onUpdate:modelValue":[e[1]||(e[1]=n=>a.selectedMonth=n),e[2]||(e[2]=n=>a.monthMenu=!1)],type:"month"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),l(c,{cols:"12",sm:"6",class:"d-flex align-center"},{default:t(()=>[l(F,{color:"primary",disabled:!a.selectedMonth||!a.filteredData.length,onClick:a.exportToExcel,class:"ml-2"},{default:t(()=>[l(J,{left:""},{default:t(()=>e[6]||(e[6]=[r("mdi-microsoft-excel")])),_:1,__:[6]}),e[7]||(e[7]=r(" 导出Excel "))]),_:1,__:[7]},8,["disabled","onClick"])]),_:1})]),_:1}),l(M,null,{default:t(()=>[l(le,null,{default:t(()=>[d("span",null,"数据预览 ("+s(a.filteredData.length)+" 条记录)",1),l(L),l(x,{color:"primary",variant:"outlined"},{default:t(()=>[r(s(a.selectedMonth?a.formatDisplayMonth(a.selectedMonth):"请选择月份"),1)]),_:1})]),_:1}),l($,{headers:a.headers,items:a.filteredData,"items-per-page":10,class:"elevation-1"},{"item.total_price":t(({item:n})=>[l(x,{color:"green",variant:"outlined"},{default:t(()=>[r(" €"+s(n.total_price.toLocaleString()),1)]),_:2},1024)]),"item.status":t(({item:n})=>[l(K,{mode:"out-in"},{default:t(()=>[l(x,{size:"small",color:"#9F209F",class:"mr-1",onClick:u=>a.handleRowClick(n)},{default:t(()=>e[8]||(e[8]=[r(" details ")])),_:2,__:[8]},1032,["onClick"])]),_:2},1024),l(I,null,{activator:t(({props:u})=>[l(x,R({size:"small",color:a.getStatusColor(n.status)},a.mergeProps(u),{class:"mr-1",style:{width:"60px","min-width":"60px"}}),{default:t(()=>[r(s(n.status),1)]),_:2},1040,["color"])]),default:t(()=>[l(re,null,{default:t(()=>[(w(!0),z(Y,null,G(a.statusItems,(u,m)=>(w(),D(se,{key:m,value:m,onClick:T=>a.changePayState(n,u.title)},{default:t(()=>[l(ie,null,{default:t(()=>[r(s(u.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items"])]),_:1}),l(ae,{"model-value":a.loading,class:"align-center justify-center"},{default:t(()=>[l(M,{class:"pa-4"},{default:t(()=>[l(W,{indeterminate:"",color:"primary",class:"mb-2"}),e[9]||(e[9]=d("div",null,"正在导出数据...",-1))]),_:1,__:[9]})]),_:1},8,["model-value"]),l(ee,{modelValue:a.detailDlgActive,"onUpdate:modelValue":e[5]||(e[5]=n=>a.detailDlgActive=n),width:"600"},{default:t(()=>[l(M,{title:"Order Details"},{default:t(()=>[a.currentRow?(w(),D(oe,{key:0},{default:t(()=>[l(g,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[10]||(e[10]=d("strong",null,"ID:",-1)),r(" "+s(a.currentRow.name),1)]),_:1,__:[10]}),l(c,{cols:"6"},{default:t(()=>[e[11]||(e[11]=d("strong",null,"Restaurant:",-1)),r(" "+s(a.currentRow.restaurant),1)]),_:1,__:[11]})]),_:1}),l(g,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[12]||(e[12]=d("strong",null,"Date:",-1)),r(" "+s(a.currentRow.date),1)]),_:1,__:[12]}),l(c,{cols:"6"},{default:t(()=>[e[13]||(e[13]=d("strong",null,"Time:",-1)),r(" "+s(a.currentRow.time),1)]),_:1,__:[13]})]),_:1}),l(g,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[14]||(e[14]=d("strong",null,"Customer:",-1)),r(" "+s(a.currentRow.customerName),1)]),_:1,__:[14]}),l(c,{cols:"6"},{default:t(()=>[e[15]||(e[15]=d("strong",null,"Phone:",-1)),r(" "+s(a.currentRow.phone),1)]),_:1,__:[15]})]),_:1}),l(g,null,{default:t(()=>[l(c,{cols:"6"},{default:t(()=>[e[16]||(e[16]=d("strong",null,"email:",-1)),r(" "+s(a.currentRow.email),1)]),_:1,__:[16]}),l(c,{cols:"6"},{default:t(()=>[e[17]||(e[17]=d("strong",null,"NumberPeople:",-1)),r(" "+s(a.currentRow.reserveNumberPeople),1)]),_:1,__:[17]})]),_:1}),l(g,null,{default:t(()=>[e[18]||(e[18]=d("strong",null,"note:",-1)),r(" "+s(a.currentRow.note),1)]),_:1,__:[18]})]),_:1})):H("",!0),l(ne,null,{default:t(()=>[l(L),l(F,{color:"primary",onClick:e[4]||(e[4]=n=>a.detailDlgActive=!1)},{default:t(()=>e[19]||(e[19]=[r("Close")])),_:1,__:[19]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}const Re=q(ue,[["render",ce],["__scopeId","data-v-a59bf611"]]);export{Re as default};
