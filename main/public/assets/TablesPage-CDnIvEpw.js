import{s as X}from"./index-BwUs8YU4.js";import{s as ae}from"./index-DK0iFgzQ.js";import{b as I}from"./index-ImcgCsMW.js";import{q as Q,s as z,f as q,o as y,w as T,a as u,d as o,h as k,n as S,c as O,e as E,F,E as G,t as x,l as N,A as Y,z as de,u as se,x as ee,i as ne,H as ue,C as L,J as te}from"./index-hyw5utsD.js";import{s as ce}from"./index-qjX8hrvB.js";import{s as oe}from"./index-CsLqiNcJ.js";import{s as pe}from"./index-_PaioYvJ.js";import{s as me}from"./index-CBW_2-1w.js";import{s as be}from"./index-DDfqNCuP.js";import{s as ve}from"./index-CX9ayfAu.js";import{Q as fe,C as W}from"./browser-r20zGpaY.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as ge}from"./index-DQ2oTfy9.js";import{a as ie,s as re}from"./index-C7ntwibb.js";import"./index-CErZRDzl.js";import"./index-D-lRL3C4.js";import"./index-RIQgCTSH.js";import"./index-CrOdDUpv.js";import"./index-C3P66M0A.js";import"./_commonjsHelpers-gnU0ypJ3.js";import"./index-CukxTccD.js";import"./index-DLcuN9u-.js";import"./index-U0CLT40_.js";import"./index-CCQzy6_a.js";import"./index-90tv7vgd.js";const he={class:"p-menuitem-content"},Te={__name:"TableMenuBar",props:{filterStatu:String},setup(M){const{t:p}=Q(),t=z(()=>[{label:p("tablesPage.all"),value:"Todos",icon:"pi pi-circle-fill",severity:"contrast"},{label:p("tablesPage.available"),value:"Livre",icon:"pi pi-circle-fill",severity:"success"},{label:p("tablesPage.dining"),value:"Ocupado",icon:"pi pi-circle-fill",severity:"danger"},{label:p("tablesPage.reserved"),value:"Reservado",icon:"pi pi-circle-fill",severity:"info"},{label:p("tablesPage.paid"),value:"Pago",icon:"pi pi-circle-fill",severity:"help"}]);return(h,b)=>{const v=I,g=ce;return y(),q(g,{model:t.value,breakpoint:"355px",class:"border-0"},{item:T(({item:i})=>[u("div",he,[o(v,{label:i.label,icon:i.icon,severity:i.severity,variant:"outlined",raised:"",onClick:P=>h.$emit("update:filterStatu",i.value)},null,8,["label","icon","severity","onClick"])])]),_:1},8,["model"])}}},Pe={class:"overflow-auto",style:{height:"calc(100vh - 250px)"}},$e={class:"grid m-2"},_e={class:"flex justify-content-center align-items-center w-100"},we={class:"relative"},xe={class:"text-center text-2xl font-bold"},ke={key:0},Ce={class:"text-center"},Se={class:"text-center text-lg"},Ne={class:"text-center text-lg font-bold"},Oe={key:1,class:"flex flex-wrap justify-content-center"},Me={class:"font-bold text-xl"},Ee={class:"ont-bold"},De={class:"flex flex-wrap justify-content-end mt-3"},Ve={__name:"TableGrid",props:{filteredTables:Array,editMode:Boolean},emits:["openTableDetail","removeTable","addNewTable"],setup(M,{emit:p}){const{t}=Q(),h=k(!1),b=k(),v=k(!1),g=k({}),i=z(()=>[{label:t("tablesPage.available"),value:"Livre"},{label:t("tablesPage.dining"),value:"Ocupado"},{label:t("tablesPage.reserved"),value:"Reservado"},{label:t("tablesPage.paid"),value:"Pago"}]);function P(c){return i.value.find(r=>r.value===c)}function C(c){return Number(c.peopleType.children)+Number(c.peopleType.adults)}function n(c){return!c||!Array.isArray(c)?0:parseFloat(c.reduce((r,_)=>r+_.price*_.quantity,0).toFixed(2))}function $(c){const r=S.getCurrentPeoplePrice();return Number(c.peopleType.children)*r.children+Number(c.peopleType.adults)*r.adults}function D(c){return(n(c.order)+$(c)).toFixed(2)}function V(c){const r="m-1 border-3 border-gray-500 ";let _="";switch(c){case"Livre":break;case"Ocupado":_="border-red-300 bg-red-100";break;case"Reservado":_="border-blue-300 bg-blue-100";break;case"Pago":_="border-purple-300 bg-purple-100";break;default:_="border-gray-500 bg-gray-100"}return r+_}function A(c,r){r=="pay"?(g.value=c.nif_note,v.value=!0):c["msg_"+r]=!1,S.socket.emit("click_msg",c.id,r)}function H(){document.getElementById("tipsAudio").play()}return S.playSoundFun=H,(c,r)=>{const _=I,U=pe,B=ae,j=X,R=oe;return y(),O(F,null,[u("div",Pe,[u("div",$e,[r[7]||(r[7]=u("audio",{id:"tipsAudio",src:"/sound/tips.mp3",preload:"auto"},null,-1)),M.editMode?(y(),q(U,{key:0,class:"m-1 border-3 border-gray-500 flex justify-content-center align-items-center",style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:r[0]||(r[0]=f=>h.value=!0)},{content:T(()=>[u("div",_e,[o(_,{text:"",icon:"pi pi-plus",severity:"contrast",size:"large"})])]),_:1})):E("",!0),(y(!0),O(F,null,G(M.filteredTables,f=>(y(),q(U,{class:de(V(f.status)),style:{"min-width":"150px","min-height":"150px","max-width":"175px","max-height":"175px"},onClick:e=>M.editMode?"":c.$emit("openTableDetail",f.id)},{header:T(()=>[u("div",we,[f.msg_pay?(y(),q(_,{key:0,onClick:Y(e=>A(f,"pay"),["stop"]),icon:"pi pi-credit-card",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"5px","z-index":"10"}},null,8,["onClick"])):E("",!0),f.msg_call?(y(),q(_,{key:1,onClick:Y(e=>A(f,"call"),["stop"]),icon:"pi pi-bell",rounded:"",raised:"",severity:"danger",class:"absolute",style:{top:"-13px",right:"60px","z-index":"10"}},null,8,["onClick"])):E("",!0)])]),content:T(()=>[u("p",xe,x(N(t)("tablesPage.tableNum"))+": "+x(f.id),1),M.editMode?E("",!0):(y(),O("div",ke,[u("p",Ce,x(P(f.status).label),1),u("p",Se,x(C(f)+" "+N(t)("tablesPage.people")),1),u("p",Ne,x(D(f))+"€",1)])),M.editMode?(y(),O("div",Oe,[o(_,{icon:"pi pi-trash",severity:"danger",outlined:"",raised:"",class:"m-2",onClick:Y(e=>c.$emit("removeTable",f.id),["stop"])},null,8,["onClick"])])):E("",!0)]),_:2},1032,["class","onClick"]))),256))])]),o(j,{visible:v.value,"onUpdate:visible":r[1]||(r[1]=f=>v.value=f),modal:!0,dismissableMask:!0,header:c.$t("tablesPage.payInfo"),style:{"min-width":"300px","max-width":"450px"},onHide:r[2]||(r[2]=f=>g.value={nif:void 0,note:void 0})},{default:T(()=>{var f,e;return[u("label",Me,"NIF:"+x((f=g.value)!=null&&f.nif?g.value.nif:N(t)("tablesPage.noNif")),1),o(B),u("label",Ee,x(N(t)("tablesPage.note"))+": "+x((e=g.value)!=null&&e.note?g.value.note:N(t)("tablesPage.noNote")),1)]}),_:1},8,["visible","header"]),o(j,{visible:h.value,"onUpdate:visible":r[5]||(r[5]=f=>h.value=f),modal:!0,dismissableMask:!0,header:c.$t("tablesPage.addTable"),onHide:r[6]||(r[6]=f=>b.value=void 0)},{default:T(()=>[o(R,{modelValue:b.value,"onUpdate:modelValue":r[3]||(r[3]=f=>b.value=f),inputId:"horizontal-buttons",showButtons:"",buttonLayout:"horizontal",prefix:`${N(t)("tablesPage.tableNum")}：${b.value<10?"0":""}`,step:1,min:1,max:9999,placeholder:c.$t("tablesPage.enterTable"),fluid:""},{incrementbuttonicon:T(()=>r[8]||(r[8]=[u("span",{class:"pi pi-plus"},null,-1)])),decrementbuttonicon:T(()=>r[9]||(r[9]=[u("span",{class:"pi pi-minus"},null,-1)])),_:1},8,["modelValue","prefix","placeholder"]),u("div",De,[o(_,{label:c.$t("tablesPage.createTable"),onClick:r[4]||(r[4]=f=>{c.$emit("addNewTable",b.value),h.value=!1})},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},qe={class:"flex flex-column justify-content-center align-items-center"},Ae={for:"Total"},je={key:0,class:"flex flex-wrap justify-content-center align-items-center"},Re={for:"Adult"},Ue={key:1,class:"flex flex-wrap justify-content-center align-items-center"},Be={for:"Children"},Le={class:"flex flex-wrap justify-content-center align-items-center m-2"},Fe={class:"flex flex-wrap justify-content-center align-items-center m-3 mb-5"},ze={class:"m-2"},He={key:0,class:"flex flex-wrap justify-content-between align-items-center"},Je={key:1,class:"flex flex-wrap justify-content-between align-items-center"},Ie={class:"flex flex-column"},Qe={__name:"TableDetail",props:{selectedTable:Object,isEditTable:Boolean},emits:["tableEditConfirm","cleanTable","showTableOrders","onEdit"],setup(M,{emit:p}){const{t}=Q();let h=!1;const b=se(),v=k(!1),g=k(!1),i=M,P=p;function C(){P("onEdit",i.selectedTable.id,e=>{n.value=JSON.parse(JSON.stringify(e)),v.value=!0})}const n=k(JSON.parse(JSON.stringify(i.selectedTable))),$=k([{label:t("tablesPage.available"),value:"Livre",severity:"success"},{label:t("tablesPage.dining"),value:"Ocupado",severity:"danger"},{label:t("tablesPage.reserved"),value:"Reservado",severity:"info"},{label:t("tablesPage.paid"),value:"Pago",severity:"help"}]);function D(){h||(g.value=!1,n.value=JSON.parse(JSON.stringify(i.selectedTable))),h=!1}const V=z(()=>Number(n.value.peopleType.children)+Number(n.value.peopleType.adults));function A(){n.value.status?(P("tableEditConfirm",n.value,e=>{(e==null?void 0:e.success)==!0?(b.add({severity:"success",summary:t("common.success"),detail:e.message,life:3e3}),v.value=!1):b.add({severity:"error",summary:t("common.error"),detail:e.message,life:3e3})}),g.value=!1,h=!0):b.add({severity:"error",summary:t("common.error"),detail:t("tablesPage.stateError"),life:3e3})}function H(){g.value=!0}function c(){v.value=!1,n.value=JSON.parse(JSON.stringify(i.selectedTable))}function r(){return $.value.find(e=>e.value===n.value.status)}function _(e,a){const l=Number(a);if(e==="Adult"){Number(n.value.peopleType.adults)+l<=0?n.value.peopleType.adults=0:n.value.peopleType.adults=Number(n.value.peopleType.adults)+l,n.value.people=Number(n.value.peopleType.adults)+Number(n.value.peopleType.children);return}if(e==="Children"){n.value.peopleType.children+l<=0?n.value.peopleType.children=0:n.value.peopleType.children=Number(n.value.peopleType.children)+l,n.value.people=Number(n.value.peopleType.adults)+Number(n.value.peopleType.children);return}}const U=ee(),B=()=>{U.require({message:t("tablesPage.clearMsg.1")+n.value.id+t("tablesPage.clearMsg.2"),header:t("tablesPage.confirmClear"),icon:"pi pi-info-circle",rejectLabel:t("common.cancel"),rejectProps:{label:t("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:t("common.confirm"),severity:"danger"},accept:()=>{P("cleanTable",n.value.id,e=>{(e==null?void 0:e.success)===!1?b.add({severity:"error",summary:t("common.error"),detail:e.message,life:3e3}):(e==null?void 0:e.success)===!0&&b.add({severity:"success",summary:t("common.success"),detail:`${t("tablesPage.clearSucMsg.1")}${n.value.id}${t("tablesPage.clearSucMsg.2")}`,life:3e3})})},reject:()=>{b.add({severity:"error",summary:t("common.operation"),detail:`${t("tablesPage.clearCancelMsg.1")}${n.value.id}${t("tablesPage.clearCancelMsg.2")}`,life:3e3})}})},j=k(null);function R(){window.open(window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),"_blank")}const f=async()=>{if(j.value)try{await fe.toCanvas(j.value,window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),{width:175,margin:2,color:{dark:"#000000",light:"#ffffff"}})}catch(e){console.error("生成二维码失败:",e)}};return ne(()=>{f()}),ue(()=>window.env.QR_ADDR+W.SimpleEncode(i.selectedTable.id),f),(e,a)=>{var J,Z;const l=ve,s=be,d=I,w=me,K=X;return y(),O(F,null,[u("div",qe,[u("div",null,[o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(l,{id:"Total",modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=m=>V.value=m),autocomplete:"off",disabled:""},null,8,["modelValue"]),u("label",Ae,x(N(t)("tablesPage.totalPeople")),1)]),_:1})]),v.value?(y(),O("div",je,[o(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:a[1]||(a[1]=m=>_("Adult",-1))}),o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(l,{id:"Adult",modelValue:n.value.peopleType.adults,"onUpdate:modelValue":a[2]||(a[2]=m=>n.value.peopleType.adults=m),autocomplete:"off"},null,8,["modelValue"]),u("label",Re,x(N(t)("tablesPage.adult")),1)]),_:1}),o(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:a[3]||(a[3]=m=>_("Adult",1))})])):E("",!0),v.value?(y(),O("div",Ue,[o(d,{icon:"pi pi-minus",rounded:"","aria-label":"Filter",size:"small",onClick:a[4]||(a[4]=m=>_("Children",-1))}),o(s,{class:"m-2",variant:"on"},{default:T(()=>[o(l,{id:"Children",modelValue:n.value.peopleType.children,"onUpdate:modelValue":a[5]||(a[5]=m=>n.value.peopleType.children=m),autocomplete:"off"},null,8,["modelValue"]),u("label",Be,x(N(t)("tablesPage.child")),1)]),_:1}),o(d,{icon:"pi pi-plus",rounded:"","aria-label":"Filter",size:"small",onClick:a[6]||(a[6]=m=>_("Children",1))})])):E("",!0)]),u("div",Le,[v.value?E("",!0):(y(),q(d,{key:0,icon:"pi pi-circle-fill",variant:"outlined",label:(J=r())==null?void 0:J.label,severity:(Z=r())==null?void 0:Z.severity,onClick:H},null,8,["label","severity"])),v.value?(y(),q(w,{key:1,modelValue:n.value.status,"onUpdate:modelValue":a[7]||(a[7]=m=>n.value.status=m),options:$.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:n.value.status===null},null,8,["modelValue","options","invalid"])):E("",!0)]),u("div",Fe,[u("canvas",{ref_key:"qrCanvas",ref:j,class:"p-1",style:{border:"2px solid #b0b0b0","border-radius":"10px"},onClick:R},null,512)]),u("div",ze,[v.value?E("",!0):(y(),O("div",He,[o(d,{label:e.$t("tablesPage.orderDetails"),severity:"success",onClick:a[8]||(a[8]=()=>e.$emit("showTableOrders"))},null,8,["label"]),o(d,{label:e.$t("tablesPage.clear"),onClick:B,severity:"danger",class:"m-1"},null,8,["label"]),o(d,{label:e.$t("tablesPage.edit"),onClick:C,class:"m-1"},null,8,["label"])])),v.value?(y(),O("div",Je,[o(d,{label:e.$t("tablesPage.cancelEdit"),severity:"danger",raised:"",class:"m-2",onClick:c},null,8,["label"]),o(d,{label:e.$t("tablesPage.saveEdit"),severity:"success",raised:"",class:"m-2",onClick:A},null,8,["label"])])):E("",!0)]),o(K,{visible:g.value,"onUpdate:visible":a[10]||(a[10]=m=>g.value=m),modal:"",header:e.$t("tablesPage.editState"),closable:!0,dismissableMask:!0,onHide:D},{default:T(()=>[u("div",Ie,[o(w,{modelValue:n.value.status,"onUpdate:modelValue":a[9]||(a[9]=m=>n.value.status=m),options:$.value,optionLabel:"label",optionValue:"value",allowEmptySelection:!1,allowEmpty:"",invalid:n.value.status===null},null,8,["modelValue","options","invalid"]),o(d,{label:e.$t("common.confirm"),class:"mt-3",onClick:A},null,8,["label"])])]),_:1},8,["visible","header"])],64)}}},Ze=ye(Qe,[["__scopeId","data-v-fd40c96d"]]);function Ge(M){const p=new Date(M),t=n=>String(n).padStart(2,"0"),h=new Date(p.toLocaleString("en-US",{timeZone:"Europe/Lisbon"})),b=h.getFullYear(),v=t(h.getMonth()+1),g=t(h.getDate()),i=t(h.getHours()),P=t(h.getMinutes()),C=t(h.getSeconds());return`${b}-${v}-${g} ${i}:${P}:${C}`}const Ke={class:"font-bold",style:{"min-width":"100px"}},Ye={__name:"TableOrderTimeLine",props:{table:{type:Object,default:()=>({id:null,peopleType:{adults:0,children:0},order:[]})}},setup(M){const p=M,t=k([]),h=z(()=>{const i=p.table.order;return Array.isArray(i)?Array.from(new Set(i.flatMap(P=>Array.isArray(P.orderIds)?P.orderIds:[]))):[]}),b=z(()=>{const i=S.orders.value,P=h.value;return Array.isArray(i)?i.filter(C=>P.includes(C.id)).sort((C,n)=>C.timestamp-n.timestamp):[]}),v=[{field:"id",header:"订单号"},{field:"table",header:"桌号"},{field:"status",header:"状态"},{field:"timestamp",header:"时间",body:i=>Ge(i.timestamp)}],g=[{field:"dishid",header:"编号"},{field:"quantity",header:"数量"},{field:"name",header:"名称",body:i=>S.getDishName(i)}];return ne(()=>{t.value=b.value.map(i=>i.id)}),(i,P)=>{const C=ie,n=re;return y(),q(n,{value:b.value,dataKey:"id",expandedRows:t.value,"onUpdate:expandedRows":P[0]||(P[0]=$=>t.value=$),expandableRows:""},{expansion:T($=>[(y(!0),O(F,null,G($.data.items,D=>(y(),O("div",{key:D.dishid,class:"p-3 mb-2 border-round bg-gray-100"},[(y(),O(F,null,G(g,V=>u("div",{key:V.field,class:"flex gap-2 mb-1"},[u("span",Ke,x(V.header)+":",1),u("span",null,x(typeof V.body=="function"?V.body(D):D[V.field]),1)])),64))]))),128))]),default:T(()=>[o(C,{expander:"",style:{width:"3rem"}}),(y(),O(F,null,G(v,$=>o(C,{key:$.field,field:$.field,header:$.header,sortable:""},{body:T(D=>[L(x(typeof $.body=="function"?$.body(D.data):D.data[$.field]),1)]),_:2},1032,["field","header"])),64))]),_:1},8,["value","expandedRows"])}}},We={key:0},Xe={class:"flex flex-column"},el={key:0},ll=["disabled","onClick"],tl={class:"text-center py-5"},al={class:"text-gray-500"},sl={key:1},nl={class:"flex flex-wrap justify-content-end justify-content-between align-items-center mt-1"},ol={class:"font-bold"},il={__name:"TableOrderView",props:{selectedTable:Object},emits:["saveOrder","cancelOrderEdit","showToast"],setup(M,{emit:p}){var a;const{t}=Q(),h=M,b=p,v=k((a=h.selectedTable.order)==null?void 0:a.sort((l,s)=>s.price-l.price).filter(l=>l.quantity!=0)),g=k(v.value.filter(l=>l.price!=0)),i=k([]),P=k(!1),C=k(!1),n=k(!1),$=k();D();function D(){S.getPeoplePricesData($,h.selectedTable.id)}const V=z(()=>{const l=A(),s=v.value.reduce((d,w)=>d+w.price*w.quantity,0);return(l+s).toFixed(2)});function A(){if(!$.value)return 0;let l=0;for(const s in $.value)l+=Number($.value[s].totalPrice);return l}const H=z(()=>{for(const l in $.value)if($.value[l].price==0)return!1;return!0});function c(l){let s=0;return l.forEach(d=>{s+=d.price*d.quantity}),s.toFixed(2)}function r(){P.value=!P.value,!P.value&&i.value.length>0&&e()}function _(l){if(i.value.find(s=>s.dishid===l.dishid))i.value.find(s=>s.dishid===l.dishid).quantity+=1;else{const s={...l,quantity:1};i.value.push(s)}l.quantity-=1}function U(){let l="| ";return i.value.forEach(s=>{const d=v.value.find(w=>w.dishid===s.dishid);d&&(l+=s.dishid+"-"+S.getDishName(s)+" "+(d.quantity+s.quantity)+" -> "+d.quantity+` | 
`)}),l}function B(l){b("cancelOrderEdit"),b("showToast","error",t("common.operation"),t("tablesPage.editCancelMsg")+`
`+l),i.value.forEach(s=>{v.value.find(d=>d.dishid===s.dishid).quantity+=s.quantity}),i.value=[]}function j(l){var s;b("saveOrder",i.value),b("showToast","info",t("common.operation"),t("tablesPage.ediSucMsg")+`
`+l),i.value=[],v.value=(s=h.selectedTable.order)==null?void 0:s.sort((d,w)=>w.price-d.price).filter(d=>d.quantity!=0)}const R=ee();function f(l){return Array.isArray(l)?l.map(te):te(l)}const e=()=>{let l=!1;const s=f(U());R.require({message:s,escape:!0,header:t("tablesPage.editOrder"),rejectLabel:t("common.cancel"),rejectProps:{label:t("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:t("common.save"),severity:"danger"},accept:()=>{l=!0,j(s)},reject:()=>{l=!0,B(s)},onHide:()=>{l||B(s)}})};return(l,s)=>{const d=ie,w=re,K=oe,J=ge,Z=I;return y(),O(F,null,[n.value?(y(),O("div",sl,[o(Ye,{table:M.selectedTable},null,8,["table"])])):(y(),O("div",We,[u("div",Xe,[H.value?(y(),q(w,{key:0,value:$.value},{default:T(()=>[o(d,{field:"peopleType",header:N(t)("tablesPage.peopleType")},{body:T(({data:m})=>[L(x(N(t)("tablesPage."+(m.peopleType.toLowerCase().includes("adult")?"adult":"child"))),1)]),_:1},8,["header"]),o(d,{field:"price",header:N(t)("tablesPage.price")},null,8,["header"]),o(d,{field:"quantity",header:N(t)("tablesPage.quantity")},null,8,["header"]),o(d,{field:"totalPrice",header:N(t)("tablesPage.totalPrice")},null,8,["header"])]),_:1},8,["value"])):E("",!0)]),o(w,{value:C.value?g.value:v.value,scrollable:"",scrollHeight:"flex",style:{"max-height":"350px"}},{empty:T(()=>[u("div",tl,[u("p",al,x(l.$t("tablesPage.noOrder")),1)])]),default:T(()=>[o(d,{field:"dishid",header:"ID"}),o(d,{header:l.$t("tablesPage.name")},{body:T(m=>[L(x(N(S).getDishName(m.data)),1)]),default:T(()=>[s[3]||(s[3]=L(" > ",-1))]),_:1,__:[3]},8,["header"]),o(d,{field:"price",header:l.$t("tablesPage.price")},null,8,["header"]),o(d,{field:"quantity",header:l.$t("tablesPage.quantity")},{body:T(m=>[P.value?E("",!0):(y(),O("label",el,x(m.data.quantity),1)),P.value?(y(),q(K,{key:1,modelValue:m.data.quantity,"onUpdate:modelValue":le=>m.data.quantity=le,inputId:"minmax-buttons",mode:"decimal",showButtons:"",min:0,style:{width:"5rem"},fluid:"",inputStyle:{cursor:"not-allowed","background-color":"#f5f5f5"},readonly:""},{incrementbuttonicon:T(()=>s[4]||(s[4]=[u("span",{style:{display:"none"}},null,-1)])),decrementbuttonicon:T(()=>[u("span",{class:"p-inputnumber-button-icon",disabled:m.data.quantity<=0,onClick:le=>_(m.data)},s[5]||(s[5]=[u("i",{class:"pi pi-angle-down"},null,-1)]),8,ll)]),_:2},1032,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:1},8,["header"]),o(d,{header:l.$t("tablesPage.totalPrice")},{body:T(m=>[L(x(c([m.data])),1)]),default:T(()=>[s[6]||(s[6]=L(" > ",-1))]),_:1,__:[6]},8,["header"])]),_:1},8,["value"])])),u("div",nl,[u("label",ol,x(l.$t("tablesPage.total")+": ")+" "+x(V.value),1),u("label",null,[o(J,{modelValue:C.value,"onUpdate:modelValue":s[0]||(s[0]=m=>C.value=m)},null,8,["modelValue"]),L(" "+x(l.$t("tablesPage.showNonZero")),1)]),u("label",null,[o(J,{modelValue:n.value,"onUpdate:modelValue":s[1]||(s[1]=m=>n.value=m)},null,8,["modelValue"]),L(" "+x(l.$t("tablesPage.timeLine")),1)]),o(Z,{label:P.value?l.$t("common.save"):l.$t("common.edit"),onClick:s[2]||(s[2]=m=>r())},null,8,["label"])])],64)}}},rl={class:"flex flex-wrap justify-content-between align-items-center m-1"},Vl={__name:"TablesPage",setup(M){const{t:p}=Q(),t=ee(),h=k("Todos"),b=k(!1),v=k(!1),g=k({id:0}),i=k(!1),P=k({}),C=z(()=>h.value==="Todos"?S.tables.value:S.tables.value.filter(e=>e.status===h.value));function n(){b.value=!0}function $(){b.value==!0&&(b.value=!1)}function D(e){t.require({message:p("tablesPage.removeTableMsg.1")+e+p("tablesPage.removeTableMsg.2"),header:p("tablesPage.removeTableHeader"),icon:"pi pi-trash",rejectProps:{label:p("common.cancel"),severity:"secondary",outlined:!0},acceptProps:{label:p("common.confirm"),severity:"danger"},accept:()=>{const a=S.deleteTable(e);a!=null?R.add({severity:"error",summary:a.title,detail:a.message,life:3e3}):R.add({severity:"info",summary:p("common.success"),detail:p("tablesPage.removeSucMsg.1")+e+p("tablesPage.removeSucMsg.2"),life:3e3})},reject:()=>{}})}async function V(e){e<10&&(e="0"+e);const a=await S.addNewTable(e);a!==void 0?R.add({severity:"error",summary:a.title,detail:a.message,life:3e3}):R.add({severity:"info",summary:p("common.success"),detail:p("tablesPage.createSucMsg.1")+e+p("tablesPage.createSucMsg.2"),life:3e3})}function A(e){const a=S.tables.value.find(l=>l.id===e);g.value={...a,order:(a==null?void 0:a.order)||[]}}function H(e,a){const l=S.tables.value.find(s=>s.id===e);g.value={...l,order:(l==null?void 0:l.order)||[]},a(g.value)}function c(e){A(e),v.value=!0}function r(e,a){const l={id:e.id,status:e.status,peopleType:{adults:e.peopleType.adults,children:e.peopleType.children}},s=S.updateTable(l);A(e.id),a(s?{success:!1,message:p("tablesPage.updateFailMsg")}:{success:!0,message:p("tablesPage.updateSucMsg")})}function _(e,a){const l=S.tableClean(e);l?(console.log("cleanTable Error:",l),a({success:!1,message:p("tablesPage.updateFailMsg")})):(v.value=!1,a({success:!0,message:p("tablesPage.updateSucMsg")}))}function U(){const e=g.value.id;A(e),i.value=!0}function B(e){S.deleteOrders(g.value.id,e),P.value.order&&(S.deleteOrder(P.value),P.value={})}function j(){S.refreshTables()}const R=se();function f(e,a,l,s){R.add({severity:e||"",summary:a||"",detail:l||"",life:s||3e3})}return(e,a)=>{const l=I,s=ae,d=X;return y(),O(F,null,[u("div",rl,[o(Te,{filterStatu:h.value,"onUpdate:filterStatu":a[0]||(a[0]=w=>h.value=w)},null,8,["filterStatu"]),b.value?E("",!0):(y(),q(l,{key:0,icon:"pi pi-pencil",label:N(p)("tablesPage.editTables"),class:"mr-3",onClick:n},null,8,["label"])),b.value?(y(),q(l,{key:1,label:N(p)("tablesPage.closeEdit"),class:"mr-3",onClick:$},null,8,["label"])):E("",!0)]),o(s,{class:"m-0"}),o(Ve,{filteredTables:C.value,"onUpdate:filteredTables":a[1]||(a[1]=w=>C.value=w),editMode:b.value,"onUpdate:editMode":a[2]||(a[2]=w=>b.value=w),onOpenTableDetail:c,onRemoveTable:D,onAddNewTable:V},null,8,["filteredTables","editMode"]),o(d,{visible:v.value,"onUpdate:visible":a[3]||(a[3]=w=>v.value=w),header:N(p)("tablesPage.tableNum")+": "+g.value.id,modal:!0,dismissableMask:!0,style:{"min-width":"350px","max-width":"550px"}},{default:T(()=>[o(Ze,{selectedTable:g.value,onTableEditConfirm:r,onCleanTable:_,onShowTableOrders:U,onOnEdit:H},null,8,["selectedTable"])]),_:1},8,["visible","header"]),o(d,{visible:i.value,"onUpdate:visible":a[4]||(a[4]=w=>i.value=w),modal:!0,dismissableMask:!0,header:N(p)("tablesPage.orderDetails"),style:{"min-width":"350px","max-width":"550px"},onHide:a[5]||(a[5]=w=>j())},{default:T(()=>[o(il,{selectedTable:g.value,onSaveOrder:B,onCancelOrderEdit:j,onShowToast:f},null,8,["selectedTable"])]),_:1},8,["visible","header"])],64)}}};export{Vl as default};
