import{r as i,o as B,L as v,J as j,f as t,E as u,F as M,H as k,h as O,I as V,M as T,D as R,N as U,O as I}from"./index-BFJRxy-J.js";import{V as b,a as s,b as J}from"./VTextField-uZNVFVPl.js";import{V as P}from"./VDialog-BV6hFmM_.js";import{V as H}from"./VDataTable-D4ElotJX.js";import{V as c}from"./scopeId-jwLLnjDf.js";import{V as q}from"./VForm-qbSW6lhe.js";import"./VList-D6sSO8NP.js";const $={__name:"map_manager",setup(z){const m=i(!1),g=i(""),L=[{key:"id",title:"Id"},{align:"start",key:"name",sortable:!1,title:"Restaurant"},{key:"address",title:"Address"},{key:"city",title:"City"},{key:"postalCode",title:"Postal Code"},{key:"phone",title:"Contact"},{key:"latitude",title:"Latitude"},{key:"longitude",title:"Longitude"}],C=i(null),r=i([]);B(()=>{v.getAllRestaurants(o=>{o.result&&(r.value=o.datas)})});let f=i(!1);const l=i({});function N(o,e){console.log(o,e),f.value=!1,m.value=!0,l.value={...e.item}}function A(){m.value=!1;const o={...l.value};if(f.value){v.addRestaurant(o,a=>{a.result?r.value.push(o):console.error("Failed to add restaurant.")});return}const e=r.value.findIndex(a=>a.id===o.id);if(e!==-1){const a=r.value[e];let d=!1;for(const n in o)if(o[n]!==a[n]){d=!0;break}d&&v.setRestaurant(o,n=>{n.result?(console.log("Success updated"),r.value.splice(e,1,o)):console.error("Failed to update restaurant.")})}}function F(){m.value=!0,l.value={id:"",name:"",address:"",city:"",postalCode:"",phone:"",latitude:"",longitude:""},f.value=!0}function E(){v.getAllRestaurants(o=>{if(o.result){const e=JSON.stringify(o.datas,null,2),a=new Blob([e],{type:"application/json"}),d=URL.createObjectURL(a),n=document.createElement("a");n.href=d,n.download="restaurants_export.json",n.click(),URL.revokeObjectURL(d)}else console.error("Failed to fetch data from server for export.")})}function S(){C.value.click()}function D(o){const e=o.target.files[0];if(!e){console.warn("No file selected.");return}const a=new FileReader;a.onload=d=>{try{const n=JSON.parse(d.target.result);if(!Array.isArray(n))throw new Error("Invalid format: Expected an array of restaurants.");const w=new Set(r.value.map(p=>p.name.trim().toLowerCase()));n.forEach(p=>{var x;const y=(x=p.name)==null?void 0:x.trim().toLowerCase();!y||w.has(y)||(v.addRestaurant(p),r.value.push(p),w.add(y))}),console.log("Import successful:",n)}catch(n){console.error("Failed to import file:",n.message)}},a.readAsText(e)}return(o,e)=>(k(),j(M,null,[t(b,{title:"Map Manager",flat:""},{text:u(()=>[t(s,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"]),t(c,{class:"ma-2",onClick:F,color:"indigo-darken-3"},{default:u(()=>e[11]||(e[11]=[V("Add Restaurant")])),_:1,__:[11]}),t(c,{class:"ma-2",onClick:E,color:"green-darken-3"},{default:u(()=>e[12]||(e[12]=[V("Export")])),_:1,__:[12]}),t(c,{class:"ma-2",onClick:S,color:"blue-darken-3"},{default:u(()=>e[13]||(e[13]=[V("Import")])),_:1,__:[13]}),O("input",{type:"file",ref_key:"fileInput",ref:C,accept:".json",onChange:D,style:{display:"none"}},null,544)]),default:u(()=>[t(H,{headers:L,items:r.value,search:g.value,"onClick:row":N},null,8,["items","search"])]),_:1}),t(P,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=a=>m.value=a),width:"500"},{default:u(()=>[t(b,{title:"Edit Info"},{default:u(()=>[t(J),t(q,{"fast-fail":"",onSubmit:T(A,["prevent"])},{default:u(()=>[t(s,{class:"ma-3",modelValue:l.value.id,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.id=a),variant:"outlined",label:"Id"},null,8,["modelValue"]),I(f)?(k(),R(s,{key:0,class:"ma-3",modelValue:l.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.name=a),variant:"outlined",label:"Restaurant Name"},null,8,["modelValue"])):U("",!0),I(f)?U("",!0):(k(),R(s,{key:1,class:"ma-3",modelValue:l.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.name=a),variant:"outlined",label:"Restaurant Name",readonly:""},null,8,["modelValue"])),t(s,{class:"ma-3",modelValue:l.value.address,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.address=a),variant:"outlined",label:"Address"},null,8,["modelValue"]),t(s,{class:"ma-3",modelValue:l.value.city,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.city=a),variant:"outlined",label:"City"},null,8,["modelValue"]),t(s,{class:"ma-3",modelValue:l.value.postalCode,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.postalCode=a),variant:"outlined",label:"Postal Code"},null,8,["modelValue"]),t(s,{class:"ma-3",modelValue:l.value.phone,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.phone=a),variant:"outlined",label:"Contact"},null,8,["modelValue"]),t(s,{class:"ma-3",modelValue:l.value.latitude,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.latitude=a),variant:"outlined",label:"Latitude"},null,8,["modelValue"]),t(s,{class:"ma-3",modelValue:l.value.longitude,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.longitude=a),variant:"outlined",label:"Longitude"},null,8,["modelValue"]),t(b,{class:"text-center"},{default:u(()=>[t(c,{width:"200",class:"mb-3",type:"submit",color:"indigo-darken-3"},{default:u(()=>e[14]||(e[14]=[V("Submit")])),_:1,__:[14]})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{$ as default};
