{"version":3,"file":"Community-BJbl4pzG.js","sources":["../../src/components/community/PostPointsRulesDialog.tsx","../../src/components/community/PostTypeSelector.tsx","../../src/components/community/recipe/CreateRecipeWizard.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useTranslation } from \"react-i18next\";\r\nimport { Gift, CheckCircle, Clock, Shield } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { usePointsSettings } from \"@/hooks/usePoints\";\r\n\r\nconst PostPointsRulesDialog = () => {\r\n  const { t } = useTranslation();\r\n  const { data: settings } = usePointsSettings();\r\n\r\n  // 从设置中提取值\r\n  const postPoints = settings?.find(s => s.key === 'post_points')?.value || '5';\r\n  const minLength = settings?.find(s => s.key === 'min_post_length')?.value || '10';\r\n  const requireMedia = settings?.find(s => s.key === 'post_require_media')?.value === 'true';\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <button className=\"text-primary hover:underline text-sm whitespace-nowrap\">\r\n          {t(\"community.viewPointsRules\", \"查看详细规则\")}\r\n        </button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Gift className=\"h-5 w-5 text-primary\" />\r\n            {t(\"community.pointsRulesTitle\", \"发帖积分规则\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 pt-2\">\r\n          <p className=\"text-muted-foreground text-sm\">\r\n            {t(\"community.pointsRulesIntro\", \"通过发布社区帖子获得积分，具体规则如下：\")}\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            {/* 积分数量 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.rulePostPoints\", { points: postPoints })}</span>\r\n            </li>\r\n            {/* 最小长度 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleMinLength\", { length: minLength })}</span>\r\n            </li>\r\n            {/* 媒体要求 */}\r\n            {requireMedia && (\r\n              <li className=\"flex items-start gap-2 text-sm\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n                <span>{t(\"community.ruleRequireMedia\", \"帖子必须包含至少一张图片或一个视频\")}</span>\r\n              </li>\r\n            )}\r\n            {/* 每日限制 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Clock className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleDailyLimit\", \"每天仅可通过发帖获得一次积分奖励\")}</span>\r\n            </li>\r\n            {/* 审核要求 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Shield className=\"h-4 w-4 text-purple-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleModerationRequired\", \"帖子需通过审核后才能获得积分\")}</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PostPointsRulesDialog;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { FileText, Utensils, Sparkles } from \"lucide-react\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\n\r\ninterface PostTypeSelectorProps {\r\n  onSelect: (type: 'post' | 'recipe') => void;\r\n}\r\n\r\nconst PostTypeSelector = ({ onSelect }: PostTypeSelectorProps) => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { isAdmin, isMerchant, isSupervisor } = useUserRole();\r\n\r\n  const canCreateRecipeDirectly = isAdmin || isMerchant || isSupervisor;\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col items-center justify-center p-6\">\r\n      <h2 className=\"text-xl font-semibold mb-2\">\r\n        {t(\"community.selectPostType\", \"选择发布类型\")}\r\n      </h2>\r\n      <p className=\"text-muted-foreground text-sm mb-8 text-center\">\r\n        {t(\"community.selectPostTypeDesc\", \"选择您想要发布的内容类型\")}\r\n      </p>\r\n\r\n      <div className=\"flex flex-col gap-3 w-full max-w-sm\">\r\n        {/* Regular Post */}\r\n        <button\r\n          onClick={() => onSelect('post')}\r\n          className=\"flex items-center gap-4 p-4 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group text-left\"\r\n        >\r\n          <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors shrink-0\">\r\n            <FileText className=\"h-6 w-6 text-primary\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-medium text-sm\">\r\n              {t(\"community.postType.post\", \"发布帖子\")}\r\n            </h3>\r\n            <p className=\"text-xs text-muted-foreground mt-0.5\">\r\n              {t(\"community.postType.postDesc\", \"分享美食体验和想法\")}\r\n            </p>\r\n          </div>\r\n        </button>\r\n\r\n        {/* Recipe - only for admins/merchants/supervisors */}\r\n        {canCreateRecipeDirectly && (\r\n          <button\r\n            onClick={() => onSelect('recipe')}\r\n            className=\"flex items-center gap-4 p-4 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group text-left\"\r\n          >\r\n            <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors shrink-0\">\r\n              <Utensils className=\"h-6 w-6 text-primary\" />\r\n            </div>\r\n            <div>\r\n              <h3 className=\"font-medium text-sm\">\r\n                {t(\"community.postType.recipe\", \"发布食谱\")}\r\n              </h3>\r\n              <p className=\"text-xs text-muted-foreground mt-0.5\">\r\n                {t(\"community.postType.recipeDesc\", \"分享烹饪教程和菜谱\")}\r\n              </p>\r\n            </div>\r\n          </button>\r\n        )}\r\n\r\n        {/* AI Recipe */}\r\n        <button\r\n          onClick={() => navigate('/ai-recipe', { state: { from: '/community' } })}\r\n          className=\"flex items-center gap-4 p-4 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group text-left\"\r\n        >\r\n          <div className=\"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors shrink-0\">\r\n            <Sparkles className=\"h-6 w-6 text-primary\" />\r\n          </div>\r\n          <div>\r\n            <h3 className=\"font-medium text-sm\">\r\n              {t(\"community.postType.aiRecipe\", \"AI 食谱\")}\r\n            </h3>\r\n            <p className=\"text-xs text-muted-foreground mt-0.5\">\r\n              {t(\"community.postType.aiRecipeDesc\", \"AI 识别食材并生成菜谱\")}\r\n            </p>\r\n          </div>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostTypeSelector;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ArrowLeft, ArrowRight, Loader2, Check } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport RecipeBasicStep from \"./RecipeBasicStep\";\r\nimport RecipeIngredientsStep from \"./RecipeIngredientsStep\";\r\nimport RecipeStepsStep from \"./RecipeStepsStep\";\r\nimport { RecipeData, Ingredient, RecipeStep, NutritionInfo } from \"./RecipeTypes\";\r\nimport { useCreateRecipe } from \"@/hooks/useCreateRecipe\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CreateRecipeWizardProps {\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst CreateRecipeWizard = ({ onClose, onSuccess }: CreateRecipeWizardProps) => {\r\n  const { t } = useTranslation();\r\n  const createRecipe = useCreateRecipe();\r\n\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [coverImage, setCoverImage] = useState<string | null>(null);\r\n  const [recipeData, setRecipeData] = useState<Partial<RecipeData>>({\r\n    recipe_name: \"\",\r\n    cook_time: undefined,\r\n    difficulty: undefined,\r\n    servings: undefined,\r\n  });\r\n  const [ingredients, setIngredients] = useState<Ingredient[]>([\r\n    { name: \"\", amount: \"\", unit: \"\" }\r\n  ]);\r\n  const [steps, setSteps] = useState<RecipeStep[]>([\r\n    { order: 1, description: \"\" }\r\n  ]);\r\n  const [nutrition, setNutrition] = useState<NutritionInfo>({});\r\n  const [introduction, setIntroduction] = useState(\"\");\r\n\r\n  const STEPS = [\r\n    { key: \"basic\", title: t(\"recipe.step.basic\", \"基本信息\") },\r\n    { key: \"ingredients\", title: t(\"recipe.step.ingredients\", \"配料\") },\r\n    { key: \"steps\", title: t(\"recipe.step.steps\", \"步骤\") },\r\n  ];\r\n\r\n  const progress = ((currentStep + 1) / STEPS.length) * 100;\r\n\r\n  const validateBasicStep = () => {\r\n    if (!recipeData.recipe_name?.trim()) {\r\n      toast.error(t(\"recipe.nameRequired\", \"请输入食谱名称\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.cook_time || recipeData.cook_time < 1) {\r\n      toast.error(t(\"recipe.cookTimeRequired\", \"请输入烹饪时间\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.difficulty) {\r\n      toast.error(t(\"recipe.difficultyRequired\", \"请选择难度\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.servings || recipeData.servings < 1) {\r\n      toast.error(t(\"recipe.servingsRequired\", \"请输入份量\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateIngredientsStep = () => {\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    if (validIngredients.length === 0) {\r\n      toast.error(t(\"recipe.ingredientsRequired\", \"请至少添加一种配料\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateStepsStep = () => {\r\n    const validSteps = steps.filter(s => s.description.trim());\r\n    if (validSteps.length === 0) {\r\n      toast.error(t(\"recipe.stepsRequired\", \"请至少添加一个步骤\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (currentStep === 0 && !validateBasicStep()) return;\r\n    if (currentStep === 1 && !validateIngredientsStep()) return;\r\n    setCurrentStep((prev) => Math.min(prev + 1, STEPS.length - 1));\r\n  };\r\n\r\n  const handleBack = () => {\r\n    setCurrentStep((prev) => Math.max(prev - 1, 0));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!validateStepsStep()) return;\r\n\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    const validSteps = steps\r\n      .filter(s => s.description.trim())\r\n      .map((s, i) => ({ ...s, order: i + 1 }));\r\n\r\n    // Only include nutrition if at least one field has a value\r\n    const hasNutrition = nutrition.calories || nutrition.protein || nutrition.carbs || nutrition.fat;\r\n\r\n    try {\r\n      await createRecipe.mutateAsync({\r\n        recipe_name: recipeData.recipe_name!,\r\n        cook_time: recipeData.cook_time!,\r\n        difficulty: recipeData.difficulty!,\r\n        servings: recipeData.servings!,\r\n        ingredients: validIngredients,\r\n        steps: validSteps,\r\n        cover_image: coverImage,\r\n        nutrition: hasNutrition ? nutrition : undefined,\r\n        introduction: introduction.trim() || undefined,\r\n      });\r\n      onSuccess();\r\n    } catch (error) {\r\n      // Error handled in hook\r\n    }\r\n  };\r\n\r\n  const renderStepContent = () => {\r\n    switch (currentStep) {\r\n      case 0:\r\n        return (\r\n          <RecipeBasicStep\r\n            data={recipeData}\r\n            coverImage={coverImage}\r\n            nutrition={nutrition}\r\n            introduction={introduction}\r\n            onDataChange={setRecipeData}\r\n            onCoverImageChange={setCoverImage}\r\n            onNutritionChange={setNutrition}\r\n            onIntroductionChange={setIntroduction}\r\n          />\r\n        );\r\n      case 1:\r\n        return (\r\n          <RecipeIngredientsStep\r\n            ingredients={ingredients}\r\n            onChange={setIngredients}\r\n          />\r\n        );\r\n      case 2:\r\n        return (\r\n          <RecipeStepsStep\r\n            steps={steps}\r\n            onChange={setSteps}\r\n          />\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b bg-background shrink-0\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <h2 className=\"font-medium\">{t(\"recipe.createTitle\", \"创建食谱\")}</h2>\r\n          <div className=\"w-6\" /> {/* Spacer */}\r\n        </div>\r\n\r\n        {/* Step Progress */}\r\n        <div className=\"space-y-2\">\r\n          <Progress value={progress} className=\"h-1\" />\r\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n            {STEPS.map((step, index) => (\r\n              <span\r\n                key={step.key}\r\n                className={index === currentStep ? \"text-primary font-medium\" : \"\"}\r\n              >\r\n                {step.title}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4\">\r\n        {renderStepContent()}\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0\">\r\n        <div className=\"flex gap-3\">\r\n          {currentStep > 0 && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleBack}\r\n              className=\"flex-1\"\r\n            >\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              {t(\"common.back\", \"上一步\")}\r\n            </Button>\r\n          )}\r\n          \r\n          {currentStep < STEPS.length - 1 ? (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleNext}\r\n              className=\"flex-1\"\r\n            >\r\n              {t(\"common.next\", \"下一步\")}\r\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n            </Button>\r\n          ) : (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSubmit}\r\n              disabled={createRecipe.isPending}\r\n              className=\"flex-1\"\r\n            >\r\n              {createRecipe.isPending ? (\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              ) : (\r\n                <Check className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              {t(\"recipe.publish\", \"发布食谱\")}\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreateRecipeWizard;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, Gift, ArrowLeft } from \"lucide-react\";\r\nimport PostPointsRulesDialog from \"./PostPointsRulesDialog\";\r\nimport MultiRestaurantSelectDrawer from \"./MultiRestaurantSelectDrawer\";\r\nimport ActivitySelectDrawer from \"./ActivitySelectDrawer\";\r\nimport EmojiPicker from \"./EmojiPicker\";\r\nimport PostTypeSelector from \"./PostTypeSelector\";\r\nimport CreateRecipeWizard from \"./recipe/CreateRecipeWizard\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n  SheetTrigger,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant, useHasPostedToday } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const location = useLocation();\r\n  const nav = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n  const { data: hasPostedToday, isLoading: checkingPost } = useHasPostedToday();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [postType, setPostType] = useState<'selecting' | 'post' | 'recipe'>('selecting');\r\n\r\n  // Auto-open when navigated back from AI recipe with state\r\n  useEffect(() => {\r\n    if ((location.state as any)?.openCreatePost) {\r\n      setOpen(true);\r\n      setPostType('selecting');\r\n      // Clear the state so it doesn't re-trigger\r\n      nav(location.pathname, { replace: true, state: {} });\r\n    }\r\n  }, [location.state]);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantIds, setRestaurantIds] = useState<string[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n  const [showRestaurantError, setShowRestaurantError] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // 普通用户 = 既不是商家、督导也不是管理员\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n  \r\n  // 是否可以创建食谱（只有管理员、督导、商家可以）\r\n  const canCreateRecipe = isAdmin || isSupervisor || isMerchant;\r\n\r\n  // 商家自动设置餐厅\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantIds([merchantRestaurant.id]);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // 重置表单\r\n  const resetForm = () => {\r\n    // 所有用户都回到选择界面（普通用户看到\"帖子\"+\"AI 食谱\"，其他角色多一个\"食谱\"）\r\n    setPostType('selecting');\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantIds([]);\r\n    setRestaurantOpen(false);\r\n    setActivityOpen(false);\r\n    setShowRestaurantError(false);\r\n  };\r\n\r\n  // 初始化时设置正确的 postType\r\n  // 普通用户也显示选择界面（含\"发帖\"和\"AI 食谱\"两个选项），不再跳过\r\n  useEffect(() => {\r\n    if (open) {\r\n      setPostType('selecting');\r\n    }\r\n  }, [open]);\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  // Get active activities\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"最多上传9张图片\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"视频不能超过100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"正在提取视频封面...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"封面已自动生成\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    // 重置错误状态\r\n    setShowRestaurantError(false);\r\n\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"请输入内容\"));\r\n      return;\r\n    }\r\n\r\n    // 普通用户必须选择餐厅\r\n    if (isRegularUser && restaurantIds.length === 0) {\r\n      setShowRestaurantError(true);\r\n      toast.error(t(\"community.restaurantRequired\", \"请选择餐厅\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_ids: restaurantIds.length > 0 ? restaurantIds : undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n\r\n  // 获取商家餐厅名称\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"未关联餐厅\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  // Handle recipe creation success\r\n  const handleRecipeSuccess = () => {\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={handleOpenChange}>\r\n      <SheetTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"发布帖子\")}</Button>\r\n        )}\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.createPost\", \"发布帖子\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* Post Type Selection */}\r\n        {postType === 'selecting' && (\r\n          <div className=\"h-full flex flex-col\">\r\n            <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setOpen(false)}\r\n                className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"h-5 w-5\" />\r\n              </button>\r\n              <span className=\"font-medium\">{t(\"community.create\", \"发布\")}</span>\r\n              <div className=\"w-6\" />\r\n            </div>\r\n            <PostTypeSelector onSelect={setPostType} />\r\n          </div>\r\n        )}\r\n\r\n        {/* Recipe Creation Wizard */}\r\n        {postType === 'recipe' && (\r\n          <CreateRecipeWizard \r\n            onClose={() => setPostType('selecting')} \r\n            onSuccess={handleRecipeSuccess}\r\n          />\r\n        )}\r\n\r\n        {/* Regular Post Creation */}\r\n        {postType === 'post' && (\r\n          <>\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n        {/* Top Navigation - for regular post */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setPostType('selecting')}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={createPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.publish\", \"发布\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* Points Hint */}\r\n        {!checkingPost && !hasPostedToday && (\r\n          <div className=\"flex items-center justify-between gap-2 px-4 py-2 bg-primary/10 dark:bg-primary/20 border-b border-primary/30 dark:border-primary/40 text-sm text-primary dark:text-primary shrink-0\">\r\n            <div className=\"flex items-center gap-2\">\r\n              <Gift className=\"h-4 w-4 shrink-0\" />\r\n              <span>{t(\"community.dailyPointsHint\", \"每日发布首个帖子可获得5积分！\")}</span>\r\n            </div>\r\n            <PostPointsRulesDialog />\r\n          </div>\r\n        )}\r\n\r\n        {/* 横向两栏布局：左侧媒体，右侧文字 */}\r\n        <div className=\"flex-1 flex flex-row overflow-hidden min-h-0\">\r\n\r\n          {/* 左侧：媒体上传区 */}\r\n          <div className=\"w-[45%] border-r bg-muted/20 flex flex-col overflow-hidden shrink-0\">\r\n            <div className=\"flex-1 overflow-y-auto p-3 space-y-3\">\r\n              {/* 图片预览网格 */}\r\n              {imageUrls.length > 0 && (\r\n                <div className=\"grid grid-cols-2 gap-2\">\r\n                  {imageUrls.map((url, index) => (\r\n                    <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden bg-muted\">\r\n                      <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => removeImage(index)}\r\n                        className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                      >\r\n                        <X className=\"h-3 w-3\" />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n\r\n              {/* 视频预览 */}\r\n              {videoUrl && (\r\n                <div className=\"relative rounded-lg overflow-hidden\">\r\n                  <video src={videoUrl} controls className=\"w-full\" preload=\"metadata\" />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={removeVideo}\r\n                    className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                  >\r\n                    <X className=\"h-4 w-4\" />\r\n                  </button>\r\n                </div>\r\n              )}\r\n\r\n              {/* 上传占位区（无媒体时） */}\r\n              {imageUrls.length === 0 && !videoUrl && (\r\n                <div\r\n                  className=\"flex flex-col items-center justify-center gap-3 h-40 border-2 border-dashed border-muted-foreground/30 rounded-xl text-muted-foreground cursor-pointer hover:border-primary/50 hover:text-primary transition-colors\"\r\n                  onClick={() => imageInputRef.current?.click()}\r\n                >\r\n                  <Image className=\"h-8 w-8\" />\r\n                  <span className=\"text-sm\">{t(\"community.addPhoto\", \"添加图片\")}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* 媒体工具栏 */}\r\n            <div className=\"flex items-center gap-4 px-3 py-3 border-t bg-background pb-[max(0.75rem,env(safe-area-inset-bottom))] shrink-0\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => imageInputRef.current?.click()}\r\n                disabled={uploading || imageUrls.length >= 9}\r\n                className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n              >\r\n                <Image className=\"h-5 w-5\" />\r\n                <span className=\"text-xs\">{t(\"community.photo\", \"照片\")}</span>\r\n              </button>\r\n\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => videoInputRef.current?.click()}\r\n                disabled={uploading || !!videoUrl}\r\n                className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n              >\r\n                <Video className=\"h-5 w-5\" />\r\n                <span className=\"text-xs\">{t(\"community.video\", \"视频\")}</span>\r\n              </button>\r\n\r\n              {uploading && <Loader2 className=\"h-4 w-4 animate-spin ml-auto text-muted-foreground\" />}\r\n            </div>\r\n          </div>\r\n\r\n          {/* 右侧：文字输入 + 关联信息 */}\r\n          <div className=\"flex-1 flex flex-col overflow-hidden\">\r\n            {/* 文字输入区 */}\r\n            <div className=\"flex-1 overflow-y-auto p-4\">\r\n              <Textarea\r\n                value={content}\r\n                onChange={(e) => setContent(e.target.value)}\r\n                placeholder={t(\"community.contentPlaceholder\", \"分享你的想法...\")}\r\n                className=\"min-h-full h-full border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap\"\r\n              />\r\n            </div>\r\n\r\n            {/* 关联信息 + emoji */}\r\n            <div className=\"px-4 py-2 border-t bg-background shrink-0 space-y-2 pb-[max(0.75rem,env(safe-area-inset-bottom))]\">\r\n              <div className=\"flex items-center gap-4 flex-wrap\">\r\n                {/* emoji */}\r\n                <EmojiPicker onSelect={(emoji) => setContent((prev) => prev + emoji)} />\r\n\r\n                {/* 餐厅选择 */}\r\n                <div className={`flex items-center gap-2 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : ''}`}>\r\n                  <MapPin className={`h-4 w-4 shrink-0 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : 'text-muted-foreground'}`} />\r\n                  {isMerchant ? (\r\n                    <span className=\"text-sm text-muted-foreground\">{getMerchantRestaurantName()}</span>\r\n                  ) : (\r\n                    <MultiRestaurantSelectDrawer\r\n                      open={restaurantOpen}\r\n                      onOpenChange={(open) => {\r\n                        setRestaurantOpen(open);\r\n                        if (open) setShowRestaurantError(false);\r\n                      }}\r\n                      value={restaurantIds}\r\n                      onSelect={(ids) => {\r\n                        setRestaurantIds(ids);\r\n                        setShowRestaurantError(false);\r\n                      }}\r\n                      restaurants={restaurants || []}\r\n                      required={isRegularUser}\r\n                    />\r\n                  )}\r\n                </div>\r\n\r\n                {/* 活动选择 */}\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Calendar className=\"h-4 w-4 text-muted-foreground shrink-0\" />\r\n                  <ActivitySelectDrawer\r\n                    open={activityOpen}\r\n                    onOpenChange={setActivityOpen}\r\n                    value={activityId}\r\n                    onSelect={setActivityId}\r\n                    activities={activeActivities}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* 错误提示 */}\r\n              {showRestaurantError && isRegularUser && restaurantIds.length === 0 && (\r\n                <p className=\"text-xs text-destructive\">\r\n                  {t(\"community.restaurantRequired\", \"请选择餐厅\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n        </>\r\n        )}\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, LayoutGrid, List, Clock, Flame, LayoutList, FileText, Utensils } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost, SortOption, PostTypeFilter } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useInfiniteScroll } from \"@/hooks/useInfiniteScroll\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLoginRequired } from \"@/hooks/useLoginRequired\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => (\r\n  <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst Community = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const isMobile = useIsMobile();\r\n  const { user } = useAuth();\r\n  const { requireLogin } = useLoginRequired();\r\n  \r\n  // Layout state: 'double' for 2 columns, 'single' for 1 column (mobile only)\r\n  const [mobileLayout, setMobileLayout] = useState<'double' | 'single'>(() => {\r\n    const saved = localStorage.getItem('community-mobile-layout');\r\n    return (saved === 'single' ? 'single' : 'double') as 'double' | 'single';\r\n  });\r\n\r\n  // Sort state\r\n  const [sortBy, setSortBy] = useState<SortOption>(() => {\r\n    const saved = localStorage.getItem('community-sort');\r\n    return (saved === 'popular' ? 'popular' : 'latest') as SortOption;\r\n  });\r\n\r\n  // Post type filter state\r\n  const [postType, setPostType] = useState<PostTypeFilter>(() => {\r\n    const saved = localStorage.getItem('community-post-type');\r\n    return (['all', 'post', 'recipe'].includes(saved || '') ? saved : 'all') as PostTypeFilter;\r\n  });\r\n  \r\n  const { data: posts, isLoading } = useCommunityPosts({\r\n    status: \"approved\",\r\n    sortBy,\r\n    postType\r\n  });\r\n  const { data: canPost } = useCanCreatePost();\r\n\r\n  // Infinite scroll - only render 12 posts initially, load more on scroll\r\n  const {\r\n    displayedData: displayedPosts,\r\n    hasMore,\r\n    sentinelRef,\r\n  } = useInfiniteScroll({\r\n    data: posts,\r\n    initialItemsPerPage: 12,\r\n    incrementPerPage: 12,\r\n  });\r\n  \r\n  // Pull-to-refresh handler - clears cache and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear caches first to ensure fresh data\r\n    queryClient.removeQueries({ queryKey: ['community-posts'] });\r\n    queryClient.removeQueries({ queryKey: ['can-create-post'] });\r\n    queryClient.removeQueries({ queryKey: ['has-posted-today'] });\r\n    \r\n    // Refetch with fresh data\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['community-posts'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['can-create-post'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['has-posted-today'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  const toggleMobileLayout = () => {\r\n    const newLayout = mobileLayout === 'double' ? 'single' : 'double';\r\n    setMobileLayout(newLayout);\r\n    localStorage.setItem('community-mobile-layout', newLayout);\r\n  };\r\n\r\n  const handleSortChange = (value: string) => {\r\n    const newSort = value as SortOption;\r\n    setSortBy(newSort);\r\n    localStorage.setItem('community-sort', newSort);\r\n  };\r\n\r\n  const handlePostTypeChange = (value: PostTypeFilter) => {\r\n    setPostType(value);\r\n    localStorage.setItem('community-post-type', value);\r\n  };\r\n\r\n  // Grid classes based on layout\r\n  // Desktop (lg+): 4 columns, Tablet (md): 3 columns, Mobile: 1 or 2 based on toggle\r\n  const getGridClasses = () => {\r\n    if (isMobile) {\r\n      return mobileLayout === 'single' \r\n        ? 'columns-1 gap-4' \r\n        : 'columns-2 gap-3';\r\n    }\r\n    // Tablet: 3 columns, Desktop: 4 columns\r\n    return 'columns-3 lg:columns-4 gap-4';\r\n  };\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-5xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl mb-2 text-primary font-medium\">\r\n                {t(\"community.title\", \"社区\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"分享美食体验，发现更多精彩\")}\r\n              </p>\r\n            </div>\r\n            {canPost ? (\r\n              <CreatePostDialog\r\n                trigger={\r\n                  <Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n                  </Button>\r\n                }\r\n              />\r\n            ) : !user ? (\r\n              <Button size=\"sm\" className=\"gap-1.5\" onClick={() => requireLogin()}>\r\n                <Plus className=\"h-4 w-4\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n              </Button>\r\n            ) : null}\r\n          </div>\r\n          \r\n          {/* Sort, Filter and Layout controls */}\r\n          <div className=\"flex items-center gap-2 mb-4\">\r\n            {/* Sort tabs */}\r\n            <div className=\"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n              <button\r\n                onClick={() => handleSortChange('latest')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'latest' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Clock className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortLatest\", \"最新\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handleSortChange('popular')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'popular' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Flame className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortPopular\", \"热门\")}</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Post type filter tabs */}\r\n            <div className=\"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n              <button\r\n                onClick={() => handlePostTypeChange('all')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'all' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <LayoutList className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterAll\", \"全部\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handlePostTypeChange('post')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'post' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <FileText className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterPost\", \"帖子\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handlePostTypeChange('recipe')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'recipe' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Utensils className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterRecipe\", \"食谱\")}</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Layout toggle - only show on mobile, always on the right */}\r\n            {isMobile && (\r\n              <button\r\n                onClick={toggleMobileLayout}\r\n                className=\"ml-auto inline-flex h-9 items-center justify-center whitespace-nowrap rounded-md bg-muted px-2.5 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n                title={mobileLayout === 'double' \r\n                  ? t(\"community.singleColumn\", \"单列布局\") \r\n                  : t(\"community.doubleColumn\", \"双列布局\")}\r\n              >\r\n                {mobileLayout === 'double' ? (\r\n                  <List className=\"h-3.5 w-3.5\" />\r\n                ) : (\r\n                  <LayoutGrid className=\"h-3.5 w-3.5\" />\r\n                )}\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Content */}\r\n          {isLoading ? (\r\n            <div className={getGridClasses()}>\r\n              {Array.from({ length: 8 }).map((_, i) => (\r\n                <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                  <PostGridSkeleton />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : posts && posts.length > 0 ? (\r\n            <>\r\n              <div className={getGridClasses()}>\r\n                {displayedPosts.map(post => (\r\n                  <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                    <PostGridCard \r\n                      post={post} \r\n                      showAssociations={isMobile && mobileLayout === 'single'}\r\n                    />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              {/* Infinite scroll sentinel */}\r\n              {hasMore && (\r\n                <div ref={sentinelRef} className=\"flex justify-center py-6\">\r\n                  <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\r\n                </div>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n              <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n                <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n              </div>\r\n              <p className=\"text-muted-foreground text-lg\">\r\n                {t(\"community.noPosts\", \"暂无帖子\")}\r\n              </p>\r\n              {canPost && (\r\n                <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                  {t(\"community.beFirst\", \"成为第一个发帖的人吧！\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Community;\r\n"],"names":["PostPointsRulesDialog","useTranslation","settings","usePointsSettings","postPoints","s","minLength","requireMedia","Dialog","jsx","DialogTrigger","jsxs","DialogContent","DialogHeader","DialogTitle","Gift","CheckCircle","Clock","Shield","PostTypeSelector","onSelect","t","navigate","useNavigate","isAdmin","isMerchant","isSupervisor","useUserRole","canCreateRecipeDirectly","FileText","Utensils","Sparkles","CreateRecipeWizard","onClose","onSuccess","createRecipe","useCreateRecipe","currentStep","setCurrentStep","useState","coverImage","setCoverImage","recipeData","setRecipeData","ingredients","setIngredients","steps","setSteps","nutrition","setNutrition","introduction","setIntroduction","STEPS","progress","validateBasicStep","toast","validateIngredientsStep","i","validateStepsStep","handleNext","prev","handleBack","handleSubmit","validIngredients","validSteps","hasNutrition","renderStepContent","RecipeBasicStep","RecipeIngredientsStep","RecipeStepsStep","ArrowLeft","Progress","step","index","Button","ArrowRight","Loader2","Check","CreatePostDialog","trigger","location","useLocation","nav","getLocalizedField","useLocalizedContent","createPost","useCreatePost","activities","useActivities","restaurants","useRestaurants","role","merchantRestaurant","useMerchantRestaurant","hasPostedToday","checkingPost","useHasPostedToday","open","setOpen","postType","setPostType","useEffect","content","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","activityId","setActivityId","restaurantIds","setRestaurantIds","uploading","setUploading","restaurantOpen","setRestaurantOpen","activityOpen","setActivityOpen","showRestaurantError","setShowRestaurantError","imageInputRef","useRef","videoInputRef","isRegularUser","resetForm","handleOpenChange","newOpen","activeActivities","a","handleImageUpload","e","files","user","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","error","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","_","removeVideo","getMerchantRestaurantName","handleRecipeSuccess","Sheet","SheetTrigger","SheetContent","VisuallyHidden.Root","SheetTitle","Fragment","url","X","Image","Video","Textarea","EmojiPicker","emoji","MapPin","MultiRestaurantSelectDrawer","ids","Calendar","ActivitySelectDrawer","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","isMobile","useIsMobile","useAuth","requireLogin","useLoginRequired","mobileLayout","setMobileLayout","sortBy","setSortBy","saved","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","displayedPosts","hasMore","sentinelRef","useInfiniteScroll","handleRefresh","useCallback","toggleMobileLayout","newLayout","handleSortChange","value","newSort","handlePostTypeChange","getGridClasses","PullToRefresh","Plus","Flame","LayoutList","List","LayoutGrid","post","PostGridCard"],"mappings":"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"}