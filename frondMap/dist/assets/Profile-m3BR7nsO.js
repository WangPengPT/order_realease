const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-QnE9GqXs.js","assets/vendor-ui-BO6fjm1h.js","assets/vendor-react-CrHRjzzo.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-BO6fjm1h.js";import{u as qt,r as g,R as U,L as Z}from"./vendor-react-CrHRjzzo.js";import{D as Ce,c as be,d as _e,e as Ee,k as P,Z as Be,u as Ae,s as T,a8 as ht,aV as xt,aW as Kt,aH as ut,B as S,aX as Gt,aD as is,aA as ks,aB as Ds,aC as Rs,I as M,aY as Yt,aE as F,aZ as ss,a_ as ts,a$ as as,b0 as rs,b1 as ns,b2 as Wt,b3 as Xt,b4 as pt,am as oe,an as ce,ao as de,ap as me,aq as he,ar as xe,as as ue,at as re,a9 as E,aO as ft,q as L,R as Q,a0 as q,p as Oe,T as $,aR as X,b5 as Ws,aG as Zt,r as Is,_ as Jt,ai as ea,b6 as sa,b7 as ta,b8 as aa,b9 as ra,ba as He,S as na,bb as ia,bc as Ke,$ as Fe,ay as pe,al as Xs,O as fe,aw as Vs,bd as la,be as oa,L as ca,bf as da,aL as Ms,aM as ma,Q as Es,bg as Os,bh as $e,bi as Ie,bj as Zs,aF as ha,bk as xa,aK as ua,bl as pa,C as fa,bm as ls,bn as ga,bo as ja,bp as va,bq as Na,b as ya,z as wa,U as Js,br as ze,bs as et}from"./index-Bjy07DNZ.js";import{u as J,_ as Ca}from"./vendor-i18n-DWR4v88Y.js";import{a as Qe,u as ba}from"./vendor-query-EnOED-MY.js";import{T as Ss,a as As,b as se,c as te}from"./tabs-PsqXGXxP.js";import{C as _a,a as Ea,b as Ge}from"./carousel-CTBl1JfU.js";import{a as Sa}from"./useActivities-CsM0lmK8.js";import{u as cs}from"./useLocalizedContent-S0TAoDtX.js";import{u as Aa}from"./useActivityParticipation-DJ1RLxVr.js";import{d as Pa}from"./useCoupons-Dc1-d7vC.js";import{u as ka,a as Da,b as Ra,c as Ia,d as Ma,P as st}from"./PointsHistoryDialog-CrTFwfy8.js";import{C as Oa}from"./checkbox-ZikhNSW5.js";import{A as tt}from"./ActivityTermsAgreement-Db_qwbNh.js";import{S as Fs}from"./separator-DNwnjUji.js";import{f as Ne}from"./format-DlNLHQnx.js";import{P as Fa}from"./PullToRefresh-DIuS7mwV.js";import{C as Ta,a as La,b as $a}from"./collapsible-C8Nxqkr0.js";import{u as za,a as Ua,b as Ba,c as Ha}from"./useInvitationCodes-BRKw92Sf.js";import{u as Qa}from"./index.esm-DEEUA1pv.js";import{o as Va,s as Ye,t as qa}from"./types-DEaQs9QY.js";import{F as Ka,a as We,b as Xe,c as Ze,d as Je,e as es}from"./form-DoHKee62.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./usePoints-CaCWi2UW.js";import"./useActivityRules-DwCDCsbU.js";import"./startOfDay-D22pAUEm.js";import"./index-CPTVb0MP.js";function Ga({open:s,onOpenChange:t,activity:i}){const{t:l}=J();return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(be,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(_e,{children:e.jsx(Ee,{className:"text-lg font-semibold line-clamp-2",children:i.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(P,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Be,{className:"w-3.5 h-3.5 fill-primary text-primary"}),l("profile.activityFavorited")]}),i.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:i.image_url,alt:i.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:i.content}})]})]})})}const Ya=()=>{const{user:s}=Ae();return Qe({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await T.from("favorites").select("restaurant_id").eq("user_id",s.id);if(i)throw i;if(!t||t.length===0)return[];const l=t.map(x=>x.restaurant_id),{data:c,error:o}=await T.from("restaurants").select("*").in("id",l).eq("visible",!0);if(o)throw o;return c||[]},enabled:!!s})},Wa=()=>{const{user:s}=Ae();return Qe({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await T.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!t||t.length===0)return[];const l=t.filter(m=>m.target_type==="restaurant").map(m=>m.target_id),c=t.filter(m=>m.target_type==="activity").map(m=>m.target_id),o=new Map;if(l.length>0){const{data:m}=await T.from("restaurants").select("id, name, name_en, name_pt").in("id",l);m?.forEach(r=>{o.set(r.id,{name:r.name,name_en:r.name_en||void 0,name_pt:r.name_pt||void 0})})}const x=new Map;if(c.length>0){const{data:m}=await T.from("activities").select("id, title_zh, title_en, title_pt").in("id",c);m?.forEach(r=>{x.set(r.id,{title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt})})}return t.map(m=>{if(m.target_type==="restaurant"){const r=o.get(m.target_id);return{...m,target_name:r?.name||"Unknown Restaurant",target_name_en:r?.name_en,target_name_pt:r?.name_pt}}else if(m.target_type==="activity"){const r=x.get(m.target_id);return{...m,target_name:r?.title_zh||"Unknown Activity",target_name_en:r?.title_en,target_name_pt:r?.title_pt}}return m})},enabled:!!s,staleTime:3e4})},Xa=()=>{const{user:s}=Ae(),{data:t=[]}=Aa();return Qe({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||t.length===0)return[];const i=t.map(a=>a.id),{data:l,error:c}=await T.from("activity_restaurants").select("*").in("restaurant_id",i).order("created_at",{ascending:!1});if(c)throw c;if(!l||l.length===0)return[];const{data:o}=await T.from("restaurants").select("id, name, name_en, name_pt, address").in("id",i),x=[...new Set(l.map(a=>a.activity_id))],{data:m}=await T.from("activities").select("*").in("id",x).eq("status","published");return l.map(a=>{const n=o?.find(h=>h.id===a.restaurant_id),d=m?.find(h=>h.id===a.activity_id);return{activity_id:a.activity_id,restaurant_id:a.restaurant_id,restaurant_name:n?.name||"",restaurant_name_en:n?.name_en||null,restaurant_name_pt:n?.name_pt||null,restaurant_address:n?.address||"",activity:d||null,created_at:a.created_at}}).filter(a=>a.activity!==null)},enabled:!!s&&t.length>0})},gt=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],at=s=>{if(!s)return{code:"+351",number:""};for(const t of gt)if(s.startsWith(t.code))return{code:t.code,number:s.slice(t.code.length).trim()};return{code:"+351",number:s}},rt=({profile:s})=>{const{t}=J(),i=qt(),{user:l}=Ae(),{isAdmin:c}=ht(),[o,x]=g.useState(!1),[m,r]=g.useState(s.display_name),a=at(s.phone),[n,d]=g.useState(a.code),[h,f]=g.useState(a.number),[p,y]=g.useState(!1),[j,R]=g.useState(null),[C,N]=g.useState(s.avatar_url||""),[A,D]=g.useState(!1),[ee,B]=g.useState(!1),[K,I]=g.useState(""),[ge,z]=g.useState(!1),Pe=g.useRef(!1);g.useEffect(()=>{const u=Pe.current;if(Pe.current=o,o&&!u){r(s.display_name);const w=at(s.phone);d(w.code),f(w.number),N(s.avatar_url||""),R(null),y(!1)}},[o,s.display_name,s.phone,s.avatar_url]);const[je,V]=g.useState(!1),[G,ne]=g.useState(!1),[Y,ie]=g.useState(!1),[W,v]=g.useState(""),[_,k]=g.useState(""),[H,ke]=g.useState(""),[De,Ve]=g.useState(!1),[ye,qe]=g.useState(!1),[qs,ds]=g.useState(!1),[kt,Te]=g.useState(!1),[Dt,Le]=g.useState(!1),[ms,hs]=g.useState(""),[le,xs]=g.useState(""),[we,us]=g.useState(""),[Ks,ps]=g.useState(!1),[fs,gs]=g.useState(""),[Re,js]=g.useState(!1),[Gs,Ys]=g.useState(!1),[ae,vs]=g.useState(null),Ns=g.useRef(null),ys=g.useRef(null),ws=g.useRef(null),Cs=xt(),bs=Kt();g.useEffect(()=>{De&&Ns.current&&Ns.current.focus()},[De]),g.useEffect(()=>{ye&&ys.current&&ys.current.focus()},[ye]),g.useEffect(()=>{Re&&ws.current&&ws.current.focus()},[Re]);const Rt=u=>{const w=u.target.files?.[0];if(w){if(w.size>2*1024*1024)return;R(w),N(URL.createObjectURL(w))}},It=async()=>{let u=s.avatar_url;if(j){const ve=await bs.mutateAsync(j);ve&&(u=ve)}const w=h?`${n} ${h}`:void 0;await Cs.mutateAsync({display_name:m,phone:w,avatar_url:u||void 0}),y(!1),x(!1)},Mt=async()=>{if(!(!l||K.toLowerCase()!=="delete")){z(!0);try{const{error:u}=await T.functions.invoke("delete-account",{body:{userId:l.id}});if(u){E.error(t("profile.deleteAccountFailed")),console.error(u),z(!1);return}E.success(t("profile.deleteAccountSuccess")),B(!1),D(!1),I(""),await new Promise(w=>setTimeout(w,1500)),await T.auth.signOut(),i("/auth")}catch(u){E.error(u.message||t("profile.deleteAccountFailed")),z(!1)}finally{z(!1)}}},Ot=async()=>{if(l?.email)try{const{error:u}=await T.functions.invoke("send-verification-code",{body:{email:l.email}});if(u)throw u;Ve(!0),E.success(t("profile.codeSentToOldEmail"))}catch(u){E.error(t("profile.sendCodeFailed")),console.error(u)}},Ft=async()=>{if(!_){E.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:w}=await T.functions.invoke("verify-email-code",{body:{email:l?.email,code:_}});if(w||!u?.success){E.error(t("profile.codeIncorrect"));return}E.success(t("profile.oldEmailVerified")),V(!1),ne(!0)}catch(u){E.error(t("profile.verificationFailed")),console.error(u)}},Tt=async()=>{if(!W||!W.includes("@")){E.error(t("profile.enterValidEmail"));return}try{const{error:u}=await T.functions.invoke("send-verification-code",{body:{email:W}});if(u)throw u;E.success(t("profile.codeSentToNewEmail")),qe(!0)}catch(u){E.error(t("profile.sendCodeFailed")),console.error(u)}},Lt=async()=>{if(!H){E.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:w}=await T.functions.invoke("verify-email-code",{body:{email:W,code:H}});if(w||!u?.success){E.error(t("profile.codeIncorrect"));return}E.success(t("profile.newEmailVerified")),ne(!1),setTimeout(()=>{ie(!0)},100)}catch(u){E.error(t("toast.verificationFailed")),console.error(u)}},$t=async()=>{ds(!0);try{const{data:{session:u}}=await T.auth.getSession();if(!u||!l){E.error(t("toast.pleaseSignIn")),ds(!1);return}const{data:w,error:ve}=await T.functions.invoke("update-email",{body:{userId:l.id,oldEmail:l.email,oldEmailCode:_,newEmail:W,newEmailCode:H},headers:{Authorization:`Bearer ${u.access_token}`}});if(ve||!w?.success)throw new Error(w?.error||"Failed to update email");E.success(t("toast.emailUpdatedSuccess")),ie(!1),x(!1),k(""),v(""),ke(""),Ve(!1),qe(!1),await new Promise(_s=>setTimeout(_s,1500)),await T.auth.signOut(),i("/auth")}catch(u){E.error(u.message||t("toast.emailUpdateError")),console.error(u)}finally{ds(!1)}},zt=u=>{let w=0;return u.length>=6&&w++,u.length>=8&&w++,/[a-z]/.test(u)&&w++,/[A-Z]/.test(u)&&w++,/[0-9]/.test(u)&&w++,/[^a-zA-Z0-9]/.test(u)&&w++,w<=2?"weak":w<=4?"medium":"strong"},Ut=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!ms){E.error(t("profile.enterCurrentPassword"));return}try{const{createClient:w}=await Ca(async()=>{const{createClient:Vt}=await import("./vendor-supabase-QnE9GqXs.js");return{createClient:Vt}},__vite__mapDeps([0,1,2])),ve=w("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:_s}=await ve.auth.signInWithPassword({email:l?.email||"",password:ms});if(_s){E.error(t("profile.oldPasswordIncorrect"));return}E.success(t("profile.oldPasswordVerified")),Te(!1),Le(!0)}catch(w){E.error(t("profile.verificationFailed")),console.error(w)}},Bt=async()=>{if(l?.email)try{const{error:u}=await T.functions.invoke("send-verification-code",{body:{email:l.email}});if(u)throw u;js(!0),E.success(t("profile.codeSentToOldEmail"))}catch(u){E.error(t("profile.sendCodeFailed")),console.error(u)}},Ht=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!fs){E.error(t("profile.enterCodePlaceholder"));return}try{const{data:w,error:ve}=await T.functions.invoke("verify-email-code",{body:{email:l?.email,code:fs}});if(ve||!w?.success){E.error(t("profile.codeIncorrect"));return}E.success(t("profile.oldEmailVerified")),Te(!1),Le(!0)}catch(w){E.error(t("profile.verificationFailed")),console.error(w)}},Qt=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!le||!we){E.error(t("profile.enterNewPassword"));return}if(le.length<6){E.error(t("profile.passwordTooShort"));return}if(le!==we){E.error(t("profile.passwordsDontMatch"));return}Ys(!0);try{const{error:w}=await T.auth.updateUser({password:le});if(w)throw w;E.success(t("profile.passwordUpdated")),Le(!1),x(!1),hs(""),xs(""),us(""),ps(!1),gs(""),js(!1)}catch(w){E.error(w.message||t("profile.passwordUpdateFailed")),console.error(w)}finally{Ys(!1)}};return e.jsxs(Ce,{open:o,onOpenChange:x,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(S,{variant:"outline",children:[e.jsx(Gt,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),e.jsxs(be,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:t("profile.editProfile")}),e.jsx(is,{children:t("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(ks,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(Ds,{src:C}),e.jsx(Rs,{children:m?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(M,{type:"file",accept:"image/*",onChange:Rt,className:"hidden",id:"avatar-upload"}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(Yt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),e.jsx(M,{id:"displayName",value:m,onChange:u=>r(u.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!s.phone&&!p?e.jsx(S,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):p||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ss,{value:n,onValueChange:d,children:[e.jsx(ts,{className:"w-[110px] h-9",children:e.jsx(as,{placeholder:"+351"})}),e.jsx(rs,{children:gt.map(u=>e.jsx(ns,{value:u.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:u.flag}),e.jsx("span",{children:u.code})]})},u.code))})]}),e.jsx(M,{id:"phone",className:"flex-1 h-9",value:h,onChange:u=>f(u.target.value),placeholder:t("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{value:`${n} ${h}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!c&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(F,{className:"text-sm",children:t("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{value:l?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>V(!0),className:"text-xs",children:[e.jsx(Wt,{className:"w-3 h-3 mr-1"}),t("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${c?"pt-2 border-t":""}`,children:[e.jsx(F,{className:"text-sm",children:t("profile.changePassword")}),e.jsxs(S,{variant:"outline",size:"sm",onClick:()=>Te(!0),className:"w-full justify-start h-9",children:[e.jsx(Xt,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!c&&e.jsxs(S,{variant:"destructive",size:"sm",onClick:()=>D(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(pt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${c?"sm:ml-auto":""}`,children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>{y(!1),x(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),e.jsx(S,{size:"sm",onClick:It,disabled:Cs.isPending||bs.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:Cs.isPending||bs.isPending?t("common.loading"):t("common.save")})]})]})]}),e.jsx(oe,{open:A,onOpenChange:D,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.deleteAccountWarning")}),e.jsx(he,{children:t("profile.deleteAccountDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{children:t("common.cancel")}),e.jsx(re,{onClick:()=>{D(!1),B(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),e.jsx(oe,{open:ee,onOpenChange:B,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.confirmDeleteAccount")}),e.jsxs(he,{className:"space-y-4",children:[e.jsx("p",{children:t("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),e.jsx(M,{id:"confirm-delete",value:K,onChange:u=>I(u.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>I(""),children:t("common.cancel")}),e.jsx(re,{onClick:Mt,disabled:K.toLowerCase()!=="delete"||ge,className:"bg-destructive hover:bg-destructive/90",children:t(ge?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(oe,{open:je,onOpenChange:V,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldEmail")}),e.jsx(he,{children:t("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(S,{variant:"outline",size:"sm",onClick:Ot,disabled:De,children:t(De?"profile.codeSent":"profile.sendCode")})]})]}),De&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.verificationCode")}),e.jsx(M,{ref:Ns,value:_,onChange:u=>k(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{V(!1),setTimeout(()=>{k(""),Ve(!1)},300)},children:t("common.cancel")}),De&&e.jsx(re,{onClick:Ft,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:G,onOpenChange:ne,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{className:"text-center space-y-3",children:[e.jsx(me,{className:"text-xl",children:t("profile.verifyNewEmail")}),e.jsx(he,{className:"text-center",children:t("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-normal",children:t("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"email",value:W,onChange:u=>v(u.target.value),placeholder:t("profile.enterNewEmail"),disabled:ye,className:"border-2 focus:border-primary flex-1"}),e.jsx(S,{variant:"outline",size:"sm",onClick:Tt,disabled:!W||ye,className:"text-xs whitespace-nowrap px-3",children:t(ye?"profile.codeSent":"profile.sendCode")})]})]}),ye&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(F,{className:"text-sm font-normal",children:t("profile.verificationCode")}),e.jsx(M,{ref:ys,value:H,onChange:u=>ke(u.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(xe,{className:"flex-col sm:flex-col gap-2",children:[ye&&e.jsx(re,{onClick:Lt,disabled:!H||H.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(ue,{onClick:()=>{ne(!1),setTimeout(()=>{v(""),ke(""),qe(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(oe,{open:Y,onOpenChange:ie,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(he,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:l?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:W})]})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{ie(!1),setTimeout(()=>{k(""),v(""),ke(""),Ve(!1),qe(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(re,{onClick:$t,disabled:qs,children:qs?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(oe,{open:kt,onOpenChange:Te,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldPassword")}),e.jsx(he,{children:t("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Ks?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(S,{variant:"outline",size:"sm",onClick:Bt,disabled:Re,children:t(Re?"profile.codeSent":"profile.sendCode")})]})]}),Re&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.verificationCode")}),e.jsx(M,{ref:ws,value:fs,onChange:u=>gs(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentPassword")}),e.jsx(M,{type:"password",value:ms,onChange:u=>hs(u.target.value),placeholder:t("profile.enterCurrentPassword")})]}),e.jsxs(S,{variant:"link",size:"sm",onClick:()=>ps(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{Te(!1),setTimeout(()=>{hs(""),ps(!1),gs(""),js(!1)},300)},children:t("common.cancel")}),Ks?Re&&e.jsx(re,{onClick:Ht,children:t("profile.verify")}):e.jsx(re,{onClick:Ut,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:Dt,onOpenChange:Le,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.setNewPassword")}),e.jsx(he,{children:t("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.newPassword")}),e.jsx(M,{type:"password",value:le,onChange:u=>{xs(u.target.value),u.target.value?vs(zt(u.target.value)):vs(null)},placeholder:t("profile.enterNewPassword")}),ae&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="weak"?"bg-destructive":ae==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="medium"||ae==="strong"?ae==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${ae==="weak"?"text-destructive":ae==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${ae}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.confirmNewPassword")}),e.jsx(M,{type:"password",value:we,onChange:u=>us(u.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),le&&we&&le!==we&&e.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{Le(!1),setTimeout(()=>{xs(""),us(""),vs(null)},300)},children:t("common.cancel")}),e.jsx(re,{onClick:Qt,disabled:!le||!we||le!==we||Gs,children:t(Gs?"common.loading":"profile.updatePassword")})]})]})})]})},Ts=[{value:"Home",icon:ta,labelKey:"address.labelHome"},{value:"Work",icon:aa,labelKey:"address.labelWork"},{value:"Office",icon:ra,labelKey:"address.labelOffice"},{value:"Other",icon:Oe,labelKey:"address.labelOther"}],Za=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Ja=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],nt=({initialData:s,onSubmit:t,onCancel:i,isLoading:l,isEdit:c})=>{const{t:o}=J(),[x,m]=g.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),r=a=>{a.preventDefault(),t(x)};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"label",children:o("address.label")}),e.jsxs(ss,{value:x.label,onValueChange:a=>m({...x,label:a}),children:[e.jsx(ts,{children:e.jsx(as,{placeholder:o("address.selectLabel")})}),e.jsx(rs,{children:Ts.map(a=>e.jsx(ns,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),o(a.labelKey)]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"street",children:[o("address.street")," *"]}),e.jsx(M,{id:"street",value:x.street,onChange:a=>m({...x,street:a.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"district",children:o("address.district")}),e.jsx(M,{id:"district",value:x.district,onChange:a=>m({...x,district:a.target.value}),placeholder:o("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"city",children:[o("address.city")," *"]}),e.jsx(M,{id:"city",value:x.city,onChange:a=>m({...x,city:a.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),e.jsx(M,{id:"postal_code",value:x.postal_code,onChange:a=>m({...x,postal_code:a.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"country",children:[o("address.country")," *"]}),e.jsxs(ss,{value:x.country,onValueChange:a=>m({...x,country:a}),children:[e.jsx(ts,{children:e.jsx(as,{placeholder:o("address.selectCountry")})}),e.jsx(rs,{children:Ja.map(a=>e.jsx(ns,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"phone",children:[o("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ss,{value:x.phone_code,onValueChange:a=>m({...x,phone_code:a}),children:[e.jsx(ts,{className:"w-[130px]",children:e.jsx(as,{placeholder:"+351"})}),e.jsx(rs,{children:Za.map(a=>e.jsx(ns,{value:a.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.flag}),e.jsx("span",{children:a.code})]})},a.code))})]}),e.jsx(M,{id:"phone",className:"flex-1",value:x.phone,onChange:a=>m({...x,phone:a.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oa,{id:"is_default",checked:x.is_default,onCheckedChange:a=>m({...x,is_default:a})}),e.jsx(F,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),e.jsxs(Zt,{className:"gap-2 sm:gap-0",children:[e.jsx(S,{type:"button",variant:"outline",onClick:i,children:o("common.cancel")}),e.jsx(S,{type:"submit",disabled:l,children:o(l?"common.saving":c?"common.save":"address.add")})]})]})},er=({address:s,onEdit:t,onDelete:i,onSetDefault:l,isDeleting:c,isSettingDefault:o,canDelete:x=!0})=>{const{t:m}=J(),r=Ts.find(n=>n.value===s.label)||Ts[3],a=r.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:m(r.labelKey)}),s.is_default&&e.jsxs(P,{variant:"secondary",className:"text-xs",children:[e.jsx(Is,{className:"w-3 h-3 mr-1 fill-current"}),m("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Jt,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>l(s.id),disabled:o,title:m("address.setAsDefault"),children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>t(s),title:m("common.edit"),children:e.jsx(ea,{className:"w-4 h-4"})}),x&&e.jsxs(oe,{children:[e.jsx(sa,{asChild:!0,children:e.jsx(S,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:m("common.delete"),children:e.jsx(pt,{className:"w-4 h-4"})})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:m("address.deleteTitle")}),e.jsx(he,{children:m("address.deleteDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{children:m("common.cancel")}),e.jsx(re,{onClick:()=>i(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:c,children:m(c?"common.deleting":"common.delete")})]})]})]})]})]})})},it=()=>{const{t:s}=J(),{data:t,isLoading:i}=ka(),{data:l}=ft(),c=Da(),o=Ra(),x=xt(),m=Ia(),r=Ma(),[a,n]=g.useState(!1),[d,h]=g.useState(null),[f,p]=g.useState(null),[y,j]=g.useState(!1),R=!l?.phone,C=I=>{if(R&&I.phone){p(I),j(!0);return}c.mutate(I,{onSuccess:()=>n(!1)})},N=()=>{if(!f)return;const I=`${f.phone_code||"+351"} ${f.phone}`;x.mutate({phone:I}),c.mutate(f,{onSuccess:()=>{n(!1),p(null),j(!1)}})},A=()=>{p(null),j(!1)},D=I=>{d&&o.mutate({id:d.id,address:I},{onSuccess:()=>h(null)})},ee=I=>{m.mutate(I)},B=I=>{r.mutate(I)};if(i)return e.jsxs(L,{children:[e.jsx(Q,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx($,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const K=t&&t.length>0;return e.jsxs(L,{children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(X,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),K&&e.jsxs(Ce,{open:a,onOpenChange:n,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(S,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:s("address.addNew")}),e.jsx(is,{children:s("address.addDescription")})]}),e.jsx(nt,{onSubmit:C,onCancel:()=>n(!1),isLoading:c.isPending})]})]})]})}),e.jsx($,{children:K?e.jsx("div",{className:"space-y-4",children:t.map(I=>e.jsx(er,{address:I,onEdit:h,onDelete:ee,onSetDefault:B,isDeleting:m.isPending,isSettingDefault:r.isPending,canDelete:t.length>1},I.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Oe,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(S,{onClick:()=>n(!0),children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Ce,{open:!!d,onOpenChange:()=>h(null),children:e.jsxs(be,{className:"sm:max-w-[500px]",children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:s("address.editAddress")}),e.jsx(is,{children:s("address.editDescription")})]}),d&&e.jsx(nt,{initialData:d,onSubmit:D,onCancel:()=>h(null),isLoading:o.isPending,isEdit:!0})]})}),e.jsx(oe,{open:y,onOpenChange:j,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:s("address.phoneConfirmTitle")}),e.jsx(he,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:A,children:s("common.cancel")}),e.jsx(re,{onClick:N,disabled:c.isPending||x.isPending,children:c.isPending||x.isPending?s("common.saving"):s("common.confirm")})]})]})})]})};var sr=Object.defineProperty,os=Object.getOwnPropertySymbols,jt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,lt=(s,t,i)=>t in s?sr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,Ls=(s,t)=>{for(var i in t||(t={}))jt.call(t,i)&&lt(s,i,t[i]);if(os)for(var i of os(t))vt.call(t,i)&&lt(s,i,t[i]);return s},$s=(s,t)=>{var i={};for(var l in s)jt.call(s,l)&&t.indexOf(l)<0&&(i[l]=s[l]);if(s!=null&&os)for(var l of os(s))t.indexOf(l)<0&&vt.call(s,l)&&(i[l]=s[l]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Se;(s=>{const t=class b{constructor(r,a,n,d){if(this.version=r,this.errorCorrectionLevel=a,this.modules=[],this.isFunction=[],r<b.MIN_VERSION||r>b.MAX_VERSION)throw new RangeError("Version value out of range");if(d<-1||d>7)throw new RangeError("Mask value out of range");this.size=r*4+17;let h=[];for(let p=0;p<this.size;p++)h.push(!1);for(let p=0;p<this.size;p++)this.modules.push(h.slice()),this.isFunction.push(h.slice());this.drawFunctionPatterns();const f=this.addEccAndInterleave(n);if(this.drawCodewords(f),d==-1){let p=1e9;for(let y=0;y<8;y++){this.applyMask(y),this.drawFormatBits(y);const j=this.getPenaltyScore();j<p&&(d=y,p=j),this.applyMask(y)}}c(0<=d&&d<=7),this.mask=d,this.applyMask(d),this.drawFormatBits(d),this.isFunction=[]}static encodeText(r,a){const n=s.QrSegment.makeSegments(r);return b.encodeSegments(n,a)}static encodeBinary(r,a){const n=s.QrSegment.makeBytes(r);return b.encodeSegments([n],a)}static encodeSegments(r,a,n=1,d=40,h=-1,f=!0){if(!(b.MIN_VERSION<=n&&n<=d&&d<=b.MAX_VERSION)||h<-1||h>7)throw new RangeError("Invalid value");let p,y;for(p=n;;p++){const N=b.getNumDataCodewords(p,a)*8,A=x.getTotalBits(r,p);if(A<=N){y=A;break}if(p>=d)throw new RangeError("Data too long")}for(const N of[b.Ecc.MEDIUM,b.Ecc.QUARTILE,b.Ecc.HIGH])f&&y<=b.getNumDataCodewords(p,N)*8&&(a=N);let j=[];for(const N of r){i(N.mode.modeBits,4,j),i(N.numChars,N.mode.numCharCountBits(p),j);for(const A of N.getData())j.push(A)}c(j.length==y);const R=b.getNumDataCodewords(p,a)*8;c(j.length<=R),i(0,Math.min(4,R-j.length),j),i(0,(8-j.length%8)%8,j),c(j.length%8==0);for(let N=236;j.length<R;N^=253)i(N,8,j);let C=[];for(;C.length*8<j.length;)C.push(0);return j.forEach((N,A)=>C[A>>>3]|=N<<7-(A&7)),new b(p,a,C,h)}getModule(r,a){return 0<=r&&r<this.size&&0<=a&&a<this.size&&this.modules[a][r]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const r=this.getAlignmentPatternPositions(),a=r.length;for(let n=0;n<a;n++)for(let d=0;d<a;d++)n==0&&d==0||n==0&&d==a-1||n==a-1&&d==0||this.drawAlignmentPattern(r[n],r[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(r){const a=this.errorCorrectionLevel.formatBits<<3|r;let n=a;for(let h=0;h<10;h++)n=n<<1^(n>>>9)*1335;const d=(a<<10|n)^21522;c(d>>>15==0);for(let h=0;h<=5;h++)this.setFunctionModule(8,h,l(d,h));this.setFunctionModule(8,7,l(d,6)),this.setFunctionModule(8,8,l(d,7)),this.setFunctionModule(7,8,l(d,8));for(let h=9;h<15;h++)this.setFunctionModule(14-h,8,l(d,h));for(let h=0;h<8;h++)this.setFunctionModule(this.size-1-h,8,l(d,h));for(let h=8;h<15;h++)this.setFunctionModule(8,this.size-15+h,l(d,h));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let r=this.version;for(let n=0;n<12;n++)r=r<<1^(r>>>11)*7973;const a=this.version<<12|r;c(a>>>18==0);for(let n=0;n<18;n++){const d=l(a,n),h=this.size-11+n%3,f=Math.floor(n/3);this.setFunctionModule(h,f,d),this.setFunctionModule(f,h,d)}}drawFinderPattern(r,a){for(let n=-4;n<=4;n++)for(let d=-4;d<=4;d++){const h=Math.max(Math.abs(d),Math.abs(n)),f=r+d,p=a+n;0<=f&&f<this.size&&0<=p&&p<this.size&&this.setFunctionModule(f,p,h!=2&&h!=4)}}drawAlignmentPattern(r,a){for(let n=-2;n<=2;n++)for(let d=-2;d<=2;d++)this.setFunctionModule(r+d,a+n,Math.max(Math.abs(d),Math.abs(n))!=1)}setFunctionModule(r,a,n){this.modules[a][r]=n,this.isFunction[a][r]=!0}addEccAndInterleave(r){const a=this.version,n=this.errorCorrectionLevel;if(r.length!=b.getNumDataCodewords(a,n))throw new RangeError("Invalid argument");const d=b.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][a],h=b.ECC_CODEWORDS_PER_BLOCK[n.ordinal][a],f=Math.floor(b.getNumRawDataModules(a)/8),p=d-f%d,y=Math.floor(f/d);let j=[];const R=b.reedSolomonComputeDivisor(h);for(let N=0,A=0;N<d;N++){let D=r.slice(A,A+y-h+(N<p?0:1));A+=D.length;const ee=b.reedSolomonComputeRemainder(D,R);N<p&&D.push(0),j.push(D.concat(ee))}let C=[];for(let N=0;N<j[0].length;N++)j.forEach((A,D)=>{(N!=y-h||D>=p)&&C.push(A[N])});return c(C.length==f),C}drawCodewords(r){if(r.length!=Math.floor(b.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let n=this.size-1;n>=1;n-=2){n==6&&(n=5);for(let d=0;d<this.size;d++)for(let h=0;h<2;h++){const f=n-h,y=(n+1&2)==0?this.size-1-d:d;!this.isFunction[y][f]&&a<r.length*8&&(this.modules[y][f]=l(r[a>>>3],7-(a&7)),a++)}}c(a==r.length*8)}applyMask(r){if(r<0||r>7)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let n=0;n<this.size;n++){let d;switch(r){case 0:d=(n+a)%2==0;break;case 1:d=a%2==0;break;case 2:d=n%3==0;break;case 3:d=(n+a)%3==0;break;case 4:d=(Math.floor(n/3)+Math.floor(a/2))%2==0;break;case 5:d=n*a%2+n*a%3==0;break;case 6:d=(n*a%2+n*a%3)%2==0;break;case 7:d=((n+a)%2+n*a%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[a][n]&&d&&(this.modules[a][n]=!this.modules[a][n])}}getPenaltyScore(){let r=0;for(let h=0;h<this.size;h++){let f=!1,p=0,y=[0,0,0,0,0,0,0];for(let j=0;j<this.size;j++)this.modules[h][j]==f?(p++,p==5?r+=b.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,y),f||(r+=this.finderPenaltyCountPatterns(y)*b.PENALTY_N3),f=this.modules[h][j],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,y)*b.PENALTY_N3}for(let h=0;h<this.size;h++){let f=!1,p=0,y=[0,0,0,0,0,0,0];for(let j=0;j<this.size;j++)this.modules[j][h]==f?(p++,p==5?r+=b.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,y),f||(r+=this.finderPenaltyCountPatterns(y)*b.PENALTY_N3),f=this.modules[j][h],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,y)*b.PENALTY_N3}for(let h=0;h<this.size-1;h++)for(let f=0;f<this.size-1;f++){const p=this.modules[h][f];p==this.modules[h][f+1]&&p==this.modules[h+1][f]&&p==this.modules[h+1][f+1]&&(r+=b.PENALTY_N2)}let a=0;for(const h of this.modules)a=h.reduce((f,p)=>f+(p?1:0),a);const n=this.size*this.size,d=Math.ceil(Math.abs(a*20-n*10)/n)-1;return c(0<=d&&d<=9),r+=d*b.PENALTY_N4,c(0<=r&&r<=2568888),r}getAlignmentPatternPositions(){if(this.version==1)return[];{const r=Math.floor(this.version/7)+2,a=this.version==32?26:Math.ceil((this.version*4+4)/(r*2-2))*2;let n=[6];for(let d=this.size-7;n.length<r;d-=a)n.splice(1,0,d);return n}}static getNumRawDataModules(r){if(r<b.MIN_VERSION||r>b.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*r+128)*r+64;if(r>=2){const n=Math.floor(r/7)+2;a-=(25*n-10)*n-55,r>=7&&(a-=36)}return c(208<=a&&a<=29648),a}static getNumDataCodewords(r,a){return Math.floor(b.getNumRawDataModules(r)/8)-b.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r]*b.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r]}static reedSolomonComputeDivisor(r){if(r<1||r>255)throw new RangeError("Degree out of range");let a=[];for(let d=0;d<r-1;d++)a.push(0);a.push(1);let n=1;for(let d=0;d<r;d++){for(let h=0;h<a.length;h++)a[h]=b.reedSolomonMultiply(a[h],n),h+1<a.length&&(a[h]^=a[h+1]);n=b.reedSolomonMultiply(n,2)}return a}static reedSolomonComputeRemainder(r,a){let n=a.map(d=>0);for(const d of r){const h=d^n.shift();n.push(0),a.forEach((f,p)=>n[p]^=b.reedSolomonMultiply(f,h))}return n}static reedSolomonMultiply(r,a){if(r>>>8||a>>>8)throw new RangeError("Byte out of range");let n=0;for(let d=7;d>=0;d--)n=n<<1^(n>>>7)*285,n^=(a>>>d&1)*r;return c(n>>>8==0),n}finderPenaltyCountPatterns(r){const a=r[1];c(a<=this.size*3);const n=a>0&&r[2]==a&&r[3]==a*3&&r[4]==a&&r[5]==a;return(n&&r[0]>=a*4&&r[6]>=a?1:0)+(n&&r[6]>=a*4&&r[0]>=a?1:0)}finderPenaltyTerminateAndCount(r,a,n){return r&&(this.finderPenaltyAddHistory(a,n),a=0),a+=this.size,this.finderPenaltyAddHistory(a,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(r,a){a[0]==0&&(r+=this.size),a.pop(),a.unshift(r)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=t;function i(m,r,a){if(r<0||r>31||m>>>r)throw new RangeError("Value out of range");for(let n=r-1;n>=0;n--)a.push(m>>>n&1)}function l(m,r){return(m>>>r&1)!=0}function c(m){if(!m)throw new Error("Assertion error")}const o=class O{constructor(r,a,n){if(this.mode=r,this.numChars=a,this.bitData=n,a<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(r){let a=[];for(const n of r)i(n,8,a);return new O(O.Mode.BYTE,r.length,a)}static makeNumeric(r){if(!O.isNumeric(r))throw new RangeError("String contains non-numeric characters");let a=[];for(let n=0;n<r.length;){const d=Math.min(r.length-n,3);i(parseInt(r.substring(n,n+d),10),d*3+1,a),n+=d}return new O(O.Mode.NUMERIC,r.length,a)}static makeAlphanumeric(r){if(!O.isAlphanumeric(r))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],n;for(n=0;n+2<=r.length;n+=2){let d=O.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n))*45;d+=O.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n+1)),i(d,11,a)}return n<r.length&&i(O.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n)),6,a),new O(O.Mode.ALPHANUMERIC,r.length,a)}static makeSegments(r){return r==""?[]:O.isNumeric(r)?[O.makeNumeric(r)]:O.isAlphanumeric(r)?[O.makeAlphanumeric(r)]:[O.makeBytes(O.toUtf8ByteArray(r))]}static makeEci(r){let a=[];if(r<0)throw new RangeError("ECI assignment value out of range");if(r<128)i(r,8,a);else if(r<16384)i(2,2,a),i(r,14,a);else if(r<1e6)i(6,3,a),i(r,21,a);else throw new RangeError("ECI assignment value out of range");return new O(O.Mode.ECI,0,a)}static isNumeric(r){return O.NUMERIC_REGEX.test(r)}static isAlphanumeric(r){return O.ALPHANUMERIC_REGEX.test(r)}getData(){return this.bitData.slice()}static getTotalBits(r,a){let n=0;for(const d of r){const h=d.mode.numCharCountBits(a);if(d.numChars>=1<<h)return 1/0;n+=4+h+d.bitData.length}return n}static toUtf8ByteArray(r){r=encodeURI(r);let a=[];for(let n=0;n<r.length;n++)r.charAt(n)!="%"?a.push(r.charCodeAt(n)):(a.push(parseInt(r.substring(n+1,n+3),16)),n+=2);return a}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=o;s.QrSegment=o})(Se||(Se={}));(s=>{(t=>{const i=class{constructor(c,o){this.ordinal=c,this.formatBits=o}};i.LOW=new i(0,1),i.MEDIUM=new i(1,0),i.QUARTILE=new i(2,3),i.HIGH=new i(3,2),t.Ecc=i})(s.QrCode||(s.QrCode={}))})(Se||(Se={}));(s=>{(t=>{const i=class{constructor(c,o){this.modeBits=c,this.numBitsCharCount=o}numCharCountBits(c){return this.numBitsCharCount[Math.floor((c+7)/17)]}};i.NUMERIC=new i(1,[10,12,14]),i.ALPHANUMERIC=new i(2,[9,11,13]),i.BYTE=new i(4,[8,16,16]),i.KANJI=new i(8,[8,10,12]),i.ECI=new i(7,[0,0,0]),t.Mode=i})(s.QrSegment||(s.QrSegment={}))})(Se||(Se={}));var Me=Se;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var tr={L:Me.QrCode.Ecc.LOW,M:Me.QrCode.Ecc.MEDIUM,Q:Me.QrCode.Ecc.QUARTILE,H:Me.QrCode.Ecc.HIGH},Nt=128,yt="L",wt="#FFFFFF",Ct="#000000",bt=!1,_t=1,ar=4,rr=0,nr=.1;function Et(s,t=0){const i=[];return s.forEach(function(l,c){let o=null;l.forEach(function(x,m){if(!x&&o!==null){i.push(`M${o+t} ${c+t}h${m-o}v1H${o+t}z`),o=null;return}if(m===l.length-1){if(!x)return;o===null?i.push(`M${m+t},${c+t} h1v1H${m+t}z`):i.push(`M${o+t},${c+t} h${m+1-o}v1H${o+t}z`);return}x&&o===null&&(o=m)})}),i.join("")}function St(s,t){return s.slice().map((i,l)=>l<t.y||l>=t.y+t.h?i:i.map((c,o)=>o<t.x||o>=t.x+t.w?c:!1))}function ir(s,t,i,l){if(l==null)return null;const c=s.length+i*2,o=Math.floor(t*nr),x=c/t,m=(l.width||o)*x,r=(l.height||o)*x,a=l.x==null?s.length/2-m/2:l.x*x,n=l.y==null?s.length/2-r/2:l.y*x,d=l.opacity==null?1:l.opacity;let h=null;if(l.excavate){let p=Math.floor(a),y=Math.floor(n),j=Math.ceil(m+a-p),R=Math.ceil(r+n-y);h={x:p,y,w:j,h:R}}const f=l.crossOrigin;return{x:a,y:n,h:r,w:m,excavation:h,opacity:d,crossOrigin:f}}function lr(s,t){return t!=null?Math.max(Math.floor(t),0):s?ar:rr}function At({value:s,level:t,minVersion:i,includeMargin:l,marginSize:c,imageSettings:o,size:x,boostLevel:m}){let r=U.useMemo(()=>{const p=(Array.isArray(s)?s:[s]).reduce((y,j)=>(y.push(...Me.QrSegment.makeSegments(j)),y),[]);return Me.QrCode.encodeSegments(p,tr[t],i,void 0,void 0,m)},[s,t,i,m]);const{cells:a,margin:n,numCells:d,calculatedImageSettings:h}=U.useMemo(()=>{let f=r.getModules();const p=lr(l,c),y=f.length+p*2,j=ir(f,x,p,o);return{cells:f,margin:p,numCells:y,calculatedImageSettings:j}},[r,x,o,l,c]);return{qrcode:r,margin:n,cells:a,numCells:d,calculatedImageSettings:h}}var or=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),cr=U.forwardRef(function(t,i){const l=t,{value:c,size:o=Nt,level:x=yt,bgColor:m=wt,fgColor:r=Ct,includeMargin:a=bt,minVersion:n=_t,boostLevel:d,marginSize:h,imageSettings:f}=l,y=$s(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:j}=y,R=$s(y,["style"]),C=f?.src,N=U.useRef(null),A=U.useRef(null),D=U.useCallback(V=>{N.current=V,typeof i=="function"?i(V):i&&(i.current=V)},[i]),[ee,B]=U.useState(!1),{margin:K,cells:I,numCells:ge,calculatedImageSettings:z}=At({value:c,level:x,minVersion:n,boostLevel:d,includeMargin:a,marginSize:h,imageSettings:f,size:o});U.useEffect(()=>{if(N.current!=null){const V=N.current,G=V.getContext("2d");if(!G)return;let ne=I;const Y=A.current,ie=z!=null&&Y!==null&&Y.complete&&Y.naturalHeight!==0&&Y.naturalWidth!==0;ie&&z.excavation!=null&&(ne=St(I,z.excavation));const W=window.devicePixelRatio||1;V.height=V.width=o*W;const v=o/ge*W;G.scale(v,v),G.fillStyle=m,G.fillRect(0,0,ge,ge),G.fillStyle=r,or?G.fill(new Path2D(Et(ne,K))):I.forEach(function(_,k){_.forEach(function(H,ke){H&&G.fillRect(ke+K,k+K,1,1)})}),z&&(G.globalAlpha=z.opacity),ie&&G.drawImage(Y,z.x+K,z.y+K,z.w,z.h)}}),U.useEffect(()=>{B(!1)},[C]);const Pe=Ls({height:o,width:o},j);let je=null;return C!=null&&(je=U.createElement("img",{src:C,key:C,style:{display:"none"},onLoad:()=>{B(!0)},ref:A,crossOrigin:z?.crossOrigin})),U.createElement(U.Fragment,null,U.createElement("canvas",Ls({style:Pe,height:o,width:o,ref:D,role:"img"},R)),je)});cr.displayName="QRCodeCanvas";var Pt=U.forwardRef(function(t,i){const l=t,{value:c,size:o=Nt,level:x=yt,bgColor:m=wt,fgColor:r=Ct,includeMargin:a=bt,minVersion:n=_t,boostLevel:d,title:h,marginSize:f,imageSettings:p}=l,y=$s(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:j,cells:R,numCells:C,calculatedImageSettings:N}=At({value:c,level:x,minVersion:n,boostLevel:d,includeMargin:a,marginSize:f,imageSettings:p,size:o});let A=R,D=null;p!=null&&N!=null&&(N.excavation!=null&&(A=St(R,N.excavation)),D=U.createElement("image",{href:p.src,height:N.h,width:N.w,x:N.x+j,y:N.y+j,preserveAspectRatio:"none",opacity:N.opacity,crossOrigin:N.crossOrigin}));const ee=Et(A,j);return U.createElement("svg",Ls({height:o,width:o,viewBox:`0 0 ${C} ${C}`,ref:i,role:"img"},y),!!h&&U.createElement("title",null,h),U.createElement("path",{fill:m,d:`M0,0 h${C}v${C}H0z`,shapeRendering:"crispEdges"}),U.createElement("path",{fill:r,d:ee,shapeRendering:"crispEdges"}),D)});Pt.displayName="QRCodeSVG";const dr=({open:s,onOpenChange:t,coupon:i})=>{const{t:l}=J(),{getLocalizedField:c}=cs(),[o,x]=g.useState(!1),m=i.coupon_codes?.coupon_templates,r=i.coupon_codes?.code,a=!!i.used_at;return e.jsx(Ce,{open:s,onOpenChange:n=>{t(n),n||x(!1)},children:e.jsxs(be,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(_e,{children:e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),l("profile.coupons.details")]})}),e.jsx(na,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:c(m,"title")}),e.jsx(P,{variant:a?"secondary":"default",children:l(a?"profile.coupons.used":"profile.coupons.available")})]}),m?.description_zh||m?.description_en||m?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:c(m,"description")}):null]}),e.jsx(Fs,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>x(!o),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Pt,{value:r||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ia,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:l("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Ke,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:m?.discount_type==="percentage"?`${m?.discount_value}% OFF`:`â‚¬${m?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),a&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m?.valid_until?`${Ne(new Date(m.valid_from),"yyyy-MM-dd")} - ${Ne(new Date(m.valid_until),"yyyy-MM-dd")}`:l("profile.coupons.noExpiry")})]})]}),m?.min_order_amount&&m.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",m.min_order_amount]})]})]}),m?.max_discount_amount&&m.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",m.max_discount_amount]})]})]}),e.jsx(Fs,{}),i.activity_id&&i.source==="share"&&e.jsxs(Z,{to:`/activity/${i.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Ke,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[l("profile.coupons.source"),": ",l("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",l("profile.coupons.viewActivity"),")"]})]})]})})]})})},mr=()=>{const{user:s}=Ae();return Qe({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await T.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},hr=()=>{const{user:s}=Ae();return Qe({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await T.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},ot=()=>{const{t:s}=J(),{data:t,isLoading:i}=mr(),{getLocalizedField:l}=cs(),c=o=>{switch(o){case"confirmed":return e.jsx(P,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(P,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(P,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(P,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(P,{variant:"outline",children:o})}};return e.jsxs(L,{children:[e.jsxs(Q,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(Xs,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(X,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx($,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(Z,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),c(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xs,{className:"w-3 h-3"}),Ne(new Date(o.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),o.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-3 h-3"}),o.party_size," ",s("booking.people")]})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},ct=()=>{const{t:s}=J(),{data:t,isLoading:i}=hr(),{getLocalizedField:l}=cs(),c=o=>{switch(o){case"completed":return e.jsx(P,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(P,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(P,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(P,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(P,{variant:"outline",children:o})}};return e.jsxs(L,{children:[e.jsxs(Q,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(la,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(X,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx($,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(Z,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),c(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:Ne(new Date(o.order_date),"yyyy-MM-dd HH:mm")}),o.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",o.total_amount.toFixed(2)]})]}),o.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Oe,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:o.delivery_address})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},xr=Va({full_name:Ye().min(2,"å§“åè‡³å°‘2ä¸ªå­—ç¬¦"),nif:Ye().min(9,"NIFè‡³å°‘9ä½").max(15,"NIFæœ€å¤š15ä½"),contact:Ye().min(5,"è”ç³»æ–¹å¼è‡³å°‘5ä¸ªå­—ç¬¦"),address:Ye().min(5,"åœ°å€è‡³å°‘5ä¸ªå­—ç¬¦")}),Ps=({open:s,onOpenChange:t,mode:i,existingData:l})=>{const{t:c}=J(),o=za(),x=Ua(),m=Qa({resolver:qa(xr),defaultValues:{full_name:l?.full_name||"",nif:l?.nif||"",contact:l?.contact||"",address:l?.address||""}});g.useEffect(()=>{s&&l?m.reset({full_name:l.full_name||"",nif:l.nif||"",contact:l.contact||"",address:l.address||""}):s&&!l&&m.reset({full_name:"",nif:"",contact:"",address:""})},[s,l,m]);const r=async n=>{try{const d={full_name:n.full_name,nif:n.nif,contact:n.contact,address:n.address};i==="reapply"&&l?.id?await x.mutateAsync({id:l.id,data:d}):await o.mutateAsync(d),t(!1),m.reset()}catch{}},a=o.isPending||x.isPending;return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(be,{className:"sm:max-w-md",children:[e.jsxs(_e,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),i==="apply"?c("profile.invitationCode.applyTitle","ç”³è¯·é‚€è¯·ç "):c("profile.invitationCode.reapplyTitle","é‡æ–°ç”³è¯·é‚€è¯·ç ")]}),e.jsx(is,{children:c("profile.invitationCode.applyDesc","è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ä»¥ç”³è¯·ä¸“å±žé‚€è¯·ç ")})]}),e.jsx(Ka,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(r),className:"space-y-4",children:[e.jsx(We,{control:m.control,name:"full_name",render:({field:n})=>e.jsxs(Xe,{children:[e.jsx(Ze,{children:c("profile.invitationCode.fullName","å…¨å")}),e.jsx(Je,{children:e.jsx(M,{placeholder:c("profile.invitationCode.fullNamePlaceholder","è¯·è¾“å…¥æ‚¨çš„å…¨å"),...n})}),e.jsx(es,{})]})}),e.jsx(We,{control:m.control,name:"nif",render:({field:n})=>e.jsxs(Xe,{children:[e.jsx(Ze,{children:c("profile.invitationCode.nif","NIF (ç¨ŽåŠ¡è¯†åˆ«å·)")}),e.jsx(Je,{children:e.jsx(M,{placeholder:c("profile.invitationCode.nifPlaceholder","è¯·è¾“å…¥æ‚¨çš„NIF"),...n})}),e.jsx(es,{})]})}),e.jsx(We,{control:m.control,name:"contact",render:({field:n})=>e.jsxs(Xe,{children:[e.jsx(Ze,{children:c("profile.invitationCode.contact","è”ç³»æ–¹å¼")}),e.jsx(Je,{children:e.jsx(M,{placeholder:c("profile.invitationCode.contactPlaceholder","è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆç”µè¯/å¾®ä¿¡ç­‰ï¼‰"),...n})}),e.jsx(es,{})]})}),e.jsx(We,{control:m.control,name:"address",render:({field:n})=>e.jsxs(Xe,{children:[e.jsx(Ze,{children:c("profile.invitationCode.address","åœ°å€")}),e.jsx(Je,{children:e.jsx(oa,{placeholder:c("profile.invitationCode.addressPlaceholder","è¯·è¾“å…¥æ‚¨çš„åœ°å€"),className:"resize-none",rows:3,...n})}),e.jsx(es,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>t(!1),children:c("common.cancel","å–æ¶ˆ")}),e.jsxs(S,{type:"submit",disabled:a,children:[a&&e.jsx(ca,{className:"w-4 h-4 mr-2 animate-spin"}),i==="apply"?c("profile.invitationCode.submit","æäº¤ç”³è¯·"):c("profile.invitationCode.resubmit","é‡æ–°æäº¤")]})]})]})})]})})},Ue=({open:s,onOpenChange:t})=>{const{t:i}=J();return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(be,{className:"sm:max-w-md",children:[e.jsx(_e,{children:e.jsx(Ee,{className:"flex items-center gap-2",children:i("profile.invitationCode.helpTitle","é‚€è¯·ç ä½¿ç”¨è¯´æ˜Ž")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(da,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpRequirements","ç”³è¯·è¦æ±‚")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpRequirementsDesc","ç”³è¯·é‚€è¯·ç éœ€æä¾›ï¼šå…¨åã€NIFï¼ˆç¨ŽåŠ¡è¯†åˆ«å·ï¼‰ã€è”ç³»æ–¹å¼ã€åœ°å€")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpUsage","ä½¿ç”¨æ¡ä»¶")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpUsageDesc",'é‚€è¯·ç åªèƒ½åœ¨"åŠ å…¥æˆ‘ä»¬"ç”³è¯·ä¸­ä½¿ç”¨ï¼Œä¸”ä»…åœ¨å‹¾é€‰"æ‰«ç ç‚¹é¤"åŠŸèƒ½åŽæ‰èƒ½å¡«å†™')})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(ma,{className:"h-4 w-4"}),e.jsx("span",{children:i("profile.invitationCode.helpBenefit","ç¦åˆ©è¯´æ˜Ž")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:i("profile.invitationCode.helpBenefitDesc","æˆåŠŸé‚€è¯·å•†å®¶åŽï¼Œè¢«é‚€è¯·äººå¯èŽ·å¾—ä»·å€¼99æ¬§å…ƒçš„é¢å¤–å…è´¹æœˆã€‚é‚€è¯·åŒæ–¹å¯è‡ªç”±åå•†ç¦åˆ©åˆ†é…æ–¹å¼ã€‚")})]}),e.jsx(Fs,{}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:i("profile.invitationCode.copyright","Â© 2026 å°ç†Šå¸‚åœº. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚æœ€ç»ˆè§£é‡Šæƒå½’å°ç†Šå¸‚åœºæ‰€æœ‰ã€‚")})]})]})})},dt=s=>{switch(s){case"zh":return va;case"pt":return ja;default:return ga}},mt=({isMobile:s})=>{const{t,i18n:i}=J(),{data:l,isLoading:c}=Ba(),{data:o=[]}=Ha(),[x,m]=g.useState(!1),[r,a]=g.useState(!1),[n,d]=g.useState(!1),[h,f]=g.useState(!1),p=async()=>{l?.code&&(await navigator.clipboard.writeText(l.code),d(!0),ua({title:t("profile.invitationCode.copied","å·²å¤åˆ¶"),description:t("profile.invitationCode.copiedDesc","é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}),setTimeout(()=>d(!1),2e3))},y=o.filter(C=>!(l?.status==="approved"&&C.id===l.id||C.id===l?.id)),j=(C,N)=>{switch(C){case"pending":return e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.pending","å®¡æ ¸ä¸­")]});case"approved":return e.jsxs(P,{variant:"outline",className:"text-primary border-primary",children:[e.jsx(Ms,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.approved","å·²é€šè¿‡")]});case"rejected":return e.jsxs(P,{variant:"destructive",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.rejected","å·²æ‹’ç»")]});case"revoked":return e.jsxs(P,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.revoked","å·²æ”¶å›ž")]});default:return null}},R=()=>y.length===0?null:e.jsxs(Ta,{open:h,onOpenChange:f,className:"mt-4",children:[e.jsx(La,{asChild:!0,children:e.jsxs(S,{variant:"ghost",size:"sm",className:"w-full justify-between text-muted-foreground hover:text-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-4 h-4"}),t("profile.invitationCode.history","åŽ†å²è®°å½•")," (",y.length,")"]}),e.jsx(fa,{className:`w-4 h-4 transition-transform ${h?"rotate-180":""}`})]})}),e.jsx($a,{className:"mt-2 space-y-2",children:y.map(C=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono font-medium",children:C.code}),j(C.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[t("profile.invitationCode.appliedAt","ç”³è¯·æ—¶é—´"),": ",ls(new Date(C.created_at),{addSuffix:!0,locale:dt(i.language)})]}),C.reviewed_at&&e.jsxs("p",{children:[t("profile.invitationCode.reviewedAt","å®¡æ ¸æ—¶é—´"),": ",ls(new Date(C.reviewed_at),{addSuffix:!0,locale:dt(i.language)})]}),C.rejection_reason&&e.jsxs("p",{className:"text-destructive",children:[t("profile.invitationCode.reason","åŽŸå› "),": ",C.rejection_reason]}),C.status==="approved"&&e.jsxs("p",{children:[t("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",C.usage_count," ",t("profile.invitationCode.people","äºº")]})]})]},C.id))})]});return c?e.jsxs(L,{children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsx(Es,{className:"h-6 w-32"}),e.jsx(Es,{className:"h-4 w-48 mt-2"})]}),e.jsx($,{className:s?"px-4 pb-4":"",children:e.jsx(Es,{className:"h-20 w-full"})})]}):l?l.status==="pending"?e.jsxs(L,{className:"border-yellow-500/30",children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-yellow-500"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(X,{children:t("profile.invitationCode.pendingDesc","æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.pending","å®¡æ ¸ä¸­")]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("profile.invitationCode.pendingMessage","ç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å®¡æ ¸é€šè¿‡åŽæ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚")})]}),R()]}),e.jsx(Ue,{open:r,onOpenChange:a})]}):l.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-destructive/30",children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-destructive"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(X,{children:t("profile.invitationCode.rejectedDesc","æ‚¨çš„ç”³è¯·æœªé€šè¿‡å®¡æ ¸")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-destructive/10 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"destructive",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.rejected","å·²æ‹’ç»")]})}),l.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[t("profile.invitationCode.reason","åŽŸå› "),":"]})," ",l.rejection_reason]})]}),e.jsxs(S,{onClick:()=>m(!0),variant:"outline",className:"w-full",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),R()]})]}),e.jsx(Ps,{open:x,onOpenChange:m,mode:"reapply",existingData:{id:l.id,full_name:l.full_name,nif:l.nif,contact:l.contact||"",address:l.address}}),e.jsx(Ue,{open:r,onOpenChange:a})]}):l.status==="revoked"?e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-orange-500/30",children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-orange-500"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(X,{children:t("profile.invitationCode.revokedDesc","æ‚¨çš„é‚€è¯·ç å·²è¢«æ”¶å›ž")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.revoked","å·²æ”¶å›ž")]})}),l.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[t("profile.invitationCode.reason","åŽŸå› "),":"]})," ",l.rejection_reason]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:t("profile.invitationCode.revokedMessage","æ‚¨çš„é‚€è¯·ç å·²è¢«ç®¡ç†å‘˜æ”¶å›žï¼Œå¦‚éœ€ç»§ç»­ä½¿ç”¨è¯·é‡æ–°ç”³è¯·ã€‚")})]}),e.jsxs(S,{onClick:()=>m(!0),variant:"outline",className:"w-full",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),R()]})]}),e.jsx(Ps,{open:x,onOpenChange:m,mode:"reapply",existingData:{id:l.id,full_name:l.full_name,nif:l.nif,contact:l.contact||"",address:l.address}}),e.jsx(Ue,{open:r,onOpenChange:a})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-primary/30",children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-primary"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(X,{children:t("profile.invitationCode.approvedDesc","åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™æ–°å•†å®¶")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:t("profile.invitationCode.yourCode","æ‚¨çš„é‚€è¯·ç ")}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary tracking-wider",children:l.code})]}),e.jsx(S,{variant:"outline",size:"icon",onClick:p,className:"flex-shrink-0",children:n?e.jsx(ha,{className:"w-4 h-4 text-primary"}):e.jsx(xa,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Vs,{className:"w-4 h-4"}),e.jsxs("span",{children:[t("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",l.usage_count," ",t("profile.invitationCode.people","äºº")]})]}),R()]})]}),e.jsx(Ue,{open:r,onOpenChange:a})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsxs(Q,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5 text-primary"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(S,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(X,{children:t("profile.invitationCode.noCodeDesc","ç”³è¯·ä¸“å±žé‚€è¯·ç ï¼Œé‚€è¯·æ–°å•†å®¶åŠ å…¥å¹³å°")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs(S,{onClick:()=>m(!0),className:"w-full",children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.apply","ç”³è¯·é‚€è¯·ç ")]}),R()]})]}),e.jsx(Ps,{open:x,onOpenChange:m,mode:"apply"}),e.jsx(Ue,{open:r,onOpenChange:a})]})},zs=g.memo(({comment:s,getLocalizedField:t,t:i})=>{const l=s.moderation_status==="flagged",c=s.moderation_status==="pending",o=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const x={spam:i("riskReason.spam","åžƒåœ¾ä¿¡æ¯"),offensive:i("riskReason.offensive","ä¸å½“è¨€è®º"),harassment:i("riskReason.harassment","éªšæ‰°æ”»å‡»"),fake_review:i("riskReason.fakeReview","è™šå‡è¯„è®º"),flooding:i("riskReason.flooding","åˆ·å±"),irrelevant:i("riskReason.irrelevant","æ— å…³å†…å®¹"),sensitive_word_detected:i("riskReason.sensitiveWord","æ•æ„Ÿè¯"),parse_error:i("riskReason.parseError","è§£æžé”™è¯¯")};return s.risk_reasons.map(m=>x[m]||m).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(Z,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:ls(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),c&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(Fe,{className:"w-3 h-3 mr-1"}),i("restaurant.commentPending","å®¡æ ¸ä¸­")]})}),l&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(P,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(Na,{className:"w-3 h-3 mr-1"}),i("restaurant.commentFailed","å‘é€å¤±è´¥")]}),o()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[i("restaurant.failReason","å¤±è´¥åŽŸå› "),": ",o()]})]})]})});zs.displayName="CommentItem";const Us=g.memo(({restaurant:s,getLocalizedField:t,t:i})=>{if(!s||!s.id)return null;const l=t(s,"name")||s.name||"",c=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(Z,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(l),className:"w-full h-full object-cover",loading:"lazy",onError:o=>{o.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:l}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:c}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[i("restaurant.noRatingLine1"),e.jsx("br",{}),i("restaurant.noRatingLine2")]})]})]})]})});Us.displayName="FavoriteRestaurantItem";const Bs=g.memo(({subscription:s,getLocalizedField:t,t:i,isMobile:l})=>{const[c,o]=g.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${l?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(t(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[i("profile.joinedOn"),":"," ",ls(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Be,{className:`text-primary fill-primary flex-shrink-0 ${l?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(Ga,{open:c,onOpenChange:o,activity:{title:String(t(s.activity,"title")),image_url:s.activity?.image_url,content:String(t(s.activity,"content"))}})]})});Bs.displayName="ActivitySubscriptionItem";const Hs=g.memo(({activityGroup:s,getLocalizedField:t,t:i,isMobile:l})=>{const c=s.activity,o=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${l?"p-3":"p-4"}`,children:[e.jsx(Z,{to:`/activity/${c.id}`,className:l?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[c.image_url&&e.jsx("img",{src:c.image_url,alt:String(t(c,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(c,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(c,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),new Date(c.start_date).toLocaleDateString()]}),c.end_date&&e.jsxs("span",{children:["- ",new Date(c.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${l?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${l?"mb-1.5":"mb-2"}`,children:[e.jsx(fe,{className:`text-primary ${l?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${l?"text-xs":"text-sm"}`,children:[i("profile.participatingRestaurants")," (",o.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${l?"gap-1.5":"gap-2"}`,children:o.map(x=>e.jsx(P,{variant:"secondary",className:l?"text-xs px-2 py-0.5":"text-xs",children:t(x,"name")},x.id))})]})]})});Hs.displayName="MerchantActivityItem";const Qs=g.memo(({coupon:s,getLocalizedField:t,t:i,isMobile:l})=>{const[c,o]=g.useState(!1),x=s.coupon_codes?.coupon_templates,m=s.coupon_codes?.code,r=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${r?"bg-muted/30":"hover:shadow-medium"} ${l?"p-3":"p-4"}`,onClick:()=>o(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":"text-base"}`,children:t(x,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${l?"text-xs":"text-sm"}`,children:t(x,"description")})]}),e.jsx(P,{variant:r?"secondary":"default",className:l?"text-xs":"",children:i(r?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${l?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:m}),e.jsx("span",{className:"text-muted-foreground",children:x?.discount_type==="percentage"?`${x?.discount_value}%`:`â‚¬${x?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${l?"text-xs":"text-sm"}`,children:r?e.jsxs("span",{children:[i("profile.coupons.usedOn"),": ",Ne(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):x?.valid_until?e.jsxs("span",{children:[i("profile.coupons.validUntil"),": ",Ne(new Date(x.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:i("profile.coupons.noExpiry")})})]}),e.jsx(dr,{open:c,onOpenChange:o,coupon:s})]})});Qs.displayName="UserCouponItem";const Qr=()=>{const{t:s}=J(),{user:t}=Ae(),i=ya(),{isWebView:l}=wa(),{data:c,isLoading:o}=ft(),{data:x,isLoading:m}=Ya(),{data:r,isLoading:a}=Wa(),{data:n,isLoading:d}=Sa(),{data:h,isLoading:f}=Xa(),{data:p,isLoading:y}=Pa(),{role:j,isMerchant:R,isSupervisor:C}=ht(),{getLocalizedField:N}=cs(),A=R||C,[D,ee]=g.useState("profile"),[B,K]=g.useState(),[I,ge]=g.useState({}),[z,Pe]=g.useState(new Set(["profile"])),je=A?[{value:"profile",label:s("profile.profile"),icon:Js},{value:"favorites",label:s("profile.favorites"),icon:Be},{value:"comments",label:s("profile.comments"),icon:ze},{value:"activities",label:s("profile.participatedActivities"),icon:pe}]:[{value:"profile",label:s("profile.profile"),icon:Js},{value:"favorites",label:s("profile.favorites"),icon:Be},{value:"comments",label:s("profile.comments"),icon:ze}],V=v=>{ge(_=>({..._,[v]:window.scrollY}))},G=v=>{if(z.has(v)){const _=I[v]||0;setTimeout(()=>window.scrollTo(0,_),0)}else setTimeout(()=>window.scrollTo(0,0),0),Pe(_=>new Set([..._,v]))};g.useEffect(()=>{if(!B)return;const v=()=>{const _=B.selectedScrollSnap(),k=je[_].value;k!==D&&(V(D),G(k),ee(k))};return B.on("select",v),()=>{B.off("select",v)}},[B,D,I,z]);const ne=v=>{if(v===D)return;V(D);const _=je.findIndex(k=>k.value===v);_!==-1&&B&&B.scrollTo(_),G(v),ee(v)},Y=ba(),ie=g.useCallback(async()=>{await Promise.all([Y.invalidateQueries({queryKey:["profile"]}),Y.invalidateQueries({queryKey:["favorites"]}),Y.invalidateQueries({queryKey:["user-comments"]}),Y.invalidateQueries({queryKey:["subscriptions"]}),Y.invalidateQueries({queryKey:["user-coupons"]})])},[Y]);if(!t||o)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const W=s(j?`profile.role.${j}`:"profile.role.user");return e.jsx(Fa,{onRefresh:ie,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${i?l?"pb-36 pt-4":"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${i?"px-3":""}`,children:[!i&&e.jsx(e.Fragment,{children:e.jsx(L,{className:"mb-6 md:mb-8",children:e.jsx($,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(ks,{className:"w-24 h-24",children:[e.jsx(Ds,{src:c?.avatar_url||""}),e.jsx(Rs,{className:"text-3xl",children:c?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:c?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),c?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:c.phone}),j&&j!=="user"&&e.jsx(P,{className:"bg-primary capitalize",children:W}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(et,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:c?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points","ç§¯åˆ†")}),e.jsx(st,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[c&&e.jsx(rt,{profile:c}),A&&c&&e.jsx(tt,{isAgreed:c?.activity_terms_agreed||!1,agreedAt:c?.activity_terms_agreed_at||null})]})]})})})}),i?e.jsxs(e.Fragment,{children:[e.jsx(_a,{setApi:K,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Ea,{className:"-ml-0",children:[e.jsx(Ge,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(L,{children:e.jsx($,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ks,{className:"w-20 h-20",children:[e.jsx(Ds,{src:c?.avatar_url||""}),e.jsx(Rs,{className:"text-2xl",children:c?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:c?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(et,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:c?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points","ç§¯åˆ†")}),e.jsx(st,{})]}),c?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:c.phone}),j&&j!=="user"&&e.jsx(P,{className:"bg-primary capitalize text-xs mb-4",children:W}),c&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(rt,{profile:c}),A&&e.jsx(tt,{isAgreed:c?.activity_terms_agreed||!1,agreedAt:c?.activity_terms_agreed_at||null})]})]})]})})}),e.jsx(mt,{isMobile:!0}),e.jsxs(L,{children:[e.jsxs(Q,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(X,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx($,{className:"px-3",children:y?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:"space-y-3",children:p.map(v=>e.jsx(Qs,{coupon:v,getLocalizedField:N,t:s,isMobile:!0},v.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(it,{}),e.jsx(ot,{}),e.jsx(ct,{})]})}),e.jsx(Ge,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(L,{children:e.jsx($,{className:"pt-4",children:e.jsxs(Ss,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(As,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(se,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),x&&x.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:x.length})]}),e.jsxs(se,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),n&&n.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:n.length})]})]}),e.jsx(te,{value:"restaurants",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):x&&x.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:x.map(v=>e.jsx(Us,{restaurant:v,getLocalizedField:N,t:s},v.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(te,{value:"activities",children:d?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):n&&n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(v=>e.jsx(Bs,{subscription:v,getLocalizedField:N,t:s,isMobile:!0},v.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(Ge,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(L,{children:[e.jsxs(Q,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(X,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx($,{className:"space-y-3 px-3",children:a?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):r&&r.length>0?r.map(v=>e.jsx(zs,{comment:v,getLocalizedField:N,t:s},v.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),A&&e.jsx(Ge,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(L,{children:[e.jsxs(Q,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(X,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx($,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:f?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):h&&h.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const v=h.reduce((_,k)=>{const H=k.activity_id;return _[H]||(_[H]={activity:k.activity,restaurants:[],participationDate:k.created_at}),_[H].restaurants.push({id:k.restaurant_id,name:k.restaurant_name,name_en:k.restaurant_name_en,name_pt:k.restaurant_name_pt}),_},{});return Object.values(v).map(_=>e.jsx(Hs,{activityGroup:_,getLocalizedField:N,t:s,isMobile:!0},_.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:`fixed left-0 right-0 bg-background border-t z-40 ${l?"bottom-20":"bottom-0"}`,children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:je.map(v=>{const _=v.icon;return e.jsxs("button",{onClick:()=>ne(v.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${D===v.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(_,{className:`${D===v.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:v.label})]},v.value)})})})]}):e.jsxs(Ss,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(As,{className:`grid w-full ${A?"grid-cols-7":"grid-cols-6"} bg-card border rounded-lg shadow-sm h-auto p-1`,children:[e.jsxs(se,{value:"favorites",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(se,{value:"coupons",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(se,{value:"comments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),A&&e.jsxs(se,{value:"activities",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(se,{value:"invitation-code",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),s("profile.invitationCode.title","é‚€è¯·ç ")]}),e.jsxs(se,{value:"addresses",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(se,{value:"orders",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(te,{value:"favorites",children:e.jsx(L,{children:e.jsx($,{className:"pt-6",children:e.jsxs(Ss,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(As,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(se,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),x&&x.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:x.length})]}),e.jsxs(se,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),n&&n.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:n.length})]})]}),e.jsx(te,{value:"restaurants",children:m?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):x&&x.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:x.map(v=>e.jsx(Us,{restaurant:v,getLocalizedField:N,t:s},v.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(te,{value:"activities",children:d?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):n&&n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(v=>e.jsx(Bs,{subscription:v,getLocalizedField:N,t:s,isMobile:i},v.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(te,{value:"comments",children:e.jsxs(L,{children:[e.jsxs(Q,{className:i?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(ze,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(X,{className:i?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx($,{className:`space-y-3 md:space-y-4 ${i?"px-3":""}`,children:a?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):r&&r.length>0?r.map(v=>e.jsx(zs,{comment:v,getLocalizedField:N,t:s},v.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:s("profile.noComments")})})]})}),A&&e.jsx(te,{value:"activities",children:e.jsxs(L,{children:[e.jsxs(Q,{className:i?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(X,{className:i?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx($,{className:i?"px-3":"",children:e.jsx("div",{className:i?"space-y-4":"space-y-6",children:f?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):h&&h.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${i?"text-base":"text-lg"}`,children:[e.jsx(fe,{className:i?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:i?"space-y-3":"space-y-4",children:(()=>{const v=h.reduce((_,k)=>{const H=k.activity_id;return _[H]||(_[H]={activity:k.activity,restaurants:[],participationDate:k.created_at}),_[H].restaurants.push({id:k.restaurant_id,name:k.restaurant_name,name_en:k.restaurant_name_en,name_pt:k.restaurant_name_pt}),_},{});return Object.values(v).map(_=>e.jsx(Hs,{activityGroup:_,getLocalizedField:N,t:s,isMobile:i},_.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(te,{value:"invitation-code",children:e.jsx(mt,{})}),e.jsx(te,{value:"coupons",children:e.jsxs(L,{children:[e.jsxs(Q,{className:i?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(He,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(X,{className:i?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx($,{className:i?"px-3":"",children:y?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${i?"grid-cols-1":"md:grid-cols-2"}`,children:p.map(v=>e.jsx(Qs,{coupon:v,getLocalizedField:N,t:s,isMobile:i},v.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(Z,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(te,{value:"addresses",children:e.jsx(it,{})}),e.jsx(te,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(ot,{}),e.jsx(ct,{})]})})]})]})})})};export{Qr as default};
//# sourceMappingURL=Profile-m3BR7nsO.js.map
