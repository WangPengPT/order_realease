import{p as _e,r as o,j as e,cO as As,al as Es,cP as Fs,cQ as Ps,cR as Rs,cS as Ls,q as Is,bO as Vs,bS as Ms,ab as Ve,bU as es,bf as ss,cT as ts,X as we,cU as V,a_ as Ce,ak as ms,bW as xs,bM as Ye,aN as Ge,cV as Us,cL as Bs,b3 as Hs,aZ as hs,w as me,bN as us,aM as Se,bH as ps,bG as gs,b2 as Os,L as as,ck as qs}from"./vendor-react-BDRnRVHv.js";import{D as Pe,c as Re,d as Le,e as Ie,T as js,B as te,V as Ze,h as x,W as Je,F as ns,C as ie,n as re,U as i,I as _,g as pe,a2 as K,a3 as X,a4 as ee,a5 as se,a6 as r,s as M,X as De,z as $s,A as Me,a7 as Ue,q as Be,r as He,t as Oe,v as qe,w as $e,x as We,y as Qe,m as Ws,E as Qs,$ as Ys}from"./index-4ynzYXNo.js";import{C as je}from"./checkbox-BQzq8dEc.js";import{i as Gs}from"./useActivities-C666VYuY.js";import{u as Zs}from"./useLocalizedContent-DlPVPXMF.js";import{r as Js,s as Ks}from"./useAdmin-BTgw7Vtt.js";import{C as ls}from"./calendar-sGVo9WMT.js";import{P as is,a as rs,b as os}from"./popover-D-hZJ7T8.js";import{T as ke,a as ze,b as B,c as H}from"./tabs-BHwuDz19.js";import{u as Xs}from"./useRestaurants-B6y6NQ-V.js";import{R as O}from"./RichTextEditor-DZJFuQ1I.js";import{A as et,a as st}from"./alert-B0pp-q1L.js";import{i as ge}from"./vendor-i18n-jtdHZIRR.js";import{N as Te,O as d,S as Ae,P as oe,T as D,Q as _s,U as Ee,D as Fe}from"./vendor-utils-vwQGbBim.js";import{u as tt,a as at}from"./useActivityRules-CQmjKCEX.js";import{u as nt,a as lt}from"./useGlobalHandbook-BvUp0LsR.js";import{b as it}from"./exportUtils-YWmY6fTR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-DA900zcV.js";const fs=1200,vs=630,cs=fs/vs;function rt(a,c,t){return Rs(Ls({unit:"%",width:90},t,a,c),a,c)}function ot({open:a,onOpenChange:c,imageFile:t,onCropComplete:q}){const{t:h}=_e(),[F,k]=o.useState(""),[f,w]=o.useState(),[p,v]=o.useState(),g=o.useRef(null),[N,b]=o.useState(!1);o.useEffect(()=>{if(a&&t){const m=new FileReader;m.addEventListener("load",()=>{k(m.result?.toString()||"")}),m.readAsDataURL(t)}},[a,t]);const P=o.useCallback(m=>{const{width:z,height:T}=m.currentTarget;w(rt(z,T,cs))},[]),L=o.useCallback(async(m,z)=>{const T=document.createElement("canvas"),$=T.getContext("2d");if(!$)throw new Error("No 2d context");const Y=m.naturalWidth/m.width,l=m.naturalHeight/m.height;return T.width=z.width*Y,T.height=z.height*l,$.imageSmoothingQuality="high",$.drawImage(m,z.x*Y,z.y*l,z.width*Y,z.height*l,0,0,T.width,T.height),new Promise((C,G)=>{T.toBlob(U=>{if(!U){G(new Error("Canvas is empty"));return}C(U)},"image/jpeg",.95)})},[]),ae=o.useCallback(async()=>{if(!(!p||!g.current)){b(!0);try{const m=await L(g.current,p),z=new File([m],t.name,{type:"image/jpeg"}),T=URL.createObjectURL(m);q(z,T),c(!1)}catch(m){console.error("Error cropping image:",m)}finally{b(!1)}}},[p,t,q,c,L]);return e.jsx(Pe,{open:a,onOpenChange:c,children:e.jsxs(Re,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Le,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(Ie,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(As,{className:"w-5 h-5 text-primary"}),h("admin.cropImage")]}),e.jsx(js,{className:"text-xs sm:text-sm",children:h("admin.cropImageDescription")})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsxs(et,{className:"border-primary/20 bg-primary/5",children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsxs(st,{className:"text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[h("admin.recommendedSize"),":"]}),e.jsxs(te,{variant:"secondary",className:"w-fit",children:[e.jsx(Fs,{className:"w-3 h-3 mr-1"}),fs," Ã— ",vs," px"]})]}),e.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:h("admin.imageSizeHint")})]})]}),e.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:F&&e.jsx(Ps,{crop:f,onChange:m=>w(m),onComplete:m=>v(m),aspect:cs,className:"max-h-[50vh] sm:max-h-[60vh]",children:e.jsx("img",{ref:g,src:F,alt:"Crop preview",onLoad:P,className:"max-w-full h-auto"})})})]}),e.jsxs(Ze,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>c(!1),disabled:N,className:"w-full sm:w-auto",children:h("common.cancel")}),e.jsx(x,{type:"button",onClick:ae,disabled:!p||N,className:"w-full sm:w-auto",children:h(N?"common.processing":"admin.confirmCrop")})]})]})})}const ct=Te({title_en:d().optional(),title_zh:d().optional(),title_pt:d().optional(),intro_zh:d().optional(),intro_en:d().optional(),intro_pt:d().optional(),content_en:d().optional(),content_zh:d().optional(),content_pt:d().optional(),usage_instructions_zh:d().optional(),usage_instructions_en:d().optional(),usage_instructions_pt:d().optional(),start_date:Ae().optional(),end_date:Ae().optional(),repeat_mode:oe(["none","daily","weekly","monthly","yearly","days_before"]).optional(),repeat_weekday:D().min(0).max(6).optional().nullable(),repeat_days_before:D().min(0).max(30).optional().nullable(),repeat_month_day:_s(Te({start:D().min(1).max(31),end:D().min(1).max(31)})).optional().nullable(),repeat_yearly_month:D().min(1).max(12).optional().nullable(),repeat_yearly_day:D().min(1).max(31).optional().nullable(),service_type:oe(["dine_in","takeaway","both"]).optional(),status:oe(["draft","published"]).default("draft"),pinned:Ee().default(!1),visible:Ee().default(!1),sort_order:D().default(0),badge_text_zh:d().optional(),badge_text_en:d().optional(),badge_text_pt:d().optional(),badge_color:d().optional(),discount_type:oe(["percentage","fixed_amount"]).optional().nullable(),discount_value:D().optional().nullable(),discount_key:d().optional().nullable()}),dt=Te({title_en:d().min(1,ge.t("validation.titleRequired")),title_zh:d().min(1,ge.t("validation.titleRequired")),title_pt:d().min(1,ge.t("validation.titleRequired")),intro_zh:d().optional(),intro_en:d().optional(),intro_pt:d().optional(),content_en:d().min(1,ge.t("validation.contentRequired")),content_zh:d().min(1,ge.t("validation.contentRequired")),content_pt:d().min(1,ge.t("validation.contentRequired")),usage_instructions_zh:d().optional(),usage_instructions_en:d().optional(),usage_instructions_pt:d().optional(),start_date:Ae(),end_date:Ae().optional(),repeat_mode:oe(["none","daily","weekly","monthly","yearly","days_before"]),repeat_weekday:D().min(0).max(6).optional().nullable(),repeat_days_before:D().min(0).max(30).optional().nullable(),repeat_month_day:_s(Te({start:D().min(1).max(31),end:D().min(1).max(31)})).optional().nullable(),repeat_yearly_month:D().min(1).max(12).optional().nullable(),repeat_yearly_day:D().min(1).max(31).optional().nullable(),service_type:oe(["dine_in","takeaway","both"]),status:oe(["draft","published"]).default("published"),pinned:Ee().default(!1),visible:Ee().default(!0),sort_order:D().default(0),badge_text_zh:d().optional(),badge_text_en:d().optional(),badge_text_pt:d().optional(),badge_color:d().optional(),discount_type:oe(["percentage","fixed_amount"]).optional().nullable(),discount_value:D().optional().nullable(),discount_key:d().optional().nullable()}),mt=ct;function ds({activity:a,trigger:c}){const{t}=_e(),q=Is(),[h,F]=o.useState(!1),[k,f]=o.useState(null),[w,p]=o.useState(a?.image_url||null),[v,g]=o.useState([]),[N,b]=o.useState(""),[P,L]=o.useState(!1),[ae,m]=o.useState(!1),[z,T]=o.useState(null),[$,Y]=o.useState(a?.media_type==="video"?"video":"image"),[l,C]=o.useState(null),[G,U]=o.useState(a?.video_url||null),[xe,ce]=o.useState(!1),[fe,de]=o.useState(!1),{data:ve}=Xs(),he=()=>a?{title_en:a.title_en,title_zh:a.title_zh,title_pt:a.title_pt,intro_zh:a.intro_zh||"",intro_en:a.intro_en||"",intro_pt:a.intro_pt||"",content_en:a.content_en,content_zh:a.content_zh,content_pt:a.content_pt,usage_instructions_zh:a.usage_instructions_zh||"",usage_instructions_en:a.usage_instructions_en||"",usage_instructions_pt:a.usage_instructions_pt||"",start_date:new Date(a.start_date),end_date:a.end_date?new Date(a.end_date):void 0,repeat_mode:a.repeat_mode||"none",repeat_weekday:a.repeat_weekday??null,repeat_days_before:a.repeat_days_before??null,repeat_month_day:Array.isArray(a.repeat_month_day)?a.repeat_month_day:null,repeat_yearly_month:a.repeat_yearly_month??null,repeat_yearly_day:a.repeat_yearly_day??null,service_type:a.service_type||"both",status:a.status||"draft",pinned:a.pinned||!1,visible:a.visible!==void 0?a.visible:!0,sort_order:a.sort_order||0,badge_text_zh:a.badge_text_zh||a.title_zh,badge_text_en:a.badge_text_en||a.title_en,badge_text_pt:a.badge_text_pt||a.title_pt,badge_color:a.badge_color||"#9b87f5",discount_type:a.discount_type||null,discount_value:a.discount_value||null,discount_key:a.discount_key||null}:{repeat_mode:"none",repeat_weekday:null,repeat_days_before:null,repeat_month_day:null,repeat_yearly_month:null,repeat_yearly_day:null,service_type:"both",status:"draft",pinned:!1,visible:!1,sort_order:0,badge_color:"#9b87f5",discount_type:null,discount_value:null,discount_key:null},{register:R,handleSubmit:Ns,formState:{errors:y},setValue:Z,watch:j,control:I,reset:Ke}=Vs({resolver:Ms(mt),defaultValues:he()}),bs=s=>{s?(Ke(he()),f(null),p(a?.image_url||null),C(null),U(a?.video_url||null),de(!1),Y(a?.media_type==="video"?"video":"image"),ce(!1),m(!1),T(null),b("")):(Ke(he()),f(null),p(a?.image_url||null),C(null),U(a?.video_url||null),de(!1),Y(a?.media_type==="video"?"video":"image")),F(s)},Ne=j("start_date"),be=j("end_date"),ys=j("pinned"),ws=j("visible"),W=j("status");o.useEffect(()=>{W==="draft"&&(Z("visible",!1),Z("pinned",!1))},[W,Z]),o.useEffect(()=>{(async()=>{if(a?.id){const{data:n}=await M.from("activity_restaurants").select("restaurant_id").eq("activity_id",a.id);n&&g(n.map(A=>A.restaurant_id))}})()},[a?.id]);const Xe=s=>{const n=s.target.files?.[0];if(n){if(n.size>10*1024*1024){me.error(t("admin.imageTooBig"));return}T(n),m(!0)}s.target.value=""},Cs=(s,n)=>{f(s),p(n)},Ss=s=>{const n=s.target.files?.[0];if(n){if(n.size>100*1024*1024){me.error(t("admin.videoTooBig")||"è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§100MBï¼‰");return}if(!n.type.startsWith("video/")){me.error(t("admin.invalidVideoFormat")||"è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶");return}C(n),U(URL.createObjectURL(n)),de(!1)}s.target.value=""},Ds=async()=>{if(!k)return a?.image_url||null;const s=k.name.split(".").pop(),A=`${`${Math.random()}.${s}`}`,{error:ne}=await M.storage.from("activity-images").upload(A,k);if(ne)throw ne;const{data:{publicUrl:ue}}=M.storage.from("activity-images").getPublicUrl(A);return ue},ks=async()=>{if(fe&&!l)return null;if(!l)return a?.video_url||null;ce(!0);try{const s=l.name.split(".").pop(),n=`video_${Date.now()}.${s}`,{error:A}=await M.storage.from("activity-images").upload(n,l);if(A)throw A;const{data:{publicUrl:ne}}=M.storage.from("activity-images").getPublicUrl(n);return ne}finally{ce(!1)}},zs=async s=>{L(!0);try{if(s.status==="published"){const S=dt.safeParse(s);if(!S.success){const u={title_zh:t("admin.titleChinese"),title_en:t("admin.titleEnglish"),title_pt:t("admin.titlePortuguese"),content_zh:t("admin.contentChinese"),content_en:t("admin.contentEnglish"),content_pt:t("admin.contentPortuguese"),start_date:t("admin.startDate"),end_date:t("admin.endDate"),repeat_mode:t("admin.repeatMode"),service_type:t("admin.serviceType")},E=S.error.errors.map(J=>{const le=J.path.join(".");return u[le]||le});me.error(`${t("admin.publishRequiresComplete")}: ${E.join(", ")}`),L(!1);return}}const{data:{user:n}}=await M.auth.getUser();if(!n)throw new Error("Not authenticated");const[A,ne]=await Promise.all([Ds(),ks()]),ue=s.status==="draft"?!1:s.visible,Q={title_en:s.title_en||"",title_zh:s.title_zh||"",title_pt:s.title_pt||"",intro_zh:s.intro_zh||null,intro_en:s.intro_en||null,intro_pt:s.intro_pt||null,content_en:s.content_en||"",content_zh:s.content_zh||"",content_pt:s.content_pt||"",usage_instructions_zh:s.usage_instructions_zh||null,usage_instructions_en:s.usage_instructions_en||null,usage_instructions_pt:s.usage_instructions_pt||null,repeat_mode:s.repeat_mode||"none",repeat_weekday:s.repeat_mode==="weekly"?s.repeat_weekday:null,repeat_days_before:s.repeat_mode==="days_before"?s.repeat_days_before:null,repeat_month_day:s.repeat_mode==="monthly"?s.repeat_month_day:null,repeat_yearly_month:s.repeat_mode==="yearly"?s.repeat_yearly_month:null,repeat_yearly_day:s.repeat_mode==="yearly"?s.repeat_yearly_day:null,service_type:s.service_type||"both",status:s.status,pinned:s.status==="draft"?!1:s.pinned,visible:ue,sort_order:s.sort_order,image_url:A,media_type:$,video_url:ne,start_date:s.start_date?.toISOString()||new Date().toISOString(),end_date:s.end_date?.toISOString()||null,badge_text_zh:s.badge_text_zh||s.title_zh||"",badge_text_en:s.badge_text_en||s.title_en||"",badge_text_pt:s.badge_text_pt||s.title_pt||"",badge_color:s.badge_color||"#9b87f5",discount_type:s.discount_type||null,discount_value:s.discount_value||null,discount_key:s.discount_key||null};if(a){const{error:S}=await M.from("activities").update(Q).eq("id",a.id);if(S)throw S;if(await M.from("activity_restaurants").delete().eq("activity_id",a.id),v.length>0){const u=v.map(J=>({activity_id:a.id,restaurant_id:J})),{error:E}=await M.from("activity_restaurants").insert(u);if(E)throw E}me.success(t("admin.activityUpdated")),F(!1)}else{const S={...Q,creator_id:n.id},{data:u,error:E}=await M.from("activities").insert([S]).select().single();if(E)throw E;if(v.length>0){const le=v.map(Ts=>({activity_id:u.id,restaurant_id:Ts})),{error:ye}=await M.from("activity_restaurants").insert(le);if(ye)throw ye}const{data:J}=await M.from("coupon_templates").select("id").eq("auto_link_activities",!0).eq("is_active",!0);if(J&&J.length>0){const le=J.map(ye=>({coupon_template_id:ye.id,activity_id:u.id}));await M.from("coupon_template_activities").insert(le)}me.success(t("admin.activityCreated")),F(!1)}q.invalidateQueries({queryKey:["activities"]}),q.invalidateQueries({queryKey:["admin-activities"]})}catch(n){me.error(n.message||t("common.error"))}finally{L(!1)}};return e.jsxs(Pe,{open:h,onOpenChange:bs,children:[e.jsx(Je,{asChild:!0,children:c}),e.jsxs(Re,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Le,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(Ie,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Ve,{className:"w-6 h-6 text-primary"}),t(a?"admin.editActivity":"admin.addActivity")]}),e.jsx(js,{className:"text-base",children:t(a?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),e.jsx(ns,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:Ns(zs),className:"space-y-6 py-6",children:[e.jsx(ie,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(re,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(es,{className:"w-5 h-5 text-primary"}),t("admin.activityMedia")||"æ´»åŠ¨åª’ä½“"]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(x,{type:"button",variant:$==="image"?"default":"outline",size:"sm",onClick:()=>Y("image"),className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),t("admin.image")||"å›¾ç‰‡"]}),e.jsxs(x,{type:"button",variant:$==="video"?"default":"outline",size:"sm",onClick:()=>Y("video"),className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4"}),t("admin.video")||"è§†é¢‘"]})]}),$==="image"&&e.jsxs("div",{className:"flex items-center gap-6",children:[w&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:w,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{f(null),p(null)},children:e.jsx(we,{className:"h-4 w-4"})})]}),e.jsxs(i,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(es,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadImage")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.imageMaxSize")})]})]}),e.jsx(_,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Xe})]})]}),$==="video"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[G&&e.jsxs("div",{className:"relative group",children:[e.jsx("video",{src:G,className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20",muted:!0,loop:!0,playsInline:!0,onMouseEnter:s=>s.currentTarget.play(),onMouseLeave:s=>{s.currentTarget.pause(),s.currentTarget.currentTime=0}}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{C(null),U(null),de(!0)},children:e.jsx(we,{className:"h-4 w-4"})})]}),e.jsxs(i,{htmlFor:"video-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(ts,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:t("admin.uploadVideo")||"ä¸Šä¼ è§†é¢‘"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t("admin.videoMaxSize")||"æœ€å¤§ 50MB"})]})]}),e.jsx(_,{id:"video-upload",type:"file",accept:"video/*",className:"hidden",onChange:Ss})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(i,{className:"text-sm font-medium mb-2 block",children:t("admin.fallbackImage")||"å°é¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:t("admin.fallbackImageDesc")||"è§†é¢‘åŠ è½½å‰æ˜¾ç¤ºçš„å°é¢å›¾"}),e.jsxs("div",{className:"flex items-center gap-4",children:[w&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:w,alt:"Fallback",className:"w-20 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20"}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 shadow opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{f(null),p(null)},children:e.jsx(we,{className:"h-3 w-3"})})]}),e.jsxs(i,{htmlFor:"fallback-image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all text-sm",children:[e.jsx(ss,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:t("admin.uploadFallback")||"ä¸Šä¼ å°é¢"})]}),e.jsx(_,{id:"fallback-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Xe})]})]})]})]})]})}),e.jsx(ie,{className:"border-primary/20",children:e.jsxs(re,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Ve,{className:"w-5 h-5 text-primary"}),t("admin.multilingualContent")]}),e.jsxs(ke,{defaultValue:"zh",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(B,{value:"zh",className:"gap-2",children:["ðŸ‡¨ðŸ‡³ ",t("admin.chinese")]}),e.jsxs(B,{value:"en",className:"gap-2",children:["ðŸ‡¬ðŸ‡§ ",t("admin.english")]}),e.jsxs(B,{value:"pt",className:"gap-2",children:["ðŸ‡µðŸ‡¹ ",t("admin.portuguese")]})]}),e.jsxs(H,{value:"zh",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_zh",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(_,{id:"title_zh",...R("title_zh"),placeholder:t("admin.enterTitle"),className:"text-base"}),y.title_zh&&e.jsx("p",{className:"text-sm text-destructive",children:y.title_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ç®€ä»‹"}),e.jsx(_,{id:"intro_zh",...R("intro_zh"),placeholder:"ç®€çŸ­æè¿°æ´»åŠ¨ï¼ˆæ˜¾ç¤ºåœ¨é¤åŽ…è¯¦æƒ…é¡µï¼‰",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"åœ¨é¤åŽ…è¯¦æƒ…é¡µæ´»åŠ¨æ ‡ç­¾åŽæ˜¾ç¤ºçš„ç®€çŸ­è¯´æ˜Ž"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_zh",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(V,{name:"content_zh",control:I,render:({field:s})=>e.jsx(O,{value:s.value,onChange:s.onChange,placeholder:t("admin.enterContent")})}),y.content_zh&&e.jsx("p",{className:"text-sm text-destructive",children:y.content_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ä½¿ç”¨æ–¹æ³•"}),e.jsx(V,{name:"usage_instructions_zh",control:I,render:({field:s})=>e.jsx(O,{value:s.value||"",onChange:s.onChange,placeholder:"æè¿°å¦‚ä½•ä½¿ç”¨æ­¤æ´»åŠ¨ï¼ˆå¯é€‰ï¼‰"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å‘ç”¨æˆ·è¯´æ˜Žå¦‚ä½•å‚ä¸Žå’Œä½¿ç”¨æ­¤æ´»åŠ¨"})]})]}),e.jsxs(H,{value:"en",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_en",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(_,{id:"title_en",...R("title_en"),placeholder:t("admin.enterTitle"),className:"text-base"}),y.title_en&&e.jsx("p",{className:"text-sm text-destructive",children:y.title_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),e.jsx(_,{id:"intro_en",...R("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_en",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(V,{name:"content_en",control:I,render:({field:s})=>e.jsx(O,{value:s.value,onChange:s.onChange,placeholder:t("admin.enterContent")})}),y.content_en&&e.jsx("p",{className:"text-sm text-destructive",children:y.content_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),e.jsx(V,{name:"usage_instructions_en",control:I,render:({field:s})=>e.jsx(O,{value:s.value||"",onChange:s.onChange,placeholder:"Describe how to use this activity (optional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),e.jsxs(H,{value:"pt",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_pt",className:"text-sm font-medium",children:t("admin.title")}),e.jsx(_,{id:"title_pt",...R("title_pt"),placeholder:t("admin.enterTitle"),className:"text-base"}),y.title_pt&&e.jsx("p",{className:"text-sm text-destructive",children:y.title_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),e.jsx(_,{id:"intro_pt",...R("intro_pt"),placeholder:"DescriÃ§Ã£o curta (exibida nos detalhes do restaurante)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descriÃ§Ã£o exibida apÃ³s o distintivo da atividade na pÃ¡gina do restaurante"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_pt",className:"text-sm font-medium",children:t("admin.content")}),e.jsx(V,{name:"content_pt",control:I,render:({field:s})=>e.jsx(O,{value:s.value,onChange:s.onChange,placeholder:t("admin.enterContent")})}),y.content_pt&&e.jsx("p",{className:"text-sm text-destructive",children:y.content_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"InstruÃ§Ãµes de Uso"}),e.jsx(V,{name:"usage_instructions_pt",control:I,render:({field:s})=>e.jsx(O,{value:s.value||"",onChange:s.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usuÃ¡rios como participar e usar esta atividade"})]})]})]})]})}),e.jsx(ie,{className:"border-primary/20",children:e.jsxs(re,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Ce,{className:"w-5 h-5 text-primary"}),t("admin.dateSettings")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:t("admin.startDate")}),e.jsxs(is,{children:[e.jsx(rs,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:pe("w-full justify-start text-left font-normal h-11",!Ne&&"text-muted-foreground"),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),Ne?Fe(Ne,"PPP"):e.jsx("span",{children:t("admin.selectDate")})]})}),e.jsx(os,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(ls,{mode:"single",selected:Ne,onSelect:s=>Z("start_date",s),initialFocus:!0,className:"pointer-events-auto"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:t("admin.endDate")}),e.jsxs(is,{children:[e.jsx(rs,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:pe("w-full justify-start text-left font-normal h-11",!be&&"text-muted-foreground"),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),be?Fe(be,"PPP"):e.jsxs("span",{children:[t("admin.selectDate")," (",t("admin.optional"),")"]})]})}),e.jsx(os,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(ls,{mode:"single",selected:be,onSelect:s=>Z("end_date",s),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:t("admin.repeatMode")}),e.jsxs(K,{onValueChange:s=>Z("repeat_mode",s),defaultValue:j("repeat_mode"),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:t("admin.selectRepeatMode")})}),e.jsxs(se,{children:[e.jsx(r,{value:"none",children:t("admin.repeatNone")}),e.jsx(r,{value:"daily",children:t("admin.repeatDaily")}),e.jsx(r,{value:"weekly",children:t("admin.repeatWeekly")}),e.jsx(r,{value:"monthly",children:t("admin.repeatMonthly")}),e.jsx(r,{value:"yearly",children:t("admin.repeatYearly")}),e.jsx(r,{value:"days_before",children:t("admin.repeatDaysBefore")})]})]})]}),j("repeat_mode")==="weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_weekday",className:"text-sm font-medium",children:"æ¯å‘¨é‡å¤æ—¥ / Weekly on"}),e.jsx(V,{name:"repeat_weekday",control:I,render:({field:s})=>e.jsxs(K,{value:s.value?.toString()||"",onValueChange:n=>s.onChange(n?parseInt(n):null),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:"é€‰æ‹©æ˜ŸæœŸå‡  / Select day"})}),e.jsxs(se,{children:[e.jsx(r,{value:"1",children:"å‘¨ä¸€ / Monday"}),e.jsx(r,{value:"2",children:"å‘¨äºŒ / Tuesday"}),e.jsx(r,{value:"3",children:"å‘¨ä¸‰ / Wednesday"}),e.jsx(r,{value:"4",children:"å‘¨å›› / Thursday"}),e.jsx(r,{value:"5",children:"å‘¨äº” / Friday"}),e.jsx(r,{value:"6",children:"å‘¨å…­ / Saturday"}),e.jsx(r,{value:"0",children:"å‘¨æ—¥ / Sunday"})]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"é€‰æ‹©æ´»åŠ¨æ¯å‘¨ç”Ÿæ•ˆçš„æ—¥æœŸ / Select which day this activity is valid each week"})]}),j("repeat_mode")==="monthly"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx(i,{className:"text-sm font-medium",children:t("admin.repeatMonthDayLabel")}),e.jsx(V,{name:"repeat_month_day",control:I,render:({field:s})=>{const n=s.value||[],A=()=>{const Q=[...n,{start:1,end:1}];s.onChange(Q)},ne=Q=>{const S=n.filter((u,E)=>E!==Q);s.onChange(S.length>0?S:null)},ue=(Q,S,u)=>{const E=n.map((J,le)=>le===Q?{...J,[S]:u}:J);s.onChange(E)};return e.jsxs("div",{className:"space-y-3",children:[n.map((Q,S)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{value:Q.start.toString(),onValueChange:u=>ue(S,"start",parseInt(u)),children:[e.jsx(X,{className:"h-10 w-24",children:e.jsx(ee,{})}),e.jsx(se,{children:Array.from({length:31},(u,E)=>E+1).map(u=>e.jsxs(r,{value:u.toString(),children:[u,"æ—¥"]},u))})]}),e.jsx("span",{className:"text-muted-foreground",children:"â€”"}),e.jsxs(K,{value:Q.end.toString(),onValueChange:u=>ue(S,"end",parseInt(u)),children:[e.jsx(X,{className:"h-10 w-24",children:e.jsx(ee,{})}),e.jsx(se,{children:Array.from({length:31},(u,E)=>E+1).map(u=>e.jsxs(r,{value:u.toString(),children:[u,"æ—¥"]},u))})]}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-destructive hover:text-destructive",onClick:()=>ne(S),children:e.jsx(ms,{className:"h-4 w-4"})})]},S)),e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:A,className:"mt-2",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),t("admin.addDateRange")]})]})}}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.repeatMonthDayHint")})]}),j("repeat_mode")==="yearly"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_yearly_month",className:"text-sm font-medium",children:t("admin.repeatYearlyMonthLabel")}),e.jsx(V,{name:"repeat_yearly_month",control:I,render:({field:s})=>e.jsxs(K,{value:s.value?.toString()||"",onValueChange:n=>s.onChange(n?parseInt(n):null),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:t("admin.repeatYearlyMonthPlaceholder")})}),e.jsxs(se,{children:[e.jsx(r,{value:"1",children:"1æœˆ / January"}),e.jsx(r,{value:"2",children:"2æœˆ / February"}),e.jsx(r,{value:"3",children:"3æœˆ / March"}),e.jsx(r,{value:"4",children:"4æœˆ / April"}),e.jsx(r,{value:"5",children:"5æœˆ / May"}),e.jsx(r,{value:"6",children:"6æœˆ / June"}),e.jsx(r,{value:"7",children:"7æœˆ / July"}),e.jsx(r,{value:"8",children:"8æœˆ / August"}),e.jsx(r,{value:"9",children:"9æœˆ / September"}),e.jsx(r,{value:"10",children:"10æœˆ / October"}),e.jsx(r,{value:"11",children:"11æœˆ / November"}),e.jsx(r,{value:"12",children:"12æœˆ / December"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_yearly_day",className:"text-sm font-medium",children:t("admin.repeatYearlyDayLabel")}),e.jsx(V,{name:"repeat_yearly_day",control:I,render:({field:s})=>e.jsxs(K,{value:s.value?.toString()||"",onValueChange:n=>s.onChange(n?parseInt(n):null),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:t("admin.repeatYearlyDayPlaceholder")})}),e.jsx(se,{children:Array.from({length:31},(n,A)=>A+1).map(n=>e.jsxs(r,{value:n.toString(),children:[n,"æ—¥ / Day ",n]},n))})]})})]}),e.jsx("p",{className:"text-xs text-muted-foreground col-span-2",children:t("admin.repeatYearlyHint")})]}),j("repeat_mode")==="days_before"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_days_before",className:"text-sm font-medium",children:t("admin.daysBeforeLabel")}),e.jsx(V,{name:"repeat_days_before",control:I,render:({field:s})=>e.jsx(_,{type:"number",min:1,max:30,className:"h-11",placeholder:t("admin.daysBeforePlaceholder"),value:s.value??"",onChange:n=>s.onChange(n.target.value?parseInt(n.target.value):null)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.daysBeforeHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"service_type",className:"text-sm font-medium",children:t("admin.serviceType")}),e.jsxs(K,{onValueChange:s=>Z("service_type",s),defaultValue:j("service_type"),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:t("admin.selectServiceType")})}),e.jsxs(se,{children:[e.jsx(r,{value:"dine_in",children:t("activities.serviceType.dine_in")}),e.jsx(r,{value:"takeaway",children:t("activities.serviceType.takeaway")}),e.jsx(r,{value:"both",children:t("activities.serviceType.both")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{className:"text-sm font-medium flex items-center gap-2",children:[j("status")==="draft"?e.jsx(Ye,{className:"w-4 h-4 text-yellow-500"}):e.jsx(Ge,{className:"w-4 h-4 text-green-500"}),"æ´»åŠ¨çŠ¶æ€"]}),e.jsxs(K,{onValueChange:s=>Z("status",s),value:W||"draft",children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(r,{value:"draft",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-4 h-4 text-yellow-500"}),"è‰ç¨¿"]})}),e.jsx(r,{value:"published",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-green-500"}),"å·²å‘å¸ƒ"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:W==="draft"?"è‰ç¨¿çŠ¶æ€ï¼šæ— å¿…å¡«é¡¹ï¼Œä¸æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Œé¤åŽ…ä¸ä¼šæ”¶åˆ°é€šçŸ¥":"å‘å¸ƒæ—¶å°†éªŒè¯å¿…å¡«é¡¹"})]}),e.jsxs("div",{className:pe("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",W==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(je,{id:"pinned",checked:ys,onCheckedChange:s=>Z("pinned",s===!0),className:"data-[state=checked]:bg-primary",disabled:W==="draft"}),e.jsxs(i,{htmlFor:"pinned",className:pe("flex items-center gap-2 text-sm font-medium",W==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(Us,{className:"w-4 h-4 text-primary"}),t("admin.pinToTop")]})]}),e.jsxs("div",{className:pe("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",W==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(je,{id:"visible",checked:ws,onCheckedChange:s=>Z("visible",s===!0),className:"data-[state=checked]:bg-primary",disabled:W==="draft"}),e.jsxs(i,{htmlFor:"visible",className:pe("flex items-center gap-2 text-sm font-medium",W==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(Ve,{className:"w-4 h-4 text-primary"}),"æ˜¾ç¤ºæ´»åŠ¨",W==="draft"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(è‰ç¨¿é»˜è®¤å…³é—­)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Bs,{className:"w-4 h-4 text-primary"}),t("admin.sortOrder")]}),e.jsx(_,{id:"sort_order",type:"number",...R("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),e.jsx(ie,{className:"border-primary/20",children:e.jsxs(re,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(te,{className:"w-5 h-5 text-primary"}),t("admin.form.badgeSettings")]}),e.jsxs(ke,{defaultValue:"zh",className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsxs(B,{value:"zh",children:["ðŸ‡¨ðŸ‡³ ",t("admin.chinese")]}),e.jsxs(B,{value:"en",children:["ðŸ‡¬ðŸ‡§ ",t("admin.english")]}),e.jsxs(B,{value:"pt",children:["ðŸ‡µðŸ‡¹ ",t("admin.portuguese")]})]}),e.jsx(H,{value:"zh",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_zh",className:"text-sm",children:[t("admin.form.badgeText")," (",t("admin.chinese"),") ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(_,{id:"badge_text_zh",...R("badge_text_zh")}),y.badge_text_zh&&e.jsx("p",{className:"text-sm text-destructive",children:y.badge_text_zh.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.form.badgeHint")})]})}),e.jsx(H,{value:"en",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_en",className:"text-sm",children:[t("admin.form.badgeText")," (",t("admin.english"),") ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(_,{id:"badge_text_en",...R("badge_text_en")}),y.badge_text_en&&e.jsx("p",{className:"text-sm text-destructive",children:y.badge_text_en.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.form.badgeHint")})]})}),e.jsx(H,{value:"pt",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_pt",className:"text-sm",children:[t("admin.form.badgeText")," (",t("admin.portuguese"),") ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(_,{id:"badge_text_pt",...R("badge_text_pt")}),y.badge_text_pt&&e.jsx("p",{className:"text-sm text-destructive",children:y.badge_text_pt.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.form.badgeHint")})]})})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(i,{htmlFor:"badge_color",className:"text-sm",children:t("admin.form.badgeColor")}),e.jsx(V,{name:"badge_color",control:I,render:({field:s})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{id:"badge_color",type:"color",value:s.value||"#9b87f5",onChange:n=>s.onChange(n.target.value),className:"w-20 h-11 cursor-pointer"}),e.jsx(_,{value:s.value||"#9b87f5",onChange:n=>s.onChange(n.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t("admin.form.preview"),":"]}),e.jsx(te,{style:{backgroundColor:j("badge_color")||"#9b87f5"},className:"text-white",children:j("badge_text_zh")||j("title_zh")||"Sample"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx(i,{className:"text-sm font-medium flex items-center gap-2 mb-3",children:"ðŸ’° ä¼˜æƒ è®¾ç½® / Discount Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"discount_type",className:"text-sm",children:"æŠ˜æ‰£ç±»åž‹ / Discount Type"}),e.jsx(V,{name:"discount_type",control:I,render:({field:s})=>e.jsxs(K,{value:s.value||"none",onValueChange:n=>s.onChange(n==="none"?null:n),children:[e.jsx(X,{className:"h-11",children:e.jsx(ee,{placeholder:"é€‰æ‹©æŠ˜æ‰£ç±»åž‹"})}),e.jsxs(se,{children:[e.jsx(r,{value:"none",children:"æ— ä¼˜æƒ  / No Discount"}),e.jsx(r,{value:"percentage",children:"ç™¾åˆ†æ¯”æŠ˜æ‰£ / Percentage"}),e.jsx(r,{value:"fixed_amount",children:"å›ºå®šé‡‘é¢ / Fixed Amount"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"discount_value",className:"text-sm",children:["æŠ˜æ‰£å€¼ / Discount Value",j("discount_type")==="percentage"&&" (%)",j("discount_type")==="fixed_amount"&&" (â‚¬)"]}),e.jsx(_,{id:"discount_value",type:"number",step:"0.01",...R("discount_value",{valueAsNumber:!0}),className:"h-11",placeholder:j("discount_type")==="percentage"?"ä¾‹å¦‚: 20 (è¡¨ç¤º8æŠ˜)":"ä¾‹å¦‚: 5 (è¡¨ç¤ºå‡5â‚¬)",disabled:!j("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:j("discount_type")==="percentage"?"è¾“å…¥æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼Œå¦‚ 20 è¡¨ç¤ºæ‰“8æŠ˜ï¼ˆå‡20%ï¼‰":j("discount_type")==="fixed_amount"?"è¾“å…¥å›ºå®šå‡å…é‡‘é¢ï¼ˆæ¬§å…ƒï¼‰":"å…ˆé€‰æ‹©æŠ˜æ‰£ç±»åž‹"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"discount_key",className:"text-sm",children:"æŠ˜æ‰£æ ‡è¯† / Discount Key"}),e.jsx(_,{id:"discount_key",type:"text",...R("discount_key"),className:"h-11",placeholder:"ä¾‹å¦‚: SUMMER2025, VIP_DISCOUNT",disabled:!j("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ç”¨äºŽå¤–éƒ¨ç³»ç»Ÿè¯†åˆ«çš„æŠ˜æ‰£æ ‡è¯†ç¬¦"})]})]})]})]})}),e.jsx(ie,{className:"border-primary/20",children:e.jsxs(re,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Hs,{className:"w-5 h-5 text-primary"}),t("admin.associatedRestaurants")]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:t("admin.searchRestaurants")||"æœç´¢é¤åŽ…...",value:N,onChange:s=>b(s.target.value),className:"pl-9 h-10"}),N&&e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"absolute right-1 top-1/2 -translate-y-1/2 h-7 w-7",onClick:()=>b(""),children:e.jsx(we,{className:"h-3.5 w-3.5"})})]}),e.jsx(ns,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:e.jsxs("div",{className:"space-y-2",children:[ve?.filter(s=>{if(!N.trim())return!0;const n=N.toLowerCase();return s.name?.toLowerCase().includes(n)||s.name_en?.toLowerCase().includes(n)||s.name_pt?.toLowerCase().includes(n)||s.address?.toLowerCase().includes(n)}).map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[e.jsx(je,{id:s.id,checked:v.includes(s.id),onCheckedChange:n=>{g(n?[...v,s.id]:v.filter(A=>A!==s.id))},className:"data-[state=checked]:bg-primary"}),e.jsx(i,{htmlFor:s.id,className:"cursor-pointer flex-1 font-normal",children:s.name}),v.includes(s.id)&&e.jsx(te,{variant:"secondary",className:"text-xs",children:"å·²é€‰"})]},s.id)),ve?.filter(s=>{if(!N.trim())return!0;const n=N.toLowerCase();return s.name?.toLowerCase().includes(n)||s.name_en?.toLowerCase().includes(n)||s.name_pt?.toLowerCase().includes(n)||s.address?.toLowerCase().includes(n)}).length===0&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:t("common.noResults")||"æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é¤åŽ…"})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["å·²é€‰æ‹© ",v.length," ä¸ªé¤åŽ…"]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>F(!1),className:"min-w-[100px]",children:t("common.cancel")}),e.jsx(x,{type:"submit",disabled:P,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:P?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),t("common.saving")]}):t("common.save")})]})]})}),z&&e.jsx(ot,{open:ae,onOpenChange:m,imageFile:z,onCropComplete:Cs})]})]})}const xt=({children:a})=>{const{t:c}=_e(),{data:t,isLoading:q}=tt(),h=at(),[F,k]=o.useState(!1),[f,w]=o.useState("zh"),[p,v]=o.useState(""),[g,N]=o.useState(""),[b,P]=o.useState("");o.useEffect(()=>{t&&(v(t.content_zh),N(t.content_en),P(t.content_pt))},[t]);const L=async()=>{if(t)try{await h.mutateAsync({id:t.id,content_zh:p,content_en:g,content_pt:b}),De({title:c("common.success"),description:c("admin.activityRules.updateSuccess")}),k(!1)}catch{De({title:c("common.error"),description:c("admin.activityRules.updateError"),variant:"destructive"})}};return e.jsxs(Pe,{open:F,onOpenChange:k,children:[e.jsx(Je,{asChild:!0,children:a}),e.jsxs(Re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Le,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(us,{className:"w-5 h-5"}),c("admin.activityRules.editTitle")]})}),q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Se,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ke,{value:f,onValueChange:w,children:[e.jsxs(ze,{className:"grid w-full grid-cols-3",children:[e.jsx(B,{value:"zh",children:c("admin.chinese")}),e.jsx(B,{value:"en",children:c("admin.english")}),e.jsx(B,{value:"pt",children:c("admin.portuguese")})]}),e.jsx(H,{value:"zh",className:"mt-4",children:e.jsx(O,{value:p,onChange:v,placeholder:c("admin.enterContent")})}),e.jsx(H,{value:"en",className:"mt-4",children:e.jsx(O,{value:g,onChange:N,placeholder:"Enter English activity rules..."})}),e.jsx(H,{value:"pt",className:"mt-4",children:e.jsx(O,{value:b,onChange:P,placeholder:"Digite as regras da atividade em portuguÃªs..."})})]})}),e.jsxs(Ze,{children:[e.jsx(x,{variant:"outline",onClick:()=>k(!1),children:c("common.cancel")}),e.jsxs(x,{onClick:L,disabled:h.isPending,children:[h.isPending?e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ps,{className:"w-4 h-4 mr-2"}),c("common.save")]})]})]})]})},ht=({children:a})=>{const{t:c}=_e(),{data:t,isLoading:q}=nt(),h=lt(),[F,k]=o.useState(!1),[f,w]=o.useState("zh"),[p,v]=o.useState(""),[g,N]=o.useState(""),[b,P]=o.useState("");o.useEffect(()=>{t&&(v(t.content_zh),N(t.content_en),P(t.content_pt))},[t]);const L=async()=>{if(t)try{await h.mutateAsync({id:t.id,content_zh:p,content_en:g,content_pt:b}),De({title:c("common.success"),description:c("activities.handbook.updateSuccess")}),k(!1)}catch{De({title:c("common.error"),description:c("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Pe,{open:F,onOpenChange:k,children:[e.jsx(Je,{asChild:!0,children:a}),e.jsxs(Re,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Le,{children:e.jsxs(Ie,{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-5 h-5"}),c("admin.editActivityHandbook")]})}),q?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Se,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ke,{value:f,onValueChange:w,children:[e.jsxs(ze,{className:"grid w-full grid-cols-3",children:[e.jsx(B,{value:"zh",children:c("admin.chinese")}),e.jsx(B,{value:"en",children:c("admin.english")}),e.jsx(B,{value:"pt",children:c("admin.portuguese")})]}),e.jsx(H,{value:"zh",className:"mt-4",children:e.jsx(O,{value:p,onChange:v,placeholder:c("admin.enterContent")})}),e.jsx(H,{value:"en",className:"mt-4",children:e.jsx(O,{value:g,onChange:N,placeholder:"Enter English activity handbook content..."})}),e.jsx(H,{value:"pt",className:"mt-4",children:e.jsx(O,{value:b,onChange:P,placeholder:"Digite o conteÃºdo do manual da atividade em portuguÃªs..."})})]})}),e.jsxs(Ze,{children:[e.jsx(x,{variant:"outline",onClick:()=>k(!1),children:c("common.cancel")}),e.jsxs(x,{onClick:L,disabled:h.isPending,children:[h.isPending?e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ps,{className:"w-4 h-4 mr-2"}),c("common.save")]})]})]})]})},Ft=()=>{const{t:a}=_e(),{toast:c}=$s(),{data:t,isLoading:q}=Gs(),{getLocalizedField:h}=Zs(),F=Js(),k=Ks(),[f,w]=o.useState([]),[p,v]=o.useState(""),[g,N]=o.useState("all"),[b,P]=o.useState({}),[L,ae]=o.useState(""),m=o.useMemo(()=>t?t.filter(l=>{const C=String(h(l,"title")||""),G=String(h(l,"content")||""),U=p===""||C.toLowerCase().includes(p.toLowerCase())||G.toLowerCase().includes(p.toLowerCase()),xe=new Date,ce=new Date(l.start_date),fe=l.end_date?new Date(l.end_date):null,de=fe?fe<xe:!1,ve=!de&&ce<=xe,he=l.status||"published",R=g==="all"||g==="active"&&ve||g==="ended"&&de||g==="pinned"&&l.pinned||g==="draft"&&he==="draft"||g==="published"&&he==="published";return U&&R}):[],[t,p,g,h]),z=()=>{if(!t||t.length===0){c({title:a("common.error"),description:a("admin.noDataToExport"),variant:"destructive"});return}it(t),c({title:a("common.success"),description:a("admin.exportSuccess")})},T=l=>{w(C=>C.includes(l)?C.filter(G=>G!==l):[...C,l])},$=()=>{f.length===m?.length?w([]):w(m?.map(l=>l.id)||[])},Y=()=>{f.length!==0&&(k.mutate(f),w([]))};return q?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.activityManagement")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.manageActivities")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(ht,{children:e.jsxs(x,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(gs,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityHandbook")})]})}),e.jsx(xt,{children:e.jsxs(x,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(us,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.activityRules")})]})}),e.jsxs(x,{variant:"outline",onClick:z,className:"flex-1 sm:flex-initial",children:[e.jsx(Os,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("admin.exportCSV")})]}),e.jsx(ds,{trigger:e.jsxs(x,{className:"flex-1 sm:flex-initial",children:[e.jsx(xs,{className:"mr-2 h-4 w-4"}),a("admin.addActivity")]})})]})]}),e.jsx(ie,{children:e.jsx(re,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(hs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(_,{placeholder:a("admin.searchActivities"),value:p,onChange:l=>v(l.target.value),className:"pl-9"})]})}),e.jsxs(K,{value:g,onValueChange:N,children:[e.jsx(X,{className:"w-[180px]",children:e.jsx(ee,{placeholder:a("admin.filterByStatus")})}),e.jsxs(se,{children:[e.jsx(r,{value:"all",children:a("admin.allStatus")}),e.jsx(r,{value:"draft",children:a("admin.statusDraft")}),e.jsx(r,{value:"published",children:a("admin.statusPublished")}),e.jsx(r,{value:"active",children:a("admin.statusActive")}),e.jsx(r,{value:"ended",children:a("admin.statusEnded")}),e.jsx(r,{value:"pinned",children:a("admin.statusPinned")})]})]})]})})}),f.length>0&&e.jsx(ie,{className:"bg-muted/50",children:e.jsx(re,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:a("admin.selectedCount",{count:f.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(Me,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(x,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),a("admin.batchDelete")]})}),e.jsxs(Be,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(He,{children:[e.jsx(Oe,{children:a("admin.confirmBatchDelete")}),e.jsxs(qe,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.batchDeleteWarning",{count:f.length})}),e.jsx("p",{className:"font-semibold text-destructive",children:a("admin.willDeleteActivities",{count:f.length})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(_,{value:L,onChange:l=>ae(l.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs($e,{children:[e.jsx(We,{onClick:()=>ae(""),children:a("common.cancel")}),e.jsx(Qe,{disabled:L!=="DELETE",onClick:()=>{Y(),ae("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>w([]),className:"flex-1 sm:flex-initial",children:a("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(je,{checked:f.length===m?.length&&m.length>0,onCheckedChange:$}),e.jsx("span",{className:"font-medium",children:a("admin.selectAll")}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",m?.length," ",a("admin.results"),")"]})]}),e.jsx("div",{className:"grid gap-4",children:m?.map(l=>e.jsx(ie,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:e.jsx(je,{checked:f.includes(l.id),onCheckedChange:()=>T(l.id),className:"mt-1"})}),l.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:l.image_url,alt:String(h(l,"title")),className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(Ws,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(Qs,{className:"text-lg md:text-xl",children:h(l,"title")}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.status==="draft"?e.jsxs(te,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(Ye,{className:"w-3 h-3 mr-1"}),"è‰ç¨¿"]}):e.jsxs(te,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(Ge,{className:"w-3 h-3 mr-1"}),"å·²å‘å¸ƒ"]}),!l.visible&&e.jsx(te,{variant:"secondary",children:a("admin.hidden")}),l.pinned&&e.jsx(te,{children:a("activities.pinned")}),(()=>{const C=new Date,G=new Date(l.start_date),U=l.end_date?new Date(l.end_date):null,xe=U?U<C:!1,ce=!xe&&G<=C;return xe?e.jsx(te,{variant:"secondary",children:a("activities.ended")}):ce?e.jsx(te,{children:a("activities.ongoing")}):null})()]})]}),e.jsx(Ys,{className:"line-clamp-2",children:e.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:h(l,"content")}})})]}),e.jsxs(re,{children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(Ce,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-xs sm:text-sm",children:[Fe(new Date(l.start_date),"PPP"),l.end_date&&` - ${Fe(new Date(l.end_date),"PPP")}`]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.status!=="draft"&&e.jsx(x,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsxs(as,{to:`/admin/activity-stats/${l.id}`,children:[e.jsx(qs,{className:"w-4 h-4 mr-1"}),a("admin.stats","ç»Ÿè®¡")]})}),e.jsx(x,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(as,{to:`/activity/${l.id}`,state:{from:"admin"},children:a("admin.view")})}),e.jsx(ds,{activity:l,trigger:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.edit")})}),l.status==="draft"?e.jsxs(Me,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Be,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(He,{children:[e.jsx(Oe,{children:a("admin.confirmDelete")}),e.jsxs(qe,{children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground mt-2",children:h(l,"title")})]})]}),e.jsxs($e,{children:[e.jsx(We,{children:a("common.cancel")}),e.jsx(Qe,{onClick:()=>F.mutate(l.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]}):e.jsxs(Me,{children:[e.jsx(Ue,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:a("common.delete")})}),e.jsxs(Be,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(He,{children:[e.jsx(Oe,{children:a("admin.confirmDelete")}),e.jsxs(qe,{className:"space-y-3",children:[e.jsx("p",{children:a("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground",children:h(l,"title")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:a("admin.typeDeleteToConfirmBatch")}),e.jsx(_,{value:b[l.id]||"",onChange:C=>P({...b,[l.id]:C.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs($e,{children:[e.jsx(We,{onClick:()=>P({...b,[l.id]:""}),children:a("common.cancel")}),e.jsx(Qe,{disabled:b[l.id]!=="DELETE",onClick:()=>{F.mutate(l.id),P({...b,[l.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]})]})]})]})]})},l.id))})]})};export{Ft as default};
//# sourceMappingURL=AdminActivities-QMOL11sG.js.map
