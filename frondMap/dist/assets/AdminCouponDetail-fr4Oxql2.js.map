{"version":3,"file":"AdminCouponDetail-fr4Oxql2.js","sources":["../../node_modules/lucide-react/dist/esm/icons/code.js","../../src/components/admin/ManageTemplateActivitiesDialog.tsx","../../src/components/admin/EditCouponCodeDialog.tsx","../../src/components/admin/BatchEditCouponStatusDialog.tsx","../../src/pages/admin/AdminCouponDetail.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.462.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Code = createLucideIcon(\"Code\", [\n  [\"polyline\", { points: \"16 18 22 12 16 6\", key: \"z7tu5w\" }],\n  [\"polyline\", { points: \"8 6 2 12 8 18\", key: \"1eg1df\" }]\n]);\n\nexport { Code as default };\n//# sourceMappingURL=code.js.map\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Loader2, Link, Unlink } from \"lucide-react\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { \r\n  useTemplateActivities, \r\n  useAddTemplateActivity, \r\n  useRemoveTemplateActivity \r\n} from \"@/hooks/useCoupons\";\r\nimport { format } from \"date-fns\";\r\n\r\ninterface ManageTemplateActivitiesDialogProps {\r\n  templateId: string;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nexport const ManageTemplateActivitiesDialog = ({ \r\n  templateId, \r\n  children \r\n}: ManageTemplateActivitiesDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  // 获取当前关联的活动\r\n  const { data: templateActivities, isLoading: loadingTemplateActivities } = \r\n    useTemplateActivities(templateId);\r\n\r\n  // 获取所有可见的活动\r\n  const { data: allActivities, isLoading: loadingAllActivities } = useQuery({\r\n    queryKey: [\"allActivitiesForCoupon\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"id, title_zh, title_en, title_pt, start_date, end_date, visible\")\r\n        .eq(\"visible\", true)\r\n        .order(\"start_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    enabled: open,\r\n  });\r\n\r\n  const addTemplateActivity = useAddTemplateActivity();\r\n  const removeTemplateActivity = useRemoveTemplateActivity();\r\n\r\n  const linkedActivityIds = new Set(\r\n    templateActivities?.map(ta => ta.activity_id) || []\r\n  );\r\n\r\n  const handleToggleActivity = async (activityId: string, isLinked: boolean) => {\r\n    if (isLinked) {\r\n      await removeTemplateActivity.mutateAsync({\r\n        templateId,\r\n        activityId,\r\n      });\r\n    } else {\r\n      await addTemplateActivity.mutateAsync({\r\n        templateId,\r\n        activityId,\r\n      });\r\n    }\r\n  };\r\n\r\n  const isLoading = loadingTemplateActivities || loadingAllActivities;\r\n  const isPending = addTemplateActivity.isPending || removeTemplateActivity.isPending;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {children || (\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Link className=\"w-4 h-4 mr-2\" />\r\n            管理关联活动\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-2xl max-h-[80vh] flex flex-col\">\r\n        <DialogHeader>\r\n          <DialogTitle>管理关联活动</DialogTitle>\r\n          <DialogDescription>\r\n            选择要关联到此优惠券模板的活动。一个优惠券可以关联多个活动。\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"flex-1 pr-4\">\r\n          {isLoading ? (\r\n            <div className=\"flex justify-center py-8\">\r\n              <Loader2 className=\"w-6 h-6 animate-spin\" />\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-2\">\r\n              {allActivities && allActivities.length > 0 ? (\r\n                allActivities.map((activity) => {\r\n                  const isLinked = linkedActivityIds.has(activity.id);\r\n                  return (\r\n                    <div\r\n                      key={activity.id}\r\n                      className=\"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors\"\r\n                    >\r\n                      <div className=\"flex items-center gap-3 flex-1\">\r\n                        <Checkbox\r\n                          checked={isLinked}\r\n                          onCheckedChange={() => handleToggleActivity(activity.id, isLinked)}\r\n                          disabled={isPending}\r\n                        />\r\n                        <div className=\"flex-1\">\r\n                          <p className=\"font-medium\">\r\n                            {getLocalizedField(activity, \"title\")}\r\n                          </p>\r\n                          <p className=\"text-xs text-muted-foreground\">\r\n                            {format(new Date(activity.start_date), \"yyyy-MM-dd\")}\r\n                            {activity.end_date && ` ~ ${format(new Date(activity.end_date), \"yyyy-MM-dd\")}`}\r\n                          </p>\r\n                        </div>\r\n                      </div>\r\n                      {isLinked && (\r\n                        <Badge variant=\"secondary\" className=\"ml-2\">\r\n                          <Link className=\"w-3 h-3 mr-1\" />\r\n                          已关联\r\n                        </Badge>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })\r\n              ) : (\r\n                <div className=\"text-center py-8 text-muted-foreground\">\r\n                  暂无可关联的活动\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </ScrollArea>\r\n\r\n        <div className=\"flex justify-between items-center pt-4 border-t\">\r\n          <p className=\"text-sm text-muted-foreground\">\r\n            已关联 {linkedActivityIds.size} 个活动\r\n          </p>\r\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n            关闭\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\ninterface EditCouponCodeDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  couponCode: {\r\n    id: string;\r\n    code: string;\r\n    usage_limit: number;\r\n    is_active: boolean;\r\n    user_coupons?: Array<{\r\n      id: string;\r\n      used_at: string | null;\r\n    }>;\r\n  };\r\n  onSuccess: () => void;\r\n}\r\n\r\ntype CouponStatus = \"available\" | \"used\" | \"expired\";\r\n\r\ninterface FormData {\r\n  usage_limit: number;\r\n  status: CouponStatus;\r\n}\r\n\r\nexport function EditCouponCodeDialog({\r\n  open,\r\n  onOpenChange,\r\n  couponCode,\r\n  onSuccess,\r\n}: EditCouponCodeDialogProps) {\r\n  const { t } = useTranslation();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  // Determine initial status based on coupon state\r\n  const getInitialStatus = (): CouponStatus => {\r\n    if (!couponCode.is_active) return \"expired\";\r\n    const hasUsedCoupons = couponCode.user_coupons?.some(uc => uc.used_at);\r\n    if (hasUsedCoupons) return \"used\";\r\n    return \"available\";\r\n  };\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    watch,\r\n    setValue,\r\n    reset,\r\n    formState: { errors },\r\n  } = useForm<FormData>({\r\n    defaultValues: {\r\n      usage_limit: couponCode.usage_limit,\r\n      status: getInitialStatus(),\r\n    },\r\n  });\r\n\r\n  // Reset form when couponCode changes\r\n  useEffect(() => {\r\n    reset({\r\n      usage_limit: couponCode.usage_limit,\r\n      status: getInitialStatus(),\r\n    });\r\n  }, [couponCode, reset]);\r\n\r\n  const currentStatus = watch(\"status\");\r\n\r\n  const onSubmit = async (data: FormData) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      // Update coupon_codes table\r\n      const { error: codeError } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .update({\r\n          usage_limit: data.usage_limit,\r\n          is_active: data.status !== \"expired\",\r\n        })\r\n        .eq(\"id\", couponCode.id);\r\n\r\n      if (codeError) throw codeError;\r\n\r\n      // Handle user_coupons updates based on status\r\n      if (couponCode.user_coupons && couponCode.user_coupons.length > 0) {\r\n        if (data.status === \"used\") {\r\n          // Mark all user_coupons as used\r\n          const { error: userCouponError } = await supabase\r\n            .from(\"user_coupons\")\r\n            .update({ used_at: new Date().toISOString() })\r\n            .eq(\"coupon_code_id\", couponCode.id)\r\n            .is(\"used_at\", null);\r\n\r\n          if (userCouponError) throw userCouponError;\r\n        } else if (data.status === \"available\") {\r\n          // Clear used_at for all user_coupons (reset to available)\r\n          const { error: userCouponError } = await supabase\r\n            .from(\"user_coupons\")\r\n            .update({ used_at: null })\r\n            .eq(\"coupon_code_id\", couponCode.id);\r\n\r\n          if (userCouponError) throw userCouponError;\r\n        }\r\n        // For \"expired\" status, we don't change used_at\r\n      }\r\n\r\n      toast.success(t(\"admin.couponCode.updateSuccess\"));\r\n      onSuccess();\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error(\"Error updating coupon code:\", error);\r\n      toast.error(t(\"admin.couponCode.updateError\"));\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[425px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"admin.couponCode.editTitle\")}</DialogTitle>\r\n          <DialogDescription>\r\n            {t(\"admin.couponCode.editDescription\")}: <code className=\"font-mono font-semibold\">{couponCode.code}</code>\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"usage_limit\">{t(\"admin.couponCode.usageLimit\")}</Label>\r\n            <Input\r\n              id=\"usage_limit\"\r\n              type=\"number\"\r\n              min=\"1\"\r\n              {...register(\"usage_limit\", {\r\n                required: t(\"admin.couponCode.usageLimitRequired\"),\r\n                min: { value: 1, message: t(\"admin.couponCode.usageLimitMin\") },\r\n                valueAsNumber: true,\r\n              })}\r\n            />\r\n            {errors.usage_limit && (\r\n              <p className=\"text-sm text-destructive\">{errors.usage_limit.message}</p>\r\n            )}\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {t(\"admin.couponCode.usageLimitHint\")}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n            <Label>{t(\"admin.couponCode.status\")}</Label>\r\n            <Select\r\n              value={currentStatus}\r\n              onValueChange={(value: CouponStatus) => setValue(\"status\", value)}\r\n            >\r\n              <SelectTrigger>\r\n                <SelectValue placeholder={t(\"admin.couponCode.selectStatus\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"available\">{t(\"admin.couponCode.statusAvailable\")}</SelectItem>\r\n                <SelectItem value=\"used\">{t(\"admin.couponCode.statusUsed\")}</SelectItem>\r\n                <SelectItem value=\"expired\">{t(\"admin.couponCode.statusExpired\")}</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {currentStatus === \"available\" && t(\"admin.couponCode.statusAvailableHint\")}\r\n              {currentStatus === \"used\" && t(\"admin.couponCode.statusUsedHint\")}\r\n              {currentStatus === \"expired\" && t(\"admin.couponCode.statusExpiredHint\")}\r\n            </p>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={() => onOpenChange(false)}\r\n              disabled={isSubmitting}\r\n            >\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button type=\"submit\" disabled={isSubmitting}>\r\n              {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n              {t(\"common.save\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Loader2 } from \"lucide-react\";\r\n\r\ninterface BatchEditCouponStatusDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  selectedCodeIds: string[];\r\n  onSuccess: () => void;\r\n}\r\n\r\ntype CouponStatus = \"available\" | \"used\" | \"expired\";\r\n\r\nexport function BatchEditCouponStatusDialog({\r\n  open,\r\n  onOpenChange,\r\n  selectedCodeIds,\r\n  onSuccess,\r\n}: BatchEditCouponStatusDialogProps) {\r\n  const { t } = useTranslation();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [status, setStatus] = useState<CouponStatus>(\"available\");\r\n\r\n  const handleSubmit = async () => {\r\n    if (selectedCodeIds.length === 0) return;\r\n    \r\n    setIsSubmitting(true);\r\n    try {\r\n      // Update coupon_codes table\r\n      const { error: codeError } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .update({\r\n          is_active: status !== \"expired\",\r\n        })\r\n        .in(\"id\", selectedCodeIds);\r\n\r\n      if (codeError) throw codeError;\r\n\r\n      // Handle user_coupons updates based on status\r\n      if (status === \"used\") {\r\n        // Mark all user_coupons as used for selected codes\r\n        const { error: userCouponError } = await supabase\r\n          .from(\"user_coupons\")\r\n          .update({ used_at: new Date().toISOString() })\r\n          .in(\"coupon_code_id\", selectedCodeIds)\r\n          .is(\"used_at\", null);\r\n\r\n        if (userCouponError) throw userCouponError;\r\n      } else if (status === \"available\") {\r\n        // Clear used_at for all user_coupons (reset to available)\r\n        const { error: userCouponError } = await supabase\r\n          .from(\"user_coupons\")\r\n          .update({ used_at: null })\r\n          .in(\"coupon_code_id\", selectedCodeIds);\r\n\r\n        if (userCouponError) throw userCouponError;\r\n      }\r\n      // For \"expired\" status, we don't change used_at\r\n\r\n      toast.success(t(\"admin.couponCode.batchUpdateSuccess\", { count: selectedCodeIds.length }));\r\n      onSuccess();\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error(\"Error batch updating coupon codes:\", error);\r\n      toast.error(t(\"admin.couponCode.batchUpdateError\"));\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[425px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"admin.couponCode.batchEditTitle\")}</DialogTitle>\r\n          <DialogDescription>\r\n            {t(\"admin.couponCode.batchEditDescription\", { count: selectedCodeIds.length })}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 py-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label>{t(\"admin.couponCode.status\")}</Label>\r\n            <Select\r\n              value={status}\r\n              onValueChange={(value: CouponStatus) => setStatus(value)}\r\n            >\r\n              <SelectTrigger>\r\n                <SelectValue placeholder={t(\"admin.couponCode.selectStatus\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"available\">{t(\"admin.couponCode.statusAvailable\")}</SelectItem>\r\n                <SelectItem value=\"used\">{t(\"admin.couponCode.statusUsed\")}</SelectItem>\r\n                <SelectItem value=\"expired\">{t(\"admin.couponCode.statusExpired\")}</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {status === \"available\" && t(\"admin.couponCode.statusAvailableHint\")}\r\n              {status === \"used\" && t(\"admin.couponCode.statusUsedHint\")}\r\n              {status === \"expired\" && t(\"admin.couponCode.statusExpiredHint\")}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <DialogFooter>\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            onClick={() => onOpenChange(false)}\r\n            disabled={isSubmitting}\r\n          >\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button onClick={handleSubmit} disabled={isSubmitting}>\r\n            {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n            {t(\"admin.couponCode.batchUpdate\")}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useQuery, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useParams, useNavigate, Link } from \"react-router-dom\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useState, useMemo } from \"react\";\r\n\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Ticket, Calendar, Code, ArrowLeft, User, Search, Pencil, Trash2, CheckSquare, Square, History, Store } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport type { CouponTemplate } from \"@/hooks/useCoupons\";\r\nimport { useTemplateActivities, useTemplateUsageHistory } from \"@/hooks/useCoupons\";\r\nimport { ManageTemplateActivitiesDialog } from \"@/components/admin/ManageTemplateActivitiesDialog\";\r\nimport { EditCouponCodeDialog } from \"@/components/admin/EditCouponCodeDialog\";\r\nimport { BatchEditCouponStatusDialog } from \"@/components/admin/BatchEditCouponStatusDialog\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CouponCodeWithUser {\r\n  id: string;\r\n  code: string;\r\n  template_id: string;\r\n  usage_limit: number;\r\n  used_count: number;\r\n  is_active: boolean;\r\n  created_at: string;\r\n  updated_at: string;\r\n  user_coupons: Array<{\r\n    id: string;\r\n    user_id: string;\r\n    claimed_at: string;\r\n    used_at: string | null;\r\n    source: string | null;\r\n    profiles: {\r\n      id: string;\r\n      display_name: string;\r\n      avatar_url: string | null;\r\n    };\r\n    used_by_merchant?: {\r\n      display_name: string;\r\n      avatar_url: string | null;\r\n    };\r\n    used_at_restaurant?: {\r\n      name: string;\r\n      name_en: string | null;\r\n      name_pt: string | null;\r\n    };\r\n  }>;\r\n}\r\n\r\nconst AdminCouponDetail = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const queryClient = useQueryClient();\r\n  \r\n  // 搜索和过滤状态\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<\"all\" | \"active\" | \"inactive\">(\"all\");\r\n  const [usageFilter, setUsageFilter] = useState<\"all\" | \"unclaimed\" | \"claimed\" | \"used\">(\"all\");\r\n  const [sourceFilter, setSourceFilter] = useState<\"all\" | \"share\" | \"other\">(\"all\");\r\n  \r\n  // 编辑和删除对话框状态\r\n  const [editingCode, setEditingCode] = useState<CouponCodeWithUser | null>(null);\r\n  const [deletingCodeId, setDeletingCodeId] = useState<string | null>(null);\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n  \r\n  // 批量选择状态\r\n  const [selectedCodes, setSelectedCodes] = useState<Set<string>>(new Set());\r\n  const [showBatchEditDialog, setShowBatchEditDialog] = useState(false);\r\n  const [showBatchDeleteDialog, setShowBatchDeleteDialog] = useState(false);\r\n  const [isBatchDeleting, setIsBatchDeleting] = useState(false);\r\n\r\n  // 获取优惠券模板信息\r\n  const { data: template, isLoading: templateLoading } = useQuery({\r\n    queryKey: [\"couponTemplate\", id],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"coupon_templates\")\r\n        .select(\"*\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data as CouponTemplate;\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // 获取关联的活动列表\r\n  const { data: templateActivities, isLoading: activitiesLoading } = useTemplateActivities(id!);\r\n\r\n  // 获取使用历史记录\r\n  const { data: usageHistory, isLoading: historyLoading } = useTemplateUsageHistory(id!);\r\n\r\n  // 获取此模板生成的所有子优惠券及用户信息\r\n  const { data: couponCodes, isLoading: codesLoading } = useQuery({\r\n    queryKey: [\"templateCouponCodes\", id],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .select(`\r\n          *,\r\n          user_coupons(\r\n            id,\r\n            user_id,\r\n            claimed_at,\r\n            used_at,\r\n            source\r\n          )\r\n        `)\r\n        .eq(\"template_id\", id)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      \r\n      // 获取所有 coupon_code_id 用于查询使用历史\r\n      const codeIds = (data || []).map((c: any) => c.id);\r\n      \r\n      // 获取使用历史以获取核销商家信息\r\n      const { data: usageHistoryData } = await supabase\r\n        .from(\"coupon_usage_history\")\r\n        .select(\"user_coupon_id, used_by_user_id, restaurant_id\")\r\n        .in(\"coupon_code_id\", codeIds);\r\n      \r\n      // 获取核销商家的 profile 信息\r\n      const merchantUserIds = [...new Set((usageHistoryData || []).map(h => h.used_by_user_id))];\r\n      const { data: merchantProfiles } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name, avatar_url\")\r\n        .in(\"id\", merchantUserIds);\r\n      \r\n      const merchantProfilesMap = (merchantProfiles || []).reduce((acc, p) => {\r\n        acc[p.id] = { display_name: p.display_name, avatar_url: p.avatar_url };\r\n        return acc;\r\n      }, {} as Record<string, { display_name: string; avatar_url: string | null }>);\r\n      \r\n      // 获取餐厅信息\r\n      const restaurantIds = [...new Set((usageHistoryData || []).filter(h => h.restaurant_id).map(h => h.restaurant_id as string))];\r\n      let restaurantsMap: Record<string, { name: string; name_en: string | null; name_pt: string | null }> = {};\r\n      if (restaurantIds.length > 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name, name_en, name_pt\")\r\n          .in(\"id\", restaurantIds);\r\n        restaurantsMap = (restaurants || []).reduce((acc, r) => {\r\n          acc[r.id] = { name: r.name, name_en: r.name_en, name_pt: r.name_pt };\r\n          return acc;\r\n        }, {} as Record<string, { name: string; name_en: string | null; name_pt: string | null }>);\r\n      }\r\n      \r\n      // 创建 user_coupon_id 到使用历史的映射\r\n      const usageByUserCouponId = (usageHistoryData || []).reduce((acc, h) => {\r\n        if (h.user_coupon_id) {\r\n          acc[h.user_coupon_id] = {\r\n            used_by_merchant: merchantProfilesMap[h.used_by_user_id] || null,\r\n            used_at_restaurant: h.restaurant_id ? restaurantsMap[h.restaurant_id] || null : null,\r\n          };\r\n        }\r\n        return acc;\r\n      }, {} as Record<string, { used_by_merchant: { display_name: string; avatar_url: string | null } | null; used_at_restaurant: { name: string; name_en: string | null; name_pt: string | null } | null }>);\r\n      \r\n      // Fetch profile information for each user_coupon\r\n      const codesWithProfiles = await Promise.all(\r\n        (data || []).map(async (code: any) => {\r\n          const userCouponsWithProfiles = await Promise.all(\r\n            (code.user_coupons || []).map(async (userCoupon: any) => {\r\n              // 如果 user_id 为 null（直接核销的情况），不查询 profile\r\n              if (!userCoupon.user_id) {\r\n                return {\r\n                  ...userCoupon,\r\n                  profiles: { id: \"\", display_name: \"Unknown\", avatar_url: null },\r\n                  ...usageByUserCouponId[userCoupon.id],\r\n                };\r\n              }\r\n              \r\n              const { data: profile } = await supabase\r\n                .from(\"profiles\")\r\n                .select(\"id, display_name, avatar_url\")\r\n                .eq(\"id\", userCoupon.user_id)\r\n                .maybeSingle();\r\n              \r\n              return {\r\n                ...userCoupon,\r\n                profiles: profile || { id: userCoupon.user_id, display_name: \"Unknown\", avatar_url: null },\r\n                ...usageByUserCouponId[userCoupon.id],\r\n              };\r\n            })\r\n          );\r\n          \r\n          return {\r\n            ...code,\r\n            user_coupons: userCouponsWithProfiles\r\n          };\r\n        })\r\n      );\r\n      \r\n      return codesWithProfiles as CouponCodeWithUser[];\r\n    },\r\n    enabled: !!id,\r\n  });\r\n\r\n  // 过滤优惠券 - Must be before any conditional returns\r\n  const filteredCouponCodes = useMemo(() => {\r\n    if (!couponCodes) return [];\r\n    \r\n    return couponCodes.filter((code) => {\r\n      // 搜索过滤：优惠券代码或用户名\r\n      const searchLower = searchQuery.toLowerCase();\r\n      const matchesSearch = \r\n        searchQuery === \"\" ||\r\n        code.code.toLowerCase().includes(searchLower) ||\r\n        code.user_coupons.some((uc) => \r\n          uc.profiles.display_name.toLowerCase().includes(searchLower)\r\n        );\r\n      \r\n      // 状态过滤\r\n      const matchesStatus = \r\n        statusFilter === \"all\" ||\r\n        (statusFilter === \"active\" && code.is_active) ||\r\n        (statusFilter === \"inactive\" && !code.is_active);\r\n      \r\n      // 使用状态过滤\r\n      const matchesUsage = \r\n        usageFilter === \"all\" ||\r\n        (usageFilter === \"unclaimed\" && code.user_coupons.length === 0) ||\r\n        (usageFilter === \"claimed\" && code.user_coupons.length > 0 && code.user_coupons.every(uc => !uc.used_at)) ||\r\n        (usageFilter === \"used\" && code.user_coupons.some(uc => uc.used_at));\r\n      \r\n      // 来源过滤\r\n      const matchesSource = \r\n        sourceFilter === \"all\" ||\r\n        (sourceFilter === \"share\" && code.user_coupons.some(uc => uc.source === \"share\")) ||\r\n        (sourceFilter === \"other\" && code.user_coupons.some(uc => uc.source !== \"share\"));\r\n      \r\n      return matchesSearch && matchesStatus && matchesUsage && matchesSource;\r\n    });\r\n  }, [couponCodes, searchQuery, statusFilter, usageFilter, sourceFilter]);\r\n\r\n  const totalGenerated = couponCodes?.length || 0;\r\n  const totalUsed = couponCodes?.reduce((sum, code) => sum + code.used_count, 0) || 0;\r\n  const totalClaimed = couponCodes?.reduce((sum, code) => sum + code.user_coupons.length, 0) || 0;\r\n\r\n  // 批量选择功能\r\n  const handleToggleSelect = (codeId: string) => {\r\n    setSelectedCodes(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(codeId)) {\r\n        newSet.delete(codeId);\r\n      } else {\r\n        newSet.add(codeId);\r\n      }\r\n      return newSet;\r\n    });\r\n  };\r\n\r\n  const handleSelectAll = () => {\r\n    if (selectedCodes.size === filteredCouponCodes.length) {\r\n      setSelectedCodes(new Set());\r\n    } else {\r\n      setSelectedCodes(new Set(filteredCouponCodes.map(code => code.id)));\r\n    }\r\n  };\r\n\r\n  const handleBatchEditSuccess = () => {\r\n    setSelectedCodes(new Set());\r\n    queryClient.invalidateQueries({ queryKey: [\"templateCouponCodes\", id] });\r\n  };\r\n\r\n  const handleBatchDelete = async () => {\r\n    if (selectedCodes.size === 0) return;\r\n    \r\n    setIsBatchDeleting(true);\r\n    try {\r\n      const selectedIds = Array.from(selectedCodes);\r\n      \r\n      // 先删除关联的 user_coupons\r\n      const { error: userCouponsError } = await supabase\r\n        .from(\"user_coupons\")\r\n        .delete()\r\n        .in(\"coupon_code_id\", selectedIds);\r\n\r\n      if (userCouponsError) throw userCouponsError;\r\n\r\n      // 再删除 coupon_codes\r\n      const { error } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .delete()\r\n        .in(\"id\", selectedIds);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(t(\"admin.couponCode.batchDeleteSuccess\", { count: selectedIds.length }));\r\n      setSelectedCodes(new Set());\r\n      queryClient.invalidateQueries({ queryKey: [\"templateCouponCodes\", id] });\r\n      setShowBatchDeleteDialog(false);\r\n    } catch (error) {\r\n      console.error(\"Error batch deleting coupon codes:\", error);\r\n      toast.error(t(\"admin.couponCode.batchDeleteError\"));\r\n    } finally {\r\n      setIsBatchDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteCouponCode = async (codeId: string) => {\r\n    setIsDeleting(true);\r\n    try {\r\n      // 先删除关联的 user_coupons\r\n      const { error: userCouponsError } = await supabase\r\n        .from(\"user_coupons\")\r\n        .delete()\r\n        .eq(\"coupon_code_id\", codeId);\r\n\r\n      if (userCouponsError) throw userCouponsError;\r\n\r\n      // 再删除 coupon_code\r\n      const { error } = await supabase\r\n        .from(\"coupon_codes\")\r\n        .delete()\r\n        .eq(\"id\", codeId);\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(\"子优惠券已删除\");\r\n      queryClient.invalidateQueries({ queryKey: [\"templateCouponCodes\", id] });\r\n      setDeletingCodeId(null);\r\n    } catch (error) {\r\n      console.error(\"Error deleting coupon code:\", error);\r\n      toast.error(\"删除失败\");\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  if (templateLoading) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"text-center py-12\">加载中...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!template) {\r\n    return (\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"text-center py-12\">\r\n          <p className=\"text-muted-foreground mb-4\">优惠券模板不存在</p>\r\n          <Button onClick={() => navigate(\"/admin/coupons\")}>返回列表</Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"container mx-auto px-4 py-8\">\r\n        <div className=\"mb-6\">\r\n          <Button\r\n            variant=\"ghost\"\r\n            onClick={() => navigate(\"/admin/coupons\")}\r\n            className=\"mb-4\"\r\n          >\r\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\r\n            返回列表\r\n          </Button>\r\n          <h1 className=\"text-3xl font-bold flex items-center gap-2\">\r\n            <Ticket className=\"w-8 h-8\" />\r\n            优惠券模板详情\r\n          </h1>\r\n        </div>\r\n\r\n        <div className=\"space-y-6\">\r\n          {/* 模板基本信息 */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg\">模板信息</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex-1\">\r\n                  <p className=\"text-sm text-muted-foreground mb-2\">关联活动</p>\r\n                  {activitiesLoading ? (\r\n                    <p className=\"text-sm\">加载中...</p>\r\n                  ) : templateActivities && templateActivities.length > 0 ? (\r\n                    <div className=\"space-y-2\">\r\n                      {templateActivities.map((ta: any) => (\r\n                        <Link\r\n                          key={ta.activity_id}\r\n                          to={`/activity/${ta.activity_id}`}\r\n                          className=\"block text-primary hover:underline\"\r\n                        >\r\n                          {getLocalizedField(ta.activities, \"title\")}\r\n                        </Link>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    <p className=\"text-sm text-muted-foreground\">未关联任何活动</p>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex gap-2 items-start\">\r\n                  <ManageTemplateActivitiesDialog templateId={id!} />\r\n                  {!template.visible && <Badge variant=\"secondary\">已隐藏</Badge>}\r\n                  {!template.is_active && <Badge variant=\"secondary\">未激活</Badge>}\r\n                  {template.is_active && <Badge>已激活</Badge>}\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              <div>\r\n                <p className=\"text-sm text-muted-foreground mb-2\">标题</p>\r\n                <div className=\"space-y-1\">\r\n                  <p>\r\n                    <span className=\"text-xs text-muted-foreground\">中文：</span>\r\n                    {template.title_zh}\r\n                  </p>\r\n                  <p>\r\n                    <span className=\"text-xs text-muted-foreground\">English：</span>\r\n                    {template.title_en}\r\n                  </p>\r\n                  <p>\r\n                    <span className=\"text-xs text-muted-foreground\">Português：</span>\r\n                    {template.title_pt}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              {(template.description_zh ||\r\n                template.description_en ||\r\n                template.description_pt) && (\r\n                <>\r\n                  <Separator />\r\n                  <div>\r\n                    <p className=\"text-sm text-muted-foreground mb-2\">描述</p>\r\n                    <div className=\"space-y-1 text-sm\">\r\n                      {template.description_zh && (\r\n                        <p>\r\n                          <span className=\"text-xs text-muted-foreground\">中文：</span>\r\n                          {template.description_zh}\r\n                        </p>\r\n                      )}\r\n                      {template.description_en && (\r\n                        <p>\r\n                          <span className=\"text-xs text-muted-foreground\">English：</span>\r\n                          {template.description_en}\r\n                        </p>\r\n                      )}\r\n                      {template.description_pt && (\r\n                        <p>\r\n                          <span className=\"text-xs text-muted-foreground\">Português：</span>\r\n                          {template.description_pt}\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </>\r\n              )}\r\n\r\n              <Separator />\r\n\r\n              <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm\">\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">折扣类型</p>\r\n                  <p className=\"font-medium\">\r\n                    {template.discount_type === \"percentage\" ? \"百分比折扣\" : \"固定金额\"}\r\n                  </p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">折扣值</p>\r\n                  <p className=\"font-medium text-primary text-lg\">\r\n                    {template.discount_type === \"percentage\"\r\n                      ? `${template.discount_value}%`\r\n                      : `€${template.discount_value}`}\r\n                  </p>\r\n                </div>\r\n                {template.min_order_amount && template.min_order_amount > 0 && (\r\n                  <div>\r\n                    <p className=\"text-muted-foreground\">最低消费</p>\r\n                    <p className=\"font-medium\">€{template.min_order_amount}</p>\r\n                  </div>\r\n                )}\r\n                {template.max_discount_amount && template.max_discount_amount > 0 && (\r\n                  <div>\r\n                    <p className=\"text-muted-foreground\">最高折扣</p>\r\n                    <p className=\"font-medium\">€{template.max_discount_amount}</p>\r\n                  </div>\r\n                )}\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">已生成</p>\r\n                  <p className=\"font-medium\">{totalGenerated} 张</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">已领取</p>\r\n                  <p className=\"font-medium\">{totalClaimed} 次</p>\r\n                </div>\r\n                <div>\r\n                  <p className=\"text-muted-foreground\">已使用</p>\r\n                  <p className=\"font-medium\">{totalUsed} 次</p>\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n                  <div>\r\n                    <p className=\"text-muted-foreground\">有效期</p>\r\n                    <p className=\"font-medium\">\r\n                      {format(new Date(template.valid_from), \"yyyy-MM-dd\")}\r\n                      {template.valid_until\r\n                        ? ` - ${format(new Date(template.valid_until), \"yyyy-MM-dd\")}`\r\n                        : \" - 无限期\"}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* 已生成的子优惠券列表 */}\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"space-y-4\">\r\n                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                  <Code className=\"h-4 w-4\" />\r\n                  已生成的子优惠券 ({totalGenerated})\r\n                </CardTitle>\r\n                \r\n                {/* 搜索和过滤 */}\r\n                {couponCodes && couponCodes.length > 0 && (\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                    <div className=\"relative\">\r\n                      <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                      <Input\r\n                        placeholder=\"搜索优惠券代码或用户名\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className=\"pl-9\"\r\n                      />\r\n                    </div>\r\n                    \r\n                    <Select value={statusFilter} onValueChange={(value: any) => setStatusFilter(value)}>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"状态\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"all\">全部状态</SelectItem>\r\n                        <SelectItem value=\"active\">已激活</SelectItem>\r\n                        <SelectItem value=\"inactive\">已停用</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    \r\n                    <Select value={usageFilter} onValueChange={(value: any) => setUsageFilter(value)}>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"使用状态\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"all\">全部</SelectItem>\r\n                        <SelectItem value=\"unclaimed\">未领取</SelectItem>\r\n                        <SelectItem value=\"claimed\">已领取未使用</SelectItem>\r\n                        <SelectItem value=\"used\">已使用</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    \r\n                    <Select value={sourceFilter} onValueChange={(value: any) => setSourceFilter(value)}>\r\n                      <SelectTrigger>\r\n                        <SelectValue placeholder=\"来源\" />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"all\">全部来源</SelectItem>\r\n                        <SelectItem value=\"share\">分享</SelectItem>\r\n                        <SelectItem value=\"other\">其他</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {codesLoading ? (\r\n                <p className=\"text-sm text-muted-foreground\">加载中...</p>\r\n              ) : !couponCodes || couponCodes.length === 0 ? (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  暂无生成的优惠券，用户分享后将自动生成\r\n                </p>\r\n              ) : filteredCouponCodes.length === 0 ? (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  没有符合筛选条件的优惠券\r\n                </p>\r\n              ) : (\r\n                <div className=\"space-y-4\">\r\n                  {/* 批量操作栏 */}\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-4\">\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <Checkbox\r\n                          id=\"selectAll\"\r\n                          checked={selectedCodes.size === filteredCouponCodes.length && filteredCouponCodes.length > 0}\r\n                          onCheckedChange={handleSelectAll}\r\n                        />\r\n                        <label htmlFor=\"selectAll\" className=\"text-sm cursor-pointer\">\r\n                          {t(\"admin.couponCode.selectAll\")}\r\n                        </label>\r\n                      </div>\r\n                      {selectedCodes.size > 0 && (\r\n                        <span className=\"text-sm text-muted-foreground\">\r\n                          {t(\"admin.couponCode.selectedCount\", { count: selectedCodes.size })}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    <div className=\"flex items-center gap-2\">\r\n                      {selectedCodes.size > 0 && (\r\n                        <>\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setShowBatchEditDialog(true)}\r\n                          >\r\n                            {t(\"admin.couponCode.batchEditStatus\")}\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"destructive\"\r\n                            size=\"sm\"\r\n                            onClick={() => setShowBatchDeleteDialog(true)}\r\n                          >\r\n                            {t(\"admin.couponCode.batchDelete\")}\r\n                          </Button>\r\n                        </>\r\n                      )}\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {filteredCouponCodes.length} / {totalGenerated}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  {filteredCouponCodes.map((code) => (\r\n                    <div\r\n                      key={code.id}\r\n                      className={`rounded-lg border bg-card p-4 ${selectedCodes.has(code.id) ? 'ring-2 ring-primary' : ''}`}\r\n                    >\r\n                      <div className=\"flex items-start justify-between mb-4\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <Checkbox\r\n                            checked={selectedCodes.has(code.id)}\r\n                            onCheckedChange={() => handleToggleSelect(code.id)}\r\n                          />\r\n                          <div className=\"w-12 h-12 rounded bg-primary/10 flex items-center justify-center\">\r\n                            <Ticket className=\"h-6 w-6 text-primary\" />\r\n                          </div>\r\n                          <div>\r\n                            <code className=\"font-mono font-semibold text-base\">\r\n                              {code.code}\r\n                            </code>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">\r\n                              生成时间：{format(new Date(code.created_at), \"yyyy-MM-dd HH:mm\")}\r\n                            </p>\r\n                            <div className=\"flex items-center gap-4 mt-1\">\r\n                              <p className=\"text-xs text-muted-foreground\">\r\n                                使用：{code.used_count} / {code.usage_limit}\r\n                              </p>\r\n                              <Badge variant={code.is_active ? \"default\" : \"secondary\"}>\r\n                                {code.is_active ? \"激活\" : \"停用\"}\r\n                              </Badge>\r\n                            </div>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            onClick={() => setEditingCode(code)}\r\n                            title=\"编辑\"\r\n                          >\r\n                            <Pencil className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          <Button\r\n                            variant=\"ghost\"\r\n                            size=\"icon\"\r\n                            onClick={() => setDeletingCodeId(code.id)}\r\n                            title=\"删除\"\r\n                          >\r\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* 用户信息 */}\r\n                      {code.user_coupons.length > 0 ? (\r\n                        <div className=\"space-y-2 pt-3 border-t\">\r\n                          <p className=\"text-sm font-medium text-muted-foreground mb-2\">\r\n                            领取用户\r\n                          </p>\r\n                          {code.user_coupons.map((userCoupon) => (\r\n                            <div\r\n                              key={userCoupon.id}\r\n                              className=\"flex items-center justify-between p-3 rounded-md bg-secondary/20\"\r\n                            >\r\n                              <div className=\"flex items-center gap-3\">\r\n                                <Avatar className=\"h-10 w-10\">\r\n                                  <AvatarImage src={userCoupon.profiles.avatar_url || undefined} />\r\n                                  <AvatarFallback>\r\n                                    <User className=\"h-5 w-5\" />\r\n                                  </AvatarFallback>\r\n                                </Avatar>\r\n                                <div>\r\n                                  <p className=\"font-medium\">{userCoupon.profiles.display_name}</p>\r\n                                  <p className=\"text-xs text-muted-foreground\">\r\n                                    领取时间：{format(new Date(userCoupon.claimed_at), \"yyyy-MM-dd HH:mm\")}\r\n                                  </p>\r\n                                  {userCoupon.source && (\r\n                                    <p className=\"text-xs text-muted-foreground\">\r\n                                      来源：{userCoupon.source === \"share\" ? \"分享\" : userCoupon.source}\r\n                                    </p>\r\n                                  )}\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"flex flex-col items-end gap-1\">\r\n                                <Badge variant={userCoupon.used_at ? \"default\" : \"secondary\"}>\r\n                                  {userCoupon.used_at\r\n                                    ? `已使用 ${format(new Date(userCoupon.used_at), \"MM-dd HH:mm\")}`\r\n                                    : \"未使用\"}\r\n                                </Badge>\r\n                                {userCoupon.used_at && userCoupon.used_by_merchant && (\r\n                                  <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n                                    <Store className=\"h-3 w-3\" />\r\n                                    <span>核销：{userCoupon.used_by_merchant.display_name}</span>\r\n                                    {userCoupon.used_at_restaurant && (\r\n                                      <span className=\"text-primary\">\r\n                                        @ {getLocalizedField(userCoupon.used_at_restaurant, \"name\")}\r\n                                      </span>\r\n                                    )}\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </div>\r\n                          ))}\r\n                        </div>\r\n                      ) : (\r\n                        <p className=\"text-sm text-muted-foreground pt-3 border-t\">\r\n                          暂无用户领取此优惠券\r\n                        </p>\r\n                      )}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* 使用历史记录 */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                <History className=\"h-4 w-4\" />\r\n                使用历史记录 ({usageHistory?.length || 0})\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {historyLoading ? (\r\n                <p className=\"text-muted-foreground text-center py-4\">加载中...</p>\r\n              ) : !usageHistory || usageHistory.length === 0 ? (\r\n                <p className=\"text-muted-foreground text-center py-4\">暂无使用记录</p>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {usageHistory.map((history: any) => (\r\n                    <div key={history.id} className=\"flex items-start gap-4 p-4 border rounded-lg\">\r\n                      <Avatar className=\"h-10 w-10\">\r\n                        {history.used_by_profile?.avatar_url ? (\r\n                          <AvatarImage src={history.used_by_profile.avatar_url} />\r\n                        ) : null}\r\n                        <AvatarFallback>\r\n                          <User className=\"h-5 w-5\" />\r\n                        </AvatarFallback>\r\n                      </Avatar>\r\n                      <div className=\"flex-1 space-y-1\">\r\n                        <div className=\"flex items-center gap-2 flex-wrap\">\r\n                          <span className=\"font-medium\">\r\n                            {history.used_by_profile?.display_name || \"未知用户\"}\r\n                          </span>\r\n                          <span className=\"text-muted-foreground\">核销了优惠券</span>\r\n                          {history.coupon_code && (\r\n                            <Badge variant=\"outline\" className=\"font-mono text-xs\">\r\n                              {history.coupon_code}\r\n                            </Badge>\r\n                          )}\r\n                        </div>\r\n                        <div className=\"flex items-center gap-4 text-sm text-muted-foreground flex-wrap\">\r\n                          <span>{format(new Date(history.used_at), \"yyyy-MM-dd HH:mm:ss\")}</span>\r\n                          {history.restaurant && (\r\n                            <span className=\"flex items-center gap-1\">\r\n                              <Store className=\"h-3 w-3\" />\r\n                              {getLocalizedField(history.restaurant, \"name\")}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                        {history.notes && (\r\n                          <p className=\"text-sm text-muted-foreground mt-1\">\r\n                            备注: {history.notes}\r\n                          </p>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 编辑对话框 */}\r\n      {editingCode && (\r\n        <EditCouponCodeDialog\r\n          open={!!editingCode}\r\n          onOpenChange={(open) => !open && setEditingCode(null)}\r\n          couponCode={editingCode}\r\n          onSuccess={() => {\r\n            queryClient.invalidateQueries({ queryKey: [\"templateCouponCodes\", id] });\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* 批量编辑对话框 */}\r\n      <BatchEditCouponStatusDialog\r\n        open={showBatchEditDialog}\r\n        onOpenChange={setShowBatchEditDialog}\r\n        selectedCodeIds={Array.from(selectedCodes)}\r\n        onSuccess={handleBatchEditSuccess}\r\n      />\r\n\r\n      {/* 删除确认对话框 */}\r\n      <AlertDialog open={!!deletingCodeId} onOpenChange={(open) => !open && setDeletingCodeId(null)}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>确认删除</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              确定要删除这个子优惠券吗？此操作将同时删除所有关联的用户领取记录，且无法撤销。\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isDeleting}>取消</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => deletingCodeId && handleDeleteCouponCode(deletingCodeId)}\r\n              disabled={isDeleting}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? \"删除中...\" : \"确认删除\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* 批量删除确认对话框 */}\r\n      <AlertDialog open={showBatchDeleteDialog} onOpenChange={setShowBatchDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"admin.couponCode.batchDeleteTitle\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"admin.couponCode.batchDeleteDescription\", { count: selectedCodes.size })}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel disabled={isBatchDeleting}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleBatchDelete}\r\n              disabled={isBatchDeleting}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {isBatchDeleting ? t(\"common.deleting\") : t(\"common.delete\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AdminCouponDetail;\r\n"],"names":["Code","createLucideIcon","ManageTemplateActivitiesDialog","templateId","children","useTranslation","getLocalizedField","useLocalizedContent","open","setOpen","useState","templateActivities","loadingTemplateActivities","useTemplateActivities","allActivities","loadingAllActivities","useQuery","data","error","supabase","addTemplateActivity","useAddTemplateActivity","removeTemplateActivity","useRemoveTemplateActivity","linkedActivityIds","ta","handleToggleActivity","activityId","isLinked","isLoading","isPending","jsxs","Dialog","jsx","DialogTrigger","Button","Link","DialogContent","DialogHeader","DialogTitle","DialogDescription","ScrollArea","Loader2","activity","Checkbox","format","Badge","EditCouponCodeDialog","onOpenChange","couponCode","onSuccess","isSubmitting","setIsSubmitting","getInitialStatus","uc","register","handleSubmit","watch","setValue","reset","errors","useForm","useEffect","currentStatus","onSubmit","codeError","userCouponError","toast","Label","Input","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","DialogFooter","BatchEditCouponStatusDialog","selectedCodeIds","status","setStatus","AdminCouponDetail","id","useParams","navigate","useNavigate","t","queryClient","useQueryClient","searchQuery","setSearchQuery","statusFilter","setStatusFilter","usageFilter","setUsageFilter","sourceFilter","setSourceFilter","editingCode","setEditingCode","deletingCodeId","setDeletingCodeId","isDeleting","setIsDeleting","selectedCodes","setSelectedCodes","showBatchEditDialog","setShowBatchEditDialog","showBatchDeleteDialog","setShowBatchDeleteDialog","isBatchDeleting","setIsBatchDeleting","template","templateLoading","activitiesLoading","usageHistory","historyLoading","useTemplateUsageHistory","couponCodes","codesLoading","codeIds","c","usageHistoryData","merchantUserIds","h","merchantProfiles","merchantProfilesMap","acc","p","restaurantIds","restaurantsMap","restaurants","r","usageByUserCouponId","code","userCouponsWithProfiles","userCoupon","profile","filteredCouponCodes","useMemo","searchLower","matchesSearch","matchesStatus","matchesUsage","matchesSource","totalGenerated","totalUsed","sum","totalClaimed","handleToggleSelect","codeId","prev","newSet","handleSelectAll","handleBatchEditSuccess","handleBatchDelete","selectedIds","userCouponsError","handleDeleteCouponCode","Fragment","ArrowLeft","Ticket","Card","CardHeader","CardTitle","CardContent","Separator","Calendar","Search","e","Pencil","Trash2","Avatar","AvatarImage","AvatarFallback","User","Store","History","history","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"8sCAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GASA,MAAMA,GAAOC,GAAiB,OAAQ,CACpC,CAAC,WAAY,CAAE,OAAQ,mBAAoB,IAAK,QAAQ,CAAE,EAC1D,CAAC,WAAY,CAAE,OAAQ,gBAAiB,IAAK,QAAQ,CAAE,CACzD,CAAC,ECkBYC,GAAiC,CAAC,CAC7C,WAAAC,EACA,SAAAC,CACF,IAA2C,CAC3BC,EAAe,EACvB,KAAA,CAAE,kBAAAC,GAAsBC,KACxB,CAACC,EAAMC,CAAO,EAAIC,WAAS,EAAK,EAGhC,CAAE,KAAMC,EAAoB,UAAWC,GAC3CC,GAAsBV,CAAU,EAG5B,CAAE,KAAMW,EAAe,UAAWC,CAAA,EAAyBC,GAAS,CACxE,SAAU,CAAC,wBAAwB,EACnC,QAAS,SAAY,CACb,KAAA,CAAE,KAAAC,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,YAAY,EACjB,OAAO,iEAAiE,EACxE,GAAG,UAAW,EAAI,EAClB,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAE3C,GAAID,EAAa,MAAAA,EACV,OAAAD,CACT,EACA,QAAST,CAAA,CACV,EAEKY,EAAsBC,KACtBC,EAAyBC,KAEzBC,EAAoB,IAAI,IAC5Bb,GAAoB,IAAIc,GAAMA,EAAG,WAAW,GAAK,CAAC,CAAA,EAG9CC,EAAuB,MAAOC,EAAoBC,IAAsB,CACxEA,EACF,MAAMN,EAAuB,YAAY,CACvC,WAAAnB,EACA,WAAAwB,CAAA,CACD,EAED,MAAMP,EAAoB,YAAY,CACpC,WAAAjB,EACA,WAAAwB,CAAA,CACD,CACH,EAGIE,EAAYjB,GAA6BG,EACzCe,EAAYV,EAAoB,WAAaE,EAAuB,UAE1E,OACGS,EAAAA,KAAAC,GAAA,CAAO,KAAAxB,EAAY,aAAcC,EAChC,SAAA,CAACwB,EAAAA,IAAAC,GAAA,CAAc,QAAO,GACnB,SAAA9B,UACE+B,EAAO,CAAA,QAAQ,UAAU,KAAK,KAC7B,SAAA,CAACF,EAAAA,IAAAG,GAAA,CAAK,UAAU,cAAe,CAAA,EAAE,QAAA,CAAA,CAEnC,CAEJ,CAAA,EACAL,EAAAA,KAACM,GAAc,CAAA,UAAU,uCACvB,SAAA,CAAAN,OAACO,GACC,CAAA,SAAA,CAAAL,EAAAA,IAACM,IAAY,SAAM,QAAA,CAAA,EACnBN,EAAAA,IAACO,IAAkB,SAEnB,gCAAA,CAAA,CAAA,EACF,EAEAP,EAAA,IAACQ,GAAW,CAAA,UAAU,cACnB,SAAAZ,EACEI,EAAAA,IAAA,MAAA,CAAI,UAAU,2BACb,SAACA,EAAA,IAAAS,GAAA,CAAQ,UAAU,sBAAA,CAAuB,EAC5C,EAEAT,EAAA,IAAC,MAAI,CAAA,UAAU,YACZ,SAAAnB,GAAiBA,EAAc,OAAS,EACvCA,EAAc,IAAK6B,GAAa,CAC9B,MAAMf,EAAWJ,EAAkB,IAAImB,EAAS,EAAE,EAEhD,OAAAZ,EAAA,KAAC,MAAA,CAEC,UAAU,8FAEV,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,iCACb,SAAA,CAAAE,EAAA,IAACW,GAAA,CACC,QAAShB,EACT,gBAAiB,IAAMF,EAAqBiB,EAAS,GAAIf,CAAQ,EACjE,SAAUE,CAAA,CACZ,EACAC,EAAAA,KAAC,MAAI,CAAA,UAAU,SACb,SAAA,CAAAE,MAAC,KAAE,UAAU,cACV,SAAkB3B,EAAAqC,EAAU,OAAO,EACtC,EACAZ,EAAAA,KAAC,IAAE,CAAA,UAAU,gCACV,SAAA,CAAAc,EAAO,IAAI,KAAKF,EAAS,UAAU,EAAG,YAAY,EAClDA,EAAS,UAAY,MAAME,EAAO,IAAI,KAAKF,EAAS,QAAQ,EAAG,YAAY,CAAC,EAAA,EAC/E,CAAA,EACF,CAAA,EACF,EACCf,GACEG,EAAAA,KAAAe,EAAA,CAAM,QAAQ,YAAY,UAAU,OACnC,SAAA,CAACb,EAAAA,IAAAG,GAAA,CAAK,UAAU,cAAe,CAAA,EAAE,KAAA,EAEnC,CAAA,CAAA,EAvBGO,EAAS,EAAA,CAyBhB,CAEH,EAEAV,EAAAA,IAAA,MAAA,CAAI,UAAU,yCAAyC,SAAA,UAAA,CAExD,CAEJ,CAAA,EAEJ,EAEAF,EAAAA,KAAC,MAAI,CAAA,UAAU,kDACb,SAAA,CAACA,EAAAA,KAAA,IAAA,CAAE,UAAU,gCAAgC,SAAA,CAAA,OACtCP,EAAkB,KAAK,MAAA,EAC9B,EACAS,EAAAA,IAACE,GAAO,QAAQ,UAAU,QAAS,IAAM1B,EAAQ,EAAK,EAAG,SAEzD,IAAA,CAAA,CAAA,EACF,CAAA,EACF,CACF,CAAA,CAAA,CAEJ,EChHO,SAASsC,GAAqB,CACnC,KAAAvC,EACA,aAAAwC,EACA,WAAAC,EACA,UAAAC,CACF,EAA8B,CACtB,KAAA,CAAE,GAAM7C,IACR,CAAC8C,EAAcC,CAAe,EAAI1C,WAAS,EAAK,EAGhD2C,EAAmB,IAClBJ,EAAW,UACOA,EAAW,cAAc,KAAKK,GAAMA,EAAG,OAAO,EAC1C,OACpB,YAH2B,UAM9B,CACJ,SAAAC,EACA,aAAAC,EACA,MAAAC,EACA,SAAAC,EACA,MAAAC,EACA,UAAW,CAAE,OAAAC,CAAO,GAClBC,GAAkB,CACpB,cAAe,CACb,YAAaZ,EAAW,YACxB,OAAQI,EAAiB,CAC3B,CAAA,CACD,EAGDS,EAAAA,UAAU,IAAM,CACRH,EAAA,CACJ,YAAaV,EAAW,YACxB,OAAQI,EAAiB,CAAA,CAC1B,CAAA,EACA,CAACJ,EAAYU,CAAK,CAAC,EAEhB,MAAAI,EAAgBN,EAAM,QAAQ,EAE9BO,EAAW,MAAO/C,GAAmB,CACzCmC,EAAgB,EAAI,EAChB,GAAA,CAEI,KAAA,CAAE,MAAOa,GAAc,MAAM9C,EAChC,KAAK,cAAc,EACnB,OAAO,CACN,YAAaF,EAAK,YAClB,UAAWA,EAAK,SAAW,SAC5B,CAAA,EACA,GAAG,KAAMgC,EAAW,EAAE,EAEzB,GAAIgB,EAAiB,MAAAA,EAGrB,GAAIhB,EAAW,cAAgBA,EAAW,aAAa,OAAS,GAC1D,GAAAhC,EAAK,SAAW,OAAQ,CAEpB,KAAA,CAAE,MAAOiD,CAAoB,EAAA,MAAM/C,EACtC,KAAK,cAAc,EACnB,OAAO,CAAE,QAAS,IAAI,KAAO,EAAA,YAAc,CAAA,CAAC,EAC5C,GAAG,iBAAkB8B,EAAW,EAAE,EAClC,GAAG,UAAW,IAAI,EAErB,GAAIiB,EAAuB,MAAAA,CAAA,SAClBjD,EAAK,SAAW,YAAa,CAEtC,KAAM,CAAE,MAAOiD,GAAoB,MAAM/C,EACtC,KAAK,cAAc,EACnB,OAAO,CAAE,QAAS,IAAK,CAAC,EACxB,GAAG,iBAAkB8B,EAAW,EAAE,EAErC,GAAIiB,EAAuB,MAAAA,CAC7B,EAIIC,EAAA,QAAQ,EAAE,gCAAgC,CAAC,EACvCjB,IACVF,EAAa,EAAK,QACX9B,EAAO,CACN,QAAA,MAAM,8BAA+BA,CAAK,EAC5CiD,EAAA,MAAM,EAAE,8BAA8B,CAAC,CAAA,QAC7C,CACAf,EAAgB,EAAK,CACvB,CAAA,EAGF,aACGpB,GAAO,CAAA,KAAAxB,EAAY,aAAAwC,EAClB,SAACjB,EAAA,KAAAM,GAAA,CAAc,UAAU,mBACvB,SAAA,CAAAN,OAACO,GACC,CAAA,SAAA,CAACL,EAAA,IAAAM,GAAA,CAAa,SAAE,EAAA,4BAA4B,CAAE,CAAA,SAC7CC,GACE,CAAA,SAAA,CAAA,EAAE,kCAAkC,EAAE,KAAGP,EAAA,IAAA,OAAA,CAAK,UAAU,0BAA2B,WAAW,KAAK,CAAA,EACtG,CAAA,EACF,SACC,OAAK,CAAA,SAAUuB,EAAaQ,CAAQ,EAAG,UAAU,YAChD,SAAA,CAACjC,EAAAA,KAAA,MAAA,CAAI,UAAU,YACb,SAAA,CAAAE,MAACmC,GAAM,CAAA,QAAQ,cAAe,SAAA,EAAE,6BAA6B,EAAE,EAC/DnC,EAAA,IAACoC,GAAA,CACC,GAAG,cACH,KAAK,SACL,IAAI,IACH,GAAGd,EAAS,cAAe,CAC1B,SAAU,EAAE,qCAAqC,EACjD,IAAK,CAAE,MAAO,EAAG,QAAS,EAAE,gCAAgC,CAAE,EAC9D,cAAe,EAAA,CAChB,CAAA,CACH,EACCK,EAAO,aACL3B,MAAA,IAAA,CAAE,UAAU,2BAA4B,SAAA2B,EAAO,YAAY,OAAQ,CAAA,QAErE,IAAE,CAAA,UAAU,gCACV,SAAA,EAAE,iCAAiC,EACtC,CAAA,EACF,EAEA7B,EAAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAACE,EAAA,IAAAmC,GAAA,CAAO,SAAE,EAAA,yBAAyB,CAAE,CAAA,EACrCrC,EAAA,KAACuC,EAAA,CACC,MAAOP,EACP,cAAgBQ,GAAwBb,EAAS,SAAUa,CAAK,EAEhE,SAAA,CAAAtC,EAAAA,IAACuC,GACC,SAACvC,MAAAwC,EAAA,CAAY,YAAa,EAAE,+BAA+B,EAAG,CAChE,CAAA,SACCC,EACC,CAAA,SAAA,CAAAzC,MAAC0C,EAAW,CAAA,MAAM,YAAa,SAAA,EAAE,kCAAkC,EAAE,QACpEA,EAAW,CAAA,MAAM,OAAQ,SAAA,EAAE,6BAA6B,EAAE,QAC1DA,EAAW,CAAA,MAAM,UAAW,SAAA,EAAE,gCAAgC,EAAE,CAAA,EACnE,CAAA,CAAA,CACF,EACA5C,EAAAA,KAAC,IAAE,CAAA,UAAU,gCACV,SAAA,CAAkBgC,IAAA,aAAe,EAAE,sCAAsC,EACzEA,IAAkB,QAAU,EAAE,iCAAiC,EAC/DA,IAAkB,WAAa,EAAE,oCAAoC,CAAA,EACxE,CAAA,EACF,SAECa,GACC,CAAA,SAAA,CAAA3C,EAAA,IAACE,EAAA,CACC,KAAK,SACL,QAAQ,UACR,QAAS,IAAMa,EAAa,EAAK,EACjC,SAAUG,EAET,WAAE,eAAe,CAAA,CACpB,EACCpB,EAAA,KAAAI,EAAA,CAAO,KAAK,SAAS,SAAUgB,EAC7B,SAAA,CAAgBA,GAAAlB,EAAAA,IAACS,GAAQ,CAAA,UAAU,2BAA4B,CAAA,EAC/D,EAAE,aAAa,CAAA,EAClB,CAAA,EACF,CAAA,EACF,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,CC/KO,SAASmC,GAA4B,CAC1C,KAAArE,EACA,aAAAwC,EACA,gBAAA8B,EACA,UAAA5B,CACF,EAAqC,CAC7B,KAAA,CAAE,GAAM7C,IACR,CAAC8C,EAAcC,CAAe,EAAI1C,WAAS,EAAK,EAChD,CAACqE,EAAQC,CAAS,EAAItE,WAAuB,WAAW,EAExD8C,EAAe,SAAY,CAC3B,GAAAsB,EAAgB,SAAW,EAE/B,CAAA1B,EAAgB,EAAI,EAChB,GAAA,CAEI,KAAA,CAAE,MAAOa,GAAc,MAAM9C,EAChC,KAAK,cAAc,EACnB,OAAO,CACN,UAAW4D,IAAW,SACvB,CAAA,EACA,GAAG,KAAMD,CAAe,EAE3B,GAAIb,EAAiB,MAAAA,EAGrB,GAAIc,IAAW,OAAQ,CAEf,KAAA,CAAE,MAAOb,CAAA,EAAoB,MAAM/C,EACtC,KAAK,cAAc,EACnB,OAAO,CAAE,YAAa,KAAK,EAAE,YAAY,EAAG,EAC5C,GAAG,iBAAkB2D,CAAe,EACpC,GAAG,UAAW,IAAI,EAErB,GAAIZ,EAAuB,MAAAA,CAAA,SAClBa,IAAW,YAAa,CAEjC,KAAM,CAAE,MAAOb,CAAA,EAAoB,MAAM/C,EACtC,KAAK,cAAc,EACnB,OAAO,CAAE,QAAS,IAAM,CAAA,EACxB,GAAG,iBAAkB2D,CAAe,EAEvC,GAAIZ,EAAuB,MAAAA,CAC7B,CAGMC,EAAA,QAAQ,EAAE,sCAAuC,CAAE,MAAOW,EAAgB,MAAQ,CAAA,CAAC,EAC/E5B,IACVF,EAAa,EAAK,QACX9B,EAAO,CACN,QAAA,MAAM,qCAAsCA,CAAK,EACnDiD,EAAA,MAAM,EAAE,mCAAmC,CAAC,CAAA,QAClD,CACAf,EAAgB,EAAK,CACvB,EAAA,EAGF,aACGpB,GAAO,CAAA,KAAAxB,EAAY,aAAAwC,EAClB,SAACjB,EAAA,KAAAM,GAAA,CAAc,UAAU,mBACvB,SAAA,CAAAN,OAACO,GACC,CAAA,SAAA,CAACL,EAAA,IAAAM,GAAA,CAAa,SAAE,EAAA,iCAAiC,CAAE,CAAA,EACnDN,EAAAA,IAACO,IACE,SAAE,EAAA,wCAAyC,CAAE,MAAOsC,EAAgB,MAAQ,CAAA,EAC/E,CAAA,EACF,QACC,MAAI,CAAA,UAAU,iBACb,SAAC/C,EAAA,KAAA,MAAA,CAAI,UAAU,YACb,SAAA,CAACE,EAAA,IAAAmC,GAAA,CAAO,SAAE,EAAA,yBAAyB,CAAE,CAAA,EACrCrC,EAAA,KAACuC,EAAA,CACC,MAAOS,EACP,cAAgBR,GAAwBS,EAAUT,CAAK,EAEvD,SAAA,CAAAtC,EAAAA,IAACuC,GACC,SAACvC,MAAAwC,EAAA,CAAY,YAAa,EAAE,+BAA+B,EAAG,CAChE,CAAA,SACCC,EACC,CAAA,SAAA,CAAAzC,MAAC0C,EAAW,CAAA,MAAM,YAAa,SAAA,EAAE,kCAAkC,EAAE,QACpEA,EAAW,CAAA,MAAM,OAAQ,SAAA,EAAE,6BAA6B,EAAE,QAC1DA,EAAW,CAAA,MAAM,UAAW,SAAA,EAAE,gCAAgC,EAAE,CAAA,EACnE,CAAA,CAAA,CACF,EACA5C,EAAAA,KAAC,IAAE,CAAA,UAAU,gCACV,SAAA,CAAWgD,IAAA,aAAe,EAAE,sCAAsC,EAClEA,IAAW,QAAU,EAAE,iCAAiC,EACxDA,IAAW,WAAa,EAAE,oCAAoC,CAAA,EACjE,CAAA,CAAA,CACF,CACF,CAAA,SACCH,GACC,CAAA,SAAA,CAAA3C,EAAA,IAACE,EAAA,CACC,KAAK,SACL,QAAQ,UACR,QAAS,IAAMa,EAAa,EAAK,EACjC,SAAUG,EAET,WAAE,eAAe,CAAA,CACpB,EACCpB,EAAA,KAAAI,EAAA,CAAO,QAASqB,EAAc,SAAUL,EACtC,SAAA,CAAgBA,GAAAlB,EAAAA,IAACS,GAAQ,CAAA,UAAU,2BAA4B,CAAA,EAC/D,EAAE,8BAA8B,CAAA,EACnC,CAAA,EACF,CAAA,CACF,CAAA,CACF,CAAA,CAEJ,CCxEA,MAAMuC,GAAoB,IAAM,CACxB,KAAA,CAAE,GAAAC,GAAOC,KACTC,EAAWC,KACX,CAAE,EAAAC,GAAMjF,IACR,CAAE,kBAAAC,GAAsBC,KACxBgF,EAAcC,KAGd,CAACC,EAAaC,CAAc,EAAIhF,WAAS,EAAE,EAC3C,CAACiF,EAAcC,CAAe,EAAIlF,WAAwC,KAAK,EAC/E,CAACmF,EAAaC,CAAc,EAAIpF,WAAmD,KAAK,EACxF,CAACqF,EAAcC,CAAe,EAAItF,WAAoC,KAAK,EAG3E,CAACuF,EAAaC,CAAc,EAAIxF,WAAoC,IAAI,EACxE,CAACyF,EAAgBC,CAAiB,EAAI1F,WAAwB,IAAI,EAClE,CAAC2F,EAAYC,CAAa,EAAI5F,WAAS,EAAK,EAG5C,CAAC6F,EAAeC,CAAgB,EAAI9F,EAAAA,SAAsB,IAAI,GAAK,EACnE,CAAC+F,GAAqBC,EAAsB,EAAIhG,WAAS,EAAK,EAC9D,CAACiG,GAAuBC,CAAwB,EAAIlG,WAAS,EAAK,EAClE,CAACmG,EAAiBC,EAAkB,EAAIpG,WAAS,EAAK,EAGtD,CAAE,KAAMqG,EAAU,UAAWC,EAAA,EAAoBhG,GAAS,CAC9D,SAAU,CAAC,iBAAkBkE,CAAE,EAC/B,QAAS,SAAY,CACnB,KAAM,CAAE,KAAAjE,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAC3B,KAAK,kBAAkB,EACvB,OAAO,GAAG,EACV,GAAG,KAAM+D,CAAE,EACX,SAEH,GAAIhE,EAAa,MAAAA,EACV,OAAAD,CACT,EACA,QAAS,CAAC,CAACiE,CAAA,CACZ,EAGK,CAAE,KAAMvE,EAAoB,UAAWsG,IAAsBpG,GAAsBqE,CAAG,EAGtF,CAAE,KAAMgC,EAAc,UAAWC,IAAmBC,GAAwBlC,CAAG,EAG/E,CAAE,KAAMmC,EAAa,UAAWC,EAAA,EAAiBtG,GAAS,CAC9D,SAAU,CAAC,sBAAuBkE,CAAE,EACpC,QAAS,SAAY,CACb,KAAA,CAAE,KAAAjE,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,cAAc,EACnB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SASP,EACA,GAAG,cAAe+D,CAAE,EACpB,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAE3C,GAAIhE,EAAa,MAAAA,EAGX,MAAAqG,GAAWtG,GAAQ,CAAC,GAAG,IAAKuG,GAAWA,EAAE,EAAE,EAG3C,CAAE,KAAMC,CAAiB,EAAI,MAAMtG,EACtC,KAAK,sBAAsB,EAC3B,OAAO,gDAAgD,EACvD,GAAG,iBAAkBoG,CAAO,EAGzBG,EAAkB,CAAC,GAAG,IAAI,KAAKD,GAAoB,CAAA,GAAI,IAAIE,GAAKA,EAAE,eAAe,CAAC,CAAC,EACnF,CAAE,KAAMC,CAAiB,EAAI,MAAMzG,EACtC,KAAK,UAAU,EACf,OAAO,8BAA8B,EACrC,GAAG,KAAMuG,CAAe,EAErBG,GAAuBD,GAAoB,CAAA,GAAI,OAAO,CAACE,EAAKC,KAC5DD,EAAAC,EAAE,EAAE,EAAI,CAAE,aAAcA,EAAE,aAAc,WAAYA,EAAE,YACnDD,GACN,CAAyE,CAAA,EAGtEE,GAAgB,CAAC,GAAG,IAAI,KAAKP,GAAoB,CAAA,GAAI,OAAYE,GAAAA,EAAE,aAAa,EAAE,OAASA,EAAE,aAAuB,CAAC,CAAC,EAC5H,IAAIM,GAAmG,CAAA,EACnG,GAAAD,GAAc,OAAS,EAAG,CAC5B,KAAM,CAAE,KAAME,CAAY,EAAI,MAAM/G,EACjC,KAAK,aAAa,EAClB,OAAO,4BAA4B,EACnC,GAAG,KAAM6G,EAAa,EACzBC,IAAkBC,GAAe,CAAA,GAAI,OAAO,CAACJ,EAAKK,KAChDL,EAAIK,EAAE,EAAE,EAAI,CAAE,KAAMA,EAAE,KAAM,QAASA,EAAE,QAAS,QAASA,EAAE,OAAQ,EAC5DL,GACN,CAAsF,CAAA,CAC3F,CAGA,MAAMM,IAAuBX,GAAoB,CAAA,GAAI,OAAO,CAACK,EAAKH,KAC5DA,EAAE,iBACAG,EAAAH,EAAE,cAAc,EAAI,CACtB,iBAAkBE,EAAoBF,EAAE,eAAe,GAAK,KAC5D,mBAAoBA,EAAE,eAAgBM,GAAeN,EAAE,aAAa,GAAK,IAAO,GAG7EG,GACN,CAAmM,CAAA,EAqC/L,OAlCmB,MAAM,QAAQ,KACrC7G,GAAQ,CAAA,GAAI,IAAI,MAAOoH,GAAc,CAC9B,MAAAC,EAA0B,MAAM,QAAQ,KAC3CD,EAAK,cAAgB,CAAI,GAAA,IAAI,MAAOE,GAAoB,CAEnD,GAAA,CAACA,EAAW,QACP,MAAA,CACL,GAAGA,EACH,SAAU,CAAE,GAAI,GAAI,aAAc,UAAW,WAAY,IAAK,EAC9D,GAAGH,GAAoBG,EAAW,EAAE,CAAA,EAIxC,KAAM,CAAE,KAAMC,EAAA,EAAY,MAAMrH,EAC7B,KAAK,UAAU,EACf,OAAO,8BAA8B,EACrC,GAAG,KAAMoH,EAAW,OAAO,EAC3B,cAEI,MAAA,CACL,GAAGA,EACH,SAAUC,IAAW,CAAE,GAAID,EAAW,QAAS,aAAc,UAAW,WAAY,IAAK,EACzF,GAAGH,GAAoBG,EAAW,EAAE,CAAA,CACtC,CACD,CAAA,EAGI,MAAA,CACL,GAAGF,EACH,aAAcC,CAAA,CAChB,CACD,CAAA,CAIL,EACA,QAAS,CAAC,CAACpD,CAAA,CACZ,EAGKuD,EAAsBC,EAAAA,QAAQ,IAC7BrB,EAEEA,EAAY,OAAQgB,GAAS,CAE5B,MAAAM,EAAclD,EAAY,cAC1BmD,EACJnD,IAAgB,IAChB4C,EAAK,KAAK,YAAY,EAAE,SAASM,CAAW,GAC5CN,EAAK,aAAa,KAAM/E,GACtBA,EAAG,SAAS,aAAa,YAAY,EAAE,SAASqF,CAAW,CAAA,EAIzDE,EACJlD,IAAiB,OAChBA,IAAiB,UAAY0C,EAAK,WAClC1C,IAAiB,YAAc,CAAC0C,EAAK,UAGlCS,EACJjD,IAAgB,OACfA,IAAgB,aAAewC,EAAK,aAAa,SAAW,GAC5DxC,IAAgB,WAAawC,EAAK,aAAa,OAAS,GAAKA,EAAK,aAAa,MAAM/E,GAAM,CAACA,EAAG,OAAO,GACtGuC,IAAgB,QAAUwC,EAAK,aAAa,KAAK/E,GAAMA,EAAG,OAAO,EAG9DyF,EACJhD,IAAiB,OAChBA,IAAiB,SAAWsC,EAAK,aAAa,KAAW/E,GAAAA,EAAG,SAAW,OAAO,GAC9EyC,IAAiB,SAAWsC,EAAK,aAAa,KAAK/E,GAAMA,EAAG,SAAW,OAAO,EAE1E,OAAAsF,GAAiBC,GAAiBC,GAAgBC,CAAA,CAC1D,EAhCwB,GAiCxB,CAAC1B,EAAa5B,EAAaE,EAAcE,EAAaE,CAAY,CAAC,EAEhEiD,EAAiB3B,GAAa,QAAU,EACxC4B,GAAY5B,GAAa,OAAO,CAAC6B,EAAKb,IAASa,EAAMb,EAAK,WAAY,CAAC,GAAK,EAC5Ec,GAAe9B,GAAa,OAAO,CAAC6B,EAAKb,IAASa,EAAMb,EAAK,aAAa,OAAQ,CAAC,GAAK,EAGxFe,GAAsBC,GAAmB,CAC7C7C,EAAyB8C,GAAA,CACjB,MAAAC,EAAS,IAAI,IAAID,CAAI,EACvB,OAAAC,EAAO,IAAIF,CAAM,EACnBE,EAAO,OAAOF,CAAM,EAEpBE,EAAO,IAAIF,CAAM,EAEZE,CAAA,CACR,CAAA,EAGGC,GAAkB,IAAM,CACxBjD,EAAc,OAASkC,EAAoB,OAC5BjC,EAAA,IAAI,GAAK,EAETA,EAAA,IAAI,IAAIiC,EAAoB,OAAYJ,EAAK,EAAE,CAAC,CAAC,CACpE,EAGIoB,GAAyB,IAAM,CAClBjD,EAAA,IAAI,GAAK,EAC1BjB,EAAY,kBAAkB,CAAE,SAAU,CAAC,sBAAuBL,CAAE,EAAG,CAAA,EAGnEwE,GAAoB,SAAY,CAChC,GAAAnD,EAAc,OAAS,EAE3B,CAAAO,GAAmB,EAAI,EACnB,GAAA,CACI,MAAA6C,EAAc,MAAM,KAAKpD,CAAa,EAGtC,CAAE,MAAOqD,GAAqB,MAAMzI,EACvC,KAAK,cAAc,EACnB,OAAA,EACA,GAAG,iBAAkBwI,CAAW,EAEnC,GAAIC,EAAwB,MAAAA,EAG5B,KAAM,CAAE,MAAA1I,CAAA,EAAU,MAAMC,EACrB,KAAK,cAAc,EACnB,SACA,GAAG,KAAMwI,CAAW,EAEvB,GAAIzI,EAAa,MAAAA,EAEXiD,EAAA,QAAQmB,EAAE,sCAAuC,CAAE,MAAOqE,EAAY,MAAQ,CAAA,CAAC,EACpEnD,EAAA,IAAI,GAAK,EAC1BjB,EAAY,kBAAkB,CAAE,SAAU,CAAC,sBAAuBL,CAAE,EAAG,EACvE0B,EAAyB,EAAK,QACvB1F,EAAO,CACN,QAAA,MAAM,qCAAsCA,CAAK,EACnDiD,EAAA,MAAMmB,EAAE,mCAAmC,CAAC,CAAA,QAClD,CACAwB,GAAmB,EAAK,CAC1B,EAAA,EAGI+C,GAAyB,MAAOR,GAAmB,CACvD/C,EAAc,EAAI,EACd,GAAA,CAEF,KAAM,CAAE,MAAOsD,GAAqB,MAAMzI,EACvC,KAAK,cAAc,EACnB,OAAA,EACA,GAAG,iBAAkBkI,CAAM,EAE9B,GAAIO,EAAwB,MAAAA,EAG5B,KAAM,CAAE,MAAA1I,CAAA,EAAU,MAAMC,EACrB,KAAK,cAAc,EACnB,SACA,GAAG,KAAMkI,CAAM,EAElB,GAAInI,EAAa,MAAAA,EAEjBiD,EAAM,QAAQ,SAAS,EACvBoB,EAAY,kBAAkB,CAAE,SAAU,CAAC,sBAAuBL,CAAE,EAAG,EACvEkB,EAAkB,IAAI,QACflF,EAAO,CACN,QAAA,MAAM,8BAA+BA,CAAK,EAClDiD,EAAM,MAAM,MAAM,CAAA,QAClB,CACAmC,EAAc,EAAK,CACrB,CAAA,EAGF,OAAIU,GAEA/E,EAAAA,IAAC,OAAI,UAAU,8BACb,eAAC,MAAI,CAAA,UAAU,oBAAoB,SAAA,QAAM,CAAA,CAC3C,CAAA,EAIC8E,EAaDhF,EAAA,KAAA+H,WAAA,CAAA,SAAA,CAAC/H,EAAAA,KAAA,MAAA,CAAI,UAAU,8BACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,OACb,SAAA,CAAAA,EAAA,KAACI,EAAA,CACC,QAAQ,QACR,QAAS,IAAMiD,EAAS,gBAAgB,EACxC,UAAU,OAEV,SAAA,CAACnD,EAAAA,IAAA8H,GAAA,CAAU,UAAU,cAAe,CAAA,EAAE,MAAA,CAAA,CAExC,EACAhI,EAAAA,KAAC,KAAG,CAAA,UAAU,6CACZ,SAAA,CAACE,EAAAA,IAAA+H,GAAA,CAAO,UAAU,SAAU,CAAA,EAAE,SAAA,EAEhC,CAAA,EACF,EAEAjI,EAAAA,KAAC,MAAI,CAAA,UAAU,YAEb,SAAA,CAAAA,OAACkI,EACC,CAAA,SAAA,CAAAhI,EAAAA,IAACiI,IACC,SAACjI,EAAA,IAAAkI,GAAA,CAAU,UAAU,UAAU,gBAAI,CACrC,CAAA,EACApI,EAAAA,KAACqI,GAAY,CAAA,UAAU,YACrB,SAAA,CAACrI,EAAAA,KAAA,MAAA,CAAI,UAAU,oCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,SACb,SAAA,CAACE,EAAA,IAAA,IAAA,CAAE,UAAU,qCAAqC,SAAI,OAAA,EACrDgF,GACEhF,EAAAA,IAAA,IAAA,CAAE,UAAU,UAAU,SAAA,QAAA,CAAM,EAC3BtB,GAAsBA,EAAmB,OAAS,QACnD,MAAI,CAAA,UAAU,YACZ,SAAmBA,EAAA,IAAKc,GACvBQ,EAAA,IAACG,GAAA,CAEC,GAAI,aAAaX,EAAG,WAAW,GAC/B,UAAU,qCAET,SAAAnB,EAAkBmB,EAAG,WAAY,OAAO,CAAA,EAJpCA,EAAG,WAAA,CAMX,CACH,CAAA,QAEC,IAAE,CAAA,UAAU,gCAAgC,SAAO,UAAA,CAAA,EAExD,EACAM,EAAAA,KAAC,MAAI,CAAA,UAAU,yBACb,SAAA,CAACE,EAAAA,IAAA/B,GAAA,CAA+B,WAAYgF,CAAK,CAAA,EAChD,CAAC6B,EAAS,eAAYjE,EAAM,CAAA,QAAQ,YAAY,SAAG,MAAA,EACnD,CAACiE,EAAS,iBAAcjE,EAAM,CAAA,QAAQ,YAAY,SAAG,MAAA,EACrDiE,EAAS,WAAc9E,EAAA,IAAAa,EAAA,CAAM,SAAG,MAAA,CAAA,EACnC,CAAA,EACF,QAECuH,EAAU,EAAA,SAEV,MACC,CAAA,SAAA,CAACpI,EAAA,IAAA,IAAA,CAAE,UAAU,qCAAqC,SAAE,KAAA,EACpDF,EAAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAAAA,OAAC,IACC,CAAA,SAAA,CAACE,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAG,MAAA,EAClD8E,EAAS,QAAA,EACZ,SACC,IACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAQ,WAAA,EACvD8E,EAAS,QAAA,EACZ,SACC,IACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAU,aAAA,EACzD8E,EAAS,QAAA,EACZ,CAAA,EACF,CAAA,EACF,GAEEA,EAAS,gBACTA,EAAS,gBACTA,EAAS,iBAEPhF,EAAA,KAAA+H,WAAA,CAAA,SAAA,CAAA7H,EAAA,IAACoI,EAAU,EAAA,SACV,MACC,CAAA,SAAA,CAACpI,EAAA,IAAA,IAAA,CAAE,UAAU,qCAAqC,SAAE,KAAA,EACpDF,EAAAA,KAAC,MAAI,CAAA,UAAU,oBACZ,SAAA,CAASgF,EAAA,uBACP,IACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAG,MAAA,EAClD8E,EAAS,cAAA,EACZ,EAEDA,EAAS,gBACRhF,EAAAA,KAAC,IACC,CAAA,SAAA,CAACE,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAQ,WAAA,EACvD8E,EAAS,cAAA,EACZ,EAEDA,EAAS,gBACRhF,EAAAA,KAAC,IACC,CAAA,SAAA,CAACE,EAAA,IAAA,OAAA,CAAK,UAAU,gCAAgC,SAAU,aAAA,EACzD8E,EAAS,cAAA,EACZ,CAAA,EAEJ,CAAA,EACF,CAAA,EACF,QAGDsD,EAAU,EAAA,EAEXtI,EAAAA,KAAC,MAAI,CAAA,UAAU,gDACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAACE,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAI,OAAA,EACzCA,EAAAA,IAAC,KAAE,UAAU,cACV,WAAS,gBAAkB,aAAe,QAAU,MACvD,CAAA,CAAA,EACF,SACC,MACC,CAAA,SAAA,CAACA,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAG,MAAA,EACvCA,EAAA,IAAA,IAAA,CAAE,UAAU,mCACV,WAAS,gBAAkB,aACxB,GAAG8E,EAAS,cAAc,IAC1B,IAAIA,EAAS,cAAc,GACjC,CAAA,EACF,EACCA,EAAS,kBAAoBA,EAAS,iBAAmB,UACvD,MACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAI,OAAA,EACzCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cAAc,SAAA,CAAA,IAAEgF,EAAS,gBAAA,EAAiB,CAAA,EACzD,EAEDA,EAAS,qBAAuBA,EAAS,oBAAsB,UAC7D,MACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAI,OAAA,EACzCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cAAc,SAAA,CAAA,IAAEgF,EAAS,mBAAA,EAAoB,CAAA,EAC5D,SAED,MACC,CAAA,SAAA,CAAC9E,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAG,MAAA,EACxCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cAAe,SAAA,CAAAiH,EAAe,IAAA,EAAE,CAAA,EAC/C,SACC,MACC,CAAA,SAAA,CAAC/G,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAG,MAAA,EACxCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cAAe,SAAA,CAAAoH,GAAa,IAAA,EAAE,CAAA,EAC7C,SACC,MACC,CAAA,SAAA,CAAClH,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAG,MAAA,EACxCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cAAe,SAAA,CAAAkH,GAAU,IAAA,EAAE,CAAA,EAC1C,CAAA,EACF,QAECoB,EAAU,EAAA,QAEV,MAAI,CAAA,UAAU,gDACb,SAACtI,EAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAACE,EAAAA,IAAAqI,GAAA,CAAS,UAAU,+BAAgC,CAAA,SACnD,MACC,CAAA,SAAA,CAACrI,EAAA,IAAA,IAAA,CAAE,UAAU,wBAAwB,SAAG,MAAA,EACxCF,EAAAA,KAAC,IAAE,CAAA,UAAU,cACV,SAAA,CAAAc,EAAO,IAAI,KAAKkE,EAAS,UAAU,EAAG,YAAY,EAClDA,EAAS,YACN,MAAMlE,EAAO,IAAI,KAAKkE,EAAS,WAAW,EAAG,YAAY,CAAC,GAC1D,QAAA,EACN,CAAA,EACF,CAAA,CAAA,CACF,CACF,CAAA,CAAA,EACF,CAAA,EACF,SAGCkD,EACC,CAAA,SAAA,CAAAhI,MAACiI,GACC,CAAA,SAAAnI,EAAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAACA,EAAAA,KAAAoI,GAAA,CAAU,UAAU,kCACnB,SAAA,CAAClI,EAAAA,IAAAjC,GAAA,CAAK,UAAU,SAAU,CAAA,EAAE,aACjBgJ,EAAe,GAAA,EAC5B,EAGC3B,GAAeA,EAAY,OAAS,GAClCtF,EAAAA,KAAA,MAAA,CAAI,UAAU,uDACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,WACb,SAAA,CAACE,EAAAA,IAAAsI,GAAA,CAAO,UAAU,wEAAyE,CAAA,EAC3FtI,EAAA,IAACoC,GAAA,CACC,YAAY,cACZ,MAAOoB,EACP,SAAW+E,GAAM9E,EAAe8E,EAAE,OAAO,KAAK,EAC9C,UAAU,MAAA,CACZ,CAAA,EACF,EAEAzI,EAAAA,KAACuC,GAAO,MAAOqB,EAAc,cAAgBpB,GAAeqB,EAAgBrB,CAAK,EAC/E,SAAA,CAAAtC,MAACuC,EACC,CAAA,SAAAvC,EAAA,IAACwC,EAAY,CAAA,YAAY,IAAK,CAAA,EAChC,SACCC,EACC,CAAA,SAAA,CAACzC,EAAA,IAAA0C,EAAA,CAAW,MAAM,MAAM,SAAI,OAAA,EAC3B1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,SAAS,SAAG,MAAA,EAC7B1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,WAAW,SAAG,MAAA,CAAA,EAClC,CAAA,EACF,EAEA5C,EAAAA,KAACuC,GAAO,MAAOuB,EAAa,cAAgBtB,GAAeuB,EAAevB,CAAK,EAC7E,SAAA,CAAAtC,MAACuC,EACC,CAAA,SAAAvC,EAAA,IAACwC,EAAY,CAAA,YAAY,MAAO,CAAA,EAClC,SACCC,EACC,CAAA,SAAA,CAACzC,EAAA,IAAA0C,EAAA,CAAW,MAAM,MAAM,SAAE,KAAA,EACzB1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,YAAY,SAAG,MAAA,EAChC1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,UAAU,SAAM,SAAA,EACjC1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,OAAO,SAAG,MAAA,CAAA,EAC9B,CAAA,EACF,EAEA5C,EAAAA,KAACuC,GAAO,MAAOyB,EAAc,cAAgBxB,GAAeyB,EAAgBzB,CAAK,EAC/E,SAAA,CAAAtC,MAACuC,EACC,CAAA,SAAAvC,EAAA,IAACwC,EAAY,CAAA,YAAY,IAAK,CAAA,EAChC,SACCC,EACC,CAAA,SAAA,CAACzC,EAAA,IAAA0C,EAAA,CAAW,MAAM,MAAM,SAAI,OAAA,EAC3B1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,QAAQ,SAAE,KAAA,EAC3B1C,EAAA,IAAA0C,EAAA,CAAW,MAAM,QAAQ,SAAE,KAAA,CAAA,EAC9B,CAAA,EACF,CAAA,EACF,CAAA,CAAA,CAEJ,CACF,CAAA,EACC1C,MAAAmI,GAAA,CACE,SACC9C,GAAArF,EAAAA,IAAC,KAAE,UAAU,gCAAgC,SAAM,QAAA,CAAA,EACjD,CAACoF,GAAeA,EAAY,SAAW,EACxCpF,MAAA,IAAA,CAAE,UAAU,gCAAgC,SAE7C,qBAAA,CAAA,EACEwG,EAAoB,SAAW,EAChCxG,MAAA,IAAA,CAAE,UAAU,gCAAgC,SAE7C,cAAA,CAAA,EAECF,EAAAA,KAAA,MAAA,CAAI,UAAU,YAEb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,oCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAA,IAACW,GAAA,CACC,GAAG,YACH,QAAS2D,EAAc,OAASkC,EAAoB,QAAUA,EAAoB,OAAS,EAC3F,gBAAiBe,EAAA,CACnB,EACAvH,EAAAA,IAAC,SAAM,QAAQ,YAAY,UAAU,yBAClC,SAAAqD,EAAE,4BAA4B,EACjC,CAAA,EACF,EACCiB,EAAc,KAAO,GACpBtE,EAAA,IAAC,QAAK,UAAU,gCACb,SAAEqD,EAAA,iCAAkC,CAAE,MAAOiB,EAAc,IAAM,CAAA,EACpE,CAAA,EAEJ,EACAxE,EAAAA,KAAC,MAAI,CAAA,UAAU,0BACZ,SAAA,CAAcwE,EAAA,KAAO,GAElBxE,EAAA,KAAA+H,EAAA,SAAA,CAAA,SAAA,CAAA7H,EAAA,IAACE,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAMuE,GAAuB,EAAI,EAEzC,WAAE,kCAAkC,CAAA,CACvC,EACAzE,EAAA,IAACE,EAAA,CACC,QAAQ,cACR,KAAK,KACL,QAAS,IAAMyE,EAAyB,EAAI,EAE3C,WAAE,8BAA8B,CAAA,CACnC,CAAA,EACF,EAEF7E,EAAAA,KAAC,OAAK,CAAA,UAAU,gCACb,SAAA,CAAoB0G,EAAA,OAAO,MAAIO,CAAA,EAClC,CAAA,EACF,CAAA,EACF,EACCP,EAAoB,IAAKJ,GACxBtG,EAAA,KAAC,MAAA,CAEC,UAAW,iCAAiCwE,EAAc,IAAI8B,EAAK,EAAE,EAAI,sBAAwB,EAAE,GAEnG,SAAA,CAACtG,EAAAA,KAAA,MAAA,CAAI,UAAU,wCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAA,IAACW,GAAA,CACC,QAAS2D,EAAc,IAAI8B,EAAK,EAAE,EAClC,gBAAiB,IAAMe,GAAmBf,EAAK,EAAE,CAAA,CACnD,EACApG,EAAAA,IAAC,OAAI,UAAU,mEACb,eAAC+H,GAAO,CAAA,UAAU,uBAAuB,CAC3C,CAAA,SACC,MACC,CAAA,SAAA,CAAA/H,EAAA,IAAC,OAAK,CAAA,UAAU,oCACb,SAAAoG,EAAK,KACR,EACAtG,EAAAA,KAAC,IAAE,CAAA,UAAU,qCAAqC,SAAA,CAAA,QAC1Cc,EAAO,IAAI,KAAKwF,EAAK,UAAU,EAAG,kBAAkB,CAAA,EAC5D,EACAtG,EAAAA,KAAC,MAAI,CAAA,UAAU,+BACb,SAAA,CAACA,EAAAA,KAAA,IAAA,CAAE,UAAU,gCAAgC,SAAA,CAAA,MACvCsG,EAAK,WAAW,MAAIA,EAAK,WAAA,EAC/B,EACApG,EAAAA,IAACa,EAAM,CAAA,QAASuF,EAAK,UAAY,UAAY,YAC1C,SAAAA,EAAK,UAAY,KAAO,IAC3B,CAAA,CAAA,EACF,CAAA,EACF,CAAA,EACF,EACAtG,EAAAA,KAAC,MAAI,CAAA,UAAU,0BACb,SAAA,CAAAE,EAAA,IAACE,EAAA,CACC,QAAQ,QACR,KAAK,OACL,QAAS,IAAM+D,EAAemC,CAAI,EAClC,MAAM,KAEN,SAAApG,EAAAA,IAACwI,GAAO,CAAA,UAAU,SAAU,CAAA,CAAA,CAC9B,EACAxI,EAAA,IAACE,EAAA,CACC,QAAQ,QACR,KAAK,OACL,QAAS,IAAMiE,EAAkBiC,EAAK,EAAE,EACxC,MAAM,KAEN,SAAApG,EAAAA,IAACyI,GAAO,CAAA,UAAU,0BAA2B,CAAA,CAAA,CAC/C,CAAA,EACF,CAAA,EACF,EAGCrC,EAAK,aAAa,OAAS,EACzBtG,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAACE,EAAA,IAAA,IAAA,CAAE,UAAU,iDAAiD,SAE9D,OAAA,EACCoG,EAAK,aAAa,IAAKE,GACtBxG,EAAA,KAAC,MAAA,CAEC,UAAU,mEAEV,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAACA,EAAAA,KAAA4I,GAAA,CAAO,UAAU,YAChB,SAAA,CAAA1I,MAAC2I,GAAY,CAAA,IAAKrC,EAAW,SAAS,YAAc,OAAW,QAC9DsC,GACC,CAAA,SAAA5I,EAAA,IAAC6I,GAAK,CAAA,UAAU,SAAU,CAAA,EAC5B,CAAA,EACF,SACC,MACC,CAAA,SAAA,CAAA7I,MAAC,IAAE,CAAA,UAAU,cAAe,SAAAsG,EAAW,SAAS,aAAa,EAC7DxG,EAAAA,KAAC,IAAE,CAAA,UAAU,gCAAgC,SAAA,CAAA,QACrCc,EAAO,IAAI,KAAK0F,EAAW,UAAU,EAAG,kBAAkB,CAAA,EAClE,EACCA,EAAW,QACTxG,OAAA,IAAA,CAAE,UAAU,gCAAgC,SAAA,CAAA,MACvCwG,EAAW,SAAW,QAAU,KAAOA,EAAW,MAAA,EACxD,CAAA,EAEJ,CAAA,EACF,EACAxG,EAAAA,KAAC,MAAI,CAAA,UAAU,gCACb,SAAA,CAAAE,MAACa,GAAM,QAASyF,EAAW,QAAU,UAAY,YAC9C,WAAW,QACR,OAAO1F,EAAO,IAAI,KAAK0F,EAAW,OAAO,EAAG,aAAa,CAAC,GAC1D,MACN,EACCA,EAAW,SAAWA,EAAW,kBAC/BxG,EAAAA,KAAA,MAAA,CAAI,UAAU,0DACb,SAAA,CAACE,EAAAA,IAAA8I,GAAA,CAAM,UAAU,SAAU,CAAA,SAC1B,OAAK,CAAA,SAAA,CAAA,MAAIxC,EAAW,iBAAiB,YAAA,EAAa,EAClDA,EAAW,oBACTxG,OAAA,OAAA,CAAK,UAAU,eAAe,SAAA,CAAA,KAC1BzB,EAAkBiI,EAAW,mBAAoB,MAAM,CAAA,EAC5D,CAAA,EAEJ,CAAA,EAEJ,CAAA,CAAA,EAvCKA,EAAW,EAAA,CAyCnB,CAAA,EACH,EAEAtG,EAAA,IAAC,IAAE,CAAA,UAAU,8CAA8C,SAE3D,aAAA,CAAA,CAAA,EAvGGoG,EAAK,EAAA,CA0Gb,CAAA,CAAA,CACH,CAEJ,CAAA,CAAA,EACF,SAGC4B,EACC,CAAA,SAAA,CAAAhI,MAACiI,GACC,CAAA,SAAAnI,EAAAA,KAACoI,GAAU,CAAA,UAAU,kCACnB,SAAA,CAAClI,EAAAA,IAAA+I,GAAA,CAAQ,UAAU,SAAU,CAAA,EAAE,WACtB9D,GAAc,QAAU,EAAE,GAAA,CAAA,CACrC,CACF,CAAA,EACCjF,MAAAmI,GAAA,CACE,SACCjD,GAAAlF,EAAAA,IAAC,IAAE,CAAA,UAAU,yCAAyC,SAAA,QAAM,CAAA,EAC1D,CAACiF,GAAgBA,EAAa,SAAW,EAC3CjF,EAAA,IAAC,IAAE,CAAA,UAAU,yCAAyC,SAAA,SAAM,EAE5DA,EAAA,IAAC,OAAI,UAAU,YACZ,SAAaiF,EAAA,IAAK+D,GAChBlJ,EAAA,KAAA,MAAA,CAAqB,UAAU,+CAC9B,SAAA,CAACA,EAAAA,KAAA4I,GAAA,CAAO,UAAU,YACf,SAAA,CAAQM,EAAA,iBAAiB,WACvBhJ,EAAAA,IAAA2I,GAAA,CAAY,IAAKK,EAAQ,gBAAgB,WAAY,EACpD,WACHJ,GACC,CAAA,SAAA5I,EAAA,IAAC6I,GAAK,CAAA,UAAU,SAAU,CAAA,EAC5B,CAAA,EACF,EACA/I,EAAAA,KAAC,MAAI,CAAA,UAAU,mBACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAE,MAAC,QAAK,UAAU,cACb,SAAQgJ,EAAA,iBAAiB,cAAgB,OAC5C,EACChJ,EAAA,IAAA,OAAA,CAAK,UAAU,wBAAwB,SAAM,SAAA,EAC7CgJ,EAAQ,aACNhJ,MAAAa,EAAA,CAAM,QAAQ,UAAU,UAAU,oBAChC,SAAAmI,EAAQ,WACX,CAAA,CAAA,EAEJ,EACAlJ,EAAAA,KAAC,MAAI,CAAA,UAAU,kEACb,SAAA,CAACE,EAAAA,IAAA,OAAA,CAAM,WAAO,IAAI,KAAKgJ,EAAQ,OAAO,EAAG,qBAAqB,EAAE,EAC/DA,EAAQ,YACNlJ,OAAA,OAAA,CAAK,UAAU,0BACd,SAAA,CAACE,EAAAA,IAAA8I,GAAA,CAAM,UAAU,SAAU,CAAA,EAC1BzK,EAAkB2K,EAAQ,WAAY,MAAM,CAAA,EAC/C,CAAA,EAEJ,EACCA,EAAQ,OACNlJ,OAAA,IAAA,CAAE,UAAU,qCAAqC,SAAA,CAAA,OAC3CkJ,EAAQ,KAAA,EACf,CAAA,EAEJ,CAAA,CAAA,EAnCQA,EAAQ,EAoClB,CACD,CAAA,CACH,CAEJ,CAAA,CAAA,EACF,CAAA,EACF,CAAA,EACF,EAGChF,GACChE,EAAA,IAACc,GAAA,CACC,KAAM,CAAC,CAACkD,EACR,aAAezF,GAAS,CAACA,GAAQ0F,EAAe,IAAI,EACpD,WAAYD,EACZ,UAAW,IAAM,CACfV,EAAY,kBAAkB,CAAE,SAAU,CAAC,sBAAuBL,CAAE,EAAG,CACzE,CAAA,CACF,EAIFjD,EAAA,IAAC4C,GAAA,CACC,KAAM4B,GACN,aAAcC,GACd,gBAAiB,MAAM,KAAKH,CAAa,EACzC,UAAWkD,EAAA,CACb,EAGCxH,EAAA,IAAAiJ,GAAA,CAAY,KAAM,CAAC,CAAC/E,EAAgB,aAAe3F,GAAS,CAACA,GAAQ4F,EAAkB,IAAI,EAC1F,gBAAC+E,GACC,CAAA,SAAA,CAAApJ,OAACqJ,GACC,CAAA,SAAA,CAAAnJ,EAAAA,IAACoJ,IAAiB,SAAI,MAAA,CAAA,EACtBpJ,EAAAA,IAACqJ,IAAuB,SAExB,yCAAA,CAAA,CAAA,EACF,SACCC,GACC,CAAA,SAAA,CAACtJ,EAAA,IAAAuJ,GAAA,CAAkB,SAAUnF,EAAY,SAAE,KAAA,EAC3CpE,EAAA,IAACwJ,GAAA,CACC,QAAS,IAAMtF,GAAkB0D,GAAuB1D,CAAc,EACtE,SAAUE,EACV,UAAU,qEAET,WAAa,SAAW,MAAA,CAC3B,CAAA,EACF,CAAA,CAAA,CACF,CACF,CAAA,QAGC6E,GAAY,CAAA,KAAMvE,GAAuB,aAAcC,EACtD,gBAACuE,GACC,CAAA,SAAA,CAAApJ,OAACqJ,GACC,CAAA,SAAA,CAACnJ,EAAA,IAAAoJ,GAAA,CAAkB,SAAE/F,EAAA,mCAAmC,CAAE,CAAA,EAC1DrD,EAAAA,IAACqJ,IACE,SAAEhG,EAAA,0CAA2C,CAAE,MAAOiB,EAAc,IAAM,CAAA,EAC7E,CAAA,EACF,SACCgF,GACC,CAAA,SAAA,CAAAtJ,MAACuJ,GAAkB,CAAA,SAAU3E,EAAkB,SAAAvB,EAAE,eAAe,EAAE,EAClErD,EAAA,IAACwJ,GAAA,CACC,QAAS/B,GACT,SAAU7C,EACV,UAAU,qEAET,SAAkBvB,EAAAuB,EAAE,kBAAuB,eAAN,CAAqB,CAC7D,CAAA,EACF,CAAA,CAAA,CACF,CACF,CAAA,CACF,CAAA,CAAA,QAjhBG,MAAI,CAAA,UAAU,8BACb,SAAC9E,EAAA,KAAA,MAAA,CAAI,UAAU,oBACb,SAAA,CAACE,EAAA,IAAA,IAAA,CAAE,UAAU,6BAA6B,SAAQ,WAAA,QACjDE,EAAO,CAAA,QAAS,IAAMiD,EAAS,gBAAgB,EAAG,SAAI,OAAA,CAAA,CACzD,CAAA,CACF,CAAA,CA8gBN","x_google_ignoreList":[0]}