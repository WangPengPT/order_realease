import{j as e}from"./vendor-ui-C5i6UHrb.js";import{r as i,j as Ls,f as Ds,u as As,R as A,L as V}from"./vendor-react-iAJ0IrSD.js";import{t as o,i as O,v as K,w as U,s as Ts,a4 as ye,ar as Es,B as b,g as Ce,D as Se,b as _e,c as Le,d as De,r as te,ay as Ze,az as Oe,G as M,aA as oe,aB as es,L as Z,a2 as ss,aC as Rs,aD as ke,aE as Ps,ac as Is,aF as Be,W as as,aG as Ms,aH as ce,a5 as $,a6 as zs,a7 as Fs,a8 as $s,a9 as I,aa as He,M as le,aI as Os,ab as Bs,a3 as R,Q as Y,at as Hs,as as ts,a as qs,aJ as Us,a0 as Gs,ad as qe,aK as Ws,aL as Ue,af as fe,h as je,T as Ge,m as Xs,au as Js,av as Qs,aw as Vs,ax as Ks,J as We,$ as Xe,N as ve,k as Ys,ag as Zs,ah as ea,ai as sa,aj as aa,ak as ta,al as ra,am as na,an as ia}from"./index-IeyQ9IsG.js";import{S as Je}from"./separator-DC2g7jSL.js";import{C as la,a as oa,b as ca}from"./collapsible-C_wItHhQ.js";import{a as da,p as Qe}from"./xiaoxiong-logo-v3-Dh4_uO4V.js";import{b as ma,c as ha,a as ua,d as xa,e as pa,f as ga,g as fa,h as ja}from"./useActivities-CSfdKy14.js";import{u as va,a as wa,b as Na}from"./useActivityParticipation-Cqd0x6Cw.js";import{u as rs}from"./useLocalizedContent-DPVaEcf3.js";import ba from"./RestaurantComments-DeDlVZFI.js";import{m as q}from"./vendor-map-BaCLwlqt.js";/* empty css                  */import{m as ya,g as Ca,c as ka}from"./geolocation-DRm3QMsJ.js";import{u as G,i as Sa}from"./vendor-i18n-DxKeo2S1.js";import{C as Ve}from"./checkbox-BfvgDkmy.js";import{R as _a}from"./ReportDialog-rInbx1FF.js";import{A as La}from"./ActivityTermsAgreement-eTj8uyuZ.js";import{T as Da,a as Aa,b as we,c as Ne}from"./tabs-ThAze4Dl.js";import{u as Ta,a as Ea}from"./useGlobalHandbook-BMVSpEno.js";import{R as be}from"./RichTextEditor-DZMi29Pn.js";import{L as Ra}from"./LocationPermissionDialog-Di0Z8GLr.js";import{u as Pa,a as Ia,b as Ma,c as za}from"./useCoupons-D3OhfYuM.js";import{u as Fa}from"./usePageView-vdjWhBzU.js";import{u as ns}from"./vendor-query-BqhVR-X_.js";import{f as Ke}from"./format-0T4Sryes.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-DEeLm6rS.js";import"./index-B7diVh8u.js";import"./useSensitiveWords-D7qREHM9.js";import"./input-otp-BP6KZttl.js";import"./useActivityRules-BAjCebW1.js";import"./vendor-editor-BxSQdrX3.js";import"./startOfDay-BltGWtfz.js";const $a=()=>e.jsxs("div",{className:"min-h-screen bg-secondary/20 pb-8",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[e.jsx(o,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(o,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(o,{className:"h-10 w-10 rounded-md"}),e.jsx(o,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-20 relative z-10",children:[e.jsx(O,{className:"shadow-large",children:e.jsxs(K,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(o,{className:"h-6 w-16 rounded-full"}),e.jsx(o,{className:"h-6 w-20 rounded-full"}),e.jsx(o,{className:"h-6 w-24 rounded-full"})]}),e.jsx(o,{className:"h-9 w-3/4 mb-4"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsx(o,{className:"h-5 w-24"}),e.jsx(o,{className:"h-5 w-20"}),e.jsx(o,{className:"h-5 w-28"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"h-4 w-32"}),e.jsx(o,{className:"h-4 w-40"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"h-4 w-20"}),e.jsx(o,{className:"h-4 w-32"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(o,{className:"h-10 w-28 rounded-md"}),e.jsx(o,{className:"h-10 w-32 rounded-md"}),e.jsx(o,{className:"h-10 w-24 rounded-md"})]})]})}),e.jsxs(O,{className:"mt-6 shadow-large",children:[e.jsx(K,{children:e.jsx(o,{className:"h-6 w-36"})}),e.jsxs(U,{className:"space-y-3",children:[e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-5/6"}),e.jsx(o,{className:"h-4 w-4/5"})]})]}),e.jsxs(O,{className:"mt-6 shadow-large",children:[e.jsx(K,{children:e.jsx(o,{className:"h-6 w-28"})}),e.jsxs(U,{className:"space-y-2",children:[e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-3/4"})]})]}),e.jsxs(O,{className:"mt-6 shadow-large",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between",children:[e.jsx(o,{className:"h-6 w-40"}),e.jsx(o,{className:"h-5 w-24"})]}),e.jsxs(U,{children:[e.jsx(o,{className:"h-[200px] w-full rounded-lg mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(o,{className:"h-16 w-16 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(o,{className:"h-5 w-40"}),e.jsx(o,{className:"h-4 w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"h-5 w-16 rounded-full"}),e.jsx(o,{className:"h-5 w-12"})]})]})]},r))})]})]})]})]}),is=i.memo(({restaurants:r,onMarkerClick:d})=>{const{t:x}=G(),s=i.useRef(null),a=i.useRef(null),f=i.useRef([]),[N,p]=i.useState(!1),[m,k]=i.useState(null),h=i.useRef(null);return i.useEffect(()=>{if(!s.current||a.current)return;const P="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!q.supported()){console.warn("[ActivityMap] WebGL not supported",{isIOSDevice:Ts(),isIOSWebView:ye(),userAgent:navigator.userAgent}),k(x("map.webglNotSupported","Your browser does not support map display"));return}const g=()=>{if(!s.current)return;const j=s.current.getBoundingClientRect();if(console.log("[ActivityMap] Container dimensions:",j.width,j.height),j.width===0||j.height===0){setTimeout(g,100);return}try{q.accessToken=P;const l=r.reduce((u,v)=>u+Number(v.restaurants.lat||0),0)/r.length,c=r.reduce((u,v)=>u+Number(v.restaurants.lng||0),0)/r.length;a.current=new q.Map({container:s.current,style:"mapbox://styles/mapbox/light-v11",center:[c,l],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),a.current.on("error",u=>{console.error("[ActivityMap] Map error:",u),k(x("map.loadError","Map failed to load"))}),a.current.addControl(new q.NavigationControl,"top-right"),a.current.on("load",()=>{p(!0)})}catch(l){console.error("[ActivityMap] Failed to initialize map:",l),k(x("map.loadError","Map failed to load"))}};return g(),()=>{f.current.forEach(j=>j.remove()),f.current=[],h.current&&(h.current.remove(),h.current=null),a.current?.remove(),a.current=null,p(!1)}},[r.length,x]),i.useEffect(()=>{if(!a.current||!N||r.length===0)return;(()=>{if(f.current.forEach(g=>g.remove()),f.current=[],h.current&&(h.current.remove(),h.current=null),r.forEach(g=>{const j=Number(g.restaurants.lat),l=Number(g.restaurants.lng);if(isNaN(j)||isNaN(l))return;const c=document.createElement("div");c.className="p-3 min-w-[200px]",c.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${g.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${g.restaurants.address}</p>
          </div>
        `;const u=new q.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([l,j]).setDOMContent(c),v=document.createElement("div");v.className="custom-marker",v.style.backgroundImage=`url(${ya})`,v.style.width="40px",v.style.height="40px",v.style.backgroundSize="contain",v.style.backgroundRepeat="no-repeat",v.style.backgroundPosition="center",v.style.cursor="pointer";const C=new q.Marker({element:v,draggable:!1}).setLngLat([l,j]).addTo(a.current),y=C.getElement();y.style.cursor="pointer";const E=S=>{S.stopPropagation(),S.preventDefault(),h.current&&h.current!==u&&h.current.remove(),u.addTo(a.current),h.current=u,a.current.easeTo({center:[l,j],zoom:17,duration:800}),d&&d(g.restaurant_id)};y.addEventListener("click",E,!0),u.on("close",()=>{h.current===u&&(h.current=null)}),f.current.push(C)}),r.length>1){const g=new q.LngLatBounds;r.forEach(j=>{const l=Number(j.restaurants.lat),c=Number(j.restaurants.lng);!isNaN(l)&&!isNaN(c)&&g.extend([c,l])}),a.current?.fitBounds(g,{padding:50,maxZoom:14})}})()},[r,N,d]),r.length===0?null:m?e.jsxs("div",{className:"w-full h-[350px] rounded-lg bg-muted/50 flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(Es,{className:"w-10 h-10 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:m}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:x("map.viewListInstead","Please view the restaurant list below")}),ye()&&e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>window.open(window.location.href,"_blank"),children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),x("map.openInBrowser","Open in Browser")]})]}):e.jsx("div",{ref:s,className:"w-full h-[350px] rounded-lg"})});is.displayName="ActivityParticipationMap";const Oa=({open:r,onOpenChange:d,restaurants:x,participatingRestaurantIds:s,onConfirm:a,isPending:f,isParticipating:N})=>{const{t:p}=G(),{localizeRestaurant:m}=rs(),[k,h]=i.useState([]);i.useEffect(()=>{r&&h(s)},[r,s]);const P=l=>{h(c=>c.includes(l)?c.filter(u=>u!==l):[...c,l])},g=()=>{k.length===x.length?h([]):h(x.map(l=>l.id))},j=()=>{a(k)};return e.jsx(Se,{open:r,onOpenChange:d,children:e.jsxs(_e,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Le,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"选择参与的餐厅"]}),e.jsx(Ze,{children:"勾选要参与活动的餐厅，取消勾选将退出活动"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(Ve,{id:"select-all",checked:k.length===x.length,onCheckedChange:g}),e.jsxs(Oe,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["全选/取消全选 (",k.length,"/",x.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:x.map(l=>{const c=m(l),u=k.includes(l.id),v=s.includes(l.id);return e.jsx(O,{className:`transition-all ${u?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsx(U,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{id:l.id,checked:u,onCheckedChange:()=>P(l.id)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs(Oe,{htmlFor:l.id,className:"cursor-pointer flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold truncate",children:c.name}),v&&e.jsxs(M,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"已参与"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:l.address}),c.type&&c.type.length>0&&e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:c.type.slice(0,2).map((C,y)=>e.jsx(M,{variant:"outline",className:"text-xs",children:C},y))})]})]})})},l.id)})})]}),e.jsxs(es,{children:[e.jsx(b,{variant:"outline",onClick:()=>d(!1),disabled:f,children:p("common.cancel")}),e.jsx(b,{onClick:j,disabled:f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),p("common.loading")]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"确认 (",k.length,")"]})})]})]})})},Ye=({children:r})=>{const{t:d,i18n:x}=G(),{isAdmin:s}=ss(),{data:a,isLoading:f}=Ta(),N=Ea(),[p,m]=i.useState(!1),[k,h]=i.useState(!1),[P,g]=i.useState("zh"),[j,l]=i.useState(""),[c,u]=i.useState(""),[v,C]=i.useState("");i.useEffect(()=>{a&&(l(a.content_zh),u(a.content_en),C(a.content_pt))},[a]);const y=()=>{if(!a)return"";const ee=x.language;return ee==="zh"?a.content_zh||a.content_en||a.content_pt||"":ee==="pt"?a.content_pt||a.content_en||a.content_zh||"":a.content_en||a.content_zh||a.content_pt||""},E=a&&(a.content_zh||a.content_en||a.content_pt),S=async()=>{if(a)try{await N.mutateAsync({id:a.id,content_zh:j,content_en:c,content_pt:v}),Be({title:d("common.success"),description:d("activities.handbook.updateSuccess")}),h(!1)}catch{Be({title:d("common.error"),description:d("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Se,{open:p,onOpenChange:m,children:[e.jsx(Rs,{asChild:!0,children:r}),e.jsxs(_e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-primary"}),e.jsx(De,{children:d("activities.handbook.title")})]})}),f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary"})}):k&&s?e.jsx("div",{className:"space-y-4",children:e.jsxs(Da,{value:P,onValueChange:g,children:[e.jsxs(Aa,{className:"grid w-full grid-cols-3",children:[e.jsx(we,{value:"zh",children:"中文"}),e.jsx(we,{value:"en",children:"English"}),e.jsx(we,{value:"pt",children:"Português"})]}),e.jsx(Ne,{value:"zh",className:"mt-4",children:e.jsx(be,{value:j,onChange:l,placeholder:"请输入中文活动手册内容..."})}),e.jsx(Ne,{value:"en",className:"mt-4",children:e.jsx(be,{value:c,onChange:u,placeholder:"Enter English activity handbook content..."})}),e.jsx(Ne,{value:"pt",className:"mt-4",children:e.jsx(be,{value:v,onChange:C,placeholder:"Digite o conteúdo do manual da atividade em português..."})})]})}):e.jsx("div",{className:"space-y-4",children:E?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:y()}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:d("activities.handbook.empty")}),s&&e.jsx("p",{className:"text-sm mt-2",children:d("activities.handbook.addPrompt")})]})}),e.jsx(es,{className:"gap-2 sm:gap-0",children:k?e.jsxs(e.Fragment,{children:[e.jsx(b,{variant:"outline",onClick:()=>h(!1),children:d("common.cancel")}),e.jsxs(b,{onClick:S,disabled:N.isPending,children:[N.isPending?e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ps,{className:"w-4 h-4 mr-2"}),d("common.save")]})]}):s&&e.jsxs(b,{onClick:()=>h(!0),children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),d(E?"common.edit":"activities.handbook.add")]})})]})]})},Ba=({open:r,onOpenChange:d,activityTitle:x,activityId:s,onShareComplete:a,onShareAction:f,isProcessing:N=!1,hasAlreadyClaimed:p=!1})=>{const{t:m}=G(),k=as(),[h,P]=i.useState(!1),[g,j]=i.useState(!1);i.useEffect(()=>{j(typeof navigator<"u"&&!!navigator.share&&typeof navigator.canShare=="function")},[]);const l=async()=>{try{await navigator.clipboard.writeText(window.location.href),R.success(m("common.linkCopied")),P(!0),f?.()}catch(C){console.error("Error copying link:",C),R.error(m("common.shareError"))}},c=C=>{const y=encodeURIComponent(window.location.href),E=encodeURIComponent(`${x} - Xiaoxiong Market`);let S="";switch(C){case"whatsapp":S=`https://wa.me/?text=${E}%20${y}`;break;case"facebook":S=`https://www.facebook.com/sharer/sharer.php?u=${y}`;break;case"twitter":S=`https://twitter.com/intent/tweet?text=${E}&url=${y}`;break;case"telegram":S=`https://t.me/share/url?url=${y}&text=${E}`;break;case"linkedin":S=`https://www.linkedin.com/sharing/share-offsite/?url=${y}`;break;case"reddit":S=`https://reddit.com/submit?url=${y}&title=${E}`;break;case"line":S=`https://social-plugins.line.me/lineit/share?url=${y}`;break;case"wechat":l(),R.info(m("sharing.copiedForWeChat"));return;case"instagram":l(),R.info(m("sharing.copiedForInstagram"));return;default:return}ye()?window.location.href=S:window.open(S,"_blank","noopener,noreferrer"),P(!0),f?.()},u=async()=>{const C={title:x,text:`${x} - Xiaoxiong Market`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(C)?(await navigator.share(C),P(!0),f?.()):l()}catch(y){y.name!=="AbortError"&&(console.error("Error sharing:",y),R.error(m("common.shareError")))}},v=()=>{h&&a()};return e.jsx(Se,{open:r,onOpenChange:d,children:e.jsxs(_e,{className:"sm:max-w-md",children:[e.jsxs(Le,{children:[e.jsxs(De,{className:"flex items-center gap-2",children:[p?e.jsx(Ms,{className:"w-5 h-5 text-primary"}):e.jsx(ce,{className:"w-5 h-5 text-primary"}),m("shareDialog.title")]}),e.jsx(Ze,{className:"space-y-2",children:p?e.jsx("p",{className:"text-primary font-medium",children:m("shareDialog.alreadyShared")}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:m("shareDialog.description")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m("shareDialog.hint")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:k&&g?e.jsxs(b,{onClick:u,className:"w-full",variant:"default",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),m("sharing.shareToApps")]}):e.jsxs(zs,{children:[e.jsx(Fs,{asChild:!0,children:e.jsxs(b,{className:"w-full",variant:"default",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),m("sharing.selectPlatform")]})}),e.jsxs($s,{className:"w-56",children:[g&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{onClick:u,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),m("sharing.systemShare")]}),e.jsx(He,{})]}),e.jsxs(I,{onClick:()=>c("wechat"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(I,{onClick:()=>c("instagram"),children:[e.jsx(Os,{className:"w-4 h-4 mr-2"}),"Instagram"]}),e.jsxs(I,{onClick:()=>c("whatsapp"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(I,{onClick:()=>c("facebook"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(I,{onClick:()=>c("twitter"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(I,{onClick:()=>c("telegram"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsxs(I,{onClick:()=>c("linkedin"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"LinkedIn"]}),e.jsxs(I,{onClick:()=>c("line"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"LINE"]}),e.jsxs(I,{onClick:()=>c("reddit"),children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Reddit"]}),e.jsx(He,{}),e.jsxs(I,{onClick:l,children:[e.jsx(Bs,{className:"w-4 h-4 mr-2"}),m("common.copyLink")]})]})]})}),!p&&e.jsx(b,{onClick:v,disabled:!h||N,className:"w-full",variant:h?"default":"secondary",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}),m("shareDialog.claiming")]}):h?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),m("shareDialog.confirmButton")]}):m("shareDialog.shareFirst")})]})]})})},Ha=({activityId:r,initialCount:d=0})=>{const{t:x}=G(),s=ns(),[a,f]=i.useState(d),N=i.useCallback(async()=>{const{count:p}=await Y.from("activity_shares").select("*",{count:"exact",head:!0}).eq("activity_id",r);p!==null&&f(p)},[r]);return i.useEffect(()=>{f(d)},[d]),i.useEffect(()=>{const p=Y.channel(`share-count-${r}`).on("postgres_changes",{event:"*",schema:"public",table:"activity_shares",filter:`activity_id=eq.${r}`},()=>{N(),s.invalidateQueries({queryKey:["shareCount",r]})}).subscribe();return()=>{Y.removeChannel(p)}},[r,N,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Hs,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[a," ",x("activities.shareCount")]})]})},qa=({activityId:r,initialCount:d=0})=>{const{t:x}=G(),s=ns(),[a,f]=i.useState(d),N=i.useCallback(async()=>{const{count:p}=await Y.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",r);p!==null&&f(p)},[r]);return i.useEffect(()=>{f(d)},[d]),i.useEffect(()=>{const p=Y.channel(`subscriber-count-${r}`).on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`activity_id=eq.${r}`},()=>{N(),s.invalidateQueries({queryKey:["subscriberCount",r]})}).subscribe();return()=>{Y.removeChannel(p)}},[r,N,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(ts,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[a," ",x("activities.subscribersCount")]})]})},yt=()=>{const{id:r}=Ls(),d=Ds(),x=As(),{t:s}=G(),{user:a}=qs(),{isMerchant:f,isSupervisor:N,isAdmin:p}=ss(),{data:m}=Us(),{localizeActivity:k,localizeRestaurant:h,currentLang:P}=rs();as();const[g,j]=A.useState(!1),[l,c]=A.useState(!1),[u,v]=A.useState(null),[C,y]=A.useState(!1),[E,S]=A.useState(!1),[ee,de]=A.useState(!1),[ls,Ae]=A.useState(!1),[me,os]=A.useState(!0),[cs,he]=A.useState(!1),[ds,ue]=A.useState(!1),[ms,Te]=A.useState(!1),[hs,xe]=A.useState(!1);Fa({pageType:"activity",targetId:r}),da(r);const{data:re=[]}=Pa(r),{data:W=!1}=Ia(r),{data:pe}=Ma(),Ee=za(),B=re.length>0||!!pe,us=A.useCallback(t=>{x(`/restaurant/${t}`,{state:{fromActivity:r}})},[x,r]),Re=d.state?.from==="admin"?"/admin/activities":"/activities",{data:n,isLoading:xs}=ma(r),{data:X,isLoading:ps}=ha(r),{data:gs=[]}=ua(),fs=gs.map(t=>t.activity_id),{data:js=0}=xa(r),{data:vs=0}=pa(r),J=ga(),{data:T}=fa(n?.creator_id),ge=ja(),{data:z=[]}=va(),{data:H=[]}=wa(r),F=Na(),L=n?k(n):null,Pe=n?fs.includes(n.id):!1,se=f||N,ws=i.useCallback(()=>{!a||!n||ge.mutate(n.id)},[a,n,ge]),ne=z.filter(t=>H.includes(t.id)).length,ae=ne>0;z.length,ne>0&&ne<z.length;const Ns=i.useCallback(()=>{if(!(!n||!se||z.length===0))if(N)de(!0);else if(ae)for(const t of z)H.includes(t.id)&&F.mutate({activityId:n.id,restaurantId:t.id});else for(const t of z)F.mutate({activityId:n.id,restaurantId:t.id})},[n,se,z,N,ae,H,F]),bs=i.useCallback(t=>{if(!n)return;const _=t.filter(w=>!H.includes(w)),D=H.filter(w=>!t.includes(w));_.forEach(w=>{F.mutate({activityId:n.id,restaurantId:w})}),D.forEach(w=>{F.mutate({activityId:n.id,restaurantId:w})}),de(!1)},[n,H,F]),ys=i.useCallback(()=>{ue(!0)},[]),Cs=i.useCallback(async()=>{ue(!1),S(!0);try{const t=await Ca();v({lat:t.coords.latitude,lng:t.coords.longitude}),y(!0),R.success(s("map.locationEnabled"))}catch(t){console.error("Location error:",t),y(!1)}finally{S(!1)}},[s]);i.useCallback(()=>{v(null),y(!1)},[]),A.useEffect(()=>{if(a&&B&&!W&&me){const t=setTimeout(()=>{os(!1)},3e3);return()=>clearTimeout(t)}},[a,B,W,me]);const Ie=i.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),R.success(s("common.linkCopied"))}catch(t){console.error("Error copying link:",t),R.error(s("common.shareError"))}},[s]),Me=i.useCallback(async()=>{if(!n||!L)return;const t={title:L.title,text:`${L.title} - Xiaoxiong Market

${L.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&typeof navigator.canShare=="function"&&navigator.canShare(t)?(await navigator.share(t),R.success(s("common.shareSuccess"))):Ie()}catch(_){_.name!=="AbortError"&&(console.error("Error sharing:",_),R.error(s("common.shareError")))}},[n,L,Ie,s]),ks=i.useCallback(()=>{if(!(!n||!L)){if(!a){xe(!0);return}B?he(!0):(Me(),J.mutateAsync({activityId:r,userId:a.id}).catch(()=>{}))}},[n,L,a,B,Me,J,r]),Ss=i.useCallback(async()=>{if(!(!n||!a)){Te(!0);try{await J.mutateAsync({activityId:r,userId:a.id});const t=re.length>0?re[0]:pe;t&&(await Ee.mutateAsync({templateId:t.id,activityId:r,source:"share"}),R.success(s("coupon.claimSuccess"))),he(!1)}catch(t){console.error("Error claiming coupon:",t),R.error(s("common.error"))}finally{Te(!1)}}},[n,a,J,r,re,pe,Ee,s]),_s=i.useCallback(()=>{!a||!r||J.mutateAsync({activityId:r,userId:a.id}).catch(t=>{console.log("Share already recorded or error:",t)})},[a,r,J]),Q=i.useMemo(()=>{if(!X)return[];const t=X.map(_=>{if(u){const D=ka(u.lat,u.lng,Number(_.restaurants.lat),Number(_.restaurants.lng));return{..._,distance:D}}return{..._,distance:void 0}});return C&&u?t.sort((_,D)=>_.distance!==void 0&&D.distance!==void 0?_.distance-D.distance:0):t.sort((_,D)=>{const w=Number(_.restaurants.rating)||0;return(Number(D.restaurants.rating)||0)-w})},[X,C,u]);if(xs)return e.jsx($a,{});if(!n||!L||n.status==="draft"&&!p)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(b,{asChild:!0,className:"mt-4",children:e.jsx(V,{to:Re,children:s("common.back")})})]})});const ze=new Date(n.start_date),ie=n.end_date?new Date(n.end_date):null,Fe=ie?new Date<=ie:new Date>=ze;return e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[n.media_type==="video"&&n.video_url?e.jsx("video",{src:n.video_url,poster:n.image_url||void 0,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,autoPlay:!0}):e.jsx("img",{src:n.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:L.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(b,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(V,{to:Re,children:e.jsx(Gs,{className:"w-5 h-5"})})}),a&&se&&m&&!m.activity_terms_agreed&&e.jsxs(V,{to:"/profile?tab=activities",className:"absolute top-4 left-16 bg-destructive/95 backdrop-blur-sm text-destructive-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse flex items-center gap-1.5 hover:bg-destructive transition-colors",children:[e.jsx(qe,{className:"w-3.5 h-3.5"}),s("activities.termsNotAgreed")]}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 items-start",children:[n.status==="draft"&&p&&e.jsxs(M,{variant:"outline",className:"bg-amber-500/90 text-white border-amber-600",children:[e.jsx(Ws,{className:"w-3 h-3 mr-1"}),s("admin.activities.draftPreview")]}),n.pinned&&e.jsx(M,{className:"bg-accent",children:s("activities.pinned")}),e.jsx(_a,{targetType:"activity",targetId:n.id,onLoginRequired:()=>xe(!0),trigger:e.jsx(b,{variant:"secondary",size:"icon",className:"shadow-lg",children:e.jsx(qe,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs(b,{variant:"secondary",size:"icon",className:"shadow-lg relative",onClick:ks,children:[e.jsx($,{className:"w-5 h-5"}),B&&!W&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(ce,{className:"w-2.5 h-2.5"})}),B&&W&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(oe,{className:"w-2.5 h-2.5"})})]}),a&&B&&!W&&me&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-primary/95 backdrop-blur-sm text-primary-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse z-10",children:[e.jsx(ce,{className:"w-3 h-3 inline mr-1"}),s("activities.shareToGetCoupon")]})]})]})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(O,{className:"shadow-large",children:[e.jsxs(K,{className:"relative",children:[e.jsx("div",{className:"hidden sm:block absolute top-4 right-4",children:e.jsx(Ye,{children:e.jsxs(b,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),s("activities.handbook.button")]})})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:pr-32",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(M,{variant:Fe?"default":"secondary",children:s(Fe?"activities.ongoing":"activities.ended")}),n.repeat_mode&&n.repeat_mode!=="none"&&n.repeat_mode!=="days_before"&&e.jsx(M,{variant:"outline",children:s(`activities.repeat.${n.repeat_mode}`)}),n.service_type&&e.jsxs(M,{variant:"outline",className:"flex items-center gap-1.5",children:[n.service_type==="dine_in"&&e.jsx(fe,{className:"w-3.5 h-3.5"}),n.service_type==="takeaway"&&e.jsx(je,{className:"w-3.5 h-3.5"}),n.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-3.5 h-3.5"}),e.jsx(je,{className:"w-3.5 h-3.5"})]}),s(`activities.serviceType.${n.service_type}`)]}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ye,{children:e.jsxs(b,{variant:"outline",size:"sm",className:"gap-1.5 h-7 px-2",children:[e.jsx(Ue,{className:"w-3.5 h-3.5"}),s("activities.handbook.button")]})})})]}),e.jsx(Ge,{className:"text-3xl",children:L.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Xs,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[Ke(ze,"PPP"),ie&&` - ${Ke(ie,"PPP")}`]})]}),e.jsx(qa,{activityId:r,initialCount:js}),e.jsx(Ha,{activityId:r,initialCount:vs}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(te,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[X?.length||0," ",s("activities.restaurantsParticipating")]})]}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Js,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:s("activities.creatorLabel")}),T?.isAdmin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Qe,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]}):T?.restaurant?e.jsxs(V,{to:`/restaurant/${T.restaurant.id}`,className:"flex items-center gap-1",onClick:t=>t.stopPropagation(),children:[T.avatar_url?e.jsxs(Qs,{className:"w-4 h-4",children:[e.jsx(Vs,{src:T.avatar_url,alt:"Creator"}),e.jsx(Ks,{className:"text-[8px]",children:T.restaurant.name.charAt(0)})]}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-medium",children:T.restaurant.name.charAt(0)})}),e.jsx("span",{className:"text-primary font-medium hover:underline",children:(()=>{const t=Sa.language;return t==="zh"?T.restaurant.name:t==="pt"?T.restaurant.name_pt||T.restaurant.name_en||T.restaurant.name:T.restaurant.name_en||T.restaurant.name})()})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Qe,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]})]})]}),a&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[se&&z.length>0&&(m?.activity_terms_agreed?e.jsx(b,{onClick:Ns,disabled:F.isPending,size:"lg",variant:ae?"outline":"default",className:"w-full sm:w-auto",children:N?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"选择参与的餐厅"]}):ae?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"退出活动"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"参与活动"]})}):e.jsx(b,{onClick:()=>Ae(!0),size:"lg",variant:"outline",className:"w-full sm:w-auto text-muted-foreground",children:s("activities.agreeTermsFirst")})),e.jsx(b,{onClick:ws,disabled:ge.isPending,size:"lg",variant:Pe?"outline":"secondary",className:"w-full sm:w-auto",children:Pe?e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2 fill-current"}),s("activities.favorited")||"已收藏"]}):e.jsxs(e.Fragment,{children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),s("activities.favorite")||"收藏活动"]})})]}),!a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("activities.signInToJoin")}),e.jsxs("p",{className:"text-xs text-muted-foreground/80 flex items-center gap-1.5",children:[e.jsx(ts,{className:"w-3.5 h-3.5"}),s("activities.signInToJoinHint")]})]})]})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("activities.about")}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline\r
                  [&_*]:!text-inherit [&_span[style*='color']]:!text-muted-foreground`,dangerouslySetInnerHTML:{__html:L.content}})]}),L.usage_instructions&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ke,{className:"w-6 h-6 text-primary"}),s("activities.usageInstructions")]}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                      prose-headings:text-foreground prose-headings:font-semibold\r
                      prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                      prose-p:leading-relaxed prose-p:my-3\r
                      prose-strong:text-foreground prose-strong:font-semibold\r
                      prose-ul:my-3 prose-ol:my-3\r
                      prose-li:my-1\r
                      prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:L.usage_instructions}})]})]}),e.jsx(Je,{}),ps?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(Z,{className:"w-6 h-6 animate-spin text-primary"})}):X&&X.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx(la,{open:g,onOpenChange:j,children:e.jsxs(O,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[e.jsx(K,{className:"pb-3",children:e.jsx(oa,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(Ge,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[e.jsx(te,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),s("activities.participatingRestaurants")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{variant:"secondary",className:"transition-opacity duration-200",children:s(g?"common.showLess":"common.showDetails")}),e.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:g?"rotate(180deg)":"rotate(0deg)"},children:e.jsx(Xe,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),e.jsx(ca,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:e.jsxs(U,{className:"pt-0 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:C?e.jsxs(M,{variant:"default",className:"flex items-center gap-1.5",children:[e.jsx(ve,{className:"w-3.5 h-3.5"}),s("activities.sortByLocationEnabled")]}):e.jsxs(b,{variant:"outline",size:"sm",onClick:ys,disabled:E,children:[E?e.jsx(Z,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ve,{className:"w-4 h-4 mr-2"}),s("activities.enableLocationSort")]})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(l?Q:Q.slice(0,6)).map((t,_)=>{const D=h(t.restaurants);return e.jsxs(O,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in h-full flex flex-col",style:{animationDelay:`${_*50}ms`,animationFillMode:"forwards"},children:[e.jsx(V,{to:`/restaurant/${t.restaurant_id}`,state:{fromActivity:n.id},className:"block",children:e.jsxs("div",{className:"relative h-40 overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:t.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:D.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),D.type&&D.type.length>0&&e.jsx("div",{className:"absolute top-2 left-2 flex flex-wrap gap-1",children:D.type.slice(0,3).map((w,$e)=>e.jsx(M,{className:"bg-primary",children:w},$e))})]})}),e.jsxs(U,{className:"pt-4 pb-4 flex flex-col flex-grow",children:[e.jsxs(V,{to:`/restaurant/${t.restaurant_id}`,state:{fromActivity:n.id},className:"block",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1 hover:text-primary transition-colors",children:D.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx(Ce,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:t.restaurants.address})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ys,{className:`w-4 h-4 ${t.restaurants.rating?"fill-accent text-accent":"text-muted-foreground"}`}),t.restaurants.rating?e.jsx("span",{className:"font-semibold text-sm",children:t.restaurants.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[s("restaurant.noRatingLine1"),e.jsx("br",{}),s("restaurant.noRatingLine2")]})]}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[t.distance.toFixed(1)," km"]})]})]}),t.restaurants.website_url&&(t.restaurants.show_takeaway_button!==!1||t.restaurants.show_booking_button!==!1)&&e.jsxs("div",{className:"flex gap-2 mt-3 pt-3 border-t border-border/50",children:[t.restaurants.show_takeaway_button!==!1&&e.jsxs(b,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{try{const w=new URL(t.restaurants.website_url);w.pathname="/table",a?.id&&w.searchParams.set("user_id",a.id),window.open(w.toString(),"_blank")}catch(w){console.error("Invalid URL:",w)}},children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),s("restaurant.takeawayOrder")]}),t.restaurants.show_booking_button!==!1&&e.jsxs(b,{size:"sm",variant:"outline",className:"flex-1",onClick:()=>{try{const w=new URL(t.restaurants.website_url);w.pathname="/reservePage",a?.id&&w.searchParams.set("user_id",a.id),window.open(w.toString(),"_blank")}catch(w){console.error("Invalid URL:",w)}},children:[e.jsx(fe,{className:"w-4 h-4 mr-1"}),s("restaurant.tableBooking")]})]})]})]},t.id)})}),Q.length>6&&!l&&e.jsxs(b,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>c(!0),children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"查看更多 (",Q.length-6," 个餐厅)"]})]})})]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(Ce,{className:"w-6 h-6"}),s("activities.participatingRestaurants")," (",Q.length,")"]}),e.jsx(is,{restaurants:Q,onMarkerClick:us})]})]}):null,e.jsx(ba,{restaurantId:n.id,targetType:"activity"})]})]})}),N&&e.jsx(Oa,{open:ee,onOpenChange:de,restaurants:z,participatingRestaurantIds:H,onConfirm:bs,isPending:F.isPending,isParticipating:ae}),se&&e.jsx(La,{isAgreed:m?.activity_terms_agreed||!1,agreedAt:m?.activity_terms_agreed_at||null,open:ls,onOpenChange:Ae}),e.jsx(Ba,{open:cs,onOpenChange:he,activityTitle:L?.title||"",activityId:r,onShareComplete:Ss,onShareAction:_s,isProcessing:ms,hasAlreadyClaimed:W}),e.jsx(Ra,{open:ds,onOpenChange:ue,onConfirm:Cs}),e.jsx(Zs,{open:hs,onOpenChange:xe,children:e.jsxs(ea,{children:[e.jsxs(sa,{children:[e.jsx(aa,{children:s("activities.loginRequired")}),e.jsx(ta,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(ra,{children:[e.jsx(na,{children:s("common.cancel")}),e.jsx(ia,{onClick:()=>x("/auth"),children:s("activities.goToLogin")})]})]})})]})};export{yt as default};
//# sourceMappingURL=ActivityDetail-oYriWevS.js.map
