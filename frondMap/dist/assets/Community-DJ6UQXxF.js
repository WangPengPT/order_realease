import{p as q,u as as,r as m,j as e,ea as te,bm as rs,cr as ns,bf as de,bD as Le,ba as is,b5 as ye,be as ls,bJ as Ee,bI as ge,ao as cs,b4 as fe,X as Z,em as Te,a4 as Y,a_ as De,en as M,eo as os,bN as ve,aM as ae,bh as Ne,eb as ds,ec as Fe,ay as ms,aw as us,w as S,ak as $e,bW as ce,d0 as xs,q as Me,v as ps,bR as oe,b7 as hs,ep as gs,cQ as fs,eq as js,bc as ys,bb as vs}from"./vendor-react-CQNN3SAN.js";import{u as Ns,g as G,P as bs,Q as ws,R as ks,D as Cs,W as Ss,c as _s,d as Rs,e as Ps,a as me,I as z,B as T,i as $,S as Ae,U as O,a8 as be,a2 as Is,a3 as Us,a4 as Ls,a5 as Es,a6 as Ts,s as U,G as Ds,af as Fs,ak as $s,ag as Ms,al as As,j as J}from"./index-a3KLXDOT.js";import{a as qs,f as Os,g as zs,h as Bs,u as Hs,i as Vs}from"./useCommunityPosts-D1risybg.js";import{u as ue}from"./useLocalizedContent-CVuSz_c7.js";import{c as Gs}from"./usePoints-CFLIzlei.js";import{D as we,b as ke,c as Ce,d as Se,f as qe}from"./drawer-BlJ5n-0A.js";import{P as _e,a as Re,b as Pe}from"./popover-D0K5_EPU.js";import{P as Ks}from"./progress-DEQBdeZ5.js";import{C as Qs,a as Ws,b as Xs}from"./collapsible-ChShm8P4.js";import{u as Js}from"./useActivities-CRe2wJIA.js";import{u as Ys}from"./useRestaurants-B84fhcaB.js";import{P as Zs}from"./PullToRefresh-BxfqBB7c.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-BUZyZFPD.js";const et=({post:t,showAssociations:a=!1})=>{const{t:s}=q(),{user:v}=Ns(),o=as(),{getLocalizedField:d}=ue(),g=qs(),[u,n]=m.useState(!1),x=t,f=x.post_type==="recipe",w=i=>{i.preventDefault(),i.stopPropagation(),v&&g.mutate({postId:t.id,liked:t.user_liked||!1})},l=()=>o(`/community/${t.id}`),h=(i,y)=>{i.preventDefault(),i.stopPropagation(),o(`/restaurant/${y}`)},p=i=>{i.preventDefault(),i.stopPropagation(),t.activity?.id&&o(`/activity/${t.activity.id}`)},r=i=>new DOMParser().parseFromString(i,"text/html").body.textContent||"",N=d(t,"content"),j=r(N),C=t.image_urls&&t.image_urls.length>0,_=!!t.video_url,R=C||_,D=t.image_urls?.length||0,I=[...t.restaurants||[],...t.restaurant&&!t.restaurants?.find(i=>i.id===t.restaurant?.id)?[t.restaurant]:[]],V=t.activity?d(t.activity,"title"):null,B=2,F=i=>{switch(i){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},c=i=>{switch(i){case"easy":return s("recipe.difficulty.easy","ç®€å•");case"medium":return s("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return s("recipe.difficulty.hard","å›°éš¾");default:return i}};return e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1",onClick:l,children:[R&&e.jsxs("div",{className:`relative ${f?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[C?u?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:s("common.imageLoadError","å›¾ç‰‡åŠ è½½å¤±è´¥")})}):e.jsx("img",{src:t.image_urls[0],alt:"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>n(!0)}):_?e.jsx("video",{src:t.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,f&&e.jsxs(G,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),s("recipe.badge","é£Ÿè°±")]}),_&&!f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(rs,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!_&&D>1&&!f&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:D})]})]}),!R&&f&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(te,{className:"h-12 w-12 text-primary/40"}),e.jsxs(G,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),s("recipe.badge","é£Ÿè°±")]})]}),e.jsxs("div",{className:"p-3",children:[f&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[x.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[x.cook_time,s("recipe.min","åˆ†")]})]}),x.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[x.servings,s("recipe.servingsShort","äºº")]})]}),x.difficulty&&e.jsx(G,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${F(x.difficulty)}`,children:c(x.difficulty)})]}),a&&(I.length>0||V)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[I.slice(0,B).map(i=>e.jsxs(G,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:y=>h(y,i.id),children:[e.jsx(is,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:d(i,"name")})]},i.id)),I.length>B&&e.jsxs(G,{variant:"secondary",className:"text-xs gap-1",children:["+",I.length-B]}),V&&e.jsxs(G,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:p,children:[e.jsx(ye,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:V})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${R?"":"min-h-[60px]"}`,children:f?x.recipe_name:j}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsxs(bs,{className:"h-5 w-5 flex-shrink-0",children:[e.jsx(ws,{src:t.author?.avatar_url||void 0}),e.jsx(ks,{className:"text-[10px]",children:t.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:t.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${t.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:w,disabled:!v,children:[e.jsx(ls,{className:`h-4 w-4 ${t.user_liked?"fill-current":""}`}),e.jsx("span",{children:t.likes_count||0})]})]})]})]})},st=()=>{const{t}=q(),{data:a}=Gs(),s=a?.find(d=>d.key==="post_points")?.value||"5",v=a?.find(d=>d.key==="min_post_length")?.value||"10",o=a?.find(d=>d.key==="post_require_media")?.value==="true";return e.jsxs(Cs,{children:[e.jsx(Ss,{asChild:!0,children:e.jsx("button",{className:"text-primary hover:underline text-sm whitespace-nowrap",children:t("community.viewPointsRules","æŸ¥çœ‹è¯¦ç»†è§„åˆ™")})}),e.jsxs(_s,{className:"max-w-md",children:[e.jsx(Rs,{children:e.jsxs(Ps,{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-primary"}),t("community.pointsRulesTitle","å‘å¸–ç§¯åˆ†è§„åˆ™")]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:t("community.pointsRulesIntro","é€šè¿‡å‘å¸ƒç¤¾åŒºå¸–å­èŽ·å¾—ç§¯åˆ†ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š")}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.rulePostPoints",{points:s})})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleMinLength",{length:v})})]}),o&&e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ge,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleRequireMedia","å¸–å­å¿…é¡»åŒ…å«è‡³å°‘ä¸€å¼ å›¾ç‰‡æˆ–ä¸€ä¸ªè§†é¢‘")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(de,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleDailyLimit","æ¯å¤©ä»…å¯é€šè¿‡å‘å¸–èŽ·å¾—ä¸€æ¬¡ç§¯åˆ†å¥–åŠ±")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(cs,{className:"h-4 w-4 text-purple-500 mt-0.5 shrink-0"}),e.jsx("span",{children:t("community.ruleModerationRequired","å¸–å­éœ€é€šè¿‡å®¡æ ¸åŽæ‰èƒ½èŽ·å¾—ç§¯åˆ†")})]})]})]})]})]})},tt=({open:t,onOpenChange:a,value:s,onSelect:v,restaurants:o,required:d=!1,maxDisplay:g=2})=>{const{t:u}=q(),{getLocalizedField:n}=ue(),x=me(),[f,w]=m.useState(""),[l,h]=m.useState(s),[p,r]=m.useState("85vh");m.useEffect(()=>{if(!t||!x)return;const c=window.visualViewport;if(!c){r("85vh");return}const i=()=>{const y=c.height,A=Math.min(y*.85,y-50);r(`${A}px`)};return i(),c.addEventListener("resize",i),()=>{c.removeEventListener("resize",i)}},[t,x]);const N=c=>{c&&(h(s),w("")),a(c)},j=o?.filter(c=>{if(!f)return!0;const i=n(c,"name")?.toLowerCase()||"",y=c.address?.toLowerCase()||"",A=f.toLowerCase();return i.includes(A)||y.includes(A)})||[],C=c=>{h(i=>i.includes(c)?i.filter(y=>y!==c):[...i,c])},_=()=>{v(l),a(!1),w("")},R=c=>{const i=s.includes(c)?s.filter(y=>y!==c):[...s,c];v(i)},I=s.map(c=>{const i=o?.find(y=>y.id===c);return i?n(i,"name"):null}).filter(Boolean),V=()=>{if(I.length===0)return e.jsxs("span",{className:"text-muted-foreground",children:[u("community.linkRestaurants","å…³è”é¤åŽ…"),d&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]});const c=I.slice(0,g),i=I.length-g;return e.jsxs("span",{className:"text-primary flex items-center gap-1 flex-wrap",children:[c.map((y,A)=>e.jsxs("span",{children:[y,A<c.length-1?"ã€":""]},A)),i>0&&e.jsxs(G,{variant:"secondary",className:"text-xs px-1.5 py-0",children:["+",i]})]})},B=e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm hover:text-primary transition-colors text-left",onClick:()=>N(!0),children:[e.jsx(V,{}),e.jsx(Te,{className:"h-4 w-4 opacity-50 shrink-0"})]}),F=({restaurant:c,isSelected:i,onToggle:y})=>e.jsxs("div",{className:$("flex items-start gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors",i?"bg-primary/10":"hover:bg-muted"),onClick:y,children:[e.jsx("div",{className:$("h-5 w-5 shrink-0 mt-0.5 rounded border flex items-center justify-center transition-colors",i?"bg-primary border-primary":"border-muted-foreground/30"),children:i&&e.jsx(Y,{className:"h-3 w-3 text-primary-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:n(c,"name")}),c.address&&e.jsxs("p",{className:"text-sm text-muted-foreground truncate flex items-center gap-1 mt-0.5",children:[e.jsx(De,{className:"h-3 w-3 shrink-0"}),c.address]})]})]});return x?e.jsxs(e.Fragment,{children:[B,e.jsx(we,{open:t,onOpenChange:N,children:e.jsxs(ke,{className:"flex flex-col",style:{height:p,maxHeight:p,transition:"height 0.15s ease-out, max-height 0.15s ease-out"},children:[e.jsx(Ce,{className:"pb-2 shrink-0",children:e.jsxs(Se,{children:[u("community.selectRestaurants","é€‰æ‹©é¤åŽ…"),l.length>0&&e.jsx(G,{variant:"secondary",className:"ml-2",children:l.length})]})}),e.jsx("div",{className:"px-4 pb-3 shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:u("community.searchRestaurant","æœç´¢é¤åŽ…..."),value:f,onChange:c=>w(c.target.value),className:"pl-9"})]})}),l.length>0&&e.jsx("div",{className:"px-4 pb-3 shrink-0",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:l.map(c=>{const i=o?.find(y=>y.id===c);return i?e.jsxs(G,{variant:"secondary",className:"gap-1 pr-1",children:[e.jsx("span",{className:"truncate max-w-[120px]",children:n(i,"name")}),e.jsx("button",{type:"button",className:"hover:bg-muted-foreground/20 rounded-full p-0.5",onClick:y=>{y.stopPropagation(),h(A=>A.filter(H=>H!==c))},children:e.jsx(Z,{className:"h-3 w-3"})})]},c):null})})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 min-h-0",children:e.jsxs("div",{className:"space-y-1 pb-4",children:[j.map(c=>e.jsx(F,{restaurant:c,isSelected:l.includes(c.id),onToggle:()=>C(c.id)},c.id)),j.length===0&&f&&e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:u("community.noRestaurantFound","æœªæ‰¾åˆ°åŒ¹é…çš„é¤åŽ…")})]})}),e.jsx(qe,{className:"pt-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{variant:"outline",className:"flex-1",onClick:()=>N(!1),children:u("common.cancel","å–æ¶ˆ")}),e.jsxs(T,{className:"flex-1",onClick:_,children:[u("community.confirmSelection","ç¡®è®¤é€‰æ‹©"),l.length>0&&` (${l.length})`]})]})})]})})]}):e.jsxs(_e,{open:t,onOpenChange:N,children:[e.jsx(Re,{asChild:!0,children:B}),e.jsxs(Pe,{className:"w-80 p-0",align:"start",children:[e.jsx("div",{className:"p-3 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx(fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:u("community.searchRestaurant","æœç´¢é¤åŽ…..."),value:f,onChange:c=>w(c.target.value),className:"pl-9"})]})}),s.length>0&&e.jsx("div",{className:"p-3 border-b",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map(c=>{const i=o?.find(y=>y.id===c);return i?e.jsxs(G,{variant:"secondary",className:"gap-1 pr-1",children:[e.jsx("span",{className:"truncate max-w-[100px]",children:n(i,"name")}),e.jsx("button",{type:"button",className:"hover:bg-muted-foreground/20 rounded-full p-0.5",onClick:y=>{y.stopPropagation(),R(c)},children:e.jsx(Z,{className:"h-3 w-3"})})]},c):null})})}),e.jsxs("div",{className:"max-h-64 overflow-y-auto p-2",children:[j.map(c=>e.jsx(F,{restaurant:c,isSelected:s.includes(c.id),onToggle:()=>R(c.id)},c.id)),j.length===0&&f&&e.jsx("div",{className:"py-4 text-center text-muted-foreground text-sm",children:u("community.noRestaurantFound","æœªæ‰¾åˆ°åŒ¹é…çš„é¤åŽ…")})]})]})]})},Oe=m.forwardRef(({className:t,...a},s)=>e.jsx(M,{ref:s,className:$("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...a}));Oe.displayName=M.displayName;const at=m.forwardRef(({className:t,...a},s)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(fe,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(M.Input,{ref:s,className:$("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...a})]}));at.displayName=M.Input.displayName;const ze=m.forwardRef(({className:t,...a},s)=>e.jsx(M.List,{ref:s,className:$("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...a}));ze.displayName=M.List.displayName;const rt=m.forwardRef((t,a)=>e.jsx(M.Empty,{ref:a,className:"py-6 text-center text-sm",...t}));rt.displayName=M.Empty.displayName;const Be=m.forwardRef(({className:t,...a},s)=>e.jsx(M.Group,{ref:s,className:$("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...a}));Be.displayName=M.Group.displayName;const nt=m.forwardRef(({className:t,...a},s)=>e.jsx(M.Separator,{ref:s,className:$("-mx-1 h-px bg-border",t),...a}));nt.displayName=M.Separator.displayName;const je=m.forwardRef(({className:t,...a},s)=>e.jsx(M.Item,{ref:s,className:$("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",t),...a}));je.displayName=M.Item.displayName;const it=({open:t,onOpenChange:a,value:s,onSelect:v,activities:o})=>{const{t:d}=q(),{getLocalizedField:g}=ue(),u=me(),[n,x]=m.useState(s),f=r=>{r&&x(s),a(r)},w=()=>{if(!s)return"";const r=o?.find(N=>N.id===s);return r?g(r,"title"):""},l=()=>{v(n),a(!1)},h=r=>{v(r),a(!1)},p=e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm hover:text-primary transition-colors",onClick:()=>f(!0),children:[s?e.jsx("span",{className:"text-primary",children:w()}):e.jsx("span",{className:"text-muted-foreground",children:d("community.linkActivity","å…³è”æ´»åŠ¨")}),e.jsx(Te,{className:"h-4 w-4 opacity-50"})]});return u?e.jsxs(e.Fragment,{children:[p,e.jsx(we,{open:t,onOpenChange:f,children:e.jsxs(ke,{className:"max-h-[85vh] flex flex-col",children:[e.jsx(Ce,{className:"pb-2",children:e.jsx(Se,{children:d("community.selectActivity","é€‰æ‹©æ´»åŠ¨")})}),e.jsx(Ae,{className:"flex-1 px-4",children:e.jsxs("div",{className:"space-y-1 pb-4",children:[e.jsxs("div",{className:$("flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors",n===""?"bg-primary/10":"hover:bg-muted"),onClick:()=>x(""),children:[e.jsx(Y,{className:$("h-4 w-4 shrink-0",n===""?"opacity-100 text-primary":"opacity-0")}),e.jsx("span",{className:"text-muted-foreground",children:d("community.noActivity","ä¸å…³è”æ´»åŠ¨")})]}),o.map(r=>e.jsxs("div",{className:$("flex items-center gap-3 py-3 px-3 rounded-lg cursor-pointer transition-colors",n===r.id?"bg-primary/10":"hover:bg-muted"),onClick:()=>x(r.id),children:[e.jsx(Y,{className:$("h-4 w-4 shrink-0",n===r.id?"opacity-100 text-primary":"opacity-0")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground shrink-0"}),e.jsx("span",{className:"font-medium",children:g(r,"title")})]})]},r.id)),o.length===0&&e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:d("activities.noActivities","æš‚æ— å¯ç”¨æ´»åŠ¨")})]})}),e.jsx(qe,{className:"pt-2",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{variant:"outline",className:"flex-1",onClick:()=>f(!1),children:d("common.cancel","å–æ¶ˆ")}),e.jsx(T,{className:"flex-1",onClick:l,children:d("community.confirmSelection","ç¡®è®¤é€‰æ‹©")})]})})]})})]}):e.jsxs(_e,{open:t,onOpenChange:f,children:[e.jsx(Re,{asChild:!0,children:p}),e.jsx(Pe,{className:"w-72 p-0",align:"start",children:e.jsx(Oe,{children:e.jsx(ze,{children:e.jsxs(Be,{children:[e.jsxs(je,{value:"none",onSelect:()=>h(""),children:[e.jsx(Y,{className:$("mr-2 h-4 w-4",s?"opacity-0":"opacity-100")}),d("community.noActivity","ä¸å…³è”æ´»åŠ¨")]}),o.map(r=>e.jsxs(je,{value:r.id,onSelect:()=>h(r.id),children:[e.jsx(Y,{className:$("mr-2 h-4 w-4",s===r.id?"opacity-100":"opacity-0")}),g(r,"title")]},r.id))]})})})})]})},Ue=[{name:"smileys",emojis:["ðŸ˜€","ðŸ˜ƒ","ðŸ˜„","ðŸ˜","ðŸ˜†","ðŸ˜…","ðŸ¤£","ðŸ˜‚","ðŸ™‚","ðŸ˜Š","ðŸ˜‡","ðŸ¥°","ðŸ˜","ðŸ¤©","ðŸ˜˜","ðŸ˜—","ðŸ˜š","ðŸ˜‹","ðŸ˜›","ðŸ˜œ","ðŸ¤ª","ðŸ˜","ðŸ¤‘","ðŸ¤—","ðŸ¤­","ðŸ¤«","ðŸ¤”","ðŸ¤","ðŸ¤¨","ðŸ˜","ðŸ˜‘","ðŸ˜¶","ðŸ˜","ðŸ˜’","ðŸ™„","ðŸ˜¬","ðŸ¤¥","ðŸ˜Œ","ðŸ˜”","ðŸ˜ª","ðŸ¤¤","ðŸ˜´","ðŸ˜·","ðŸ¤’","ðŸ¤•","ðŸ¤¢","ðŸ¤®","ðŸ¥µ","ðŸ¥¶","ðŸ¥´","ðŸ˜µ","ðŸ¤¯","ðŸ¤ ","ðŸ¥³","ðŸ˜Ž","ðŸ¤“","ðŸ§"]},{name:"gestures",emojis:["ðŸ‘","ðŸ‘Ž","ðŸ‘Œ","ðŸ¤Œ","âœŒï¸","ðŸ¤ž","ðŸ¤Ÿ","ðŸ¤˜","ðŸ¤™","ðŸ‘ˆ","ðŸ‘‰","ðŸ‘†","ðŸ‘‡","â˜ï¸","âœ‹","ðŸ¤š","ðŸ–ï¸","ðŸ––","ðŸ‘‹","ðŸ¤","ðŸ™","ðŸ’ª","ðŸ¦¾","ðŸ¦¿","ðŸ¦µ","ðŸ¦¶","ðŸ‘‚","ðŸ¦»","ðŸ‘ƒ","ðŸ§ ","ðŸ‘€","ðŸ‘ï¸","ðŸ‘…","ðŸ‘„"]},{name:"food",emojis:["ðŸ","ðŸŽ","ðŸ","ðŸŠ","ðŸ‹","ðŸŒ","ðŸ‰","ðŸ‡","ðŸ“","ðŸ«","ðŸˆ","ðŸ’","ðŸ‘","ðŸ¥­","ðŸ","ðŸ¥¥","ðŸ¥","ðŸ…","ðŸ†","ðŸ¥‘","ðŸ¥¦","ðŸ¥¬","ðŸ¥’","ðŸŒ¶ï¸","ðŸ«‘","ðŸŒ½","ðŸ¥•","ðŸ§„","ðŸ§…","ðŸ¥”","ðŸ ","ðŸ¥","ðŸ¥¯","ðŸž","ðŸ¥–","ðŸ¥¨","ðŸ§€","ðŸ¥š","ðŸ³","ðŸ§ˆ","ðŸ¥ž","ðŸ§‡","ðŸ¥“","ðŸ¥©","ðŸ—","ðŸ–","ðŸ¦´","ðŸŒ­","ðŸ”","ðŸŸ","ðŸ•","ðŸ«“","ðŸ¥ª","ðŸ¥™","ðŸ§†","ðŸŒ®","ðŸŒ¯","ðŸ«”","ðŸ¥—","ðŸ¥˜","ðŸ«•","ðŸ¥«","ðŸ","ðŸœ","ðŸ²","ðŸ›","ðŸ£","ðŸ±","ðŸ¥Ÿ","ðŸ¦ª","ðŸ¤","ðŸ™","ðŸš","ðŸ˜","ðŸ¥","ðŸ¥ ","ðŸ¥®","ðŸ¢","ðŸ¡","ðŸ§","ðŸ¨","ðŸ¦","ðŸ¥§","ðŸ§","ðŸ°","ðŸŽ‚","ðŸ®","ðŸ­","ðŸ¬","ðŸ«","ðŸ¿","ðŸ©","ðŸª"]},{name:"hearts",emojis:["â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ–¤","ðŸ¤","ðŸ¤Ž","ðŸ’”","â£ï¸","ðŸ’•","ðŸ’ž","ðŸ’“","ðŸ’—","ðŸ’–","ðŸ’˜","ðŸ’","ðŸ’Ÿ","â™¥ï¸"]},{name:"objects",emojis:["â­","ðŸŒŸ","âœ¨","ðŸ’«","ðŸ”¥","ðŸ’¯","ðŸŽ‰","ðŸŽŠ","ðŸŽˆ","ðŸŽ","ðŸ†","ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰","âš½","ðŸ€","ðŸˆ","âš¾","ðŸŽ¾","ðŸ","ðŸŽ±","ðŸ“","ðŸŽ®","ðŸŽ²","ðŸ§©","ðŸŽ­","ðŸŽ¨","ðŸŽ¬","ðŸŽ¤","ðŸŽ§","ðŸŽµ","ðŸŽ¶","ðŸŽ¹","ðŸŽ¸","ðŸŽº","ðŸŽ»","ðŸ“·","ðŸ“¸","ðŸ“¹","ðŸŽ¥","ðŸ“±","ðŸ’»","âŒ¨ï¸","ðŸ–¥ï¸","ðŸ“º","ðŸ“»","â°","âŒš","ðŸ’¡","ðŸ”¦","ðŸ“š","ðŸ“–","âœï¸","ðŸ“","ðŸ’°","ðŸ’µ","ðŸ’´","ðŸ’¶","ðŸ’·","ðŸ’³","ðŸ›’","ðŸŽ€","ðŸŽ—ï¸"]},{name:"nature",emojis:["ðŸŒ¸","ðŸ’®","ðŸµï¸","ðŸŒ¹","ðŸ¥€","ðŸŒº","ðŸŒ»","ðŸŒ¼","ðŸŒ·","ðŸŒ±","ðŸª´","ðŸŒ²","ðŸŒ³","ðŸŒ´","ðŸŒµ","ðŸŒ¾","ðŸŒ¿","â˜˜ï¸","ðŸ€","ðŸ","ðŸ‚","ðŸƒ","ðŸŒ","ðŸŒŽ","ðŸŒ","ðŸŒ™","â­","â˜€ï¸","ðŸŒ¤ï¸","â›…","ðŸŒ¥ï¸","â˜ï¸","ðŸŒ¦ï¸","ðŸŒ§ï¸","â›ˆï¸","ðŸŒ©ï¸","ðŸŒ¨ï¸","â„ï¸","â˜ƒï¸","â›„","ðŸŒ¬ï¸","ðŸ’¨","ðŸŒŠ","ðŸ’§","ðŸ’¦","â˜”","ðŸŒˆ"]}],lt=({onSelect:t})=>{const{t:a}=q(),s=me(),[v,o]=m.useState(!1),[d,g]=m.useState(0),u=w=>{t(w),s||o(!1)},n={smileys:a("emoji.smileys","è¡¨æƒ…"),gestures:a("emoji.gestures","æ‰‹åŠ¿"),food:a("emoji.food","ç¾Žé£Ÿ"),hearts:a("emoji.hearts","çˆ±å¿ƒ"),objects:a("emoji.objects","ç‰©å“"),nature:a("emoji.nature","è‡ªç„¶")},x=e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-2 border-b",children:Ue.map((w,l)=>e.jsx("button",{type:"button",onClick:()=>g(l),className:`px-3 py-1.5 text-sm rounded-full whitespace-nowrap transition-colors ${d===l?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80 text-muted-foreground"}`,children:n[w.name]},w.name))}),e.jsx("div",{className:"grid grid-cols-8 gap-1",children:Ue[d].emojis.map((w,l)=>e.jsx("button",{type:"button",onClick:()=>u(w),className:"w-9 h-9 flex items-center justify-center text-xl hover:bg-muted rounded-md transition-colors",children:w},l))})]}),f=e.jsxs("button",{type:"button",onClick:()=>o(!0),className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground transition-colors",children:[e.jsx(os,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:a("community.emoji","è¡¨æƒ…")})]});return s?e.jsxs(e.Fragment,{children:[f,e.jsx(we,{open:v,onOpenChange:o,children:e.jsxs(ke,{className:"h-[50vh]",children:[e.jsx(Ce,{className:"pb-2",children:e.jsx(Se,{children:a("emoji.title","é€‰æ‹©è¡¨æƒ…")})}),e.jsx(Ae,{className:"flex-1 px-4 pb-4",children:x})]})})]}):e.jsxs(_e,{open:v,onOpenChange:o,children:[e.jsx(Re,{asChild:!0,children:f}),e.jsx(Pe,{className:"w-80 p-3",align:"start",side:"top",children:x})]})},ct=({onSelect:t})=>{const{t:a}=q();return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:a("community.selectPostType","é€‰æ‹©å‘å¸ƒç±»åž‹")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-8 text-center",children:a("community.selectPostTypeDesc","é€‰æ‹©æ‚¨æƒ³è¦å‘å¸ƒçš„å†…å®¹ç±»åž‹")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full max-w-sm",children:[e.jsxs("button",{onClick:()=>t("post"),className:"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(ve,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium",children:a("community.postType.post","å‘å¸ƒå¸–å­")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("community.postType.postDesc","åˆ†äº«ç¾Žé£Ÿä½“éªŒå’Œæƒ³æ³•")})]})]}),e.jsxs("button",{onClick:()=>t("recipe"),className:"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(te,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium",children:a("community.postType.recipe","å‘å¸ƒé£Ÿè°±")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("community.postType.recipeDesc","åˆ†äº«çƒ¹é¥ªæ•™ç¨‹å’Œèœè°±")})]})]})]})]})},ot=[{value:"easy",labelKey:"recipe.difficulty.easy"},{value:"medium",labelKey:"recipe.difficulty.medium"},{value:"hard",labelKey:"recipe.difficulty.hard"}],dt=["g","kg","ml","L","tsp","tbsp","cup","piece","slice","clove","pinch"],mt=({data:t,coverImage:a,nutrition:s,introduction:v,onDataChange:o,onCoverImageChange:d,onNutritionChange:g,onIntroductionChange:u})=>{const{t:n}=q(),x=m.useRef(null),[f,w]=m.useState(!!(s.calories||s.protein||s.carbs||s.fat)),[l,h]=m.useState(!1),p=async r=>{const N=r.target.files?.[0];if(N){if(N.size>5*1024*1024){S.error(n("common.imageTooLarge","å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB"));return}h(!0);try{const{data:{user:j}}=await U.auth.getUser();if(!j)throw new Error("Not authenticated");const C=N.name.split(".").pop(),_=`${j.id}/${Date.now()}-recipe-cover.${C}`,{error:R}=await U.storage.from("community-posts").upload(_,N);if(R)throw R;const{data:{publicUrl:D}}=U.storage.from("community-posts").getPublicUrl(_);d(D)}catch(j){console.error("Upload error:",j),S.error(n("common.uploadError","ä¸Šä¼ å¤±è´¥"))}finally{h(!1),x.current&&(x.current.value="")}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:n("recipe.coverImage","å°é¢å›¾ç‰‡")}),e.jsx("input",{ref:x,type:"file",accept:"image/*",className:"hidden",onChange:p}),a?e.jsxs("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:a,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>d(null),className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsx("button",{type:"button",onClick:()=>x.current?.click(),disabled:l,className:"w-full aspect-video rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-2 text-muted-foreground hover:border-primary hover:text-primary transition-colors",children:l?e.jsx(ae,{className:"h-8 w-8 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"h-8 w-8"}),e.jsx("span",{className:"text-sm",children:n("recipe.addCoverImage","æ·»åŠ å°é¢å›¾ç‰‡")})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"recipe-name",children:[n("recipe.name","é£Ÿè°±åç§°")," *"]}),e.jsx(z,{id:"recipe-name",value:t.recipe_name||"",onChange:r=>o({...t,recipe_name:r.target.value}),placeholder:n("recipe.namePlaceholder","å¦‚ï¼šçº¢çƒ§è‚‰ã€ç•ªèŒ„ç‚’è›‹")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"introduction",children:[e.jsx(ve,{className:"h-4 w-4 inline mr-1"}),n("recipe.introduction","ç¾Žé£Ÿä»‹ç»")]}),e.jsx(be,{id:"introduction",value:v,onChange:r=>u(r.target.value),placeholder:n("recipe.introductionPlaceholder","ä»‹ç»è¿™é“ç¾Žé£Ÿçš„ç‰¹è‰²ã€å£æ„Ÿã€æ¥æºæ•…äº‹ç­‰..."),rows:3,className:"resize-none"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"cook-time",children:[e.jsx(de,{className:"h-4 w-4 inline mr-1"}),n("recipe.cookTime","çƒ¹é¥ªæ—¶é—´")," *"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{id:"cook-time",type:"number",min:1,value:t.cook_time||"",onChange:r=>o({...t,cook_time:parseInt(r.target.value)||0}),placeholder:"30",className:"w-24"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n("recipe.minutes","åˆ†é’Ÿ")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{children:[e.jsx(ds,{className:"h-4 w-4 inline mr-1"}),n("recipe.difficulty","éš¾åº¦")," *"]}),e.jsxs(Is,{value:t.difficulty||"",onValueChange:r=>o({...t,difficulty:r}),children:[e.jsx(Us,{children:e.jsx(Ls,{placeholder:n("recipe.selectDifficulty","é€‰æ‹©éš¾åº¦")})}),e.jsx(Es,{children:ot.map(r=>e.jsx(Ts,{value:r.value,children:n(r.labelKey,r.value)},r.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(O,{htmlFor:"servings",children:[e.jsx(Le,{className:"h-4 w-4 inline mr-1"}),n("recipe.servings","ä»½é‡")," *"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{id:"servings",type:"number",min:1,value:t.servings||"",onChange:r=>o({...t,servings:parseInt(r.target.value)||0}),placeholder:"2",className:"w-24"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n("recipe.people","äººä»½")})]})]}),e.jsxs(Qs,{open:f,onOpenChange:w,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(T,{variant:"ghost",type:"button",className:"w-full justify-between px-0 hover:bg-transparent",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(Fe,{className:"h-4 w-4"}),n("recipe.nutritionInfo","è¥å…»ä¿¡æ¯"),e.jsxs("span",{className:"text-xs text-muted-foreground font-normal",children:["(",n("common.optional","å¯é€‰"),")"]})]}),f?e.jsx(ms,{className:"h-4 w-4"}):e.jsx(us,{className:"h-4 w-4"})]})}),e.jsx(Xs,{className:"space-y-4 pt-2",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"calories",className:"text-xs",children:n("recipe.calories","å¡è·¯é‡Œ")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{id:"calories",type:"number",min:0,value:s.calories||"",onChange:r=>g({...s,calories:parseInt(r.target.value)||void 0}),placeholder:"300",className:"h-8"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"kcal"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"protein",className:"text-xs",children:n("recipe.protein","è›‹ç™½è´¨")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{id:"protein",type:"number",min:0,value:s.protein||"",onChange:r=>g({...s,protein:parseInt(r.target.value)||void 0}),placeholder:"20",className:"h-8"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"carbs",className:"text-xs",children:n("recipe.carbs","ç¢³æ°´")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{id:"carbs",type:"number",min:0,value:s.carbs||"",onChange:r=>g({...s,carbs:parseInt(r.target.value)||void 0}),placeholder:"30",className:"h-8"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"g"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(O,{htmlFor:"fat",className:"text-xs",children:n("recipe.fat","è„‚è‚ª")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{id:"fat",type:"number",min:0,value:s.fat||"",onChange:r=>g({...s,fat:parseInt(r.target.value)||void 0}),placeholder:"10",className:"h-8"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"g"})]})]})]})})]})]})},ut=({ingredients:t,onChange:a})=>{const{t:s}=q(),v=()=>{a([...t,{name:"",amount:"",unit:""}])},o=(g,u,n)=>{const x=[...t];x[g]={...x[g],[u]:n},a(x)},d=g=>{a(t.filter((u,n)=>n!==g))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"text-base font-medium",children:[s("recipe.ingredients","é…æ–™")," *"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.filter(g=>g.name).length," ",s("recipe.items","é¡¹")]})]}),e.jsx("div",{className:"space-y-3",children:t.map((g,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(z,{value:g.name,onChange:n=>o(u,"name",n.target.value),placeholder:s("recipe.ingredientName","é…æ–™åç§°")})}),e.jsx("div",{className:"w-20",children:e.jsx(z,{value:g.amount,onChange:n=>o(u,"amount",n.target.value),placeholder:s("recipe.amount","é‡")})}),e.jsxs("div",{className:"w-20",children:[e.jsx(z,{value:g.unit,onChange:n=>o(u,"unit",n.target.value),placeholder:s("recipe.unit","å•ä½"),list:"common-units"}),e.jsx("datalist",{id:"common-units",children:dt.map(n=>e.jsx("option",{value:n},n))})]}),e.jsx(T,{type:"button",variant:"ghost",size:"icon",onClick:()=>d(u),disabled:t.length===1,className:"shrink-0",children:e.jsx($e,{className:"h-4 w-4 text-destructive"})})]},u))}),e.jsxs(T,{type:"button",variant:"outline",onClick:v,className:"w-full",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),s("recipe.addIngredient","æ·»åŠ é…æ–™")]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("recipe.unitsHint","å¸¸ç”¨å•ä½ï¼šg, kg, ml, L, å‹º, æ¯, ä¸ª, ç‰‡, é€‚é‡")})]})},le=3,xt=({steps:t,onChange:a})=>{const{t:s}=q(),[v,o]=m.useState(null),d=m.useRef([]),g=l=>l.image_urls&&l.image_urls.length>0?l.image_urls:l.image_url?[l.image_url]:[],u=()=>{const l=t.length+1;a([...t,{order:l,description:"",image_urls:[]}])},n=(l,h,p)=>{const r=[...t];r[l]={...r[l],[h]:p},a(r)},x=l=>{const h=t.filter((p,r)=>r!==l).map((p,r)=>({...p,order:r+1}));a(h)},f=(l,h)=>{const r=g(t[l]).filter((N,j)=>j!==h);n(l,"image_urls",r),n(l,"image_url",void 0)},w=async(l,h)=>{const p=h.target.files?.[0];if(!p)return;const r=g(t[l]);if(r.length>=le){S.error(s("recipe.maxStepImages","æ¯ä¸ªæ­¥éª¤æœ€å¤šä¸Šä¼ {{max}}å¼ å›¾ç‰‡",{max:le}));return}if(p.size>5*1024*1024){S.error(s("common.imageTooLarge","å›¾ç‰‡ä¸èƒ½è¶…è¿‡5MB"));return}o(l);try{const{data:{user:N}}=await U.auth.getUser();if(!N)throw new Error("Not authenticated");const j=p.name.split(".").pop(),C=`${N.id}/${Date.now()}-step-${l}.${j}`,{error:_}=await U.storage.from("community-posts").upload(C,p);if(_)throw _;const{data:{publicUrl:R}}=U.storage.from("community-posts").getPublicUrl(C),D=[...r,R],I=[...t];I[l]={...I[l],image_urls:D,image_url:void 0},a(I)}catch(N){console.error("Upload error:",N),S.error(s("common.uploadError","ä¸Šä¼ å¤±è´¥"))}finally{o(null),d.current[l]&&(d.current[l].value="")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(O,{className:"text-base font-medium",children:[s("recipe.steps","çƒ¹é¥ªæ­¥éª¤")," *"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t.filter(l=>l.description).length," ",s("recipe.stepsCount","æ­¥")]})]}),e.jsx("div",{className:"space-y-4",children:t.map((l,h)=>{const p=g(l);return e.jsxs("div",{className:"p-4 border rounded-lg space-y-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-primary",children:s("recipe.stepNumber","ç¬¬{{n}}æ­¥",{n:h+1})})]}),e.jsx(T,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(h),disabled:t.length===1,children:e.jsx($e,{className:"h-4 w-4 text-destructive"})})]}),e.jsx(be,{value:l.description,onChange:r=>n(h,"description",r.target.value),placeholder:s("recipe.stepDescriptionPlaceholder","æè¿°è¿™ä¸€æ­¥çš„æ“ä½œ..."),className:"min-h-[80px]"}),e.jsxs("div",{children:[e.jsx("input",{ref:r=>d.current[h]=r,type:"file",accept:"image/*",className:"hidden",onChange:r=>w(h,r)}),p.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:p.map((r,N)=>e.jsxs("div",{className:"relative w-24 h-20 rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:r,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>f(h,N),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(Z,{className:"h-3 w-3"})})]},N))}),p.length<le&&e.jsxs("button",{type:"button",onClick:()=>d.current[h]?.click(),disabled:v===h,className:"flex items-center gap-2 text-sm text-muted-foreground hover:text-primary transition-colors",children:[v===h?e.jsx(ae,{className:"h-4 w-4 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4"}),e.jsx("span",{children:p.length===0?s("recipe.addStepImage","æ·»åŠ æ­¥éª¤å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰"):s("recipe.addMoreImages","ç»§ç»­æ·»åŠ  ({{current}}/{{max}})",{current:p.length,max:le})})]})]})]},h)})}),e.jsxs(T,{type:"button",variant:"outline",onClick:u,className:"w-full",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),s("recipe.addStep","æ·»åŠ æ­¥éª¤")]})]})},pt=()=>{const t=Me(),{t:a}=q();return ps({mutationFn:async s=>{const{data:{user:v}}=await U.auth.getUser();if(!v)throw new Error("Not authenticated");let o;s.introduction?o=s.introduction:o="";const d=[];s.cover_image&&d.push(s.cover_image),s.steps.forEach(n=>{n.image_urls&&n.image_urls.length>0?n.image_urls.forEach(x=>d.push(x)):n.image_url&&d.push(n.image_url)});const{data:g,error:u}=await U.from("community_posts").insert({author_id:v.id,post_type:"recipe",content:o,image_urls:d,recipe_name:s.recipe_name,cook_time:s.cook_time,difficulty:s.difficulty,servings:s.servings,ingredients:s.ingredients,steps:s.steps,nutrition:s.nutrition?s.nutrition:null,recipe_tags:s.recipe_tags||null,recipe_category:s.recipe_category||null,status:"pending",moderation_status:"pending"}).select().single();if(u)throw u;try{await U.functions.invoke("moderate-post",{body:{post_id:g.id,content:o,user_id:v.id,image_urls:d}})}catch(n){console.error("Moderation call failed:",n)}return g},onSuccess:()=>{t.invalidateQueries({queryKey:["community-posts"]}),t.invalidateQueries({queryKey:["has-posted-today"]}),S.success(a("recipe.publishSuccess","é£Ÿè°±å‘å¸ƒæˆåŠŸ"))},onError:s=>{console.error("Create recipe error:",s),S.error(a("recipe.publishError","å‘å¸ƒå¤±è´¥"))}})},ht=({onClose:t,onSuccess:a})=>{const{t:s}=q(),v=pt(),[o,d]=m.useState(0),[g,u]=m.useState(null),[n,x]=m.useState({recipe_name:"",cook_time:void 0,difficulty:void 0,servings:void 0}),[f,w]=m.useState([{name:"",amount:"",unit:""}]),[l,h]=m.useState([{order:1,description:""}]),[p,r]=m.useState({}),[N,j]=m.useState(""),C=[{key:"basic",title:s("recipe.step.basic","åŸºæœ¬ä¿¡æ¯")},{key:"ingredients",title:s("recipe.step.ingredients","é…æ–™")},{key:"steps",title:s("recipe.step.steps","æ­¥éª¤")}],_=(o+1)/C.length*100,R=()=>n.recipe_name?.trim()?!n.cook_time||n.cook_time<1?(S.error(s("recipe.cookTimeRequired","è¯·è¾“å…¥çƒ¹é¥ªæ—¶é—´")),!1):n.difficulty?!n.servings||n.servings<1?(S.error(s("recipe.servingsRequired","è¯·è¾“å…¥ä»½é‡")),!1):!0:(S.error(s("recipe.difficultyRequired","è¯·é€‰æ‹©éš¾åº¦")),!1):(S.error(s("recipe.nameRequired","è¯·è¾“å…¥é£Ÿè°±åç§°")),!1),D=()=>f.filter(y=>y.name.trim()).length===0?(S.error(s("recipe.ingredientsRequired","è¯·è‡³å°‘æ·»åŠ ä¸€ç§é…æ–™")),!1):!0,I=()=>l.filter(y=>y.description.trim()).length===0?(S.error(s("recipe.stepsRequired","è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ­¥éª¤")),!1):!0,V=()=>{o===0&&!R()||o===1&&!D()||d(i=>Math.min(i+1,C.length-1))},B=()=>{d(i=>Math.max(i-1,0))},F=async()=>{if(!I())return;const i=f.filter(H=>H.name.trim()),y=l.filter(H=>H.description.trim()).map((H,xe)=>({...H,order:xe+1})),A=p.calories||p.protein||p.carbs||p.fat;try{await v.mutateAsync({recipe_name:n.recipe_name,cook_time:n.cook_time,difficulty:n.difficulty,servings:n.servings,ingredients:i,steps:y,cover_image:g,nutrition:A?p:void 0,introduction:N.trim()||void 0}),a()}catch{}},c=()=>{switch(o){case 0:return e.jsx(mt,{data:n,coverImage:g,nutrition:p,introduction:N,onDataChange:x,onCoverImageChange:u,onNutritionChange:r,onIntroductionChange:j});case 1:return e.jsx(ut,{ingredients:f,onChange:w});case 2:return e.jsx(xt,{steps:l,onChange:h});default:return null}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{type:"button",onClick:t,className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx("h2",{className:"font-medium",children:s("recipe.createTitle","åˆ›å»ºé£Ÿè°±")}),e.jsx("div",{className:"w-6"})," "]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ks,{value:_,className:"h-1"}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground",children:C.map((i,y)=>e.jsx("span",{className:y===o?"text-primary font-medium":"",children:i.title},i.key))})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:c()}),e.jsx("div",{className:"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[o>0&&e.jsxs(T,{type:"button",variant:"outline",onClick:B,className:"flex-1",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),s("common.back","ä¸Šä¸€æ­¥")]}),o<C.length-1?e.jsxs(T,{type:"button",onClick:V,className:"flex-1",children:[s("common.next","ä¸‹ä¸€æ­¥"),e.jsx(hs,{className:"h-4 w-4 ml-2"})]}):e.jsxs(T,{type:"button",onClick:F,disabled:v.isPending,className:"flex-1",children:[v.isPending?e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Y,{className:"h-4 w-4 mr-2"}),s("recipe.publish","å‘å¸ƒé£Ÿè°±")]})]})})]})},gt=({trigger:t})=>{const{t:a}=q(),{getLocalizedField:s}=ue(),v=Os(),{data:o}=Js(),{data:d}=Ys(),{role:g,isMerchant:u,isAdmin:n,isSupervisor:x}=Ds(),{data:f}=zs(),{data:w,isLoading:l}=Bs(),[h,p]=m.useState(!1),[r,N]=m.useState("selecting"),[j,C]=m.useState(""),[_,R]=m.useState([]),[D,I]=m.useState(null),[V,B]=m.useState(""),[F,c]=m.useState([]),[i,y]=m.useState(!1),[A,H]=m.useState(!1),[xe,Ie]=m.useState(!1),[pe,ee]=m.useState(!1),re=m.useRef(null),ne=m.useRef(null),se=!u&&!x&&!n,ie=n||x||u;m.useEffect(()=>{u&&f&&h&&c([f.id])},[u,f,h]);const he=()=>{N(ie?"selecting":"post"),C(""),R([]),I(null),B(""),c([]),H(!1),Ie(!1),ee(!1)};m.useEffect(()=>{h&&N(ie?"selecting":"post")},[h,ie]);const He=b=>{p(b),b||he()},Ve=o?.filter(b=>b.status==="published")||[],Ge=async b=>{const P=b.target.files;if(!(!P||P.length===0)){if(_.length+P.length>9){S.error(a("community.maxImages","æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡"));return}y(!0);try{const{data:{user:E}}=await U.auth.getUser();if(!E)throw new Error("Not authenticated");const k=[];for(const L of Array.from(P)){const X=L.name.split(".").pop(),K=`${E.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${X}`,{error:Q}=await U.storage.from("community-posts").upload(K,L);if(Q)throw Q;const{data:{publicUrl:W}}=U.storage.from("community-posts").getPublicUrl(K);k.push(W)}R(L=>[...L,...k])}catch(E){console.error("Upload error:",E),S.error(a("common.uploadError","ä¸Šä¼ å¤±è´¥"))}finally{y(!1),re.current&&(re.current.value="")}}},Ke=b=>new Promise((P,E)=>{const k=document.createElement("video"),L=document.createElement("canvas"),X=L.getContext("2d");k.preload="auto",k.muted=!0,k.playsInline=!0;let K=!1;const Q=()=>{K||k.videoWidth===0||k.videoHeight===0||(L.width=k.videoWidth,L.height=k.videoHeight,X&&(X.drawImage(k,0,0,L.width,L.height),L.toBlob(W=>{W&&W.size>0?(K=!0,k.pause(),URL.revokeObjectURL(k.src),P(W)):E(new Error("Failed to create blob"))},"image/jpeg",.85)))};k.onloadedmetadata=()=>{L.width=k.videoWidth,L.height=k.videoHeight,k.currentTime=.1},k.onseeked=()=>{setTimeout(Q,100)},k.onerror=()=>{URL.revokeObjectURL(k.src),E(new Error("Failed to load video"))},setTimeout(()=>{K||(URL.revokeObjectURL(k.src),E(new Error("Timeout")))},1e4),k.src=URL.createObjectURL(b),k.load()}),Qe=async b=>{const P=b.target.files?.[0];if(P){if(P.size>100*1024*1024){S.error(a("community.videoTooLarge","è§†é¢‘ä¸èƒ½è¶…è¿‡100MB"));return}y(!0);try{const{data:{user:E}}=await U.auth.getUser();if(!E)throw new Error("Not authenticated");const k=P.name.split(".").pop(),L=`${E.id}/${Date.now()}.${k}`,{error:X}=await U.storage.from("community-posts").upload(L,P);if(X)throw X;const{data:{publicUrl:K}}=U.storage.from("community-posts").getPublicUrl(L);I(K);try{S.info(a("community.extractingCover","æ­£åœ¨æå–è§†é¢‘å°é¢..."));const Q=await Ke(P),W=`${E.id}/${Date.now()}-cover.jpg`,{error:es}=await U.storage.from("community-posts").upload(W,Q);if(!es){const{data:{publicUrl:ss}}=U.storage.from("community-posts").getPublicUrl(W);R(ts=>[ss,...ts]),S.success(a("community.coverExtracted","å°é¢å·²è‡ªåŠ¨ç”Ÿæˆ"))}}catch(Q){console.warn("Cover extraction failed:",Q)}}catch(E){console.error("Upload error:",E),S.error(a("common.uploadError","ä¸Šä¼ å¤±è´¥"))}finally{y(!1),ne.current&&(ne.current.value="")}}},We=b=>{R(P=>P.filter((E,k)=>k!==b))},Xe=()=>{I(null),R(b=>b.length>0&&b[0].includes("-cover.jpg")?b.slice(1):b)},Je=async()=>{if(ee(!1),!j.trim()){S.error(a("community.contentRequired","è¯·è¾“å…¥å†…å®¹"));return}if(se&&F.length===0){ee(!0),S.error(a("community.restaurantRequired","è¯·é€‰æ‹©é¤åŽ…"));return}await v.mutateAsync({content:j,image_urls:_,video_url:D||void 0,activity_id:V||void 0,restaurant_ids:F.length>0?F:void 0}),he(),p(!1)},Ye=()=>f?s(f,"name"):a("community.noRestaurant","æœªå…³è”é¤åŽ…"),Ze=()=>{he(),p(!1)};return e.jsxs(Fs,{open:h,onOpenChange:He,children:[e.jsx($s,{asChild:!0,children:t||e.jsx(T,{children:a("community.createPost","å‘å¸ƒå¸–å­")})}),e.jsxs(Ms,{side:"bottom",className:"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden",children:[e.jsx(gs,{children:e.jsx(As,{children:a("community.createPost","å‘å¸ƒå¸–å­")})}),r==="selecting"&&e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:a("community.create","å‘å¸ƒ")}),e.jsx("div",{className:"w-6"})]}),e.jsx(ct,{onSelect:N})]}),r==="recipe"&&e.jsx(ht,{onClose:()=>N("selecting"),onSuccess:Ze}),r==="post"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>ie?N("selecting"):p(!1),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(oe,{className:"h-5 w-5"})}),e.jsxs(T,{size:"sm",onClick:Je,disabled:v.isPending||!j.trim(),className:"rounded-full px-6",children:[v.isPending&&e.jsx(ae,{className:"h-4 w-4 mr-2 animate-spin"}),a("community.publish","å‘å¸ƒ")]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[!l&&!w&&e.jsxs("div",{className:"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:a("community.dailyPointsHint","æ¯æ—¥å‘å¸ƒé¦–ä¸ªå¸–å­å¯èŽ·å¾—5ç§¯åˆ†ï¼")})]}),e.jsx(st,{})]}),e.jsx(be,{value:j,onChange:b=>C(b.target.value),placeholder:a("community.contentPlaceholder","åˆ†äº«ä½ çš„æƒ³æ³•..."),className:"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap"}),_.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:_.map((b,P)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:b,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>We(P),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(Z,{className:"h-3 w-3"})})]},P))}),D&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx("video",{src:D,controls:!0,className:"w-full max-h-48",preload:"metadata"}),e.jsx("button",{type:"button",onClick:Xe,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-2 pb-0 bg-background shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:`flex items-center gap-3 ${pe&&se&&F.length===0?"text-destructive":""}`,children:[e.jsx(De,{className:`h-5 w-5 shrink-0 ${pe&&se&&F.length===0?"text-destructive":"text-muted-foreground"}`}),u?e.jsx("span",{className:"text-sm text-muted-foreground",children:Ye()}):e.jsx(tt,{open:A,onOpenChange:b=>{H(b),b&&ee(!1)},value:F,onSelect:b=>{c(b),ee(!1)},restaurants:d||[],required:se})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsx(it,{open:xe,onOpenChange:Ie,value:V,onSelect:B,activities:Ve})]})]}),pe&&se&&F.length===0&&e.jsx("p",{className:"text-xs text-destructive pl-8",children:a("community.restaurantRequired","è¯·é€‰æ‹©é¤åŽ…")})]}),e.jsxs("div",{className:"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0",children:[e.jsx("input",{ref:re,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:Ge}),e.jsx("input",{ref:ne,type:"file",accept:"video/*",className:"hidden",onChange:Qe}),e.jsxs("button",{type:"button",onClick:()=>re.current?.click(),disabled:i||_.length>=9,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(Ne,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:a("community.photo","ç…§ç‰‡")})]}),e.jsxs("button",{type:"button",onClick:()=>ne.current?.click(),disabled:i||!!D,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(fs,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:a("community.video","è§†é¢‘")})]}),e.jsx(lt,{onSelect:b=>C(P=>P+b)}),i&&e.jsx(ae,{className:"h-5 w-5 animate-spin ml-auto"})]})]})]})]})},ft=()=>e.jsxs("div",{className:"rounded-xl overflow-hidden bg-card border border-border/50",children:[e.jsx(J,{className:"aspect-[4/5] w-full"}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{className:"h-4 w-full"}),e.jsx(J,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 rounded-full"}),e.jsx(J,{className:"h-3 w-16"})]}),e.jsx(J,{className:"h-4 w-10"})]})]})]}),Tt=()=>{const{t}=q(),a=Me(),s=me(),[v,o]=m.useState(()=>localStorage.getItem("community-mobile-layout")==="single"?"single":"double"),[d,g]=m.useState(()=>localStorage.getItem("community-sort")==="popular"?"popular":"latest"),[u,n]=m.useState(()=>{const j=localStorage.getItem("community-post-type");return["all","post","recipe"].includes(j||"")?j:"all"}),{data:x,isLoading:f}=Hs({status:"approved",sortBy:d,postType:u}),{data:w}=Vs(),l=m.useCallback(async()=>{a.removeQueries({queryKey:["community-posts"]}),a.removeQueries({queryKey:["can-create-post"]}),a.removeQueries({queryKey:["has-posted-today"]}),await Promise.all([a.invalidateQueries({queryKey:["community-posts"]}),a.invalidateQueries({queryKey:["can-create-post"]}),a.invalidateQueries({queryKey:["has-posted-today"]})])},[a]),h=()=>{const j=v==="double"?"single":"double";o(j),localStorage.setItem("community-mobile-layout",j)},p=j=>{const C=j;g(C),localStorage.setItem("community-sort",C)},r=j=>{n(j),localStorage.setItem("community-post-type",j)},N=()=>s?v==="single"?"columns-1 gap-4":"columns-2 gap-3":"columns-3 lg:columns-4 gap-4";return e.jsx(Zs,{onRefresh:l,children:e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:e.jsxs("div",{className:"container mx-auto max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl mb-2 text-primary font-medium",children:t("community.title","ç¤¾åŒº")}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-lg",children:t("community.description","åˆ†äº«ç¾Žé£Ÿä½“éªŒï¼Œå‘çŽ°æ›´å¤šç²¾å½©")})]}),w&&e.jsx(gt,{trigger:e.jsxs(T,{size:"sm",className:"gap-1.5",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.createPost","å‘å¸ƒ")})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>p("latest"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${d==="latest"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(de,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.sortLatest","æœ€æ–°")})]}),e.jsxs("button",{onClick:()=>p("popular"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${d==="popular"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Fe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.sortPopular","çƒ­é—¨")})]})]}),e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>r("all"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${u==="all"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(js,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterAll","å…¨éƒ¨")})]}),e.jsxs("button",{onClick:()=>r("post"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${u==="post"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterPost","å¸–å­")})]}),e.jsxs("button",{onClick:()=>r("recipe"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${u==="recipe"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(te,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:t("community.filterRecipe","é£Ÿè°±")})]})]}),s&&e.jsx("button",{onClick:h,className:"ml-auto inline-flex h-9 items-center justify-center whitespace-nowrap rounded-md bg-muted px-2.5 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",title:v==="double"?t("community.singleColumn","å•åˆ—å¸ƒå±€"):t("community.doubleColumn","åŒåˆ—å¸ƒå±€"),children:v==="double"?e.jsx(ys,{className:"h-3.5 w-3.5"}):e.jsx(vs,{className:"h-3.5 w-3.5"})})]}),f?e.jsx("div",{className:N(),children:Array.from({length:8}).map((j,C)=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(ft,{})},C))}):x&&x.length>0?e.jsx("div",{className:N(),children:x.map(j=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(et,{post:j,showAssociations:s&&v==="single"})},j.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(ce,{className:"w-8 h-8 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground text-lg",children:t("community.noPosts","æš‚æ— å¸–å­")}),w&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground/70",children:t("community.beFirst","æˆä¸ºç¬¬ä¸€ä¸ªå‘å¸–çš„äººå§ï¼")})]})]})})})};export{Tt as default};
//# sourceMappingURL=Community-DJ6UQXxF.js.map
