const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-6pZ9VDFn.js","assets/vendor-ui-DmpovMYY.js","assets/vendor-react-iAJ0IrSD.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-DmpovMYY.js";import{u as Rt,r as j,R as L,L as G}from"./vendor-react-iAJ0IrSD.js";import{D as Oe,c as Fe,d as Te,e as Le,k as R,V as Me,u as _e,s as I,a5 as Gs,aS as Ys,aT as Dt,aE as Ws,B as F,aU as kt,aA as ps,ax as gs,ay as js,az as vs,I as O,aV as It,aB as k,aW as Qe,aX as Ve,aY as qe,aZ as Ke,a_ as Ge,a$ as Mt,b0 as Ot,b1 as Xs,aj as ie,ak as le,al as oe,am as ce,an as de,ao as me,ap as ue,aq as ee,a6 as _,aL as Zs,q as V,O as se,Z as te,p as Re,P as q,aO as he,b2 as Ms,aD as Ft,r as Ns,W as Tt,af as Lt,b3 as $t,b4 as Ut,b5 as zt,b6 as Bt,b7 as Ye,S as Ht,b8 as Qt,b9 as Be,Y as Ps,av as xe,ai as Os,G as fe,at as Js,ba as Vt,bb as et,bc as qt,b as Kt,U as Fs,bd as Ie,be as Ts}from"./index-CcIuifO_.js";import{u as pe,_ as Gt}from"./vendor-i18n-DxKeo2S1.js";import{a as $e,u as Yt}from"./vendor-query-D82cqPtt.js";import{T as xs,a as fs,b as Z,c as J}from"./tabs-PQ6AGiBI.js";import{C as Wt,a as Xt,b as He}from"./carousel-DXiEEsI6.js";import{a as Zt}from"./useActivities-CvpiXKqz.js";import{u as Xe}from"./useLocalizedContent-BN2IWylL.js";import{u as Jt}from"./useActivityParticipation-DJdxslx5.js";import{d as ea}from"./useCoupons-Svn9YGyg.js";import{u as sa,a as ta,b as aa,c as ra,d as na,P as Ls}from"./PointsHistoryDialog-CXr-uJZV.js";import{C as ia}from"./checkbox-7eL0cEpI.js";import{A as $s}from"./ActivityTermsAgreement-DsVhz1hw.js";import{S as Us}from"./separator-Di2KbPjp.js";import{f as Ne}from"./format-C8rwt8Rj.js";import{P as la}from"./PullToRefresh-Doyt0tyw.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-6pZ9VDFn.js";import"./usePoints-B-xkOAb1.js";import"./useActivityRules-Bg-DP88r.js";import"./startOfDay-DZ2hF7-U.js";function oa({open:s,onOpenChange:t,activity:i}){const{t:l}=pe();return e.jsx(Oe,{open:s,onOpenChange:t,children:e.jsxs(Fe,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(Te,{children:e.jsx(Le,{className:"text-lg font-semibold line-clamp-2",children:i.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(R,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Me,{className:"w-3.5 h-3.5 fill-primary text-primary"}),l("profile.activityFavorited")]}),i.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:i.image_url,alt:i.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:i.content}})]})]})})}const ca=()=>{const{user:s}=_e();return $e({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await I.from("favorites").select("restaurant_id").eq("user_id",s.id);if(i)throw i;if(!t||t.length===0)return[];const l=t.map(x=>x.restaurant_id),{data:u,error:o}=await I.from("restaurants").select("*").in("id",l).eq("visible",!0);if(o)throw o;return u||[]},enabled:!!s})},da=()=>{const{user:s}=_e();return $e({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await I.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!t||t.length===0)return[];const l=t.filter(d=>d.target_type==="restaurant").map(d=>d.target_id),u=t.filter(d=>d.target_type==="activity").map(d=>d.target_id),o=new Map;if(l.length>0){const{data:d}=await I.from("restaurants").select("id, name, name_en, name_pt").in("id",l);d?.forEach(r=>{o.set(r.id,{name:r.name,name_en:r.name_en||void 0,name_pt:r.name_pt||void 0})})}const x=new Map;if(u.length>0){const{data:d}=await I.from("activities").select("id, title_zh, title_en, title_pt").in("id",u);d?.forEach(r=>{x.set(r.id,{title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt})})}return t.map(d=>{if(d.target_type==="restaurant"){const r=o.get(d.target_id);return{...d,target_name:r?.name||"Unknown Restaurant",target_name_en:r?.name_en,target_name_pt:r?.name_pt}}else if(d.target_type==="activity"){const r=x.get(d.target_id);return{...d,target_name:r?.title_zh||"Unknown Activity",target_name_en:r?.title_en,target_name_pt:r?.title_pt}}return d})},enabled:!!s,staleTime:3e4})},ma=()=>{const{user:s}=_e(),{data:t=[]}=Jt();return $e({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||t.length===0)return[];const i=t.map(a=>a.id),{data:l,error:u}=await I.from("activity_restaurants").select("*").in("restaurant_id",i).order("created_at",{ascending:!1});if(u)throw u;if(!l||l.length===0)return[];const{data:o}=await I.from("restaurants").select("id, name, name_en, name_pt, address").in("id",i),x=[...new Set(l.map(a=>a.activity_id))],{data:d}=await I.from("activities").select("*").in("id",x).eq("status","published");return l.map(a=>{const n=o?.find(m=>m.id===a.restaurant_id),c=d?.find(m=>m.id===a.activity_id);return{activity_id:a.activity_id,restaurant_id:a.restaurant_id,restaurant_name:n?.name||"",restaurant_name_en:n?.name_en||null,restaurant_name_pt:n?.name_pt||null,restaurant_address:n?.address||"",activity:c||null,created_at:a.created_at}}).filter(a=>a.activity!==null)},enabled:!!s&&t.length>0})},st=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],zs=s=>{if(!s)return{code:"+351",number:""};for(const t of st)if(s.startsWith(t.code))return{code:t.code,number:s.slice(t.code.length).trim()};return{code:"+351",number:s}},Bs=({profile:s})=>{const{t}=pe(),i=Rt(),{user:l}=_e(),{isAdmin:u}=Gs(),[o,x]=j.useState(!1),[d,r]=j.useState(s.display_name),a=zs(s.phone),[n,c]=j.useState(a.code),[m,p]=j.useState(a.number),[f,N]=j.useState(!1),[v,T]=j.useState(null),[E,y]=j.useState(s.avatar_url||""),[S,M]=j.useState(!1),[U,Y]=j.useState(!1),[z,P]=j.useState(""),[ae,$]=j.useState(!1),ge=j.useRef(!1);j.useEffect(()=>{const h=ge.current;if(ge.current=o,o&&!h){r(s.display_name);const w=zs(s.phone);c(w.code),p(w.number),y(s.avatar_url||""),T(null),N(!1)}},[o,s.display_name,s.phone,s.avatar_url]);const[ye,B]=j.useState(!1),[K,H]=j.useState(!1),[re,W]=j.useState(!1),[g,b]=j.useState(""),[A,Q]=j.useState(""),[je,Ee]=j.useState(""),[Se,Ue]=j.useState(!1),[we,ze]=j.useState(!1),[Rs,Ze]=j.useState(!1),[xt,De]=j.useState(!1),[ft,ke]=j.useState(!1),[Je,es]=j.useState(""),[ne,ss]=j.useState(""),[Ce,ts]=j.useState(""),[Ds,as]=j.useState(!1),[rs,ns]=j.useState(""),[Ae,is]=j.useState(!1),[ks,Is]=j.useState(!1),[X,ls]=j.useState(null),os=j.useRef(null),cs=j.useRef(null),ds=j.useRef(null),ms=Ys(),us=Dt();j.useEffect(()=>{Se&&os.current&&os.current.focus()},[Se]),j.useEffect(()=>{we&&cs.current&&cs.current.focus()},[we]),j.useEffect(()=>{Ae&&ds.current&&ds.current.focus()},[Ae]);const pt=h=>{const w=h.target.files?.[0];if(w){if(w.size>2*1024*1024)return;T(w),y(URL.createObjectURL(w))}},gt=async()=>{let h=s.avatar_url;if(v){const ve=await us.mutateAsync(v);ve&&(h=ve)}const w=m?`${n} ${m}`:void 0;await ms.mutateAsync({display_name:d,phone:w,avatar_url:h||void 0}),N(!1),x(!1)},jt=async()=>{if(!(!l||z.toLowerCase()!=="delete")){$(!0);try{const{error:h}=await I.functions.invoke("delete-account",{body:{userId:l.id}});if(h){_.error(t("profile.deleteAccountFailed")),console.error(h),$(!1);return}_.success(t("profile.deleteAccountSuccess")),Y(!1),M(!1),P(""),await new Promise(w=>setTimeout(w,1500)),await I.auth.signOut(),i("/auth")}catch(h){_.error(h.message||t("profile.deleteAccountFailed")),$(!1)}finally{$(!1)}}},vt=async()=>{if(l?.email)try{const{error:h}=await I.functions.invoke("send-verification-code",{body:{email:l.email}});if(h)throw h;Ue(!0),_.success(t("profile.codeSentToOldEmail"))}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},Nt=async()=>{if(!A){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:h,error:w}=await I.functions.invoke("verify-email-code",{body:{email:l?.email,code:A}});if(w||!h?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),B(!1),H(!0)}catch(h){_.error(t("profile.verificationFailed")),console.error(h)}},yt=async()=>{if(!g||!g.includes("@")){_.error(t("profile.enterValidEmail"));return}try{const{error:h}=await I.functions.invoke("send-verification-code",{body:{email:g}});if(h)throw h;_.success(t("profile.codeSentToNewEmail")),ze(!0)}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},wt=async()=>{if(!je){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:h,error:w}=await I.functions.invoke("verify-email-code",{body:{email:g,code:je}});if(w||!h?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.newEmailVerified")),H(!1),setTimeout(()=>{W(!0)},100)}catch(h){_.error(t("toast.verificationFailed")),console.error(h)}},Ct=async()=>{Ze(!0);try{const{data:{session:h}}=await I.auth.getSession();if(!h||!l){_.error(t("toast.pleaseSignIn")),Ze(!1);return}const{data:w,error:ve}=await I.functions.invoke("update-email",{body:{userId:l.id,oldEmail:l.email,oldEmailCode:A,newEmail:g,newEmailCode:je},headers:{Authorization:`Bearer ${h.access_token}`}});if(ve||!w?.success)throw new Error(w?.error||"Failed to update email");_.success(t("toast.emailUpdatedSuccess")),W(!1),x(!1),Q(""),b(""),Ee(""),Ue(!1),ze(!1),await new Promise(hs=>setTimeout(hs,1500)),await I.auth.signOut(),i("/auth")}catch(h){_.error(h.message||t("toast.emailUpdateError")),console.error(h)}finally{Ze(!1)}},bt=h=>{let w=0;return h.length>=6&&w++,h.length>=8&&w++,/[a-z]/.test(h)&&w++,/[A-Z]/.test(h)&&w++,/[0-9]/.test(h)&&w++,/[^a-zA-Z0-9]/.test(h)&&w++,w<=2?"weak":w<=4?"medium":"strong"},_t=async h=>{if(h?.preventDefault(),h?.stopPropagation(),!Je){_.error(t("profile.enterCurrentPassword"));return}try{const{createClient:w}=await Gt(async()=>{const{createClient:Pt}=await import("./vendor-supabase-6pZ9VDFn.js");return{createClient:Pt}},__vite__mapDeps([0,1,2])),ve=w("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:hs}=await ve.auth.signInWithPassword({email:l?.email||"",password:Je});if(hs){_.error(t("profile.oldPasswordIncorrect"));return}_.success(t("profile.oldPasswordVerified")),De(!1),ke(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},Et=async()=>{if(l?.email)try{const{error:h}=await I.functions.invoke("send-verification-code",{body:{email:l.email}});if(h)throw h;is(!0),_.success(t("profile.codeSentToOldEmail"))}catch(h){_.error(t("profile.sendCodeFailed")),console.error(h)}},St=async h=>{if(h?.preventDefault(),h?.stopPropagation(),!rs){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:w,error:ve}=await I.functions.invoke("verify-email-code",{body:{email:l?.email,code:rs}});if(ve||!w?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),De(!1),ke(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},At=async h=>{if(h?.preventDefault(),h?.stopPropagation(),!ne||!Ce){_.error(t("profile.enterNewPassword"));return}if(ne.length<6){_.error(t("profile.passwordTooShort"));return}if(ne!==Ce){_.error(t("profile.passwordsDontMatch"));return}Is(!0);try{const{error:w}=await I.auth.updateUser({password:ne});if(w)throw w;_.success(t("profile.passwordUpdated")),ke(!1),x(!1),es(""),ss(""),ts(""),as(!1),ns(""),is(!1)}catch(w){_.error(w.message||t("profile.passwordUpdateFailed")),console.error(w)}finally{Is(!1)}};return e.jsxs(Oe,{open:o,onOpenChange:x,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:[e.jsx(kt,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),e.jsxs(Fe,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:t("profile.editProfile")}),e.jsx(ps,{children:t("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(gs,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(js,{src:E}),e.jsx(vs,{children:d?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(O,{type:"file",accept:"image/*",onChange:pt,className:"hidden",id:"avatar-upload"}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(It,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(k,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),e.jsx(O,{id:"displayName",value:d,onChange:h=>r(h.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(k,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!s.phone&&!f?e.jsx(F,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):f||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Qe,{value:n,onValueChange:c,children:[e.jsx(Ve,{className:"w-[110px] h-9",children:e.jsx(qe,{placeholder:"+351"})}),e.jsx(Ke,{children:st.map(h=>e.jsx(Ge,{value:h.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:h.flag}),e.jsx("span",{children:h.code})]})},h.code))})]}),e.jsx(O,{id:"phone",className:"flex-1 h-9",value:m,onChange:h=>p(h.target.value),placeholder:t("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:`${n} ${m}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!u&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(k,{className:"text-sm",children:t("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>B(!0),className:"text-xs",children:[e.jsx(Mt,{className:"w-3 h-3 mr-1"}),t("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${u?"pt-2 border-t":""}`,children:[e.jsx(k,{className:"text-sm",children:t("profile.changePassword")}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>De(!0),className:"w-full justify-start h-9",children:[e.jsx(Ot,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!u&&e.jsxs(F,{variant:"destructive",size:"sm",onClick:()=>M(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${u?"sm:ml-auto":""}`,children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>{N(!1),x(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),e.jsx(F,{size:"sm",onClick:gt,disabled:ms.isPending||us.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:ms.isPending||us.isPending?t("common.loading"):t("common.save")})]})]})]}),e.jsx(ie,{open:S,onOpenChange:M,children:e.jsxs(le,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:t("profile.deleteAccountWarning")}),e.jsx(de,{children:t("profile.deleteAccountDescription")})]}),e.jsxs(me,{children:[e.jsx(ue,{children:t("common.cancel")}),e.jsx(ee,{onClick:()=>{M(!1),Y(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),e.jsx(ie,{open:U,onOpenChange:Y,children:e.jsxs(le,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:t("profile.confirmDeleteAccount")}),e.jsxs(de,{className:"space-y-4",children:[e.jsx("p",{children:t("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),e.jsx(O,{id:"confirm-delete",value:z,onChange:h=>P(h.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(me,{children:[e.jsx(ue,{onClick:()=>P(""),children:t("common.cancel")}),e.jsx(ee,{onClick:jt,disabled:z.toLowerCase()!=="delete"||ae,className:"bg-destructive hover:bg-destructive/90",children:t(ae?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(ie,{open:ye,onOpenChange:B,children:e.jsxs(le,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:t("profile.verifyOldEmail")}),e.jsx(de,{children:t("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:vt,disabled:Se,children:t(Se?"profile.codeSent":"profile.sendCode")})]})]}),Se&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.verificationCode")}),e.jsx(O,{ref:os,value:A,onChange:h=>Q(h.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),e.jsxs(me,{children:[e.jsx(ue,{onClick:()=>{B(!1),setTimeout(()=>{Q(""),Ue(!1)},300)},children:t("common.cancel")}),Se&&e.jsx(ee,{onClick:Nt,children:t("profile.verify")})]})]})}),e.jsx(ie,{open:K,onOpenChange:H,children:e.jsxs(le,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(oe,{className:"text-center space-y-3",children:[e.jsx(ce,{className:"text-xl",children:t("profile.verifyNewEmail")}),e.jsx(de,{className:"text-center",children:t("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{className:"text-sm font-normal",children:t("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{type:"email",value:g,onChange:h=>b(h.target.value),placeholder:t("profile.enterNewEmail"),disabled:we,className:"border-2 focus:border-primary flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:yt,disabled:!g||we,className:"text-xs whitespace-nowrap px-3",children:t(we?"profile.codeSent":"profile.sendCode")})]})]}),we&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(k,{className:"text-sm font-normal",children:t("profile.verificationCode")}),e.jsx(O,{ref:cs,value:je,onChange:h=>Ee(h.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(me,{className:"flex-col sm:flex-col gap-2",children:[we&&e.jsx(ee,{onClick:wt,disabled:!je||je.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(ue,{onClick:()=>{H(!1),setTimeout(()=>{b(""),Ee(""),ze(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(ie,{open:re,onOpenChange:W,children:e.jsxs(le,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(de,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:l?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:g})]})]})]}),e.jsxs(me,{children:[e.jsx(ue,{onClick:()=>{W(!1),setTimeout(()=>{Q(""),b(""),Ee(""),Ue(!1),ze(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(ee,{onClick:Ct,disabled:Rs,children:Rs?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(ie,{open:xt,onOpenChange:De,children:e.jsxs(le,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:t("profile.verifyOldPassword")}),e.jsx(de,{children:t("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Ds?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:Et,disabled:Ae,children:t(Ae?"profile.codeSent":"profile.sendCode")})]})]}),Ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.verificationCode")}),e.jsx(O,{ref:ds,value:rs,onChange:h=>ns(h.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.currentPassword")}),e.jsx(O,{type:"password",value:Je,onChange:h=>es(h.target.value),placeholder:t("profile.enterCurrentPassword")})]}),e.jsxs(F,{variant:"link",size:"sm",onClick:()=>as(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),e.jsxs(me,{children:[e.jsx(ue,{onClick:()=>{De(!1),setTimeout(()=>{es(""),as(!1),ns(""),is(!1)},300)},children:t("common.cancel")}),Ds?Ae&&e.jsx(ee,{onClick:St,children:t("profile.verify")}):e.jsx(ee,{onClick:_t,children:t("profile.verify")})]})]})}),e.jsx(ie,{open:ft,onOpenChange:ke,children:e.jsxs(le,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsx(ce,{children:t("profile.setNewPassword")}),e.jsx(de,{children:t("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.newPassword")}),e.jsx(O,{type:"password",value:ne,onChange:h=>{ss(h.target.value),h.target.value?ls(bt(h.target.value)):ls(null)},placeholder:t("profile.enterNewPassword")}),X&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${X==="weak"?"bg-destructive":X==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${X==="medium"||X==="strong"?X==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${X==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${X==="weak"?"text-destructive":X==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${X}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:t("profile.confirmNewPassword")}),e.jsx(O,{type:"password",value:Ce,onChange:h=>ts(h.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),ne&&Ce&&ne!==Ce&&e.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),e.jsxs(me,{children:[e.jsx(ue,{onClick:()=>{ke(!1),setTimeout(()=>{ss(""),ts(""),ls(null)},300)},children:t("common.cancel")}),e.jsx(ee,{onClick:At,disabled:!ne||!Ce||ne!==Ce||ks,children:t(ks?"common.loading":"profile.updatePassword")})]})]})})]})},ys=[{value:"Home",icon:Ut,labelKey:"address.labelHome"},{value:"Work",icon:zt,labelKey:"address.labelWork"},{value:"Office",icon:Bt,labelKey:"address.labelOffice"},{value:"Other",icon:Re,labelKey:"address.labelOther"}],ua=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],ha=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],Hs=({initialData:s,onSubmit:t,onCancel:i,isLoading:l,isEdit:u})=>{const{t:o}=pe(),[x,d]=j.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),r=a=>{a.preventDefault(),t(x)};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"label",children:o("address.label")}),e.jsxs(Qe,{value:x.label,onValueChange:a=>d({...x,label:a}),children:[e.jsx(Ve,{children:e.jsx(qe,{placeholder:o("address.selectLabel")})}),e.jsx(Ke,{children:ys.map(a=>e.jsx(Ge,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),o(a.labelKey)]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"street",children:[o("address.street")," *"]}),e.jsx(O,{id:"street",value:x.street,onChange:a=>d({...x,street:a.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"district",children:o("address.district")}),e.jsx(O,{id:"district",value:x.district,onChange:a=>d({...x,district:a.target.value}),placeholder:o("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"city",children:[o("address.city")," *"]}),e.jsx(O,{id:"city",value:x.city,onChange:a=>d({...x,city:a.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),e.jsx(O,{id:"postal_code",value:x.postal_code,onChange:a=>d({...x,postal_code:a.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"country",children:[o("address.country")," *"]}),e.jsxs(Qe,{value:x.country,onValueChange:a=>d({...x,country:a}),children:[e.jsx(Ve,{children:e.jsx(qe,{placeholder:o("address.selectCountry")})}),e.jsx(Ke,{children:ha.map(a=>e.jsx(Ge,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"phone",children:[o("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Qe,{value:x.phone_code,onValueChange:a=>d({...x,phone_code:a}),children:[e.jsx(Ve,{className:"w-[130px]",children:e.jsx(qe,{placeholder:"+351"})}),e.jsx(Ke,{children:ua.map(a=>e.jsx(Ge,{value:a.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.flag}),e.jsx("span",{children:a.code})]})},a.code))})]}),e.jsx(O,{id:"phone",className:"flex-1",value:x.phone,onChange:a=>d({...x,phone:a.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ia,{id:"is_default",checked:x.is_default,onCheckedChange:a=>d({...x,is_default:a})}),e.jsx(k,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),e.jsxs(Ft,{className:"gap-2 sm:gap-0",children:[e.jsx(F,{type:"button",variant:"outline",onClick:i,children:o("common.cancel")}),e.jsx(F,{type:"submit",disabled:l,children:o(l?"common.saving":u?"common.save":"address.add")})]})]})},xa=({address:s,onEdit:t,onDelete:i,onSetDefault:l,isDeleting:u,isSettingDefault:o,canDelete:x=!0})=>{const{t:d}=pe(),r=ys.find(n=>n.value===s.label)||ys[3],a=r.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:d(r.labelKey)}),s.is_default&&e.jsxs(R,{variant:"secondary",className:"text-xs",children:[e.jsx(Ns,{className:"w-3 h-3 mr-1 fill-current"}),d("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Tt,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>l(s.id),disabled:o,title:d("address.setAsDefault"),children:e.jsx(Ns,{className:"w-4 h-4"})}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>t(s),title:d("common.edit"),children:e.jsx(Lt,{className:"w-4 h-4"})}),x&&e.jsxs(ie,{children:[e.jsx($t,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:d("common.delete"),children:e.jsx(Xs,{className:"w-4 h-4"})})}),e.jsxs(le,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:d("address.deleteTitle")}),e.jsx(de,{children:d("address.deleteDescription")})]}),e.jsxs(me,{children:[e.jsx(ue,{children:d("common.cancel")}),e.jsx(ee,{onClick:()=>i(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:u,children:d(u?"common.deleting":"common.delete")})]})]})]})]})]})})},Qs=()=>{const{t:s}=pe(),{data:t,isLoading:i}=sa(),{data:l}=Zs(),u=ta(),o=aa(),x=Ys(),d=ra(),r=na(),[a,n]=j.useState(!1),[c,m]=j.useState(null),[p,f]=j.useState(null),[N,v]=j.useState(!1),T=!l?.phone,E=P=>{if(T&&P.phone){f(P),v(!0);return}u.mutate(P,{onSuccess:()=>n(!1)})},y=()=>{if(!p)return;const P=`${p.phone_code||"+351"} ${p.phone}`;x.mutate({phone:P}),u.mutate(p,{onSuccess:()=>{n(!1),f(null),v(!1)}})},S=()=>{f(null),v(!1)},M=P=>{c&&o.mutate({id:c.id,address:P},{onSuccess:()=>m(null)})},U=P=>{d.mutate(P)},Y=P=>{r.mutate(P)};if(i)return e.jsxs(V,{children:[e.jsx(se,{children:e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(q,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const z=t&&t.length>0;return e.jsxs(V,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(he,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),z&&e.jsxs(Oe,{open:a,onOpenChange:n,children:[e.jsx(Ws,{asChild:!0,children:e.jsxs(F,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(Fe,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:s("address.addNew")}),e.jsx(ps,{children:s("address.addDescription")})]}),e.jsx(Hs,{onSubmit:E,onCancel:()=>n(!1),isLoading:u.isPending})]})]})]})}),e.jsx(q,{children:z?e.jsx("div",{className:"space-y-4",children:t.map(P=>e.jsx(xa,{address:P,onEdit:m,onDelete:U,onSetDefault:Y,isDeleting:d.isPending,isSettingDefault:r.isPending,canDelete:t.length>1},P.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Re,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(F,{onClick:()=>n(!0),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Oe,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(Fe,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:s("address.editAddress")}),e.jsx(ps,{children:s("address.editDescription")})]}),c&&e.jsx(Hs,{initialData:c,onSubmit:M,onCancel:()=>m(null),isLoading:o.isPending,isEdit:!0})]})}),e.jsx(ie,{open:N,onOpenChange:v,children:e.jsxs(le,{children:[e.jsxs(oe,{children:[e.jsx(ce,{children:s("address.phoneConfirmTitle")}),e.jsx(de,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(me,{children:[e.jsx(ue,{onClick:S,children:s("common.cancel")}),e.jsx(ee,{onClick:y,disabled:u.isPending||x.isPending,children:u.isPending||x.isPending?s("common.saving"):s("common.confirm")})]})]})})]})};var fa=Object.defineProperty,We=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable,Vs=(s,t,i)=>t in s?fa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,ws=(s,t)=>{for(var i in t||(t={}))tt.call(t,i)&&Vs(s,i,t[i]);if(We)for(var i of We(t))at.call(t,i)&&Vs(s,i,t[i]);return s},Cs=(s,t)=>{var i={};for(var l in s)tt.call(s,l)&&t.indexOf(l)<0&&(i[l]=s[l]);if(s!=null&&We)for(var l of We(s))t.indexOf(l)<0&&at.call(s,l)&&(i[l]=s[l]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var be;(s=>{const t=class C{constructor(r,a,n,c){if(this.version=r,this.errorCorrectionLevel=a,this.modules=[],this.isFunction=[],r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version value out of range");if(c<-1||c>7)throw new RangeError("Mask value out of range");this.size=r*4+17;let m=[];for(let f=0;f<this.size;f++)m.push(!1);for(let f=0;f<this.size;f++)this.modules.push(m.slice()),this.isFunction.push(m.slice());this.drawFunctionPatterns();const p=this.addEccAndInterleave(n);if(this.drawCodewords(p),c==-1){let f=1e9;for(let N=0;N<8;N++){this.applyMask(N),this.drawFormatBits(N);const v=this.getPenaltyScore();v<f&&(c=N,f=v),this.applyMask(N)}}u(0<=c&&c<=7),this.mask=c,this.applyMask(c),this.drawFormatBits(c),this.isFunction=[]}static encodeText(r,a){const n=s.QrSegment.makeSegments(r);return C.encodeSegments(n,a)}static encodeBinary(r,a){const n=s.QrSegment.makeBytes(r);return C.encodeSegments([n],a)}static encodeSegments(r,a,n=1,c=40,m=-1,p=!0){if(!(C.MIN_VERSION<=n&&n<=c&&c<=C.MAX_VERSION)||m<-1||m>7)throw new RangeError("Invalid value");let f,N;for(f=n;;f++){const y=C.getNumDataCodewords(f,a)*8,S=x.getTotalBits(r,f);if(S<=y){N=S;break}if(f>=c)throw new RangeError("Data too long")}for(const y of[C.Ecc.MEDIUM,C.Ecc.QUARTILE,C.Ecc.HIGH])p&&N<=C.getNumDataCodewords(f,y)*8&&(a=y);let v=[];for(const y of r){i(y.mode.modeBits,4,v),i(y.numChars,y.mode.numCharCountBits(f),v);for(const S of y.getData())v.push(S)}u(v.length==N);const T=C.getNumDataCodewords(f,a)*8;u(v.length<=T),i(0,Math.min(4,T-v.length),v),i(0,(8-v.length%8)%8,v),u(v.length%8==0);for(let y=236;v.length<T;y^=253)i(y,8,v);let E=[];for(;E.length*8<v.length;)E.push(0);return v.forEach((y,S)=>E[S>>>3]|=y<<7-(S&7)),new C(f,a,E,m)}getModule(r,a){return 0<=r&&r<this.size&&0<=a&&a<this.size&&this.modules[a][r]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const r=this.getAlignmentPatternPositions(),a=r.length;for(let n=0;n<a;n++)for(let c=0;c<a;c++)n==0&&c==0||n==0&&c==a-1||n==a-1&&c==0||this.drawAlignmentPattern(r[n],r[c]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(r){const a=this.errorCorrectionLevel.formatBits<<3|r;let n=a;for(let m=0;m<10;m++)n=n<<1^(n>>>9)*1335;const c=(a<<10|n)^21522;u(c>>>15==0);for(let m=0;m<=5;m++)this.setFunctionModule(8,m,l(c,m));this.setFunctionModule(8,7,l(c,6)),this.setFunctionModule(8,8,l(c,7)),this.setFunctionModule(7,8,l(c,8));for(let m=9;m<15;m++)this.setFunctionModule(14-m,8,l(c,m));for(let m=0;m<8;m++)this.setFunctionModule(this.size-1-m,8,l(c,m));for(let m=8;m<15;m++)this.setFunctionModule(8,this.size-15+m,l(c,m));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let r=this.version;for(let n=0;n<12;n++)r=r<<1^(r>>>11)*7973;const a=this.version<<12|r;u(a>>>18==0);for(let n=0;n<18;n++){const c=l(a,n),m=this.size-11+n%3,p=Math.floor(n/3);this.setFunctionModule(m,p,c),this.setFunctionModule(p,m,c)}}drawFinderPattern(r,a){for(let n=-4;n<=4;n++)for(let c=-4;c<=4;c++){const m=Math.max(Math.abs(c),Math.abs(n)),p=r+c,f=a+n;0<=p&&p<this.size&&0<=f&&f<this.size&&this.setFunctionModule(p,f,m!=2&&m!=4)}}drawAlignmentPattern(r,a){for(let n=-2;n<=2;n++)for(let c=-2;c<=2;c++)this.setFunctionModule(r+c,a+n,Math.max(Math.abs(c),Math.abs(n))!=1)}setFunctionModule(r,a,n){this.modules[a][r]=n,this.isFunction[a][r]=!0}addEccAndInterleave(r){const a=this.version,n=this.errorCorrectionLevel;if(r.length!=C.getNumDataCodewords(a,n))throw new RangeError("Invalid argument");const c=C.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][a],m=C.ECC_CODEWORDS_PER_BLOCK[n.ordinal][a],p=Math.floor(C.getNumRawDataModules(a)/8),f=c-p%c,N=Math.floor(p/c);let v=[];const T=C.reedSolomonComputeDivisor(m);for(let y=0,S=0;y<c;y++){let M=r.slice(S,S+N-m+(y<f?0:1));S+=M.length;const U=C.reedSolomonComputeRemainder(M,T);y<f&&M.push(0),v.push(M.concat(U))}let E=[];for(let y=0;y<v[0].length;y++)v.forEach((S,M)=>{(y!=N-m||M>=f)&&E.push(S[y])});return u(E.length==p),E}drawCodewords(r){if(r.length!=Math.floor(C.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let n=this.size-1;n>=1;n-=2){n==6&&(n=5);for(let c=0;c<this.size;c++)for(let m=0;m<2;m++){const p=n-m,N=(n+1&2)==0?this.size-1-c:c;!this.isFunction[N][p]&&a<r.length*8&&(this.modules[N][p]=l(r[a>>>3],7-(a&7)),a++)}}u(a==r.length*8)}applyMask(r){if(r<0||r>7)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let n=0;n<this.size;n++){let c;switch(r){case 0:c=(n+a)%2==0;break;case 1:c=a%2==0;break;case 2:c=n%3==0;break;case 3:c=(n+a)%3==0;break;case 4:c=(Math.floor(n/3)+Math.floor(a/2))%2==0;break;case 5:c=n*a%2+n*a%3==0;break;case 6:c=(n*a%2+n*a%3)%2==0;break;case 7:c=((n+a)%2+n*a%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[a][n]&&c&&(this.modules[a][n]=!this.modules[a][n])}}getPenaltyScore(){let r=0;for(let m=0;m<this.size;m++){let p=!1,f=0,N=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[m][v]==p?(f++,f==5?r+=C.PENALTY_N1:f>5&&r++):(this.finderPenaltyAddHistory(f,N),p||(r+=this.finderPenaltyCountPatterns(N)*C.PENALTY_N3),p=this.modules[m][v],f=1);r+=this.finderPenaltyTerminateAndCount(p,f,N)*C.PENALTY_N3}for(let m=0;m<this.size;m++){let p=!1,f=0,N=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][m]==p?(f++,f==5?r+=C.PENALTY_N1:f>5&&r++):(this.finderPenaltyAddHistory(f,N),p||(r+=this.finderPenaltyCountPatterns(N)*C.PENALTY_N3),p=this.modules[v][m],f=1);r+=this.finderPenaltyTerminateAndCount(p,f,N)*C.PENALTY_N3}for(let m=0;m<this.size-1;m++)for(let p=0;p<this.size-1;p++){const f=this.modules[m][p];f==this.modules[m][p+1]&&f==this.modules[m+1][p]&&f==this.modules[m+1][p+1]&&(r+=C.PENALTY_N2)}let a=0;for(const m of this.modules)a=m.reduce((p,f)=>p+(f?1:0),a);const n=this.size*this.size,c=Math.ceil(Math.abs(a*20-n*10)/n)-1;return u(0<=c&&c<=9),r+=c*C.PENALTY_N4,u(0<=r&&r<=2568888),r}getAlignmentPatternPositions(){if(this.version==1)return[];{const r=Math.floor(this.version/7)+2,a=this.version==32?26:Math.ceil((this.version*4+4)/(r*2-2))*2;let n=[6];for(let c=this.size-7;n.length<r;c-=a)n.splice(1,0,c);return n}}static getNumRawDataModules(r){if(r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*r+128)*r+64;if(r>=2){const n=Math.floor(r/7)+2;a-=(25*n-10)*n-55,r>=7&&(a-=36)}return u(208<=a&&a<=29648),a}static getNumDataCodewords(r,a){return Math.floor(C.getNumRawDataModules(r)/8)-C.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r]*C.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r]}static reedSolomonComputeDivisor(r){if(r<1||r>255)throw new RangeError("Degree out of range");let a=[];for(let c=0;c<r-1;c++)a.push(0);a.push(1);let n=1;for(let c=0;c<r;c++){for(let m=0;m<a.length;m++)a[m]=C.reedSolomonMultiply(a[m],n),m+1<a.length&&(a[m]^=a[m+1]);n=C.reedSolomonMultiply(n,2)}return a}static reedSolomonComputeRemainder(r,a){let n=a.map(c=>0);for(const c of r){const m=c^n.shift();n.push(0),a.forEach((p,f)=>n[f]^=C.reedSolomonMultiply(p,m))}return n}static reedSolomonMultiply(r,a){if(r>>>8||a>>>8)throw new RangeError("Byte out of range");let n=0;for(let c=7;c>=0;c--)n=n<<1^(n>>>7)*285,n^=(a>>>c&1)*r;return u(n>>>8==0),n}finderPenaltyCountPatterns(r){const a=r[1];u(a<=this.size*3);const n=a>0&&r[2]==a&&r[3]==a*3&&r[4]==a&&r[5]==a;return(n&&r[0]>=a*4&&r[6]>=a?1:0)+(n&&r[6]>=a*4&&r[0]>=a?1:0)}finderPenaltyTerminateAndCount(r,a,n){return r&&(this.finderPenaltyAddHistory(a,n),a=0),a+=this.size,this.finderPenaltyAddHistory(a,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(r,a){a[0]==0&&(r+=this.size),a.pop(),a.unshift(r)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=t;function i(d,r,a){if(r<0||r>31||d>>>r)throw new RangeError("Value out of range");for(let n=r-1;n>=0;n--)a.push(d>>>n&1)}function l(d,r){return(d>>>r&1)!=0}function u(d){if(!d)throw new Error("Assertion error")}const o=class D{constructor(r,a,n){if(this.mode=r,this.numChars=a,this.bitData=n,a<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(r){let a=[];for(const n of r)i(n,8,a);return new D(D.Mode.BYTE,r.length,a)}static makeNumeric(r){if(!D.isNumeric(r))throw new RangeError("String contains non-numeric characters");let a=[];for(let n=0;n<r.length;){const c=Math.min(r.length-n,3);i(parseInt(r.substring(n,n+c),10),c*3+1,a),n+=c}return new D(D.Mode.NUMERIC,r.length,a)}static makeAlphanumeric(r){if(!D.isAlphanumeric(r))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],n;for(n=0;n+2<=r.length;n+=2){let c=D.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n))*45;c+=D.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n+1)),i(c,11,a)}return n<r.length&&i(D.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n)),6,a),new D(D.Mode.ALPHANUMERIC,r.length,a)}static makeSegments(r){return r==""?[]:D.isNumeric(r)?[D.makeNumeric(r)]:D.isAlphanumeric(r)?[D.makeAlphanumeric(r)]:[D.makeBytes(D.toUtf8ByteArray(r))]}static makeEci(r){let a=[];if(r<0)throw new RangeError("ECI assignment value out of range");if(r<128)i(r,8,a);else if(r<16384)i(2,2,a),i(r,14,a);else if(r<1e6)i(6,3,a),i(r,21,a);else throw new RangeError("ECI assignment value out of range");return new D(D.Mode.ECI,0,a)}static isNumeric(r){return D.NUMERIC_REGEX.test(r)}static isAlphanumeric(r){return D.ALPHANUMERIC_REGEX.test(r)}getData(){return this.bitData.slice()}static getTotalBits(r,a){let n=0;for(const c of r){const m=c.mode.numCharCountBits(a);if(c.numChars>=1<<m)return 1/0;n+=4+m+c.bitData.length}return n}static toUtf8ByteArray(r){r=encodeURI(r);let a=[];for(let n=0;n<r.length;n++)r.charAt(n)!="%"?a.push(r.charCodeAt(n)):(a.push(parseInt(r.substring(n+1,n+3),16)),n+=2);return a}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=o;s.QrSegment=o})(be||(be={}));(s=>{(t=>{const i=class{constructor(u,o){this.ordinal=u,this.formatBits=o}};i.LOW=new i(0,1),i.MEDIUM=new i(1,0),i.QUARTILE=new i(2,3),i.HIGH=new i(3,2),t.Ecc=i})(s.QrCode||(s.QrCode={}))})(be||(be={}));(s=>{(t=>{const i=class{constructor(u,o){this.modeBits=u,this.numBitsCharCount=o}numCharCountBits(u){return this.numBitsCharCount[Math.floor((u+7)/17)]}};i.NUMERIC=new i(1,[10,12,14]),i.ALPHANUMERIC=new i(2,[9,11,13]),i.BYTE=new i(4,[8,16,16]),i.KANJI=new i(8,[8,10,12]),i.ECI=new i(7,[0,0,0]),t.Mode=i})(s.QrSegment||(s.QrSegment={}))})(be||(be={}));var Pe=be;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var pa={L:Pe.QrCode.Ecc.LOW,M:Pe.QrCode.Ecc.MEDIUM,Q:Pe.QrCode.Ecc.QUARTILE,H:Pe.QrCode.Ecc.HIGH},rt=128,nt="L",it="#FFFFFF",lt="#000000",ot=!1,ct=1,ga=4,ja=0,va=.1;function dt(s,t=0){const i=[];return s.forEach(function(l,u){let o=null;l.forEach(function(x,d){if(!x&&o!==null){i.push(`M${o+t} ${u+t}h${d-o}v1H${o+t}z`),o=null;return}if(d===l.length-1){if(!x)return;o===null?i.push(`M${d+t},${u+t} h1v1H${d+t}z`):i.push(`M${o+t},${u+t} h${d+1-o}v1H${o+t}z`);return}x&&o===null&&(o=d)})}),i.join("")}function mt(s,t){return s.slice().map((i,l)=>l<t.y||l>=t.y+t.h?i:i.map((u,o)=>o<t.x||o>=t.x+t.w?u:!1))}function Na(s,t,i,l){if(l==null)return null;const u=s.length+i*2,o=Math.floor(t*va),x=u/t,d=(l.width||o)*x,r=(l.height||o)*x,a=l.x==null?s.length/2-d/2:l.x*x,n=l.y==null?s.length/2-r/2:l.y*x,c=l.opacity==null?1:l.opacity;let m=null;if(l.excavate){let f=Math.floor(a),N=Math.floor(n),v=Math.ceil(d+a-f),T=Math.ceil(r+n-N);m={x:f,y:N,w:v,h:T}}const p=l.crossOrigin;return{x:a,y:n,h:r,w:d,excavation:m,opacity:c,crossOrigin:p}}function ya(s,t){return t!=null?Math.max(Math.floor(t),0):s?ga:ja}function ut({value:s,level:t,minVersion:i,includeMargin:l,marginSize:u,imageSettings:o,size:x,boostLevel:d}){let r=L.useMemo(()=>{const f=(Array.isArray(s)?s:[s]).reduce((N,v)=>(N.push(...Pe.QrSegment.makeSegments(v)),N),[]);return Pe.QrCode.encodeSegments(f,pa[t],i,void 0,void 0,d)},[s,t,i,d]);const{cells:a,margin:n,numCells:c,calculatedImageSettings:m}=L.useMemo(()=>{let p=r.getModules();const f=ya(l,u),N=p.length+f*2,v=Na(p,x,f,o);return{cells:p,margin:f,numCells:N,calculatedImageSettings:v}},[r,x,o,l,u]);return{qrcode:r,margin:n,cells:a,numCells:c,calculatedImageSettings:m}}var wa=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),Ca=L.forwardRef(function(t,i){const l=t,{value:u,size:o=rt,level:x=nt,bgColor:d=it,fgColor:r=lt,includeMargin:a=ot,minVersion:n=ct,boostLevel:c,marginSize:m,imageSettings:p}=l,N=Cs(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:v}=N,T=Cs(N,["style"]),E=p?.src,y=L.useRef(null),S=L.useRef(null),M=L.useCallback(B=>{y.current=B,typeof i=="function"?i(B):i&&(i.current=B)},[i]),[U,Y]=L.useState(!1),{margin:z,cells:P,numCells:ae,calculatedImageSettings:$}=ut({value:u,level:x,minVersion:n,boostLevel:c,includeMargin:a,marginSize:m,imageSettings:p,size:o});L.useEffect(()=>{if(y.current!=null){const B=y.current,K=B.getContext("2d");if(!K)return;let H=P;const re=S.current,W=$!=null&&re!==null&&re.complete&&re.naturalHeight!==0&&re.naturalWidth!==0;W&&$.excavation!=null&&(H=mt(P,$.excavation));const g=window.devicePixelRatio||1;B.height=B.width=o*g;const b=o/ae*g;K.scale(b,b),K.fillStyle=d,K.fillRect(0,0,ae,ae),K.fillStyle=r,wa?K.fill(new Path2D(dt(H,z))):P.forEach(function(A,Q){A.forEach(function(je,Ee){je&&K.fillRect(Ee+z,Q+z,1,1)})}),$&&(K.globalAlpha=$.opacity),W&&K.drawImage(re,$.x+z,$.y+z,$.w,$.h)}}),L.useEffect(()=>{Y(!1)},[E]);const ge=ws({height:o,width:o},v);let ye=null;return E!=null&&(ye=L.createElement("img",{src:E,key:E,style:{display:"none"},onLoad:()=>{Y(!0)},ref:S,crossOrigin:$?.crossOrigin})),L.createElement(L.Fragment,null,L.createElement("canvas",ws({style:ge,height:o,width:o,ref:M,role:"img"},T)),ye)});Ca.displayName="QRCodeCanvas";var ht=L.forwardRef(function(t,i){const l=t,{value:u,size:o=rt,level:x=nt,bgColor:d=it,fgColor:r=lt,includeMargin:a=ot,minVersion:n=ct,boostLevel:c,title:m,marginSize:p,imageSettings:f}=l,N=Cs(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:v,cells:T,numCells:E,calculatedImageSettings:y}=ut({value:u,level:x,minVersion:n,boostLevel:c,includeMargin:a,marginSize:p,imageSettings:f,size:o});let S=T,M=null;f!=null&&y!=null&&(y.excavation!=null&&(S=mt(T,y.excavation)),M=L.createElement("image",{href:f.src,height:y.h,width:y.w,x:y.x+v,y:y.y+v,preserveAspectRatio:"none",opacity:y.opacity,crossOrigin:y.crossOrigin}));const U=dt(S,v);return L.createElement("svg",ws({height:o,width:o,viewBox:`0 0 ${E} ${E}`,ref:i,role:"img"},N),!!m&&L.createElement("title",null,m),L.createElement("path",{fill:d,d:`M0,0 h${E}v${E}H0z`,shapeRendering:"crispEdges"}),L.createElement("path",{fill:r,d:U,shapeRendering:"crispEdges"}),M)});ht.displayName="QRCodeSVG";const ba=({open:s,onOpenChange:t,coupon:i})=>{const{t:l}=pe(),{getLocalizedField:u}=Xe(),[o,x]=j.useState(!1),d=i.coupon_codes?.coupon_templates,r=i.coupon_codes?.code,a=!!i.used_at;return e.jsx(Oe,{open:s,onOpenChange:n=>{t(n),n||x(!1)},children:e.jsxs(Fe,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(Te,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5 text-primary"}),l("profile.coupons.details")]})}),e.jsx(Ht,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:u(d,"title")}),e.jsx(R,{variant:a?"secondary":"default",children:l(a?"profile.coupons.used":"profile.coupons.available")})]}),d?.description_zh||d?.description_en||d?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:u(d,"description")}):null]}),e.jsx(Us,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>x(!o),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(ht,{value:r||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Qt,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:l("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Be,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:d?.discount_type==="percentage"?`${d?.discount_value}% OFF`:`â‚¬${d?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ps,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),a&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(i.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d?.valid_until?`${Ne(new Date(d.valid_from),"yyyy-MM-dd")} - ${Ne(new Date(d.valid_until),"yyyy-MM-dd")}`:l("profile.coupons.noExpiry")})]})]}),d?.min_order_amount&&d.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.min_order_amount]})]})]}),d?.max_discount_amount&&d.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.max_discount_amount]})]})]}),e.jsx(Us,{}),i.activity_id&&i.source==="share"&&e.jsxs(G,{to:`/activity/${i.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Be,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[l("profile.coupons.source"),": ",l("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",l("profile.coupons.viewActivity"),")"]})]})]})})]})})},_a=()=>{const{user:s}=_e();return $e({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await I.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},Ea=()=>{const{user:s}=_e();return $e({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await I.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},qs=()=>{const{t:s}=pe(),{data:t,isLoading:i}=_a(),{getLocalizedField:l}=Xe(),u=o=>{switch(o){case"confirmed":return e.jsx(R,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(R,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(R,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(R,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(R,{variant:"outline",children:o})}};return e.jsxs(V,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(he,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(q,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(G,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),u(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Os,{className:"w-3 h-3"}),Ne(new Date(o.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ps,{className:"w-3 h-3"}),o.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),o.party_size," ",s("booking.people")]})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},Ks=()=>{const{t:s}=pe(),{data:t,isLoading:i}=Ea(),{getLocalizedField:l}=Xe(),u=o=>{switch(o){case"completed":return e.jsx(R,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(R,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(R,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(R,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(R,{variant:"outline",children:o})}};return e.jsxs(V,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Vt,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(he,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(q,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(G,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),u(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:Ne(new Date(o.order_date),"yyyy-MM-dd HH:mm")}),o.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",o.total_amount.toFixed(2)]})]}),o.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Re,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:o.delivery_address})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},bs=j.memo(({comment:s,getLocalizedField:t,t:i})=>{const l=s.moderation_status==="flagged",u=s.moderation_status==="pending",o=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const x={spam:i("riskReason.spam","åžƒåœ¾ä¿¡æ¯"),offensive:i("riskReason.offensive","ä¸å½“è¨€è®º"),harassment:i("riskReason.harassment","éªšæ‰°æ”»å‡»"),fake_review:i("riskReason.fakeReview","è™šå‡è¯„è®º"),flooding:i("riskReason.flooding","åˆ·å±"),irrelevant:i("riskReason.irrelevant","æ— å…³å†…å®¹"),sensitive_word_detected:i("riskReason.sensitiveWord","æ•æ„Ÿè¯"),parse_error:i("riskReason.parseError","è§£æžé”™è¯¯")};return s.risk_reasons.map(d=>x[d]||d).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(G,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:et(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),u&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(R,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(Ps,{className:"w-3 h-3 mr-1"}),i("restaurant.commentPending","å®¡æ ¸ä¸­")]})}),l&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(R,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(qt,{className:"w-3 h-3 mr-1"}),i("restaurant.commentFailed","å‘é€å¤±è´¥")]}),o()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[i("restaurant.failReason","å¤±è´¥åŽŸå› "),": ",o()]})]})]})});bs.displayName="CommentItem";const _s=j.memo(({restaurant:s,getLocalizedField:t,t:i})=>{if(!s||!s.id)return null;const l=t(s,"name")||s.name||"",u=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(G,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(l),className:"w-full h-full object-cover",loading:"lazy",onError:o=>{o.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:l}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:u}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ns,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[i("restaurant.noRatingLine1"),e.jsx("br",{}),i("restaurant.noRatingLine2")]})]})]})]})});_s.displayName="FavoriteRestaurantItem";const Es=j.memo(({subscription:s,getLocalizedField:t,t:i,isMobile:l})=>{const[u,o]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${l?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(t(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[i("profile.joinedOn"),":"," ",et(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Me,{className:`text-primary fill-primary flex-shrink-0 ${l?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(oa,{open:u,onOpenChange:o,activity:{title:String(t(s.activity,"title")),image_url:s.activity?.image_url,content:String(t(s.activity,"content"))}})]})});Es.displayName="ActivitySubscriptionItem";const Ss=j.memo(({activityGroup:s,getLocalizedField:t,t:i,isMobile:l})=>{const u=s.activity,o=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${l?"p-3":"p-4"}`,children:[e.jsx(G,{to:`/activity/${u.id}`,className:l?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[u.image_url&&e.jsx("img",{src:u.image_url,alt:String(t(u,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(u,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(u,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-3 h-3"}),new Date(u.start_date).toLocaleDateString()]}),u.end_date&&e.jsxs("span",{children:["- ",new Date(u.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${l?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${l?"mb-1.5":"mb-2"}`,children:[e.jsx(fe,{className:`text-primary ${l?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${l?"text-xs":"text-sm"}`,children:[i("profile.participatingRestaurants")," (",o.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${l?"gap-1.5":"gap-2"}`,children:o.map(x=>e.jsx(R,{variant:"secondary",className:l?"text-xs px-2 py-0.5":"text-xs",children:t(x,"name")},x.id))})]})]})});Ss.displayName="MerchantActivityItem";const As=j.memo(({coupon:s,getLocalizedField:t,t:i,isMobile:l})=>{const[u,o]=j.useState(!1),x=s.coupon_codes?.coupon_templates,d=s.coupon_codes?.code,r=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${r?"bg-muted/30":"hover:shadow-medium"} ${l?"p-3":"p-4"}`,onClick:()=>o(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":"text-base"}`,children:t(x,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${l?"text-xs":"text-sm"}`,children:t(x,"description")})]}),e.jsx(R,{variant:r?"secondary":"default",className:l?"text-xs":"",children:i(r?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${l?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:d}),e.jsx("span",{className:"text-muted-foreground",children:x?.discount_type==="percentage"?`${x?.discount_value}%`:`â‚¬${x?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${l?"text-xs":"text-sm"}`,children:r?e.jsxs("span",{children:[i("profile.coupons.usedOn"),": ",Ne(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):x?.valid_until?e.jsxs("span",{children:[i("profile.coupons.validUntil"),": ",Ne(new Date(x.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:i("profile.coupons.noExpiry")})})]}),e.jsx(ba,{open:u,onOpenChange:o,coupon:s})]})});As.displayName="UserCouponItem";const Xa=()=>{const{t:s}=pe(),{user:t}=_e(),i=Kt(),{data:l,isLoading:u}=Zs(),{data:o,isLoading:x}=ca(),{data:d,isLoading:r}=da(),{data:a,isLoading:n}=Zt(),{data:c,isLoading:m}=ma(),{data:p,isLoading:f}=ea(),{role:N,isMerchant:v,isSupervisor:T}=Gs(),{getLocalizedField:E}=Xe(),y=v||T,[S,M]=j.useState("profile"),[U,Y]=j.useState(),[z,P]=j.useState({}),[ae,$]=j.useState(new Set(["profile"])),ge=y?[{value:"profile",label:s("profile.profile"),icon:Fs},{value:"favorites",label:s("profile.favorites"),icon:Me},{value:"comments",label:s("profile.comments"),icon:Ie},{value:"activities",label:s("profile.participatedActivities"),icon:xe}]:[{value:"profile",label:s("profile.profile"),icon:Fs},{value:"favorites",label:s("profile.favorites"),icon:Me},{value:"comments",label:s("profile.comments"),icon:Ie}],ye=g=>{P(b=>({...b,[g]:window.scrollY}))},B=g=>{if(ae.has(g)){const b=z[g]||0;setTimeout(()=>window.scrollTo(0,b),0)}else setTimeout(()=>window.scrollTo(0,0),0),$(b=>new Set([...b,g]))};j.useEffect(()=>{if(!U)return;const g=()=>{const b=U.selectedScrollSnap(),A=ge[b].value;A!==S&&(ye(S),B(A),M(A))};return U.on("select",g),()=>{U.off("select",g)}},[U,S,z,ae]);const K=g=>{if(g===S)return;ye(S);const b=ge.findIndex(A=>A.value===g);b!==-1&&U&&U.scrollTo(b),B(g),M(g)},H=Yt(),re=j.useCallback(async()=>{await Promise.all([H.invalidateQueries({queryKey:["profile"]}),H.invalidateQueries({queryKey:["favorites"]}),H.invalidateQueries({queryKey:["user-comments"]}),H.invalidateQueries({queryKey:["subscriptions"]}),H.invalidateQueries({queryKey:["user-coupons"]})])},[H]);if(!t||u)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const W=s(N?`profile.role.${N}`:"profile.role.user");return e.jsx(la,{onRefresh:re,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${i?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${i?"px-3":""}`,children:[!i&&e.jsx(e.Fragment,{children:e.jsx(V,{className:"mb-6 md:mb-8",children:e.jsx(q,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(gs,{className:"w-24 h-24",children:[e.jsx(js,{src:l?.avatar_url||""}),e.jsx(vs,{className:"text-3xl",children:l?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:l?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),l?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:l.phone}),N&&N!=="user"&&e.jsx(R,{className:"bg-primary capitalize",children:W}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Ts,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:l?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Ls,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[l&&e.jsx(Bs,{profile:l}),y&&l&&e.jsx($s,{isAgreed:l?.activity_terms_agreed||!1,agreedAt:l?.activity_terms_agreed_at||null})]})]})})})}),i?e.jsxs(e.Fragment,{children:[e.jsx(Wt,{setApi:Y,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Xt,{className:"-ml-0",children:[e.jsx(He,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(V,{children:e.jsx(q,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(gs,{className:"w-20 h-20",children:[e.jsx(js,{src:l?.avatar_url||""}),e.jsx(vs,{className:"text-2xl",children:l?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:l?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Ts,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:l?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Ls,{})]}),l?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:l.phone}),N&&N!=="user"&&e.jsx(R,{className:"bg-primary capitalize text-xs mb-4",children:W}),l&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Bs,{profile:l}),y&&e.jsx($s,{isAgreed:l?.activity_terms_agreed||!1,agreedAt:l?.activity_terms_agreed_at||null})]})]})]})})}),e.jsxs(V,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(he,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(q,{className:"px-3",children:f?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:"space-y-3",children:p.map(g=>e.jsx(As,{coupon:g,getLocalizedField:E,t:s,isMobile:!0},g.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(Qs,{}),e.jsx(qs,{}),e.jsx(Ks,{})]})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(V,{children:e.jsx(q,{className:"pt-4",children:e.jsxs(xs,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(fs,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(Z,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(R,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(Z,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(xe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(R,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(J,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(g=>e.jsx(_s,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(J,{value:"activities",children:n?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(g=>e.jsx(Es,{subscription:g,getLocalizedField:E,t:s,isMobile:!0},g.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(V,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(he,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx(q,{className:"space-y-3 px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):d&&d.length>0?d.map(g=>e.jsx(bs,{comment:g,getLocalizedField:E,t:s},g.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),y&&e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(V,{children:[e.jsxs(se,{className:"pb-3",children:[e.jsxs(te,{className:"text-lg flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(he,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(q,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const g=c.reduce((b,A)=>{const Q=A.activity_id;return b[Q]||(b[Q]={activity:A.activity,restaurants:[],participationDate:A.created_at}),b[Q].restaurants.push({id:A.restaurant_id,name:A.restaurant_name,name_en:A.restaurant_name_en,name_pt:A.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(Ss,{activityGroup:b,getLocalizedField:E,t:s,isMobile:!0},b.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:ge.map(g=>{const b=g.icon;return e.jsxs("button",{onClick:()=>K(g.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${S===g.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(b,{className:`${S===g.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]},g.value)})})})]}):e.jsxs(xs,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(fs,{className:`grid w-full ${y?"grid-cols-6":"grid-cols-5"}`,children:[e.jsxs(Z,{value:"favorites",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(Z,{value:"coupons",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(Z,{value:"comments",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),y&&e.jsxs(Z,{value:"activities",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(Z,{value:"addresses",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(Z,{value:"orders",children:[e.jsx(Js,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(J,{value:"favorites",children:e.jsx(V,{children:e.jsx(q,{className:"pt-6",children:e.jsxs(xs,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(fs,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(Z,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(R,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(Z,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(R,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(J,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(g=>e.jsx(_s,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(J,{value:"activities",children:n?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-4",children:a.map(g=>e.jsx(Es,{subscription:g,getLocalizedField:E,t:s,isMobile:i},g.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(J,{value:"comments",children:e.jsxs(V,{children:[e.jsxs(se,{className:i?"pb-3":"",children:[e.jsxs(te,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(Ie,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(he,{className:i?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx(q,{className:`space-y-3 md:space-y-4 ${i?"px-3":""}`,children:r?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):d&&d.length>0?d.map(g=>e.jsx(bs,{comment:g,getLocalizedField:E,t:s},g.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:s("profile.noComments")})})]})}),y&&e.jsx(J,{value:"activities",children:e.jsxs(V,{children:[e.jsxs(se,{className:i?"pb-3":"",children:[e.jsxs(te,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(xe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(he,{className:i?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(q,{className:i?"px-3":"",children:e.jsx("div",{className:i?"space-y-4":"space-y-6",children:m?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${i?"text-base":"text-lg"}`,children:[e.jsx(fe,{className:i?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:i?"space-y-3":"space-y-4",children:(()=>{const g=c.reduce((b,A)=>{const Q=A.activity_id;return b[Q]||(b[Q]={activity:A.activity,restaurants:[],participationDate:A.created_at}),b[Q].restaurants.push({id:A.restaurant_id,name:A.restaurant_name,name_en:A.restaurant_name_en,name_pt:A.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(Ss,{activityGroup:b,getLocalizedField:E,t:s,isMobile:i},b.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(J,{value:"coupons",children:e.jsxs(V,{children:[e.jsxs(se,{className:i?"pb-3":"",children:[e.jsxs(te,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(Ye,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(he,{className:i?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(q,{className:i?"px-3":"",children:f?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):p&&p.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${i?"grid-cols-1":"md:grid-cols-2"}`,children:p.map(g=>e.jsx(As,{coupon:g,getLocalizedField:E,t:s,isMobile:i},g.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(J,{value:"addresses",children:e.jsx(Qs,{})}),e.jsx(J,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(qs,{}),e.jsx(Ks,{})]})})]})]})})})};export{Xa as default};
//# sourceMappingURL=Profile-DwUP4XE1.js.map
