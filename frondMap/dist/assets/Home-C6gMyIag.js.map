{"version":3,"mappings":"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","names":["AskXiaoxiongDialog","open","onOpenChange","i18n","t","useTranslation","navigate","useNavigate","isMobile","useIsMobile","user","useAuth","settings","useSiteSettings","logoUrl","showNewChatConfirm","setShowNewChatConfirm","useState","provider","input","setInput","messages","isLoading","isLoadingHistory","showLocationDialog","setShowLocationDialog","pendingMessage","setPendingMessage","handleSubmit","handleKeyDown","handleLocationConfirm","processMessage","abortRequest","requestLocation","clearChat","useXiaoxiongChat","useEffect","handleClose","getTitle","jsxs","Dialog","DialogContent","jsx","DialogHeader","DialogTitle","SquarePen","XiaoxiongChatContent","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","MobileHeroSection","memo","stats","onAskXiaoxiong","templates","useActiveHomepageTemplates","buttons","useNavigationSettings","currentLang","showExternalLinkDialog","setShowExternalLinkDialog","showAboutUsButton","demoButton","btn","getLocalizedText","field","title","description","chatButtonText","handleConfirmExternalLink","openExternalUrl","mapIcon","Link","Info","ShoppingBag","CalendarCheck","MessageCircle","Search","ChefHat","BookOpen","ExternalLinkConfirmDialog","isDateRangeArray","value","item","isActivityValidOnDate","activity","targetDate","startDate","startOfDay","endDate","target","isSameDay","targetWeekday","getDay","targetDayOfMonth","getDate","monthRanges","range","targetMonth","getMonth","targetDay","yearlyMonth","yearlyDay","getActivitySortWeight","useRecentActivities","activities","useActivities","recentActivities","useMemo","today","tomorrow","addDays","dayAfterTomorrow","filterAndSort","date","a","b","weightDiff","allRecentActivities","seen","combined","useResponsiveCount","count","setCount","updateCount","width","ActivityCard","dayLabel","getLocalizedField","useLocalizedContent","serviceTypeLabel","handleClick","Card","Calendar","Badge","cn","UtensilsCrossed","Fragment","LoadingSkeleton","displayCount","_","Skeleton","RecentActivitiesSection","hasActivities","showAll","setShowAll","getDayLabel","dayKey","displayedActivities","hasMore","Button","ArrowRight","RecentPostCard","post","isRecipe","content","displayText","coverImage","authorName","authorAvatar","Image","Play","Avatar","AvatarImage","AvatarFallback","Heart","RecentPostsSection","posts","useQuery","data","error","supabase","p","displayedPosts","sushiRamenHero","sushiRamenMobile","HomeMapSection","lazy","StatsDisplay","useLightweightMode","getWindowWidth","getConnection","getDeviceMemory","windowWidth","isDesktop","connection","isCapacitor","isWebView","isCapacitorApp","isInWebView","e","deviceMemory","HeroSlide","template","isActive","onContentReady","onDIYCook","postersLoaded","setPostersLoaded","videosReady","setVideosReady","videoErrors","setVideoErrors","imagesLoaded","setImagesLoaded","shouldLoadVideo","setShouldLoadVideo","isLightweight","mobileVideoRef","useRef","tabletVideoRef","desktopVideoRef","getDeviceType","getOverlayOpacity","deviceType","getOverlayStyle","baseOpacity","direction","normalizeOpacity","defaultValue","normalizedBaseOpacity","fromOpacity","viaOpacity","toOpacity","cssDirection","colorMap","fromColor","viaColor","toColor","mobileImg","tabletImg","desktopImg","blurAmount","desktopMediaType","tabletMediaType","mobileMediaType","isDesktopVideo","isTabletVideo","isMobileVideo","mobileVideo","tabletVideo","desktopVideo","currentImage","img","prev","handleVideoCanPlay","device","handleVideoError","isIOS","isIOSDevice","video","timer","err","Home","queryClient","useQueryClient","siteSettings","isLoadingTemplates","refetchTemplates","currentIndex","setCurrentIndex","setStats","timerRef","firstSlideReady","setFirstSlideReady","askDialogOpen","setAskDialogOpen","isNativeApp","useEnvironment","showMobileLayout","shouldHideAppDownload","isAIAssistantEnabled","handleContentReady","useCallback","usePageView","fetchStats","result","handleRefresh","duration","goToSlide","index","showControls","PullToRefresh","HomeSkeleton","Suspense","Smartphone","appStoreBadge","googlePlayBadge","Download","Store"],"ignoreList":[],"sources":["../../src/components/AskXiaoxiongDialog.tsx","../../src/components/MobileHeroSection.tsx","../../src/hooks/useRecentActivities.ts","../../src/components/RecentActivitiesSection.tsx","../../src/components/RecentPostsSection.tsx","../../src/pages/Home.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { useXiaoxiongChat, Provider } from \"@/hooks/useXiaoxiongChat\";\r\nimport XiaoxiongChatContent from \"@/components/XiaoxiongChatContent\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { SquarePen } from \"lucide-react\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\n\r\ninterface AskXiaoxiongDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nconst AskXiaoxiongDialog = ({ open, onOpenChange }: AskXiaoxiongDialogProps) => {\r\n  const { i18n, t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const isMobile = useIsMobile();\r\n  const { user } = useAuth();\r\n  const { settings } = useSiteSettings();\r\n  const logoUrl = settings?.logo_url;\r\n  const [showNewChatConfirm, setShowNewChatConfirm] = useState(false);\r\n  \r\n  // Use provider from site settings, fallback to xiaoxiong-community (consistent with AskXiaoxiong page)\r\n  const provider = (settings?.ai_provider || \"xiaoxiong-community\") as Provider;\r\n  \r\n  const {\r\n    input,\r\n    setInput,\r\n    messages,\r\n    isLoading,\r\n    isLoadingHistory,\r\n    showLocationDialog,\r\n    setShowLocationDialog,\r\n    pendingMessage,\r\n    setPendingMessage,\r\n    handleSubmit,\r\n    handleKeyDown,\r\n    handleLocationConfirm,\r\n    processMessage,\r\n    abortRequest,\r\n    requestLocation,\r\n    clearChat,\r\n  } = useXiaoxiongChat(provider);\r\n\r\n  // On mobile, redirect to full page instead of dialog\r\n  useEffect(() => {\r\n    if (open && isMobile) {\r\n      onOpenChange(false);\r\n      navigate(\"/ask-xiaoxiong\");\r\n    }\r\n  }, [open, isMobile, navigate, onOpenChange]);\r\n\r\n  // Request location on dialog open\r\n  useEffect(() => {\r\n    if (open && !isMobile) {\r\n      requestLocation();\r\n    }\r\n  }, [open, isMobile, requestLocation]);\r\n\r\n  // Cleanup on close\r\n  const handleClose = () => {\r\n    abortRequest();\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const getTitle = () => {\r\n    if (i18n.language === \"zh\") return \"小熊AI助手\";\r\n    if (i18n.language === \"pt\") return \"Assistente IA Xiaoxiong\";\r\n    return \"Xiaoxiong AI Assistant\";\r\n  };\r\n\r\n  // Don't render dialog on mobile (will redirect to page)\r\n  if (isMobile) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"sm:max-w-2xl sm:h-[90vh] sm:max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden\">\r\n        <DialogHeader className=\"px-4 py-3 shrink-0 border-b\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <DialogTitle className=\"text-base font-semibold flex items-center gap-2\">\r\n              {logoUrl && <img src={logoUrl} alt=\"Logo\" className=\"w-8 h-8 rounded-full object-cover\" />}\r\n              {getTitle()}\r\n            </DialogTitle>\r\n            {messages.length > 0 && user?.id && (\r\n              <button\r\n                onClick={() => setShowNewChatConfirm(true)}\r\n                className=\"p-1 hover:bg-muted rounded-md text-muted-foreground hover:text-primary transition-colors\"\r\n                title={t(\"aiRecipe.newChat\", \"新对话\")}\r\n              >\r\n                <SquarePen className=\"h-4 w-4\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n        </DialogHeader>\r\n\r\n        <div className=\"flex-1 min-h-0 flex flex-col overflow-hidden\">\r\n          <XiaoxiongChatContent\r\n            messages={messages}\r\n            input={input}\r\n            setInput={setInput}\r\n            isLoading={isLoading}\r\n            isLoadingHistory={isLoadingHistory}\r\n            showLocationDialog={showLocationDialog}\r\n            setShowLocationDialog={setShowLocationDialog}\r\n            pendingMessage={pendingMessage}\r\n            handleSubmit={handleSubmit}\r\n            handleKeyDown={handleKeyDown}\r\n            handleLocationConfirm={handleLocationConfirm}\r\n            processMessage={processMessage}\r\n            setPendingMessage={setPendingMessage}\r\n            onClose={handleClose}\r\n            onClearChat={clearChat}\r\n            showBackButton={false}\r\n            showHeader={false}\r\n            className=\"flex-1\"\r\n          />\r\n        </div>\r\n      </DialogContent>\r\n\r\n      <AlertDialog open={showNewChatConfirm} onOpenChange={setShowNewChatConfirm}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"aiRecipe.newChat\", \"新对话\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"aiRecipe.newChatConfirm\", \"开始新对话将清除当前聊天记录，确定吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={async () => { await clearChat(); }}>\r\n              {t(\"common.confirm\", \"确定\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AskXiaoxiongDialog;\r\n","import { memo, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { ShoppingBag, CalendarCheck, MessageCircle, Search, Info, ChefHat, BookOpen } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport { useActiveHomepageTemplates } from \"@/hooks/useHomepageTemplates\";\r\nimport { useNavigationSettings } from \"@/hooks/useNavigationSettings\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { openExternalUrl } from \"@/lib/externalLinks\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\n\r\ninterface MobileHeroSectionProps {\r\n  stats: { order_count: number; reserve_count: number } | null;\r\n  onAskXiaoxiong: () => void;\r\n}\r\n\r\nconst MobileHeroSection = memo(({ stats, onAskXiaoxiong }: MobileHeroSectionProps) => {\r\n  const navigate = useNavigate();\r\n  const { t, i18n } = useTranslation();\r\n  const { data: templates } = useActiveHomepageTemplates();\r\n  const { buttons } = useNavigationSettings();\r\n  const { settings } = useSiteSettings();\r\n  const currentLang = i18n.language;\r\n  \r\n  // State for external link confirmation dialog\r\n  const [showExternalLinkDialog, setShowExternalLinkDialog] = useState(false);\r\n  \r\n  // Check if About Us button should be shown\r\n  const showAboutUsButton = settings?.about_us_button_mobile !== false;\r\n\r\n  // Find demo button from navigation settings\r\n  const demoButton = buttons?.find(\r\n    (btn) => btn.label_zh === \"演示\" || btn.link?.includes(\"v.xiaoxiong.pt\")\r\n  );\r\n\r\n  // Check if demo button should be shown\r\n  const showDemoButton = demoButton && \r\n    demoButton.enabled !== false && \r\n    demoButton.visible !== false && \r\n    demoButton.show_on_mobile !== false;\r\n\r\n  // Get localized demo button label\r\n  const getDemoLabel = () => {\r\n    if (!demoButton) return t(\"home.hero.demo\", \"前往演示\");\r\n    if (currentLang === \"zh\") return demoButton.label_zh;\r\n    if (currentLang === \"pt\") return demoButton.label_pt;\r\n    return demoButton.label_en;\r\n  };\r\n\r\n  // Get localized text from active template\r\n  const getLocalizedText = (field: string) => {\r\n    if (!templates || templates.length === 0) return \"\";\r\n    const template = templates[0];\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const title = getLocalizedText(\"title\") || t(\"home.hero.title\");\r\n  const description = getLocalizedText(\"description\") || t(\"home.hero.description\");\r\n  const chatButtonText = getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\");\r\n\r\n  // Handle demo button click - show confirmation dialog\r\n  const handleDemoClick = () => {\r\n    setShowExternalLinkDialog(true);\r\n  };\r\n\r\n  // Handle confirmation - open external URL with iOS WebView compatibility\r\n  const handleConfirmExternalLink = () => {\r\n    if (demoButton?.link) {\r\n      openExternalUrl(demoButton.link);\r\n    }\r\n    setShowExternalLinkDialog(false);\r\n  };\r\n\r\n  return (\r\n    <section className=\"min-h-[55vh] flex flex-col bg-secondary/20\">\r\n      {/* Header Area - Brand + Demo Button */}\r\n      <div className=\"pt-20 px-4\">\r\n        {/* Top Row: Brand Name + Demo Button */}\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          {/* Brand Name with Icon */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"text-xl font-bold text-foreground\">\r\n              {t(\"home.hero.brandName\")}\r\n            </span>\r\n            <img \r\n              src={mapIcon} \r\n              alt=\"map icon\" \r\n              width={28}\r\n              height={28}\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className=\"w-7 h-7 object-contain flex-shrink-0\" \r\n            />\r\n          </div>\r\n\r\n          {/* About Us Button */}\r\n          {showAboutUsButton && (\r\n            <Link\r\n              to=\"/about-us\"\r\n              className=\"flex items-center gap-1 px-2 py-1 text-xs bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-sm hover:bg-background transition-colors whitespace-nowrap flex-shrink-0\"\r\n            >\r\n              <Info className=\"w-3.5 h-3.5 text-primary flex-shrink-0\" />\r\n              <span className=\"text-foreground/80\">\r\n                {t(\"nav.aboutUs\", \"关于我们\")}\r\n              </span>\r\n            </Link>\r\n          )}\r\n        </div>\r\n\r\n        {/* Stats Row: Delivery + Booking */}\r\n        {stats && (\r\n          <div className=\"flex items-center gap-4\">\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.delivery\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.order_count}</span>\r\n            </div>\r\n            <div className=\"flex items-center gap-1.5\">\r\n              <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n              <span className=\"text-sm text-muted-foreground\">{t(\"home.stats.reservation\")}</span>\r\n              <span className=\"font-bold text-foreground text-sm\">{stats.reserve_count}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content Area - Title, Description, Chat Button */}\r\n      <div className=\"flex-1 flex flex-col items-center justify-center px-4 py-8\">\r\n        <div className=\"max-w-md mx-auto text-center space-y-4\">\r\n          {/* Title */}\r\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground leading-tight\">\r\n            {title}\r\n          </h1>\r\n          \r\n          {/* Description */}\r\n          <p className=\"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto\">\r\n            {description}\r\n          </p>\r\n          \r\n          {/* Chat Button - Ask Xiaoxiong */}\r\n          <div className=\"pt-4 space-y-3\">\r\n            <button \r\n              onClick={onAskXiaoxiong}\r\n              className=\"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto\"\r\n            >\r\n              <MessageCircle className=\"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors\" />\r\n              <span className=\"text-sm text-muted-foreground group-hover:text-foreground transition-colors\">\r\n                {chatButtonText}\r\n              </span>\r\n              <Search className=\"w-4 h-4 text-muted-foreground/60 ml-2\" />\r\n            </button>\r\n\r\n            {/* Divider */}\r\n            <div className=\"flex items-center gap-3 px-4\">\r\n              <div className=\"flex-1 h-px bg-border/50\" />\r\n              <span className=\"text-xs text-muted-foreground/60\">{t(\"aiRecipe.or\", \"或者\")}</span>\r\n              <div className=\"flex-1 h-px bg-border/50\" />\r\n            </div>\r\n\r\n            {/* DIY Cook Button */}\r\n            <button \r\n              onClick={() => navigate(\"/ai-recipe\")}\r\n              className=\"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 border border-border/50 mx-auto\"\r\n            >\r\n              <ChefHat className=\"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors\" />\r\n              <span className=\"text-sm text-muted-foreground group-hover:text-foreground transition-colors\">\r\n                {t(\"aiRecipe.diyCook\", \"自己动手做，Ai菜谱\")}\r\n              </span>\r\n              <BookOpen className=\"w-4 h-4 text-muted-foreground/70 group-hover:text-foreground/70 transition-colors\" />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* External Link Confirmation Dialog */}\r\n      <ExternalLinkConfirmDialog\r\n        open={showExternalLinkDialog}\r\n        onOpenChange={setShowExternalLinkDialog}\r\n        onConfirm={handleConfirmExternalLink}\r\n        url={demoButton?.link}\r\n      />\r\n    </section>\r\n  );\r\n});\r\n\r\nMobileHeroSection.displayName = \"MobileHeroSection\";\r\n\r\nexport default MobileHeroSection;\r\n","import { useMemo } from \"react\";\r\nimport { useActivities, Activity, ActivityCreator } from \"@/hooks/useActivities\";\r\nimport { addDays, isSameDay, getDay, getDate, getMonth, startOfDay } from \"date-fns\";\r\n\r\n// Extended Activity type with creator\r\ntype ActivityWithExtras = Activity & { creator: ActivityCreator; share_count?: number };\r\n\r\ninterface DateRange {\r\n  start: number;\r\n  end: number;\r\n}\r\n\r\n// Type guard to check if value is a valid DateRange array\r\nconst isDateRangeArray = (value: unknown): value is DateRange[] => {\r\n  if (!value || !Array.isArray(value)) return false;\r\n  return value.every(item => \r\n    typeof item === 'object' && \r\n    item !== null &&\r\n    'start' in item && \r\n    'end' in item &&\r\n    typeof item.start === 'number' &&\r\n    typeof item.end === 'number'\r\n  );\r\n};\r\n\r\n// Check if activity is valid on a specific date\r\nconst isActivityValidOnDate = (activity: ActivityWithExtras, targetDate: Date): boolean => {\r\n  const startDate = startOfDay(new Date(activity.start_date));\r\n  const endDate = activity.end_date ? startOfDay(new Date(activity.end_date)) : null;\r\n  const target = startOfDay(targetDate);\r\n  \r\n  // Check if within valid period\r\n  if (target < startDate) return false;\r\n  if (endDate && target > endDate) return false;\r\n  \r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  \r\n  switch (repeatMode) {\r\n    case \"none\":\r\n      // Only valid on start date\r\n      return isSameDay(startDate, target);\r\n      \r\n    case \"daily\":\r\n      // Valid every day\r\n      return true;\r\n      \r\n    case \"weekly\":\r\n      // Check weekday (0-6, Sunday = 0)\r\n      const targetWeekday = getDay(target);\r\n      // Need to fetch repeat_weekday from the raw data\r\n      const weekday = (activity as any).repeat_weekday;\r\n      return weekday === targetWeekday;\r\n      \r\n    case \"monthly\":\r\n      // Check day of month ranges\r\n      const targetDayOfMonth = getDate(target);\r\n      const monthRanges = (activity as any).repeat_month_day;\r\n      if (!isDateRangeArray(monthRanges)) return false;\r\n      return monthRanges.some(range => \r\n        targetDayOfMonth >= range.start && targetDayOfMonth <= range.end\r\n      );\r\n      \r\n    case \"yearly\":\r\n      // Check month and day of year\r\n      const targetMonth = getMonth(target) + 1; // 1-12\r\n      const targetDay = getDate(target);\r\n      const yearlyMonth = (activity as any).repeat_yearly_month;\r\n      const yearlyDay = (activity as any).repeat_yearly_day;\r\n      return yearlyMonth === targetMonth && yearlyDay === targetDay;\r\n             \r\n    default:\r\n      return false;\r\n  }\r\n};\r\n\r\n// Get sort weight for activity (lower = higher priority)\r\nconst getActivitySortWeight = (activity: ActivityWithExtras): number => {\r\n  const repeatMode = activity.repeat_mode || \"none\";\r\n  switch (repeatMode) {\r\n    case \"none\": return 0;      // Dated activities first\r\n    case \"weekly\": return 1;\r\n    case \"monthly\": return 2;\r\n    case \"yearly\": return 3;\r\n    case \"daily\": return 4;     // Daily activities last\r\n    default: return 5;\r\n  }\r\n};\r\n\r\nexport interface ActivityWithDayLabel extends ActivityWithExtras {\r\n  dayLabel: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\";\r\n}\r\n\r\nexport const useRecentActivities = () => {\r\n  const { data: activities, isLoading } = useActivities();\r\n  \r\n  const recentActivities = useMemo(() => {\r\n    if (!activities) return { today: [], tomorrow: [], dayAfterTomorrow: [] };\r\n    \r\n    const today = new Date();\r\n    const tomorrow = addDays(today, 1);\r\n    const dayAfterTomorrow = addDays(today, 2);\r\n    \r\n    const filterAndSort = (date: Date): ActivityWithExtras[] => {\r\n      return activities\r\n        .filter(a => a.visible && a.status === \"published\")\r\n        .filter(a => isActivityValidOnDate(a, date))\r\n        .sort((a, b) => {\r\n          // Sort by type weight first\r\n          const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n          if (weightDiff !== 0) return weightDiff;\r\n          \r\n          // Then by pinned and sort_order\r\n          if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n          return (a.sort_order || 0) - (b.sort_order || 0);\r\n        });\r\n    };\r\n    \r\n    return {\r\n      today: filterAndSort(today),\r\n      tomorrow: filterAndSort(tomorrow),\r\n      dayAfterTomorrow: filterAndSort(dayAfterTomorrow),\r\n    };\r\n  }, [activities]);\r\n  \r\n  // Combine all recent activities (deduplicated, with day label)\r\n  const allRecentActivities = useMemo((): ActivityWithDayLabel[] => {\r\n    const seen = new Set<string>();\r\n    const combined: ActivityWithDayLabel[] = [];\r\n    \r\n    // Add today's activities\r\n    recentActivities.today.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"today\" });\r\n      }\r\n    });\r\n    \r\n    // Add tomorrow's activities\r\n    recentActivities.tomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"tomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Add day after tomorrow's activities\r\n    recentActivities.dayAfterTomorrow.forEach(activity => {\r\n      if (!seen.has(activity.id)) {\r\n        seen.add(activity.id);\r\n        combined.push({ ...activity, dayLabel: \"dayAfterTomorrow\" });\r\n      }\r\n    });\r\n    \r\n    // Sort combined list\r\n    return combined.sort((a, b) => {\r\n      const weightDiff = getActivitySortWeight(a) - getActivitySortWeight(b);\r\n      if (weightDiff !== 0) return weightDiff;\r\n      if (a.pinned !== b.pinned) return a.pinned ? -1 : 1;\r\n      return (a.sort_order || 0) - (b.sort_order || 0);\r\n    });\r\n  }, [recentActivities]);\r\n  \r\n  return {\r\n    recentActivities,\r\n    allRecentActivities,\r\n    isLoading,\r\n    hasActivities: allRecentActivities.length > 0,\r\n  };\r\n};\r\n","import { memo, useMemo, useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { ArrowRight, Calendar, UtensilsCrossed, ShoppingBag } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { useRecentActivities, ActivityWithDayLabel } from \"@/hooks/useRecentActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Get responsive display count based on window width\r\nconst useResponsiveCount = () => {\r\n  const [count, setCount] = useState(4);\r\n  \r\n  useEffect(() => {\r\n    const updateCount = () => {\r\n      const width = window.innerWidth;\r\n      if (width < 640) {\r\n        setCount(2);\r\n      } else if (width < 1024) {\r\n        setCount(3);\r\n      } else {\r\n        setCount(4);\r\n      }\r\n    };\r\n    \r\n    updateCount();\r\n    window.addEventListener(\"resize\", updateCount);\r\n    return () => window.removeEventListener(\"resize\", updateCount);\r\n  }, []);\r\n  \r\n  return count;\r\n};\r\n\r\n// Activity Card Component\r\nconst ActivityCard = memo(({ \r\n  activity, \r\n  dayLabel \r\n}: { \r\n  activity: ActivityWithDayLabel; \r\n  dayLabel: string;\r\n}) => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const title = getLocalizedField(activity, \"title\");\r\n  \r\n  const serviceTypeLabel = useMemo(() => {\r\n    switch (activity.service_type) {\r\n      case \"dine_in\":\r\n        return t(\"activities.serviceType.dine_in\");\r\n      case \"takeaway\":\r\n        return t(\"activities.serviceType.takeaway\");\r\n      case \"both\":\r\n        return t(\"activities.serviceType.both\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  }, [activity.service_type, t]);\r\n  \r\n  const handleClick = () => {\r\n    navigate(`/activity/${activity.id}`);\r\n  };\r\n  \r\n  return (\r\n    <Card \r\n      className=\"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card\"\r\n      onClick={handleClick}\r\n    >\r\n      {/* Image Container */}\r\n      <div className=\"relative aspect-[16/10] overflow-hidden bg-muted\">\r\n        {activity.image_url ? (\r\n          <img \r\n            src={activity.image_url} \r\n            alt={title}\r\n            className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            loading=\"lazy\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5\">\r\n            <Calendar className=\"w-12 h-12 text-primary/40\" />\r\n          </div>\r\n        )}\r\n        \r\n        {/* Day Badge */}\r\n        <Badge \r\n          className={cn(\r\n            \"absolute top-2 left-2 text-xs font-medium\",\r\n            dayLabel === t(\"home.recentActivities.today\") \r\n              ? \"bg-primary text-primary-foreground\" \r\n              : \"bg-secondary text-secondary-foreground\"\r\n          )}\r\n        >\r\n          {dayLabel}\r\n        </Badge>\r\n        \r\n        {/* Pinned Badge */}\r\n        {activity.pinned && (\r\n          <Badge \r\n            className=\"absolute top-2 right-2 text-xs bg-accent text-accent-foreground\"\r\n          >\r\n            {t(\"activities.pinned\")}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <div className=\"p-3 space-y-2\">\r\n        <h3 className=\"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors\">\r\n          {title}\r\n        </h3>\r\n        \r\n        <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n          {activity.service_type === \"dine_in\" && (\r\n            <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"takeaway\" && (\r\n            <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n          )}\r\n          {activity.service_type === \"both\" && (\r\n            <>\r\n              <UtensilsCrossed className=\"w-3 h-3 flex-shrink-0\" />\r\n              <ShoppingBag className=\"w-3 h-3 flex-shrink-0\" />\r\n            </>\r\n          )}\r\n          <span className=\"truncate\">{serviceTypeLabel}</span>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n});\r\nActivityCard.displayName = \"ActivityCard\";\r\n\r\n// Loading Skeleton\r\nconst LoadingSkeleton = memo(() => {\r\n  const displayCount = useResponsiveCount();\r\n  \r\n  return (\r\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n      {Array.from({ length: displayCount }).map((_, i) => (\r\n        <Card key={i} className=\"overflow-hidden\">\r\n          <Skeleton className=\"aspect-[16/10] w-full\" />\r\n          <div className=\"p-3 space-y-2\">\r\n            <Skeleton className=\"h-4 w-full\" />\r\n            <Skeleton className=\"h-3 w-2/3\" />\r\n          </div>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\nLoadingSkeleton.displayName = \"LoadingSkeleton\";\r\n\r\n// Main Component\r\nconst RecentActivitiesSection = memo(() => {\r\n  const { t } = useTranslation();\r\n  const { allRecentActivities, isLoading, hasActivities } = useRecentActivities();\r\n  const displayCount = useResponsiveCount();\r\n  const [showAll, setShowAll] = useState(false);\r\n  \r\n  // Get day label for display\r\n  const getDayLabel = (dayKey: \"today\" | \"tomorrow\" | \"dayAfterTomorrow\") => {\r\n    switch (dayKey) {\r\n      case \"today\":\r\n        return t(\"home.recentActivities.today\");\r\n      case \"tomorrow\":\r\n        return t(\"home.recentActivities.tomorrow\");\r\n      case \"dayAfterTomorrow\":\r\n        return t(\"home.recentActivities.dayAfterTomorrow\");\r\n      default:\r\n        return \"\";\r\n    }\r\n  };\r\n  \r\n  // Slice activities to display count or show all\r\n  const displayedActivities = useMemo(() => {\r\n    if (showAll) {\r\n      return allRecentActivities;\r\n    }\r\n    return allRecentActivities.slice(0, displayCount);\r\n  }, [allRecentActivities, displayCount, showAll]);\r\n  \r\n  const hasMore = allRecentActivities.length > displayCount;\r\n  \r\n  // Don't render if no activities and not loading\r\n  if (!isLoading && !hasActivities) {\r\n    return null;\r\n  }\r\n  \r\n  return (\r\n    <section className=\"py-8 sm:py-12 px-4 bg-secondary/20\">\r\n      <div className=\"container mx-auto max-w-7xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-foreground\">\r\n            {t(\"home.recentActivities.title\")}\r\n          </h2>\r\n          \r\n          {hasMore && !showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-primary hover:text-primary/80\"\r\n              onClick={() => setShowAll(true)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.viewAll\")}\r\n                <ArrowRight className=\"w-4 h-4\" />\r\n              </span>\r\n            </Button>\r\n          )}\r\n          \r\n          {showAll && (\r\n            <Button \r\n              variant=\"ghost\" \r\n              size=\"sm\" \r\n              className=\"text-muted-foreground hover:text-foreground\"\r\n              onClick={() => setShowAll(false)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentActivities.collapse\")}\r\n              </span>\r\n            </Button>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Content */}\r\n        {isLoading ? (\r\n          <LoadingSkeleton />\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {displayedActivities.map((activity) => (\r\n              <ActivityCard \r\n                key={activity.id} \r\n                activity={activity}\r\n                dayLabel={getDayLabel(activity.dayLabel)}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n});\r\nRecentActivitiesSection.displayName = \"RecentActivitiesSection\";\r\n\r\nexport default RecentActivitiesSection;\r\n","import { memo, useMemo, useState, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { ArrowRight, Heart, MessageCircle, Image, Play, ChefHat } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\n// Get responsive display count based on window width\r\nconst useResponsiveCount = () => {\r\n  const [count, setCount] = useState(4);\r\n  \r\n  useEffect(() => {\r\n    const updateCount = () => {\r\n      const width = window.innerWidth;\r\n      if (width < 640) setCount(2);\r\n      else if (width < 1024) setCount(3);\r\n      else setCount(4);\r\n    };\r\n    updateCount();\r\n    window.addEventListener(\"resize\", updateCount);\r\n    return () => window.removeEventListener(\"resize\", updateCount);\r\n  }, []);\r\n  \r\n  return count;\r\n};\r\n\r\n// Post Card Component\r\nconst RecentPostCard = memo(({ post }: { post: any }) => {\r\n  const navigate = useNavigate();\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const isRecipe = post.post_type === \"recipe\";\r\n  const title = isRecipe\r\n    ? getLocalizedField(post, \"recipe_name\") || post.recipe_name\r\n    : null;\r\n  const content = getLocalizedField(post, \"content\") || post.content;\r\n  const displayText = title || content;\r\n  const coverImage = post.image_urls?.[0] || null;\r\n  const authorName = post.author?.display_name || t(\"community.anonymous\", \"匿名用户\");\r\n  const authorAvatar = post.author?.avatar_url;\r\n  \r\n  return (\r\n    <Card\r\n      className=\"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card\"\r\n      onClick={() => navigate(`/community/post/${post.id}`)}\r\n    >\r\n      {/* Image Container */}\r\n      <div className=\"relative aspect-[16/10] overflow-hidden bg-muted\">\r\n        {coverImage ? (\r\n          <img\r\n            src={coverImage}\r\n            alt={displayText || \"\"}\r\n            className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300\"\r\n            loading=\"lazy\"\r\n          />\r\n        ) : (\r\n          <div className=\"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5\">\r\n            {isRecipe ? (\r\n              <ChefHat className=\"w-12 h-12 text-primary/40\" />\r\n            ) : (\r\n              <Image className=\"w-12 h-12 text-primary/40\" />\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Recipe Badge */}\r\n        <Badge className=\"absolute top-2 left-2 text-xs font-medium bg-accent text-accent-foreground\">\r\n          {t(\"community.recipe\", \"食谱\")}\r\n        </Badge>\r\n\r\n        {/* Video indicator */}\r\n        {post.video_url && (\r\n          <div className=\"absolute top-2 right-2 w-6 h-6 rounded-full bg-black/50 flex items-center justify-center\">\r\n            <Play className=\"w-3 h-3 text-white fill-white\" />\r\n          </div>\r\n        )}\r\n\r\n        {/* Multi-image indicator */}\r\n        {!post.video_url && post.image_urls?.length > 1 && (\r\n          <div className=\"absolute top-2 right-2 bg-black/50 text-white text-[10px] px-1.5 py-0.5 rounded-full\">\r\n            {post.image_urls.length}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"p-3 space-y-2\">\r\n        <p className=\"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors\">\r\n          {displayText}\r\n        </p>\r\n\r\n        <div className=\"flex items-center justify-between\">\r\n          {/* Author */}\r\n          <div className=\"flex items-center gap-1.5 min-w-0\">\r\n            <Avatar className=\"w-4 h-4\">\r\n              <AvatarImage src={authorAvatar || undefined} />\r\n              <AvatarFallback className=\"text-[8px]\">{authorName[0]}</AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate max-w-[60px]\">{authorName}</span>\r\n          </div>\r\n\r\n          {/* Stats */}\r\n          <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n            <span className=\"flex items-center gap-0.5\">\r\n              <Heart className=\"w-3 h-3\" />\r\n              {post.likes_count || 0}\r\n            </span>\r\n            <span className=\"flex items-center gap-0.5\">\r\n              <MessageCircle className=\"w-3 h-3\" />\r\n              {post.comments_count || 0}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n});\r\nRecentPostCard.displayName = \"RecentPostCard\";\r\n\r\n// Loading Skeleton\r\nconst LoadingSkeleton = memo(() => {\r\n  const displayCount = useResponsiveCount();\r\n  return (\r\n    <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n      {Array.from({ length: displayCount }).map((_, i) => (\r\n        <Card key={i} className=\"overflow-hidden\">\r\n          <Skeleton className=\"aspect-[16/10] w-full\" />\r\n          <div className=\"p-3 space-y-2\">\r\n            <Skeleton className=\"h-4 w-full\" />\r\n            <Skeleton className=\"h-3 w-2/3\" />\r\n          </div>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n});\r\nLoadingSkeleton.displayName = \"RecentPostsSkeleton\";\r\n\r\n// Main Component\r\nconst RecentPostsSection = memo(() => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const displayCount = useResponsiveCount();\r\n  const [showAll, setShowAll] = useState(false);\r\n\r\n  const { data: posts = [], isLoading } = useQuery({\r\n    queryKey: [\"recent-home-recipes\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"community_posts\")\r\n        .select(`\r\n          id, content, content_en, content_zh, content_pt,\r\n          image_urls, video_url, post_type,\r\n          recipe_name, recipe_name_en, recipe_name_pt,\r\n          likes_count, comments_count, shares_count, views_count,\r\n          created_at,\r\n          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url)\r\n        `)\r\n        .eq(\"status\", \"approved\")\r\n        .eq(\"post_type\", \"recipe\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(12);\r\n\r\n      if (error) throw error;\r\n      return (data || []).map((p: any) => ({\r\n        ...p,\r\n        author: Array.isArray(p.author) ? p.author[0] : p.author,\r\n      }));\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  const displayedPosts = useMemo(() => {\r\n    return showAll ? posts : posts.slice(0, displayCount);\r\n  }, [posts, displayCount, showAll]);\r\n\r\n  const hasMore = posts.length > displayCount;\r\n\r\n  if (!isLoading && posts.length === 0) return null;\r\n\r\n  return (\r\n    <section className=\"py-8 sm:py-12 px-4 bg-secondary/20\">\r\n      <div className=\"container mx-auto max-w-7xl\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-6\">\r\n          <h2 className=\"text-xl sm:text-2xl font-bold text-foreground\">\r\n            {t(\"home.recentPosts.title\", \"近日食谱\")}\r\n          </h2>\r\n\r\n          {hasMore && !showAll && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className=\"text-primary hover:text-primary/80\"\r\n              onClick={() => setShowAll(true)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentPosts.viewAll\", \"查看全部\")}\r\n                <ArrowRight className=\"w-4 h-4\" />\r\n              </span>\r\n            </Button>\r\n          )}\r\n\r\n          {showAll && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className=\"text-muted-foreground hover:text-foreground\"\r\n              onClick={() => setShowAll(false)}\r\n            >\r\n              <span className=\"flex items-center gap-1\">\r\n                {t(\"home.recentPosts.collapse\", \"收起\")}\r\n              </span>\r\n            </Button>\r\n          )}\r\n        </div>\r\n\r\n        {/* Content */}\r\n        {isLoading ? (\r\n          <LoadingSkeleton />\r\n        ) : (\r\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4\">\r\n            {displayedPosts.map((post: any) => (\r\n              <RecentPostCard key={post.id} post={post} />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </section>\r\n  );\r\n});\r\nRecentPostsSection.displayName = \"RecentPostsSection\";\r\n\r\nexport default RecentPostsSection;\r\n","import { Button } from \"@/components/ui/button\";\r\nimport { MapPin, Search, Star, Calendar, Store, ArrowRight, ShoppingBag, CalendarCheck, Smartphone, Download, MessageCircle, ChefHat, BookOpen } from \"lucide-react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card } from \"@/components/ui/card\";\r\n// Hero images served from public folder for LCP optimization (discoverable in initial HTML)\r\nconst sushiRamenHero = \"/images/sushi-ramen-hero.jpg\";\r\nconst sushiRamenMobile = \"/images/sushi-ramen-mobile.jpg\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport googlePlayBadge from \"@/assets/google-play-badge-new.png\";\r\nimport appStoreBadge from \"@/assets/app-store-badge.svg\";\r\nimport { useState, useEffect, memo, useCallback, useRef, lazy, Suspense } from \"react\";\r\nimport { useActiveHomepageTemplates, HomepageTemplate } from \"@/hooks/useHomepageTemplates\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\nimport { HomeSkeleton } from \"@/components/skeletons\";\r\nimport { isIOSWebView, isInWebView, isCapacitorApp, isIOSDevice } from \"@/lib/externalLinks\";\r\nimport AskXiaoxiongDialog from \"@/components/AskXiaoxiongDialog\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\n// Lazy load map section - mapbox-gl is 458KB and not needed for initial render\r\nconst HomeMapSection = lazy(() => import(\"@/components/HomeMapSection\"));\r\nimport MobileHeroSection from \"@/components/MobileHeroSection\";\r\nimport RecentActivitiesSection from \"@/components/RecentActivitiesSection\";\r\nimport RecentPostsSection from \"@/components/RecentPostsSection\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport useEnvironment from \"@/hooks/useEnvironment\";\r\n// Memoized Stats Display Component\r\nconst StatsDisplay = memo(({ stats, t }: { stats: { order_count: number; reserve_count: number }; t: (key: string) => string }) => (\r\n  <div className=\"absolute top-16 sm:top-20 left-3 z-20\">\r\n    <div className=\"gap-4 w-fit flex-col flex items-start justify-start\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.delivery\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.order_count}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.reservation\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.reserve_count}</span>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"flex items-center gap-2\">\r\n        <span className=\"text-xl sm:text-2xl font-bold text-white drop-shadow-md\">\r\n          {t(\"home.hero.brandName\")}\r\n        </span>\r\n        <img \r\n          src={mapIcon} \r\n          alt=\"map icon\" \r\n          width={32}\r\n          height={32}\r\n          loading=\"eager\"\r\n          decoding=\"async\"\r\n          className=\"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0\" \r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n));\r\nStatsDisplay.displayName = \"StatsDisplay\";\r\n\r\n\r\n// Hook to determine if we should use lightweight mode for better performance\r\nconst useLightweightMode = (): boolean => {\r\n  // Safely access window properties with fallbacks for SSR/restricted environments\r\n  const getWindowWidth = () => {\r\n    try {\r\n      return typeof window !== 'undefined' ? window.innerWidth : 1024;\r\n    } catch {\r\n      return 1024;\r\n    }\r\n  };\r\n  \r\n  const getConnection = () => {\r\n    try {\r\n      return typeof navigator !== 'undefined' ? (navigator as any).connection : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n  \r\n  const getDeviceMemory = () => {\r\n    try {\r\n      return typeof navigator !== 'undefined' ? (navigator as any).deviceMemory : null;\r\n    } catch {\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const windowWidth = getWindowWidth();\r\n  const isMobile = windowWidth < 640;\r\n  const isDesktop = windowWidth >= 1024;\r\n  const connection = getConnection();\r\n  \r\n  // Detection for iOS environments - wrapped in try-catch for safety\r\n  let isCapacitor = false;\r\n  let isWebView = false;\r\n  \r\n  try {\r\n    isCapacitor = isCapacitorApp();\r\n    isWebView = isInWebView();\r\n  } catch (e) {\r\n    console.warn('[useLightweightMode] Environment detection failed:', e);\r\n  }\r\n  \r\n  // Desktop: only use lightweight mode if user explicitly enabled data saver\r\n  if (isDesktop) {\r\n    if (connection?.saveData) return true;\r\n    return false; // Desktop always loads video by default\r\n  }\r\n  \r\n  // Mobile/Tablet: WebView environments use lightweight mode\r\n  // But exclude Capacitor native apps (user's own app should play videos)\r\n  if (isWebView && !isCapacitor) {\r\n    return true;\r\n  }\r\n  \r\n  // Check for slow network or data saver (mobile/tablet)\r\n  if (connection) {\r\n    if (connection.saveData) return true;\r\n    if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') return true;\r\n  }\r\n  \r\n  // Mobile low memory devices (< 2GB) - reduced threshold\r\n  const deviceMemory = getDeviceMemory();\r\n  if (isMobile && deviceMemory && deviceMemory < 2) return true;\r\n  \r\n  return false;\r\n};\r\n\r\n// Hero Slide Component\r\nconst HeroSlide = memo(({ \r\n  template, \r\n  isActive, \r\n  currentLang, \r\n  t,\r\n  onContentReady,\r\n  onAskXiaoxiong,\r\n  onDIYCook\r\n}: { \r\n  template: HomepageTemplate; \r\n  isActive: boolean;\r\n  currentLang: string;\r\n  t: any;\r\n  onContentReady?: () => void;\r\n  onAskXiaoxiong?: () => void;\r\n  onDIYCook?: () => void;\r\n}) => {\r\n  const [postersLoaded, setPostersLoaded] = useState<Record<string, boolean>>({});\r\n  const [videosReady, setVideosReady] = useState<Record<string, boolean>>({});\r\n  const [videoErrors, setVideoErrors] = useState<Record<string, boolean>>({});\r\n  const [imagesLoaded, setImagesLoaded] = useState<Record<string, boolean>>({\r\n    mobile: true,\r\n    tablet: true, \r\n    desktop: true\r\n  });\r\n  // Control when to start loading videos - only after image is ready\r\n  const [shouldLoadVideo, setShouldLoadVideo] = useState(false);\r\n  const isLightweight = useLightweightMode();\r\n  \r\n  // Video refs for iOS Safari fix\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null);\r\n  const tabletVideoRef = useRef<HTMLVideoElement>(null);\r\n  const desktopVideoRef = useRef<HTMLVideoElement>(null);\r\n  \r\n  const getLocalizedText = (field: string) => {\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const getDeviceType = () => {\r\n    try {\r\n      if (typeof window === 'undefined') return 'desktop';\r\n      const width = window.innerWidth;\r\n      if (width < 640) return 'mobile';\r\n      if (width < 1024) return 'tablet';\r\n      return 'desktop';\r\n    } catch {\r\n      return 'desktop';\r\n    }\r\n  };\r\n\r\n  const getOverlayOpacity = () => {\r\n    const deviceType = getDeviceType();\r\n    \r\n    if (deviceType === 'mobile' && template.mobile_overlay_opacity !== null) {\r\n      return template.mobile_overlay_opacity;\r\n    }\r\n    if (deviceType === 'tablet' && template.tablet_overlay_opacity !== null) {\r\n      return template.tablet_overlay_opacity;\r\n    }\r\n    if (deviceType === 'desktop' && template.desktop_overlay_opacity !== null) {\r\n      return template.desktop_overlay_opacity;\r\n    }\r\n    \r\n    return template.overlay_opacity ?? 30;\r\n  };\r\n\r\n  const getOverlayStyle = () => {\r\n    const baseOpacity = getOverlayOpacity();\r\n    const direction = template.overlay_gradient_direction || 'to-b';\r\n    \r\n    const normalizeOpacity = (value: number | null | undefined, defaultValue: number) => {\r\n      if (value === null || value === undefined) return defaultValue / 100;\r\n      return value > 1 ? value / 100 : value;\r\n    };\r\n    \r\n    const normalizedBaseOpacity = baseOpacity > 1 ? baseOpacity / 100 : baseOpacity;\r\n    \r\n    const fromOpacity = normalizeOpacity(template.overlay_gradient_from_opacity, 30) * normalizedBaseOpacity;\r\n    const viaOpacity = normalizeOpacity(template.overlay_gradient_via_opacity, 25) * normalizedBaseOpacity;\r\n    const toOpacity = normalizeOpacity(template.overlay_gradient_to_opacity, 40) * normalizedBaseOpacity;\r\n\r\n    const directionMap: Record<string, string> = {\r\n      'to-t': 'to top',\r\n      'to-b': 'to bottom',\r\n      'to-l': 'to left',\r\n      'to-r': 'to right',\r\n      'to-tl': 'to top left',\r\n      'to-tr': 'to top right',\r\n      'to-bl': 'to bottom left',\r\n      'to-br': 'to bottom right'\r\n    };\r\n\r\n    const cssDirection = directionMap[direction] || 'to bottom';\r\n\r\n    const colorMap: Record<string, string> = {\r\n      'black': '0, 0, 0',\r\n      'white': '255, 255, 255',\r\n      'background': '0, 0, 0',\r\n      'foreground': '255, 255, 255',\r\n      'primary': '1, 100, 80',\r\n      'secondary': '240, 240, 240'\r\n    };\r\n\r\n    const fromColor = colorMap[template.overlay_gradient_from || 'black'] || '0, 0, 0';\r\n    const viaColor = colorMap[template.overlay_gradient_via || 'black'] || '0, 0, 0';\r\n    const toColor = colorMap[template.overlay_gradient_to || 'black'] || '0, 0, 0';\r\n\r\n    return {\r\n      background: `linear-gradient(${cssDirection}, rgba(${fromColor}, ${fromOpacity}), rgba(${viaColor}, ${viaOpacity}), rgba(${toColor}, ${toOpacity}))`\r\n    };\r\n  };\r\n\r\n  const mobileImg = template.mobile_image_url || sushiRamenMobile;\r\n  const tabletImg = template.tablet_image_url || template.desktop_image_url || sushiRamenHero;\r\n  const desktopImg = template.desktop_image_url || sushiRamenHero;\r\n  const blurAmount = template.background_blur || 0;\r\n\r\n  // Per-device media type (fallback to global media_type for backwards compatibility)\r\n  const desktopMediaType = (template as any).desktop_media_type || template.media_type || 'image';\r\n  const tabletMediaType = (template as any).tablet_media_type || template.media_type || 'image';\r\n  const mobileMediaType = (template as any).mobile_media_type || template.media_type || 'image';\r\n\r\n  // In lightweight mode (WebView), always treat as image to avoid video loading overhead\r\n  const isDesktopVideo = desktopMediaType === 'video' && !isLightweight;\r\n  const isTabletVideo = tabletMediaType === 'video' && !isLightweight;\r\n  const isMobileVideo = mobileMediaType === 'video' && !isLightweight;\r\n  \r\n  const mobileVideo = isMobileVideo ? template.mobile_video_url : null;\r\n  const tabletVideo = isTabletVideo ? (template.tablet_video_url || template.desktop_video_url) : null;\r\n  const desktopVideo = isDesktopVideo ? template.desktop_video_url : null;\r\n\r\n  // Preload only current device's poster image to prevent flash\r\n  useEffect(() => {\r\n    const deviceType = getDeviceType();\r\n    const currentImage = deviceType === 'mobile' ? mobileImg \r\n      : deviceType === 'tablet' ? tabletImg : desktopImg;\r\n    \r\n    if (currentImage) {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        setPostersLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        setImagesLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        // Image is ready - notify parent and start loading video\r\n        if (isActive) {\r\n          onContentReady?.();\r\n          // Start loading video after image is displayed (with slight delay for smoother UX)\r\n          setTimeout(() => setShouldLoadVideo(true), 100);\r\n        }\r\n      };\r\n      img.src = currentImage;\r\n    }\r\n  }, [mobileImg, tabletImg, desktopImg, isActive, onContentReady]);\r\n\r\n  // Also enable video loading when slide becomes active (for carousel navigation)\r\n  useEffect(() => {\r\n    if (isActive && postersLoaded[getDeviceType()]) {\r\n      setShouldLoadVideo(true);\r\n    }\r\n  }, [isActive, postersLoaded]);\r\n\r\n  const handleVideoCanPlay = (device: string) => {\r\n    setVideosReady(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  const handleVideoError = (device: string, error: any) => {\r\n    console.error(`[HeroSlide] Video error on ${device}:`, error);\r\n    setVideoErrors(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  // iOS Safari video autoplay fix - programmatically set muted and trigger play\r\n  useEffect(() => {\r\n    if (!shouldLoadVideo || !isActive) return;\r\n    \r\n    let isIOS = false;\r\n    try {\r\n      isIOS = isIOSDevice();\r\n    } catch {\r\n      // Ignore detection errors in restricted WebView environments\r\n    }\r\n    if (!isIOS) return;\r\n\r\n    const deviceType = getDeviceType();\r\n    const videoRef = deviceType === 'mobile' ? mobileVideoRef \r\n      : deviceType === 'tablet' ? tabletVideoRef : desktopVideoRef;\r\n    \r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    // For iOS, we need to programmatically ensure muted is set and call play()\r\n    const attemptPlay = async () => {\r\n      try {\r\n        video.muted = true;\r\n        video.playsInline = true;\r\n        // Set webkit-playsinline for older iOS versions\r\n        video.setAttribute('webkit-playsinline', 'true');\r\n        \r\n        await video.play();\r\n        console.log(`[HeroSlide] iOS video play successful on ${deviceType}`);\r\n      } catch (err) {\r\n        console.error(`[HeroSlide] iOS video play failed on ${deviceType}:`, err);\r\n        // Mark as error so we show the fallback image\r\n        setVideoErrors(prev => ({ ...prev, [deviceType]: true }));\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure video element is ready\r\n    const timer = setTimeout(attemptPlay, 150);\r\n    return () => clearTimeout(timer);\r\n  }, [shouldLoadVideo, isActive]);\r\n\r\n  return (\r\n    <div className={cn(\r\n      \"absolute inset-0 w-full h-full transition-opacity duration-1000\",\r\n      isActive ? \"opacity-100 z-10\" : \"opacity-0 z-0\"\r\n    )}>\r\n      {/* 背景媒体 */}\r\n      <div className=\"absolute inset-0 w-full h-full\">\r\n        {/* Mobile: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full sm:hidden\">\r\n          {!imagesLoaded.mobile && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isMobileVideo && mobileVideo ? (\r\n            <>\r\n              <img \r\n                src={mobileImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.mobile && !videoErrors.mobile ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.mobile && (\r\n                <video\r\n                  ref={mobileVideoRef}\r\n                  src={mobileVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('mobile')}\r\n                  onError={(e) => handleVideoError('mobile', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={mobileImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.mobile ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Tablet: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden sm:block lg:hidden\">\r\n          {!imagesLoaded.tablet && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isTabletVideo && tabletVideo ? (\r\n            <>\r\n              <img \r\n                src={tabletImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.tablet && !videoErrors.tablet ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.tablet && (\r\n                <video\r\n                  ref={tabletVideoRef}\r\n                  src={tabletVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('tablet')}\r\n                  onError={(e) => handleVideoError('tablet', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={tabletImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.tablet ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Desktop: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden lg:block\">\r\n          {!imagesLoaded.desktop && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isDesktopVideo && desktopVideo ? (\r\n            <>\r\n              <img \r\n                src={desktopImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.desktop && !videoErrors.desktop ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.desktop && (\r\n                <video\r\n                  ref={desktopVideoRef}\r\n                  src={desktopVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('desktop')}\r\n                  onError={(e) => handleVideoError('desktop', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={desktopImg} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.desktop ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"absolute inset-0 w-full h-full\" style={getOverlayStyle()} />\r\n      </div>\r\n\r\n      {/* 内容 */}\r\n      <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen\">\r\n        <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n          <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n            {getLocalizedText(\"title\") || t(\"home.hero.title\")}\r\n          </h1>\r\n          \r\n          <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n            {getLocalizedText(\"description\") || t(\"home.hero.description\")}\r\n          </p>\r\n          \r\n          {template.subtitle_button_text_zh && (\r\n            <div className=\"flex flex-col items-center gap-3\">\r\n              <button \r\n                onClick={onAskXiaoxiong}\r\n                className=\"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40\"\r\n              >\r\n                <MessageCircle className=\"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm\" />\r\n                <span className=\"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium\">\r\n                  {getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\")}\r\n                </span>\r\n                <Search className=\"w-4 h-4 text-white/60 ml-2 drop-shadow-sm\" />\r\n              </button>\r\n\r\n              {/* Divider */}\r\n              <div className=\"flex items-center gap-3 w-64\">\r\n                <div className=\"flex-1 h-px bg-white/30\" />\r\n                <span className=\"text-xs text-white/60\">{t(\"aiRecipe.or\", \"或者\")}</span>\r\n                <div className=\"flex-1 h-px bg-white/30\" />\r\n              </div>\r\n\r\n              {/* DIY Cook Button */}\r\n              <button \r\n                onClick={onDIYCook}\r\n                className=\"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 border border-white/40\"\r\n              >\r\n                <ChefHat className=\"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm\" />\r\n                <span className=\"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium\">\r\n                  {t(\"aiRecipe.diyCook\", \"自己动手做\")}\r\n                </span>\r\n                <BookOpen className=\"w-4 h-4 text-white/70 group-hover:text-white/90 transition-colors drop-shadow-sm\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nHeroSlide.displayName = \"HeroSlide\";\r\n\r\nconst Home = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const queryClient = useQueryClient();\r\n  const { settings: siteSettings } = useSiteSettings();\r\n  const { data: templates, isLoading: isLoadingTemplates, refetch: refetchTemplates } = useActiveHomepageTemplates();\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [stats, setStats] = useState<{ order_count: number; reserve_count: number } | null>(null);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [firstSlideReady, setFirstSlideReady] = useState(false);\r\n  const [askDialogOpen, setAskDialogOpen] = useState(false);\r\n  \r\n  // Mobile/WebView detection for conditional layout\r\n  const isMobile = useIsMobile();\r\n  const { isWebView, isNativeApp } = useEnvironment();\r\n  const showMobileLayout = isMobile || isWebView;\r\n  \r\n  // Use environment hook values instead of direct function calls to avoid exceptions\r\n  const shouldHideAppDownload = isWebView || isNativeApp;\r\n  \r\n  // Check if AI assistant is enabled\r\n  const isAIAssistantEnabled = siteSettings?.ai_assistant_enabled !== false;\r\n  \r\n  // Handler for when the first slide's content is ready\r\n  const handleContentReady = useCallback(() => {\r\n    setFirstSlideReady(true);\r\n  }, []);\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"home\" });\r\n\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(\"https://v.xiaoxiong.pt/api/get_info\");\r\n      const result = await response.json();\r\n      if (result) {\r\n        setStats({\r\n          order_count: result.order_count || 0,\r\n          reserve_count: result.reserve_count || 0\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch stats:\", error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [fetchStats]);\r\n\r\n  // Pull-to-refresh handler - clears all caches and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear all related caches first\r\n    queryClient.removeQueries({ queryKey: ['homepage-templates'] });\r\n    queryClient.removeQueries({ queryKey: ['restaurants'] });\r\n    queryClient.removeQueries({ queryKey: ['activities'] });\r\n    queryClient.removeQueries({ queryKey: ['recent-activities'] });\r\n    \r\n    // Then refetch fresh data\r\n    await Promise.all([\r\n      refetchTemplates(),\r\n      fetchStats(),\r\n      queryClient.invalidateQueries({ queryKey: ['restaurants'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['activities'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['recent-activities'] }),\r\n    ]);\r\n  }, [refetchTemplates, fetchStats, queryClient]);\r\n\r\n  // Auto-rotate carousel\r\n  useEffect(() => {\r\n    if (!templates || templates.length <= 1) return;\r\n\r\n    const currentTemplate = templates[currentIndex];\r\n    const duration = currentTemplate?.duration || 5000;\r\n\r\n    timerRef.current = setTimeout(() => {\r\n      setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n    }, duration);\r\n\r\n    return () => {\r\n      if (timerRef.current) clearTimeout(timerRef.current);\r\n    };\r\n  }, [templates, currentIndex]);\r\n\r\n  const goToSlide = useCallback((index: number) => {\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex(index);\r\n  }, []);\r\n\r\n  const goToPrev = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev - 1 + templates.length) % templates.length);\r\n  }, [templates]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n  }, [templates]);\r\n\r\n  const currentLang = i18n.language;\r\n  const showControls = templates && templates.length > 1;\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen\">\r\n        {/* Hero Section - Conditional Layout */}\r\n        {showMobileLayout ? (\r\n          // Mobile/WebView: Simplified hero without background\r\n          <MobileHeroSection \r\n            stats={stats} \r\n            onAskXiaoxiong={() => setAskDialogOpen(true)} \r\n          />\r\n        ) : (\r\n          // Desktop: Full carousel with background media\r\n          <section className=\"relative h-screen flex items-start overflow-hidden bg-background\">\r\n            {/* 统计数据显示 - 左上角 */}\r\n            {stats && <StatsDisplay stats={stats} t={t} />}\r\n\r\n            {/* Carousel Slides */}\r\n            <div className={cn(\r\n              \"absolute inset-0 w-full h-full transition-opacity duration-500\",\r\n              firstSlideReady ? \"opacity-100\" : \"opacity-0\"\r\n            )}>\r\n              {templates?.map((template, index) => (\r\n                <HeroSlide\r\n                  key={template.id}\r\n                  template={template}\r\n                  isActive={index === currentIndex}\r\n                  currentLang={currentLang}\r\n                  t={t}\r\n                  onContentReady={index === 0 ? handleContentReady : undefined}\r\n                  onAskXiaoxiong={() => setAskDialogOpen(true)}\r\n                  onDIYCook={() => navigate(\"/ai-recipe\")}\r\n                />\r\n              ))}\r\n            </div>\r\n\r\n            {/* Loading state - show skeleton until content is actually ready */}\r\n            <div \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full z-20 transition-opacity duration-500\",\r\n                (isLoadingTemplates || !firstSlideReady) ? \"opacity-100\" : \"opacity-0 pointer-events-none\"\r\n              )}\r\n            >\r\n              <HomeSkeleton />\r\n            </div>\r\n\r\n            {/* Fallback if no templates (only after loading completes) */}\r\n            {!isLoadingTemplates && (!templates || templates.length === 0) && (\r\n              <div className=\"absolute inset-0 w-full h-full\">\r\n                <img \r\n                  src={sushiRamenMobile} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center sm:hidden\"\r\n                />\r\n                <img \r\n                  src={sushiRamenHero} \r\n                  alt=\"Background\" \r\n                  fetchPriority=\"high\"\r\n                  loading=\"eager\"\r\n                  decoding=\"async\"\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center hidden sm:block\"\r\n                />\r\n                <div className=\"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40\" />\r\n                <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen\">\r\n                  <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n                    <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n                      {t(\"home.hero.title\")}\r\n                    </h1>\r\n                    <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n                      {t(\"home.hero.description\")}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Carousel Controls - Dot Indicators Only */}\r\n            {showControls && (\r\n              <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2\">\r\n                {templates.map((_, index) => (\r\n                  <button\r\n                    key={index}\r\n                    onClick={() => goToSlide(index)}\r\n                    className={cn(\r\n                      \"w-3 h-3 rounded-full transition-all duration-300\",\r\n                      index === currentIndex \r\n                        ? \"bg-white w-8\" \r\n                        : \"bg-white/50 hover:bg-white/70\"\r\n                    )}\r\n                    aria-label={`Go to slide ${index + 1}`}\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n          </section>\r\n        )}\r\n\r\n      {/* Recent Activities Section */}\r\n      <RecentActivitiesSection />\r\n\r\n      {/* Recent Posts Section */}\r\n      <RecentPostsSection />\r\n\r\n      {/* Map Section */}\r\n      <section className=\"py-12 sm:py-20 px-4 bg-secondary/20\">\r\n        <div className=\"container mx-auto max-w-7xl\">\r\n          <Suspense fallback={<div className=\"h-[400px] bg-muted/30 rounded-lg animate-pulse\" />}>\r\n            <HomeMapSection />\r\n          </Suspense>\r\n        </div>\r\n      </section>\r\n\r\n      {/* App Download Section - Hidden in WebView/Native App */}\r\n      {!shouldHideAppDownload && (\r\n      <section className=\"py-16 sm:py-24 px-4 relative overflow-hidden\">\r\n        {/* Background with soft edges using mask */}\r\n        <div \r\n          className=\"absolute inset-0 bg-gradient-to-br from-primary/5 via-primary/3 to-primary/8\"\r\n          style={{\r\n            maskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n            WebkitMaskImage: 'radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)',\r\n          }}\r\n        />\r\n        \r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-1/4 left-1/4 w-72 h-72 bg-primary/8 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-5xl relative z-10\">\r\n          <div className=\"flex flex-col items-center justify-center gap-8\">\r\n            \r\n            {/* Content */}\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4\">\r\n                <Smartphone className=\"w-4 h-4\" />\r\n                <span>Mobile App</span>\r\n              </div>\r\n              <h3 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4\">\r\n                {t(\"home.app.title\")}\r\n              </h3>\r\n              <p className=\"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed\">\r\n                {t(\"home.app.description\")}\r\n              </p>\r\n              <div className=\"flex flex-col items-center gap-4\">\r\n                <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n                  {/* App Store */}\r\n                  <a \r\n                    href=\"https://apps.apple.com/cn/app/xiaoxiong/id6755481369\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={appStoreBadge} \r\n                        alt=\"Download on the App Store\" \r\n                        width={108}\r\n                        height={36}\r\n                        className=\"h-8 sm:h-9\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                  \r\n                  {/* Google Play */}\r\n                  <a \r\n                    href=\"https://play.google.com/store/apps/details?id=com.xiaoxiong.market\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={googlePlayBadge} \r\n                        alt=\"Get it on Google Play\" \r\n                        width={145}\r\n                        height={56}\r\n                        className=\"h-12 sm:h-14\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                </div>\r\n                \r\n                {/* Download hint */}\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Download className=\"w-4 h-4 animate-bounce\" />\r\n                  <span>{t(\"home.app.downloadNow\")}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n      )}\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"py-16 sm:py-20 px-4 bg-gradient-to-r from-primary/90 to-primary relative overflow-hidden rounded-3xl mx-4 sm:mx-8 lg:mx-16 mb-8\">\r\n        <div className=\"absolute inset-0 bg-grid-pattern opacity-10\" />\r\n        <div className=\"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-4xl text-center relative z-10\">\r\n          <h2 className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4\">\r\n            {t(\"home.cta.title\")}\r\n          </h2>\r\n          <p className=\"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4\">\r\n            {t(\"home.cta.description\")}\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <Button size=\"lg\" variant=\"secondary\" asChild className=\"text-base sm:text-lg shadow-xl hover:shadow-2xl\">\r\n              <Link to=\"/join-us\">\r\n                <Store className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {t(\"home.cta.button\")}\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Ask Xiaoxiong Dialog - conditionally rendered based on settings */}\r\n      {isAIAssistantEnabled && (\r\n        <AskXiaoxiongDialog open={askDialogOpen} onOpenChange={setAskDialogOpen} />\r\n      )}\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"file":"assets/Home-C6gMyIag.js"}