import{j as e}from"./vendor-ui-DmpovMYY.js";import{a as ze,u as We,l as qe,D as Xe,b as He,c as Ue,d as Je,S as Ae,M as Ne,e as E,U as Ke,L as Ce,f as Ge,g as Qe,h as Ye,i as Ze,I as et,B as Q,N as be,F as tt,j as V,k as st,m as at,C as Re,n as Ie,o as ve,p as Te,q as $e,E as rt,s as nt,r as ot,t as it,v as lt,H as ct,w as Ee,x as Me,y as dt,z as mt,A as ut,G as xt}from"./index-DsNZqemC.js";import{u as Oe,r,a as De,L as ht}from"./vendor-react-iAJ0IrSD.js";import{c as pt,g as gt,m as ft}from"./geolocation-DRm3QMsJ.js";import{u as bt}from"./useHomepageTemplates-VKXo33vt.js";import{u as vt}from"./usePageView-BgQdK3eR.js";import{L as Fe}from"./LocationPermissionDialog-DdsUxHor.js";import{u as Se}from"./vendor-i18n-DxKeo2S1.js";import{P as yt}from"./PullToRefresh-CtPrbdnG.js";import{u as wt}from"./vendor-query-D82cqPtt.js";import{P as jt,a as Nt,b as kt}from"./popover-DMTAbRhM.js";import{u as St,a as _t}from"./useRestaurants-D0aCSjP-.js";import{u as Ct,R as Rt,l as It}from"./xiaoxiong-logo-clean-Bd6pytW8.js";import{u as Tt}from"./useLocalizedContent-BN2IWylL.js";import{u as $t}from"./useActivities-B4Dk2hMx.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-6pZ9VDFn.js";import"./vendor-map-BaCLwlqt.js";/* empty css                  */const Dt="/assets/google-play-badge-new-BAXiFmDF.png",Lt="/assets/app-store-badge-C-eOGvqu.svg",je="https://tzdgqhwyzsxkxnncgzap.supabase.co",he="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",zt=["最近","附近","离我","距离","远近","近的","周边","周围","最近的","附近的","nearest","closest","nearby","near me","close to me","distance","around me","mais perto","próximo","perto de mim","distância","mais próximo"],At=()=>{const n="xiaoxiong_anonymous_user_id";let i=localStorage.getItem(n);return i||(i=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(n,i)),i},Et=({open:n,onOpenChange:i,provider:b="ask-xiaoxiong"})=>{const{i18n:p}=Se(),h=Oe(),{settings:M}=ze(),{user:W}=We(),R=M?.logo_url||qe,[m,S]=r.useState(""),[I,g]=r.useState([]),[w,_]=r.useState(!1),[N,k]=r.useState(null),[U,q]=r.useState(!1),[O,D]=r.useState(null),[A,L]=r.useState(!1),[ae,X]=r.useState(!1),x=r.useRef(null),v=r.useRef(null),z=r.useRef(null),j=r.useRef(null),re=()=>W?.id?W.id:At();r.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;X(!!s)},[]),r.useEffect(()=>{n&&!N&&navigator.geolocation?.getCurrentPosition(s=>{k({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[n,N]),r.useEffect(()=>{!n&&z.current&&(z.current.stop(),L(!1))},[n]),r.useEffect(()=>{j.current?.scrollIntoView({behavior:"smooth"})},[I]);const pe=async(s,l)=>{const o=await fetch(`${je}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${he}`,apikey:he},body:JSON.stringify({text:s.content,stream:!0,lat:N?.lat,lng:N?.lng}),signal:x.current?.signal});if(!o.ok)throw new Error(`Request failed with status: ${o.status}`);if(!o.body)throw new Error("No response body");const d=o.body.getReader(),t=new TextDecoder;let a="";for(;;){const{done:y,value:T}=await d.read();if(y)break;const ue=t.decode(T,{stream:!0});a+=ue;let $=a;$.startsWith('"')&&($=$.slice(1)),$.endsWith('"')&&($=$.slice(0,-1)),$=$.replace(/\\n/g,`
`),g(H=>H.map(P=>P.id===l?{...P,content:$}:P))}let c=a;c.startsWith('"')&&(c=c.slice(1)),c.endsWith('"')&&(c=c.slice(0,-1)),c=c.replace(/\\n/g,`
`),g(y=>y.map(T=>T.id===l?{...T,content:c,isStreaming:!1}:T))},ge=async(s,l)=>{const o=re(),d=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const t=await fetch(`${je}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${he}`,apikey:he},body:JSON.stringify({message:s.content,userId:o}),signal:x.current?.signal}),a=Date.now()-d;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${a}ms`),!t.ok)throw new Error(`Request failed with status: ${t.status}`);if(!t.body)throw new Error("No response body");const c=t.body.getReader(),y=new TextDecoder;let T="",ue=!1,$=0;for(;;){const{done:H,value:P}=await c.read();if(H){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-d}ms, 共 ${$} 个数据块`);break}$++;const B=y.decode(P,{stream:!0});if(T+=B,!ue){ue=!0;const se=Date.now()-d;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${se}ms, 大小: ${B.length} 字符`)}De.flushSync(()=>{g(se=>se.map(fe=>fe.id===l?{...fe,content:T}:fe))}),await new Promise(se=>requestAnimationFrame(se))}g(H=>H.map(P=>P.id===l?{...P,isStreaming:!1}:P))},Y=async(s,l)=>{const o=Date.now();console.log(`[前端-LovableAI] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const d=await fetch(`${je}/functions/v1/lovable-chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${he}`,apikey:he},body:JSON.stringify({message:s.content,lat:N?.lat,lng:N?.lng,language:p.language}),signal:x.current?.signal}),t=Date.now()-o;if(console.log(`[前端-LovableAI] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${t}ms`),!d.ok){const $=await d.json().catch(()=>({}));throw new Error($.error||`Request failed with status: ${d.status}`)}if(!d.body)throw new Error("No response body");const a=d.body.getReader(),c=new TextDecoder;let y="",T="",ue=!1;for(;;){const{done:$,value:H}=await a.read();if($){console.log(`[前端-LovableAI] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-o}ms`);break}if(T+=c.decode(H,{stream:!0}),!ue){ue=!0;const B=Date.now()-o;console.log(`[前端-LovableAI] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${B}ms`)}let P;for(;(P=T.indexOf(`
`))!==-1;){let B=T.slice(0,P);if(T=T.slice(P+1),B.endsWith("\r")&&(B=B.slice(0,-1)),B.startsWith(":")||B.trim()===""||!B.startsWith("data: "))continue;const se=B.slice(6).trim();if(se==="[DONE]")break;try{const _e=JSON.parse(se).choices?.[0]?.delta?.content;_e&&(y+=_e,De.flushSync(()=>{g(ye=>ye.map(we=>we.id===l?{...we,content:y}:we))}),await new Promise(ye=>requestAnimationFrame(ye)))}catch{T=B+`
`+T;break}}}g($=>$.map(H=>H.id===l?{...H,isStreaming:!1}:H))},Z=s=>{const l=s.toLowerCase();return zt.some(o=>l.includes(o))},J=async s=>{const l={id:Date.now().toString(),role:"user",content:s},o=(Date.now()+1).toString(),d={id:o,role:"assistant",content:"",isStreaming:!0};g(t=>[...t,l,d]),S(""),_(!0),x.current&&x.current.abort(),x.current=new AbortController;try{b==="lovable-ai"?await Y(l,o):b==="xiaoxiong-agent"?await ge(l,o):await pe(l,o)}catch(t){if(t instanceof Error&&t.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",t);const a=p.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":p.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";g(c=>c.map(y=>y.id===o?{...y,content:a,isStreaming:!1}:y))}finally{_(!1)}},ee=()=>{q(!1),navigator.geolocation?.getCurrentPosition(s=>{k({lat:s.coords.latitude,lng:s.coords.longitude}),O&&setTimeout(()=>{J(O),D(null)},100)},s=>{console.log("Location permission denied:",s.message),O&&(J(O),D(null))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},ne=async()=>{if(!m.trim()||w)return;const s=m.trim();if(!N&&Z(s)){D(s),q(!0),S("");return}await J(s)},oe=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),ne())},ie=()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.log("Speech recognition not supported");return}z.current&&z.current.stop();const l=new s;z.current=l;const o={zh:"zh-CN",en:"en-US",pt:"pt-BR"};l.lang=o[p.language]||"zh-CN",l.continuous=!1,l.interimResults=!0,l.onstart=()=>{L(!0)},l.onresult=d=>{const t=Array.from(d.results).map(a=>a[0].transcript).join("");S(t)},l.onerror=d=>{console.log("Speech recognition error:",d.error),L(!1)},l.onend=()=>{L(!1)},l.start()},le=()=>{z.current&&(z.current.stop(),L(!1))},u=()=>{A?le():ie()},C=()=>{x.current&&x.current.abort(),i(!1)},F=s=>{C(),h(s)},f=s=>{const l=/\[([^\]]+)\]\(([^)]+)\)/g,o=[];let d=0,t,a=0;for(;(t=l.exec(s))!==null;){t.index>d&&o.push(e.jsx("span",{children:s.slice(d,t.index)},a++));const c=t[1],y=t[2];y.startsWith("/")?o.push(e.jsx("button",{onClick:()=>F(y),className:"text-primary hover:underline font-medium cursor-pointer",children:c},a++)):o.push(e.jsx("a",{href:y,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:c},a++)),d=t.index+t[0].length}return d<s.length&&o.push(e.jsx("span",{children:s.slice(d)},a++)),o.length>0?o:[e.jsx("span",{children:s},"0")]},ce=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),K=(s,l=20)=>s.length<=l?s:s.slice(0,l)+"...",de=(s,l)=>{const o=a=>a.split("|").slice(1,-1).map(c=>ce(c.trim())),d=o(s[0]),t=s.slice(2).map(o);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:d.map((a,c)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:a,children:f(K(a,15))},c))})}),e.jsx("tbody",{children:t.map((a,c)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:a.map((y,T)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:y,children:f(K(y,18))},T))},c))})]})},l)},G=s=>{const l=s.split(`
`),o=[];let d=0;for(;d<l.length;){const t=l[d];if(t.trim().startsWith("|")&&t.split("|").length>2){const a=[];for(;d<l.length&&l[d].trim().startsWith("|");)a.push(l[d]),d++;a.length>=2&&o.push(de(a,o.length));continue}if(t.startsWith("### "))o.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:f(t.slice(4))},o.length));else if(t.startsWith("## "))o.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:f(t.slice(3))},o.length));else if(t.startsWith("# "))o.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:f(t.slice(2))},o.length));else if(t.includes("**")){const a=t.split(/\*\*(.*?)\*\*/g);o.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:a.map((c,y)=>y%2===1?e.jsx("strong",{className:"font-semibold",children:f(c)},y):f(c))},o.length))}else t.startsWith("- ")||t.startsWith("* ")?o.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:f(t.slice(2))},o.length)):/^\d+\.\s/.test(t)?o.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:f(t.replace(/^\d+\.\s/,""))},o.length)):t.match(/^[-*_]{3,}$/)?o.push(e.jsx("hr",{className:"my-3 border-border"},o.length)):t.trim()===""?o.push(e.jsx("div",{className:"h-1"},o.length)):o.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:f(t)},o.length));d++}return o},xe=()=>p.language==="zh"?"小熊AI助手":p.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",te=()=>p.language==="zh"?"告诉小熊，你想吃什么...":p.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",me=()=>p.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":p.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(Xe,{open:n,onOpenChange:C,children:e.jsxs(He,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(Ue,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(Je,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:R,alt:"Logo",className:"w-6 h-6 object-contain"})}),xe()]})}),e.jsx(Ae,{className:"flex-1 h-0",ref:v,children:e.jsxs("div",{className:"p-4 space-y-4",children:[I.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(Ne,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:me()})]}),I.map(s=>e.jsxs("div",{className:E("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:E("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(Ke,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx("div",{className:E("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:G(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ce,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:p.language==="zh"?"思考中...":p.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:j})]})}),e.jsx("div",{className:"p-4 bg-background shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border-2 border-border bg-muted/30 shadow-sm hover:shadow-md transition-shadow duration-200",children:[ae&&e.jsx("button",{onClick:u,disabled:w,className:E("shrink-0 p-2 rounded-full transition-all duration-200 hover:bg-muted",A&&"text-destructive animate-pulse"),title:p.language==="zh"?A?"停止录音":"语音输入":p.language==="pt"?A?"Parar gravação":"Entrada de voz":A?"Stop recording":"Voice input",children:A?e.jsx(Ge,{className:"h-5 w-5"}):e.jsx(Qe,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{value:m,onChange:s=>S(s.target.value),onKeyDown:oe,placeholder:A?p.language==="zh"?"正在聆听...":p.language==="pt"?"Ouvindo...":"Listening...":te(),disabled:w,className:"flex-1 bg-transparent border-0 outline-none text-foreground placeholder:text-muted-foreground",autoFocus:!0}),e.jsx("button",{onClick:ne,disabled:!m.trim()||w,className:E("shrink-0 p-2 rounded-full transition-all duration-200",m.trim()&&!w?"text-primary hover:bg-primary/10":"text-muted-foreground/50"),children:w?e.jsx(Ce,{className:"h-5 w-5 animate-spin"}):e.jsx(Ye,{className:"h-5 w-5"})})]})}),e.jsx(Fe,{open:U,onOpenChange:s=>{q(s),!s&&O&&(J(O),D(null))},onConfirm:ee})]})})},Le=({restaurant:n,language:i})=>{const[b,p]=r.useState(999),h=r.useRef(null),M=n.type.slice(0,3).map((m,S)=>({key:`type-${S}`,label:m,variant:"secondary",color:void 0}));r.useEffect(()=>{const m=()=>{if(!h.current)return;const I=h.current,g=Array.from(I.querySelectorAll(".tag-badge"));if(g.length===0){setTimeout(m,50);return}const w=g[0]?.offsetTop;let _=g.length;for(let N=0;N<g.length;N++)if(g[N].offsetTop>w){_=N;break}_<g.length&&(_=Math.max(1,_-1)),p(_)};p(999);const S=setTimeout(m,100);return window.addEventListener("resize",m),()=>{clearTimeout(S),window.removeEventListener("resize",m)}},[M.length,n.id]);const W=M.slice(0,b),R=M.length>b;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:h,className:"flex gap-1.5 flex-wrap flex-1",children:W.map(m=>e.jsx(V,{variant:m.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:m.color?{backgroundColor:m.color,color:"white"}:void 0,children:m.label},m.key))}),R&&e.jsxs(jt,{children:[e.jsx(Nt,{asChild:!0,children:e.jsx(Q,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(rt,{className:"h-4 w-4"})})}),e.jsx(kt,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:M.map(m=>e.jsx(V,{variant:m.variant,className:"text-xs font-medium",style:m.color?{backgroundColor:m.color,color:"white"}:void 0,children:m.label},m.key))})})]})]})},Mt=()=>{const n=Oe(),{t:i,i18n:b}=Se(),{toast:p}=Ze(),{localizeRestaurant:h}=Tt(),[M,W]=r.useState(""),[R,m]=r.useState([]),[S,I]=r.useState(null),[g,w]=r.useState([]),[_,N]=r.useState(null),[k,U]=r.useState(null),[q,O]=r.useState(!1),[D,A]=r.useState(!1),[L,ae]=r.useState(!1),X=r.useRef(null),x=r.useRef(null),v=r.useRef({}),[z,j]=r.useState(null),[re,pe]=r.useState(!1),[ge,Y]=r.useState(!1),[Z,J]=r.useState(!1),[ee,ne]=r.useState(!1),oe=4,{data:ie,isLoading:le}=St(M,R.length>0?R.join(","):void 0),{data:u=[]}=_t(),{data:C=[]}=$t(),{data:F={}}=Ct(),f=C.filter(t=>(F[t.id]||0)>0),ce=t=>{m(a=>a.includes(t)?a.filter(c=>c!==t):[...a,t])},K=()=>{Y(!0)},de=async()=>{Y(!1);try{const t=await gt();U({lat:t.coords.latitude,lng:t.coords.longitude}),p({title:i("restaurants.locationEnabled"),description:i("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},G=t=>{N(t),t&&!k&&K()},xe=async t=>{if(S===t)I(null),w([]);else{I(t);const{data:a,error:c}=await nt.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);c?(console.error("Error fetching activity restaurants:",c),w([])):w(a.map(y=>y.restaurant_id))}},te=ie?.map(t=>{const a=h(t);if(k){const c=pt(k.lat,k.lng,t.lat,t.lng);return{...a,distance:c}}return a})||[],me=S?te.filter(t=>g.includes(t.id)):te,s=_&&k?me.filter(t=>t.distance&&t.distance<=_).sort((t,a)=>(t.distance||0)-(a.distance||0)):k?me.sort((t,a)=>(t.distance||0)-(a.distance||0)):me.sort((t,a)=>(a.rating||0)-(t.rating||0)),l=t=>{n(`/restaurant/${t.id}`)},o=t=>{j(t.id);const a=v.current[t.id];a&&a.scrollIntoView({behavior:"smooth",block:"center"})},d=()=>{const t=document.getElementById("home-map-container");if(t)if(q)document.exitFullscreen&&document.exitFullscreen();else{if(X.current){const a=X.current.getCenter(),c=X.current.getZoom();x.current={center:[a.lng,a.lat],zoom:c}}t.requestFullscreen&&t.requestFullscreen()}};return r.useEffect(()=>{const t=()=>{const a=!!document.fullscreenElement;O(a),!a&&x.current&&X.current&&setTimeout(()=>{X.current?.jumpTo({center:x.current.center,zoom:x.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-2 sm:mb-3",children:i("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-xl mx-auto px-4",children:i("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(et,{placeholder:i("restaurants.search"),value:M,onChange:t=>W(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs(Q,{variant:k?"default":"outline",onClick:k?void 0:K,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(be,{className:`w-4 h-4 ${k?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:i("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:i(k?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs(Q,{variant:re?"default":"outline",onClick:()=>pe(!re),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(tt,{className:"w-4 h-4"}),i("restaurants.filter")]})]})]}),re&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("restaurants.restaurantTypes"),":"]}),R.length>0&&e.jsx(V,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>m([]),children:i("common.actions.clearFilter")}),u.length>8&&e.jsx(Q,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>A(!D),children:i(D?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${D?"animate-expand-height":""}`,children:(D?u:u.slice(0,8)).map((t,a)=>e.jsx(V,{variant:R.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${R.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ce(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:u.map((t,a)=>e.jsx(V,{variant:R.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${R.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ce(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),f.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("nav.activities"),":"]}),S&&e.jsx(V,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{I(null),w([])},children:i("common.actions.clearFilter")}),f.length>8&&e.jsx(Q,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>ae(!L),children:i(L?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${L?"animate-expand-height":""}`,children:(L?f:f.slice(0,8)).map((t,a)=>{const c=b.language==="zh"?t.badge_text_zh||t.title_zh:b.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(V,{variant:S===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${S===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>xe(t.id),children:c},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:f.map((t,a)=>{const c=b.language==="zh"?t.badge_text_zh||t.title_zh:b.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(V,{variant:S===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${S===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>xe(t.id),children:c},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),k&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[i("restaurants.radius"),":"]}),e.jsx(V,{variant:_===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(null),children:i("restaurants.allRestaurants")}),e.jsx(V,{variant:_===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(5),children:i("restaurants.radius5km")}),e.jsx(V,{variant:_===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(10),children:i("restaurants.radius10km")}),e.jsx(V,{variant:_===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(20),children:i("restaurants.radius20km")})]})]}),!le&&s&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${Z?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${q?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx(Q,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:d,children:q?e.jsx(st,{className:"w-5 h-5"}):e.jsx(at,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(Rt,{restaurants:s,onRestaurantClick:l,userLocation:k,radiusFilter:_,onMarkerClick:o,showViewDetailsButton:!0,onMapInit:t=>{X.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:It,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:b.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx(Q,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>J(!Z),children:Z?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4"}),i("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),i("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ve,{className:"w-6 h-6 text-primary"}),i("restaurants.title"),e.jsx(V,{variant:"secondary",className:"ml-2",children:s.length})]}),k&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(be,{className:"w-4 h-4"}),i("restaurants.sortedByDistance")]})]}),s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(ve,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:i("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:i("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(ee?s:s.slice(0,oe)).map(t=>e.jsx(Te,{ref:a=>v.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${z===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>l(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(be,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx($e,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Le,{restaurant:t,language:b.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ve,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),s.length>oe&&e.jsx(Q,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>ne(!ee),children:ee?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4"}),i("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4"}),i("map.showAllRestaurants",{count:s.length})]})})]}),e.jsx(Ae,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:s.map(t=>e.jsx(Te,{ref:a=>v.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${z===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>l(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(be,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx($e,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Le,{restaurant:t,language:b.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(ve,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(Fe,{open:ge,onOpenChange:Y,onConfirm:de})]})},ke="/images/sushi-ramen-hero.jpg",Pe="/images/sushi-ramen-mobile.jpg",Be=r.memo(({stats:n,t:i})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:n.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(it,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:n.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:i("home.hero.brandName")}),e.jsx("img",{src:ft,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Be.displayName="StatsDisplay";const Ot=()=>{const n=window.innerWidth<640,i=window.innerWidth>=1024,b=navigator.connection,p=Me(),h=Ee();return i?!!b?.saveData:!!(h&&!p||b&&(b.saveData||b.effectiveType==="2g"||b.effectiveType==="slow-2g")||n&&navigator.deviceMemory&&navigator.deviceMemory<2)},Ve=r.memo(({template:n,isActive:i,currentLang:b,t:p,onContentReady:h,onAskXiaoxiong:M})=>{const[W,R]=r.useState({}),[m,S]=r.useState({}),[I,g]=r.useState({}),[w,_]=r.useState({mobile:!0,tablet:!0,desktop:!0}),[N,k]=r.useState(!1),U=Ot(),q=r.useRef(null),O=r.useRef(null),D=r.useRef(null),A=u=>n[`${u}${b==="zh"?"_zh":b==="pt"?"_pt":"_en"}`]||"",L=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",ae=()=>{const u=L();return u==="mobile"&&n.mobile_overlay_opacity!==null?n.mobile_overlay_opacity:u==="tablet"&&n.tablet_overlay_opacity!==null?n.tablet_overlay_opacity:u==="desktop"&&n.desktop_overlay_opacity!==null?n.desktop_overlay_opacity:n.overlay_opacity??30},X=()=>{const u=ae(),C=n.overlay_gradient_direction||"to-b",F=(o,d)=>o==null?d/100:o>1?o/100:o,f=u>1?u/100:u,ce=F(n.overlay_gradient_from_opacity,30)*f,K=F(n.overlay_gradient_via_opacity,25)*f,de=F(n.overlay_gradient_to_opacity,40)*f,xe={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[C]||"to bottom",te={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},me=te[n.overlay_gradient_from||"black"]||"0, 0, 0",s=te[n.overlay_gradient_via||"black"]||"0, 0, 0",l=te[n.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${xe}, rgba(${me}, ${ce}), rgba(${s}, ${K}), rgba(${l}, ${de}))`}},x=n.mobile_image_url||Pe,v=n.tablet_image_url||n.desktop_image_url||ke,z=n.desktop_image_url||ke,j=n.background_blur||0,re=n.desktop_media_type||n.media_type||"image",pe=n.tablet_media_type||n.media_type||"image",ge=n.mobile_media_type||n.media_type||"image",Y=re==="video"&&!U,Z=pe==="video"&&!U,J=ge==="video"&&!U,ee=J?n.mobile_video_url:null,ne=Z?n.tablet_video_url||n.desktop_video_url:null,oe=Y?n.desktop_video_url:null;r.useEffect(()=>{const u=L(),C=u==="mobile"?x:u==="tablet"?v:z;if(C){const F=new Image;F.onload=()=>{R(f=>({...f,[u]:!0})),_(f=>({...f,[u]:!0})),i&&(h?.(),setTimeout(()=>k(!0),100))},F.src=C}},[x,v,z,i,h]),r.useEffect(()=>{i&&W[L()]&&k(!0)},[i,W]);const ie=u=>{S(C=>({...C,[u]:!0}))},le=(u,C)=>{console.error(`[HeroSlide] Video error on ${u}:`,C),g(F=>({...F,[u]:!0}))};return r.useEffect(()=>{if(!N||!i||!xt())return;const C=L(),f=(C==="mobile"?q:C==="tablet"?O:D).current;if(!f)return;const K=setTimeout(async()=>{try{f.muted=!0,f.playsInline=!0,f.setAttribute("webkit-playsinline","true"),await f.play(),console.log(`[HeroSlide] iOS video play successful on ${C}`)}catch(de){console.error(`[HeroSlide] iOS video play failed on ${C}:`,de),g(G=>({...G,[C]:!0}))}},150);return()=>clearTimeout(K)},[N,i]),e.jsxs("div",{className:E("absolute inset-0 w-full h-full transition-opacity duration-1000",i?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!w.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),J&&ee?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:x,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",m.mobile&&!I.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:j>0?`blur(${j}px)`:void 0}}),N&&!I.mobile&&e.jsx("video",{ref:q,src:ee,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>ie("mobile"),onError:u=>le("mobile",u),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:j>0?`blur(${j}px)`:void 0}})]}):e.jsx("img",{src:x,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",w.mobile?"opacity-100":"opacity-0"),style:{filter:j>0?`blur(${j}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!w.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),Z&&ne?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:v,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",m.tablet&&!I.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:j>0?`blur(${j}px)`:void 0}}),N&&!I.tablet&&e.jsx("video",{ref:O,src:ne,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>ie("tablet"),onError:u=>le("tablet",u),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:j>0?`blur(${j}px)`:void 0}})]}):e.jsx("img",{src:v,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",w.tablet?"opacity-100":"opacity-0"),style:{filter:j>0?`blur(${j}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!w.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),Y&&oe?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z,alt:"Background",className:E("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",m.desktop&&!I.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:j>0?`blur(${j}px)`:void 0}}),N&&!I.desktop&&e.jsx("video",{ref:D,src:oe,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>ie("desktop"),onError:u=>le("desktop",u),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:j>0?`blur(${j}px)`:void 0}})]}):e.jsx("img",{src:z,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:E("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",w.desktop?"opacity-100":"opacity-0"),style:{filter:j>0?`blur(${j}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:X()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:A("title")||p("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:A("description")||p("home.hero.description")}),n.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:M,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-2xl shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(Ne,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-white/90 group-hover:text-white transition-colors drop-shadow-sm",children:A("subtitle_button_text")||p("home.hero.subtitle")}),e.jsx(lt,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]})})]})})]})});Ve.displayName="HeroSlide";const rs=()=>{const{t:n,i18n:i}=Se(),b=wt(),{settings:p}=ze(),{data:h,isLoading:M,refetch:W}=bt(),[R,m]=r.useState(0),[S,I]=r.useState(null),g=r.useRef(null),[w,_]=r.useState(!1),[N,k]=r.useState(!1),U=p?.ai_assistant_enabled!==!1,q=p?.ai_provider||"ask-xiaoxiong",O=r.useCallback(()=>{_(!0)},[]);vt({pageType:"home"});const D=r.useCallback(async()=>{try{const v=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();v&&I({order_count:v.order_count||0,reserve_count:v.reserve_count||0})}catch(x){console.error("Failed to fetch stats:",x)}},[]);r.useEffect(()=>{D()},[D]);const A=r.useCallback(async()=>{await Promise.all([W(),D(),b.invalidateQueries({queryKey:["restaurants"]}),b.invalidateQueries({queryKey:["activities"]})])},[W,D,b]);r.useEffect(()=>{if(!h||h.length<=1)return;const v=h[R]?.duration||5e3;return g.current=setTimeout(()=>{m(z=>(z+1)%h.length)},v),()=>{g.current&&clearTimeout(g.current)}},[h,R]);const L=r.useCallback(x=>{g.current&&clearTimeout(g.current),m(x)},[]);r.useCallback(()=>{h&&(g.current&&clearTimeout(g.current),m(x=>(x-1+h.length)%h.length))},[h]),r.useCallback(()=>{h&&(g.current&&clearTimeout(g.current),m(x=>(x+1)%h.length))},[h]);const ae=i.language,X=h&&h.length>1;return e.jsx(yt,{onRefresh:A,children:e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[S&&e.jsx(Be,{stats:S,t:n}),e.jsx("div",{className:E("absolute inset-0 w-full h-full transition-opacity duration-500",w?"opacity-100":"opacity-0"),children:h?.map((x,v)=>e.jsx(Ve,{template:x,isActive:v===R,currentLang:ae,t:n,onContentReady:v===0?O:void 0,onAskXiaoxiong:()=>k(!0)},x.id))}),e.jsx("div",{className:E("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",M||!w?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(ct,{})}),!M&&(!h||h.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:Pe,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:ke,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:n("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:n("home.hero.description")})]})})]}),X&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:h.map((x,v)=>e.jsx("button",{onClick:()=>L(v),className:E("w-3 h-3 rounded-full transition-all duration-300",v===R?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${v+1}`},v))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(Mt,{})})}),!Ee()&&!Me()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(dt,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:n("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:n("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Lt,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Dt,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(mt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:n("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:n("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:n("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Q,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(ht,{to:"/join-us",children:[e.jsx(ut,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),n("home.cta.button")]})})})]})]}),U&&e.jsx(Et,{open:N,onOpenChange:k,provider:q})]})})};export{rs as default};
//# sourceMappingURL=Home-DmOJIqzk.js.map
