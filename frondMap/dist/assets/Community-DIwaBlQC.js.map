{"version":3,"file":"Community-DIwaBlQC.js","sources":["../../src/components/community/PostGridCard.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Heart, Images } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { CommunityPost, useLikePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PostGridCardProps {\r\n  post: CommunityPost;\r\n}\r\n\r\nconst PostGridCard = ({ post }: PostGridCardProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const [imageError, setImageError] = useState(false);\r\n\r\n  const handleLike = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleCardClick = () => {\r\n    navigate(`/community/${post.id}`);\r\n  };\r\n\r\n  // Strip HTML tags for plain text preview\r\n  const getPlainTextContent = (html: string) => {\r\n    const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n    return doc.body.textContent || \"\";\r\n  };\r\n\r\n  const content = getLocalizedField(post, \"content\");\r\n  const plainContent = getPlainTextContent(content);\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasVideo = !!post.video_url;\r\n  const hasMedia = hasImages || hasVideo;\r\n  const imageCount = post.image_urls?.length || 0;\r\n\r\n  return (\r\n    <div \r\n      className=\"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\r\n      onClick={handleCardClick}\r\n    >\r\n      {/* Media Section - Only show first image, no swipe */}\r\n      {hasMedia && (\r\n        <div className=\"relative\">\r\n          {hasImages ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden\">\r\n              {!imageError ? (\r\n                <img\r\n                  src={post.image_urls![0]}\r\n                  alt=\"\"\r\n                  className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                  onError={() => setImageError(true)}\r\n                />\r\n              ) : (\r\n                <div className=\"w-full h-full bg-muted flex items-center justify-center\">\r\n                  <span className=\"text-xs text-muted-foreground\">\r\n                    {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Multiple images indicator */}\r\n              {imageCount > 1 && (\r\n                <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1\">\r\n                  <Images className=\"h-3 w-3\" />\r\n                  <span>{imageCount}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : hasVideo ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden bg-black\">\r\n              <video\r\n                src={post.video_url}\r\n                className=\"w-full h-full object-cover\"\r\n                preload=\"metadata\"\r\n                muted\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                <div className=\"w-12 h-12 rounded-full bg-white/30 backdrop-blur-sm flex items-center justify-center\">\r\n                  <div className=\"w-0 h-0 border-l-[16px] border-l-white border-y-[10px] border-y-transparent ml-1\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-3\">\r\n        {/* Text Content */}\r\n        <p className={`text-sm font-medium line-clamp-2 leading-relaxed ${hasMedia ? '' : 'min-h-[60px]'}`}>\r\n          {plainContent}\r\n        </p>\r\n\r\n        {/* Author Row */}\r\n        <div className=\"flex items-center justify-between mt-3\">\r\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n            <Avatar className=\"h-5 w-5 flex-shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"text-[10px]\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate\">\r\n              {post.author?.display_name}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Like Button */}\r\n          <button\r\n            className={`flex items-center gap-1 text-xs ${\r\n              post.user_liked ? \"text-red-500\" : \"text-muted-foreground\"\r\n            } hover:text-red-500 transition-colors`}\r\n            onClick={handleLike}\r\n            disabled={!user}\r\n          >\r\n            <Heart\r\n              className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n            />\r\n            <span>{post.likes_count || 0}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostGridCard;\r\n","import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"最多上传9张图片\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"视频不能超过100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user.id}/${Date.now()}.${fileExt}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(fileName, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(fileName);\r\n\r\n      setVideoUrl(publicUrl);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"请输入内容\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n    });\r\n\r\n    // Reset form\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setOpen(false);\r\n  };\r\n\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"发布帖子\")}</Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"community.createPost\", \"发布帖子\")}</DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 mt-4\">\r\n          {/* Content */}\r\n          <div className=\"space-y-2\">\r\n            <Label>{t(\"community.content\", \"内容\")}</Label>\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"分享你的想法...\")}\r\n              rows={4}\r\n              className=\"resize-none\"\r\n            />\r\n          </div>\r\n\r\n          {/* Activity Selection */}\r\n          <div className=\"space-y-2\">\r\n            <Label className=\"flex items-center gap-2\">\r\n              <Calendar className=\"h-4 w-4\" />\r\n              {t(\"community.linkActivity\", \"关联活动\")}\r\n            </Label>\r\n            <Select value={activityId || \"none\"} onValueChange={(val) => setActivityId(val === \"none\" ? \"\" : val)}>\r\n              <SelectTrigger>\r\n                <SelectValue placeholder={t(\"community.selectActivity\", \"选择活动（可选）\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">\r\n                  {t(\"community.noActivity\", \"不关联活动\")}\r\n                </SelectItem>\r\n                {activeActivities.map((activity) => (\r\n                  <SelectItem key={activity.id} value={activity.id}>\r\n                    {getLocalizedField(activity, \"title\")}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          {/* Image Preview */}\r\n          {imageUrls.length > 0 && (\r\n            <div className=\"grid grid-cols-3 gap-2\">\r\n              {imageUrls.map((url, index) => (\r\n                <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden\">\r\n                  <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => removeImage(index)}\r\n                    className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                  >\r\n                    <X className=\"h-3 w-3\" />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Video Preview */}\r\n          {videoUrl && (\r\n            <div className=\"relative rounded-lg overflow-hidden\">\r\n              <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n              <button\r\n                type=\"button\"\r\n                onClick={removeVideo}\r\n                className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n              >\r\n                <X className=\"h-4 w-4\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* Upload Buttons */}\r\n          <div className=\"flex items-center gap-2\">\r\n            <input\r\n              ref={imageInputRef}\r\n              type=\"file\"\r\n              accept=\"image/*\"\r\n              multiple\r\n              className=\"hidden\"\r\n              onChange={handleImageUpload}\r\n            />\r\n            <input\r\n              ref={videoInputRef}\r\n              type=\"file\"\r\n              accept=\"video/*\"\r\n              className=\"hidden\"\r\n              onChange={handleVideoUpload}\r\n            />\r\n\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => imageInputRef.current?.click()}\r\n              disabled={uploading || imageUrls.length >= 9}\r\n            >\r\n              <Image className=\"h-4 w-4 mr-2\" />\r\n              {t(\"community.addImage\", \"添加图片\")}\r\n            </Button>\r\n\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => videoInputRef.current?.click()}\r\n              disabled={uploading || !!videoUrl}\r\n            >\r\n              <Video className=\"h-4 w-4 mr-2\" />\r\n              {t(\"community.addVideo\", \"添加视频\")}\r\n            </Button>\r\n\r\n            {uploading && <Loader2 className=\"h-4 w-4 animate-spin\" />}\r\n          </div>\r\n\r\n          {/* Submit */}\r\n          <div className=\"flex justify-end gap-2 pt-4\">\r\n            <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n              {t(\"common.cancel\", \"取消\")}\r\n            </Button>\r\n            <Button\r\n              onClick={handleSubmit}\r\n              disabled={createPost.isPending || !content.trim()}\r\n            >\r\n              {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n              {t(\"community.publish\", \"发布\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => (\r\n  <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst Community = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const { data: posts, isLoading } = useCommunityPosts({ status: \"approved\" });\r\n  const { data: canPost } = useCanCreatePost();\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await queryClient.invalidateQueries({ queryKey: ['community-posts'] });\r\n  }, [queryClient]);\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"container max-w-4xl mx-auto py-4 px-3 sm:px-4\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <h1 className=\"text-xl sm:text-2xl font-bold\">{t(\"nav.community\", \"社区\")}</h1>\r\n          {canPost && (\r\n            <CreatePostDialog\r\n              trigger={\r\n                <Button size=\"sm\" className=\"gap-1.5\">\r\n                  <Plus className=\"h-4 w-4\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {/* Xiaohongshu-style Masonry Grid */}\r\n        <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n          {isLoading ? (\r\n            // Loading skeleton - masonry style\r\n            Array.from({ length: 6 }).map((_, i) => (\r\n              <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridSkeleton />\r\n              </div>\r\n            ))\r\n          ) : posts && posts.length > 0 ? (\r\n            posts.map((post) => (\r\n              <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridCard post={post} />\r\n              </div>\r\n            ))\r\n          ) : (\r\n            <div className=\"col-span-2 text-center py-12 text-muted-foreground\">\r\n              <p>{t(\"community.noPosts\", \"暂无帖子\")}</p>\r\n              {canPost && (\r\n                <p className=\"mt-2\">\r\n                  {t(\"community.beFirst\", \"成为第一个发帖的人吧！\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Community;\r\n"],"names":["PostGridCard","post","t","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","imageError","setImageError","useState","handleLike","e","handleCardClick","getPlainTextContent","html","content","plainContent","hasImages","hasVideo","hasMedia","imageCount","jsxs","jsx","Images","Avatar","AvatarImage","AvatarFallback","Heart","CreatePostDialog","trigger","createPost","useCreatePost","activities","useActivities","open","setOpen","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","activityId","setActivityId","uploading","setUploading","imageInputRef","useRef","videoInputRef","handleImageUpload","files","toast","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","prev","error","handleVideoUpload","removeImage","index","_","i","removeVideo","handleSubmit","activeActivities","a","Dialog","DialogTrigger","Button","DialogContent","DialogHeader","DialogTitle","Label","Textarea","Calendar","Select","val","SelectTrigger","SelectValue","SelectContent","SelectItem","activity","url","X","Image","Video","Loader2","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","handleRefresh","useCallback","PullToRefresh","Plus"],"mappings":"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"}