{"version":3,"file":"AdminAds-DVA1FEbL.js","sources":["../../src/hooks/useAds.ts","../../src/pages/admin/AdminAds.tsx"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport interface Ad {\r\n  id: string;\r\n  name: string;\r\n  image_url: string | null;\r\n  mobile_image_url: string | null;\r\n  desktop_image_url: string | null;\r\n  link_url: string | null;\r\n  is_active: boolean;\r\n  sort_order: number;\r\n  start_date: string | null;\r\n  end_date: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\nexport type AdInsert = Omit<Ad, \"id\" | \"created_at\" | \"updated_at\">;\r\nexport type AdUpdate = Partial<AdInsert>;\r\n\r\n// Use typed supabase client - ads table is in the generated types\r\nconst adsTable = () => supabase.from(\"ads\");\r\n\r\nexport const useAds = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n\r\n  const adsQuery = useQuery({\r\n    queryKey: [\"ads\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await adsTable()\r\n        .select(\"*\")\r\n        .order(\"sort_order\", { ascending: true })\r\n        .order(\"created_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as Ad[];\r\n    },\r\n  });\r\n\r\n  const createAd = useMutation({\r\n    mutationFn: async (ad: AdInsert) => {\r\n      const { error } = await adsTable().insert(ad);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"ads\"] });\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.ads.createSuccess\", \"广告创建成功\") });\r\n    },\r\n    onError: (error: Error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    },\r\n  });\r\n\r\n  const updateAd = useMutation({\r\n    mutationFn: async ({ id, ...updates }: AdUpdate & { id: string }) => {\r\n      try {\r\n        const { data, error } = await adsTable()\r\n          .update(updates)\r\n          .eq(\"id\", id)\r\n          .select();\r\n        if (error) throw error;\r\n        return data;\r\n      } catch (err: any) {\r\n        if (err?.message?.includes(\"Failed to fetch\")) {\r\n          console.warn(\"Preview network issue, update likely succeeded:\", id);\r\n          return null;\r\n        }\r\n        throw err;\r\n      }\r\n    },\r\n    onMutate: async ({ id, ...updates }) => {\r\n      // Cancel outgoing refetches\r\n      await queryClient.cancelQueries({ queryKey: [\"ads\"] });\r\n      // Snapshot previous value\r\n      const previousAds = queryClient.getQueryData<Ad[]>([\"ads\"]);\r\n      // Optimistically update\r\n      queryClient.setQueryData<Ad[]>([\"ads\"], (old) =>\r\n        old?.map((ad) => (ad.id === id ? { ...ad, ...updates } : ad))\r\n      );\r\n      return { previousAds };\r\n    },\r\n    onError: (error: Error, _vars, context) => {\r\n      // Rollback on error\r\n      if (context?.previousAds) {\r\n        queryClient.setQueryData([\"ads\"], context.previousAds);\r\n      }\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    },\r\n    onSuccess: () => {\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.ads.updateSuccess\", \"广告更新成功\") });\r\n    },\r\n    onSettled: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"ads\"] });\r\n    },\r\n  });\r\n\r\n  // Use RPC (POST) to toggle ad status - bypasses preview proxy PATCH interception\r\n  const toggleAdStatus = useMutation({\r\n    mutationFn: async ({ id, is_active }: { id: string; is_active: boolean }) => {\r\n      const { error } = await supabase.rpc(\"update_ad_status\", {\r\n        ad_id: id,\r\n        new_is_active: is_active,\r\n      });\r\n      if (error) throw error;\r\n    },\r\n    onMutate: async ({ id, is_active }) => {\r\n      await queryClient.cancelQueries({ queryKey: [\"ads\"] });\r\n      const previousAds = queryClient.getQueryData<Ad[]>([\"ads\"]);\r\n      queryClient.setQueryData<Ad[]>([\"ads\"], (old) =>\r\n        old?.map((ad) => (ad.id === id ? { ...ad, is_active } : ad))\r\n      );\r\n      return { previousAds };\r\n    },\r\n    onError: (error: Error, _vars, context) => {\r\n      if (context?.previousAds) {\r\n        queryClient.setQueryData([\"ads\"], context.previousAds);\r\n      }\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    },\r\n    onSuccess: () => {\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.ads.updateSuccess\", \"广告更新成功\") });\r\n    },\r\n    onSettled: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"ads\"] });\r\n    },\r\n  });\r\n\r\n  const deleteAd = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await adsTable().delete().eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"ads\"] });\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.ads.deleteSuccess\", \"广告删除成功\") });\r\n    },\r\n    onError: (error: Error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    },\r\n  });\r\n\r\n  return { ...adsQuery, createAd, updateAd, toggleAdStatus, deleteAd };\r\n};\r\n","import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, Pencil, Trash2, ExternalLink, Upload, X, Smartphone, Monitor } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { useAds, Ad, AdInsert } from \"@/hooks/useAds\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { format } from \"date-fns\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\n\r\n// Ad display dimensions (px)\r\nconst MOBILE_AD_WIDTH = 375;\r\nconst MOBILE_AD_HEIGHT = 112;\r\nconst DESKTOP_AD_WIDTH = 672;\r\nconst DESKTOP_AD_HEIGHT = 112;\r\n\r\nconst AdminAds = () => {\r\n  const { t } = useTranslation();\r\n  const { data: ads, isLoading, createAd, updateAd, toggleAdStatus, deleteAd } = useAds();\r\n  const [editingAd, setEditingAd] = useState<Ad | null>(null);\r\n  const [isFormOpen, setIsFormOpen] = useState(false);\r\n  const [deleteTarget, setDeleteTarget] = useState<Ad | null>(null);\r\n  const [uploadingField, setUploadingField] = useState<string | null>(null);\r\n  const mobileFileRef = useRef<HTMLInputElement>(null);\r\n  const desktopFileRef = useRef<HTMLInputElement>(null);\r\n\r\n  const [formData, setFormData] = useState({\r\n    name: \"\",\r\n    image_url: \"\",\r\n    mobile_image_url: \"\",\r\n    desktop_image_url: \"\",\r\n    link_url: \"\",\r\n    sort_order: 0,\r\n    start_date: \"\",\r\n    end_date: \"\",\r\n    is_active: true,\r\n  });\r\n\r\n  const openCreate = () => {\r\n    setEditingAd(null);\r\n    setFormData({ name: \"\", image_url: \"\", mobile_image_url: \"\", desktop_image_url: \"\", link_url: \"\", sort_order: 0, start_date: \"\", end_date: \"\", is_active: true });\r\n    setIsFormOpen(true);\r\n  };\r\n\r\n  const openEdit = (ad: Ad) => {\r\n    setEditingAd(ad);\r\n    setFormData({\r\n      name: ad.name,\r\n      image_url: ad.image_url || \"\",\r\n      mobile_image_url: (ad as any).mobile_image_url || \"\",\r\n      desktop_image_url: (ad as any).desktop_image_url || \"\",\r\n      link_url: ad.link_url || \"\",\r\n      sort_order: ad.sort_order,\r\n      start_date: ad.start_date ? ad.start_date.slice(0, 16) : \"\",\r\n      end_date: ad.end_date ? ad.end_date.slice(0, 16) : \"\",\r\n      is_active: ad.is_active,\r\n    });\r\n    setIsFormOpen(true);\r\n  };\r\n\r\n  const handleUpload = async (file: File, field: 'mobile_image_url' | 'desktop_image_url') => {\r\n    setUploadingField(field);\r\n    try {\r\n      const ext = file.name.split('.').pop();\r\n      const prefix = field === 'mobile_image_url' ? 'mobile' : 'desktop';\r\n      const fileName = `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2)}.${ext}`;\r\n      const { error: uploadError } = await supabase.storage.from('promo-images').upload(fileName, file);\r\n      if (uploadError) throw uploadError;\r\n      const { data: { publicUrl } } = supabase.storage.from('promo-images').getPublicUrl(fileName);\r\n      setFormData(p => ({ ...p, [field]: publicUrl }));\r\n      toast({ title: t(\"common.success\"), description: t(\"admin.ads.uploadSuccess\", \"图片上传成功\") });\r\n    } catch (err: any) {\r\n      toast({ title: t(\"common.error\"), description: err.message, variant: \"destructive\" });\r\n    } finally {\r\n      setUploadingField(null);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    const payload = {\r\n      name: formData.name,\r\n      image_url: formData.mobile_image_url || formData.desktop_image_url || null,\r\n      mobile_image_url: formData.mobile_image_url || null,\r\n      desktop_image_url: formData.desktop_image_url || null,\r\n      link_url: formData.link_url || null,\r\n      sort_order: formData.sort_order,\r\n      start_date: formData.start_date || null,\r\n      end_date: formData.end_date || null,\r\n      is_active: formData.is_active,\r\n    };\r\n\r\n    try {\r\n      if (editingAd) {\r\n        await updateAd.mutateAsync({ id: editingAd.id, ...payload });\r\n      } else {\r\n        await createAd.mutateAsync(payload as AdInsert);\r\n      }\r\n      setIsFormOpen(false);\r\n    } catch (err: any) {\r\n      console.error(\"Ad save error:\", err);\r\n    }\r\n  };\r\n\r\n  const handleToggleActive = async (ad: Ad) => {\r\n    await toggleAdStatus.mutateAsync({ id: ad.id, is_active: !ad.is_active });\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (deleteTarget) {\r\n      await deleteAd.mutateAsync(deleteTarget.id);\r\n      setDeleteTarget(null);\r\n    }\r\n  };\r\n\r\n  const isAdCurrentlyActive = (ad: Ad) => {\r\n    if (!ad.is_active) return false;\r\n    const now = new Date();\r\n    if (ad.start_date && new Date(ad.start_date) > now) return false;\r\n    if (ad.end_date && new Date(ad.end_date) < now) return false;\r\n    return true;\r\n  };\r\n\r\n  const renderImageUploader = (\r\n    field: 'mobile_image_url' | 'desktop_image_url',\r\n    label: string,\r\n    width: number,\r\n    height: number,\r\n    fileRef: React.RefObject<HTMLInputElement>,\r\n    icon: React.ReactNode,\r\n  ) => {\r\n    const url = formData[field];\r\n    const isUploading = uploadingField === field;\r\n    const aspectRatio = `${width}/${height}`;\r\n\r\n    return (\r\n      <div className=\"space-y-2\">\r\n        <Label className=\"flex items-center gap-1.5 text-sm\">\r\n          {icon}\r\n          {label}\r\n          <span className=\"text-xs text-muted-foreground font-normal ml-1\">\r\n            ({width} × {height}px)\r\n          </span>\r\n        </Label>\r\n        <input\r\n          ref={fileRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          className=\"hidden\"\r\n          onChange={(e) => {\r\n            const file = e.target.files?.[0];\r\n            if (file) handleUpload(file, field);\r\n            if (fileRef.current) fileRef.current.value = '';\r\n          }}\r\n        />\r\n        {url ? (\r\n          <div className=\"relative\">\r\n            {/* Preview container matching display aspect ratio */}\r\n            <div\r\n              className=\"w-full border border-border rounded-lg overflow-hidden bg-muted/30\"\r\n              style={{ aspectRatio }}\r\n            >\r\n              <img src={url} alt=\"preview\" className=\"w-full h-full object-cover\" />\r\n            </div>\r\n            <div className=\"absolute top-1.5 right-1.5 flex gap-1\">\r\n              <Button\r\n                type=\"button\" variant=\"secondary\" size=\"icon\"\r\n                className=\"h-7 w-7 bg-background/80 backdrop-blur-sm\"\r\n                onClick={() => fileRef.current?.click()}\r\n                disabled={isUploading}\r\n              >\r\n                <Upload className=\"h-3.5 w-3.5\" />\r\n              </Button>\r\n              <Button\r\n                type=\"button\" variant=\"destructive\" size=\"icon\"\r\n                className=\"h-7 w-7\"\r\n                onClick={() => setFormData(p => ({ ...p, [field]: \"\" }))}\r\n              >\r\n                <X className=\"h-3.5 w-3.5\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div\r\n            className=\"w-full border-2 border-dashed border-border rounded-lg flex flex-col items-center justify-center gap-1.5 cursor-pointer hover:border-primary/50 hover:bg-muted/30 transition-colors\"\r\n            style={{ aspectRatio }}\r\n            onClick={() => fileRef.current?.click()}\r\n          >\r\n            {isUploading ? (\r\n              <p className=\"text-xs text-muted-foreground\">{t(\"common.uploading\", \"上传中...\")}</p>\r\n            ) : (\r\n              <>\r\n                <Upload className=\"h-5 w-5 text-muted-foreground\" />\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"admin.ads.clickToUpload\", \"点击上传\")}\r\n                </p>\r\n                <p className=\"text-[10px] text-muted-foreground/70\">\r\n                  {t(\"admin.ads.recommendedSize\", \"推荐尺寸\")}: {width} × {height}px\r\n                </p>\r\n              </>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold\">{t(\"admin.ads.title\", \"广告管理\")}</h1>\r\n          <p className=\"text-sm text-muted-foreground mt-1\">\r\n            {t(\"admin.ads.description\", \"管理广告内容，包括名称、链接和图片\")}\r\n          </p>\r\n        </div>\r\n        <Button onClick={openCreate}>\r\n          <Plus className=\"h-4 w-4 mr-2\" />\r\n          {t(\"admin.ads.create\", \"新建广告\")}\r\n        </Button>\r\n      </div>\r\n\r\n      <Card>\r\n        <CardContent className=\"p-0\">\r\n          {isLoading ? (\r\n            <div className=\"p-6 space-y-3\">\r\n              {[1, 2, 3].map(i => <Skeleton key={i} className=\"h-16 w-full\" />)}\r\n            </div>\r\n          ) : !ads || ads.length === 0 ? (\r\n            <div className=\"p-12 text-center text-muted-foreground\">\r\n              {t(\"admin.ads.empty\", \"暂无广告\")}\r\n            </div>\r\n          ) : (\r\n            <Table>\r\n              <TableHeader>\r\n                <TableRow>\r\n                  <TableHead className=\"w-16\">{t(\"common.sort\", \"排序\")}</TableHead>\r\n                  <TableHead>{t(\"admin.ads.image\", \"图片\")}</TableHead>\r\n                  <TableHead>{t(\"admin.ads.name\", \"名称\")}</TableHead>\r\n                  <TableHead>{t(\"admin.ads.link\", \"链接\")}</TableHead>\r\n                  <TableHead>{t(\"admin.ads.period\", \"有效期\")}</TableHead>\r\n                  <TableHead>{t(\"admin.ads.status\", \"状态\")}</TableHead>\r\n                  <TableHead className=\"text-right\">{t(\"common.actions\", \"操作\")}</TableHead>\r\n                </TableRow>\r\n              </TableHeader>\r\n              <TableBody>\r\n                {ads.map((ad) => {\r\n                  const mobileImg = (ad as any).mobile_image_url;\r\n                  const desktopImg = (ad as any).desktop_image_url;\r\n                  const displayImg = mobileImg || desktopImg || ad.image_url;\r\n                  return (\r\n                    <TableRow key={ad.id}>\r\n                      <TableCell className=\"text-muted-foreground\">{ad.sort_order}</TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex gap-1\">\r\n                          {mobileImg && (\r\n                            <div className=\"h-10 w-10 bg-muted rounded border overflow-hidden relative\" title=\"Mobile\">\r\n                              <img src={mobileImg} alt=\"M\" className=\"h-full w-full object-cover\" />\r\n                              <Smartphone className=\"absolute bottom-0.5 right-0.5 h-2.5 w-2.5 text-white drop-shadow\" />\r\n                            </div>\r\n                          )}\r\n                          {desktopImg && (\r\n                            <div className=\"h-10 w-16 bg-muted rounded border overflow-hidden relative\" title=\"Desktop\">\r\n                              <img src={desktopImg} alt=\"D\" className=\"h-full w-full object-cover\" />\r\n                              <Monitor className=\"absolute bottom-0.5 right-0.5 h-2.5 w-2.5 text-white drop-shadow\" />\r\n                            </div>\r\n                          )}\r\n                          {!mobileImg && !desktopImg && displayImg && (\r\n                            <div className=\"h-10 w-16 bg-muted rounded border overflow-hidden\">\r\n                              <img src={displayImg} alt={ad.name} className=\"h-full w-full object-cover\" />\r\n                            </div>\r\n                          )}\r\n                          {!mobileImg && !desktopImg && !displayImg && (\r\n                            <div className=\"h-10 w-16 bg-muted rounded flex items-center justify-center text-[10px] text-muted-foreground\">\r\n                              {t(\"common.noImage\", \"无图片\")}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell className=\"font-medium\">{ad.name}</TableCell>\r\n                      <TableCell>\r\n                        {ad.link_url ? (\r\n                          <a href={ad.link_url} target=\"_blank\" rel=\"noopener noreferrer\" className=\"text-primary hover:underline text-sm flex items-center gap-1 max-w-[200px] truncate\">\r\n                            <ExternalLink className=\"h-3 w-3 shrink-0\" />\r\n                            <span className=\"truncate\">{ad.link_url}</span>\r\n                          </a>\r\n                        ) : (\r\n                          <span className=\"text-muted-foreground text-sm\">—</span>\r\n                        )}\r\n                      </TableCell>\r\n                      <TableCell className=\"text-sm text-muted-foreground\">\r\n                        {ad.start_date || ad.end_date ? (\r\n                          <div className=\"space-y-0.5\">\r\n                            {ad.start_date && <div>{format(new Date(ad.start_date), \"yyyy-MM-dd HH:mm\")}</div>}\r\n                            {ad.end_date && <div>~ {format(new Date(ad.end_date), \"yyyy-MM-dd HH:mm\")}</div>}\r\n                          </div>\r\n                        ) : (\r\n                          <span>{t(\"admin.ads.permanent\", \"长期\")}</span>\r\n                        )}\r\n                      </TableCell>\r\n                      <TableCell>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Switch checked={ad.is_active} onCheckedChange={() => handleToggleActive(ad)} />\r\n                          <Badge variant={isAdCurrentlyActive(ad) ? \"default\" : \"secondary\"}>\r\n                            {isAdCurrentlyActive(ad) ? t(\"admin.ads.active\", \"投放中\") : t(\"admin.ads.inactive\", \"未投放\")}\r\n                          </Badge>\r\n                        </div>\r\n                      </TableCell>\r\n                      <TableCell className=\"text-right\">\r\n                        <div className=\"flex items-center justify-end gap-1\">\r\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => openEdit(ad)}>\r\n                            <Pencil className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          <Button variant=\"ghost\" size=\"icon\" onClick={() => setDeleteTarget(ad)}>\r\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n                          </Button>\r\n                        </div>\r\n                      </TableCell>\r\n                    </TableRow>\r\n                  );\r\n                })}\r\n              </TableBody>\r\n            </Table>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Create / Edit Dialog */}\r\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\r\n        <DialogContent className=\"max-w-lg max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>\r\n              {editingAd ? t(\"admin.ads.edit\", \"编辑广告\") : t(\"admin.ads.create\", \"新建广告\")}\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label>{t(\"admin.ads.name\", \"名称\")} *</Label>\r\n              <Input value={formData.name} onChange={e => setFormData(p => ({ ...p, name: e.target.value }))} />\r\n            </div>\r\n\r\n            {/* Mobile Image Upload */}\r\n            {renderImageUploader(\r\n              'mobile_image_url',\r\n              t(\"admin.ads.mobileImage\", \"手机端图片\"),\r\n              MOBILE_AD_WIDTH, MOBILE_AD_HEIGHT,\r\n              mobileFileRef,\r\n              <Smartphone className=\"h-4 w-4\" />\r\n            )}\r\n\r\n            {/* Desktop Image Upload */}\r\n            {renderImageUploader(\r\n              'desktop_image_url',\r\n              t(\"admin.ads.desktopImage\", \"桌面/平板图片\"),\r\n              DESKTOP_AD_WIDTH, DESKTOP_AD_HEIGHT,\r\n              desktopFileRef,\r\n              <Monitor className=\"h-4 w-4\" />\r\n            )}\r\n\r\n            <div>\r\n              <Label>{t(\"admin.ads.linkUrl\", \"跳转链接\")}</Label>\r\n              <Input value={formData.link_url} onChange={e => setFormData(p => ({ ...p, link_url: e.target.value }))} placeholder=\"https://...\" />\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <Label>{t(\"common.sort\", \"排序\")}</Label>\r\n                <Input type=\"number\" value={formData.sort_order} onChange={e => setFormData(p => ({ ...p, sort_order: parseInt(e.target.value) || 0 }))} />\r\n              </div>\r\n              <div className=\"flex items-end gap-2\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Switch checked={formData.is_active} onCheckedChange={v => setFormData(p => ({ ...p, is_active: v }))} />\r\n                  <Label>{t(\"admin.ads.enabled\", \"启用\")}</Label>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"grid grid-cols-2 gap-4\">\r\n              <div>\r\n                <Label>{t(\"admin.ads.startDate\", \"开始时间\")}</Label>\r\n                <Input type=\"datetime-local\" value={formData.start_date} onChange={e => setFormData(p => ({ ...p, start_date: e.target.value }))} />\r\n              </div>\r\n              <div>\r\n                <Label>{t(\"admin.ads.endDate\", \"结束时间\")}</Label>\r\n                <Input type=\"datetime-local\" value={formData.end_date} onChange={e => setFormData(p => ({ ...p, end_date: e.target.value }))} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsFormOpen(false)}>{t(\"common.cancel\", \"取消\")}</Button>\r\n            <Button onClick={handleSubmit} disabled={!formData.name || createAd.isPending || updateAd.isPending}>\r\n              {t(\"common.save\", \"保存\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Delete Confirm */}\r\n      <AlertDialog open={!!deleteTarget} onOpenChange={open => !open && setDeleteTarget(null)}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"admin.ads.deleteConfirm\", \"确定要删除广告\")} \"{deleteTarget?.name}\" ?\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDelete}>{t(\"common.delete\", \"删除\")}</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminAds;\r\n"],"names":["adsTable","supabase","useAds","t","useTranslation","queryClient","useQueryClient","adsQuery","useQuery","data","error","createAd","useMutation","ad","toast","updateAd","id","updates","err","previousAds","old","_vars","context","toggleAdStatus","is_active","deleteAd","MOBILE_AD_WIDTH","MOBILE_AD_HEIGHT","DESKTOP_AD_WIDTH","DESKTOP_AD_HEIGHT","AdminAds","ads","isLoading","editingAd","setEditingAd","useState","isFormOpen","setIsFormOpen","deleteTarget","setDeleteTarget","uploadingField","setUploadingField","mobileFileRef","useRef","desktopFileRef","formData","setFormData","openCreate","openEdit","handleUpload","file","field","ext","fileName","uploadError","publicUrl","p","handleSubmit","payload","handleToggleActive","handleDelete","isAdCurrentlyActive","now","renderImageUploader","label","width","height","fileRef","icon","url","isUploading","aspectRatio","jsxs","Label","jsx","e","Button","Upload","X","Fragment","Plus","Card","CardContent","Skeleton","i","Table","TableHeader","TableRow","TableHead","TableBody","mobileImg","desktopImg","displayImg","TableCell","Smartphone","Monitor","ExternalLink","format","Switch","Badge","Pencil","Trash2","Dialog","DialogContent","DialogHeader","DialogTitle","Input","v","DialogFooter","AlertDialog","open","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"wnBAwBA,MAAMA,EAAW,IAAMC,EAAS,KAAK,KAAK,EAE7BC,GAAS,IAAM,CACpB,KAAA,CAAE,EAAAC,GAAMC,IACRC,EAAcC,KAEdC,EAAWC,GAAS,CACxB,SAAU,CAAC,KAAK,EAChB,QAAS,SAAY,CACb,KAAA,CAAE,KAAAC,EAAM,MAAAC,GAAU,MAAMV,EAAS,EACpC,OAAO,GAAG,EACV,MAAM,aAAc,CAAE,UAAW,GAAM,EACvC,MAAM,aAAc,CAAE,UAAW,EAAA,CAAO,EAC3C,GAAIU,EAAa,MAAAA,EACV,OAAAD,CACT,CAAA,CACD,EAEKE,EAAWC,EAAY,CAC3B,WAAY,MAAOC,GAAiB,CAClC,KAAM,CAAE,MAAAH,CAAM,EAAI,MAAMV,EAAS,EAAE,OAAOa,CAAE,EAC5C,GAAIH,EAAa,MAAAA,CACnB,EACA,UAAW,IAAM,CACfL,EAAY,kBAAkB,CAAE,SAAU,CAAC,KAAK,CAAG,CAAA,EAC7CS,EAAA,CAAE,MAAOX,EAAE,gBAAgB,EAAG,YAAaA,EAAE,0BAA2B,QAAQ,CAAA,CAAG,CAC3F,EACA,QAAUO,GAAiB,CACnBI,EAAA,CAAE,MAAOX,EAAE,cAAc,EAAG,YAAaO,EAAM,QAAS,QAAS,aAAe,CAAA,CACxF,CAAA,CACD,EAEKK,EAAWH,EAAY,CAC3B,WAAY,MAAO,CAAE,GAAAI,EAAI,GAAGC,KAAyC,CAC/D,GAAA,CACF,KAAM,CAAE,KAAAR,EAAM,MAAAC,GAAU,MAAMV,EAAS,EACpC,OAAOiB,CAAO,EACd,GAAG,KAAMD,CAAE,EACX,OAAO,EACV,GAAIN,EAAa,MAAAA,EACV,OAAAD,QACAS,EAAU,CACjB,GAAIA,GAAK,SAAS,SAAS,iBAAiB,EAClC,eAAA,KAAK,kDAAmDF,CAAE,EAC3D,KAEH,MAAAE,CACR,CACF,EACA,SAAU,MAAO,CAAE,GAAAF,EAAI,GAAGC,KAAc,CAEtC,MAAMZ,EAAY,cAAc,CAAE,SAAU,CAAC,KAAK,EAAG,EAErD,MAAMc,EAAcd,EAAY,aAAmB,CAAC,KAAK,CAAC,EAE9C,OAAAA,EAAA,aAAmB,CAAC,KAAK,EAAIe,GACvCA,GAAK,IAAKP,GAAQA,EAAG,KAAOG,EAAK,CAAE,GAAGH,EAAI,GAAGI,CAAA,EAAYJ,CAAG,CAAA,EAEvD,CAAE,YAAAM,CAAY,CACvB,EACA,QAAS,CAACT,EAAcW,EAAOC,IAAY,CAErCA,GAAS,aACXjB,EAAY,aAAa,CAAC,KAAK,EAAGiB,EAAQ,WAAW,EAEjDR,EAAA,CAAE,MAAOX,EAAE,cAAc,EAAG,YAAaO,EAAM,QAAS,QAAS,aAAe,CAAA,CACxF,EACA,UAAW,IAAM,CACTI,EAAA,CAAE,MAAOX,EAAE,gBAAgB,EAAG,YAAaA,EAAE,0BAA2B,QAAQ,CAAA,CAAG,CAC3F,EACA,UAAW,IAAM,CACfE,EAAY,kBAAkB,CAAE,SAAU,CAAC,KAAK,CAAG,CAAA,CACrD,CAAA,CACD,EAGKkB,EAAiBX,EAAY,CACjC,WAAY,MAAO,CAAE,GAAAI,EAAI,UAAAQ,KAAoD,CAC3E,KAAM,CAAE,MAAAd,CAAM,EAAI,MAAMT,EAAS,IAAI,mBAAoB,CACvD,MAAOe,EACP,cAAeQ,CAAA,CAChB,EACD,GAAId,EAAa,MAAAA,CACnB,EACA,SAAU,MAAO,CAAE,GAAAM,EAAI,UAAAQ,KAAgB,CACrC,MAAMnB,EAAY,cAAc,CAAE,SAAU,CAAC,KAAK,EAAG,EACrD,MAAMc,EAAcd,EAAY,aAAmB,CAAC,KAAK,CAAC,EAC9C,OAAAA,EAAA,aAAmB,CAAC,KAAK,EAAIe,GACvCA,GAAK,IAAKP,GAAQA,EAAG,KAAOG,EAAK,CAAE,GAAGH,EAAI,UAAAW,CAAA,EAAcX,CAAG,CAAA,EAEtD,CAAE,YAAAM,CAAY,CACvB,EACA,QAAS,CAACT,EAAcW,EAAOC,IAAY,CACrCA,GAAS,aACXjB,EAAY,aAAa,CAAC,KAAK,EAAGiB,EAAQ,WAAW,EAEjDR,EAAA,CAAE,MAAOX,EAAE,cAAc,EAAG,YAAaO,EAAM,QAAS,QAAS,aAAe,CAAA,CACxF,EACA,UAAW,IAAM,CACTI,EAAA,CAAE,MAAOX,EAAE,gBAAgB,EAAG,YAAaA,EAAE,0BAA2B,QAAQ,CAAA,CAAG,CAC3F,EACA,UAAW,IAAM,CACfE,EAAY,kBAAkB,CAAE,SAAU,CAAC,KAAK,CAAG,CAAA,CACrD,CAAA,CACD,EAEKoB,EAAWb,EAAY,CAC3B,WAAY,MAAOI,GAAe,CAC1B,KAAA,CAAE,MAAAN,GAAU,MAAMV,IAAW,OAAO,EAAE,GAAG,KAAMgB,CAAE,EACvD,GAAIN,EAAa,MAAAA,CACnB,EACA,UAAW,IAAM,CACfL,EAAY,kBAAkB,CAAE,SAAU,CAAC,KAAK,CAAG,CAAA,EAC7CS,EAAA,CAAE,MAAOX,EAAE,gBAAgB,EAAG,YAAaA,EAAE,0BAA2B,QAAQ,CAAA,CAAG,CAC3F,EACA,QAAUO,GAAiB,CACnBI,EAAA,CAAE,MAAOX,EAAE,cAAc,EAAG,YAAaO,EAAM,QAAS,QAAS,aAAe,CAAA,CACxF,CAAA,CACD,EAED,MAAO,CAAE,GAAGH,EAAU,SAAAI,EAAU,SAAAI,EAAU,eAAAQ,EAAgB,SAAAE,EAC5D,EC9HMC,GAAkB,IAClBC,GAAmB,IACnBC,GAAmB,IACnBC,GAAoB,IAEpBC,GAAW,IAAM,CACf,KAAA,CAAE,EAAA3B,GAAMC,IACR,CAAE,KAAM2B,EAAK,UAAAC,EAAW,SAAArB,EAAU,SAAAI,EAAU,eAAAQ,EAAgB,SAAAE,GAAavB,KACzE,CAAC+B,EAAWC,CAAY,EAAIC,WAAoB,IAAI,EACpD,CAACC,EAAYC,CAAa,EAAIF,WAAS,EAAK,EAC5C,CAACG,EAAcC,CAAe,EAAIJ,WAAoB,IAAI,EAC1D,CAACK,EAAgBC,CAAiB,EAAIN,WAAwB,IAAI,EAClEO,EAAgBC,SAAyB,IAAI,EAC7CC,EAAiBD,SAAyB,IAAI,EAE9C,CAACE,EAAUC,CAAW,EAAIX,WAAS,CACvC,KAAM,GACN,UAAW,GACX,iBAAkB,GAClB,kBAAmB,GACnB,SAAU,GACV,WAAY,EACZ,WAAY,GACZ,SAAU,GACV,UAAW,EAAA,CACZ,EAEKY,EAAa,IAAM,CACvBb,EAAa,IAAI,EACjBY,EAAY,CAAE,KAAM,GAAI,UAAW,GAAI,iBAAkB,GAAI,kBAAmB,GAAI,SAAU,GAAI,WAAY,EAAG,WAAY,GAAI,SAAU,GAAI,UAAW,GAAM,EAChKT,EAAc,EAAI,CAAA,EAGdW,EAAYnC,GAAW,CAC3BqB,EAAarB,CAAE,EACHiC,EAAA,CACV,KAAMjC,EAAG,KACT,UAAWA,EAAG,WAAa,GAC3B,iBAAmBA,EAAW,kBAAoB,GAClD,kBAAoBA,EAAW,mBAAqB,GACpD,SAAUA,EAAG,UAAY,GACzB,WAAYA,EAAG,WACf,WAAYA,EAAG,WAAaA,EAAG,WAAW,MAAM,EAAG,EAAE,EAAI,GACzD,SAAUA,EAAG,SAAWA,EAAG,SAAS,MAAM,EAAG,EAAE,EAAI,GACnD,UAAWA,EAAG,SAAA,CACf,EACDwB,EAAc,EAAI,CAAA,EAGdY,EAAe,MAAOC,EAAYC,IAAoD,CAC1FV,EAAkBU,CAAK,EACnB,GAAA,CACF,MAAMC,EAAMF,EAAK,KAAK,MAAM,GAAG,EAAE,MAE3BG,EAAW,GADFF,IAAU,mBAAqB,SAAW,SAC/B,IAAI,KAAK,IAAA,CAAK,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,MAAM,CAAC,CAAC,IAAIC,CAAG,GAChF,CAAE,MAAOE,CAAY,EAAI,MAAMrD,EAAS,QAAQ,KAAK,cAAc,EAAE,OAAOoD,EAAUH,CAAI,EAChG,GAAII,EAAmB,MAAAA,EACvB,KAAM,CAAE,KAAM,CAAE,UAAAC,CAAA,CAAY,EAAItD,EAAS,QAAQ,KAAK,cAAc,EAAE,aAAaoD,CAAQ,EAC/EP,EAAAU,IAAM,CAAE,GAAGA,EAAG,CAACL,CAAK,EAAGI,CAAY,EAAA,EACzCzC,EAAA,CAAE,MAAOX,EAAE,gBAAgB,EAAG,YAAaA,EAAE,0BAA2B,QAAQ,CAAA,CAAG,QAClFe,EAAU,CACXJ,EAAA,CAAE,MAAOX,EAAE,cAAc,EAAG,YAAae,EAAI,QAAS,QAAS,aAAe,CAAA,CAAA,QACpF,CACAuB,EAAkB,IAAI,CACxB,CAAA,EAGIgB,EAAe,SAAY,CAC/B,MAAMC,EAAU,CACd,KAAMb,EAAS,KACf,UAAWA,EAAS,kBAAoBA,EAAS,mBAAqB,KACtE,iBAAkBA,EAAS,kBAAoB,KAC/C,kBAAmBA,EAAS,mBAAqB,KACjD,SAAUA,EAAS,UAAY,KAC/B,WAAYA,EAAS,WACrB,WAAYA,EAAS,YAAc,KACnC,SAAUA,EAAS,UAAY,KAC/B,UAAWA,EAAS,SAAA,EAGlB,GAAA,CACEZ,EACI,MAAAlB,EAAS,YAAY,CAAE,GAAIkB,EAAU,GAAI,GAAGyB,EAAS,EAErD,MAAA/C,EAAS,YAAY+C,CAAmB,EAEhDrB,EAAc,EAAK,QACZnB,EAAU,CACT,QAAA,MAAM,iBAAkBA,CAAG,CACrC,CAAA,EAGIyC,GAAqB,MAAO9C,GAAW,CACrC,MAAAU,EAAe,YAAY,CAAE,GAAIV,EAAG,GAAI,UAAW,CAACA,EAAG,SAAA,CAAW,CAAA,EAGpE+C,GAAe,SAAY,CAC3BtB,IACI,MAAAb,EAAS,YAAYa,EAAa,EAAE,EAC1CC,EAAgB,IAAI,EACtB,EAGIsB,EAAuBhD,GAAW,CAClC,GAAA,CAACA,EAAG,UAAkB,MAAA,GACpB,MAAAiD,MAAU,KAEZ,MADA,EAAAjD,EAAG,YAAc,IAAI,KAAKA,EAAG,UAAU,EAAIiD,GAC3CjD,EAAG,UAAY,IAAI,KAAKA,EAAG,QAAQ,EAAIiD,EACpC,EAGHC,EAAsB,CAC1BZ,EACAa,EACAC,EACAC,EACAC,EACAC,IACG,CACG,MAAAC,EAAMxB,EAASM,CAAK,EACpBmB,EAAc9B,IAAmBW,EACjCoB,EAAc,GAAGN,CAAK,IAAIC,CAAM,GAGpC,OAAAM,EAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAACA,EAAAA,KAAAC,EAAA,CAAM,UAAU,oCACd,SAAA,CAAAL,EACAJ,EACDQ,EAAAA,KAAC,OAAK,CAAA,UAAU,iDAAiD,SAAA,CAAA,IAC7DP,EAAM,MAAIC,EAAO,KAAA,EACrB,CAAA,EACF,EACAQ,EAAA,IAAC,QAAA,CACC,IAAKP,EACL,KAAK,OACL,OAAO,UACP,UAAU,SACV,SAAWQ,GAAM,CACf,MAAMzB,EAAOyB,EAAE,OAAO,QAAQ,CAAC,EAC3BzB,GAAmBD,EAAAC,EAAMC,CAAK,EAC9BgB,EAAQ,UAAiBA,EAAA,QAAQ,MAAQ,GAC/C,CAAA,CACF,EACCE,EACCG,EAAA,KAAC,MAAI,CAAA,UAAU,WAEb,SAAA,CAAAE,EAAA,IAAC,MAAA,CACC,UAAU,qEACV,MAAO,CAAE,YAAAH,CAAY,EAErB,eAAC,MAAI,CAAA,IAAKF,EAAK,IAAI,UAAU,UAAU,6BAA6B,CAAA,CACtE,EACAG,EAAAA,KAAC,MAAI,CAAA,UAAU,wCACb,SAAA,CAAAE,EAAA,IAACE,EAAA,CACC,KAAK,SAAS,QAAQ,YAAY,KAAK,OACvC,UAAU,4CACV,QAAS,IAAMT,EAAQ,SAAS,MAAM,EACtC,SAAUG,EAEV,SAAAI,EAAAA,IAACG,EAAO,CAAA,UAAU,aAAc,CAAA,CAAA,CAClC,EACAH,EAAA,IAACE,EAAA,CACC,KAAK,SAAS,QAAQ,cAAc,KAAK,OACzC,UAAU,UACV,QAAS,IAAM9B,EAAkBU,IAAA,CAAE,GAAGA,EAAG,CAACL,CAAK,EAAG,EAAA,EAAK,EAEvD,SAAAuB,EAAAA,IAACI,GAAE,CAAA,UAAU,aAAc,CAAA,CAAA,CAC7B,CAAA,EACF,CAAA,CAAA,CACF,EAEAJ,EAAA,IAAC,MAAA,CACC,UAAU,sLACV,MAAO,CAAE,YAAAH,CAAY,EACrB,QAAS,IAAMJ,EAAQ,SAAS,MAAM,EAErC,SAAAG,EACEI,EAAA,IAAA,IAAA,CAAE,UAAU,gCAAiC,WAAE,mBAAoB,QAAQ,CAAE,CAAA,EAG5EF,EAAAA,KAAAO,EAAAA,SAAA,CAAA,SAAA,CAACL,EAAAA,IAAAG,EAAA,CAAO,UAAU,+BAAgC,CAAA,QACjD,IAAE,CAAA,UAAU,gCACV,SAAE1E,EAAA,0BAA2B,MAAM,EACtC,EACAqE,EAAAA,KAAC,IAAE,CAAA,UAAU,uCACV,SAAA,CAAArE,EAAE,4BAA6B,MAAM,EAAE,KAAG8D,EAAM,MAAIC,EAAO,IAAA,EAC9D,CAAA,EACF,CAAA,CAEJ,CAEJ,CAAA,CAAA,CAAA,EAKF,OAAAM,EAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,oCACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAAAE,MAAC,MAAG,UAAU,qBAAsB,SAAEvE,EAAA,kBAAmB,MAAM,EAAE,QAChE,IAAE,CAAA,UAAU,qCACV,SAAEA,EAAA,wBAAyB,mBAAmB,EACjD,CAAA,EACF,EACAqE,EAAAA,KAACI,EAAO,CAAA,QAAS7B,EACf,SAAA,CAAC2B,EAAAA,IAAAM,GAAA,CAAK,UAAU,cAAe,CAAA,EAC9B7E,EAAE,mBAAoB,MAAM,CAAA,EAC/B,CAAA,EACF,QAEC8E,GACC,CAAA,SAAAP,MAACQ,IAAY,UAAU,MACpB,WACER,EAAA,IAAA,MAAA,CAAI,UAAU,gBACZ,UAAC,EAAG,EAAG,CAAC,EAAE,OAAUA,EAAAA,IAAAS,GAAA,CAAiB,UAAU,aAAA,EAAbC,CAA2B,CAAE,CAClE,CAAA,EACE,CAACrD,GAAOA,EAAI,SAAW,QACxB,MAAI,CAAA,UAAU,yCACZ,SAAE5B,EAAA,kBAAmB,MAAM,CAC9B,CAAA,SAECkF,GACC,CAAA,SAAA,CAACX,EAAA,IAAAY,GAAA,CACC,gBAACC,EACC,CAAA,SAAA,CAAAb,MAACc,GAAU,UAAU,OAAQ,SAAErF,EAAA,cAAe,IAAI,EAAE,EACnDuE,EAAA,IAAAc,EAAA,CAAW,SAAErF,EAAA,kBAAmB,IAAI,EAAE,EACtCuE,EAAA,IAAAc,EAAA,CAAW,SAAErF,EAAA,iBAAkB,IAAI,EAAE,EACrCuE,EAAA,IAAAc,EAAA,CAAW,SAAErF,EAAA,iBAAkB,IAAI,EAAE,EACrCuE,EAAA,IAAAc,EAAA,CAAW,SAAErF,EAAA,mBAAoB,KAAK,EAAE,EACxCuE,EAAA,IAAAc,EAAA,CAAW,SAAErF,EAAA,mBAAoB,IAAI,EAAE,QACvCqF,EAAU,CAAA,UAAU,aAAc,SAAErF,EAAA,iBAAkB,IAAI,EAAE,CAAA,CAAA,CAC/D,CACF,CAAA,EACCuE,EAAA,IAAAe,GAAA,CACE,SAAI1D,EAAA,IAAKlB,GAAO,CACf,MAAM6E,EAAa7E,EAAW,iBACxB8E,EAAc9E,EAAW,kBACzB+E,EAAaF,GAAaC,GAAc9E,EAAG,UACjD,cACG0E,EACC,CAAA,SAAA,CAAAb,EAAA,IAACmB,EAAU,CAAA,UAAU,wBAAyB,SAAAhF,EAAG,WAAW,EAC3D6D,MAAAmB,EAAA,CACC,SAACrB,EAAAA,KAAA,MAAA,CAAI,UAAU,aACZ,SAAA,CAAAkB,GACElB,EAAAA,KAAA,MAAA,CAAI,UAAU,6DAA6D,MAAM,SAChF,SAAA,CAAAE,MAAC,OAAI,IAAKgB,EAAW,IAAI,IAAI,UAAU,6BAA6B,EACpEhB,EAAAA,IAACoB,EAAW,CAAA,UAAU,kEAAmE,CAAA,CAAA,EAC3F,EAEDH,GACEnB,EAAAA,KAAA,MAAA,CAAI,UAAU,6DAA6D,MAAM,UAChF,SAAA,CAAAE,MAAC,OAAI,IAAKiB,EAAY,IAAI,IAAI,UAAU,6BAA6B,EACrEjB,EAAAA,IAACqB,EAAQ,CAAA,UAAU,kEAAmE,CAAA,CAAA,EACxF,EAED,CAACL,GAAa,CAACC,GAAcC,GAC5BlB,EAAAA,IAAC,OAAI,UAAU,oDACb,SAACA,EAAAA,IAAA,MAAA,CAAI,IAAKkB,EAAY,IAAK/E,EAAG,KAAM,UAAU,4BAA6B,CAAA,EAC7E,EAED,CAAC6E,GAAa,CAACC,GAAc,CAACC,GAC5BlB,EAAA,IAAA,MAAA,CAAI,UAAU,gGACZ,SAAEvE,EAAA,iBAAkB,KAAK,CAC5B,CAAA,CAAA,CAAA,CAEJ,CACF,CAAA,EACCuE,EAAA,IAAAmB,EAAA,CAAU,UAAU,cAAe,WAAG,KAAK,EAC3CnB,EAAA,IAAAmB,EAAA,CACE,SAAGhF,EAAA,gBACD,IAAE,CAAA,KAAMA,EAAG,SAAU,OAAO,SAAS,IAAI,sBAAsB,UAAU,sFACxE,SAAA,CAAC6D,EAAAA,IAAAsB,GAAA,CAAa,UAAU,kBAAmB,CAAA,EAC1CtB,EAAA,IAAA,OAAA,CAAK,UAAU,WAAY,WAAG,SAAS,CAAA,EAC1C,EAECA,MAAA,OAAA,CAAK,UAAU,gCAAgC,YAAC,CAAA,EAErD,EACAA,EAAA,IAACmB,EAAU,CAAA,UAAU,gCAClB,SAAAhF,EAAG,YAAcA,EAAG,SACnB2D,EAAAA,KAAC,MAAI,CAAA,UAAU,cACZ,SAAA,CAAG3D,EAAA,YAAe6D,EAAAA,IAAA,MAAA,CAAK,SAAOuB,EAAA,IAAI,KAAKpF,EAAG,UAAU,EAAG,kBAAkB,CAAE,CAAA,EAC3EA,EAAG,UAAY2D,EAAAA,KAAC,MAAI,CAAA,SAAA,CAAA,KAAGyB,EAAO,IAAI,KAAKpF,EAAG,QAAQ,EAAG,kBAAkB,CAAA,EAAE,CAAA,EAC5E,EAEC6D,MAAA,OAAA,CAAM,WAAE,sBAAuB,IAAI,CAAE,CAAA,EAE1C,EACCA,MAAAmB,EAAA,CACC,SAACrB,EAAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAACE,MAAAwB,EAAA,CAAO,QAASrF,EAAG,UAAW,gBAAiB,IAAM8C,GAAmB9C,CAAE,EAAG,QAC7EsF,GAAM,CAAA,QAAStC,EAAoBhD,CAAE,EAAI,UAAY,YACnD,SAAAgD,EAAoBhD,CAAE,EAAIV,EAAE,mBAAoB,KAAK,EAAIA,EAAE,qBAAsB,KAAK,EACzF,CAAA,CAAA,CACF,CACF,CAAA,QACC0F,EAAU,CAAA,UAAU,aACnB,SAACrB,EAAA,KAAA,MAAA,CAAI,UAAU,sCACb,SAAA,CAAAE,EAAA,IAACE,EAAO,CAAA,QAAQ,QAAQ,KAAK,OAAO,QAAS,IAAM5B,EAASnC,CAAE,EAC5D,SAAA6D,MAAC0B,GAAO,CAAA,UAAU,SAAU,CAAA,EAC9B,EACC1B,EAAA,IAAAE,EAAA,CAAO,QAAQ,QAAQ,KAAK,OAAO,QAAS,IAAMrC,EAAgB1B,CAAE,EACnE,SAAA6D,MAAC2B,GAAO,CAAA,UAAU,0BAA2B,CAAA,EAC/C,CAAA,CAAA,CACF,CACF,CAAA,CAAA,GAlEaxF,EAAG,EAmElB,CAEH,CAAA,EACH,CAAA,CACF,CAAA,CAEJ,CAAA,EACF,EAGA6D,EAAAA,IAAC4B,IAAO,KAAMlE,EAAY,aAAcC,EACtC,SAAAmC,EAAA,KAAC+B,GAAc,CAAA,UAAU,wCACvB,SAAA,CAAA7B,EAAA,IAAC8B,GACC,CAAA,SAAA9B,EAAA,IAAC+B,GACE,CAAA,SAAAxE,EAAY9B,EAAE,iBAAkB,MAAM,EAAIA,EAAE,mBAAoB,MAAM,CACzE,CAAA,EACF,EACAqE,EAAAA,KAAC,MAAI,CAAA,UAAU,YACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAAAA,OAACC,EAAO,CAAA,SAAA,CAAAtE,EAAE,iBAAkB,IAAI,EAAE,IAAA,EAAE,QACnCuG,EAAM,CAAA,MAAO7D,EAAS,KAAM,SAAe8B,GAAA7B,EAAkBU,IAAA,CAAE,GAAGA,EAAG,KAAMmB,EAAE,OAAO,KAAA,EAAQ,EAAG,CAAA,EAClG,EAGCZ,EACC,mBACA5D,EAAE,wBAAyB,OAAO,EAClCuB,GAAiBC,GACjBe,EACAgC,EAAAA,IAACoB,EAAW,CAAA,UAAU,SAAU,CAAA,CAClC,EAGC/B,EACC,oBACA5D,EAAE,yBAA0B,SAAS,EACrCyB,GAAkBC,GAClBe,EACA8B,EAAAA,IAACqB,EAAQ,CAAA,UAAU,SAAU,CAAA,CAC/B,SAEC,MACC,CAAA,SAAA,CAAArB,EAAA,IAACD,EAAO,CAAA,SAAAtE,EAAE,oBAAqB,MAAM,EAAE,QACtCuG,EAAM,CAAA,MAAO7D,EAAS,SAAU,YAAeC,EAAYU,IAAM,CAAE,GAAGA,EAAG,SAAUmB,EAAE,OAAO,OAAQ,EAAG,YAAY,cAAc,CAAA,EACpI,EACAH,EAAAA,KAAC,MAAI,CAAA,UAAU,yBACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAAAE,EAAA,IAACD,EAAO,CAAA,SAAAtE,EAAE,cAAe,IAAI,EAAE,EAC/BuE,EAAAA,IAACgC,GAAM,KAAK,SAAS,MAAO7D,EAAS,WAAY,SAAU8B,GAAK7B,EAAYU,IAAM,CAAE,GAAGA,EAAG,WAAY,SAASmB,EAAE,OAAO,KAAK,GAAK,CAAE,EAAE,CAAG,CAAA,CAAA,EAC3I,QACC,MAAI,CAAA,UAAU,uBACb,SAACH,EAAA,KAAA,MAAA,CAAI,UAAU,0BACb,SAAA,CAAAE,EAAA,IAACwB,EAAO,CAAA,QAASrD,EAAS,UAAW,gBAAsB8D,GAAA7D,EAAkBU,IAAA,CAAE,GAAGA,EAAG,UAAWmD,CAAA,EAAI,EAAG,EACtGjC,EAAA,IAAAD,EAAA,CAAO,SAAEtE,EAAA,oBAAqB,IAAI,EAAE,CAAA,CAAA,CACvC,CACF,CAAA,CAAA,EACF,EACAqE,EAAAA,KAAC,MAAI,CAAA,UAAU,yBACb,SAAA,CAAAA,OAAC,MACC,CAAA,SAAA,CAAAE,EAAA,IAACD,EAAO,CAAA,SAAAtE,EAAE,sBAAuB,MAAM,EAAE,QACxCuG,EAAM,CAAA,KAAK,iBAAiB,MAAO7D,EAAS,WAAY,SAAU8B,GAAK7B,EAAkBU,IAAA,CAAE,GAAGA,EAAG,WAAYmB,EAAE,OAAO,OAAQ,EAAG,CAAA,EACpI,SACC,MACC,CAAA,SAAA,CAAAD,EAAA,IAACD,EAAO,CAAA,SAAAtE,EAAE,oBAAqB,MAAM,EAAE,QACtCuG,EAAM,CAAA,KAAK,iBAAiB,MAAO7D,EAAS,SAAU,SAAU8B,GAAK7B,EAAkBU,IAAA,CAAE,GAAGA,EAAG,SAAUmB,EAAE,OAAO,OAAQ,EAAG,CAAA,EAChI,CAAA,EACF,CAAA,EACF,SACCiC,GACC,CAAA,SAAA,CAAClC,EAAAA,IAAAE,EAAA,CAAO,QAAQ,UAAU,QAAS,IAAMvC,EAAc,EAAK,EAAI,SAAAlC,EAAE,gBAAiB,IAAI,CAAE,CAAA,EACxFuE,EAAA,IAAAE,EAAA,CAAO,QAASnB,EAAc,SAAU,CAACZ,EAAS,MAAQlC,EAAS,WAAaI,EAAS,UACvF,SAAEZ,EAAA,cAAe,IAAI,EACxB,CAAA,EACF,CAAA,CAAA,CACF,CACF,CAAA,EAGCuE,EAAA,IAAAmC,GAAA,CAAY,KAAM,CAAC,CAACvE,EAAc,aAAsBwE,GAAA,CAACA,GAAQvE,EAAgB,IAAI,EACpF,gBAACwE,GACC,CAAA,SAAA,CAAAvC,OAACwC,GACC,CAAA,SAAA,CAAAtC,EAAA,IAACuC,GAAkB,CAAA,SAAA9G,EAAE,uBAAwB,MAAM,EAAE,SACpD+G,GACE,CAAA,SAAA,CAAA/G,EAAE,0BAA2B,SAAS,EAAE,KAAGmC,GAAc,KAAK,KAAA,EACjE,CAAA,EACF,SACC6E,GACC,CAAA,SAAA,CAAAzC,EAAA,IAAC0C,GAAmB,CAAA,SAAAjH,EAAE,gBAAiB,IAAI,EAAE,QAC5CkH,GAAkB,CAAA,QAASzD,GAAe,SAAEzD,EAAA,gBAAiB,IAAI,EAAE,CAAA,EACtE,CAAA,CAAA,CACF,CACF,CAAA,CACF,CAAA,CAAA,CAEJ"}