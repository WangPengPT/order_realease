import{j as e,bA as K,u as Q,p as J,r as g,s as O,bT as P,ak as W,el as R,b8 as X,cB as Y,be as Z,bG as ee,a_ as se,w as S}from"./vendor-react-87iFmKFJ.js";import{S as p,u as te,h,C as j,n as b,m as ie,B as v,s as re}from"./index-BrOhGy48.js";import{u as ae,R as ne,P as ce}from"./PublishConfirmStep-B6rYaGg8.js";import{S as w}from"./separator-BpIhbv8t.js";import{R as le}from"./RecipeCookingMode-C-vJ1lr_.js";import{u as oe}from"./useSavedRecipes-C7aQsABw.js";import{u as de}from"./useCreateRecipe-BuEYr6mx.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CQWbleDe.js";import"./progress-BadpfeCy.js";import"./TranslateButton-4661lXfE.js";import"./ImagePreviewModal-BV6JKbFL.js";const me=({showHeader:l=!0,showFilters:o=!0,children:i})=>e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 animate-fade-in",children:[l&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx(p,{className:"h-8 sm:h-10 w-48 mb-2"}),e.jsx(p,{className:"h-4 sm:h-5 w-72"})]}),o&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6",children:[e.jsx(p,{className:"h-10 flex-1 max-w-md rounded-md"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{className:"h-10 w-28 rounded-md"}),e.jsx(p,{className:"h-10 w-24 rounded-md"})]})]}),i]}),Ce=()=>{const{id:l}=K(),o=Q(),{t:i,i18n:c}=J(),{user:A}=te(),{deleteRecipe:D}=oe(),y=de(),{uploadImage:T,verifyResultPhoto:V,isVerifying:M}=ae(),[d,_]=g.useState("guided"),[a,n]=g.useState("overview"),[m,U]=g.useState(""),[z,B]=g.useState(!1),F=()=>{n("result")},I=(t,r)=>{U(t),B(r),r&&n("publish")},L=async t=>{if(!(!s||!m))try{await y.mutateAsync({recipe_name:s.recipe_name,subtitle:s.subtitle,cook_time:s.cook_time,difficulty:s.difficulty,servings:s.servings,ingredients:s.ingredients,steps:s.steps.map((r,x)=>({...r,order:x+1})),cover_image:m,introduction:t?.trim()||s.introduction,ai_recipe_source:{source:"saved_recipe",saved_recipe_id:l,result_image:m,photo_verified:z}}),S.success(i("aiRecipe.allPublished","é£Ÿè°±å·²å‘å¸ƒåˆ°ç¤¾åŒºï¼")),o("/community")}catch{}},k=()=>{n("overview"),S.success(i("aiRecipe.cookingComplete","å¤ªæ£’äº†ï¼çƒ¹é¥ªå®Œæˆï¼"))},{data:f,isLoading:q}=O({queryKey:["saved-recipe",l],queryFn:async()=>{const{data:t,error:r}=await re.from("saved_recipes").select("*").eq("id",l).single();if(r)throw r;return t},enabled:!!l&&!!A});if(q)return e.jsx(me,{});if(!f)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx("p",{className:"text-muted-foreground",children:i("aiRecipe.recipeNotFound","é£Ÿè°±æœªæ‰¾åˆ°")}),e.jsxs(h,{variant:"outline",onClick:()=>o("/profile"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),i("common.back","è¿”å›")]})]});const s=f.recipe_data,C=()=>c.language==="en"&&s.recipe_name_en?s.recipe_name_en:c.language==="pt"&&s.recipe_name_pt?s.recipe_name_pt:s.recipe_name,E=t=>{switch(t){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},G=t=>{switch(t){case"easy":return i("recipe.difficulty.easy","ç®€å•");case"medium":return i("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return i("recipe.difficulty.hard","å›°éš¾");default:return t}},u=s.steps?.map((t,r)=>({...t,order:t.order||r+1}))||[],N=u.length>0,H=async()=>{try{await D(f.id),o("/profile")}catch{}},$=()=>a==="result"?i("aiRecipe.resultPhotoTitle","æ‹æ‘„æˆå“"):a==="publish"?i("aiRecipe.confirmPublish","ç¡®è®¤å‘å¸ƒ"):f.recipe_name;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-14 z-10 bg-background border-b px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-lg mx-auto",children:[e.jsx("button",{onClick:()=>{a==="result"?n("cooking"):a==="publish"?n("result"):o(-1)},className:"p-1 -ml-1 hover:bg-muted rounded-md",children:e.jsx(P,{className:"h-5 w-5"})}),e.jsx("h2",{className:"font-medium text-sm line-clamp-1 flex-1 text-center mx-4",children:$()}),a==="overview"?e.jsx(h,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:H,children:e.jsx(W,{className:"h-4 w-4"})}):e.jsx("div",{className:"w-8"})]})}),e.jsxs("div",{className:"max-w-lg mx-auto p-4",children:[a==="result"&&e.jsx(j,{className:"overflow-hidden",children:e.jsxs(b,{className:"pt-6",children:[e.jsx(ne,{onPhotoVerified:I,uploadImage:T,verifyPhoto:V,recipeName:s.recipe_name,isVerifying:M}),e.jsx("div",{className:"mt-4",children:e.jsx(h,{variant:"ghost",className:"w-full text-muted-foreground",onClick:k,children:i("aiRecipe.noThanks","æš‚æ—¶ä¸åˆ†äº«")})})]})}),a==="publish"&&m&&e.jsx(j,{className:"overflow-hidden",children:e.jsx(b,{className:"pt-6",children:e.jsx(ce,{resultImageUrl:m,recipeName:C(),onPublish:L,onSkip:k,isPublishing:y.isPending})})}),a==="cooking"&&d==="guided"&&N&&e.jsx(j,{className:"overflow-hidden",children:e.jsx(le,{steps:u,onExit:()=>n("overview"),onComplete:F})}),(a==="overview"||d==="full")&&a!=="result"&&a!=="publish"&&e.jsxs(e.Fragment,{children:[a!=="cooking"&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{_("guided"),n("overview")},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${d==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(R,{className:"h-4 w-4"}),i("recipe.guidedMode","æµç¨‹æ¨¡å¼")]}),e.jsxs("button",{onClick:()=>_("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${d==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(X,{className:"h-4 w-4"}),i("recipe.fullMode","å®Œæ•´æ¨¡å¼")]})]})}),e.jsxs(j,{className:"overflow-hidden",children:[e.jsxs(ie,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(v,{className:"bg-primary text-primary-foreground gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),i("recipe.badge","é£Ÿè°±")]})}),e.jsx("h2",{className:"text-xl font-bold",children:C()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",i("recipe.minutes","åˆ†é’Ÿ")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",i("recipe.servingsUnit","äººä»½")]})]}),s.difficulty&&e.jsxs(v,{variant:"outline",className:E(s.difficulty),children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),G(s.difficulty)]})]})]}),e.jsxs(b,{className:"space-y-6",children:[(()=>{const t=c.language==="en"&&s.introduction_en?s.introduction_en:c.language==="pt"&&s.introduction_pt?s.introduction_pt:s.introduction;return t&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:t})})(),e.jsx(w,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[i("recipe.ingredients","é£Ÿæ")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:i("recipe.ingredientName","åç§°")}),e.jsx("span",{className:"w-24 text-right",children:i("recipe.amount","ç”¨é‡")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((t,r)=>{const x=c.language==="en"&&t.name_en?t.name_en:c.language==="pt"&&t.name_pt?t.name_pt:t.name;return e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:x}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[t.amount," ",t.unit]})]},r)})})]}),d==="guided"&&N&&e.jsxs(h,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:()=>n("cooking"),children:[e.jsx(R,{className:"h-6 w-6"}),i("recipe.startCooking","å¼€å§‹çƒ¹é¥ª"),e.jsxs(v,{variant:"secondary",className:"ml-2",children:[u.length," ",i("recipe.stepsCount","æ­¥")]})]}),d==="full"&&N&&e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[i("recipe.steps","æ­¥éª¤")," (",u.length,")"]}),e.jsx("ol",{className:"space-y-4",children:u.map((t,r)=>{const x=c.language==="en"&&t.description_en?t.description_en:c.language==="pt"&&t.description_pt?t.description_pt:t.description;return e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:t.order}),e.jsx("p",{className:"text-sm flex-1",children:x})]},r)})})]}),e.jsx(w,{}),e.jsxs(h,{size:"lg",className:"w-full gap-2 h-14 text-base",onClick:()=>n("result"),children:["ğŸ‰ ",i("aiRecipe.finishAndShare","å®Œæˆå¹¶åˆ†äº«åˆ°ç¤¾åŒº")]})]})]})]})]})]})]})};export{Ce as default};
//# sourceMappingURL=SavedRecipeDetail-P2Alc_Eg.js.map
