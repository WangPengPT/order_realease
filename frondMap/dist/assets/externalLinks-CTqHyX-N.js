import{k as f,r as a,s as u}from"./index-DVul3rRI.js";const l="location_cache",d=()=>{const t="visitor_id";let e=localStorage.getItem(t);return e||(e=crypto.randomUUID(),localStorage.setItem(t,e)),e},y=()=>{try{const t=sessionStorage.getItem(l);if(t)return JSON.parse(t)}catch{}return null},h=t=>{try{sessionStorage.setItem(l,JSON.stringify(t))}catch{}},w=async()=>{const t=y();if(t)return t;try{const{data:e,error:r}=await u.functions.invoke("get-location");if(r)return console.error("Failed to fetch location:",r),{country:null,city:null,region:null};const n={country:(e==null?void 0:e.country)||null,city:(e==null?void 0:e.city)||null,region:(e==null?void 0:e.region)||null,ip:(e==null?void 0:e.ip)||null};return(n.country||n.city)&&h(n),n}catch(e){return console.error("Failed to fetch location data:",e),{country:null,city:null,region:null}}},A=({pageType:t,targetId:e})=>{const{user:r}=f(),n=a.useRef(!1);a.useEffect(()=>{if(n.current)return;n.current=!0,(async()=>{try{const o=d(),i=await w();await u.from("page_views").insert({page_type:t,target_id:e||null,visitor_id:o,user_id:(r==null?void 0:r.id)||null,user_agent:navigator.userAgent,referer:document.referrer||null,country:i.country,city:i.city,region:i.region})}catch(o){console.error("Failed to track page view:",o)}})()},[t,e,r==null?void 0:r.id])},S=()=>{const t=navigator.userAgent;if(!/iPad|iPhone|iPod/.test(t)||window.navigator.standalone===!0)return!1;if(/FBAN|FBAV|Twitter|Instagram|Line|WeChat|MicroMessenger|QQ|Weibo/i.test(t))return!0;const s=/Safari\//.test(t),o=/CriOS/.test(t),i=/FxiOS/.test(t),c=/EdgiOS/.test(t);if(!s&&!o&&!i&&!c)return!0;const g=/Version\/[\d.]+/.test(t);return!!(s&&!g&&!o&&!i&&!c)},I=()=>{const t=navigator.userAgent,e=/Android/.test(t),r=/wv/.test(t)||/Version\/[\d.]+.*Chrome/.test(t);return e&&r},m=()=>S()||I();export{S as a,m as i,A as u};
