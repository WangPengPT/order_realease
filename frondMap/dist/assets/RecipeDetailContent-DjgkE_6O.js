import{p as Q,u as qe,r as l,j as e,bf as oe,b0 as Xe,cW as Je,L as J,b5 as Ke,a_ as Qe,aw as te,ay as ae,eg as Ce,be as ne,b3 as re,bq as le,cf as Ze,X as Ie,bj as De,W as ze,w as es,cw as Ae,bD as Le,dN as Me,dO as Pe,bz as $e,ei as ie,a4 as ss,bc as Se}from"./vendor-react-DwI6ZJq7.js";import{C as _e,a as ke,b as Te}from"./carousel-D95V3LOY.js";import{u as ts,C as q,p as de,P as me,Q as xe,R as ue,g as L,K as as,L as ns,B as j,M as rs,N as Ee,q as K,r as ls,A as is,t as cs,v as os,w as ds,x as ms,y as xs,z as us,E as hs}from"./index-C7QjDrm6.js";import{a as gs,f as fs,b as ps}from"./useCommunityPosts-CLuoFC0C.js";import{u as he}from"./useLocalizedContent-MCfjRTM4.js";import{T as Z}from"./TranslateButton-B50pnwzD.js";import{u as js}from"./ShareDrawer-BQGopPSQ.js";import{E as Ns,a as ws}from"./EditRecipeDialog-PDDiowvd.js";import{H as ge,p as fe,I as pe,J as je}from"./vendor-utils-vwQGbBim.js";import{S as ce}from"./separator-CibeM5gC.js";import{I as Ne}from"./ImagePreviewModal-BnY9exzb.js";import{P as bs}from"./progress-BvJjdbpj.js";const $s=({post:s,showActions:$=!0,isDetailPage:t=!1})=>{const{t:c,i18n:b}=Q(),{user:S}=ts(),v=qe(),{getLocalizedField:z}=he(),_=gs(),A=fs(),k=ps(),[h,T]=l.useState(!1),[y,E]=l.useState(!1),[I,M]=l.useState({}),[C,o]=l.useState(!1),[u,p]=l.useState(0),[N,P]=l.useState(),[O,G]=l.useState(),[U,W]=l.useState(0),[H,Y]=l.useState(null);l.useState(null),l.useState(!1),l.useState(0),l.useState(!1);const[d,a]=l.useState({}),[r,i]=l.useState(null),[g,w]=l.useState(!1),{share:R,DrawerComponent:V}=js();l.useEffect(()=>{if(C){const n=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${n}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,n)}}},[C]),l.useEffect(()=>{N&&(W(N.selectedScrollSnap()),N.on("select",()=>{W(N.selectedScrollSnap())}))},[N]);const Re=()=>{switch(b.language){case"zh":return je;case"pt":return pe;default:return fe}},Fe=()=>{S&&_.mutate({postId:s.id,liked:s.user_liked||!1})},Oe=async()=>{const n=`${window.location.origin}/community/${s.id}`;R({title:c("community.shareTitle","分享帖子"),text:s.content.replace(/<[^>]*>/g,"").substring(0,100),url:n},()=>{S&&A.mutate(s.id),es.success(c("community.shareSuccess","分享成功"))})},Ue=()=>{k.mutate(s.id),T(!1)},we=n=>{t?(p(n),o(!0)):v(`/community/${s.id}`)},X=(n,m)=>{const f=n.currentTarget;a(D=>({...D,[m]:{width:f.naturalWidth,height:f.naturalHeight}}))},be=n=>{const m=d[n];return m?m.height/m.width>1.5:!1},ve=S?.id===s.author_id,We=s.activity?z(s.activity,"title"):null,B=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(n=>n.id===s.restaurant?.id)?[s.restaurant]:[]],ee=t?3:2,Ge=g?B:B.slice(0,ee),ye=B.length>ee,He=z(s,"content"),Ye=b.language==="zh"&&s.content_zh||b.language==="en"&&s.content_en||b.language==="pt"&&s.content_pt,Ve=(H||He||s.content)?.replace(/\n/g,"<br>")||"";return e.jsxs(e.Fragment,{children:[e.jsxs(q,{className:"overflow-hidden",children:[e.jsx(de,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(ue,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(s.created_at),{addSuffix:!0,locale:Re()})}),ve&&s.status==="pending"&&e.jsxs(L,{variant:"outline",className:"text-amber-600 border-amber-500 bg-amber-50 dark:bg-amber-950/30 text-xs mt-0.5",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),c("community.pendingReview","审核中")]})]})]}),$&&ve&&e.jsxs(as,{children:[e.jsx(ns,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Xe,{className:"h-4 w-4"})})}),e.jsxs(rs,{align:"end",children:[e.jsxs(Ee,{onClick:()=>E(!0),children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),c("common.edit","编辑")]}),e.jsx(Ee,{onClick:()=>T(!0),className:"text-destructive",children:c("common.delete","删除")})]})]})]})}),e.jsxs(K,{className:"pt-0 pb-3",children:[(s.activity||B.length>0)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3 items-center",children:[s.activity&&e.jsx(J,{to:`/activity/${s.activity.id}`,children:e.jsxs(L,{variant:"secondary",className:"gap-1",children:[e.jsx(Ke,{className:"h-3 w-3"}),We]})}),Ge.map(n=>e.jsx(J,{to:`/restaurant/${n.id}`,children:e.jsxs(L,{variant:"secondary",className:"gap-1",children:[e.jsx(Qe,{className:"h-3 w-3"}),z(n,"name")]})},n.id)),ye&&!g&&e.jsxs("button",{onClick:()=>w(!0),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:["+",B.length-ee," ",c("community.more","更多"),e.jsx(te,{className:"h-3 w-3"})]}),g&&ye&&e.jsxs("button",{onClick:()=>w(!1),className:"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5",children:[c("community.collapse","收起"),e.jsx(ae,{className:"h-3 w-3"})]})]}),e.jsx(J,{to:`/community/${s.id}`,children:e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert ${t?"":"line-clamp-6"}`,dangerouslySetInnerHTML:{__html:Ve}})}),!Ye&&e.jsx(Z,{text:s.content,onTranslation:Y,className:"mt-1"}),(()=>{const n=t&&s.video_url?(s.image_urls||[]).filter(m=>!m.includes("-cover")):s.image_urls;return!n||n.length===0?null:e.jsx("div",{className:"relative mt-3",children:n.length===1?(()=>{const m=n[0],f=be(m);return e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]",onClick:()=>we(0),children:I[m]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:c("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m,alt:"",className:"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top",onLoad:D=>X(D,m),onError:()=>M(D=>({...D,[m]:!0}))}),f&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),e.jsx("span",{children:c("community.longImage","长图")})]})]})})})():e.jsxs(e.Fragment,{children:[e.jsx(_e,{setApi:P,className:"w-full",opts:{loop:!0},children:e.jsx(ke,{className:"-ml-0",children:n.map((m,f)=>{const D=be(m);return e.jsx(Te,{className:"pl-0",children:e.jsx("div",{className:"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted",onClick:()=>we(f),children:I[m]?e.jsx("div",{className:"w-full h-full min-h-[200px] bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:c("common.imageLoadError","图片加载失败")})}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:m,alt:"",className:"w-full h-full object-contain",onLoad:x=>X(x,m),onError:()=>M(x=>({...x,[m]:!0}))}),D&&e.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),e.jsx("span",{children:c("community.longImage","长图")})]})]})})},f)})})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[U+1,"/",n.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:n.map((m,f)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${f===U?"bg-primary":"bg-muted-foreground/30"}`,onClick:D=>{D.stopPropagation(),N?.scrollTo(f)}},f))})]})})})(),s.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden bg-gray-900",children:e.jsx("video",{src:s.video_url,...s.image_urls?.length?{poster:s.image_urls[0]}:{},controls:!0,className:"w-full max-h-96",preload:"metadata",playsInline:!0})})]}),e.jsx(ls,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(j,{variant:"ghost",size:"sm",className:`gap-2 ${s.user_liked?"text-red-500":""}`,onClick:Fe,disabled:!S,children:[e.jsx(ne,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count})]}),e.jsx(J,{to:`/community/${s.id}`,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:s.comments_count})]})}),e.jsxs(j,{variant:"ghost",size:"sm",className:"gap-2",onClick:Oe,children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:s.shares_count})]})]})})]}),e.jsx(is,{open:h,onOpenChange:T,children:e.jsxs(cs,{children:[e.jsxs(os,{children:[e.jsx(ds,{children:c("common.confirmDelete","确认删除")}),e.jsx(ms,{children:c("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(xs,{children:[e.jsx(us,{children:c("common.cancel","取消")}),e.jsx(hs,{onClick:Ue,children:c("common.delete","删除")})]})]})}),s.post_type==="recipe"?e.jsx(Ns,{post:s,open:y,onOpenChange:E}):e.jsx(ws,{post:s,open:y,onOpenChange:E}),C&&Ze.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black overflow-hidden",onClick:n=>{n.target===n.currentTarget&&o(!1)},onWheel:n=>n.stopPropagation(),onTouchMove:n=>n.stopPropagation(),children:[s.image_urls&&s.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[u+1," / ",s.image_urls.length]}),e.jsx(j,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>o(!1),children:e.jsx(Ie,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(_e,{className:"w-full",opts:{loop:!0,startIndex:u},setApi:n=>{G(n),n&&n.on("select",()=>{p(n.selectedScrollSnap())})},children:e.jsx(ke,{className:"-ml-0",children:s.image_urls?.map((n,m)=>{const f=d[n],D=f?f.height/f.width>1.5:!1;return e.jsx(Te,{className:"pl-0 flex items-center justify-center",children:D?e.jsx("div",{className:"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain",onMouseDown:x=>{const F=x.currentTarget;i({y:x.clientY,scrollTop:F.scrollTop})},onMouseUp:x=>{if(r){const F=Math.abs(x.clientY-r.y),se=Math.abs(x.currentTarget.scrollTop-r.scrollTop);F<10&&se<10&&o(!1),i(null)}},onTouchStart:x=>{const F=x.currentTarget;i({y:x.touches[0].clientY,scrollTop:F.scrollTop})},onTouchEnd:x=>{if(r){const F=x.changedTouches[0],se=Math.abs(F.clientY-r.y),Be=Math.abs(x.currentTarget.scrollTop-r.scrollTop);se<15&&Be<15&&(x.preventDefault(),o(!1)),i(null)}},children:e.jsx("img",{src:n,alt:"",className:"block select-none",style:{width:"100vw",minHeight:"100dvh",height:"auto",margin:0},draggable:!1,onLoad:x=>X(x,n)})}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("img",{src:n,alt:"",className:"object-contain w-screen h-screen select-none cursor-pointer",draggable:!1,onClick:()=>o(!1),onLoad:x=>X(x,n)})})},m)})})})}),s.image_urls&&s.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>O?.scrollPrev(),children:e.jsx(De,{className:"h-8 w-8"})}),e.jsx(j,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>O?.scrollNext(),children:e.jsx(ze,{className:"h-8 w-8"})})]})]}),document.body),V]})},vs=({post:s,onStartCooking:$})=>{const{t,i18n:c}=Q(),{getLocalizedField:b}=he(),[S,v]=l.useState(null),[z,_]=l.useState(null),[A,k]=l.useState({}),[h,T]=l.useState(null),[y,E]=l.useState(!1),[I,M]=l.useState(!1),C=200,o=5,p=z||(()=>{const a={zh:"content_zh",en:"content_en",pt:"content_pt"}[c.language]||"content",r=s[a];return r&&typeof r=="string"&&r.trim()?r:s.content})(),N=S||b(s,"recipe_name")||s.recipe_name,P=()=>{const d=[];if(s.recipe_name&&d.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&d.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const a=s.ingredients.map(r=>r.name).join("|");d.push(`[INGREDIENTS]${a}`)}return d.join(`
---
`)},O=d=>{if(!d){v(null),_(null),k({});return}d.split(`
---
`).forEach(r=>{if(r.startsWith("[NAME]"))v(r.replace("[NAME]",""));else if(r.startsWith("[CONTENT]"))_(r.replace("[CONTENT]",""));else if(r.startsWith("[INGREDIENTS]")){const i=r.replace("[INGREDIENTS]","").split("|"),g={};i.forEach((w,R)=>{g[R]=w.trim()}),k(g)}})},G=()=>{switch(c.language){case"zh":return je;case"pt":return pe;default:return fe}},U=d=>{switch(d){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},W=d=>{switch(d){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return d}},H=s.image_urls&&s.image_urls.length>0,Y=s.steps&&s.steps.length>0;return e.jsxs(q,{className:"overflow-hidden",children:[H&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:N||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>T(s.image_urls[0])}),e.jsxs(L,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(de,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(ue,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(s.created_at),{addSuffix:!0,locale:G()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(Z,{text:P(),onTranslation:O,label:t("recipe.translateAll")})}),e.jsx("h2",{className:"text-xl font-bold",children:N}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(L,{variant:"outline",className:U(s.difficulty),children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),W(s.difficulty)]})]})]}),e.jsxs(K,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:y||(p||"").length<=C?p:(p||"").slice(0,C)+"..."}),(p||"").length>C&&e.jsxs(j,{variant:"ghost",size:"sm",className:"px-0 h-auto py-1 text-xs text-primary",onClick:()=>E(!y),children:[y?t("common.collapse","收起"):t("common.viewAll","查看全部"),y?e.jsx(ae,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-orange-500"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")}),e.jsx("span",{className:"w-16 text-center",children:t("recipe.link","链接")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:(I?s.ingredients:s.ingredients.slice(0,o)).map((d,a)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:A[a]||d.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[d.amount," ",d.unit]}),e.jsx("span",{className:"w-16 text-center shrink-0",children:d.link?e.jsx("a",{href:d.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center p-1 rounded-md text-primary hover:bg-primary/10 transition-colors",title:d.link,children:e.jsx($e,{className:"h-3.5 w-3.5"})}):e.jsx("span",{className:"text-xs text-muted-foreground/40",children:"—"})})]},a))}),s.ingredients.length>o&&e.jsxs(j,{variant:"ghost",size:"sm",className:"w-full mt-2 text-xs text-primary",onClick:()=>M(!I),children:[I?t("common.collapse","收起"):t("recipe.showAllIngredients",{count:s.ingredients.length}),I?e.jsx(ae,{className:"h-3 w-3 ml-1"}):e.jsx(te,{className:"h-3 w-3 ml-1"})]})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((d,a)=>e.jsxs(L,{variant:"secondary",className:"text-xs",children:["#",d]},a))}),Y&&e.jsxs(j,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:$,children:[e.jsx(ie,{className:"h-6 w-6"}),t("recipe.startCooking","开始烹饪"),e.jsxs(L,{variant:"secondary",className:"ml-2",children:[s.steps.length," ",t("recipe.stepsCount","步")]})]})]}),e.jsx(Ne,{imageUrl:h||"",isOpen:!!h,onClose:()=>T(null)})]})},ys=({steps:s,onExit:$})=>{const{t}=Q(),[c,b]=l.useState(0),[S,v]=l.useState({}),[z,_]=l.useState(null),A=[...s].sort((o,u)=>o.order-u.order),k=A.length,h=A[c],T=(c+1)/k*100,y=c===k-1,E=c===0,I=()=>{y||b(o=>o+1)},M=()=>{E||b(o=>o-1)},C=()=>{$()};return e.jsxs("div",{className:"flex flex-col h-full min-h-[60vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:$,children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:t("recipe.stepProgress","步骤 {{current}} / {{total}}",{current:c+1,total:k})}),e.jsx(Z,{text:A.map(o=>o.description).join(`
---
`),onTranslation:o=>{if(o){const u=o.split(`
---
`),p={};u.forEach((N,P)=>{p[P]=N}),v(p)}else v({})}})]}),e.jsx(bs,{value:T,className:"h-1 rounded-none"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg",children:h.order})}),(()=>{const o=h.image_urls&&h.image_urls.length>0?h.image_urls:h.image_url?[h.image_url]:[];return o.length>0&&e.jsx("div",{className:"mb-6 flex flex-wrap justify-center gap-2",children:o.map((u,p)=>e.jsx("img",{src:u,alt:`Step ${h.order} - ${p+1}`,className:`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${o.length===1?"max-w-[75%]":"w-[calc(50%-0.25rem)]"}`,onClick:()=>_(u)},p))})})(),e.jsx("p",{className:"text-lg leading-relaxed text-center",children:S[c]||h.description})]}),e.jsx("div",{className:"flex justify-center gap-1.5 py-3",children:A.map((o,u)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${u===c?"bg-primary w-6":u<c?"bg-primary/50":"bg-muted-foreground/30"}`,onClick:()=>b(u)},u))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-background",children:[e.jsxs(j,{variant:"outline",size:"lg",onClick:M,disabled:E,className:"gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),t("recipe.prevStep","上一步")]}),y?e.jsxs(j,{size:"lg",onClick:C,className:"gap-2",variant:"default",children:[e.jsx(ss,{className:"h-5 w-5"}),t("recipe.complete","完成")]}):e.jsxs(j,{size:"lg",onClick:I,className:"gap-2",children:[t("recipe.nextStep","下一步"),e.jsx(ze,{className:"h-5 w-5"})]})]}),e.jsx(Ne,{imageUrl:z||"",isOpen:!!z,onClose:()=>_(null)})]})},Rs=({post:s,showActions:$=!1})=>{const{t,i18n:c}=Q(),{getLocalizedField:b}=he(),[S,v]=l.useState("guided"),[z,_]=l.useState("overview"),[A,k]=l.useState(null),[h,T]=l.useState(null),[y,E]=l.useState({}),[I,M]=l.useState({}),[C,o]=l.useState(null);l.useRef(null);const u=l.useCallback(()=>{_("cooking"),requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"})})},[]),N=h||(()=>{const r={zh:"content_zh",en:"content_en",pt:"content_pt"}[c.language]||"content",i=s[r];return i&&typeof i=="string"&&i.trim()?i:s.content})(),P=A||b(s,"recipe_name")||s.recipe_name,O=()=>{const a=[];if(s.recipe_name&&a.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&a.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const r=s.ingredients.map(i=>i.name).join("|");a.push(`[INGREDIENTS]${r}`)}if(s.steps&&s.steps.length>0){const r=s.steps.sort((i,g)=>i.order-g.order).map(i=>i.description).join("|");a.push(`[STEPS]${r}`)}return a.join(`
---
`)},G=a=>{if(!a){k(null),T(null),E({}),M({});return}a.split(`
---
`).forEach(i=>{if(i.startsWith("[NAME]"))k(i.replace("[NAME]",""));else if(i.startsWith("[CONTENT]"))T(i.replace("[CONTENT]",""));else if(i.startsWith("[INGREDIENTS]")){const g=i.replace("[INGREDIENTS]","").split("|"),w={};g.forEach((R,V)=>{w[V]=R.trim()}),E(w)}else if(i.startsWith("[STEPS]")){const g=i.replace("[STEPS]","").split("|"),w={};g.forEach((R,V)=>{w[V]=R.trim()}),M(w)}})},U=()=>{switch(c.language){case"zh":return je;case"pt":return pe;default:return fe}},W=a=>{switch(a){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},H=a=>{switch(a){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return a}},Y=s.image_urls&&s.image_urls.length>0,d=s.steps&&s.steps.length>0;return S==="guided"&&z==="cooking"&&d?e.jsx(q,{className:"overflow-hidden",children:e.jsx(ys,{steps:s.steps,onExit:()=>_("overview")})}):S==="guided"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>v("guided"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>v("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsx(vs,{post:s,onStartCooking:u}),e.jsx(q,{children:e.jsx(K,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-6 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ne,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{v("guided"),_("overview")},className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(ie,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>v("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(Se,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsxs(q,{className:"overflow-hidden",children:[Y&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:P||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>o(s.image_urls[0])}),e.jsxs(L,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Ae,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(de,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(me,{className:"h-10 w-10",children:[e.jsx(xe,{src:s.author?.avatar_url||void 0}),e.jsx(ue,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ge(new Date(s.created_at),{addSuffix:!0,locale:U()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(Z,{text:O(),onTranslation:G,label:t("recipe.translateAllFull")})}),e.jsx("h2",{className:"text-xl font-bold",children:P}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(L,{variant:"outline",className:W(s.difficulty),children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),H(s.difficulty)]})]})]}),e.jsxs(K,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:N})}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(Pe,{className:"h-4 w-4 text-primary"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(ce,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:t("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:t("recipe.amount","用量")}),e.jsx("span",{className:"w-16 text-center",children:t("recipe.link","链接")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((a,r)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:y[r]||a.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[a.amount," ",a.unit]}),e.jsx("span",{className:"w-16 text-center shrink-0",children:a.link?e.jsx("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center p-1 rounded-md text-primary hover:bg-primary/10 transition-colors",title:a.link,children:e.jsx($e,{className:"h-3.5 w-3.5"})}):e.jsx("span",{className:"text-xs text-muted-foreground/40",children:"—"})})]},r))})]}),e.jsx(ce,{}),d&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.steps","步骤")," (",s.steps.length,")"]}),e.jsx("ol",{className:"space-y-4",children:s.steps.sort((a,r)=>a.order-r.order).map((a,r)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:a.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:I[r]||a.description}),(()=>{const i=a.image_urls&&a.image_urls.length>0?a.image_urls:a.image_url?[a.image_url]:[];return i.length>0&&e.jsx("div",{className:`flex gap-2 ${i.length===1?"":"flex-wrap"}`,children:i.map((g,w)=>e.jsx("img",{src:g,alt:`Step ${a.order} - ${w+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${i.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>o(g)},w))})})()]})]},r))})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((a,r)=>e.jsxs(L,{variant:"secondary",className:"text-xs",children:["#",a]},r))}),e.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(ne,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(re,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(le,{className:"h-4 w-4"}),s.shares_count||0]})]})]})]}),e.jsx(Ne,{imageUrl:C||"",isOpen:!!C,onClose:()=>o(null)})]})};export{$s as P,Rs as R};
//# sourceMappingURL=RecipeDetailContent-DjgkE_6O.js.map
