import{j as e,bB as Q,u as K,p as W,r as d,s as ee,bT as z,ak as se,el as D,bc as te,bn as ie,b4 as ae,cC as re,bh as ne,bG as ce,a$ as le,w as M}from"./vendor-react-DImbKuZP.js";import{S as x,u as oe,q as g,C as j,F as w,E as de,B as y,s as me}from"./index-_G3CuCzp.js";import{u as ue,R as pe,P as xe}from"./PublishConfirmStep-CGHgxQDO.js";import{S as _}from"./separator-8wE-3N0K.js";import{R as he}from"./RecipeCookingMode-B5DymqUo.js";import{u as fe}from"./useSavedRecipes-BgAf4HJl.js";import{u as ge}from"./useCreateRecipe-D3-oJXV2.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CRxszhSs.js";import"./xiaoxiong-logo-clean-D2n3VLi4.js";import"./useWatermarkedVideo-V-xLJRQT.js";import"./progress-Bi_ViBYA.js";import"./TranslateButton-P5tJRjUf.js";import"./ImagePreviewModal-CyiB2E01.js";const je=({showHeader:m=!0,showFilters:u=!0,children:i})=>e.jsxs("div",{className:"container mx-auto px-4 py-6 sm:py-8 animate-fade-in",children:[m&&e.jsxs("div",{className:"mb-6 sm:mb-8",children:[e.jsx(x,{className:"h-8 sm:h-10 w-48 mb-2"}),e.jsx(x,{className:"h-4 sm:h-5 w-72"})]}),u&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-6",children:[e.jsx(x,{className:"h-10 flex-1 max-w-md rounded-md"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{className:"h-10 w-28 rounded-md"}),e.jsx(x,{className:"h-10 w-24 rounded-md"})]})]}),i]}),Ue=()=>{const{id:m}=Q(),u=K(),{t:i,i18n:o}=W(),{user:T}=oe(),{deleteRecipe:U}=fe(),k=ge(),{uploadImage:A,verifyResultPhoto:E,isVerifying:F}=ue(),[p,C]=d.useState("guided"),[r,n]=d.useState("overview"),[h,O]=d.useState(""),[L,V]=d.useState(!1),[I,N]=d.useState(null),[J,R]=d.useState(!1),S=d.useRef(null),q=()=>{n("result")},B=(s,a)=>{O(s),V(a),a&&n("publish")},G=async s=>{if(!(!t||!h))try{await k.mutateAsync({recipe_name:t.recipe_name,subtitle:t.subtitle,cook_time:t.cook_time,difficulty:t.difficulty,servings:t.servings,ingredients:t.ingredients,steps:t.steps.map((a,l)=>({...a,order:l+1})),cover_image:h,introduction:s?.trim()||t.introduction,ai_recipe_source:{source:"saved_recipe",saved_recipe_id:m,result_image:h,photo_verified:L}}),M.success(i("aiRecipe.allPublished","é£Ÿè°±å·²å‘å¸ƒåˆ°ç¤¾åŒºï¼")),u("/community")}catch{}},P=()=>{n("overview"),M.success(i("aiRecipe.cookingComplete","å¤ªæ£’äº†ï¼çƒ¹é¥ªå®Œæˆï¼"))},{data:c,isLoading:X}=ee({queryKey:["saved-recipe",m],queryFn:async()=>{const{data:s,error:a}=await me.from("saved_recipes").select("*").eq("id",m).single();if(a)throw a;return s},enabled:!!m&&!!T});if(d.useEffect(()=>{if(!c)return;const s=c.recipe_data;if(s.image_url){N(s.image_url);return}if(S.current===c.recipe_name)return;S.current=c.recipe_name,R(!0),fetch("https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/ai-recipe/generate-images",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw"},body:JSON.stringify({recipes:[{recipe_name:s.recipe_name,recipe_name_en:s.recipe_name_en}]})}).then(l=>l.json()).then(l=>N(l.images?.[0]?.image_url??null)).catch(()=>N(null)).finally(()=>R(!1))},[c]),X)return e.jsx(je,{});if(!c)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[50vh] gap-4",children:[e.jsx("p",{className:"text-muted-foreground",children:i("aiRecipe.recipeNotFound","é£Ÿè°±æœªæ‰¾åˆ°")}),e.jsxs(g,{variant:"outline",onClick:()=>u("/profile"),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),i("common.back","è¿”å›")]})]});const t=c.recipe_data,b=()=>o.language==="en"&&t.recipe_name_en?t.recipe_name_en:o.language==="pt"&&t.recipe_name_pt?t.recipe_name_pt:t.recipe_name,H=s=>{switch(s){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},$=s=>{switch(s){case"easy":return i("recipe.difficulty.easy","ç®€å•");case"medium":return i("recipe.difficulty.medium","ä¸­ç­‰");case"hard":return i("recipe.difficulty.hard","å›°éš¾");default:return s}},f=t.steps?.map((s,a)=>({...s,order:s.order||a+1}))||[],v=f.length>0,Y=async()=>{try{await U(c.id),u("/profile")}catch{}},Z=()=>r==="result"?i("aiRecipe.resultPhotoTitle","æ‹æ‘„æˆå“"):r==="publish"?i("aiRecipe.confirmPublish","ç¡®è®¤å‘å¸ƒ"):c.recipe_name;return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"sticky top-14 z-10 bg-background border-b px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between max-w-lg mx-auto",children:[e.jsx("button",{onClick:()=>{r==="result"?n("cooking"):r==="publish"?n("result"):u(-1)},className:"p-1 -ml-1 hover:bg-muted rounded-md",children:e.jsx(z,{className:"h-5 w-5"})}),e.jsx("h2",{className:"font-medium text-sm line-clamp-1 flex-1 text-center mx-4",children:Z()}),r==="overview"?e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:Y,children:e.jsx(se,{className:"h-4 w-4"})}):e.jsx("div",{className:"w-8"})]})}),e.jsxs("div",{className:"max-w-lg mx-auto p-4",children:[r==="result"&&e.jsx(j,{className:"overflow-hidden",children:e.jsxs(w,{className:"pt-6",children:[e.jsx(pe,{onPhotoVerified:B,uploadImage:A,verifyPhoto:E,recipeName:t.recipe_name,isVerifying:F}),e.jsx("div",{className:"mt-4",children:e.jsx(g,{variant:"ghost",className:"w-full text-muted-foreground",onClick:P,children:i("aiRecipe.noThanks","æš‚æ—¶ä¸åˆ†äº«")})})]})}),r==="publish"&&h&&e.jsx(j,{className:"overflow-hidden",children:e.jsx(w,{className:"pt-6",children:e.jsx(xe,{resultImageUrl:h,recipeName:b(),onPublish:G,onSkip:P,isPublishing:k.isPending})})}),r==="cooking"&&p==="guided"&&v&&e.jsx(j,{className:"overflow-hidden",children:e.jsx(he,{steps:f,onExit:()=>n("overview"),onComplete:q})}),(r==="overview"||p==="full")&&r!=="result"&&r!=="publish"&&e.jsxs(e.Fragment,{children:[r!=="cooking"&&e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{C("guided"),n("overview")},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${p==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(D,{className:"h-4 w-4"}),i("recipe.guidedMode","æµç¨‹æ¨¡å¼")]}),e.jsxs("button",{onClick:()=>C("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${p==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(te,{className:"h-4 w-4"}),i("recipe.fullMode","å®Œæ•´æ¨¡å¼")]})]})}),e.jsxs(j,{className:"overflow-hidden",children:[e.jsx("div",{className:"relative w-full aspect-[16/9] bg-muted overflow-hidden",children:J?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-1.5 z-10",children:[e.jsx(ie,{className:"h-4 w-4 text-primary animate-pulse"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i("aiRecipe.generatingImage","AI æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...")})]})]}):I?e.jsx("img",{src:I,alt:b(),className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ae,{className:"h-10 w-10 text-muted-foreground/30"})})}),e.jsxs(de,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(y,{className:"bg-primary text-primary-foreground gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),i("recipe.badge","é£Ÿè°±")]})}),e.jsx("h2",{className:"text-xl font-bold",children:b()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[t.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.cook_time," ",i("recipe.minutes","åˆ†é’Ÿ")]})]}),t.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.servings," ",i("recipe.servingsUnit","äººä»½")]})]}),t.difficulty&&e.jsxs(y,{variant:"outline",className:H(t.difficulty),children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),$(t.difficulty)]})]})]}),e.jsxs(w,{className:"space-y-6",children:[(()=>{const s=o.language==="en"&&t.introduction_en?t.introduction_en:o.language==="pt"&&t.introduction_pt?t.introduction_pt:t.introduction;return s&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:s})})(),e.jsx(_,{}),t.ingredients&&t.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[i("recipe.ingredients","é£Ÿæ")," (",t.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:i("recipe.ingredientName","åç§°")}),e.jsx("span",{className:"w-24 text-right",children:i("recipe.amount","ç”¨é‡")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:t.ingredients.map((s,a)=>{const l=o.language==="en"&&s.name_en?s.name_en:o.language==="pt"&&s.name_pt?s.name_pt:s.name;return e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:l}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[s.amount," ",s.unit]})]},a)})})]}),p==="guided"&&v&&e.jsxs(g,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:()=>n("cooking"),children:[e.jsx(D,{className:"h-6 w-6"}),i("recipe.startCooking","å¼€å§‹çƒ¹é¥ª"),e.jsxs(y,{variant:"secondary",className:"ml-2",children:[f.length," ",i("recipe.stepsCount","æ­¥")]})]}),p==="full"&&v&&e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[i("recipe.steps","æ­¥éª¤")," (",f.length,")"]}),e.jsx("ol",{className:"space-y-4",children:f.map((s,a)=>{const l=o.language==="en"&&s.description_en?s.description_en:o.language==="pt"&&s.description_pt?s.description_pt:s.description;return e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:s.order}),e.jsx("p",{className:"text-sm flex-1",children:l})]},a)})})]}),e.jsx(_,{}),e.jsxs(g,{size:"lg",className:"w-full gap-2 h-14 text-base",onClick:()=>n("result"),children:["ğŸ‰ ",i("aiRecipe.finishAndShare","å®Œæˆå¹¶åˆ†äº«åˆ°ç¤¾åŒº")]})]})]})]})]})]})]})};export{Ue as default};
//# sourceMappingURL=SavedRecipeDetail-CK0DzRtd.js.map
