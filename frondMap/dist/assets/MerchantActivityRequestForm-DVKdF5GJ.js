import{b as W,u as T,j as e,P,g as M,e as me,a7 as he,a8 as je,a9 as Q,M as fe,d as ge,aa as _e,ab as ve}from"./vendor-ui-DAmPMpEA.js";import{r as o,u as be}from"./vendor-react-iAJ0IrSD.js";import{u as ye}from"./index.esm-CVRqJy9l.js";import{o as Ne,s as j,l as Re,e as we,t as Ce}from"./types-CpDVS0Ep.js";import{d as X,bi as Ie,y as Se,a2 as ke,bj as O,g as $,v as K,bd as Pe,B as k,aW as ze,t as Ee,T as Ae,i as Fe,aT as Ge,I as _,aR as E,az as A,a$ as Me,bk as De,L as Te,X as Ue,aM as Le,aN as qe,aO as Be,aP as Ve,aQ as F,aF as G,Q as H}from"./index-COqZhysY.js";import{F as Oe,a as u,b as x,c as f,d as p,e as m,f as $e}from"./form-B_84nLaY.js";import{u as Ke}from"./useActivityRequests-CU6YxpTv.js";import{u as He}from"./vendor-i18n-DxKeo2S1.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-BlSVl3IQ.js";import"./vendor-supabase-KNAP0qdW.js";var U="Radio",[We,J]=W(U),[Qe,Xe]=We(U),Y=o.forwardRef((t,i)=>{const{__scopeRadio:r,name:g,checked:a=!1,required:l,disabled:h,value:v="on",onCheck:N,form:R,...y}=t,[b,w]=o.useState(null),c=T(i,S=>w(S)),d=o.useRef(!1),I=b?R||!!b.closest("form"):!0;return e.jsxs(Qe,{scope:r,checked:a,disabled:h,children:[e.jsx(P.button,{type:"button",role:"radio","aria-checked":a,"data-state":re(a),"data-disabled":h?"":void 0,disabled:h,value:v,...y,ref:c,onClick:M(t.onClick,S=>{a||N?.(),I&&(d.current=S.isPropagationStopped(),d.current||S.stopPropagation())})}),I&&e.jsx(se,{control:b,bubbles:!d.current,name:g,value:v,checked:a,required:l,disabled:h,form:R,style:{transform:"translateX(-100%)"}})]})});Y.displayName=U;var Z="RadioIndicator",ee=o.forwardRef((t,i)=>{const{__scopeRadio:r,forceMount:g,...a}=t,l=Xe(Z,r);return e.jsx(me,{present:g||l.checked,children:e.jsx(P.span,{"data-state":re(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:i})})});ee.displayName=Z;var Je="RadioBubbleInput",se=o.forwardRef(({__scopeRadio:t,control:i,checked:r,bubbles:g=!0,...a},l)=>{const h=o.useRef(null),v=T(h,l),N=he(r),R=je(i);return o.useEffect(()=>{const y=h.current;if(!y)return;const b=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(b,"checked").set;if(N!==r&&c){const d=new Event("click",{bubbles:g});c.call(y,r),y.dispatchEvent(d)}},[N,r,g]),e.jsx(P.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...a,tabIndex:-1,ref:v,style:{...a.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});se.displayName=Je;function re(t){return t?"checked":"unchecked"}var Ye=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],z="RadioGroup",[Ze,fs]=W(z,[Q,J]),te=Q(),ae=J(),[es,ss]=Ze(z),oe=o.forwardRef((t,i)=>{const{__scopeRadioGroup:r,name:g,defaultValue:a,value:l,required:h=!1,disabled:v=!1,orientation:N,dir:R,loop:y=!0,onValueChange:b,...w}=t,c=te(r),d=fe(R),[I,S]=ge({prop:l,defaultProp:a??null,onChange:b,caller:z});return e.jsx(es,{scope:r,name:g,required:h,disabled:v,value:I,onValueChange:S,children:e.jsx(_e,{asChild:!0,...c,orientation:N,dir:d,loop:y,children:e.jsx(P.div,{role:"radiogroup","aria-required":h,"aria-orientation":N,"data-disabled":v?"":void 0,dir:d,...w,ref:i})})})});oe.displayName=z;var ne="RadioGroupItem",ie=o.forwardRef((t,i)=>{const{__scopeRadioGroup:r,disabled:g,...a}=t,l=ss(ne,r),h=l.disabled||g,v=te(r),N=ae(r),R=o.useRef(null),y=T(i,R),b=l.value===a.value,w=o.useRef(!1);return o.useEffect(()=>{const c=I=>{Ye.includes(I.key)&&(w.current=!0)},d=()=>w.current=!1;return document.addEventListener("keydown",c),document.addEventListener("keyup",d),()=>{document.removeEventListener("keydown",c),document.removeEventListener("keyup",d)}},[]),e.jsx(ve,{asChild:!0,...v,focusable:!h,active:b,children:e.jsx(Y,{disabled:h,required:l.required,checked:b,...N,...a,name:l.name,ref:y,onCheck:()=>l.onValueChange(a.value),onKeyDown:M(c=>{c.key==="Enter"&&c.preventDefault()}),onFocus:M(a.onFocus,()=>{w.current&&R.current?.click()})})})});ie.displayName=ne;var rs="RadioGroupIndicator",le=o.forwardRef((t,i)=>{const{__scopeRadioGroup:r,...g}=t,a=ae(r);return e.jsx(ee,{...a,...g,ref:i})});le.displayName=rs;var ce=oe,de=ie,ts=le;const ue=o.forwardRef(({className:t,...i},r)=>e.jsx(ce,{className:X("grid gap-2",t),...i,ref:r}));ue.displayName=ce.displayName;const D=o.forwardRef(({className:t,...i},r)=>e.jsx(de,{ref:r,className:X("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...i,children:e.jsx(ts,{className:"flex items-center justify-center",children:e.jsx(Ie,{className:"h-2.5 w-2.5 fill-current text-current"})})}));D.displayName=de.displayName;const as=Ne({title_zh:j().min(1,"中文标题不能为空"),title_en:j().min(1,"英文标题不能为空"),title_pt:j().min(1,"葡萄牙语标题不能为空"),intro_zh:j().optional(),intro_en:j().optional(),intro_pt:j().optional(),content_zh:j().min(1,"中文内容不能为空"),content_en:j().min(1,"英文内容不能为空"),content_pt:j().min(1,"葡萄牙语内容不能为空"),image_url:j().url().optional().or(Re("")),start_date:j().min(1,"开始日期不能为空"),end_date:j().optional(),service_type:we(["dine_in","takeaway","both"]),badge_text_zh:j().optional(),badge_text_en:j().optional(),badge_text_pt:j().optional(),badge_color:j().optional()}),gs=()=>{He();const t=be(),{user:i}=Se(),{isMerchant:r,isSupervisor:g}=ke(),a=Ke(),[l,h]=o.useState(!1),[v,N]=o.useState("upload"),[R,y]=o.useState(""),[b,w]=o.useState(!1),[c,d]=o.useState(""),I=o.useRef(null),S=async s=>{if(i){if(s.size>5*1024*1024){G({title:"图片太大",description:"图片大小不能超过5MB",variant:"destructive"});return}w(!0);try{const C=s.name.split(".").pop(),q=`activity-requests/${`${i.id}-${Date.now()}.${C}`}`,{error:B}=await H.storage.from("activity-images").upload(q,s);if(B)throw B;const{data:{publicUrl:V}}=H.storage.from("activity-images").getPublicUrl(q);y(V),d(V),G({title:"上传成功",description:"封面图片已上传"})}catch(C){console.error("Upload error:",C),G({title:"上传失败",description:"图片上传失败，请重试",variant:"destructive"})}finally{w(!1)}}},xe=s=>{const C=s.target.files?.[0];C&&S(C)},L=()=>{y(""),d(""),I.current&&(I.current.value="")},n=ye({resolver:Ce(as),defaultValues:{title_zh:"",title_en:"",title_pt:"",intro_zh:"",intro_en:"",intro_pt:"",content_zh:"",content_en:"",content_pt:"",image_url:"",start_date:new Date().toISOString().split("T")[0],end_date:"",service_type:"both",badge_text_zh:"",badge_text_en:"",badge_text_pt:"",badge_color:"#9b87f5"}});if(!i||!r&&!g)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(O,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx($,{children:e.jsxs(K,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Pe,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"无权访问"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"只有商家和主管可以申请创建活动"})]})})})]});const pe=async s=>{h(!0);try{const C=v==="upload"?R:s.image_url;await a.mutateAsync({title_zh:s.title_zh,title_en:s.title_en,title_pt:s.title_pt,intro_zh:s.intro_zh||null,intro_en:s.intro_en||null,intro_pt:s.intro_pt||null,content_zh:s.content_zh,content_en:s.content_en,content_pt:s.content_pt,image_url:C||null,start_date:s.start_date,end_date:s.end_date||null,service_type:s.service_type,badge_text_zh:s.badge_text_zh||null,badge_text_en:s.badge_text_en||null,badge_text_pt:s.badge_text_pt||null,badge_color:s.badge_color||"#9b87f5"}),t("/merchant/activity-requests")}finally{h(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(O,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>t("/merchant/activity-requests"),children:e.jsx(ze,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"申请创建活动"}),e.jsx("p",{className:"text-muted-foreground",children:"填写活动信息，提交后等待管理员审核"})]})]}),e.jsxs($,{children:[e.jsxs(Ee,{children:[e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),"活动信息"]}),e.jsx(Ge,{children:"请填写完整的活动信息，审核通过后将自动创建活动"})]}),e.jsx(K,{children:e.jsx(Oe,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(pe),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{control:n.control,name:"title_zh",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"中文标题 *"}),e.jsx(p,{children:e.jsx(_,{placeholder:"活动标题",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"title_en",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"英文标题 *"}),e.jsx(p,{children:e.jsx(_,{placeholder:"Activity Title",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"title_pt",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"葡萄牙语标题 *"}),e.jsx(p,{children:e.jsx(_,{placeholder:"Título da Atividade",...s})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{control:n.control,name:"intro_zh",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"中文简介"}),e.jsx(p,{children:e.jsx(_,{placeholder:"简短描述",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"intro_en",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"英文简介"}),e.jsx(p,{children:e.jsx(_,{placeholder:"Brief description",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"intro_pt",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"葡萄牙语简介"}),e.jsx(p,{children:e.jsx(_,{placeholder:"Descrição breve",...s})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{control:n.control,name:"content_zh",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"中文内容 *"}),e.jsx(p,{children:e.jsx(E,{placeholder:"详细描述",rows:5,...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"content_en",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"英文内容 *"}),e.jsx(p,{children:e.jsx(E,{placeholder:"Detailed description",rows:5,...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"content_pt",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"葡萄牙语内容 *"}),e.jsx(p,{children:e.jsx(E,{placeholder:"Descrição detalhada",rows:5,...s})}),e.jsx(m,{})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(A,{children:"封面图片"}),e.jsxs(ue,{value:v,onValueChange:s=>{N(s),s==="url"?L():(n.setValue("image_url",""),d(""))},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"upload",id:"upload"}),e.jsxs(A,{htmlFor:"upload",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Me,{className:"h-4 w-4"}),"上传图片"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"url",id:"url"}),e.jsxs(A,{htmlFor:"url",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(De,{className:"h-4 w-4"}),"图片URL"]})]})]}),v==="upload"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{ref:I,type:"file",accept:"image/*",onChange:xe,disabled:b,className:"flex-1"}),b&&e.jsx(Te,{className:"h-4 w-4 animate-spin"})]}),c&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:c,alt:"Preview",className:"max-h-32 rounded-md border"}),e.jsx(k,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:L,children:e.jsx(Ue,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"支持 JPG、PNG、WebP 格式，最大 5MB"})]}):e.jsx(u,{control:n.control,name:"image_url",render:({field:s})=>e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(_,{placeholder:"https://example.com/image.jpg",...s,onChange:C=>{s.onChange(C),d(C.target.value)}})}),c&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:c,alt:"Preview",className:"max-h-32 rounded-md border",onError:()=>d("")})}),e.jsx(m,{})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{})," ",e.jsx(u,{control:n.control,name:"service_type",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"服务类型 *"}),e.jsxs(Le,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(p,{children:e.jsx(qe,{children:e.jsx(Be,{placeholder:"选择服务类型"})})}),e.jsxs(Ve,{children:[e.jsx(F,{value:"dine_in",children:"堂食"}),e.jsx(F,{value:"takeaway",children:"外卖"}),e.jsx(F,{value:"both",children:"堂食+外卖"})]})]}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(u,{control:n.control,name:"start_date",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"开始日期 *"}),e.jsx(p,{children:e.jsx(_,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"end_date",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"结束日期"}),e.jsx(p,{children:e.jsx(_,{type:"date",...s})}),e.jsx($e,{children:"留空表示无限期"}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(u,{control:n.control,name:"badge_text_zh",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"中文徽章"}),e.jsx(p,{children:e.jsx(_,{placeholder:"新活动",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"badge_text_en",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"英文徽章"}),e.jsx(p,{children:e.jsx(_,{placeholder:"New",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"badge_text_pt",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"葡萄牙语徽章"}),e.jsx(p,{children:e.jsx(_,{placeholder:"Novo",...s})}),e.jsx(m,{})]})}),e.jsx(u,{control:n.control,name:"badge_color",render:({field:s})=>e.jsxs(x,{children:[e.jsx(f,{children:"徽章颜色"}),e.jsx(p,{children:e.jsx(_,{type:"color",...s})}),e.jsx(m,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>t("/merchant/activity-requests"),disabled:l,children:"取消"}),e.jsx(k,{type:"submit",disabled:l,children:l?"提交中...":"提交申请"})]})]})})})]})]})})]})};export{gs as default};
//# sourceMappingURL=MerchantActivityRequestForm-DVKdF5GJ.js.map
