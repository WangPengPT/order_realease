import{r as a,cf as N,j as t,X as k,p as I,aM as M,dH as Y,dI as E,w as v}from"./vendor-react-DrIUZWbh.js";import{h as L,s as C}from"./index-DBaPCe8F.js";const B=({imageUrl:d,isOpen:f,onClose:u})=>{const[h,r]=a.useState(!1),[m,x]=a.useState(!1),[n,p]=a.useState(null),o=a.useRef(null);a.useEffect(()=>{if(f){const e=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${e}px`,document.body.style.left="0",document.body.style.right="0",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.style.overflow="",window.scrollTo(0,e)}}},[f]),a.useEffect(()=>{r(!1),x(!1)},[d]);const y=e=>{const c=e.currentTarget,i=c.naturalHeight/c.naturalWidth;r(i>1.5),x(!0)},g=e=>{e.target===e.currentTarget&&u()},w=e=>{if(!n)return;const c=e.changedTouches[0],i=Math.abs(c.clientY-n.y),s=o.current,b=s?Math.abs(s.scrollTop-n.scrollTop):0;i<15&&b<15&&(e.preventDefault(),u()),p(null)};return f?N.createPortal(t.jsxs("div",{className:"fixed inset-0 z-[100] bg-black",style:{left:0,right:0,top:0,bottom:0,width:"100vw",height:"100dvh",overflow:"hidden",margin:0,padding:0},children:[t.jsx(L,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:u,children:t.jsx(k,{className:"h-6 w-6"})}),t.jsxs("div",{ref:o,className:"w-full h-full overflow-x-hidden overscroll-contain",style:{overflowY:h?"scroll":"hidden",WebkitOverflowScrolling:"touch"},onClick:g,onTouchStart:e=>{p({y:e.touches[0].clientY,scrollTop:o.current?.scrollTop||0})},onTouchEnd:w,onMouseDown:e=>{p({y:e.clientY,scrollTop:o.current?.scrollTop||0})},onMouseUp:e=>{if(n){const c=Math.abs(e.clientY-n.y),i=o.current,s=i?Math.abs(i.scrollTop-n.scrollTop):0;c<10&&s<10&&u(),p(null)}},children:[!m&&t.jsx("img",{src:d,alt:"",onLoad:y,style:{position:"absolute",opacity:0,pointerEvents:"none"}}),m&&(h?t.jsx("img",{src:d,alt:"",draggable:!1,className:"block select-none",style:{width:"100vw",minWidth:"100vw",minHeight:"100dvh",height:"auto",margin:0,objectFit:"cover",objectPosition:"top center"}}):t.jsx("div",{className:"w-full h-full flex items-center justify-center",onClick:u,children:t.jsx("img",{src:d,alt:"",draggable:!1,className:"max-w-full max-h-full object-contain select-none"})}))]})]}),document.body):null},S=new Map,F=({text:d,className:f,label:u,onTranslation:h})=>{const{t:r,i18n:m}=I(),[x,n]=a.useState(!1),[p,o]=a.useState(null),[y,g]=a.useState(!1),[w,e]=a.useState(null),c=m.language;w&&w!==c&&y&&(g(!1),o(null),h?.(null));const i=async()=>{const s=m.language,b=`${d.substring(0,100)}_${s}`;if(y&&w===s){g(!1),h?.(null);return}const T=S.get(b);if(T){o(T),g(!0),e(s),h?.(T);return}n(!0),console.log("[TranslateButton] Calling translate-content with targetLang:",s);try{const{data:l,error:j}=await C.functions.invoke("translate-content",{body:{text:d,targetLang:s}});if(console.log("[TranslateButton] Response:",l,j),j){console.error("Translation error:",j),v.error(r("translate.error","翻译失败，请稍后重试"));return}l?.translatedText?(S.set(b,l.translatedText),o(l.translatedText),g(!0),e(s),h?.(l.translatedText)):l?.error&&v.error(l.error)}catch(l){console.error("Translation error:",l),v.error(r("translate.error","翻译失败，请稍后重试"))}finally{n(!1)}};return t.jsx(L,{variant:"ghost",size:"sm",className:`gap-1.5 h-auto py-1 px-2 text-xs text-muted-foreground hover:text-foreground ${f||""}`,onClick:i,disabled:x,children:x?t.jsxs(t.Fragment,{children:[t.jsx(M,{className:"h-3 w-3 animate-spin"}),t.jsx("span",{children:r("translate.translating","翻译中...")})]}):y?t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"h-3 w-3"}),t.jsx("span",{children:r("translate.showOriginal","显示原文")})]}):t.jsxs(t.Fragment,{children:[t.jsx(E,{className:"h-3 w-3"}),t.jsx("span",{children:u||r("translate.button","翻译")})]})})};export{B as I,F as T};
//# sourceMappingURL=TranslateButton-C8PbeOHN.js.map
