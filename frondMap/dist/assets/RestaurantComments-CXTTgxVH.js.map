{"version":3,"file":"RestaurantComments-CXTTgxVH.js","sources":["../../src/components/TranslateButton.tsx","../../src/components/TranslatableText.tsx","../../src/components/ImagePreviewModal.tsx","../../src/components/RestaurantComments.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Languages, Loader2, RotateCcw } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface TranslateButtonProps {\r\n  text: string;\r\n  className?: string;\r\n  onTranslation?: (translatedText: string | null) => void;\r\n}\r\n\r\n// Simple cache to store translations and avoid repeated API calls\r\nconst translationCache = new Map<string, string>();\r\n\r\nconst TranslateButton = ({ text, className, onTranslation }: TranslateButtonProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [isTranslating, setIsTranslating] = useState(false);\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n  const [showTranslation, setShowTranslation] = useState(false);\r\n  const [lastTranslatedLang, setLastTranslatedLang] = useState<string | null>(null);\r\n\r\n  // Reset translation when language changes\r\n  const currentLang = i18n.language;\r\n  \r\n  // If language changed and we have a translation, reset it\r\n  if (lastTranslatedLang && lastTranslatedLang !== currentLang && showTranslation) {\r\n    setShowTranslation(false);\r\n    setTranslatedText(null);\r\n    onTranslation?.(null);\r\n  }\r\n\r\n  const handleTranslate = async () => {\r\n    // Get current language at call time, not render time\r\n    const targetLang = i18n.language;\r\n    const cacheKey = `${text.substring(0, 100)}_${targetLang}`;\r\n    \r\n    // If already showing translation for the same language, toggle back to original\r\n    if (showTranslation && lastTranslatedLang === targetLang) {\r\n      setShowTranslation(false);\r\n      onTranslation?.(null);\r\n      return;\r\n    }\r\n\r\n    // Check global cache\r\n    const cached = translationCache.get(cacheKey);\r\n    if (cached) {\r\n      setTranslatedText(cached);\r\n      setShowTranslation(true);\r\n      setLastTranslatedLang(targetLang);\r\n      onTranslation?.(cached);\r\n      return;\r\n    }\r\n\r\n    // Call translation API\r\n    setIsTranslating(true);\r\n    console.log('[TranslateButton] Calling translate-content with targetLang:', targetLang);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke('translate-content', {\r\n        body: { text, targetLang }\r\n      });\r\n      console.log('[TranslateButton] Response:', data, error);\r\n\r\n      if (error) {\r\n        console.error('Translation error:', error);\r\n        toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n        return;\r\n      }\r\n\r\n      if (data?.translatedText) {\r\n        // Store in cache\r\n        translationCache.set(cacheKey, data.translatedText);\r\n        setTranslatedText(data.translatedText);\r\n        setShowTranslation(true);\r\n        setLastTranslatedLang(targetLang);\r\n        onTranslation?.(data.translatedText);\r\n      } else if (data?.error) {\r\n        toast.error(data.error);\r\n      }\r\n    } catch (err) {\r\n      console.error('Translation error:', err);\r\n      toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n    } finally {\r\n      setIsTranslating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"sm\"\r\n      className={`gap-1.5 h-auto py-1 px-2 text-xs text-muted-foreground hover:text-foreground ${className || ''}`}\r\n      onClick={handleTranslate}\r\n      disabled={isTranslating}\r\n    >\r\n      {isTranslating ? (\r\n        <>\r\n          <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n          <span>{t(\"translate.translating\", \"翻译中...\")}</span>\r\n        </>\r\n      ) : showTranslation ? (\r\n        <>\r\n          <RotateCcw className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.showOriginal\", \"显示原文\")}</span>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <Languages className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.button\", \"翻译\")}</span>\r\n        </>\r\n      )}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default TranslateButton;\r\n","import { useState } from \"react\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\n\r\ninterface TranslatableTextProps {\r\n  text: string;\r\n  className?: string;\r\n}\r\n\r\nconst TranslatableText = ({ text, className }: TranslatableTextProps) => {\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <p className=\"text-xs sm:text-sm text-foreground break-words\">\r\n        {translatedText || text}\r\n      </p>\r\n      <TranslateButton \r\n        text={text} \r\n        onTranslation={setTranslatedText}\r\n        className=\"mt-0.5\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TranslatableText;\r\n","import { useState, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface ImagePreviewModalProps {\r\n  imageUrl: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst ImagePreviewModal = ({ imageUrl, isOpen, onClose }: ImagePreviewModalProps) => {\r\n  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\r\n  const [scrollStart, setScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      const scrollY = window.scrollY;\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const img = e.currentTarget;\r\n    setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\r\n  };\r\n\r\n  const isLongImage = imageDimensions ? imageDimensions.height / imageDimensions.width > 1.5 : false;\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return createPortal(\r\n    <div \r\n      className=\"fixed inset-0 z-[100] bg-black overflow-hidden\"\r\n      onClick={(e) => {\r\n        if (e.target === e.currentTarget) {\r\n          onClose();\r\n        }\r\n      }}\r\n      onWheel={(e) => e.stopPropagation()}\r\n      onTouchMove={(e) => e.stopPropagation()}\r\n    >\r\n      {/* Close Button */}\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n        onClick={onClose}\r\n      >\r\n        <X className=\"h-6 w-6\" />\r\n      </Button>\r\n\r\n      {/* Image Container */}\r\n      <div className=\"absolute inset-0 flex items-center justify-center\">\r\n        {isLongImage ? (\r\n          // Long image - scrollable\r\n          <div \r\n            className=\"w-full h-screen overflow-y-auto overscroll-contain\"\r\n            onMouseDown={(e) => {\r\n              const target = e.currentTarget;\r\n              setScrollStart({ y: e.clientY, scrollTop: target.scrollTop });\r\n            }}\r\n            onMouseUp={(e) => {\r\n              if (scrollStart) {\r\n                const deltaY = Math.abs(e.clientY - scrollStart.y);\r\n                const deltaScroll = Math.abs(e.currentTarget.scrollTop - scrollStart.scrollTop);\r\n                if (deltaY < 10 && deltaScroll < 10) {\r\n                  onClose();\r\n                }\r\n                setScrollStart(null);\r\n              }\r\n            }}\r\n            onTouchStart={(e) => {\r\n              const target = e.currentTarget;\r\n              setScrollStart({ y: e.touches[0].clientY, scrollTop: target.scrollTop });\r\n            }}\r\n            onTouchEnd={(e) => {\r\n              if (scrollStart) {\r\n                const touch = e.changedTouches[0];\r\n                const deltaY = Math.abs(touch.clientY - scrollStart.y);\r\n                const deltaScroll = Math.abs(e.currentTarget.scrollTop - scrollStart.scrollTop);\r\n                if (deltaY < 15 && deltaScroll < 15) {\r\n                  e.preventDefault();\r\n                  onClose();\r\n                }\r\n                setScrollStart(null);\r\n              }\r\n            }}\r\n          >\r\n            <div className=\"min-h-full flex flex-col items-center py-4\">\r\n              <img\r\n                src={imageUrl}\r\n                alt=\"\"\r\n                className=\"w-full max-w-[90vw] h-auto object-contain select-none pointer-events-none\"\r\n                draggable={false}\r\n                onLoad={handleImageLoad}\r\n              />\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          // Normal image - click to close\r\n          <div className=\"w-full h-full flex items-center justify-center\">\r\n            <img\r\n              src={imageUrl}\r\n              alt=\"\"\r\n              className=\"object-contain w-screen h-screen select-none cursor-pointer\"\r\n              draggable={false}\r\n              onClick={onClose}\r\n              onLoad={handleImageLoad}\r\n            />\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nexport default ImagePreviewModal;\r\n","import { useState, useCallback, useMemo, memo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useComments, useAddComment, useDeleteComment, Comment } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useCheckSensitiveWords } from \"@/hooks/useSensitiveWords\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { MessageSquare, Trash2, Reply, Image as ImageIcon, X, Star, DollarSign, ShieldAlert, VolumeX, Clock, AlertCircle } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RestaurantCommentsProps {\r\n  restaurantId?: string;\r\n  targetId?: string;\r\n  targetType?: \"restaurant\" | \"activity\" | \"post\";\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\n// Component for comment image with long image detection\r\nconst CommentImage = memo(({ imageUrl, onPreview }: { imageUrl: string; onPreview: () => void }) => {\r\n  const { t } = useTranslation();\r\n  const [isLongImage, setIsLongImage] = useState(false);\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n\r\n  const handleImageLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const img = e.currentTarget;\r\n    const aspectRatio = img.naturalHeight / img.naturalWidth;\r\n    setIsLongImage(aspectRatio > 1.5);\r\n    setImageLoaded(true);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"relative mt-2 inline-block max-w-full sm:max-w-sm w-full\">\r\n      <img\r\n        src={imageUrl}\r\n        alt=\"Comment attachment\"\r\n        className=\"rounded-lg w-full max-h-[300px] sm:max-h-[400px] object-cover object-top cursor-pointer hover:opacity-90 transition-opacity\"\r\n        onClick={onPreview}\r\n        onLoad={handleImageLoad}\r\n      />\r\n      {imageLoaded && isLongImage && (\r\n        <Badge \r\n          variant=\"secondary\" \r\n          className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-1.5 py-0.5\"\r\n        >\r\n          {t(\"community.longImage\", \"长图\")}\r\n        </Badge>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCommentImage.displayName = \"CommentImage\";\r\n\r\nconst RestaurantComments = ({ restaurantId, targetId, targetType = \"restaurant\" }: RestaurantCommentsProps) => {\r\n  // Support both old prop name (restaurantId) and new prop name (targetId)\r\n  const actualTargetId = targetId || restaurantId || \"\";\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { data: profile } = useProfile();\r\n  const { isAdmin } = useUserRole();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [priceRange, setPriceRange] = useState(\"\");\r\n  const [replyTo, setReplyTo] = useState<string | null>(null);\r\n  const [replyContent, setReplyContent] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState<File | null>(null);\r\n  const [commentImagePreview, setCommentImagePreview] = useState<string | null>(null);\r\n  const [replyImage, setReplyImage] = useState<File | null>(null);\r\n  const [replyImagePreview, setReplyImagePreview] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n\r\n  const { data: comments, isLoading } = useComments(actualTargetId, targetType);\r\n  const addComment = useAddComment();\r\n  const deleteComment = useDeleteComment();\r\n  const { checkContent } = useCheckSensitiveWords();\r\n\r\n  const uploadImage = useCallback(async (file: File): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from(\"comment-images\")\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"comment-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.imageUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return null;\r\n    }\r\n  }, [user, toast, t]);\r\n\r\n  const handleImageSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, isReply: boolean = false) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"restaurant.imageTooLarge\"),\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (isReply) {\r\n        setReplyImage(file);\r\n        setReplyImagePreview(URL.createObjectURL(file));\r\n      } else {\r\n        setCommentImage(file);\r\n        setCommentImagePreview(URL.createObjectURL(file));\r\n      }\r\n    }\r\n  }, [toast, t]);\r\n\r\n  const clearImage = useCallback((isReply: boolean = false) => {\r\n    if (isReply) {\r\n      setReplyImage(null);\r\n      setReplyImagePreview(null);\r\n    } else {\r\n      setCommentImage(null);\r\n      setCommentImagePreview(null);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmitComment = useCallback(async () => {\r\n    if (!newComment.trim() || !user) return;\r\n    \r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(newComment);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // For restaurant comments, require rating\r\n    if (targetType === \"restaurant\" && !rating) {\r\n      toast({\r\n        title: t(\"common.hint\", \"提示\"),\r\n        description: t(\"toast.pleaseSelectRating\"),\r\n        variant: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (commentImage) {\r\n      const uploadedUrl = await uploadImage(commentImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: newComment,\r\n      ratingValue: targetType === \"restaurant\" ? rating : undefined,\r\n      priceRange: targetType === \"restaurant\" && priceRange ? priceRange : undefined,\r\n      imageUrl,\r\n    });\r\n\r\n    setNewComment(\"\");\r\n    setRating(0);\r\n    setPriceRange(\"\");\r\n    setCommentImage(null);\r\n    setCommentImagePreview(null);\r\n    setUploading(false);\r\n  }, [newComment, user, profile, targetType, rating, toast, t, commentImage, uploadImage, addComment, restaurantId, priceRange, checkContent]);\r\n\r\n  const handleSubmitReply = useCallback(async (parentId: string) => {\r\n    if (!replyContent.trim() || !user) return;\r\n\r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(replyContent);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (replyImage) {\r\n      const uploadedUrl = await uploadImage(replyImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: replyContent,\r\n      parentId,\r\n      imageUrl,\r\n    });\r\n\r\n    setReplyContent(\"\");\r\n    setReplyTo(null);\r\n    setReplyImage(null);\r\n    setReplyImagePreview(null);\r\n    setUploading(false);\r\n  }, [replyContent, user, profile, replyImage, uploadImage, addComment, restaurantId, targetType, checkContent, toast, t]);\r\n\r\n  const handleDeleteComment = useCallback(async (commentId: string) => {\r\n    await deleteComment.mutateAsync(commentId);\r\n    setDeleteConfirmId(null);\r\n  }, [deleteComment]);\r\n\r\n  const CommentItem = memo(({ comment, isReply = false }: { comment: Comment; isReply?: boolean }) => (\r\n    <div className={`flex gap-2 sm:gap-3 ${isReply ? \"ml-8 sm:ml-12 mt-3\" : \"\"}`}>\r\n      <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n        <AvatarImage src={comment.profiles?.avatar_url} />\r\n        <AvatarFallback className=\"text-xs sm:text-sm\">\r\n          {comment.profiles?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n        </AvatarFallback>\r\n      </Avatar>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-semibold text-xs sm:text-sm truncate\">{comment.profiles?.display_name}</span>\r\n          <span className=\"text-xs text-muted-foreground shrink-0\">\r\n            {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true })}\r\n          </span>\r\n          {comment.edited && (\r\n            <span className=\"text-xs text-muted-foreground italic\">({t(\"restaurant.edited\")})</span>\r\n          )}\r\n          {/* Show moderation status badges for user's own comments */}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"pending\" && (\r\n            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs py-0 h-5\">\r\n              <Clock className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentPending\", \"审核中\")}\r\n            </Badge>\r\n          )}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"flagged\" && (\r\n            <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs py-0 h-5\">\r\n              <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentFailed\", \"发送失败\")}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Display rating and price range for main comments */}\r\n        {!isReply && comment.rating_value && (\r\n          <div className=\"flex items-center gap-3 mt-1 mb-2\">\r\n            <div className=\"flex items-center gap-1\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-4 h-4\",\r\n                    star <= comment.rating_value!\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            {comment.price_range && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <DollarSign className=\"w-3 h-3\" />\r\n                <span>{priceRanges.find(r => r.value === comment.price_range)?.label}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        <TranslatableText text={comment.content} className=\"mt-1\" />\r\n        {comment.image_url && (\r\n          <CommentImage \r\n            imageUrl={comment.image_url} \r\n            onPreview={() => setPreviewImageUrl(comment.image_url!)} \r\n          />\r\n        )}\r\n        <div className=\"flex gap-2 sm:gap-3 mt-2\">\r\n          {!isReply && user && !profile?.is_muted && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setReplyTo(comment.id)}\r\n              className=\"h-7 text-xs px-2 sm:px-3\"\r\n            >\r\n              <Reply className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"restaurant.reply\")}</span>\r\n            </Button>\r\n          )}\r\n          {(user?.id === comment.user_id || isAdmin) && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setDeleteConfirmId(comment.id)}\r\n              className=\"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"common.delete\")}</span>\r\n            </Button>\r\n          )}\r\n          {user?.id !== comment.user_id && (\r\n            <ReportDialog\r\n              targetType=\"comment\"\r\n              targetId={comment.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-7 text-xs px-2 sm:px-3\"\r\n                >\r\n                  <ShieldAlert className=\"w-3 h-3 mr-1\" />\r\n                  <span className=\"hidden xs:inline\">{t(\"report.title\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {replyTo === comment.id && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-col sm:flex-row gap-2\">\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeReply\")}\r\n                  className=\"min-h-[80px] text-sm\"\r\n                />\r\n                  {replyImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={replyImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(replyImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(true)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex sm:flex-col gap-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleSubmitReply(comment.id)}\r\n                  disabled={!replyContent.trim() || uploading}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {uploading ? t(\"common.loading\") : t(\"restaurant.reply\")}\r\n                </Button>\r\n                <Input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => handleImageSelect(e, true)}\r\n                  className=\"hidden\"\r\n                  id={`reply-image-${comment.id}`}\r\n                  disabled={uploading}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => document.getElementById(`reply-image-${comment.id}`)?.click()}\r\n                  disabled={uploading}\r\n                  className=\"text-xs sm:px-3\"\r\n                >\r\n                  <ImageIcon className=\"h-4 w-4 sm:mr-1\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setReplyTo(null);\r\n                    setReplyContent(\"\");\r\n                    clearImage(true);\r\n                  }}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {comment.replies && comment.replies.length > 0 && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            {comment.replies.map((reply) => (\r\n              <CommentItem key={reply.id} comment={reply} isReply />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  ));\r\n  CommentItem.displayName = \"CommentItem\";\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <MessageSquare className=\"w-4 sm:w-5 h-4 sm:h-5\" />\r\n        <h2 className=\"text-xl sm:text-2xl font-bold\">\r\n          {t(\"restaurant.reviews\")} ({comments?.length || 0})\r\n        </h2>\r\n      </div>\r\n\r\n      {user ? (\r\n        profile?.is_muted ? (\r\n          <Card className=\"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20\">\r\n            <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6\">\r\n              <div className=\"flex items-center gap-3 text-yellow-600 dark:text-yellow-400\">\r\n                <VolumeX className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-sm font-medium\">{t(\"restaurant.youAreMutedNotice\")}</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n        <Card>\r\n          <CardContent className=\"pt-4 sm:pt-6 px-3 sm:px-6\">\r\n            <div className=\"flex gap-2 sm:gap-3\">\r\n              <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n                <AvatarImage src={profile?.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-xs sm:text-sm\">\r\n                  {profile?.display_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1 space-y-2 sm:space-y-3 min-w-0\">\r\n                {/* Rating and Price Range - Only for restaurant */}\r\n                {targetType === \"restaurant\" && (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Star className=\"w-4 h-4 text-accent\" />\r\n                        评分 <span className=\"text-destructive\">*</span>\r\n                      </label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onMouseEnter={() => setHoverRating(star)}\r\n                            onMouseLeave={() => setHoverRating(0)}\r\n                            onClick={() => setRating(star)}\r\n                            className=\"transition-transform hover:scale-110\"\r\n                          >\r\n                            <Star\r\n                              className={cn(\r\n                                \"w-7 h-7 cursor-pointer transition-colors\",\r\n                                star <= (hoverRating || rating)\r\n                                  ? \"fill-accent text-accent\"\r\n                                  : \"text-muted-foreground hover:text-accent\"\r\n                              )}\r\n                            />\r\n                          </button>\r\n                        ))}\r\n                        {rating > 0 && (\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">\r\n                            ({rating}/5)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <DollarSign className=\"w-4 h-4\" />\r\n                        {t(\"restaurant.priceRange\")}\r\n                      </label>\r\n                      <Select value={priceRange} onValueChange={setPriceRange}>\r\n                        <SelectTrigger className=\"w-full\">\r\n                          <SelectValue placeholder={t(\"restaurant.selectPriceRange\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-background\">\r\n                          {priceRanges.map((range) => (\r\n                            <SelectItem key={range.value} value={range.value}>\r\n                              {range.label}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Textarea\r\n                  value={newComment}\r\n                  onChange={(e) => setNewComment(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeComment\")}\r\n                  className=\"min-h-[80px] sm:min-h-[100px] text-sm\"\r\n                />\r\n                {commentImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={commentImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(commentImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(false)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => handleImageSelect(e, false)}\r\n                    className=\"hidden\"\r\n                    id=\"comment-image\"\r\n                    disabled={uploading}\r\n                  />\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => document.getElementById(\"comment-image\")?.click()}\r\n                    disabled={uploading}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    <ImageIcon className=\"h-4 w-4 sm:mr-2\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmitComment}\r\n                    disabled={!newComment.trim() || addComment.isPending || uploading}\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                  >\r\n                    {uploading || addComment.isPending ? t(\"common.loading\") : t(\"restaurant.postComment\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.signInToComment\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <div className=\"space-y-4 sm:space-y-6\">\r\n        {comments?.map((comment) => (\r\n          <Card key={comment.id}>\r\n            <CardHeader className=\"p-3 sm:p-6\">\r\n              <CommentItem comment={comment} />\r\n            </CardHeader>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {comments?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.noComments\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n\r\n    {/* Login Required Dialog */}\r\n    <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {t(\"activities.loginRequiredMessage\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n          <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n            {t(\"activities.goToLogin\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n\r\n    {/* Delete Comment Confirmation Dialog */}\r\n    <AlertDialog open={!!deleteConfirmId} onOpenChange={(open) => !open && setDeleteConfirmId(null)}>\r\n      <AlertDialogContent className=\"max-w-sm\">\r\n        <AlertDialogHeader>\r\n          <div className=\"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-destructive/10\">\r\n            <Trash2 className=\"h-7 w-7 text-destructive\" />\r\n          </div>\r\n          <AlertDialogTitle className=\"text-center\">\r\n            {t(\"restaurant.deleteComment\")}\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-center\">\r\n            {t(\"restaurant.confirmDelete\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter className=\"sm:justify-center gap-2\">\r\n          <AlertDialogCancel className=\"sm:w-24\">\r\n            {t(\"common.cancel\")}\r\n          </AlertDialogCancel>\r\n          <AlertDialogAction\r\n            onClick={() => deleteConfirmId && handleDeleteComment(deleteConfirmId)}\r\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90 sm:w-24\"\r\n          >\r\n            {t(\"common.delete\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n    \r\n    {/* Image Preview Modal */}\r\n    <ImagePreviewModal\r\n      imageUrl={previewImageUrl || \"\"}\r\n      isOpen={!!previewImageUrl}\r\n      onClose={() => setPreviewImageUrl(null)}\r\n    />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RestaurantComments;\r\n"],"names":["translationCache","TranslateButton","text","className","onTranslation","t","i18n","useTranslation","isTranslating","setIsTranslating","useState","translatedText","setTranslatedText","showTranslation","setShowTranslation","lastTranslatedLang","setLastTranslatedLang","currentLang","handleTranslate","targetLang","cacheKey","cached","data","error","supabase","toast","err","jsx","Button","jsxs","Fragment","Loader2","RotateCcw","Languages","TranslatableText","ImagePreviewModal","imageUrl","isOpen","onClose","imageDimensions","setImageDimensions","scrollStart","setScrollStart","useEffect","scrollY","handleImageLoad","e","img","isLongImage","createPortal","X","target","deltaY","deltaScroll","touch","priceRanges","CommentImage","memo","onPreview","setIsLongImage","imageLoaded","setImageLoaded","useCallback","aspectRatio","Badge","RestaurantComments","restaurantId","targetId","targetType","actualTargetId","user","useAuth","profile","useProfile","isAdmin","useUserRole","useToast","navigate","useNavigate","newComment","setNewComment","rating","setRating","hoverRating","setHoverRating","priceRange","setPriceRange","replyTo","setReplyTo","replyContent","setReplyContent","commentImage","setCommentImage","commentImagePreview","setCommentImagePreview","replyImage","setReplyImage","replyImagePreview","setReplyImagePreview","uploading","setUploading","showLoginDialog","setShowLoginDialog","deleteConfirmId","setDeleteConfirmId","previewImageUrl","setPreviewImageUrl","comments","isLoading","useComments","addComment","useAddComment","deleteComment","useDeleteComment","checkContent","useCheckSensitiveWords","uploadImage","file","fileExt","filePath","uploadError","publicUrl","handleImageSelect","isReply","clearImage","handleSubmitComment","uploadedUrl","handleSubmitReply","parentId","handleDeleteComment","commentId","CommentItem","comment","Avatar","AvatarImage","AvatarFallback","Clock","AlertCircle","star","Star","cn","DollarSign","Reply","Trash2","ReportDialog","ShieldAlert","Textarea","Input","ImageIcon","reply","MessageSquare","Card","CardContent","VolumeX","Select","SelectTrigger","SelectValue","SelectContent","range","SelectItem","CardHeader","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","open"],"mappings":"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"}