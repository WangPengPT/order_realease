import{j as s}from"./vendor-ui-DAmPMpEA.js";import{u as I,r as V}from"./vendor-react-iAJ0IrSD.js";import{a as d}from"./vendor-query-BlSVl3IQ.js";import{i as f,g as k,a6 as z,a7 as A,a8 as U,a9 as B,aa as u,C as o,k as m,j as H,t as Q,B as $,s as x}from"./index-Do1W_89N.js";import{u as G}from"./useLocalizedContent-tJ7i_ycU.js";import{u as J}from"./vendor-i18n-DxKeo2S1.js";import{T as M}from"./trending-up-DWx64Qpz.js";import{E as y}from"./eye-BYP9cNA5.js";import{U as N}from"./users-BFOmDQIZ.js";import{S as w}from"./share-2-BFzeyqrI.js";import{C as b}from"./chart-column-CsuCj0AI.js";import{s as v}from"./startOfDay-D6pD3B6q.js";import{s as _}from"./subDays-DgL-WRAj.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";const os=()=>{const{t:r}=J(),S=I(),{getLocalizedField:C}=G(),[n,q]=V.useState("30days"),E=()=>{const e=new Date;switch(n){case"today":return v(e).toISOString();case"7days":return v(_(e,6)).toISOString();case"30days":return v(_(e,29)).toISOString();default:return null}},{data:F,isLoading:O}=d({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:e,error:a}=await x.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;return e}}),l=E(),{data:h}=d({queryKey:["admin-all-subscription-counts",n],queryFn:async()=>{let e=x.from("subscriptions").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:j}=d({queryKey:["admin-all-share-counts",n],queryFn:async()=>{let e=x.from("activity_shares").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:g}=d({queryKey:["admin-all-activity-view-counts",n],queryFn:async()=>{let e=x.from("page_views").select("target_id, created_at").eq("page_type","activity");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{c.target_id&&(t[c.target_id]=(t[c.target_id]||0)+1)}),t}}),{data:p}=d({queryKey:["admin-all-activity-restaurant-counts"],queryFn:async()=>{const{data:e,error:a}=await x.from("activity_restaurants").select("activity_id");if(a)throw a;const i={};return e.forEach(t=>{i[t.activity_id]=(i[t.activity_id]||0)+1}),i}}),D=g?Object.values(g).reduce((e,a)=>e+a,0):0,T=h?Object.values(h).reduce((e,a)=>e+a,0):0,K=j?Object.values(j).reduce((e,a)=>e+a,0):0,L=p?Object.values(p).reduce((e,a)=>e+a,0):0;return O?s.jsxs("div",{className:"space-y-6",children:[s.jsx(f,{className:"h-8 w-48"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>s.jsx(f,{className:"h-24"},e))}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>s.jsx(f,{className:"h-40"},e))})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-6 w-6 text-primary"}),s.jsx("h1",{className:"text-2xl font-bold",children:r("admin.activityStatistics")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs(z,{value:n,onValueChange:e=>q(e),children:[s.jsx(A,{className:"w-[140px]",children:s.jsx(U,{})}),s.jsxs(B,{children:[s.jsx(u,{value:"today",children:r("analytics.today","今日")}),s.jsx(u,{value:"7days",children:r("analytics.last7Days","近7天")}),s.jsx(u,{value:"30days",children:r("analytics.last30Days","近30天")}),s.jsx(u,{value:"all",children:r("analytics.allTime","所有时间")})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:s.jsx(y,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalViews")}),s.jsx("p",{className:"text-2xl font-bold",children:D})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:s.jsx(N,{className:"h-5 w-5 text-red-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalSubscribers")}),s.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:s.jsx(w,{className:"h-5 w-5 text-green-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalShares")}),s.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),s.jsx(o,{children:s.jsx(m,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:s.jsx(b,{className:"h-5 w-5 text-amber-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.participatingRestaurants")}),s.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:r("admin.allActivities")}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F?.map(e=>{const a=C(e,"title"),i=g?.[e.id]||0,t=h?.[e.id]||0,c=j?.[e.id]||0,R=p?.[e.id]||0;return s.jsxs(o,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>S(`/admin/activity-stats/${e.id}`),children:[s.jsx(H,{className:"pb-2",children:s.jsx(Q,{className:"text-base line-clamp-2",children:a})}),s.jsxs(m,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[i," ",r("admin.views")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[t," ",r("admin.subscribers")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[c," ",r("admin.shares")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[R," ",r("admin.restaurants")]})]})]}),s.jsx($,{variant:"outline",size:"sm",className:"w-full mt-4",children:r("admin.viewDetails")})]})]},e.id)})})]})]})};export{os as default};
//# sourceMappingURL=AdminActivityStatsList-DeWgAJj-.js.map
