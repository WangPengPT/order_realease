import{p as se,r as c,j as e,bf as D,by as ae,ef as P,b4 as te,bC as ne,cd as R,c6 as w,a4 as re,bh as ie,cQ as le,bQ as ce,c7 as de,ak as oe,w as z}from"./vendor-react-BQzJ6E-_.js";import{C as d,p as b,F as y,q as o,I as me,g as m,B as l,A as he,t as xe,v as ue,w as ge,x as je,y as pe,z as fe,E as ve,P as Ne,Q as we,R as be,i as T,j as x,s as ye}from"./index-CvGChxBf.js";import{T as Ce,a as ke,b as u,c as Ae}from"./tabs-CvD2Ockf.js";import{C as _e}from"./checkbox-qigJZImh.js";import{d as Se,e as De,c as Pe}from"./useCommunityPosts-PMIyS9cK.js";import{u as Re}from"./useLocalizedContent-CInskQbp.js";import{P as ze}from"./PostManagementDialog-CkqHrPv3.js";import{H as Te,p as Ie,I as Me,J as Ee}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-Bm_2ig-Q.js";import"./separator-RJWDid-q.js";import"./useActivities-CN_ZMYRf.js";const Ge=()=>{const{t:a,i18n:I}=se();Re();const[C,M]=c.useState(""),[g,E]=c.useState("pending"),[k,A]=c.useState(null),[j,p]=c.useState(null),[r,h]=c.useState(new Set),[_,S]=c.useState(null),L=s=>{switch(s){case"pending":return{moderation_status:"pending"};case"flagged":return{moderation_status:"flagged"};case"approved":return{moderation_status:"approved",status:"approved"};case"rejected":return{status:"rejected"};default:return{}}},{data:n,isLoading:B,refetch:H}=Se({...L(g),search:C||void 0}),i=De(),F=Pe(),O=()=>{switch(I.language){case"zh":return Ee;case"pt":return Me;default:return Ie}},Q=s=>s===null?"bg-gray-100 text-gray-600":s<=30?"bg-emerald-100 text-emerald-700":s<=60?"bg-amber-100 text-amber-700":"bg-red-100 text-red-700",V=s=>s===null?a("admin.moderation.unknown","未知"):s<=30?a("admin.moderation.safe","安全"):s<=60?a("admin.moderation.suspicious","可疑"):a("admin.moderation.highRisk","高风险"),U=async s=>{await i.mutateAsync({id:s.id,status:"approved",moderation_status:"approved"})},q=async s=>{await i.mutateAsync({id:s.id,status:"rejected",moderation_status:"flagged"})},J=async s=>{S(s.id);try{const{error:t}=await ye.functions.invoke("moderate-post",{body:{post_id:s.id,content:s.content,user_id:s.author_id,image_urls:s.image_urls,video_url:s.video_url}});if(t)throw t;z.success(a("admin.moderation.reReviewSuccess","重新审核完成")),H()}catch(t){console.error("Re-moderation error:",t),z.error(a("admin.moderation.reReviewError","重新审核失败"))}finally{S(null)}},W=async()=>{const s=Array.from(r);for(const t of s)await i.mutateAsync({id:t,status:"approved",moderation_status:"approved"});h(new Set)},X=async()=>{const s=Array.from(r);for(const t of s)await i.mutateAsync({id:t,status:"rejected",moderation_status:"flagged"});h(new Set)},$=()=>{j&&(F.mutate(j.id),p(null))},G=s=>{const t=new Set(r);t.has(s)?t.delete(s):t.add(s),h(t)},K=()=>{n&&(r.size===n.length?h(new Set):h(new Set(n.map(s=>s.id))))},Y=s=>{const t=document.createElement("div");return t.innerHTML=s,t.textContent||t.innerText||""},f=n?.filter(s=>s.moderation_status==="pending").length||0,v=n?.filter(s=>s.moderation_status==="flagged").length||0,Z=({post:s})=>{const t=Array.isArray(s.risk_reasons)?s.risk_reasons:[];return e.jsx(d,{className:"overflow-hidden",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex items-start pt-1",children:e.jsx(_e,{checked:r.has(s.id),onCheckedChange:()=>G(s.id)})}),e.jsxs(Ne,{className:"h-10 w-10 shrink-0",children:[e.jsx(we,{src:s.author?.avatar_url||void 0}),e.jsx(be,{className:"bg-primary/10 text-primary",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:s.author?.display_name}),e.jsx("span",{className:"text-muted-foreground",children:"·"}),e.jsx("span",{className:"text-muted-foreground",children:Te(new Date(s.created_at),{addSuffix:!0,locale:O()})})]}),e.jsxs(m,{className:T("shrink-0",Q(s.risk_score)),children:[s.risk_score!==null?`${s.risk_score}`:"-"," · ",V(s.risk_score)]})]}),e.jsx("p",{className:"text-sm line-clamp-2 whitespace-pre-line",children:Y(s.content)}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.image_urls&&s.image_urls.length>0&&e.jsxs(m,{variant:"outline",className:"text-xs",children:[e.jsx(ie,{className:"h-3 w-3 mr-1"}),s.image_urls.length]}),s.video_url&&e.jsxs(m,{variant:"outline",className:"text-xs",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),a("admin.communityPosts.hasVideo","视频")]}),t.length>0&&t.map(N=>e.jsx(m,{variant:"secondary",className:"text-xs",children:N},N))]}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsxs(l,{size:"sm",variant:"ghost",className:"h-8 text-blue-600 hover:bg-blue-50",onClick:()=>A(s),children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),a("common.details","详情")]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-8 text-emerald-600 hover:bg-emerald-50",onClick:()=>U(s),disabled:i.isPending,children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),a("admin.action.approve","通过")]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-8 text-red-600 hover:bg-red-50",onClick:()=>q(s),disabled:i.isPending,children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),a("admin.action.reject","拒绝")]}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-8 text-purple-600 hover:bg-purple-50",onClick:()=>J(s),disabled:_===s.id,children:[e.jsx(de,{className:T("h-4 w-4 mr-1",_===s.id&&"animate-spin")}),a("admin.moderation.reReview","重审")]}),e.jsx(l,{size:"sm",variant:"ghost",className:"h-8 text-destructive hover:bg-destructive/10",onClick:()=>p(s),children:e.jsx(oe,{className:"h-4 w-4"})})]})]})]})})})},ee=()=>e.jsx(d,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x,{className:"h-5 w-5"}),e.jsx(x,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(x,{className:"h-4 w-1/3"}),e.jsx(x,{className:"h-4 w-full"}),e.jsx(x,{className:"h-4 w-2/3"})]})]})})});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:a("admin.communityModeration.title","社区审核")}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:a("admin.communityModeration.subtitle","审核社区帖子，确保内容安全")})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(d,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:a("admin.moderation.pendingReview","待审核")}),e.jsx(D,{className:"h-4 w-4 text-amber-500"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:f})})]}),e.jsxs(d,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:a("admin.moderation.highRiskCount","高风险")}),e.jsx(ae,{className:"h-4 w-4 text-red-500"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:v})})]}),e.jsxs(d,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium",children:a("admin.moderation.todayReviewed","今日审核")}),e.jsx(P,{className:"h-4 w-4 text-emerald-500"})]}),e.jsx(o,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?.filter(s=>{const t=new Date;return new Date(s.ai_reviewed_at||s.created_at).toDateString()===t.toDateString()}).length||0})})]})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(me,{placeholder:a("admin.communityPosts.searchPlaceholder","搜索内容..."),value:C,onChange:s=>M(s.target.value),className:"pl-10"})]}),e.jsxs(Ce,{value:g,onValueChange:E,children:[e.jsxs(ke,{children:[e.jsxs(u,{value:"pending",className:"gap-1.5",children:[e.jsx(D,{className:"h-4 w-4"}),a("admin.moderation.pending","待审核"),f>0&&e.jsx(m,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:f})]}),e.jsxs(u,{value:"flagged",className:"gap-1.5",children:[e.jsx(ne,{className:"h-4 w-4"}),a("admin.moderation.flagged","高风险"),v>0&&e.jsx(m,{variant:"destructive",className:"ml-1 h-5 px-1.5",children:v})]}),e.jsxs(u,{value:"approved",className:"gap-1.5",children:[e.jsx(R,{className:"h-4 w-4"}),a("admin.moderation.approved","已通过")]}),e.jsxs(u,{value:"rejected",className:"gap-1.5",children:[e.jsx(w,{className:"h-4 w-4"}),a("admin.moderation.rejected","已拒绝")]})]}),r.size>0&&e.jsxs("div",{className:"flex items-center gap-3 mt-4 p-3 bg-muted/50 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[a("admin.selected","已选择")," ",r.size," ",a("admin.items","项")]}),e.jsx(l,{size:"sm",variant:"outline",onClick:K,children:r.size===n?.length?a("admin.deselectAll","取消全选"):a("admin.selectAll","全选")}),e.jsxs(l,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",onClick:W,disabled:i.isPending,children:[e.jsx(re,{className:"h-4 w-4 mr-1"}),a("admin.batchApprove","批量通过")]}),e.jsxs(l,{size:"sm",variant:"destructive",onClick:X,disabled:i.isPending,children:[e.jsx(w,{className:"h-4 w-4 mr-1"}),a("admin.batchReject","批量拒绝")]})]}),e.jsx(Ae,{value:g,className:"mt-4 space-y-3",children:B?Array.from({length:3}).map((s,t)=>e.jsx(ee,{},t)):n&&n.length>0?n.map(s=>e.jsx(Z,{post:s},s.id)):e.jsx(d,{children:e.jsxs(o,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(P,{className:"h-12 w-12 text-muted-foreground/30 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.moderation.noItems","暂无待审核内容")})]})})})]}),e.jsx(ze,{post:k,open:!!k,onOpenChange:s=>!s&&A(null)}),e.jsx(he,{open:!!j,onOpenChange:s=>!s&&p(null),children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(ge,{children:a("common.confirmDelete","确认删除")}),e.jsx(je,{children:a("admin.communityPosts.deleteWarning","此操作不可撤销，确定要删除这条帖子吗？")})]}),e.jsxs(pe,{children:[e.jsx(fe,{children:a("common.cancel","取消")}),e.jsx(ve,{onClick:$,className:"bg-destructive hover:bg-destructive/90",children:a("common.delete","删除")})]})]})})]})};export{Ge as default};
//# sourceMappingURL=AdminCommunityModeration-DwGZijmN.js.map
