{"version":3,"file":"useAdmin-Cp35hB2I.js","sources":["../../src/hooks/useAdmin.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport i18n from \"@/i18n/config\";\r\n\r\n// Helper function to get user role\r\nconst getUserRole = async (userId: string) => {\r\n  const { data } = await supabase\r\n    .from(\"user_roles\")\r\n    .select(\"role\")\r\n    .eq(\"user_id\", userId)\r\n    .single();\r\n  return data?.role;\r\n};\r\n\r\nexport const useAdminUsers = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"admin-users\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n      \r\n      // Fetch all profiles with pagination (1000 per page)\r\n      const fetchAllProfiles = async () => {\r\n        const allProfiles: any[] = [];\r\n        let page = 0;\r\n        const pageSize = 1000;\r\n        let hasMore = true;\r\n        \r\n        while (hasMore) {\r\n          const { data, error } = await supabase\r\n            .from(\"profiles\")\r\n            .select(\"*\")\r\n            .order(\"created_at\", { ascending: false })\r\n            .range(page * pageSize, (page + 1) * pageSize - 1);\r\n          \r\n          if (error) throw error;\r\n          \r\n          if (data && data.length > 0) {\r\n            allProfiles.push(...data);\r\n            hasMore = data.length === pageSize;\r\n            page++;\r\n          } else {\r\n            hasMore = false;\r\n          }\r\n        }\r\n        return allProfiles;\r\n      };\r\n\r\n      // Fetch all roles with pagination\r\n      const fetchAllRoles = async () => {\r\n        const allRoles: any[] = [];\r\n        let page = 0;\r\n        const pageSize = 1000;\r\n        let hasMore = true;\r\n        \r\n        while (hasMore) {\r\n          const { data, error } = await supabase\r\n            .from(\"user_roles\")\r\n            .select(\"user_id, role\")\r\n            .range(page * pageSize, (page + 1) * pageSize - 1);\r\n          \r\n          if (error) throw error;\r\n          \r\n          if (data && data.length > 0) {\r\n            allRoles.push(...data);\r\n            hasMore = data.length === pageSize;\r\n            page++;\r\n          } else {\r\n            hasMore = false;\r\n          }\r\n        }\r\n        return allRoles;\r\n      };\r\n\r\n      // Fetch profiles, roles, session, and current user role in parallel\r\n      const [profiles, roles, sessionResult, currentUserRoleResult] = await Promise.all([\r\n        fetchAllProfiles(),\r\n        fetchAllRoles(),\r\n        supabase.auth.getSession(),\r\n        supabase\r\n          .from(\"user_roles\")\r\n          .select(\"role\")\r\n          .eq(\"user_id\", user.id)\r\n          .single()\r\n      ]);\r\n      \r\n      // Create a role map for O(1) lookup\r\n      const roleMap: Record<string, string> = {};\r\n      roles.forEach(r => {\r\n        roleMap[r.user_id] = r.role;\r\n      });\r\n\r\n      // Fetch user emails and auth data from edge function\r\n      let emailMap: Record<string, string> = {};\r\n      let createdAtMap: Record<string, string> = {};\r\n      let lastSignInMap: Record<string, string | null> = {};\r\n      \r\n      if (sessionResult.data?.session?.access_token) {\r\n        try {\r\n          const response = await supabase.functions.invoke(\"get-user-emails\", {\r\n            headers: {\r\n              Authorization: `Bearer ${sessionResult.data.session.access_token}`,\r\n            },\r\n          });\r\n          if (response.data?.emails) {\r\n            emailMap = response.data.emails;\r\n          }\r\n          if (response.data?.createdAt) {\r\n            createdAtMap = response.data.createdAt;\r\n          }\r\n          if (response.data?.lastSignIn) {\r\n            lastSignInMap = response.data.lastSignIn;\r\n          }\r\n        } catch (e) {\r\n          console.error(\"Failed to fetch user data:\", e);\r\n        }\r\n      }\r\n\r\n      // Map profiles with roles (no additional queries needed)\r\n      const usersWithRoles = profiles.map((profile) => ({\r\n        ...profile,\r\n        role: roleMap[profile.id] || \"user\",\r\n        email: emailMap[profile.id] || \"\",\r\n        auth_created_at: createdAtMap[profile.id] || profile.created_at,\r\n        last_sign_in_at: lastSignInMap[profile.id] || null,\r\n      }));\r\n\r\n      // Check if current user is supervisor\r\n      const currentUserRole = currentUserRoleResult.data;\r\n\r\n      // If supervisor, show merchants they manage\r\n      if (currentUserRole?.role === \"supervisor\") {\r\n        // Get all restaurants managed by this supervisor\r\n        const { data: supervisorRestaurants, error: restaurantError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        if (restaurantError) throw restaurantError;\r\n\r\n        if (!supervisorRestaurants || supervisorRestaurants.length === 0) {\r\n          return [];\r\n        }\r\n\r\n        const restaurantIds = supervisorRestaurants.map(r => r.restaurant_id);\r\n\r\n        // Get all merchants who manage any of these restaurants\r\n        const { data: merchantRestaurantLinks, error: linksError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"user_id, restaurant_id\")\r\n          .in(\"restaurant_id\", restaurantIds);\r\n\r\n        if (linksError) throw linksError;\r\n\r\n        if (!merchantRestaurantLinks || merchantRestaurantLinks.length === 0) {\r\n          return [];\r\n        }\r\n\r\n        // Get unique merchant user IDs (excluding the supervisor)\r\n        const merchantIds = [...new Set(\r\n          merchantRestaurantLinks\r\n            .map(link => link.user_id)\r\n            .filter(id => id !== user.id)\r\n        )];\r\n\r\n        if (merchantIds.length === 0) {\r\n          return [];\r\n        }\r\n\r\n        // Filter users who are merchants from the role map\r\n        const validMerchantIds = merchantIds.filter(id => roleMap[id] === \"merchant\");\r\n\r\n        // Filter users to show only valid merchants\r\n        return usersWithRoles.filter(u => validMerchantIds.includes(u.id));\r\n      }\r\n\r\n      return usersWithRoles;\r\n    },\r\n    staleTime: 30000, // Cache for 30 seconds\r\n  });\r\n};\r\n\r\nexport const useChangeRole = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ userId, role }: { userId: string; role: \"user\" | \"merchant\" | \"supervisor\" | \"admin\" }) => {\r\n      // Use upsert to handle both insert and update cases\r\n      const { error } = await supabase\r\n        .from(\"user_roles\")\r\n        .upsert(\r\n          { user_id: userId, role },\r\n          { onConflict: 'user_id' }\r\n        );\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"user-roles\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.roleChanged\"),\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      console.error(\"Role change error:\", error);\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: error.message || i18n.t(\"toast.roleChangeFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Removed useRemoveRole - users now only have one role that can be changed\r\n\r\n// Hook to get restaurants based on user role (admin sees all, supervisor sees only their restaurants)\r\nexport const useAdminRestaurants = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"admin-restaurants\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      if (isSupervisor) {\r\n        // Get supervisor's assigned restaurants\r\n        const { data: merchantRestaurants, error: mrError } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        if (mrError) throw mrError;\r\n\r\n        const restaurantIds = merchantRestaurants?.map(mr => mr.restaurant_id) || [];\r\n        \r\n        if (restaurantIds.length === 0) return [];\r\n\r\n        // Get full restaurant details for assigned restaurants\r\n        const { data, error } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"*\")\r\n          .in(\"id\", restaurantIds)\r\n          .order(\"rating\", { ascending: false });\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n      } else {\r\n        // Admin sees all restaurants\r\n        const { data, error } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"*\")\r\n          .order(\"rating\", { ascending: false });\r\n\r\n        if (error) throw error;\r\n        return data || [];\r\n      }\r\n    },\r\n    enabled: !!user,\r\n  });\r\n};\r\n\r\nexport const useOperationLogs = () => {\r\n  return useQuery({\r\n    queryKey: [\"operation-logs\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"operation_logs\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(100);\r\n\r\n      if (error) throw error;\r\n\r\n      // Fetch user profiles for logs\r\n      const logsWithUsers = await Promise.all(\r\n        (data || []).map(async (log) => {\r\n          const { data: profile } = await supabase\r\n            .from(\"profiles\")\r\n            .select(\"display_name\")\r\n            .eq(\"id\", log.user_id)\r\n            .single();\r\n\r\n          return {\r\n            ...log,\r\n            user_name: profile?.display_name || \"Unknown User\",\r\n          };\r\n        })\r\n      );\r\n\r\n      return logsWithUsers;\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateMerchantProfile = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({\r\n      userId,\r\n      display_name,\r\n      phone,\r\n      avatar_url,\r\n    }: {\r\n      userId: string;\r\n      display_name?: string;\r\n      phone?: string;\r\n      avatar_url?: string;\r\n    }) => {\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({ display_name, phone, avatar_url })\r\n        .eq(\"id\", userId)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.profileUpdated\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.profileUpdateFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUploadMerchantAvatar = () => {\r\n  const { toast } = useToast();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ file, userId }: { file: File; userId: string }) => {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${Date.now()}.${fileExt}`;\r\n      const filePath = `${userId}/${fileName}`;\r\n\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"avatars\")\r\n        .upload(filePath, file, { upsert: true });\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"avatars\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.avatarUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useAdminStats = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"admin-stats\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return {\r\n        totalUsers: 0,\r\n        totalRestaurants: 0,\r\n        totalActivities: 0,\r\n        totalComments: 0,\r\n      };\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      if (isSupervisor) {\r\n        // Get supervisor's assigned restaurants\r\n        const { data: merchantRestaurants } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id, user_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        const restaurantIds = merchantRestaurants?.map(mr => mr.restaurant_id) || [];\r\n        const merchantUserIds = Array.from(new Set(merchantRestaurants?.map(mr => mr.user_id))) || [];\r\n\r\n        // Count only merchants managed by this supervisor\r\n        const merchantsCount = merchantUserIds.length;\r\n\r\n        // Count only assigned restaurants\r\n        const restaurantsCount = restaurantIds.length;\r\n\r\n        // Count comments for assigned restaurants\r\n        let commentsCount = 0;\r\n        if (restaurantIds.length > 0) {\r\n          const { count } = await supabase\r\n            .from(\"comments\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"target_type\", \"restaurant\")\r\n            .in(\"target_id\", restaurantIds);\r\n          commentsCount = count || 0;\r\n        }\r\n\r\n        return {\r\n          totalUsers: merchantsCount,\r\n          totalRestaurants: restaurantsCount,\r\n          totalActivities: 0, // Supervisors don't manage activities\r\n          totalComments: commentsCount,\r\n        };\r\n      }\r\n\r\n      // Admin sees all stats\r\n      const [usersCount, restaurantsCount, activitiesCount, commentsCount] =\r\n        await Promise.all([\r\n          supabase.from(\"profiles\").select(\"*\", { count: \"exact\", head: true }),\r\n          supabase.from(\"restaurants\").select(\"*\", { count: \"exact\", head: true }),\r\n          supabase.from(\"activities\").select(\"*\", { count: \"exact\", head: true }),\r\n          supabase.from(\"comments\").select(\"*\", { count: \"exact\", head: true }),\r\n        ]);\r\n\r\n      return {\r\n        totalUsers: usersCount.count || 0,\r\n        totalRestaurants: restaurantsCount.count || 0,\r\n        totalActivities: activitiesCount.count || 0,\r\n        totalComments: commentsCount.count || 0,\r\n      };\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUserGrowth = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"user-growth\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      if (isSupervisor) {\r\n        // Get supervisor's managed merchants\r\n        const { data: merchantRestaurants } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"user_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        const merchantUserIds = Array.from(new Set(merchantRestaurants?.map(mr => mr.user_id)));\r\n        \r\n        if (merchantUserIds.length === 0) return [];\r\n\r\n        // Get merchant profiles\r\n        const { data, error } = await supabase\r\n          .from(\"profiles\")\r\n          .select(\"created_at\")\r\n          .in(\"id\", merchantUserIds)\r\n          .order(\"created_at\", { ascending: true });\r\n\r\n        if (error) throw error;\r\n\r\n        // Group by month\r\n        const monthlyData: Record<string, number> = {};\r\n        data?.forEach((profile) => {\r\n          const date = new Date(profile.created_at);\r\n          const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\r\n          monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;\r\n        });\r\n\r\n        // Convert to cumulative data\r\n        let cumulative = 0;\r\n        const result = Object.entries(monthlyData)\r\n          .sort(([a], [b]) => a.localeCompare(b))\r\n          .map(([month, count]) => {\r\n            cumulative += count;\r\n            return { month, count: cumulative };\r\n          });\r\n\r\n        return result;\r\n      }\r\n\r\n      // Admin sees all user growth\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"created_at\")\r\n        .order(\"created_at\", { ascending: true });\r\n\r\n      if (error) throw error;\r\n\r\n      // Group by month\r\n      const monthlyData: Record<string, number> = {};\r\n      data?.forEach((profile) => {\r\n        const date = new Date(profile.created_at);\r\n        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\r\n        monthlyData[monthKey] = (monthlyData[monthKey] || 0) + 1;\r\n      });\r\n\r\n      // Convert to cumulative data\r\n      let cumulative = 0;\r\n      const result = Object.entries(monthlyData)\r\n        .sort(([a], [b]) => a.localeCompare(b))\r\n        .map(([month, count]) => {\r\n          cumulative += count;\r\n          return { month, count: cumulative };\r\n        });\r\n\r\n      return result;\r\n    },\r\n  });\r\n};\r\n\r\nexport const useTopRestaurants = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"top-restaurants\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      let query = supabase\r\n        .from(\"restaurants\")\r\n        .select(\"id, name, rating\")\r\n        .order(\"rating\", { ascending: false, nullsFirst: false })\r\n        .limit(10);\r\n\r\n      if (isSupervisor) {\r\n        // Get supervisor's assigned restaurants\r\n        const { data: merchantRestaurants } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        const restaurantIds = merchantRestaurants?.map(mr => mr.restaurant_id) || [];\r\n        \r\n        if (restaurantIds.length === 0) return [];\r\n\r\n        query = supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name, rating\")\r\n          .in(\"id\", restaurantIds)\r\n          .order(\"rating\", { ascending: false, nullsFirst: false })\r\n          .limit(10);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      // Get comment counts for each restaurant\r\n      const restaurantsWithComments = await Promise.all(\r\n        (data || []).map(async (restaurant) => {\r\n          const { count } = await supabase\r\n            .from(\"comments\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"target_id\", restaurant.id)\r\n            .eq(\"target_type\", \"restaurant\");\r\n\r\n          return {\r\n            name: restaurant.name,\r\n            rating: restaurant.rating || 0,\r\n            comments: count || 0,\r\n          };\r\n        })\r\n      );\r\n\r\n      return restaurantsWithComments;\r\n    },\r\n  });\r\n};\r\n\r\nexport const useRestaurantRatingTrends = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"restaurant-rating-trends\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      // Get restaurants (filtered for supervisors)\r\n      let restaurantIds: string[] = [];\r\n      let restaurantNames: Record<string, string> = {};\r\n\r\n      if (isSupervisor) {\r\n        const { data: merchantRestaurants } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        restaurantIds = merchantRestaurants?.map(mr => mr.restaurant_id) || [];\r\n      } else {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name\")\r\n          .order(\"rating\", { ascending: false, nullsFirst: false })\r\n          .limit(5);\r\n\r\n        restaurantIds = restaurants?.map(r => r.id) || [];\r\n        restaurants?.forEach(r => {\r\n          restaurantNames[r.id] = r.name;\r\n        });\r\n      }\r\n\r\n      if (restaurantIds.length === 0) return [];\r\n\r\n      // Get all ratings for these restaurants with timestamps\r\n      const { data: ratings } = await supabase\r\n        .from(\"comments\")\r\n        .select(\"target_id, rating_value, created_at\")\r\n        .eq(\"target_type\", \"restaurant\")\r\n        .in(\"target_id\", restaurantIds)\r\n        .not(\"rating_value\", \"is\", null)\r\n        .order(\"created_at\", { ascending: true });\r\n\r\n      if (!ratings || ratings.length === 0) return [];\r\n\r\n      // Get restaurant names if not already fetched\r\n      if (Object.keys(restaurantNames).length === 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", restaurantIds);\r\n\r\n        restaurants?.forEach(r => {\r\n          restaurantNames[r.id] = r.name;\r\n        });\r\n      }\r\n\r\n      // Group by restaurant and month, calculate average rating\r\n      const monthlyAverages: Record<string, Record<string, { sum: number; count: number }>> = {};\r\n\r\n      ratings.forEach(rating => {\r\n        const date = new Date(rating.created_at);\r\n        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\r\n        \r\n        if (!monthlyAverages[rating.target_id]) {\r\n          monthlyAverages[rating.target_id] = {};\r\n        }\r\n        \r\n        if (!monthlyAverages[rating.target_id][monthKey]) {\r\n          monthlyAverages[rating.target_id][monthKey] = { sum: 0, count: 0 };\r\n        }\r\n        \r\n        monthlyAverages[rating.target_id][monthKey].sum += rating.rating_value;\r\n        monthlyAverages[rating.target_id][monthKey].count += 1;\r\n      });\r\n\r\n      // Convert to chart data format\r\n      const allMonths = new Set<string>();\r\n      Object.values(monthlyAverages).forEach(restaurant => {\r\n        Object.keys(restaurant).forEach(month => allMonths.add(month));\r\n      });\r\n\r\n      const sortedMonths = Array.from(allMonths).sort();\r\n\r\n      return sortedMonths.map(month => {\r\n        const dataPoint: any = { month };\r\n        \r\n        Object.keys(monthlyAverages).forEach(restaurantId => {\r\n          const restaurantData = monthlyAverages[restaurantId][month];\r\n          const avgRating = restaurantData \r\n            ? (restaurantData.sum / restaurantData.count).toFixed(1)\r\n            : null;\r\n          \r\n          dataPoint[restaurantNames[restaurantId] || restaurantId] = avgRating;\r\n        });\r\n        \r\n        return dataPoint;\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useRestaurantCommentTrends = () => {\r\n  const { user } = useAuth();\r\n  \r\n  return useQuery({\r\n    queryKey: [\"restaurant-comment-trends\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const userRole = await getUserRole(user.id);\r\n      const isSupervisor = userRole === \"supervisor\";\r\n\r\n      // Get restaurants (filtered for supervisors)\r\n      let restaurantIds: string[] = [];\r\n      let restaurantNames: Record<string, string> = {};\r\n\r\n      if (isSupervisor) {\r\n        const { data: merchantRestaurants } = await supabase\r\n          .from(\"merchant_restaurants\")\r\n          .select(\"restaurant_id\")\r\n          .eq(\"user_id\", user.id);\r\n\r\n        restaurantIds = merchantRestaurants?.map(mr => mr.restaurant_id) || [];\r\n      } else {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name\")\r\n          .order(\"rating\", { ascending: false, nullsFirst: false })\r\n          .limit(5);\r\n\r\n        restaurantIds = restaurants?.map(r => r.id) || [];\r\n        restaurants?.forEach(r => {\r\n          restaurantNames[r.id] = r.name;\r\n        });\r\n      }\r\n\r\n      if (restaurantIds.length === 0) return [];\r\n\r\n      // Get all comments for these restaurants with timestamps\r\n      const { data: comments } = await supabase\r\n        .from(\"comments\")\r\n        .select(\"target_id, created_at\")\r\n        .eq(\"target_type\", \"restaurant\")\r\n        .in(\"target_id\", restaurantIds)\r\n        .order(\"created_at\", { ascending: true });\r\n\r\n      if (!comments || comments.length === 0) return [];\r\n\r\n      // Get restaurant names if not already fetched\r\n      if (Object.keys(restaurantNames).length === 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", restaurantIds);\r\n\r\n        restaurants?.forEach(r => {\r\n          restaurantNames[r.id] = r.name;\r\n        });\r\n      }\r\n\r\n      // Group by restaurant and month, count comments\r\n      const monthlyCounts: Record<string, Record<string, number>> = {};\r\n\r\n      comments.forEach(comment => {\r\n        const date = new Date(comment.created_at);\r\n        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\r\n        \r\n        if (!monthlyCounts[comment.target_id]) {\r\n          monthlyCounts[comment.target_id] = {};\r\n        }\r\n        \r\n        monthlyCounts[comment.target_id][monthKey] = (monthlyCounts[comment.target_id][monthKey] || 0) + 1;\r\n      });\r\n\r\n      // Convert to chart data format\r\n      const allMonths = new Set<string>();\r\n      Object.values(monthlyCounts).forEach(restaurant => {\r\n        Object.keys(restaurant).forEach(month => allMonths.add(month));\r\n      });\r\n\r\n      const sortedMonths = Array.from(allMonths).sort();\r\n\r\n      return sortedMonths.map(month => {\r\n        const dataPoint: any = { month };\r\n        \r\n        Object.keys(monthlyCounts).forEach(restaurantId => {\r\n          const count = monthlyCounts[restaurantId][month] || 0;\r\n          dataPoint[restaurantNames[restaurantId] || restaurantId] = count;\r\n        });\r\n        \r\n        return dataPoint;\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useActivityEngagement = () => {\r\n  return useQuery({\r\n    queryKey: [\"activity-engagement\"],\r\n    queryFn: async () => {\r\n      const { data: activities, error } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"id, title_en\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(10);\r\n\r\n      if (error) throw error;\r\n\r\n      // Get subscriber counts for each activity\r\n      const activitiesWithEngagement = await Promise.all(\r\n        (activities || []).map(async (activity) => {\r\n          const [subscribers, comments] = await Promise.all([\r\n            supabase\r\n              .from(\"subscriptions\")\r\n              .select(\"*\", { count: \"exact\", head: true })\r\n              .eq(\"activity_id\", activity.id),\r\n            supabase\r\n              .from(\"comments\")\r\n              .select(\"*\", { count: \"exact\", head: true })\r\n              .eq(\"target_id\", activity.id)\r\n              .eq(\"target_type\", \"activity\"),\r\n          ]);\r\n\r\n          return {\r\n            name: activity.title_en,\r\n            subscribers: subscribers.count || 0,\r\n            comments: comments.count || 0,\r\n          };\r\n        })\r\n      );\r\n\r\n      return activitiesWithEngagement;\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteActivity = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (activityId: string) => {\r\n      // Delete associated restaurants first\r\n      await supabase\r\n        .from(\"activity_restaurants\")\r\n        .delete()\r\n        .eq(\"activity_id\", activityId);\r\n\r\n      // Delete the activity\r\n      const { error } = await supabase\r\n        .from(\"activities\")\r\n        .delete()\r\n        .eq(\"id\", activityId);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"activities\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-activities\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.activityDeleted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.activityDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteRestaurant = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (restaurantId: string) => {\r\n      const { error } = await supabase\r\n        .from(\"restaurants\")\r\n        .delete()\r\n        .eq(\"id\", restaurantId);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"restaurants\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.restaurantDeleted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.restaurantDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteUser = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (userId: string) => {\r\n      console.log(\"Calling delete-account edge function for userId:\", userId);\r\n      const { data, error } = await supabase.functions.invoke(\"delete-account\", {\r\n        body: { userId },\r\n      });\r\n      console.log(\"Delete-account response:\", { data, error });\r\n      if (error) {\r\n        console.error(\"Delete-account error:\", error);\r\n        throw error;\r\n      }\r\n      if (data?.error) {\r\n        console.error(\"Delete-account data error:\", data.error);\r\n        throw new Error(data.error);\r\n      }\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.userDeleted\"),\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      console.error(\"useDeleteUser onError:\", error);\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: error?.message || i18n.t(\"toast.userDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBanUser = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const { user } = useAuth();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ userId, banReason }: { userId: string; banReason?: string }) => {\r\n      const { error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          is_banned: true,\r\n          ban_reason: banReason || null,\r\n          banned_at: new Date().toISOString(),\r\n          banned_by: user?.id,\r\n        })\r\n        .eq(\"id\", userId);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.userBanned\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.userBanFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUnbanUser = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (userId: string) => {\r\n      const { error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          is_banned: false,\r\n          ban_reason: null,\r\n          banned_at: null,\r\n          banned_by: null,\r\n        })\r\n        .eq(\"id\", userId);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"banned-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.userUnbanned\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.userUnbanFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useMuteUser = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n  const { user } = useAuth();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ userId, muteReason, mutedUntil }: { userId: string; muteReason?: string; mutedUntil?: string }) => {\r\n      const { error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          is_muted: true,\r\n          mute_reason: muteReason || null,\r\n          muted_at: new Date().toISOString(),\r\n          muted_by: user?.id,\r\n          muted_until: mutedUntil || null,\r\n        })\r\n        .eq(\"id\", userId);\r\n\r\n      if (error) throw error;\r\n\r\n      // Get user's language preference for notification\r\n      const { data: userProfile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"language_preference\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n\r\n      const userLang = userProfile?.language_preference || \"en\";\r\n      \r\n      // Format duration for notification\r\n      let durationText = \"\";\r\n      if (mutedUntil) {\r\n        const mutedUntilDate = new Date(mutedUntil);\r\n        if (userLang === \"zh\") {\r\n          durationText = `禁言至: ${mutedUntilDate.toLocaleDateString(\"zh-CN\")}`;\r\n        } else if (userLang === \"pt\") {\r\n          durationText = `Silenciado até: ${mutedUntilDate.toLocaleDateString(\"pt-PT\")}`;\r\n        } else {\r\n          durationText = `Muted until: ${mutedUntilDate.toLocaleDateString(\"en-US\")}`;\r\n        }\r\n      } else {\r\n        if (userLang === \"zh\") {\r\n          durationText = \"永久禁言\";\r\n        } else if (userLang === \"pt\") {\r\n          durationText = \"Silenciamento permanente\";\r\n        } else {\r\n          durationText = \"Permanent mute\";\r\n        }\r\n      }\r\n\r\n      // Create notification for the muted user\r\n      let notificationTitle = \"\";\r\n      let notificationContent = \"\";\r\n      \r\n      if (userLang === \"zh\") {\r\n        notificationTitle = \"账号已被禁言\";\r\n        notificationContent = `${durationText}。原因: ${muteReason || \"违反社区规则\"}`;\r\n      } else if (userLang === \"pt\") {\r\n        notificationTitle = \"Conta silenciada\";\r\n        notificationContent = `${durationText}. Motivo: ${muteReason || \"Violação das regras da comunidade\"}`;\r\n      } else {\r\n        notificationTitle = \"Account muted\";\r\n        notificationContent = `${durationText}. Reason: ${muteReason || \"Community guidelines violation\"}`;\r\n      }\r\n\r\n      await supabase.from(\"notifications\").insert({\r\n        user_id: userId,\r\n        type: \"activity_update\",\r\n        title: notificationTitle,\r\n        content: notificationContent,\r\n        link: \"/profile\",\r\n      });\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"muted-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.userMuted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.userMuteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUnmuteUser = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (userId: string) => {\r\n      // Get user's language preference for notification before unmuting\r\n      const { data: userProfile } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"language_preference\")\r\n        .eq(\"id\", userId)\r\n        .single();\r\n\r\n      const { error } = await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          is_muted: false,\r\n          mute_reason: null,\r\n          muted_at: null,\r\n          muted_by: null,\r\n          muted_until: null,\r\n        })\r\n        .eq(\"id\", userId);\r\n\r\n      if (error) throw error;\r\n\r\n      const userLang = userProfile?.language_preference || \"en\";\r\n      \r\n      // Create notification for the unmuted user\r\n      let notificationTitle = \"\";\r\n      let notificationContent = \"\";\r\n      \r\n      if (userLang === \"zh\") {\r\n        notificationTitle = \"禁言已解除\";\r\n        notificationContent = \"您的账号禁言已被解除，现在可以正常发表评论了。\";\r\n      } else if (userLang === \"pt\") {\r\n        notificationTitle = \"Silenciamento removido\";\r\n        notificationContent = \"O silenciamento da sua conta foi removido. Você pode comentar novamente.\";\r\n      } else {\r\n        notificationTitle = \"Mute lifted\";\r\n        notificationContent = \"Your account mute has been lifted. You can now post comments again.\";\r\n      }\r\n\r\n      await supabase.from(\"notifications\").insert({\r\n        user_id: userId,\r\n        type: \"activity_update\",\r\n        title: notificationTitle,\r\n        content: notificationContent,\r\n        link: \"/profile\",\r\n      });\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"muted-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.userUnmuted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.userUnmuteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBannedUsers = () => {\r\n  return useQuery({\r\n    queryKey: [\"banned-users\"],\r\n    queryFn: async () => {\r\n      const { data: profiles, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"is_banned\", true)\r\n        .order(\"banned_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      // Get roles\r\n      const { data: roles } = await supabase.from(\"user_roles\").select(\"user_id, role\");\r\n      const roleMap: Record<string, string> = {};\r\n      roles?.forEach(r => { roleMap[r.user_id] = r.role; });\r\n\r\n      return (profiles || []).map(profile => ({\r\n        ...profile,\r\n        role: roleMap[profile.id] || \"user\",\r\n      }));\r\n    },\r\n  });\r\n};\r\n\r\nexport const useMutedUsers = () => {\r\n  return useQuery({\r\n    queryKey: [\"muted-users\"],\r\n    queryFn: async () => {\r\n      const { data: profiles, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"*\")\r\n        .eq(\"is_muted\", true)\r\n        .order(\"muted_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      // Get roles\r\n      const { data: roles } = await supabase.from(\"user_roles\").select(\"user_id, role\");\r\n      const roleMap: Record<string, string> = {};\r\n      roles?.forEach(r => { roleMap[r.user_id] = r.role; });\r\n\r\n      return (profiles || []).map(profile => ({\r\n        ...profile,\r\n        role: roleMap[profile.id] || \"user\",\r\n      }));\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBatchDeleteUsers = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (userIds: string[]) => {\r\n      // Use the delete-account edge function for each user\r\n      const deletePromises = userIds.map(async (userId) => {\r\n        const { error } = await supabase.functions.invoke(\"delete-account\", {\r\n          body: { userId },\r\n        });\r\n        if (error) throw error;\r\n      });\r\n\r\n      await Promise.all(deletePromises);\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.usersDeleted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.usersDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBatchDeleteRestaurants = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (restaurantIds: string[]) => {\r\n      const { error } = await supabase\r\n        .from(\"restaurants\")\r\n        .delete()\r\n        .in(\"id\", restaurantIds);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"restaurants\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.restaurantsDeleted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.restaurantsDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBatchDeleteActivities = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (activityIds: string[]) => {\r\n      // Delete associated restaurants first\r\n      await supabase\r\n        .from(\"activity_restaurants\")\r\n        .delete()\r\n        .in(\"activity_id\", activityIds);\r\n\r\n      // Delete activities\r\n      const { error } = await supabase\r\n        .from(\"activities\")\r\n        .delete()\r\n        .in(\"id\", activityIds);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"activities\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.activitiesDeleted\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.activitiesDeleteFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useBatchChangeRole = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ userIds, role }: { userIds: string[]; role: \"user\" | \"merchant\" | \"supervisor\" | \"admin\" }) => {\r\n      // Use upsert for batch role changes\r\n      const upserts = userIds.map(userId => ({\r\n        user_id: userId,\r\n        role\r\n      }));\r\n      \r\n      const { error } = await supabase\r\n        .from(\"user_roles\")\r\n        .upsert(upserts, { onConflict: 'user_id' });\r\n      \r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-users\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.rolesChanged\"),\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      console.error(\"Batch role change error:\", error);\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: error.message || i18n.t(\"toast.rolesChangeFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useToggleRestaurantVisibility = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ restaurantId, visible }: { restaurantId: string; visible: boolean }) => {\r\n      const { error } = await supabase\r\n        .from(\"restaurants\")\r\n        .update({ visible })\r\n        .eq(\"id\", restaurantId);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-restaurants\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"restaurants\"] });\r\n      toast({\r\n        title: i18n.t(\"common.success\"),\r\n        description: i18n.t(\"toast.visibilityUpdated\"),\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.visibilityUpdateFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useActivityShareTrends = () => {\r\n  return useQuery({\r\n    queryKey: [\"activity-share-trends\"],\r\n    queryFn: async () => {\r\n      // Get top 5 activities by share count\r\n      const { data: activities } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"id, title_zh, title_en, title_pt\")\r\n        .eq(\"visible\", true)\r\n        .limit(10);\r\n\r\n      if (!activities || activities.length === 0) return [];\r\n\r\n      const activityIds = activities.map(a => a.id);\r\n      const activityNames: Record<string, string> = {};\r\n      activities.forEach(a => {\r\n        activityNames[a.id] = a.title_zh || a.title_en;\r\n      });\r\n\r\n      // Get all shares for these activities\r\n      const { data: shares } = await supabase\r\n        .from(\"activity_shares\")\r\n        .select(\"activity_id, created_at\")\r\n        .in(\"activity_id\", activityIds)\r\n        .order(\"created_at\", { ascending: true });\r\n\r\n      if (!shares || shares.length === 0) return [];\r\n\r\n      // Group by activity and month\r\n      const monthlyShares: Record<string, Record<string, number>> = {};\r\n\r\n      shares.forEach(share => {\r\n        const date = new Date(share.created_at);\r\n        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\r\n        \r\n        if (!monthlyShares[share.activity_id]) {\r\n          monthlyShares[share.activity_id] = {};\r\n        }\r\n        \r\n        monthlyShares[share.activity_id][monthKey] = \r\n          (monthlyShares[share.activity_id][monthKey] || 0) + 1;\r\n      });\r\n\r\n      // Get all months\r\n      const allMonths = new Set<string>();\r\n      Object.values(monthlyShares).forEach(activity => {\r\n        Object.keys(activity).forEach(month => allMonths.add(month));\r\n      });\r\n\r\n      const sortedMonths = Array.from(allMonths).sort();\r\n\r\n      // Filter to only include activities that have shares\r\n      const activitiesWithShares = Object.keys(monthlyShares);\r\n\r\n      return sortedMonths.map(month => {\r\n        const dataPoint: any = { month };\r\n        \r\n        activitiesWithShares.forEach(activityId => {\r\n          const shareCount = monthlyShares[activityId][month] || 0;\r\n          const name = activityNames[activityId]?.substring(0, 15) || activityId;\r\n          dataPoint[name] = shareCount;\r\n        });\r\n        \r\n        return dataPoint;\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useActivityShareStats = () => {\r\n  return useQuery({\r\n    queryKey: [\"activity-share-stats\"],\r\n    queryFn: async () => {\r\n      // Get all activities with their share counts\r\n      const { data: activities } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"id, title_zh, title_en, title_pt\")\r\n        .eq(\"visible\", true);\r\n\r\n      if (!activities || activities.length === 0) return [];\r\n\r\n      // Get share counts for each activity\r\n      const activitiesWithShares = await Promise.all(\r\n        activities.map(async (activity) => {\r\n          const { count } = await supabase\r\n            .from(\"activity_shares\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"activity_id\", activity.id);\r\n\r\n          return {\r\n            id: activity.id,\r\n            name: (activity.title_zh || activity.title_en).substring(0, 15),\r\n            shares: count || 0,\r\n          };\r\n        })\r\n      );\r\n\r\n      // Sort by shares descending and take top 10\r\n      return activitiesWithShares\r\n        .sort((a, b) => b.shares - a.shares)\r\n        .slice(0, 10);\r\n    },\r\n  });\r\n};\r\n"],"names":["getUserRole","userId","data","supabase","useAdminUsers","user","useAuth","useQuery","fetchAllProfiles","allProfiles","page","pageSize","hasMore","error","fetchAllRoles","allRoles","profiles","roles","sessionResult","currentUserRoleResult","roleMap","r","emailMap","createdAtMap","lastSignInMap","response","e","usersWithRoles","profile","supervisorRestaurants","restaurantError","restaurantIds","merchantRestaurantLinks","linksError","merchantIds","link","id","validMerchantIds","u","useChangeRole","toast","useToast","queryClient","useQueryClient","useMutation","role","i18n","useAdminRestaurants","merchantRestaurants","mrError","mr","useOperationLogs","log","useUpdateMerchantProfile","display_name","phone","avatar_url","useUploadMerchantAvatar","file","fileExt","fileName","filePath","uploadError","publicUrl","useAdminStats","merchantsCount","restaurantsCount","commentsCount","count","usersCount","activitiesCount","useTopRestaurants","isSupervisor","query","restaurant","useRestaurantRatingTrends","restaurantNames","restaurants","ratings","monthlyAverages","rating","date","monthKey","allMonths","month","dataPoint","restaurantId","restaurantData","avgRating","useRestaurantCommentTrends","comments","monthlyCounts","comment","useActivityEngagement","activities","activity","subscribers","useDeleteActivity","activityId","useDeleteRestaurant","useDeleteUser","useBanUser","banReason","useUnbanUser","useMuteUser","muteReason","mutedUntil","userProfile","userLang","durationText","mutedUntilDate","notificationTitle","notificationContent","useUnmuteUser","useBannedUsers","useMutedUsers","useBatchDeleteUsers","userIds","deletePromises","useBatchDeleteRestaurants","useBatchDeleteActivities","activityIds","useBatchChangeRole","upserts","useToggleRestaurantVisibility","visible","useActivityShareTrends","a","activityNames","shares","monthlyShares","share","sortedMonths","activitiesWithShares","shareCount","name","useActivityShareStats","b"],"mappings":"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"}