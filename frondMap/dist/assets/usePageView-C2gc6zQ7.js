import{l,r as i,s}from"./index-DjxB8hoH.js";const a="location_cache",u=()=>{const r="visitor_id";let t=localStorage.getItem(r);return t||(t=crypto.randomUUID(),localStorage.setItem(r,t)),t},y=()=>{try{const r=sessionStorage.getItem(a);if(r)return JSON.parse(r)}catch{}return null},g=r=>{try{sessionStorage.setItem(a,JSON.stringify(r))}catch{}},f=async()=>{const r=y();if(r)return r;try{const{data:t,error:e}=await s.functions.invoke("get-location");if(e)return console.error("Failed to fetch location:",e),{country:null,city:null,region:null};const o={country:(t==null?void 0:t.country)||null,city:(t==null?void 0:t.city)||null,region:(t==null?void 0:t.region)||null,ip:(t==null?void 0:t.ip)||null};return(o.country||o.city)&&g(o),o}catch(t){return console.error("Failed to fetch location data:",t),{country:null,city:null,region:null}}},p=({pageType:r,targetId:t})=>{const{user:e}=l(),o=i.useRef(!1);i.useEffect(()=>{if(o.current)return;o.current=!0,(async()=>{try{const n=u(),c=await f();await s.from("page_views").insert({page_type:r,target_id:t||null,visitor_id:n,user_id:(e==null?void 0:e.id)||null,user_agent:navigator.userAgent,referer:document.referrer||null,country:c.country,city:c.city,region:c.region})}catch(n){console.error("Failed to track page view:",n)}})()},[r,t,e==null?void 0:e.id])};export{p as u};
