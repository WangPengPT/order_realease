{"version":3,"file":"RestaurantComments-CZUH4OEM.js","sources":["../../src/components/RestaurantComments.tsx"],"sourcesContent":["import { useState, useCallback, useMemo, memo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useComments, useAddComment, useDeleteComment, Comment } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useCheckSensitiveWords } from \"@/hooks/useSensitiveWords\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { MessageSquare, Trash2, Reply, Image as ImageIcon, X, Star, DollarSign, ShieldAlert, VolumeX, Clock, AlertCircle } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\n\r\ninterface RestaurantCommentsProps {\r\n  restaurantId: string;\r\n  targetType?: \"restaurant\" | \"activity\";\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\nconst RestaurantComments = ({ restaurantId, targetType = \"restaurant\" }: RestaurantCommentsProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { data: profile } = useProfile();\r\n  const { isAdmin } = useUserRole();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [priceRange, setPriceRange] = useState(\"\");\r\n  const [replyTo, setReplyTo] = useState<string | null>(null);\r\n  const [replyContent, setReplyContent] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState<File | null>(null);\r\n  const [commentImagePreview, setCommentImagePreview] = useState<string | null>(null);\r\n  const [replyImage, setReplyImage] = useState<File | null>(null);\r\n  const [replyImagePreview, setReplyImagePreview] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n\r\n  const { data: comments, isLoading } = useComments(restaurantId, targetType);\r\n  const addComment = useAddComment();\r\n  const deleteComment = useDeleteComment();\r\n  const { checkContent } = useCheckSensitiveWords();\r\n\r\n  const uploadImage = useCallback(async (file: File): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from(\"comment-images\")\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"comment-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.imageUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return null;\r\n    }\r\n  }, [user, toast, t]);\r\n\r\n  const handleImageSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, isReply: boolean = false) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"restaurant.imageTooLarge\"),\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (isReply) {\r\n        setReplyImage(file);\r\n        setReplyImagePreview(URL.createObjectURL(file));\r\n      } else {\r\n        setCommentImage(file);\r\n        setCommentImagePreview(URL.createObjectURL(file));\r\n      }\r\n    }\r\n  }, [toast, t]);\r\n\r\n  const clearImage = useCallback((isReply: boolean = false) => {\r\n    if (isReply) {\r\n      setReplyImage(null);\r\n      setReplyImagePreview(null);\r\n    } else {\r\n      setCommentImage(null);\r\n      setCommentImagePreview(null);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmitComment = useCallback(async () => {\r\n    if (!newComment.trim() || !user) return;\r\n    \r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(newComment);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // For restaurant comments, require rating\r\n    if (targetType === \"restaurant\" && !rating) {\r\n      toast({\r\n        title: t(\"common.hint\", \"提示\"),\r\n        description: t(\"toast.pleaseSelectRating\"),\r\n        variant: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (commentImage) {\r\n      const uploadedUrl = await uploadImage(commentImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: restaurantId,\r\n      targetType: targetType,\r\n      content: newComment,\r\n      ratingValue: targetType === \"restaurant\" ? rating : undefined,\r\n      priceRange: targetType === \"restaurant\" && priceRange ? priceRange : undefined,\r\n      imageUrl,\r\n    });\r\n\r\n    setNewComment(\"\");\r\n    setRating(0);\r\n    setPriceRange(\"\");\r\n    setCommentImage(null);\r\n    setCommentImagePreview(null);\r\n    setUploading(false);\r\n  }, [newComment, user, profile, targetType, rating, toast, t, commentImage, uploadImage, addComment, restaurantId, priceRange, checkContent]);\r\n\r\n  const handleSubmitReply = useCallback(async (parentId: string) => {\r\n    if (!replyContent.trim() || !user) return;\r\n\r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(replyContent);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (replyImage) {\r\n      const uploadedUrl = await uploadImage(replyImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: restaurantId,\r\n      targetType: targetType,\r\n      content: replyContent,\r\n      parentId,\r\n      imageUrl,\r\n    });\r\n\r\n    setReplyContent(\"\");\r\n    setReplyTo(null);\r\n    setReplyImage(null);\r\n    setReplyImagePreview(null);\r\n    setUploading(false);\r\n  }, [replyContent, user, profile, replyImage, uploadImage, addComment, restaurantId, targetType, checkContent, toast, t]);\r\n\r\n  const handleDeleteComment = useCallback(async (commentId: string) => {\r\n    await deleteComment.mutateAsync(commentId);\r\n    setDeleteConfirmId(null);\r\n  }, [deleteComment]);\r\n\r\n  const CommentItem = memo(({ comment, isReply = false }: { comment: Comment; isReply?: boolean }) => (\r\n    <div className={`flex gap-2 sm:gap-3 ${isReply ? \"ml-8 sm:ml-12 mt-3\" : \"\"}`}>\r\n      <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n        <AvatarImage src={comment.profiles?.avatar_url} />\r\n        <AvatarFallback className=\"text-xs sm:text-sm\">\r\n          {comment.profiles?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n        </AvatarFallback>\r\n      </Avatar>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-semibold text-xs sm:text-sm truncate\">{comment.profiles?.display_name}</span>\r\n          <span className=\"text-xs text-muted-foreground shrink-0\">\r\n            {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true })}\r\n          </span>\r\n          {comment.edited && (\r\n            <span className=\"text-xs text-muted-foreground italic\">({t(\"restaurant.edited\")})</span>\r\n          )}\r\n          {/* Show moderation status badges for user's own comments */}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"pending\" && (\r\n            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs py-0 h-5\">\r\n              <Clock className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentPending\", \"审核中\")}\r\n            </Badge>\r\n          )}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"flagged\" && (\r\n            <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs py-0 h-5\">\r\n              <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentFailed\", \"发送失败\")}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Display rating and price range for main comments */}\r\n        {!isReply && comment.rating_value && (\r\n          <div className=\"flex items-center gap-3 mt-1 mb-2\">\r\n            <div className=\"flex items-center gap-1\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-4 h-4\",\r\n                    star <= comment.rating_value!\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            {comment.price_range && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <DollarSign className=\"w-3 h-3\" />\r\n                <span>{priceRanges.find(r => r.value === comment.price_range)?.label}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        <p className=\"text-xs sm:text-sm mt-1 text-foreground break-words\">{comment.content}</p>\r\n        {comment.image_url && (\r\n          <img\r\n            src={comment.image_url}\r\n            alt=\"Comment attachment\"\r\n            className=\"mt-2 rounded-lg max-w-full sm:max-w-sm w-full\"\r\n          />\r\n        )}\r\n        <div className=\"flex gap-2 sm:gap-3 mt-2\">\r\n          {!isReply && user && !profile?.is_muted && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setReplyTo(comment.id)}\r\n              className=\"h-7 text-xs px-2 sm:px-3\"\r\n            >\r\n              <Reply className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"restaurant.reply\")}</span>\r\n            </Button>\r\n          )}\r\n          {(user?.id === comment.user_id || isAdmin) && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setDeleteConfirmId(comment.id)}\r\n              className=\"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"common.delete\")}</span>\r\n            </Button>\r\n          )}\r\n          {user?.id !== comment.user_id && (\r\n            <ReportDialog\r\n              targetType=\"comment\"\r\n              targetId={comment.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-7 text-xs px-2 sm:px-3\"\r\n                >\r\n                  <ShieldAlert className=\"w-3 h-3 mr-1\" />\r\n                  <span className=\"hidden xs:inline\">{t(\"report.title\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {replyTo === comment.id && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-col sm:flex-row gap-2\">\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeReply\")}\r\n                  className=\"min-h-[80px] text-sm\"\r\n                />\r\n                {replyImagePreview && (\r\n                  <div className=\"relative inline-block max-w-full\">\r\n                    <img\r\n                      src={replyImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"max-w-full sm:max-w-xs rounded-lg\"\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(true)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex sm:flex-col gap-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleSubmitReply(comment.id)}\r\n                  disabled={!replyContent.trim() || uploading}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {uploading ? t(\"common.loading\") : t(\"restaurant.reply\")}\r\n                </Button>\r\n                <Input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => handleImageSelect(e, true)}\r\n                  className=\"hidden\"\r\n                  id={`reply-image-${comment.id}`}\r\n                  disabled={uploading}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => document.getElementById(`reply-image-${comment.id}`)?.click()}\r\n                  disabled={uploading}\r\n                  className=\"text-xs sm:px-3\"\r\n                >\r\n                  <ImageIcon className=\"h-4 w-4 sm:mr-1\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setReplyTo(null);\r\n                    setReplyContent(\"\");\r\n                    clearImage(true);\r\n                  }}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {comment.replies && comment.replies.length > 0 && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            {comment.replies.map((reply) => (\r\n              <CommentItem key={reply.id} comment={reply} isReply />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  ));\r\n  CommentItem.displayName = \"CommentItem\";\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <MessageSquare className=\"w-4 sm:w-5 h-4 sm:h-5\" />\r\n        <h2 className=\"text-xl sm:text-2xl font-bold\">\r\n          {t(\"restaurant.reviews\")} ({comments?.length || 0})\r\n        </h2>\r\n      </div>\r\n\r\n      {user ? (\r\n        profile?.is_muted ? (\r\n          <Card className=\"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20\">\r\n            <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6\">\r\n              <div className=\"flex items-center gap-3 text-yellow-600 dark:text-yellow-400\">\r\n                <VolumeX className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-sm font-medium\">{t(\"restaurant.youAreMutedNotice\")}</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n        <Card>\r\n          <CardContent className=\"pt-4 sm:pt-6 px-3 sm:px-6\">\r\n            <div className=\"flex gap-2 sm:gap-3\">\r\n              <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n                <AvatarImage src={profile?.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-xs sm:text-sm\">\r\n                  {profile?.display_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1 space-y-2 sm:space-y-3 min-w-0\">\r\n                {/* Rating and Price Range - Only for restaurant */}\r\n                {targetType === \"restaurant\" && (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Star className=\"w-4 h-4 text-accent\" />\r\n                        评分 <span className=\"text-destructive\">*</span>\r\n                      </label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onMouseEnter={() => setHoverRating(star)}\r\n                            onMouseLeave={() => setHoverRating(0)}\r\n                            onClick={() => setRating(star)}\r\n                            className=\"transition-transform hover:scale-110\"\r\n                          >\r\n                            <Star\r\n                              className={cn(\r\n                                \"w-7 h-7 cursor-pointer transition-colors\",\r\n                                star <= (hoverRating || rating)\r\n                                  ? \"fill-accent text-accent\"\r\n                                  : \"text-muted-foreground hover:text-accent\"\r\n                              )}\r\n                            />\r\n                          </button>\r\n                        ))}\r\n                        {rating > 0 && (\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">\r\n                            ({rating}/5)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <DollarSign className=\"w-4 h-4\" />\r\n                        {t(\"restaurant.priceRange\")}\r\n                      </label>\r\n                      <Select value={priceRange} onValueChange={setPriceRange}>\r\n                        <SelectTrigger className=\"w-full\">\r\n                          <SelectValue placeholder={t(\"restaurant.selectPriceRange\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-background\">\r\n                          {priceRanges.map((range) => (\r\n                            <SelectItem key={range.value} value={range.value}>\r\n                              {range.label}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Textarea\r\n                  value={newComment}\r\n                  onChange={(e) => setNewComment(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeComment\")}\r\n                  className=\"min-h-[80px] sm:min-h-[100px] text-sm\"\r\n                />\r\n                {commentImagePreview && (\r\n                  <div className=\"relative inline-block max-w-full\">\r\n                    <img\r\n                      src={commentImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"max-w-full sm:max-w-xs rounded-lg\"\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(false)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => handleImageSelect(e, false)}\r\n                    className=\"hidden\"\r\n                    id=\"comment-image\"\r\n                    disabled={uploading}\r\n                  />\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => document.getElementById(\"comment-image\")?.click()}\r\n                    disabled={uploading}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    <ImageIcon className=\"h-4 w-4 sm:mr-2\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmitComment}\r\n                    disabled={!newComment.trim() || addComment.isPending || uploading}\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                  >\r\n                    {uploading || addComment.isPending ? t(\"common.loading\") : t(\"restaurant.postComment\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.signInToComment\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <div className=\"space-y-4 sm:space-y-6\">\r\n        {comments?.map((comment) => (\r\n          <Card key={comment.id}>\r\n            <CardHeader className=\"p-3 sm:p-6\">\r\n              <CommentItem comment={comment} />\r\n            </CardHeader>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {comments?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.noComments\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n\r\n    {/* Login Required Dialog */}\r\n    <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {t(\"activities.loginRequiredMessage\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n          <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n            {t(\"activities.goToLogin\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n\r\n    {/* Delete Comment Confirmation Dialog */}\r\n    <AlertDialog open={!!deleteConfirmId} onOpenChange={(open) => !open && setDeleteConfirmId(null)}>\r\n      <AlertDialogContent className=\"max-w-sm\">\r\n        <AlertDialogHeader>\r\n          <div className=\"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-destructive/10\">\r\n            <Trash2 className=\"h-7 w-7 text-destructive\" />\r\n          </div>\r\n          <AlertDialogTitle className=\"text-center\">\r\n            {t(\"restaurant.deleteComment\")}\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-center\">\r\n            {t(\"restaurant.confirmDelete\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter className=\"sm:justify-center gap-2\">\r\n          <AlertDialogCancel className=\"sm:w-24\">\r\n            {t(\"common.cancel\")}\r\n          </AlertDialogCancel>\r\n          <AlertDialogAction\r\n            onClick={() => deleteConfirmId && handleDeleteComment(deleteConfirmId)}\r\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90 sm:w-24\"\r\n          >\r\n            {t(\"common.delete\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RestaurantComments;\r\n"],"names":["priceRanges","RestaurantComments","restaurantId","targetType","t","useTranslation","user","useAuth","profile","useProfile","isAdmin","useUserRole","toast","useToast","navigate","useNavigate","newComment","setNewComment","useState","rating","setRating","hoverRating","setHoverRating","priceRange","setPriceRange","replyTo","setReplyTo","replyContent","setReplyContent","commentImage","setCommentImage","commentImagePreview","setCommentImagePreview","replyImage","setReplyImage","replyImagePreview","setReplyImagePreview","uploading","setUploading","showLoginDialog","setShowLoginDialog","deleteConfirmId","setDeleteConfirmId","comments","isLoading","useComments","addComment","useAddComment","deleteComment","useDeleteComment","checkContent","useCheckSensitiveWords","uploadImage","useCallback","file","fileExt","filePath","uploadError","data","supabase","publicUrl","error","handleImageSelect","e","isReply","clearImage","handleSubmitComment","imageUrl","uploadedUrl","handleSubmitReply","parentId","handleDeleteComment","commentId","CommentItem","memo","comment","jsxs","Avatar","jsx","AvatarImage","AvatarFallback","Badge","Clock","AlertCircle","star","Star","cn","DollarSign","r","Button","Reply","Trash2","ReportDialog","ShieldAlert","Textarea","X","Input","ImageIcon","reply","Fragment","MessageSquare","Card","CardContent","VolumeX","Select","SelectTrigger","SelectValue","SelectContent","range","SelectItem","CardHeader","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","open"],"mappings":"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"}