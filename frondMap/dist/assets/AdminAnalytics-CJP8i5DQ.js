import{p as ne,s as T,r as S,u as me,z as fe,j as e,D as pe,aa as ge,B as R,t as ye,a4 as je,a5 as we,aI as ie,Z as ve,$ as Ne,a0 as be,a1 as _e,n as $,as as De,M as xe,a_ as Se,a$ as ke,b0 as Ce,d as Me,C,e as M,o as E,f as L,S as Ee,b as Le,aU as ee}from"./index-DVul3rRI.js";import{s as ce}from"./startOfDay-BNzNGG7l.js";import{s as Ve}from"./subDays-BT2GcUDp.js";import{f as K}from"./format-Il-ANUNE.js";import{U as le}from"./users-DLqoVkAn.js";import{R as he}from"./refresh-cw-BZqj5MZ-.js";import{E as Te}from"./eye-BCkNdHAq.js";import{T as se}from"./trending-up-ZVxTRXP-.js";import{R as B,L as te,C as W,X as G,Y as X,T as I,b as J,c as Ae,B as ae,a as oe}from"./LineChart-CpEMOyhg.js";import{C as Oe}from"./chart-column-GA67r7ff.js";import{P as Ue,a as ze}from"./PieChart-CdKroEtG.js";import{B as re}from"./BarChart-DX3HF-uR.js";import{L as Fe}from"./link-2-CYcbiZzr.js";import{B as Re}from"./building-BX_yGYTW.js";import"./isEqual-D9KOwNhl.js";const Ke=r=>{if(!r)return"direct";try{return new URL(r).hostname.replace("www.","")}catch{return"unknown"}},qe=(r=30)=>ne({queryKey:["analytics",r],queryFn:async()=>{let d=null;r===1?d=ce(new Date).toISOString():r>1&&(d=ce(Ve(new Date,r-1)).toISOString());const N=1e3;let V=[],v=0,A=!0;for(;A;){let a=T.from("page_views").select("*").order("created_at",{ascending:!1}).range(v*N,(v+1)*N-1);d&&(a=a.gte("created_at",d));const{data:n,error:u}=await a;if(u)throw u;n&&n.length>0?(V=V.concat(n),A=n.length===N,v++):A=!1}const m=V,b=m.length,O=new Set(m.map(a=>a.visitor_id)).size,U={};m.forEach(a=>{U[a.page_type]=(U[a.page_type]||0)+1});const z=new Map;m.forEach(a=>{const n=K(new Date(a.created_at),"yyyy-MM-dd");z.has(n)||z.set(n,{views:0,visitors:new Set});const u=z.get(n);u.views++,u.visitors.add(a.visitor_id)});const x=Array.from(z.entries()).map(([a,n])=>({date:a,views:n.views,uniqueVisitors:n.visitors.size})).sort((a,n)=>a.date.localeCompare(n.date)),c=new Map;m.forEach(a=>{const n=Ke(a.referer);c.set(n,(c.get(n)||0)+1)});const j=Array.from(c.entries()).map(([a,n])=>({domain:a,count:n,percentage:b>0?n/b*100:0})).sort((a,n)=>n.count-a.count),p=new Map;m.forEach(a=>{const n=a.country||"unknown";p.set(n,(p.get(n)||0)+1)});const _=Array.from(p.entries()).map(([a,n])=>({location:a,count:n,percentage:b>0?n/b*100:0})).sort((a,n)=>n.count-a.count),l=new Map;m.forEach(a=>{const n=a.city||"unknown";l.set(n,(l.get(n)||0)+1)});const h=Array.from(l.entries()).map(([a,n])=>({location:a,count:n,percentage:b>0?n/b*100:0})).sort((a,n)=>n.count-a.count),D=new Map;m.forEach(a=>{const n=K(new Date(a.created_at),"yyyy-MM-dd"),u=a.country||"unknown";D.has(u)||D.set(u,new Map);const f=D.get(u);f.set(n,(f.get(n)||0)+1)});const o=[];D.forEach((a,n)=>{a.forEach((u,f)=>{o.push({date:f,location:n,views:u})})}),o.sort((a,n)=>a.date.localeCompare(n.date));const k=new Map;m.forEach(a=>{const n=K(new Date(a.created_at),"yyyy-MM-dd"),u=a.city||"unknown";k.has(u)||k.set(u,new Map);const f=k.get(u);f.set(n,(f.get(n)||0)+1)});const g=[];k.forEach((a,n)=>{a.forEach((u,f)=>{g.push({date:f,location:n,views:u})})}),g.sort((a,n)=>a.date.localeCompare(n.date));const y=new Map;m.filter(a=>a.page_type==="restaurant"&&a.target_id).forEach(a=>{y.set(a.target_id,(y.get(a.target_id)||0)+1)});const F=Array.from(y.entries()).sort((a,n)=>n[1]-a[1]).slice(0,10);let Y=[];if(F.length>0){const{data:a}=await T.from("restaurants").select("id, name").in("id",F.map(n=>n[0]));Y=F.map(([n,u])=>{var f;return{id:n,name:((f=a==null?void 0:a.find(H=>H.id===n))==null?void 0:f.name)||"Unknown",views:u}})}const P=new Map;m.filter(a=>a.page_type==="activity"&&a.target_id).forEach(a=>{P.set(a.target_id,(P.get(a.target_id)||0)+1)});const Z=Array.from(P.entries()).sort((a,n)=>n[1]-a[1]).slice(0,10);let Q=[];if(Z.length>0){const{data:a}=await T.from("activities").select("id, title_zh, title_en, title_pt").in("id",Z.map(n=>n[0]));Q=Z.map(([n,u])=>{const f=a==null?void 0:a.find(H=>H.id===n);return{id:n,title:(f==null?void 0:f.title_zh)||(f==null?void 0:f.title_en)||"Unknown",views:u}})}return{totalViews:b,uniqueVisitors:O,viewsByPage:U,dailyViews:x,topRestaurants:Y,topActivities:Q,refererStats:j,countryStats:_,cityStats:h,countryDailyViews:o,cityDailyViews:g}}}),ue=()=>{const[r,d]=S.useState(new Set),[N,V]=S.useState(null);S.useEffect(()=>{console.log("Initializing online users observer...");const x=T.channel("online-users");return x.on("presence",{event:"sync"},()=>{const c=x.presenceState(),j=new Set;Object.keys(c).forEach(p=>{j.add(p)}),d(j),console.log("Presence sync - online users:",Array.from(j))}).on("presence",{event:"join"},({key:c,newPresences:j})=>{console.log("User joined:",c,j),d(p=>new Set([...p,c]))}).on("presence",{event:"leave"},({key:c,leftPresences:j})=>{console.log("User left:",c,j),d(p=>{const _=new Set(p);return _.delete(c),_})}).subscribe(c=>{console.log("Presence channel status:",c)}),V(x),()=>{console.log("Cleaning up online users observer..."),T.removeChannel(x)}},[]);const{data:v,isLoading:A,refetch:m}=ne({queryKey:["online-users-details",Array.from(r).sort().join(",")],queryFn:async()=>{if(r.size===0)return[];const x=Array.from(r);console.log("Fetching details for online users:",x);const{data:c,error:j}=await T.from("user_presence").select("*").in("user_id",x);j&&console.error("Error fetching presence:",j);const{data:p,error:_}=await T.rpc("get_public_profiles",{user_ids:x});_&&console.error("Error fetching profiles:",_);const{data:l,error:h}=await T.from("user_roles").select("user_id, role").in("user_id",x);h&&console.error("Error fetching roles:",h);const D=new Map((c||[]).map(g=>[g.user_id,g])),o=new Map((p||[]).map(g=>[g.id,g])),k=new Map((l||[]).map(g=>[g.user_id,g.role]));return x.map(g=>{const y=D.get(g),F=o.get(g);return{user_id:g,is_online:!0,last_seen:(y==null?void 0:y.last_seen)||new Date().toISOString(),ip_address:y==null?void 0:y.ip_address,city:y==null?void 0:y.city,country:y==null?void 0:y.country,profile:F?{display_name:F.display_name,avatar_url:F.avatar_url}:void 0,role:k.get(g)}})},enabled:r.size>0,staleTime:1e4}),{data:b,refetch:t}=ne({queryKey:["online-users-db-fallback"],queryFn:async()=>{const x=new Date(Date.now()-12e4).toISOString(),{data:c,error:j}=await T.from("user_presence").select("*").gte("last_seen",x).order("last_seen",{ascending:!1});if(j)return console.error("Error fetching DB presence:",j),[];if(!c||c.length===0)return[];const p=c.map(o=>o.user_id),{data:_}=await T.rpc("get_public_profiles",{user_ids:p}),{data:l}=await T.from("user_roles").select("user_id, role").in("user_id",p),h=new Map((_||[]).map(o=>[o.id,o])),D=new Map((l||[]).map(o=>[o.user_id,o.role]));return c.map(o=>({user_id:o.user_id,is_online:o.is_online,last_seen:o.last_seen,ip_address:o.ip_address,city:o.city,country:o.country,profile:h.get(o.user_id)?{display_name:h.get(o.user_id).display_name,avatar_url:h.get(o.user_id).avatar_url}:void 0,role:D.get(o.user_id)}))},refetchInterval:3e4}),O=(()=>{const x=new Map;return(b||[]).forEach(c=>{x.set(c.user_id,c)}),(v||[]).forEach(c=>{x.set(c.user_id,{...c,is_online:!0})}),r.forEach(c=>{x.has(c)||x.set(c,{user_id:c,is_online:!0,last_seen:new Date().toISOString()})}),Array.from(x.values())})(),U=O.length;return{onlineUsers:O,onlineCount:U,isLoading:A,refetch:async()=>{await Promise.all([m(),t()])}}},Be=({trigger:r})=>{const{t:d,i18n:N}=me(),[V,v]=S.useState(!1),[A,m]=S.useState(!1),{onlineUsers:b,onlineCount:t,isLoading:O,refetch:U}=ue(),z=S.useCallback(async()=>{m(!0);try{await U(),fe.success(d("common.refreshed","已刷新"))}finally{m(!1)}},[U,d]),x=()=>{switch(N.language){case"zh":return Ce;case"pt":return ke;default:return Se}},c=l=>{switch(l){case"admin":return"destructive";case"supervisor":return"default";case"merchant":return"secondary";default:return"outline"}},j=l=>{switch(l){case"admin":return d("admin.role.admin","管理员");case"supervisor":return d("admin.role.supervisor","主管");case"merchant":return d("admin.role.merchant","商家");default:return d("admin.role.user","用户")}},p=(l,h)=>l&&h?`${l}, ${h}`:l||h||null,_=l=>l.city||l.country||l.ip_address;return e.jsxs(pe,{open:V,onOpenChange:v,children:[e.jsx(ge,{asChild:!0,children:r||e.jsxs(R,{variant:"outline",size:"sm",children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),d("admin.onlineUsers.viewOnline","查看在线用户")]})}),e.jsxs(ye,{className:"max-w-md",children:[e.jsx(je,{children:e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-3 h-3 fill-green-500 text-green-500"}),d("admin.onlineUsers.title","在线用户")," (",t,")"]})}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(R,{variant:"ghost",size:"sm",onClick:z,disabled:O||A,children:[e.jsx(he,{className:`w-4 h-4 mr-1 ${O||A?"animate-spin":""}`}),d("common.refresh","刷新")]})}),e.jsx(ve,{className:"h-[400px] pr-4",children:O?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:d("common.loading","加载中...")}):b.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:d("admin.onlineUsers.noOnline","暂无在线用户")}):e.jsx("div",{className:"space-y-3",children:b.map(l=>{var h,D,o,k;return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(Ne,{className:"h-10 w-10",children:[e.jsx(be,{src:((h=l.profile)==null?void 0:h.avatar_url)||void 0}),e.jsx(_e,{children:((o=(D=l.profile)==null?void 0:D.display_name)==null?void 0:o.charAt(0))||"?"})]}),e.jsx(ie,{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${l.is_online?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:((k=l.profile)==null?void 0:k.display_name)||d("common.anonymous","匿名用户")}),e.jsx($,{variant:c(l.role),className:"text-xs",children:j(l.role)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.is_online?d("admin.onlineUsers.online","在线中"):d("admin.onlineUsers.lastSeen","最后活跃 {{time}}",{time:De(new Date(l.last_seen),{addSuffix:!0,locale:x()})})}),_(l)&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:[p(l.city,l.country)&&e.jsx("span",{children:p(l.city,l.country)}),l.ip_address&&e.jsxs(e.Fragment,{children:[p(l.city,l.country)&&e.jsx("span",{className:"mx-1",children:"·"}),e.jsx("span",{className:"font-mono text-[10px]",children:l.ip_address})]})]})]})]})]},l.user_id)})})})]})]})},de=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--muted-foreground))"],q=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],rs=()=>{var a,n,u,f,H;const{t:r,i18n:d}=me(),[N,V]=S.useState(30),[v,A]=S.useState([]),[m,b]=S.useState([]),{data:t,isLoading:O,refetch:U,isRefetching:z}=qe(N),{onlineCount:x,isLoading:c}=ue(),j={home:r("analytics.pageTypes.home","首页"),restaurant:r("analytics.pageTypes.restaurant","餐厅详情"),activity:r("analytics.pageTypes.activity","活动详情"),restaurants:r("analytics.pageTypes.restaurants","餐厅列表"),activities:r("analytics.pageTypes.activities","活动列表"),map:r("analytics.pageTypes.map","地图"),profile:r("analytics.pageTypes.profile","个人资料"),auth:r("analytics.pageTypes.auth","登录/注册"),"join-us":r("analytics.pageTypes.joinUs","加入我们"),other:r("analytics.pageTypes.other","其他")},p={direct:r("analytics.referer.direct","直接访问"),unknown:r("analytics.referer.unknown","未知来源")},_={unknown:r("analytics.location.unknown","未知地区")},l=s=>p[s]||s,h=s=>_[s]||s,D=S.useMemo(()=>{var s;return((s=t==null?void 0:t.countryStats)==null?void 0:s.slice(0,10).map(i=>i.location))||[]},[t==null?void 0:t.countryStats]),o=S.useMemo(()=>{var s;return((s=t==null?void 0:t.cityStats)==null?void 0:s.slice(0,10).map(i=>i.location))||[]},[t==null?void 0:t.cityStats]),k=S.useMemo(()=>{if(!(t!=null&&t.countryDailyViews)||v.length===0)return[];const s=new Map;return t.countryDailyViews.filter(i=>v.includes(i.location)).forEach(i=>{s.has(i.date)||s.set(i.date,{}),s.get(i.date)[i.location]=i.views}),Array.from(s.entries()).map(([i,w])=>({date:i,...w})).sort((i,w)=>i.date.localeCompare(w.date))},[t==null?void 0:t.countryDailyViews,v]),g=S.useMemo(()=>{if(!(t!=null&&t.cityDailyViews)||m.length===0)return[];const s=new Map;return t.cityDailyViews.filter(i=>m.includes(i.location)).forEach(i=>{s.has(i.date)||s.set(i.date,{}),s.get(i.date)[i.location]=i.views}),Array.from(s.entries()).map(([i,w])=>({date:i,...w})).sort((i,w)=>i.date.localeCompare(w.date))},[t==null?void 0:t.cityDailyViews,m]),y=t!=null&&t.viewsByPage?Object.entries(t.viewsByPage).map(([s,i])=>({name:j[s]||s,value:i})):[],F=((a=t==null?void 0:t.refererStats)==null?void 0:a.slice(0,10).map(s=>({name:l(s.domain),value:s.count,percentage:s.percentage.toFixed(1)})))||[],Y=((n=t==null?void 0:t.countryStats)==null?void 0:n.slice(0,10).map(s=>({name:h(s.location),value:s.count,percentage:s.percentage.toFixed(1)})))||[],P=((u=t==null?void 0:t.cityStats)==null?void 0:u.slice(0,10).map(s=>({name:h(s.location),value:s.count,percentage:s.percentage.toFixed(1)})))||[],Z=s=>{A(i=>i.includes(s)?i.filter(w=>w!==s):i.length<5?[...i,s]:i)},Q=s=>{b(i=>i.includes(s)?i.filter(w=>w!==s):i.length<5?[...i,s]:i)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:r("analytics.title","访问统计")}),e.jsx("p",{className:"text-muted-foreground",children:r("analytics.description","网站访问数据分析")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(R,{variant:N===1?"default":"outline",size:"sm",onClick:()=>V(1),children:r("analytics.today","今日")}),[7,30,90].map(s=>e.jsxs(R,{variant:N===s?"default":"outline",size:"sm",onClick:()=>V(s),children:[s,r("analytics.days","天")]},s)),e.jsx(R,{variant:N===0?"default":"outline",size:"sm",onClick:()=>V(0),children:r("analytics.all","所有")})]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>U(),disabled:z,children:[e.jsx(he,{className:`w-4 h-4 mr-1 ${z?"animate-spin":""}`}),r("common.refresh","刷新")]})]})]}),O?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,i)=>e.jsx(Me,{className:"h-32"},i))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(C,{className:"border-green-500/50 bg-green-500/5",children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(E,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 fill-green-500 text-green-500"}),r("analytics.onlineUsers","在线用户")]}),e.jsx(le,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:c?"-":x}),e.jsx("div",{className:"mt-2",children:e.jsx(Be,{trigger:e.jsxs(R,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700",children:[r("analytics.viewOnlineUsers","查看在线用户")," →"]})})})]})]}),e.jsxs(C,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:r("analytics.totalViews","总访问量")}),e.jsx(Te,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t==null?void 0:t.totalViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N===0?r("analytics.allTime","所有时间"):N===1?r("analytics.today","今日"):r("analytics.lastNDays","最近{{days}}天",{days:N})})]})]}),e.jsxs(C,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:r("analytics.uniqueVisitors","独立访客")}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t==null?void 0:t.uniqueVisitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("analytics.uniqueVisitorDesc","基于访客ID")})]})]}),e.jsxs(C,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:r("analytics.restaurantViews","餐厅浏览")}),e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(((f=t==null?void 0:t.viewsByPage)==null?void 0:f.restaurant)||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("analytics.restaurantViewsDesc","餐厅详情页访问")})]})]}),e.jsxs(C,{children:[e.jsxs(M,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(E,{className:"text-sm font-medium",children:r("analytics.activityViews","活动浏览")}),e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(L,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(((H=t==null?void 0:t.viewsByPage)==null?void 0:H.activity)||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("analytics.activityViewsDesc","活动详情页访问")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),r("analytics.dailyTrend","每日访问趋势")]})}),e.jsx(L,{children:e.jsx("div",{className:"h-[300px]",children:t!=null&&t.dailyViews&&t.dailyViews.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(te,{data:t.dailyViews,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>K(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(X,{className:"text-xs"}),e.jsx(I,{labelFormatter:s=>K(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(J,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:r("analytics.views","访问量")}),e.jsx(J,{type:"monotone",dataKey:"uniqueVisitors",stroke:"hsl(var(--chart-2))",strokeWidth:2,name:r("analytics.uniqueVisitors","独立访客")})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:r("analytics.noData","暂无数据")})})})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),r("analytics.pageDistribution","页面访问分布")]})}),e.jsx(L,{children:e.jsx("div",{className:"h-[300px]",children:y.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(Ue,{children:[e.jsx(ze,{data:y,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:i})=>`${s} ${(i*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:y.map((s,i)=>e.jsx(Ae,{fill:de[i%de.length]},`cell-${i}`))}),e.jsx(I,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:r("analytics.noData","暂无数据")})})})]})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),r("analytics.refererStats","访问来源统计")]})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[300px]",children:F.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(re,{data:F,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(X,{dataKey:"name",type:"category",width:120,className:"text-xs",tick:{fontSize:11}}),e.jsx(I,{formatter:(s,i,w)=>[`${s} (${w.payload.percentage}%)`,r("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ae,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:r("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:t!=null&&t.refererStats&&t.refererStats.length>0?t.refererStats.map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:i<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:i+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[150px]",children:l(s.domain)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.domain)):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:r("analytics.noData","暂无数据")})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),r("analytics.countryStats","国家/地区统计")]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:Y.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(re,{data:Y,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(X,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(I,{formatter:(s,i,w)=>[`${s} (${w.payload.percentage}%)`,r("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ae,{dataKey:"value",fill:"hsl(var(--chart-2))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:r("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:t!=null&&t.countryStats&&t.countryStats.length>0?t.countryStats.slice(0,10).map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:i<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:i+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:h(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:r("analytics.noData","暂无数据")})})]})})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"}),r("analytics.cityStats","城市统计")]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:P.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(re,{data:P,layout:"vertical",children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{type:"number",className:"text-xs"}),e.jsx(X,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(I,{formatter:(s,i,w)=>[`${s} (${w.payload.percentage}%)`,r("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ae,{dataKey:"value",fill:"hsl(var(--chart-3))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:r("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:t!=null&&t.cityStats&&t.cityStats.length>0?t.cityStats.slice(0,10).map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:i<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:i+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:h(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:r("analytics.noData","暂无数据")})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),r("analytics.countryTrend","国家/地区访问趋势")]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map((s,i)=>e.jsx(R,{variant:v.includes(s)?"default":"outline",size:"sm",onClick:()=>Z(s),className:"text-xs",style:v.includes(s)?{backgroundColor:q[v.indexOf(s)%q.length]}:{},children:h(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:k.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(te,{data:k,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>K(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(X,{className:"text-xs"}),e.jsx(I,{labelFormatter:s=>K(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(oe,{}),v.map((s,i)=>e.jsx(J,{type:"monotone",dataKey:s,stroke:q[i%q.length],strokeWidth:2,name:h(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:v.length===0?r("analytics.selectLocations","请选择地区查看趋势"):r("analytics.noData","暂无数据")})})]})})]}),e.jsxs(C,{children:[e.jsx(M,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),r("analytics.cityTrend","城市访问趋势")]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((s,i)=>e.jsx(R,{variant:m.includes(s)?"default":"outline",size:"sm",onClick:()=>Q(s),className:"text-xs",style:m.includes(s)?{backgroundColor:q[m.indexOf(s)%q.length]}:{},children:h(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:g.length>0?e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(te,{data:g,children:[e.jsx(W,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(G,{dataKey:"date",tickFormatter:s=>K(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(X,{className:"text-xs"}),e.jsx(I,{labelFormatter:s=>K(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(oe,{}),m.map((s,i)=>e.jsx(J,{type:"monotone",dataKey:s,stroke:q[i%q.length],strokeWidth:2,name:h(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:m.length===0?r("analytics.selectLocations","请选择地区查看趋势"):r("analytics.noData","暂无数据")})})]})})]})]})]})]})};export{rs as default};
