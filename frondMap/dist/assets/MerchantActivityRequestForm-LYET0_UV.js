import{r as x,j as e}from"./vendor-react-core-BErlw7p5.js";import{o as W,s as i,l as Y,e as Z,u as K,t as Q}from"./vendor-forms-6GCG0Z6m.js";import{d as D,n as ee,r as se,a7 as A,C as M,j as P,B as g,h as re,p as te,a2 as ne,I as c,a1 as b,R as N,X as ae,Y as le,Z as ie,$ as oe,a0 as y,V as w,s as q}from"./index-CEqKPgls.js";import{a9 as L,aa as V,ab as ce}from"./vendor-ui-other-CPTlx-W2.js";import{b as de,ar as xe,af as me,e as he,ai as je,au as pe,o as ue,X as ge}from"./vendor-icons-C2Bicc1E.js";import{F as _e,a as t,b as n,c as o,d as a,e as l,f as fe}from"./form-D7KQkOcz.js";import{u as ve}from"./useActivityRequests-Cl5YQG8n.js";import{u as be}from"./vendor-i18n-CqcxoxDo.js";import{u as Ne}from"./vendor-router-CLK0c9aH.js";import"./vendor-editor-BdQcs4B3.js";import"./vendor-misc-DH4LiFnZ.js";import"./vendor-date-fYlqblcl.js";import"./vendor-query-BS0wY7WL.js";import"./vendor-supabase-Clrw0GhO.js";import"./vendor-ui-dialog-Sv_VEL0d.js";import"./vendor-ui-dropdown-DwTcg2UT.js";const B=x.forwardRef(({className:m,...h},j)=>e.jsx(L,{className:D("grid gap-2",m),...h,ref:j}));B.displayName=L.displayName;const C=x.forwardRef(({className:m,...h},j)=>e.jsx(V,{ref:j,className:D("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",m),...h,children:e.jsx(ce,{className:"flex items-center justify-center",children:e.jsx(de,{className:"h-2.5 w-2.5 fill-current text-current"})})}));C.displayName=V.displayName;const ye=W({title_zh:i().min(1,"中文标题不能为空"),title_en:i().min(1,"英文标题不能为空"),title_pt:i().min(1,"葡萄牙语标题不能为空"),intro_zh:i().optional(),intro_en:i().optional(),intro_pt:i().optional(),content_zh:i().min(1,"中文内容不能为空"),content_en:i().min(1,"英文内容不能为空"),content_pt:i().min(1,"葡萄牙语内容不能为空"),image_url:i().url().optional().or(Y("")),start_date:i().min(1,"开始日期不能为空"),end_date:i().optional(),service_type:Z(["dine_in","takeaway","both"]),badge_text_zh:i().optional(),badge_text_en:i().optional(),badge_text_pt:i().optional(),badge_color:i().optional()}),Be=()=>{be();const m=Ne(),{user:h}=ee(),{isMerchant:j,isSupervisor:E}=se(),$=ve(),[_,z]=x.useState(!1),[f,G]=x.useState("upload"),[X,I]=x.useState(""),[S,F]=x.useState(!1),[u,p]=x.useState(""),v=x.useRef(null),H=async s=>{if(h){if(s.size>5*1024*1024){w({title:"图片太大",description:"图片大小不能超过5MB",variant:"destructive"});return}F(!0);try{const d=s.name.split(".").pop(),U=`activity-requests/${`${h.id}-${Date.now()}.${d}`}`,{error:T}=await q.storage.from("activity-images").upload(U,s);if(T)throw T;const{data:{publicUrl:k}}=q.storage.from("activity-images").getPublicUrl(U);I(k),p(k),w({title:"上传成功",description:"封面图片已上传"})}catch(d){console.error("Upload error:",d),w({title:"上传失败",description:"图片上传失败，请重试",variant:"destructive"})}finally{F(!1)}}},J=s=>{const d=s.target.files?.[0];d&&H(d)},R=()=>{I(""),p(""),v.current&&(v.current.value="")},r=K({resolver:Q(ye),defaultValues:{title_zh:"",title_en:"",title_pt:"",intro_zh:"",intro_en:"",intro_pt:"",content_zh:"",content_en:"",content_pt:"",image_url:"",start_date:new Date().toISOString().split("T")[0],end_date:"",service_type:"both",badge_text_zh:"",badge_text_en:"",badge_text_pt:"",badge_color:"#9b87f5"}});if(!h||!j&&!E)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(M,{children:e.jsxs(P,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(xe,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"无权访问"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"只有商家和主管可以申请创建活动"})]})})})]});const O=async s=>{z(!0);try{const d=f==="upload"?X:s.image_url;await $.mutateAsync({title_zh:s.title_zh,title_en:s.title_en,title_pt:s.title_pt,intro_zh:s.intro_zh||null,intro_en:s.intro_en||null,intro_pt:s.intro_pt||null,content_zh:s.content_zh,content_en:s.content_en,content_pt:s.content_pt,image_url:d||null,start_date:s.start_date,end_date:s.end_date||null,service_type:s.service_type,badge_text_zh:s.badge_text_zh||null,badge_text_en:s.badge_text_en||null,badge_text_pt:s.badge_text_pt||null,badge_color:s.badge_color||"#9b87f5"}),m("/merchant/activity-requests")}finally{z(!1)}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(A,{}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>m("/merchant/activity-requests"),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"申请创建活动"}),e.jsx("p",{className:"text-muted-foreground",children:"填写活动信息，提交后等待管理员审核"})]})]}),e.jsxs(M,{children:[e.jsxs(re,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"活动信息"]}),e.jsx(ne,{children:"请填写完整的活动信息，审核通过后将自动创建活动"})]}),e.jsx(P,{children:e.jsx(_e,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(O),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(t,{control:r.control,name:"title_zh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"中文标题 *"}),e.jsx(a,{children:e.jsx(c,{placeholder:"活动标题",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"title_en",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"英文标题 *"}),e.jsx(a,{children:e.jsx(c,{placeholder:"Activity Title",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"title_pt",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"葡萄牙语标题 *"}),e.jsx(a,{children:e.jsx(c,{placeholder:"Título da Atividade",...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(t,{control:r.control,name:"intro_zh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"中文简介"}),e.jsx(a,{children:e.jsx(c,{placeholder:"简短描述",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"intro_en",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"英文简介"}),e.jsx(a,{children:e.jsx(c,{placeholder:"Brief description",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"intro_pt",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"葡萄牙语简介"}),e.jsx(a,{children:e.jsx(c,{placeholder:"Descrição breve",...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(t,{control:r.control,name:"content_zh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"中文内容 *"}),e.jsx(a,{children:e.jsx(b,{placeholder:"详细描述",rows:5,...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"content_en",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"英文内容 *"}),e.jsx(a,{children:e.jsx(b,{placeholder:"Detailed description",rows:5,...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"content_pt",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"葡萄牙语内容 *"}),e.jsx(a,{children:e.jsx(b,{placeholder:"Descrição detalhada",rows:5,...s})}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(N,{children:"封面图片"}),e.jsxs(B,{value:f,onValueChange:s=>{G(s),s==="url"?R():(r.setValue("image_url",""),p(""))},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{value:"upload",id:"upload"}),e.jsxs(N,{htmlFor:"upload",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(je,{className:"h-4 w-4"}),"上传图片"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{value:"url",id:"url"}),e.jsxs(N,{htmlFor:"url",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(pe,{className:"h-4 w-4"}),"图片URL"]})]})]}),f==="upload"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{ref:v,type:"file",accept:"image/*",onChange:J,disabled:S,className:"flex-1"}),S&&e.jsx(ue,{className:"h-4 w-4 animate-spin"})]}),u&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:u,alt:"Preview",className:"max-h-32 rounded-md border"}),e.jsx(g,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:R,children:e.jsx(ge,{className:"h-3 w-3"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"支持 JPG、PNG、WebP 格式，最大 5MB"})]}):e.jsx(t,{control:r.control,name:"image_url",render:({field:s})=>e.jsxs(n,{children:[e.jsx(a,{children:e.jsx(c,{placeholder:"https://example.com/image.jpg",...s,onChange:d=>{s.onChange(d),p(d.target.value)}})}),u&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:u,alt:"Preview",className:"max-h-32 rounded-md border",onError:()=>p("")})}),e.jsx(l,{})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{})," ",e.jsx(t,{control:r.control,name:"service_type",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"服务类型 *"}),e.jsxs(ae,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(a,{children:e.jsx(le,{children:e.jsx(ie,{placeholder:"选择服务类型"})})}),e.jsxs(oe,{children:[e.jsx(y,{value:"dine_in",children:"堂食"}),e.jsx(y,{value:"takeaway",children:"外卖"}),e.jsx(y,{value:"both",children:"堂食+外卖"})]})]}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(t,{control:r.control,name:"start_date",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"开始日期 *"}),e.jsx(a,{children:e.jsx(c,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"end_date",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"结束日期"}),e.jsx(a,{children:e.jsx(c,{type:"date",...s})}),e.jsx(fe,{children:"留空表示无限期"}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(t,{control:r.control,name:"badge_text_zh",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"中文徽章"}),e.jsx(a,{children:e.jsx(c,{placeholder:"新活动",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"badge_text_en",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"英文徽章"}),e.jsx(a,{children:e.jsx(c,{placeholder:"New",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"badge_text_pt",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"葡萄牙语徽章"}),e.jsx(a,{children:e.jsx(c,{placeholder:"Novo",...s})}),e.jsx(l,{})]})}),e.jsx(t,{control:r.control,name:"badge_color",render:({field:s})=>e.jsxs(n,{children:[e.jsx(o,{children:"徽章颜色"}),e.jsx(a,{children:e.jsx(c,{type:"color",...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>m("/merchant/activity-requests"),disabled:_,children:"取消"}),e.jsx(g,{type:"submit",disabled:_,children:_?"提交中...":"提交申请"})]})]})})})]})]})})]})};export{Be as default};
//# sourceMappingURL=MerchantActivityRequestForm-LYET0_UV.js.map
