import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as l,L as Ze}from"./vendor-react-iAJ0IrSD.js";import{r as Ns,D as Se,a as De,b as ke,c as ze,$ as is,q as $,a2 as $e,B as x,a3 as We,au as Ee,S as Ke,C as K,j as X,a0 as i,X as Fe,I as g,f as fe,d as re,a6 as ce,a7 as de,a8 as me,a9 as xe,aa as d,e as qe,g as bs,s as A,y as ae,L as _e,a4 as ve,m as ys,J as Pe,ah as Ie,ag as ws,K as Re,N as Le,O as Ve,Q as Be,R as Me,T as Ue,V as Oe,i as Cs,t as Ss,ac as Ds}from"./index-BcrfGQEh.js";import{C as he}from"./checkbox-4ejPvdP9.js";import{i as ks}from"./useActivities-B--CQBpN.js";import{u as zs}from"./useLocalizedContent-tJ7i_ycU.js";import{r as Ts,s as As}from"./useAdmin-jXgzqV2H.js";import{u as Es,C as H}from"./index.esm-CVRqJy9l.js";import{o as rs,s as o,d as Ne,e as Y,n as J,b as be,t as Fs}from"./types-CpDVS0Ep.js";import{C as Xe}from"./calendar-BM2A7QlJ.js";import{P as Ye,a as Je,b as es}from"./popover-EiaykqqH.js";import{T as ye,a as we,b as P,c as I}from"./tabs-C_tzE0Ci.js";import{u as Ps}from"./useRestaurants-Bz5Pv7_Q.js";import{u as Is}from"./vendor-query-BlSVl3IQ.js";import{R}from"./RichTextEditor--UO8SiL1.js";import{C as Rs,M as Ls,S as Vs,L as Bs,B as Ms,V as ss}from"./ReactCrop-BlnwZw7C.js";import{A as Us,a as Os}from"./alert-BVG_b3XF.js";import{u as ue,i as oe}from"./vendor-i18n-DxKeo2S1.js";import{I as qs}from"./info-Dw5QXq05.js";import{U as ts}from"./upload-DGLlOmKj.js";import{I as as}from"./image-C10sDEfq.js";import{F as He}from"./file-pen-BakHYBxv.js";import{A as Hs}from"./arrow-up-down-9dHWYGpt.js";import{f as Ce}from"./format-C1rHoFdk.js";import{u as $s,a as Ws}from"./useActivityRules-ij-m5anW.js";import{F as os}from"./file-text-CT0gf2Ab.js";import{S as cs}from"./save-NBF8cpPJ.js";import{u as Qs,a as Gs}from"./useGlobalHandbook-DAedx9aE.js";import{B as ds}from"./book-open-CaLPx_z4.js";import{b as Zs}from"./exportUtils-YWmY6fTR.js";import{D as Ks}from"./download-cx2oDCVf.js";import{P as Xs}from"./plus-CN0JuuEq.js";import{S as Ys}from"./search-DYCHfSrp.js";import{C as Js}from"./chart-column-CF-gauMi.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";import"./startOfDay-CJ0Nm-E7.js";import"./subDays-DEpdoBC8.js";import"./chevron-left-BHcY9IrV.js";import"./vendor-editor-BxSQdrX3.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=Ns("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),ms=1200,xs=630,ns=ms/xs;function st(t,h,a){return Bs(Ms({unit:"%",width:90},a,t,h),t,h)}function tt({open:t,onOpenChange:h,imageFile:a,onCropComplete:B}){const{t:m}=ue(),[k,w]=l.useState(""),[_,y]=l.useState(),[j,v]=l.useState(),u=l.useRef(null),[z,N]=l.useState(!1);l.useEffect(()=>{if(t&&a){const c=new FileReader;c.addEventListener("load",()=>{w(c.result?.toString()||"")}),c.readAsDataURL(a)}},[t,a]);const T=l.useCallback(c=>{const{width:b,height:C}=c.currentTarget;y(st(b,C,ns))},[]),E=l.useCallback(async(c,b)=>{const C=document.createElement("canvas"),U=C.getContext("2d");if(!U)throw new Error("No 2d context");const W=c.naturalWidth/c.width,n=c.naturalHeight/c.height;return C.width=b.width*W,C.height=b.height*n,U.imageSmoothingQuality="high",U.drawImage(c,b.x*W,b.y*n,b.width*W,b.height*n,0,0,C.width,C.height),new Promise((S,Q)=>{C.toBlob(O=>{if(!O){Q(new Error("Canvas is empty"));return}S(O)},"image/jpeg",.95)})},[]),M=l.useCallback(async()=>{if(!(!j||!u.current)){N(!0);try{const c=await E(u.current,j),b=new File([c],a.name,{type:"image/jpeg"}),C=URL.createObjectURL(c);B(b,C),h(!1)}catch(c){console.error("Error cropping image:",c)}finally{N(!1)}}},[j,a,B,h,E]);return e.jsx(Se,{open:t,onOpenChange:h,children:e.jsxs(De,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(ke,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(ze,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(Rs,{className:"w-5 h-5 text-primary"}),m("admin.cropImage")]}),e.jsx(is,{className:"text-xs sm:text-sm",children:m("admin.cropImageDescription")})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsxs(Us,{className:"border-primary/20 bg-primary/5",children:[e.jsx(qs,{className:"h-4 w-4"}),e.jsxs(Os,{className:"text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[m("admin.recommendedSize"),":"]}),e.jsxs($,{variant:"secondary",className:"w-fit",children:[e.jsx(Ls,{className:"w-3 h-3 mr-1"}),ms," Ã— ",xs," px"]})]}),e.jsx("p",{className:"mt-2 text-muted-foreground text-xs",children:m("admin.imageSizeHint")})]})]}),e.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:k&&e.jsx(Vs,{crop:_,onChange:c=>y(c),onComplete:c=>v(c),aspect:ns,className:"max-h-[50vh] sm:max-h-[60vh]",children:e.jsx("img",{ref:u,src:k,alt:"Crop preview",onLoad:T,className:"max-w-full h-auto"})})})]}),e.jsxs($e,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:z,className:"w-full sm:w-auto",children:m("common.cancel")}),e.jsx(x,{type:"button",onClick:M,disabled:!j||z,className:"w-full sm:w-auto",children:m(z?"common.processing":"admin.confirmCrop")})]})]})})}const at=rs({title_en:o().optional(),title_zh:o().optional(),title_pt:o().optional(),intro_zh:o().optional(),intro_en:o().optional(),intro_pt:o().optional(),content_en:o().optional(),content_zh:o().optional(),content_pt:o().optional(),usage_instructions_zh:o().optional(),usage_instructions_en:o().optional(),usage_instructions_pt:o().optional(),start_date:Ne().optional(),end_date:Ne().optional(),repeat_mode:Y(["none","daily","weekly","monthly","yearly","days_before"]).optional(),repeat_weekday:J().min(0).max(6).optional().nullable(),repeat_days_before:J().min(0).max(30).optional().nullable(),service_type:Y(["dine_in","takeaway","both"]).optional(),status:Y(["draft","published"]).default("draft"),pinned:be().default(!1),visible:be().default(!1),sort_order:J().default(0),badge_text_zh:o().optional(),badge_text_en:o().optional(),badge_text_pt:o().optional(),badge_color:o().optional(),discount_type:Y(["percentage","fixed_amount"]).optional().nullable(),discount_value:J().optional().nullable(),discount_key:o().optional().nullable()}),nt=rs({title_en:o().min(1,oe.t("validation.titleRequired")),title_zh:o().min(1,oe.t("validation.titleRequired")),title_pt:o().min(1,oe.t("validation.titleRequired")),intro_zh:o().optional(),intro_en:o().optional(),intro_pt:o().optional(),content_en:o().min(1,oe.t("validation.contentRequired")),content_zh:o().min(1,oe.t("validation.contentRequired")),content_pt:o().min(1,oe.t("validation.contentRequired")),usage_instructions_zh:o().optional(),usage_instructions_en:o().optional(),usage_instructions_pt:o().optional(),start_date:Ne(),end_date:Ne().optional(),repeat_mode:Y(["none","daily","weekly","monthly","yearly","days_before"]),repeat_weekday:J().min(0).max(6).optional().nullable(),repeat_days_before:J().min(0).max(30).optional().nullable(),service_type:Y(["dine_in","takeaway","both"]),status:Y(["draft","published"]).default("published"),pinned:be().default(!1),visible:be().default(!0),sort_order:J().default(0),badge_text_zh:o().optional(),badge_text_en:o().optional(),badge_text_pt:o().optional(),badge_color:o().optional(),discount_type:Y(["percentage","fixed_amount"]).optional().nullable(),discount_value:J().optional().nullable(),discount_key:o().optional().nullable()}),lt=at;function ls({activity:t,trigger:h}){const{t:a}=ue(),B=Is(),[m,k]=l.useState(!1),[w,_]=l.useState(null),[y,j]=l.useState(t?.image_url||null),[v,u]=l.useState([]),[z,N]=l.useState(!1),[T,E]=l.useState(!1),[M,c]=l.useState(null),[b,C]=l.useState(t?.media_type==="video"?"video":"image"),[U,W]=l.useState(null),[n,S]=l.useState(t?.video_url||null),[Q,O]=l.useState(!1),[ee,ne]=l.useState(!1),{data:pe}=Ps(),{register:D,handleSubmit:Te,formState:{errors:p},setValue:F,watch:f,control:q}=Es({resolver:Fs(lt),defaultValues:t?{title_en:t.title_en,title_zh:t.title_zh,title_pt:t.title_pt,intro_zh:t.intro_zh||"",intro_en:t.intro_en||"",intro_pt:t.intro_pt||"",content_en:t.content_en,content_zh:t.content_zh,content_pt:t.content_pt,usage_instructions_zh:t.usage_instructions_zh||"",usage_instructions_en:t.usage_instructions_en||"",usage_instructions_pt:t.usage_instructions_pt||"",start_date:new Date(t.start_date),end_date:t.end_date?new Date(t.end_date):void 0,repeat_mode:t.repeat_mode||"none",repeat_weekday:t.repeat_weekday??null,repeat_days_before:t.repeat_days_before??null,service_type:t.service_type||"both",status:t.status||"draft",pinned:t.pinned||!1,visible:t.visible!==void 0?t.visible:!0,sort_order:t.sort_order||0,badge_text_zh:t.badge_text_zh||t.title_zh,badge_text_en:t.badge_text_en||t.title_en,badge_text_pt:t.badge_text_pt||t.title_pt,badge_color:t.badge_color||"#9b87f5",discount_type:t.discount_type||null,discount_value:t.discount_value||null,discount_key:t.discount_key||null}:{repeat_mode:"none",repeat_weekday:null,repeat_days_before:null,service_type:"both",status:"draft",pinned:!1,visible:!1,sort_order:0,badge_color:"#9b87f5",discount_type:null,discount_value:null,discount_key:null}}),ge=f("start_date"),je=f("end_date"),hs=f("pinned"),us=f("visible"),L=f("status");l.useEffect(()=>{L==="draft"&&(F("visible",!1),F("pinned",!1))},[L,F]),l.useEffect(()=>{(async()=>{if(t?.id){const{data:r}=await A.from("activity_restaurants").select("restaurant_id").eq("activity_id",t.id);r&&u(r.map(V=>V.restaurant_id))}})()},[t?.id]);const Qe=s=>{const r=s.target.files?.[0];if(r){if(r.size>10*1024*1024){ae.error(a("admin.imageTooBig"));return}c(r),E(!0)}s.target.value=""},ps=(s,r)=>{_(s),j(r)},gs=s=>{const r=s.target.files?.[0];if(r){if(r.size>100*1024*1024){ae.error(a("admin.videoTooBig")||"è§†é¢‘æ–‡ä»¶è¿‡å¤§ï¼ˆæœ€å¤§100MBï¼‰");return}if(!r.type.startsWith("video/")){ae.error(a("admin.invalidVideoFormat")||"è¯·ä¸Šä¼ è§†é¢‘æ–‡ä»¶");return}W(r),S(URL.createObjectURL(r)),ne(!1)}s.target.value=""},js=async()=>{if(!w)return t?.image_url||null;const s=w.name.split(".").pop(),V=`${`${Math.random()}.${s}`}`,{error:le}=await A.storage.from("activity-images").upload(V,w);if(le)throw le;const{data:{publicUrl:Ae}}=A.storage.from("activity-images").getPublicUrl(V);return Ae},fs=async()=>{if(ee&&!U)return null;if(!U)return t?.video_url||null;O(!0);try{const s=U.name.split(".").pop(),r=`video_${Date.now()}.${s}`,{error:V}=await A.storage.from("activity-images").upload(r,U);if(V)throw V;const{data:{publicUrl:le}}=A.storage.from("activity-images").getPublicUrl(r);return le}finally{O(!1)}},_s=async s=>{N(!0);try{if(s.status==="published"){const G=nt.safeParse(s);if(!G.success){const ie={title_zh:a("admin.titleChinese"),title_en:a("admin.titleEnglish"),title_pt:a("admin.titlePortuguese"),content_zh:a("admin.contentChinese"),content_en:a("admin.contentEnglish"),content_pt:a("admin.contentPortuguese"),start_date:a("admin.startDate"),end_date:a("admin.endDate"),repeat_mode:a("admin.repeatMode"),service_type:a("admin.serviceType")},Z=G.error.errors.map(se=>{const te=se.path.join(".");return ie[te]||te});ae.error(`${a("admin.publishRequiresComplete")}: ${Z.join(", ")}`),N(!1);return}}const{data:{user:r}}=await A.auth.getUser();if(!r)throw new Error("Not authenticated");const[V,le]=await Promise.all([js(),fs()]),Ae=s.status==="draft"?!1:s.visible,Ge={title_en:s.title_en||"",title_zh:s.title_zh||"",title_pt:s.title_pt||"",intro_zh:s.intro_zh||null,intro_en:s.intro_en||null,intro_pt:s.intro_pt||null,content_en:s.content_en||"",content_zh:s.content_zh||"",content_pt:s.content_pt||"",usage_instructions_zh:s.usage_instructions_zh||null,usage_instructions_en:s.usage_instructions_en||null,usage_instructions_pt:s.usage_instructions_pt||null,repeat_mode:s.repeat_mode||"none",repeat_weekday:s.repeat_mode==="weekly"?s.repeat_weekday:null,repeat_days_before:s.repeat_mode==="days_before"?s.repeat_days_before:null,service_type:s.service_type||"both",status:s.status,pinned:s.status==="draft"?!1:s.pinned,visible:Ae,sort_order:s.sort_order,image_url:V,media_type:b,video_url:le,creator_id:r.id,start_date:s.start_date?.toISOString()||new Date().toISOString(),end_date:s.end_date?.toISOString()||null,badge_text_zh:s.badge_text_zh||s.title_zh||"",badge_text_en:s.badge_text_en||s.title_en||"",badge_text_pt:s.badge_text_pt||s.title_pt||"",badge_color:s.badge_color||"#9b87f5",discount_type:s.discount_type||null,discount_value:s.discount_value||null,discount_key:s.discount_key||null};if(t){const{error:G}=await A.from("activities").update(Ge).eq("id",t.id);if(G)throw G;if(await A.from("activity_restaurants").delete().eq("activity_id",t.id),v.length>0){const ie=v.map(se=>({activity_id:t.id,restaurant_id:se})),{error:Z}=await A.from("activity_restaurants").insert(ie);if(Z)throw Z}ae.success(a("admin.activityUpdated")),k(!1)}else{const{data:G,error:ie}=await A.from("activities").insert([Ge]).select().single();if(ie)throw ie;if(v.length>0){const se=v.map(vs=>({activity_id:G.id,restaurant_id:vs})),{error:te}=await A.from("activity_restaurants").insert(se);if(te)throw te}const{data:Z}=await A.from("coupon_templates").select("id").eq("auto_link_activities",!0).eq("is_active",!0);if(Z&&Z.length>0){const se=Z.map(te=>({coupon_template_id:te.id,activity_id:G.id}));await A.from("coupon_template_activities").insert(se)}ae.success(a("admin.activityCreated")),k(!1)}B.invalidateQueries({queryKey:["activities"]})}catch(r){ae.error(r.message||a("common.error"))}finally{N(!1)}};return e.jsxs(Se,{open:m,onOpenChange:k,children:[e.jsx(We,{asChild:!0,children:h}),e.jsxs(De,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(ke,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(ze,{className:"text-2xl flex items-center gap-2",children:[e.jsx(Ee,{className:"w-6 h-6 text-primary"}),a(t?"admin.editActivity":"admin.addActivity")]}),e.jsx(is,{className:"text-base",children:a(t?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),e.jsx(Ke,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:Te(_s),className:"space-y-6 py-6",children:[e.jsx(K,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(X,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(ts,{className:"w-5 h-5 text-primary"}),a("admin.activityMedia")||"æ´»åŠ¨åª’ä½“"]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(x,{type:"button",variant:b==="image"?"default":"outline",size:"sm",onClick:()=>C("image"),className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-4 h-4"}),a("admin.image")||"å›¾ç‰‡"]}),e.jsxs(x,{type:"button",variant:b==="video"?"default":"outline",size:"sm",onClick:()=>C("video"),className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-4 h-4"}),a("admin.video")||"è§†é¢‘"]})]}),b==="image"&&e.jsxs("div",{className:"flex items-center gap-6",children:[y&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:y,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{_(null),j(null)},children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs(i,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(ts,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:a("admin.uploadImage")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("admin.imageMaxSize")})]})]}),e.jsx(g,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Qe})]})]}),b==="video"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[n&&e.jsxs("div",{className:"relative group",children:[e.jsx("video",{src:n,className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20",muted:!0,loop:!0,playsInline:!0,onMouseEnter:s=>s.currentTarget.play(),onMouseLeave:s=>{s.currentTarget.pause(),s.currentTarget.currentTime=0}}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{W(null),S(null),ne(!0)},children:e.jsx(Fe,{className:"h-4 w-4"})})]}),e.jsxs(i,{htmlFor:"video-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(ss,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-sm",children:a("admin.uploadVideo")||"ä¸Šä¼ è§†é¢‘"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:a("admin.videoMaxSize")||"æœ€å¤§ 50MB"})]})]}),e.jsx(g,{id:"video-upload",type:"file",accept:"video/*",className:"hidden",onChange:gs})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx(i,{className:"text-sm font-medium mb-2 block",children:a("admin.fallbackImage")||"å°é¢å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:a("admin.fallbackImageDesc")||"è§†é¢‘åŠ è½½å‰æ˜¾ç¤ºçš„å°é¢å›¾"}),e.jsxs("div",{className:"flex items-center gap-4",children:[y&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:y,alt:"Fallback",className:"w-20 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20"}),e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-1 -right-1 h-6 w-6 shadow opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{_(null),j(null)},children:e.jsx(Fe,{className:"h-3 w-3"})})]}),e.jsxs(i,{htmlFor:"fallback-image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all text-sm",children:[e.jsx(as,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:a("admin.uploadFallback")||"ä¸Šä¼ å°é¢"})]}),e.jsx(g,{id:"fallback-image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Qe})]})]})]})]})]})}),e.jsx(K,{className:"border-primary/20",children:e.jsxs(X,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Ee,{className:"w-5 h-5 text-primary"}),a("admin.multilingualContent")]}),e.jsxs(ye,{defaultValue:"zh",className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(P,{value:"zh",className:"gap-2",children:["ðŸ‡¨ðŸ‡³ ",a("admin.chinese")]}),e.jsxs(P,{value:"en",className:"gap-2",children:["ðŸ‡¬ðŸ‡§ ",a("admin.english")]}),e.jsxs(P,{value:"pt",className:"gap-2",children:["ðŸ‡µðŸ‡¹ ",a("admin.portuguese")]})]}),e.jsxs(I,{value:"zh",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_zh",className:"text-sm font-medium",children:a("admin.title")}),e.jsx(g,{id:"title_zh",...D("title_zh"),placeholder:a("admin.enterTitle"),className:"text-base"}),p.title_zh&&e.jsx("p",{className:"text-sm text-destructive",children:p.title_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ç®€ä»‹"}),e.jsx(g,{id:"intro_zh",...D("intro_zh"),placeholder:"ç®€çŸ­æè¿°æ´»åŠ¨ï¼ˆæ˜¾ç¤ºåœ¨é¤åŽ…è¯¦æƒ…é¡µï¼‰",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"åœ¨é¤åŽ…è¯¦æƒ…é¡µæ´»åŠ¨æ ‡ç­¾åŽæ˜¾ç¤ºçš„ç®€çŸ­è¯´æ˜Ž"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_zh",className:"text-sm font-medium",children:a("admin.content")}),e.jsx(H,{name:"content_zh",control:q,render:({field:s})=>e.jsx(R,{value:s.value,onChange:s.onChange,placeholder:a("admin.enterContent")})}),p.content_zh&&e.jsx("p",{className:"text-sm text-destructive",children:p.content_zh.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_zh",className:"text-sm font-medium",children:"æ´»åŠ¨ä½¿ç”¨æ–¹æ³•"}),e.jsx(H,{name:"usage_instructions_zh",control:q,render:({field:s})=>e.jsx(R,{value:s.value||"",onChange:s.onChange,placeholder:"æè¿°å¦‚ä½•ä½¿ç”¨æ­¤æ´»åŠ¨ï¼ˆå¯é€‰ï¼‰"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å‘ç”¨æˆ·è¯´æ˜Žå¦‚ä½•å‚ä¸Žå’Œä½¿ç”¨æ­¤æ´»åŠ¨"})]})]}),e.jsxs(I,{value:"en",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_en",className:"text-sm font-medium",children:a("admin.title")}),e.jsx(g,{id:"title_en",...D("title_en"),placeholder:a("admin.enterTitle"),className:"text-base"}),p.title_en&&e.jsx("p",{className:"text-sm text-destructive",children:p.title_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_en",className:"text-sm font-medium",children:"Activity Brief"}),e.jsx(g,{id:"intro_en",...D("intro_en"),placeholder:"Short description (shown on restaurant details)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Brief description shown after activity badge on restaurant page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_en",className:"text-sm font-medium",children:a("admin.content")}),e.jsx(H,{name:"content_en",control:q,render:({field:s})=>e.jsx(R,{value:s.value,onChange:s.onChange,placeholder:a("admin.enterContent")})}),p.content_en&&e.jsx("p",{className:"text-sm text-destructive",children:p.content_en.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_en",className:"text-sm font-medium",children:"Usage Instructions"}),e.jsx(H,{name:"usage_instructions_en",control:q,render:({field:s})=>e.jsx(R,{value:s.value||"",onChange:s.onChange,placeholder:"Describe how to use this activity (optional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explain to users how to participate and use this activity"})]})]}),e.jsxs(I,{value:"pt",className:"space-y-4 mt-0",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"title_pt",className:"text-sm font-medium",children:a("admin.title")}),e.jsx(g,{id:"title_pt",...D("title_pt"),placeholder:a("admin.enterTitle"),className:"text-base"}),p.title_pt&&e.jsx("p",{className:"text-sm text-destructive",children:p.title_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"intro_pt",className:"text-sm font-medium",children:"Resumo da Atividade"}),e.jsx(g,{id:"intro_pt",...D("intro_pt"),placeholder:"DescriÃ§Ã£o curta (exibida nos detalhes do restaurante)",className:"text-base"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Breve descriÃ§Ã£o exibida apÃ³s o distintivo da atividade na pÃ¡gina do restaurante"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"content_pt",className:"text-sm font-medium",children:a("admin.content")}),e.jsx(H,{name:"content_pt",control:q,render:({field:s})=>e.jsx(R,{value:s.value,onChange:s.onChange,placeholder:a("admin.enterContent")})}),p.content_pt&&e.jsx("p",{className:"text-sm text-destructive",children:p.content_pt.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"usage_instructions_pt",className:"text-sm font-medium",children:"InstruÃ§Ãµes de Uso"}),e.jsx(H,{name:"usage_instructions_pt",control:q,render:({field:s})=>e.jsx(R,{value:s.value||"",onChange:s.onChange,placeholder:"Descreva como usar esta atividade (opcional)"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Explique aos usuÃ¡rios como participar e usar esta atividade"})]})]})]})]})}),e.jsx(K,{className:"border-primary/20",children:e.jsxs(X,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(fe,{className:"w-5 h-5 text-primary"}),a("admin.dateSettings")]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:a("admin.startDate")}),e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:re("w-full justify-start text-left font-normal h-11",!ge&&"text-muted-foreground"),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),ge?Ce(ge,"PPP"):e.jsx("span",{children:a("admin.selectDate")})]})}),e.jsx(es,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(Xe,{mode:"single",selected:ge,onSelect:s=>F("start_date",s),initialFocus:!0,className:"pointer-events-auto"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-sm font-medium",children:a("admin.endDate")}),e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:re("w-full justify-start text-left font-normal h-11",!je&&"text-muted-foreground"),children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),je?Ce(je,"PPP"):e.jsxs("span",{children:[a("admin.selectDate")," (",a("admin.optional"),")"]})]})}),e.jsx(es,{className:"w-auto p-0 z-[100]",align:"start",children:e.jsx(Xe,{mode:"single",selected:je,onSelect:s=>F("end_date",s),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:a("admin.repeatMode")}),e.jsxs(ce,{onValueChange:s=>F("repeat_mode",s),defaultValue:f("repeat_mode"),children:[e.jsx(de,{className:"h-11",children:e.jsx(me,{placeholder:a("admin.selectRepeatMode")})}),e.jsxs(xe,{children:[e.jsx(d,{value:"none",children:a("admin.repeatNone")}),e.jsx(d,{value:"daily",children:a("admin.repeatDaily")}),e.jsx(d,{value:"weekly",children:a("admin.repeatWeekly")}),e.jsx(d,{value:"monthly",children:a("admin.repeatMonthly")}),e.jsx(d,{value:"yearly",children:a("admin.repeatYearly")}),e.jsx(d,{value:"days_before",children:a("admin.repeatDaysBefore")})]})]})]}),f("repeat_mode")==="weekly"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_weekday",className:"text-sm font-medium",children:"æ¯å‘¨é‡å¤æ—¥ / Weekly on"}),e.jsx(H,{name:"repeat_weekday",control:q,render:({field:s})=>e.jsxs(ce,{value:s.value?.toString()||"",onValueChange:r=>s.onChange(r?parseInt(r):null),children:[e.jsx(de,{className:"h-11",children:e.jsx(me,{placeholder:"é€‰æ‹©æ˜ŸæœŸå‡  / Select day"})}),e.jsxs(xe,{children:[e.jsx(d,{value:"1",children:"å‘¨ä¸€ / Monday"}),e.jsx(d,{value:"2",children:"å‘¨äºŒ / Tuesday"}),e.jsx(d,{value:"3",children:"å‘¨ä¸‰ / Wednesday"}),e.jsx(d,{value:"4",children:"å‘¨å›› / Thursday"}),e.jsx(d,{value:"5",children:"å‘¨äº” / Friday"}),e.jsx(d,{value:"6",children:"å‘¨å…­ / Saturday"}),e.jsx(d,{value:"0",children:"å‘¨æ—¥ / Sunday"})]})]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"é€‰æ‹©æ´»åŠ¨æ¯å‘¨ç”Ÿæ•ˆçš„æ—¥æœŸ / Select which day this activity is valid each week"})]}),f("repeat_mode")==="days_before"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"repeat_days_before",className:"text-sm font-medium",children:a("admin.daysBeforeLabel")}),e.jsx(H,{name:"repeat_days_before",control:q,render:({field:s})=>e.jsx(g,{type:"number",min:1,max:30,className:"h-11",placeholder:a("admin.daysBeforePlaceholder"),value:s.value??"",onChange:r=>s.onChange(r.target.value?parseInt(r.target.value):null)})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("admin.daysBeforeHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"service_type",className:"text-sm font-medium",children:a("admin.serviceType")}),e.jsxs(ce,{onValueChange:s=>F("service_type",s),defaultValue:f("service_type"),children:[e.jsx(de,{className:"h-11",children:e.jsx(me,{placeholder:a("admin.selectServiceType")})}),e.jsxs(xe,{children:[e.jsx(d,{value:"dine_in",children:a("activities.serviceType.dine_in")}),e.jsx(d,{value:"takeaway",children:a("activities.serviceType.takeaway")}),e.jsx(d,{value:"both",children:a("activities.serviceType.both")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{className:"text-sm font-medium flex items-center gap-2",children:[f("status")==="draft"?e.jsx(He,{className:"w-4 h-4 text-yellow-500"}):e.jsx(qe,{className:"w-4 h-4 text-green-500"}),"æ´»åŠ¨çŠ¶æ€"]}),e.jsxs(ce,{onValueChange:s=>F("status",s),value:L||"draft",children:[e.jsx(de,{className:"h-11",children:e.jsx(me,{})}),e.jsxs(xe,{children:[e.jsx(d,{value:"draft",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-yellow-500"}),"è‰ç¨¿"]})}),e.jsx(d,{value:"published",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-green-500"}),"å·²å‘å¸ƒ"]})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:L==="draft"?"è‰ç¨¿çŠ¶æ€ï¼šæ— å¿…å¡«é¡¹ï¼Œä¸æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Œé¤åŽ…ä¸ä¼šæ”¶åˆ°é€šçŸ¥":"å‘å¸ƒæ—¶å°†éªŒè¯å¿…å¡«é¡¹"})]}),e.jsxs("div",{className:re("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",L==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(he,{id:"pinned",checked:hs,onCheckedChange:s=>F("pinned",s===!0),className:"data-[state=checked]:bg-primary",disabled:L==="draft"}),e.jsxs(i,{htmlFor:"pinned",className:re("flex items-center gap-2 text-sm font-medium",L==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(et,{className:"w-4 h-4 text-primary"}),a("admin.pinToTop")]})]}),e.jsxs("div",{className:re("flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end",L==="draft"?"opacity-50 cursor-not-allowed bg-muted/30":"hover:bg-muted/50"),children:[e.jsx(he,{id:"visible",checked:us,onCheckedChange:s=>F("visible",s===!0),className:"data-[state=checked]:bg-primary",disabled:L==="draft"}),e.jsxs(i,{htmlFor:"visible",className:re("flex items-center gap-2 text-sm font-medium",L==="draft"?"cursor-not-allowed":"cursor-pointer"),children:[e.jsx(Ee,{className:"w-4 h-4 text-primary"}),"æ˜¾ç¤ºæ´»åŠ¨",L==="draft"&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"(è‰ç¨¿é»˜è®¤å…³é—­)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Hs,{className:"w-4 h-4 text-primary"}),a("admin.sortOrder")]}),e.jsx(g,{id:"sort_order",type:"number",...D("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),e.jsx(K,{className:"border-primary/20",children:e.jsxs(X,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx($,{className:"w-5 h-5 text-primary"}),"æ˜¾ç¤ºå¾½ç« è®¾ç½®"]}),e.jsxs(ye,{defaultValue:"zh",className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-3 mb-4",children:[e.jsx(P,{value:"zh",children:"ðŸ‡¨ðŸ‡³ ä¸­æ–‡"}),e.jsx(P,{value:"en",children:"ðŸ‡¬ðŸ‡§ English"}),e.jsx(P,{value:"pt",children:"ðŸ‡µðŸ‡¹ PortuguÃªs"})]}),e.jsx(I,{value:"zh",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_zh",className:"text-sm",children:["å¾½ç« æ–‡å­— (ä¸­æ–‡) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"badge_text_zh",...D("badge_text_zh"),placeholder:"ä¾‹å¦‚: ç²‰ä¸èŠ‚"}),p.badge_text_zh&&e.jsx("p",{className:"text-sm text-destructive",children:p.badge_text_zh.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"å¾½ç« æ–‡å­—æ˜¾ç¤ºåœ¨é¤åŽ…è¯¦æƒ…å’Œæ´»åŠ¨åˆ—è¡¨ä¸­ï¼Œå»ºè®®ç®€æ´æ˜Žäº†"})]})}),e.jsx(I,{value:"en",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_en",className:"text-sm",children:["Badge Text (English) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"badge_text_en",...D("badge_text_en"),placeholder:"e.g. Fan Festival"}),p.badge_text_en&&e.jsx("p",{className:"text-sm text-destructive",children:p.badge_text_en.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Badge text shown on restaurant details and activity list, keep it concise"})]})}),e.jsx(I,{value:"pt",className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"badge_text_pt",className:"text-sm",children:["Texto do Distintivo (PortuguÃªs) ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(g,{id:"badge_text_pt",...D("badge_text_pt"),placeholder:"ex: Festival dos FÃ£s"}),p.badge_text_pt&&e.jsx("p",{className:"text-sm text-destructive",children:p.badge_text_pt.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso"})]})})]}),e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsx(i,{htmlFor:"badge_color",className:"text-sm",children:"å¾½ç« é¢œè‰² / Badge Color"}),e.jsx(H,{name:"badge_color",control:q,render:({field:s})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{id:"badge_color",type:"color",value:s.value||"#9b87f5",onChange:r=>s.onChange(r.target.value),className:"w-20 h-11 cursor-pointer"}),e.jsx(g,{value:s.value||"#9b87f5",onChange:r=>s.onChange(r.target.value),placeholder:"#9b87f5",className:"flex-1"})]})}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"é¢„è§ˆ / Preview:"}),e.jsx($,{style:{backgroundColor:f("badge_color")||"#9b87f5"},className:"text-white",children:f("badge_text_zh")||f("title_zh")||"ç¤ºä¾‹"})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx(i,{className:"text-sm font-medium flex items-center gap-2 mb-3",children:"ðŸ’° ä¼˜æƒ è®¾ç½® / Discount Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"discount_type",className:"text-sm",children:"æŠ˜æ‰£ç±»åž‹ / Discount Type"}),e.jsx(H,{name:"discount_type",control:q,render:({field:s})=>e.jsxs(ce,{value:s.value||"none",onValueChange:r=>s.onChange(r==="none"?null:r),children:[e.jsx(de,{className:"h-11",children:e.jsx(me,{placeholder:"é€‰æ‹©æŠ˜æ‰£ç±»åž‹"})}),e.jsxs(xe,{children:[e.jsx(d,{value:"none",children:"æ— ä¼˜æƒ  / No Discount"}),e.jsx(d,{value:"percentage",children:"ç™¾åˆ†æ¯”æŠ˜æ‰£ / Percentage"}),e.jsx(d,{value:"fixed_amount",children:"å›ºå®šé‡‘é¢ / Fixed Amount"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"discount_value",className:"text-sm",children:["æŠ˜æ‰£å€¼ / Discount Value",f("discount_type")==="percentage"&&" (%)",f("discount_type")==="fixed_amount"&&" (â‚¬)"]}),e.jsx(g,{id:"discount_value",type:"number",step:"0.01",...D("discount_value",{valueAsNumber:!0}),className:"h-11",placeholder:f("discount_type")==="percentage"?"ä¾‹å¦‚: 20 (è¡¨ç¤º8æŠ˜)":"ä¾‹å¦‚: 5 (è¡¨ç¤ºå‡5â‚¬)",disabled:!f("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f("discount_type")==="percentage"?"è¾“å…¥æŠ˜æ‰£ç™¾åˆ†æ¯”ï¼Œå¦‚ 20 è¡¨ç¤ºæ‰“8æŠ˜ï¼ˆå‡20%ï¼‰":f("discount_type")==="fixed_amount"?"è¾“å…¥å›ºå®šå‡å…é‡‘é¢ï¼ˆæ¬§å…ƒï¼‰":"å…ˆé€‰æ‹©æŠ˜æ‰£ç±»åž‹"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"discount_key",className:"text-sm",children:"æŠ˜æ‰£æ ‡è¯† / Discount Key"}),e.jsx(g,{id:"discount_key",type:"text",...D("discount_key"),className:"h-11",placeholder:"ä¾‹å¦‚: SUMMER2025, VIP_DISCOUNT",disabled:!f("discount_type")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"ç”¨äºŽå¤–éƒ¨ç³»ç»Ÿè¯†åˆ«çš„æŠ˜æ‰£æ ‡è¯†ç¬¦"})]})]})]})]})}),e.jsx(K,{className:"border-primary/20",children:e.jsxs(X,{className:"p-6",children:[e.jsxs(i,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(bs,{className:"w-5 h-5 text-primary"}),a("admin.associatedRestaurants")]}),e.jsx(Ke,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:e.jsx("div",{className:"space-y-2",children:pe?.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[e.jsx(he,{id:s.id,checked:v.includes(s.id),onCheckedChange:r=>{u(r?[...v,s.id]:v.filter(V=>V!==s.id))},className:"data-[state=checked]:bg-primary"}),e.jsx(i,{htmlFor:s.id,className:"cursor-pointer flex-1 font-normal",children:s.name}),v.includes(s.id)&&e.jsx($,{variant:"secondary",className:"text-xs",children:"å·²é€‰"})]},s.id))})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["å·²é€‰æ‹© ",v.length," ä¸ªé¤åŽ…"]})]})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>k(!1),className:"min-w-[100px]",children:a("common.cancel")}),e.jsx(x,{type:"submit",disabled:z,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),a("common.saving")]}):a("common.save")})]})]})}),M&&e.jsx(tt,{open:T,onOpenChange:E,imageFile:M,onCropComplete:ps})]})]})}const it=({children:t})=>{const{t:h}=ue(),{data:a,isLoading:B}=$s(),m=Ws(),[k,w]=l.useState(!1),[_,y]=l.useState("zh"),[j,v]=l.useState(""),[u,z]=l.useState(""),[N,T]=l.useState("");l.useEffect(()=>{a&&(v(a.content_zh),z(a.content_en),T(a.content_pt))},[a]);const E=async()=>{if(a)try{await m.mutateAsync({id:a.id,content_zh:j,content_en:u,content_pt:N}),ve({title:h("common.success"),description:"æ´»åŠ¨æ¡ä¾‹å·²æ›´æ–°"}),w(!1)}catch{ve({title:h("common.error"),description:"æ›´æ–°å¤±è´¥",variant:"destructive"})}};return e.jsxs(Se,{open:k,onOpenChange:w,children:[e.jsx(We,{asChild:!0,children:t}),e.jsxs(De,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ke,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-5 h-5"}),"ç¼–è¾‘æ´»åŠ¨æ¡ä¾‹"]})}),B?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(_e,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ye,{value:_,onValueChange:y,children:[e.jsxs(we,{className:"grid w-full grid-cols-3",children:[e.jsx(P,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(P,{value:"en",children:"English"}),e.jsx(P,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(I,{value:"zh",className:"mt-4",children:e.jsx(R,{value:j,onChange:v,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ¡ä¾‹å†…å®¹..."})}),e.jsx(I,{value:"en",className:"mt-4",children:e.jsx(R,{value:u,onChange:z,placeholder:"Enter English activity rules..."})}),e.jsx(I,{value:"pt",className:"mt-4",children:e.jsx(R,{value:N,onChange:T,placeholder:"Digite as regras da atividade em portuguÃªs..."})})]})}),e.jsxs($e,{children:[e.jsx(x,{variant:"outline",onClick:()=>w(!1),children:h("common.cancel")}),e.jsxs(x,{onClick:E,disabled:m.isPending,children:[m.isPending?e.jsx(_e,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(cs,{className:"w-4 h-4 mr-2"}),h("common.save")]})]})]})]})},rt=({children:t})=>{const{t:h}=ue(),{data:a,isLoading:B}=Qs(),m=Gs(),[k,w]=l.useState(!1),[_,y]=l.useState("zh"),[j,v]=l.useState(""),[u,z]=l.useState(""),[N,T]=l.useState("");l.useEffect(()=>{a&&(v(a.content_zh),z(a.content_en),T(a.content_pt))},[a]);const E=async()=>{if(a)try{await m.mutateAsync({id:a.id,content_zh:j,content_en:u,content_pt:N}),ve({title:h("common.success"),description:h("activities.handbook.updateSuccess")}),w(!1)}catch{ve({title:h("common.error"),description:h("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Se,{open:k,onOpenChange:w,children:[e.jsx(We,{asChild:!0,children:t}),e.jsxs(De,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ke,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"w-5 h-5"}),h("admin.editActivityHandbook")]})}),B?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(_e,{className:"w-6 h-6 animate-spin text-primary"})}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ye,{value:_,onValueChange:y,children:[e.jsxs(we,{className:"grid w-full grid-cols-3",children:[e.jsx(P,{value:"zh",children:"ä¸­æ–‡"}),e.jsx(P,{value:"en",children:"English"}),e.jsx(P,{value:"pt",children:"PortuguÃªs"})]}),e.jsx(I,{value:"zh",className:"mt-4",children:e.jsx(R,{value:j,onChange:v,placeholder:"è¯·è¾“å…¥ä¸­æ–‡æ´»åŠ¨æ‰‹å†Œå†…å®¹..."})}),e.jsx(I,{value:"en",className:"mt-4",children:e.jsx(R,{value:u,onChange:z,placeholder:"Enter English activity handbook content..."})}),e.jsx(I,{value:"pt",className:"mt-4",children:e.jsx(R,{value:N,onChange:T,placeholder:"Digite o conteÃºdo do manual da atividade em portuguÃªs..."})})]})}),e.jsxs($e,{children:[e.jsx(x,{variant:"outline",onClick:()=>w(!1),children:h("common.cancel")}),e.jsxs(x,{onClick:E,disabled:m.isPending,children:[m.isPending?e.jsx(_e,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(cs,{className:"w-4 h-4 mr-2"}),h("common.save")]})]})]})]})},Gt=()=>{const{t}=ue(),{toast:h}=ys(),{data:a,isLoading:B}=ks(),{getLocalizedField:m}=zs(),k=Ts(),w=As(),[_,y]=l.useState([]),[j,v]=l.useState(""),[u,z]=l.useState("all"),[N,T]=l.useState({}),[E,M]=l.useState(""),c=l.useMemo(()=>a?a.filter(n=>{const S=String(m(n,"title")||""),Q=String(m(n,"content")||""),O=j===""||S.toLowerCase().includes(j.toLowerCase())||Q.toLowerCase().includes(j.toLowerCase()),ee=new Date,ne=new Date(n.start_date),pe=n.end_date?new Date(n.end_date):null,D=pe?pe<ee:!1,Te=!D&&ne<=ee,p=n.status||"published",F=u==="all"||u==="active"&&Te||u==="ended"&&D||u==="pinned"&&n.pinned||u==="draft"&&p==="draft"||u==="published"&&p==="published";return O&&F}):[],[a,j,u,m]),b=()=>{if(!a||a.length===0){h({title:t("common.error"),description:t("admin.noDataToExport"),variant:"destructive"});return}Zs(a),h({title:t("common.success"),description:t("admin.exportSuccess")})},C=n=>{y(S=>S.includes(n)?S.filter(Q=>Q!==n):[...S,n])},U=()=>{_.length===c?.length?y([]):y(c?.map(n=>n.id)||[])},W=()=>{_.length!==0&&(w.mutate(_),y([]))};return B?e.jsx("div",{className:"text-center",children:t("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:t("admin.activityManagement")}),e.jsx("p",{className:"text-muted-foreground",children:t("admin.manageActivities")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(rt,{children:e.jsxs(x,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("admin.activityHandbook")})]})}),e.jsx(it,{children:e.jsxs(x,{variant:"outline",className:"flex-1 sm:flex-initial",children:[e.jsx(os,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("admin.activityRules")})]})}),e.jsxs(x,{variant:"outline",onClick:b,className:"flex-1 sm:flex-initial",children:[e.jsx(Ks,{className:"mr-2 h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:t("admin.exportCSV")})]}),e.jsx(ls,{trigger:e.jsxs(x,{className:"flex-1 sm:flex-initial",children:[e.jsx(Xs,{className:"mr-2 h-4 w-4"}),t("admin.addActivity")]})})]})]}),e.jsx(K,{children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ys,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:t("admin.searchActivities"),value:j,onChange:n=>v(n.target.value),className:"pl-9"})]})}),e.jsxs(ce,{value:u,onValueChange:z,children:[e.jsx(de,{className:"w-[180px]",children:e.jsx(me,{placeholder:t("admin.filterByStatus")})}),e.jsxs(xe,{children:[e.jsx(d,{value:"all",children:t("admin.allStatus")}),e.jsx(d,{value:"draft",children:t("admin.statusDraft")}),e.jsx(d,{value:"published",children:t("admin.statusPublished")}),e.jsx(d,{value:"active",children:t("admin.statusActive")}),e.jsx(d,{value:"ended",children:t("admin.statusEnded")}),e.jsx(d,{value:"pinned",children:t("admin.statusPinned")})]})]})]})})}),_.length>0&&e.jsx(K,{className:"bg-muted/50",children:e.jsx(X,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("span",{className:"font-medium",children:t("admin.selectedCount",{count:_.length})}),e.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[e.jsxs(Pe,{children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(x,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[e.jsx(ws,{className:"mr-2 h-4 w-4"}),t("admin.batchDelete")]})}),e.jsxs(Re,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsx(Ve,{children:t("admin.confirmBatchDelete")}),e.jsxs(Be,{className:"space-y-3",children:[e.jsx("p",{children:t("admin.batchDeleteWarning",{count:_.length})}),e.jsx("p",{className:"font-semibold text-destructive",children:t("admin.willDeleteActivities",{count:_.length})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:t("admin.typeDeleteToConfirmBatch")}),e.jsx(g,{value:E,onChange:n=>M(n.target.value),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(Me,{children:[e.jsx(Ue,{onClick:()=>M(""),children:t("common.cancel")}),e.jsx(Oe,{disabled:E!=="DELETE",onClick:()=>{W(),M("")},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete")})]})]})]}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>y([]),className:"flex-1 sm:flex-initial",children:t("admin.clearSelection")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(he,{checked:_.length===c?.length&&c.length>0,onCheckedChange:U}),e.jsx("span",{className:"font-medium",children:t("admin.selectAll")}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",c?.length," ",t("admin.results"),")"]})]}),e.jsx("div",{className:"grid gap-4",children:c?.map(n=>e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center",children:[e.jsx("div",{className:"p-4 flex items-start md:self-start",children:e.jsx(he,{checked:_.includes(n.id),onCheckedChange:()=>C(n.id),className:"mt-1"})}),n.image_url&&e.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0",children:e.jsx("img",{src:n.image_url,alt:String(m(n,"title")),className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs(Cs,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsx(Ss,{className:"text-lg md:text-xl",children:m(n,"title")}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.status==="draft"?e.jsxs($,{variant:"outline",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(He,{className:"w-3 h-3 mr-1"}),"è‰ç¨¿"]}):e.jsxs($,{variant:"outline",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(qe,{className:"w-3 h-3 mr-1"}),"å·²å‘å¸ƒ"]}),!n.visible&&e.jsx($,{variant:"secondary",children:t("admin.hidden")}),n.pinned&&e.jsx($,{children:t("activities.pinned")}),(()=>{const S=new Date,Q=new Date(n.start_date),O=n.end_date?new Date(n.end_date):null,ee=O?O<S:!1,ne=!ee&&Q<=S;return ee?e.jsx($,{variant:"secondary",children:t("activities.ended")}):ne?e.jsx($,{children:t("activities.ongoing")}):null})()]})]}),e.jsx(Ds,{className:"line-clamp-2",children:e.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:m(n,"content")}})})]}),e.jsxs(X,{children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsx(fe,{className:"h-4 w-4 flex-shrink-0"}),e.jsxs("span",{className:"text-xs sm:text-sm",children:[Ce(new Date(n.start_date),"PPP"),n.end_date&&` - ${Ce(new Date(n.end_date),"PPP")}`]})]})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.status!=="draft"&&e.jsx(x,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsxs(Ze,{to:`/admin/activity-stats/${n.id}`,children:[e.jsx(Js,{className:"w-4 h-4 mr-1"}),t("admin.stats","ç»Ÿè®¡")]})}),e.jsx(x,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:e.jsx(Ze,{to:`/activity/${n.id}`,state:{from:"admin"},children:t("admin.view")})}),e.jsx(ls,{activity:n,trigger:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:t("common.edit")})}),n.status==="draft"?e.jsxs(Pe,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:t("common.delete")})}),e.jsxs(Re,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsx(Ve,{children:t("admin.confirmDelete")}),e.jsxs(Be,{children:[e.jsx("p",{children:t("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground mt-2",children:m(n,"title")})]})]}),e.jsxs(Me,{children:[e.jsx(Ue,{children:t("common.cancel")}),e.jsx(Oe,{onClick:()=>k.mutate(n.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete")})]})]})]}):e.jsxs(Pe,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:t("common.delete")})}),e.jsxs(Re,{className:"max-w-[90vw] sm:max-w-[425px]",children:[e.jsxs(Le,{children:[e.jsx(Ve,{children:t("admin.confirmDelete")}),e.jsxs(Be,{className:"space-y-3",children:[e.jsx("p",{children:t("admin.deleteActivityWarning")}),e.jsx("p",{className:"font-semibold text-foreground",children:m(n,"title")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm",children:t("admin.typeDeleteToConfirmBatch")}),e.jsx(g,{value:N[n.id]||"",onChange:S=>T({...N,[n.id]:S.target.value}),placeholder:"DELETE",className:"font-mono"})]})]})]}),e.jsxs(Me,{children:[e.jsx(Ue,{onClick:()=>T({...N,[n.id]:""}),children:t("common.cancel")}),e.jsx(Oe,{disabled:N[n.id]!=="DELETE",onClick:()=>{k.mutate(n.id),T({...N,[n.id]:""})},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete")})]})]})]})]})]})]})]})},n.id))})]})};export{Gt as default};
//# sourceMappingURL=AdminActivities-_OlTQxXW.js.map
