import{p as te,cc as ae,r as d,bO as re,bS as ne,j as e,cd as ie,y as le,M as oe,b3 as ce,a4 as x,bt as de,bs as E,c5 as me,am as xe,bb as ue,an as q,aM as L,X as he,L as z,bh as je,W as pe,bA as fe}from"./vendor-react-Dngtq_Sc.js";import{b as ge,C as A,n as O,h as _,m as Ne,E as ve,a4 as ye,g as m,I as v,a1 as w,o as be,D as Ue,c as _e,d as we,e as Ce,Y as Ve,s as Se}from"./index-CzZZrTBB.js";import{F as Ie,a as u,b as h,d as f,e as j,c as y}from"./form-CvBqToXL.js";import{d as ke}from"./useInvitationCodes-Cbvkz3fG.js";import{P as Re}from"./progress-C-UFPYqk.js";import{N as Pe,P as G,O as b,Q as De}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-xpVHVj_9.js";const H=["booking","delivery","qrcode"],He=()=>{const{t:s,i18n:C}=te(),[V]=ae(),[R,P]=d.useState(!1),[$,D]=d.useState(!1),[n,S]=d.useState(1),[B,I]=d.useState(!1),{settings:i}=ge(),Q=ke(),[c,g]=d.useState({isValidating:!1,isValid:null,inviterUserId:null}),W=d.useMemo(()=>Pe({restaurant_type:G(["standard","ghost"]),name:b().min(2,{message:s("joinUs.nameMin")}),email:b().email({message:s("joinUs.emailInvalid")}),phone:b().min(6,{message:s("joinUs.phoneMin")}),restaurant_name:b().min(2,{message:s("joinUs.restaurantNameMin")}),restaurant_address:b().min(2,{message:s("joinUs.addressMin")}),features_selected:De(G(H)).min(1,{message:s("joinUs.featuresMin")}),invitation_code:b().optional()}),[s]),r=re({resolver:ne(W),defaultValues:{restaurant_type:"standard",name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[],invitation_code:V.get("code")||""}}),J=r.watch("restaurant_type"),l=r.watch("features_selected")?.includes("qrcode"),o=J==="ghost",N=o?3:4;d.useEffect(()=>{const t=V.get("code");t&&l&&!o&&T(t)},[V,l,o]),d.useEffect(()=>{(!l||o)&&(r.setValue("invitation_code",""),g({isValidating:!1,isValid:null,inviterUserId:null}))},[l,o,r]),d.useEffect(()=>{o&&r.setValue("features_selected",["delivery"])},[o,r]);const T=async t=>{if(!t||t.length<6){g({isValidating:!1,isValid:null,inviterUserId:null});return}g({isValidating:!0,isValid:null,inviterUserId:null});try{const a=await Q.mutateAsync(t);g(a?{isValidating:!1,isValid:!0,inviterUserId:a.user_id}:{isValidating:!1,isValid:!1,inviterUserId:null})}catch{g({isValidating:!1,isValid:!1,inviterUserId:null})}},X=async()=>{let t=[];switch(n){case 1:t=["restaurant_type"];break;case 2:t=["name","email","phone"];break;case 3:t=["restaurant_name","restaurant_address"];break;case 4:o||(t=["features_selected"]);break}return await r.trigger(t)},Y=async t=>{t.preventDefault(),t.stopPropagation(),await X()&&n<N&&S(p=>p+1)},K=t=>{t.preventDefault(),t.stopPropagation(),n>1&&S(a=>a-1)},Z=async t=>{P(!0);try{const a=C.language||"en",p=o?["delivery"]:t.features_selected,{error:U}=await Se.functions.invoke("send-join-request-email",{body:{...t,features_selected:p,language:a,invitation_code:!o&&c.isValid?t.invitation_code:null,invited_by_user_id:!o&&c.inviterUserId?c.inviterUserId:null,restaurant_type:t.restaurant_type}});if(U){if(U.message.includes("rate_limit_exceeded"))w({title:s("joinUs.rateLimitError"),description:s("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw U;return}D(!0),r.reset(),S(1),w({title:s("joinUs.successTitle"),description:s("joinUs.successDescription")})}catch(a){console.error("Error submitting join request:",a),w({title:s("common.error"),description:s("joinUs.submitError"),variant:"destructive"})}finally{P(!1)}},ee=()=>{const t=C.language;return t==="zh"&&i?.join_success_title_zh?i.join_success_title_zh:t==="pt"&&i?.join_success_title_pt?i.join_success_title_pt:i?.join_success_title_en?i.join_success_title_en:s("joinUs.successTitle")},se=()=>{const t=C.language;return t==="zh"&&i?.join_success_message_zh?i.join_success_message_zh:t==="pt"&&i?.join_success_message_pt?i.join_success_message_pt:i?.join_success_message_en?i.join_success_message_en:s("joinUs.successMessage")},F=i?.join_contact_phone||"968815050",k=i?.contact_email,M=n/N*100;return $?e.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsx(A,{className:"border-primary",children:e.jsxs(O,{className:"pt-12 pb-12 text-center",children:[e.jsx(ie,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:ee()}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:se()}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:[e.jsxs("a",{href:`tel:${F}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:F})]}),k&&e.jsxs("a",{href:`mailto:${k}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:k})]})]}),e.jsx(_,{onClick:()=>D(!1),children:s("joinUs.submitAnother")})]})})})}):e.jsxs("div",{className:"min-h-screen pt-4 pb-12 px-4 bg-secondary/20",children:[e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsxs(A,{children:[e.jsxs(Ne,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ce,{className:"w-12 h-12 text-primary"})}),e.jsx(ve,{className:"text-3xl font-bold",children:s("joinUs.title")}),e.jsx(ye,{className:"text-base",children:s("joinUs.description")})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:s("joinUs.step",{current:n,total:N})}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.round(M),"%"]})]}),e.jsx(Re,{value:M,className:"h-2"}),e.jsx("div",{className:"flex justify-between mt-4",children:Array.from({length:N},(t,a)=>a+1).map(t=>e.jsx("div",{className:m("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors",t<n?"bg-primary text-primary-foreground":t===n?"bg-primary text-primary-foreground ring-2 ring-primary ring-offset-2":"bg-muted text-muted-foreground"),children:t<n?e.jsx(x,{className:"w-4 h-4"}):t},t))})]}),e.jsx(O,{children:e.jsx(Ie,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Z),className:"space-y-6",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.selectRestaurantType")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.selectRestaurantTypeDesc")})]}),e.jsx(u,{control:r.control,name:"restaurant_type",render:({field:t})=>e.jsxs(h,{children:[e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>t.onChange("standard"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",t.value==="standard"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",t.value==="standard"?"bg-primary/10":"bg-muted"),children:e.jsx(de,{className:m("w-8 h-8",t.value==="standard"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s("joinUs.standardRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("joinUs.standardRestaurantDesc")})]})]}),t.value==="standard"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(x,{className:"w-5 h-5 text-primary"})})]}),e.jsxs("div",{onClick:()=>t.onChange("ghost"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",t.value==="ghost"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",t.value==="ghost"?"bg-primary/10":"bg-muted"),children:e.jsx(E,{className:m("w-8 h-8",t.value==="ghost"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s("joinUs.ghostRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s("joinUs.ghostRestaurantDesc")})]})]}),t.value==="ghost"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(x,{className:"w-5 h-5 text-primary"})}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),I(!0)},className:"absolute top-3 left-3 p-1 rounded-full hover:bg-muted transition-colors",children:e.jsx(me,{className:"w-4 h-4 text-muted-foreground"})})]})]})}),e.jsx(j,{})]})})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(xe,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.contactInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.contactInfoDesc")})]}),e.jsx(u,{control:r.control,name:"name",render:({field:t})=>e.jsxs(h,{children:[e.jsx(y,{children:s("joinUs.name")}),e.jsx(f,{children:e.jsx(v,{placeholder:s("joinUs.namePlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(u,{control:r.control,name:"email",render:({field:t})=>e.jsxs(h,{children:[e.jsx(y,{children:s("joinUs.email")}),e.jsx(f,{children:e.jsx(v,{type:"email",placeholder:s("joinUs.emailPlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(u,{control:r.control,name:"phone",render:({field:t})=>e.jsxs(h,{children:[e.jsx(y,{children:s("joinUs.phone")}),e.jsx(f,{children:e.jsx(v,{type:"tel",placeholder:s("joinUs.phonePlaceholder"),...t})}),e.jsx(j,{})]})})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(ue,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.restaurantInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.restaurantInfoDesc")})]}),e.jsx(u,{control:r.control,name:"restaurant_name",render:({field:t})=>e.jsxs(h,{children:[e.jsx(y,{children:s("joinUs.restaurantName")}),e.jsx(f,{children:e.jsx(v,{placeholder:s("joinUs.restaurantNamePlaceholder"),...t})}),e.jsx(j,{})]})}),e.jsx(u,{control:r.control,name:"restaurant_address",render:({field:t})=>e.jsxs(h,{children:[e.jsx(y,{children:s("joinUs.restaurantAddress")}),e.jsx(f,{children:e.jsx(v,{placeholder:s("joinUs.restaurantAddressPlaceholder"),...t})}),e.jsx(j,{})]})})]}),n===4&&!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(q,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:s("joinUs.featuresNeeded")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("joinUs.featuresDescription")})]}),e.jsx(u,{control:r.control,name:"features_selected",render:({field:t})=>e.jsxs(h,{children:[e.jsx("div",{className:"space-y-3",children:H.map(a=>{const p=t.value?.includes(a);return e.jsxs("div",{className:"flex flex-row items-center space-x-3 space-y-0 rounded-lg border p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{p?t.onChange(t.value?.filter(U=>U!==a)):t.onChange([...t.value||[],a])},children:[e.jsx("div",{className:m("h-4 w-4 shrink-0 rounded-sm border flex items-center justify-center transition-colors",p?"bg-primary border-primary text-primary-foreground":"border-primary"),children:p&&e.jsx(x,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-normal cursor-pointer flex-1 text-sm",children:s(`joinUs.feature.${a}`)})]},a)})}),e.jsx(j,{})]})}),e.jsx(u,{control:r.control,name:"invitation_code",render:({field:t})=>e.jsxs(h,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),s("joinUs.invitationCode"),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs",children:["(",s("joinUs.optional"),")"]})]}),e.jsx(f,{children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{placeholder:s("joinUs.invitationCodePlaceholder","如有邀请码请输入"),...t,disabled:!l,onChange:a=>{t.onChange(a),l&&T(a.target.value)},onFocus:()=>{l||w({title:s("joinUs.qrcodeRequired","请先勾选扫码点餐"),description:s("joinUs.qrcodeRequiredDesc","只有选择扫码点餐功能后才能使用邀请码")})},className:m("pr-10",!l&&"cursor-not-allowed opacity-50")}),l&&c.isValidating&&e.jsx(L,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground"}),l&&!c.isValidating&&c.isValid===!0&&e.jsx(x,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-green-500"}),l&&!c.isValidating&&c.isValid===!1&&t.value&&e.jsx(he,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-red-500"})]})}),!l&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s("joinUs.qrcodeRequiredHint","需要勾选扫码点餐功能后才能填写邀请码")}),l&&c.isValid===!0&&e.jsx("p",{className:"text-xs text-green-600",children:s("joinUs.invitationCodeValid","邀请码有效")}),l&&c.isValid===!1&&t.value&&e.jsx("p",{className:"text-xs text-red-600",children:s("joinUs.invitationCodeInvalid","邀请码无效")}),e.jsx(j,{})]})})]}),n===N&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center pb-4",children:[s("joinUs.consentText")," ",e.jsx(z,{to:"/privacy-policy",className:"text-primary hover:underline",children:s("joinUs.privacyPolicy")})," ",s("joinUs.and")," ",e.jsx(z,{to:"/terms-of-service",className:"text-primary hover:underline",children:s("joinUs.termsOfService")})]}),e.jsxs("div",{className:"flex justify-between gap-4 pt-4",children:[n>1?e.jsxs(_,{type:"button",variant:"outline",onClick:K,className:"flex-1",children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),s("joinUs.prev")]}):e.jsx("div",{className:"flex-1"}),n<N?e.jsxs(_,{type:"button",onClick:Y,className:"flex-1",children:[s("joinUs.next"),e.jsx(pe,{className:"w-4 h-4 ml-2"})]}):e.jsxs(_,{type:"submit",className:"flex-1",disabled:R,children:[R&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),s("joinUs.submit")]})]}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{type:"button",onClick:()=>be("https://xiaoxiong.pt/en/pages/subscription"),className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[s("joinUs.visitOurWebsite","访问我们的官网查看详细信息"),e.jsx(fe,{className:"w-3 h-3"})]})})]})})})]})}),e.jsx(Ue,{open:B,onOpenChange:I,children:e.jsxs(_e,{className:"sm:max-w-lg",children:[e.jsxs(we,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),s("joinUs.ghostRestaurantInfoTitle")]}),e.jsx(Ve,{asChild:!0,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsx("p",{children:s("joinUs.ghostRestaurantInfo1")}),e.jsx("p",{children:s("joinUs.ghostRestaurantInfo2")}),e.jsx("p",{children:s("joinUs.ghostRestaurantInfo3")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-foreground",children:s("joinUs.ghostRestaurantFeatures")}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s("joinUs.ghostRestaurantFeature1")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s("joinUs.ghostRestaurantFeature2")})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-primary flex-shrink-0 mt-0.5"}),e.jsx("span",{children:s("joinUs.ghostRestaurantFeature3")})]})]})]}),e.jsx("div",{className:"bg-primary/10 rounded-lg p-3 border border-primary/20",children:e.jsx("p",{className:"text-sm font-medium text-primary",children:s("joinUs.ghostRestaurantSummary")})})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(_,{onClick:()=>I(!1),children:s("common.gotIt")})})]})})]})};export{He as default};
//# sourceMappingURL=JoinUs-DnwOBYPf.js.map
