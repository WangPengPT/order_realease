{"version":3,"mappings":"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","names":["RestaurantDetailSkeleton","jsxs","jsx","Skeleton","Card","CardHeader","CardContent","i","priceRanges","RestaurantRating","restaurantId","t","useTranslation","comments","useComments","ratedComments","c","averageRating","sum","ratingDistribution","star","priceRangeStats","acc","comment","mostCommonPriceRange","a","b","CardTitle","Star","cn","DollarSign","r","count","percentage","Trans","useRestaurantActivities","useQuery","data","error","supabase","now","item","activity","startDate","endDate","getLocalizedActivityTitle","language","getLocalizedBadgeText","badgeText","getLocalizedIntro","GALLERY_VIEW_KEY","RestaurantDishGallery","showGallery","images","isLoading","useDishImages","lightboxOpen","setLightboxOpen","useState","currentIndex","setCurrentIndex","isCollapsed","setIsCollapsed","isMobile","useIsMobile","viewMode","setViewMode","saved","useEffect","openLightbox","useCallback","index","closeLightbox","goToPrevious","prev","goToNext","e","getCarouselItemClass","Fragment","Collapsible","open","CollapsibleTrigger","ImageIcon","Button","Square","LayoutGrid","ChevronDown","CollapsibleContent","Carousel","CarouselContent","image","CarouselItem","CarouselPrevious","CarouselNext","ImagePreviewModal","ChevronLeft","ChevronRight","OwnerBioDrawer","ownerBio","ownerName","ownerAvatarUrl","avatarFallback","Sheet","SheetTrigger","SheetContent","SheetHeader","SheetTitle","Sparkles","Quote","GhostRestaurantVideoModal","onOpenChange","videoUrl","posterUrl","title","videoRef","useRef","progressRef","isPlaying","setIsPlaying","isMuted","setIsMuted","isFullscreen","setIsFullscreen","currentTime","setCurrentTime","duration","setDuration","showControls","setShowControls","controlsTimeoutRef","formatTime","seconds","mins","secs","handlePlayPause","handleMuteToggle","handleFullscreenToggle","handleProgressClick","rect","showControlsTemporarily","handleProgressTouch","touchX","handlePlay","handlePauseEvent","handleTimeUpdate","handleLoadedMetadata","handleEnded","progress","DialogPrimitive.Root","DialogPrimitive.Portal","DialogPrimitive.Overlay","DialogPrimitive.Content","VisuallyHidden","DialogPrimitive.Title","X","Play","Pause","VolumeX","Volume2","Minimize","Maximize","useRestaurantPosts","merchants","merchantUserIds","m","posts","post","GhostRestaurantRecentPosts","memo","Loader2","FileText","PostGridCard","Link","ArrowRight","FOOD_PHILOSOPHY_MAX_HEIGHT","FoodPhilosophySection","foodDescription","cleanFoodDesc","isExpanded","setIsExpanded","isOverflowing","setIsOverflowing","contentRef","checkOverflow","GhostRestaurantHero","restaurant","localizedRestaurant","backUrl","user","isFavorite","onToggleFavorite","onShare","showEditButton","editButton","reportButton","getLocalizedField","useLocalizedContent","useEnvironment","videoModalOpen","setVideoModalOpen","avatarPreviewOpen","setAvatarPreviewOpen","videoReady","setVideoReady","videoError","setVideoError","isVideoBanner","bannerImage","videoPoster","autoplayFailed","setAutoplayFailed","maxAutoplayAttempts","stripHtml","html","truncatedBio","shouldShowViewMore","truncatedFoodDesc","videoContainerRef","handleVisibilityChange","isVisible","attemptAutoplay","video","err","attempts","timeoutId","isMounted","tryAutoplay","handleLoadedData","handleError","observer","entries","entry","handleBannerClick","Share2","Heart","Badge","Ghost","formatTrademarkSymbols","CollapsibleText","text","MAX_HEIGHT","formatTrademarkSymbolsInHtml","blocks","getLocalizedBlockContent","block","content","isFirstImage","isLastImage","GhostRestaurantBrandStory","brandId","i18n","brand","useBrand","getLocalizedBrandName","hasContentBlocks","hasLogo","intro","Building2","AspectRatio","AspectRatioPrimitive.Root","formatDuration","VideoCard","onClick","Film","GhostRestaurantVideos","videos","selectedVideo","setSelectedVideo","getLocalizedVideoTitle","RestaurantComments","lazy","GhostRestaurantStory","restaurantActivities","ratingCount","onTakeawayClick","onNavigationClick","dishImages","hasDishImages","commentsSectionRef","ShoppingBag","Camera","idx","MapPin","type","Separator","Navigation","Phone","MessageCircle","Suspense","BrandAboutSection","isOpen","setIsOpen","RestaurantDetail","id","useParams","location","useLocation","useAuth","localizeRestaurant","mapContainer","map","distance","setDistance","hoursOpen","setHoursOpen","mapOpen","setMapOpen","announcementOpen","setAnnouncementOpen","activitiesOpen","setActivitiesOpen","shouldLoadMap","setShouldLoadMap","shouldLoadComments","setShouldLoadComments","isGeneratingToken","setIsGeneratingToken","mapSectionRef","showNavigationDialog","setShowNavigationDialog","showLoginDialog","setShowLoginDialog","showOrderDialog","setShowOrderDialog","showPrivateDialog","setShowPrivateDialog","navigate","useNavigate","queryClient","useQueryClient","smartShareFn","SmartShareDrawer","useSmartShare","handleRefresh","usePageView","fromActivity","fromAdmin","fromProfile","useRestaurant","favoriteIds","useFavorites","toggleFavorite","useToggleFavorite","role","isAdmin","useUserRole","myRestaurants","useMerchantRestaurants","isMerchantOfRestaurant","useMemo","stats","totalPriceRangeCount","priceRangeDisplay","avg","getUserLocation","position","dist","calculateDistance","handleToggleFavorite","handleCopyLink","toast","handleNativeShare","handleShareToPlatform","platform","url","shareUrl","isIOSWebView","mapObserver","commentsObserver","token","mapboxgl","isIOSDevice","initMap","el","mapIcon","timer","RestaurantFormDialog","Edit","ReportDialog","ShieldAlert","AlertDialog","AlertDialogContent","AlertDialogHeader","ExternalLink","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogAction","finalUrl","tokenErr","openExternalUrl","AlertDialogCancel","openNavigation","PullToRefresh","DropdownMenu","DropdownMenuTrigger","DropdownMenuContent","DropdownMenuItem","DropdownMenuSeparator","Link2","Wallet","Clock","formatOpeningHours","days","dayKeys","currentDay","day","hours","isToday","displayName","hoursText","UtensilsCrossed","targetUrl"],"ignoreList":[],"sources":["../../src/components/skeletons/RestaurantDetailSkeleton.tsx","../../src/components/RestaurantRating.tsx","../../src/hooks/useRestaurantActivities.ts","../../src/components/RestaurantDishGallery.tsx","../../src/components/OwnerBioDrawer.tsx","../../src/components/GhostRestaurantVideoModal.tsx","../../src/components/GhostRestaurantRecentPosts.tsx","../../src/components/GhostRestaurantHero.tsx","../../src/components/GhostRestaurantBrandStory.tsx","../../src/components/ui/aspect-ratio.tsx","../../src/components/GhostRestaurantVideos.tsx","../../src/components/GhostRestaurantStory.tsx","../../src/components/BrandAboutSection.tsx","../../src/pages/RestaurantDetail.tsx"],"sourcesContent":["import { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { ChevronLeft } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\nconst RestaurantDetailSkeleton = () => {\r\n  return (\r\n    <div className=\"min-h-screen bg-background pb-8\">\r\n      {/* Hero Image Section */}\r\n      <div className=\"relative h-[30vh] sm:h-[35vh] overflow-hidden\">\r\n        <Skeleton className=\"w-full h-full rounded-none\" />\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent\" />\r\n        \r\n        {/* Back Button */}\r\n        <div className=\"absolute top-4 left-4\">\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n        </div>\r\n        \r\n        {/* Action Buttons */}\r\n        <div className=\"absolute top-4 right-4 flex gap-2\">\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n          <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"container mx-auto px-4 -mt-16 relative z-10\">\r\n        <Card className=\"shadow-large\">\r\n          <CardHeader>\r\n            <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\r\n              <div className=\"flex-1\">\r\n                {/* Type badges */}\r\n                <div className=\"mb-3 flex flex-wrap gap-2\">\r\n                  <Skeleton className=\"h-6 w-16 rounded-full\" />\r\n                  <Skeleton className=\"h-6 w-20 rounded-full\" />\r\n                  <Skeleton className=\"h-6 w-14 rounded-full\" />\r\n                </div>\r\n                \r\n                {/* Restaurant name */}\r\n                <Skeleton className=\"h-9 w-64 mb-3\" />\r\n                \r\n                {/* Rating and distance */}\r\n                <div className=\"flex items-center gap-4 mb-2\">\r\n                  <Skeleton className=\"h-5 w-20\" />\r\n                  <Skeleton className=\"h-5 w-24\" />\r\n                  <Skeleton className=\"h-5 w-16\" />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Action buttons */}\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-10 w-28 rounded-md\" />\r\n                <Skeleton className=\"h-10 w-10 rounded-md\" />\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          \r\n          <CardContent className=\"space-y-6\">\r\n            {/* Announcement section */}\r\n            <div className=\"space-y-2\">\r\n              <Skeleton className=\"h-5 w-24\" />\r\n              <Skeleton className=\"h-16 w-full rounded-md\" />\r\n            </div>\r\n            \r\n            {/* Activities section */}\r\n            <div className=\"space-y-2\">\r\n              <Skeleton className=\"h-5 w-32\" />\r\n              <div className=\"flex gap-2\">\r\n                <Skeleton className=\"h-8 w-24 rounded-full\" />\r\n                <Skeleton className=\"h-8 w-28 rounded-full\" />\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Info rows */}\r\n            <div className=\"space-y-4\">\r\n              {/* Address */}\r\n              <div className=\"flex items-start gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-1\">\r\n                  <Skeleton className=\"h-5 w-full\" />\r\n                  <Skeleton className=\"h-5 w-3/4\" />\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Phone */}\r\n              <div className=\"flex items-center gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <Skeleton className=\"h-5 w-32\" />\r\n              </div>\r\n              \r\n              {/* Hours */}\r\n              <div className=\"flex items-start gap-3\">\r\n                <Skeleton className=\"h-5 w-5 flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-1\">\r\n                  <Skeleton className=\"h-5 w-40\" />\r\n                  <Skeleton className=\"h-5 w-48\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Map Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader>\r\n            <Skeleton className=\"h-6 w-20\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <Skeleton className=\"h-[200px] w-full rounded-lg\" />\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Photo Gallery Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader>\r\n            <Skeleton className=\"h-6 w-24\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex gap-3 overflow-hidden\">\r\n              {[1, 2, 3, 4].map((i) => (\r\n                <Skeleton key={i} className=\"h-24 w-24 rounded-lg flex-shrink-0\" />\r\n              ))}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        \r\n        {/* Comments Section */}\r\n        <Card className=\"mt-6 shadow-large\">\r\n          <CardHeader className=\"flex flex-row items-center justify-between\">\r\n            <Skeleton className=\"h-6 w-32\" />\r\n            <Skeleton className=\"h-9 w-24 rounded-md\" />\r\n          </CardHeader>\r\n          <CardContent className=\"space-y-4\">\r\n            {[1, 2, 3].map((i) => (\r\n              <div key={i} className=\"flex gap-3\">\r\n                <Skeleton className=\"h-10 w-10 rounded-full flex-shrink-0\" />\r\n                <div className=\"flex-1 space-y-2\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Skeleton className=\"h-4 w-24\" />\r\n                    <Skeleton className=\"h-4 w-16\" />\r\n                  </div>\r\n                  <Skeleton className=\"h-4 w-full\" />\r\n                  <Skeleton className=\"h-4 w-3/4\" />\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RestaurantDetailSkeleton;\r\n","import { Star, DollarSign } from \"lucide-react\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { useComments } from \"@/hooks/useComments\";\r\nimport { useTranslation, Trans } from \"react-i18next\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface RestaurantRatingProps {\r\n  restaurantId: string;\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5\" },\r\n  { value: \"5-10\", label: \"5-10\" },\r\n  { value: \"10-15\", label: \"10-15\" },\r\n  { value: \"15-20\", label: \"15-20\" },\r\n  { value: \"20-25\", label: \"20-25\" },\r\n  { value: \"25-30\", label: \"25-30\" },\r\n  { value: \"30-40\", label: \"30-40\" },\r\n  { value: \"40-50\", label: \"40-50\" },\r\n  { value: \"50+\", label: \"50+\" },\r\n];\r\n\r\nconst RestaurantRating = ({ restaurantId }: RestaurantRatingProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  // Get all comments with ratings\r\n  const { data: comments } = useComments(restaurantId, \"restaurant\");\r\n  \r\n  // Filter comments that have ratings\r\n  const ratedComments = comments?.filter(c => c.rating_value) || [];\r\n\r\n  const averageRating = ratedComments.length\r\n    ? ratedComments.reduce((sum, c) => sum + (c.rating_value || 0), 0) / ratedComments.length\r\n    : 0;\r\n\r\n  const ratingDistribution = [5, 4, 3, 2, 1].map((star) => ({\r\n    star,\r\n    count: ratedComments.filter((c) => c.rating_value === star).length,\r\n    percentage: ratedComments.length\r\n      ? ((ratedComments.filter((c) => c.rating_value === star).length / ratedComments.length) * 100).toFixed(0)\r\n      : 0,\r\n  }));\r\n\r\n  // Calculate most common price range\r\n  const priceRangeStats = ratedComments.reduce((acc, comment) => {\r\n    if (comment.price_range) {\r\n      acc[comment.price_range] = (acc[comment.price_range] || 0) + 1;\r\n    }\r\n    return acc;\r\n  }, {} as Record<string, number>);\r\n\r\n  const mostCommonPriceRange = priceRangeStats && Object.keys(priceRangeStats).length > 0\r\n    ? Object.entries(priceRangeStats).sort((a, b) => b[1] - a[1])[0]\r\n    : null;\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle>{t(\"restaurant.rating\")}</CardTitle>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Average Rating Display */}\r\n        <div className=\"flex items-center gap-6\">\r\n          <div className=\"text-center\">\r\n            <div className=\"text-5xl font-bold\">{averageRating.toFixed(1)}</div>\r\n            <div className=\"flex items-center justify-center mt-2\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-5 h-5\",\r\n                    star <= Math.round(averageRating)\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            <div className=\"text-sm text-muted-foreground mt-1\">\r\n              {ratedComments.length} {t(\"restaurant.ratingsCount\")}\r\n            </div>\r\n            {mostCommonPriceRange && (\r\n              <div className=\"flex items-center justify-center gap-1 mt-2 text-sm\">\r\n                <DollarSign className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"font-semibold text-foreground\">\r\n                  {priceRanges.find(r => r.value === mostCommonPriceRange[0])?.label}\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Rating Distribution */}\r\n          <div className=\"flex-1 space-y-2\">\r\n            {ratingDistribution.map(({ star, count, percentage }) => (\r\n              <div key={star} className=\"flex items-center gap-2 text-sm\">\r\n                <span className=\"w-8\">{star} </span>\r\n                <div className=\"flex-1 h-2 bg-secondary rounded-full overflow-hidden\">\r\n                  <div\r\n                    className=\"h-full bg-accent transition-all\"\r\n                    style={{ width: `${percentage}%` }}\r\n                  />\r\n                </div>\r\n                <span className=\"w-12 text-right text-muted-foreground\">{count}</span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Info message */}\r\n        <div className=\"pt-4 border-t text-center text-sm text-muted-foreground\">\r\n          <Trans\r\n            i18nKey=\"restaurant.signInToRate\"\r\n            components={{\r\n              login: <a href=\"/auth\" className=\"text-primary hover:underline font-medium\" />\r\n            }}\r\n          />\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default RestaurantRating;\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport interface RestaurantActivity {\r\n  activity_id: string;\r\n  title_zh: string;\r\n  title_en: string;\r\n  title_pt: string;\r\n  intro_zh?: string | null;\r\n  intro_en?: string | null;\r\n  intro_pt?: string | null;\r\n  badge_text_zh?: string | null;\r\n  badge_text_en?: string | null;\r\n  badge_text_pt?: string | null;\r\n  badge_color?: string | null;\r\n}\r\n\r\n// Get activities for a specific restaurant\r\nexport const useRestaurantActivities = (restaurantId: string) => {\r\n  const { i18n } = useTranslation();\r\n\r\n  return useQuery({\r\n    queryKey: [\"restaurant-activities\", restaurantId],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(`\r\n          activity_id,\r\n          activities (\r\n            id,\r\n            title_zh,\r\n            title_en,\r\n            title_pt,\r\n            intro_zh,\r\n            intro_en,\r\n            intro_pt,\r\n            badge_text_zh,\r\n            badge_text_en,\r\n            badge_text_pt,\r\n            badge_color,\r\n            start_date,\r\n            end_date\r\n          )\r\n        `)\r\n        .eq(\"restaurant_id\", restaurantId);\r\n\r\n      if (error) throw error;\r\n\r\n      // Filter only active activities\r\n      const now = new Date();\r\n      const activeActivities = data\r\n        .filter((item: any) => {\r\n          const activity = item.activities;\r\n          if (!activity) return false;\r\n          \r\n          const startDate = new Date(activity.start_date);\r\n          const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n          \r\n          return startDate <= now && (!endDate || endDate >= now);\r\n        })\r\n        .map((item: any) => ({\r\n          activity_id: item.activity_id,\r\n          title_zh: item.activities.title_zh,\r\n          title_en: item.activities.title_en,\r\n          title_pt: item.activities.title_pt,\r\n          intro_zh: item.activities.intro_zh,\r\n          intro_en: item.activities.intro_en,\r\n          intro_pt: item.activities.intro_pt,\r\n          badge_text_zh: item.activities.badge_text_zh,\r\n          badge_text_en: item.activities.badge_text_en,\r\n          badge_text_pt: item.activities.badge_text_pt,\r\n          badge_color: item.activities.badge_color,\r\n        }));\r\n\r\n      return activeActivities as RestaurantActivity[];\r\n    },\r\n    enabled: !!restaurantId,\r\n  });\r\n};\r\n\r\n// Get activities for multiple restaurants at once (for list views)\r\nexport const useBatchRestaurantActivities = (restaurantIds: string[]) => {\r\n  const { i18n } = useTranslation();\r\n\r\n  return useQuery({\r\n    queryKey: [\"batch-restaurant-activities\", restaurantIds.join(\",\")],\r\n    queryFn: async () => {\r\n      if (restaurantIds.length === 0) return {};\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(`\r\n          restaurant_id,\r\n          activity_id,\r\n          activities (\r\n            id,\r\n            title_zh,\r\n            title_en,\r\n            title_pt,\r\n            intro_zh,\r\n            intro_en,\r\n            intro_pt,\r\n            badge_text_zh,\r\n            badge_text_en,\r\n            badge_text_pt,\r\n            badge_color,\r\n            start_date,\r\n            end_date\r\n          )\r\n        `)\r\n        .in(\"restaurant_id\", restaurantIds);\r\n\r\n      if (error) throw error;\r\n\r\n      // Group by restaurant and filter active activities\r\n      const now = new Date();\r\n      const activitiesByRestaurant: { [key: string]: RestaurantActivity[] } = {};\r\n\r\n      data.forEach((item: any) => {\r\n        const activity = item.activities;\r\n        if (!activity) return;\r\n\r\n        const startDate = new Date(activity.start_date);\r\n        const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n\r\n        if (startDate <= now && (!endDate || endDate >= now)) {\r\n          if (!activitiesByRestaurant[item.restaurant_id]) {\r\n            activitiesByRestaurant[item.restaurant_id] = [];\r\n          }\r\n\r\n          activitiesByRestaurant[item.restaurant_id].push({\r\n            activity_id: item.activity_id,\r\n            title_zh: activity.title_zh,\r\n            title_en: activity.title_en,\r\n            title_pt: activity.title_pt,\r\n            intro_zh: activity.intro_zh,\r\n            intro_en: activity.intro_en,\r\n            intro_pt: activity.intro_pt,\r\n            badge_text_zh: activity.badge_text_zh,\r\n            badge_text_en: activity.badge_text_en,\r\n            badge_text_pt: activity.badge_text_pt,\r\n            badge_color: activity.badge_color,\r\n          });\r\n        }\r\n      });\r\n\r\n      return activitiesByRestaurant;\r\n    },\r\n    enabled: restaurantIds.length > 0,\r\n  });\r\n};\r\n\r\n// Helper to get localized activity title\r\nexport const getLocalizedActivityTitle = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  if (language === \"zh\") return activity.title_zh;\r\n  if (language === \"pt\") return activity.title_pt;\r\n  return activity.title_en;\r\n};\r\n\r\n// Helper to get localized badge text or fallback to activity title\r\nexport const getLocalizedBadgeText = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  let badgeText = \"\";\r\n  if (language === \"zh\") {\r\n    badgeText = activity.badge_text_zh || activity.title_zh;\r\n  } else if (language === \"pt\") {\r\n    badgeText = activity.badge_text_pt || activity.title_pt;\r\n  } else {\r\n    badgeText = activity.badge_text_en || activity.title_en;\r\n  }\r\n  return badgeText;\r\n};\r\n\r\n// Helper to get localized intro text\r\nexport const getLocalizedIntro = (\r\n  activity: RestaurantActivity,\r\n  language: string\r\n): string => {\r\n  if (language === \"zh\") {\r\n    return activity.intro_zh || \"\";\r\n  } else if (language === \"pt\") {\r\n    return activity.intro_pt || \"\";\r\n  } else {\r\n    return activity.intro_en || \"\";\r\n  }\r\n};\r\n","import { useState, useCallback, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  CarouselNext,\r\n  CarouselPrevious,\r\n} from \"@/components/ui/carousel\";\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from \"@/components/ui/collapsible\";\r\nimport { ChevronLeft, ChevronRight, X, ImageIcon, ChevronDown, LayoutGrid, Square } from \"lucide-react\";\r\nimport { useDishImages } from \"@/hooks/useDishImages\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RestaurantDishGalleryProps {\r\n  restaurantId: string;\r\n  showGallery?: boolean;\r\n}\r\n\r\nconst GALLERY_VIEW_KEY = \"dish-gallery-view-mode\";\r\n\r\nexport function RestaurantDishGallery({ restaurantId, showGallery = true }: RestaurantDishGalleryProps) {\r\n  const { t } = useTranslation();\r\n  const { data: images = [], isLoading } = useDishImages(restaurantId);\r\n  const [lightboxOpen, setLightboxOpen] = useState(false);\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [isCollapsed, setIsCollapsed] = useState(false);\r\n  const isMobile = useIsMobile();\r\n  \r\n  // View mode: 'single' or 'multi' - only for mobile\r\n  const [viewMode, setViewMode] = useState<'single' | 'multi'>(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem(GALLERY_VIEW_KEY);\r\n      return (saved === 'single' || saved === 'multi') ? saved : 'multi';\r\n    }\r\n    return 'multi';\r\n  });\r\n\r\n  // Persist view mode preference\r\n  useEffect(() => {\r\n    localStorage.setItem(GALLERY_VIEW_KEY, viewMode);\r\n  }, [viewMode]);\r\n\r\n  const openLightbox = useCallback((index: number) => {\r\n    setCurrentIndex(index);\r\n    setLightboxOpen(true);\r\n  }, []);\r\n\r\n  const closeLightbox = useCallback(() => {\r\n    setLightboxOpen(false);\r\n  }, []);\r\n\r\n  const goToPrevious = useCallback(() => {\r\n    setCurrentIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));\r\n  }, [images.length]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    setCurrentIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));\r\n  }, [images.length]);\r\n\r\n  // Handle keyboard navigation\r\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\r\n    if (e.key === \"ArrowLeft\") goToPrevious();\r\n    if (e.key === \"ArrowRight\") goToNext();\r\n    if (e.key === \"Escape\") closeLightbox();\r\n  }, [goToPrevious, goToNext, closeLightbox]);\r\n\r\n  if (isLoading) {\r\n    return null;\r\n  }\r\n\r\n  // Don't render if gallery is disabled or no images\r\n  if (!showGallery || !images.length) {\r\n    return null;\r\n  }\r\n\r\n  // Determine basis class based on view mode (mobile only)\r\n  const getCarouselItemClass = () => {\r\n    if (isMobile && viewMode === 'single') {\r\n      return \"pl-2 basis-full\";\r\n    }\r\n    return \"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4\";\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card>\r\n        <Collapsible open={!isCollapsed} onOpenChange={(open) => setIsCollapsed(!open)}>\r\n          <CardHeader className=\"pb-3\">\r\n            <CollapsibleTrigger className=\"w-full\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                  <ImageIcon className=\"w-5 h-5\" />\r\n                  {t(\"restaurant.photoGallery\")}\r\n                  <span className=\"text-sm font-normal text-muted-foreground\">\r\n                    ({images.length})\r\n                  </span>\r\n                </CardTitle>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {/* Mobile-only view mode toggle */}\r\n                  {isMobile && (\r\n                    <div \r\n                      className=\"flex items-center gap-1 bg-muted rounded-md p-0.5\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <Button\r\n                        variant={viewMode === 'single' ? 'default' : 'ghost'}\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setViewMode('single');\r\n                        }}\r\n                        title={t(\"dishImages.singleView\")}\r\n                      >\r\n                        <Square className=\"h-4 w-4\" />\r\n                      </Button>\r\n                      <Button\r\n                        variant={viewMode === 'multi' ? 'default' : 'ghost'}\r\n                        size=\"icon\"\r\n                        className=\"h-7 w-7\"\r\n                        onClick={(e) => {\r\n                          e.stopPropagation();\r\n                          setViewMode('multi');\r\n                        }}\r\n                        title={t(\"dishImages.multiView\")}\r\n                      >\r\n                        <LayoutGrid className=\"h-4 w-4\" />\r\n                      </Button>\r\n                    </div>\r\n                  )}\r\n                  <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${!isCollapsed ? 'rotate-180' : ''}`} />\r\n                </div>\r\n              </div>\r\n            </CollapsibleTrigger>\r\n          </CardHeader>\r\n          <CollapsibleContent>\r\n            <CardContent>\r\n              <Carousel className=\"w-full\">\r\n                <CarouselContent className=\"-ml-2 md:-ml-4\">\r\n                  {images.map((image, index) => (\r\n                    <CarouselItem\r\n                      key={image.id}\r\n                      className={getCarouselItemClass()}\r\n                    >\r\n                      <div\r\n                        className=\"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity\"\r\n                        onClick={() => openLightbox(index)}\r\n                      >\r\n                        <img\r\n                          src={image.image_url}\r\n                          alt={`Dish ${index + 1}`}\r\n                          className=\"w-full h-full object-cover\"\r\n                          loading=\"lazy\"\r\n                        />\r\n                      </div>\r\n                    </CarouselItem>\r\n                  ))}\r\n                </CarouselContent>\r\n                {images.length > (isMobile && viewMode === 'single' ? 1 : 2) && (\r\n                  <>\r\n                    <CarouselPrevious className=\"-left-3 md:-left-4\" />\r\n                    <CarouselNext className=\"-right-3 md:-right-4\" />\r\n                  </>\r\n                )}\r\n              </Carousel>\r\n              <p className=\"text-sm text-muted-foreground mt-2 text-center\">\r\n                {t(\"dishImages.clickToEnlarge\")}\r\n              </p>\r\n            </CardContent>\r\n          </CollapsibleContent>\r\n        </Collapsible>\r\n      </Card>\r\n\r\n      {/* Image Preview with Navigation */}\r\n      {lightboxOpen && (\r\n        <>\r\n          <ImagePreviewModal\r\n            imageUrl={images[currentIndex]?.image_url || \"\"}\r\n            isOpen={lightboxOpen}\r\n            onClose={closeLightbox}\r\n          />\r\n          {/* Navigation overlay for multi-image gallery */}\r\n          {images.length > 1 && (\r\n            <div className=\"fixed inset-0 z-[101] pointer-events-none\">\r\n              {/* Previous button */}\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  goToPrevious();\r\n                }}\r\n              >\r\n                <ChevronLeft className=\"w-8 h-8\" />\r\n              </Button>\r\n\r\n              {/* Next button */}\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  goToNext();\r\n                }}\r\n              >\r\n                <ChevronRight className=\"w-8 h-8\" />\r\n              </Button>\r\n\r\n              {/* Image counter */}\r\n              <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm pointer-events-auto\">\r\n                {currentIndex + 1} / {images.length}\r\n              </div>\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n}","import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetTrigger } from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Quote, ChevronRight, Sparkles } from \"lucide-react\";\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\n\r\ninterface OwnerBioDrawerProps {\r\n  ownerBio: string;\r\n  ownerName: string;\r\n  ownerAvatarUrl?: string;\r\n  avatarFallback: string;\r\n}\r\n\r\nexport const OwnerBioDrawer = ({\r\n  ownerBio,\r\n  ownerName,\r\n  ownerAvatarUrl,\r\n  avatarFallback,\r\n}: OwnerBioDrawerProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Sheet>\r\n      <SheetTrigger asChild>\r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"sm\" \r\n          className=\"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1\"\r\n        >\r\n          {t(\"common.viewAll\", \"\")}\r\n          <ChevronRight className=\"w-4 h-4\" />\r\n        </Button>\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"max-h-[85dvh] rounded-t-[10px] p-0 flex flex-col overflow-hidden\"\r\n        onPointerDownOutside={(e) => e.preventDefault()}\r\n      >\r\n        <SheetHeader className=\"p-4 pb-2 shrink-0\">\r\n          <SheetTitle className=\"flex items-center gap-2 text-lg\">\r\n            <Sparkles className=\"w-5 h-5 text-primary\" />\r\n            {t(\"restaurants.ownerStory\", \"\")}\r\n          </SheetTitle>\r\n        </SheetHeader>\r\n        <div className=\"flex-1 min-h-0 overflow-y-auto overscroll-contain -webkit-overflow-scrolling-touch px-4 pb-8\">\r\n          <div className=\"relative max-w-2xl mx-auto\">\r\n            {/* Large quote mark */}\r\n            <Quote className=\"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180\" />\r\n            \r\n            {/* Story content */}\r\n            <div className=\"relative z-10 pt-6 space-y-4\">\r\n              <p className=\"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1\">\r\n                {ownerBio}\r\n              </p>\r\n              \r\n            </div>\r\n            \r\n            {/* Signature */}\r\n            <div className=\"mt-8 flex items-center gap-3 pt-6 border-t\">\r\n              <div className=\"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg\">\r\n                {ownerAvatarUrl ? (\r\n                  <img \r\n                    src={ownerAvatarUrl} \r\n                    alt={ownerName}\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                ) : (\r\n                  avatarFallback\r\n                )}\r\n              </div>\r\n              <div className=\"text-left\">\r\n                <p className=\"font-semibold text-foreground\">{ownerName}</p>\r\n                <p className=\"text-xs text-muted-foreground\">{t(\"restaurants.chef\", \"\")}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default OwnerBioDrawer;\r\n","import * as DialogPrimitive from \"@radix-ui/react-dialog\";\r\nimport { VisuallyHidden } from \"@radix-ui/react-visually-hidden\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { X, Volume2, VolumeX, Maximize, Minimize, Play, Pause } from \"lucide-react\";\r\nimport { useRef, useState, useEffect, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface GhostRestaurantVideoModalProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  videoUrl: string;\r\n  posterUrl?: string;\r\n  title?: string;\r\n}\r\n\r\nexport const GhostRestaurantVideoModal = ({\r\n  open,\r\n  onOpenChange,\r\n  videoUrl,\r\n  posterUrl,\r\n  title,\r\n}: GhostRestaurantVideoModalProps) => {\r\n  const { t } = useTranslation();\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const progressRef = useRef<HTMLDivElement>(null);\r\n  const [isPlaying, setIsPlaying] = useState(false);\r\n  const [isMuted, setIsMuted] = useState(false);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [currentTime, setCurrentTime] = useState(0);\r\n  const [duration, setDuration] = useState(0);\r\n  const [showControls, setShowControls] = useState(true);\r\n  const controlsTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const formatTime = (seconds: number): string => {\r\n    const mins = Math.floor(seconds / 60);\r\n    const secs = Math.floor(seconds % 60);\r\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n  };\r\n\r\n  const handlePlayPause = useCallback(() => {\r\n    if (!videoRef.current) return;\r\n    if (isPlaying) {\r\n      videoRef.current.pause();\r\n    } else {\r\n      videoRef.current.play();\r\n    }\r\n  }, [isPlaying]);\r\n\r\n  const handleMuteToggle = useCallback(() => {\r\n    if (!videoRef.current) return;\r\n    videoRef.current.muted = !isMuted;\r\n    setIsMuted(!isMuted);\r\n  }, [isMuted]);\r\n\r\n  const handleFullscreenToggle = useCallback(async () => {\r\n    try {\r\n      if (!document.fullscreenElement) {\r\n        await videoRef.current?.requestFullscreen();\r\n        setIsFullscreen(true);\r\n      } else {\r\n        await document.exitFullscreen();\r\n        setIsFullscreen(false);\r\n      }\r\n    } catch (error) {\r\n      console.log('Fullscreen not supported:', error);\r\n    }\r\n  }, []);\r\n\r\n  const handleProgressClick = useCallback((e: React.MouseEvent<HTMLDivElement>) => {\r\n    if (!videoRef.current || !progressRef.current) return;\r\n    const rect = progressRef.current.getBoundingClientRect();\r\n    const clickX = e.clientX - rect.left;\r\n    const percentage = clickX / rect.width;\r\n    videoRef.current.currentTime = percentage * duration;\r\n  }, [duration]);\r\n\r\n  const showControlsTemporarily = useCallback(() => {\r\n    setShowControls(true);\r\n    if (controlsTimeoutRef.current) {\r\n      clearTimeout(controlsTimeoutRef.current);\r\n    }\r\n    controlsTimeoutRef.current = setTimeout(() => {\r\n      if (isPlaying) {\r\n        setShowControls(false);\r\n      }\r\n    }, 3000);\r\n  }, [isPlaying]);\r\n\r\n  const handleProgressTouch = useCallback((e: React.TouchEvent<HTMLDivElement>) => {\r\n    if (!videoRef.current || !progressRef.current) return;\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const rect = progressRef.current.getBoundingClientRect();\r\n    const touchX = e.touches[0].clientX - rect.left;\r\n    const percentage = Math.max(0, Math.min(1, touchX / rect.width));\r\n    videoRef.current.currentTime = percentage * duration;\r\n  }, [duration]);\r\n\r\n  // Reset state when modal opens/closes\r\n  useEffect(() => {\r\n    if (open && videoRef.current) {\r\n      // Reset video to start when opening\r\n      videoRef.current.currentTime = 0;\r\n      setCurrentTime(0);\r\n      setShowControls(true);\r\n      \r\n      // Auto-play when modal opens\r\n      videoRef.current.play().catch(() => {\r\n        // Autoplay blocked, show play button\r\n        setIsPlaying(false);\r\n      });\r\n    } else if (!open && videoRef.current) {\r\n      // Pause and reset when closing\r\n      videoRef.current.pause();\r\n      videoRef.current.currentTime = 0;\r\n      setIsPlaying(false);\r\n      setCurrentTime(0);\r\n      setShowControls(true);\r\n    }\r\n    \r\n    return () => {\r\n      if (controlsTimeoutRef.current) {\r\n        clearTimeout(controlsTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [open]);\r\n\r\n  // Video event handlers\r\n  const handlePlay = useCallback(() => setIsPlaying(true), []);\r\n  const handlePauseEvent = useCallback(() => setIsPlaying(false), []);\r\n  const handleTimeUpdate = useCallback(() => {\r\n    if (videoRef.current) {\r\n      setCurrentTime(videoRef.current.currentTime);\r\n    }\r\n  }, []);\r\n  const handleLoadedMetadata = useCallback(() => {\r\n    if (videoRef.current) {\r\n      setDuration(videoRef.current.duration);\r\n    }\r\n  }, []);\r\n  const handleEnded = useCallback(() => {\r\n    setIsPlaying(false);\r\n    setShowControls(true);\r\n  }, []);\r\n\r\n  const progress = duration > 0 ? (currentTime / duration) * 100 : 0;\r\n\r\n  return (\r\n    <DialogPrimitive.Root open={open} onOpenChange={onOpenChange}>\r\n      <DialogPrimitive.Portal>\r\n        {/* Overlay - Lower z-index, pointer-events-none to not block clicks */}\r\n        <DialogPrimitive.Overlay \r\n          className=\"fixed inset-0 z-[49] bg-black/90 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\"\r\n          style={{ pointerEvents: 'none' }}\r\n        />\r\n        \r\n        {/* Content Container - Higher z-index for proper layering */}\r\n        <div \r\n          className=\"fixed inset-0 z-50 flex items-center justify-center p-4\"\r\n          style={{ touchAction: 'none' }}\r\n          onClick={(e) => {\r\n            // Only close if clicking the backdrop, not the content\r\n            if (e.target === e.currentTarget) {\r\n              onOpenChange(false);\r\n            }\r\n          }}\r\n          onTouchEnd={(e) => {\r\n            // Close on tap backdrop\r\n            if (e.target === e.currentTarget) {\r\n              onOpenChange(false);\r\n            }\r\n          }}\r\n        >\r\n          <DialogPrimitive.Content \r\n            className=\"relative w-full max-w-4xl bg-black rounded-lg overflow-hidden outline-none\"\r\n            style={{ touchAction: 'auto' }}\r\n            aria-describedby={undefined}\r\n            onMouseMove={showControlsTemporarily}\r\n            onTouchStart={(e) => {\r\n              e.stopPropagation();\r\n              showControlsTemporarily();\r\n            }}\r\n            onTouchMove={(e) => {\r\n              e.stopPropagation();\r\n              showControlsTemporarily();\r\n            }}\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Accessibility: Hidden title for screen readers */}\r\n            <VisuallyHidden>\r\n              <DialogPrimitive.Title>{title || t(\"restaurants.videoPlayer\", \"Video Player\")}</DialogPrimitive.Title>\r\n            </VisuallyHidden>\r\n            {/* Close Button */}\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"ghost\"\r\n              size=\"icon\"\r\n              className={cn(\r\n                \"absolute top-3 right-3 z-[60] bg-black/50 hover:bg-black/70 text-white h-10 w-10 rounded-full transition-opacity duration-300\",\r\n                showControls ? \"opacity-100\" : \"opacity-0 pointer-events-none\"\r\n              )}\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onOpenChange(false);\r\n              }}\r\n            >\r\n              <X className=\"h-5 w-5\" />\r\n            </Button>\r\n\r\n            {/* Title */}\r\n            {title && (\r\n              <div className={cn(\r\n                \"absolute top-3 left-3 z-[60] transition-opacity duration-300 pointer-events-none\",\r\n                showControls ? \"opacity-100\" : \"opacity-0\"\r\n              )}>\r\n                <h3 className=\"text-white font-semibold text-lg drop-shadow-lg\">{title}</h3>\r\n              </div>\r\n            )}\r\n\r\n            {/* Video Player */}\r\n            <div className=\"relative aspect-video bg-black select-none\">\r\n              <video\r\n                ref={videoRef}\r\n                src={videoUrl}\r\n                poster={posterUrl}\r\n                className=\"w-full h-full object-contain cursor-pointer\"\r\n                playsInline\r\n                preload=\"metadata\"\r\n                onPlay={handlePlay}\r\n                onPause={handlePauseEvent}\r\n                onTimeUpdate={handleTimeUpdate}\r\n                onLoadedMetadata={handleLoadedMetadata}\r\n                onEnded={handleEnded}\r\n                onCanPlay={() => {\r\n                  // Ensure duration is set when video can play\r\n                  if (videoRef.current && !duration) {\r\n                    setDuration(videoRef.current.duration);\r\n                  }\r\n                }}\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  handlePlayPause();\r\n                }}\r\n                onTouchEnd={(e) => {\r\n                  // Only toggle play/pause if not dragging progress bar\r\n                  if (e.target === videoRef.current) {\r\n                    e.preventDefault();\r\n                    handlePlayPause();\r\n                  }\r\n                }}\r\n              />\r\n\r\n              {/* Play Overlay - Only show when paused, positioned above video but below controls */}\r\n              {!isPlaying && (\r\n                <div \r\n                  className=\"absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30\"\r\n                  style={{ zIndex: 5 }}\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handlePlayPause();\r\n                  }}\r\n                  onTouchEnd={(e) => {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    handlePlayPause();\r\n                  }}\r\n                >\r\n                  <div className=\"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-colors\">\r\n                    <Play className=\"w-8 h-8 md:w-10 md:h-10 text-white ml-1\" fill=\"white\" />\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Controls Bar - Always capture pointer events when visible */}\r\n              <div \r\n                className={cn(\r\n                  \"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent px-4 py-3 transition-opacity duration-300\",\r\n                  showControls ? \"opacity-100\" : \"opacity-0\"\r\n                )}\r\n                style={{ \r\n                  zIndex: 30,\r\n                  pointerEvents: showControls ? 'auto' : 'none'\r\n                }}\r\n                onClick={(e) => e.stopPropagation()}\r\n                onTouchStart={(e) => e.stopPropagation()}\r\n                onTouchMove={(e) => e.stopPropagation()}\r\n              >\r\n                {/* Progress Bar - Larger touch target */}\r\n                <div \r\n                  ref={progressRef}\r\n                  className=\"w-full py-2 cursor-pointer mb-2 group\"\r\n                  style={{ touchAction: 'none' }}\r\n                  onClick={(e) => {\r\n                    e.stopPropagation();\r\n                    handleProgressClick(e);\r\n                  }}\r\n                  onTouchStart={(e) => {\r\n                    e.stopPropagation();\r\n                    handleProgressTouch(e);\r\n                  }}\r\n                  onTouchMove={(e) => {\r\n                    e.stopPropagation();\r\n                    handleProgressTouch(e);\r\n                  }}\r\n                  onTouchEnd={(e) => {\r\n                    e.stopPropagation();\r\n                  }}\r\n                >\r\n                  <div className=\"w-full h-2 bg-white/30 rounded-full relative\">\r\n                    <div \r\n                      className=\"h-full bg-primary rounded-full relative transition-all\"\r\n                      style={{ width: `${progress}%` }}\r\n                    >\r\n                      <div className=\"absolute right-0 top-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full shadow-md -mr-2.5\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Control Buttons */}\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div className=\"flex items-center gap-3\">\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"ghost\"\r\n                      size=\"icon\"\r\n                      className=\"h-10 w-10 text-white hover:bg-white/20 active:scale-95\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        handlePlayPause();\r\n                      }}\r\n                      onTouchEnd={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        handlePlayPause();\r\n                      }}\r\n                    >\r\n                      {isPlaying ? <Pause className=\"h-6 w-6\" /> : <Play className=\"h-6 w-6\" />}\r\n                    </Button>\r\n\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"ghost\"\r\n                      size=\"icon\"\r\n                      className=\"h-10 w-10 text-white hover:bg-white/20 active:scale-95\"\r\n                      onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        handleMuteToggle();\r\n                      }}\r\n                      onTouchEnd={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        handleMuteToggle();\r\n                      }}\r\n                    >\r\n                      {isMuted ? <VolumeX className=\"h-6 w-6\" /> : <Volume2 className=\"h-6 w-6\" />}\r\n                    </Button>\r\n\r\n                    <span className=\"text-white text-sm font-medium select-none\">\r\n                      {formatTime(currentTime)} / {formatTime(duration)}\r\n                    </span>\r\n                  </div>\r\n\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"h-10 w-10 text-white hover:bg-white/20 active:scale-95\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      handleFullscreenToggle();\r\n                    }}\r\n                    onTouchEnd={(e) => {\r\n                      e.preventDefault();\r\n                      e.stopPropagation();\r\n                      handleFullscreenToggle();\r\n                    }}\r\n                  >\r\n                    {isFullscreen ? <Minimize className=\"h-6 w-6\" /> : <Maximize className=\"h-6 w-6\" />}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </DialogPrimitive.Content>\r\n        </div>\r\n      </DialogPrimitive.Portal>\r\n    </DialogPrimitive.Root>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantVideoModal;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { FileText, Loader2, ArrowRight } from \"lucide-react\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { memo } from \"react\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\n\r\ninterface GhostRestaurantRecentPostsProps {\r\n  restaurantId: string;\r\n}\r\n\r\nconst useRestaurantPosts = (restaurantId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"restaurant-posts\", restaurantId],\r\n    queryFn: async () => {\r\n      // Get associated merchant user IDs\r\n      const { data: merchants } = await supabase\r\n        .from(\"merchant_restaurants\")\r\n        .select(\"user_id\")\r\n        .eq(\"restaurant_id\", restaurantId);\r\n\r\n      const merchantUserIds = merchants?.map(m => m.user_id) || [];\r\n      \r\n      // If no associated merchants, return empty\r\n      if (merchantUserIds.length === 0) return [];\r\n\r\n      // Get posts by associated merchants only\r\n      const { data: posts, error } = await supabase\r\n        .from(\"community_posts\")\r\n        .select(`\r\n          *,\r\n          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),\r\n          post_likes(user_id)\r\n        `)\r\n        .in(\"author_id\", merchantUserIds)\r\n        .eq(\"status\", \"approved\")\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(6);\r\n\r\n      if (error) throw error;\r\n\r\n      return (posts || []).map((post: any) => ({\r\n        ...post,\r\n        likes_count: post.likes_count || 0,\r\n        user_liked: false,\r\n      }));\r\n    },\r\n    enabled: !!restaurantId,\r\n  });\r\n};\r\n\r\nexport const GhostRestaurantRecentPosts = memo(({ restaurantId }: GhostRestaurantRecentPostsProps) => {\r\n  const { t } = useTranslation();\r\n  const { data: posts = [], isLoading } = useRestaurantPosts(restaurantId);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <section className=\"py-8 md:py-12 lg:py-16\">\r\n        <div className=\"container mx-auto max-w-6xl px-4\">\r\n          <div className=\"flex items-center justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\r\n          </div>\r\n        </div>\r\n      </section>\r\n    );\r\n  }\r\n\r\n  if (posts.length === 0) {\r\n    return (\r\n      <div className=\"mt-5 md:mt-6 space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 border border-border/30\">\r\n        <h3 className=\"text-base md:text-lg font-semibold text-foreground flex items-center gap-2\">\r\n          <FileText className=\"w-4 h-4 md:w-5 md:h-5 text-primary\" />\r\n          {t(\"restaurants.recentPosts\", \"\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground py-4 text-center\">\r\n          {t(\"restaurants.noRecentPosts\", \"\")}\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"mt-5 md:mt-6 space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 border border-border/30\">\r\n      <h3 className=\"text-base md:text-lg font-semibold text-foreground flex items-center gap-2\">\r\n        <FileText className=\"w-4 h-4 md:w-5 md:h-5 text-primary\" />\r\n        {t(\"restaurants.recentPosts\", \"\")}\r\n      </h3>\r\n\r\n      <div className=\"grid grid-cols-2 gap-2 md:gap-3\">\r\n        {posts.map((post: any) => (\r\n          <PostGridCard key={post.id} post={post} />\r\n        ))}\r\n      </div>\r\n\r\n      {posts.length >= 6 && (\r\n        <div className=\"text-center pt-1\">\r\n          <Link \r\n            to=\"/community\" \r\n            className=\"inline-flex items-center gap-1.5 text-xs text-primary hover:text-primary/80 font-medium transition-colors\"\r\n          >\r\n            {t(\"common.viewMore\", \"\")}\r\n            <ArrowRight className=\"w-3.5 h-3.5\" />\r\n          </Link>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\n\r\nGhostRestaurantRecentPosts.displayName = \"GhostRestaurantRecentPosts\";\r\n\r\nexport default GhostRestaurantRecentPosts;\r\n","import { formatTrademarkSymbols } from \"@/lib/textFormatting\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Heart, ChevronLeft, Share2, Sparkles, Quote, Ghost, Play, ChevronDown } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { OwnerBioDrawer } from \"@/components/OwnerBioDrawer\";\r\n\r\nimport { GhostRestaurantVideoModal } from \"@/components/GhostRestaurantVideoModal\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\nimport { GhostRestaurantRecentPosts } from \"@/components/GhostRestaurantRecentPosts\";\r\nimport { useEnvironment } from \"@/hooks/useEnvironment\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\n\r\ninterface GhostRestaurantHeroProps {\r\n  restaurant: any;\r\n  localizedRestaurant: any;\r\n  backUrl: string;\r\n  user: any;\r\n  isFavorite: boolean;\r\n  onToggleFavorite: () => void;\r\n  onShare: () => void;\r\n  onReport: () => void;\r\n  showEditButton?: boolean;\r\n  editButton?: React.ReactNode;\r\n  reportButton?: React.ReactNode;\r\n}\r\n\r\n// Collapsible Food Philosophy sub-component with dynamic overflow detection\r\nconst FOOD_PHILOSOPHY_MAX_HEIGHT = 240; // ~15em, same as brand story\r\n\r\nconst FoodPhilosophySection = ({ foodDescription, cleanFoodDesc }: { foodDescription: string; cleanFoodDesc: string }) => {\r\n  const { t } = useTranslation();\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isOverflowing, setIsOverflowing] = useState(false);\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n\r\n  const checkOverflow = useCallback(() => {\r\n    if (contentRef.current) {\r\n      setIsOverflowing(contentRef.current.scrollHeight > FOOD_PHILOSOPHY_MAX_HEIGHT);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkOverflow();\r\n    window.addEventListener('resize', checkOverflow);\r\n    return () => window.removeEventListener('resize', checkOverflow);\r\n  }, [checkOverflow, foodDescription]);\r\n\r\n  return (\r\n    <div className=\"space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30\">\r\n      <h3 className=\"text-base md:text-lg font-semibold text-foreground flex items-center gap-2\">\r\n        <Quote className=\"w-4 h-4 md:w-5 md:h-5 text-primary rotate-180\" />\r\n        {t(\"restaurants.foodPhilosophy\", \"\")}\r\n      </h3>\r\n      <div className=\"relative\">\r\n        <div \r\n          ref={contentRef}\r\n          className={`text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2 overflow-hidden transition-all duration-300`}\r\n          style={isOverflowing && !isExpanded ? { maxHeight: `${FOOD_PHILOSOPHY_MAX_HEIGHT}px` } : undefined}\r\n          dangerouslySetInnerHTML={{ __html: foodDescription }}\r\n        />\r\n        {isOverflowing && !isExpanded && (\r\n          <div className=\"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-muted/50 to-transparent\" />\r\n        )}\r\n      </div>\r\n      {isOverflowing && (\r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium\"\r\n        >\r\n          {isExpanded ? t(\"common.collapse\", \"\") : t(\"common.expand\", \"\")}\r\n          <ChevronDown className={`w-3.5 h-3.5 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport const GhostRestaurantHero = ({\r\n  restaurant,\r\n  localizedRestaurant,\r\n  backUrl,\r\n  user,\r\n  isFavorite,\r\n  onToggleFavorite,\r\n  onShare,\r\n  showEditButton,\r\n  editButton,\r\n  reportButton,\r\n}: GhostRestaurantHeroProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const { isWebView, isIOSWebView } = useEnvironment();\r\n  \r\n  const [videoModalOpen, setVideoModalOpen] = useState(false);\r\n  const [avatarPreviewOpen, setAvatarPreviewOpen] = useState(false);\r\n  const [videoReady, setVideoReady] = useState(false);\r\n  const [videoError, setVideoError] = useState(false);\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  \r\n  const ownerBio = getLocalizedField(restaurant, \"owner_bio\") || restaurant.owner_bio;\r\n  const foodDescription = localizedRestaurant.description;\r\n  const avatarFallback = localizedRestaurant.name?.charAt(0)?.toUpperCase() || \"\";\r\n\r\n  // Check if banner should be video\r\n  const isVideoBanner = restaurant.banner_media_type === 'video' && restaurant.promo_video_url;\r\n  const bannerImage = restaurant.banner_url || restaurant.image_url || \"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80\";\r\n  const videoPoster = restaurant.promo_video_poster || bannerImage;\r\n\r\n  // Track if autoplay failed (for WebView fallback)\r\n  const [autoplayFailed, setAutoplayFailed] = useState(false);\r\n  const maxAutoplayAttempts = 3;\r\n\r\n  // Strip HTML and truncate for preview\r\n  const stripHtml = (html: string) => html?.replace(/<[^>]*>/g, '') || '';\r\n  \r\n  // Truncate bio for preview\r\n  const truncatedBio = ownerBio && ownerBio.length > 100 \r\n    ? ownerBio.substring(0, 100) + \"...\" \r\n    : ownerBio;\r\n  const shouldShowViewMore = ownerBio && ownerBio.length > 100;\r\n\r\n  // Clean food description\r\n  const cleanFoodDesc = stripHtml(foodDescription);\r\n  const truncatedFoodDesc = cleanFoodDesc && cleanFoodDesc.length > 120 \r\n    ? cleanFoodDesc.substring(0, 120) + \"...\" \r\n    : cleanFoodDesc;\r\n\r\n  // Intersection Observer to pause video when out of view\r\n  const videoContainerRef = useRef<HTMLDivElement>(null);\r\n  \r\n  const handleVisibilityChange = useCallback((isVisible: boolean) => {\r\n    if (!videoRef.current || !isVideoBanner || autoplayFailed) return;\r\n    \r\n    if (isVisible) {\r\n      videoRef.current.play().catch(() => {});\r\n    } else {\r\n      videoRef.current.pause();\r\n    }\r\n  }, [isVideoBanner, autoplayFailed]);\r\n\r\n  // Aggressive autoplay attempt function for WebView compatibility\r\n  const attemptAutoplay = useCallback(async (video: HTMLVideoElement): Promise<boolean> => {\r\n    try {\r\n      // Ensure video is muted (required for autoplay)\r\n      video.muted = true;\r\n      video.volume = 0;\r\n      \r\n      // Try to play\r\n      await video.play();\r\n      return true;\r\n    } catch (err) {\r\n      console.warn('Video autoplay attempt failed:', err);\r\n      return false;\r\n    }\r\n  }, []);\r\n\r\n  // Handle video auto-play for iOS Safari and WebView compatibility\r\n  useEffect(() => {\r\n    if (!isVideoBanner || !videoRef.current) return;\r\n    \r\n    const video = videoRef.current;\r\n    let attempts = 0;\r\n    let timeoutId: ReturnType<typeof setTimeout>;\r\n    let isMounted = true;\r\n    \r\n    const tryAutoplay = async () => {\r\n      if (!isMounted || attempts >= maxAutoplayAttempts) {\r\n        if (isMounted && attempts >= maxAutoplayAttempts) {\r\n          setAutoplayFailed(true);\r\n          setVideoReady(true);\r\n        }\r\n        return;\r\n      }\r\n      \r\n      attempts++;\r\n      const success = await attemptAutoplay(video);\r\n      \r\n      if (success && isMounted) {\r\n        setVideoReady(true);\r\n        setAutoplayFailed(false);\r\n      } else if (isMounted && attempts < maxAutoplayAttempts) {\r\n        // Retry after delay\r\n        timeoutId = setTimeout(tryAutoplay, 500);\r\n      } else if (isMounted) {\r\n        setAutoplayFailed(true);\r\n        setVideoReady(true);\r\n      }\r\n    };\r\n\r\n    const handleLoadedData = () => {\r\n      tryAutoplay();\r\n    };\r\n\r\n    const handleError = () => {\r\n      if (isMounted) setVideoError(true);\r\n    };\r\n\r\n    // Start attempts based on current state\r\n    if (video.readyState >= 2) {\r\n      // HAVE_CURRENT_DATA or higher\r\n      tryAutoplay();\r\n    } else {\r\n      video.addEventListener('loadeddata', handleLoadedData);\r\n    }\r\n    \r\n    video.addEventListener('error', handleError);\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      clearTimeout(timeoutId);\r\n      video.removeEventListener('loadeddata', handleLoadedData);\r\n      video.removeEventListener('error', handleError);\r\n    };\r\n  }, [isVideoBanner, attemptAutoplay]);\r\n\r\n  // Intersection Observer for pause on scroll\r\n  useEffect(() => {\r\n    if (!isVideoBanner || autoplayFailed || !videoContainerRef.current) return;\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          handleVisibilityChange(entry.isIntersecting);\r\n        });\r\n      },\r\n      { threshold: 0.1 } // Pause when less than 10% visible\r\n    );\r\n\r\n    observer.observe(videoContainerRef.current);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [isVideoBanner, autoplayFailed, handleVisibilityChange]);\r\n\r\n  const handleBannerClick = () => {\r\n    if (isVideoBanner && restaurant.promo_video_url) {\r\n      // If autoplay failed, try to play inline first on user interaction\r\n      if (autoplayFailed && videoRef.current) {\r\n        const video = videoRef.current;\r\n        video.muted = true;\r\n        video.play().then(() => {\r\n          setAutoplayFailed(false);\r\n          setVideoReady(true);\r\n        }).catch(() => {\r\n          // If still can't play, open modal\r\n          setVideoModalOpen(true);\r\n        });\r\n      } else {\r\n        setVideoModalOpen(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"relative\">\r\n      {/* Full-width Hero - Background Banner (Video or Image) */}\r\n      <div \r\n        ref={videoContainerRef}\r\n        className=\"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted cursor-pointer group\"\r\n        onClick={handleBannerClick}\r\n      >\r\n        {/* Video Banner - try autoplay, fallback to static if it fails */}\r\n        {isVideoBanner && !videoError ? (\r\n          <>\r\n            {/* Poster image as loading fallback or when autoplay fails */}\r\n            <img\r\n              src={videoPoster}\r\n              alt={localizedRestaurant.name}\r\n              className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${videoReady && !autoplayFailed ? 'opacity-0' : 'opacity-100'}`}\r\n              loading=\"eager\"\r\n            />\r\n            {/* Video element - always present but hidden when autoplay failed */}\r\n            <video\r\n              ref={videoRef}\r\n              src={restaurant.promo_video_url}\r\n              poster={videoPoster}\r\n              className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${videoReady && !autoplayFailed ? 'opacity-100' : 'opacity-0'}`}\r\n              autoPlay\r\n              muted\r\n              loop\r\n              playsInline\r\n              // @ts-ignore - webkit-playsinline for iOS\r\n              webkit-playsinline=\"true\"\r\n              // @ts-ignore - x5-playsinline for WeChat/QQ WebView\r\n              x5-playsinline=\"true\"\r\n              // @ts-ignore - x5-video-player-type for inline play in WeChat\r\n              x5-video-player-type=\"h5\"\r\n            />\r\n          </>\r\n        ) : (\r\n          /* Static Image Banner (fallback or image mode) */\r\n          <img\r\n            src={bannerImage}\r\n            alt={localizedRestaurant.name}\r\n            className=\"w-full h-full object-cover\"\r\n            loading=\"eager\"\r\n          />\r\n        )}\r\n\r\n        {/* Gradient Overlay */}\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent\" />\r\n\r\n        {/* Video Play Button Overlay - always visible when autoplay failed */}\r\n        {isVideoBanner && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n            <div className={`w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 transition-opacity duration-300 pointer-events-auto cursor-pointer ${autoplayFailed ? 'opacity-100' : 'opacity-0 group-hover:opacity-100'}`}>\r\n              <Play className=\"w-8 h-8 md:w-10 md:h-10 text-white ml-1\" fill=\"white\" />\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        \r\n        {/* Navigation buttons - absolute positioned, above video */}\r\n        <div \r\n          className=\"absolute top-0 left-0 right-0 flex justify-between items-center z-40 p-3 md:p-4\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          <Button asChild variant=\"secondary\" size=\"icon\" className=\"h-9 w-9 md:h-10 md:w-10 shadow-lg\">\r\n            <Link to={backUrl}>\r\n              <ChevronLeft className=\"w-4 h-4 md:w-5 md:h-5\" />\r\n            </Link>\r\n          </Button>\r\n          \r\n          <div className=\"flex items-center gap-1.5 md:gap-2\">\r\n            {reportButton}\r\n            {editButton}\r\n            <Button\r\n              variant=\"secondary\"\r\n              size=\"icon\"\r\n              className=\"h-9 w-9 md:h-10 md:w-10 shadow-lg\"\r\n              onClick={(e) => {\r\n                e.stopPropagation();\r\n                onShare();\r\n              }}\r\n            >\r\n              <Share2 className=\"w-4 h-4 md:w-5 md:h-5\" />\r\n            </Button>\r\n            {user && (\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className=\"h-9 w-9 md:h-10 md:w-10 shadow-lg\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onToggleFavorite();\r\n                }}\r\n              >\r\n                <Heart className={`w-4 h-4 md:w-5 md:h-5 ${isFavorite ? 'fill-destructive text-destructive' : ''}`} />\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content Section - Overlapping the hero image */}\r\n      <div className=\"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8\">\r\n        {/* Watch Full Video Button - Positioned above the card header */}\r\n        {isVideoBanner && (\r\n          <div className=\"flex justify-center mb-3\">\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"sm\"\r\n            className=\"gap-2 bg-primary/5 hover:bg-primary/10 text-primary/70 border border-primary/10 backdrop-blur-md\"\r\n              onClick={() => {\r\n                // Pause the banner video when opening modal\r\n                if (videoRef.current) {\r\n                  videoRef.current.pause();\r\n                }\r\n                setVideoModalOpen(true);\r\n              }}\r\n            >\r\n              <Play className=\"w-4 h-4\" />\r\n              {t(\"restaurants.clickWatchFullVideo\", \"\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Unified Card Container */}\r\n        {/* Unified Card Container */}\r\n        <Card className=\"shadow-xl border-border/50\">\r\n          {/* Title Section */}\r\n          <CardHeader className=\"pb-4 md:pb-6\">\r\n            <div className=\"flex flex-wrap items-center gap-2 mb-1.5 md:mb-2\">\r\n              <Badge variant=\"secondary\" className=\"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20\">\r\n                {t(\"admin.templateGhost\", \"Virtual Kitchen\")}\r\n                <Ghost className=\"w-3 h-3\" />\r\n              </Badge>\r\n              {localizedRestaurant.type && localizedRestaurant.type.length > 0 && (\r\n                <Badge variant=\"secondary\" className=\"text-[10px] md:text-xs bg-primary/10 text-primary border-primary/20\">\r\n                  {localizedRestaurant.type.join(\"  \")}\r\n                </Badge>\r\n              )}\r\n              <p className=\"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary\">\r\n                {t(\"restaurants.exclusiveInterview\", \"\")}\r\n              </p>\r\n            </div>\r\n            <CardTitle className=\"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight\">\r\n              {formatTrademarkSymbols(localizedRestaurant.name)}\r\n            </CardTitle>\r\n          </CardHeader>\r\n\r\n          <CardContent className=\"pt-0\">\r\n            {/* Grid Layout inside the unified card */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8\">\r\n              {/* Left: Signature Dish Image + Philosophy - Takes 3 cols on md+ */}\r\n              <div className=\"md:col-span-3 space-y-5 md:space-y-6\">\r\n                {/* Signature Dish Image */}\r\n                <div className=\"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group\">\r\n                  <img\r\n                    src={restaurant.cover_image_url || restaurant.image_url || \"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80\"}\r\n                    alt={localizedRestaurant.name}\r\n                    className=\"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105\"\r\n                  />\r\n                  <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent\" />\r\n                </div>\r\n\r\n                {/* Food Philosophy */}\r\n                {(truncatedFoodDesc || foodDescription) && (\r\n                  <FoodPhilosophySection \r\n                    foodDescription={foodDescription}\r\n                    cleanFoodDesc={cleanFoodDesc}\r\n                  />\r\n                )}\r\n              </div>\r\n\r\n              {/* Right: Owner Profile Section - Takes 2 cols on md+ */}\r\n              <div className=\"md:col-span-2 space-y-5 md:space-y-6\">\r\n                <div className=\"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden\">\r\n                  {/* Owner Avatar - Centered Circle */}\r\n                  <div className=\"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent\">\r\n                    <div className=\"flex justify-center\">\r\n                      <div className=\"relative\">\r\n                        <div \r\n                          className={`w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10 ${restaurant.owner_avatar_url ? 'cursor-pointer' : ''}`}\r\n                          onClick={() => {\r\n                            if (restaurant.owner_avatar_url) setAvatarPreviewOpen(true);\r\n                          }}\r\n                        >\r\n                          {restaurant.owner_avatar_url ? (\r\n                            <img \r\n                              src={restaurant.owner_avatar_url} \r\n                              alt={localizedRestaurant.name}\r\n                              className=\"w-full h-full object-cover\"\r\n                            />\r\n                          ) : (\r\n                            <div className=\"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center\">\r\n                              <span className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70\">\r\n                                {avatarFallback}\r\n                              </span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {/* Badge */}\r\n                        <Badge className=\"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap\">\r\n                          <Sparkles className=\"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1\" />\r\n                          {t(\"restaurants.ownerStory\", \"\")}\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Owner Info */}\r\n                  <div className=\"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30\">\r\n                    <h3 className=\"text-lg md:text-xl font-bold text-foreground\">\r\n                      {formatTrademarkSymbols(getLocalizedField(restaurant, \"owner_name\") || localizedRestaurant.name)}\r\n                    </h3>\r\n                    <p className=\"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1\">\r\n                      {t(\"restaurants.chef\", \"\")}\r\n                    </p>\r\n                  </div>\r\n\r\n                  {/* Owner Story */}\r\n                  <div className=\"p-4 md:p-6 space-y-3 md:space-y-4\">\r\n                    <h4 className=\"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2\">\r\n                      <Quote className=\"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180\" />\r\n                      {t(\"restaurants.ownerWords\", \"\")}\r\n                    </h4>\r\n                    \r\n                    {ownerBio ? (\r\n                      <div className=\"space-y-2 md:space-y-3\">\r\n                        <p className=\"text-xs md:text-sm text-muted-foreground leading-relaxed\">\r\n                          {truncatedBio}\r\n                        </p>\r\n                        {shouldShowViewMore && (\r\n                          <OwnerBioDrawer\r\n                            ownerBio={ownerBio}\r\n                            ownerName={localizedRestaurant.name}\r\n                            ownerAvatarUrl={restaurant.owner_avatar_url}\r\n                            avatarFallback={avatarFallback}\r\n                          />\r\n                        )}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-xs md:text-sm text-muted-foreground/60 italic\">\r\n                        {t(\"restaurants.noBioYet\", \"\")}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Decorative bottom */}\r\n                  <div className=\"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20\" />\r\n                </div>\r\n\r\n                {/* Recent Posts Section - below owner profile card */}\r\n                <GhostRestaurantRecentPosts restaurantId={restaurant.id} />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Video Modal */}\r\n      {isVideoBanner && (\r\n        <GhostRestaurantVideoModal\r\n          open={videoModalOpen}\r\n          onOpenChange={setVideoModalOpen}\r\n          videoUrl={restaurant.promo_video_url}\r\n          posterUrl={videoPoster}\r\n          title={localizedRestaurant.name}\r\n        />\r\n      )}\r\n\r\n      {restaurant.owner_avatar_url && (\r\n        <ImagePreviewModal\r\n          imageUrl={restaurant.owner_avatar_url}\r\n          isOpen={avatarPreviewOpen}\r\n          onClose={() => setAvatarPreviewOpen(false)}\r\n          disableLongImage\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantHero;\r\n","import { formatTrademarkSymbols, formatTrademarkSymbolsInHtml } from \"@/lib/textFormatting\";\r\nimport { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Building2, ChevronDown } from \"lucide-react\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { useBrand, ContentBlock } from \"@/hooks/useBrands\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\n\r\n\r\n// Collapsible text block for long intro\r\nconst CollapsibleText = ({ text }: { text: string }) => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isOverflowing, setIsOverflowing] = useState(false);\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n  const MAX_HEIGHT = isMobile ? 120 : 240;\r\n\r\n  const checkOverflow = useCallback(() => {\r\n    if (contentRef.current) {\r\n      setIsOverflowing(contentRef.current.scrollHeight > MAX_HEIGHT);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkOverflow();\r\n    window.addEventListener('resize', checkOverflow);\r\n    return () => window.removeEventListener('resize', checkOverflow);\r\n  }, [checkOverflow, text]);\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"relative\">\r\n        <div\r\n          ref={contentRef}\r\n          className={`text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline overflow-hidden transition-all duration-300`}\r\n          style={isOverflowing && !isExpanded ? { maxHeight: `${MAX_HEIGHT}px` } : undefined}\r\n          dangerouslySetInnerHTML={{ __html: formatTrademarkSymbolsInHtml(text) }}\r\n        />\r\n        {isOverflowing && !isExpanded && (\r\n          <div className=\"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-card to-transparent\" />\r\n        )}\r\n      </div>\r\n      {isOverflowing && (\r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium mt-2\"\r\n        >\r\n          {isExpanded ? t(\"common.collapse\", \"\") : t(\"common.expand\", \"\")}\r\n          <ChevronDown className={`w-3.5 h-3.5 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Collapsible content blocks\r\nconst CollapsibleContent = ({ blocks, getLocalizedBlockContent }: { blocks: any[]; getLocalizedBlockContent: (block: any) => string }) => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [isExpanded, setIsExpanded] = useState(false);\r\n  const [isOverflowing, setIsOverflowing] = useState(false);\r\n  const contentRef = useRef<HTMLDivElement>(null);\r\n  const MAX_HEIGHT = isMobile ? 160 : 320;\r\n\r\n  const checkOverflow = useCallback(() => {\r\n    if (contentRef.current) {\r\n      setIsOverflowing(contentRef.current.scrollHeight > MAX_HEIGHT);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    checkOverflow();\r\n    window.addEventListener('resize', checkOverflow);\r\n    return () => window.removeEventListener('resize', checkOverflow);\r\n  }, [checkOverflow, blocks]);\r\n\r\n  return (\r\n    <div>\r\n      <div\r\n        ref={contentRef}\r\n        className={`relative space-y-4 overflow-hidden transition-all duration-300`}\r\n        style={isOverflowing && !isExpanded ? { maxHeight: `${MAX_HEIGHT}px` } : undefined}\r\n      >\r\n        {blocks.map((block: any, index: number) => {\r\n          const content = getLocalizedBlockContent(block);\r\n          const isFirstImage = block.type === \"image\" && index === 0;\r\n          const isLastImage = block.type === \"image\" && index === blocks.length - 1;\r\n\r\n          return (\r\n            <div key={block.id}>\r\n              {block.type === \"text\" && content && (\r\n                <div\r\n                  className=\"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline\"\r\n                  dangerouslySetInnerHTML={{ __html: formatTrademarkSymbolsInHtml(content) }}\r\n                />\r\n              )}\r\n              {block.type === \"image\" && block.url && (\r\n                <div className=\"flex justify-start\">\r\n                  <img\r\n                    src={block.url}\r\n                    alt={block.alt || \"\"}\r\n                    className={\r\n                      isFirstImage\r\n                        ? \"w-16 h-16 object-contain rounded-lg\"\r\n                        : isLastImage\r\n                          ? \"h-12 w-auto object-contain opacity-80\"\r\n                          : \"max-w-[120px] max-h-24 object-contain rounded-lg\"\r\n                    }\r\n                  />\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n        {isOverflowing && !isExpanded && (\r\n          <div className=\"absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t from-card to-transparent\" />\r\n        )}\r\n      </div>\r\n      {isOverflowing && (\r\n        <button\r\n          onClick={() => setIsExpanded(!isExpanded)}\r\n          className=\"flex items-center gap-1 text-xs text-primary hover:text-primary/80 transition-colors font-medium mt-2\"\r\n        >\r\n          {isExpanded ? t(\"common.collapse\", \"\") : t(\"common.expand\", \"\")}\r\n          <ChevronDown className={`w-3.5 h-3.5 transition-transform ${isExpanded ? 'rotate-180' : ''}`} />\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\ninterface GhostRestaurantBrandStoryProps {\r\n  brandId: string;\r\n}\r\n\r\nexport const GhostRestaurantBrandStory = ({ brandId }: GhostRestaurantBrandStoryProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { data: brand, isLoading } = useBrand(brandId);\r\n\r\n  if (isLoading || !brand) return null;\r\n\r\n  const getLocalizedBlockContent = (block: ContentBlock) => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return block.content_zh;\r\n      case \"pt\":\r\n        return block.content_pt;\r\n      default:\r\n        return block.content_en || block.content_zh;\r\n    }\r\n  };\r\n\r\n  const getLocalizedBrandName = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return brand.name;\r\n      case \"pt\":\r\n        return brand.name_pt || brand.name;\r\n      default:\r\n        return brand.name_en || brand.name;\r\n    }\r\n  };\r\n\r\n  const hasContentBlocks = brand.content_blocks && brand.content_blocks.length > 0;\r\n  const hasLogo = !!brand.logo_url;\r\n\r\n  // Get intro text\r\n  const getLocalizedIntro = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return brand.intro_zh;\r\n      case \"pt\":\r\n        return brand.intro_pt;\r\n      default:\r\n        return brand.intro_en || brand.intro_zh;\r\n    }\r\n  };\r\n\r\n  const intro = getLocalizedIntro();\r\n\r\n  // If nothing to show, don't render\r\n  if (!hasLogo && !hasContentBlocks && !intro) return null;\r\n\r\n\r\n  return (\r\n    <section className=\"py-8 md:py-12 lg:py-16 bg-muted/30\">\r\n      <div className=\"container mx-auto max-w-4xl px-4\">\r\n        {/* Section header */}\r\n        <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n          <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n            {t(\"brand.story\", \"\")}\r\n          </p>\r\n          <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground inline-flex items-center justify-center gap-2 md:gap-3\">\r\n            <Building2 className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary flex-shrink-0\" />\r\n            <span>{formatTrademarkSymbols(getLocalizedBrandName())}</span>\r\n          </h2>\r\n          <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n        </div>\r\n\r\n        <Card className=\"border-0 shadow-lg md:shadow-xl overflow-hidden\">\r\n          <CardContent className=\"p-4 md:p-6 lg:p-8\">\r\n            <div className=\"flex flex-col md:flex-row gap-6 md:gap-8\">\r\n              {/* Left: Brand Logo & Images */}\r\n              {hasLogo && (\r\n                <div className=\"flex-shrink-0 flex flex-col items-center md:items-start gap-4\">\r\n                  <img\r\n                    src={brand.logo_url!}\r\n                    alt={getLocalizedBrandName()}\r\n                    className=\"w-52 h-52 md:w-60 md:h-60 object-contain rounded-xl\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Right: Text Content */}\r\n              <div className=\"flex-1 min-w-0\">\r\n                {/* Content Blocks with collapsible */}\r\n                {hasContentBlocks && (\r\n                  <CollapsibleContent\r\n                    blocks={brand.content_blocks!}\r\n                    getLocalizedBlockContent={getLocalizedBlockContent}\r\n                  />\r\n                )}\r\n\r\n                {/* Fallback to intro if no content blocks */}\r\n                {intro && !hasContentBlocks && (\r\n                  <CollapsibleText text={intro} />\r\n                )}\r\n\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    </section>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantBrandStory;\r\n","import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\";\r\n\r\nconst AspectRatio = AspectRatioPrimitive.Root;\r\n\r\nexport { AspectRatio };\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Play, Film } from \"lucide-react\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { AspectRatio } from \"@/components/ui/aspect-ratio\";\r\nimport { GhostRestaurantVideoModal } from \"@/components/GhostRestaurantVideoModal\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  CarouselNext,\r\n  CarouselPrevious,\r\n} from \"@/components/ui/carousel\";\r\n\r\ninterface VideoItem {\r\n  url: string;\r\n  title_zh?: string;\r\n  title_en?: string;\r\n  title_pt?: string;\r\n  poster_url?: string;\r\n  duration?: number;\r\n}\r\n\r\ninterface GhostRestaurantVideosProps {\r\n  videos: VideoItem[];\r\n}\r\n\r\nconst formatDuration = (seconds?: number): string => {\r\n  if (!seconds) return \"\";\r\n  const mins = Math.floor(seconds / 60);\r\n  const secs = Math.floor(seconds % 60);\r\n  return `${mins}:${secs.toString().padStart(2, '0')}`;\r\n};\r\n\r\nconst VideoCard = ({ \r\n  video, \r\n  onClick,\r\n  language \r\n}: { \r\n  video: VideoItem; \r\n  onClick: () => void;\r\n  language: string;\r\n}) => {\r\n  const getLocalizedTitle = () => {\r\n    switch (language) {\r\n      case 'en':\r\n        return video.title_en || video.title_zh || '';\r\n      case 'pt':\r\n        return video.title_pt || video.title_en || video.title_zh || '';\r\n      default:\r\n        return video.title_zh || video.title_en || '';\r\n    }\r\n  };\r\n\r\n  const title = getLocalizedTitle();\r\n\r\n  return (\r\n    <Card \r\n      className=\"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/30 transition-all hover:shadow-lg\"\r\n      onClick={onClick}\r\n    >\r\n      <div className=\"relative\">\r\n        <AspectRatio ratio={16/9}>\r\n          {video.poster_url ? (\r\n            // \r\n            <img \r\n              src={video.poster_url} \r\n              alt={title}\r\n              className=\"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105\"\r\n              loading=\"lazy\"\r\n            />\r\n          ) : (\r\n            // \r\n            <div className=\"w-full h-full bg-gradient-to-br from-primary/20 via-primary/10 to-muted flex items-center justify-center\">\r\n              <div className=\"w-16 h-16 rounded-full bg-primary/20 backdrop-blur-sm flex items-center justify-center border border-primary/30\">\r\n                <Play className=\"w-8 h-8 text-primary ml-1\" fill=\"currentColor\" />\r\n              </div>\r\n              <Film className=\"absolute bottom-3 left-3 w-5 h-5 text-primary/40\" />\r\n            </div>\r\n          )}\r\n        </AspectRatio>\r\n\r\n        {/*  */}\r\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity\">\r\n          <div className=\"w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 md:bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 md:group-hover:scale-110 transition-transform\">\r\n            <Play className=\"w-6 h-6 md:w-7 md:h-7 text-white ml-0.5\" fill=\"white\" />\r\n          </div>\r\n        </div>\r\n\r\n        {/*  */}\r\n        {video.duration && (\r\n          <Badge \r\n            variant=\"secondary\" \r\n            className=\"absolute bottom-2 right-2 bg-black/70 text-white text-xs border-0\"\r\n          >\r\n            {formatDuration(video.duration)}\r\n          </Badge>\r\n        )}\r\n      </div>\r\n\r\n      {/*  */}\r\n      {title && (\r\n        <div className=\"p-3\">\r\n          <p className=\"text-sm font-medium text-foreground line-clamp-2\">{title}</p>\r\n        </div>\r\n      )}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport const GhostRestaurantVideos = ({ videos }: GhostRestaurantVideosProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [selectedVideo, setSelectedVideo] = useState<VideoItem | null>(null);\r\n\r\n  if (!videos || videos.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  const getLocalizedVideoTitle = (video: VideoItem) => {\r\n    switch (i18n.language) {\r\n      case 'en':\r\n        return video.title_en || video.title_zh || '';\r\n      case 'pt':\r\n        return video.title_pt || video.title_en || video.title_zh || '';\r\n      default:\r\n        return video.title_zh || video.title_en || '';\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <section className=\"py-8 md:py-12 lg:py-16 bg-muted/30\">\r\n        <div className=\"container mx-auto max-w-6xl px-4\">\r\n          {/* Section Header */}\r\n          <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n            <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n              BEHIND THE KITCHEN\r\n            </p>\r\n            <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n              <Play className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n              {t(\"restaurants.videoSection\", \"\")}\r\n            </h2>\r\n            <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n          </div>\r\n\r\n          {/* Video Grid/Carousel */}\r\n          {isMobile ? (\r\n            <Carousel\r\n              opts={{\r\n                align: \"start\",\r\n                loop: videos.length > 2,\r\n              }}\r\n              className=\"w-full\"\r\n            >\r\n              <CarouselContent className=\"-ml-2\">\r\n                {videos.map((video, index) => (\r\n                  <CarouselItem key={index} className=\"pl-2 basis-4/5 sm:basis-1/2\">\r\n                    <VideoCard \r\n                      video={video} \r\n                      onClick={() => setSelectedVideo(video)}\r\n                      language={i18n.language}\r\n                    />\r\n                  </CarouselItem>\r\n                ))}\r\n              </CarouselContent>\r\n              {videos.length > 2 && (\r\n                <>\r\n                  <CarouselPrevious className=\"hidden sm:flex -left-4\" />\r\n                  <CarouselNext className=\"hidden sm:flex -right-4\" />\r\n                </>\r\n              )}\r\n            </Carousel>\r\n          ) : (\r\n            <div className=\"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\r\n              {videos.map((video, index) => (\r\n                <VideoCard \r\n                  key={index}\r\n                  video={video} \r\n                  onClick={() => setSelectedVideo(video)}\r\n                  language={i18n.language}\r\n                />\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      {/* Video Player Modal */}\r\n      <GhostRestaurantVideoModal\r\n        open={!!selectedVideo}\r\n        onOpenChange={(open) => !open && setSelectedVideo(null)}\r\n        videoUrl={selectedVideo?.url || ''}\r\n        posterUrl={selectedVideo?.poster_url}\r\n        title={selectedVideo ? getLocalizedVideoTitle(selectedVideo) : undefined}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantVideos;","import { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { MapPin, Phone, MessageCircle, Star, ChevronDown, ShoppingBag, Loader2, Camera, Ghost, Navigation } from \"lucide-react\";\r\nimport { GhostRestaurantBrandStory } from \"@/components/GhostRestaurantBrandStory\";\r\n\r\n\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RestaurantDishGallery } from \"@/components/RestaurantDishGallery\";\r\nimport { useDishImages } from \"@/hooks/useDishImages\";\r\nimport RestaurantRating from \"@/components/RestaurantRating\";\r\nimport { GhostRestaurantVideos } from \"@/components/GhostRestaurantVideos\";\r\nimport { lazy, Suspense, useRef } from \"react\";\r\nimport { getLocalizedBadgeText, getLocalizedActivityTitle, getLocalizedIntro } from \"@/hooks/useRestaurantActivities\";\r\n\r\nconst RestaurantComments = lazy(() => import(\"@/components/RestaurantComments\"));\r\n\r\ninterface GhostRestaurantStoryProps {\r\n  restaurant: any;\r\n  localizedRestaurant: any;\r\n  restaurantActivities: any[];\r\n  ratingCount: number;\r\n  averageRating: number;\r\n  onTakeawayClick: () => void;\r\n  onNavigationClick?: () => void;\r\n  brandId?: string | null;\r\n}\r\n\r\nexport const GhostRestaurantStory = ({\r\n  restaurant,\r\n  localizedRestaurant,\r\n  restaurantActivities,\r\n  ratingCount,\r\n  averageRating,\r\n  onTakeawayClick,\r\n  onNavigationClick,\r\n  brandId,\r\n}: GhostRestaurantStoryProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  // activitiesOpen state removed - activities now shown as standalone section\r\n  const { data: dishImages = [] } = useDishImages(restaurant.id);\r\n  const hasDishImages = dishImages.length > 0 && (restaurant as any).show_dish_gallery !== false;\r\n  \r\n  const commentsSectionRef = useRef<HTMLDivElement>(null);\r\n\r\n  return (\r\n    <div className=\"relative bg-background\">\r\n      {/* Takeaway CTA Section */}\r\n      {restaurant.website_url && (restaurant as any).show_takeaway_button && (\r\n        <section className=\"py-6 md:py-8 bg-gradient-to-b from-muted/50 to-background\">\r\n          <div className=\"container mx-auto max-w-2xl px-4\">\r\n            <div className=\"text-center mb-4 md:mb-5\">\r\n              <p className=\"text-xs md:text-sm text-muted-foreground mb-1\">\r\n                {t(\"restaurants.readyToOrder\")}\r\n              </p>\r\n              <p className=\"text-sm md:text-base font-medium text-foreground\">\r\n                {t(\"restaurants.orderNowHint\")}\r\n              </p>\r\n            </div>\r\n            <div className=\"max-w-md mx-auto\">\r\n              <Button \r\n                className=\"w-full h-11 md:h-12 text-sm md:text-base shadow-md hover:shadow-lg transition-shadow\"\r\n                size=\"lg\"\r\n                onClick={onTakeawayClick}\r\n              >\r\n                <ShoppingBag className=\"w-4 h-4 md:w-5 md:h-5 mr-2\" />\r\n                {t(\"restaurant.takeawayOrder\")}\r\n              </Button>\r\n            </div>\r\n            <div className=\"flex items-center justify-center gap-3 mt-4 md:mt-5\">\r\n              <div className=\"h-px w-12 md:w-16 bg-border\" />\r\n              <span className=\"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider\">\r\n                {t(\"restaurants.orBrowse\")}\r\n              </span>\r\n              <div className=\"h-px w-12 md:w-16 bg-border\" />\r\n            </div>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Photo Gallery Section - only show if there are images */}\r\n      {hasDishImages && (\r\n        <section className=\"py-8 md:py-12 lg:py-16\">\r\n          <div className=\"container mx-auto max-w-6xl px-4\">\r\n\r\n            <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n              <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n                {t(\"restaurants.gallery\", \"\")}\r\n              </p>\r\n              <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n                <Camera className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n                {t(\"restaurants.photoWall\", \"\")}\r\n              </h2>\r\n              <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n            </div>\r\n            \r\n            <RestaurantDishGallery restaurantId={restaurant.id} showGallery={(restaurant as any).show_dish_gallery !== false} />\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Video Gallery Section - Behind The Kitchen */}\r\n      {restaurant.videos && Array.isArray(restaurant.videos) && restaurant.videos.length > 0 && (\r\n        <GhostRestaurantVideos videos={restaurant.videos} />\r\n      )}\r\n\r\n      {/* Brand Story Section */}\r\n      {brandId && (\r\n        <GhostRestaurantBrandStory brandId={brandId} />\r\n      )}\r\n\r\n      {/* Activities Section - Standalone above restaurant info */}\r\n      {restaurantActivities.length > 0 && (\r\n        <section className=\"py-8 md:py-12 lg:py-16\">\r\n          <div className=\"container mx-auto max-w-4xl px-4\">\r\n            <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n              <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n                {t(\"restaurants.participating\", \"\")}\r\n              </p>\r\n              <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n                <Star className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n                {t(\"activities.title\")}\r\n              </h2>\r\n              <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n            </div>\r\n\r\n            <div className=\"grid gap-3 md:gap-4\">\r\n              {restaurantActivities.map((activity, idx) => {\r\n                const intro = getLocalizedIntro(activity, i18n.language);\r\n                return (\r\n                  <Link\r\n                    key={`activity-card-${idx}`}\r\n                    to={`/activity/${activity.activity_id}`}\r\n                    className=\"block\"\r\n                  >\r\n                    <Card className=\"border-0 shadow-md hover:shadow-lg transition-shadow overflow-hidden\">\r\n                      <CardContent className=\"p-4 md:p-5 flex items-center gap-3 md:gap-4\">\r\n                        <Badge \r\n                          variant=\"default\" \r\n                          className=\"text-white text-xs md:text-sm shrink-0\"\r\n                          style={{ backgroundColor: activity.badge_color || \"hsl(var(--primary))\" }}\r\n                        >\r\n                          {getLocalizedBadgeText(activity, i18n.language)}\r\n                        </Badge>\r\n                        <div className=\"min-w-0 flex-1\">\r\n                          <p className=\"font-semibold text-sm md:text-base text-card-foreground truncate\">\r\n                            {getLocalizedActivityTitle(activity, i18n.language)}\r\n                          </p>\r\n                          {intro && (\r\n                            <p className=\"text-xs md:text-sm text-muted-foreground line-clamp-1 mt-0.5\">\r\n                              {intro}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                        <ChevronDown className=\"w-4 h-4 text-muted-foreground -rotate-90 shrink-0\" />\r\n                      </CardContent>\r\n                    </Card>\r\n                  </Link>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Info Section - Contact & Details */}\r\n      <section className=\"py-8 md:py-12 lg:py-16 bg-muted/30\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n            <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n              {t(\"restaurants.info\", \"\")}\r\n            </p>\r\n            <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n              <MapPin className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n              {t(\"restaurants.contactInfo\", \"\")}\r\n            </h2>\r\n            <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n          </div>\r\n\r\n          <Card className=\"border-0 shadow-lg md:shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6\">\r\n              {/* Type tags and rating */}\r\n              <div className=\"flex flex-wrap items-center gap-2 md:gap-3\">\r\n                <Badge variant=\"secondary\" className=\"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20\">\r\n                  {t(\"admin.templateGhost\", \"Virtual Kitchen\")}\r\n                  <Ghost className=\"w-3 h-3\" />\r\n                </Badge>\r\n                {localizedRestaurant.type.slice(0, 3).map((type: string, idx: number) => (\r\n                  <Badge key={idx} variant=\"secondary\" className=\"text-xs md:text-sm\">{type}</Badge>\r\n                ))}\r\n                {ratingCount > 0 && (\r\n                  <div className=\"flex items-center gap-1 ml-auto\">\r\n                    <Star className=\"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent\" />\r\n                    <span className=\"font-bold text-base md:text-lg\">\r\n                      {averageRating.toFixed(1)}\r\n                      <span className=\"text-muted-foreground font-normal text-xs md:text-sm ml-1\">({ratingCount})</span>\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              {/* Contact Info Grid */}\r\n              <div className=\"grid gap-3 md:gap-4\">\r\n                {/* Kitchen Address */}\r\n                <div className=\"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors\">\r\n                  <MapPin className=\"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"min-w-0 flex-1\">\r\n                    <p className=\"font-semibold text-sm md:text-base text-card-foreground\">{t(\"restaurants.kitchenAddress\")}</p>\r\n                    <p className=\"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words\">{restaurant.address}</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Navigation Button */}\r\n                {onNavigationClick && (\r\n                  <Button \r\n                    variant=\"secondary\"\r\n                    className=\"w-full\"\r\n                    onClick={onNavigationClick}\r\n                  >\r\n                    <Navigation className=\"w-4 h-4 mr-2\" />\r\n                    {t(\"restaurant.getDirections\")}\r\n                  </Button>\r\n                )}\r\n\r\n                {/* Phone */}\r\n                {restaurant.phone && (\r\n                  <a \r\n                    href={`tel:${restaurant.phone}`}\r\n                    className=\"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group\"\r\n                  >\r\n                    <Phone className=\"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                    <div>\r\n                      <p className=\"font-semibold text-sm md:text-base text-card-foreground\">{t(\"restaurant.phone\")}</p>\r\n                      <p className=\"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1\">{restaurant.phone}</p>\r\n                    </div>\r\n                  </a>\r\n                )}\r\n\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Rating Section */}\r\n      <section className=\"py-8 md:py-12 lg:py-16\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n            <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n              {t(\"restaurants.rating\", \"\")}\r\n            </p>\r\n            <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n              <Star className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n              {t(\"restaurants.rateUs\", \"\")}\r\n            </h2>\r\n            <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n          </div>\r\n\r\n          <Card className=\"border-0 shadow-lg md:shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-4 md:p-6 lg:p-8\">\r\n              <RestaurantRating restaurantId={restaurant.id} />\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Comments Section */}\r\n      <section className=\"py-8 md:py-12 lg:py-16 bg-muted/30\">\r\n        <div className=\"container mx-auto max-w-4xl px-4\">\r\n          <div className=\"text-center mb-6 md:mb-8 lg:mb-10\">\r\n            <p className=\"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3\">\r\n              {t(\"restaurants.reviews\", \"\")}\r\n            </p>\r\n            <h2 className=\"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3\">\r\n              <MessageCircle className=\"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary\" />\r\n              {t(\"restaurants.customerReviews\", \"\")}\r\n            </h2>\r\n            <div className=\"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4\" />\r\n          </div>\r\n\r\n          <Card className=\"border-0 shadow-lg md:shadow-xl overflow-hidden\">\r\n            <CardContent className=\"p-4 md:p-6 lg:p-8\" ref={commentsSectionRef}>\r\n              <Suspense fallback={\r\n                <div className=\"flex items-center justify-center py-8 md:py-12\">\r\n                  <Loader2 className=\"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary\" />\r\n                </div>\r\n              }>\r\n                <RestaurantComments restaurantId={restaurant.id} />\r\n              </Suspense>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </section>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default GhostRestaurantStory;\r\n","import { formatTrademarkSymbolsInHtml } from \"@/lib/textFormatting\";\r\nimport { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { ChevronDown, Building2 } from \"lucide-react\";\r\nimport { useBrand, ContentBlock } from \"@/hooks/useBrands\";\r\n\r\ninterface BrandAboutSectionProps {\r\n  brandId: string;\r\n}\r\n\r\nexport function BrandAboutSection({ brandId }: BrandAboutSectionProps) {\r\n  const { t, i18n } = useTranslation();\r\n  const [isOpen, setIsOpen] = useState(false);\r\n  const { data: brand, isLoading } = useBrand(brandId);\r\n\r\n  if (isLoading || !brand) return null;\r\n\r\n  // Get localized intro based on current language\r\n  const getLocalizedIntro = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return brand.intro_zh;\r\n      case \"pt\":\r\n        return brand.intro_pt;\r\n      default:\r\n        return brand.intro_en || brand.intro_zh;\r\n    }\r\n  };\r\n\r\n  // Get localized content from content blocks\r\n  const getLocalizedBlockContent = (block: ContentBlock) => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return block.content_zh;\r\n      case \"pt\":\r\n        return block.content_pt;\r\n      default:\r\n        return block.content_en || block.content_zh;\r\n    }\r\n  };\r\n\r\n  const intro = getLocalizedIntro();\r\n  const hasContentBlocks = brand.content_blocks && brand.content_blocks.length > 0;\r\n  \r\n  // If no intro and no content blocks, don't render\r\n  if (!intro && !hasContentBlocks) return null;\r\n\r\n  return (\r\n    <Collapsible\r\n      open={isOpen}\r\n      onOpenChange={setIsOpen}\r\n      className=\"mt-4\"\r\n    >\r\n      <CollapsibleTrigger className=\"w-full\">\r\n        <div className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Building2 className=\"w-5 h-5 text-primary\" />\r\n            <span className=\"font-medium\">{t(\"brand.aboutUs\")}</span>\r\n          </div>\r\n          <ChevronDown \r\n            className={`w-5 h-5 text-muted-foreground transition-transform ${isOpen ? 'rotate-180' : ''}`} \r\n          />\r\n        </div>\r\n      </CollapsibleTrigger>\r\n      \r\n      <CollapsibleContent>\r\n        <div className=\"p-4 mt-2 rounded-lg bg-muted/30\">\r\n          {/* Content Blocks - optimized layout */}\r\n          <div className=\"space-y-4\">\r\n            {hasContentBlocks && brand.content_blocks!.map((block, index) => {\r\n              const content = getLocalizedBlockContent(block);\r\n              const isFirstImage = block.type === \"image\" && index === 0;\r\n              const isLastImage = block.type === \"image\" && index === brand.content_blocks!.length - 1;\r\n              \r\n              return (\r\n                <div key={block.id}>\r\n                  {block.type === \"text\" && content && (\r\n                    <div \r\n                      className=\"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline\"\r\n                      dangerouslySetInnerHTML={{ __html: formatTrademarkSymbolsInHtml(content) }}\r\n                    />\r\n                  )}\r\n                  {block.type === \"image\" && block.url && (\r\n                    <div className=\"flex justify-start\">\r\n                      <img \r\n                        src={block.url} \r\n                        alt={block.alt || \"\"}\r\n                        className={\r\n                          isFirstImage \r\n                            ? \"w-16 h-16 object-contain rounded-lg\" \r\n                            : isLastImage \r\n                              ? \"h-12 w-auto object-contain opacity-80\" \r\n                              : \"max-w-[120px] max-h-24 object-contain rounded-lg\"\r\n                        }\r\n                      />\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n\r\n          {/* Brand Intro - if no content blocks */}\r\n          {intro && !hasContentBlocks && (\r\n            <div \r\n              className=\"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline\"\r\n              dangerouslySetInnerHTML={{ __html: formatTrademarkSymbolsInHtml(intro) }}\r\n            />\r\n          )}\r\n        </div>\r\n      </CollapsibleContent>\r\n    </Collapsible>\r\n  );\r\n}\r\n","import { formatTrademarkSymbols } from \"@/lib/textFormatting\";\r\nimport { useParams, Link, useLocation, useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuSeparator,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport {\r\n  Collapsible,\r\n  CollapsibleContent,\r\n  CollapsibleTrigger,\r\n} from \"@/components/ui/collapsible\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { toast } from \"sonner\";\r\nimport { Star, MapPin, Phone, Clock, Heart, Navigation, ChevronLeft, Loader2, MessageCircle, Wallet, Edit, ShieldAlert, Share2, Link2, ChevronDown, ShoppingBag, CalendarDays, ExternalLink, UtensilsCrossed } from \"lucide-react\";\r\nimport { useRestaurant, useToggleFavorite, useFavorites } from \"@/hooks/useRestaurants\";\r\nimport { useComments } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { formatAllOpeningHours, formatOpeningHours } from \"@/lib/timeUtils\";\r\nimport { openNavigation, calculateDistance, getUserLocation } from \"@/lib/geolocation\";\r\nimport { isIOSWebView, isIOSDevice, openExternalUrl } from \"@/lib/externalLinks\";\r\n// NavigationConfirmDialog removed - using inline glass-style AlertDialog instead\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport RestaurantRating from \"@/components/RestaurantRating\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport { useEffect, useRef, useState, useMemo, useCallback, lazy, Suspense } from \"react\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\nimport { useSmartShare, ShareDrawer } from \"@/components/ShareDrawer\";\r\n\r\n// Lazy load heavy components\r\nconst RestaurantComments = lazy(() => import(\"@/components/RestaurantComments\"));\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useMerchantRestaurants } from \"@/hooks/useActivityParticipation\";\r\nimport { RestaurantFormDialog } from \"@/components/admin/RestaurantFormDialog\";\r\nimport { useRestaurantActivities, getLocalizedBadgeText, getLocalizedActivityTitle, getLocalizedIntro } from \"@/hooks/useRestaurantActivities\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { RestaurantDishGallery } from \"@/components/RestaurantDishGallery\";\r\nimport { RestaurantDetailSkeleton } from \"@/components/skeletons\";\r\nimport { GhostRestaurantHero } from \"@/components/GhostRestaurantHero\";\r\nimport { GhostRestaurantStory } from \"@/components/GhostRestaurantStory\";\r\nimport { BrandAboutSection } from \"@/components/BrandAboutSection\";\r\n\r\nconst RestaurantDetail = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const location = useLocation();\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { localizeRestaurant, getLocalizedField } = useLocalizedContent();\r\n  const isMobile = useIsMobile();\r\n  const mapContainer = useRef<HTMLDivElement>(null);\r\n  const map = useRef<mapboxgl.Map | null>(null);\r\n  const [distance, setDistance] = useState<number | null>(null);\r\n  const [hoursOpen, setHoursOpen] = useState(false);\r\n  const [mapOpen, setMapOpen] = useState(true);\r\n  const [announcementOpen, setAnnouncementOpen] = useState(false);\r\n  const [activitiesOpen, setActivitiesOpen] = useState(false);\r\n  const [shouldLoadMap, setShouldLoadMap] = useState(true);\r\n  const [shouldLoadComments, setShouldLoadComments] = useState(true);\r\n  const [isGeneratingToken, setIsGeneratingToken] = useState(false);\r\n  const mapSectionRef = useRef<HTMLDivElement>(null);\r\n  const commentsSectionRef = useRef<HTMLDivElement>(null);\r\n  const [showNavigationDialog, setShowNavigationDialog] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [showOrderDialog, setShowOrderDialog] = useState(false);\r\n  const [showPrivateDialog, setShowPrivateDialog] = useState(false);\r\n  const navigate = useNavigate();\r\n  const queryClient = useQueryClient();\r\n  const { share: smartShareFn, DrawerComponent: SmartShareDrawer } = useSmartShare();\r\n\r\n  // Pull-to-refresh handler - clears cache and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear caches first\r\n    queryClient.removeQueries({ queryKey: ['restaurant', id] });\r\n    queryClient.removeQueries({ queryKey: ['comments', id] });\r\n    queryClient.removeQueries({ queryKey: ['restaurant-activities', id] });\r\n    queryClient.removeQueries({ queryKey: ['dish-images', id] });\r\n    \r\n    // Refetch with fresh data\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['restaurant', id] }),\r\n      queryClient.invalidateQueries({ queryKey: ['comments', id] }),\r\n      queryClient.invalidateQueries({ queryKey: ['restaurant-activities', id] }),\r\n      queryClient.invalidateQueries({ queryKey: ['dish-images', id] }),\r\n    ]);\r\n  }, [queryClient, id]);\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"restaurant\", targetId: id });\r\n  \r\n  // Determine where to go back based on where we came from\r\n  const fromActivity = (location.state as { fromActivity?: string })?.fromActivity;\r\n  const fromAdmin = (location.state as { from?: string })?.from === \"admin\";\r\n  const fromProfile = (location.state as { from?: string })?.from === \"profile\";\r\n  \r\n  const backUrl = fromAdmin\r\n    ? \"/admin/restaurants\"\r\n    : fromProfile\r\n    ? \"/profile\"\r\n    : fromActivity\r\n    ? `/activity/${fromActivity}`\r\n    : \"/restaurants\";\r\n\r\n  const { data: restaurant, isLoading } = useRestaurant(id!);\r\n  const { data: favoriteIds = [] } = useFavorites();\r\n  const { data: comments } = useComments(id!, \"restaurant\", { enabled: shouldLoadComments });\r\n  const toggleFavorite = useToggleFavorite();\r\n  const { role, isAdmin } = useUserRole();\r\n  const { data: myRestaurants = [] } = useMerchantRestaurants();\r\n  const { data: restaurantActivities = [] } = useRestaurantActivities(id!);\r\n  \r\n  // Check if current user is merchant of this restaurant\r\n  const isMerchantOfRestaurant = restaurant && myRestaurants.some(r => r.id === restaurant.id);\r\n\r\n  const localizedRestaurant = restaurant ? localizeRestaurant(restaurant) : null;\r\n  const isFavorite = restaurant ? favoriteIds.includes(restaurant.id) : false;\r\n\r\n  // Calculate most common price range from comments\r\n  const priceRanges = useMemo(() => [\r\n    { value: \"\", label: \" (0-10)\" },\r\n    { value: \"\", label: \" (10-20)\" },\r\n    { value: \"\", label: \" (20+)\" },\r\n  ], []);\r\n  \r\n  const mostCommonPriceRange = useMemo(() => {\r\n    const stats: Record<string, { count: number; latestDate: string }> = {};\r\n    comments?.forEach(comment => {\r\n      if (comment.price_range) {\r\n        if (!stats[comment.price_range]) {\r\n          stats[comment.price_range] = { count: 0, latestDate: comment.created_at };\r\n        }\r\n        stats[comment.price_range].count += 1;\r\n        // Keep track of the most recent date for this price range\r\n        if (comment.created_at > stats[comment.price_range].latestDate) {\r\n          stats[comment.price_range].latestDate = comment.created_at;\r\n        }\r\n      }\r\n    });\r\n    return stats;\r\n  }, [comments]);\r\n  \r\n  // Calculate total price range count\r\n  const totalPriceRangeCount = useMemo(() => {\r\n    if (!mostCommonPriceRange) return 0;\r\n    return Object.values(mostCommonPriceRange).reduce((sum, item) => sum + item.count, 0);\r\n  }, [mostCommonPriceRange]);\r\n  \r\n  // Only display price range if there are more than 10 data points\r\n  // If counts are equal, use the one with the most recent comment\r\n  const priceRangeDisplay = useMemo(() => {\r\n    if (!mostCommonPriceRange || totalPriceRangeCount < 10) return null;\r\n    const sorted = Object.entries(mostCommonPriceRange).sort(([, a], [, b]) => {\r\n      // Sort by count first (descending)\r\n      if (b.count !== a.count) return b.count - a.count;\r\n      // If counts are equal, sort by latest date (descending)\r\n      return b.latestDate.localeCompare(a.latestDate);\r\n    });\r\n    return sorted[0]?.[0] || null;\r\n  }, [mostCommonPriceRange, totalPriceRangeCount]);\r\n\r\n  // Calculate rating count and average rating from comments (comments with rating_value)\r\n  const { ratingCount, averageRating } = useMemo(() => {\r\n    const ratedComments = comments?.filter(c => c.rating_value) || [];\r\n    const count = ratedComments.length;\r\n    const avg = count > 0 \r\n      ? ratedComments.reduce((sum, c) => sum + (c.rating_value || 0), 0) / count \r\n      : 0;\r\n    return { ratingCount: count, averageRating: avg };\r\n  }, [comments]);\r\n\r\n  // Calculate distance from user location\r\n  useEffect(() => {\r\n    if (!restaurant) return;\r\n    \r\n    getUserLocation()\r\n      .then((position) => {\r\n        const dist = calculateDistance(\r\n          position.coords.latitude,\r\n          position.coords.longitude,\r\n          restaurant.lat,\r\n          restaurant.lng\r\n        );\r\n        setDistance(dist);\r\n      })\r\n      .catch(() => {\r\n        // Silently fail if location not available\r\n        setDistance(null);\r\n      });\r\n  }, [restaurant]);\r\n\r\n  const handleToggleFavorite = useCallback(() => {\r\n    if (!user || !restaurant) return;\r\n    toggleFavorite.mutate(restaurant.id);\r\n  }, [user, restaurant, toggleFavorite]);\r\n\r\n  const handleCopyLink = useCallback(async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(window.location.href);\r\n      toast.success(t(\"common.linkCopied\"));\r\n    } catch (error) {\r\n      console.error(\"Error copying link:\", error);\r\n      toast.error(t(\"common.shareError\"));\r\n    }\r\n  }, [t]);\r\n\r\n  const handleNativeShare = useCallback(async () => {\r\n    if (!restaurant || !localizedRestaurant) return;\r\n    \r\n    smartShareFn({\r\n      title: localizedRestaurant.name,\r\n      text: `${localizedRestaurant.name} - Xiaoxiong Market\\n\\n${localizedRestaurant.description || localizedRestaurant.address}`,\r\n      url: window.location.href,\r\n    }, () => {\r\n      toast.success(t(\"common.shareSuccess\"));\r\n    });\r\n  }, [restaurant, localizedRestaurant, smartShareFn, t]);\r\n\r\n  const handleShareToPlatform = useCallback((platform: string) => {\r\n    if (!restaurant || !localizedRestaurant) return;\r\n    \r\n    const url = encodeURIComponent(window.location.href);\r\n    const text = encodeURIComponent(localizedRestaurant.name);\r\n    \r\n    let shareUrl = \"\";\r\n    \r\n    switch (platform) {\r\n      case \"whatsapp\":\r\n        shareUrl = `https://wa.me/?text=${text}%20${url}`;\r\n        break;\r\n      case \"facebook\":\r\n        shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}`;\r\n        break;\r\n      case \"twitter\":\r\n        shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;\r\n        break;\r\n      case \"telegram\":\r\n        shareUrl = `https://t.me/share/url?url=${url}&text=${text}`;\r\n        break;\r\n      case \"wechat\":\r\n        handleCopyLink();\r\n        toast.info(t(\"common.shareVia\") + \" WeChat\");\r\n        return;\r\n      default:\r\n        return;\r\n    }\r\n    \r\n    // Use appropriate method based on environment\r\n    if (isIOSWebView()) {\r\n      window.location.href = shareUrl;\r\n    } else {\r\n      window.open(shareUrl, \"_blank\", \"width=600,height=400\");\r\n    }\r\n  }, [restaurant, localizedRestaurant, handleCopyLink, t]);\r\n\r\n  // Setup Intersection Observer for lazy loading\r\n  useEffect(() => {\r\n    const mapObserver = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && !shouldLoadMap) {\r\n            setShouldLoadMap(true);\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"100px\" }\r\n    );\r\n\r\n    const commentsObserver = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && !shouldLoadComments) {\r\n            setShouldLoadComments(true);\r\n          }\r\n        });\r\n      },\r\n      { rootMargin: \"200px\" }\r\n    );\r\n\r\n    if (mapSectionRef.current) {\r\n      mapObserver.observe(mapSectionRef.current);\r\n    }\r\n    if (commentsSectionRef.current) {\r\n      commentsObserver.observe(commentsSectionRef.current);\r\n    }\r\n\r\n    return () => {\r\n      mapObserver.disconnect();\r\n      commentsObserver.disconnect();\r\n    };\r\n  }, [shouldLoadMap, shouldLoadComments]);\r\n\r\n  // Initialize map\r\n  useEffect(() => {\r\n    if (!mapContainer.current || !restaurant || !shouldLoadMap || !mapOpen) return;\r\n    \r\n    // Don't initialize if map already exists\r\n    if (map.current) return;\r\n\r\n    const token = import.meta.env.VITE_MAPBOX_TOKEN;\r\n    if (!token) {\r\n      console.warn('[RestaurantDetail Map] No Mapbox token found');\r\n      return;\r\n    }\r\n\r\n    // Check WebGL support\r\n    if (!mapboxgl.supported()) {\r\n      console.warn('[RestaurantDetail Map] WebGL not supported', {\r\n        isIOSDevice: isIOSDevice(),\r\n        isIOSWebView: isIOSWebView(),\r\n        userAgent: navigator.userAgent\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Wait for container to have dimensions\r\n    const initMap = () => {\r\n      if (!mapContainer.current) return;\r\n      \r\n      const rect = mapContainer.current.getBoundingClientRect();\r\n      \r\n      if (rect.width === 0 || rect.height === 0) {\r\n        // Retry after a short delay\r\n        setTimeout(initMap, 100);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        mapboxgl.accessToken = token;\r\n\r\n        map.current = new mapboxgl.Map({\r\n          container: mapContainer.current,\r\n          style: \"mapbox://styles/mapbox/light-v11\",\r\n          center: [restaurant.lng, restaurant.lat],\r\n          zoom: 15,\r\n          cooperativeGestures: true, // Require two fingers to pan and zoom on mobile\r\n        });\r\n\r\n        map.current.on('error', (e) => {\r\n          console.error('[RestaurantDetail Map] Map error:', e);\r\n        });\r\n\r\n        // Add custom marker with icon\r\n        const el = document.createElement('div');\r\n        el.style.backgroundImage = `url(${mapIcon})`;\r\n        el.style.width = '40px';\r\n        el.style.height = '40px';\r\n        el.style.backgroundSize = 'contain';\r\n        el.style.backgroundRepeat = 'no-repeat';\r\n        el.style.backgroundPosition = 'center';\r\n        el.style.cursor = 'pointer';\r\n\r\n        new mapboxgl.Marker({ element: el })\r\n          .setLngLat([restaurant.lng, restaurant.lat])\r\n          .addTo(map.current);\r\n\r\n        map.current.addControl(new mapboxgl.NavigationControl());\r\n      } catch (error) {\r\n        console.error('[RestaurantDetail Map] Failed to initialize map:', error);\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure Collapsible animation is complete\r\n    setTimeout(initMap, 50);\r\n\r\n    return () => {\r\n      map.current?.remove();\r\n      map.current = null;\r\n    };\r\n  }, [restaurant, shouldLoadMap, mapOpen]);\r\n\r\n  // Handle map resize when toggling visibility\r\n  useEffect(() => {\r\n    if (mapOpen && map.current) {\r\n      // Wait for collapsible animation to complete before resizing\r\n      const timer = setTimeout(() => {\r\n        map.current?.resize();\r\n        // Re-center the map after resize\r\n        if (restaurant) {\r\n          map.current?.setCenter([restaurant.lng, restaurant.lat]);\r\n        }\r\n      }, 350);\r\n      \r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [mapOpen, restaurant]);\r\n\r\n  if (isLoading) {\r\n    return <RestaurantDetailSkeleton />;\r\n  }\r\n\r\n  if (!restaurant || !localizedRestaurant) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <p className=\"text-xl text-muted-foreground\">{t(\"error.notFound\")}</p>\r\n          <Button asChild className=\"mt-4\">\r\n            <Link to={backUrl}>{t(\"common.back\")}</Link>\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const isGhostRestaurant = (restaurant as any).template === 'ghost';\r\n\r\n  // Ghost Restaurant - Immersive storytelling layout\r\n  if (isGhostRestaurant) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background\">\r\n        {/* Hero Section */}\r\n        <GhostRestaurantHero\r\n          restaurant={restaurant}\r\n          localizedRestaurant={localizedRestaurant}\r\n          backUrl={backUrl}\r\n          user={user}\r\n          isFavorite={isFavorite}\r\n          onToggleFavorite={handleToggleFavorite}\r\n          onShare={() => {\r\n            if (!user) {\r\n              setShowLoginDialog(true);\r\n              return;\r\n            }\r\n            if (isMobile && navigator.share) {\r\n              handleNativeShare();\r\n            } else {\r\n              handleCopyLink();\r\n            }\r\n          }}\r\n          onReport={() => {}}\r\n          showEditButton={isMerchantOfRestaurant || isAdmin}\r\n          editButton={(isMerchantOfRestaurant || isAdmin) && restaurant ? (\r\n            <RestaurantFormDialog\r\n              restaurant={restaurant}\r\n              trigger={\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"icon\"\r\n                  className=\"backdrop-blur-sm bg-background/60\"\r\n                >\r\n                  <Edit className=\"w-5 h-5\" />\r\n                </Button>\r\n              }\r\n            />\r\n          ) : null}\r\n          reportButton={restaurant ? (\r\n            <ReportDialog\r\n              targetType=\"restaurant\"\r\n              targetId={restaurant.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"secondary\"\r\n                  size=\"icon\"\r\n                  className=\"backdrop-blur-sm bg-background/60\"\r\n                >\r\n                  <ShieldAlert className=\"w-5 h-5\" />\r\n                </Button>\r\n              }\r\n            />\r\n          ) : null}\r\n        />\r\n\r\n        {/* Story Content */}\r\n        <GhostRestaurantStory\r\n          restaurant={restaurant}\r\n          localizedRestaurant={localizedRestaurant}\r\n          restaurantActivities={restaurantActivities}\r\n          ratingCount={ratingCount}\r\n          averageRating={averageRating}\r\n          onTakeawayClick={() => setShowOrderDialog(true)}\r\n          onNavigationClick={() => setShowNavigationDialog(true)}\r\n          brandId={(restaurant as any).brand_id}\r\n        />\r\n\r\n        {/* Dialogs */}\r\n        <AlertDialog open={showOrderDialog} onOpenChange={setShowOrderDialog}>\r\n          <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n            <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n            <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n              <div \r\n                className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n              >\r\n                <ExternalLink className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n              </div>\r\n              <div className=\"space-y-1.5 px-1\">\r\n                <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                  {t(\"restaurant.orderOrBookTitle\", \"/\")}\r\n                </AlertDialogTitle>\r\n                <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                   {t(\"restaurant.orderOrBookDescription\", \"\")}\r\n                 </AlertDialogDescription>\r\n               </div>\r\n             </AlertDialogHeader>\r\n             <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                 <AlertDialogAction\r\n                    onClick={async () => {\r\n                      try {\r\n                        let finalUrl = restaurant.website_url;\r\n                        if (user) {\r\n                          try {\r\n                            const { data } = await supabase.functions.invoke('generate-private-token', {\r\n                              body: { restaurant_id: restaurant.id }\r\n                            });\r\n                            const url = new URL(restaurant.website_url);\r\n                            if (data?.token) {\r\n                              url.searchParams.set('token', data.token);\r\n                            }\r\n                            finalUrl = url.toString();\r\n                          } catch (tokenErr) {\r\n                            console.error('Token generation failed:', tokenErr);\r\n                          }\r\n                        }\r\n                        openExternalUrl(finalUrl);\r\n                      } catch (e) {\r\n                        openExternalUrl(restaurant.website_url);\r\n                      }\r\n                   }}\r\n                   className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                 >\r\n                   {t(\"common.continue\", \"\")}\r\n                 </AlertDialogAction>\r\n               <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                 {t(\"common.cancel\")}\r\n               </AlertDialogCancel>\r\n             </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Login Required Dialog */}\r\n        <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {t(\"activities.loginRequiredMessage\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter>\r\n              <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n              <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n                {t(\"activities.goToLogin\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {/* Navigation Confirm Dialog for Ghost Restaurant */}\r\n        <AlertDialog open={showNavigationDialog} onOpenChange={setShowNavigationDialog}>\r\n          <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n            <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n            <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n              <div \r\n                className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n              >\r\n                <Navigation className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n              </div>\r\n              <div className=\"space-y-1.5 px-1\">\r\n                <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                  {t(\"navigation.confirmTitle\")}\r\n                </AlertDialogTitle>\r\n                <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                  {t(\"navigation.confirmDescriptionSimple\", { destination: localizedRestaurant.name })}\r\n                </AlertDialogDescription>\r\n              </div>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n              <AlertDialogAction\r\n                onClick={() => {\r\n                  openNavigation(restaurant.lat, restaurant.lng, localizedRestaurant.name);\r\n                  setShowNavigationDialog(false);\r\n                }}\r\n                className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n              >\r\n                {t(\"navigation.openNavigation\", \"\")}\r\n              </AlertDialogAction>\r\n              <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                {t(\"common.cancel\")}\r\n              </AlertDialogCancel>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Regular Restaurant Layout\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n    <div className=\"min-h-screen bg-secondary/20\">\r\n      {/* Hero Image */}\r\n      <div className=\"relative h-[33vh] overflow-hidden bg-muted\">\r\n        <img\r\n          src={restaurant.cover_image_url || restaurant.image_url || \"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80\"}\r\n          alt={localizedRestaurant.name}\r\n          className=\"w-full h-full object-cover\"\r\n          loading=\"eager\"\r\n        />\r\n        <div className=\"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent\" />\r\n        \r\n        {/* Back Button */}\r\n        <Button\r\n          asChild\r\n          variant=\"secondary\"\r\n          size=\"icon\"\r\n          className=\"absolute top-4 left-4\"\r\n        >\r\n          <Link to={backUrl}>\r\n            <ChevronLeft className=\"w-5 h-5\" />\r\n          </Link>\r\n        </Button>\r\n\r\n        {/* Favorite Button */}\r\n        {user && (\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4\"\r\n            onClick={handleToggleFavorite}\r\n          >\r\n            <Heart className={`w-5 h-5 ${isFavorite ? 'fill-destructive text-destructive' : ''}`} />\r\n          </Button>\r\n        )}\r\n        \r\n        {/* Share Button */}\r\n        {isMobile && navigator.share ? (\r\n          <Button\r\n            variant=\"secondary\"\r\n            size=\"icon\"\r\n            className={`absolute top-4 shadow-lg ${user ? 'right-16' : 'right-4'}`}\r\n            onClick={() => {\r\n              if (!user) {\r\n                setShowLoginDialog(true);\r\n                return;\r\n              }\r\n              handleNativeShare();\r\n            }}\r\n          >\r\n            <Share2 className=\"w-5 h-5\" />\r\n          </Button>\r\n        ) : (\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 shadow-lg ${user ? 'right-16' : 'right-4'}`}\r\n                onClick={(e) => {\r\n                  if (!user) {\r\n                    e.preventDefault();\r\n                    setShowLoginDialog(true);\r\n                  }\r\n                }}\r\n              >\r\n                <Share2 className=\"w-5 h-5\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n              {navigator.share && (\r\n                <>\r\n                  <DropdownMenuItem onClick={handleNativeShare}>\r\n                    <Share2 className=\"w-4 h-4 mr-2\" />\r\n                    {t(\"common.moreOptions\")}\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                </>\r\n              )}\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"wechat\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                WeChat\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"whatsapp\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                WhatsApp\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"facebook\")}>\r\n                <Share2 className=\"w-4 h-4 mr-2\" />\r\n                Facebook\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"twitter\")}>\r\n                <Share2 className=\"w-4 h-4 mr-2\" />\r\n                X (Twitter)\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={() => handleShareToPlatform(\"telegram\")}>\r\n                <MessageCircle className=\"w-4 h-4 mr-2\" />\r\n                Telegram\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem onClick={handleCopyLink}>\r\n                <Link2 className=\"w-4 h-4 mr-2\" />\r\n                {t(\"common.copyLink\")}\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        )}\r\n        \r\n        {/* Edit Button for Merchants */}\r\n        {(isMerchantOfRestaurant || isAdmin) && restaurant && (\r\n          <RestaurantFormDialog\r\n            restaurant={restaurant}\r\n            trigger={\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 ${user ? 'right-28' : 'right-16'}`}\r\n              >\r\n                <Edit className=\"w-5 h-5\" />\r\n              </Button>\r\n            }\r\n          />\r\n        )}\r\n        \r\n        {/* Report Button */}\r\n        {restaurant && (\r\n          <ReportDialog\r\n            targetType=\"restaurant\"\r\n            targetId={restaurant.id}\r\n            onLoginRequired={() => setShowLoginDialog(true)}\r\n            trigger={\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className={`absolute top-4 ${\r\n                  (isMerchantOfRestaurant || isAdmin) \r\n                    ? (user ? 'right-40' : 'right-28')\r\n                    : (user ? 'right-28' : 'right-16')\r\n                }`}\r\n              >\r\n                <ShieldAlert className=\"w-5 h-5\" />\r\n              </Button>\r\n            }\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div className=\"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12\">\r\n        <Card className=\"shadow-large\">\r\n          <CardHeader>\r\n            <div className=\"flex flex-col md:flex-row md:items-start md:justify-between gap-4\">\r\n              <div>\r\n                <div className=\"mb-2 flex flex-wrap gap-2\">\r\n                  {localizedRestaurant.type.slice(0, 3).map((type, idx) => (\r\n                    <Badge key={idx} variant=\"secondary\">{type}</Badge>\r\n                  ))}\r\n                </div>\r\n                <CardTitle className=\"text-3xl mb-2\">\r\n                  {formatTrademarkSymbols(localizedRestaurant.name)}\r\n                </CardTitle>\r\n                <div className=\"flex items-center gap-3 mb-2 flex-wrap\">\r\n                  {distance !== null && (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Navigation className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"font-semibold text-base\">{distance.toFixed(1)} km</span>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"flex items-center gap-1\">\r\n                    <Star className={`w-5 h-5 ${ratingCount > 0 ? \"fill-accent text-accent\" : \"text-muted-foreground\"}`} />\r\n                    {ratingCount > 0 ? (\r\n                      <span className=\"font-semibold text-base\">\r\n                        {averageRating.toFixed(1)}\r\n                        <span className=\"text-muted-foreground font-normal text-sm ml-1\">({ratingCount})</span>\r\n                      </span>\r\n                    ) : (\r\n                      <span className=\"text-sm text-muted-foreground\">\r\n                        {t(\"restaurant.noRatingWithHint\")}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  {priceRangeDisplay && (\r\n                    <div className=\"flex items-center gap-1\">\r\n                      <Wallet className=\"w-4 h-4 text-primary\" />\r\n                      <span className=\"font-semibold text-base\">{priceRangeDisplay}</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Brand About Section - Collapsible */}\r\n                {(restaurant as any).brand_id && (\r\n                  <BrandAboutSection brandId={(restaurant as any).brand_id} />\r\n                )}\r\n                \r\n                {localizedRestaurant.description && localizedRestaurant.description.replace(/<[^>]*>/g, '').trim() !== '' && (\r\n                  <div \r\n                    className=\"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3\"\r\n                    dangerouslySetInnerHTML={{ __html: localizedRestaurant.description }}\r\n                  />\r\n                )}\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n\r\n          <CardContent className=\"space-y-6\">\r\n            {/* Contact Info */}\r\n            <div className=\"grid md:grid-cols-2 gap-4\">\r\n              {/* Activities */}\r\n              {restaurantActivities.length > 0 && (\r\n                <Collapsible\r\n                  open={activitiesOpen}\r\n                  onOpenChange={setActivitiesOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <Star className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex flex-col items-start\">\r\n                          <p className=\"font-medium text-card-foreground\">{t(\"activities.title\")}</p>\r\n                          {!activitiesOpen && (\r\n                            <div className=\"flex flex-wrap gap-1.5 mt-1\">\r\n                              {restaurantActivities.map((activity, idx) => (\r\n                                <Badge \r\n                                  key={`activity-${idx}`} \r\n                                  variant=\"default\" \r\n                                  className=\"text-white\"\r\n                                  style={{ backgroundColor: activity.badge_color || \"#9b87f5\" }}\r\n                                >\r\n                                  {getLocalizedBadgeText(activity, i18n.language)}\r\n                                </Badge>\r\n                              ))}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${activitiesOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3 space-y-2\">\r\n                      {restaurantActivities.map((activity, idx) => {\r\n                        const intro = getLocalizedIntro(activity, i18n.language);\r\n                        return (\r\n                          <Link\r\n                            key={`activity-detail-${idx}`}\r\n                            to={`/activity/${activity.activity_id}`}\r\n                            className=\"block p-2 rounded-md hover:bg-muted/80 transition-colors\"\r\n                          >\r\n                            <Badge \r\n                              variant=\"default\" \r\n                              className=\"text-white mr-2\"\r\n                              style={{ backgroundColor: activity.badge_color || \"#9b87f5\" }}\r\n                            >\r\n                              {getLocalizedBadgeText(activity, i18n.language)}\r\n                            </Badge>\r\n                            <span className=\"text-sm text-muted-foreground\">\r\n                              {intro || getLocalizedActivityTitle(activity, i18n.language)} ... \r\n                            </span>\r\n                          </Link>\r\n                        );\r\n                      })}\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n\r\n              <div className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\">\r\n                <MapPin className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                <div>\r\n                  <p className=\"font-medium text-card-foreground\">{t(\"restaurant.address\")}</p>\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <p className=\"text-muted-foreground\">{restaurant.address}</p>\r\n                    {(restaurant as any).template === 'ghost' && (\r\n                      <Badge variant=\"secondary\" className=\"text-xs\">\r\n                        {t(\"restaurants.ghostKitchen\")}\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {restaurant.phone && (\r\n                <a \r\n                  href={`tel:${restaurant.phone}`}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer\"\r\n                >\r\n                  <Phone className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div>\r\n                    <p className=\"font-medium text-card-foreground\">{t(\"restaurant.phone\")}</p>\r\n                    <p className=\"text-primary underline\">{restaurant.phone}</p>\r\n                  </div>\r\n                </a>\r\n              )}\r\n\r\n              {/* Opening Hours - Only for non-ghost restaurants */}\r\n              {restaurant.opening_hours && (restaurant as any).template !== 'ghost' && (\r\n                <Collapsible\r\n                  open={hoursOpen}\r\n                  onOpenChange={setHoursOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <Clock className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <div className=\"flex flex-col items-start\">\r\n                          <p className=\"font-medium text-card-foreground\">{t(\"restaurant.hours\")}</p>\r\n                          {!hoursOpen && (\r\n                            <p className=\"text-sm text-muted-foreground mt-0.5\">\r\n                              {t(\"restaurant.today\")} {formatOpeningHours(restaurant.opening_hours)}\r\n                            </p>\r\n                          )}\r\n                        </div>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${hoursOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3\">\r\n                      <div className=\"space-y-2\">\r\n                        {(() => {\r\n                          const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];\r\n                          const dayKeys: Record<string, string> = {\r\n                            monday: 'dayMon',\r\n                            tuesday: 'dayTue',\r\n                            wednesday: 'dayWed',\r\n                            thursday: 'dayThu',\r\n                            friday: 'dayFri',\r\n                            saturday: 'daySat',\r\n                            sunday: 'daySun'\r\n                          };\r\n                          const currentDay = days[new Date().getDay() === 0 ? 6 : new Date().getDay() - 1];\r\n                          \r\n                          return days.map((day) => {\r\n                            const hours = restaurant.opening_hours[day];\r\n                            const isToday = day === currentDay;\r\n                            const displayName = t(`restaurant.${dayKeys[day]}`);\r\n                            \r\n                            let hoursText = 'N/A';\r\n                            if (hours) {\r\n                              if (hours.closed) {\r\n                                hoursText = t(\"restaurant.closed\");\r\n                              } else if (hours.splitShift) {\r\n                                hoursText = `${hours.open} - ${hours.close}, ${hours.open2} - ${hours.close2}`;\r\n                              } else {\r\n                                hoursText = `${hours.open} - ${hours.close}`;\r\n                              }\r\n                            }\r\n                            \r\n                            return (\r\n                              <div \r\n                                key={day}\r\n                                className={`flex justify-between items-center py-1.5 px-2 rounded ${\r\n                                  isToday ? 'bg-primary/10 border border-primary/20' : ''\r\n                                }`}\r\n                              >\r\n                                <span className={`text-sm font-medium ${\r\n                                  isToday ? 'text-primary' : 'text-foreground'\r\n                                }`}>\r\n                                  {displayName}\r\n                                  {isToday && <span className=\"ml-2 text-xs\">({t(\"restaurant.today\")})</span>}\r\n                                </span>\r\n                                <span className={`text-sm ${\r\n                                  isToday ? 'text-primary font-semibold' : 'text-muted-foreground'\r\n                                } ${hours?.closed ? 'italic' : ''}`}>\r\n                                  {hoursText}\r\n                                </span>\r\n                              </div>\r\n                            );\r\n                          });\r\n                        })()}\r\n                      </div>\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n\r\n              {/* Announcement */}\r\n              {restaurant && (getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh) && (\r\n                <Collapsible\r\n                  open={announcementOpen}\r\n                  onOpenChange={setAnnouncementOpen}\r\n                  className=\"flex items-start gap-3 p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <MessageCircle className=\"w-5 h-5 text-primary mt-0.5 flex-shrink-0\" />\r\n                  <div className=\"flex-1\">\r\n                    <CollapsibleTrigger className=\"w-full\">\r\n                      <div className=\"flex items-center justify-between\">\r\n                        <p className=\"font-medium text-card-foreground\">{t(\"restaurant.announcement\")}</p>\r\n                        <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${announcementOpen ? 'rotate-180' : ''}`} />\r\n                      </div>\r\n                    </CollapsibleTrigger>\r\n                    <CollapsibleContent className=\"mt-3\">\r\n                      <div className=\"p-3 rounded-md bg-primary/5 border border-primary/10\">\r\n                        <p className=\"text-sm text-foreground whitespace-pre-wrap\">\r\n                          {getLocalizedField(restaurant, \"announcement\") || restaurant.announcement_zh}\r\n                        </p>\r\n                      </div>\r\n                    </CollapsibleContent>\r\n                  </div>\r\n                </Collapsible>\r\n              )}\r\n            </div>\r\n\r\n            {/* Action Buttons - Hide navigation/booking for ghost restaurants */}\r\n            <div className=\"flex flex-col gap-3\">\r\n              {(restaurant as any).template !== 'ghost' && (\r\n                <Button \r\n                  variant=\"secondary\"\r\n                  className=\"w-full\"\r\n                  onClick={() => setShowNavigationDialog(true)}\r\n                >\r\n                  <Navigation className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"restaurant.getDirections\")}\r\n                </Button>\r\n              )}\r\n              {restaurant.website_url && ((restaurant as any).show_takeaway_button || ((restaurant as any).show_booking_button && (restaurant as any).template !== 'ghost')) && (\r\n                <Button \r\n                  className=\"w-full\"\r\n                  onClick={() => setShowOrderDialog(true)}\r\n                >\r\n                  <UtensilsCrossed className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"restaurant.orderOrBook\", \"/\")}\r\n                </Button>\r\n              )}\r\n            </div>\r\n\r\n            {/* Navigation Confirm Dialog - Glass UI Style */}\r\n            <AlertDialog open={showNavigationDialog} onOpenChange={setShowNavigationDialog}>\r\n              <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <Navigation className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n                  </div>\r\n                  <div className=\"space-y-1.5 px-1\">\r\n                    <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                      {t(\"navigation.confirmTitle\")}\r\n                    </AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                      {t(\"navigation.confirmDescriptionSimple\", { destination: localizedRestaurant.name })}\r\n                    </AlertDialogDescription>\r\n                  </div>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                  <AlertDialogAction\r\n                    onClick={() => {\r\n                      openNavigation(restaurant.lat, restaurant.lng, localizedRestaurant.name);\r\n                      setShowNavigationDialog(false);\r\n                    }}\r\n                    className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                  >\r\n                    {t(\"navigation.openNavigation\", \"\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Private Domain Confirm Dialog - Glass UI Style */}\r\n            <AlertDialog open={showPrivateDialog} onOpenChange={setShowPrivateDialog}>\r\n              <AlertDialogContent className=\"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center pb-2\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <ExternalLink className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={2} />\r\n                  </div>\r\n                  <AlertDialogTitle className=\"text-lg font-semibold text-foreground\">\r\n                    {t(\"restaurant.joinPrivateTitle\")}\r\n                  </AlertDialogTitle>\r\n                  <AlertDialogDescription className=\"text-center text-sm text-muted-foreground mt-2 leading-relaxed\">\r\n                    {t(\"restaurant.joinPrivateDescription\")}\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                \r\n                <AlertDialogFooter className=\"relative flex-col gap-2 pt-4\">\r\n                  <AlertDialogAction\r\n                     onClick={async () => {\r\n                      const url = new URL(restaurant.website_url);\r\n                      if (user) {\r\n                        try {\r\n                          const { data } = await supabase.functions.invoke('generate-private-token', {\r\n                            body: { restaurant_id: restaurant.id }\r\n                          });\r\n                          if (data?.token) {\r\n                            url.searchParams.set('token', data.token);\r\n                          }\r\n                        } catch (tokenErr) {\r\n                          console.error('Token generation failed:', tokenErr);\r\n                        }\r\n                      }\r\n                      const targetUrl = url.toString();\r\n                      openExternalUrl(targetUrl);\r\n                    }}\r\n                    className=\"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200\"\r\n                  >\r\n                    {isGeneratingToken ? (\r\n                      <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    ) : null}\r\n                    {t(\"restaurant.joinPrivateConfirm\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogCancel className=\"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200\">\r\n                    {t(\"common.cancel\")}\r\n                  </AlertDialogCancel>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Order/Booking Confirm Dialog - Glass UI Style */}\r\n            <AlertDialog open={showOrderDialog} onOpenChange={setShowOrderDialog}>\r\n              <AlertDialogContent className=\"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6\">\r\n                {/* Glass effect overlay */}\r\n                <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none\" />\r\n                \r\n                <AlertDialogHeader className=\"relative text-center space-y-3\">\r\n                  {/* Icon container */}\r\n                  <div \r\n                    className=\"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0\"\r\n                    style={{ transform: 'translateZ(0)', willChange: 'transform' }}\r\n                  >\r\n                    <ExternalLink className=\"w-7 h-7 text-primary shrink-0\" strokeWidth={1.5} />\r\n                  </div>\r\n                  <div className=\"space-y-1.5 px-1\">\r\n                    <AlertDialogTitle className=\"text-base font-semibold tracking-tight text-foreground\">\r\n                      {t(\"restaurant.orderOrBookTitle\", \"/\")}\r\n                    </AlertDialogTitle>\r\n                    <AlertDialogDescription className=\"text-sm text-muted-foreground/80 leading-relaxed break-words\">\r\n                       {t(\"restaurant.orderOrBookDescription\", \"\")}\r\n                     </AlertDialogDescription>\r\n                   </div>\r\n                 </AlertDialogHeader>\r\n                 \r\n                 <AlertDialogFooter className=\"relative flex-col gap-2 pt-4 mt-1\">\r\n                     <AlertDialogAction\r\n                        onClick={async () => {\r\n                          try {\r\n                            let finalUrl = restaurant.website_url;\r\n                            if (user) {\r\n                              try {\r\n                                const { data } = await supabase.functions.invoke('generate-private-token', {\r\n                                  body: { restaurant_id: restaurant.id }\r\n                                });\r\n                                const url = new URL(restaurant.website_url);\r\n                                if (data?.token) {\r\n                                  url.searchParams.set('token', data.token);\r\n                                }\r\n                                finalUrl = url.toString();\r\n                              } catch (tokenErr) {\r\n                                console.error('Token generation failed:', tokenErr);\r\n                              }\r\n                            }\r\n                            openExternalUrl(finalUrl);\r\n                          } catch (e) {\r\n                            openExternalUrl(restaurant.website_url);\r\n                          }\r\n                       }}\r\n                       className=\"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200\"\r\n                     >\r\n                       {t(\"common.continue\", \"\")}\r\n                     </AlertDialogAction>\r\n                   <AlertDialogCancel className=\"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0\">\r\n                     {t(\"common.cancel\")}\r\n                   </AlertDialogCancel>\r\n                 </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>\r\n\r\n            {/* Dish Photo Gallery */}\r\n            <RestaurantDishGallery restaurantId={restaurant.id} showGallery={(restaurant as any).show_dish_gallery !== false} />\r\n\r\n            {/* Map - Only show for non-ghost restaurants */}\r\n            {(restaurant as any).template !== 'ghost' && (\r\n              <div ref={mapSectionRef}>\r\n                <Collapsible\r\n                  open={mapOpen}\r\n                  onOpenChange={setMapOpen}\r\n                  className=\"p-4 rounded-lg bg-muted/50\"\r\n                >\r\n                  <CollapsibleTrigger className=\"w-full\">\r\n                    <div className=\"flex items-center justify-between mb-4\">\r\n                      <h2 className=\"text-2xl font-bold\">{t(\"restaurant.map\")}</h2>\r\n                      <ChevronDown className={`w-5 h-5 text-muted-foreground transition-transform ${mapOpen ? 'rotate-180' : ''}`} />\r\n                    </div>\r\n                  </CollapsibleTrigger>\r\n                  <CollapsibleContent>\r\n                    {shouldLoadMap ? (\r\n                      <div ref={mapContainer} className=\"h-[350px] rounded-lg overflow-hidden bg-muted\" />\r\n                    ) : (\r\n                      <div className=\"h-[350px] rounded-lg bg-muted flex items-center justify-center\">\r\n                        <Loader2 className=\"w-6 h-6 animate-spin text-muted-foreground\" />\r\n                      </div>\r\n                    )}\r\n                  </CollapsibleContent>\r\n                </Collapsible>\r\n              </div>\r\n            )}\r\n\r\n            <Separator />\r\n\r\n            {/* Rating Section */}\r\n            <RestaurantRating restaurantId={restaurant.id} />\r\n\r\n            <Separator />\r\n\r\n            {/* Comments Section */}\r\n            <div ref={commentsSectionRef}>\r\n              {shouldLoadComments ? (\r\n                <Suspense fallback={\r\n                  <div className=\"flex items-center justify-center py-12\">\r\n                    <Loader2 className=\"w-8 h-8 animate-spin text-primary\" />\r\n                  </div>\r\n                }>\r\n                  <RestaurantComments restaurantId={restaurant.id} />\r\n                </Suspense>\r\n              ) : (\r\n                <div className=\"flex items-center justify-center py-12\">\r\n                  <Loader2 className=\"w-8 h-8 animate-spin text-muted-foreground\" />\r\n                </div>\r\n              )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Login Required Dialog */}\r\n      <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"activities.loginRequiredMessage\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n              {t(\"activities.goToLogin\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n      \r\n      {/* Smart Share Drawer for WebView environments */}\r\n      {SmartShareDrawer}\r\n    </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default RestaurantDetail;\r\n"],"file":"assets/RestaurantDetail-CneExRQx.js"}