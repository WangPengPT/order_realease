{"version":3,"file":"useActivities-Ba4YdxT4.js","sources":["../../src/hooks/useActivities.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport i18n from \"@/i18n/config\";\r\n\r\nexport interface Activity {\r\n  id: string;\r\n  title_en: string;\r\n  title_zh: string;\r\n  title_pt: string;\r\n  content_en: string;\r\n  content_zh: string;\r\n  content_pt: string;\r\n  intro_en?: string | null;\r\n  intro_zh?: string | null;\r\n  intro_pt?: string | null;\r\n  badge_text_en?: string | null;\r\n  badge_text_zh?: string | null;\r\n  badge_text_pt?: string | null;\r\n  badge_color?: string | null;\r\n  usage_instructions_zh?: string | null;\r\n  usage_instructions_en?: string | null;\r\n  usage_instructions_pt?: string | null;\r\n  handbook_zh?: string | null;\r\n  handbook_en?: string | null;\r\n  handbook_pt?: string | null;\r\n  handbook_pending_zh?: string | null;\r\n  handbook_pending_en?: string | null;\r\n  handbook_pending_pt?: string | null;\r\n  handbook_status?: string | null;\r\n  start_date: string;\r\n  end_date: string | null;\r\n  image_url: string | null;\r\n  media_type?: string | null;\r\n  video_url?: string | null;\r\n  pinned: boolean;\r\n  visible: boolean;\r\n  status: \"draft\" | \"published\";\r\n  repeat_mode: string | null;\r\n  sort_order: number;\r\n  creator_id: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n  subscriber_count?: number;\r\n  share_count?: number;\r\n  service_type: \"dine_in\" | \"takeaway\" | \"both\";\r\n}\r\n\r\nexport interface ActivityRestaurant {\r\n  id: string;\r\n  activity_id: string;\r\n  restaurant_id: string;\r\n  created_at: string;\r\n  restaurants: {\r\n    id: string;\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n    type: string[];\r\n    type_en: string[] | null;\r\n    type_pt: string[] | null;\r\n    address: string;\r\n    image_url: string | null;\r\n    rating: number | null;\r\n    lat: number | null;\r\n    lng: number | null;\r\n    website_url: string | null;\r\n    show_takeaway_button: boolean | null;\r\n    show_booking_button: boolean | null;\r\n  };\r\n}\r\n\r\nexport interface ActivityCreator {\r\n  isAdmin: boolean;\r\n  restaurant?: {\r\n    id: string;\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n  } | null;\r\n  avatar_url?: string | null;\r\n}\r\n\r\n// Frontend hook - only returns published activities\r\nexport const useActivities = () => {\r\n  return useQuery({\r\n    queryKey: [\"activities\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"*\")\r\n        .eq(\"status\", \"published\") // Only fetch published activities for frontend\r\n        .order(\"pinned\", { ascending: false })\r\n        .order(\"sort_order\", { ascending: true })\r\n        .order(\"start_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      \r\n      // Get subscriber counts, share counts and creator info for all activities\r\n      const activitiesWithExtras = await Promise.all(\r\n        (data || []).map(async (activity) => {\r\n          // Get subscriber count\r\n          const { count: subscriberCount } = await supabase\r\n            .from(\"subscriptions\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"activity_id\", activity.id);\r\n          \r\n          // Get share count from activity_shares table\r\n          const { count: shareCount } = await supabase\r\n            .from(\"activity_shares\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"activity_id\", activity.id);\r\n          \r\n          // Get creator info using secure function\r\n          const { data: creatorInfo } = await supabase\r\n            .rpc(\"get_activity_creator_info\", { creator_user_id: activity.creator_id });\r\n          \r\n          const parsedCreatorInfo = creatorInfo as unknown as { \r\n            isAdmin: boolean; \r\n            restaurant: ActivityCreator[\"restaurant\"]; \r\n            avatar_url: string | null;\r\n          } | null;\r\n          \r\n          return {\r\n            ...activity,\r\n            subscriber_count: subscriberCount || 0,\r\n            share_count: shareCount || 0,\r\n            creator: {\r\n              isAdmin: parsedCreatorInfo?.isAdmin ?? true,\r\n              restaurant: parsedCreatorInfo?.restaurant ?? null,\r\n              avatar_url: parsedCreatorInfo?.avatar_url ?? null,\r\n            } as ActivityCreator,\r\n          };\r\n        })\r\n      );\r\n      \r\n      return activitiesWithExtras as (Activity & { creator: ActivityCreator; share_count?: number })[];\r\n    },\r\n  });\r\n};\r\n\r\n// Admin hook - returns ALL activities including drafts (for admin backend)\r\nexport const useAdminActivities = () => {\r\n  return useQuery({\r\n    queryKey: [\"admin-activities\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"*\")\r\n        .order(\"pinned\", { ascending: false })\r\n        .order(\"sort_order\", { ascending: true })\r\n        .order(\"start_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      \r\n      // Get subscriber counts, share counts and creator info for all activities\r\n      const activitiesWithExtras = await Promise.all(\r\n        (data || []).map(async (activity) => {\r\n          // Get subscriber count\r\n          const { count: subscriberCount } = await supabase\r\n            .from(\"subscriptions\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"activity_id\", activity.id);\r\n          \r\n          // Get share count from activity_shares table\r\n          const { count: shareCount } = await supabase\r\n            .from(\"activity_shares\")\r\n            .select(\"*\", { count: \"exact\", head: true })\r\n            .eq(\"activity_id\", activity.id);\r\n          \r\n          // Get creator info using secure function\r\n          const { data: creatorInfo } = await supabase\r\n            .rpc(\"get_activity_creator_info\", { creator_user_id: activity.creator_id });\r\n          \r\n          const parsedCreatorInfo = creatorInfo as unknown as { \r\n            isAdmin: boolean; \r\n            restaurant: ActivityCreator[\"restaurant\"]; \r\n            avatar_url: string | null;\r\n          } | null;\r\n          \r\n          return {\r\n            ...activity,\r\n            subscriber_count: subscriberCount || 0,\r\n            share_count: shareCount || 0,\r\n            creator: {\r\n              isAdmin: parsedCreatorInfo?.isAdmin ?? true,\r\n              restaurant: parsedCreatorInfo?.restaurant ?? null,\r\n              avatar_url: parsedCreatorInfo?.avatar_url ?? null,\r\n            } as ActivityCreator,\r\n          };\r\n        })\r\n      );\r\n      \r\n      return activitiesWithExtras as (Activity & { creator: ActivityCreator; share_count?: number })[];\r\n    },\r\n  });\r\n};\r\n\r\nexport const useActivity = (id: string) => {\r\n  return useQuery({\r\n    queryKey: [\"activity\", id],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"*\")\r\n        .eq(\"id\", id)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data as Activity;\r\n    },\r\n    enabled: !!id,\r\n  });\r\n};\r\n\r\nexport const useActivityRestaurants = (activityId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"activityRestaurants\", activityId],\r\n    queryFn: async () => {\r\n      const { data: arData, error: arError } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(\"*\")\r\n        .eq(\"activity_id\", activityId);\r\n\r\n      if (arError) throw arError;\r\n      if (!arData || arData.length === 0) return [];\r\n\r\n      const restaurantIds = arData.map(ar => ar.restaurant_id);\r\n      const { data: restaurants, error: restaurantsError } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"id, name, name_en, name_pt, type, type_en, type_pt, address, image_url, rating, lat, lng, website_url, show_takeaway_button, show_booking_button\")\r\n        .in(\"id\", restaurantIds);\r\n\r\n      if (restaurantsError) throw restaurantsError;\r\n\r\n      return arData.map(ar => ({\r\n        ...ar,\r\n        restaurants: restaurants?.find(r => r.id === ar.restaurant_id) || {\r\n          id: ar.restaurant_id,\r\n          name: \"\",\r\n          name_en: null,\r\n          name_pt: null,\r\n          type: [],\r\n          type_en: null,\r\n          type_pt: null,\r\n          address: \"\",\r\n          image_url: null,\r\n          rating: null,\r\n          lat: null,\r\n          lng: null,\r\n          website_url: null,\r\n          show_takeaway_button: null,\r\n          show_booking_button: null,\r\n        }\r\n      })) as ActivityRestaurant[];\r\n    },\r\n    enabled: !!activityId,\r\n  });\r\n};\r\n\r\nexport const useSubscriptions = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"subscriptions\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"subscriptions\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n\r\n      // Fetch activity details for each subscription - only published activities\r\n      const subscriptionsWithActivities = await Promise.all(\r\n        (data || []).map(async (sub) => {\r\n          const { data: activity } = await supabase\r\n            .from(\"activities\")\r\n            .select(\"*\")\r\n            .eq(\"id\", sub.activity_id)\r\n            .eq(\"status\", \"published\") // Only show published activities\r\n            .maybeSingle();\r\n\r\n          return {\r\n            ...sub,\r\n            activity,\r\n          };\r\n        })\r\n      );\r\n\r\n      // Filter out subscriptions where activity is null (draft activities)\r\n      return subscriptionsWithActivities.filter(sub => sub.activity !== null);\r\n    },\r\n    enabled: !!user,\r\n  });\r\n};\r\n\r\nexport const useToggleSubscription = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (activityId: string) => {\r\n      if (!user) throw new Error(\"User not authenticated\");\r\n\r\n      const { data: existing } = await supabase\r\n        .from(\"subscriptions\")\r\n        .select(\"id\")\r\n        .eq(\"activity_id\", activityId)\r\n        .eq(\"user_id\", user.id)\r\n        .maybeSingle();\r\n\r\n      if (existing) {\r\n        const { error } = await supabase\r\n          .from(\"subscriptions\")\r\n          .delete()\r\n          .eq(\"id\", existing.id);\r\n\r\n        if (error) throw error;\r\n        return { action: \"unsubscribed\", activityId };\r\n      } else {\r\n        const { error } = await supabase\r\n          .from(\"subscriptions\")\r\n          .insert({\r\n            activity_id: activityId,\r\n            user_id: user.id,\r\n          });\r\n\r\n        if (error) throw error;\r\n        return { action: \"subscribed\", activityId };\r\n      }\r\n    },\r\n    onMutate: async (activityId) => {\r\n      // Cancel outgoing refetches\r\n      await queryClient.cancelQueries({ queryKey: [\"activities\"] });\r\n      await queryClient.cancelQueries({ queryKey: [\"subscriptions\"] });\r\n\r\n      // Snapshot previous values\r\n      const previousActivities = queryClient.getQueryData([\"activities\"]);\r\n      const previousSubscriptions = queryClient.getQueryData([\"subscriptions\", user?.id]);\r\n\r\n      // Check if already subscribed\r\n      const subscriptions = queryClient.getQueryData<Array<{ activity_id: string }>>([\"subscriptions\", user?.id]) || [];\r\n      const isSubscribed = subscriptions.some(sub => sub.activity_id === activityId);\r\n\r\n      // Optimistically update activities list\r\n      queryClient.setQueryData([\"activities\"], (old: Array<Activity & { subscriber_count?: number }> | undefined) => {\r\n        if (!old) return old;\r\n        return old.map(activity => {\r\n          if (activity.id === activityId) {\r\n            return {\r\n              ...activity,\r\n              subscriber_count: (activity.subscriber_count || 0) + (isSubscribed ? -1 : 1),\r\n            };\r\n          }\r\n          return activity;\r\n        });\r\n      });\r\n\r\n      return { previousActivities, previousSubscriptions };\r\n    },\r\n    onSuccess: (result) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"subscriptions\"] });\r\n      toast({\r\n        title: result.action === \"subscribed\" ? i18n.t(\"toast.subscribed\") : i18n.t(\"toast.unsubscribed\"),\r\n        description:\r\n          result.action === \"subscribed\"\r\n            ? i18n.t(\"toast.subscribedDesc\")\r\n            : i18n.t(\"toast.unsubscribedDesc\"),\r\n      });\r\n    },\r\n    onError: (err, activityId, context) => {\r\n      // Rollback on error\r\n      if (context?.previousActivities) {\r\n        queryClient.setQueryData([\"activities\"], context.previousActivities);\r\n      }\r\n      if (context?.previousSubscriptions) {\r\n        queryClient.setQueryData([\"subscriptions\", user?.id], context.previousSubscriptions);\r\n      }\r\n      toast({\r\n        title: i18n.t(\"common.error\"),\r\n        description: i18n.t(\"toast.subscriptionFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useSubscriberCount = (activityId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"subscriberCount\", activityId],\r\n    queryFn: async () => {\r\n      const { count, error } = await supabase\r\n        .from(\"subscriptions\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"activity_id\", activityId);\r\n\r\n      if (error) throw error;\r\n      return count || 0;\r\n    },\r\n    enabled: !!activityId,\r\n  });\r\n};\r\n\r\nexport const useShareCount = (activityId: string) => {\r\n  return useQuery({\r\n    queryKey: [\"shareCount\", activityId],\r\n    queryFn: async () => {\r\n      const { count, error } = await supabase\r\n        .from(\"activity_shares\")\r\n        .select(\"*\", { count: \"exact\", head: true })\r\n        .eq(\"activity_id\", activityId);\r\n\r\n      if (error) throw error;\r\n      return count || 0;\r\n    },\r\n    enabled: !!activityId,\r\n  });\r\n};\r\n\r\nexport const useHasShared = (activityId: string) => {\r\n  const { data: session } = useQuery({\r\n    queryKey: [\"session\"],\r\n    queryFn: async () => {\r\n      const { data } = await supabase.auth.getSession();\r\n      return data.session;\r\n    },\r\n  });\r\n\r\n  return useQuery({\r\n    queryKey: [\"hasShared\", activityId, session?.user?.id],\r\n    queryFn: async () => {\r\n      if (!session?.user?.id) return false;\r\n      \r\n      const { data, error } = await supabase\r\n        .from(\"activity_shares\")\r\n        .select(\"id\")\r\n        .eq(\"activity_id\", activityId)\r\n        .eq(\"user_id\", session.user.id)\r\n        .maybeSingle();\r\n\r\n      if (error) throw error;\r\n      return !!data;\r\n    },\r\n    enabled: !!activityId && !!session?.user?.id,\r\n  });\r\n};\r\n\r\nexport const useRecordShare = () => {\r\n  const queryClient = useQueryClient();\r\n  \r\n  return useMutation({\r\n    mutationFn: async ({ activityId, userId }: { activityId: string; userId: string }) => {\r\n      const { error } = await supabase\r\n        .from(\"activity_shares\")\r\n        .insert({ activity_id: activityId, user_id: userId });\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: (_, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"shareCount\", variables.activityId] });\r\n      queryClient.invalidateQueries({ queryKey: [\"hasShared\", variables.activityId] });\r\n      queryClient.invalidateQueries({ queryKey: [\"activities\"] });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useActivityCreator = (creatorId: string | undefined) => {\r\n  return useQuery({\r\n    queryKey: [\"activityCreator\", creatorId],\r\n    queryFn: async () => {\r\n      if (!creatorId) return null;\r\n      \r\n      const { data: creatorInfo } = await supabase\r\n        .rpc(\"get_activity_creator_info\", { creator_user_id: creatorId });\r\n      \r\n      const parsedCreatorInfo = creatorInfo as unknown as { \r\n        isAdmin: boolean; \r\n        restaurant: ActivityCreator[\"restaurant\"]; \r\n        avatar_url: string | null;\r\n      } | null;\r\n      \r\n      return {\r\n        isAdmin: parsedCreatorInfo?.isAdmin ?? true,\r\n        restaurant: parsedCreatorInfo?.restaurant ?? null,\r\n        avatar_url: parsedCreatorInfo?.avatar_url ?? null,\r\n      } as ActivityCreator;\r\n    },\r\n    enabled: !!creatorId,\r\n  });\r\n};\r\n"],"names":["useActivities","useQuery","data","error","supabase","activity","subscriberCount","shareCount","creatorInfo","parsedCreatorInfo","useAdminActivities","useActivity","id","useActivityRestaurants","activityId","arData","arError","restaurantIds","ar","restaurants","restaurantsError","r","useSubscriptions","user","useAuth","sub","useToggleSubscription","toast","useToast","queryClient","useQueryClient","useMutation","existing","previousActivities","previousSubscriptions","isSubscribed","old","result","i18n","err","context","useSubscriberCount","count","useShareCount","useRecordShare","userId","_","variables","useActivityCreator","creatorId"],"mappings":"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"}