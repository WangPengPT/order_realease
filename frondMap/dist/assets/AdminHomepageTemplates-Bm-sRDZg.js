import{p as he,r as x,j as e,cI as G,cX as be,cY as ye,b8 as fe,cJ as Ae,aM as ne,cK as $e,cL as Le,cM as Re,bQ as Oe,cZ as Be,bf as Me,c_ as ge,bK as Pe,bJ as Ue,br as He,ak as Ve,bB as We,X as Je,w as T,bh as ce,cN as de,c1 as Ye,aw as qe}from"./vendor-react-Dd_5Sawp.js";import{D as Ne,c as we,d as Ce,e as Te,T as ke,g as Ge,V as Ke,B as p,C as te,q as ie,A as Xe,a7 as Qe,t as Ze,v as es,w as ss,x as as,y as ts,z as is,E as ls,U as n,I as d,K as rs,L as ns,M as os,N as le,O as cs,a2 as ds,a3 as ms,a4 as ps,a5 as us,a6 as se,a8 as me,p as pe,F as ue}from"./index-BTawsUvj.js";import{S as ve}from"./slider-DJ1bTEn5.js";import{T as De,a as ze,b as K,c as re}from"./tabs-Bn7q7SHF.js";import{a as hs,b as xs,c as gs,d as vs,e as js,f as _s}from"./useHomepageTemplates-DVfj1SeX.js";import{A as bs,a as ys}from"./alert-CzAAilfg.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-BnZwaL-Z.js";const fs={desktop:{width:1920,height:1080,aspect:16/9,label:"桌面端 16:9",icon:be},tablet:{width:1024,height:768,aspect:4/3,label:"平板端 4:3",icon:ye},mobile:{width:750,height:1334,aspect:9/16,label:"移动端 9:16",icon:fe}};function je(a,w,f){return Le(Re({unit:"%",width:90},f,a,w),a,w)}function Ns({open:a,onOpenChange:w,imageSource:f,deviceType:I,onCropComplete:C}){const{t:ae}=he(),[$,X]=x.useState(""),[k,F]=x.useState(),[O,g]=x.useState(),[t,b]=x.useState(I),L=x.useRef(null),[E,B]=x.useState(!1),[S,M]=x.useState(!1),h=fs[t],W=h.icon;x.useEffect(()=>{if(a&&f)if(b(I),F(void 0),g(void 0),typeof f=="string")M(!0),X(f);else{M(!0);const o=new FileReader;o.addEventListener("load",()=>{X(o.result?.toString()||"")}),o.readAsDataURL(f)}},[a,f,I]);const P=x.useCallback(o=>{M(!1);const{width:v,height:j}=o.currentTarget;F(je(v,j,h.aspect))},[h.aspect]);x.useEffect(()=>{if(L.current&&L.current.complete){const{width:o,height:v}=L.current;o&&v&&F(je(o,v,h.aspect))}},[t,h.aspect]);const J=x.useCallback(async(o,v)=>{const j=document.createElement("canvas"),Y=j.getContext("2d");if(!Y)throw new Error("No 2d context");const Q=o.naturalWidth/o.width,U=o.naturalHeight/o.height,q=v.width*Q,H=v.height*U;let D=q,R=H;if(D>h.width||R>h.height){const V=Math.min(h.width/D,h.height/R);D=D*V,R=R*V}return j.width=D,j.height=R,Y.imageSmoothingQuality="high",Y.drawImage(o,v.x*Q,v.y*U,q,H,0,0,j.width,j.height),new Promise((V,Z)=>{j.toBlob(z=>{if(!z){Z(new Error("Canvas is empty"));return}V(z)},"image/jpeg",.92)})},[h]),N=x.useCallback(async()=>{if(!(!O||!L.current)){B(!0);try{const o=await J(L.current,O),v=typeof f=="string"?`cropped-${t}-${Date.now()}.jpg`:f.name,j=new File([o],v,{type:"image/jpeg"});C(j,t),w(!1)}catch(o){console.error("Error cropping image:",o)}finally{B(!1)}}},[O,f,t,C,w,J]);return e.jsx(Ne,{open:a,onOpenChange:w,children:e.jsxs(we,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ce,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(Te,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-primary"}),"裁剪图片"]}),e.jsx(ke,{className:"text-xs sm:text-sm",children:"拖动选择要保留的区域，裁剪后将用于主页轮播"})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsx(De,{value:t,onValueChange:o=>b(o),children:e.jsxs(ze,{className:"grid w-full grid-cols-3",children:[e.jsxs(K,{value:"desktop",className:"flex items-center gap-1",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"桌面端"})]}),e.jsxs(K,{value:"tablet",className:"flex items-center gap-1",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"平板端"})]}),e.jsxs(K,{value:"mobile",className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"移动端"})]})]})}),e.jsxs(bs,{className:"border-primary/20 bg-primary/5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(ys,{className:"text-xs sm:text-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"推荐尺寸:"}),e.jsxs(Ge,{variant:"secondary",className:"w-fit",children:[e.jsx(Ae,{className:"w-3 h-3 mr-1"}),h.width," × ",h.height," px (",h.label,")"]})]})})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-lg border bg-muted/30 min-h-[200px]",children:[S&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8 animate-spin text-muted-foreground"})}),$&&e.jsx($e,{crop:k,onChange:o=>F(o),onComplete:o=>g(o),aspect:h.aspect,className:"max-h-[50vh] sm:max-h-[55vh] flex items-center justify-center",children:e.jsx("img",{ref:L,src:$,alt:"Crop preview",onLoad:P,crossOrigin:"anonymous",className:"max-w-full max-h-[50vh] sm:max-h-[55vh] h-auto object-contain"})})]})]}),e.jsxs(Ke,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>w(!1),disabled:E,className:"w-full sm:w-auto",children:ae("common.cancel")}),e.jsx(p,{type:"button",onClick:N,disabled:!O||E||S,className:"w-full sm:w-auto",children:E?"处理中...":"确认裁剪"})]})]})})}const _e="/images/sushi-ramen-hero.jpg",ws="/images/sushi-ramen-mobile.jpg",Cs=({template:a,onClose:w})=>{const{i18n:f}=he(),I=f.language?.split("-")[0]||"zh",C=N=>a[`${N}${I==="zh"?"_zh":I==="pt"?"_pt":"_en"}`]||"",ae=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",$=()=>{const N=ae();return N==="mobile"&&a.mobile_overlay_opacity!==null?a.mobile_overlay_opacity:N==="tablet"&&a.tablet_overlay_opacity!==null?a.tablet_overlay_opacity:N==="desktop"&&a.desktop_overlay_opacity!==null?a.desktop_overlay_opacity:a.overlay_opacity??30},X=()=>{const N=$()||30,o=a.overlay_gradient_direction||"to-b",v=(z,ee)=>z==null?ee/100:z>1?z/100:z,j=N>1?N/100:N,Y=v(a.overlay_gradient_from_opacity,30)*j,Q=v(a.overlay_gradient_via_opacity,25)*j,U=v(a.overlay_gradient_to_opacity,40)*j,H={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[o]||"to bottom",D={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},R=D[a.overlay_gradient_from||"black"]||"0, 0, 0",V=D[a.overlay_gradient_via||"black"]||"0, 0, 0",Z=D[a.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${H}, rgba(${R}, ${Y}), rgba(${V}, ${Q}), rgba(${Z}, ${U}))`}},k=a.mobile_image_url||ws,F=a.tablet_image_url||a.desktop_image_url||_e,O=a.desktop_image_url||_e,g=a.background_blur||0,t=a.desktop_media_type||a.media_type||"image",b=a.tablet_media_type||a.media_type||"image",E=(a.mobile_media_type||a.media_type||"image")==="video"?a.mobile_video_url:null,B=b==="video"?a.tablet_video_url||a.desktop_video_url:null,S=t==="video"?a.desktop_video_url:null,M=C("title"),h=C("subtitle"),W=C("description"),P=C("primary_button_text"),J=C("secondary_button_text");return e.jsxs("div",{className:"relative w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:E?e.jsx("video",{src:E,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:k||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:B?e.jsx("video",{src:B,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:F||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:S?e.jsx("video",{src:S,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:O||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})})]}),e.jsx("div",{className:"absolute inset-0 z-10",style:X()}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center text-center px-4",children:[h&&e.jsx("p",{className:"text-white/90 text-sm sm:text-base mb-2 drop-shadow-md",children:h}),M&&e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4 drop-shadow-lg",children:M}),W&&e.jsx("p",{className:"text-white/80 text-base sm:text-lg max-w-2xl mb-8 drop-shadow-md",children:W}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[P&&e.jsx(p,{variant:a.primary_button_variant||"default",size:"lg",className:"pointer-events-none",children:P}),J&&e.jsx(p,{variant:a.secondary_button_variant||"outline",size:"lg",className:"pointer-events-none text-white border-white hover:bg-white/10",children:J})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30 bg-black/50 text-white text-xs px-3 py-1 rounded-full",children:"预览模式 - 点击右上角关闭"})]})},Ls=()=>{const{t:a}=he(),{data:w,isLoading:f}=hs(),I=xs(),C=gs(),ae=vs(),$=js(),X=_s(),[k,F]=x.useState(null),[O,g]=x.useState(!1),[t,b]=x.useState({}),[L,E]=x.useState("images"),[B,S]=x.useState(null),[M,h]=x.useState(!1),[W,P]=x.useState(null),[J,N]=x.useState("desktop"),o=()=>{b({sort_order:w?.length||0,is_active:!0,media_type:"image",desktop_media_type:"image",tablet_media_type:"image",mobile_media_type:"image",duration:5e3,overlay_opacity:40,overlay_gradient_direction:"to-b",overlay_gradient_from:"background",overlay_gradient_from_opacity:30,overlay_gradient_via:"background",overlay_gradient_via_opacity:25,overlay_gradient_to:"background",overlay_gradient_to_opacity:40,background_blur:0,title_zh:"发现您的亚洲美食之旅",title_en:"Discover Your Asian Food Journey",title_pt:"Descubra Sua Jornada Gastronômica Asiática",subtitle_zh:"您的美食之旅从这里开始",subtitle_en:"Your culinary journey starts here",subtitle_pt:"Sua jornada culinária começa aqui",description_zh:"探索里斯本地区最好的亚洲美食",description_en:"Explore the best Asian cuisine in the Lisbon area",description_pt:"Explore a melhor cozinha asiática na área de Lisboa",primary_button_text_zh:"探索餐厅",primary_button_text_en:"Explore Restaurants",primary_button_text_pt:"Explorar Restaurantes",primary_button_link:"/restaurants",primary_button_variant:"default",secondary_button_text_zh:"活动",secondary_button_text_en:"Activities",secondary_button_text_pt:"Atividades",secondary_button_link:"/activities",secondary_button_variant:"outline"}),g(!0),E("media")},v=s=>{b(s),F(s),E("media")},j=async()=>{try{k?(await C.mutateAsync({id:k.id,...t}),F(null)):(await I.mutateAsync(t),g(!1)),b({})}catch(s){console.error("Save failed:",s)}},Y=async s=>{try{await ae.mutateAsync(s)}catch(m){console.error("Delete failed:",m)}},Q=async s=>{try{await C.mutateAsync({id:s.id,is_active:!s.is_active})}catch(m){console.error("Toggle failed:",m)}},U=async(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("image/")){T.error(a("admin.homepageTemplates.selectImageFile"));return}try{const i=k?.id||"new",c=await $.mutateAsync({file:r,type:m,templateId:i});b(_=>({..._,[`${m}_image_url`]:c.url}))}catch(i){console.error("Upload failed:",i)}}},q=(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("image/")){T.error(a("admin.homepageTemplates.selectImageFile"));return}P(r),N(m),h(!0),s.target.value=""}},H=(s,m)=>{P(s),N(m),h(!0)},D=async(s,m)=>{try{const r=k?.id||"new",i=await $.mutateAsync({file:s,type:m,templateId:r});b(c=>({...c,[`${m}_image_url`]:i.url})),T.success("图片裁剪并上传成功")}catch(r){console.error("Upload failed:",r),T.error("上传失败")}},R=s=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const A=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),URL.revokeObjectURL(i.src),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout(A,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout(A,100)},i.onerror=y=>{URL.revokeObjectURL(i.src),r(new Error("Failed to load video: "+y?.message||"Unknown error"))},setTimeout(()=>{u||(URL.revokeObjectURL(i.src),r(new Error("Timeout while extracting video frame")))},1e4),i.src=URL.createObjectURL(s),i.load()}),V=s=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const A=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout(A,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout(A,100)},i.onerror=()=>{r(new Error("Failed to load video from URL"))},setTimeout(()=>{u||r(new Error("Timeout while extracting video frame from URL"))},15e3),i.src=s,i.load()}),[Z,z]=x.useState(!1),ee=async s=>{const m=s?[s]:["desktop","tablet","mobile"],r=k?.id||"new",i={desktop:"桌面端",tablet:"平板端",mobile:"移动端"};z(!0);let c=0,_=0;for(const u of m){const A=t[`${u}_video_url`];if(A)try{T.info(`正在提取${i[u]}视频第一帧...`);const y=await V(A),Fe=new File([y],`${u}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),Ee=await $.mutateAsync({file:Fe,type:u,templateId:r});b(Se=>({...Se,[`${u}_image_url`]:Ee.url})),c++}catch(y){console.error(`Failed to regenerate ${u} poster:`,y),_++}}if(z(!1),c>0){const u=s?`成功重新生成${i[s]}备用图片`:`成功重新生成 ${c} 个备用图片`;T.success(u)}if(_>0&&T.warning(`${_} 个视频提取失败，可能是跨域限制`),c===0&&_===0){const u=s?`${i[s]}没有视频需要处理`:"没有找到需要处理的视频";T.info(u)}},oe=async(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("video/")){T.error("请选择视频文件");return}if(r.size>100*1024*1024){T.error("视频文件大小不能超过100MB");return}try{const i=k?.id||"new",c=await X.mutateAsync({file:r,type:m,templateId:i});try{T.info("正在提取视频第一帧作为备用图片...");const _=await R(r),u=new File([_],`${m}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),A=await $.mutateAsync({file:u,type:m,templateId:i});b(y=>({...y,[`${m}_video_url`]:c.url,[`${m}_image_url`]:A.url})),T.success("视频和备用图片已自动生成")}catch(_){console.error("Failed to extract first frame:",_),b(u=>({...u,[`${m}_video_url`]:c.url})),T.warning("视频已上传，但无法自动提取第一帧，请手动上传备用图片")}}catch(i){console.error("Upload failed:",i)}}},l=(s,m)=>{b(r=>({...r,[s]:m}))},xe=()=>{F(null),g(!1),b({})};if(f)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(ne,{className:"w-8 h-8 animate-spin"})});const Ie=()=>e.jsxs(De,{value:L,onValueChange:E,className:"w-full",children:[e.jsxs(ze,{className:"grid w-full grid-cols-4",children:[e.jsx(K,{value:"media",children:"媒体"}),e.jsx(K,{value:"overlay",children:a("admin.homepageTemplates.tabs.overlay")}),e.jsx(K,{value:"content",children:a("admin.homepageTemplates.tabs.content")}),e.jsx(K,{value:"buttons",children:a("admin.homepageTemplates.tabs.buttons")})]}),e.jsxs(re,{value:"media",className:"space-y-6 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"每个端可以独立选择图片或视频，支持混合配置（如：桌面端视频 + 移动端图片）"}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"桌面端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.desktop_media_type||"image")==="image"?"default":"outline",onClick:()=>l("desktop_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.desktop_media_type||"image")==="video"?"default":"outline",onClick:()=>l("desktop_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.desktop_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.desktop_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.desktop_image_url,alt:"Desktop",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.desktop_image_url,"desktop"),title:"编辑裁剪",children:e.jsx(G,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"desktop"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>q(s,"desktop"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"desktop-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.desktop_video_url&&e.jsx("video",{src:t.desktop_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>oe(s,"desktop")})]}),t.desktop_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.desktop_image_url,alt:"Desktop poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"平板端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.tablet_media_type||"image")==="image"?"default":"outline",onClick:()=>l("tablet_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.tablet_media_type||"image")==="video"?"default":"outline",onClick:()=>l("tablet_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.tablet_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.tablet_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.tablet_image_url,alt:"Tablet",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.tablet_image_url,"tablet"),title:"编辑裁剪",children:e.jsx(G,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"tablet"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>q(s,"tablet"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"tablet-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.tablet_video_url&&e.jsx("video",{src:t.tablet_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>oe(s,"tablet")})]}),t.tablet_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.tablet_image_url,alt:"Tablet poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-medium",children:"移动端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(t.mobile_media_type||"image")==="image"?"default":"outline",onClick:()=>l("mobile_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(t.mobile_media_type||"image")==="video"?"default":"outline",onClick:()=>l("mobile_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(de,{className:"w-3 h-3"}),"视频"]})]})]}),(t.mobile_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[t.mobile_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.mobile_image_url,alt:"Mobile",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(t.mobile_image_url,"mobile"),title:"编辑裁剪",children:e.jsx(G,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"mobile"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>q(s,"mobile"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"mobile-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[t.mobile_video_url&&e.jsx("video",{src:t.mobile_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>oe(s,"mobile")})]}),t.mobile_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:t.mobile_image_url,alt:"Mobile poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),(t.desktop_video_url||t.tablet_video_url||t.mobile_video_url)&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(n,{className:"text-sm font-medium",children:"备用图片管理"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"上传视频时会自动截取第一帧作为备用图片"})]}),e.jsxs(rs,{children:[e.jsx(ns,{asChild:!0,children:e.jsxs(p,{type:"button",variant:"outline",size:"sm",disabled:Z,children:[Z?e.jsx(ne,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"重新生成第一帧",e.jsx(qe,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(os,{align:"end",children:[e.jsx(le,{onClick:()=>ee(),children:"全部重新生成"}),e.jsx(cs,{}),e.jsx(le,{onClick:()=>ee("desktop"),disabled:!t.desktop_video_url,className:t.desktop_video_url?"":"opacity-50 cursor-not-allowed",children:"仅桌面端"}),e.jsx(le,{onClick:()=>ee("tablet"),disabled:!t.tablet_video_url,className:t.tablet_video_url?"":"opacity-50 cursor-not-allowed",children:"仅平板端"}),e.jsx(le,{onClick:()=>ee("mobile"),disabled:!t.mobile_video_url,className:t.mobile_video_url?"":"opacity-50 cursor-not-allowed",children:"仅移动端"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.duration")}),e.jsx(d,{type:"number",value:t.duration||5e3,onChange:s=>l("duration",parseInt(s.target.value)||5e3),min:1e3,max:3e4}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a("admin.homepageTemplates.durationHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.sortOrder")}),e.jsx(d,{type:"number",value:t.sort_order||0,onChange:s=>l("sort_order",parseInt(s.target.value)||0)})]})]})]}),e.jsx(re,{value:"overlay",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:[a("admin.homepageTemplates.baseOverlayOpacity"),": ",t.overlay_opacity||40,"%"]}),e.jsx(ve,{value:[t.overlay_opacity||40],onValueChange:([s])=>l("overlay_opacity",s),max:100,step:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.gradientDirection")}),e.jsxs(ds,{value:t.overlay_gradient_direction||"to-b",onValueChange:s=>l("overlay_gradient_direction",s),children:[e.jsx(ms,{children:e.jsx(ps,{})}),e.jsxs(us,{children:[e.jsx(se,{value:"to-b",children:a("admin.homepageTemplates.gradientDirection.toBottom")}),e.jsx(se,{value:"to-t",children:a("admin.homepageTemplates.gradientDirection.toTop")}),e.jsx(se,{value:"to-r",children:a("admin.homepageTemplates.gradientDirection.toRight")}),e.jsx(se,{value:"to-l",children:a("admin.homepageTemplates.gradientDirection.toLeft")}),e.jsx(se,{value:"to-br",children:a("admin.homepageTemplates.gradientDirection.toBottomRight")}),e.jsx(se,{value:"to-tr",children:a("admin.homepageTemplates.gradientDirection.toTopRight")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.startOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_from_opacity||30,onChange:s=>l("overlay_gradient_from_opacity",parseInt(s.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.middleOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_via_opacity||25,onChange:s=>l("overlay_gradient_via_opacity",parseInt(s.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.endOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:t.overlay_gradient_to_opacity||40,onChange:s=>l("overlay_gradient_to_opacity",parseInt(s.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{children:[a("admin.homepageTemplates.backgroundBlur"),": ",t.background_blur||0,"px"]}),e.jsx(ve,{value:[t.background_blur||0],onValueChange:([s])=>l("background_blur",s),max:50,step:1})]})]})}),e.jsx(re,{value:"content",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.titleChinese")}),e.jsx(d,{value:t.title_zh||"",onChange:s=>l("title_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.titleEnglish")}),e.jsx(d,{value:t.title_en||"",onChange:s=>l("title_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.titlePortuguese")}),e.jsx(d,{value:t.title_pt||"",onChange:s=>l("title_pt",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.descriptionChinese")}),e.jsx(me,{value:t.description_zh||"",onChange:s=>l("description_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.descriptionEnglish")}),e.jsx(me,{value:t.description_en||"",onChange:s=>l("description_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.descriptionPortuguese")}),e.jsx(me,{value:t.description_pt||"",onChange:s=>l("description_pt",s.target.value)})]})]})}),e.jsxs(re,{value:"buttons",className:"space-y-4 mt-4",children:[e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:a("admin.homepageTemplates.primaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.primary_button_text_zh||"",onChange:s=>l("primary_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.english")}),e.jsx(d,{value:t.primary_button_text_en||"",onChange:s=>l("primary_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.primary_button_text_pt||"",onChange:s=>l("primary_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.link")}),e.jsx(d,{value:t.primary_button_link||"",onChange:s=>l("primary_button_link",s.target.value)})]})]})]}),e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:a("admin.homepageTemplates.secondaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.secondary_button_text_zh||"",onChange:s=>l("secondary_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.english")}),e.jsx(d,{value:t.secondary_button_text_en||"",onChange:s=>l("secondary_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.secondary_button_text_pt||"",onChange:s=>l("secondary_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.link")}),e.jsx(d,{value:t.secondary_button_link||"",onChange:s=>l("secondary_button_link",s.target.value)})]})]})]}),e.jsxs(te,{children:[e.jsx(pe,{className:"py-3",children:e.jsx(ue,{className:"text-lg",children:a("admin.homepageTemplates.mapButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.chinese")}),e.jsx(d,{value:t.map_button_text_zh||"",onChange:s=>l("map_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.english")}),e.jsx(d,{value:t.map_button_text_en||"",onChange:s=>l("map_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:t.map_button_text_pt||"",onChange:s=>l("map_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:a("admin.homepageTemplates.link")}),e.jsx(d,{value:t.map_button_link||"",onChange:s=>l("map_button_link",s.target.value),placeholder:"/map"})]})]})]})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:a("admin.homepageTemplates")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:a("admin.homepageTemplatesDescription")})]}),e.jsxs(p,{onClick:o,children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),a("admin.homepageTemplates.createTemplate")]})]}),e.jsxs("div",{className:"grid gap-4",children:[w?.map(s=>e.jsx(te,{className:s.is_active?"":"opacity-60",children:e.jsx(ie,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["#",s.sort_order]})]}),s.desktop_image_url&&e.jsx("img",{src:s.desktop_image_url,alt:"Preview",className:"w-24 h-16 object-cover rounded border"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.title_zh}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.description_zh}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Me,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.duration/1e3,a("admin.homepageTemplates.seconds")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>S(s),title:a("admin.homepageTemplates.preview")||"预览",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Q(s),title:s.is_active?a("admin.homepageTemplates.hide"):a("admin.homepageTemplates.show"),children:s.is_active?e.jsx(Pe,{className:"w-4 h-4"}):e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>v(s),children:e.jsx(He,{className:"w-4 h-4"})}),e.jsxs(Xe,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Ze,{children:[e.jsxs(es,{children:[e.jsx(ss,{children:a("admin.confirmDelete")}),e.jsx(as,{children:a("admin.homepageTemplates.deleteTemplateConfirm")})]}),e.jsxs(ts,{children:[e.jsx(is,{children:a("common.cancel")}),e.jsx(ls,{onClick:()=>Y(s.id),children:a("common.delete")})]})]})]})]})]})})},s.id)),(!w||w.length===0)&&e.jsx(te,{children:e.jsx(ie,{className:"p-8 text-center text-muted-foreground",children:a("admin.homepageTemplates.noTemplates")})})]}),e.jsx(Ne,{open:!!k||O,onOpenChange:xe,children:e.jsxs(we,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ce,{children:[e.jsx(Te,{children:a(k?"admin.homepageTemplates.editTemplate":"admin.homepageTemplates.createTemplate")}),e.jsx(ke,{children:a("admin.homepageTemplates.configureTemplate")})]}),Ie(),e.jsxs("div",{className:"flex justify-between gap-2 mt-4",children:[e.jsxs(p,{variant:"outline",onClick:()=>S(t),disabled:!t.desktop_image_url&&!t.mobile_image_url,children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),"预览"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",onClick:xe,children:a("common.cancel")}),e.jsxs(p,{onClick:j,disabled:I.isPending||C.isPending,children:[(I.isPending||C.isPending)&&e.jsx(ne,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(We,{className:"w-4 h-4 mr-2"}),a("common.save")]})]})]})]})}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 text-white hover:bg-white/20",onClick:()=>S(null),children:e.jsx(Je,{className:"w-6 h-6"})}),e.jsx(Cs,{template:B,onClose:()=>S(null)})]}),W&&e.jsx(Ns,{open:M,onOpenChange:s=>{h(s),s||P(null)},imageSource:W,deviceType:J,onCropComplete:D})]})};export{Ls as default};
//# sourceMappingURL=AdminHomepageTemplates-Bm-sRDZg.js.map
