import{p as H,u as U,r as v,j as e,b0 as V,cW as B,ak as G,cw as b,bm as K,cr as Q,bf as W,bD as q,ba as J,b5 as X,be as Y}from"./vendor-react-DwI6ZJq7.js";import{u as Z,K as ee,L as se,M as te,N as D,g as l,P as ae,Q as re,R as ie,A as le,t as ne,v as ce,w as oe,x as de,y as me,z as xe,E as ue}from"./index-C7QjDrm6.js";import{a as he,b as ge}from"./useCommunityPosts-CLuoFC0C.js";import{u as fe}from"./useLocalizedContent-MCfjRTM4.js";import{E as pe,a as je}from"./EditRecipeDialog-PDDiowvd.js";const ke=({post:s,showAssociations:C=!1})=>{const{t:a}=H(),{user:d}=Z(),m=U(),{getLocalizedField:x}=fe(),_=he(),A=ge(),[P,E]=v.useState(!1),[$,u]=v.useState(!1),[y,h]=v.useState(!1),r=s,i=r.post_type==="recipe",N=d?.id===s.author_id,S=t=>{t.preventDefault(),t.stopPropagation(),d&&_.mutate({postId:s.id,liked:s.user_liked||!1})},I=()=>m(`/community/${s.id}`),L=(t,j)=>{t.preventDefault(),t.stopPropagation(),m(`/restaurant/${j}`)},M=t=>{t.preventDefault(),t.stopPropagation(),s.activity?.id&&m(`/activity/${s.activity.id}`)},R=()=>{A.mutate(s.id),u(!1)},T=t=>new DOMParser().parseFromString(t,"text/html").body.textContent||"",z=x(s,"content"),n=T(z),w=s.image_urls&&s.image_urls.length>0,c=!!s.video_url,g=w||c,k=s.image_urls?.length||0,o=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(t=>t.id===s.restaurant?.id)?[s.restaurant]:[]],f=s.activity?x(s.activity,"title"):null,p=2,F=t=>{switch(t){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},O=t=>{switch(t){case"easy":return a("recipe.difficulty.easy","简单");case"medium":return a("recipe.difficulty.medium","中等");case"hard":return a("recipe.difficulty.hard","困难");default:return t}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 relative",onClick:I,children:[N&&e.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:t=>t.stopPropagation(),children:e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx(V,{className:"h-4 w-4 text-white"})})}),e.jsxs(te,{align:"end",className:"min-w-[120px]",children:[e.jsxs(D,{onClick:()=>h(!0),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),a("common.edit","编辑")]}),e.jsxs(D,{className:"text-destructive focus:text-destructive",onClick:()=>u(!0),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),a("common.delete","删除")]})]})]})}),g&&e.jsxs("div",{className:`relative ${i?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[w?P?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:a("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>E(!0)}):c?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,i&&e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),a("recipe.badge","食谱")]}),c&&!i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(K,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!c&&k>1&&!i&&e.jsxs("div",{className:`absolute top-2 ${N?"right-11":"right-2"} bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1`,children:[e.jsx(Q,{className:"h-3 w-3"}),e.jsx("span",{children:k})]})]}),!g&&i&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(b,{className:"h-12 w-12 text-primary/40"}),e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),a("recipe.badge","食谱")]})]}),e.jsxs("div",{className:"p-3",children:[i&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[r.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.cook_time,a("recipe.min","分")]})]}),r.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.servings,a("recipe.servingsShort","人")]})]}),r.difficulty&&e.jsx(l,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${F(r.difficulty)}`,children:O(r.difficulty)})]}),C&&(o.length>0||f)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[o.slice(0,p).map(t=>e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:j=>L(j,t.id),children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:x(t,"name")})]},t.id)),o.length>p&&e.jsxs(l,{variant:"secondary",className:"text-xs gap-1",children:["+",o.length-p]}),f&&e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:M,children:[e.jsx(X,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:f})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${g?"":"min-h-[60px]"}`,children:i?r.recipe_name:n}),i&&n&&!n.includes("主要配料：")&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3 leading-relaxed mt-1",children:n}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsxs(ae,{className:"h-5 w-5 flex-shrink-0",children:[e.jsx(re,{src:s.author?.avatar_url||void 0}),e.jsx(ie,{className:"text-[10px]",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${s.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:S,disabled:!d,children:[e.jsx(Y,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count||0})]})]})]})]}),e.jsx(le,{open:$,onOpenChange:u,children:e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:a("community.deleteConfirmTitle","确认删除")}),e.jsx(de,{children:a("community.deleteConfirmDesc","删除后将无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(me,{children:[e.jsx(xe,{children:a("common.cancel","取消")}),e.jsx(ue,{onClick:R,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete","删除")})]})]})}),i?e.jsx(pe,{post:s,open:y,onOpenChange:h}):e.jsx(je,{post:s,open:y,onOpenChange:h})]})};export{ke as P};
//# sourceMappingURL=PostGridCard-C7jHx_c7.js.map
