var J6=e=>{throw TypeError(e)};var BN=(e,t,r)=>t.has(e)||J6("Cannot "+r);var St=(e,t,r)=>(BN(e,t,"read from private field"),r?r.call(e):t.get(e)),Bn=(e,t,r)=>t.has(e)?J6("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),cn=(e,t,r,n)=>(BN(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Ri=(e,t,r)=>(BN(e,t,"access private method"),r);var Y2=(e,t,r,n)=>({set _(o){cn(e,t,o,r)},get _(){return St(e,t,n)}});function rZ(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const o in n)if(o!=="default"&&!(o in e)){const l=Object.getOwnPropertyDescriptor(n,o);l&&Object.defineProperty(e,o,l.get?l:{enumerable:!0,get:()=>n[o]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=r(o);fetch(o.href,l)}})();var mc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function va(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function wfe(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}),r}var nZ={exports:{}},NI={},iZ={exports:{}},Hi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xT=Symbol.for("react.element"),Sfe=Symbol.for("react.portal"),Efe=Symbol.for("react.fragment"),Tfe=Symbol.for("react.strict_mode"),Afe=Symbol.for("react.profiler"),Pfe=Symbol.for("react.provider"),Cfe=Symbol.for("react.context"),Ofe=Symbol.for("react.forward_ref"),Ife=Symbol.for("react.suspense"),kfe=Symbol.for("react.memo"),Rfe=Symbol.for("react.lazy"),Q6=Symbol.iterator;function jfe(e){return e===null||typeof e!="object"?null:(e=Q6&&e[Q6]||e["@@iterator"],typeof e=="function"?e:null)}var aZ={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oZ=Object.assign,sZ={};function gb(e,t,r){this.props=e,this.context=t,this.refs=sZ,this.updater=r||aZ}gb.prototype.isReactComponent={};gb.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};gb.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function lZ(){}lZ.prototype=gb.prototype;function cz(e,t,r){this.props=e,this.context=t,this.refs=sZ,this.updater=r||aZ}var uz=cz.prototype=new lZ;uz.constructor=cz;oZ(uz,gb.prototype);uz.isPureReactComponent=!0;var e8=Array.isArray,cZ=Object.prototype.hasOwnProperty,dz={current:null},uZ={key:!0,ref:!0,__self:!0,__source:!0};function dZ(e,t,r){var n,o={},l=null,d=null;if(t!=null)for(n in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(l=""+t.key),t)cZ.call(t,n)&&!uZ.hasOwnProperty(n)&&(o[n]=t[n]);var i=arguments.length-2;if(i===1)o.children=r;else if(1<i){for(var g=Array(i),x=0;x<i;x++)g[x]=arguments[x+2];o.children=g}if(e&&e.defaultProps)for(n in i=e.defaultProps,i)o[n]===void 0&&(o[n]=i[n]);return{$$typeof:xT,type:e,key:l,ref:d,props:o,_owner:dz.current}}function Nfe(e,t){return{$$typeof:xT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function hz(e){return typeof e=="object"&&e!==null&&e.$$typeof===xT}function Mfe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var t8=/\/+/g;function $N(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Mfe(""+e.key):t.toString(36)}function ZP(e,t,r,n,o){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(l){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case xT:case Sfe:d=!0}}if(d)return d=e,o=o(d),e=n===""?"."+$N(d,0):n,e8(o)?(r="",e!=null&&(r=e.replace(t8,"$&/")+"/"),ZP(o,t,r,"",function(x){return x})):o!=null&&(hz(o)&&(o=Nfe(o,r+(!o.key||d&&d.key===o.key?"":(""+o.key).replace(t8,"$&/")+"/")+e)),t.push(o)),1;if(d=0,n=n===""?".":n+":",e8(e))for(var i=0;i<e.length;i++){l=e[i];var g=n+$N(l,i);d+=ZP(l,t,r,g,o)}else if(g=jfe(e),typeof g=="function")for(e=g.call(e),i=0;!(l=e.next()).done;)l=l.value,g=n+$N(l,i++),d+=ZP(l,t,r,g,o);else if(l==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function J2(e,t,r){if(e==null)return e;var n=[],o=0;return ZP(e,n,"","",function(l){return t.call(r,l,o++)}),n}function Dfe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Gl={current:null},XP={transition:null},Lfe={ReactCurrentDispatcher:Gl,ReactCurrentBatchConfig:XP,ReactCurrentOwner:dz};function hZ(){throw Error("act(...) is not supported in production builds of React.")}Hi.Children={map:J2,forEach:function(e,t,r){J2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return J2(e,function(){t++}),t},toArray:function(e){return J2(e,function(t){return t})||[]},only:function(e){if(!hz(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Hi.Component=gb;Hi.Fragment=Efe;Hi.Profiler=Afe;Hi.PureComponent=cz;Hi.StrictMode=Tfe;Hi.Suspense=Ife;Hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lfe;Hi.act=hZ;Hi.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=oZ({},e.props),o=e.key,l=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(l=t.ref,d=dz.current),t.key!==void 0&&(o=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(g in t)cZ.call(t,g)&&!uZ.hasOwnProperty(g)&&(n[g]=t[g]===void 0&&i!==void 0?i[g]:t[g])}var g=arguments.length-2;if(g===1)n.children=r;else if(1<g){i=Array(g);for(var x=0;x<g;x++)i[x]=arguments[x+2];n.children=i}return{$$typeof:xT,type:e.type,key:o,ref:l,props:n,_owner:d}};Hi.createContext=function(e){return e={$$typeof:Cfe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Pfe,_context:e},e.Consumer=e};Hi.createElement=dZ;Hi.createFactory=function(e){var t=dZ.bind(null,e);return t.type=e,t};Hi.createRef=function(){return{current:null}};Hi.forwardRef=function(e){return{$$typeof:Ofe,render:e}};Hi.isValidElement=hz;Hi.lazy=function(e){return{$$typeof:Rfe,_payload:{_status:-1,_result:e},_init:Dfe}};Hi.memo=function(e,t){return{$$typeof:kfe,type:e,compare:t===void 0?null:t}};Hi.startTransition=function(e){var t=XP.transition;XP.transition={};try{e()}finally{XP.transition=t}};Hi.unstable_act=hZ;Hi.useCallback=function(e,t){return Gl.current.useCallback(e,t)};Hi.useContext=function(e){return Gl.current.useContext(e)};Hi.useDebugValue=function(){};Hi.useDeferredValue=function(e){return Gl.current.useDeferredValue(e)};Hi.useEffect=function(e,t){return Gl.current.useEffect(e,t)};Hi.useId=function(){return Gl.current.useId()};Hi.useImperativeHandle=function(e,t,r){return Gl.current.useImperativeHandle(e,t,r)};Hi.useInsertionEffect=function(e,t){return Gl.current.useInsertionEffect(e,t)};Hi.useLayoutEffect=function(e,t){return Gl.current.useLayoutEffect(e,t)};Hi.useMemo=function(e,t){return Gl.current.useMemo(e,t)};Hi.useReducer=function(e,t,r){return Gl.current.useReducer(e,t,r)};Hi.useRef=function(e){return Gl.current.useRef(e)};Hi.useState=function(e){return Gl.current.useState(e)};Hi.useSyncExternalStore=function(e,t,r){return Gl.current.useSyncExternalStore(e,t,r)};Hi.useTransition=function(){return Gl.current.useTransition()};Hi.version="18.3.1";iZ.exports=Hi;var G=iZ.exports;const We=va(G),fz=rZ({__proto__:null,default:We},[G]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ffe=G,zfe=Symbol.for("react.element"),Bfe=Symbol.for("react.fragment"),$fe=Object.prototype.hasOwnProperty,Ufe=Ffe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Vfe={key:!0,ref:!0,__self:!0,__source:!0};function fZ(e,t,r){var n,o={},l=null,d=null;r!==void 0&&(l=""+r),t.key!==void 0&&(l=""+t.key),t.ref!==void 0&&(d=t.ref);for(n in t)$fe.call(t,n)&&!Vfe.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)o[n]===void 0&&(o[n]=t[n]);return{$$typeof:zfe,type:e,key:l,ref:d,props:o,_owner:Ufe.current}}NI.Fragment=Bfe;NI.jsx=fZ;NI.jsxs=fZ;nZ.exports=NI;var m=nZ.exports,pZ={exports:{}},eu={},mZ={exports:{}},gZ={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(_e,be){var Pe=_e.length;_e.push(be);e:for(;0<Pe;){var ye=Pe-1>>>1,ge=_e[ye];if(0<o(ge,be))_e[ye]=be,_e[Pe]=ge,Pe=ye;else break e}}function r(_e){return _e.length===0?null:_e[0]}function n(_e){if(_e.length===0)return null;var be=_e[0],Pe=_e.pop();if(Pe!==be){_e[0]=Pe;e:for(var ye=0,ge=_e.length,ke=ge>>>1;ye<ke;){var Qe=2*(ye+1)-1,He=_e[Qe],$e=Qe+1,Xe=_e[$e];if(0>o(He,Pe))$e<ge&&0>o(Xe,He)?(_e[ye]=Xe,_e[$e]=Pe,ye=$e):(_e[ye]=He,_e[Qe]=Pe,ye=Qe);else if($e<ge&&0>o(Xe,Pe))_e[ye]=Xe,_e[$e]=Pe,ye=$e;else break e}}return be}function o(_e,be){var Pe=_e.sortIndex-be.sortIndex;return Pe!==0?Pe:_e.id-be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var d=Date,i=d.now();e.unstable_now=function(){return d.now()-i}}var g=[],x=[],S=1,E=null,A=3,C=!1,N=!1,k=!1,R=typeof setTimeout=="function"?setTimeout:null,L=typeof clearTimeout=="function"?clearTimeout:null,j=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function F(_e){for(var be=r(x);be!==null;){if(be.callback===null)n(x);else if(be.startTime<=_e)n(x),be.sortIndex=be.expirationTime,t(g,be);else break;be=r(x)}}function B(_e){if(k=!1,F(_e),!N)if(r(g)!==null)N=!0,Ce(U);else{var be=r(x);be!==null&&fe(B,be.startTime-_e)}}function U(_e,be){N=!1,k&&(k=!1,L(te),te=-1),C=!0;var Pe=A;try{for(F(be),E=r(g);E!==null&&(!(E.expirationTime>be)||_e&&!ne());){var ye=E.callback;if(typeof ye=="function"){E.callback=null,A=E.priorityLevel;var ge=ye(E.expirationTime<=be);be=e.unstable_now(),typeof ge=="function"?E.callback=ge:E===r(g)&&n(g),F(be)}else n(g);E=r(g)}if(E!==null)var ke=!0;else{var Qe=r(x);Qe!==null&&fe(B,Qe.startTime-be),ke=!1}return ke}finally{E=null,A=Pe,C=!1}}var Z=!1,X=null,te=-1,se=5,oe=-1;function ne(){return!(e.unstable_now()-oe<se)}function ee(){if(X!==null){var _e=e.unstable_now();oe=_e;var be=!0;try{be=X(!0,_e)}finally{be?ie():(Z=!1,X=null)}}else Z=!1}var ie;if(typeof j=="function")ie=function(){j(ee)};else if(typeof MessageChannel<"u"){var he=new MessageChannel,Se=he.port2;he.port1.onmessage=ee,ie=function(){Se.postMessage(null)}}else ie=function(){R(ee,0)};function Ce(_e){X=_e,Z||(Z=!0,ie())}function fe(_e,be){te=R(function(){_e(e.unstable_now())},be)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(_e){_e.callback=null},e.unstable_continueExecution=function(){N||C||(N=!0,Ce(U))},e.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):se=0<_e?Math.floor(1e3/_e):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return r(g)},e.unstable_next=function(_e){switch(A){case 1:case 2:case 3:var be=3;break;default:be=A}var Pe=A;A=be;try{return _e()}finally{A=Pe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(_e,be){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var Pe=A;A=_e;try{return be()}finally{A=Pe}},e.unstable_scheduleCallback=function(_e,be,Pe){var ye=e.unstable_now();switch(typeof Pe=="object"&&Pe!==null?(Pe=Pe.delay,Pe=typeof Pe=="number"&&0<Pe?ye+Pe:ye):Pe=ye,_e){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Pe+ge,_e={id:S++,callback:be,priorityLevel:_e,startTime:Pe,expirationTime:ge,sortIndex:-1},Pe>ye?(_e.sortIndex=Pe,t(x,_e),r(g)===null&&_e===r(x)&&(k?(L(te),te=-1):k=!0,fe(B,Pe-ye))):(_e.sortIndex=ge,t(g,_e),N||C||(N=!0,Ce(U))),_e},e.unstable_shouldYield=ne,e.unstable_wrapCallback=function(_e){var be=A;return function(){var Pe=A;A=be;try{return _e.apply(this,arguments)}finally{A=Pe}}}})(gZ);mZ.exports=gZ;var qfe=mZ.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wfe=G,Yc=qfe;function Ir(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yZ=new Set,rE={};function bv(e,t){b0(e,t),b0(e+"Capture",t)}function b0(e,t){for(rE[e]=t,e=0;e<t.length;e++)yZ.add(t[e])}var If=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AD=Object.prototype.hasOwnProperty,Gfe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,r8={},n8={};function Hfe(e){return AD.call(n8,e)?!0:AD.call(r8,e)?!1:Gfe.test(e)?n8[e]=!0:(r8[e]=!0,!1)}function Kfe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Zfe(e,t,r,n){if(t===null||typeof t>"u"||Kfe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Hl(e,t,r,n,o,l,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=l,this.removeEmptyString=d}var Hs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Hs[e]=new Hl(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Hs[t]=new Hl(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Hs[e]=new Hl(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Hs[e]=new Hl(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Hs[e]=new Hl(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Hs[e]=new Hl(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Hs[e]=new Hl(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Hs[e]=new Hl(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Hs[e]=new Hl(e,5,!1,e.toLowerCase(),null,!1,!1)});var pz=/[\-:]([a-z])/g;function mz(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(pz,mz);Hs[t]=new Hl(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(pz,mz);Hs[t]=new Hl(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(pz,mz);Hs[t]=new Hl(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Hs[e]=new Hl(e,1,!1,e.toLowerCase(),null,!1,!1)});Hs.xlinkHref=new Hl("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Hs[e]=new Hl(e,1,!1,e.toLowerCase(),null,!0,!0)});function gz(e,t,r,n){var o=Hs.hasOwnProperty(t)?Hs[t]:null;(o!==null?o.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Zfe(t,r,o,n)&&(r=null),n||o===null?Hfe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):o.mustUseProperty?e[o.propertyName]=r===null?o.type===3?!1:"":r:(t=o.attributeName,n=o.attributeNamespace,r===null?e.removeAttribute(t):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Bf=Wfe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Q2=Symbol.for("react.element"),Px=Symbol.for("react.portal"),Cx=Symbol.for("react.fragment"),yz=Symbol.for("react.strict_mode"),PD=Symbol.for("react.profiler"),vZ=Symbol.for("react.provider"),_Z=Symbol.for("react.context"),vz=Symbol.for("react.forward_ref"),CD=Symbol.for("react.suspense"),OD=Symbol.for("react.suspense_list"),_z=Symbol.for("react.memo"),Yp=Symbol.for("react.lazy"),xZ=Symbol.for("react.offscreen"),i8=Symbol.iterator;function Z1(e){return e===null||typeof e!="object"?null:(e=i8&&e[i8]||e["@@iterator"],typeof e=="function"?e:null)}var xo=Object.assign,UN;function wS(e){if(UN===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);UN=t&&t[1]||""}return`
`+UN+e}var VN=!1;function qN(e,t){if(!e||VN)return"";VN=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(x){var n=x}Reflect.construct(e,[],t)}else{try{t.call()}catch(x){n=x}e.call(t.prototype)}else{try{throw Error()}catch(x){n=x}e()}}catch(x){if(x&&n&&typeof x.stack=="string"){for(var o=x.stack.split(`
`),l=n.stack.split(`
`),d=o.length-1,i=l.length-1;1<=d&&0<=i&&o[d]!==l[i];)i--;for(;1<=d&&0<=i;d--,i--)if(o[d]!==l[i]){if(d!==1||i!==1)do if(d--,i--,0>i||o[d]!==l[i]){var g=`
`+o[d].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=d&&0<=i);break}}}finally{VN=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?wS(e):""}function Xfe(e){switch(e.tag){case 5:return wS(e.type);case 16:return wS("Lazy");case 13:return wS("Suspense");case 19:return wS("SuspenseList");case 0:case 2:case 15:return e=qN(e.type,!1),e;case 11:return e=qN(e.type.render,!1),e;case 1:return e=qN(e.type,!0),e;default:return""}}function ID(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Cx:return"Fragment";case Px:return"Portal";case PD:return"Profiler";case yz:return"StrictMode";case CD:return"Suspense";case OD:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case _Z:return(e.displayName||"Context")+".Consumer";case vZ:return(e._context.displayName||"Context")+".Provider";case vz:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case _z:return t=e.displayName||null,t!==null?t:ID(e.type)||"Memo";case Yp:t=e._payload,e=e._init;try{return ID(e(t))}catch{}}return null}function Yfe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ID(t);case 8:return t===yz?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function zm(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function bZ(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Jfe(e){var t=bZ(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,l=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(d){n=""+d,l.call(this,d)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(d){n=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function eP(e){e._valueTracker||(e._valueTracker=Jfe(e))}function wZ(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=bZ(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function PC(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function kD(e,t){var r=t.checked;return xo({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function a8(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=zm(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function SZ(e,t){t=t.checked,t!=null&&gz(e,"checked",t,!1)}function RD(e,t){SZ(e,t);var r=zm(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?jD(e,t.type,r):t.hasOwnProperty("defaultValue")&&jD(e,t.type,zm(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function o8(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function jD(e,t,r){(t!=="number"||PC(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var SS=Array.isArray;function Wx(e,t,r,n){if(e=e.options,t){t={};for(var o=0;o<r.length;o++)t["$"+r[o]]=!0;for(r=0;r<e.length;r++)o=t.hasOwnProperty("$"+e[r].value),e[r].selected!==o&&(e[r].selected=o),o&&n&&(e[r].defaultSelected=!0)}else{for(r=""+zm(r),t=null,o=0;o<e.length;o++){if(e[o].value===r){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function ND(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ir(91));return xo({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function s8(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Ir(92));if(SS(r)){if(1<r.length)throw Error(Ir(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:zm(r)}}function EZ(e,t){var r=zm(t.value),n=zm(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function l8(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function TZ(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function MD(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?TZ(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var tP,AZ=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,o){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,o)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(tP=tP||document.createElement("div"),tP.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=tP.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function nE(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var NS={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qfe=["Webkit","ms","Moz","O"];Object.keys(NS).forEach(function(e){Qfe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),NS[t]=NS[e]})});function PZ(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||NS.hasOwnProperty(e)&&NS[e]?(""+t).trim():t+"px"}function CZ(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=PZ(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,o):e[r]=o}}var epe=xo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function DD(e,t){if(t){if(epe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ir(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ir(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ir(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ir(62))}}function LD(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var FD=null;function xz(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var zD=null,Gx=null,Hx=null;function c8(e){if(e=ST(e)){if(typeof zD!="function")throw Error(Ir(280));var t=e.stateNode;t&&(t=zI(t),zD(e.stateNode,e.type,t))}}function OZ(e){Gx?Hx?Hx.push(e):Hx=[e]:Gx=e}function IZ(){if(Gx){var e=Gx,t=Hx;if(Hx=Gx=null,c8(e),t)for(e=0;e<t.length;e++)c8(t[e])}}function kZ(e,t){return e(t)}function RZ(){}var WN=!1;function jZ(e,t,r){if(WN)return e(t,r);WN=!0;try{return kZ(e,t,r)}finally{WN=!1,(Gx!==null||Hx!==null)&&(RZ(),IZ())}}function iE(e,t){var r=e.stateNode;if(r===null)return null;var n=zI(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Ir(231,t,typeof r));return r}var BD=!1;if(If)try{var X1={};Object.defineProperty(X1,"passive",{get:function(){BD=!0}}),window.addEventListener("test",X1,X1),window.removeEventListener("test",X1,X1)}catch{BD=!1}function tpe(e,t,r,n,o,l,d,i,g){var x=Array.prototype.slice.call(arguments,3);try{t.apply(r,x)}catch(S){this.onError(S)}}var MS=!1,CC=null,OC=!1,$D=null,rpe={onError:function(e){MS=!0,CC=e}};function npe(e,t,r,n,o,l,d,i,g){MS=!1,CC=null,tpe.apply(rpe,arguments)}function ipe(e,t,r,n,o,l,d,i,g){if(npe.apply(this,arguments),MS){if(MS){var x=CC;MS=!1,CC=null}else throw Error(Ir(198));OC||(OC=!0,$D=x)}}function wv(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function NZ(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function u8(e){if(wv(e)!==e)throw Error(Ir(188))}function ape(e){var t=e.alternate;if(!t){if(t=wv(e),t===null)throw Error(Ir(188));return t!==e?null:e}for(var r=e,n=t;;){var o=r.return;if(o===null)break;var l=o.alternate;if(l===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===l.child){for(l=o.child;l;){if(l===r)return u8(o),e;if(l===n)return u8(o),t;l=l.sibling}throw Error(Ir(188))}if(r.return!==n.return)r=o,n=l;else{for(var d=!1,i=o.child;i;){if(i===r){d=!0,r=o,n=l;break}if(i===n){d=!0,n=o,r=l;break}i=i.sibling}if(!d){for(i=l.child;i;){if(i===r){d=!0,r=l,n=o;break}if(i===n){d=!0,n=l,r=o;break}i=i.sibling}if(!d)throw Error(Ir(189))}}if(r.alternate!==n)throw Error(Ir(190))}if(r.tag!==3)throw Error(Ir(188));return r.stateNode.current===r?e:t}function MZ(e){return e=ape(e),e!==null?DZ(e):null}function DZ(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=DZ(e);if(t!==null)return t;e=e.sibling}return null}var LZ=Yc.unstable_scheduleCallback,d8=Yc.unstable_cancelCallback,ope=Yc.unstable_shouldYield,spe=Yc.unstable_requestPaint,Mo=Yc.unstable_now,lpe=Yc.unstable_getCurrentPriorityLevel,bz=Yc.unstable_ImmediatePriority,FZ=Yc.unstable_UserBlockingPriority,IC=Yc.unstable_NormalPriority,cpe=Yc.unstable_LowPriority,zZ=Yc.unstable_IdlePriority,MI=null,vh=null;function upe(e){if(vh&&typeof vh.onCommitFiberRoot=="function")try{vh.onCommitFiberRoot(MI,e,void 0,(e.current.flags&128)===128)}catch{}}var xd=Math.clz32?Math.clz32:fpe,dpe=Math.log,hpe=Math.LN2;function fpe(e){return e>>>=0,e===0?32:31-(dpe(e)/hpe|0)|0}var rP=64,nP=4194304;function ES(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function kC(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,o=e.suspendedLanes,l=e.pingedLanes,d=r&268435455;if(d!==0){var i=d&~o;i!==0?n=ES(i):(l&=d,l!==0&&(n=ES(l)))}else d=r&~o,d!==0?n=ES(d):l!==0&&(n=ES(l));if(n===0)return 0;if(t!==0&&t!==n&&!(t&o)&&(o=n&-n,l=t&-t,o>=l||o===16&&(l&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-xd(t),o=1<<r,n|=e[r],t&=~o;return n}function ppe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mpe(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,l=e.pendingLanes;0<l;){var d=31-xd(l),i=1<<d,g=o[d];g===-1?(!(i&r)||i&n)&&(o[d]=ppe(i,t)):g<=t&&(e.expiredLanes|=i),l&=~i}}function UD(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function BZ(){var e=rP;return rP<<=1,!(rP&4194240)&&(rP=64),e}function GN(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function bT(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-xd(t),e[t]=r}function gpe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var o=31-xd(r),l=1<<o;t[o]=0,n[o]=-1,e[o]=-1,r&=~l}}function wz(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-xd(r),o=1<<n;o&t|e[n]&t&&(e[n]|=t),r&=~o}}var ja=0;function $Z(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var UZ,Sz,VZ,qZ,WZ,VD=!1,iP=[],Tm=null,Am=null,Pm=null,aE=new Map,oE=new Map,tm=[],ype="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function h8(e,t){switch(e){case"focusin":case"focusout":Tm=null;break;case"dragenter":case"dragleave":Am=null;break;case"mouseover":case"mouseout":Pm=null;break;case"pointerover":case"pointerout":aE.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":oE.delete(t.pointerId)}}function Y1(e,t,r,n,o,l){return e===null||e.nativeEvent!==l?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:l,targetContainers:[o]},t!==null&&(t=ST(t),t!==null&&Sz(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function vpe(e,t,r,n,o){switch(t){case"focusin":return Tm=Y1(Tm,e,t,r,n,o),!0;case"dragenter":return Am=Y1(Am,e,t,r,n,o),!0;case"mouseover":return Pm=Y1(Pm,e,t,r,n,o),!0;case"pointerover":var l=o.pointerId;return aE.set(l,Y1(aE.get(l)||null,e,t,r,n,o)),!0;case"gotpointercapture":return l=o.pointerId,oE.set(l,Y1(oE.get(l)||null,e,t,r,n,o)),!0}return!1}function GZ(e){var t=Iy(e.target);if(t!==null){var r=wv(t);if(r!==null){if(t=r.tag,t===13){if(t=NZ(r),t!==null){e.blockedOn=t,WZ(e.priority,function(){VZ(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function YP(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=qD(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);FD=n,r.target.dispatchEvent(n),FD=null}else return t=ST(r),t!==null&&Sz(t),e.blockedOn=r,!1;t.shift()}return!0}function f8(e,t,r){YP(e)&&r.delete(t)}function _pe(){VD=!1,Tm!==null&&YP(Tm)&&(Tm=null),Am!==null&&YP(Am)&&(Am=null),Pm!==null&&YP(Pm)&&(Pm=null),aE.forEach(f8),oE.forEach(f8)}function J1(e,t){e.blockedOn===t&&(e.blockedOn=null,VD||(VD=!0,Yc.unstable_scheduleCallback(Yc.unstable_NormalPriority,_pe)))}function sE(e){function t(o){return J1(o,e)}if(0<iP.length){J1(iP[0],e);for(var r=1;r<iP.length;r++){var n=iP[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Tm!==null&&J1(Tm,e),Am!==null&&J1(Am,e),Pm!==null&&J1(Pm,e),aE.forEach(t),oE.forEach(t),r=0;r<tm.length;r++)n=tm[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<tm.length&&(r=tm[0],r.blockedOn===null);)GZ(r),r.blockedOn===null&&tm.shift()}var Kx=Bf.ReactCurrentBatchConfig,RC=!0;function xpe(e,t,r,n){var o=ja,l=Kx.transition;Kx.transition=null;try{ja=1,Ez(e,t,r,n)}finally{ja=o,Kx.transition=l}}function bpe(e,t,r,n){var o=ja,l=Kx.transition;Kx.transition=null;try{ja=4,Ez(e,t,r,n)}finally{ja=o,Kx.transition=l}}function Ez(e,t,r,n){if(RC){var o=qD(e,t,r,n);if(o===null)rM(e,t,n,jC,r),h8(e,n);else if(vpe(o,e,t,r,n))n.stopPropagation();else if(h8(e,n),t&4&&-1<ype.indexOf(e)){for(;o!==null;){var l=ST(o);if(l!==null&&UZ(l),l=qD(e,t,r,n),l===null&&rM(e,t,n,jC,r),l===o)break;o=l}o!==null&&n.stopPropagation()}else rM(e,t,n,null,r)}}var jC=null;function qD(e,t,r,n){if(jC=null,e=xz(n),e=Iy(e),e!==null)if(t=wv(e),t===null)e=null;else if(r=t.tag,r===13){if(e=NZ(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return jC=e,null}function HZ(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lpe()){case bz:return 1;case FZ:return 4;case IC:case cpe:return 16;case zZ:return 536870912;default:return 16}default:return 16}}var _m=null,Tz=null,JP=null;function KZ(){if(JP)return JP;var e,t=Tz,r=t.length,n,o="value"in _m?_m.value:_m.textContent,l=o.length;for(e=0;e<r&&t[e]===o[e];e++);var d=r-e;for(n=1;n<=d&&t[r-n]===o[l-n];n++);return JP=o.slice(e,1<n?1-n:void 0)}function QP(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function aP(){return!0}function p8(){return!1}function tu(e){function t(r,n,o,l,d){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=l,this.target=d,this.currentTarget=null;for(var i in e)e.hasOwnProperty(i)&&(r=e[i],this[i]=r?r(l):l[i]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?aP:p8,this.isPropagationStopped=p8,this}return xo(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=aP)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=aP)},persist:function(){},isPersistent:aP}),t}var yb={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Az=tu(yb),wT=xo({},yb,{view:0,detail:0}),wpe=tu(wT),HN,KN,Q1,DI=xo({},wT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Pz,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Q1&&(Q1&&e.type==="mousemove"?(HN=e.screenX-Q1.screenX,KN=e.screenY-Q1.screenY):KN=HN=0,Q1=e),HN)},movementY:function(e){return"movementY"in e?e.movementY:KN}}),m8=tu(DI),Spe=xo({},DI,{dataTransfer:0}),Epe=tu(Spe),Tpe=xo({},wT,{relatedTarget:0}),ZN=tu(Tpe),Ape=xo({},yb,{animationName:0,elapsedTime:0,pseudoElement:0}),Ppe=tu(Ape),Cpe=xo({},yb,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ope=tu(Cpe),Ipe=xo({},yb,{data:0}),g8=tu(Ipe),kpe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Rpe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jpe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Npe(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=jpe[e])?!!t[e]:!1}function Pz(){return Npe}var Mpe=xo({},wT,{key:function(e){if(e.key){var t=kpe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=QP(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Rpe[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Pz,charCode:function(e){return e.type==="keypress"?QP(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?QP(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Dpe=tu(Mpe),Lpe=xo({},DI,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),y8=tu(Lpe),Fpe=xo({},wT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Pz}),zpe=tu(Fpe),Bpe=xo({},yb,{propertyName:0,elapsedTime:0,pseudoElement:0}),$pe=tu(Bpe),Upe=xo({},DI,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Vpe=tu(Upe),qpe=[9,13,27,32],Cz=If&&"CompositionEvent"in window,DS=null;If&&"documentMode"in document&&(DS=document.documentMode);var Wpe=If&&"TextEvent"in window&&!DS,ZZ=If&&(!Cz||DS&&8<DS&&11>=DS),v8=" ",_8=!1;function XZ(e,t){switch(e){case"keyup":return qpe.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YZ(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ox=!1;function Gpe(e,t){switch(e){case"compositionend":return YZ(t);case"keypress":return t.which!==32?null:(_8=!0,v8);case"textInput":return e=t.data,e===v8&&_8?null:e;default:return null}}function Hpe(e,t){if(Ox)return e==="compositionend"||!Cz&&XZ(e,t)?(e=KZ(),JP=Tz=_m=null,Ox=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ZZ&&t.locale!=="ko"?null:t.data;default:return null}}var Kpe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x8(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Kpe[e.type]:t==="textarea"}function JZ(e,t,r,n){OZ(n),t=NC(t,"onChange"),0<t.length&&(r=new Az("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var LS=null,lE=null;function Zpe(e){cX(e,0)}function LI(e){var t=Rx(e);if(wZ(t))return e}function Xpe(e,t){if(e==="change")return t}var QZ=!1;if(If){var XN;if(If){var YN="oninput"in document;if(!YN){var b8=document.createElement("div");b8.setAttribute("oninput","return;"),YN=typeof b8.oninput=="function"}XN=YN}else XN=!1;QZ=XN&&(!document.documentMode||9<document.documentMode)}function w8(){LS&&(LS.detachEvent("onpropertychange",eX),lE=LS=null)}function eX(e){if(e.propertyName==="value"&&LI(lE)){var t=[];JZ(t,lE,e,xz(e)),jZ(Zpe,t)}}function Ype(e,t,r){e==="focusin"?(w8(),LS=t,lE=r,LS.attachEvent("onpropertychange",eX)):e==="focusout"&&w8()}function Jpe(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return LI(lE)}function Qpe(e,t){if(e==="click")return LI(t)}function eme(e,t){if(e==="input"||e==="change")return LI(t)}function tme(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Td=typeof Object.is=="function"?Object.is:tme;function cE(e,t){if(Td(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!AD.call(t,o)||!Td(e[o],t[o]))return!1}return!0}function S8(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function E8(e,t){var r=S8(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=S8(r)}}function tX(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?tX(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function rX(){for(var e=window,t=PC();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=PC(e.document)}return t}function Oz(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function rme(e){var t=rX(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&tX(r.ownerDocument.documentElement,r)){if(n!==null&&Oz(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var o=r.textContent.length,l=Math.min(n.start,o);n=n.end===void 0?l:Math.min(n.end,o),!e.extend&&l>n&&(o=n,n=l,l=o),o=E8(r,l);var d=E8(r,n);o&&d&&(e.rangeCount!==1||e.anchorNode!==o.node||e.anchorOffset!==o.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(o.node,o.offset),e.removeAllRanges(),l>n?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var nme=If&&"documentMode"in document&&11>=document.documentMode,Ix=null,WD=null,FS=null,GD=!1;function T8(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;GD||Ix==null||Ix!==PC(n)||(n=Ix,"selectionStart"in n&&Oz(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),FS&&cE(FS,n)||(FS=n,n=NC(WD,"onSelect"),0<n.length&&(t=new Az("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=Ix)))}function oP(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var kx={animationend:oP("Animation","AnimationEnd"),animationiteration:oP("Animation","AnimationIteration"),animationstart:oP("Animation","AnimationStart"),transitionend:oP("Transition","TransitionEnd")},JN={},nX={};If&&(nX=document.createElement("div").style,"AnimationEvent"in window||(delete kx.animationend.animation,delete kx.animationiteration.animation,delete kx.animationstart.animation),"TransitionEvent"in window||delete kx.transitionend.transition);function FI(e){if(JN[e])return JN[e];if(!kx[e])return e;var t=kx[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in nX)return JN[e]=t[r];return e}var iX=FI("animationend"),aX=FI("animationiteration"),oX=FI("animationstart"),sX=FI("transitionend"),lX=new Map,A8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xm(e,t){lX.set(e,t),bv(t,[e])}for(var QN=0;QN<A8.length;QN++){var eM=A8[QN],ime=eM.toLowerCase(),ame=eM[0].toUpperCase()+eM.slice(1);Xm(ime,"on"+ame)}Xm(iX,"onAnimationEnd");Xm(aX,"onAnimationIteration");Xm(oX,"onAnimationStart");Xm("dblclick","onDoubleClick");Xm("focusin","onFocus");Xm("focusout","onBlur");Xm(sX,"onTransitionEnd");b0("onMouseEnter",["mouseout","mouseover"]);b0("onMouseLeave",["mouseout","mouseover"]);b0("onPointerEnter",["pointerout","pointerover"]);b0("onPointerLeave",["pointerout","pointerover"]);bv("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bv("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bv("onBeforeInput",["compositionend","keypress","textInput","paste"]);bv("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bv("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bv("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var TS="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ome=new Set("cancel close invalid load scroll toggle".split(" ").concat(TS));function P8(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,ipe(n,t,void 0,e),e.currentTarget=null}function cX(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],o=n.event;n=n.listeners;e:{var l=void 0;if(t)for(var d=n.length-1;0<=d;d--){var i=n[d],g=i.instance,x=i.currentTarget;if(i=i.listener,g!==l&&o.isPropagationStopped())break e;P8(o,i,x),l=g}else for(d=0;d<n.length;d++){if(i=n[d],g=i.instance,x=i.currentTarget,i=i.listener,g!==l&&o.isPropagationStopped())break e;P8(o,i,x),l=g}}}if(OC)throw e=$D,OC=!1,$D=null,e}function ro(e,t){var r=t[YD];r===void 0&&(r=t[YD]=new Set);var n=e+"__bubble";r.has(n)||(uX(t,e,2,!1),r.add(n))}function tM(e,t,r){var n=0;t&&(n|=4),uX(r,e,n,t)}var sP="_reactListening"+Math.random().toString(36).slice(2);function uE(e){if(!e[sP]){e[sP]=!0,yZ.forEach(function(r){r!=="selectionchange"&&(ome.has(r)||tM(r,!1,e),tM(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[sP]||(t[sP]=!0,tM("selectionchange",!1,t))}}function uX(e,t,r,n){switch(HZ(t)){case 1:var o=xpe;break;case 4:o=bpe;break;default:o=Ez}r=o.bind(null,t,r,e),o=void 0,!BD||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,r,{capture:!0,passive:o}):e.addEventListener(t,r,!0):o!==void 0?e.addEventListener(t,r,{passive:o}):e.addEventListener(t,r,!1)}function rM(e,t,r,n,o){var l=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var d=n.tag;if(d===3||d===4){var i=n.stateNode.containerInfo;if(i===o||i.nodeType===8&&i.parentNode===o)break;if(d===4)for(d=n.return;d!==null;){var g=d.tag;if((g===3||g===4)&&(g=d.stateNode.containerInfo,g===o||g.nodeType===8&&g.parentNode===o))return;d=d.return}for(;i!==null;){if(d=Iy(i),d===null)return;if(g=d.tag,g===5||g===6){n=l=d;continue e}i=i.parentNode}}n=n.return}jZ(function(){var x=l,S=xz(r),E=[];e:{var A=lX.get(e);if(A!==void 0){var C=Az,N=e;switch(e){case"keypress":if(QP(r)===0)break e;case"keydown":case"keyup":C=Dpe;break;case"focusin":N="focus",C=ZN;break;case"focusout":N="blur",C=ZN;break;case"beforeblur":case"afterblur":C=ZN;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":C=m8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":C=Epe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":C=zpe;break;case iX:case aX:case oX:C=Ppe;break;case sX:C=$pe;break;case"scroll":C=wpe;break;case"wheel":C=Vpe;break;case"copy":case"cut":case"paste":C=Ope;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":C=y8}var k=(t&4)!==0,R=!k&&e==="scroll",L=k?A!==null?A+"Capture":null:A;k=[];for(var j=x,F;j!==null;){F=j;var B=F.stateNode;if(F.tag===5&&B!==null&&(F=B,L!==null&&(B=iE(j,L),B!=null&&k.push(dE(j,B,F)))),R)break;j=j.return}0<k.length&&(A=new C(A,N,null,r,S),E.push({event:A,listeners:k}))}}if(!(t&7)){e:{if(A=e==="mouseover"||e==="pointerover",C=e==="mouseout"||e==="pointerout",A&&r!==FD&&(N=r.relatedTarget||r.fromElement)&&(Iy(N)||N[kf]))break e;if((C||A)&&(A=S.window===S?S:(A=S.ownerDocument)?A.defaultView||A.parentWindow:window,C?(N=r.relatedTarget||r.toElement,C=x,N=N?Iy(N):null,N!==null&&(R=wv(N),N!==R||N.tag!==5&&N.tag!==6)&&(N=null)):(C=null,N=x),C!==N)){if(k=m8,B="onMouseLeave",L="onMouseEnter",j="mouse",(e==="pointerout"||e==="pointerover")&&(k=y8,B="onPointerLeave",L="onPointerEnter",j="pointer"),R=C==null?A:Rx(C),F=N==null?A:Rx(N),A=new k(B,j+"leave",C,r,S),A.target=R,A.relatedTarget=F,B=null,Iy(S)===x&&(k=new k(L,j+"enter",N,r,S),k.target=F,k.relatedTarget=R,B=k),R=B,C&&N)t:{for(k=C,L=N,j=0,F=k;F;F=lx(F))j++;for(F=0,B=L;B;B=lx(B))F++;for(;0<j-F;)k=lx(k),j--;for(;0<F-j;)L=lx(L),F--;for(;j--;){if(k===L||L!==null&&k===L.alternate)break t;k=lx(k),L=lx(L)}k=null}else k=null;C!==null&&C8(E,A,C,k,!1),N!==null&&R!==null&&C8(E,R,N,k,!0)}}e:{if(A=x?Rx(x):window,C=A.nodeName&&A.nodeName.toLowerCase(),C==="select"||C==="input"&&A.type==="file")var U=Xpe;else if(x8(A))if(QZ)U=eme;else{U=Jpe;var Z=Ype}else(C=A.nodeName)&&C.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(U=Qpe);if(U&&(U=U(e,x))){JZ(E,U,r,S);break e}Z&&Z(e,A,x),e==="focusout"&&(Z=A._wrapperState)&&Z.controlled&&A.type==="number"&&jD(A,"number",A.value)}switch(Z=x?Rx(x):window,e){case"focusin":(x8(Z)||Z.contentEditable==="true")&&(Ix=Z,WD=x,FS=null);break;case"focusout":FS=WD=Ix=null;break;case"mousedown":GD=!0;break;case"contextmenu":case"mouseup":case"dragend":GD=!1,T8(E,r,S);break;case"selectionchange":if(nme)break;case"keydown":case"keyup":T8(E,r,S)}var X;if(Cz)e:{switch(e){case"compositionstart":var te="onCompositionStart";break e;case"compositionend":te="onCompositionEnd";break e;case"compositionupdate":te="onCompositionUpdate";break e}te=void 0}else Ox?XZ(e,r)&&(te="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(te="onCompositionStart");te&&(ZZ&&r.locale!=="ko"&&(Ox||te!=="onCompositionStart"?te==="onCompositionEnd"&&Ox&&(X=KZ()):(_m=S,Tz="value"in _m?_m.value:_m.textContent,Ox=!0)),Z=NC(x,te),0<Z.length&&(te=new g8(te,e,null,r,S),E.push({event:te,listeners:Z}),X?te.data=X:(X=YZ(r),X!==null&&(te.data=X)))),(X=Wpe?Gpe(e,r):Hpe(e,r))&&(x=NC(x,"onBeforeInput"),0<x.length&&(S=new g8("onBeforeInput","beforeinput",null,r,S),E.push({event:S,listeners:x}),S.data=X))}cX(E,t)})}function dE(e,t,r){return{instance:e,listener:t,currentTarget:r}}function NC(e,t){for(var r=t+"Capture",n=[];e!==null;){var o=e,l=o.stateNode;o.tag===5&&l!==null&&(o=l,l=iE(e,r),l!=null&&n.unshift(dE(e,l,o)),l=iE(e,t),l!=null&&n.push(dE(e,l,o))),e=e.return}return n}function lx(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function C8(e,t,r,n,o){for(var l=t._reactName,d=[];r!==null&&r!==n;){var i=r,g=i.alternate,x=i.stateNode;if(g!==null&&g===n)break;i.tag===5&&x!==null&&(i=x,o?(g=iE(r,l),g!=null&&d.unshift(dE(r,g,i))):o||(g=iE(r,l),g!=null&&d.push(dE(r,g,i)))),r=r.return}d.length!==0&&e.push({event:t,listeners:d})}var sme=/\r\n?/g,lme=/\u0000|\uFFFD/g;function O8(e){return(typeof e=="string"?e:""+e).replace(sme,`
`).replace(lme,"")}function lP(e,t,r){if(t=O8(t),O8(e)!==t&&r)throw Error(Ir(425))}function MC(){}var HD=null,KD=null;function ZD(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var XD=typeof setTimeout=="function"?setTimeout:void 0,cme=typeof clearTimeout=="function"?clearTimeout:void 0,I8=typeof Promise=="function"?Promise:void 0,ume=typeof queueMicrotask=="function"?queueMicrotask:typeof I8<"u"?function(e){return I8.resolve(null).then(e).catch(dme)}:XD;function dme(e){setTimeout(function(){throw e})}function nM(e,t){var r=t,n=0;do{var o=r.nextSibling;if(e.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){e.removeChild(o),sE(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);sE(t)}function Cm(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function k8(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var vb=Math.random().toString(36).slice(2),lh="__reactFiber$"+vb,hE="__reactProps$"+vb,kf="__reactContainer$"+vb,YD="__reactEvents$"+vb,hme="__reactListeners$"+vb,fme="__reactHandles$"+vb;function Iy(e){var t=e[lh];if(t)return t;for(var r=e.parentNode;r;){if(t=r[kf]||r[lh]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=k8(e);e!==null;){if(r=e[lh])return r;e=k8(e)}return t}e=r,r=e.parentNode}return null}function ST(e){return e=e[lh]||e[kf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Rx(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ir(33))}function zI(e){return e[hE]||null}var JD=[],jx=-1;function Ym(e){return{current:e}}function ao(e){0>jx||(e.current=JD[jx],JD[jx]=null,jx--)}function Ka(e,t){jx++,JD[jx]=e.current,e.current=t}var Bm={},pl=Ym(Bm),_c=Ym(!1),ev=Bm;function w0(e,t){var r=e.type.contextTypes;if(!r)return Bm;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var o={},l;for(l in r)o[l]=t[l];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function xc(e){return e=e.childContextTypes,e!=null}function DC(){ao(_c),ao(pl)}function R8(e,t,r){if(pl.current!==Bm)throw Error(Ir(168));Ka(pl,t),Ka(_c,r)}function dX(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in t))throw Error(Ir(108,Yfe(e)||"Unknown",o));return xo({},r,n)}function LC(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Bm,ev=pl.current,Ka(pl,e),Ka(_c,_c.current),!0}function j8(e,t,r){var n=e.stateNode;if(!n)throw Error(Ir(169));r?(e=dX(e,t,ev),n.__reactInternalMemoizedMergedChildContext=e,ao(_c),ao(pl),Ka(pl,e)):ao(_c),Ka(_c,r)}var ff=null,BI=!1,iM=!1;function hX(e){ff===null?ff=[e]:ff.push(e)}function pme(e){BI=!0,hX(e)}function Jm(){if(!iM&&ff!==null){iM=!0;var e=0,t=ja;try{var r=ff;for(ja=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}ff=null,BI=!1}catch(o){throw ff!==null&&(ff=ff.slice(e+1)),LZ(bz,Jm),o}finally{ja=t,iM=!1}}return null}var Nx=[],Mx=0,FC=null,zC=0,mu=[],gu=0,tv=null,yf=1,vf="";function gy(e,t){Nx[Mx++]=zC,Nx[Mx++]=FC,FC=e,zC=t}function fX(e,t,r){mu[gu++]=yf,mu[gu++]=vf,mu[gu++]=tv,tv=e;var n=yf;e=vf;var o=32-xd(n)-1;n&=~(1<<o),r+=1;var l=32-xd(t)+o;if(30<l){var d=o-o%5;l=(n&(1<<d)-1).toString(32),n>>=d,o-=d,yf=1<<32-xd(t)+o|r<<o|n,vf=l+e}else yf=1<<l|r<<o|n,vf=e}function Iz(e){e.return!==null&&(gy(e,1),fX(e,1,0))}function kz(e){for(;e===FC;)FC=Nx[--Mx],Nx[Mx]=null,zC=Nx[--Mx],Nx[Mx]=null;for(;e===tv;)tv=mu[--gu],mu[gu]=null,vf=mu[--gu],mu[gu]=null,yf=mu[--gu],mu[gu]=null}var Gc=null,Wc=null,uo=!1,gd=null;function pX(e,t){var r=wu(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function N8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Gc=e,Wc=Cm(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Gc=e,Wc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=tv!==null?{id:yf,overflow:vf}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=wu(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Gc=e,Wc=null,!0):!1;default:return!1}}function QD(e){return(e.mode&1)!==0&&(e.flags&128)===0}function eL(e){if(uo){var t=Wc;if(t){var r=t;if(!N8(e,t)){if(QD(e))throw Error(Ir(418));t=Cm(r.nextSibling);var n=Gc;t&&N8(e,t)?pX(n,r):(e.flags=e.flags&-4097|2,uo=!1,Gc=e)}}else{if(QD(e))throw Error(Ir(418));e.flags=e.flags&-4097|2,uo=!1,Gc=e}}}function M8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Gc=e}function cP(e){if(e!==Gc)return!1;if(!uo)return M8(e),uo=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ZD(e.type,e.memoizedProps)),t&&(t=Wc)){if(QD(e))throw mX(),Error(Ir(418));for(;t;)pX(e,t),t=Cm(t.nextSibling)}if(M8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ir(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Wc=Cm(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Wc=null}}else Wc=Gc?Cm(e.stateNode.nextSibling):null;return!0}function mX(){for(var e=Wc;e;)e=Cm(e.nextSibling)}function S0(){Wc=Gc=null,uo=!1}function Rz(e){gd===null?gd=[e]:gd.push(e)}var mme=Bf.ReactCurrentBatchConfig;function eS(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ir(309));var n=r.stateNode}if(!n)throw Error(Ir(147,e));var o=n,l=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===l?t.ref:(t=function(d){var i=o.refs;d===null?delete i[l]:i[l]=d},t._stringRef=l,t)}if(typeof e!="string")throw Error(Ir(284));if(!r._owner)throw Error(Ir(290,e))}return e}function uP(e,t){throw e=Object.prototype.toString.call(t),Error(Ir(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function D8(e){var t=e._init;return t(e._payload)}function gX(e){function t(L,j){if(e){var F=L.deletions;F===null?(L.deletions=[j],L.flags|=16):F.push(j)}}function r(L,j){if(!e)return null;for(;j!==null;)t(L,j),j=j.sibling;return null}function n(L,j){for(L=new Map;j!==null;)j.key!==null?L.set(j.key,j):L.set(j.index,j),j=j.sibling;return L}function o(L,j){return L=Rm(L,j),L.index=0,L.sibling=null,L}function l(L,j,F){return L.index=F,e?(F=L.alternate,F!==null?(F=F.index,F<j?(L.flags|=2,j):F):(L.flags|=2,j)):(L.flags|=1048576,j)}function d(L){return e&&L.alternate===null&&(L.flags|=2),L}function i(L,j,F,B){return j===null||j.tag!==6?(j=dM(F,L.mode,B),j.return=L,j):(j=o(j,F),j.return=L,j)}function g(L,j,F,B){var U=F.type;return U===Cx?S(L,j,F.props.children,B,F.key):j!==null&&(j.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Yp&&D8(U)===j.type)?(B=o(j,F.props),B.ref=eS(L,j,F),B.return=L,B):(B=oC(F.type,F.key,F.props,null,L.mode,B),B.ref=eS(L,j,F),B.return=L,B)}function x(L,j,F,B){return j===null||j.tag!==4||j.stateNode.containerInfo!==F.containerInfo||j.stateNode.implementation!==F.implementation?(j=hM(F,L.mode,B),j.return=L,j):(j=o(j,F.children||[]),j.return=L,j)}function S(L,j,F,B,U){return j===null||j.tag!==7?(j=Xy(F,L.mode,B,U),j.return=L,j):(j=o(j,F),j.return=L,j)}function E(L,j,F){if(typeof j=="string"&&j!==""||typeof j=="number")return j=dM(""+j,L.mode,F),j.return=L,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case Q2:return F=oC(j.type,j.key,j.props,null,L.mode,F),F.ref=eS(L,null,j),F.return=L,F;case Px:return j=hM(j,L.mode,F),j.return=L,j;case Yp:var B=j._init;return E(L,B(j._payload),F)}if(SS(j)||Z1(j))return j=Xy(j,L.mode,F,null),j.return=L,j;uP(L,j)}return null}function A(L,j,F,B){var U=j!==null?j.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return U!==null?null:i(L,j,""+F,B);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case Q2:return F.key===U?g(L,j,F,B):null;case Px:return F.key===U?x(L,j,F,B):null;case Yp:return U=F._init,A(L,j,U(F._payload),B)}if(SS(F)||Z1(F))return U!==null?null:S(L,j,F,B,null);uP(L,F)}return null}function C(L,j,F,B,U){if(typeof B=="string"&&B!==""||typeof B=="number")return L=L.get(F)||null,i(j,L,""+B,U);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Q2:return L=L.get(B.key===null?F:B.key)||null,g(j,L,B,U);case Px:return L=L.get(B.key===null?F:B.key)||null,x(j,L,B,U);case Yp:var Z=B._init;return C(L,j,F,Z(B._payload),U)}if(SS(B)||Z1(B))return L=L.get(F)||null,S(j,L,B,U,null);uP(j,B)}return null}function N(L,j,F,B){for(var U=null,Z=null,X=j,te=j=0,se=null;X!==null&&te<F.length;te++){X.index>te?(se=X,X=null):se=X.sibling;var oe=A(L,X,F[te],B);if(oe===null){X===null&&(X=se);break}e&&X&&oe.alternate===null&&t(L,X),j=l(oe,j,te),Z===null?U=oe:Z.sibling=oe,Z=oe,X=se}if(te===F.length)return r(L,X),uo&&gy(L,te),U;if(X===null){for(;te<F.length;te++)X=E(L,F[te],B),X!==null&&(j=l(X,j,te),Z===null?U=X:Z.sibling=X,Z=X);return uo&&gy(L,te),U}for(X=n(L,X);te<F.length;te++)se=C(X,L,te,F[te],B),se!==null&&(e&&se.alternate!==null&&X.delete(se.key===null?te:se.key),j=l(se,j,te),Z===null?U=se:Z.sibling=se,Z=se);return e&&X.forEach(function(ne){return t(L,ne)}),uo&&gy(L,te),U}function k(L,j,F,B){var U=Z1(F);if(typeof U!="function")throw Error(Ir(150));if(F=U.call(F),F==null)throw Error(Ir(151));for(var Z=U=null,X=j,te=j=0,se=null,oe=F.next();X!==null&&!oe.done;te++,oe=F.next()){X.index>te?(se=X,X=null):se=X.sibling;var ne=A(L,X,oe.value,B);if(ne===null){X===null&&(X=se);break}e&&X&&ne.alternate===null&&t(L,X),j=l(ne,j,te),Z===null?U=ne:Z.sibling=ne,Z=ne,X=se}if(oe.done)return r(L,X),uo&&gy(L,te),U;if(X===null){for(;!oe.done;te++,oe=F.next())oe=E(L,oe.value,B),oe!==null&&(j=l(oe,j,te),Z===null?U=oe:Z.sibling=oe,Z=oe);return uo&&gy(L,te),U}for(X=n(L,X);!oe.done;te++,oe=F.next())oe=C(X,L,te,oe.value,B),oe!==null&&(e&&oe.alternate!==null&&X.delete(oe.key===null?te:oe.key),j=l(oe,j,te),Z===null?U=oe:Z.sibling=oe,Z=oe);return e&&X.forEach(function(ee){return t(L,ee)}),uo&&gy(L,te),U}function R(L,j,F,B){if(typeof F=="object"&&F!==null&&F.type===Cx&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case Q2:e:{for(var U=F.key,Z=j;Z!==null;){if(Z.key===U){if(U=F.type,U===Cx){if(Z.tag===7){r(L,Z.sibling),j=o(Z,F.props.children),j.return=L,L=j;break e}}else if(Z.elementType===U||typeof U=="object"&&U!==null&&U.$$typeof===Yp&&D8(U)===Z.type){r(L,Z.sibling),j=o(Z,F.props),j.ref=eS(L,Z,F),j.return=L,L=j;break e}r(L,Z);break}else t(L,Z);Z=Z.sibling}F.type===Cx?(j=Xy(F.props.children,L.mode,B,F.key),j.return=L,L=j):(B=oC(F.type,F.key,F.props,null,L.mode,B),B.ref=eS(L,j,F),B.return=L,L=B)}return d(L);case Px:e:{for(Z=F.key;j!==null;){if(j.key===Z)if(j.tag===4&&j.stateNode.containerInfo===F.containerInfo&&j.stateNode.implementation===F.implementation){r(L,j.sibling),j=o(j,F.children||[]),j.return=L,L=j;break e}else{r(L,j);break}else t(L,j);j=j.sibling}j=hM(F,L.mode,B),j.return=L,L=j}return d(L);case Yp:return Z=F._init,R(L,j,Z(F._payload),B)}if(SS(F))return N(L,j,F,B);if(Z1(F))return k(L,j,F,B);uP(L,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,j!==null&&j.tag===6?(r(L,j.sibling),j=o(j,F),j.return=L,L=j):(r(L,j),j=dM(F,L.mode,B),j.return=L,L=j),d(L)):r(L,j)}return R}var E0=gX(!0),yX=gX(!1),BC=Ym(null),$C=null,Dx=null,jz=null;function Nz(){jz=Dx=$C=null}function Mz(e){var t=BC.current;ao(BC),e._currentValue=t}function tL(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Zx(e,t){$C=e,jz=Dx=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(gc=!0),e.firstContext=null)}function Iu(e){var t=e._currentValue;if(jz!==e)if(e={context:e,memoizedValue:t,next:null},Dx===null){if($C===null)throw Error(Ir(308));Dx=e,$C.dependencies={lanes:0,firstContext:e}}else Dx=Dx.next=e;return t}var ky=null;function Dz(e){ky===null?ky=[e]:ky.push(e)}function vX(e,t,r,n){var o=t.interleaved;return o===null?(r.next=r,Dz(t)):(r.next=o.next,o.next=r),t.interleaved=r,Rf(e,n)}function Rf(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var Jp=!1;function Lz(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _X(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ef(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Om(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,ua&2){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,Rf(e,r)}return o=n.interleaved,o===null?(t.next=t,Dz(n)):(t.next=o.next,o.next=t),n.interleaved=t,Rf(e,r)}function eC(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,wz(e,r)}}function L8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,l=null;if(r=r.firstBaseUpdate,r!==null){do{var d={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};l===null?o=l=d:l=l.next=d,r=r.next}while(r!==null);l===null?o=l=t:l=l.next=t}else o=l=t;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:l,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function UC(e,t,r,n){var o=e.updateQueue;Jp=!1;var l=o.firstBaseUpdate,d=o.lastBaseUpdate,i=o.shared.pending;if(i!==null){o.shared.pending=null;var g=i,x=g.next;g.next=null,d===null?l=x:d.next=x,d=g;var S=e.alternate;S!==null&&(S=S.updateQueue,i=S.lastBaseUpdate,i!==d&&(i===null?S.firstBaseUpdate=x:i.next=x,S.lastBaseUpdate=g))}if(l!==null){var E=o.baseState;d=0,S=x=g=null,i=l;do{var A=i.lane,C=i.eventTime;if((n&A)===A){S!==null&&(S=S.next={eventTime:C,lane:0,tag:i.tag,payload:i.payload,callback:i.callback,next:null});e:{var N=e,k=i;switch(A=t,C=r,k.tag){case 1:if(N=k.payload,typeof N=="function"){E=N.call(C,E,A);break e}E=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=k.payload,A=typeof N=="function"?N.call(C,E,A):N,A==null)break e;E=xo({},E,A);break e;case 2:Jp=!0}}i.callback!==null&&i.lane!==0&&(e.flags|=64,A=o.effects,A===null?o.effects=[i]:A.push(i))}else C={eventTime:C,lane:A,tag:i.tag,payload:i.payload,callback:i.callback,next:null},S===null?(x=S=C,g=E):S=S.next=C,d|=A;if(i=i.next,i===null){if(i=o.shared.pending,i===null)break;A=i,i=A.next,A.next=null,o.lastBaseUpdate=A,o.shared.pending=null}}while(!0);if(S===null&&(g=E),o.baseState=g,o.firstBaseUpdate=x,o.lastBaseUpdate=S,t=o.shared.interleaved,t!==null){o=t;do d|=o.lane,o=o.next;while(o!==t)}else l===null&&(o.shared.lanes=0);nv|=d,e.lanes=d,e.memoizedState=E}}function F8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(Ir(191,o));o.call(n)}}}var ET={},_h=Ym(ET),fE=Ym(ET),pE=Ym(ET);function Ry(e){if(e===ET)throw Error(Ir(174));return e}function Fz(e,t){switch(Ka(pE,t),Ka(fE,e),Ka(_h,ET),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:MD(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=MD(t,e)}ao(_h),Ka(_h,t)}function T0(){ao(_h),ao(fE),ao(pE)}function xX(e){Ry(pE.current);var t=Ry(_h.current),r=MD(t,e.type);t!==r&&(Ka(fE,e),Ka(_h,r))}function zz(e){fE.current===e&&(ao(_h),ao(fE))}var vo=Ym(0);function VC(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var aM=[];function Bz(){for(var e=0;e<aM.length;e++)aM[e]._workInProgressVersionPrimary=null;aM.length=0}var tC=Bf.ReactCurrentDispatcher,oM=Bf.ReactCurrentBatchConfig,rv=0,_o=null,hs=null,As=null,qC=!1,zS=!1,mE=0,gme=0;function rl(){throw Error(Ir(321))}function $z(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Td(e[r],t[r]))return!1;return!0}function Uz(e,t,r,n,o,l){if(rv=l,_o=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,tC.current=e===null||e.memoizedState===null?xme:bme,e=r(n,o),zS){l=0;do{if(zS=!1,mE=0,25<=l)throw Error(Ir(301));l+=1,As=hs=null,t.updateQueue=null,tC.current=wme,e=r(n,o)}while(zS)}if(tC.current=WC,t=hs!==null&&hs.next!==null,rv=0,As=hs=_o=null,qC=!1,t)throw Error(Ir(300));return e}function Vz(){var e=mE!==0;return mE=0,e}function nh(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return As===null?_o.memoizedState=As=e:As=As.next=e,As}function ku(){if(hs===null){var e=_o.alternate;e=e!==null?e.memoizedState:null}else e=hs.next;var t=As===null?_o.memoizedState:As.next;if(t!==null)As=t,hs=e;else{if(e===null)throw Error(Ir(310));hs=e,e={memoizedState:hs.memoizedState,baseState:hs.baseState,baseQueue:hs.baseQueue,queue:hs.queue,next:null},As===null?_o.memoizedState=As=e:As=As.next=e}return As}function gE(e,t){return typeof t=="function"?t(e):t}function sM(e){var t=ku(),r=t.queue;if(r===null)throw Error(Ir(311));r.lastRenderedReducer=e;var n=hs,o=n.baseQueue,l=r.pending;if(l!==null){if(o!==null){var d=o.next;o.next=l.next,l.next=d}n.baseQueue=o=l,r.pending=null}if(o!==null){l=o.next,n=n.baseState;var i=d=null,g=null,x=l;do{var S=x.lane;if((rv&S)===S)g!==null&&(g=g.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),n=x.hasEagerState?x.eagerState:e(n,x.action);else{var E={lane:S,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};g===null?(i=g=E,d=n):g=g.next=E,_o.lanes|=S,nv|=S}x=x.next}while(x!==null&&x!==l);g===null?d=n:g.next=i,Td(n,t.memoizedState)||(gc=!0),t.memoizedState=n,t.baseState=d,t.baseQueue=g,r.lastRenderedState=n}if(e=r.interleaved,e!==null){o=e;do l=o.lane,_o.lanes|=l,nv|=l,o=o.next;while(o!==e)}else o===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function lM(e){var t=ku(),r=t.queue;if(r===null)throw Error(Ir(311));r.lastRenderedReducer=e;var n=r.dispatch,o=r.pending,l=t.memoizedState;if(o!==null){r.pending=null;var d=o=o.next;do l=e(l,d.action),d=d.next;while(d!==o);Td(l,t.memoizedState)||(gc=!0),t.memoizedState=l,t.baseQueue===null&&(t.baseState=l),r.lastRenderedState=l}return[l,n]}function bX(){}function wX(e,t){var r=_o,n=ku(),o=t(),l=!Td(n.memoizedState,o);if(l&&(n.memoizedState=o,gc=!0),n=n.queue,qz(TX.bind(null,r,n,e),[e]),n.getSnapshot!==t||l||As!==null&&As.memoizedState.tag&1){if(r.flags|=2048,yE(9,EX.bind(null,r,n,o,t),void 0,null),Os===null)throw Error(Ir(349));rv&30||SX(r,t,o)}return o}function SX(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=_o.updateQueue,t===null?(t={lastEffect:null,stores:null},_o.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function EX(e,t,r,n){t.value=r,t.getSnapshot=n,AX(t)&&PX(e)}function TX(e,t,r){return r(function(){AX(t)&&PX(e)})}function AX(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Td(e,r)}catch{return!0}}function PX(e){var t=Rf(e,1);t!==null&&bd(t,e,1,-1)}function z8(e){var t=nh();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gE,lastRenderedState:e},t.queue=e,e=e.dispatch=_me.bind(null,_o,e),[t.memoizedState,e]}function yE(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=_o.updateQueue,t===null?(t={lastEffect:null,stores:null},_o.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function CX(){return ku().memoizedState}function rC(e,t,r,n){var o=nh();_o.flags|=e,o.memoizedState=yE(1|t,r,void 0,n===void 0?null:n)}function $I(e,t,r,n){var o=ku();n=n===void 0?null:n;var l=void 0;if(hs!==null){var d=hs.memoizedState;if(l=d.destroy,n!==null&&$z(n,d.deps)){o.memoizedState=yE(t,r,l,n);return}}_o.flags|=e,o.memoizedState=yE(1|t,r,l,n)}function B8(e,t){return rC(8390656,8,e,t)}function qz(e,t){return $I(2048,8,e,t)}function OX(e,t){return $I(4,2,e,t)}function IX(e,t){return $I(4,4,e,t)}function kX(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function RX(e,t,r){return r=r!=null?r.concat([e]):null,$I(4,4,kX.bind(null,t,e),r)}function Wz(){}function jX(e,t){var r=ku();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&$z(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function NX(e,t){var r=ku();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&$z(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function MX(e,t,r){return rv&21?(Td(r,t)||(r=BZ(),_o.lanes|=r,nv|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,gc=!0),e.memoizedState=r)}function yme(e,t){var r=ja;ja=r!==0&&4>r?r:4,e(!0);var n=oM.transition;oM.transition={};try{e(!1),t()}finally{ja=r,oM.transition=n}}function DX(){return ku().memoizedState}function vme(e,t,r){var n=km(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},LX(e))FX(t,r);else if(r=vX(e,t,r,n),r!==null){var o=Wl();bd(r,e,n,o),zX(r,t,n)}}function _me(e,t,r){var n=km(e),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(LX(e))FX(t,o);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=t.lastRenderedReducer,l!==null))try{var d=t.lastRenderedState,i=l(d,r);if(o.hasEagerState=!0,o.eagerState=i,Td(i,d)){var g=t.interleaved;g===null?(o.next=o,Dz(t)):(o.next=g.next,g.next=o),t.interleaved=o;return}}catch{}finally{}r=vX(e,t,o,n),r!==null&&(o=Wl(),bd(r,e,n,o),zX(r,t,n))}}function LX(e){var t=e.alternate;return e===_o||t!==null&&t===_o}function FX(e,t){zS=qC=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function zX(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,wz(e,r)}}var WC={readContext:Iu,useCallback:rl,useContext:rl,useEffect:rl,useImperativeHandle:rl,useInsertionEffect:rl,useLayoutEffect:rl,useMemo:rl,useReducer:rl,useRef:rl,useState:rl,useDebugValue:rl,useDeferredValue:rl,useTransition:rl,useMutableSource:rl,useSyncExternalStore:rl,useId:rl,unstable_isNewReconciler:!1},xme={readContext:Iu,useCallback:function(e,t){return nh().memoizedState=[e,t===void 0?null:t],e},useContext:Iu,useEffect:B8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,rC(4194308,4,kX.bind(null,t,e),r)},useLayoutEffect:function(e,t){return rC(4194308,4,e,t)},useInsertionEffect:function(e,t){return rC(4,2,e,t)},useMemo:function(e,t){var r=nh();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=nh();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=vme.bind(null,_o,e),[n.memoizedState,e]},useRef:function(e){var t=nh();return e={current:e},t.memoizedState=e},useState:z8,useDebugValue:Wz,useDeferredValue:function(e){return nh().memoizedState=e},useTransition:function(){var e=z8(!1),t=e[0];return e=yme.bind(null,e[1]),nh().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=_o,o=nh();if(uo){if(r===void 0)throw Error(Ir(407));r=r()}else{if(r=t(),Os===null)throw Error(Ir(349));rv&30||SX(n,t,r)}o.memoizedState=r;var l={value:r,getSnapshot:t};return o.queue=l,B8(TX.bind(null,n,l,e),[e]),n.flags|=2048,yE(9,EX.bind(null,n,l,r,t),void 0,null),r},useId:function(){var e=nh(),t=Os.identifierPrefix;if(uo){var r=vf,n=yf;r=(n&~(1<<32-xd(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=mE++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=gme++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},bme={readContext:Iu,useCallback:jX,useContext:Iu,useEffect:qz,useImperativeHandle:RX,useInsertionEffect:OX,useLayoutEffect:IX,useMemo:NX,useReducer:sM,useRef:CX,useState:function(){return sM(gE)},useDebugValue:Wz,useDeferredValue:function(e){var t=ku();return MX(t,hs.memoizedState,e)},useTransition:function(){var e=sM(gE)[0],t=ku().memoizedState;return[e,t]},useMutableSource:bX,useSyncExternalStore:wX,useId:DX,unstable_isNewReconciler:!1},wme={readContext:Iu,useCallback:jX,useContext:Iu,useEffect:qz,useImperativeHandle:RX,useInsertionEffect:OX,useLayoutEffect:IX,useMemo:NX,useReducer:lM,useRef:CX,useState:function(){return lM(gE)},useDebugValue:Wz,useDeferredValue:function(e){var t=ku();return hs===null?t.memoizedState=e:MX(t,hs.memoizedState,e)},useTransition:function(){var e=lM(gE)[0],t=ku().memoizedState;return[e,t]},useMutableSource:bX,useSyncExternalStore:wX,useId:DX,unstable_isNewReconciler:!1};function ld(e,t){if(e&&e.defaultProps){t=xo({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function rL(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:xo({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var UI={isMounted:function(e){return(e=e._reactInternals)?wv(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Wl(),o=km(e),l=Ef(n,o);l.payload=t,r!=null&&(l.callback=r),t=Om(e,l,o),t!==null&&(bd(t,e,o,n),eC(t,e,o))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Wl(),o=km(e),l=Ef(n,o);l.tag=1,l.payload=t,r!=null&&(l.callback=r),t=Om(e,l,o),t!==null&&(bd(t,e,o,n),eC(t,e,o))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Wl(),n=km(e),o=Ef(r,n);o.tag=2,t!=null&&(o.callback=t),t=Om(e,o,n),t!==null&&(bd(t,e,n,r),eC(t,e,n))}};function $8(e,t,r,n,o,l,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,l,d):t.prototype&&t.prototype.isPureReactComponent?!cE(r,n)||!cE(o,l):!0}function BX(e,t,r){var n=!1,o=Bm,l=t.contextType;return typeof l=="object"&&l!==null?l=Iu(l):(o=xc(t)?ev:pl.current,n=t.contextTypes,l=(n=n!=null)?w0(e,o):Bm),t=new t(r,l),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=UI,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=o,e.__reactInternalMemoizedMaskedChildContext=l),t}function U8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&UI.enqueueReplaceState(t,t.state,null)}function nL(e,t,r,n){var o=e.stateNode;o.props=r,o.state=e.memoizedState,o.refs={},Lz(e);var l=t.contextType;typeof l=="object"&&l!==null?o.context=Iu(l):(l=xc(t)?ev:pl.current,o.context=w0(e,l)),o.state=e.memoizedState,l=t.getDerivedStateFromProps,typeof l=="function"&&(rL(e,t,l,r),o.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(t=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),t!==o.state&&UI.enqueueReplaceState(o,o.state,null),UC(e,r,o,n),o.state=e.memoizedState),typeof o.componentDidMount=="function"&&(e.flags|=4194308)}function A0(e,t){try{var r="",n=t;do r+=Xfe(n),n=n.return;while(n);var o=r}catch(l){o=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:t,stack:o,digest:null}}function cM(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function iL(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Sme=typeof WeakMap=="function"?WeakMap:Map;function $X(e,t,r){r=Ef(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){HC||(HC=!0,pL=n),iL(e,t)},r}function UX(e,t,r){r=Ef(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var o=t.value;r.payload=function(){return n(o)},r.callback=function(){iL(e,t)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(r.callback=function(){iL(e,t),typeof n!="function"&&(Im===null?Im=new Set([this]):Im.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),r}function V8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new Sme;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(r)||(o.add(r),e=Lme.bind(null,e,t,r),t.then(e,e))}function q8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function W8(e,t,r,n,o){return e.mode&1?(e.flags|=65536,e.lanes=o,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ef(-1,1),t.tag=2,Om(r,t,1))),r.lanes|=1),e)}var Eme=Bf.ReactCurrentOwner,gc=!1;function Ml(e,t,r,n){t.child=e===null?yX(t,null,r,n):E0(t,e.child,r,n)}function G8(e,t,r,n,o){r=r.render;var l=t.ref;return Zx(t,o),n=Uz(e,t,r,n,l,o),r=Vz(),e!==null&&!gc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,jf(e,t,o)):(uo&&r&&Iz(t),t.flags|=1,Ml(e,t,n,o),t.child)}function H8(e,t,r,n,o){if(e===null){var l=r.type;return typeof l=="function"&&!Qz(l)&&l.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=l,VX(e,t,l,n,o)):(e=oC(r.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(l=e.child,!(e.lanes&o)){var d=l.memoizedProps;if(r=r.compare,r=r!==null?r:cE,r(d,n)&&e.ref===t.ref)return jf(e,t,o)}return t.flags|=1,e=Rm(l,n),e.ref=t.ref,e.return=t,t.child=e}function VX(e,t,r,n,o){if(e!==null){var l=e.memoizedProps;if(cE(l,n)&&e.ref===t.ref)if(gc=!1,t.pendingProps=n=l,(e.lanes&o)!==0)e.flags&131072&&(gc=!0);else return t.lanes=e.lanes,jf(e,t,o)}return aL(e,t,r,n,o)}function qX(e,t,r){var n=t.pendingProps,o=n.children,l=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ka(Fx,Dc),Dc|=r;else{if(!(r&1073741824))return e=l!==null?l.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ka(Fx,Dc),Dc|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=l!==null?l.baseLanes:r,Ka(Fx,Dc),Dc|=n}else l!==null?(n=l.baseLanes|r,t.memoizedState=null):n=r,Ka(Fx,Dc),Dc|=n;return Ml(e,t,o,r),t.child}function WX(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function aL(e,t,r,n,o){var l=xc(r)?ev:pl.current;return l=w0(t,l),Zx(t,o),r=Uz(e,t,r,n,l,o),n=Vz(),e!==null&&!gc?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~o,jf(e,t,o)):(uo&&n&&Iz(t),t.flags|=1,Ml(e,t,r,o),t.child)}function K8(e,t,r,n,o){if(xc(r)){var l=!0;LC(t)}else l=!1;if(Zx(t,o),t.stateNode===null)nC(e,t),BX(t,r,n),nL(t,r,n,o),n=!0;else if(e===null){var d=t.stateNode,i=t.memoizedProps;d.props=i;var g=d.context,x=r.contextType;typeof x=="object"&&x!==null?x=Iu(x):(x=xc(r)?ev:pl.current,x=w0(t,x));var S=r.getDerivedStateFromProps,E=typeof S=="function"||typeof d.getSnapshotBeforeUpdate=="function";E||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==n||g!==x)&&U8(t,d,n,x),Jp=!1;var A=t.memoizedState;d.state=A,UC(t,n,d,o),g=t.memoizedState,i!==n||A!==g||_c.current||Jp?(typeof S=="function"&&(rL(t,r,S,n),g=t.memoizedState),(i=Jp||$8(t,r,i,n,A,g,x))?(E||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=g),d.props=n,d.state=g,d.context=x,n=i):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{d=t.stateNode,_X(e,t),i=t.memoizedProps,x=t.type===t.elementType?i:ld(t.type,i),d.props=x,E=t.pendingProps,A=d.context,g=r.contextType,typeof g=="object"&&g!==null?g=Iu(g):(g=xc(r)?ev:pl.current,g=w0(t,g));var C=r.getDerivedStateFromProps;(S=typeof C=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(i!==E||A!==g)&&U8(t,d,n,g),Jp=!1,A=t.memoizedState,d.state=A,UC(t,n,d,o);var N=t.memoizedState;i!==E||A!==N||_c.current||Jp?(typeof C=="function"&&(rL(t,r,C,n),N=t.memoizedState),(x=Jp||$8(t,r,x,n,A,N,g)||!1)?(S||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(n,N,g),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(n,N,g)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=N),d.props=n,d.state=N,d.context=g,n=x):(typeof d.componentDidUpdate!="function"||i===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||i===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),n=!1)}return oL(e,t,r,n,l,o)}function oL(e,t,r,n,o,l){WX(e,t);var d=(t.flags&128)!==0;if(!n&&!d)return o&&j8(t,r,!1),jf(e,t,l);n=t.stateNode,Eme.current=t;var i=d&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&d?(t.child=E0(t,e.child,null,l),t.child=E0(t,null,i,l)):Ml(e,t,i,l),t.memoizedState=n.state,o&&j8(t,r,!0),t.child}function GX(e){var t=e.stateNode;t.pendingContext?R8(e,t.pendingContext,t.pendingContext!==t.context):t.context&&R8(e,t.context,!1),Fz(e,t.containerInfo)}function Z8(e,t,r,n,o){return S0(),Rz(o),t.flags|=256,Ml(e,t,r,n),t.child}var sL={dehydrated:null,treeContext:null,retryLane:0};function lL(e){return{baseLanes:e,cachePool:null,transitions:null}}function HX(e,t,r){var n=t.pendingProps,o=vo.current,l=!1,d=(t.flags&128)!==0,i;if((i=d)||(i=e!==null&&e.memoizedState===null?!1:(o&2)!==0),i?(l=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(o|=1),Ka(vo,o&1),e===null)return eL(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=n.children,e=n.fallback,l?(n=t.mode,l=t.child,d={mode:"hidden",children:d},!(n&1)&&l!==null?(l.childLanes=0,l.pendingProps=d):l=WI(d,n,0,null),e=Xy(e,n,r,null),l.return=t,e.return=t,l.sibling=e,t.child=l,t.child.memoizedState=lL(r),t.memoizedState=sL,e):Gz(t,d));if(o=e.memoizedState,o!==null&&(i=o.dehydrated,i!==null))return Tme(e,t,d,n,i,o,r);if(l){l=n.fallback,d=t.mode,o=e.child,i=o.sibling;var g={mode:"hidden",children:n.children};return!(d&1)&&t.child!==o?(n=t.child,n.childLanes=0,n.pendingProps=g,t.deletions=null):(n=Rm(o,g),n.subtreeFlags=o.subtreeFlags&14680064),i!==null?l=Rm(i,l):(l=Xy(l,d,r,null),l.flags|=2),l.return=t,n.return=t,n.sibling=l,t.child=n,n=l,l=t.child,d=e.child.memoizedState,d=d===null?lL(r):{baseLanes:d.baseLanes|r,cachePool:null,transitions:d.transitions},l.memoizedState=d,l.childLanes=e.childLanes&~r,t.memoizedState=sL,n}return l=e.child,e=l.sibling,n=Rm(l,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Gz(e,t){return t=WI({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function dP(e,t,r,n){return n!==null&&Rz(n),E0(t,e.child,null,r),e=Gz(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Tme(e,t,r,n,o,l,d){if(r)return t.flags&256?(t.flags&=-257,n=cM(Error(Ir(422))),dP(e,t,d,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(l=n.fallback,o=t.mode,n=WI({mode:"visible",children:n.children},o,0,null),l=Xy(l,o,d,null),l.flags|=2,n.return=t,l.return=t,n.sibling=l,t.child=n,t.mode&1&&E0(t,e.child,null,d),t.child.memoizedState=lL(d),t.memoizedState=sL,l);if(!(t.mode&1))return dP(e,t,d,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var i=n.dgst;return n=i,l=Error(Ir(419)),n=cM(l,n,void 0),dP(e,t,d,n)}if(i=(d&e.childLanes)!==0,gc||i){if(n=Os,n!==null){switch(d&-d){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(n.suspendedLanes|d)?0:o,o!==0&&o!==l.retryLane&&(l.retryLane=o,Rf(e,o),bd(n,e,o,-1))}return Jz(),n=cM(Error(Ir(421))),dP(e,t,d,n)}return o.data==="$?"?(t.flags|=128,t.child=e.child,t=Fme.bind(null,e),o._reactRetry=t,null):(e=l.treeContext,Wc=Cm(o.nextSibling),Gc=t,uo=!0,gd=null,e!==null&&(mu[gu++]=yf,mu[gu++]=vf,mu[gu++]=tv,yf=e.id,vf=e.overflow,tv=t),t=Gz(t,n.children),t.flags|=4096,t)}function X8(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),tL(e.return,t,r)}function uM(e,t,r,n,o){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(l.isBackwards=t,l.rendering=null,l.renderingStartTime=0,l.last=n,l.tail=r,l.tailMode=o)}function KX(e,t,r){var n=t.pendingProps,o=n.revealOrder,l=n.tail;if(Ml(e,t,n.children,r),n=vo.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&X8(e,r,t);else if(e.tag===19)X8(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ka(vo,n),!(t.mode&1))t.memoizedState=null;else switch(o){case"forwards":for(r=t.child,o=null;r!==null;)e=r.alternate,e!==null&&VC(e)===null&&(o=r),r=r.sibling;r=o,r===null?(o=t.child,t.child=null):(o=r.sibling,r.sibling=null),uM(t,!1,o,r,l);break;case"backwards":for(r=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&VC(e)===null){t.child=o;break}e=o.sibling,o.sibling=r,r=o,o=e}uM(t,!0,r,null,l);break;case"together":uM(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function nC(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function jf(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),nv|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ir(153));if(t.child!==null){for(e=t.child,r=Rm(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Rm(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Ame(e,t,r){switch(t.tag){case 3:GX(t),S0();break;case 5:xX(t);break;case 1:xc(t.type)&&LC(t);break;case 4:Fz(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,o=t.memoizedProps.value;Ka(BC,n._currentValue),n._currentValue=o;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Ka(vo,vo.current&1),t.flags|=128,null):r&t.child.childLanes?HX(e,t,r):(Ka(vo,vo.current&1),e=jf(e,t,r),e!==null?e.sibling:null);Ka(vo,vo.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return KX(e,t,r);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Ka(vo,vo.current),n)break;return null;case 22:case 23:return t.lanes=0,qX(e,t,r)}return jf(e,t,r)}var ZX,cL,XX,YX;ZX=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};cL=function(){};XX=function(e,t,r,n){var o=e.memoizedProps;if(o!==n){e=t.stateNode,Ry(_h.current);var l=null;switch(r){case"input":o=kD(e,o),n=kD(e,n),l=[];break;case"select":o=xo({},o,{value:void 0}),n=xo({},n,{value:void 0}),l=[];break;case"textarea":o=ND(e,o),n=ND(e,n),l=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=MC)}DD(r,n);var d;r=null;for(x in o)if(!n.hasOwnProperty(x)&&o.hasOwnProperty(x)&&o[x]!=null)if(x==="style"){var i=o[x];for(d in i)i.hasOwnProperty(d)&&(r||(r={}),r[d]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(rE.hasOwnProperty(x)?l||(l=[]):(l=l||[]).push(x,null));for(x in n){var g=n[x];if(i=o!=null?o[x]:void 0,n.hasOwnProperty(x)&&g!==i&&(g!=null||i!=null))if(x==="style")if(i){for(d in i)!i.hasOwnProperty(d)||g&&g.hasOwnProperty(d)||(r||(r={}),r[d]="");for(d in g)g.hasOwnProperty(d)&&i[d]!==g[d]&&(r||(r={}),r[d]=g[d])}else r||(l||(l=[]),l.push(x,r)),r=g;else x==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,i=i?i.__html:void 0,g!=null&&i!==g&&(l=l||[]).push(x,g)):x==="children"?typeof g!="string"&&typeof g!="number"||(l=l||[]).push(x,""+g):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(rE.hasOwnProperty(x)?(g!=null&&x==="onScroll"&&ro("scroll",e),l||i===g||(l=[])):(l=l||[]).push(x,g))}r&&(l=l||[]).push("style",r);var x=l;(t.updateQueue=x)&&(t.flags|=4)}};YX=function(e,t,r,n){r!==n&&(t.flags|=4)};function tS(e,t){if(!uo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function nl(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Pme(e,t,r){var n=t.pendingProps;switch(kz(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nl(t),null;case 1:return xc(t.type)&&DC(),nl(t),null;case 3:return n=t.stateNode,T0(),ao(_c),ao(pl),Bz(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(cP(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,gd!==null&&(yL(gd),gd=null))),cL(e,t),nl(t),null;case 5:zz(t);var o=Ry(pE.current);if(r=t.type,e!==null&&t.stateNode!=null)XX(e,t,r,n,o),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Ir(166));return nl(t),null}if(e=Ry(_h.current),cP(t)){n=t.stateNode,r=t.type;var l=t.memoizedProps;switch(n[lh]=t,n[hE]=l,e=(t.mode&1)!==0,r){case"dialog":ro("cancel",n),ro("close",n);break;case"iframe":case"object":case"embed":ro("load",n);break;case"video":case"audio":for(o=0;o<TS.length;o++)ro(TS[o],n);break;case"source":ro("error",n);break;case"img":case"image":case"link":ro("error",n),ro("load",n);break;case"details":ro("toggle",n);break;case"input":a8(n,l),ro("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!l.multiple},ro("invalid",n);break;case"textarea":s8(n,l),ro("invalid",n)}DD(r,l),o=null;for(var d in l)if(l.hasOwnProperty(d)){var i=l[d];d==="children"?typeof i=="string"?n.textContent!==i&&(l.suppressHydrationWarning!==!0&&lP(n.textContent,i,e),o=["children",i]):typeof i=="number"&&n.textContent!==""+i&&(l.suppressHydrationWarning!==!0&&lP(n.textContent,i,e),o=["children",""+i]):rE.hasOwnProperty(d)&&i!=null&&d==="onScroll"&&ro("scroll",n)}switch(r){case"input":eP(n),o8(n,l,!0);break;case"textarea":eP(n),l8(n);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(n.onclick=MC)}n=o,t.updateQueue=n,n!==null&&(t.flags|=4)}else{d=o.nodeType===9?o:o.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=TZ(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=d.createElement(r,{is:n.is}):(e=d.createElement(r),r==="select"&&(d=e,n.multiple?d.multiple=!0:n.size&&(d.size=n.size))):e=d.createElementNS(e,r),e[lh]=t,e[hE]=n,ZX(e,t,!1,!1),t.stateNode=e;e:{switch(d=LD(r,n),r){case"dialog":ro("cancel",e),ro("close",e),o=n;break;case"iframe":case"object":case"embed":ro("load",e),o=n;break;case"video":case"audio":for(o=0;o<TS.length;o++)ro(TS[o],e);o=n;break;case"source":ro("error",e),o=n;break;case"img":case"image":case"link":ro("error",e),ro("load",e),o=n;break;case"details":ro("toggle",e),o=n;break;case"input":a8(e,n),o=kD(e,n),ro("invalid",e);break;case"option":o=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},o=xo({},n,{value:void 0}),ro("invalid",e);break;case"textarea":s8(e,n),o=ND(e,n),ro("invalid",e);break;default:o=n}DD(r,o),i=o;for(l in i)if(i.hasOwnProperty(l)){var g=i[l];l==="style"?CZ(e,g):l==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,g!=null&&AZ(e,g)):l==="children"?typeof g=="string"?(r!=="textarea"||g!=="")&&nE(e,g):typeof g=="number"&&nE(e,""+g):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(rE.hasOwnProperty(l)?g!=null&&l==="onScroll"&&ro("scroll",e):g!=null&&gz(e,l,g,d))}switch(r){case"input":eP(e),o8(e,n,!1);break;case"textarea":eP(e),l8(e);break;case"option":n.value!=null&&e.setAttribute("value",""+zm(n.value));break;case"select":e.multiple=!!n.multiple,l=n.value,l!=null?Wx(e,!!n.multiple,l,!1):n.defaultValue!=null&&Wx(e,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(e.onclick=MC)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return nl(t),null;case 6:if(e&&t.stateNode!=null)YX(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Ir(166));if(r=Ry(pE.current),Ry(_h.current),cP(t)){if(n=t.stateNode,r=t.memoizedProps,n[lh]=t,(l=n.nodeValue!==r)&&(e=Gc,e!==null))switch(e.tag){case 3:lP(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&lP(n.nodeValue,r,(e.mode&1)!==0)}l&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[lh]=t,t.stateNode=n}return nl(t),null;case 13:if(ao(vo),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(uo&&Wc!==null&&t.mode&1&&!(t.flags&128))mX(),S0(),t.flags|=98560,l=!1;else if(l=cP(t),n!==null&&n.dehydrated!==null){if(e===null){if(!l)throw Error(Ir(318));if(l=t.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(Ir(317));l[lh]=t}else S0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;nl(t),l=!1}else gd!==null&&(yL(gd),gd=null),l=!0;if(!l)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||vo.current&1?ms===0&&(ms=3):Jz())),t.updateQueue!==null&&(t.flags|=4),nl(t),null);case 4:return T0(),cL(e,t),e===null&&uE(t.stateNode.containerInfo),nl(t),null;case 10:return Mz(t.type._context),nl(t),null;case 17:return xc(t.type)&&DC(),nl(t),null;case 19:if(ao(vo),l=t.memoizedState,l===null)return nl(t),null;if(n=(t.flags&128)!==0,d=l.rendering,d===null)if(n)tS(l,!1);else{if(ms!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=VC(e),d!==null){for(t.flags|=128,tS(l,!1),n=d.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)l=r,e=n,l.flags&=14680066,d=l.alternate,d===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=d.childLanes,l.lanes=d.lanes,l.child=d.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=d.memoizedProps,l.memoizedState=d.memoizedState,l.updateQueue=d.updateQueue,l.type=d.type,e=d.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ka(vo,vo.current&1|2),t.child}e=e.sibling}l.tail!==null&&Mo()>P0&&(t.flags|=128,n=!0,tS(l,!1),t.lanes=4194304)}else{if(!n)if(e=VC(d),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),tS(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!uo)return nl(t),null}else 2*Mo()-l.renderingStartTime>P0&&r!==1073741824&&(t.flags|=128,n=!0,tS(l,!1),t.lanes=4194304);l.isBackwards?(d.sibling=t.child,t.child=d):(r=l.last,r!==null?r.sibling=d:t.child=d,l.last=d)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Mo(),t.sibling=null,r=vo.current,Ka(vo,n?r&1|2:r&1),t):(nl(t),null);case 22:case 23:return Yz(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Dc&1073741824&&(nl(t),t.subtreeFlags&6&&(t.flags|=8192)):nl(t),null;case 24:return null;case 25:return null}throw Error(Ir(156,t.tag))}function Cme(e,t){switch(kz(t),t.tag){case 1:return xc(t.type)&&DC(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return T0(),ao(_c),ao(pl),Bz(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return zz(t),null;case 13:if(ao(vo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ir(340));S0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return ao(vo),null;case 4:return T0(),null;case 10:return Mz(t.type._context),null;case 22:case 23:return Yz(),null;case 24:return null;default:return null}}var hP=!1,hl=!1,Ome=typeof WeakSet=="function"?WeakSet:Set,vn=null;function Lx(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Co(e,t,n)}else r.current=null}function uL(e,t,r){try{r()}catch(n){Co(e,t,n)}}var Y8=!1;function Ime(e,t){if(HD=RC,e=rX(),Oz(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,l=n.focusNode;n=n.focusOffset;try{r.nodeType,l.nodeType}catch{r=null;break e}var d=0,i=-1,g=-1,x=0,S=0,E=e,A=null;t:for(;;){for(var C;E!==r||o!==0&&E.nodeType!==3||(i=d+o),E!==l||n!==0&&E.nodeType!==3||(g=d+n),E.nodeType===3&&(d+=E.nodeValue.length),(C=E.firstChild)!==null;)A=E,E=C;for(;;){if(E===e)break t;if(A===r&&++x===o&&(i=d),A===l&&++S===n&&(g=d),(C=E.nextSibling)!==null)break;E=A,A=E.parentNode}E=C}r=i===-1||g===-1?null:{start:i,end:g}}else r=null}r=r||{start:0,end:0}}else r=null;for(KD={focusedElem:e,selectionRange:r},RC=!1,vn=t;vn!==null;)if(t=vn,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,vn=e;else for(;vn!==null;){t=vn;try{var N=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var k=N.memoizedProps,R=N.memoizedState,L=t.stateNode,j=L.getSnapshotBeforeUpdate(t.elementType===t.type?k:ld(t.type,k),R);L.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var F=t.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ir(163))}}catch(B){Co(t,t.return,B)}if(e=t.sibling,e!==null){e.return=t.return,vn=e;break}vn=t.return}return N=Y8,Y8=!1,N}function BS(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&e)===e){var l=o.destroy;o.destroy=void 0,l!==void 0&&uL(t,r,l)}o=o.next}while(o!==n)}}function VI(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function dL(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function JX(e){var t=e.alternate;t!==null&&(e.alternate=null,JX(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[lh],delete t[hE],delete t[YD],delete t[hme],delete t[fme])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function QX(e){return e.tag===5||e.tag===3||e.tag===4}function J8(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||QX(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function hL(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=MC));else if(n!==4&&(e=e.child,e!==null))for(hL(e,t,r),e=e.sibling;e!==null;)hL(e,t,r),e=e.sibling}function fL(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(fL(e,t,r),e=e.sibling;e!==null;)fL(e,t,r),e=e.sibling}var $s=null,hd=!1;function Bp(e,t,r){for(r=r.child;r!==null;)eY(e,t,r),r=r.sibling}function eY(e,t,r){if(vh&&typeof vh.onCommitFiberUnmount=="function")try{vh.onCommitFiberUnmount(MI,r)}catch{}switch(r.tag){case 5:hl||Lx(r,t);case 6:var n=$s,o=hd;$s=null,Bp(e,t,r),$s=n,hd=o,$s!==null&&(hd?(e=$s,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):$s.removeChild(r.stateNode));break;case 18:$s!==null&&(hd?(e=$s,r=r.stateNode,e.nodeType===8?nM(e.parentNode,r):e.nodeType===1&&nM(e,r),sE(e)):nM($s,r.stateNode));break;case 4:n=$s,o=hd,$s=r.stateNode.containerInfo,hd=!0,Bp(e,t,r),$s=n,hd=o;break;case 0:case 11:case 14:case 15:if(!hl&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var l=o,d=l.destroy;l=l.tag,d!==void 0&&(l&2||l&4)&&uL(r,t,d),o=o.next}while(o!==n)}Bp(e,t,r);break;case 1:if(!hl&&(Lx(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(i){Co(r,t,i)}Bp(e,t,r);break;case 21:Bp(e,t,r);break;case 22:r.mode&1?(hl=(n=hl)||r.memoizedState!==null,Bp(e,t,r),hl=n):Bp(e,t,r);break;default:Bp(e,t,r)}}function Q8(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Ome),t.forEach(function(n){var o=zme.bind(null,e,n);r.has(n)||(r.add(n),n.then(o,o))})}}function nd(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var l=e,d=t,i=d;e:for(;i!==null;){switch(i.tag){case 5:$s=i.stateNode,hd=!1;break e;case 3:$s=i.stateNode.containerInfo,hd=!0;break e;case 4:$s=i.stateNode.containerInfo,hd=!0;break e}i=i.return}if($s===null)throw Error(Ir(160));eY(l,d,o),$s=null,hd=!1;var g=o.alternate;g!==null&&(g.return=null),o.return=null}catch(x){Co(o,t,x)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)tY(t,e),t=t.sibling}function tY(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(nd(t,e),th(e),n&4){try{BS(3,e,e.return),VI(3,e)}catch(k){Co(e,e.return,k)}try{BS(5,e,e.return)}catch(k){Co(e,e.return,k)}}break;case 1:nd(t,e),th(e),n&512&&r!==null&&Lx(r,r.return);break;case 5:if(nd(t,e),th(e),n&512&&r!==null&&Lx(r,r.return),e.flags&32){var o=e.stateNode;try{nE(o,"")}catch(k){Co(e,e.return,k)}}if(n&4&&(o=e.stateNode,o!=null)){var l=e.memoizedProps,d=r!==null?r.memoizedProps:l,i=e.type,g=e.updateQueue;if(e.updateQueue=null,g!==null)try{i==="input"&&l.type==="radio"&&l.name!=null&&SZ(o,l),LD(i,d);var x=LD(i,l);for(d=0;d<g.length;d+=2){var S=g[d],E=g[d+1];S==="style"?CZ(o,E):S==="dangerouslySetInnerHTML"?AZ(o,E):S==="children"?nE(o,E):gz(o,S,E,x)}switch(i){case"input":RD(o,l);break;case"textarea":EZ(o,l);break;case"select":var A=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!l.multiple;var C=l.value;C!=null?Wx(o,!!l.multiple,C,!1):A!==!!l.multiple&&(l.defaultValue!=null?Wx(o,!!l.multiple,l.defaultValue,!0):Wx(o,!!l.multiple,l.multiple?[]:"",!1))}o[hE]=l}catch(k){Co(e,e.return,k)}}break;case 6:if(nd(t,e),th(e),n&4){if(e.stateNode===null)throw Error(Ir(162));o=e.stateNode,l=e.memoizedProps;try{o.nodeValue=l}catch(k){Co(e,e.return,k)}}break;case 3:if(nd(t,e),th(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{sE(t.containerInfo)}catch(k){Co(e,e.return,k)}break;case 4:nd(t,e),th(e);break;case 13:nd(t,e),th(e),o=e.child,o.flags&8192&&(l=o.memoizedState!==null,o.stateNode.isHidden=l,!l||o.alternate!==null&&o.alternate.memoizedState!==null||(Zz=Mo())),n&4&&Q8(e);break;case 22:if(S=r!==null&&r.memoizedState!==null,e.mode&1?(hl=(x=hl)||S,nd(t,e),hl=x):nd(t,e),th(e),n&8192){if(x=e.memoizedState!==null,(e.stateNode.isHidden=x)&&!S&&e.mode&1)for(vn=e,S=e.child;S!==null;){for(E=vn=S;vn!==null;){switch(A=vn,C=A.child,A.tag){case 0:case 11:case 14:case 15:BS(4,A,A.return);break;case 1:Lx(A,A.return);var N=A.stateNode;if(typeof N.componentWillUnmount=="function"){n=A,r=A.return;try{t=n,N.props=t.memoizedProps,N.state=t.memoizedState,N.componentWillUnmount()}catch(k){Co(n,r,k)}}break;case 5:Lx(A,A.return);break;case 22:if(A.memoizedState!==null){tq(E);continue}}C!==null?(C.return=A,vn=C):tq(E)}S=S.sibling}e:for(S=null,E=e;;){if(E.tag===5){if(S===null){S=E;try{o=E.stateNode,x?(l=o.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(i=E.stateNode,g=E.memoizedProps.style,d=g!=null&&g.hasOwnProperty("display")?g.display:null,i.style.display=PZ("display",d))}catch(k){Co(e,e.return,k)}}}else if(E.tag===6){if(S===null)try{E.stateNode.nodeValue=x?"":E.memoizedProps}catch(k){Co(e,e.return,k)}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===e)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===e)break e;for(;E.sibling===null;){if(E.return===null||E.return===e)break e;S===E&&(S=null),E=E.return}S===E&&(S=null),E.sibling.return=E.return,E=E.sibling}}break;case 19:nd(t,e),th(e),n&4&&Q8(e);break;case 21:break;default:nd(t,e),th(e)}}function th(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(QX(r)){var n=r;break e}r=r.return}throw Error(Ir(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(nE(o,""),n.flags&=-33);var l=J8(e);fL(e,l,o);break;case 3:case 4:var d=n.stateNode.containerInfo,i=J8(e);hL(e,i,d);break;default:throw Error(Ir(161))}}catch(g){Co(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function kme(e,t,r){vn=e,rY(e)}function rY(e,t,r){for(var n=(e.mode&1)!==0;vn!==null;){var o=vn,l=o.child;if(o.tag===22&&n){var d=o.memoizedState!==null||hP;if(!d){var i=o.alternate,g=i!==null&&i.memoizedState!==null||hl;i=hP;var x=hl;if(hP=d,(hl=g)&&!x)for(vn=o;vn!==null;)d=vn,g=d.child,d.tag===22&&d.memoizedState!==null?rq(o):g!==null?(g.return=d,vn=g):rq(o);for(;l!==null;)vn=l,rY(l),l=l.sibling;vn=o,hP=i,hl=x}eq(e)}else o.subtreeFlags&8772&&l!==null?(l.return=o,vn=l):eq(e)}}function eq(e){for(;vn!==null;){var t=vn;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:hl||VI(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!hl)if(r===null)n.componentDidMount();else{var o=t.elementType===t.type?r.memoizedProps:ld(t.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;l!==null&&F8(t,l,n);break;case 3:var d=t.updateQueue;if(d!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}F8(t,d,r)}break;case 5:var i=t.stateNode;if(r===null&&t.flags&4){r=i;var g=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":g.autoFocus&&r.focus();break;case"img":g.src&&(r.src=g.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var x=t.alternate;if(x!==null){var S=x.memoizedState;if(S!==null){var E=S.dehydrated;E!==null&&sE(E)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ir(163))}hl||t.flags&512&&dL(t)}catch(A){Co(t,t.return,A)}}if(t===e){vn=null;break}if(r=t.sibling,r!==null){r.return=t.return,vn=r;break}vn=t.return}}function tq(e){for(;vn!==null;){var t=vn;if(t===e){vn=null;break}var r=t.sibling;if(r!==null){r.return=t.return,vn=r;break}vn=t.return}}function rq(e){for(;vn!==null;){var t=vn;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{VI(4,t)}catch(g){Co(t,r,g)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var o=t.return;try{n.componentDidMount()}catch(g){Co(t,o,g)}}var l=t.return;try{dL(t)}catch(g){Co(t,l,g)}break;case 5:var d=t.return;try{dL(t)}catch(g){Co(t,d,g)}}}catch(g){Co(t,t.return,g)}if(t===e){vn=null;break}var i=t.sibling;if(i!==null){i.return=t.return,vn=i;break}vn=t.return}}var Rme=Math.ceil,GC=Bf.ReactCurrentDispatcher,Hz=Bf.ReactCurrentOwner,Eu=Bf.ReactCurrentBatchConfig,ua=0,Os=null,Jo=null,qs=0,Dc=0,Fx=Ym(0),ms=0,vE=null,nv=0,qI=0,Kz=0,$S=null,pc=null,Zz=0,P0=1/0,df=null,HC=!1,pL=null,Im=null,fP=!1,xm=null,KC=0,US=0,mL=null,iC=-1,aC=0;function Wl(){return ua&6?Mo():iC!==-1?iC:iC=Mo()}function km(e){return e.mode&1?ua&2&&qs!==0?qs&-qs:mme.transition!==null?(aC===0&&(aC=BZ()),aC):(e=ja,e!==0||(e=window.event,e=e===void 0?16:HZ(e.type)),e):1}function bd(e,t,r,n){if(50<US)throw US=0,mL=null,Error(Ir(185));bT(e,r,n),(!(ua&2)||e!==Os)&&(e===Os&&(!(ua&2)&&(qI|=r),ms===4&&rm(e,qs)),bc(e,n),r===1&&ua===0&&!(t.mode&1)&&(P0=Mo()+500,BI&&Jm()))}function bc(e,t){var r=e.callbackNode;mpe(e,t);var n=kC(e,e===Os?qs:0);if(n===0)r!==null&&d8(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&d8(r),t===1)e.tag===0?pme(nq.bind(null,e)):hX(nq.bind(null,e)),ume(function(){!(ua&6)&&Jm()}),r=null;else{switch($Z(n)){case 1:r=bz;break;case 4:r=FZ;break;case 16:r=IC;break;case 536870912:r=zZ;break;default:r=IC}r=uY(r,nY.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function nY(e,t){if(iC=-1,aC=0,ua&6)throw Error(Ir(327));var r=e.callbackNode;if(Xx()&&e.callbackNode!==r)return null;var n=kC(e,e===Os?qs:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=ZC(e,n);else{t=n;var o=ua;ua|=2;var l=aY();(Os!==e||qs!==t)&&(df=null,P0=Mo()+500,Zy(e,t));do try{Mme();break}catch(i){iY(e,i)}while(!0);Nz(),GC.current=l,ua=o,Jo!==null?t=0:(Os=null,qs=0,t=ms)}if(t!==0){if(t===2&&(o=UD(e),o!==0&&(n=o,t=gL(e,o))),t===1)throw r=vE,Zy(e,0),rm(e,n),bc(e,Mo()),r;if(t===6)rm(e,n);else{if(o=e.current.alternate,!(n&30)&&!jme(o)&&(t=ZC(e,n),t===2&&(l=UD(e),l!==0&&(n=l,t=gL(e,l))),t===1))throw r=vE,Zy(e,0),rm(e,n),bc(e,Mo()),r;switch(e.finishedWork=o,e.finishedLanes=n,t){case 0:case 1:throw Error(Ir(345));case 2:yy(e,pc,df);break;case 3:if(rm(e,n),(n&130023424)===n&&(t=Zz+500-Mo(),10<t)){if(kC(e,0)!==0)break;if(o=e.suspendedLanes,(o&n)!==n){Wl(),e.pingedLanes|=e.suspendedLanes&o;break}e.timeoutHandle=XD(yy.bind(null,e,pc,df),t);break}yy(e,pc,df);break;case 4:if(rm(e,n),(n&4194240)===n)break;for(t=e.eventTimes,o=-1;0<n;){var d=31-xd(n);l=1<<d,d=t[d],d>o&&(o=d),n&=~l}if(n=o,n=Mo()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Rme(n/1960))-n,10<n){e.timeoutHandle=XD(yy.bind(null,e,pc,df),n);break}yy(e,pc,df);break;case 5:yy(e,pc,df);break;default:throw Error(Ir(329))}}}return bc(e,Mo()),e.callbackNode===r?nY.bind(null,e):null}function gL(e,t){var r=$S;return e.current.memoizedState.isDehydrated&&(Zy(e,t).flags|=256),e=ZC(e,t),e!==2&&(t=pc,pc=r,t!==null&&yL(t)),e}function yL(e){pc===null?pc=e:pc.push.apply(pc,e)}function jme(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],l=o.getSnapshot;o=o.value;try{if(!Td(l(),o))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function rm(e,t){for(t&=~Kz,t&=~qI,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-xd(t),n=1<<r;e[r]=-1,t&=~n}}function nq(e){if(ua&6)throw Error(Ir(327));Xx();var t=kC(e,0);if(!(t&1))return bc(e,Mo()),null;var r=ZC(e,t);if(e.tag!==0&&r===2){var n=UD(e);n!==0&&(t=n,r=gL(e,n))}if(r===1)throw r=vE,Zy(e,0),rm(e,t),bc(e,Mo()),r;if(r===6)throw Error(Ir(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,yy(e,pc,df),bc(e,Mo()),null}function Xz(e,t){var r=ua;ua|=1;try{return e(t)}finally{ua=r,ua===0&&(P0=Mo()+500,BI&&Jm())}}function iv(e){xm!==null&&xm.tag===0&&!(ua&6)&&Xx();var t=ua;ua|=1;var r=Eu.transition,n=ja;try{if(Eu.transition=null,ja=1,e)return e()}finally{ja=n,Eu.transition=r,ua=t,!(ua&6)&&Jm()}}function Yz(){Dc=Fx.current,ao(Fx)}function Zy(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,cme(r)),Jo!==null)for(r=Jo.return;r!==null;){var n=r;switch(kz(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&DC();break;case 3:T0(),ao(_c),ao(pl),Bz();break;case 5:zz(n);break;case 4:T0();break;case 13:ao(vo);break;case 19:ao(vo);break;case 10:Mz(n.type._context);break;case 22:case 23:Yz()}r=r.return}if(Os=e,Jo=e=Rm(e.current,null),qs=Dc=t,ms=0,vE=null,Kz=qI=nv=0,pc=$S=null,ky!==null){for(t=0;t<ky.length;t++)if(r=ky[t],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,l=r.pending;if(l!==null){var d=l.next;l.next=o,n.next=d}r.pending=n}ky=null}return e}function iY(e,t){do{var r=Jo;try{if(Nz(),tC.current=WC,qC){for(var n=_o.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}qC=!1}if(rv=0,As=hs=_o=null,zS=!1,mE=0,Hz.current=null,r===null||r.return===null){ms=1,vE=t,Jo=null;break}e:{var l=e,d=r.return,i=r,g=t;if(t=qs,i.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){var x=g,S=i,E=S.tag;if(!(S.mode&1)&&(E===0||E===11||E===15)){var A=S.alternate;A?(S.updateQueue=A.updateQueue,S.memoizedState=A.memoizedState,S.lanes=A.lanes):(S.updateQueue=null,S.memoizedState=null)}var C=q8(d);if(C!==null){C.flags&=-257,W8(C,d,i,l,t),C.mode&1&&V8(l,x,t),t=C,g=x;var N=t.updateQueue;if(N===null){var k=new Set;k.add(g),t.updateQueue=k}else N.add(g);break e}else{if(!(t&1)){V8(l,x,t),Jz();break e}g=Error(Ir(426))}}else if(uo&&i.mode&1){var R=q8(d);if(R!==null){!(R.flags&65536)&&(R.flags|=256),W8(R,d,i,l,t),Rz(A0(g,i));break e}}l=g=A0(g,i),ms!==4&&(ms=2),$S===null?$S=[l]:$S.push(l),l=d;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t;var L=$X(l,g,t);L8(l,L);break e;case 1:i=g;var j=l.type,F=l.stateNode;if(!(l.flags&128)&&(typeof j.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Im===null||!Im.has(F)))){l.flags|=65536,t&=-t,l.lanes|=t;var B=UX(l,i,t);L8(l,B);break e}}l=l.return}while(l!==null)}sY(r)}catch(U){t=U,Jo===r&&r!==null&&(Jo=r=r.return);continue}break}while(!0)}function aY(){var e=GC.current;return GC.current=WC,e===null?WC:e}function Jz(){(ms===0||ms===3||ms===2)&&(ms=4),Os===null||!(nv&268435455)&&!(qI&268435455)||rm(Os,qs)}function ZC(e,t){var r=ua;ua|=2;var n=aY();(Os!==e||qs!==t)&&(df=null,Zy(e,t));do try{Nme();break}catch(o){iY(e,o)}while(!0);if(Nz(),ua=r,GC.current=n,Jo!==null)throw Error(Ir(261));return Os=null,qs=0,ms}function Nme(){for(;Jo!==null;)oY(Jo)}function Mme(){for(;Jo!==null&&!ope();)oY(Jo)}function oY(e){var t=cY(e.alternate,e,Dc);e.memoizedProps=e.pendingProps,t===null?sY(e):Jo=t,Hz.current=null}function sY(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Cme(r,t),r!==null){r.flags&=32767,Jo=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ms=6,Jo=null;return}}else if(r=Pme(r,t,Dc),r!==null){Jo=r;return}if(t=t.sibling,t!==null){Jo=t;return}Jo=t=e}while(t!==null);ms===0&&(ms=5)}function yy(e,t,r){var n=ja,o=Eu.transition;try{Eu.transition=null,ja=1,Dme(e,t,r,n)}finally{Eu.transition=o,ja=n}return null}function Dme(e,t,r,n){do Xx();while(xm!==null);if(ua&6)throw Error(Ir(327));r=e.finishedWork;var o=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Ir(177));e.callbackNode=null,e.callbackPriority=0;var l=r.lanes|r.childLanes;if(gpe(e,l),e===Os&&(Jo=Os=null,qs=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||fP||(fP=!0,uY(IC,function(){return Xx(),null})),l=(r.flags&15990)!==0,r.subtreeFlags&15990||l){l=Eu.transition,Eu.transition=null;var d=ja;ja=1;var i=ua;ua|=4,Hz.current=null,Ime(e,r),tY(r,e),rme(KD),RC=!!HD,KD=HD=null,e.current=r,kme(r),spe(),ua=i,ja=d,Eu.transition=l}else e.current=r;if(fP&&(fP=!1,xm=e,KC=o),l=e.pendingLanes,l===0&&(Im=null),upe(r.stateNode),bc(e,Mo()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)o=t[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(HC)throw HC=!1,e=pL,pL=null,e;return KC&1&&e.tag!==0&&Xx(),l=e.pendingLanes,l&1?e===mL?US++:(US=0,mL=e):US=0,Jm(),null}function Xx(){if(xm!==null){var e=$Z(KC),t=Eu.transition,r=ja;try{if(Eu.transition=null,ja=16>e?16:e,xm===null)var n=!1;else{if(e=xm,xm=null,KC=0,ua&6)throw Error(Ir(331));var o=ua;for(ua|=4,vn=e.current;vn!==null;){var l=vn,d=l.child;if(vn.flags&16){var i=l.deletions;if(i!==null){for(var g=0;g<i.length;g++){var x=i[g];for(vn=x;vn!==null;){var S=vn;switch(S.tag){case 0:case 11:case 15:BS(8,S,l)}var E=S.child;if(E!==null)E.return=S,vn=E;else for(;vn!==null;){S=vn;var A=S.sibling,C=S.return;if(JX(S),S===x){vn=null;break}if(A!==null){A.return=C,vn=A;break}vn=C}}}var N=l.alternate;if(N!==null){var k=N.child;if(k!==null){N.child=null;do{var R=k.sibling;k.sibling=null,k=R}while(k!==null)}}vn=l}}if(l.subtreeFlags&2064&&d!==null)d.return=l,vn=d;else e:for(;vn!==null;){if(l=vn,l.flags&2048)switch(l.tag){case 0:case 11:case 15:BS(9,l,l.return)}var L=l.sibling;if(L!==null){L.return=l.return,vn=L;break e}vn=l.return}}var j=e.current;for(vn=j;vn!==null;){d=vn;var F=d.child;if(d.subtreeFlags&2064&&F!==null)F.return=d,vn=F;else e:for(d=j;vn!==null;){if(i=vn,i.flags&2048)try{switch(i.tag){case 0:case 11:case 15:VI(9,i)}}catch(U){Co(i,i.return,U)}if(i===d){vn=null;break e}var B=i.sibling;if(B!==null){B.return=i.return,vn=B;break e}vn=i.return}}if(ua=o,Jm(),vh&&typeof vh.onPostCommitFiberRoot=="function")try{vh.onPostCommitFiberRoot(MI,e)}catch{}n=!0}return n}finally{ja=r,Eu.transition=t}}return!1}function iq(e,t,r){t=A0(r,t),t=$X(e,t,1),e=Om(e,t,1),t=Wl(),e!==null&&(bT(e,1,t),bc(e,t))}function Co(e,t,r){if(e.tag===3)iq(e,e,r);else for(;t!==null;){if(t.tag===3){iq(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Im===null||!Im.has(n))){e=A0(r,e),e=UX(t,e,1),t=Om(t,e,1),e=Wl(),t!==null&&(bT(t,1,e),bc(t,e));break}}t=t.return}}function Lme(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Wl(),e.pingedLanes|=e.suspendedLanes&r,Os===e&&(qs&r)===r&&(ms===4||ms===3&&(qs&130023424)===qs&&500>Mo()-Zz?Zy(e,0):Kz|=r),bc(e,t)}function lY(e,t){t===0&&(e.mode&1?(t=nP,nP<<=1,!(nP&130023424)&&(nP=4194304)):t=1);var r=Wl();e=Rf(e,t),e!==null&&(bT(e,t,r),bc(e,r))}function Fme(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),lY(e,r)}function zme(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Ir(314))}n!==null&&n.delete(t),lY(e,r)}var cY;cY=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||_c.current)gc=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return gc=!1,Ame(e,t,r);gc=!!(e.flags&131072)}else gc=!1,uo&&t.flags&1048576&&fX(t,zC,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;nC(e,t),e=t.pendingProps;var o=w0(t,pl.current);Zx(t,r),o=Uz(null,t,n,e,o,r);var l=Vz();return t.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,xc(n)?(l=!0,LC(t)):l=!1,t.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,Lz(t),o.updater=UI,t.stateNode=o,o._reactInternals=t,nL(t,n,e,r),t=oL(null,t,n,!0,l,r)):(t.tag=0,uo&&l&&Iz(t),Ml(null,t,o,r),t=t.child),t;case 16:n=t.elementType;e:{switch(nC(e,t),e=t.pendingProps,o=n._init,n=o(n._payload),t.type=n,o=t.tag=$me(n),e=ld(n,e),o){case 0:t=aL(null,t,n,e,r);break e;case 1:t=K8(null,t,n,e,r);break e;case 11:t=G8(null,t,n,e,r);break e;case 14:t=H8(null,t,n,ld(n.type,e),r);break e}throw Error(Ir(306,n,""))}return t;case 0:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),aL(e,t,n,o,r);case 1:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),K8(e,t,n,o,r);case 3:e:{if(GX(t),e===null)throw Error(Ir(387));n=t.pendingProps,l=t.memoizedState,o=l.element,_X(e,t),UC(t,n,null,r);var d=t.memoizedState;if(n=d.element,l.isDehydrated)if(l={element:n,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=l,t.memoizedState=l,t.flags&256){o=A0(Error(Ir(423)),t),t=Z8(e,t,n,r,o);break e}else if(n!==o){o=A0(Error(Ir(424)),t),t=Z8(e,t,n,r,o);break e}else for(Wc=Cm(t.stateNode.containerInfo.firstChild),Gc=t,uo=!0,gd=null,r=yX(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(S0(),n===o){t=jf(e,t,r);break e}Ml(e,t,n,r)}t=t.child}return t;case 5:return xX(t),e===null&&eL(t),n=t.type,o=t.pendingProps,l=e!==null?e.memoizedProps:null,d=o.children,ZD(n,o)?d=null:l!==null&&ZD(n,l)&&(t.flags|=32),WX(e,t),Ml(e,t,d,r),t.child;case 6:return e===null&&eL(t),null;case 13:return HX(e,t,r);case 4:return Fz(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=E0(t,null,n,r):Ml(e,t,n,r),t.child;case 11:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),G8(e,t,n,o,r);case 7:return Ml(e,t,t.pendingProps,r),t.child;case 8:return Ml(e,t,t.pendingProps.children,r),t.child;case 12:return Ml(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,o=t.pendingProps,l=t.memoizedProps,d=o.value,Ka(BC,n._currentValue),n._currentValue=d,l!==null)if(Td(l.value,d)){if(l.children===o.children&&!_c.current){t=jf(e,t,r);break e}}else for(l=t.child,l!==null&&(l.return=t);l!==null;){var i=l.dependencies;if(i!==null){d=l.child;for(var g=i.firstContext;g!==null;){if(g.context===n){if(l.tag===1){g=Ef(-1,r&-r),g.tag=2;var x=l.updateQueue;if(x!==null){x=x.shared;var S=x.pending;S===null?g.next=g:(g.next=S.next,S.next=g),x.pending=g}}l.lanes|=r,g=l.alternate,g!==null&&(g.lanes|=r),tL(l.return,r,t),i.lanes|=r;break}g=g.next}}else if(l.tag===10)d=l.type===t.type?null:l.child;else if(l.tag===18){if(d=l.return,d===null)throw Error(Ir(341));d.lanes|=r,i=d.alternate,i!==null&&(i.lanes|=r),tL(d,r,t),d=l.sibling}else d=l.child;if(d!==null)d.return=l;else for(d=l;d!==null;){if(d===t){d=null;break}if(l=d.sibling,l!==null){l.return=d.return,d=l;break}d=d.return}l=d}Ml(e,t,o.children,r),t=t.child}return t;case 9:return o=t.type,n=t.pendingProps.children,Zx(t,r),o=Iu(o),n=n(o),t.flags|=1,Ml(e,t,n,r),t.child;case 14:return n=t.type,o=ld(n,t.pendingProps),o=ld(n.type,o),H8(e,t,n,o,r);case 15:return VX(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,o=t.pendingProps,o=t.elementType===n?o:ld(n,o),nC(e,t),t.tag=1,xc(n)?(e=!0,LC(t)):e=!1,Zx(t,r),BX(t,n,o),nL(t,n,o,r),oL(null,t,n,!0,e,r);case 19:return KX(e,t,r);case 22:return qX(e,t,r)}throw Error(Ir(156,t.tag))};function uY(e,t){return LZ(e,t)}function Bme(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wu(e,t,r,n){return new Bme(e,t,r,n)}function Qz(e){return e=e.prototype,!(!e||!e.isReactComponent)}function $me(e){if(typeof e=="function")return Qz(e)?1:0;if(e!=null){if(e=e.$$typeof,e===vz)return 11;if(e===_z)return 14}return 2}function Rm(e,t){var r=e.alternate;return r===null?(r=wu(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function oC(e,t,r,n,o,l){var d=2;if(n=e,typeof e=="function")Qz(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case Cx:return Xy(r.children,o,l,t);case yz:d=8,o|=8;break;case PD:return e=wu(12,r,t,o|2),e.elementType=PD,e.lanes=l,e;case CD:return e=wu(13,r,t,o),e.elementType=CD,e.lanes=l,e;case OD:return e=wu(19,r,t,o),e.elementType=OD,e.lanes=l,e;case xZ:return WI(r,o,l,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case vZ:d=10;break e;case _Z:d=9;break e;case vz:d=11;break e;case _z:d=14;break e;case Yp:d=16,n=null;break e}throw Error(Ir(130,e==null?e:typeof e,""))}return t=wu(d,r,t,o),t.elementType=e,t.type=n,t.lanes=l,t}function Xy(e,t,r,n){return e=wu(7,e,n,t),e.lanes=r,e}function WI(e,t,r,n){return e=wu(22,e,n,t),e.elementType=xZ,e.lanes=r,e.stateNode={isHidden:!1},e}function dM(e,t,r){return e=wu(6,e,null,t),e.lanes=r,e}function hM(e,t,r){return t=wu(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Ume(e,t,r,n,o){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=GN(0),this.expirationTimes=GN(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=GN(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function eB(e,t,r,n,o,l,d,i,g){return e=new Ume(e,t,r,i,g),t===1?(t=1,l===!0&&(t|=8)):t=0,l=wu(3,null,null,t),e.current=l,l.stateNode=e,l.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lz(l),e}function Vme(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Px,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function dY(e){if(!e)return Bm;e=e._reactInternals;e:{if(wv(e)!==e||e.tag!==1)throw Error(Ir(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(xc(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ir(171))}if(e.tag===1){var r=e.type;if(xc(r))return dX(e,r,t)}return t}function hY(e,t,r,n,o,l,d,i,g){return e=eB(r,n,!0,e,o,l,d,i,g),e.context=dY(null),r=e.current,n=Wl(),o=km(r),l=Ef(n,o),l.callback=t??null,Om(r,l,o),e.current.lanes=o,bT(e,o,n),bc(e,n),e}function GI(e,t,r,n){var o=t.current,l=Wl(),d=km(o);return r=dY(r),t.context===null?t.context=r:t.pendingContext=r,t=Ef(l,d),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Om(o,t,d),e!==null&&(bd(e,o,d,l),eC(e,o,d)),d}function XC(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function aq(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function tB(e,t){aq(e,t),(e=e.alternate)&&aq(e,t)}function qme(){return null}var fY=typeof reportError=="function"?reportError:function(e){console.error(e)};function rB(e){this._internalRoot=e}HI.prototype.render=rB.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ir(409));GI(e,t,null,null)};HI.prototype.unmount=rB.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;iv(function(){GI(null,e,null,null)}),t[kf]=null}};function HI(e){this._internalRoot=e}HI.prototype.unstable_scheduleHydration=function(e){if(e){var t=qZ();e={blockedOn:null,target:e,priority:t};for(var r=0;r<tm.length&&t!==0&&t<tm[r].priority;r++);tm.splice(r,0,e),r===0&&GZ(e)}};function nB(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function KI(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function oq(){}function Wme(e,t,r,n,o){if(o){if(typeof n=="function"){var l=n;n=function(){var x=XC(d);l.call(x)}}var d=hY(t,n,e,0,null,!1,!1,"",oq);return e._reactRootContainer=d,e[kf]=d.current,uE(e.nodeType===8?e.parentNode:e),iv(),d}for(;o=e.lastChild;)e.removeChild(o);if(typeof n=="function"){var i=n;n=function(){var x=XC(g);i.call(x)}}var g=eB(e,0,!1,null,null,!1,!1,"",oq);return e._reactRootContainer=g,e[kf]=g.current,uE(e.nodeType===8?e.parentNode:e),iv(function(){GI(t,g,r,n)}),g}function ZI(e,t,r,n,o){var l=r._reactRootContainer;if(l){var d=l;if(typeof o=="function"){var i=o;o=function(){var g=XC(d);i.call(g)}}GI(t,d,e,o)}else d=Wme(r,t,e,o,n);return XC(d)}UZ=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=ES(t.pendingLanes);r!==0&&(wz(t,r|1),bc(t,Mo()),!(ua&6)&&(P0=Mo()+500,Jm()))}break;case 13:iv(function(){var n=Rf(e,1);if(n!==null){var o=Wl();bd(n,e,1,o)}}),tB(e,1)}};Sz=function(e){if(e.tag===13){var t=Rf(e,134217728);if(t!==null){var r=Wl();bd(t,e,134217728,r)}tB(e,134217728)}};VZ=function(e){if(e.tag===13){var t=km(e),r=Rf(e,t);if(r!==null){var n=Wl();bd(r,e,t,n)}tB(e,t)}};qZ=function(){return ja};WZ=function(e,t){var r=ja;try{return ja=e,t()}finally{ja=r}};zD=function(e,t,r){switch(t){case"input":if(RD(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var o=zI(n);if(!o)throw Error(Ir(90));wZ(n),RD(n,o)}}}break;case"textarea":EZ(e,r);break;case"select":t=r.value,t!=null&&Wx(e,!!r.multiple,t,!1)}};kZ=Xz;RZ=iv;var Gme={usingClientEntryPoint:!1,Events:[ST,Rx,zI,OZ,IZ,Xz]},rS={findFiberByHostInstance:Iy,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hme={bundleType:rS.bundleType,version:rS.version,rendererPackageName:rS.rendererPackageName,rendererConfig:rS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=MZ(e),e===null?null:e.stateNode},findFiberByHostInstance:rS.findFiberByHostInstance||qme,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pP=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pP.isDisabled&&pP.supportsFiber)try{MI=pP.inject(Hme),vh=pP}catch{}}eu.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Gme;eu.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nB(t))throw Error(Ir(200));return Vme(e,t,null,r)};eu.createRoot=function(e,t){if(!nB(e))throw Error(Ir(299));var r=!1,n="",o=fY;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),t=eB(e,1,!1,null,null,r,!1,n,o),e[kf]=t.current,uE(e.nodeType===8?e.parentNode:e),new rB(t)};eu.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ir(188)):(e=Object.keys(e).join(","),Error(Ir(268,e)));return e=MZ(t),e=e===null?null:e.stateNode,e};eu.flushSync=function(e){return iv(e)};eu.hydrate=function(e,t,r){if(!KI(t))throw Error(Ir(200));return ZI(null,e,t,!0,r)};eu.hydrateRoot=function(e,t,r){if(!nB(e))throw Error(Ir(405));var n=r!=null&&r.hydratedSources||null,o=!1,l="",d=fY;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(l=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),t=hY(t,null,e,1,r??null,o,!1,l,d),e[kf]=t.current,uE(e),n)for(e=0;e<n.length;e++)r=n[e],o=r._getVersion,o=o(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,o]:t.mutableSourceEagerHydrationData.push(r,o);return new HI(t)};eu.render=function(e,t,r){if(!KI(t))throw Error(Ir(200));return ZI(null,e,t,!1,r)};eu.unmountComponentAtNode=function(e){if(!KI(e))throw Error(Ir(40));return e._reactRootContainer?(iv(function(){ZI(null,null,e,!1,function(){e._reactRootContainer=null,e[kf]=null})}),!0):!1};eu.unstable_batchedUpdates=Xz;eu.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!KI(r))throw Error(Ir(200));if(e==null||e._reactInternals===void 0)throw Error(Ir(38));return ZI(e,t,r,!1,n)};eu.version="18.3.1-next-f1338f8080-20240426";function pY(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(pY)}catch(e){console.error(e)}}pY(),pZ.exports=eu;var Qm=pZ.exports;const mY=va(Qm);var gY,sq=Qm;gY=sq.createRoot,sq.hydrateRoot;const Kme=1,Zme=1e6;let fM=0;function Xme(){return fM=(fM+1)%Number.MAX_SAFE_INTEGER,fM.toString()}const pM=new Map,lq=e=>{if(pM.has(e))return;const t=setTimeout(()=>{pM.delete(e),VS({type:"REMOVE_TOAST",toastId:e})},Zme);pM.set(e,t)},Yme=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Kme)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?lq(r):e.toasts.forEach(n=>{lq(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},sC=[];let lC={toasts:[]};function VS(e){lC=Yme(lC,e),sC.forEach(t=>{t(lC)})}function Lc({...e}){const t=Xme(),r=o=>VS({type:"UPDATE_TOAST",toast:{...o,id:t}}),n=()=>VS({type:"DISMISS_TOAST",toastId:t});return VS({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:o=>{o||n()}}}),{id:t,dismiss:n,update:r}}function wa(){const[e,t]=G.useState(lC);return G.useEffect(()=>(sC.push(t),()=>{const r=sC.indexOf(t);r>-1&&sC.splice(r,1)}),[e]),{...e,toast:Lc,dismiss:r=>VS({type:"DISMISS_TOAST",toastId:r})}}function Rr(e,t,{checkForDefaultPrevented:r=!0}={}){return function(o){if(e==null||e(o),r===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function cq(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function XI(...e){return t=>{let r=!1;const n=e.map(o=>{const l=cq(o,t);return!r&&typeof l=="function"&&(r=!0),l});if(r)return()=>{for(let o=0;o<n.length;o++){const l=n[o];typeof l=="function"?l():cq(e[o],null)}}}}function hi(...e){return G.useCallback(XI(...e),e)}function Jme(e,t){const r=G.createContext(t),n=l=>{const{children:d,...i}=l,g=G.useMemo(()=>i,Object.values(i));return m.jsx(r.Provider,{value:g,children:d})};n.displayName=e+"Provider";function o(l){const d=G.useContext(r);if(d)return d;if(t!==void 0)return t;throw new Error(`\`${l}\` must be used within \`${e}\``)}return[n,o]}function Ks(e,t=[]){let r=[];function n(l,d){const i=G.createContext(d),g=r.length;r=[...r,d];const x=E=>{var L;const{scope:A,children:C,...N}=E,k=((L=A==null?void 0:A[e])==null?void 0:L[g])||i,R=G.useMemo(()=>N,Object.values(N));return m.jsx(k.Provider,{value:R,children:C})};x.displayName=l+"Provider";function S(E,A){var k;const C=((k=A==null?void 0:A[e])==null?void 0:k[g])||i,N=G.useContext(C);if(N)return N;if(d!==void 0)return d;throw new Error(`\`${E}\` must be used within \`${l}\``)}return[x,S]}const o=()=>{const l=r.map(d=>G.createContext(d));return function(i){const g=(i==null?void 0:i[e])||l;return G.useMemo(()=>({[`__scope${e}`]:{...i,[e]:g}}),[i,g])}};return o.scopeName=e,[n,Qme(o,...t)]}function Qme(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(l){const d=n.reduce((i,{useScope:g,scopeName:x})=>{const E=g(l)[`__scope${x}`];return{...i,...E}},{});return G.useMemo(()=>({[`__scope${t.scopeName}`]:d}),[d])}};return r.scopeName=t.scopeName,r}function $m(e){const t=ege(e),r=G.forwardRef((n,o)=>{const{children:l,...d}=n,i=G.Children.toArray(l),g=i.find(tge);if(g){const x=g.props.children,S=i.map(E=>E===g?G.Children.count(x)>1?G.Children.only(null):G.isValidElement(x)?x.props.children:null:E);return m.jsx(t,{...d,ref:o,children:G.isValidElement(x)?G.cloneElement(x,void 0,S):null})}return m.jsx(t,{...d,ref:o,children:l})});return r.displayName=`${e}.Slot`,r}var Sv=$m("Slot");function ege(e){const t=G.forwardRef((r,n)=>{const{children:o,...l}=r;if(G.isValidElement(o)){const d=nge(o),i=rge(l,o.props);return o.type!==G.Fragment&&(i.ref=n?XI(n,d):d),G.cloneElement(o,i)}return G.Children.count(o)>1?G.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var yY=Symbol("radix.slottable");function vY(e){const t=({children:r})=>m.jsx(m.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=yY,t}function tge(e){return G.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===yY}function rge(e,t){const r={...t};for(const n in t){const o=e[n],l=t[n];/^on[A-Z]/.test(n)?o&&l?r[n]=(...i)=>{const g=l(...i);return o(...i),g}:o&&(r[n]=o):n==="style"?r[n]={...o,...l}:n==="className"&&(r[n]=[o,l].filter(Boolean).join(" "))}return{...e,...r}}function nge(e){var n,o;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function YI(e){const t=e+"CollectionProvider",[r,n]=Ks(t),[o,l]=r(t,{collectionRef:{current:null},itemMap:new Map}),d=k=>{const{scope:R,children:L}=k,j=We.useRef(null),F=We.useRef(new Map).current;return m.jsx(o,{scope:R,itemMap:F,collectionRef:j,children:L})};d.displayName=t;const i=e+"CollectionSlot",g=$m(i),x=We.forwardRef((k,R)=>{const{scope:L,children:j}=k,F=l(i,L),B=hi(R,F.collectionRef);return m.jsx(g,{ref:B,children:j})});x.displayName=i;const S=e+"CollectionItemSlot",E="data-radix-collection-item",A=$m(S),C=We.forwardRef((k,R)=>{const{scope:L,children:j,...F}=k,B=We.useRef(null),U=hi(R,B),Z=l(S,L);return We.useEffect(()=>(Z.itemMap.set(B,{ref:B,...F}),()=>void Z.itemMap.delete(B))),m.jsx(A,{[E]:"",ref:U,children:j})});C.displayName=S;function N(k){const R=l(e+"CollectionConsumer",k);return We.useCallback(()=>{const j=R.collectionRef.current;if(!j)return[];const F=Array.from(j.querySelectorAll(`[${E}]`));return Array.from(R.itemMap.values()).sort((Z,X)=>F.indexOf(Z.ref.current)-F.indexOf(X.ref.current))},[R.collectionRef,R.itemMap])}return[{Provider:d,Slot:x,ItemSlot:C},N,n]}var ige=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],bn=ige.reduce((e,t)=>{const r=$m(`Primitive.${t}`),n=G.forwardRef((o,l)=>{const{asChild:d,...i}=o,g=d?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),m.jsx(g,{...i,ref:l})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function iB(e,t){e&&Qm.flushSync(()=>e.dispatchEvent(t))}function Io(e){const t=G.useRef(e);return G.useEffect(()=>{t.current=e}),G.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function age(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e);G.useEffect(()=>{const n=o=>{o.key==="Escape"&&r(o)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var oge="DismissableLayer",vL="dismissableLayer.update",sge="dismissableLayer.pointerDownOutside",lge="dismissableLayer.focusOutside",uq,_Y=G.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Ev=G.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:o,onFocusOutside:l,onInteractOutside:d,onDismiss:i,...g}=e,x=G.useContext(_Y),[S,E]=G.useState(null),A=(S==null?void 0:S.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,C]=G.useState({}),N=hi(t,X=>E(X)),k=Array.from(x.layers),[R]=[...x.layersWithOutsidePointerEventsDisabled].slice(-1),L=k.indexOf(R),j=S?k.indexOf(S):-1,F=x.layersWithOutsidePointerEventsDisabled.size>0,B=j>=L,U=uge(X=>{const te=X.target,se=[...x.branches].some(oe=>oe.contains(te));!B||se||(o==null||o(X),d==null||d(X),X.defaultPrevented||i==null||i())},A),Z=dge(X=>{const te=X.target;[...x.branches].some(oe=>oe.contains(te))||(l==null||l(X),d==null||d(X),X.defaultPrevented||i==null||i())},A);return age(X=>{j===x.layers.size-1&&(n==null||n(X),!X.defaultPrevented&&i&&(X.preventDefault(),i()))},A),G.useEffect(()=>{if(S)return r&&(x.layersWithOutsidePointerEventsDisabled.size===0&&(uq=A.body.style.pointerEvents,A.body.style.pointerEvents="none"),x.layersWithOutsidePointerEventsDisabled.add(S)),x.layers.add(S),dq(),()=>{r&&x.layersWithOutsidePointerEventsDisabled.size===1&&(A.body.style.pointerEvents=uq)}},[S,A,r,x]),G.useEffect(()=>()=>{S&&(x.layers.delete(S),x.layersWithOutsidePointerEventsDisabled.delete(S),dq())},[S,x]),G.useEffect(()=>{const X=()=>C({});return document.addEventListener(vL,X),()=>document.removeEventListener(vL,X)},[]),m.jsx(bn.div,{...g,ref:N,style:{pointerEvents:F?B?"auto":"none":void 0,...e.style},onFocusCapture:Rr(e.onFocusCapture,Z.onFocusCapture),onBlurCapture:Rr(e.onBlurCapture,Z.onBlurCapture),onPointerDownCapture:Rr(e.onPointerDownCapture,U.onPointerDownCapture)})});Ev.displayName=oge;var cge="DismissableLayerBranch",xY=G.forwardRef((e,t)=>{const r=G.useContext(_Y),n=G.useRef(null),o=hi(t,n);return G.useEffect(()=>{const l=n.current;if(l)return r.branches.add(l),()=>{r.branches.delete(l)}},[r.branches]),m.jsx(bn.div,{...e,ref:o})});xY.displayName=cge;function uge(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e),n=G.useRef(!1),o=G.useRef(()=>{});return G.useEffect(()=>{const l=i=>{if(i.target&&!n.current){let g=function(){bY(sge,r,x,{discrete:!0})};const x={originalEvent:i};i.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=g,t.addEventListener("click",o.current,{once:!0})):g()}else t.removeEventListener("click",o.current);n.current=!1},d=window.setTimeout(()=>{t.addEventListener("pointerdown",l)},0);return()=>{window.clearTimeout(d),t.removeEventListener("pointerdown",l),t.removeEventListener("click",o.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function dge(e,t=globalThis==null?void 0:globalThis.document){const r=Io(e),n=G.useRef(!1);return G.useEffect(()=>{const o=l=>{l.target&&!n.current&&bY(lge,r,{originalEvent:l},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function dq(){const e=new CustomEvent(vL);document.dispatchEvent(e)}function bY(e,t,r,{discrete:n}){const o=r.originalEvent.target,l=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&o.addEventListener(e,t,{once:!0}),n?iB(o,l):o.dispatchEvent(l)}var hge=Ev,fge=xY,ko=globalThis!=null&&globalThis.document?G.useLayoutEffect:()=>{},pge="Portal",_b=G.forwardRef((e,t)=>{var i;const{container:r,...n}=e,[o,l]=G.useState(!1);ko(()=>l(!0),[]);const d=r||o&&((i=globalThis==null?void 0:globalThis.document)==null?void 0:i.body);return d?mY.createPortal(m.jsx(bn.div,{...n,ref:t}),d):null});_b.displayName=pge;function mge(e,t){return G.useReducer((r,n)=>t[r][n]??r,e)}var ys=e=>{const{present:t,children:r}=e,n=gge(t),o=typeof r=="function"?r({present:n.isPresent}):G.Children.only(r),l=hi(n.ref,yge(o));return typeof r=="function"||n.isPresent?G.cloneElement(o,{ref:l}):null};ys.displayName="Presence";function gge(e){const[t,r]=G.useState(),n=G.useRef(null),o=G.useRef(e),l=G.useRef("none"),d=e?"mounted":"unmounted",[i,g]=mge(d,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return G.useEffect(()=>{const x=mP(n.current);l.current=i==="mounted"?x:"none"},[i]),ko(()=>{const x=n.current,S=o.current;if(S!==e){const A=l.current,C=mP(x);e?g("MOUNT"):C==="none"||(x==null?void 0:x.display)==="none"?g("UNMOUNT"):g(S&&A!==C?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,g]),ko(()=>{if(t){let x;const S=t.ownerDocument.defaultView??window,E=C=>{const k=mP(n.current).includes(C.animationName);if(C.target===t&&k&&(g("ANIMATION_END"),!o.current)){const R=t.style.animationFillMode;t.style.animationFillMode="forwards",x=S.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=R)})}},A=C=>{C.target===t&&(l.current=mP(n.current))};return t.addEventListener("animationstart",A),t.addEventListener("animationcancel",E),t.addEventListener("animationend",E),()=>{S.clearTimeout(x),t.removeEventListener("animationstart",A),t.removeEventListener("animationcancel",E),t.removeEventListener("animationend",E)}}else g("ANIMATION_END")},[t,g]),{isPresent:["mounted","unmountSuspended"].includes(i),ref:G.useCallback(x=>{n.current=x?getComputedStyle(x):null,r(x)},[])}}function mP(e){return(e==null?void 0:e.animationName)||"none"}function yge(e){var n,o;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var vge=fz[" useInsertionEffect ".trim().toString()]||ko;function Ru({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[o,l,d]=_ge({defaultProp:t,onChange:r}),i=e!==void 0,g=i?e:o;{const S=G.useRef(e!==void 0);G.useEffect(()=>{const E=S.current;E!==i&&console.warn(`${n} is changing from ${E?"controlled":"uncontrolled"} to ${i?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),S.current=i},[i,n])}const x=G.useCallback(S=>{var E;if(i){const A=xge(S)?S(e):S;A!==e&&((E=d.current)==null||E.call(d,A))}else l(S)},[i,e,l,d]);return[g,x]}function _ge({defaultProp:e,onChange:t}){const[r,n]=G.useState(e),o=G.useRef(r),l=G.useRef(t);return vge(()=>{l.current=t},[t]),G.useEffect(()=>{var d;o.current!==r&&((d=l.current)==null||d.call(l,r),o.current=r)},[r,o]),[r,n,l]}function xge(e){return typeof e=="function"}var wY=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),bge="VisuallyHidden",JI=G.forwardRef((e,t)=>m.jsx(bn.span,{...e,ref:t,style:{...wY,...e.style}}));JI.displayName=bge;var wge=JI,aB="ToastProvider",[oB,Sge,Ege]=YI("Toast"),[SY,yet]=Ks("Toast",[Ege]),[Tge,QI]=SY(aB),EY=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:o="right",swipeThreshold:l=50,children:d}=e,[i,g]=G.useState(null),[x,S]=G.useState(0),E=G.useRef(!1),A=G.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${aB}\`. Expected non-empty \`string\`.`),m.jsx(oB.Provider,{scope:t,children:m.jsx(Tge,{scope:t,label:r,duration:n,swipeDirection:o,swipeThreshold:l,toastCount:x,viewport:i,onViewportChange:g,onToastAdd:G.useCallback(()=>S(C=>C+1),[]),onToastRemove:G.useCallback(()=>S(C=>C-1),[]),isFocusedToastEscapeKeyDownRef:E,isClosePausedRef:A,children:d})})};EY.displayName=aB;var TY="ToastViewport",Age=["F8"],_L="toast.viewportPause",xL="toast.viewportResume",AY=G.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Age,label:o="Notifications ({hotkey})",...l}=e,d=QI(TY,r),i=Sge(r),g=G.useRef(null),x=G.useRef(null),S=G.useRef(null),E=G.useRef(null),A=hi(t,E,d.onViewportChange),C=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),N=d.toastCount>0;G.useEffect(()=>{const R=L=>{var F;n.length!==0&&n.every(B=>L[B]||L.code===B)&&((F=E.current)==null||F.focus())};return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[n]),G.useEffect(()=>{const R=g.current,L=E.current;if(N&&R&&L){const j=()=>{if(!d.isClosePausedRef.current){const Z=new CustomEvent(_L);L.dispatchEvent(Z),d.isClosePausedRef.current=!0}},F=()=>{if(d.isClosePausedRef.current){const Z=new CustomEvent(xL);L.dispatchEvent(Z),d.isClosePausedRef.current=!1}},B=Z=>{!R.contains(Z.relatedTarget)&&F()},U=()=>{R.contains(document.activeElement)||F()};return R.addEventListener("focusin",j),R.addEventListener("focusout",B),R.addEventListener("pointermove",j),R.addEventListener("pointerleave",U),window.addEventListener("blur",j),window.addEventListener("focus",F),()=>{R.removeEventListener("focusin",j),R.removeEventListener("focusout",B),R.removeEventListener("pointermove",j),R.removeEventListener("pointerleave",U),window.removeEventListener("blur",j),window.removeEventListener("focus",F)}}},[N,d.isClosePausedRef]);const k=G.useCallback(({tabbingDirection:R})=>{const j=i().map(F=>{const B=F.ref.current,U=[B,...zge(B)];return R==="forwards"?U:U.reverse()});return(R==="forwards"?j.reverse():j).flat()},[i]);return G.useEffect(()=>{const R=E.current;if(R){const L=j=>{var U,Z,X;const F=j.altKey||j.ctrlKey||j.metaKey;if(j.key==="Tab"&&!F){const te=document.activeElement,se=j.shiftKey;if(j.target===R&&se){(U=x.current)==null||U.focus();return}const ee=k({tabbingDirection:se?"backwards":"forwards"}),ie=ee.findIndex(he=>he===te);mM(ee.slice(ie+1))?j.preventDefault():se?(Z=x.current)==null||Z.focus():(X=S.current)==null||X.focus()}};return R.addEventListener("keydown",L),()=>R.removeEventListener("keydown",L)}},[i,k]),m.jsxs(fge,{ref:g,role:"region","aria-label":o.replace("{hotkey}",C),tabIndex:-1,style:{pointerEvents:N?void 0:"none"},children:[N&&m.jsx(bL,{ref:x,onFocusFromOutsideViewport:()=>{const R=k({tabbingDirection:"forwards"});mM(R)}}),m.jsx(oB.Slot,{scope:r,children:m.jsx(bn.ol,{tabIndex:-1,...l,ref:A})}),N&&m.jsx(bL,{ref:S,onFocusFromOutsideViewport:()=>{const R=k({tabbingDirection:"backwards"});mM(R)}})]})});AY.displayName=TY;var PY="ToastFocusProxy",bL=G.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...o}=e,l=QI(PY,r);return m.jsx(JI,{"aria-hidden":!0,tabIndex:0,...o,ref:t,style:{position:"fixed"},onFocus:d=>{var x;const i=d.relatedTarget;!((x=l.viewport)!=null&&x.contains(i))&&n()}})});bL.displayName=PY;var TT="Toast",Pge="toast.swipeStart",Cge="toast.swipeMove",Oge="toast.swipeCancel",Ige="toast.swipeEnd",CY=G.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:o,onOpenChange:l,...d}=e,[i,g]=Ru({prop:n,defaultProp:o??!0,onChange:l,caller:TT});return m.jsx(ys,{present:r||i,children:m.jsx(jge,{open:i,...d,ref:t,onClose:()=>g(!1),onPause:Io(e.onPause),onResume:Io(e.onResume),onSwipeStart:Rr(e.onSwipeStart,x=>{x.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Rr(e.onSwipeMove,x=>{const{x:S,y:E}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","move"),x.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${S}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${E}px`)}),onSwipeCancel:Rr(e.onSwipeCancel,x=>{x.currentTarget.setAttribute("data-swipe","cancel"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Rr(e.onSwipeEnd,x=>{const{x:S,y:E}=x.detail.delta;x.currentTarget.setAttribute("data-swipe","end"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),x.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),x.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${S}px`),x.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${E}px`),g(!1)})})})});CY.displayName=TT;var[kge,Rge]=SY(TT,{onClose(){}}),jge=G.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:o,open:l,onClose:d,onEscapeKeyDown:i,onPause:g,onResume:x,onSwipeStart:S,onSwipeMove:E,onSwipeCancel:A,onSwipeEnd:C,...N}=e,k=QI(TT,r),[R,L]=G.useState(null),j=hi(t,he=>L(he)),F=G.useRef(null),B=G.useRef(null),U=o||k.duration,Z=G.useRef(0),X=G.useRef(U),te=G.useRef(0),{onToastAdd:se,onToastRemove:oe}=k,ne=Io(()=>{var Se;(R==null?void 0:R.contains(document.activeElement))&&((Se=k.viewport)==null||Se.focus()),d()}),ee=G.useCallback(he=>{!he||he===1/0||(window.clearTimeout(te.current),Z.current=new Date().getTime(),te.current=window.setTimeout(ne,he))},[ne]);G.useEffect(()=>{const he=k.viewport;if(he){const Se=()=>{ee(X.current),x==null||x()},Ce=()=>{const fe=new Date().getTime()-Z.current;X.current=X.current-fe,window.clearTimeout(te.current),g==null||g()};return he.addEventListener(_L,Ce),he.addEventListener(xL,Se),()=>{he.removeEventListener(_L,Ce),he.removeEventListener(xL,Se)}}},[k.viewport,U,g,x,ee]),G.useEffect(()=>{l&&!k.isClosePausedRef.current&&ee(U)},[l,U,k.isClosePausedRef,ee]),G.useEffect(()=>(se(),()=>oe()),[se,oe]);const ie=G.useMemo(()=>R?MY(R):null,[R]);return k.viewport?m.jsxs(m.Fragment,{children:[ie&&m.jsx(Nge,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:ie}),m.jsx(kge,{scope:r,onClose:ne,children:Qm.createPortal(m.jsx(oB.ItemSlot,{scope:r,children:m.jsx(hge,{asChild:!0,onEscapeKeyDown:Rr(i,()=>{k.isFocusedToastEscapeKeyDownRef.current||ne(),k.isFocusedToastEscapeKeyDownRef.current=!1}),children:m.jsx(bn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":l?"open":"closed","data-swipe-direction":k.swipeDirection,...N,ref:j,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Rr(e.onKeyDown,he=>{he.key==="Escape"&&(i==null||i(he.nativeEvent),he.nativeEvent.defaultPrevented||(k.isFocusedToastEscapeKeyDownRef.current=!0,ne()))}),onPointerDown:Rr(e.onPointerDown,he=>{he.button===0&&(F.current={x:he.clientX,y:he.clientY})}),onPointerMove:Rr(e.onPointerMove,he=>{if(!F.current)return;const Se=he.clientX-F.current.x,Ce=he.clientY-F.current.y,fe=!!B.current,_e=["left","right"].includes(k.swipeDirection),be=["left","up"].includes(k.swipeDirection)?Math.min:Math.max,Pe=_e?be(0,Se):0,ye=_e?0:be(0,Ce),ge=he.pointerType==="touch"?10:2,ke={x:Pe,y:ye},Qe={originalEvent:he,delta:ke};fe?(B.current=ke,gP(Cge,E,Qe,{discrete:!1})):hq(ke,k.swipeDirection,ge)?(B.current=ke,gP(Pge,S,Qe,{discrete:!1}),he.target.setPointerCapture(he.pointerId)):(Math.abs(Se)>ge||Math.abs(Ce)>ge)&&(F.current=null)}),onPointerUp:Rr(e.onPointerUp,he=>{const Se=B.current,Ce=he.target;if(Ce.hasPointerCapture(he.pointerId)&&Ce.releasePointerCapture(he.pointerId),B.current=null,F.current=null,Se){const fe=he.currentTarget,_e={originalEvent:he,delta:Se};hq(Se,k.swipeDirection,k.swipeThreshold)?gP(Ige,C,_e,{discrete:!0}):gP(Oge,A,_e,{discrete:!0}),fe.addEventListener("click",be=>be.preventDefault(),{once:!0})}})})})}),k.viewport)})]}):null}),Nge=e=>{const{__scopeToast:t,children:r,...n}=e,o=QI(TT,t),[l,d]=G.useState(!1),[i,g]=G.useState(!1);return Lge(()=>d(!0)),G.useEffect(()=>{const x=window.setTimeout(()=>g(!0),1e3);return()=>window.clearTimeout(x)},[]),i?null:m.jsx(_b,{asChild:!0,children:m.jsx(JI,{...n,children:l&&m.jsxs(m.Fragment,{children:[o.label," ",r]})})})},Mge="ToastTitle",OY=G.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return m.jsx(bn.div,{...n,ref:t})});OY.displayName=Mge;var Dge="ToastDescription",IY=G.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return m.jsx(bn.div,{...n,ref:t})});IY.displayName=Dge;var kY="ToastAction",RY=G.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?m.jsx(NY,{altText:r,asChild:!0,children:m.jsx(sB,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${kY}\`. Expected non-empty \`string\`.`),null)});RY.displayName=kY;var jY="ToastClose",sB=G.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,o=Rge(jY,r);return m.jsx(NY,{asChild:!0,children:m.jsx(bn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,o.onClose)})})});sB.displayName=jY;var NY=G.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...o}=e;return m.jsx(bn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...o,ref:t})});function MY(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),Fge(n)){const o=n.ariaHidden||n.hidden||n.style.display==="none",l=n.dataset.radixToastAnnounceExclude==="";if(!o)if(l){const d=n.dataset.radixToastAnnounceAlt;d&&t.push(d)}else t.push(...MY(n))}}),t}function gP(e,t,r,{discrete:n}){const o=r.originalEvent.currentTarget,l=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&o.addEventListener(e,t,{once:!0}),n?iB(o,l):o.dispatchEvent(l)}var hq=(e,t,r=0)=>{const n=Math.abs(e.x),o=Math.abs(e.y),l=n>o;return t==="left"||t==="right"?l&&n>r:!l&&o>r};function Lge(e=()=>{}){const t=Io(e);ko(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function Fge(e){return e.nodeType===e.ELEMENT_NODE}function zge(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function mM(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Bge=EY,DY=AY,LY=CY,FY=OY,zY=IY,BY=RY,$Y=sB;function UY(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(r=UY(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Ei(){for(var e,t,r=0,n="",o=arguments.length;r<o;r++)(e=arguments[r])&&(t=UY(e))&&(n&&(n+=" "),n+=t);return n}const fq=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,pq=Ei,xb=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return pq(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:o,defaultVariants:l}=t,d=Object.keys(o).map(x=>{const S=r==null?void 0:r[x],E=l==null?void 0:l[x];if(S===null)return null;const A=fq(S)||fq(E);return o[x][A]}),i=r&&Object.entries(r).reduce((x,S)=>{let[E,A]=S;return A===void 0||(x[E]=A),x},{}),g=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((x,S)=>{let{class:E,className:A,...C}=S;return Object.entries(C).every(N=>{let[k,R]=N;return Array.isArray(R)?R.includes({...l,...i}[k]):{...l,...i}[k]===R})?[...x,E,A]:x},[]);return pq(e,d,g,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $ge=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),VY=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Uge={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vge=G.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:o="",children:l,iconNode:d,...i},g)=>G.createElement("svg",{ref:g,...Uge,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:VY("lucide",o),...i},[...d.map(([x,S])=>G.createElement(x,S)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hn=(e,t)=>{const r=G.forwardRef(({className:n,...o},l)=>G.createElement(Vge,{ref:l,iconNode:t,className:VY(`lucide-${$ge(e)}`,n),...o}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=hn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qge=hn("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wge=hn("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qY=hn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yP=hn("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gge=hn("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $l=hn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hge=hn("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kge=hn("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zge=hn("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tf=hn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=hn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lB=hn("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WY=hn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xge=hn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yge=hn("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jge=hn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qge=hn("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eye=hn("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tye=hn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=hn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wL=hn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rye=hn("Dot",[["circle",{cx:"12.1",cy:"12.1",r:"1",key:"18d7e5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ek=hn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mq=hn("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nye=hn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=hn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=hn("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C0=hn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uB=hn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gq=hn("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iye=hn("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GY=hn("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HY=hn("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=hn("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aye=hn("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yq=hn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KY=hn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=hn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZY=hn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oye=hn("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XY=hn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yx=hn("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dB=hn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sye=hn("Minimize",[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=hn("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lye=hn("PanelLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=hn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cye=hn("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hB=hn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uye=hn("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tv=hn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dye=hn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zx=hn("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tk=hn("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hc=hn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hye=hn("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fB=hn("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wc=hn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qo=hn("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bb=hn("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YY=hn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O0=hn("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JY=hn("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qS=hn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=hn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yu=hn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QY=hn("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fye=hn("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ju=hn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),pB="-",pye=e=>{const t=gye(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:d=>{const i=d.split(pB);return i[0]===""&&i.length!==1&&i.shift(),eJ(i,t)||mye(d)},getConflictingClassGroupIds:(d,i)=>{const g=r[d]||[];return i&&n[d]?[...g,...n[d]]:g}}},eJ=(e,t)=>{var d;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),o=n?eJ(e.slice(1),n):void 0;if(o)return o;if(t.validators.length===0)return;const l=e.join(pB);return(d=t.validators.find(({validator:i})=>i(l)))==null?void 0:d.classGroupId},vq=/^\[(.+)\]$/,mye=e=>{if(vq.test(e)){const t=vq.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},gye=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return vye(Object.entries(e.classGroups),r).forEach(([l,d])=>{SL(d,n,l,t)}),n},SL=(e,t,r,n)=>{e.forEach(o=>{if(typeof o=="string"){const l=o===""?t:_q(t,o);l.classGroupId=r;return}if(typeof o=="function"){if(yye(o)){SL(o(n),t,r,n);return}t.validators.push({validator:o,classGroupId:r});return}Object.entries(o).forEach(([l,d])=>{SL(d,_q(t,l),r,n)})})},_q=(e,t)=>{let r=e;return t.split(pB).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},yye=e=>e.isThemeGetter,vye=(e,t)=>t?e.map(([r,n])=>{const o=n.map(l=>typeof l=="string"?t+l:typeof l=="object"?Object.fromEntries(Object.entries(l).map(([d,i])=>[t+d,i])):l);return[r,o]}):e,_ye=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const o=(l,d)=>{r.set(l,d),t++,t>e&&(t=0,n=r,r=new Map)};return{get(l){let d=r.get(l);if(d!==void 0)return d;if((d=n.get(l))!==void 0)return o(l,d),d},set(l,d){r.has(l)?r.set(l,d):o(l,d)}}},tJ="!",xye=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,o=t[0],l=t.length,d=i=>{const g=[];let x=0,S=0,E;for(let R=0;R<i.length;R++){let L=i[R];if(x===0){if(L===o&&(n||i.slice(R,R+l)===t)){g.push(i.slice(S,R)),S=R+l;continue}if(L==="/"){E=R;continue}}L==="["?x++:L==="]"&&x--}const A=g.length===0?i:i.substring(S),C=A.startsWith(tJ),N=C?A.substring(1):A,k=E&&E>S?E-S:void 0;return{modifiers:g,hasImportantModifier:C,baseClassName:N,maybePostfixModifierPosition:k}};return r?i=>r({className:i,parseClassName:d}):d},bye=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},wye=e=>({cache:_ye(e.cacheSize),parseClassName:xye(e),...pye(e)}),Sye=/\s+/,Eye=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:o}=t,l=[],d=e.trim().split(Sye);let i="";for(let g=d.length-1;g>=0;g-=1){const x=d[g],{modifiers:S,hasImportantModifier:E,baseClassName:A,maybePostfixModifierPosition:C}=r(x);let N=!!C,k=n(N?A.substring(0,C):A);if(!k){if(!N){i=x+(i.length>0?" "+i:i);continue}if(k=n(A),!k){i=x+(i.length>0?" "+i:i);continue}N=!1}const R=bye(S).join(":"),L=E?R+tJ:R,j=L+k;if(l.includes(j))continue;l.push(j);const F=o(k,N);for(let B=0;B<F.length;++B){const U=F[B];l.push(L+U)}i=x+(i.length>0?" "+i:i)}return i};function Tye(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=rJ(t))&&(n&&(n+=" "),n+=r);return n}const rJ=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=rJ(e[n]))&&(r&&(r+=" "),r+=t);return r};function Aye(e,...t){let r,n,o,l=d;function d(g){const x=t.reduce((S,E)=>E(S),e());return r=wye(x),n=r.cache.get,o=r.cache.set,l=i,i(g)}function i(g){const x=n(g);if(x)return x;const S=Eye(g,r);return o(g,S),S}return function(){return l(Tye.apply(null,arguments))}}const to=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},nJ=/^\[(?:([a-z-]+):)?(.+)\]$/i,Pye=/^\d+\/\d+$/,Cye=new Set(["px","full","screen"]),Oye=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Iye=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,kye=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Rye=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,jye=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,of=e=>Jx(e)||Cye.has(e)||Pye.test(e),$p=e=>wb(e,"length",$ye),Jx=e=>!!e&&!Number.isNaN(Number(e)),vM=e=>wb(e,"number",Jx),nS=e=>!!e&&Number.isInteger(Number(e)),Nye=e=>e.endsWith("%")&&Jx(e.slice(0,-1)),Oi=e=>nJ.test(e),Up=e=>Oye.test(e),Mye=new Set(["length","size","percentage"]),Dye=e=>wb(e,Mye,iJ),Lye=e=>wb(e,"position",iJ),Fye=new Set(["image","url"]),zye=e=>wb(e,Fye,Vye),Bye=e=>wb(e,"",Uye),iS=()=>!0,wb=(e,t,r)=>{const n=nJ.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},$ye=e=>Iye.test(e)&&!kye.test(e),iJ=()=>!1,Uye=e=>Rye.test(e),Vye=e=>jye.test(e),qye=()=>{const e=to("colors"),t=to("spacing"),r=to("blur"),n=to("brightness"),o=to("borderColor"),l=to("borderRadius"),d=to("borderSpacing"),i=to("borderWidth"),g=to("contrast"),x=to("grayscale"),S=to("hueRotate"),E=to("invert"),A=to("gap"),C=to("gradientColorStops"),N=to("gradientColorStopPositions"),k=to("inset"),R=to("margin"),L=to("opacity"),j=to("padding"),F=to("saturate"),B=to("scale"),U=to("sepia"),Z=to("skew"),X=to("space"),te=to("translate"),se=()=>["auto","contain","none"],oe=()=>["auto","hidden","clip","visible","scroll"],ne=()=>["auto",Oi,t],ee=()=>[Oi,t],ie=()=>["",of,$p],he=()=>["auto",Jx,Oi],Se=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Ce=()=>["solid","dashed","dotted","double","none"],fe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],_e=()=>["start","end","center","between","around","evenly","stretch"],be=()=>["","0",Oi],Pe=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ye=()=>[Jx,Oi];return{cacheSize:500,separator:":",theme:{colors:[iS],spacing:[of,$p],blur:["none","",Up,Oi],brightness:ye(),borderColor:[e],borderRadius:["none","","full",Up,Oi],borderSpacing:ee(),borderWidth:ie(),contrast:ye(),grayscale:be(),hueRotate:ye(),invert:be(),gap:ee(),gradientColorStops:[e],gradientColorStopPositions:[Nye,$p],inset:ne(),margin:ne(),opacity:ye(),padding:ee(),saturate:ye(),scale:ye(),sepia:be(),skew:ye(),space:ee(),translate:ee()},classGroups:{aspect:[{aspect:["auto","square","video",Oi]}],container:["container"],columns:[{columns:[Up]}],"break-after":[{"break-after":Pe()}],"break-before":[{"break-before":Pe()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...Se(),Oi]}],overflow:[{overflow:oe()}],"overflow-x":[{"overflow-x":oe()}],"overflow-y":[{"overflow-y":oe()}],overscroll:[{overscroll:se()}],"overscroll-x":[{"overscroll-x":se()}],"overscroll-y":[{"overscroll-y":se()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[k]}],"inset-x":[{"inset-x":[k]}],"inset-y":[{"inset-y":[k]}],start:[{start:[k]}],end:[{end:[k]}],top:[{top:[k]}],right:[{right:[k]}],bottom:[{bottom:[k]}],left:[{left:[k]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",nS,Oi]}],basis:[{basis:ne()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Oi]}],grow:[{grow:be()}],shrink:[{shrink:be()}],order:[{order:["first","last","none",nS,Oi]}],"grid-cols":[{"grid-cols":[iS]}],"col-start-end":[{col:["auto",{span:["full",nS,Oi]},Oi]}],"col-start":[{"col-start":he()}],"col-end":[{"col-end":he()}],"grid-rows":[{"grid-rows":[iS]}],"row-start-end":[{row:["auto",{span:[nS,Oi]},Oi]}],"row-start":[{"row-start":he()}],"row-end":[{"row-end":he()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Oi]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Oi]}],gap:[{gap:[A]}],"gap-x":[{"gap-x":[A]}],"gap-y":[{"gap-y":[A]}],"justify-content":[{justify:["normal",..._e()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",..._e(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[..._e(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[j]}],px:[{px:[j]}],py:[{py:[j]}],ps:[{ps:[j]}],pe:[{pe:[j]}],pt:[{pt:[j]}],pr:[{pr:[j]}],pb:[{pb:[j]}],pl:[{pl:[j]}],m:[{m:[R]}],mx:[{mx:[R]}],my:[{my:[R]}],ms:[{ms:[R]}],me:[{me:[R]}],mt:[{mt:[R]}],mr:[{mr:[R]}],mb:[{mb:[R]}],ml:[{ml:[R]}],"space-x":[{"space-x":[X]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[X]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Oi,t]}],"min-w":[{"min-w":[Oi,t,"min","max","fit"]}],"max-w":[{"max-w":[Oi,t,"none","full","min","max","fit","prose",{screen:[Up]},Up]}],h:[{h:[Oi,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Oi,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Oi,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Oi,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Up,$p]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",vM]}],"font-family":[{font:[iS]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Oi]}],"line-clamp":[{"line-clamp":["none",Jx,vM]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",of,Oi]}],"list-image":[{"list-image":["none",Oi]}],"list-style-type":[{list:["none","disc","decimal",Oi]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[L]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[L]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Ce(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",of,$p]}],"underline-offset":[{"underline-offset":["auto",of,Oi]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:ee()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Oi]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Oi]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[L]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...Se(),Lye]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Dye]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zye]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[N]}],"gradient-via-pos":[{via:[N]}],"gradient-to-pos":[{to:[N]}],"gradient-from":[{from:[C]}],"gradient-via":[{via:[C]}],"gradient-to":[{to:[C]}],rounded:[{rounded:[l]}],"rounded-s":[{"rounded-s":[l]}],"rounded-e":[{"rounded-e":[l]}],"rounded-t":[{"rounded-t":[l]}],"rounded-r":[{"rounded-r":[l]}],"rounded-b":[{"rounded-b":[l]}],"rounded-l":[{"rounded-l":[l]}],"rounded-ss":[{"rounded-ss":[l]}],"rounded-se":[{"rounded-se":[l]}],"rounded-ee":[{"rounded-ee":[l]}],"rounded-es":[{"rounded-es":[l]}],"rounded-tl":[{"rounded-tl":[l]}],"rounded-tr":[{"rounded-tr":[l]}],"rounded-br":[{"rounded-br":[l]}],"rounded-bl":[{"rounded-bl":[l]}],"border-w":[{border:[i]}],"border-w-x":[{"border-x":[i]}],"border-w-y":[{"border-y":[i]}],"border-w-s":[{"border-s":[i]}],"border-w-e":[{"border-e":[i]}],"border-w-t":[{"border-t":[i]}],"border-w-r":[{"border-r":[i]}],"border-w-b":[{"border-b":[i]}],"border-w-l":[{"border-l":[i]}],"border-opacity":[{"border-opacity":[L]}],"border-style":[{border:[...Ce(),"hidden"]}],"divide-x":[{"divide-x":[i]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[i]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[L]}],"divide-style":[{divide:Ce()}],"border-color":[{border:[o]}],"border-color-x":[{"border-x":[o]}],"border-color-y":[{"border-y":[o]}],"border-color-s":[{"border-s":[o]}],"border-color-e":[{"border-e":[o]}],"border-color-t":[{"border-t":[o]}],"border-color-r":[{"border-r":[o]}],"border-color-b":[{"border-b":[o]}],"border-color-l":[{"border-l":[o]}],"divide-color":[{divide:[o]}],"outline-style":[{outline:["",...Ce()]}],"outline-offset":[{"outline-offset":[of,Oi]}],"outline-w":[{outline:[of,$p]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:ie()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[L]}],"ring-offset-w":[{"ring-offset":[of,$p]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",Up,Bye]}],"shadow-color":[{shadow:[iS]}],opacity:[{opacity:[L]}],"mix-blend":[{"mix-blend":[...fe(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":fe()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[g]}],"drop-shadow":[{"drop-shadow":["","none",Up,Oi]}],grayscale:[{grayscale:[x]}],"hue-rotate":[{"hue-rotate":[S]}],invert:[{invert:[E]}],saturate:[{saturate:[F]}],sepia:[{sepia:[U]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[g]}],"backdrop-grayscale":[{"backdrop-grayscale":[x]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[S]}],"backdrop-invert":[{"backdrop-invert":[E]}],"backdrop-opacity":[{"backdrop-opacity":[L]}],"backdrop-saturate":[{"backdrop-saturate":[F]}],"backdrop-sepia":[{"backdrop-sepia":[U]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[d]}],"border-spacing-x":[{"border-spacing-x":[d]}],"border-spacing-y":[{"border-spacing-y":[d]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Oi]}],duration:[{duration:ye()}],ease:[{ease:["linear","in","out","in-out",Oi]}],delay:[{delay:ye()}],animate:[{animate:["none","spin","ping","pulse","bounce",Oi]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[B]}],"scale-x":[{"scale-x":[B]}],"scale-y":[{"scale-y":[B]}],rotate:[{rotate:[nS,Oi]}],"translate-x":[{"translate-x":[te]}],"translate-y":[{"translate-y":[te]}],"skew-x":[{"skew-x":[Z]}],"skew-y":[{"skew-y":[Z]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Oi]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Oi]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":ee()}],"scroll-mx":[{"scroll-mx":ee()}],"scroll-my":[{"scroll-my":ee()}],"scroll-ms":[{"scroll-ms":ee()}],"scroll-me":[{"scroll-me":ee()}],"scroll-mt":[{"scroll-mt":ee()}],"scroll-mr":[{"scroll-mr":ee()}],"scroll-mb":[{"scroll-mb":ee()}],"scroll-ml":[{"scroll-ml":ee()}],"scroll-p":[{"scroll-p":ee()}],"scroll-px":[{"scroll-px":ee()}],"scroll-py":[{"scroll-py":ee()}],"scroll-ps":[{"scroll-ps":ee()}],"scroll-pe":[{"scroll-pe":ee()}],"scroll-pt":[{"scroll-pt":ee()}],"scroll-pr":[{"scroll-pr":ee()}],"scroll-pb":[{"scroll-pb":ee()}],"scroll-pl":[{"scroll-pl":ee()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Oi]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[of,$p,vM]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Wye=Aye(qye);function _r(...e){return Wye(Ei(e))}const Gye=Bge,aJ=G.forwardRef(({className:e,...t},r)=>m.jsx(DY,{ref:r,className:_r("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));aJ.displayName=DY.displayName;const Hye=xb("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),oJ=G.forwardRef(({className:e,variant:t,...r},n)=>m.jsx(LY,{ref:n,className:_r(Hye({variant:t}),e),...r}));oJ.displayName=LY.displayName;const Kye=G.forwardRef(({className:e,...t},r)=>m.jsx(BY,{ref:r,className:_r("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));Kye.displayName=BY.displayName;const sJ=G.forwardRef(({className:e,...t},r)=>m.jsx($Y,{ref:r,className:_r("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:m.jsx(ju,{className:"h-4 w-4"})}));sJ.displayName=$Y.displayName;const lJ=G.forwardRef(({className:e,...t},r)=>m.jsx(FY,{ref:r,className:_r("text-sm font-semibold",e),...t}));lJ.displayName=FY.displayName;const cJ=G.forwardRef(({className:e,...t},r)=>m.jsx(zY,{ref:r,className:_r("text-sm opacity-90",e),...t}));cJ.displayName=zY.displayName;function Zye(){const{toasts:e}=wa();return m.jsxs(Gye,{children:[e.map(function({id:t,title:r,description:n,action:o,...l}){return m.jsxs(oJ,{...l,children:[m.jsxs("div",{className:"grid gap-1",children:[r&&m.jsx(lJ,{children:r}),n&&m.jsx(cJ,{children:n})]}),o,m.jsx(sJ,{})]},t)}),m.jsx(aJ,{})]})}var xq=["light","dark"],Xye="(prefers-color-scheme: dark)",Yye=G.createContext(void 0),Jye={setTheme:e=>{},themes:[]},Qye=()=>{var e;return(e=G.useContext(Yye))!=null?e:Jye};G.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:o,defaultTheme:l,value:d,attrs:i,nonce:g})=>{let x=l==="system",S=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${i.map(N=>`'${N}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,E=o?xq.includes(l)&&l?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${l}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",A=(N,k=!1,R=!0)=>{let L=d?d[N]:N,j=k?N+"|| ''":`'${L}'`,F="";return o&&R&&!k&&xq.includes(N)&&(F+=`d.style.colorScheme = '${N}';`),r==="class"?k||L?F+=`c.add(${j})`:F+="null":L&&(F+=`d[s](n,${j})`),F},C=e?`!function(){${S}${A(e)}}()`:n?`!function(){try{${S}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${x})){var t='${Xye}',m=window.matchMedia(t);if(m.media!==t||m.matches){${A("dark")}}else{${A("light")}}}else if(e){${d?`var x=${JSON.stringify(d)};`:""}${A(d?"x[e]":"e",!0)}}${x?"":"else{"+A(l,!1,!1)+"}"}${E}}catch(e){}}()`:`!function(){try{${S}var e=localStorage.getItem('${t}');if(e){${d?`var x=${JSON.stringify(d)};`:""}${A(d?"x[e]":"e",!0)}}else{${A(l,!1,!1)};}${E}}catch(t){}}();`;return G.createElement("script",{nonce:g,dangerouslySetInnerHTML:{__html:C}})});var eve=e=>{switch(e){case"success":return nve;case"info":return ave;case"warning":return ive;case"error":return ove;default:return null}},tve=Array(12).fill(0),rve=({visible:e,className:t})=>We.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},We.createElement("div",{className:"sonner-spinner"},tve.map((r,n)=>We.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),nve=We.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},We.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),ive=We.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},We.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ave=We.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},We.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),ove=We.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},We.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),sve=We.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},We.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),We.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),lve=()=>{let[e,t]=We.useState(document.hidden);return We.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},EL=1,cve=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,o=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:EL++,l=this.toasts.find(i=>i.id===o),d=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(o)&&this.dismissedToasts.delete(o),l?this.toasts=this.toasts.map(i=>i.id===o?(this.publish({...i,...e,id:o,title:r}),{...i,...e,id:o,dismissible:d,title:r}):i):this.addToast({title:r,...n,dismissible:d,id:o}),o},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),o=r!==void 0,l,d=n.then(async g=>{if(l=["resolve",g],We.isValidElement(g))o=!1,this.create({id:r,type:"default",message:g});else if(dve(g)&&!g.ok){o=!1;let x=typeof t.error=="function"?await t.error(`HTTP error! status: ${g.status}`):t.error,S=typeof t.description=="function"?await t.description(`HTTP error! status: ${g.status}`):t.description;this.create({id:r,type:"error",message:x,description:S})}else if(t.success!==void 0){o=!1;let x=typeof t.success=="function"?await t.success(g):t.success,S=typeof t.description=="function"?await t.description(g):t.description;this.create({id:r,type:"success",message:x,description:S})}}).catch(async g=>{if(l=["reject",g],t.error!==void 0){o=!1;let x=typeof t.error=="function"?await t.error(g):t.error,S=typeof t.description=="function"?await t.description(g):t.description;this.create({id:r,type:"error",message:x,description:S})}}).finally(()=>{var g;o&&(this.dismiss(r),r=void 0),(g=t.finally)==null||g.call(t)}),i=()=>new Promise((g,x)=>d.then(()=>l[0]==="reject"?x(l[1]):g(l[1])).catch(x));return typeof r!="string"&&typeof r!="number"?{unwrap:i}:Object.assign(r,{unwrap:i})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||EL++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},fc=new cve,uve=(e,t)=>{let r=(t==null?void 0:t.id)||EL++;return fc.addToast({title:e,...t,id:r}),r},dve=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",hve=uve,fve=()=>fc.toasts,pve=()=>fc.getActiveToasts(),Vr=Object.assign(hve,{success:fc.success,info:fc.info,warning:fc.warning,error:fc.error,custom:fc.custom,message:fc.message,promise:fc.promise,dismiss:fc.dismiss,loading:fc.loading},{getHistory:fve,getToasts:pve});function mve(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}mve(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function vP(e){return e.label!==void 0}var gve=3,yve="32px",vve="16px",bq=4e3,_ve=356,xve=14,bve=20,wve=200;function id(...e){return e.filter(Boolean).join(" ")}function Sve(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var Eve=e=>{var t,r,n,o,l,d,i,g,x,S,E;let{invert:A,toast:C,unstyled:N,interacting:k,setHeights:R,visibleToasts:L,heights:j,index:F,toasts:B,expanded:U,removeToast:Z,defaultRichColors:X,closeButton:te,style:se,cancelButtonStyle:oe,actionButtonStyle:ne,className:ee="",descriptionClassName:ie="",duration:he,position:Se,gap:Ce,loadingIcon:fe,expandByDefault:_e,classNames:be,icons:Pe,closeButtonAriaLabel:ye="Close toast",pauseWhenPageIsHidden:ge}=e,[ke,Qe]=We.useState(null),[He,$e]=We.useState(null),[Xe,ft]=We.useState(!1),[ze,ut]=We.useState(!1),[At,xt]=We.useState(!1),[nr,Vt]=We.useState(!1),[dr,Br]=We.useState(!1),[Yr,_t]=We.useState(0),[Mt,Ke]=We.useState(0),at=We.useRef(C.duration||he||bq),dt=We.useRef(null),tr=We.useRef(null),Qt=F===0,er=F+1<=L,Pr=C.type,sn=C.dismissible!==!1,fn=C.className||"",Ai=C.descriptionClassName||"",mi=We.useMemo(()=>j.findIndex(On=>On.toastId===C.id)||0,[j,C.id]),Zi=We.useMemo(()=>{var On;return(On=C.closeButton)!=null?On:te},[C.closeButton,te]),Rs=We.useMemo(()=>C.duration||he||bq,[C.duration,he]),Ua=We.useRef(0),wi=We.useRef(0),_s=We.useRef(0),zo=We.useRef(null),[js,Bo]=Se.split("-"),ts=We.useMemo(()=>j.reduce((On,Ii,ha)=>ha>=mi?On:On+Ii.height,0),[j,mi]),ji=lve(),oo=C.invert||A,ml=Pr==="loading";wi.current=We.useMemo(()=>mi*Ce+ts,[mi,ts]),We.useEffect(()=>{at.current=Rs},[Rs]),We.useEffect(()=>{ft(!0)},[]),We.useEffect(()=>{let On=tr.current;if(On){let Ii=On.getBoundingClientRect().height;return Ke(Ii),R(ha=>[{toastId:C.id,height:Ii,position:C.position},...ha]),()=>R(ha=>ha.filter($o=>$o.toastId!==C.id))}},[R,C.id]),We.useLayoutEffect(()=>{if(!Xe)return;let On=tr.current,Ii=On.style.height;On.style.height="auto";let ha=On.getBoundingClientRect().height;On.style.height=Ii,Ke(ha),R($o=>$o.find(Nt=>Nt.toastId===C.id)?$o.map(Nt=>Nt.toastId===C.id?{...Nt,height:ha}:Nt):[{toastId:C.id,height:ha,position:C.position},...$o])},[Xe,C.title,C.description,R,C.id]);let xr=We.useCallback(()=>{ut(!0),_t(wi.current),R(On=>On.filter(Ii=>Ii.toastId!==C.id)),setTimeout(()=>{Z(C)},wve)},[C,Z,R,wi]);We.useEffect(()=>{if(C.promise&&Pr==="loading"||C.duration===1/0||C.type==="loading")return;let On;return U||k||ge&&ji?(()=>{if(_s.current<Ua.current){let Ii=new Date().getTime()-Ua.current;at.current=at.current-Ii}_s.current=new Date().getTime()})():at.current!==1/0&&(Ua.current=new Date().getTime(),On=setTimeout(()=>{var Ii;(Ii=C.onAutoClose)==null||Ii.call(C,C),xr()},at.current)),()=>clearTimeout(On)},[U,k,C,Pr,ge,ji,xr]),We.useEffect(()=>{C.delete&&xr()},[xr,C.delete]);function wn(){var On,Ii,ha;return Pe!=null&&Pe.loading?We.createElement("div",{className:id(be==null?void 0:be.loader,(On=C==null?void 0:C.classNames)==null?void 0:On.loader,"sonner-loader"),"data-visible":Pr==="loading"},Pe.loading):fe?We.createElement("div",{className:id(be==null?void 0:be.loader,(Ii=C==null?void 0:C.classNames)==null?void 0:Ii.loader,"sonner-loader"),"data-visible":Pr==="loading"},fe):We.createElement(rve,{className:id(be==null?void 0:be.loader,(ha=C==null?void 0:C.classNames)==null?void 0:ha.loader),visible:Pr==="loading"})}return We.createElement("li",{tabIndex:0,ref:tr,className:id(ee,fn,be==null?void 0:be.toast,(t=C==null?void 0:C.classNames)==null?void 0:t.toast,be==null?void 0:be.default,be==null?void 0:be[Pr],(r=C==null?void 0:C.classNames)==null?void 0:r[Pr]),"data-sonner-toast":"","data-rich-colors":(n=C.richColors)!=null?n:X,"data-styled":!(C.jsx||C.unstyled||N),"data-mounted":Xe,"data-promise":!!C.promise,"data-swiped":dr,"data-removed":ze,"data-visible":er,"data-y-position":js,"data-x-position":Bo,"data-index":F,"data-front":Qt,"data-swiping":At,"data-dismissible":sn,"data-type":Pr,"data-invert":oo,"data-swipe-out":nr,"data-swipe-direction":He,"data-expanded":!!(U||_e&&Xe),style:{"--index":F,"--toasts-before":F,"--z-index":B.length-F,"--offset":`${ze?Yr:wi.current}px`,"--initial-height":_e?"auto":`${Mt}px`,...se,...C.style},onDragEnd:()=>{xt(!1),Qe(null),zo.current=null},onPointerDown:On=>{ml||!sn||(dt.current=new Date,_t(wi.current),On.target.setPointerCapture(On.pointerId),On.target.tagName!=="BUTTON"&&(xt(!0),zo.current={x:On.clientX,y:On.clientY}))},onPointerUp:()=>{var On,Ii,ha,$o;if(nr||!sn)return;zo.current=null;let Nt=Number(((On=tr.current)==null?void 0:On.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Uo=Number(((Ii=tr.current)==null?void 0:Ii.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),gl=new Date().getTime()-((ha=dt.current)==null?void 0:ha.getTime()),rs=ke==="x"?Nt:Uo,xn=Math.abs(rs)/gl;if(Math.abs(rs)>=bve||xn>.11){_t(wi.current),($o=C.onDismiss)==null||$o.call(C,C),$e(ke==="x"?Nt>0?"right":"left":Uo>0?"down":"up"),xr(),Vt(!0),Br(!1);return}xt(!1),Qe(null)},onPointerMove:On=>{var Ii,ha,$o,Nt;if(!zo.current||!sn||((Ii=window.getSelection())==null?void 0:Ii.toString().length)>0)return;let Uo=On.clientY-zo.current.y,gl=On.clientX-zo.current.x,rs=(ha=e.swipeDirections)!=null?ha:Sve(Se);!ke&&(Math.abs(gl)>1||Math.abs(Uo)>1)&&Qe(Math.abs(gl)>Math.abs(Uo)?"x":"y");let xn={x:0,y:0};ke==="y"?(rs.includes("top")||rs.includes("bottom"))&&(rs.includes("top")&&Uo<0||rs.includes("bottom")&&Uo>0)&&(xn.y=Uo):ke==="x"&&(rs.includes("left")||rs.includes("right"))&&(rs.includes("left")&&gl<0||rs.includes("right")&&gl>0)&&(xn.x=gl),(Math.abs(xn.x)>0||Math.abs(xn.y)>0)&&Br(!0),($o=tr.current)==null||$o.style.setProperty("--swipe-amount-x",`${xn.x}px`),(Nt=tr.current)==null||Nt.style.setProperty("--swipe-amount-y",`${xn.y}px`)}},Zi&&!C.jsx?We.createElement("button",{"aria-label":ye,"data-disabled":ml,"data-close-button":!0,onClick:ml||!sn?()=>{}:()=>{var On;xr(),(On=C.onDismiss)==null||On.call(C,C)},className:id(be==null?void 0:be.closeButton,(o=C==null?void 0:C.classNames)==null?void 0:o.closeButton)},(l=Pe==null?void 0:Pe.close)!=null?l:sve):null,C.jsx||G.isValidElement(C.title)?C.jsx?C.jsx:typeof C.title=="function"?C.title():C.title:We.createElement(We.Fragment,null,Pr||C.icon||C.promise?We.createElement("div",{"data-icon":"",className:id(be==null?void 0:be.icon,(d=C==null?void 0:C.classNames)==null?void 0:d.icon)},C.promise||C.type==="loading"&&!C.icon?C.icon||wn():null,C.type!=="loading"?C.icon||(Pe==null?void 0:Pe[Pr])||eve(Pr):null):null,We.createElement("div",{"data-content":"",className:id(be==null?void 0:be.content,(i=C==null?void 0:C.classNames)==null?void 0:i.content)},We.createElement("div",{"data-title":"",className:id(be==null?void 0:be.title,(g=C==null?void 0:C.classNames)==null?void 0:g.title)},typeof C.title=="function"?C.title():C.title),C.description?We.createElement("div",{"data-description":"",className:id(ie,Ai,be==null?void 0:be.description,(x=C==null?void 0:C.classNames)==null?void 0:x.description)},typeof C.description=="function"?C.description():C.description):null),G.isValidElement(C.cancel)?C.cancel:C.cancel&&vP(C.cancel)?We.createElement("button",{"data-button":!0,"data-cancel":!0,style:C.cancelButtonStyle||oe,onClick:On=>{var Ii,ha;vP(C.cancel)&&sn&&((ha=(Ii=C.cancel).onClick)==null||ha.call(Ii,On),xr())},className:id(be==null?void 0:be.cancelButton,(S=C==null?void 0:C.classNames)==null?void 0:S.cancelButton)},C.cancel.label):null,G.isValidElement(C.action)?C.action:C.action&&vP(C.action)?We.createElement("button",{"data-button":!0,"data-action":!0,style:C.actionButtonStyle||ne,onClick:On=>{var Ii,ha;vP(C.action)&&((ha=(Ii=C.action).onClick)==null||ha.call(Ii,On),!On.defaultPrevented&&xr())},className:id(be==null?void 0:be.actionButton,(E=C==null?void 0:C.classNames)==null?void 0:E.actionButton)},C.action.label):null))};function wq(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Tve(e,t){let r={};return[e,t].forEach((n,o)=>{let l=o===1,d=l?"--mobile-offset":"--offset",i=l?vve:yve;function g(x){["top","right","bottom","left"].forEach(S=>{r[`${d}-${S}`]=typeof x=="number"?`${x}px`:x})}typeof n=="number"||typeof n=="string"?g(n):typeof n=="object"?["top","right","bottom","left"].forEach(x=>{n[x]===void 0?r[`${d}-${x}`]=i:r[`${d}-${x}`]=typeof n[x]=="number"?`${n[x]}px`:n[x]}):g(i)}),r}var Ave=G.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:o=["altKey","KeyT"],expand:l,closeButton:d,className:i,offset:g,mobileOffset:x,theme:S="light",richColors:E,duration:A,style:C,visibleToasts:N=gve,toastOptions:k,dir:R=wq(),gap:L=xve,loadingIcon:j,icons:F,containerAriaLabel:B="Notifications",pauseWhenPageIsHidden:U}=e,[Z,X]=We.useState([]),te=We.useMemo(()=>Array.from(new Set([n].concat(Z.filter(ge=>ge.position).map(ge=>ge.position)))),[Z,n]),[se,oe]=We.useState([]),[ne,ee]=We.useState(!1),[ie,he]=We.useState(!1),[Se,Ce]=We.useState(S!=="system"?S:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),fe=We.useRef(null),_e=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),be=We.useRef(null),Pe=We.useRef(!1),ye=We.useCallback(ge=>{X(ke=>{var Qe;return(Qe=ke.find(He=>He.id===ge.id))!=null&&Qe.delete||fc.dismiss(ge.id),ke.filter(({id:He})=>He!==ge.id)})},[]);return We.useEffect(()=>fc.subscribe(ge=>{if(ge.dismiss){X(ke=>ke.map(Qe=>Qe.id===ge.id?{...Qe,delete:!0}:Qe));return}setTimeout(()=>{mY.flushSync(()=>{X(ke=>{let Qe=ke.findIndex(He=>He.id===ge.id);return Qe!==-1?[...ke.slice(0,Qe),{...ke[Qe],...ge},...ke.slice(Qe+1)]:[ge,...ke]})})})}),[]),We.useEffect(()=>{if(S!=="system"){Ce(S);return}if(S==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Ce("dark"):Ce("light")),typeof window>"u")return;let ge=window.matchMedia("(prefers-color-scheme: dark)");try{ge.addEventListener("change",({matches:ke})=>{Ce(ke?"dark":"light")})}catch{ge.addListener(({matches:Qe})=>{try{Ce(Qe?"dark":"light")}catch(He){console.error(He)}})}},[S]),We.useEffect(()=>{Z.length<=1&&ee(!1)},[Z]),We.useEffect(()=>{let ge=ke=>{var Qe,He;o.every($e=>ke[$e]||ke.code===$e)&&(ee(!0),(Qe=fe.current)==null||Qe.focus()),ke.code==="Escape"&&(document.activeElement===fe.current||(He=fe.current)!=null&&He.contains(document.activeElement))&&ee(!1)};return document.addEventListener("keydown",ge),()=>document.removeEventListener("keydown",ge)},[o]),We.useEffect(()=>{if(fe.current)return()=>{be.current&&(be.current.focus({preventScroll:!0}),be.current=null,Pe.current=!1)}},[fe.current]),We.createElement("section",{ref:t,"aria-label":`${B} ${_e}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},te.map((ge,ke)=>{var Qe;let[He,$e]=ge.split("-");return Z.length?We.createElement("ol",{key:ge,dir:R==="auto"?wq():R,tabIndex:-1,ref:fe,className:i,"data-sonner-toaster":!0,"data-theme":Se,"data-y-position":He,"data-lifted":ne&&Z.length>1&&!l,"data-x-position":$e,style:{"--front-toast-height":`${((Qe=se[0])==null?void 0:Qe.height)||0}px`,"--width":`${_ve}px`,"--gap":`${L}px`,...C,...Tve(g,x)},onBlur:Xe=>{Pe.current&&!Xe.currentTarget.contains(Xe.relatedTarget)&&(Pe.current=!1,be.current&&(be.current.focus({preventScroll:!0}),be.current=null))},onFocus:Xe=>{Xe.target instanceof HTMLElement&&Xe.target.dataset.dismissible==="false"||Pe.current||(Pe.current=!0,be.current=Xe.relatedTarget)},onMouseEnter:()=>ee(!0),onMouseMove:()=>ee(!0),onMouseLeave:()=>{ie||ee(!1)},onDragEnd:()=>ee(!1),onPointerDown:Xe=>{Xe.target instanceof HTMLElement&&Xe.target.dataset.dismissible==="false"||he(!0)},onPointerUp:()=>he(!1)},Z.filter(Xe=>!Xe.position&&ke===0||Xe.position===ge).map((Xe,ft)=>{var ze,ut;return We.createElement(Eve,{key:Xe.id,icons:F,index:ft,toast:Xe,defaultRichColors:E,duration:(ze=k==null?void 0:k.duration)!=null?ze:A,className:k==null?void 0:k.className,descriptionClassName:k==null?void 0:k.descriptionClassName,invert:r,visibleToasts:N,closeButton:(ut=k==null?void 0:k.closeButton)!=null?ut:d,interacting:ie,position:ge,style:k==null?void 0:k.style,unstyled:k==null?void 0:k.unstyled,classNames:k==null?void 0:k.classNames,cancelButtonStyle:k==null?void 0:k.cancelButtonStyle,actionButtonStyle:k==null?void 0:k.actionButtonStyle,removeToast:ye,toasts:Z.filter(At=>At.position==Xe.position),heights:se.filter(At=>At.position==Xe.position),setHeights:oe,expandByDefault:l,gap:L,loadingIcon:j,expanded:ne,pauseWhenPageIsHidden:U,swipeDirections:e.swipeDirections})})):null}))});const Pve=({...e})=>{const{theme:t="system"}=Qye();return m.jsx(Ave,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var Cve=fz[" useId ".trim().toString()]||(()=>{}),Ove=0;function Hc(e){const[t,r]=G.useState(Cve());return ko(()=>{r(n=>n??String(Ove++))},[e]),t?`radix-${t}`:""}const Ive=["top","right","bottom","left"],Um=Math.min,Bc=Math.max,YC=Math.round,_P=Math.floor,xh=e=>({x:e,y:e}),kve={left:"right",right:"left",bottom:"top",top:"bottom"},Rve={start:"end",end:"start"};function TL(e,t,r){return Bc(e,Um(t,r))}function Nf(e,t){return typeof e=="function"?e(t):e}function Mf(e){return e.split("-")[0]}function Sb(e){return e.split("-")[1]}function mB(e){return e==="x"?"y":"x"}function gB(e){return e==="y"?"height":"width"}const jve=new Set(["top","bottom"]);function uh(e){return jve.has(Mf(e))?"y":"x"}function yB(e){return mB(uh(e))}function Nve(e,t,r){r===void 0&&(r=!1);const n=Sb(e),o=yB(e),l=gB(o);let d=o==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[l]>t.floating[l]&&(d=JC(d)),[d,JC(d)]}function Mve(e){const t=JC(e);return[AL(e),t,AL(t)]}function AL(e){return e.replace(/start|end/g,t=>Rve[t])}const Sq=["left","right"],Eq=["right","left"],Dve=["top","bottom"],Lve=["bottom","top"];function Fve(e,t,r){switch(e){case"top":case"bottom":return r?t?Eq:Sq:t?Sq:Eq;case"left":case"right":return t?Dve:Lve;default:return[]}}function zve(e,t,r,n){const o=Sb(e);let l=Fve(Mf(e),r==="start",n);return o&&(l=l.map(d=>d+"-"+o),t&&(l=l.concat(l.map(AL)))),l}function JC(e){return e.replace(/left|right|bottom|top/g,t=>kve[t])}function Bve(e){return{top:0,right:0,bottom:0,left:0,...e}}function uJ(e){return typeof e!="number"?Bve(e):{top:e,right:e,bottom:e,left:e}}function QC(e){const{x:t,y:r,width:n,height:o}=e;return{width:n,height:o,top:r,left:t,right:t+n,bottom:r+o,x:t,y:r}}function Tq(e,t,r){let{reference:n,floating:o}=e;const l=uh(t),d=yB(t),i=gB(d),g=Mf(t),x=l==="y",S=n.x+n.width/2-o.width/2,E=n.y+n.height/2-o.height/2,A=n[i]/2-o[i]/2;let C;switch(g){case"top":C={x:S,y:n.y-o.height};break;case"bottom":C={x:S,y:n.y+n.height};break;case"right":C={x:n.x+n.width,y:E};break;case"left":C={x:n.x-o.width,y:E};break;default:C={x:n.x,y:n.y}}switch(Sb(t)){case"start":C[d]-=A*(r&&x?-1:1);break;case"end":C[d]+=A*(r&&x?-1:1);break}return C}const $ve=async(e,t,r)=>{const{placement:n="bottom",strategy:o="absolute",middleware:l=[],platform:d}=r,i=l.filter(Boolean),g=await(d.isRTL==null?void 0:d.isRTL(t));let x=await d.getElementRects({reference:e,floating:t,strategy:o}),{x:S,y:E}=Tq(x,n,g),A=n,C={},N=0;for(let k=0;k<i.length;k++){const{name:R,fn:L}=i[k],{x:j,y:F,data:B,reset:U}=await L({x:S,y:E,initialPlacement:n,placement:A,strategy:o,middlewareData:C,rects:x,platform:d,elements:{reference:e,floating:t}});S=j??S,E=F??E,C={...C,[R]:{...C[R],...B}},U&&N<=50&&(N++,typeof U=="object"&&(U.placement&&(A=U.placement),U.rects&&(x=U.rects===!0?await d.getElementRects({reference:e,floating:t,strategy:o}):U.rects),{x:S,y:E}=Tq(x,A,g)),k=-1)}return{x:S,y:E,placement:A,strategy:o,middlewareData:C}};async function _E(e,t){var r;t===void 0&&(t={});const{x:n,y:o,platform:l,rects:d,elements:i,strategy:g}=e,{boundary:x="clippingAncestors",rootBoundary:S="viewport",elementContext:E="floating",altBoundary:A=!1,padding:C=0}=Nf(t,e),N=uJ(C),R=i[A?E==="floating"?"reference":"floating":E],L=QC(await l.getClippingRect({element:(r=await(l.isElement==null?void 0:l.isElement(R)))==null||r?R:R.contextElement||await(l.getDocumentElement==null?void 0:l.getDocumentElement(i.floating)),boundary:x,rootBoundary:S,strategy:g})),j=E==="floating"?{x:n,y:o,width:d.floating.width,height:d.floating.height}:d.reference,F=await(l.getOffsetParent==null?void 0:l.getOffsetParent(i.floating)),B=await(l.isElement==null?void 0:l.isElement(F))?await(l.getScale==null?void 0:l.getScale(F))||{x:1,y:1}:{x:1,y:1},U=QC(l.convertOffsetParentRelativeRectToViewportRelativeRect?await l.convertOffsetParentRelativeRectToViewportRelativeRect({elements:i,rect:j,offsetParent:F,strategy:g}):j);return{top:(L.top-U.top+N.top)/B.y,bottom:(U.bottom-L.bottom+N.bottom)/B.y,left:(L.left-U.left+N.left)/B.x,right:(U.right-L.right+N.right)/B.x}}const Uve=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:o,rects:l,platform:d,elements:i,middlewareData:g}=t,{element:x,padding:S=0}=Nf(e,t)||{};if(x==null)return{};const E=uJ(S),A={x:r,y:n},C=yB(o),N=gB(C),k=await d.getDimensions(x),R=C==="y",L=R?"top":"left",j=R?"bottom":"right",F=R?"clientHeight":"clientWidth",B=l.reference[N]+l.reference[C]-A[C]-l.floating[N],U=A[C]-l.reference[C],Z=await(d.getOffsetParent==null?void 0:d.getOffsetParent(x));let X=Z?Z[F]:0;(!X||!await(d.isElement==null?void 0:d.isElement(Z)))&&(X=i.floating[F]||l.floating[N]);const te=B/2-U/2,se=X/2-k[N]/2-1,oe=Um(E[L],se),ne=Um(E[j],se),ee=oe,ie=X-k[N]-ne,he=X/2-k[N]/2+te,Se=TL(ee,he,ie),Ce=!g.arrow&&Sb(o)!=null&&he!==Se&&l.reference[N]/2-(he<ee?oe:ne)-k[N]/2<0,fe=Ce?he<ee?he-ee:he-ie:0;return{[C]:A[C]+fe,data:{[C]:Se,centerOffset:he-Se-fe,...Ce&&{alignmentOffset:fe}},reset:Ce}}}),Vve=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:o,middlewareData:l,rects:d,initialPlacement:i,platform:g,elements:x}=t,{mainAxis:S=!0,crossAxis:E=!0,fallbackPlacements:A,fallbackStrategy:C="bestFit",fallbackAxisSideDirection:N="none",flipAlignment:k=!0,...R}=Nf(e,t);if((r=l.arrow)!=null&&r.alignmentOffset)return{};const L=Mf(o),j=uh(i),F=Mf(i)===i,B=await(g.isRTL==null?void 0:g.isRTL(x.floating)),U=A||(F||!k?[JC(i)]:Mve(i)),Z=N!=="none";!A&&Z&&U.push(...zve(i,k,N,B));const X=[i,...U],te=await _E(t,R),se=[];let oe=((n=l.flip)==null?void 0:n.overflows)||[];if(S&&se.push(te[L]),E){const he=Nve(o,d,B);se.push(te[he[0]],te[he[1]])}if(oe=[...oe,{placement:o,overflows:se}],!se.every(he=>he<=0)){var ne,ee;const he=(((ne=l.flip)==null?void 0:ne.index)||0)+1,Se=X[he];if(Se&&(!(E==="alignment"?j!==uh(Se):!1)||oe.every(_e=>_e.overflows[0]>0&&uh(_e.placement)===j)))return{data:{index:he,overflows:oe},reset:{placement:Se}};let Ce=(ee=oe.filter(fe=>fe.overflows[0]<=0).sort((fe,_e)=>fe.overflows[1]-_e.overflows[1])[0])==null?void 0:ee.placement;if(!Ce)switch(C){case"bestFit":{var ie;const fe=(ie=oe.filter(_e=>{if(Z){const be=uh(_e.placement);return be===j||be==="y"}return!0}).map(_e=>[_e.placement,_e.overflows.filter(be=>be>0).reduce((be,Pe)=>be+Pe,0)]).sort((_e,be)=>_e[1]-be[1])[0])==null?void 0:ie[0];fe&&(Ce=fe);break}case"initialPlacement":Ce=i;break}if(o!==Ce)return{reset:{placement:Ce}}}return{}}}};function Aq(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function Pq(e){return Ive.some(t=>e[t]>=0)}const qve=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...o}=Nf(e,t);switch(n){case"referenceHidden":{const l=await _E(t,{...o,elementContext:"reference"}),d=Aq(l,r.reference);return{data:{referenceHiddenOffsets:d,referenceHidden:Pq(d)}}}case"escaped":{const l=await _E(t,{...o,altBoundary:!0}),d=Aq(l,r.floating);return{data:{escapedOffsets:d,escaped:Pq(d)}}}default:return{}}}}},dJ=new Set(["left","top"]);async function Wve(e,t){const{placement:r,platform:n,elements:o}=e,l=await(n.isRTL==null?void 0:n.isRTL(o.floating)),d=Mf(r),i=Sb(r),g=uh(r)==="y",x=dJ.has(d)?-1:1,S=l&&g?-1:1,E=Nf(t,e);let{mainAxis:A,crossAxis:C,alignmentAxis:N}=typeof E=="number"?{mainAxis:E,crossAxis:0,alignmentAxis:null}:{mainAxis:E.mainAxis||0,crossAxis:E.crossAxis||0,alignmentAxis:E.alignmentAxis};return i&&typeof N=="number"&&(C=i==="end"?N*-1:N),g?{x:C*S,y:A*x}:{x:A*x,y:C*S}}const Gve=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:o,y:l,placement:d,middlewareData:i}=t,g=await Wve(t,e);return d===((r=i.offset)==null?void 0:r.placement)&&(n=i.arrow)!=null&&n.alignmentOffset?{}:{x:o+g.x,y:l+g.y,data:{...g,placement:d}}}}},Hve=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:o}=t,{mainAxis:l=!0,crossAxis:d=!1,limiter:i={fn:R=>{let{x:L,y:j}=R;return{x:L,y:j}}},...g}=Nf(e,t),x={x:r,y:n},S=await _E(t,g),E=uh(Mf(o)),A=mB(E);let C=x[A],N=x[E];if(l){const R=A==="y"?"top":"left",L=A==="y"?"bottom":"right",j=C+S[R],F=C-S[L];C=TL(j,C,F)}if(d){const R=E==="y"?"top":"left",L=E==="y"?"bottom":"right",j=N+S[R],F=N-S[L];N=TL(j,N,F)}const k=i.fn({...t,[A]:C,[E]:N});return{...k,data:{x:k.x-r,y:k.y-n,enabled:{[A]:l,[E]:d}}}}}},Kve=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:o,rects:l,middlewareData:d}=t,{offset:i=0,mainAxis:g=!0,crossAxis:x=!0}=Nf(e,t),S={x:r,y:n},E=uh(o),A=mB(E);let C=S[A],N=S[E];const k=Nf(i,t),R=typeof k=="number"?{mainAxis:k,crossAxis:0}:{mainAxis:0,crossAxis:0,...k};if(g){const F=A==="y"?"height":"width",B=l.reference[A]-l.floating[F]+R.mainAxis,U=l.reference[A]+l.reference[F]-R.mainAxis;C<B?C=B:C>U&&(C=U)}if(x){var L,j;const F=A==="y"?"width":"height",B=dJ.has(Mf(o)),U=l.reference[E]-l.floating[F]+(B&&((L=d.offset)==null?void 0:L[E])||0)+(B?0:R.crossAxis),Z=l.reference[E]+l.reference[F]+(B?0:((j=d.offset)==null?void 0:j[E])||0)-(B?R.crossAxis:0);N<U?N=U:N>Z&&(N=Z)}return{[A]:C,[E]:N}}}},Zve=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:o,rects:l,platform:d,elements:i}=t,{apply:g=()=>{},...x}=Nf(e,t),S=await _E(t,x),E=Mf(o),A=Sb(o),C=uh(o)==="y",{width:N,height:k}=l.floating;let R,L;E==="top"||E==="bottom"?(R=E,L=A===(await(d.isRTL==null?void 0:d.isRTL(i.floating))?"start":"end")?"left":"right"):(L=E,R=A==="end"?"top":"bottom");const j=k-S.top-S.bottom,F=N-S.left-S.right,B=Um(k-S[R],j),U=Um(N-S[L],F),Z=!t.middlewareData.shift;let X=B,te=U;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(te=F),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(X=j),Z&&!A){const oe=Bc(S.left,0),ne=Bc(S.right,0),ee=Bc(S.top,0),ie=Bc(S.bottom,0);C?te=N-2*(oe!==0||ne!==0?oe+ne:Bc(S.left,S.right)):X=k-2*(ee!==0||ie!==0?ee+ie:Bc(S.top,S.bottom))}await g({...t,availableWidth:te,availableHeight:X});const se=await d.getDimensions(i.floating);return N!==se.width||k!==se.height?{reset:{rects:!0}}:{}}}};function rk(){return typeof window<"u"}function Eb(e){return hJ(e)?(e.nodeName||"").toLowerCase():"#document"}function Kc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Ih(e){var t;return(t=(hJ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function hJ(e){return rk()?e instanceof Node||e instanceof Kc(e).Node:!1}function Ad(e){return rk()?e instanceof Element||e instanceof Kc(e).Element:!1}function Th(e){return rk()?e instanceof HTMLElement||e instanceof Kc(e).HTMLElement:!1}function Cq(e){return!rk()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Kc(e).ShadowRoot}const Xve=new Set(["inline","contents"]);function CT(e){const{overflow:t,overflowX:r,overflowY:n,display:o}=Pd(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!Xve.has(o)}const Yve=new Set(["table","td","th"]);function Jve(e){return Yve.has(Eb(e))}const Qve=[":popover-open",":modal"];function nk(e){return Qve.some(t=>{try{return e.matches(t)}catch{return!1}})}const e_e=["transform","translate","scale","rotate","perspective"],t_e=["transform","translate","scale","rotate","perspective","filter"],r_e=["paint","layout","strict","content"];function vB(e){const t=_B(),r=Ad(e)?Pd(e):e;return e_e.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||t_e.some(n=>(r.willChange||"").includes(n))||r_e.some(n=>(r.contain||"").includes(n))}function n_e(e){let t=Vm(e);for(;Th(t)&&!I0(t);){if(vB(t))return t;if(nk(t))return null;t=Vm(t)}return null}function _B(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const i_e=new Set(["html","body","#document"]);function I0(e){return i_e.has(Eb(e))}function Pd(e){return Kc(e).getComputedStyle(e)}function ik(e){return Ad(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Vm(e){if(Eb(e)==="html")return e;const t=e.assignedSlot||e.parentNode||Cq(e)&&e.host||Ih(e);return Cq(t)?t.host:t}function fJ(e){const t=Vm(e);return I0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Th(t)&&CT(t)?t:fJ(t)}function xE(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const o=fJ(e),l=o===((n=e.ownerDocument)==null?void 0:n.body),d=Kc(o);if(l){const i=PL(d);return t.concat(d,d.visualViewport||[],CT(o)?o:[],i&&r?xE(i):[])}return t.concat(o,xE(o,[],r))}function PL(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function pJ(e){const t=Pd(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const o=Th(e),l=o?e.offsetWidth:r,d=o?e.offsetHeight:n,i=YC(r)!==l||YC(n)!==d;return i&&(r=l,n=d),{width:r,height:n,$:i}}function xB(e){return Ad(e)?e:e.contextElement}function Qx(e){const t=xB(e);if(!Th(t))return xh(1);const r=t.getBoundingClientRect(),{width:n,height:o,$:l}=pJ(t);let d=(l?YC(r.width):r.width)/n,i=(l?YC(r.height):r.height)/o;return(!d||!Number.isFinite(d))&&(d=1),(!i||!Number.isFinite(i))&&(i=1),{x:d,y:i}}const a_e=xh(0);function mJ(e){const t=Kc(e);return!_B()||!t.visualViewport?a_e:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function o_e(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Kc(e)?!1:t}function av(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const o=e.getBoundingClientRect(),l=xB(e);let d=xh(1);t&&(n?Ad(n)&&(d=Qx(n)):d=Qx(e));const i=o_e(l,r,n)?mJ(l):xh(0);let g=(o.left+i.x)/d.x,x=(o.top+i.y)/d.y,S=o.width/d.x,E=o.height/d.y;if(l){const A=Kc(l),C=n&&Ad(n)?Kc(n):n;let N=A,k=PL(N);for(;k&&n&&C!==N;){const R=Qx(k),L=k.getBoundingClientRect(),j=Pd(k),F=L.left+(k.clientLeft+parseFloat(j.paddingLeft))*R.x,B=L.top+(k.clientTop+parseFloat(j.paddingTop))*R.y;g*=R.x,x*=R.y,S*=R.x,E*=R.y,g+=F,x+=B,N=Kc(k),k=PL(N)}}return QC({width:S,height:E,x:g,y:x})}function bB(e,t){const r=ik(e).scrollLeft;return t?t.left+r:av(Ih(e)).left+r}function gJ(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),o=n.left+t.scrollLeft-(r?0:bB(e,n)),l=n.top+t.scrollTop;return{x:o,y:l}}function s_e(e){let{elements:t,rect:r,offsetParent:n,strategy:o}=e;const l=o==="fixed",d=Ih(n),i=t?nk(t.floating):!1;if(n===d||i&&l)return r;let g={scrollLeft:0,scrollTop:0},x=xh(1);const S=xh(0),E=Th(n);if((E||!E&&!l)&&((Eb(n)!=="body"||CT(d))&&(g=ik(n)),Th(n))){const C=av(n);x=Qx(n),S.x=C.x+n.clientLeft,S.y=C.y+n.clientTop}const A=d&&!E&&!l?gJ(d,g,!0):xh(0);return{width:r.width*x.x,height:r.height*x.y,x:r.x*x.x-g.scrollLeft*x.x+S.x+A.x,y:r.y*x.y-g.scrollTop*x.y+S.y+A.y}}function l_e(e){return Array.from(e.getClientRects())}function c_e(e){const t=Ih(e),r=ik(e),n=e.ownerDocument.body,o=Bc(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),l=Bc(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let d=-r.scrollLeft+bB(e);const i=-r.scrollTop;return Pd(n).direction==="rtl"&&(d+=Bc(t.clientWidth,n.clientWidth)-o),{width:o,height:l,x:d,y:i}}function u_e(e,t){const r=Kc(e),n=Ih(e),o=r.visualViewport;let l=n.clientWidth,d=n.clientHeight,i=0,g=0;if(o){l=o.width,d=o.height;const x=_B();(!x||x&&t==="fixed")&&(i=o.offsetLeft,g=o.offsetTop)}return{width:l,height:d,x:i,y:g}}const d_e=new Set(["absolute","fixed"]);function h_e(e,t){const r=av(e,!0,t==="fixed"),n=r.top+e.clientTop,o=r.left+e.clientLeft,l=Th(e)?Qx(e):xh(1),d=e.clientWidth*l.x,i=e.clientHeight*l.y,g=o*l.x,x=n*l.y;return{width:d,height:i,x:g,y:x}}function Oq(e,t,r){let n;if(t==="viewport")n=u_e(e,r);else if(t==="document")n=c_e(Ih(e));else if(Ad(t))n=h_e(t,r);else{const o=mJ(e);n={x:t.x-o.x,y:t.y-o.y,width:t.width,height:t.height}}return QC(n)}function yJ(e,t){const r=Vm(e);return r===t||!Ad(r)||I0(r)?!1:Pd(r).position==="fixed"||yJ(r,t)}function f_e(e,t){const r=t.get(e);if(r)return r;let n=xE(e,[],!1).filter(i=>Ad(i)&&Eb(i)!=="body"),o=null;const l=Pd(e).position==="fixed";let d=l?Vm(e):e;for(;Ad(d)&&!I0(d);){const i=Pd(d),g=vB(d);!g&&i.position==="fixed"&&(o=null),(l?!g&&!o:!g&&i.position==="static"&&!!o&&d_e.has(o.position)||CT(d)&&!g&&yJ(e,d))?n=n.filter(S=>S!==d):o=i,d=Vm(d)}return t.set(e,n),n}function p_e(e){let{element:t,boundary:r,rootBoundary:n,strategy:o}=e;const d=[...r==="clippingAncestors"?nk(t)?[]:f_e(t,this._c):[].concat(r),n],i=d[0],g=d.reduce((x,S)=>{const E=Oq(t,S,o);return x.top=Bc(E.top,x.top),x.right=Um(E.right,x.right),x.bottom=Um(E.bottom,x.bottom),x.left=Bc(E.left,x.left),x},Oq(t,i,o));return{width:g.right-g.left,height:g.bottom-g.top,x:g.left,y:g.top}}function m_e(e){const{width:t,height:r}=pJ(e);return{width:t,height:r}}function g_e(e,t,r){const n=Th(t),o=Ih(t),l=r==="fixed",d=av(e,!0,l,t);let i={scrollLeft:0,scrollTop:0};const g=xh(0);function x(){g.x=bB(o)}if(n||!n&&!l)if((Eb(t)!=="body"||CT(o))&&(i=ik(t)),n){const C=av(t,!0,l,t);g.x=C.x+t.clientLeft,g.y=C.y+t.clientTop}else o&&x();l&&!n&&o&&x();const S=o&&!n&&!l?gJ(o,i):xh(0),E=d.left+i.scrollLeft-g.x-S.x,A=d.top+i.scrollTop-g.y-S.y;return{x:E,y:A,width:d.width,height:d.height}}function _M(e){return Pd(e).position==="static"}function Iq(e,t){if(!Th(e)||Pd(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Ih(e)===r&&(r=r.ownerDocument.body),r}function vJ(e,t){const r=Kc(e);if(nk(e))return r;if(!Th(e)){let o=Vm(e);for(;o&&!I0(o);){if(Ad(o)&&!_M(o))return o;o=Vm(o)}return r}let n=Iq(e,t);for(;n&&Jve(n)&&_M(n);)n=Iq(n,t);return n&&I0(n)&&_M(n)&&!vB(n)?r:n||n_e(e)||r}const y_e=async function(e){const t=this.getOffsetParent||vJ,r=this.getDimensions,n=await r(e.floating);return{reference:g_e(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function v_e(e){return Pd(e).direction==="rtl"}const __e={convertOffsetParentRelativeRectToViewportRelativeRect:s_e,getDocumentElement:Ih,getClippingRect:p_e,getOffsetParent:vJ,getElementRects:y_e,getClientRects:l_e,getDimensions:m_e,getScale:Qx,isElement:Ad,isRTL:v_e};function _J(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function x_e(e,t){let r=null,n;const o=Ih(e);function l(){var i;clearTimeout(n),(i=r)==null||i.disconnect(),r=null}function d(i,g){i===void 0&&(i=!1),g===void 0&&(g=1),l();const x=e.getBoundingClientRect(),{left:S,top:E,width:A,height:C}=x;if(i||t(),!A||!C)return;const N=_P(E),k=_P(o.clientWidth-(S+A)),R=_P(o.clientHeight-(E+C)),L=_P(S),F={rootMargin:-N+"px "+-k+"px "+-R+"px "+-L+"px",threshold:Bc(0,Um(1,g))||1};let B=!0;function U(Z){const X=Z[0].intersectionRatio;if(X!==g){if(!B)return d();X?d(!1,X):n=setTimeout(()=>{d(!1,1e-7)},1e3)}X===1&&!_J(x,e.getBoundingClientRect())&&d(),B=!1}try{r=new IntersectionObserver(U,{...F,root:o.ownerDocument})}catch{r=new IntersectionObserver(U,F)}r.observe(e)}return d(!0),l}function b_e(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:o=!0,ancestorResize:l=!0,elementResize:d=typeof ResizeObserver=="function",layoutShift:i=typeof IntersectionObserver=="function",animationFrame:g=!1}=n,x=xB(e),S=o||l?[...x?xE(x):[],...xE(t)]:[];S.forEach(L=>{o&&L.addEventListener("scroll",r,{passive:!0}),l&&L.addEventListener("resize",r)});const E=x&&i?x_e(x,r):null;let A=-1,C=null;d&&(C=new ResizeObserver(L=>{let[j]=L;j&&j.target===x&&C&&(C.unobserve(t),cancelAnimationFrame(A),A=requestAnimationFrame(()=>{var F;(F=C)==null||F.observe(t)})),r()}),x&&!g&&C.observe(x),C.observe(t));let N,k=g?av(e):null;g&&R();function R(){const L=av(e);k&&!_J(k,L)&&r(),k=L,N=requestAnimationFrame(R)}return r(),()=>{var L;S.forEach(j=>{o&&j.removeEventListener("scroll",r),l&&j.removeEventListener("resize",r)}),E==null||E(),(L=C)==null||L.disconnect(),C=null,g&&cancelAnimationFrame(N)}}const w_e=Gve,S_e=Hve,E_e=Vve,T_e=Zve,A_e=qve,kq=Uve,P_e=Kve,C_e=(e,t,r)=>{const n=new Map,o={platform:__e,...r},l={...o.platform,_c:n};return $ve(e,t,{...o,platform:l})};var O_e=typeof document<"u",I_e=function(){},uC=O_e?G.useLayoutEffect:I_e;function eO(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!eO(e[n],t[n]))return!1;return!0}if(o=Object.keys(e),r=o.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,o[n]))return!1;for(n=r;n--!==0;){const l=o[n];if(!(l==="_owner"&&e.$$typeof)&&!eO(e[l],t[l]))return!1}return!0}return e!==e&&t!==t}function xJ(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function Rq(e,t){const r=xJ(e);return Math.round(t*r)/r}function xM(e){const t=G.useRef(e);return uC(()=>{t.current=e}),t}function k_e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:o,elements:{reference:l,floating:d}={},transform:i=!0,whileElementsMounted:g,open:x}=e,[S,E]=G.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[A,C]=G.useState(n);eO(A,n)||C(n);const[N,k]=G.useState(null),[R,L]=G.useState(null),j=G.useCallback(_e=>{_e!==Z.current&&(Z.current=_e,k(_e))},[]),F=G.useCallback(_e=>{_e!==X.current&&(X.current=_e,L(_e))},[]),B=l||N,U=d||R,Z=G.useRef(null),X=G.useRef(null),te=G.useRef(S),se=g!=null,oe=xM(g),ne=xM(o),ee=xM(x),ie=G.useCallback(()=>{if(!Z.current||!X.current)return;const _e={placement:t,strategy:r,middleware:A};ne.current&&(_e.platform=ne.current),C_e(Z.current,X.current,_e).then(be=>{const Pe={...be,isPositioned:ee.current!==!1};he.current&&!eO(te.current,Pe)&&(te.current=Pe,Qm.flushSync(()=>{E(Pe)}))})},[A,t,r,ne,ee]);uC(()=>{x===!1&&te.current.isPositioned&&(te.current.isPositioned=!1,E(_e=>({..._e,isPositioned:!1})))},[x]);const he=G.useRef(!1);uC(()=>(he.current=!0,()=>{he.current=!1}),[]),uC(()=>{if(B&&(Z.current=B),U&&(X.current=U),B&&U){if(oe.current)return oe.current(B,U,ie);ie()}},[B,U,ie,oe,se]);const Se=G.useMemo(()=>({reference:Z,floating:X,setReference:j,setFloating:F}),[j,F]),Ce=G.useMemo(()=>({reference:B,floating:U}),[B,U]),fe=G.useMemo(()=>{const _e={position:r,left:0,top:0};if(!Ce.floating)return _e;const be=Rq(Ce.floating,S.x),Pe=Rq(Ce.floating,S.y);return i?{..._e,transform:"translate("+be+"px, "+Pe+"px)",...xJ(Ce.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:be,top:Pe}},[r,i,Ce.floating,S.x,S.y]);return G.useMemo(()=>({...S,update:ie,refs:Se,elements:Ce,floatingStyles:fe}),[S,ie,Se,Ce,fe])}const R_e=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:o}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?kq({element:n.current,padding:o}).fn(r):{}:n?kq({element:n,padding:o}).fn(r):{}}}},j_e=(e,t)=>({...w_e(e),options:[e,t]}),N_e=(e,t)=>({...S_e(e),options:[e,t]}),M_e=(e,t)=>({...P_e(e),options:[e,t]}),D_e=(e,t)=>({...E_e(e),options:[e,t]}),L_e=(e,t)=>({...T_e(e),options:[e,t]}),F_e=(e,t)=>({...A_e(e),options:[e,t]}),z_e=(e,t)=>({...R_e(e),options:[e,t]});var B_e="Arrow",bJ=G.forwardRef((e,t)=>{const{children:r,width:n=10,height:o=5,...l}=e;return m.jsx(bn.svg,{...l,ref:t,width:n,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:m.jsx("polygon",{points:"0,0 30,0 15,10"})})});bJ.displayName=B_e;var $_e=bJ;function wB(e){const[t,r]=G.useState(void 0);return ko(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const l=o[0];let d,i;if("borderBoxSize"in l){const g=l.borderBoxSize,x=Array.isArray(g)?g[0]:g;d=x.inlineSize,i=x.blockSize}else d=e.offsetWidth,i=e.offsetHeight;r({width:d,height:i})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var SB="Popper",[wJ,eg]=Ks(SB),[U_e,SJ]=wJ(SB),EJ=e=>{const{__scopePopper:t,children:r}=e,[n,o]=G.useState(null);return m.jsx(U_e,{scope:t,anchor:n,onAnchorChange:o,children:r})};EJ.displayName=SB;var TJ="PopperAnchor",AJ=G.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...o}=e,l=SJ(TJ,r),d=G.useRef(null),i=hi(t,d);return G.useEffect(()=>{l.onAnchorChange((n==null?void 0:n.current)||d.current)}),n?null:m.jsx(bn.div,{...o,ref:i})});AJ.displayName=TJ;var EB="PopperContent",[V_e,q_e]=wJ(EB),PJ=G.forwardRef((e,t)=>{var Xe,ft,ze,ut,At,xt;const{__scopePopper:r,side:n="bottom",sideOffset:o=0,align:l="center",alignOffset:d=0,arrowPadding:i=0,avoidCollisions:g=!0,collisionBoundary:x=[],collisionPadding:S=0,sticky:E="partial",hideWhenDetached:A=!1,updatePositionStrategy:C="optimized",onPlaced:N,...k}=e,R=SJ(EB,r),[L,j]=G.useState(null),F=hi(t,nr=>j(nr)),[B,U]=G.useState(null),Z=wB(B),X=(Z==null?void 0:Z.width)??0,te=(Z==null?void 0:Z.height)??0,se=n+(l!=="center"?"-"+l:""),oe=typeof S=="number"?S:{top:0,right:0,bottom:0,left:0,...S},ne=Array.isArray(x)?x:[x],ee=ne.length>0,ie={padding:oe,boundary:ne.filter(G_e),altBoundary:ee},{refs:he,floatingStyles:Se,placement:Ce,isPositioned:fe,middlewareData:_e}=k_e({strategy:"fixed",placement:se,whileElementsMounted:(...nr)=>b_e(...nr,{animationFrame:C==="always"}),elements:{reference:R.anchor},middleware:[j_e({mainAxis:o+te,alignmentAxis:d}),g&&N_e({mainAxis:!0,crossAxis:!1,limiter:E==="partial"?M_e():void 0,...ie}),g&&D_e({...ie}),L_e({...ie,apply:({elements:nr,rects:Vt,availableWidth:dr,availableHeight:Br})=>{const{width:Yr,height:_t}=Vt.reference,Mt=nr.floating.style;Mt.setProperty("--radix-popper-available-width",`${dr}px`),Mt.setProperty("--radix-popper-available-height",`${Br}px`),Mt.setProperty("--radix-popper-anchor-width",`${Yr}px`),Mt.setProperty("--radix-popper-anchor-height",`${_t}px`)}}),B&&z_e({element:B,padding:i}),H_e({arrowWidth:X,arrowHeight:te}),A&&F_e({strategy:"referenceHidden",...ie})]}),[be,Pe]=IJ(Ce),ye=Io(N);ko(()=>{fe&&(ye==null||ye())},[fe,ye]);const ge=(Xe=_e.arrow)==null?void 0:Xe.x,ke=(ft=_e.arrow)==null?void 0:ft.y,Qe=((ze=_e.arrow)==null?void 0:ze.centerOffset)!==0,[He,$e]=G.useState();return ko(()=>{L&&$e(window.getComputedStyle(L).zIndex)},[L]),m.jsx("div",{ref:he.setFloating,"data-radix-popper-content-wrapper":"",style:{...Se,transform:fe?Se.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:He,"--radix-popper-transform-origin":[(ut=_e.transformOrigin)==null?void 0:ut.x,(At=_e.transformOrigin)==null?void 0:At.y].join(" "),...((xt=_e.hide)==null?void 0:xt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:m.jsx(V_e,{scope:r,placedSide:be,onArrowChange:U,arrowX:ge,arrowY:ke,shouldHideArrow:Qe,children:m.jsx(bn.div,{"data-side":be,"data-align":Pe,...k,ref:F,style:{...k.style,animation:fe?void 0:"none"}})})})});PJ.displayName=EB;var CJ="PopperArrow",W_e={top:"bottom",right:"left",bottom:"top",left:"right"},OJ=G.forwardRef(function(t,r){const{__scopePopper:n,...o}=t,l=q_e(CJ,n),d=W_e[l.placedSide];return m.jsx("span",{ref:l.onArrowChange,style:{position:"absolute",left:l.arrowX,top:l.arrowY,[d]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[l.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[l.placedSide],visibility:l.shouldHideArrow?"hidden":void 0},children:m.jsx($_e,{...o,ref:r,style:{...o.style,display:"block"}})})});OJ.displayName=CJ;function G_e(e){return e!==null}var H_e=e=>({name:"transformOrigin",options:e,fn(t){var R,L,j;const{placement:r,rects:n,middlewareData:o}=t,d=((R=o.arrow)==null?void 0:R.centerOffset)!==0,i=d?0:e.arrowWidth,g=d?0:e.arrowHeight,[x,S]=IJ(r),E={start:"0%",center:"50%",end:"100%"}[S],A=(((L=o.arrow)==null?void 0:L.x)??0)+i/2,C=(((j=o.arrow)==null?void 0:j.y)??0)+g/2;let N="",k="";return x==="bottom"?(N=d?E:`${A}px`,k=`${-g}px`):x==="top"?(N=d?E:`${A}px`,k=`${n.floating.height+g}px`):x==="right"?(N=`${-g}px`,k=d?E:`${C}px`):x==="left"&&(N=`${n.floating.width+g}px`,k=d?E:`${C}px`),{data:{x:N,y:k}}}});function IJ(e){const[t,r="center"]=e.split("-");return[t,r]}var ak=EJ,OT=AJ,ok=PJ,sk=OJ,[lk,vet]=Ks("Tooltip",[eg]),ck=eg(),kJ="TooltipProvider",K_e=700,CL="tooltip.open",[Z_e,TB]=lk(kJ),RJ=e=>{const{__scopeTooltip:t,delayDuration:r=K_e,skipDelayDuration:n=300,disableHoverableContent:o=!1,children:l}=e,d=G.useRef(!0),i=G.useRef(!1),g=G.useRef(0);return G.useEffect(()=>{const x=g.current;return()=>window.clearTimeout(x)},[]),m.jsx(Z_e,{scope:t,isOpenDelayedRef:d,delayDuration:r,onOpen:G.useCallback(()=>{window.clearTimeout(g.current),d.current=!1},[]),onClose:G.useCallback(()=>{window.clearTimeout(g.current),g.current=window.setTimeout(()=>d.current=!0,n)},[n]),isPointerInTransitRef:i,onPointerInTransitChange:G.useCallback(x=>{i.current=x},[]),disableHoverableContent:o,children:l})};RJ.displayName=kJ;var bE="Tooltip",[X_e,uk]=lk(bE),jJ=e=>{const{__scopeTooltip:t,children:r,open:n,defaultOpen:o,onOpenChange:l,disableHoverableContent:d,delayDuration:i}=e,g=TB(bE,e.__scopeTooltip),x=ck(t),[S,E]=G.useState(null),A=Hc(),C=G.useRef(0),N=d??g.disableHoverableContent,k=i??g.delayDuration,R=G.useRef(!1),[L,j]=Ru({prop:n,defaultProp:o??!1,onChange:X=>{X?(g.onOpen(),document.dispatchEvent(new CustomEvent(CL))):g.onClose(),l==null||l(X)},caller:bE}),F=G.useMemo(()=>L?R.current?"delayed-open":"instant-open":"closed",[L]),B=G.useCallback(()=>{window.clearTimeout(C.current),C.current=0,R.current=!1,j(!0)},[j]),U=G.useCallback(()=>{window.clearTimeout(C.current),C.current=0,j(!1)},[j]),Z=G.useCallback(()=>{window.clearTimeout(C.current),C.current=window.setTimeout(()=>{R.current=!0,j(!0),C.current=0},k)},[k,j]);return G.useEffect(()=>()=>{C.current&&(window.clearTimeout(C.current),C.current=0)},[]),m.jsx(ak,{...x,children:m.jsx(X_e,{scope:t,contentId:A,open:L,stateAttribute:F,trigger:S,onTriggerChange:E,onTriggerEnter:G.useCallback(()=>{g.isOpenDelayedRef.current?Z():B()},[g.isOpenDelayedRef,Z,B]),onTriggerLeave:G.useCallback(()=>{N?U():(window.clearTimeout(C.current),C.current=0)},[U,N]),onOpen:B,onClose:U,disableHoverableContent:N,children:r})})};jJ.displayName=bE;var OL="TooltipTrigger",NJ=G.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,o=uk(OL,r),l=TB(OL,r),d=ck(r),i=G.useRef(null),g=hi(t,i,o.onTriggerChange),x=G.useRef(!1),S=G.useRef(!1),E=G.useCallback(()=>x.current=!1,[]);return G.useEffect(()=>()=>document.removeEventListener("pointerup",E),[E]),m.jsx(OT,{asChild:!0,...d,children:m.jsx(bn.button,{"aria-describedby":o.open?o.contentId:void 0,"data-state":o.stateAttribute,...n,ref:g,onPointerMove:Rr(e.onPointerMove,A=>{A.pointerType!=="touch"&&!S.current&&!l.isPointerInTransitRef.current&&(o.onTriggerEnter(),S.current=!0)}),onPointerLeave:Rr(e.onPointerLeave,()=>{o.onTriggerLeave(),S.current=!1}),onPointerDown:Rr(e.onPointerDown,()=>{o.open&&o.onClose(),x.current=!0,document.addEventListener("pointerup",E,{once:!0})}),onFocus:Rr(e.onFocus,()=>{x.current||o.onOpen()}),onBlur:Rr(e.onBlur,o.onClose),onClick:Rr(e.onClick,o.onClose)})})});NJ.displayName=OL;var Y_e="TooltipPortal",[_et,J_e]=lk(Y_e,{forceMount:void 0}),k0="TooltipContent",MJ=G.forwardRef((e,t)=>{const r=J_e(k0,e.__scopeTooltip),{forceMount:n=r.forceMount,side:o="top",...l}=e,d=uk(k0,e.__scopeTooltip);return m.jsx(ys,{present:n||d.open,children:d.disableHoverableContent?m.jsx(DJ,{side:o,...l,ref:t}):m.jsx(Q_e,{side:o,...l,ref:t})})}),Q_e=G.forwardRef((e,t)=>{const r=uk(k0,e.__scopeTooltip),n=TB(k0,e.__scopeTooltip),o=G.useRef(null),l=hi(t,o),[d,i]=G.useState(null),{trigger:g,onClose:x}=r,S=o.current,{onPointerInTransitChange:E}=n,A=G.useCallback(()=>{i(null),E(!1)},[E]),C=G.useCallback((N,k)=>{const R=N.currentTarget,L={x:N.clientX,y:N.clientY},j=ixe(L,R.getBoundingClientRect()),F=axe(L,j),B=oxe(k.getBoundingClientRect()),U=lxe([...F,...B]);i(U),E(!0)},[E]);return G.useEffect(()=>()=>A(),[A]),G.useEffect(()=>{if(g&&S){const N=R=>C(R,S),k=R=>C(R,g);return g.addEventListener("pointerleave",N),S.addEventListener("pointerleave",k),()=>{g.removeEventListener("pointerleave",N),S.removeEventListener("pointerleave",k)}}},[g,S,C,A]),G.useEffect(()=>{if(d){const N=k=>{const R=k.target,L={x:k.clientX,y:k.clientY},j=(g==null?void 0:g.contains(R))||(S==null?void 0:S.contains(R)),F=!sxe(L,d);j?A():F&&(A(),x())};return document.addEventListener("pointermove",N),()=>document.removeEventListener("pointermove",N)}},[g,S,d,x,A]),m.jsx(DJ,{...e,ref:l})}),[exe,txe]=lk(bE,{isInside:!1}),rxe=vY("TooltipContent"),DJ=G.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":o,onEscapeKeyDown:l,onPointerDownOutside:d,...i}=e,g=uk(k0,r),x=ck(r),{onClose:S}=g;return G.useEffect(()=>(document.addEventListener(CL,S),()=>document.removeEventListener(CL,S)),[S]),G.useEffect(()=>{if(g.trigger){const E=A=>{const C=A.target;C!=null&&C.contains(g.trigger)&&S()};return window.addEventListener("scroll",E,{capture:!0}),()=>window.removeEventListener("scroll",E,{capture:!0})}},[g.trigger,S]),m.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:E=>E.preventDefault(),onDismiss:S,children:m.jsxs(ok,{"data-state":g.stateAttribute,...x,...i,ref:t,style:{...i.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[m.jsx(rxe,{children:n}),m.jsx(exe,{scope:r,isInside:!0,children:m.jsx(wge,{id:g.contentId,role:"tooltip",children:o||n})})]})})});MJ.displayName=k0;var LJ="TooltipArrow",nxe=G.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,o=ck(r);return txe(LJ,r).isInside?null:m.jsx(sk,{...o,...n,ref:t})});nxe.displayName=LJ;function ixe(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),o=Math.abs(t.right-e.x),l=Math.abs(t.left-e.x);switch(Math.min(r,n,o,l)){case l:return"left";case o:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function axe(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function oxe(e){const{top:t,right:r,bottom:n,left:o}=e;return[{x:o,y:t},{x:r,y:t},{x:r,y:n},{x:o,y:n}]}function sxe(e,t){const{x:r,y:n}=e;let o=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){const i=t[l],g=t[d],x=i.x,S=i.y,E=g.x,A=g.y;S>n!=A>n&&r<(E-x)*(n-S)/(A-S)+x&&(o=!o)}return o}function lxe(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),cxe(t)}function cxe(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const o=e[n];for(;t.length>=2;){const l=t[t.length-1],d=t[t.length-2];if((l.x-d.x)*(o.y-d.y)>=(l.y-d.y)*(o.x-d.x))t.pop();else break}t.push(o)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const o=e[n];for(;r.length>=2;){const l=r[r.length-1],d=r[r.length-2];if((l.x-d.x)*(o.y-d.y)>=(l.y-d.y)*(o.x-d.x))r.pop();else break}r.push(o)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var uxe=RJ,dxe=jJ,hxe=NJ,FJ=MJ;const zJ=uxe,fxe=dxe,pxe=hxe,BJ=G.forwardRef(({className:e,sideOffset:t=4,...r},n)=>m.jsx(FJ,{ref:n,sideOffset:t,className:_r("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));BJ.displayName=FJ.displayName;var Tb=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ov=typeof window>"u"||"Deno"in globalThis;function Dl(){}function mxe(e,t){return typeof e=="function"?e(t):e}function IL(e){return typeof e=="number"&&e>=0&&e!==1/0}function $J(e,t){return Math.max(e+(t||0)-Date.now(),0)}function jm(e,t){return typeof e=="function"?e(t):e}function pu(e,t){return typeof e=="function"?e(t):e}function jq(e,t){const{type:r="all",exact:n,fetchStatus:o,predicate:l,queryKey:d,stale:i}=e;if(d){if(n){if(t.queryHash!==AB(d,t.options))return!1}else if(!wE(t.queryKey,d))return!1}if(r!=="all"){const g=t.isActive();if(r==="active"&&!g||r==="inactive"&&g)return!1}return!(typeof i=="boolean"&&t.isStale()!==i||o&&o!==t.state.fetchStatus||l&&!l(t))}function Nq(e,t){const{exact:r,status:n,predicate:o,mutationKey:l}=e;if(l){if(!t.options.mutationKey)return!1;if(r){if(sv(t.options.mutationKey)!==sv(l))return!1}else if(!wE(t.options.mutationKey,l))return!1}return!(n&&t.state.status!==n||o&&!o(t))}function AB(e,t){return((t==null?void 0:t.queryKeyHashFn)||sv)(e)}function sv(e){return JSON.stringify(e,(t,r)=>kL(r)?Object.keys(r).sort().reduce((n,o)=>(n[o]=r[o],n),{}):r)}function wE(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>wE(e[r],t[r])):!1}function UJ(e,t){if(e===t)return e;const r=Mq(e)&&Mq(t);if(r||kL(e)&&kL(t)){const n=r?e:Object.keys(e),o=n.length,l=r?t:Object.keys(t),d=l.length,i=r?[]:{},g=new Set(n);let x=0;for(let S=0;S<d;S++){const E=r?S:l[S];(!r&&g.has(E)||r)&&e[E]===void 0&&t[E]===void 0?(i[E]=void 0,x++):(i[E]=UJ(e[E],t[E]),i[E]===e[E]&&e[E]!==void 0&&x++)}return o===d&&x===o?e:i}return t}function tO(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function Mq(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function kL(e){if(!Dq(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!Dq(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function Dq(e){return Object.prototype.toString.call(e)==="[object Object]"}function gxe(e){return new Promise(t=>{setTimeout(t,e)})}function RL(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?UJ(e,t):t}function yxe(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function vxe(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var PB=Symbol();function VJ(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===PB?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function qJ(e,t){return typeof e=="function"?e(...t):!!e}var By,cm,c0,GK,_xe=(GK=class extends Tb{constructor(){super();Bn(this,By);Bn(this,cm);Bn(this,c0);cn(this,c0,t=>{if(!ov&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){St(this,cm)||this.setEventListener(St(this,c0))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,cm))==null||t.call(this),cn(this,cm,void 0))}setEventListener(t){var r;cn(this,c0,t),(r=St(this,cm))==null||r.call(this),cn(this,cm,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){St(this,By)!==t&&(cn(this,By,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof St(this,By)=="boolean"?St(this,By):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},By=new WeakMap,cm=new WeakMap,c0=new WeakMap,GK),CB=new _xe,u0,um,d0,HK,xxe=(HK=class extends Tb{constructor(){super();Bn(this,u0,!0);Bn(this,um);Bn(this,d0);cn(this,d0,t=>{if(!ov&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){St(this,um)||this.setEventListener(St(this,d0))}onUnsubscribe(){var t;this.hasListeners()||((t=St(this,um))==null||t.call(this),cn(this,um,void 0))}setEventListener(t){var r;cn(this,d0,t),(r=St(this,um))==null||r.call(this),cn(this,um,t(this.setOnline.bind(this)))}setOnline(t){St(this,u0)!==t&&(cn(this,u0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return St(this,u0)}},u0=new WeakMap,um=new WeakMap,d0=new WeakMap,HK),rO=new xxe;function jL(){let e,t;const r=new Promise((o,l)=>{e=o,t=l});r.status="pending",r.catch(()=>{});function n(o){Object.assign(r,o),delete r.resolve,delete r.reject}return r.resolve=o=>{n({status:"fulfilled",value:o}),e(o)},r.reject=o=>{n({status:"rejected",reason:o}),t(o)},r}function bxe(e){return Math.min(1e3*2**e,3e4)}function WJ(e){return(e??"online")==="online"?rO.isOnline():!0}var GJ=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function bM(e){return e instanceof GJ}function HJ(e){let t=!1,r=0,n=!1,o;const l=jL(),d=k=>{var R;n||(A(new GJ(k)),(R=e.abort)==null||R.call(e))},i=()=>{t=!0},g=()=>{t=!1},x=()=>CB.isFocused()&&(e.networkMode==="always"||rO.isOnline())&&e.canRun(),S=()=>WJ(e.networkMode)&&e.canRun(),E=k=>{var R;n||(n=!0,(R=e.onSuccess)==null||R.call(e,k),o==null||o(),l.resolve(k))},A=k=>{var R;n||(n=!0,(R=e.onError)==null||R.call(e,k),o==null||o(),l.reject(k))},C=()=>new Promise(k=>{var R;o=L=>{(n||x())&&k(L)},(R=e.onPause)==null||R.call(e)}).then(()=>{var k;o=void 0,n||(k=e.onContinue)==null||k.call(e)}),N=()=>{if(n)return;let k;const R=r===0?e.initialPromise:void 0;try{k=R??e.fn()}catch(L){k=Promise.reject(L)}Promise.resolve(k).then(E).catch(L=>{var Z;if(n)return;const j=e.retry??(ov?0:3),F=e.retryDelay??bxe,B=typeof F=="function"?F(r,L):F,U=j===!0||typeof j=="number"&&r<j||typeof j=="function"&&j(r,L);if(t||!U){A(L);return}r++,(Z=e.onFail)==null||Z.call(e,r,L),gxe(B).then(()=>x()?void 0:C()).then(()=>{t?A(L):N()})})};return{promise:l,cancel:d,continue:()=>(o==null||o(),l),cancelRetry:i,continueRetry:g,canStart:S,start:()=>(S()?N():C().then(N),l)}}var wxe=e=>setTimeout(e,0);function Sxe(){let e=[],t=0,r=i=>{i()},n=i=>{i()},o=wxe;const l=i=>{t?e.push(i):o(()=>{r(i)})},d=()=>{const i=e;e=[],i.length&&o(()=>{n(()=>{i.forEach(g=>{r(g)})})})};return{batch:i=>{let g;t++;try{g=i()}finally{t--,t||d()}return g},batchCalls:i=>(...g)=>{l(()=>{i(...g)})},schedule:l,setNotifyFunction:i=>{r=i},setBatchNotifyFunction:i=>{n=i},setScheduler:i=>{o=i}}}var fs=Sxe(),$y,KK,KJ=(KK=class{constructor(){Bn(this,$y)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),IL(this.gcTime)&&cn(this,$y,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(ov?1/0:5*60*1e3))}clearGcTimeout(){St(this,$y)&&(clearTimeout(St(this,$y)),cn(this,$y,void 0))}},$y=new WeakMap,KK),h0,Uy,fu,Vy,il,gT,qy,ud,uf,ZK,Exe=(ZK=class extends KJ{constructor(t){super();Bn(this,ud);Bn(this,h0);Bn(this,Uy);Bn(this,fu);Bn(this,Vy);Bn(this,il);Bn(this,gT);Bn(this,qy);cn(this,qy,!1),cn(this,gT,t.defaultOptions),this.setOptions(t.options),this.observers=[],cn(this,Vy,t.client),cn(this,fu,St(this,Vy).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,cn(this,h0,Txe(this.options)),this.state=t.state??St(this,h0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=St(this,il))==null?void 0:t.promise}setOptions(t){this.options={...St(this,gT),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&St(this,fu).remove(this)}setData(t,r){const n=RL(this.state.data,t,this.options);return Ri(this,ud,uf).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Ri(this,ud,uf).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,o;const r=(n=St(this,il))==null?void 0:n.promise;return(o=St(this,il))==null||o.cancel(t),r?r.then(Dl).catch(Dl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(St(this,h0))}isActive(){return this.observers.some(t=>pu(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===PB||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>jm(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!$J(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,il))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=St(this,il))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),St(this,fu).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(St(this,il)&&(St(this,qy)?St(this,il).cancel({revert:!0}):St(this,il).cancelRetry()),this.scheduleGc()),St(this,fu).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ri(this,ud,uf).call(this,{type:"invalidate"})}fetch(t,r){var x,S,E;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(St(this,il))return St(this,il).continueRetry(),St(this,il).promise}if(t&&this.setOptions(t),!this.options.queryFn){const A=this.observers.find(C=>C.options.queryFn);A&&this.setOptions(A.options)}const n=new AbortController,o=A=>{Object.defineProperty(A,"signal",{enumerable:!0,get:()=>(cn(this,qy,!0),n.signal)})},l=()=>{const A=VJ(this.options,r),N=(()=>{const k={client:St(this,Vy),queryKey:this.queryKey,meta:this.meta};return o(k),k})();return cn(this,qy,!1),this.options.persister?this.options.persister(A,N,this):A(N)},i=(()=>{const A={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:St(this,Vy),state:this.state,fetchFn:l};return o(A),A})();(x=this.options.behavior)==null||x.onFetch(i,this),cn(this,Uy,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((S=i.fetchOptions)==null?void 0:S.meta))&&Ri(this,ud,uf).call(this,{type:"fetch",meta:(E=i.fetchOptions)==null?void 0:E.meta});const g=A=>{var C,N,k,R;bM(A)&&A.silent||Ri(this,ud,uf).call(this,{type:"error",error:A}),bM(A)||((N=(C=St(this,fu).config).onError)==null||N.call(C,A,this),(R=(k=St(this,fu).config).onSettled)==null||R.call(k,this.state.data,A,this)),this.scheduleGc()};return cn(this,il,HJ({initialPromise:r==null?void 0:r.initialPromise,fn:i.fetchFn,abort:n.abort.bind(n),onSuccess:A=>{var C,N,k,R;if(A===void 0){g(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(A)}catch(L){g(L);return}(N=(C=St(this,fu).config).onSuccess)==null||N.call(C,A,this),(R=(k=St(this,fu).config).onSettled)==null||R.call(k,A,this.state.error,this),this.scheduleGc()},onError:g,onFail:(A,C)=>{Ri(this,ud,uf).call(this,{type:"failed",failureCount:A,error:C})},onPause:()=>{Ri(this,ud,uf).call(this,{type:"pause"})},onContinue:()=>{Ri(this,ud,uf).call(this,{type:"continue"})},retry:i.options.retry,retryDelay:i.options.retryDelay,networkMode:i.options.networkMode,canRun:()=>!0})),St(this,il).start()}},h0=new WeakMap,Uy=new WeakMap,fu=new WeakMap,Vy=new WeakMap,il=new WeakMap,gT=new WeakMap,qy=new WeakMap,ud=new WeakSet,uf=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...ZJ(n.data,this.options),fetchMeta:t.meta??null};case"success":return cn(this,Uy,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return bM(o)&&o.revert&&St(this,Uy)?{...St(this,Uy),fetchStatus:"idle"}:{...n,error:o,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),fs.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),St(this,fu).notify({query:this,type:"updated",action:t})})},ZK);function ZJ(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:WJ(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function Txe(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var ah,XK,Axe=(XK=class extends Tb{constructor(t={}){super();Bn(this,ah);this.config=t,cn(this,ah,new Map)}build(t,r,n){const o=r.queryKey,l=r.queryHash??AB(o,r);let d=this.get(l);return d||(d=new Exe({client:t,queryKey:o,queryHash:l,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(o)}),this.add(d)),d}add(t){St(this,ah).has(t.queryHash)||(St(this,ah).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=St(this,ah).get(t.queryHash);r&&(t.destroy(),r===t&&St(this,ah).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){fs.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return St(this,ah).get(t)}getAll(){return[...St(this,ah).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>jq(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>jq(t,n)):r}notify(t){fs.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){fs.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){fs.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},ah=new WeakMap,XK),oh,jl,Wy,sh,Wp,YK,Pxe=(YK=class extends KJ{constructor(t){super();Bn(this,sh);Bn(this,oh);Bn(this,jl);Bn(this,Wy);this.mutationId=t.mutationId,cn(this,jl,t.mutationCache),cn(this,oh,[]),this.state=t.state||XJ(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){St(this,oh).includes(t)||(St(this,oh).push(t),this.clearGcTimeout(),St(this,jl).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){cn(this,oh,St(this,oh).filter(r=>r!==t)),this.scheduleGc(),St(this,jl).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){St(this,oh).length||(this.state.status==="pending"?this.scheduleGc():St(this,jl).remove(this))}continue(){var t;return((t=St(this,Wy))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var l,d,i,g,x,S,E,A,C,N,k,R,L,j,F,B,U,Z,X,te;const r=()=>{Ri(this,sh,Wp).call(this,{type:"continue"})};cn(this,Wy,HJ({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(se,oe)=>{Ri(this,sh,Wp).call(this,{type:"failed",failureCount:se,error:oe})},onPause:()=>{Ri(this,sh,Wp).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>St(this,jl).canRun(this)}));const n=this.state.status==="pending",o=!St(this,Wy).canStart();try{if(n)r();else{Ri(this,sh,Wp).call(this,{type:"pending",variables:t,isPaused:o}),await((d=(l=St(this,jl).config).onMutate)==null?void 0:d.call(l,t,this));const oe=await((g=(i=this.options).onMutate)==null?void 0:g.call(i,t));oe!==this.state.context&&Ri(this,sh,Wp).call(this,{type:"pending",context:oe,variables:t,isPaused:o})}const se=await St(this,Wy).start();return await((S=(x=St(this,jl).config).onSuccess)==null?void 0:S.call(x,se,t,this.state.context,this)),await((A=(E=this.options).onSuccess)==null?void 0:A.call(E,se,t,this.state.context)),await((N=(C=St(this,jl).config).onSettled)==null?void 0:N.call(C,se,null,this.state.variables,this.state.context,this)),await((R=(k=this.options).onSettled)==null?void 0:R.call(k,se,null,t,this.state.context)),Ri(this,sh,Wp).call(this,{type:"success",data:se}),se}catch(se){try{throw await((j=(L=St(this,jl).config).onError)==null?void 0:j.call(L,se,t,this.state.context,this)),await((B=(F=this.options).onError)==null?void 0:B.call(F,se,t,this.state.context)),await((Z=(U=St(this,jl).config).onSettled)==null?void 0:Z.call(U,void 0,se,this.state.variables,this.state.context,this)),await((te=(X=this.options).onSettled)==null?void 0:te.call(X,void 0,se,t,this.state.context)),se}finally{Ri(this,sh,Wp).call(this,{type:"error",error:se})}}finally{St(this,jl).runNext(this)}}},oh=new WeakMap,jl=new WeakMap,Wy=new WeakMap,sh=new WeakSet,Wp=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),fs.batch(()=>{St(this,oh).forEach(n=>{n.onMutationUpdate(t)}),St(this,jl).notify({mutation:this,type:"updated",action:t})})},YK);function XJ(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var pf,dd,yT,JK,Cxe=(JK=class extends Tb{constructor(t={}){super();Bn(this,pf);Bn(this,dd);Bn(this,yT);this.config=t,cn(this,pf,new Set),cn(this,dd,new Map),cn(this,yT,0)}build(t,r,n){const o=new Pxe({mutationCache:this,mutationId:++Y2(this,yT)._,options:t.defaultMutationOptions(r),state:n});return this.add(o),o}add(t){St(this,pf).add(t);const r=xP(t);if(typeof r=="string"){const n=St(this,dd).get(r);n?n.push(t):St(this,dd).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(St(this,pf).delete(t)){const r=xP(t);if(typeof r=="string"){const n=St(this,dd).get(r);if(n)if(n.length>1){const o=n.indexOf(t);o!==-1&&n.splice(o,1)}else n[0]===t&&St(this,dd).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=xP(t);if(typeof r=="string"){const n=St(this,dd).get(r),o=n==null?void 0:n.find(l=>l.state.status==="pending");return!o||o===t}else return!0}runNext(t){var n;const r=xP(t);if(typeof r=="string"){const o=(n=St(this,dd).get(r))==null?void 0:n.find(l=>l!==t&&l.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){fs.batch(()=>{St(this,pf).forEach(t=>{this.notify({type:"removed",mutation:t})}),St(this,pf).clear(),St(this,dd).clear()})}getAll(){return Array.from(St(this,pf))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>Nq(r,n))}findAll(t={}){return this.getAll().filter(r=>Nq(t,r))}notify(t){fs.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return fs.batch(()=>Promise.all(t.map(r=>r.continue().catch(Dl))))}},pf=new WeakMap,dd=new WeakMap,yT=new WeakMap,JK);function xP(e){var t;return(t=e.options.scope)==null?void 0:t.id}function Lq(e){return{onFetch:(t,r)=>{var S,E,A,C,N;const n=t.options,o=(A=(E=(S=t.fetchOptions)==null?void 0:S.meta)==null?void 0:E.fetchMore)==null?void 0:A.direction,l=((C=t.state.data)==null?void 0:C.pages)||[],d=((N=t.state.data)==null?void 0:N.pageParams)||[];let i={pages:[],pageParams:[]},g=0;const x=async()=>{let k=!1;const R=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(t.signal.aborted?k=!0:t.signal.addEventListener("abort",()=>{k=!0}),t.signal)})},L=VJ(t.options,t.fetchOptions),j=async(F,B,U)=>{if(k)return Promise.reject();if(B==null&&F.pages.length)return Promise.resolve(F);const X=(()=>{const ne={client:t.client,queryKey:t.queryKey,pageParam:B,direction:U?"backward":"forward",meta:t.options.meta};return R(ne),ne})(),te=await L(X),{maxPages:se}=t.options,oe=U?vxe:yxe;return{pages:oe(F.pages,te,se),pageParams:oe(F.pageParams,B,se)}};if(o&&l.length){const F=o==="backward",B=F?Oxe:Fq,U={pages:l,pageParams:d},Z=B(n,U);i=await j(U,Z,F)}else{const F=e??l.length;do{const B=g===0?d[0]??n.initialPageParam:Fq(n,i);if(g>0&&B==null)break;i=await j(i,B),g++}while(g<F)}return i};t.options.persister?t.fetchFn=()=>{var k,R;return(R=(k=t.options).persister)==null?void 0:R.call(k,x,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=x}}}function Fq(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Oxe(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var Ao,dm,hm,f0,p0,fm,m0,g0,QK,Ixe=(QK=class{constructor(e={}){Bn(this,Ao);Bn(this,dm);Bn(this,hm);Bn(this,f0);Bn(this,p0);Bn(this,fm);Bn(this,m0);Bn(this,g0);cn(this,Ao,e.queryCache||new Axe),cn(this,dm,e.mutationCache||new Cxe),cn(this,hm,e.defaultOptions||{}),cn(this,f0,new Map),cn(this,p0,new Map),cn(this,fm,0)}mount(){Y2(this,fm)._++,St(this,fm)===1&&(cn(this,m0,CB.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,Ao).onFocus())})),cn(this,g0,rO.subscribe(async e=>{e&&(await this.resumePausedMutations(),St(this,Ao).onOnline())})))}unmount(){var e,t;Y2(this,fm)._--,St(this,fm)===0&&((e=St(this,m0))==null||e.call(this),cn(this,m0,void 0),(t=St(this,g0))==null||t.call(this),cn(this,g0,void 0))}isFetching(e){return St(this,Ao).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return St(this,dm).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,Ao).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=St(this,Ao).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(jm(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return St(this,Ao).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),o=St(this,Ao).get(n.queryHash),l=o==null?void 0:o.state.data,d=mxe(t,l);if(d!==void 0)return St(this,Ao).build(this,n).setData(d,{...r,manual:!0})}setQueriesData(e,t,r){return fs.batch(()=>St(this,Ao).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=St(this,Ao).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=St(this,Ao);fs.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=St(this,Ao);return fs.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=fs.batch(()=>St(this,Ao).findAll(e).map(o=>o.cancel(r)));return Promise.all(n).then(Dl).catch(Dl)}invalidateQueries(e,t={}){return fs.batch(()=>(St(this,Ao).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=fs.batch(()=>St(this,Ao).findAll(e).filter(o=>!o.isDisabled()&&!o.isStatic()).map(o=>{let l=o.fetch(void 0,r);return r.throwOnError||(l=l.catch(Dl)),o.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(n).then(Dl)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=St(this,Ao).build(this,t);return r.isStaleByTime(jm(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Dl).catch(Dl)}fetchInfiniteQuery(e){return e.behavior=Lq(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Dl).catch(Dl)}ensureInfiniteQueryData(e){return e.behavior=Lq(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return rO.isOnline()?St(this,dm).resumePausedMutations():Promise.resolve()}getQueryCache(){return St(this,Ao)}getMutationCache(){return St(this,dm)}getDefaultOptions(){return St(this,hm)}setDefaultOptions(e){cn(this,hm,e)}setQueryDefaults(e,t){St(this,f0).set(sv(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...St(this,f0).values()],r={};return t.forEach(n=>{wE(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){St(this,p0).set(sv(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...St(this,p0).values()],r={};return t.forEach(n=>{wE(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...St(this,hm).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=AB(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===PB&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...St(this,hm).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){St(this,Ao).clear(),St(this,dm).clear()}},Ao=new WeakMap,dm=new WeakMap,hm=new WeakMap,f0=new WeakMap,p0=new WeakMap,fm=new WeakMap,m0=new WeakMap,g0=new WeakMap,QK),cc,ra,vT,Nl,Gy,y0,pm,mm,_T,v0,_0,Hy,Ky,gm,x0,Oa,AS,NL,ML,DL,LL,FL,zL,BL,YJ,eZ,kxe=(eZ=class extends Tb{constructor(t,r){super();Bn(this,Oa);Bn(this,cc);Bn(this,ra);Bn(this,vT);Bn(this,Nl);Bn(this,Gy);Bn(this,y0);Bn(this,pm);Bn(this,mm);Bn(this,_T);Bn(this,v0);Bn(this,_0);Bn(this,Hy);Bn(this,Ky);Bn(this,gm);Bn(this,x0,new Set);this.options=r,cn(this,cc,t),cn(this,mm,null),cn(this,pm,jL()),this.options.experimental_prefetchInRender||St(this,pm).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(St(this,ra).addObserver(this),zq(St(this,ra),this.options)?Ri(this,Oa,AS).call(this):this.updateResult(),Ri(this,Oa,LL).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return $L(St(this,ra),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return $L(St(this,ra),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Ri(this,Oa,FL).call(this),Ri(this,Oa,zL).call(this),St(this,ra).removeObserver(this)}setOptions(t){const r=this.options,n=St(this,ra);if(this.options=St(this,cc).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof pu(this.options.enabled,St(this,ra))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Ri(this,Oa,BL).call(this),St(this,ra).setOptions(this.options),r._defaulted&&!tO(this.options,r)&&St(this,cc).getQueryCache().notify({type:"observerOptionsUpdated",query:St(this,ra),observer:this});const o=this.hasListeners();o&&Bq(St(this,ra),n,this.options,r)&&Ri(this,Oa,AS).call(this),this.updateResult(),o&&(St(this,ra)!==n||pu(this.options.enabled,St(this,ra))!==pu(r.enabled,St(this,ra))||jm(this.options.staleTime,St(this,ra))!==jm(r.staleTime,St(this,ra)))&&Ri(this,Oa,NL).call(this);const l=Ri(this,Oa,ML).call(this);o&&(St(this,ra)!==n||pu(this.options.enabled,St(this,ra))!==pu(r.enabled,St(this,ra))||l!==St(this,gm))&&Ri(this,Oa,DL).call(this,l)}getOptimisticResult(t){const r=St(this,cc).getQueryCache().build(St(this,cc),t),n=this.createResult(r,t);return jxe(this,n)&&(cn(this,Nl,n),cn(this,y0,this.options),cn(this,Gy,St(this,ra).state)),n}getCurrentResult(){return St(this,Nl)}trackResult(t,r){return new Proxy(t,{get:(n,o)=>(this.trackProp(o),r==null||r(o),Reflect.get(n,o))})}trackProp(t){St(this,x0).add(t)}getCurrentQuery(){return St(this,ra)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=St(this,cc).defaultQueryOptions(t),n=St(this,cc).getQueryCache().build(St(this,cc),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Ri(this,Oa,AS).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),St(this,Nl)))}createResult(t,r){var se;const n=St(this,ra),o=this.options,l=St(this,Nl),d=St(this,Gy),i=St(this,y0),x=t!==n?t.state:St(this,vT),{state:S}=t;let E={...S},A=!1,C;if(r._optimisticResults){const oe=this.hasListeners(),ne=!oe&&zq(t,r),ee=oe&&Bq(t,n,r,o);(ne||ee)&&(E={...E,...ZJ(S.data,t.options)}),r._optimisticResults==="isRestoring"&&(E.fetchStatus="idle")}let{error:N,errorUpdatedAt:k,status:R}=E;C=E.data;let L=!1;if(r.placeholderData!==void 0&&C===void 0&&R==="pending"){let oe;l!=null&&l.isPlaceholderData&&r.placeholderData===(i==null?void 0:i.placeholderData)?(oe=l.data,L=!0):oe=typeof r.placeholderData=="function"?r.placeholderData((se=St(this,_0))==null?void 0:se.state.data,St(this,_0)):r.placeholderData,oe!==void 0&&(R="success",C=RL(l==null?void 0:l.data,oe,r),A=!0)}if(r.select&&C!==void 0&&!L)if(l&&C===(d==null?void 0:d.data)&&r.select===St(this,_T))C=St(this,v0);else try{cn(this,_T,r.select),C=r.select(C),C=RL(l==null?void 0:l.data,C,r),cn(this,v0,C),cn(this,mm,null)}catch(oe){cn(this,mm,oe)}St(this,mm)&&(N=St(this,mm),C=St(this,v0),k=Date.now(),R="error");const j=E.fetchStatus==="fetching",F=R==="pending",B=R==="error",U=F&&j,Z=C!==void 0,te={status:R,fetchStatus:E.fetchStatus,isPending:F,isSuccess:R==="success",isError:B,isInitialLoading:U,isLoading:U,data:C,dataUpdatedAt:E.dataUpdatedAt,error:N,errorUpdatedAt:k,failureCount:E.fetchFailureCount,failureReason:E.fetchFailureReason,errorUpdateCount:E.errorUpdateCount,isFetched:E.dataUpdateCount>0||E.errorUpdateCount>0,isFetchedAfterMount:E.dataUpdateCount>x.dataUpdateCount||E.errorUpdateCount>x.errorUpdateCount,isFetching:j,isRefetching:j&&!F,isLoadingError:B&&!Z,isPaused:E.fetchStatus==="paused",isPlaceholderData:A,isRefetchError:B&&Z,isStale:OB(t,r),refetch:this.refetch,promise:St(this,pm),isEnabled:pu(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const oe=ie=>{te.status==="error"?ie.reject(te.error):te.data!==void 0&&ie.resolve(te.data)},ne=()=>{const ie=cn(this,pm,te.promise=jL());oe(ie)},ee=St(this,pm);switch(ee.status){case"pending":t.queryHash===n.queryHash&&oe(ee);break;case"fulfilled":(te.status==="error"||te.data!==ee.value)&&ne();break;case"rejected":(te.status!=="error"||te.error!==ee.reason)&&ne();break}}return te}updateResult(){const t=St(this,Nl),r=this.createResult(St(this,ra),this.options);if(cn(this,Gy,St(this,ra).state),cn(this,y0,this.options),St(this,Gy).data!==void 0&&cn(this,_0,St(this,ra)),tO(r,t))return;cn(this,Nl,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:o}=this.options,l=typeof o=="function"?o():o;if(l==="all"||!l&&!St(this,x0).size)return!0;const d=new Set(l??St(this,x0));return this.options.throwOnError&&d.add("error"),Object.keys(St(this,Nl)).some(i=>{const g=i;return St(this,Nl)[g]!==t[g]&&d.has(g)})};Ri(this,Oa,YJ).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Ri(this,Oa,LL).call(this)}},cc=new WeakMap,ra=new WeakMap,vT=new WeakMap,Nl=new WeakMap,Gy=new WeakMap,y0=new WeakMap,pm=new WeakMap,mm=new WeakMap,_T=new WeakMap,v0=new WeakMap,_0=new WeakMap,Hy=new WeakMap,Ky=new WeakMap,gm=new WeakMap,x0=new WeakMap,Oa=new WeakSet,AS=function(t){Ri(this,Oa,BL).call(this);let r=St(this,ra).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(Dl)),r},NL=function(){Ri(this,Oa,FL).call(this);const t=jm(this.options.staleTime,St(this,ra));if(ov||St(this,Nl).isStale||!IL(t))return;const n=$J(St(this,Nl).dataUpdatedAt,t)+1;cn(this,Hy,setTimeout(()=>{St(this,Nl).isStale||this.updateResult()},n))},ML=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(St(this,ra)):this.options.refetchInterval)??!1},DL=function(t){Ri(this,Oa,zL).call(this),cn(this,gm,t),!(ov||pu(this.options.enabled,St(this,ra))===!1||!IL(St(this,gm))||St(this,gm)===0)&&cn(this,Ky,setInterval(()=>{(this.options.refetchIntervalInBackground||CB.isFocused())&&Ri(this,Oa,AS).call(this)},St(this,gm)))},LL=function(){Ri(this,Oa,NL).call(this),Ri(this,Oa,DL).call(this,Ri(this,Oa,ML).call(this))},FL=function(){St(this,Hy)&&(clearTimeout(St(this,Hy)),cn(this,Hy,void 0))},zL=function(){St(this,Ky)&&(clearInterval(St(this,Ky)),cn(this,Ky,void 0))},BL=function(){const t=St(this,cc).getQueryCache().build(St(this,cc),this.options);if(t===St(this,ra))return;const r=St(this,ra);cn(this,ra,t),cn(this,vT,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},YJ=function(t){fs.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(St(this,Nl))}),St(this,cc).getQueryCache().notify({query:St(this,ra),type:"observerResultsUpdated"})})},eZ);function Rxe(e,t){return pu(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function zq(e,t){return Rxe(e,t)||e.state.data!==void 0&&$L(e,t,t.refetchOnMount)}function $L(e,t,r){if(pu(t.enabled,e)!==!1&&jm(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&OB(e,t)}return!1}function Bq(e,t,r,n){return(e!==t||pu(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&OB(e,r)}function OB(e,t){return pu(t.enabled,e)!==!1&&e.isStaleByTime(jm(t.staleTime,e))}function jxe(e,t){return!tO(e.getCurrentResult(),t)}var ym,vm,uc,mf,Of,dC,UL,tZ,Nxe=(tZ=class extends Tb{constructor(r,n){super();Bn(this,Of);Bn(this,ym);Bn(this,vm);Bn(this,uc);Bn(this,mf);cn(this,ym,r),this.setOptions(n),this.bindMethods(),Ri(this,Of,dC).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var o;const n=this.options;this.options=St(this,ym).defaultMutationOptions(r),tO(this.options,n)||St(this,ym).getMutationCache().notify({type:"observerOptionsUpdated",mutation:St(this,uc),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&sv(n.mutationKey)!==sv(this.options.mutationKey)?this.reset():((o=St(this,uc))==null?void 0:o.state.status)==="pending"&&St(this,uc).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=St(this,uc))==null||r.removeObserver(this)}onMutationUpdate(r){Ri(this,Of,dC).call(this),Ri(this,Of,UL).call(this,r)}getCurrentResult(){return St(this,vm)}reset(){var r;(r=St(this,uc))==null||r.removeObserver(this),cn(this,uc,void 0),Ri(this,Of,dC).call(this),Ri(this,Of,UL).call(this)}mutate(r,n){var o;return cn(this,mf,n),(o=St(this,uc))==null||o.removeObserver(this),cn(this,uc,St(this,ym).getMutationCache().build(St(this,ym),this.options)),St(this,uc).addObserver(this),St(this,uc).execute(r)}},ym=new WeakMap,vm=new WeakMap,uc=new WeakMap,mf=new WeakMap,Of=new WeakSet,dC=function(){var n;const r=((n=St(this,uc))==null?void 0:n.state)??XJ();cn(this,vm,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},UL=function(r){fs.batch(()=>{var n,o,l,d,i,g,x,S;if(St(this,mf)&&this.hasListeners()){const E=St(this,vm).variables,A=St(this,vm).context;(r==null?void 0:r.type)==="success"?((o=(n=St(this,mf)).onSuccess)==null||o.call(n,r.data,E,A),(d=(l=St(this,mf)).onSettled)==null||d.call(l,r.data,null,E,A)):(r==null?void 0:r.type)==="error"&&((g=(i=St(this,mf)).onError)==null||g.call(i,r.error,E,A),(S=(x=St(this,mf)).onSettled)==null||S.call(x,void 0,r.error,E,A))}this.listeners.forEach(E=>{E(St(this,vm))})})},tZ),JJ=G.createContext(void 0),Na=e=>{const t=G.useContext(JJ);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},Mxe=({client:e,children:t})=>(G.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),m.jsx(JJ.Provider,{value:e,children:t})),QJ=G.createContext(!1),Dxe=()=>G.useContext(QJ);QJ.Provider;function Lxe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var Fxe=G.createContext(Lxe()),zxe=()=>G.useContext(Fxe),Bxe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},$xe=e=>{G.useEffect(()=>{e.clearReset()},[e])},Uxe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:o})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(o&&e.data===void 0||qJ(r,[e.error,n])),Vxe=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},qxe=(e,t)=>e.isLoading&&e.isFetching&&!t,Wxe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,$q=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function Gxe(e,t,r){var E,A,C,N,k;const n=Dxe(),o=zxe(),l=Na(),d=l.defaultQueryOptions(e);(A=(E=l.getDefaultOptions().queries)==null?void 0:E._experimental_beforeQuery)==null||A.call(E,d),d._optimisticResults=n?"isRestoring":"optimistic",Vxe(d),Bxe(d,o),$xe(o);const i=!l.getQueryCache().get(d.queryHash),[g]=G.useState(()=>new t(l,d)),x=g.getOptimisticResult(d),S=!n&&e.subscribed!==!1;if(G.useSyncExternalStore(G.useCallback(R=>{const L=S?g.subscribe(fs.batchCalls(R)):Dl;return g.updateResult(),L},[g,S]),()=>g.getCurrentResult(),()=>g.getCurrentResult()),G.useEffect(()=>{g.setOptions(d)},[d,g]),Wxe(d,x))throw $q(d,g,o);if(Uxe({result:x,errorResetBoundary:o,throwOnError:d.throwOnError,query:l.getQueryCache().get(d.queryHash),suspense:d.suspense}))throw x.error;if((N=(C=l.getDefaultOptions().queries)==null?void 0:C._experimental_afterQuery)==null||N.call(C,d,x),d.experimental_prefetchInRender&&!ov&&qxe(x,n)){const R=i?$q(d,g,o):(k=l.getQueryCache().get(d.queryHash))==null?void 0:k.promise;R==null||R.catch(Dl).finally(()=>{g.updateResult()})}return d.notifyOnChangeProps?x:g.trackResult(x)}function Wi(e,t){return Gxe(e,kxe)}function Xa(e,t){const r=Na(),[n]=G.useState(()=>new Nxe(r,e));G.useEffect(()=>{n.setOptions(e)},[n,e]);const o=G.useSyncExternalStore(G.useCallback(d=>n.subscribe(fs.batchCalls(d)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),l=G.useCallback((d,i)=>{n.mutate(d,i).catch(Dl)},[n]);if(o.error&&qJ(n.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:l,mutateAsync:o.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function SE(){return SE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SE.apply(this,arguments)}var bm;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(bm||(bm={}));const Uq="popstate";function Hxe(e){e===void 0&&(e={});function t(n,o){let{pathname:l,search:d,hash:i}=n.location;return VL("",{pathname:l,search:d,hash:i},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function r(n,o){return typeof o=="string"?o:nO(o)}return Zxe(t,r,null,e)}function Lo(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function eQ(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function Kxe(){return Math.random().toString(36).substr(2,8)}function Vq(e,t){return{usr:e.state,key:e.key,idx:t}}function VL(e,t,r,n){return r===void 0&&(r=null),SE({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?Ab(t):t,{state:r,key:t&&t.key||n||Kxe()})}function nO(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Ab(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function Zxe(e,t,r,n){n===void 0&&(n={});let{window:o=document.defaultView,v5Compat:l=!1}=n,d=o.history,i=bm.Pop,g=null,x=S();x==null&&(x=0,d.replaceState(SE({},d.state,{idx:x}),""));function S(){return(d.state||{idx:null}).idx}function E(){i=bm.Pop;let R=S(),L=R==null?null:R-x;x=R,g&&g({action:i,location:k.location,delta:L})}function A(R,L){i=bm.Push;let j=VL(k.location,R,L);x=S()+1;let F=Vq(j,x),B=k.createHref(j);try{d.pushState(F,"",B)}catch(U){if(U instanceof DOMException&&U.name==="DataCloneError")throw U;o.location.assign(B)}l&&g&&g({action:i,location:k.location,delta:1})}function C(R,L){i=bm.Replace;let j=VL(k.location,R,L);x=S();let F=Vq(j,x),B=k.createHref(j);d.replaceState(F,"",B),l&&g&&g({action:i,location:k.location,delta:0})}function N(R){let L=o.location.origin!=="null"?o.location.origin:o.location.href,j=typeof R=="string"?R:nO(R);return j=j.replace(/ $/,"%20"),Lo(L,"No window.location.(origin|href) available to create URL for href: "+j),new URL(j,L)}let k={get action(){return i},get location(){return e(o,d)},listen(R){if(g)throw new Error("A history only accepts one active listener");return o.addEventListener(Uq,E),g=R,()=>{o.removeEventListener(Uq,E),g=null}},createHref(R){return t(o,R)},createURL:N,encodeLocation(R){let L=N(R);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:A,replace:C,go(R){return d.go(R)}};return k}var qq;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(qq||(qq={}));function Xxe(e,t,r){return r===void 0&&(r="/"),Yxe(e,t,r,!1)}function Yxe(e,t,r,n){let o=typeof t=="string"?Ab(t):t,l=IB(o.pathname||"/",r);if(l==null)return null;let d=tQ(e);Jxe(d);let i=null;for(let g=0;i==null&&g<d.length;++g){let x=c0e(l);i=s0e(d[g],x,n)}return i}function tQ(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let o=(l,d,i)=>{let g={relativePath:i===void 0?l.path||"":i,caseSensitive:l.caseSensitive===!0,childrenIndex:d,route:l};g.relativePath.startsWith("/")&&(Lo(g.relativePath.startsWith(n),'Absolute route path "'+g.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),g.relativePath=g.relativePath.slice(n.length));let x=Nm([n,g.relativePath]),S=r.concat(g);l.children&&l.children.length>0&&(Lo(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+x+'".')),tQ(l.children,t,S,x)),!(l.path==null&&!l.index)&&t.push({path:x,score:a0e(x,l.index),routesMeta:S})};return e.forEach((l,d)=>{var i;if(l.path===""||!((i=l.path)!=null&&i.includes("?")))o(l,d);else for(let g of rQ(l.path))o(l,d,g)}),t}function rQ(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,o=r.endsWith("?"),l=r.replace(/\?$/,"");if(n.length===0)return o?[l,""]:[l];let d=rQ(n.join("/")),i=[];return i.push(...d.map(g=>g===""?l:[l,g].join("/"))),o&&i.push(...d),i.map(g=>e.startsWith("/")&&g===""?"/":g)}function Jxe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:o0e(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Qxe=/^:[\w-]+$/,e0e=3,t0e=2,r0e=1,n0e=10,i0e=-2,Wq=e=>e==="*";function a0e(e,t){let r=e.split("/"),n=r.length;return r.some(Wq)&&(n+=i0e),t&&(n+=t0e),r.filter(o=>!Wq(o)).reduce((o,l)=>o+(Qxe.test(l)?e0e:l===""?r0e:n0e),n)}function o0e(e,t){return e.length===t.length&&e.slice(0,-1).every((n,o)=>n===t[o])?e[e.length-1]-t[t.length-1]:0}function s0e(e,t,r){let{routesMeta:n}=e,o={},l="/",d=[];for(let i=0;i<n.length;++i){let g=n[i],x=i===n.length-1,S=l==="/"?t:t.slice(l.length)||"/",E=Gq({path:g.relativePath,caseSensitive:g.caseSensitive,end:x},S),A=g.route;if(!E&&x&&r&&!n[n.length-1].route.index&&(E=Gq({path:g.relativePath,caseSensitive:g.caseSensitive,end:!1},S)),!E)return null;Object.assign(o,E.params),d.push({params:o,pathname:Nm([l,E.pathname]),pathnameBase:f0e(Nm([l,E.pathnameBase])),route:A}),E.pathnameBase!=="/"&&(l=Nm([l,E.pathnameBase]))}return d}function Gq(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=l0e(e.path,e.caseSensitive,e.end),o=t.match(r);if(!o)return null;let l=o[0],d=l.replace(/(.)\/+$/,"$1"),i=o.slice(1);return{params:n.reduce((x,S,E)=>{let{paramName:A,isOptional:C}=S;if(A==="*"){let k=i[E]||"";d=l.slice(0,l.length-k.length).replace(/(.)\/+$/,"$1")}const N=i[E];return C&&!N?x[A]=void 0:x[A]=(N||"").replace(/%2F/g,"/"),x},{}),pathname:l,pathnameBase:d,pattern:e}}function l0e(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),eQ(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],o="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(d,i,g)=>(n.push({paramName:i,isOptional:g!=null}),g?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),o+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?o+="\\/*$":e!==""&&e!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,t?void 0:"i"),n]}function c0e(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return eQ(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function IB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function u0e(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:o=""}=typeof e=="string"?Ab(e):e;return{pathname:r?r.startsWith("/")?r:d0e(r,t):t,search:p0e(n),hash:m0e(o)}}function d0e(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(o=>{o===".."?r.length>1&&r.pop():o!=="."&&r.push(o)}),r.length>1?r.join("/"):"/"}function wM(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function h0e(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function kB(e,t){let r=h0e(e);return t?r.map((n,o)=>o===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function RB(e,t,r,n){n===void 0&&(n=!1);let o;typeof e=="string"?o=Ab(e):(o=SE({},e),Lo(!o.pathname||!o.pathname.includes("?"),wM("?","pathname","search",o)),Lo(!o.pathname||!o.pathname.includes("#"),wM("#","pathname","hash",o)),Lo(!o.search||!o.search.includes("#"),wM("#","search","hash",o)));let l=e===""||o.pathname==="",d=l?"/":o.pathname,i;if(d==null)i=r;else{let E=t.length-1;if(!n&&d.startsWith("..")){let A=d.split("/");for(;A[0]==="..";)A.shift(),E-=1;o.pathname=A.join("/")}i=E>=0?t[E]:"/"}let g=u0e(o,i),x=d&&d!=="/"&&d.endsWith("/"),S=(l||d===".")&&r.endsWith("/");return!g.pathname.endsWith("/")&&(x||S)&&(g.pathname+="/"),g}const Nm=e=>e.join("/").replace(/\/\/+/g,"/"),f0e=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),p0e=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,m0e=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function g0e(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const nQ=["post","put","patch","delete"];new Set(nQ);const y0e=["get",...nQ];new Set(y0e);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function EE(){return EE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},EE.apply(this,arguments)}const jB=G.createContext(null),v0e=G.createContext(null),tg=G.createContext(null),dk=G.createContext(null),$f=G.createContext({outlet:null,matches:[],isDataRoute:!1}),iQ=G.createContext(null);function _0e(e,t){let{relative:r}=t===void 0?{}:t;Pb()||Lo(!1);let{basename:n,navigator:o}=G.useContext(tg),{hash:l,pathname:d,search:i}=sQ(e,{relative:r}),g=d;return n!=="/"&&(g=d==="/"?n:Nm([n,d])),o.createHref({pathname:g,search:i,hash:l})}function Pb(){return G.useContext(dk)!=null}function Uf(){return Pb()||Lo(!1),G.useContext(dk).location}function aQ(e){G.useContext(tg).static||G.useLayoutEffect(e)}function Vf(){let{isDataRoute:e}=G.useContext($f);return e?R0e():x0e()}function x0e(){Pb()||Lo(!1);let e=G.useContext(jB),{basename:t,future:r,navigator:n}=G.useContext(tg),{matches:o}=G.useContext($f),{pathname:l}=Uf(),d=JSON.stringify(kB(o,r.v7_relativeSplatPath)),i=G.useRef(!1);return aQ(()=>{i.current=!0}),G.useCallback(function(x,S){if(S===void 0&&(S={}),!i.current)return;if(typeof x=="number"){n.go(x);return}let E=RB(x,JSON.parse(d),l,S.relative==="path");e==null&&t!=="/"&&(E.pathname=E.pathname==="/"?t:Nm([t,E.pathname])),(S.replace?n.replace:n.push)(E,S.state,S)},[t,n,d,l,e])}function oQ(){let{matches:e}=G.useContext($f),t=e[e.length-1];return t?t.params:{}}function sQ(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=G.useContext(tg),{matches:o}=G.useContext($f),{pathname:l}=Uf(),d=JSON.stringify(kB(o,n.v7_relativeSplatPath));return G.useMemo(()=>RB(e,JSON.parse(d),l,r==="path"),[e,d,l,r])}function b0e(e,t){return w0e(e,t)}function w0e(e,t,r,n){Pb()||Lo(!1);let{navigator:o}=G.useContext(tg),{matches:l}=G.useContext($f),d=l[l.length-1],i=d?d.params:{};d&&d.pathname;let g=d?d.pathnameBase:"/";d&&d.route;let x=Uf(),S;if(t){var E;let R=typeof t=="string"?Ab(t):t;g==="/"||(E=R.pathname)!=null&&E.startsWith(g)||Lo(!1),S=R}else S=x;let A=S.pathname||"/",C=A;if(g!=="/"){let R=g.replace(/^\//,"").split("/");C="/"+A.replace(/^\//,"").split("/").slice(R.length).join("/")}let N=Xxe(e,{pathname:C}),k=P0e(N&&N.map(R=>Object.assign({},R,{params:Object.assign({},i,R.params),pathname:Nm([g,o.encodeLocation?o.encodeLocation(R.pathname).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?g:Nm([g,o.encodeLocation?o.encodeLocation(R.pathnameBase).pathname:R.pathnameBase])})),l,r,n);return t&&k?G.createElement(dk.Provider,{value:{location:EE({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:bm.Pop}},k):k}function S0e(){let e=k0e(),t=g0e(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return G.createElement(G.Fragment,null,G.createElement("h2",null,"Unexpected Application Error!"),G.createElement("h3",{style:{fontStyle:"italic"}},t),r?G.createElement("pre",{style:o},r):null,null)}const E0e=G.createElement(S0e,null);class T0e extends G.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?G.createElement($f.Provider,{value:this.props.routeContext},G.createElement(iQ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function A0e(e){let{routeContext:t,match:r,children:n}=e,o=G.useContext(jB);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),G.createElement($f.Provider,{value:t},n)}function P0e(e,t,r,n){var o;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var l;if(!r)return null;if(r.errors)e=r.matches;else if((l=n)!=null&&l.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let d=e,i=(o=r)==null?void 0:o.errors;if(i!=null){let S=d.findIndex(E=>E.route.id&&(i==null?void 0:i[E.route.id])!==void 0);S>=0||Lo(!1),d=d.slice(0,Math.min(d.length,S+1))}let g=!1,x=-1;if(r&&n&&n.v7_partialHydration)for(let S=0;S<d.length;S++){let E=d[S];if((E.route.HydrateFallback||E.route.hydrateFallbackElement)&&(x=S),E.route.id){let{loaderData:A,errors:C}=r,N=E.route.loader&&A[E.route.id]===void 0&&(!C||C[E.route.id]===void 0);if(E.route.lazy||N){g=!0,x>=0?d=d.slice(0,x+1):d=[d[0]];break}}}return d.reduceRight((S,E,A)=>{let C,N=!1,k=null,R=null;r&&(C=i&&E.route.id?i[E.route.id]:void 0,k=E.route.errorElement||E0e,g&&(x<0&&A===0?(N=!0,R=null):x===A&&(N=!0,R=E.route.hydrateFallbackElement||null)));let L=t.concat(d.slice(0,A+1)),j=()=>{let F;return C?F=k:N?F=R:E.route.Component?F=G.createElement(E.route.Component,null):E.route.element?F=E.route.element:F=S,G.createElement(A0e,{match:E,routeContext:{outlet:S,matches:L,isDataRoute:r!=null},children:F})};return r&&(E.route.ErrorBoundary||E.route.errorElement||A===0)?G.createElement(T0e,{location:r.location,revalidation:r.revalidation,component:k,error:C,children:j(),routeContext:{outlet:null,matches:L,isDataRoute:!0}}):j()},null)}var lQ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(lQ||{}),iO=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(iO||{});function C0e(e){let t=G.useContext(jB);return t||Lo(!1),t}function O0e(e){let t=G.useContext(v0e);return t||Lo(!1),t}function I0e(e){let t=G.useContext($f);return t||Lo(!1),t}function cQ(e){let t=I0e(),r=t.matches[t.matches.length-1];return r.route.id||Lo(!1),r.route.id}function k0e(){var e;let t=G.useContext(iQ),r=O0e(iO.UseRouteError),n=cQ(iO.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function R0e(){let{router:e}=C0e(lQ.UseNavigateStable),t=cQ(iO.UseNavigateStable),r=G.useRef(!1);return aQ(()=>{r.current=!0}),G.useCallback(function(o,l){l===void 0&&(l={}),r.current&&(typeof o=="number"?e.navigate(o):e.navigate(o,EE({fromRouteId:t},l)))},[e,t])}function j0e(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function N0e(e){let{to:t,replace:r,state:n,relative:o}=e;Pb()||Lo(!1);let{future:l,static:d}=G.useContext(tg),{matches:i}=G.useContext($f),{pathname:g}=Uf(),x=Vf(),S=RB(t,kB(i,l.v7_relativeSplatPath),g,o==="path"),E=JSON.stringify(S);return G.useEffect(()=>x(JSON.parse(E),{replace:r,state:n,relative:o}),[x,E,o,r,n]),null}function ls(e){Lo(!1)}function M0e(e){let{basename:t="/",children:r=null,location:n,navigationType:o=bm.Pop,navigator:l,static:d=!1,future:i}=e;Pb()&&Lo(!1);let g=t.replace(/^\/*/,"/"),x=G.useMemo(()=>({basename:g,navigator:l,static:d,future:EE({v7_relativeSplatPath:!1},i)}),[g,i,l,d]);typeof n=="string"&&(n=Ab(n));let{pathname:S="/",search:E="",hash:A="",state:C=null,key:N="default"}=n,k=G.useMemo(()=>{let R=IB(S,g);return R==null?null:{location:{pathname:R,search:E,hash:A,state:C,key:N},navigationType:o}},[g,S,E,A,C,N,o]);return k==null?null:G.createElement(tg.Provider,{value:x},G.createElement(dk.Provider,{children:r,value:k}))}function D0e(e){let{children:t,location:r}=e;return b0e(qL(t),r)}new Promise(()=>{});function qL(e,t){t===void 0&&(t=[]);let r=[];return G.Children.forEach(e,(n,o)=>{if(!G.isValidElement(n))return;let l=[...t,o];if(n.type===G.Fragment){r.push.apply(r,qL(n.props.children,l));return}n.type!==ls&&Lo(!1),!n.props.index||!n.props.children||Lo(!1);let d={id:n.props.id||l.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(d.children=qL(n.props.children,l)),r.push(d)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function WL(){return WL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},WL.apply(this,arguments)}function L0e(e,t){if(e==null)return{};var r={},n=Object.keys(e),o,l;for(l=0;l<n.length;l++)o=n[l],!(t.indexOf(o)>=0)&&(r[o]=e[o]);return r}function F0e(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function z0e(e,t){return e.button===0&&(!t||t==="_self")&&!F0e(e)}const B0e=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],$0e="6";try{window.__reactRouterVersion=$0e}catch{}const U0e="startTransition",Hq=fz[U0e];function V0e(e){let{basename:t,children:r,future:n,window:o}=e,l=G.useRef();l.current==null&&(l.current=Hxe({window:o,v5Compat:!0}));let d=l.current,[i,g]=G.useState({action:d.action,location:d.location}),{v7_startTransition:x}=n||{},S=G.useCallback(E=>{x&&Hq?Hq(()=>g(E)):g(E)},[g,x]);return G.useLayoutEffect(()=>d.listen(S),[d,S]),G.useEffect(()=>j0e(n),[n]),G.createElement(M0e,{basename:t,children:r,location:i.location,navigationType:i.action,navigator:d,future:n})}const q0e=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",W0e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vi=G.forwardRef(function(t,r){let{onClick:n,relative:o,reloadDocument:l,replace:d,state:i,target:g,to:x,preventScrollReset:S,viewTransition:E}=t,A=L0e(t,B0e),{basename:C}=G.useContext(tg),N,k=!1;if(typeof x=="string"&&W0e.test(x)&&(N=x,q0e))try{let F=new URL(window.location.href),B=x.startsWith("//")?new URL(F.protocol+x):new URL(x),U=IB(B.pathname,C);B.origin===F.origin&&U!=null?x=U+B.search+B.hash:k=!0}catch{}let R=_0e(x,{relative:o}),L=G0e(x,{replace:d,state:i,target:g,preventScrollReset:S,relative:o,viewTransition:E});function j(F){n&&n(F),F.defaultPrevented||L(F)}return G.createElement("a",WL({},A,{href:N||R,onClick:k||l?n:j,ref:r,target:g}))});var Kq;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Kq||(Kq={}));var Zq;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(Zq||(Zq={}));function G0e(e,t){let{target:r,replace:n,state:o,preventScrollReset:l,relative:d,viewTransition:i}=t===void 0?{}:t,g=Vf(),x=Uf(),S=sQ(e,{relative:d});return G.useCallback(E=>{if(z0e(E,r)){E.preventDefault();let A=n!==void 0?n:nO(x)===nO(S);g(e,{replace:A,state:o,preventScrollReset:l,relative:d,viewTransition:i})}},[x,g,S,n,o,r,e,l,d,i])}var GL=function(e,t){return GL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])},GL(e,t)};function uQ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");GL(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var _u=function(){return _u=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},_u.apply(this,arguments)};function rg(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function dQ(e,t,r,n){var o=arguments.length,l=o<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(e,t,r,n);else for(var i=e.length-1;i>=0;i--)(d=e[i])&&(l=(o<3?d(l):o>3?d(t,r,l):d(t,r))||l);return o>3&&l&&Object.defineProperty(t,r,l),l}function hQ(e,t){return function(r,n){t(r,n,e)}}function fQ(e,t,r,n,o,l){function d(L){if(L!==void 0&&typeof L!="function")throw new TypeError("Function expected");return L}for(var i=n.kind,g=i==="getter"?"get":i==="setter"?"set":"value",x=!t&&e?n.static?e:e.prototype:null,S=t||(x?Object.getOwnPropertyDescriptor(x,n.name):{}),E,A=!1,C=r.length-1;C>=0;C--){var N={};for(var k in n)N[k]=k==="access"?{}:n[k];for(var k in n.access)N.access[k]=n.access[k];N.addInitializer=function(L){if(A)throw new TypeError("Cannot add initializers after decoration has completed");l.push(d(L||null))};var R=(0,r[C])(i==="accessor"?{get:S.get,set:S.set}:S[g],N);if(i==="accessor"){if(R===void 0)continue;if(R===null||typeof R!="object")throw new TypeError("Object expected");(E=d(R.get))&&(S.get=E),(E=d(R.set))&&(S.set=E),(E=d(R.init))&&o.unshift(E)}else(E=d(R))&&(i==="field"?o.unshift(E):S[g]=E)}x&&Object.defineProperty(x,n.name,S),A=!0}function pQ(e,t,r){for(var n=arguments.length>2,o=0;o<t.length;o++)r=n?t[o].call(e,r):t[o].call(e);return n?r:void 0}function mQ(e){return typeof e=="symbol"?e:"".concat(e)}function gQ(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function yQ(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function Cn(e,t,r,n){function o(l){return l instanceof r?l:new r(function(d){d(l)})}return new(r||(r=Promise))(function(l,d){function i(S){try{x(n.next(S))}catch(E){d(E)}}function g(S){try{x(n.throw(S))}catch(E){d(E)}}function x(S){S.done?l(S.value):o(S.value).then(i,g)}x((n=n.apply(e,t||[])).next())})}function vQ(e,t){var r={label:0,sent:function(){if(l[0]&1)throw l[1];return l[1]},trys:[],ops:[]},n,o,l,d=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return d.next=i(0),d.throw=i(1),d.return=i(2),typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function i(x){return function(S){return g([x,S])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;d&&(d=0,x[0]&&(r=0)),r;)try{if(n=1,o&&(l=x[0]&2?o.return:x[0]?o.throw||((l=o.return)&&l.call(o),0):o.next)&&!(l=l.call(o,x[1])).done)return l;switch(o=0,l&&(x=[x[0]&2,l.value]),x[0]){case 0:case 1:l=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,o=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(l=r.trys,!(l=l.length>0&&l[l.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!l||x[1]>l[0]&&x[1]<l[3])){r.label=x[1];break}if(x[0]===6&&r.label<l[1]){r.label=l[1],l=x;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(x);break}l[2]&&r.ops.pop(),r.trys.pop();continue}x=t.call(e,r)}catch(S){x=[6,S],o=0}finally{n=l=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var hk=Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function _Q(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&hk(t,e,r)}function aO(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function NB(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,l=[],d;try{for(;(t===void 0||t-- >0)&&!(o=n.next()).done;)l.push(o.value)}catch(i){d={error:i}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(d)throw d.error}}return l}function xQ(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(NB(arguments[t]));return e}function bQ(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var l=arguments[t],d=0,i=l.length;d<i;d++,o++)n[o]=l[d];return n}function MB(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,l;n<o;n++)(l||!(n in t))&&(l||(l=Array.prototype.slice.call(t,0,n)),l[n]=t[n]);return e.concat(l||Array.prototype.slice.call(t))}function R0(e){return this instanceof R0?(this.v=e,this):new R0(e)}function wQ(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),o,l=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",d),o[Symbol.asyncIterator]=function(){return this},o;function d(C){return function(N){return Promise.resolve(N).then(C,E)}}function i(C,N){n[C]&&(o[C]=function(k){return new Promise(function(R,L){l.push([C,k,R,L])>1||g(C,k)})},N&&(o[C]=N(o[C])))}function g(C,N){try{x(n[C](N))}catch(k){A(l[0][3],k)}}function x(C){C.value instanceof R0?Promise.resolve(C.value.v).then(S,E):A(l[0][2],C)}function S(C){g("next",C)}function E(C){g("throw",C)}function A(C,N){C(N),l.shift(),l.length&&g(l[0][0],l[0][1])}}function SQ(e){var t,r;return t={},n("next"),n("throw",function(o){throw o}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(o,l){t[o]=e[o]?function(d){return(r=!r)?{value:R0(e[o](d)),done:!1}:l?l(d):d}:l}}function EQ(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof aO=="function"?aO(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(l){r[l]=e[l]&&function(d){return new Promise(function(i,g){d=e[l](d),o(i,g,d.done,d.value)})}}function o(l,d,i,g){Promise.resolve(g).then(function(x){l({value:x,done:i})},d)}}function TQ(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var H0e=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},HL=function(e){return HL=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},HL(e)};function AQ(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=HL(e),n=0;n<r.length;n++)r[n]!=="default"&&hk(t,e,r[n]);return H0e(t,e),t}function PQ(e){return e&&e.__esModule?e:{default:e}}function CQ(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function OQ(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r}function IQ(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function kQ(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,o;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(o=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");o&&(n=function(){try{o.call(this)}catch(l){return Promise.reject(l)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var K0e=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function RQ(e){function t(l){e.error=e.hasError?new K0e(l,e.error,"An error was suppressed during disposal."):l,e.hasError=!0}var r,n=0;function o(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(o);if(r.dispose){var l=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(l).then(o,function(d){return t(d),o()})}else n|=1}catch(d){t(d)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return o()}function jQ(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,o,l,d){return n?t?".jsx":".js":o&&(!l||!d)?r:o+l+"."+d.toLowerCase()+"js"}):e}const Z0e={__extends:uQ,__assign:_u,__rest:rg,__decorate:dQ,__param:hQ,__esDecorate:fQ,__runInitializers:pQ,__propKey:mQ,__setFunctionName:gQ,__metadata:yQ,__awaiter:Cn,__generator:vQ,__createBinding:hk,__exportStar:_Q,__values:aO,__read:NB,__spread:xQ,__spreadArrays:bQ,__spreadArray:MB,__await:R0,__asyncGenerator:wQ,__asyncDelegator:SQ,__asyncValues:EQ,__makeTemplateObject:TQ,__importStar:AQ,__importDefault:PQ,__classPrivateFieldGet:CQ,__classPrivateFieldSet:OQ,__classPrivateFieldIn:IQ,__addDisposableResource:kQ,__disposeResources:RQ,__rewriteRelativeImportExtension:jQ},X0e=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:kQ,get __assign(){return _u},__asyncDelegator:SQ,__asyncGenerator:wQ,__asyncValues:EQ,__await:R0,__awaiter:Cn,__classPrivateFieldGet:CQ,__classPrivateFieldIn:IQ,__classPrivateFieldSet:OQ,__createBinding:hk,__decorate:dQ,__disposeResources:RQ,__esDecorate:fQ,__exportStar:_Q,__extends:uQ,__generator:vQ,__importDefault:PQ,__importStar:AQ,__makeTemplateObject:TQ,__metadata:yQ,__param:hQ,__propKey:mQ,__read:NB,__rest:rg,__rewriteRelativeImportExtension:jQ,__runInitializers:pQ,__setFunctionName:gQ,__spread:xQ,__spreadArray:MB,__spreadArrays:bQ,__values:aO,default:Z0e},Symbol.toStringTag,{value:"Module"})),Y0e=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class fk extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class NQ extends fk{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class KL extends fk{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class ZL extends fk{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var oO;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(oO||(oO={}));class J0e{constructor(t,{headers:r={},customFetch:n,region:o=oO.Any}={}){this.url=t,this.headers=r,this.region=o,this.fetch=Y0e(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Cn(this,arguments,void 0,function*(r,n={}){var o;let l,d;try{const{headers:i,method:g,body:x,signal:S,timeout:E}=n;let A={},{region:C}=n;C||(C=this.region);const N=new URL(`${this.url}/${r}`);C&&C!=="any"&&(A["x-region"]=C,N.searchParams.set("forceFunctionRegion",C));let k;x&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&x instanceof Blob||x instanceof ArrayBuffer?(A["Content-Type"]="application/octet-stream",k=x):typeof x=="string"?(A["Content-Type"]="text/plain",k=x):typeof FormData<"u"&&x instanceof FormData?k=x:(A["Content-Type"]="application/json",k=JSON.stringify(x)):k=x;let R=S;E&&(d=new AbortController,l=setTimeout(()=>d.abort(),E),S?(R=d.signal,S.addEventListener("abort",()=>d.abort())):R=d.signal);const L=yield this.fetch(N.toString(),{method:g||"POST",headers:Object.assign(Object.assign(Object.assign({},A),this.headers),i),body:k,signal:R}).catch(U=>{throw new NQ(U)}),j=L.headers.get("x-relay-error");if(j&&j==="true")throw new KL(L);if(!L.ok)throw new ZL(L);let F=((o=L.headers.get("Content-Type"))!==null&&o!==void 0?o:"text/plain").split(";")[0].trim(),B;return F==="application/json"?B=yield L.json():F==="application/octet-stream"||F==="application/pdf"?B=yield L.blob():F==="text/event-stream"?B=L:F==="multipart/form-data"?B=yield L.formData():B=yield L.text(),{data:B,error:null,response:L}}catch(i){return{data:null,error:i,response:i instanceof ZL||i instanceof KL?i.context:void 0}}finally{l&&clearTimeout(l)}})}}var Bl={};const Cb=wfe(X0e);var bP={},wP={},SP={},EP={},TP={},AP={},Xq;function MQ(){if(Xq)return AP;Xq=1,Object.defineProperty(AP,"__esModule",{value:!0});class e extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}}return AP.default=e,AP}var Yq;function DQ(){if(Yq)return TP;Yq=1,Object.defineProperty(TP,"__esModule",{value:!0});const t=Cb.__importDefault(MQ());class r{constructor(o){var l,d;this.shouldThrowOnError=!1,this.method=o.method,this.url=o.url,this.headers=new Headers(o.headers),this.schema=o.schema,this.body=o.body,this.shouldThrowOnError=(l=o.shouldThrowOnError)!==null&&l!==void 0?l:!1,this.signal=o.signal,this.isMaybeSingle=(d=o.isMaybeSingle)!==null&&d!==void 0?d:!1,o.fetch?this.fetch=o.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(o,l){return this.headers=new Headers(this.headers),this.headers.set(o,l),this}then(o,l){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const d=this.fetch;let i=d(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async g=>{var x,S,E,A;let C=null,N=null,k=null,R=g.status,L=g.statusText;if(g.ok){if(this.method!=="HEAD"){const U=await g.text();U===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((x=this.headers.get("Accept"))===null||x===void 0)&&x.includes("application/vnd.pgrst.plan+text"))?N=U:N=JSON.parse(U))}const F=(S=this.headers.get("Prefer"))===null||S===void 0?void 0:S.match(/count=(exact|planned|estimated)/),B=(E=g.headers.get("content-range"))===null||E===void 0?void 0:E.split("/");F&&B&&B.length>1&&(k=parseInt(B[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(N)&&(N.length>1?(C={code:"PGRST116",details:`Results contain ${N.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},N=null,k=null,R=406,L="Not Acceptable"):N.length===1?N=N[0]:N=null)}else{const F=await g.text();try{C=JSON.parse(F),Array.isArray(C)&&g.status===404&&(N=[],C=null,R=200,L="OK")}catch{g.status===404&&F===""?(R=204,L="No Content"):C={message:F}}if(C&&this.isMaybeSingle&&(!((A=C==null?void 0:C.details)===null||A===void 0)&&A.includes("0 rows"))&&(C=null,R=200,L="OK"),C&&this.shouldThrowOnError)throw new t.default(C)}return{error:C,data:N,count:k,status:R,statusText:L}});return this.shouldThrowOnError||(i=i.catch(g=>{var x,S,E,A,C,N;let k="";const R=g==null?void 0:g.cause;if(R){const L=(x=R==null?void 0:R.message)!==null&&x!==void 0?x:"",j=(S=R==null?void 0:R.code)!==null&&S!==void 0?S:"";k=`${(E=g==null?void 0:g.name)!==null&&E!==void 0?E:"FetchError"}: ${g==null?void 0:g.message}`,k+=`

Caused by: ${(A=R==null?void 0:R.name)!==null&&A!==void 0?A:"Error"}: ${L}`,j&&(k+=` (${j})`),R!=null&&R.stack&&(k+=`
${R.stack}`)}else k=(C=g==null?void 0:g.stack)!==null&&C!==void 0?C:"";return{error:{message:`${(N=g==null?void 0:g.name)!==null&&N!==void 0?N:"FetchError"}: ${g==null?void 0:g.message}`,details:k,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(o,l)}returns(){return this}overrideTypes(){return this}}return TP.default=r,TP}var Jq;function LQ(){if(Jq)return EP;Jq=1,Object.defineProperty(EP,"__esModule",{value:!0});const t=Cb.__importDefault(DQ());class r extends t.default{select(o){let l=!1;const d=(o??"*").split("").map(i=>/\s/.test(i)&&!l?"":(i==='"'&&(l=!l),i)).join("");return this.url.searchParams.set("select",d),this.headers.append("Prefer","return=representation"),this}order(o,{ascending:l=!0,nullsFirst:d,foreignTable:i,referencedTable:g=i}={}){const x=g?`${g}.order`:"order",S=this.url.searchParams.get(x);return this.url.searchParams.set(x,`${S?`${S},`:""}${o}.${l?"asc":"desc"}${d===void 0?"":d?".nullsfirst":".nullslast"}`),this}limit(o,{foreignTable:l,referencedTable:d=l}={}){const i=typeof d>"u"?"limit":`${d}.limit`;return this.url.searchParams.set(i,`${o}`),this}range(o,l,{foreignTable:d,referencedTable:i=d}={}){const g=typeof i>"u"?"offset":`${i}.offset`,x=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(g,`${o}`),this.url.searchParams.set(x,`${l-o+1}`),this}abortSignal(o){return this.signal=o,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:o=!1,verbose:l=!1,settings:d=!1,buffers:i=!1,wal:g=!1,format:x="text"}={}){var S;const E=[o?"analyze":null,l?"verbose":null,d?"settings":null,i?"buffers":null,g?"wal":null].filter(Boolean).join("|"),A=(S=this.headers.get("Accept"))!==null&&S!==void 0?S:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${x}; for="${A}"; options=${E};`),x==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(o){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${o}`),this}}return EP.default=r,EP}var Qq;function DB(){if(Qq)return SP;Qq=1,Object.defineProperty(SP,"__esModule",{value:!0});const t=Cb.__importDefault(LQ()),r=new RegExp("[,()]");class n extends t.default{eq(l,d){return this.url.searchParams.append(l,`eq.${d}`),this}neq(l,d){return this.url.searchParams.append(l,`neq.${d}`),this}gt(l,d){return this.url.searchParams.append(l,`gt.${d}`),this}gte(l,d){return this.url.searchParams.append(l,`gte.${d}`),this}lt(l,d){return this.url.searchParams.append(l,`lt.${d}`),this}lte(l,d){return this.url.searchParams.append(l,`lte.${d}`),this}like(l,d){return this.url.searchParams.append(l,`like.${d}`),this}likeAllOf(l,d){return this.url.searchParams.append(l,`like(all).{${d.join(",")}}`),this}likeAnyOf(l,d){return this.url.searchParams.append(l,`like(any).{${d.join(",")}}`),this}ilike(l,d){return this.url.searchParams.append(l,`ilike.${d}`),this}ilikeAllOf(l,d){return this.url.searchParams.append(l,`ilike(all).{${d.join(",")}}`),this}ilikeAnyOf(l,d){return this.url.searchParams.append(l,`ilike(any).{${d.join(",")}}`),this}regexMatch(l,d){return this.url.searchParams.append(l,`match.${d}`),this}regexIMatch(l,d){return this.url.searchParams.append(l,`imatch.${d}`),this}is(l,d){return this.url.searchParams.append(l,`is.${d}`),this}isDistinct(l,d){return this.url.searchParams.append(l,`isdistinct.${d}`),this}in(l,d){const i=Array.from(new Set(d)).map(g=>typeof g=="string"&&r.test(g)?`"${g}"`:`${g}`).join(",");return this.url.searchParams.append(l,`in.(${i})`),this}contains(l,d){return typeof d=="string"?this.url.searchParams.append(l,`cs.${d}`):Array.isArray(d)?this.url.searchParams.append(l,`cs.{${d.join(",")}}`):this.url.searchParams.append(l,`cs.${JSON.stringify(d)}`),this}containedBy(l,d){return typeof d=="string"?this.url.searchParams.append(l,`cd.${d}`):Array.isArray(d)?this.url.searchParams.append(l,`cd.{${d.join(",")}}`):this.url.searchParams.append(l,`cd.${JSON.stringify(d)}`),this}rangeGt(l,d){return this.url.searchParams.append(l,`sr.${d}`),this}rangeGte(l,d){return this.url.searchParams.append(l,`nxl.${d}`),this}rangeLt(l,d){return this.url.searchParams.append(l,`sl.${d}`),this}rangeLte(l,d){return this.url.searchParams.append(l,`nxr.${d}`),this}rangeAdjacent(l,d){return this.url.searchParams.append(l,`adj.${d}`),this}overlaps(l,d){return typeof d=="string"?this.url.searchParams.append(l,`ov.${d}`):this.url.searchParams.append(l,`ov.{${d.join(",")}}`),this}textSearch(l,d,{config:i,type:g}={}){let x="";g==="plain"?x="pl":g==="phrase"?x="ph":g==="websearch"&&(x="w");const S=i===void 0?"":`(${i})`;return this.url.searchParams.append(l,`${x}fts${S}.${d}`),this}match(l){return Object.entries(l).forEach(([d,i])=>{this.url.searchParams.append(d,`eq.${i}`)}),this}not(l,d,i){return this.url.searchParams.append(l,`not.${d}.${i}`),this}or(l,{foreignTable:d,referencedTable:i=d}={}){const g=i?`${i}.or`:"or";return this.url.searchParams.append(g,`(${l})`),this}filter(l,d,i){return this.url.searchParams.append(l,`${d}.${i}`),this}}return SP.default=n,SP}var eW;function FQ(){if(eW)return wP;eW=1,Object.defineProperty(wP,"__esModule",{value:!0});const t=Cb.__importDefault(DB());class r{constructor(o,{headers:l={},schema:d,fetch:i}){this.url=o,this.headers=new Headers(l),this.schema=d,this.fetch=i}select(o,l){const{head:d=!1,count:i}=l??{},g=d?"HEAD":"GET";let x=!1;const S=(o??"*").split("").map(E=>/\s/.test(E)&&!x?"":(E==='"'&&(x=!x),E)).join("");return this.url.searchParams.set("select",S),i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:g,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(o,{count:l,defaultToNull:d=!0}={}){var i;const g="POST";if(l&&this.headers.append("Prefer",`count=${l}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const x=o.reduce((S,E)=>S.concat(Object.keys(E)),[]);if(x.length>0){const S=[...new Set(x)].map(E=>`"${E}"`);this.url.searchParams.set("columns",S.join(","))}}return new t.default({method:g,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(o,{onConflict:l,ignoreDuplicates:d=!1,count:i,defaultToNull:g=!0}={}){var x;const S="POST";if(this.headers.append("Prefer",`resolution=${d?"ignore":"merge"}-duplicates`),l!==void 0&&this.url.searchParams.set("on_conflict",l),i&&this.headers.append("Prefer",`count=${i}`),g||this.headers.append("Prefer","missing=default"),Array.isArray(o)){const E=o.reduce((A,C)=>A.concat(Object.keys(C)),[]);if(E.length>0){const A=[...new Set(E)].map(C=>`"${C}"`);this.url.searchParams.set("columns",A.join(","))}}return new t.default({method:S,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(x=this.fetch)!==null&&x!==void 0?x:fetch})}update(o,{count:l}={}){var d;const i="PATCH";return l&&this.headers.append("Prefer",`count=${l}`),new t.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:o,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}delete({count:o}={}){var l;const d="DELETE";return o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}}return wP.default=r,wP}var tW;function Q0e(){if(tW)return bP;tW=1,Object.defineProperty(bP,"__esModule",{value:!0});const e=Cb,t=e.__importDefault(FQ()),r=e.__importDefault(DB());class n{constructor(l,{headers:d={},schema:i,fetch:g}={}){this.url=l,this.headers=new Headers(d),this.schemaName=i,this.fetch=g}from(l){if(!l||typeof l!="string"||l.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");const d=new URL(`${this.url}/${l}`);return new t.default(d,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(l){return new n(this.url,{headers:this.headers,schema:l,fetch:this.fetch})}rpc(l,d={},{head:i=!1,get:g=!1,count:x}={}){var S;let E;const A=new URL(`${this.url}/rpc/${l}`);let C;i||g?(E=i?"HEAD":"GET",Object.entries(d).filter(([k,R])=>R!==void 0).map(([k,R])=>[k,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([k,R])=>{A.searchParams.append(k,R)})):(E="POST",C=d);const N=new Headers(this.headers);return x&&N.set("Prefer",`count=${x}`),new r.default({method:E,url:A,headers:N,schema:this.schemaName,body:C,fetch:(S=this.fetch)!==null&&S!==void 0?S:fetch})}}return bP.default=n,bP}Object.defineProperty(Bl,"__esModule",{value:!0});var zQ=Bl.PostgrestError=ZQ=Bl.PostgrestBuilder=HQ=Bl.PostgrestTransformBuilder=WQ=Bl.PostgrestFilterBuilder=VQ=Bl.PostgrestQueryBuilder=$Q=Bl.PostgrestClient=void 0;const Ob=Cb,BQ=Ob.__importDefault(Q0e());var $Q=Bl.PostgrestClient=BQ.default;const UQ=Ob.__importDefault(FQ());var VQ=Bl.PostgrestQueryBuilder=UQ.default;const qQ=Ob.__importDefault(DB());var WQ=Bl.PostgrestFilterBuilder=qQ.default;const GQ=Ob.__importDefault(LQ());var HQ=Bl.PostgrestTransformBuilder=GQ.default;const KQ=Ob.__importDefault(DQ());var ZQ=Bl.PostgrestBuilder=KQ.default;const XQ=Ob.__importDefault(MQ());zQ=Bl.PostgrestError=XQ.default;var YQ=Bl.default={PostgrestClient:BQ.default,PostgrestQueryBuilder:UQ.default,PostgrestFilterBuilder:qQ.default,PostgrestTransformBuilder:GQ.default,PostgrestBuilder:KQ.default,PostgrestError:XQ.default};const ebe=rZ({__proto__:null,get PostgrestBuilder(){return ZQ},get PostgrestClient(){return $Q},get PostgrestError(){return zQ},get PostgrestFilterBuilder(){return WQ},get PostgrestQueryBuilder(){return VQ},get PostgrestTransformBuilder(){return HQ},default:YQ},[Bl]),{PostgrestClient:tbe,PostgrestQueryBuilder:bet,PostgrestFilterBuilder:wet,PostgrestTransformBuilder:Eet,PostgrestBuilder:Tet,PostgrestError:rbe}=YQ||ebe;class JQ{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const r=process.versions;if(r&&r.node){const n=r.node,o=parseInt(n.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const nbe="2.84.0",ibe=`realtime-js/${nbe}`,QQ="1.0.0",abe="2.0.0",rW=QQ,XL=1e4,obe=1e3,sbe=100;var Py;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Py||(Py={}));var us;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(us||(us={}));var fd;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(fd||(fd={}));var YL;(function(e){e.websocket="websocket"})(YL||(YL={}));var Cy;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Cy||(Cy={}));class lbe{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n,o,l;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",g=(n=t.join_ref)!==null&&n!==void 0?n:"",x=t.payload.event,S=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:new ArrayBuffer(0),E=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+i.length+d.length+x.length,A=new ArrayBuffer(this.HEADER_LENGTH+E);let C=new DataView(A),N=0;C.setUint8(N++,this.KINDS.userBroadcastPush),C.setUint8(N++,g.length),C.setUint8(N++,i.length),C.setUint8(N++,d.length),C.setUint8(N++,x.length),C.setUint8(N++,this.BINARY_ENCODING),Array.from(g,R=>C.setUint8(N++,R.charCodeAt(0))),Array.from(i,R=>C.setUint8(N++,R.charCodeAt(0))),Array.from(d,R=>C.setUint8(N++,R.charCodeAt(0))),Array.from(x,R=>C.setUint8(N++,R.charCodeAt(0)));var k=new Uint8Array(A.byteLength+S.byteLength);return k.set(new Uint8Array(A),0),k.set(new Uint8Array(S),A.byteLength),k.buffer}_encodeJsonUserBroadcastPush(t){var r,n,o,l;const d=t.topic,i=(r=t.ref)!==null&&r!==void 0?r:"",g=(n=t.join_ref)!==null&&n!==void 0?n:"",x=t.payload.event,S=(l=(o=t.payload)===null||o===void 0?void 0:o.payload)!==null&&l!==void 0?l:{},A=new TextEncoder().encode(JSON.stringify(S)).buffer,C=this.USER_BROADCAST_PUSH_META_LENGTH+g.length+i.length+d.length+x.length,N=new ArrayBuffer(this.HEADER_LENGTH+C);let k=new DataView(N),R=0;k.setUint8(R++,this.KINDS.userBroadcastPush),k.setUint8(R++,g.length),k.setUint8(R++,i.length),k.setUint8(R++,d.length),k.setUint8(R++,x.length),k.setUint8(R++,this.JSON_ENCODING),Array.from(g,j=>k.setUint8(R++,j.charCodeAt(0))),Array.from(i,j=>k.setUint8(R++,j.charCodeAt(0))),Array.from(d,j=>k.setUint8(R++,j.charCodeAt(0))),Array.from(x,j=>k.setUint8(R++,j.charCodeAt(0)));var L=new Uint8Array(N.byteLength+A.byteLength);return L.set(new Uint8Array(N),0),L.set(new Uint8Array(A),N.byteLength),L.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[o,l,d,i,g]=n;return r({join_ref:o,ref:l,topic:d,event:i,payload:g})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),o=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,o)}}_decodeUserBroadcast(t,r,n){const o=r.getUint8(1),l=r.getUint8(2),d=r.getUint8(3),i=r.getUint8(4);let g=this.HEADER_LENGTH+4;const x=n.decode(t.slice(g,g+o));g=g+o;const S=n.decode(t.slice(g,g+l));g=g+l;const E=n.decode(t.slice(g,g+d));g=g+d;const A=t.slice(g,t.byteLength),C=i===this.JSON_ENCODING?JSON.parse(n.decode(A)):A,N={type:this.BROADCAST_EVENT,event:S,payload:C};return d>0&&(N.meta=JSON.parse(E)),{join_ref:null,ref:null,topic:x,event:this.BROADCAST_EVENT,payload:N}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}}class eee{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Wa;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Wa||(Wa={}));const nW=(e,t,r={})=>{var n;const o=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((l,d)=>(l[d]=cbe(d,e,t,o),l),{}):{}},cbe=(e,t,r,n)=>{const o=t.find(i=>i.name===e),l=o==null?void 0:o.type,d=r[e];return l&&!n.includes(l)?tee(l,d):JL(d)},tee=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return fbe(t,r)}switch(e){case Wa.bool:return ube(t);case Wa.float4:case Wa.float8:case Wa.int2:case Wa.int4:case Wa.int8:case Wa.numeric:case Wa.oid:return dbe(t);case Wa.json:case Wa.jsonb:return hbe(t);case Wa.timestamp:return pbe(t);case Wa.abstime:case Wa.date:case Wa.daterange:case Wa.int4range:case Wa.int8range:case Wa.money:case Wa.reltime:case Wa.text:case Wa.time:case Wa.timestamptz:case Wa.timetz:case Wa.tsrange:case Wa.tstzrange:return JL(t);default:return JL(t)}},JL=e=>e,ube=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},dbe=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},hbe=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},fbe=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let l;const d=e.slice(1,r);try{l=JSON.parse("["+d+"]")}catch{l=d?d.split(","):[]}return l.map(i=>tee(t,i))}return e},pbe=e=>typeof e=="string"?e.replace(" ","T"):e,ree=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class SM{constructor(t,r,n={},o=XL){this.channel=t,this.event=r,this.payload=n,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var QL;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(QL||(QL={}));class e0{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},o=>{const{onJoin:l,onLeave:d,onSync:i}=this.caller;this.joinRef=this.channel._joinRef(),this.state=e0.syncState(this.state,o,l,d),this.pendingDiffs.forEach(g=>{this.state=e0.syncDiff(this.state,g,l,d)}),this.pendingDiffs=[],i()}),this.channel._on(n.diff,{},o=>{const{onJoin:l,onLeave:d,onSync:i}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=e0.syncDiff(this.state,o,l,d),i())}),this.onJoin((o,l,d)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:l,newPresences:d})}),this.onLeave((o,l,d)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:l,leftPresences:d})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,o){const l=this.cloneDeep(t),d=this.transformState(r),i={},g={};return this.map(l,(x,S)=>{d[x]||(g[x]=S)}),this.map(d,(x,S)=>{const E=l[x];if(E){const A=S.map(R=>R.presence_ref),C=E.map(R=>R.presence_ref),N=S.filter(R=>C.indexOf(R.presence_ref)<0),k=E.filter(R=>A.indexOf(R.presence_ref)<0);N.length>0&&(i[x]=N),k.length>0&&(g[x]=k)}else i[x]=S}),this.syncDiff(l,{joins:i,leaves:g},n,o)}static syncDiff(t,r,n,o){const{joins:l,leaves:d}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),o||(o=()=>{}),this.map(l,(i,g)=>{var x;const S=(x=t[i])!==null&&x!==void 0?x:[];if(t[i]=this.cloneDeep(g),S.length>0){const E=t[i].map(C=>C.presence_ref),A=S.filter(C=>E.indexOf(C.presence_ref)<0);t[i].unshift(...A)}n(i,S,g)}),this.map(d,(i,g)=>{let x=t[i];if(!x)return;const S=g.map(E=>E.presence_ref);x=x.filter(E=>S.indexOf(E.presence_ref)<0),t[i]=x,o(i,x,g),x.length===0&&delete t[i]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const o=t[n];return"metas"in o?r[n]=o.metas.map(l=>(l.presence_ref=l.phx_ref,delete l.phx_ref,delete l.phx_ref_prev,l)):r[n]=o,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var e3;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(e3||(e3={}));var t0;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(t0||(t0={}));var ih;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(ih||(ih={}));class pk{constructor(t,r={config:{}},n){var o,l;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=us.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new SM(this,fd.join,this.params,this.timeout),this.rejoinTimer=new eee(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=us.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(d=>d.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=us.closed,this.socket._remove(this)}),this._onError(d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=us.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=us.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",d=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,d),this.state=us.errored,this.rejoinTimer.scheduleTimeout())}),this._on(fd.reply,{},(d,i)=>{this._trigger(this._replyEventName(i),d)}),this.presence=new e0(this),this.broadcastEndpointURL=ree(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((l=(o=this.params.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,o,l;if(this.socket.isConnected()||this.socket.connect(),this.state==us.closed){const{config:{broadcast:d,presence:i,private:g}}=this.params,x=(o=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(C=>C.filter))!==null&&o!==void 0?o:[],S=!!this.bindings[t0.PRESENCE]&&this.bindings[t0.PRESENCE].length>0||((l=this.params.config.presence)===null||l===void 0?void 0:l.enabled)===!0,E={},A={broadcast:d,presence:Object.assign(Object.assign({},i),{enabled:S}),postgres_changes:x,private:g};this.socket.accessTokenValue&&(E.access_token=this.socket.accessTokenValue),this._onError(C=>t==null?void 0:t(ih.CHANNEL_ERROR,C)),this._onClose(()=>t==null?void 0:t(ih.CLOSED)),this.updateJoinPayload(Object.assign({config:A},E)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:C})=>{var N;if(this.socket.setAuth(),C===void 0){t==null||t(ih.SUBSCRIBED);return}else{const k=this.bindings.postgres_changes,R=(N=k==null?void 0:k.length)!==null&&N!==void 0?N:0,L=[];for(let j=0;j<R;j++){const F=k[j],{filter:{event:B,schema:U,table:Z,filter:X}}=F,te=C&&C[j];if(te&&te.event===B&&te.schema===U&&te.table===Z&&te.filter===X)L.push(Object.assign(Object.assign({},F),{id:te.id}));else{this.unsubscribe(),this.state=us.errored,t==null||t(ih.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=L,t&&t(ih.SUBSCRIBED);return}}).receive("error",C=>{this.state=us.errored,t==null||t(ih.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(C).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(ih.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===us.joined&&t===t0.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var o;const l=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(r==null)return Promise.reject("Payload is required for httpSend()");const d={method:"POST",headers:{Authorization:l,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},i=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(o=n.timeout)!==null&&o!==void 0?o:this.timeout);if(i.status===202)return{success:!0};let g=i.statusText;try{const x=await i.json();g=x.error||x.message||g}catch{}return Promise.reject(new Error(g))}async send(t,r={}){var n,o;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:l,payload:d}=t,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:l,payload:d,private:this.private}]})};try{const x=await this._fetchWithTimeout(this.broadcastEndpointURL,g,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((o=x.body)===null||o===void 0?void 0:o.cancel()),x.ok?"ok":"error"}catch(x){return x.name==="AbortError"?"timed out":"error"}}else return new Promise(l=>{var d,i,g;const x=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((g=(i=(d=this.params)===null||d===void 0?void 0:d.config)===null||i===void 0?void 0:i.broadcast)===null||g===void 0)&&g.ack)&&l("ok"),x.receive("ok",()=>l("ok")),x.receive("error",()=>l("error")),x.receive("timeout",()=>l("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=us.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(fd.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(o=>{n=new SM(this,fd.leave,{},t),n.receive("ok",()=>{r(),o("ok")}).receive("timeout",()=>{r(),o("timed out")}).receive("error",()=>{o("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=us.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const o=new AbortController,l=setTimeout(()=>o.abort(),n),d=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:o.signal}));return clearTimeout(l),d}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new SM(this,t,r,n);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>sbe){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var o,l;const d=t.toLocaleLowerCase(),{close:i,error:g,leave:x,join:S}=fd;if(n&&[i,g,x,S].indexOf(d)>=0&&n!==this._joinRef())return;let A=this._onMessage(d,r,n);if(r&&!A)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(d)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(C=>{var N,k,R;return((N=C.filter)===null||N===void 0?void 0:N.event)==="*"||((R=(k=C.filter)===null||k===void 0?void 0:k.event)===null||R===void 0?void 0:R.toLocaleLowerCase())===d}).map(C=>C.callback(A,n)):(l=this.bindings[d])===null||l===void 0||l.filter(C=>{var N,k,R,L,j,F;if(["broadcast","presence","postgres_changes"].includes(d))if("id"in C){const B=C.id,U=(N=C.filter)===null||N===void 0?void 0:N.event;return B&&((k=r.ids)===null||k===void 0?void 0:k.includes(B))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((R=r.data)===null||R===void 0?void 0:R.type.toLocaleLowerCase()))}else{const B=(j=(L=C==null?void 0:C.filter)===null||L===void 0?void 0:L.event)===null||j===void 0?void 0:j.toLocaleLowerCase();return B==="*"||B===((F=r==null?void 0:r.event)===null||F===void 0?void 0:F.toLocaleLowerCase())}else return C.type.toLocaleLowerCase()===d}).map(C=>{if(typeof A=="object"&&"ids"in A){const N=A.data,{schema:k,table:R,commit_timestamp:L,type:j,errors:F}=N;A=Object.assign(Object.assign({},{schema:k,table:R,commit_timestamp:L,eventType:j,new:{},old:{},errors:F}),this._getPayloadRecords(N))}C.callback(A,n)})}_isClosed(){return this.state===us.closed}_isJoined(){return this.state===us.joined}_isJoining(){return this.state===us.joining}_isLeaving(){return this.state===us.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const o=t.toLocaleLowerCase(),l={type:o,filter:r,callback:n};return this.bindings[o]?this.bindings[o].push(l):this.bindings[o]=[l],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(o=>{var l;return!(((l=o.type)===null||l===void 0?void 0:l.toLocaleLowerCase())===n&&pk.isEqual(o.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(fd.close,{},t)}_onError(t){this._on(fd.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=us.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=nW(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=nW(t.columns,t.old_record)),r}}const EM=()=>{},PP={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},mbe=[1e3,2e3,5e3,1e4],gbe=1e4,ybe=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class nee{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=XL,this.transport=null,this.heartbeatIntervalMs=PP.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=EM,this.ref=0,this.reconnectTimer=null,this.vsn=rW,this.logger=EM,this.conn=null,this.sendBuffer=[],this.serializer=new lbe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>o?(...l)=>o(...l):(...l)=>fetch(...l),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${YL.websocket}`,this.httpEndpoint=ree(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=JQ.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Py.connecting:return Cy.Connecting;case Py.open:return Cy.Open;case Py.closing:return Cy.Closing;default:return Cy.Closed}}isConnected(){return this.connectionState()===Cy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,o=this.getChannels().find(l=>l.topic===n);if(o)return o;{const l=new pk(`realtime:${t}`,r,this);return this.channels.push(l),l}}push(t){const{topic:r,event:n,payload:o,ref:l}=t,d=()=>{this.encode(t,i=>{var g;(g=this.conn)===null||g===void 0||g.send(i)})};this.log("push",`${r} ${n} (${l})`,o),this.isConnected()?d():this.sendBuffer.push(d)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(obe,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},PP.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply")try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error")}catch(x){this.log("error","error in heartbeat callback",x)}r.ref&&r.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:o,payload:l,ref:d}=r,i=d?`(${d})`:"",g=l.status||"";this.log("receive",`${g} ${n} ${o} ${i}`.trim(),l),this.channels.filter(x=>x._isMember(n)).forEach(x=>x._trigger(o,l,d)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){if(this.conn){if(this.conn.readyState===Py.open||this.conn.readyState===Py.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(fd.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",o=new URLSearchParams(r);return`${t}${n}${o}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([ybe],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r;t?r=t:this.accessToken?r=await this.accessToken():r=this.accessTokenValue,this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(n=>{const o={access_token:r,version:ibe};r&&n.updateJoinPayload(o),n.joinedOnce&&n._isJoined()&&n._push(fd.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(r=>{this.log("error",`error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(o){this.log("error",`error in ${t} callback`,o)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new eee(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},PP.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,o,l,d,i,g,x,S,E,A,C;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:XL,this.heartbeatIntervalMs=(o=t==null?void 0:t.heartbeatIntervalMs)!==null&&o!==void 0?o:PP.HEARTBEAT_INTERVAL,this.worker=(l=t==null?void 0:t.worker)!==null&&l!==void 0?l:!1,this.accessToken=(d=t==null?void 0:t.accessToken)!==null&&d!==void 0?d:null,this.heartbeatCallback=(i=t==null?void 0:t.heartbeatCallback)!==null&&i!==void 0?i:EM,this.vsn=(g=t==null?void 0:t.vsn)!==null&&g!==void 0?g:rW,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(x=t==null?void 0:t.reconnectAfterMs)!==null&&x!==void 0?x:N=>mbe[N-1]||gbe,this.vsn){case QQ:this.encode=(S=t==null?void 0:t.encode)!==null&&S!==void 0?S:(N,k)=>k(JSON.stringify(N)),this.decode=(E=t==null?void 0:t.decode)!==null&&E!==void 0?E:(N,k)=>k(JSON.parse(N));break;case abe:this.encode=(A=t==null?void 0:t.encode)!==null&&A!==void 0?A:this.serializer.encode.bind(this.serializer),this.decode=(C=t==null?void 0:t.decode)!==null&&C!==void 0?C:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class LB extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function yo(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class vbe extends LB{constructor(t,r,n){super(t),this.name="StorageApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class t3 extends LB{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}const FB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),_be=()=>Response,r3=e=>{if(Array.isArray(e))return e.map(r=>r3(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const o=r.replace(/([-_][a-z])/gi,l=>l.toUpperCase().replace(/[-_]/g,""));t[o]=r3(n)}),t},xbe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},TM=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},bbe=(e,t,r)=>Cn(void 0,void 0,void 0,function*(){const n=yield _be();e instanceof n&&!(r!=null&&r.noResolveJson)?e.json().then(o=>{const l=e.status||500,d=(o==null?void 0:o.statusCode)||l+"";t(new vbe(TM(o),l,d))}).catch(o=>{t(new t3(TM(o),o))}):t(new t3(TM(e),e))}),wbe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?o:(xbe(n)?(o.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),o.body=JSON.stringify(n)):o.body=n,t!=null&&t.duplex&&(o.duplex=t.duplex),Object.assign(Object.assign({},o),r))};function IT(e,t,r,n,o,l){return Cn(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,wbe(t,n,o,l)).then(g=>{if(!g.ok)throw g;return n!=null&&n.noResolveJson?g:g.json()}).then(g=>d(g)).catch(g=>bbe(g,i,n))})})}function TE(e,t,r,n){return Cn(this,void 0,void 0,function*(){return IT(e,"GET",t,r,n)})}function cd(e,t,r,n,o){return Cn(this,void 0,void 0,function*(){return IT(e,"POST",t,n,o,r)})}function n3(e,t,r,n,o){return Cn(this,void 0,void 0,function*(){return IT(e,"PUT",t,n,o,r)})}function Sbe(e,t,r,n){return Cn(this,void 0,void 0,function*(){return IT(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),n)})}function zB(e,t,r,n,o){return Cn(this,void 0,void 0,function*(){return IT(e,"DELETE",t,n,o,r)})}class Ebe{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r}then(t,r){return this.execute().then(t,r)}execute(){return Cn(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yo(t))return{data:null,error:t};throw t}})}}var iee;class Tbe{constructor(t,r){this.downloadFn=t,this.shouldThrowOnError=r,this[iee]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ebe(this.downloadFn,this.shouldThrowOnError)}then(t,r){return this.getPromise().then(t,r)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Cn(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(yo(t))return{data:null,error:t};throw t}})}}iee=Symbol.toStringTag;const Abe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},iW={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Pbe{constructor(t,r={},n,o){this.shouldThrowOnError=!1,this.url=t,this.headers=r,this.bucketId=n,this.fetch=FB(o)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,r,n,o){return Cn(this,void 0,void 0,function*(){try{let l;const d=Object.assign(Object.assign({},iW),o);let i=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(d.upsert)});const g=d.metadata;typeof Blob<"u"&&n instanceof Blob?(l=new FormData,l.append("cacheControl",d.cacheControl),g&&l.append("metadata",this.encodeMetadata(g)),l.append("",n)):typeof FormData<"u"&&n instanceof FormData?(l=n,l.has("cacheControl")||l.append("cacheControl",d.cacheControl),g&&!l.has("metadata")&&l.append("metadata",this.encodeMetadata(g))):(l=n,i["cache-control"]=`max-age=${d.cacheControl}`,i["content-type"]=d.contentType,g&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(g))),(typeof ReadableStream<"u"&&l instanceof ReadableStream||l&&typeof l=="object"&&"pipe"in l&&typeof l.pipe=="function")&&!d.duplex&&(d.duplex="half")),o!=null&&o.headers&&(i=Object.assign(Object.assign({},i),o.headers));const x=this._removeEmptyFolders(r),S=this._getFinalPath(x),E=yield(t=="PUT"?n3:cd)(this.fetch,`${this.url}/object/${S}`,l,Object.assign({headers:i},d!=null&&d.duplex?{duplex:d.duplex}:{}));return{data:{path:x,id:E.Id,fullPath:E.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(yo(l))return{data:null,error:l};throw l}})}upload(t,r,n){return Cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,n)})}uploadToSignedUrl(t,r,n,o){return Cn(this,void 0,void 0,function*(){const l=this._removeEmptyFolders(t),d=this._getFinalPath(l),i=new URL(this.url+`/object/upload/sign/${d}`);i.searchParams.set("token",r);try{let g;const x=Object.assign({upsert:iW.upsert},o),S=Object.assign(Object.assign({},this.headers),{"x-upsert":String(x.upsert)});typeof Blob<"u"&&n instanceof Blob?(g=new FormData,g.append("cacheControl",x.cacheControl),g.append("",n)):typeof FormData<"u"&&n instanceof FormData?(g=n,g.append("cacheControl",x.cacheControl)):(g=n,S["cache-control"]=`max-age=${x.cacheControl}`,S["content-type"]=x.contentType);const E=yield n3(this.fetch,i.toString(),g,{headers:S});return{data:{path:l,fullPath:E.Key},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(yo(g))return{data:null,error:g};throw g}})}createSignedUploadUrl(t,r){return Cn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t);const o=Object.assign({},this.headers);r!=null&&r.upsert&&(o["x-upsert"]="true");const l=yield cd(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:o}),d=new URL(this.url+l.url),i=d.searchParams.get("token");if(!i)throw new LB("No token returned by API");return{data:{signedUrl:d.toString(),path:t,token:i},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yo(n))return{data:null,error:n};throw n}})}update(t,r,n){return Cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,n)})}move(t,r,n){return Cn(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}copy(t,r,n){return Cn(this,void 0,void 0,function*(){try{return{data:{path:(yield cd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}createSignedUrl(t,r,n){return Cn(this,void 0,void 0,function*(){try{let o=this._getFinalPath(t),l=yield cd(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:r},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const d=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return l={signedUrl:encodeURI(`${this.url}${l.signedURL}${d}`)},{data:l,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}createSignedUrls(t,r,n){return Cn(this,void 0,void 0,function*(){try{const o=yield cd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),l=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:o.map(d=>Object.assign(Object.assign({},d),{signedUrl:d.signedURL?encodeURI(`${this.url}${d.signedURL}${l}`):null})),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}download(t,r){const o=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",l=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),d=l?`?${l}`:"",i=this._getFinalPath(t),g=()=>TE(this.fetch,`${this.url}/${o}/${i}${d}`,{headers:this.headers,noResolveJson:!0});return new Tbe(g,this.shouldThrowOnError)}info(t){return Cn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const n=yield TE(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:r3(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yo(n))return{data:null,error:n};throw n}})}exists(t){return Cn(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield Sbe(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yo(n)&&n instanceof t3){const o=n.originalError;if([400,404].includes(o==null?void 0:o.status))return{data:!1,error:n}}throw n}})}getPublicUrl(t,r){const n=this._getFinalPath(t),o=[],l=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";l!==""&&o.push(l);const i=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",g=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});g!==""&&o.push(g);let x=o.join("&");return x!==""&&(x=`?${x}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${x}`)}}}remove(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield zB(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}list(t,r,n){return Cn(this,void 0,void 0,function*(){try{const o=Object.assign(Object.assign(Object.assign({},Abe),r),{prefix:t||""});return{data:yield cd(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},n),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}listV2(t,r){return Cn(this,void 0,void 0,function*(){try{const n=Object.assign({},t);return{data:yield cd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yo(n))return{data:null,error:n};throw n}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const aee="2.84.0",oee={"X-Client-Info":`storage-js/${aee}`};class Cbe{constructor(t,r={},n,o){this.shouldThrowOnError=!1;const l=new URL(t);o!=null&&o.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oee),r),this.fetch=FB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return Cn(this,void 0,void 0,function*(){try{const r=this.listBucketOptionsToQueryString(t);return{data:yield TE(this.fetch,`${this.url}/bucket${r}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}getBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield TE(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}createBucket(t){return Cn(this,arguments,void 0,function*(r,n={public:!1}){try{return{data:yield cd(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(yo(o))return{data:null,error:o};throw o}})}updateBucket(t,r){return Cn(this,void 0,void 0,function*(){try{return{data:yield n3(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(yo(n))return{data:null,error:n};throw n}})}emptyBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield zB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}listBucketOptionsToQueryString(t){const r={};return t&&("limit"in t&&(r.limit=String(t.limit)),"offset"in t&&(r.offset=String(t.offset)),t.search&&(r.search=t.search),t.sortColumn&&(r.sortColumn=t.sortColumn),t.sortOrder&&(r.sortOrder=t.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}}class Obe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oee),r),this.fetch=FB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield cd(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}listBuckets(t){return Cn(this,void 0,void 0,function*(){try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),o=n?`${this.url}/bucket?${n}`:`${this.url}/bucket`;return{data:yield TE(this.fetch,o,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield zB(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(yo(r))return{data:null,error:r};throw r}})}}const BB={"X-Client-Info":`storage-js/${aee}`,"Content-Type":"application/json"};class see extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Uc(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class AM extends see{constructor(t,r,n){super(t),this.name="StorageVectorsApiError",this.status=r,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ibe extends see{constructor(t,r){super(t),this.name="StorageVectorsUnknownError",this.originalError=r}}var aW;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(aW||(aW={}));const $B=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),kbe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},oW=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Rbe=(e,t,r)=>Cn(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const o=e.status||500,l=e;if(typeof l.json=="function")l.json().then(d=>{const i=(d==null?void 0:d.statusCode)||(d==null?void 0:d.code)||o+"";t(new AM(oW(d),o,i))}).catch(()=>{const d=o+"",i=l.statusText||`HTTP ${o} error`;t(new AM(i,o,d))});else{const d=o+"",i=l.statusText||`HTTP ${o} error`;t(new AM(i,o,d))}}else t(new Ibe(oW(e),e))}),jbe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(kbe(n)?(o.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),o.body=JSON.stringify(n)):o.body=n,Object.assign(Object.assign({},o),r)):o};function Nbe(e,t,r,n,o,l){return Cn(this,void 0,void 0,function*(){return new Promise((d,i)=>{e(r,jbe(t,n,o,l)).then(g=>{if(!g.ok)throw g;if(n!=null&&n.noResolveJson)return g;const x=g.headers.get("content-type");return!x||!x.includes("application/json")?{}:g.json()}).then(g=>d(g)).catch(g=>Rbe(g,i,n))})})}function Vc(e,t,r,n,o){return Cn(this,void 0,void 0,function*(){return Nbe(e,"POST",t,n,o,r)})}class Mbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},BB),r),this.fetch=$B(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return Cn(this,void 0,void 0,function*(){try{return{data:(yield Vc(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}getIndex(t,r){return Cn(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Uc(n))return{data:null,error:n};throw n}})}listIndexes(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}deleteIndex(t,r){return Cn(this,void 0,void 0,function*(){try{return{data:(yield Vc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:r},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Uc(n))return{data:null,error:n};throw n}})}}class Dbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},BB),r),this.fetch=$B(n)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return Cn(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Vc(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}getVectors(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}listVectors(t){return Cn(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Vc(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}queryVectors(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}deleteVectors(t){return Cn(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Vc(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}}class Lbe{constructor(t,r={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},BB),r),this.fetch=$B(n)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:(yield Vc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}getBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:yield Vc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}listBuckets(){return Cn(this,arguments,void 0,function*(t={}){try{return{data:yield Vc(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Cn(this,void 0,void 0,function*(){try{return{data:(yield Vc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Uc(r))return{data:null,error:r};throw r}})}}class Fbe extends Lbe{constructor(t,r={}){super(t,r.headers||{},r.fetch)}from(t){return new zbe(this.url,this.headers,t,this.fetch)}}class zbe extends Mbe{constructor(t,r,n,o){super(t,r,o),this.vectorBucketName=n}createIndex(t){const r=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Cn(this,void 0,void 0,function*(){return r.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Cn(this,arguments,void 0,function*(r={}){return t.listIndexes.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const r=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Cn(this,void 0,void 0,function*(){return r.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const r=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Cn(this,void 0,void 0,function*(){return r.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new Bbe(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class Bbe extends Dbe{constructor(t,r,n,o,l){super(t,r,l),this.vectorBucketName=n,this.indexName=o}putVectors(t){const r=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Cn(this,void 0,void 0,function*(){return r.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const r=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Cn(this,void 0,void 0,function*(){return r.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Cn(this,arguments,void 0,function*(r={}){return t.listVectors.call(this,Object.assign(Object.assign({},r),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const r=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Cn(this,void 0,void 0,function*(){return r.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const r=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Cn(this,void 0,void 0,function*(){return r.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class $be extends Cbe{constructor(t,r={},n,o){super(t,r,n,o)}from(t){return new Pbe(this.url,this.headers,t,this.fetch)}get vectors(){return new Fbe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Obe(this.url+"/iceberg",this.headers,this.fetch)}}const Ube="2.84.0";let PS="";typeof Deno<"u"?PS="deno":typeof document<"u"?PS="web":typeof navigator<"u"&&navigator.product==="ReactNative"?PS="react-native":PS="node";const Vbe={"X-Client-Info":`supabase-js-${PS}/${Ube}`},qbe={headers:Vbe},Wbe={schema:"public"},Gbe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Hbe={},Kbe=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Zbe=()=>Headers,Xbe=(e,t,r)=>{const n=Kbe(r),o=Zbe();return async(l,d)=>{var i;const g=(i=await t())!==null&&i!==void 0?i:e;let x=new o(d==null?void 0:d.headers);return x.has("apikey")||x.set("apikey",e),x.has("Authorization")||x.set("Authorization",`Bearer ${g}`),n(l,Object.assign(Object.assign({},d),{headers:x}))}};function Ybe(e){return e.endsWith("/")?e:e+"/"}function Jbe(e,t){var r,n;const{db:o,auth:l,realtime:d,global:i}=e,{db:g,auth:x,realtime:S,global:E}=t,A={db:Object.assign(Object.assign({},g),o),auth:Object.assign(Object.assign({},x),l),realtime:Object.assign(Object.assign({},S),d),storage:{},global:Object.assign(Object.assign(Object.assign({},E),i),{headers:Object.assign(Object.assign({},(r=E==null?void 0:E.headers)!==null&&r!==void 0?r:{}),(n=i==null?void 0:i.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?A.accessToken=e.accessToken:delete A.accessToken,A}function Qbe(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Ybe(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const lee="2.84.0",Ex=30*1e3,i3=3,PM=i3*Ex,ewe="http://localhost:9999",twe="supabase.auth.token",rwe={"X-Client-Info":`gotrue-js/${lee}`},a3="X-Supabase-Api-Version",cee={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},nwe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,iwe=10*60*1e3;class j0 extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function kn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class uee extends j0{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function dee(e){return kn(e)&&e.name==="AuthApiError"}class nm extends j0{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class qf extends j0{constructor(t,r,n,o){super(t,n,o),this.name=r,this.status=n}}class lc extends qf{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function hee(e){return kn(e)&&e.name==="AuthSessionMissingError"}class vy extends qf{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class CS extends qf{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class OS extends qf{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function fee(e){return kn(e)&&e.name==="AuthImplicitGrantRedirectError"}class o3 extends qf{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class sO extends qf{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function hC(e){return kn(e)&&e.name==="AuthRetryableFetchError"}class s3 extends qf{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class lO extends qf{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const cO="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),sW=` 	
\r=`.split(""),awe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<sW.length;t+=1)e[sW[t].charCodeAt(0)]=-2;for(let t=0;t<cO.length;t+=1)e[cO[t].charCodeAt(0)]=t;return e})();function lW(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(cO[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(cO[n]),t.queuedBits-=6}}function pee(e,t,r){const n=awe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function cW(e){const t=[],r=d=>{t.push(String.fromCodePoint(d))},n={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},l=d=>{lwe(d,n,r)};for(let d=0;d<e.length;d+=1)pee(e.charCodeAt(d),o,l);return t.join("")}function owe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function swe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const o=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|o)+65536,r+=1}owe(n,t)}}function lwe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function r0(e){const t=[],r={queue:0,queuedBits:0},n=o=>{t.push(o)};for(let o=0;o<e.length;o+=1)pee(e.charCodeAt(o),r,n);return new Uint8Array(t)}function cwe(e){const t=[];return swe(e,r=>t.push(r)),new Uint8Array(t)}function jy(e){const t=[],r={queue:0,queuedBits:0},n=o=>{t.push(o)};return e.forEach(o=>lW(o,r,n)),lW(null,r,n),t.join("")}function uwe(e){return Math.round(Date.now()/1e3)+e}function dwe(){return Symbol("auth-callback")}const zs=()=>typeof window<"u"&&typeof document<"u",uy={tested:!1,writable:!1},mee=()=>{if(!zs())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(uy.tested)return uy.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),uy.tested=!0,uy.writable=!0}catch{uy.tested=!0,uy.writable=!1}return uy.writable};function hwe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((o,l)=>{t[l]=o})}catch{}return r.searchParams.forEach((n,o)=>{t[o]=n}),t}const gee=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),fwe=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Tx=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},dy=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Vp=async(e,t)=>{await e.removeItem(t)};class mk{constructor(){this.promise=new mk.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}mk.promiseConstructor=Promise;function CM(e){const t=e.split(".");if(t.length!==3)throw new lO("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!nwe.test(t[n]))throw new lO("JWT not in base64url format");return{header:JSON.parse(cW(t[0])),payload:JSON.parse(cW(t[1])),signature:r0(t[2]),raw:{header:t[0],payload:t[1]}}}async function pwe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function mwe(e,t){return new Promise((n,o)=>{(async()=>{for(let l=0;l<1/0;l++)try{const d=await e(l);if(!t(l,null,d)){n(d);return}}catch(d){if(!t(l,d)){o(d);return}}})()})}function gwe(e){return("0"+e.toString(16)).substr(-2)}function ywe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let o="";for(let l=0;l<56;l++)o+=r.charAt(Math.floor(Math.random()*n));return o}return crypto.getRandomValues(t),Array.from(t,gwe).join("")}async function vwe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),o=new Uint8Array(n);return Array.from(o).map(l=>String.fromCharCode(l)).join("")}async function _we(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await vwe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function cx(e,t,r=!1){const n=ywe();let o=n;r&&(o+="/PASSWORD_RECOVERY"),await Tx(e,`${t}-code-verifier`,o);const l=await _we(n);return[l,n===l?"plain":"s256"]}const xwe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function bwe(e){const t=e.headers.get(a3);if(!t||!t.match(xwe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function wwe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Swe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ewe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ux(e){if(!Ewe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function OM(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Twe(e,t){return new Proxy(e,{get:(r,n,o)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const l=n.toString();if(l==="Symbol(Symbol.toPrimitive)"||l==="Symbol(Symbol.toStringTag)"||l==="Symbol(util.inspect.custom)"||l==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,o)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,o)}})}function uW(e){return JSON.parse(JSON.stringify(e))}const _y=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Awe=[502,503,504];async function dW(e){var t;if(!fwe(e))throw new sO(_y(e),0);if(Awe.includes(e.status))throw new sO(_y(e),e.status);let r;try{r=await e.json()}catch(l){throw new nm(_y(l),l)}let n;const o=bwe(e);if(o&&o.getTime()>=cee["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new s3(_y(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new lc}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((l,d)=>l&&typeof d=="string",!0))throw new s3(_y(r),e.status,r.weak_password.reasons);throw new uee(_y(r),e.status||500,n)}const Pwe=(e,t,r,n)=>{const o={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),r))};async function Jn(e,t,r,n){var o;const l=Object.assign({},n==null?void 0:n.headers);l[a3]||(l[a3]=cee["2024-01-01"].name),n!=null&&n.jwt&&(l.Authorization=`Bearer ${n.jwt}`);const d=(o=n==null?void 0:n.query)!==null&&o!==void 0?o:{};n!=null&&n.redirectTo&&(d.redirect_to=n.redirectTo);const i=Object.keys(d).length?"?"+new URLSearchParams(d).toString():"",g=await Cwe(e,t,r+i,{headers:l,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(g):{data:Object.assign({},g),error:null}}async function Cwe(e,t,r,n,o,l){const d=Pwe(t,n,o,l);let i;try{i=await e(r,Object.assign({},d))}catch(g){throw console.error(g),new sO(_y(g),0)}if(i.ok||await dW(i),n!=null&&n.noResolveJson)return i;try{return await i.json()}catch(g){await dW(g)}}function od(e){var t;let r=null;kwe(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=uwe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function hW(e){const t=od(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function im(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Owe(e){return{data:e,error:null}}function Iwe(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:o,verification_type:l}=e,d=rg(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),i={action_link:t,email_otp:r,hashed_token:n,redirect_to:o,verification_type:l},g=Object.assign({},d);return{data:{properties:i,user:g},error:null}}function fW(e){return e}function kwe(e){return e.access_token&&e.refresh_token&&e.expires_in}const fC=["global","local","others"];class yee{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=gee(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=fC[0]){if(fC.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${fC.join(", ")}`);try{return await Jn(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(kn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await Jn(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:im})}catch(n){if(kn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=rg(t,["options"]),o=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(o.new_email=n==null?void 0:n.newEmail,delete o.newEmail),await Jn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:Iwe,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(kn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await Jn(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:im})}catch(r){if(kn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,o,l,d,i,g;try{const x={nextPage:null,lastPage:0,total:0},S=await Jn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(l=(o=t==null?void 0:t.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:fW});if(S.error)throw S.error;const E=await S.json(),A=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,C=(g=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&g!==void 0?g:[];return C.length>0&&(C.forEach(N=>{const k=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(N.split(";")[1].split("=")[1]);x[`${R}Page`]=k}),x.total=parseInt(A)),{data:Object.assign(Object.assign({},E),x),error:null}}catch(x){if(kn(x))return{data:{users:[]},error:x};throw x}}async getUserById(t){ux(t);try{return await Jn(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:im})}catch(r){if(kn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){ux(t);try{return await Jn(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:im})}catch(n){if(kn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){ux(t);try{return await Jn(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:im})}catch(n){if(kn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){ux(t.userId);try{const{data:r,error:n}=await Jn(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:r,error:n}}catch(r){if(kn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){ux(t.userId),ux(t.id);try{return{data:await Jn(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,o,l,d,i,g;try{const x={nextPage:null,lastPage:0,total:0},S=await Jn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(l=(o=t==null?void 0:t.perPage)===null||o===void 0?void 0:o.toString())!==null&&l!==void 0?l:""},xform:fW});if(S.error)throw S.error;const E=await S.json(),A=(d=S.headers.get("x-total-count"))!==null&&d!==void 0?d:0,C=(g=(i=S.headers.get("link"))===null||i===void 0?void 0:i.split(","))!==null&&g!==void 0?g:[];return C.length>0&&(C.forEach(N=>{const k=parseInt(N.split(";")[0].split("=")[1].substring(0,1)),R=JSON.parse(N.split(";")[1].split("=")[1]);x[`${R}Page`]=k}),x.total=parseInt(A)),{data:Object.assign(Object.assign({},E),x),error:null}}catch(x){if(kn(x))return{data:{clients:[]},error:x};throw x}}async _createOAuthClient(t){try{return await Jn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(kn(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await Jn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(kn(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await Jn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(kn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await Jn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await Jn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(kn(r))return{data:null,error:r};throw r}}}function pW(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const xy={debug:!!(globalThis&&mee()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class vee extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class _ee extends vee{}async function xee(e,t,r){xy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),xy.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async o=>{if(o){xy.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,o.name);try{return await r()}finally{xy.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,o.name)}}else{if(t===0)throw xy.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new _ee(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(xy.debug)try{const l=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(l,null,"  "))}catch(l){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",l)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Rwe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function bee(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function jwe(e){return parseInt(e,16)}function Nwe(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function Mwe(e){var t;const{chainId:r,domain:n,expirationTime:o,issuedAt:l=new Date,nonce:d,notBefore:i,requestId:g,resources:x,scheme:S,uri:E,version:A}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(d&&d.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${d}`);if(!E)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(A!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${A}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const C=bee(e.address),N=S?`${S}://${n}`:n,k=e.statement?`${e.statement}
`:"",R=`${N} wants you to sign in with your Ethereum account:
${C}

${k}`;let L=`URI: ${E}
Version: ${A}
Chain ID: ${r}${d?`
Nonce: ${d}`:""}
Issued At: ${l.toISOString()}`;if(o&&(L+=`
Expiration Time: ${o.toISOString()}`),i&&(L+=`
Not Before: ${i.toISOString()}`),g&&(L+=`
Request ID: ${g}`),x){let j=`
Resources:`;for(const F of x){if(!F||typeof F!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${F}`);j+=`
- ${F}`}L+=j}return`${R}
${L}`}class Xo extends Error{constructor({message:t,code:r,cause:n,name:o}){var l;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(l=o??(n instanceof Error?n.name:void 0))!==null&&l!==void 0?l:"Unknown Error",this.code=r}}class uO extends Xo{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function Dwe({error:e,options:t}){var r,n,o;const{publicKey:l}=t;if(!l)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Xo({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=l.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Xo({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=l.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Xo({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((o=l.authenticatorSelection)===null||o===void 0?void 0:o.userVerification)==="required")return new Xo({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new Xo({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new Xo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return l.pubKeyCredParams.filter(i=>i.type==="public-key").length===0?new Xo({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Xo({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const d=window.location.hostname;if(wee(d)){if(l.rp.id!==d)return new Xo({message:`The RP ID "${l.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Xo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(l.user.id.byteLength<1||l.user.id.byteLength>64)return new Xo({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new Xo({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Xo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Lwe({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Xo({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new Xo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(wee(n)){if(r.rpId!==n)return new Xo({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new Xo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new Xo({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Xo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Fwe{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const zwe=new Fwe;function Bwe(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,o=rg(e,["challenge","user","excludeCredentials"]),l=r0(t).buffer,d=Object.assign(Object.assign({},r),{id:r0(r.id).buffer}),i=Object.assign(Object.assign({},o),{challenge:l,user:d});if(n&&n.length>0){i.excludeCredentials=new Array(n.length);for(let g=0;g<n.length;g++){const x=n[g];i.excludeCredentials[g]=Object.assign(Object.assign({},x),{id:r0(x.id).buffer,type:x.type||"public-key",transports:x.transports})}}return i}function $we(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=rg(e,["challenge","allowCredentials"]),o=r0(t).buffer,l=Object.assign(Object.assign({},n),{challenge:o});if(r&&r.length>0){l.allowCredentials=new Array(r.length);for(let d=0;d<r.length;d++){const i=r[d];l.allowCredentials[d]=Object.assign(Object.assign({},i),{id:r0(i.id).buffer,type:i.type||"public-key",transports:i.transports})}}return l}function Uwe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:jy(new Uint8Array(e.response.attestationObject)),clientDataJSON:jy(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function Vwe(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),o=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:jy(new Uint8Array(o.authenticatorData)),clientDataJSON:jy(new Uint8Array(o.clientDataJSON)),signature:jy(new Uint8Array(o.signature)),userHandle:o.userHandle?jy(new Uint8Array(o.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function wee(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function mW(){var e,t;return!!(zs()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function qwe(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new uO("Browser returned unexpected credential type",t)}:{data:null,error:new uO("Empty credential response",t)}}catch(t){return{data:null,error:Dwe({error:t,options:e})}}}async function Wwe(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new uO("Browser returned unexpected credential type",t)}:{data:null,error:new uO("Empty credential response",t)}}catch(t){return{data:null,error:Lwe({error:t,options:e})}}}const Gwe={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Hwe={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function dO(...e){const t=o=>o!==null&&typeof o=="object"&&!Array.isArray(o),r=o=>o instanceof ArrayBuffer||ArrayBuffer.isView(o),n={};for(const o of e)if(o)for(const l in o){const d=o[l];if(d!==void 0)if(Array.isArray(d))n[l]=d;else if(r(d))n[l]=d;else if(t(d)){const i=n[l];t(i)?n[l]=dO(i,d):n[l]=dO(d)}else n[l]=d}return n}function Kwe(e,t){return dO(Gwe,e,t||{})}function Zwe(e,t){return dO(Hwe,e,t||{})}class Xwe{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:o},l){try{const{data:d,error:i}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!d)return{data:null,error:i};const g=o??zwe.createNewAbortSignal();if(d.webauthn.type==="create"){const{user:x}=d.webauthn.credential_options.publicKey;x.name||(x.name=`${x.id}:${n}`),x.displayName||(x.displayName=x.name)}switch(d.webauthn.type){case"create":{const x=Kwe(d.webauthn.credential_options.publicKey,l==null?void 0:l.create),{data:S,error:E}=await qwe({publicKey:x,signal:g});return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:E}}case"request":{const x=Zwe(d.webauthn.credential_options.publicKey,l==null?void 0:l.request),{data:S,error:E}=await Wwe(Object.assign(Object.assign({},d.webauthn.credential_options),{publicKey:x,signal:g}));return S?{data:{factorId:t,challengeId:d.id,webauthn:{type:d.webauthn.type,credential_response:S}},error:null}:{data:null,error:E}}}}catch(d){return kn(d)?{data:null,error:d}:{data:null,error:new nm("Unexpected error in challenge",d)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!r)return{data:null,error:new j0("rpId is required for WebAuthn authentication")};try{if(!mW())return{data:null,error:new nm("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:o},{request:l});if(!d)return{data:null,error:i};const{webauthn:g}=d;return this._verify({factorId:t,challengeId:d.challengeId,webauthn:{type:g.type,rpId:r,rpOrigins:n,credential_response:g.credential_response}})}catch(d){return kn(d)?{data:null,error:d}:{data:null,error:new nm("Unexpected error in authenticate",d)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:o}={}},l){if(!r)return{data:null,error:new j0("rpId is required for WebAuthn registration")};try{if(!mW())return{data:null,error:new nm("Browser does not support WebAuthn",null)};const{data:d,error:i}=await this._enroll({friendlyName:t});if(!d)return await this.client.mfa.listFactors().then(S=>{var E;return(E=S.data)===null||E===void 0?void 0:E.all.find(A=>A.factor_type==="webauthn"&&A.friendly_name===t&&A.status!=="unverified")}).then(S=>S?this.client.mfa.unenroll({factorId:S==null?void 0:S.id}):void 0),{data:null,error:i};const{data:g,error:x}=await this._challenge({factorId:d.id,friendlyName:d.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:o},{create:l});return g?this._verify({factorId:d.id,challengeId:g.challengeId,webauthn:{rpId:r,rpOrigins:n,type:g.webauthn.type,credential_response:g.webauthn.credential_response}}):{data:null,error:x}}catch(d){return kn(d)?{data:null,error:d}:{data:null,error:new nm("Unexpected error in register",d)}}}}Rwe();const Ywe={url:ewe,storageKey:twe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:rwe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function gW(e,t,r){return await r()}const dx={};class N0{get jwks(){var t,r;return(r=(t=dx[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){dx[this.storageKey]=Object.assign(Object.assign({},dx[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=dx[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){dx[this.storageKey]=Object.assign(Object.assign({},dx[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,o;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const l=Object.assign(Object.assign({},Ywe),t);if(this.storageKey=l.storageKey,this.instanceID=(r=N0.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,N0.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!l.debug,typeof l.debug=="function"&&(this.logger=l.debug),this.instanceID>0&&zs()){const d=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(d),this.logDebugMessages&&console.trace(d)}if(this.persistSession=l.persistSession,this.autoRefreshToken=l.autoRefreshToken,this.admin=new yee({url:l.url,headers:l.headers,fetch:l.fetch}),this.url=l.url,this.headers=l.headers,this.fetch=gee(l.fetch),this.lock=l.lock||gW,this.detectSessionInUrl=l.detectSessionInUrl,this.flowType=l.flowType,this.hasCustomAuthorizationHeader=l.hasCustomAuthorizationHeader,this.throwOnError=l.throwOnError,l.lock?this.lock=l.lock:zs()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=xee:this.lock=gW,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Xwe(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(l.storage?this.storage=l.storage:mee()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=pW(this.memoryStorage)),l.userStorage&&(this.userStorage=l.userStorage)):(this.memoryStorage={},this.storage=pW(this.memoryStorage)),zs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${lee}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(zs()&&(r=hwe(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),zs()&&this.detectSessionInUrl&&n!=="none"){const{data:o,error:l}=await this._getSessionFromURL(r,n);if(l){if(this._debug("#_initialize()","error detecting session from URL",l),fee(l)){const g=(t=l.details)===null||t===void 0?void 0:t.code;if(g==="identity_already_exists"||g==="identity_not_found"||g==="single_identity_not_deletable")return{error:l}}return await this._removeSession(),{error:l}}const{session:d,redirectType:i}=o;return this._debug("#_initialize()","detected session in URL",d,"redirect type",i),await this._saveSession(d),setTimeout(async()=>{i==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",d):await this._notifyAllSubscribers("SIGNED_IN",d)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return kn(r)?this._returnResult({error:r}):this._returnResult({error:new nm("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,o;try{const l=await Jn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(o=t==null?void 0:t.options)===null||o===void 0?void 0:o.captchaToken}},xform:od}),{data:d,error:i}=l;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const g=d.session,x=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:x,session:g},error:null})}catch(l){if(kn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signUp(t){var r,n,o;try{let l;if("email"in t){const{email:S,password:E,options:A}=t;let C=null,N=null;this.flowType==="pkce"&&([C,N]=await cx(this.storage,this.storageKey)),l=await Jn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:A==null?void 0:A.emailRedirectTo,body:{email:S,password:E,data:(r=A==null?void 0:A.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:A==null?void 0:A.captchaToken},code_challenge:C,code_challenge_method:N},xform:od})}else if("phone"in t){const{phone:S,password:E,options:A}=t;l=await Jn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:S,password:E,data:(n=A==null?void 0:A.data)!==null&&n!==void 0?n:{},channel:(o=A==null?void 0:A.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:A==null?void 0:A.captchaToken}},xform:od})}else throw new CS("You must provide either an email or phone number and a password");const{data:d,error:i}=l;if(i||!d)return this._returnResult({data:{user:null,session:null},error:i});const g=d.session,x=d.user;return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:x,session:g},error:null})}catch(l){if(kn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithPassword(t){try{let r;if("email"in t){const{email:l,password:d,options:i}=t;r=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:l,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:hW})}else if("phone"in t){const{phone:l,password:d,options:i}=t;r=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:l,password:d,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},xform:hW})}else throw new CS("You must provide either an email or phone number and a password");const{data:n,error:o}=r;if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!n||!n.session||!n.user){const l=new vy;return this._returnResult({data:{user:null,session:null},error:l})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:o})}catch(r){if(kn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,o,l;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(o=t.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(l=t.options)===null||l===void 0?void 0:l.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,o,l,d,i,g,x,S,E,A;let C,N;if("message"in t)C=t.message,N=t.signature;else{const{chain:k,wallet:R,statement:L,options:j}=t;let F;if(zs())if(typeof R=="object")F=R;else{const se=window;if("ethereum"in se&&typeof se.ethereum=="object"&&"request"in se.ethereum&&typeof se.ethereum.request=="function")F=se.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof R!="object"||!(j!=null&&j.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");F=R}const B=new URL((r=j==null?void 0:j.url)!==null&&r!==void 0?r:window.location.href),U=await F.request({method:"eth_requestAccounts"}).then(se=>se).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Z=bee(U[0]);let X=(n=j==null?void 0:j.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!X){const se=await F.request({method:"eth_chainId"});X=jwe(se)}const te={domain:B.host,address:Z,statement:L,uri:B.href,version:"1",chainId:X,nonce:(o=j==null?void 0:j.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(d=(l=j==null?void 0:j.signInWithEthereum)===null||l===void 0?void 0:l.issuedAt)!==null&&d!==void 0?d:new Date,expirationTime:(i=j==null?void 0:j.signInWithEthereum)===null||i===void 0?void 0:i.expirationTime,notBefore:(g=j==null?void 0:j.signInWithEthereum)===null||g===void 0?void 0:g.notBefore,requestId:(x=j==null?void 0:j.signInWithEthereum)===null||x===void 0?void 0:x.requestId,resources:(S=j==null?void 0:j.signInWithEthereum)===null||S===void 0?void 0:S.resources};C=Mwe(te),N=await F.request({method:"personal_sign",params:[Nwe(C),Z]})}try{const{data:k,error:R}=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:C,signature:N},!((E=t.options)===null||E===void 0)&&E.captchaToken?{gotrue_meta_security:{captcha_token:(A=t.options)===null||A===void 0?void 0:A.captchaToken}}:null),xform:od});if(R)throw R;if(!k||!k.session||!k.user){const L=new vy;return this._returnResult({data:{user:null,session:null},error:L})}return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("SIGNED_IN",k.session)),this._returnResult({data:Object.assign({},k),error:R})}catch(k){if(kn(k))return this._returnResult({data:{user:null,session:null},error:k});throw k}}async signInWithSolana(t){var r,n,o,l,d,i,g,x,S,E,A,C;let N,k;if("message"in t)N=t.message,k=t.signature;else{const{chain:R,wallet:L,statement:j,options:F}=t;let B;if(zs())if(typeof L=="object")B=L;else{const Z=window;if("solana"in Z&&typeof Z.solana=="object"&&("signIn"in Z.solana&&typeof Z.solana.signIn=="function"||"signMessage"in Z.solana&&typeof Z.solana.signMessage=="function"))B=Z.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof L!="object"||!(F!=null&&F.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");B=L}const U=new URL((r=F==null?void 0:F.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in B&&B.signIn){const Z=await B.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},F==null?void 0:F.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),j?{statement:j}:null));let X;if(Array.isArray(Z)&&Z[0]&&typeof Z[0]=="object")X=Z[0];else if(Z&&typeof Z=="object"&&"signedMessage"in Z&&"signature"in Z)X=Z;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in X&&"signature"in X&&(typeof X.signedMessage=="string"||X.signedMessage instanceof Uint8Array)&&X.signature instanceof Uint8Array)N=typeof X.signedMessage=="string"?X.signedMessage:new TextDecoder().decode(X.signedMessage),k=X.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in B)||typeof B.signMessage!="function"||!("publicKey"in B)||typeof B!="object"||!B.publicKey||!("toBase58"in B.publicKey)||typeof B.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");N=[`${U.host} wants you to sign in with your Solana account:`,B.publicKey.toBase58(),...j?["",j,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(o=(n=F==null?void 0:F.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((l=F==null?void 0:F.signInWithSolana)===null||l===void 0)&&l.notBefore?[`Not Before: ${F.signInWithSolana.notBefore}`]:[],...!((d=F==null?void 0:F.signInWithSolana)===null||d===void 0)&&d.expirationTime?[`Expiration Time: ${F.signInWithSolana.expirationTime}`]:[],...!((i=F==null?void 0:F.signInWithSolana)===null||i===void 0)&&i.chainId?[`Chain ID: ${F.signInWithSolana.chainId}`]:[],...!((g=F==null?void 0:F.signInWithSolana)===null||g===void 0)&&g.nonce?[`Nonce: ${F.signInWithSolana.nonce}`]:[],...!((x=F==null?void 0:F.signInWithSolana)===null||x===void 0)&&x.requestId?[`Request ID: ${F.signInWithSolana.requestId}`]:[],...!((E=(S=F==null?void 0:F.signInWithSolana)===null||S===void 0?void 0:S.resources)===null||E===void 0)&&E.length?["Resources",...F.signInWithSolana.resources.map(X=>`- ${X}`)]:[]].join(`
`);const Z=await B.signMessage(new TextEncoder().encode(N),"utf8");if(!Z||!(Z instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");k=Z}}try{const{data:R,error:L}=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:N,signature:jy(k)},!((A=t.options)===null||A===void 0)&&A.captchaToken?{gotrue_meta_security:{captcha_token:(C=t.options)===null||C===void 0?void 0:C.captchaToken}}:null),xform:od});if(L)throw L;if(!R||!R.session||!R.user){const j=new vy;return this._returnResult({data:{user:null,session:null},error:j})}return R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),this._returnResult({data:Object.assign({},R),error:L})}catch(R){if(kn(R))return this._returnResult({data:{user:null,session:null},error:R});throw R}}async _exchangeCodeForSession(t){const r=await dy(this.storage,`${this.storageKey}-code-verifier`),[n,o]=(r??"").split("/");try{const{data:l,error:d}=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:od});if(await Vp(this.storage,`${this.storageKey}-code-verifier`),d)throw d;if(!l||!l.session||!l.user){const i=new vy;return this._returnResult({data:{user:null,session:null,redirectType:null},error:i})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:Object.assign(Object.assign({},l),{redirectType:o??null}),error:d})}catch(l){if(kn(l))return this._returnResult({data:{user:null,session:null,redirectType:null},error:l});throw l}}async signInWithIdToken(t){try{const{options:r,provider:n,token:o,access_token:l,nonce:d}=t,i=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:o,access_token:l,nonce:d,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:od}),{data:g,error:x}=i;if(x)return this._returnResult({data:{user:null,session:null},error:x});if(!g||!g.session||!g.user){const S=new vy;return this._returnResult({data:{user:null,session:null},error:S})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:g,error:x})}catch(r){if(kn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,o,l,d;try{if("email"in t){const{email:i,options:g}=t;let x=null,S=null;this.flowType==="pkce"&&([x,S]=await cx(this.storage,this.storageKey));const{error:E}=await Jn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:i,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},create_user:(n=g==null?void 0:g.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:x,code_challenge_method:S},redirectTo:g==null?void 0:g.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:E})}if("phone"in t){const{phone:i,options:g}=t,{data:x,error:S}=await Jn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:i,data:(o=g==null?void 0:g.data)!==null&&o!==void 0?o:{},create_user:(l=g==null?void 0:g.shouldCreateUser)!==null&&l!==void 0?l:!0,gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},channel:(d=g==null?void 0:g.channel)!==null&&d!==void 0?d:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:x==null?void 0:x.message_id},error:S})}throw new CS("You must provide either an email or phone number.")}catch(i){if(kn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async verifyOtp(t){var r,n;try{let o,l;"options"in t&&(o=(r=t.options)===null||r===void 0?void 0:r.redirectTo,l=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:d,error:i}=await Jn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:l}}),redirectTo:o,xform:od});if(i)throw i;if(!d)throw new Error("An error occurred on token verification.");const g=d.session,x=d.user;return g!=null&&g.access_token&&(await this._saveSession(g),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",g)),this._returnResult({data:{user:x,session:g},error:null})}catch(o){if(kn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithSSO(t){var r,n,o,l,d;try{let i=null,g=null;this.flowType==="pkce"&&([i,g]=await cx(this.storage,this.storageKey));const x=await Jn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((o=t==null?void 0:t.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:g}),headers:this.headers,xform:Owe});return!((l=x.data)===null||l===void 0)&&l.url&&zs()&&!(!((d=t.options)===null||d===void 0)&&d.skipBrowserRedirect)&&window.location.assign(x.data.url),this._returnResult(x)}catch(i){if(kn(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new lc;const{error:o}=await Jn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:o})})}catch(t){if(kn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:o,options:l}=t,{error:d}=await Jn(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}else if("phone"in t){const{phone:n,type:o,options:l}=t,{data:d,error:i}=await Jn(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:i})}throw new CS("You must provide either an email or phone number and a type")}catch(r){if(kn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await dy(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<PM:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const d=await dy(this.userStorage,this.storageKey+"-user");d!=null&&d.user?t.user=d.user:t.user=OM()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const d={value:this.suppressGetSessionWarning};t.user=Twe(t.user,d),d.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{session:null},error:l}):this._returnResult({data:{session:o},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Jn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:im}):await this._useSession(async r=>{var n,o,l;const{data:d,error:i}=r;if(i)throw i;return!(!((n=d.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new lc}:await Jn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(l=(o=d.session)===null||o===void 0?void 0:o.access_token)!==null&&l!==void 0?l:void 0,xform:im})})}catch(r){if(kn(r))return hee(r)&&(await this._removeSession(),await Vp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:o,error:l}=n;if(l)throw l;if(!o.session)throw new lc;const d=o.session;let i=null,g=null;this.flowType==="pkce"&&t.email!=null&&([i,g]=await cx(this.storage,this.storageKey));const{data:x,error:S}=await Jn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:i,code_challenge_method:g}),jwt:d.access_token,xform:im});if(S)throw S;return d.user=x.user,await this._saveSession(d),await this._notifyAllSubscribers("USER_UPDATED",d),this._returnResult({data:{user:d.user},error:null})})}catch(n){if(kn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new lc;const r=Date.now()/1e3;let n=r,o=!0,l=null;const{payload:d}=CM(t.access_token);if(d.exp&&(n=d.exp,o=n<=r),o){const{data:i,error:g}=await this._callRefreshToken(t.refresh_token);if(g)return this._returnResult({data:{user:null,session:null},error:g});if(!i)return{data:{user:null,session:null},error:null};l=i}else{const{data:i,error:g}=await this._getUser(t.access_token);if(g)throw g;l={access_token:t.access_token,refresh_token:t.refresh_token,user:i.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)}return this._returnResult({data:{user:l.user,session:l},error:null})}catch(r){if(kn(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:d,error:i}=r;if(i)throw i;t=(n=d.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new lc;const{data:o,error:l}=await this._callRefreshToken(t.refresh_token);return l?this._returnResult({data:{user:null,session:null},error:l}):o?this._returnResult({data:{user:o.user,session:o},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(kn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!zs())throw new OS("No browser detected.");if(t.error||t.error_description||t.error_code)throw new OS(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new o3("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new OS("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new o3("No code detected.");const{data:j,error:F}=await this._exchangeCodeForSession(t.code);if(F)throw F;const B=new URL(window.location.href);return B.searchParams.delete("code"),window.history.replaceState(window.history.state,"",B.toString()),{data:{session:j.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:o,access_token:l,refresh_token:d,expires_in:i,expires_at:g,token_type:x}=t;if(!l||!i||!d||!x)throw new OS("No session defined in URL");const S=Math.round(Date.now()/1e3),E=parseInt(i);let A=S+E;g&&(A=parseInt(g));const C=A-S;C*1e3<=Ex&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${C}s, should have been closer to ${E}s`);const N=A-E;S-N>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",N,A,S):S-N<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",N,A,S);const{data:k,error:R}=await this._getUser(l);if(R)throw R;const L={provider_token:n,provider_refresh_token:o,access_token:l,expires_in:E,expires_at:A,refresh_token:d,token_type:x,user:k.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:L,redirectType:t.type},error:null})}catch(n){if(kn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await dy(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({error:l});const d=(n=o.session)===null||n===void 0?void 0:n.access_token;if(d){const{error:i}=await this.admin.signOut(d,t);if(i&&!(dee(i)&&(i.status===404||i.status===401||i.status===403)))return this._returnResult({error:i})}return t!=="others"&&(await this._removeSession(),await Vp(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=dwe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,o;try{const{data:{session:l},error:d}=r;if(d)throw d;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",l)),this._debug("INITIAL_SESSION","callback id",t,"session",l)}catch(l){await((o=this.stateChangeEmitters.get(t))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",l),console.error(l)}})}async resetPasswordForEmail(t,r={}){let n=null,o=null;this.flowType==="pkce"&&([n,o]=await cx(this.storage,this.storageKey,!0));try{return await Jn(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:o,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(l){if(kn(l))return this._returnResult({data:null,error:l});throw l}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:o}=await this._useSession(async l=>{var d,i,g,x,S;const{data:E,error:A}=l;if(A)throw A;const C=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(d=t.options)===null||d===void 0?void 0:d.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(g=t.options)===null||g===void 0?void 0:g.queryParams,skipBrowserRedirect:!0});return await Jn(this.fetch,"GET",C,{headers:this.headers,jwt:(S=(x=E.session)===null||x===void 0?void 0:x.access_token)!==null&&S!==void 0?S:void 0})});if(o)throw o;return zs()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(kn(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:o,data:{session:l}}=r;if(o)throw o;const{options:d,provider:i,token:g,access_token:x,nonce:S}=t,E=await Jn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=l==null?void 0:l.access_token)!==null&&n!==void 0?n:void 0,body:{provider:i,id_token:g,access_token:x,nonce:S,link_identity:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},xform:od}),{data:A,error:C}=E;return C?this._returnResult({data:{user:null,session:null},error:C}):!A||!A.session||!A.user?this._returnResult({data:{user:null,session:null},error:new vy}):(A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("USER_UPDATED",A.session)),this._returnResult({data:A,error:C}))}catch(o){if(kn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,o;const{data:l,error:d}=r;if(d)throw d;return await Jn(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(o=(n=l.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0})})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await mwe(async o=>(o>0&&await pwe(200*Math.pow(2,o-1)),this._debug(r,"refreshing attempt",o),await Jn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:od})),(o,l)=>{const d=200*Math.pow(2,o);return l&&hC(l)&&Date.now()+d-n<Ex})}catch(n){if(this._debug(r,"error",n),kn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),zs()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const o=await dy(this.storage,this.storageKey);if(o&&this.userStorage){let d=await dy(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!d&&(d={user:o.user},await Tx(this.userStorage,this.storageKey+"-user",d)),o.user=(t=d==null?void 0:d.user)!==null&&t!==void 0?t:OM()}else if(o&&!o.user&&!o.user){const d=await dy(this.storage,this.storageKey+"-user");d&&(d!=null&&d.user)?(o.user=d.user,await Vp(this.storage,this.storageKey+"-user"),await Tx(this.storage,this.storageKey,o)):o.user=OM()}if(this._debug(n,"session from storage",o),!this._isValidSession(o)){this._debug(n,"session is not valid"),o!==null&&await this._removeSession();return}const l=((r=o.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<PM;if(this._debug(n,`session has${l?"":" not"} expired with margin of ${PM}s`),l){if(this.autoRefreshToken&&o.refresh_token){const{error:d}=await this._callRefreshToken(o.refresh_token);d&&(console.error(d),hC(d)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{const{data:d,error:i}=await this._getUser(o.access_token);!i&&(d!=null&&d.user)?(o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(d){console.error("Error getting user data:",d),this._debug(n,"error getting user data, skipping SIGNED_IN notification",d)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(n,"error",o),console.error(o);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new lc;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const o=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new mk;const{data:l,error:d}=await this._refreshAccessToken(t);if(d)throw d;if(!l.session)throw new lc;await this._saveSession(l.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",l.session);const i={data:l.session,error:null};return this.refreshingDeferred.resolve(i),i}catch(l){if(this._debug(o,"error",l),kn(l)){const d={data:null,error:l};return hC(l)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(d),d}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(l),l}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(t,r,n=!0){const o=`#_notifyAllSubscribers(${t})`;this._debug(o,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const l=[],d=Array.from(this.stateChangeEmitters.values()).map(async i=>{try{await i.callback(t,r)}catch(g){l.push(g)}});if(await Promise.all(d),l.length>0){for(let i=0;i<l.length;i+=1)console.error(l[i]);throw l[0]}}finally{this._debug(o,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Tx(this.userStorage,this.storageKey+"-user",{user:r.user});const o=Object.assign({},r);delete o.user;const l=uW(o);await Tx(this.storage,this.storageKey,l)}else{const o=uW(r);await Tx(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await Vp(this.storage,this.storageKey),await Vp(this.storage,this.storageKey+"-code-verifier"),await Vp(this.storage,this.storageKey+"-user"),this.userStorage&&await Vp(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&zs()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Ex);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const o=Math.floor((n.expires_at*1e3-t)/Ex);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Ex}ms, refresh threshold is ${i3} ticks`),o<=i3&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof vee)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!zs()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const o=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&o.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&o.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[l,d]=await cx(this.storage,this.storageKey),i=new URLSearchParams({code_challenge:`${encodeURIComponent(l)}`,code_challenge_method:`${encodeURIComponent(d)}`});o.push(i.toString())}if(n!=null&&n.queryParams){const l=new URLSearchParams(n.queryParams);o.push(l.toString())}return n!=null&&n.skipBrowserRedirect&&o.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${o.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;return l?this._returnResult({data:null,error:l}):await Jn(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,o;const{data:l,error:d}=r;if(d)return this._returnResult({data:null,error:d});const i=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:g,error:x}=await Jn(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:(n=l==null?void 0:l.session)===null||n===void 0?void 0:n.access_token});return x?this._returnResult({data:null,error:x}):(t.factorType==="totp"&&g.type==="totp"&&(!((o=g==null?void 0:g.totp)===null||o===void 0)&&o.qr_code)&&(g.totp.qr_code=`data:image/svg+xml;utf-8,${g.totp.qr_code}`),this._returnResult({data:g,error:null}))})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({data:null,error:l});const d=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?Uwe(t.webauthn.credential_response):Vwe(t.webauthn.credential_response)})}:{code:t.code}),{data:i,error:g}=await Jn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:d,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return g?this._returnResult({data:null,error:g}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:g}))})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var n;const{data:o,error:l}=r;if(l)return this._returnResult({data:null,error:l});const d=await Jn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});if(d.error)return d;const{data:i}=d;if(i.type!=="webauthn")return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Bwe(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:$we(i.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const o={all:[],phone:[],totp:[],webauthn:[]};for(const l of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])o.all.push(l),l.status==="verified"&&o[l.factor_type].push(l);return{data:o,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:l}=CM(n.access_token);let d=null;l.aal&&(d=l.aal);let i=d;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(S=>S.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(i="aal2");const x=l.amr||[];return{data:{currentLevel:d,nextLevel:i,currentAuthenticationMethods:x},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:o}=r;return o?this._returnResult({data:null,error:o}):n?await Jn(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new lc})})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new lc});const d=await Jn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"approve"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&zs()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(kn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:o},error:l}=n;if(l)return this._returnResult({data:null,error:l});if(!o)return this._returnResult({data:null,error:new lc});const d=await Jn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:o.access_token,body:{action:"deny"},xform:i=>({data:i,error:null})});return d.data&&d.data.redirect_url&&zs()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(d.data.redirect_url),d})}catch(n){if(kn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await Jn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new lc})})}catch(t){if(kn(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:o}=r;return o?this._returnResult({data:null,error:o}):n?await Jn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new lc})})}catch(r){if(kn(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(i=>i.kid===t);if(n)return n;const o=Date.now();if(n=this.jwks.keys.find(i=>i.kid===t),n&&this.jwks_cached_at+iwe>o)return n;const{data:l,error:d}=await Jn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;return!l.keys||l.keys.length===0||(this.jwks=l,this.jwks_cached_at=o,n=l.keys.find(i=>i.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:C,error:N}=await this.getSession();if(N||!C.session)return this._returnResult({data:null,error:N});n=C.session.access_token}const{header:o,payload:l,signature:d,raw:{header:i,payload:g}}=CM(n);r!=null&&r.allowExpired||wwe(l.exp);const x=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!x){const{error:C}=await this.getUser(n);if(C)throw C;return{data:{claims:l,header:o,signature:d},error:null}}const S=Swe(o.alg),E=await crypto.subtle.importKey("jwk",x,S,!0,["verify"]);if(!await crypto.subtle.verify(S,E,d,cwe(`${i}.${g}`)))throw new lO("Invalid JWT signature");return{data:{claims:l,header:o,signature:d},error:null}}catch(n){if(kn(n))return this._returnResult({data:null,error:n});throw n}}}N0.nextInstanceID={};const See=N0;class Jwe extends See{constructor(t){super(t)}}class Eee{constructor(t,r,n){var o,l,d;this.supabaseUrl=t,this.supabaseKey=r;const i=Qbe(t);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const g=`sb-${i.hostname.split(".")[0]}-auth-token`,x={db:Wbe,realtime:Hbe,auth:Object.assign(Object.assign({},Gbe),{storageKey:g}),global:qbe},S=Jbe(n??{},x);this.storageKey=(o=S.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(l=S.global.headers)!==null&&l!==void 0?l:{},S.accessToken?(this.accessToken=S.accessToken,this.auth=new Proxy({},{get:(E,A)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(A)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((d=S.auth)!==null&&d!==void 0?d:{},this.headers,S.global.fetch),this.fetch=Xbe(r,this._getAccessToken.bind(this),S.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},S.realtime)),this.accessToken&&this.accessToken().then(E=>this.realtime.setAuth(E)).catch(E=>console.warn("Failed to set initial Realtime auth token:",E)),this.rest=new tbe(new URL("rest/v1",i).href,{headers:this.headers,schema:S.db.schema,fetch:this.fetch}),this.storage=new $be(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),S.accessToken||this._listenForAuthEvents()}get functions(){return new J0e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,r,n)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,r;if(this.accessToken)return await this.accessToken();const{data:n}=await this.auth.getSession();return(r=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:o,userStorage:l,storageKey:d,flowType:i,lock:g,debug:x,throwOnError:S},E,A){const C={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Jwe({url:this.authUrl.href,headers:Object.assign(Object.assign({},C),E),storageKey:d,autoRefreshToken:t,persistSession:r,detectSessionInUrl:n,storage:o,userStorage:l,flowType:i,lock:g,debug:x,throwOnError:S,fetch:A,hasCustomAuthorizationHeader:Object.keys(this.headers).some(N=>N.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new nee(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,n)=>{this._handleTokenChanged(r,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(t,r,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Tee=(e,t,r)=>new Eee(e,t,r);function Qwe(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}Qwe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const e1e=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:uee,AuthClient:See,AuthError:j0,AuthImplicitGrantRedirectError:OS,AuthInvalidCredentialsError:CS,AuthInvalidJwtError:lO,AuthInvalidTokenResponseError:vy,AuthPKCEGrantCodeExchangeError:o3,AuthRetryableFetchError:sO,AuthSessionMissingError:lc,AuthUnknownError:nm,AuthWeakPasswordError:s3,CustomAuthError:qf,get FunctionRegion(){return oO},FunctionsError:fk,FunctionsFetchError:NQ,FunctionsHttpError:ZL,FunctionsRelayError:KL,GoTrueAdminApi:yee,GoTrueClient:N0,NavigatorLockAcquireTimeoutError:_ee,PostgrestError:rbe,get REALTIME_LISTEN_TYPES(){return t0},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return e3},get REALTIME_PRESENCE_LISTEN_EVENTS(){return QL},get REALTIME_SUBSCRIBE_STATES(){return ih},RealtimeChannel:pk,RealtimeClient:nee,RealtimePresence:e0,SIGN_OUT_SCOPES:fC,SupabaseClient:Eee,WebSocketFactory:JQ,createClient:Tee,isAuthApiError:dee,isAuthError:kn,isAuthImplicitGrantRedirectError:fee,isAuthRetryableFetchError:hC,isAuthSessionMissingError:hee,lockInternals:xy,navigatorLock:xee},Symbol.toStringTag,{value:"Module"})),t1e="https://tzdgqhwyzsxkxnncgzap.supabase.co",r1e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Ut=Tee(t1e,r1e,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),Aee=G.createContext(void 0),n1e=({children:e})=>{const[t,r]=G.useState(null),[n,o]=G.useState(null),[l,d]=G.useState(!0),i=Vf();G.useEffect(()=>{const{data:{subscription:N}}=Ut.auth.onAuthStateChange((k,R)=>{o(R),r((R==null?void 0:R.user)??null),k==="SIGNED_IN"&&R&&i("/")});return Ut.auth.getSession().then(({data:{session:k}})=>{o(k),r((k==null?void 0:k.user)??null),d(!1)}),()=>N.unsubscribe()},[i]);const g=async(N,k,R,L)=>{const j=`${window.location.origin}/`,{error:F}=await Ut.auth.signUp({email:N,password:k,options:{emailRedirectTo:j,data:{display_name:R,phone:L||null}}});return{error:F}},x=async(N,k)=>{const{error:R}=await Ut.auth.signInWithPassword({email:N,password:k});return{error:R}},S=async()=>{const{error:N}=await Ut.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/`}});return{error:N}},E=async N=>{const{error:k}=await Ut.auth.signInWithOtp({phone:N,options:{channel:"sms"}});return{error:k}},A=async(N,k)=>{const{error:R}=await Ut.auth.verifyOtp({phone:N,token:k,type:"sms"});return{error:R}},C=async()=>{await Ut.auth.signOut(),i("/auth")};return m.jsx(Aee.Provider,{value:{user:t,session:n,signUp:g,signIn:x,signInWithGoogle:S,signInWithPhone:E,verifyOTP:A,signOut:C,loading:l},children:e})},Di=()=>{const e=G.useContext(Aee);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},AE=xb("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),lr=G.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...o},l)=>{const d=n?Sv:"button";return m.jsx(d,{className:_r(AE({variant:t,size:r,className:e})),ref:l,...o})});lr.displayName="Button";const i1e="/assets/xiaoxiong-logo-v3-D4uDr23w.png";var IM="focusScope.autoFocusOnMount",kM="focusScope.autoFocusOnUnmount",yW={bubbles:!1,cancelable:!0},a1e="FocusScope",kT=G.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:o,onUnmountAutoFocus:l,...d}=e,[i,g]=G.useState(null),x=Io(o),S=Io(l),E=G.useRef(null),A=hi(t,k=>g(k)),C=G.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;G.useEffect(()=>{if(n){let k=function(F){if(C.paused||!i)return;const B=F.target;i.contains(B)?E.current=B:Gp(E.current,{select:!0})},R=function(F){if(C.paused||!i)return;const B=F.relatedTarget;B!==null&&(i.contains(B)||Gp(E.current,{select:!0}))},L=function(F){if(document.activeElement===document.body)for(const U of F)U.removedNodes.length>0&&Gp(i)};document.addEventListener("focusin",k),document.addEventListener("focusout",R);const j=new MutationObserver(L);return i&&j.observe(i,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",k),document.removeEventListener("focusout",R),j.disconnect()}}},[n,i,C.paused]),G.useEffect(()=>{if(i){_W.add(C);const k=document.activeElement;if(!i.contains(k)){const L=new CustomEvent(IM,yW);i.addEventListener(IM,x),i.dispatchEvent(L),L.defaultPrevented||(o1e(d1e(Pee(i)),{select:!0}),document.activeElement===k&&Gp(i))}return()=>{i.removeEventListener(IM,x),setTimeout(()=>{const L=new CustomEvent(kM,yW);i.addEventListener(kM,S),i.dispatchEvent(L),L.defaultPrevented||Gp(k??document.body,{select:!0}),i.removeEventListener(kM,S),_W.remove(C)},0)}}},[i,x,S,C]);const N=G.useCallback(k=>{if(!r&&!n||C.paused)return;const R=k.key==="Tab"&&!k.altKey&&!k.ctrlKey&&!k.metaKey,L=document.activeElement;if(R&&L){const j=k.currentTarget,[F,B]=s1e(j);F&&B?!k.shiftKey&&L===B?(k.preventDefault(),r&&Gp(F,{select:!0})):k.shiftKey&&L===F&&(k.preventDefault(),r&&Gp(B,{select:!0})):L===j&&k.preventDefault()}},[r,n,C.paused]);return m.jsx(bn.div,{tabIndex:-1,...d,ref:A,onKeyDown:N})});kT.displayName=a1e;function o1e(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(Gp(n,{select:t}),document.activeElement!==r)return}function s1e(e){const t=Pee(e),r=vW(t,e),n=vW(t.reverse(),e);return[r,n]}function Pee(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const o=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||o?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function vW(e,t){for(const r of e)if(!l1e(r,{upTo:t}))return r}function l1e(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function c1e(e){return e instanceof HTMLInputElement&&"select"in e}function Gp(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&c1e(e)&&t&&e.select()}}var _W=u1e();function u1e(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=xW(e,t),e.unshift(t)},remove(t){var r;e=xW(e,t),(r=e[0])==null||r.resume()}}}function xW(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function d1e(e){return e.filter(t=>t.tagName!=="A")}var RM=0;function gk(){G.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??bW()),document.body.insertAdjacentElement("beforeend",e[1]??bW()),RM++,()=>{RM===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),RM--}},[])}function bW(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var pC="right-scroll-bar-position",mC="width-before-scroll-bar",h1e="with-scroll-bars-hidden",f1e="--removed-body-scroll-bar-size";function jM(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function p1e(e,t){var r=G.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var o=r.value;o!==n&&(r.value=n,r.callback(n,o))}}}})[0];return r.callback=t,r.facade}var m1e=typeof window<"u"?G.useLayoutEffect:G.useEffect,wW=new WeakMap;function g1e(e,t){var r=p1e(null,function(n){return e.forEach(function(o){return jM(o,n)})});return m1e(function(){var n=wW.get(r);if(n){var o=new Set(n),l=new Set(e),d=r.current;o.forEach(function(i){l.has(i)||jM(i,null)}),l.forEach(function(i){o.has(i)||jM(i,d)})}wW.set(r,e)},[e]),r}function y1e(e){return e}function v1e(e,t){t===void 0&&(t=y1e);var r=[],n=!1,o={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(l){var d=t(l,n);return r.push(d),function(){r=r.filter(function(i){return i!==d})}},assignSyncMedium:function(l){for(n=!0;r.length;){var d=r;r=[],d.forEach(l)}r={push:function(i){return l(i)},filter:function(){return r}}},assignMedium:function(l){n=!0;var d=[];if(r.length){var i=r;r=[],i.forEach(l),d=r}var g=function(){var S=d;d=[],S.forEach(l)},x=function(){return Promise.resolve().then(g)};x(),r={push:function(S){d.push(S),x()},filter:function(S){return d=d.filter(S),r}}}};return o}function _1e(e){e===void 0&&(e={});var t=v1e(null);return t.options=_u({async:!0,ssr:!1},e),t}var Cee=function(e){var t=e.sideCar,r=rg(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return G.createElement(n,_u({},r))};Cee.isSideCarExport=!0;function x1e(e,t){return e.useMedium(t),Cee}var Oee=_1e(),NM=function(){},yk=G.forwardRef(function(e,t){var r=G.useRef(null),n=G.useState({onScrollCapture:NM,onWheelCapture:NM,onTouchMoveCapture:NM}),o=n[0],l=n[1],d=e.forwardProps,i=e.children,g=e.className,x=e.removeScrollBar,S=e.enabled,E=e.shards,A=e.sideCar,C=e.noRelative,N=e.noIsolation,k=e.inert,R=e.allowPinchZoom,L=e.as,j=L===void 0?"div":L,F=e.gapMode,B=rg(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),U=A,Z=g1e([r,t]),X=_u(_u({},B),o);return G.createElement(G.Fragment,null,S&&G.createElement(U,{sideCar:Oee,removeScrollBar:x,shards:E,noRelative:C,noIsolation:N,inert:k,setCallbacks:l,allowPinchZoom:!!R,lockRef:r,gapMode:F}),d?G.cloneElement(G.Children.only(i),_u(_u({},X),{ref:Z})):G.createElement(j,_u({},X,{className:g,ref:Z}),i))});yk.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};yk.classNames={fullWidth:mC,zeroRight:pC};var b1e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function w1e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=b1e();return t&&e.setAttribute("nonce",t),e}function S1e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function E1e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var T1e=function(){var e=0,t=null;return{add:function(r){e==0&&(t=w1e())&&(S1e(t,r),E1e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},A1e=function(){var e=T1e();return function(t,r){G.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},Iee=function(){var e=A1e(),t=function(r){var n=r.styles,o=r.dynamic;return e(n,o),null};return t},P1e={left:0,top:0,right:0,gap:0},MM=function(e){return parseInt(e||"",10)||0},C1e=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[MM(r),MM(n),MM(o)]},O1e=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return P1e;var t=C1e(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},I1e=Iee(),n0="data-scroll-locked",k1e=function(e,t,r,n){var o=e.left,l=e.top,d=e.right,i=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(h1e,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(i,"px ").concat(n,`;
  }
  body[`).concat(n0,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(l,`px;
    padding-right: `).concat(d,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(i,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(i,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(pC,` {
    right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(mC,` {
    margin-right: `).concat(i,"px ").concat(n,`;
  }
  
  .`).concat(pC," .").concat(pC,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(mC," .").concat(mC,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(n0,`] {
    `).concat(f1e,": ").concat(i,`px;
  }
`)},SW=function(){var e=parseInt(document.body.getAttribute(n0)||"0",10);return isFinite(e)?e:0},R1e=function(){G.useEffect(function(){return document.body.setAttribute(n0,(SW()+1).toString()),function(){var e=SW()-1;e<=0?document.body.removeAttribute(n0):document.body.setAttribute(n0,e.toString())}},[])},j1e=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,o=n===void 0?"margin":n;R1e();var l=G.useMemo(function(){return O1e(o)},[o]);return G.createElement(I1e,{styles:k1e(l,!t,o,r?"":"!important")})},l3=!1;if(typeof window<"u")try{var CP=Object.defineProperty({},"passive",{get:function(){return l3=!0,!0}});window.addEventListener("test",CP,CP),window.removeEventListener("test",CP,CP)}catch{l3=!1}var hx=l3?{passive:!1}:!1,N1e=function(e){return e.tagName==="TEXTAREA"},kee=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!N1e(e)&&r[t]==="visible")},M1e=function(e){return kee(e,"overflowY")},D1e=function(e){return kee(e,"overflowX")},EW=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var o=Ree(e,n);if(o){var l=jee(e,n),d=l[1],i=l[2];if(d>i)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},L1e=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},F1e=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},Ree=function(e,t){return e==="v"?M1e(t):D1e(t)},jee=function(e,t){return e==="v"?L1e(t):F1e(t)},z1e=function(e,t){return e==="h"&&t==="rtl"?-1:1},B1e=function(e,t,r,n,o){var l=z1e(e,window.getComputedStyle(t).direction),d=l*n,i=r.target,g=t.contains(i),x=!1,S=d>0,E=0,A=0;do{if(!i)break;var C=jee(e,i),N=C[0],k=C[1],R=C[2],L=k-R-l*N;(N||L)&&Ree(e,i)&&(E+=L,A+=N);var j=i.parentNode;i=j&&j.nodeType===Node.DOCUMENT_FRAGMENT_NODE?j.host:j}while(!g&&i!==document.body||g&&(t.contains(i)||t===i));return(S&&(Math.abs(E)<1||!o)||!S&&(Math.abs(A)<1||!o))&&(x=!0),x},OP=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},TW=function(e){return[e.deltaX,e.deltaY]},AW=function(e){return e&&"current"in e?e.current:e},$1e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},U1e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},V1e=0,fx=[];function q1e(e){var t=G.useRef([]),r=G.useRef([0,0]),n=G.useRef(),o=G.useState(V1e++)[0],l=G.useState(Iee)[0],d=G.useRef(e);G.useEffect(function(){d.current=e},[e]),G.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var k=MB([e.lockRef.current],(e.shards||[]).map(AW),!0).filter(Boolean);return k.forEach(function(R){return R.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),k.forEach(function(R){return R.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var i=G.useCallback(function(k,R){if("touches"in k&&k.touches.length===2||k.type==="wheel"&&k.ctrlKey)return!d.current.allowPinchZoom;var L=OP(k),j=r.current,F="deltaX"in k?k.deltaX:j[0]-L[0],B="deltaY"in k?k.deltaY:j[1]-L[1],U,Z=k.target,X=Math.abs(F)>Math.abs(B)?"h":"v";if("touches"in k&&X==="h"&&Z.type==="range")return!1;var te=EW(X,Z);if(!te)return!0;if(te?U=X:(U=X==="v"?"h":"v",te=EW(X,Z)),!te)return!1;if(!n.current&&"changedTouches"in k&&(F||B)&&(n.current=U),!U)return!0;var se=n.current||U;return B1e(se,R,k,se==="h"?F:B,!0)},[]),g=G.useCallback(function(k){var R=k;if(!(!fx.length||fx[fx.length-1]!==l)){var L="deltaY"in R?TW(R):OP(R),j=t.current.filter(function(U){return U.name===R.type&&(U.target===R.target||R.target===U.shadowParent)&&$1e(U.delta,L)})[0];if(j&&j.should){R.cancelable&&R.preventDefault();return}if(!j){var F=(d.current.shards||[]).map(AW).filter(Boolean).filter(function(U){return U.contains(R.target)}),B=F.length>0?i(R,F[0]):!d.current.noIsolation;B&&R.cancelable&&R.preventDefault()}}},[]),x=G.useCallback(function(k,R,L,j){var F={name:k,delta:R,target:L,should:j,shadowParent:W1e(L)};t.current.push(F),setTimeout(function(){t.current=t.current.filter(function(B){return B!==F})},1)},[]),S=G.useCallback(function(k){r.current=OP(k),n.current=void 0},[]),E=G.useCallback(function(k){x(k.type,TW(k),k.target,i(k,e.lockRef.current))},[]),A=G.useCallback(function(k){x(k.type,OP(k),k.target,i(k,e.lockRef.current))},[]);G.useEffect(function(){return fx.push(l),e.setCallbacks({onScrollCapture:E,onWheelCapture:E,onTouchMoveCapture:A}),document.addEventListener("wheel",g,hx),document.addEventListener("touchmove",g,hx),document.addEventListener("touchstart",S,hx),function(){fx=fx.filter(function(k){return k!==l}),document.removeEventListener("wheel",g,hx),document.removeEventListener("touchmove",g,hx),document.removeEventListener("touchstart",S,hx)}},[]);var C=e.removeScrollBar,N=e.inert;return G.createElement(G.Fragment,null,N?G.createElement(l,{styles:U1e(o)}):null,C?G.createElement(j1e,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function W1e(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const G1e=x1e(Oee,q1e);var RT=G.forwardRef(function(e,t){return G.createElement(yk,_u({},e,{ref:t,sideCar:G1e}))});RT.classNames=yk.classNames;var H1e=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},px=new WeakMap,IP=new WeakMap,kP={},DM=0,Nee=function(e){return e&&(e.host||Nee(e.parentNode))},K1e=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=Nee(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},Z1e=function(e,t,r,n){var o=K1e(t,Array.isArray(e)?e:[e]);kP[r]||(kP[r]=new WeakMap);var l=kP[r],d=[],i=new Set,g=new Set(o),x=function(E){!E||i.has(E)||(i.add(E),x(E.parentNode))};o.forEach(x);var S=function(E){!E||g.has(E)||Array.prototype.forEach.call(E.children,function(A){if(i.has(A))S(A);else try{var C=A.getAttribute(n),N=C!==null&&C!=="false",k=(px.get(A)||0)+1,R=(l.get(A)||0)+1;px.set(A,k),l.set(A,R),d.push(A),k===1&&N&&IP.set(A,!0),R===1&&A.setAttribute(r,"true"),N||A.setAttribute(n,"true")}catch(L){console.error("aria-hidden: cannot operate on ",A,L)}})};return S(t),i.clear(),DM++,function(){d.forEach(function(E){var A=px.get(E)-1,C=l.get(E)-1;px.set(E,A),l.set(E,C),A||(IP.has(E)||E.removeAttribute(n),IP.delete(E)),C||E.removeAttribute(r)}),DM--,DM||(px=new WeakMap,px=new WeakMap,IP=new WeakMap,kP={})}},vk=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),o=H1e(e);return o?(n.push.apply(n,Array.from(o.querySelectorAll("[aria-live]"))),Z1e(n,o,r,"aria-hidden")):function(){return null}},_k="Dialog",[Mee,Dee]=Ks(_k),[X1e,Id]=Mee(_k),Lee=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:o,onOpenChange:l,modal:d=!0}=e,i=G.useRef(null),g=G.useRef(null),[x,S]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:_k});return m.jsx(X1e,{scope:t,triggerRef:i,contentRef:g,contentId:Hc(),titleId:Hc(),descriptionId:Hc(),open:x,onOpenChange:S,onOpenToggle:G.useCallback(()=>S(E=>!E),[S]),modal:d,children:r})};Lee.displayName=_k;var Fee="DialogTrigger",zee=G.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=Id(Fee,r),l=hi(t,o.triggerRef);return m.jsx(bn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":qB(o.open),...n,ref:l,onClick:Rr(e.onClick,o.onOpenToggle)})});zee.displayName=Fee;var UB="DialogPortal",[Y1e,Bee]=Mee(UB,{forceMount:void 0}),$ee=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:o}=e,l=Id(UB,t);return m.jsx(Y1e,{scope:t,forceMount:r,children:G.Children.map(n,d=>m.jsx(ys,{present:r||l.open,children:m.jsx(_b,{asChild:!0,container:o,children:d})}))})};$ee.displayName=UB;var hO="DialogOverlay",Uee=G.forwardRef((e,t)=>{const r=Bee(hO,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,l=Id(hO,e.__scopeDialog);return l.modal?m.jsx(ys,{present:n||l.open,children:m.jsx(Q1e,{...o,ref:t})}):null});Uee.displayName=hO;var J1e=$m("DialogOverlay.RemoveScroll"),Q1e=G.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=Id(hO,r);return m.jsx(RT,{as:J1e,allowPinchZoom:!0,shards:[o.contentRef],children:m.jsx(bn.div,{"data-state":qB(o.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),lv="DialogContent",Vee=G.forwardRef((e,t)=>{const r=Bee(lv,e.__scopeDialog),{forceMount:n=r.forceMount,...o}=e,l=Id(lv,e.__scopeDialog);return m.jsx(ys,{present:n||l.open,children:l.modal?m.jsx(eSe,{...o,ref:t}):m.jsx(tSe,{...o,ref:t})})});Vee.displayName=lv;var eSe=G.forwardRef((e,t)=>{const r=Id(lv,e.__scopeDialog),n=G.useRef(null),o=hi(t,r.contentRef,n);return G.useEffect(()=>{const l=n.current;if(l)return vk(l)},[]),m.jsx(qee,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(e.onCloseAutoFocus,l=>{var d;l.preventDefault(),(d=r.triggerRef.current)==null||d.focus()}),onPointerDownOutside:Rr(e.onPointerDownOutside,l=>{const d=l.detail.originalEvent,i=d.button===0&&d.ctrlKey===!0;(d.button===2||i)&&l.preventDefault()}),onFocusOutside:Rr(e.onFocusOutside,l=>l.preventDefault())})}),tSe=G.forwardRef((e,t)=>{const r=Id(lv,e.__scopeDialog),n=G.useRef(!1),o=G.useRef(!1);return m.jsx(qee,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,l),l.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),l.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:l=>{var g,x;(g=e.onInteractOutside)==null||g.call(e,l),l.defaultPrevented||(n.current=!0,l.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const d=l.target;((x=r.triggerRef.current)==null?void 0:x.contains(d))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&o.current&&l.preventDefault()}})}),qee=G.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:l,...d}=e,i=Id(lv,r),g=G.useRef(null),x=hi(t,g);return gk(),m.jsxs(m.Fragment,{children:[m.jsx(kT,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:l,children:m.jsx(Ev,{role:"dialog",id:i.contentId,"aria-describedby":i.descriptionId,"aria-labelledby":i.titleId,"data-state":qB(i.open),...d,ref:x,onDismiss:()=>i.onOpenChange(!1)})}),m.jsxs(m.Fragment,{children:[m.jsx(nSe,{titleId:i.titleId}),m.jsx(aSe,{contentRef:g,descriptionId:i.descriptionId})]})]})}),VB="DialogTitle",Wee=G.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=Id(VB,r);return m.jsx(bn.h2,{id:o.titleId,...n,ref:t})});Wee.displayName=VB;var Gee="DialogDescription",Hee=G.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=Id(Gee,r);return m.jsx(bn.p,{id:o.descriptionId,...n,ref:t})});Hee.displayName=Gee;var Kee="DialogClose",Zee=G.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,o=Id(Kee,r);return m.jsx(bn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,()=>o.onOpenChange(!1))})});Zee.displayName=Kee;function qB(e){return e?"open":"closed"}var Xee="DialogTitleWarning",[rSe,Yee]=Jme(Xee,{contentName:lv,titleName:VB,docsSlug:"dialog"}),nSe=({titleId:e})=>{const t=Yee(Xee),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return G.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},iSe="DialogDescriptionWarning",aSe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Yee(iSe).contentName}}.`;return G.useEffect(()=>{var l;const o=(l=e.current)==null?void 0:l.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},WB=Lee,GB=zee,HB=$ee,jT=Uee,NT=Vee,MT=Wee,DT=Hee,xk=Zee;const Jee=WB,oSe=GB,sSe=HB,Qee=G.forwardRef(({className:e,...t},r)=>m.jsx(jT,{className:_r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Qee.displayName=jT.displayName;const lSe=xb("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),KB=G.forwardRef(({side:e="right",className:t,children:r,...n},o)=>m.jsxs(sSe,{children:[m.jsx(Qee,{}),m.jsxs(NT,{ref:o,className:_r(lSe({side:e}),t),...n,children:[r,m.jsxs(xk,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[m.jsx(ju,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));KB.displayName=NT.displayName;const cSe=G.forwardRef(({className:e,...t},r)=>m.jsx(MT,{ref:r,className:_r("text-lg font-semibold text-foreground",e),...t}));cSe.displayName=MT.displayName;const uSe=G.forwardRef(({className:e,...t},r)=>m.jsx(DT,{ref:r,className:_r("text-sm text-muted-foreground",e),...t}));uSe.displayName=DT.displayName;var ete={exports:{}},tte={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0=G;function dSe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var hSe=typeof Object.is=="function"?Object.is:dSe,fSe=M0.useState,pSe=M0.useEffect,mSe=M0.useLayoutEffect,gSe=M0.useDebugValue;function ySe(e,t){var r=t(),n=fSe({inst:{value:r,getSnapshot:t}}),o=n[0].inst,l=n[1];return mSe(function(){o.value=r,o.getSnapshot=t,LM(o)&&l({inst:o})},[e,r,t]),pSe(function(){return LM(o)&&l({inst:o}),e(function(){LM(o)&&l({inst:o})})},[e]),gSe(r),r}function LM(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!hSe(e,r)}catch{return!0}}function vSe(e,t){return t()}var _Se=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?vSe:ySe;tte.useSyncExternalStore=M0.useSyncExternalStore!==void 0?M0.useSyncExternalStore:_Se;ete.exports=tte;var rte=ete.exports;function xSe(){return rte.useSyncExternalStore(bSe,()=>!0,()=>!1)}function bSe(){return()=>{}}var ZB="Avatar",[wSe,Aet]=Ks(ZB),[SSe,nte]=wSe(ZB),ite=G.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[o,l]=G.useState("idle");return m.jsx(SSe,{scope:r,imageLoadingStatus:o,onImageLoadingStatusChange:l,children:m.jsx(bn.span,{...n,ref:t})})});ite.displayName=ZB;var ate="AvatarImage",ote=G.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:o=()=>{},...l}=e,d=nte(ate,r),i=ESe(n,l),g=Io(x=>{o(x),d.onImageLoadingStatusChange(x)});return ko(()=>{i!=="idle"&&g(i)},[i,g]),i==="loaded"?m.jsx(bn.img,{...l,ref:t,src:n}):null});ote.displayName=ate;var ste="AvatarFallback",lte=G.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...o}=e,l=nte(ste,r),[d,i]=G.useState(n===void 0);return G.useEffect(()=>{if(n!==void 0){const g=window.setTimeout(()=>i(!0),n);return()=>window.clearTimeout(g)}},[n]),d&&l.imageLoadingStatus!=="loaded"?m.jsx(bn.span,{...o,ref:t}):null});lte.displayName=ste;function PW(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ESe(e,{referrerPolicy:t,crossOrigin:r}){const n=xSe(),o=G.useRef(null),l=n?(o.current||(o.current=new window.Image),o.current):null,[d,i]=G.useState(()=>PW(l,e));return ko(()=>{i(PW(l,e))},[l,e]),ko(()=>{const g=E=>()=>{i(E)};if(!l)return;const x=g("loaded"),S=g("error");return l.addEventListener("load",x),l.addEventListener("error",S),t&&(l.referrerPolicy=t),typeof r=="string"&&(l.crossOrigin=r),()=>{l.removeEventListener("load",x),l.removeEventListener("error",S)}},[l,r,t]),d}var cte=ite,ute=ote,dte=lte;const qm=G.forwardRef(({className:e,...t},r)=>m.jsx(cte,{ref:r,className:_r("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));qm.displayName=cte.displayName;const Wm=G.forwardRef(({className:e,...t},r)=>m.jsx(ute,{ref:r,className:_r("aspect-square h-full w-full",e),...t}));Wm.displayName=ute.displayName;const Gm=G.forwardRef(({className:e,...t},r)=>m.jsx(dte,{ref:r,className:_r("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Gm.displayName=dte.displayName;const ui=e=>typeof e=="string",aS=()=>{let e,t;const r=new Promise((n,o)=>{e=n,t=o});return r.resolve=e,r.reject=t,r},CW=e=>e==null?"":""+e,TSe=(e,t,r)=>{e.forEach(n=>{t[n]&&(r[n]=t[n])})},ASe=/###/g,OW=e=>e&&e.indexOf("###")>-1?e.replace(ASe,"."):e,IW=e=>!e||ui(e),WS=(e,t,r)=>{const n=ui(t)?t.split("."):t;let o=0;for(;o<n.length-1;){if(IW(e))return{};const l=OW(n[o]);!e[l]&&r&&(e[l]=new r),Object.prototype.hasOwnProperty.call(e,l)?e=e[l]:e={},++o}return IW(e)?{}:{obj:e,k:OW(n[o])}},kW=(e,t,r)=>{const{obj:n,k:o}=WS(e,t,Object);if(n!==void 0||t.length===1){n[o]=r;return}let l=t[t.length-1],d=t.slice(0,t.length-1),i=WS(e,d,Object);for(;i.obj===void 0&&d.length;)l=`${d[d.length-1]}.${l}`,d=d.slice(0,d.length-1),i=WS(e,d,Object),i!=null&&i.obj&&typeof i.obj[`${i.k}.${l}`]<"u"&&(i.obj=void 0);i.obj[`${i.k}.${l}`]=r},PSe=(e,t,r,n)=>{const{obj:o,k:l}=WS(e,t,Object);o[l]=o[l]||[],o[l].push(r)},fO=(e,t)=>{const{obj:r,k:n}=WS(e,t);if(r&&Object.prototype.hasOwnProperty.call(r,n))return r[n]},CSe=(e,t,r)=>{const n=fO(e,r);return n!==void 0?n:fO(t,r)},hte=(e,t,r)=>{for(const n in t)n!=="__proto__"&&n!=="constructor"&&(n in e?ui(e[n])||e[n]instanceof String||ui(t[n])||t[n]instanceof String?r&&(e[n]=t[n]):hte(e[n],t[n],r):e[n]=t[n]);return e},mx=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var OSe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const ISe=e=>ui(e)?e.replace(/[&<>"'\/]/g,t=>OSe[t]):e;class kSe{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const r=this.regExpMap.get(t);if(r!==void 0)return r;const n=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,n),this.regExpQueue.push(t),n}}const RSe=[" ",",","?","!",";"],jSe=new kSe(20),NSe=(e,t,r)=>{t=t||"",r=r||"";const n=RSe.filter(d=>t.indexOf(d)<0&&r.indexOf(d)<0);if(n.length===0)return!0;const o=jSe.getRegExp(`(${n.map(d=>d==="?"?"\\?":d).join("|")})`);let l=!o.test(e);if(!l){const d=e.indexOf(r);d>0&&!o.test(e.substring(0,d))&&(l=!0)}return l},c3=(e,t,r=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const n=t.split(r);let o=e;for(let l=0;l<n.length;){if(!o||typeof o!="object")return;let d,i="";for(let g=l;g<n.length;++g)if(g!==l&&(i+=r),i+=n[g],d=o[i],d!==void 0){if(["string","number","boolean"].indexOf(typeof d)>-1&&g<n.length-1)continue;l+=g-l+1;break}o=d}return o},PE=e=>e==null?void 0:e.replace("_","-"),MSe={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var r,n;(n=(r=console==null?void 0:console[e])==null?void 0:r.apply)==null||n.call(r,console,t)}};class pO{constructor(t,r={}){this.init(t,r)}init(t,r={}){this.prefix=r.prefix||"i18next:",this.logger=t||MSe,this.options=r,this.debug=r.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,r,n,o){return o&&!this.debug?null:(ui(t[0])&&(t[0]=`${n}${this.prefix} ${t[0]}`),this.logger[r](t))}create(t){return new pO(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new pO(this.logger,t)}}var dh=new pO;let bk=class{constructor(){this.observers={}}on(t,r){return t.split(" ").forEach(n=>{this.observers[n]||(this.observers[n]=new Map);const o=this.observers[n].get(r)||0;this.observers[n].set(r,o+1)}),this}off(t,r){if(this.observers[t]){if(!r){delete this.observers[t];return}this.observers[t].delete(r)}}emit(t,...r){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([o,l])=>{for(let d=0;d<l;d++)o(...r)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([o,l])=>{for(let d=0;d<l;d++)o.apply(o,[t,...r])})}};class RW extends bk{constructor(t,r={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const r=this.options.ns.indexOf(t);r>-1&&this.options.ns.splice(r,1)}getResource(t,r,n,o={}){var x,S;const l=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,d=o.ignoreJSONStructure!==void 0?o.ignoreJSONStructure:this.options.ignoreJSONStructure;let i;t.indexOf(".")>-1?i=t.split("."):(i=[t,r],n&&(Array.isArray(n)?i.push(...n):ui(n)&&l?i.push(...n.split(l)):i.push(n)));const g=fO(this.data,i);return!g&&!r&&!n&&t.indexOf(".")>-1&&(t=i[0],r=i[1],n=i.slice(2).join(".")),g||!d||!ui(n)?g:c3((S=(x=this.data)==null?void 0:x[t])==null?void 0:S[r],n,l)}addResource(t,r,n,o,l={silent:!1}){const d=l.keySeparator!==void 0?l.keySeparator:this.options.keySeparator;let i=[t,r];n&&(i=i.concat(d?n.split(d):n)),t.indexOf(".")>-1&&(i=t.split("."),o=r,r=i[1]),this.addNamespaces(r),kW(this.data,i,o),l.silent||this.emit("added",t,r,n,o)}addResources(t,r,n,o={silent:!1}){for(const l in n)(ui(n[l])||Array.isArray(n[l]))&&this.addResource(t,r,l,n[l],{silent:!0});o.silent||this.emit("added",t,r,n)}addResourceBundle(t,r,n,o,l,d={silent:!1,skipCopy:!1}){let i=[t,r];t.indexOf(".")>-1&&(i=t.split("."),o=n,n=r,r=i[1]),this.addNamespaces(r);let g=fO(this.data,i)||{};d.skipCopy||(n=JSON.parse(JSON.stringify(n))),o?hte(g,n,l):g={...g,...n},kW(this.data,i,g),d.silent||this.emit("added",t,r,n)}removeResourceBundle(t,r){this.hasResourceBundle(t,r)&&delete this.data[t][r],this.removeNamespaces(r),this.emit("removed",t,r)}hasResourceBundle(t,r){return this.getResource(t,r)!==void 0}getResourceBundle(t,r){return r||(r=this.options.defaultNS),this.getResource(t,r)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const r=this.getDataByLanguage(t);return!!(r&&Object.keys(r)||[]).find(o=>r[o]&&Object.keys(r[o]).length>0)}toJSON(){return this.data}}var fte={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,r,n,o){return e.forEach(l=>{var d;t=((d=this.processors[l])==null?void 0:d.process(t,r,n,o))??t}),t}};const pte=Symbol("i18next/PATH_KEY");function DSe(){const e=[],t=Object.create(null);let r;return t.get=(n,o)=>{var l;return(l=r==null?void 0:r.revoke)==null||l.call(r),o===pte?e:(e.push(o),r=Proxy.revocable(n,t),r.proxy)},Proxy.revocable(Object.create(null),t).proxy}function u3(e,t){const{[pte]:r}=e(DSe());return r.join((t==null?void 0:t.keySeparator)??".")}const jW={},FM=e=>!ui(e)&&typeof e!="boolean"&&typeof e!="number";class mO extends bk{constructor(t,r={}){super(),TSe(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=r,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=dh.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,r={interpolation:{}}){const n={...r};if(t==null)return!1;const o=this.resolve(t,n);if((o==null?void 0:o.res)===void 0)return!1;const l=FM(o.res);return!(n.returnObjects===!1&&l)}extractFromKey(t,r){let n=r.nsSeparator!==void 0?r.nsSeparator:this.options.nsSeparator;n===void 0&&(n=":");const o=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator;let l=r.ns||this.options.defaultNS||[];const d=n&&t.indexOf(n)>-1,i=!this.options.userDefinedKeySeparator&&!r.keySeparator&&!this.options.userDefinedNsSeparator&&!r.nsSeparator&&!NSe(t,n,o);if(d&&!i){const g=t.match(this.interpolator.nestingRegexp);if(g&&g.length>0)return{key:t,namespaces:ui(l)?[l]:l};const x=t.split(n);(n!==o||n===o&&this.options.ns.indexOf(x[0])>-1)&&(l=x.shift()),t=x.join(o)}return{key:t,namespaces:ui(l)?[l]:l}}translate(t,r,n){let o=typeof r=="object"?{...r}:r;if(typeof o!="object"&&this.options.overloadTranslationOptionHandler&&(o=this.options.overloadTranslationOptionHandler(arguments)),typeof o=="object"&&(o={...o}),o||(o={}),t==null)return"";typeof t=="function"&&(t=u3(t,{...this.options,...o})),Array.isArray(t)||(t=[String(t)]);const l=o.returnDetails!==void 0?o.returnDetails:this.options.returnDetails,d=o.keySeparator!==void 0?o.keySeparator:this.options.keySeparator,{key:i,namespaces:g}=this.extractFromKey(t[t.length-1],o),x=g[g.length-1];let S=o.nsSeparator!==void 0?o.nsSeparator:this.options.nsSeparator;S===void 0&&(S=":");const E=o.lng||this.language,A=o.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((E==null?void 0:E.toLowerCase())==="cimode")return A?l?{res:`${x}${S}${i}`,usedKey:i,exactUsedKey:i,usedLng:E,usedNS:x,usedParams:this.getUsedParamsDetails(o)}:`${x}${S}${i}`:l?{res:i,usedKey:i,exactUsedKey:i,usedLng:E,usedNS:x,usedParams:this.getUsedParamsDetails(o)}:i;const C=this.resolve(t,o);let N=C==null?void 0:C.res;const k=(C==null?void 0:C.usedKey)||i,R=(C==null?void 0:C.exactUsedKey)||i,L=["[object Number]","[object Function]","[object RegExp]"],j=o.joinArrays!==void 0?o.joinArrays:this.options.joinArrays,F=!this.i18nFormat||this.i18nFormat.handleAsObject,B=o.count!==void 0&&!ui(o.count),U=mO.hasDefaultValue(o),Z=B?this.pluralResolver.getSuffix(E,o.count,o):"",X=o.ordinal&&B?this.pluralResolver.getSuffix(E,o.count,{ordinal:!1}):"",te=B&&!o.ordinal&&o.count===0,se=te&&o[`defaultValue${this.options.pluralSeparator}zero`]||o[`defaultValue${Z}`]||o[`defaultValue${X}`]||o.defaultValue;let oe=N;F&&!N&&U&&(oe=se);const ne=FM(oe),ee=Object.prototype.toString.apply(oe);if(F&&oe&&ne&&L.indexOf(ee)<0&&!(ui(j)&&Array.isArray(oe))){if(!o.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const ie=this.options.returnedObjectHandler?this.options.returnedObjectHandler(k,oe,{...o,ns:g}):`key '${i} (${this.language})' returned an object instead of string.`;return l?(C.res=ie,C.usedParams=this.getUsedParamsDetails(o),C):ie}if(d){const ie=Array.isArray(oe),he=ie?[]:{},Se=ie?R:k;for(const Ce in oe)if(Object.prototype.hasOwnProperty.call(oe,Ce)){const fe=`${Se}${d}${Ce}`;U&&!N?he[Ce]=this.translate(fe,{...o,defaultValue:FM(se)?se[Ce]:void 0,joinArrays:!1,ns:g}):he[Ce]=this.translate(fe,{...o,joinArrays:!1,ns:g}),he[Ce]===fe&&(he[Ce]=oe[Ce])}N=he}}else if(F&&ui(j)&&Array.isArray(N))N=N.join(j),N&&(N=this.extendTranslation(N,t,o,n));else{let ie=!1,he=!1;!this.isValidLookup(N)&&U&&(ie=!0,N=se),this.isValidLookup(N)||(he=!0,N=i);const Ce=(o.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&he?void 0:N,fe=U&&se!==N&&this.options.updateMissing;if(he||ie||fe){if(this.logger.log(fe?"updateKey":"missingKey",E,x,i,fe?se:N),d){const ye=this.resolve(i,{...o,keySeparator:!1});ye&&ye.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _e=[];const be=this.languageUtils.getFallbackCodes(this.options.fallbackLng,o.lng||this.language);if(this.options.saveMissingTo==="fallback"&&be&&be[0])for(let ye=0;ye<be.length;ye++)_e.push(be[ye]);else this.options.saveMissingTo==="all"?_e=this.languageUtils.toResolveHierarchy(o.lng||this.language):_e.push(o.lng||this.language);const Pe=(ye,ge,ke)=>{var He;const Qe=U&&ke!==N?ke:Ce;this.options.missingKeyHandler?this.options.missingKeyHandler(ye,x,ge,Qe,fe,o):(He=this.backendConnector)!=null&&He.saveMissing&&this.backendConnector.saveMissing(ye,x,ge,Qe,fe,o),this.emit("missingKey",ye,x,ge,N)};this.options.saveMissing&&(this.options.saveMissingPlurals&&B?_e.forEach(ye=>{const ge=this.pluralResolver.getSuffixes(ye,o);te&&o[`defaultValue${this.options.pluralSeparator}zero`]&&ge.indexOf(`${this.options.pluralSeparator}zero`)<0&&ge.push(`${this.options.pluralSeparator}zero`),ge.forEach(ke=>{Pe([ye],i+ke,o[`defaultValue${ke}`]||se)})}):Pe(_e,i,se))}N=this.extendTranslation(N,t,o,C,n),he&&N===i&&this.options.appendNamespaceToMissingKey&&(N=`${x}${S}${i}`),(he||ie)&&this.options.parseMissingKeyHandler&&(N=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${x}${S}${i}`:i,ie?N:void 0,o))}return l?(C.res=N,C.usedParams=this.getUsedParamsDetails(o),C):N}extendTranslation(t,r,n,o,l){var g,x;if((g=this.i18nFormat)!=null&&g.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...n},n.lng||this.language||o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init({...n,interpolation:{...this.options.interpolation,...n.interpolation}});const S=ui(t)&&(((x=n==null?void 0:n.interpolation)==null?void 0:x.skipOnVariables)!==void 0?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let E;if(S){const C=t.match(this.interpolator.nestingRegexp);E=C&&C.length}let A=n.replace&&!ui(n.replace)?n.replace:n;if(this.options.interpolation.defaultVariables&&(A={...this.options.interpolation.defaultVariables,...A}),t=this.interpolator.interpolate(t,A,n.lng||this.language||o.usedLng,n),S){const C=t.match(this.interpolator.nestingRegexp),N=C&&C.length;E<N&&(n.nest=!1)}!n.lng&&o&&o.res&&(n.lng=this.language||o.usedLng),n.nest!==!1&&(t=this.interpolator.nest(t,(...C)=>(l==null?void 0:l[0])===C[0]&&!n.context?(this.logger.warn(`It seems you are nesting recursively key: ${C[0]} in key: ${r[0]}`),null):this.translate(...C,r),n)),n.interpolation&&this.interpolator.reset()}const d=n.postProcess||this.options.postProcess,i=ui(d)?[d]:d;return t!=null&&(i!=null&&i.length)&&n.applyPostProcessor!==!1&&(t=fte.handle(i,t,r,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...o,usedParams:this.getUsedParamsDetails(n)},...n}:n,this)),t}resolve(t,r={}){let n,o,l,d,i;return ui(t)&&(t=[t]),t.forEach(g=>{if(this.isValidLookup(n))return;const x=this.extractFromKey(g,r),S=x.key;o=S;let E=x.namespaces;this.options.fallbackNS&&(E=E.concat(this.options.fallbackNS));const A=r.count!==void 0&&!ui(r.count),C=A&&!r.ordinal&&r.count===0,N=r.context!==void 0&&(ui(r.context)||typeof r.context=="number")&&r.context!=="",k=r.lngs?r.lngs:this.languageUtils.toResolveHierarchy(r.lng||this.language,r.fallbackLng);E.forEach(R=>{var L,j;this.isValidLookup(n)||(i=R,!jW[`${k[0]}-${R}`]&&((L=this.utils)!=null&&L.hasLoadedNamespace)&&!((j=this.utils)!=null&&j.hasLoadedNamespace(i))&&(jW[`${k[0]}-${R}`]=!0,this.logger.warn(`key "${o}" for languages "${k.join(", ")}" won't get resolved as namespace "${i}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),k.forEach(F=>{var Z;if(this.isValidLookup(n))return;d=F;const B=[S];if((Z=this.i18nFormat)!=null&&Z.addLookupKeys)this.i18nFormat.addLookupKeys(B,S,F,R,r);else{let X;A&&(X=this.pluralResolver.getSuffix(F,r.count,r));const te=`${this.options.pluralSeparator}zero`,se=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(A&&(r.ordinal&&X.indexOf(se)===0&&B.push(S+X.replace(se,this.options.pluralSeparator)),B.push(S+X),C&&B.push(S+te)),N){const oe=`${S}${this.options.contextSeparator||"_"}${r.context}`;B.push(oe),A&&(r.ordinal&&X.indexOf(se)===0&&B.push(oe+X.replace(se,this.options.pluralSeparator)),B.push(oe+X),C&&B.push(oe+te))}}let U;for(;U=B.pop();)this.isValidLookup(n)||(l=U,n=this.getResource(F,R,U,r))}))})}),{res:n,usedKey:o,exactUsedKey:l,usedLng:d,usedNS:i}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,r,n,o={}){var l;return(l=this.i18nFormat)!=null&&l.getResource?this.i18nFormat.getResource(t,r,n,o):this.resourceStore.getResource(t,r,n,o)}getUsedParamsDetails(t={}){const r=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],n=t.replace&&!ui(t.replace);let o=n?t.replace:t;if(n&&typeof t.count<"u"&&(o.count=t.count),this.options.interpolation.defaultVariables&&(o={...this.options.interpolation.defaultVariables,...o}),!n){o={...o};for(const l of r)delete o[l]}return o}static hasDefaultValue(t){const r="defaultValue";for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&r===n.substring(0,r.length)&&t[n]!==void 0)return!0;return!1}}class NW{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=dh.create("languageUtils")}getScriptPartFromCode(t){if(t=PE(t),!t||t.indexOf("-")<0)return null;const r=t.split("-");return r.length===2||(r.pop(),r[r.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(r.join("-"))}getLanguagePartFromCode(t){if(t=PE(t),!t||t.indexOf("-")<0)return t;const r=t.split("-");return this.formatLanguageCode(r[0])}formatLanguageCode(t){if(ui(t)&&t.indexOf("-")>-1){let r;try{r=Intl.getCanonicalLocales(t)[0]}catch{}return r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let r;return t.forEach(n=>{if(r)return;const o=this.formatLanguageCode(n);(!this.options.supportedLngs||this.isSupportedCode(o))&&(r=o)}),!r&&this.options.supportedLngs&&t.forEach(n=>{if(r)return;const o=this.getScriptPartFromCode(n);if(this.isSupportedCode(o))return r=o;const l=this.getLanguagePartFromCode(n);if(this.isSupportedCode(l))return r=l;r=this.options.supportedLngs.find(d=>{if(d===l)return d;if(!(d.indexOf("-")<0&&l.indexOf("-")<0)&&(d.indexOf("-")>0&&l.indexOf("-")<0&&d.substring(0,d.indexOf("-"))===l||d.indexOf(l)===0&&l.length>1))return d})}),r||(r=this.getFallbackCodes(this.options.fallbackLng)[0]),r}getFallbackCodes(t,r){if(!t)return[];if(typeof t=="function"&&(t=t(r)),ui(t)&&(t=[t]),Array.isArray(t))return t;if(!r)return t.default||[];let n=t[r];return n||(n=t[this.getScriptPartFromCode(r)]),n||(n=t[this.formatLanguageCode(r)]),n||(n=t[this.getLanguagePartFromCode(r)]),n||(n=t.default),n||[]}toResolveHierarchy(t,r){const n=this.getFallbackCodes((r===!1?[]:r)||this.options.fallbackLng||[],t),o=[],l=d=>{d&&(this.isSupportedCode(d)?o.push(d):this.logger.warn(`rejecting language code not found in supportedLngs: ${d}`))};return ui(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&l(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&l(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&l(this.getLanguagePartFromCode(t))):ui(t)&&l(this.formatLanguageCode(t)),n.forEach(d=>{o.indexOf(d)<0&&l(this.formatLanguageCode(d))}),o}}const MW={zero:0,one:1,two:2,few:3,many:4,other:5},DW={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class LSe{constructor(t,r={}){this.languageUtils=t,this.options=r,this.logger=dh.create("pluralResolver"),this.pluralRulesCache={}}addRule(t,r){this.rules[t]=r}clearCache(){this.pluralRulesCache={}}getRule(t,r={}){const n=PE(t==="dev"?"en":t),o=r.ordinal?"ordinal":"cardinal",l=JSON.stringify({cleanedCode:n,type:o});if(l in this.pluralRulesCache)return this.pluralRulesCache[l];let d;try{d=new Intl.PluralRules(n,{type:o})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),DW;if(!t.match(/-|_/))return DW;const g=this.languageUtils.getLanguagePartFromCode(t);d=this.getRule(g,r)}return this.pluralRulesCache[l]=d,d}needsPlural(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),(n==null?void 0:n.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,r,n={}){return this.getSuffixes(t,n).map(o=>`${r}${o}`)}getSuffixes(t,r={}){let n=this.getRule(t,r);return n||(n=this.getRule("dev",r)),n?n.resolvedOptions().pluralCategories.sort((o,l)=>MW[o]-MW[l]).map(o=>`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${o}`):[]}getSuffix(t,r,n={}){const o=this.getRule(t,n);return o?`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${o.select(r)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",r,n))}}const LW=(e,t,r,n=".",o=!0)=>{let l=CSe(e,t,r);return!l&&o&&ui(r)&&(l=c3(e,r,n),l===void 0&&(l=c3(t,r,n))),l},zM=e=>e.replace(/\$/g,"$$$$");class FSe{constructor(t={}){var r;this.logger=dh.create("interpolator"),this.options=t,this.format=((r=t==null?void 0:t.interpolation)==null?void 0:r.format)||(n=>n),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:r,escapeValue:n,useRawValueToEscape:o,prefix:l,prefixEscaped:d,suffix:i,suffixEscaped:g,formatSeparator:x,unescapeSuffix:S,unescapePrefix:E,nestingPrefix:A,nestingPrefixEscaped:C,nestingSuffix:N,nestingSuffixEscaped:k,nestingOptionsSeparator:R,maxReplaces:L,alwaysFormat:j}=t.interpolation;this.escape=r!==void 0?r:ISe,this.escapeValue=n!==void 0?n:!0,this.useRawValueToEscape=o!==void 0?o:!1,this.prefix=l?mx(l):d||"{{",this.suffix=i?mx(i):g||"}}",this.formatSeparator=x||",",this.unescapePrefix=S?"":E||"-",this.unescapeSuffix=this.unescapePrefix?"":S||"",this.nestingPrefix=A?mx(A):C||mx("$t("),this.nestingSuffix=N?mx(N):k||mx(")"),this.nestingOptionsSeparator=R||",",this.maxReplaces=L||1e3,this.alwaysFormat=j!==void 0?j:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(r,n)=>(r==null?void 0:r.source)===n?(r.lastIndex=0,r):new RegExp(n,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,r,n,o){var C;let l,d,i;const g=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},x=N=>{if(N.indexOf(this.formatSeparator)<0){const j=LW(r,g,N,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(j,void 0,n,{...o,...r,interpolationkey:N}):j}const k=N.split(this.formatSeparator),R=k.shift().trim(),L=k.join(this.formatSeparator).trim();return this.format(LW(r,g,R,this.options.keySeparator,this.options.ignoreJSONStructure),L,n,{...o,...r,interpolationkey:R})};this.resetRegExp();const S=(o==null?void 0:o.missingInterpolationHandler)||this.options.missingInterpolationHandler,E=((C=o==null?void 0:o.interpolation)==null?void 0:C.skipOnVariables)!==void 0?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:N=>zM(N)},{regex:this.regexp,safeValue:N=>this.escapeValue?zM(this.escape(N)):zM(N)}].forEach(N=>{for(i=0;l=N.regex.exec(t);){const k=l[1].trim();if(d=x(k),d===void 0)if(typeof S=="function"){const L=S(t,l,o);d=ui(L)?L:""}else if(o&&Object.prototype.hasOwnProperty.call(o,k))d="";else if(E){d=l[0];continue}else this.logger.warn(`missed to pass in variable ${k} for interpolating ${t}`),d="";else!ui(d)&&!this.useRawValueToEscape&&(d=CW(d));const R=N.safeValue(d);if(t=t.replace(l[0],R),E?(N.regex.lastIndex+=d.length,N.regex.lastIndex-=l[0].length):N.regex.lastIndex=0,i++,i>=this.maxReplaces)break}}),t}nest(t,r,n={}){let o,l,d;const i=(g,x)=>{const S=this.nestingOptionsSeparator;if(g.indexOf(S)<0)return g;const E=g.split(new RegExp(`${S}[ ]*{`));let A=`{${E[1]}`;g=E[0],A=this.interpolate(A,d);const C=A.match(/'/g),N=A.match(/"/g);(((C==null?void 0:C.length)??0)%2===0&&!N||N.length%2!==0)&&(A=A.replace(/'/g,'"'));try{d=JSON.parse(A),x&&(d={...x,...d})}catch(k){return this.logger.warn(`failed parsing options string in nesting for key ${g}`,k),`${g}${S}${A}`}return d.defaultValue&&d.defaultValue.indexOf(this.prefix)>-1&&delete d.defaultValue,g};for(;o=this.nestingRegexp.exec(t);){let g=[];d={...n},d=d.replace&&!ui(d.replace)?d.replace:d,d.applyPostProcessor=!1,delete d.defaultValue;const x=/{.*}/.test(o[1])?o[1].lastIndexOf("}")+1:o[1].indexOf(this.formatSeparator);if(x!==-1&&(g=o[1].slice(x).split(this.formatSeparator).map(S=>S.trim()).filter(Boolean),o[1]=o[1].slice(0,x)),l=r(i.call(this,o[1].trim(),d),d),l&&o[0]===t&&!ui(l))return l;ui(l)||(l=CW(l)),l||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${t}`),l=""),g.length&&(l=g.reduce((S,E)=>this.format(S,E,n.lng,{...n,interpolationkey:o[1].trim()}),l.trim())),t=t.replace(o[0],l),this.regexp.lastIndex=0}return t}}const zSe=e=>{let t=e.toLowerCase().trim();const r={};if(e.indexOf("(")>-1){const n=e.split("(");t=n[0].toLowerCase().trim();const o=n[1].substring(0,n[1].length-1);t==="currency"&&o.indexOf(":")<0?r.currency||(r.currency=o.trim()):t==="relativetime"&&o.indexOf(":")<0?r.range||(r.range=o.trim()):o.split(";").forEach(d=>{if(d){const[i,...g]=d.split(":"),x=g.join(":").trim().replace(/^'+|'+$/g,""),S=i.trim();r[S]||(r[S]=x),x==="false"&&(r[S]=!1),x==="true"&&(r[S]=!0),isNaN(x)||(r[S]=parseInt(x,10))}})}return{formatName:t,formatOptions:r}},FW=e=>{const t={};return(r,n,o)=>{let l=o;o&&o.interpolationkey&&o.formatParams&&o.formatParams[o.interpolationkey]&&o[o.interpolationkey]&&(l={...l,[o.interpolationkey]:void 0});const d=n+JSON.stringify(l);let i=t[d];return i||(i=e(PE(n),o),t[d]=i),i(r)}},BSe=e=>(t,r,n)=>e(PE(r),n)(t);class $Se{constructor(t={}){this.logger=dh.create("formatter"),this.options=t,this.init(t)}init(t,r={interpolation:{}}){this.formatSeparator=r.interpolation.formatSeparator||",";const n=r.cacheInBuiltFormats?FW:BSe;this.formats={number:n((o,l)=>{const d=new Intl.NumberFormat(o,{...l});return i=>d.format(i)}),currency:n((o,l)=>{const d=new Intl.NumberFormat(o,{...l,style:"currency"});return i=>d.format(i)}),datetime:n((o,l)=>{const d=new Intl.DateTimeFormat(o,{...l});return i=>d.format(i)}),relativetime:n((o,l)=>{const d=new Intl.RelativeTimeFormat(o,{...l});return i=>d.format(i,l.range||"day")}),list:n((o,l)=>{const d=new Intl.ListFormat(o,{...l});return i=>d.format(i)})}}add(t,r){this.formats[t.toLowerCase().trim()]=r}addCached(t,r){this.formats[t.toLowerCase().trim()]=FW(r)}format(t,r,n,o={}){const l=r.split(this.formatSeparator);if(l.length>1&&l[0].indexOf("(")>1&&l[0].indexOf(")")<0&&l.find(i=>i.indexOf(")")>-1)){const i=l.findIndex(g=>g.indexOf(")")>-1);l[0]=[l[0],...l.splice(1,i)].join(this.formatSeparator)}return l.reduce((i,g)=>{var E;const{formatName:x,formatOptions:S}=zSe(g);if(this.formats[x]){let A=i;try{const C=((E=o==null?void 0:o.formatParams)==null?void 0:E[o.interpolationkey])||{},N=C.locale||C.lng||o.locale||o.lng||n;A=this.formats[x](i,N,{...S,...o,...C})}catch(C){this.logger.warn(C)}return A}else this.logger.warn(`there was no format function for ${x}`);return i},t)}}const USe=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class VSe extends bk{constructor(t,r,n,o={}){var l,d;super(),this.backend=t,this.store=r,this.services=n,this.languageUtils=n.languageUtils,this.options=o,this.logger=dh.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=o.maxParallelReads||10,this.readingCalls=0,this.maxRetries=o.maxRetries>=0?o.maxRetries:5,this.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,this.state={},this.queue=[],(d=(l=this.backend)==null?void 0:l.init)==null||d.call(l,n,o.backend,o)}queueLoad(t,r,n,o){const l={},d={},i={},g={};return t.forEach(x=>{let S=!0;r.forEach(E=>{const A=`${x}|${E}`;!n.reload&&this.store.hasResourceBundle(x,E)?this.state[A]=2:this.state[A]<0||(this.state[A]===1?d[A]===void 0&&(d[A]=!0):(this.state[A]=1,S=!1,d[A]===void 0&&(d[A]=!0),l[A]===void 0&&(l[A]=!0),g[E]===void 0&&(g[E]=!0)))}),S||(i[x]=!0)}),(Object.keys(l).length||Object.keys(d).length)&&this.queue.push({pending:d,pendingCount:Object.keys(d).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(l),pending:Object.keys(d),toLoadLanguages:Object.keys(i),toLoadNamespaces:Object.keys(g)}}loaded(t,r,n){const o=t.split("|"),l=o[0],d=o[1];r&&this.emit("failedLoading",l,d,r),!r&&n&&this.store.addResourceBundle(l,d,n,void 0,void 0,{skipCopy:!0}),this.state[t]=r?-1:2,r&&n&&(this.state[t]=0);const i={};this.queue.forEach(g=>{PSe(g.loaded,[l],d),USe(g,t),r&&g.errors.push(r),g.pendingCount===0&&!g.done&&(Object.keys(g.loaded).forEach(x=>{i[x]||(i[x]={});const S=g.loaded[x];S.length&&S.forEach(E=>{i[x][E]===void 0&&(i[x][E]=!0)})}),g.done=!0,g.errors.length?g.callback(g.errors):g.callback())}),this.emit("loaded",i),this.queue=this.queue.filter(g=>!g.done)}read(t,r,n,o=0,l=this.retryTimeout,d){if(!t.length)return d(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:r,fcName:n,tried:o,wait:l,callback:d});return}this.readingCalls++;const i=(x,S)=>{if(this.readingCalls--,this.waitingReads.length>0){const E=this.waitingReads.shift();this.read(E.lng,E.ns,E.fcName,E.tried,E.wait,E.callback)}if(x&&S&&o<this.maxRetries){setTimeout(()=>{this.read.call(this,t,r,n,o+1,l*2,d)},l);return}d(x,S)},g=this.backend[n].bind(this.backend);if(g.length===2){try{const x=g(t,r);x&&typeof x.then=="function"?x.then(S=>i(null,S)).catch(i):i(null,x)}catch(x){i(x)}return}return g(t,r,i)}prepareLoading(t,r,n={},o){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),o&&o();ui(t)&&(t=this.languageUtils.toResolveHierarchy(t)),ui(r)&&(r=[r]);const l=this.queueLoad(t,r,n,o);if(!l.toLoad.length)return l.pending.length||o(),null;l.toLoad.forEach(d=>{this.loadOne(d)})}load(t,r,n){this.prepareLoading(t,r,{},n)}reload(t,r,n){this.prepareLoading(t,r,{reload:!0},n)}loadOne(t,r=""){const n=t.split("|"),o=n[0],l=n[1];this.read(o,l,"read",void 0,void 0,(d,i)=>{d&&this.logger.warn(`${r}loading namespace ${l} for language ${o} failed`,d),!d&&i&&this.logger.log(`${r}loaded namespace ${l} for language ${o}`,i),this.loaded(t,d,i)})}saveMissing(t,r,n,o,l,d={},i=()=>{}){var g,x,S,E,A;if((x=(g=this.services)==null?void 0:g.utils)!=null&&x.hasLoadedNamespace&&!((E=(S=this.services)==null?void 0:S.utils)!=null&&E.hasLoadedNamespace(r))){this.logger.warn(`did not save key "${n}" as the namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(n==null||n==="")){if((A=this.backend)!=null&&A.create){const C={...d,isUpdate:l},N=this.backend.create.bind(this.backend);if(N.length<6)try{let k;N.length===5?k=N(t,r,n,o,C):k=N(t,r,n,o),k&&typeof k.then=="function"?k.then(R=>i(null,R)).catch(i):i(null,k)}catch(k){i(k)}else N(t,r,n,o,i,C)}!t||!t[0]||this.store.addResource(t[0],r,n,o)}}}const zW=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),ui(e[1])&&(t.defaultValue=e[1]),ui(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const r=e[3]||e[2];Object.keys(r).forEach(n=>{t[n]=r[n]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),BW=e=>{var t,r;return ui(e.ns)&&(e.ns=[e.ns]),ui(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),ui(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((r=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:r.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},RP=()=>{},qSe=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(r=>{typeof e[r]=="function"&&(e[r]=e[r].bind(e))})};class GS extends bk{constructor(t={},r){if(super(),this.options=BW(t),this.services={},this.logger=dh,this.modules={external:[]},qSe(this),r&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,r),this;setTimeout(()=>{this.init(t,r)},0)}}init(t={},r){this.isInitializing=!0,typeof t=="function"&&(r=t,t={}),t.defaultNS==null&&t.ns&&(ui(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const n=zW();this.options={...n,...this.options,...BW(t)},this.options.interpolation={...n.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator);const o=x=>x?typeof x=="function"?new x:x:null;if(!this.options.isClone){this.modules.logger?dh.init(o(this.modules.logger),this.options):dh.init(null,this.options);let x;this.modules.formatter?x=this.modules.formatter:x=$Se;const S=new NW(this.options);this.store=new RW(this.options.resources,this.options);const E=this.services;E.logger=dh,E.resourceStore=this.store,E.languageUtils=S,E.pluralResolver=new LSe(S,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),x&&(!this.options.interpolation.format||this.options.interpolation.format===n.interpolation.format)&&(E.formatter=o(x),E.formatter.init&&E.formatter.init(E,this.options),this.options.interpolation.format=E.formatter.format.bind(E.formatter)),E.interpolator=new FSe(this.options),E.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},E.backendConnector=new VSe(o(this.modules.backend),E.resourceStore,E,this.options),E.backendConnector.on("*",(C,...N)=>{this.emit(C,...N)}),this.modules.languageDetector&&(E.languageDetector=o(this.modules.languageDetector),E.languageDetector.init&&E.languageDetector.init(E,this.options.detection,this.options)),this.modules.i18nFormat&&(E.i18nFormat=o(this.modules.i18nFormat),E.i18nFormat.init&&E.i18nFormat.init(this)),this.translator=new mO(this.services,this.options),this.translator.on("*",(C,...N)=>{this.emit(C,...N)}),this.modules.external.forEach(C=>{C.init&&C.init(this)})}if(this.format=this.options.interpolation.format,r||(r=RP),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const x=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);x.length>0&&x[0]!=="dev"&&(this.options.lng=x[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(x=>{this[x]=(...S)=>this.store[x](...S)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(x=>{this[x]=(...S)=>(this.store[x](...S),this)});const i=aS(),g=()=>{const x=(S,E)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),i.resolve(E),r(S,E)};if(this.languages&&!this.isInitialized)return x(null,this.t.bind(this));this.changeLanguage(this.options.lng,x)};return this.options.resources||!this.options.initAsync?g():setTimeout(g,0),i}loadResources(t,r=RP){var l,d;let n=r;const o=ui(t)?t:this.language;if(typeof t=="function"&&(n=t),!this.options.resources||this.options.partialBundledLanguages){if((o==null?void 0:o.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return n();const i=[],g=x=>{if(!x||x==="cimode")return;this.services.languageUtils.toResolveHierarchy(x).forEach(E=>{E!=="cimode"&&i.indexOf(E)<0&&i.push(E)})};o?g(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(S=>g(S)),(d=(l=this.options.preload)==null?void 0:l.forEach)==null||d.call(l,x=>g(x)),this.services.backendConnector.load(i,this.options.ns,x=>{!x&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),n(x)})}else n(null)}reloadResources(t,r,n){const o=aS();return typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=void 0),t||(t=this.languages),r||(r=this.options.ns),n||(n=RP),this.services.backendConnector.reload(t,r,l=>{o.resolve(),n(l)}),o}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&fte.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let r=0;r<this.languages.length;r++){const n=this.languages[r];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,r){this.isLanguageChangingTo=t;const n=aS();this.emit("languageChanging",t);const o=i=>{this.language=i,this.languages=this.services.languageUtils.toResolveHierarchy(i),this.resolvedLanguage=void 0,this.setResolvedLanguage(i)},l=(i,g)=>{g?this.isLanguageChangingTo===t&&(o(g),this.translator.changeLanguage(g),this.isLanguageChangingTo=void 0,this.emit("languageChanged",g),this.logger.log("languageChanged",g)):this.isLanguageChangingTo=void 0,n.resolve((...x)=>this.t(...x)),r&&r(i,(...x)=>this.t(...x))},d=i=>{var S,E;!t&&!i&&this.services.languageDetector&&(i=[]);const g=ui(i)?i:i&&i[0],x=this.store.hasLanguageSomeTranslations(g)?g:this.services.languageUtils.getBestMatchFromCodes(ui(i)?[i]:i);x&&(this.language||o(x),this.translator.language||this.translator.changeLanguage(x),(E=(S=this.services.languageDetector)==null?void 0:S.cacheUserLanguage)==null||E.call(S,x)),this.loadResources(x,A=>{l(A,x)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?d(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(d):this.services.languageDetector.detect(d):d(t),n}getFixedT(t,r,n){const o=(l,d,...i)=>{let g;typeof d!="object"?g=this.options.overloadTranslationOptionHandler([l,d].concat(i)):g={...d},g.lng=g.lng||o.lng,g.lngs=g.lngs||o.lngs,g.ns=g.ns||o.ns,g.keyPrefix!==""&&(g.keyPrefix=g.keyPrefix||n||o.keyPrefix);const x=this.options.keySeparator||".";let S;return g.keyPrefix&&Array.isArray(l)?S=l.map(E=>(typeof E=="function"&&(E=u3(E,{...this.options,...d})),`${g.keyPrefix}${x}${E}`)):(typeof l=="function"&&(l=u3(l,{...this.options,...d})),S=g.keyPrefix?`${g.keyPrefix}${x}${l}`:l),this.t(S,g)};return ui(t)?o.lng=t:o.lngs=t,o.ns=r,o.keyPrefix=n,o}t(...t){var r;return(r=this.translator)==null?void 0:r.translate(...t)}exists(...t){var r;return(r=this.translator)==null?void 0:r.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,r={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const n=r.lng||this.resolvedLanguage||this.languages[0],o=this.options?this.options.fallbackLng:!1,l=this.languages[this.languages.length-1];if(n.toLowerCase()==="cimode")return!0;const d=(i,g)=>{const x=this.services.backendConnector.state[`${i}|${g}`];return x===-1||x===0||x===2};if(r.precheck){const i=r.precheck(this,d);if(i!==void 0)return i}return!!(this.hasResourceBundle(n,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||d(n,t)&&(!o||d(l,t)))}loadNamespaces(t,r){const n=aS();return this.options.ns?(ui(t)&&(t=[t]),t.forEach(o=>{this.options.ns.indexOf(o)<0&&this.options.ns.push(o)}),this.loadResources(o=>{n.resolve(),r&&r(o)}),n):(r&&r(),Promise.resolve())}loadLanguages(t,r){const n=aS();ui(t)&&(t=[t]);const o=this.options.preload||[],l=t.filter(d=>o.indexOf(d)<0&&this.services.languageUtils.isSupportedCode(d));return l.length?(this.options.preload=o.concat(l),this.loadResources(d=>{n.resolve(),r&&r(d)}),n):(r&&r(),Promise.resolve())}dir(t){var o,l;if(t||(t=this.resolvedLanguage||(((o=this.languages)==null?void 0:o.length)>0?this.languages[0]:this.language)),!t)return"rtl";try{const d=new Intl.Locale(t);if(d&&d.getTextInfo){const i=d.getTextInfo();if(i&&i.direction)return i.direction}}catch{}const r=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],n=((l=this.services)==null?void 0:l.languageUtils)||new NW(zW());return t.toLowerCase().indexOf("-latn")>1?"ltr":r.indexOf(n.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},r){const n=new GS(t,r);return n.createInstance=GS.createInstance,n}cloneInstance(t={},r=RP){const n=t.forkResourceStore;n&&delete t.forkResourceStore;const o={...this.options,...t,isClone:!0},l=new GS(o);if((t.debug!==void 0||t.prefix!==void 0)&&(l.logger=l.logger.clone(t)),["store","services","language"].forEach(i=>{l[i]=this[i]}),l.services={...this.services},l.services.utils={hasLoadedNamespace:l.hasLoadedNamespace.bind(l)},n){const i=Object.keys(this.store.data).reduce((g,x)=>(g[x]={...this.store.data[x]},g[x]=Object.keys(g[x]).reduce((S,E)=>(S[E]={...g[x][E]},S),g[x]),g),{});l.store=new RW(i,o),l.services.resourceStore=l.store}return l.translator=new mO(l.services,o),l.translator.on("*",(i,...g)=>{l.emit(i,...g)}),l.init(o,r),l.translator.options=o,l.translator.backendConnector.services.utils={hasLoadedNamespace:l.hasLoadedNamespace.bind(l)},l}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Kl=GS.createInstance();Kl.createInstance;Kl.dir;Kl.init;Kl.loadResources;Kl.reloadResources;Kl.use;Kl.changeLanguage;Kl.getFixedT;Kl.t;Kl.exists;Kl.setDefaultNamespace;Kl.hasLoadedNamespace;Kl.loadNamespaces;Kl.loadLanguages;const WSe=(e,t,r,n)=>{var l,d,i,g;const o=[r,{code:t,...n||{}}];if((d=(l=e==null?void 0:e.services)==null?void 0:l.logger)!=null&&d.forward)return e.services.logger.forward(o,"warn","react-i18next::",!0);cv(o[0])&&(o[0]=`react-i18next:: ${o[0]}`),(g=(i=e==null?void 0:e.services)==null?void 0:i.logger)!=null&&g.warn?e.services.logger.warn(...o):console!=null&&console.warn&&console.warn(...o)},$W={},mte=(e,t,r,n)=>{cv(r)&&$W[r]||(cv(r)&&($W[r]=new Date),WSe(e,t,r,n))},gte=(e,t)=>()=>{if(e.isInitialized)t();else{const r=()=>{setTimeout(()=>{e.off("initialized",r)},0),t()};e.on("initialized",r)}},d3=(e,t,r)=>{e.loadNamespaces(t,gte(e,r))},UW=(e,t,r,n)=>{if(cv(r)&&(r=[r]),e.options.preload&&e.options.preload.indexOf(t)>-1)return d3(e,r,n);r.forEach(o=>{e.options.ns.indexOf(o)<0&&e.options.ns.push(o)}),e.loadLanguages(t,gte(e,n))},GSe=(e,t,r={})=>!t.languages||!t.languages.length?(mte(t,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:t.languages}),!0):t.hasLoadedNamespace(e,{lng:r.lng,precheck:(n,o)=>{if(r.bindI18n&&r.bindI18n.indexOf("languageChanging")>-1&&n.services.backendConnector.backend&&n.isLanguageChangingTo&&!o(n.isLanguageChangingTo,e))return!1}}),cv=e=>typeof e=="string",HSe=e=>typeof e=="object"&&e!==null,KSe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,ZSe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},XSe=e=>ZSe[e],YSe=e=>e.replace(KSe,XSe);let h3={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:YSe};const JSe=(e={})=>{h3={...h3,...e}},QSe=()=>h3;let yte;const eEe=e=>{yte=e},tEe=()=>yte,rEe={type:"3rdParty",init(e){JSe(e.options.react),eEe(e)}},nEe=G.createContext();class iEe{constructor(){this.usedNamespaces={}}addUsedNamespaces(t){t.forEach(r=>{this.usedNamespaces[r]||(this.usedNamespaces[r]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const aEe=(e,t)=>cv(t)?t:HSe(t)&&cv(t.defaultValue)?t.defaultValue:Array.isArray(e)?e[e.length-1]:e,oEe={t:aEe,ready:!1},sEe=()=>()=>{},Ki=(e,t={})=>{var se,oe,ne;const{i18n:r}=t,{i18n:n,defaultNS:o}=G.useContext(nEe)||{},l=r||n||tEe();l&&!l.reportNamespaces&&(l.reportNamespaces=new iEe),l||mte(l,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const d=G.useMemo(()=>{var ee;return{...QSe(),...(ee=l==null?void 0:l.options)==null?void 0:ee.react,...t}},[l,t]),{useSuspense:i,keyPrefix:g}=d,x=o||((se=l==null?void 0:l.options)==null?void 0:se.defaultNS),S=cv(x)?[x]:x||["translation"],E=G.useMemo(()=>S,S);(ne=(oe=l==null?void 0:l.reportNamespaces)==null?void 0:oe.addUsedNamespaces)==null||ne.call(oe,E);const A=G.useRef(0),C=G.useCallback(ee=>{if(!l)return sEe;const{bindI18n:ie,bindI18nStore:he}=d,Se=()=>{A.current+=1,ee()};return ie&&l.on(ie,Se),he&&l.store.on(he,Se),()=>{ie&&ie.split(" ").forEach(Ce=>l.off(Ce,Se)),he&&he.split(" ").forEach(Ce=>l.store.off(Ce,Se))}},[l,d]),N=G.useRef(),k=G.useCallback(()=>{if(!l)return oEe;const ee=!!(l.isInitialized||l.initializedStoreOnce)&&E.every(_e=>GSe(_e,l,d)),ie=t.lng||l.language,he=A.current,Se=N.current;if(Se&&Se.ready===ee&&Se.lng===ie&&Se.keyPrefix===g&&Se.revision===he)return Se;const fe={t:l.getFixedT(ie,d.nsMode==="fallback"?E:E[0],g),ready:ee,lng:ie,keyPrefix:g,revision:he};return N.current=fe,fe},[l,E,g,d,t.lng]),[R,L]=G.useState(0),{t:j,ready:F}=rte.useSyncExternalStore(C,k,k);G.useEffect(()=>{if(l&&!F&&!i){const ee=()=>L(ie=>ie+1);t.lng?UW(l,t.lng,E,ee):d3(l,E,ee)}},[l,t.lng,E,F,i,R]);const B=l||{},U=G.useRef(null),Z=G.useRef(),X=ee=>{const ie=Object.getOwnPropertyDescriptors(ee);ie.__original&&delete ie.__original;const he=Object.create(Object.getPrototypeOf(ee),ie);if(!Object.prototype.hasOwnProperty.call(he,"__original"))try{Object.defineProperty(he,"__original",{value:ee,writable:!1,enumerable:!1,configurable:!1})}catch{}return he},te=G.useMemo(()=>{const ee=B,ie=ee==null?void 0:ee.language;let he=ee;ee&&(U.current&&U.current.__original===ee?Z.current!==ie?(he=X(ee),U.current=he,Z.current=ie):he=U.current:(he=X(ee),U.current=he,Z.current=ie));const Se=[j,he,F];return Se.t=j,Se.i18n=he,Se.ready=F,Se},[j,B,F,B.resolvedLanguage,B.language,B.languages]);if(l&&i&&!F)throw new Promise(ee=>{const ie=()=>ee();t.lng?UW(l,t.lng,E,ie):d3(l,E,ie)});return te};var lEe=G.createContext(void 0);function LT(e){const t=G.useContext(lEe);return e||t||"ltr"}var BM="rovingFocusGroup.onEntryFocus",cEe={bubbles:!1,cancelable:!0},FT="RovingFocusGroup",[f3,vte,uEe]=YI(FT),[dEe,wk]=Ks(FT,[uEe]),[hEe,fEe]=dEe(FT),_te=G.forwardRef((e,t)=>m.jsx(f3.Provider,{scope:e.__scopeRovingFocusGroup,children:m.jsx(f3.Slot,{scope:e.__scopeRovingFocusGroup,children:m.jsx(pEe,{...e,ref:t})})}));_te.displayName=FT;var pEe=G.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:o=!1,dir:l,currentTabStopId:d,defaultCurrentTabStopId:i,onCurrentTabStopIdChange:g,onEntryFocus:x,preventScrollOnEntryFocus:S=!1,...E}=e,A=G.useRef(null),C=hi(t,A),N=LT(l),[k,R]=Ru({prop:d,defaultProp:i??null,onChange:g,caller:FT}),[L,j]=G.useState(!1),F=Io(x),B=vte(r),U=G.useRef(!1),[Z,X]=G.useState(0);return G.useEffect(()=>{const te=A.current;if(te)return te.addEventListener(BM,F),()=>te.removeEventListener(BM,F)},[F]),m.jsx(hEe,{scope:r,orientation:n,dir:N,loop:o,currentTabStopId:k,onItemFocus:G.useCallback(te=>R(te),[R]),onItemShiftTab:G.useCallback(()=>j(!0),[]),onFocusableItemAdd:G.useCallback(()=>X(te=>te+1),[]),onFocusableItemRemove:G.useCallback(()=>X(te=>te-1),[]),children:m.jsx(bn.div,{tabIndex:L||Z===0?-1:0,"data-orientation":n,...E,ref:C,style:{outline:"none",...e.style},onMouseDown:Rr(e.onMouseDown,()=>{U.current=!0}),onFocus:Rr(e.onFocus,te=>{const se=!U.current;if(te.target===te.currentTarget&&se&&!L){const oe=new CustomEvent(BM,cEe);if(te.currentTarget.dispatchEvent(oe),!oe.defaultPrevented){const ne=B().filter(Ce=>Ce.focusable),ee=ne.find(Ce=>Ce.active),ie=ne.find(Ce=>Ce.id===k),Se=[ee,ie,...ne].filter(Boolean).map(Ce=>Ce.ref.current);wte(Se,S)}}U.current=!1}),onBlur:Rr(e.onBlur,()=>j(!1))})})}),xte="RovingFocusGroupItem",bte=G.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:o=!1,tabStopId:l,children:d,...i}=e,g=Hc(),x=l||g,S=fEe(xte,r),E=S.currentTabStopId===x,A=vte(r),{onFocusableItemAdd:C,onFocusableItemRemove:N,currentTabStopId:k}=S;return G.useEffect(()=>{if(n)return C(),()=>N()},[n,C,N]),m.jsx(f3.ItemSlot,{scope:r,id:x,focusable:n,active:o,children:m.jsx(bn.span,{tabIndex:E?0:-1,"data-orientation":S.orientation,...i,ref:t,onMouseDown:Rr(e.onMouseDown,R=>{n?S.onItemFocus(x):R.preventDefault()}),onFocus:Rr(e.onFocus,()=>S.onItemFocus(x)),onKeyDown:Rr(e.onKeyDown,R=>{if(R.key==="Tab"&&R.shiftKey){S.onItemShiftTab();return}if(R.target!==R.currentTarget)return;const L=yEe(R,S.orientation,S.dir);if(L!==void 0){if(R.metaKey||R.ctrlKey||R.altKey||R.shiftKey)return;R.preventDefault();let F=A().filter(B=>B.focusable).map(B=>B.ref.current);if(L==="last")F.reverse();else if(L==="prev"||L==="next"){L==="prev"&&F.reverse();const B=F.indexOf(R.currentTarget);F=S.loop?vEe(F,B+1):F.slice(B+1)}setTimeout(()=>wte(F))}}),children:typeof d=="function"?d({isCurrentTabStop:E,hasTabStop:k!=null}):d})})});bte.displayName=xte;var mEe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function gEe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function yEe(e,t,r){const n=gEe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return mEe[n]}function wte(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function vEe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var Ste=_te,Ete=bte,p3=["Enter"," "],_Ee=["ArrowDown","PageUp","Home"],Tte=["ArrowUp","PageDown","End"],xEe=[..._Ee,...Tte],bEe={ltr:[...p3,"ArrowRight"],rtl:[...p3,"ArrowLeft"]},wEe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},zT="Menu",[CE,SEe,EEe]=YI(zT),[Av,Ate]=Ks(zT,[EEe,eg,wk]),Sk=eg(),Pte=wk(),[TEe,Pv]=Av(zT),[AEe,BT]=Av(zT),Cte=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:o,onOpenChange:l,modal:d=!0}=e,i=Sk(t),[g,x]=G.useState(null),S=G.useRef(!1),E=Io(l),A=LT(o);return G.useEffect(()=>{const C=()=>{S.current=!0,document.addEventListener("pointerdown",N,{capture:!0,once:!0}),document.addEventListener("pointermove",N,{capture:!0,once:!0})},N=()=>S.current=!1;return document.addEventListener("keydown",C,{capture:!0}),()=>{document.removeEventListener("keydown",C,{capture:!0}),document.removeEventListener("pointerdown",N,{capture:!0}),document.removeEventListener("pointermove",N,{capture:!0})}},[]),m.jsx(ak,{...i,children:m.jsx(TEe,{scope:t,open:r,onOpenChange:E,content:g,onContentChange:x,children:m.jsx(AEe,{scope:t,onClose:G.useCallback(()=>E(!1),[E]),isUsingKeyboardRef:S,dir:A,modal:d,children:n})})})};Cte.displayName=zT;var PEe="MenuAnchor",XB=G.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,o=Sk(r);return m.jsx(OT,{...o,...n,ref:t})});XB.displayName=PEe;var YB="MenuPortal",[CEe,Ote]=Av(YB,{forceMount:void 0}),Ite=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:o}=e,l=Pv(YB,t);return m.jsx(CEe,{scope:t,forceMount:r,children:m.jsx(ys,{present:r||l.open,children:m.jsx(_b,{asChild:!0,container:o,children:n})})})};Ite.displayName=YB;var Tu="MenuContent",[OEe,JB]=Av(Tu),kte=G.forwardRef((e,t)=>{const r=Ote(Tu,e.__scopeMenu),{forceMount:n=r.forceMount,...o}=e,l=Pv(Tu,e.__scopeMenu),d=BT(Tu,e.__scopeMenu);return m.jsx(CE.Provider,{scope:e.__scopeMenu,children:m.jsx(ys,{present:n||l.open,children:m.jsx(CE.Slot,{scope:e.__scopeMenu,children:d.modal?m.jsx(IEe,{...o,ref:t}):m.jsx(kEe,{...o,ref:t})})})})}),IEe=G.forwardRef((e,t)=>{const r=Pv(Tu,e.__scopeMenu),n=G.useRef(null),o=hi(t,n);return G.useEffect(()=>{const l=n.current;if(l)return vk(l)},[]),m.jsx(QB,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Rr(e.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),kEe=G.forwardRef((e,t)=>{const r=Pv(Tu,e.__scopeMenu);return m.jsx(QB,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),REe=$m("MenuContent.ScrollLock"),QB=G.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:o,onOpenAutoFocus:l,onCloseAutoFocus:d,disableOutsidePointerEvents:i,onEntryFocus:g,onEscapeKeyDown:x,onPointerDownOutside:S,onFocusOutside:E,onInteractOutside:A,onDismiss:C,disableOutsideScroll:N,...k}=e,R=Pv(Tu,r),L=BT(Tu,r),j=Sk(r),F=Pte(r),B=SEe(r),[U,Z]=G.useState(null),X=G.useRef(null),te=hi(t,X,R.onContentChange),se=G.useRef(0),oe=G.useRef(""),ne=G.useRef(0),ee=G.useRef(null),ie=G.useRef("right"),he=G.useRef(0),Se=N?RT:G.Fragment,Ce=N?{as:REe,allowPinchZoom:!0}:void 0,fe=be=>{var Xe,ft;const Pe=oe.current+be,ye=B().filter(ze=>!ze.disabled),ge=document.activeElement,ke=(Xe=ye.find(ze=>ze.ref.current===ge))==null?void 0:Xe.textValue,Qe=ye.map(ze=>ze.textValue),He=qEe(Qe,Pe,ke),$e=(ft=ye.find(ze=>ze.textValue===He))==null?void 0:ft.ref.current;(function ze(ut){oe.current=ut,window.clearTimeout(se.current),ut!==""&&(se.current=window.setTimeout(()=>ze(""),1e3))})(Pe),$e&&setTimeout(()=>$e.focus())};G.useEffect(()=>()=>window.clearTimeout(se.current),[]),gk();const _e=G.useCallback(be=>{var ye,ge;return ie.current===((ye=ee.current)==null?void 0:ye.side)&&GEe(be,(ge=ee.current)==null?void 0:ge.area)},[]);return m.jsx(OEe,{scope:r,searchRef:oe,onItemEnter:G.useCallback(be=>{_e(be)&&be.preventDefault()},[_e]),onItemLeave:G.useCallback(be=>{var Pe;_e(be)||((Pe=X.current)==null||Pe.focus(),Z(null))},[_e]),onTriggerLeave:G.useCallback(be=>{_e(be)&&be.preventDefault()},[_e]),pointerGraceTimerRef:ne,onPointerGraceIntentChange:G.useCallback(be=>{ee.current=be},[]),children:m.jsx(Se,{...Ce,children:m.jsx(kT,{asChild:!0,trapped:o,onMountAutoFocus:Rr(l,be=>{var Pe;be.preventDefault(),(Pe=X.current)==null||Pe.focus({preventScroll:!0})}),onUnmountAutoFocus:d,children:m.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:i,onEscapeKeyDown:x,onPointerDownOutside:S,onFocusOutside:E,onInteractOutside:A,onDismiss:C,children:m.jsx(Ste,{asChild:!0,...F,dir:L.dir,orientation:"vertical",loop:n,currentTabStopId:U,onCurrentTabStopIdChange:Z,onEntryFocus:Rr(g,be=>{L.isUsingKeyboardRef.current||be.preventDefault()}),preventScrollOnEntryFocus:!0,children:m.jsx(ok,{role:"menu","aria-orientation":"vertical","data-state":Hte(R.open),"data-radix-menu-content":"",dir:L.dir,...j,...k,ref:te,style:{outline:"none",...k.style},onKeyDown:Rr(k.onKeyDown,be=>{const ye=be.target.closest("[data-radix-menu-content]")===be.currentTarget,ge=be.ctrlKey||be.altKey||be.metaKey,ke=be.key.length===1;ye&&(be.key==="Tab"&&be.preventDefault(),!ge&&ke&&fe(be.key));const Qe=X.current;if(be.target!==Qe||!xEe.includes(be.key))return;be.preventDefault();const $e=B().filter(Xe=>!Xe.disabled).map(Xe=>Xe.ref.current);Tte.includes(be.key)&&$e.reverse(),UEe($e)}),onBlur:Rr(e.onBlur,be=>{be.currentTarget.contains(be.target)||(window.clearTimeout(se.current),oe.current="")}),onPointerMove:Rr(e.onPointerMove,OE(be=>{const Pe=be.target,ye=he.current!==be.clientX;if(be.currentTarget.contains(Pe)&&ye){const ge=be.clientX>he.current?"right":"left";ie.current=ge,he.current=be.clientX}}))})})})})})})});kte.displayName=Tu;var jEe="MenuGroup",e4=G.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(bn.div,{role:"group",...n,ref:t})});e4.displayName=jEe;var NEe="MenuLabel",Rte=G.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(bn.div,{...n,ref:t})});Rte.displayName=NEe;var gO="MenuItem",VW="menu.itemSelect",Ek=G.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...o}=e,l=G.useRef(null),d=BT(gO,e.__scopeMenu),i=JB(gO,e.__scopeMenu),g=hi(t,l),x=G.useRef(!1),S=()=>{const E=l.current;if(!r&&E){const A=new CustomEvent(VW,{bubbles:!0,cancelable:!0});E.addEventListener(VW,C=>n==null?void 0:n(C),{once:!0}),iB(E,A),A.defaultPrevented?x.current=!1:d.onClose()}};return m.jsx(jte,{...o,ref:g,disabled:r,onClick:Rr(e.onClick,S),onPointerDown:E=>{var A;(A=e.onPointerDown)==null||A.call(e,E),x.current=!0},onPointerUp:Rr(e.onPointerUp,E=>{var A;x.current||(A=E.currentTarget)==null||A.click()}),onKeyDown:Rr(e.onKeyDown,E=>{const A=i.searchRef.current!=="";r||A&&E.key===" "||p3.includes(E.key)&&(E.currentTarget.click(),E.preventDefault())})})});Ek.displayName=gO;var jte=G.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:o,...l}=e,d=JB(gO,r),i=Pte(r),g=G.useRef(null),x=hi(t,g),[S,E]=G.useState(!1),[A,C]=G.useState("");return G.useEffect(()=>{const N=g.current;N&&C((N.textContent??"").trim())},[l.children]),m.jsx(CE.ItemSlot,{scope:r,disabled:n,textValue:o??A,children:m.jsx(Ete,{asChild:!0,...i,focusable:!n,children:m.jsx(bn.div,{role:"menuitem","data-highlighted":S?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...l,ref:x,onPointerMove:Rr(e.onPointerMove,OE(N=>{n?d.onItemLeave(N):(d.onItemEnter(N),N.defaultPrevented||N.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Rr(e.onPointerLeave,OE(N=>d.onItemLeave(N))),onFocus:Rr(e.onFocus,()=>E(!0)),onBlur:Rr(e.onBlur,()=>E(!1))})})})}),MEe="MenuCheckboxItem",Nte=G.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...o}=e;return m.jsx(zte,{scope:e.__scopeMenu,checked:r,children:m.jsx(Ek,{role:"menuitemcheckbox","aria-checked":yO(r)?"mixed":r,...o,ref:t,"data-state":r4(r),onSelect:Rr(o.onSelect,()=>n==null?void 0:n(yO(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Nte.displayName=MEe;var Mte="MenuRadioGroup",[DEe,LEe]=Av(Mte,{value:void 0,onValueChange:()=>{}}),Dte=G.forwardRef((e,t)=>{const{value:r,onValueChange:n,...o}=e,l=Io(n);return m.jsx(DEe,{scope:e.__scopeMenu,value:r,onValueChange:l,children:m.jsx(e4,{...o,ref:t})})});Dte.displayName=Mte;var Lte="MenuRadioItem",Fte=G.forwardRef((e,t)=>{const{value:r,...n}=e,o=LEe(Lte,e.__scopeMenu),l=r===o.value;return m.jsx(zte,{scope:e.__scopeMenu,checked:l,children:m.jsx(Ek,{role:"menuitemradio","aria-checked":l,...n,ref:t,"data-state":r4(l),onSelect:Rr(n.onSelect,()=>{var d;return(d=o.onValueChange)==null?void 0:d.call(o,r)},{checkForDefaultPrevented:!1})})})});Fte.displayName=Lte;var t4="MenuItemIndicator",[zte,FEe]=Av(t4,{checked:!1}),Bte=G.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...o}=e,l=FEe(t4,r);return m.jsx(ys,{present:n||yO(l.checked)||l.checked===!0,children:m.jsx(bn.span,{...o,ref:t,"data-state":r4(l.checked)})})});Bte.displayName=t4;var zEe="MenuSeparator",$te=G.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return m.jsx(bn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});$te.displayName=zEe;var BEe="MenuArrow",Ute=G.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,o=Sk(r);return m.jsx(sk,{...o,...n,ref:t})});Ute.displayName=BEe;var $Ee="MenuSub",[Cet,Vte]=Av($Ee),IS="MenuSubTrigger",qte=G.forwardRef((e,t)=>{const r=Pv(IS,e.__scopeMenu),n=BT(IS,e.__scopeMenu),o=Vte(IS,e.__scopeMenu),l=JB(IS,e.__scopeMenu),d=G.useRef(null),{pointerGraceTimerRef:i,onPointerGraceIntentChange:g}=l,x={__scopeMenu:e.__scopeMenu},S=G.useCallback(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return G.useEffect(()=>S,[S]),G.useEffect(()=>{const E=i.current;return()=>{window.clearTimeout(E),g(null)}},[i,g]),m.jsx(XB,{asChild:!0,...x,children:m.jsx(jte,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":o.contentId,"data-state":Hte(r.open),...e,ref:XI(t,o.onTriggerChange),onClick:E=>{var A;(A=e.onClick)==null||A.call(e,E),!(e.disabled||E.defaultPrevented)&&(E.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Rr(e.onPointerMove,OE(E=>{l.onItemEnter(E),!E.defaultPrevented&&!e.disabled&&!r.open&&!d.current&&(l.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{r.onOpenChange(!0),S()},100))})),onPointerLeave:Rr(e.onPointerLeave,OE(E=>{var C,N;S();const A=(C=r.content)==null?void 0:C.getBoundingClientRect();if(A){const k=(N=r.content)==null?void 0:N.dataset.side,R=k==="right",L=R?-5:5,j=A[R?"left":"right"],F=A[R?"right":"left"];l.onPointerGraceIntentChange({area:[{x:E.clientX+L,y:E.clientY},{x:j,y:A.top},{x:F,y:A.top},{x:F,y:A.bottom},{x:j,y:A.bottom}],side:k}),window.clearTimeout(i.current),i.current=window.setTimeout(()=>l.onPointerGraceIntentChange(null),300)}else{if(l.onTriggerLeave(E),E.defaultPrevented)return;l.onPointerGraceIntentChange(null)}})),onKeyDown:Rr(e.onKeyDown,E=>{var C;const A=l.searchRef.current!=="";e.disabled||A&&E.key===" "||bEe[n.dir].includes(E.key)&&(r.onOpenChange(!0),(C=r.content)==null||C.focus(),E.preventDefault())})})})});qte.displayName=IS;var Wte="MenuSubContent",Gte=G.forwardRef((e,t)=>{const r=Ote(Tu,e.__scopeMenu),{forceMount:n=r.forceMount,...o}=e,l=Pv(Tu,e.__scopeMenu),d=BT(Tu,e.__scopeMenu),i=Vte(Wte,e.__scopeMenu),g=G.useRef(null),x=hi(t,g);return m.jsx(CE.Provider,{scope:e.__scopeMenu,children:m.jsx(ys,{present:n||l.open,children:m.jsx(CE.Slot,{scope:e.__scopeMenu,children:m.jsx(QB,{id:i.contentId,"aria-labelledby":i.triggerId,...o,ref:x,align:"start",side:d.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:S=>{var E;d.isUsingKeyboardRef.current&&((E=g.current)==null||E.focus()),S.preventDefault()},onCloseAutoFocus:S=>S.preventDefault(),onFocusOutside:Rr(e.onFocusOutside,S=>{S.target!==i.trigger&&l.onOpenChange(!1)}),onEscapeKeyDown:Rr(e.onEscapeKeyDown,S=>{d.onClose(),S.preventDefault()}),onKeyDown:Rr(e.onKeyDown,S=>{var C;const E=S.currentTarget.contains(S.target),A=wEe[d.dir].includes(S.key);E&&A&&(l.onOpenChange(!1),(C=i.trigger)==null||C.focus(),S.preventDefault())})})})})})});Gte.displayName=Wte;function Hte(e){return e?"open":"closed"}function yO(e){return e==="indeterminate"}function r4(e){return yO(e)?"indeterminate":e?"checked":"unchecked"}function UEe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function VEe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function qEe(e,t,r){const o=t.length>1&&Array.from(t).every(x=>x===t[0])?t[0]:t,l=r?e.indexOf(r):-1;let d=VEe(e,Math.max(l,0));o.length===1&&(d=d.filter(x=>x!==r));const g=d.find(x=>x.toLowerCase().startsWith(o.toLowerCase()));return g!==r?g:void 0}function WEe(e,t){const{x:r,y:n}=e;let o=!1;for(let l=0,d=t.length-1;l<t.length;d=l++){const i=t[l],g=t[d],x=i.x,S=i.y,E=g.x,A=g.y;S>n!=A>n&&r<(E-x)*(n-S)/(A-S)+x&&(o=!o)}return o}function GEe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return WEe(r,t)}function OE(e){return t=>t.pointerType==="mouse"?e(t):void 0}var HEe=Cte,KEe=XB,ZEe=Ite,XEe=kte,YEe=e4,JEe=Rte,QEe=Ek,eTe=Nte,tTe=Dte,rTe=Fte,nTe=Bte,iTe=$te,aTe=Ute,oTe=qte,sTe=Gte,Tk="DropdownMenu",[lTe,Oet]=Ks(Tk,[Ate]),Zl=Ate(),[cTe,Kte]=lTe(Tk),Zte=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:o,defaultOpen:l,onOpenChange:d,modal:i=!0}=e,g=Zl(t),x=G.useRef(null),[S,E]=Ru({prop:o,defaultProp:l??!1,onChange:d,caller:Tk});return m.jsx(cTe,{scope:t,triggerId:Hc(),triggerRef:x,contentId:Hc(),open:S,onOpenChange:E,onOpenToggle:G.useCallback(()=>E(A=>!A),[E]),modal:i,children:m.jsx(HEe,{...g,open:S,onOpenChange:E,dir:n,modal:i,children:r})})};Zte.displayName=Tk;var Xte="DropdownMenuTrigger",Yte=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...o}=e,l=Kte(Xte,r),d=Zl(r);return m.jsx(KEe,{asChild:!0,...d,children:m.jsx(bn.button,{type:"button",id:l.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":l.open?l.contentId:void 0,"data-state":l.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...o,ref:XI(t,l.triggerRef),onPointerDown:Rr(e.onPointerDown,i=>{!n&&i.button===0&&i.ctrlKey===!1&&(l.onOpenToggle(),l.open||i.preventDefault())}),onKeyDown:Rr(e.onKeyDown,i=>{n||(["Enter"," "].includes(i.key)&&l.onOpenToggle(),i.key==="ArrowDown"&&l.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(i.key)&&i.preventDefault())})})})});Yte.displayName=Xte;var uTe="DropdownMenuPortal",Jte=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Zl(t);return m.jsx(ZEe,{...n,...r})};Jte.displayName=uTe;var Qte="DropdownMenuContent",ere=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Kte(Qte,r),l=Zl(r),d=G.useRef(!1);return m.jsx(XEe,{id:o.contentId,"aria-labelledby":o.triggerId,...l,...n,ref:t,onCloseAutoFocus:Rr(e.onCloseAutoFocus,i=>{var g;d.current||(g=o.triggerRef.current)==null||g.focus(),d.current=!1,i.preventDefault()}),onInteractOutside:Rr(e.onInteractOutside,i=>{const g=i.detail.originalEvent,x=g.button===0&&g.ctrlKey===!0,S=g.button===2||x;(!o.modal||S)&&(d.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ere.displayName=Qte;var dTe="DropdownMenuGroup",hTe=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(YEe,{...o,...n,ref:t})});hTe.displayName=dTe;var fTe="DropdownMenuLabel",tre=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(JEe,{...o,...n,ref:t})});tre.displayName=fTe;var pTe="DropdownMenuItem",rre=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(QEe,{...o,...n,ref:t})});rre.displayName=pTe;var mTe="DropdownMenuCheckboxItem",nre=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(eTe,{...o,...n,ref:t})});nre.displayName=mTe;var gTe="DropdownMenuRadioGroup",yTe=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(tTe,{...o,...n,ref:t})});yTe.displayName=gTe;var vTe="DropdownMenuRadioItem",ire=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(rTe,{...o,...n,ref:t})});ire.displayName=vTe;var _Te="DropdownMenuItemIndicator",are=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(nTe,{...o,...n,ref:t})});are.displayName=_Te;var xTe="DropdownMenuSeparator",ore=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(iTe,{...o,...n,ref:t})});ore.displayName=xTe;var bTe="DropdownMenuArrow",wTe=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(aTe,{...o,...n,ref:t})});wTe.displayName=bTe;var STe="DropdownMenuSubTrigger",sre=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(oTe,{...o,...n,ref:t})});sre.displayName=STe;var ETe="DropdownMenuSubContent",lre=G.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,o=Zl(r);return m.jsx(sTe,{...o,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});lre.displayName=ETe;var TTe=Zte,ATe=Yte,PTe=Jte,cre=ere,ure=tre,dre=rre,hre=nre,fre=ire,pre=are,mre=ore,gre=sre,yre=lre;const Cv=TTe,Ov=ATe,CTe=G.forwardRef(({className:e,inset:t,children:r,...n},o)=>m.jsxs(gre,{ref:o,className:_r("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,m.jsx(WY,{className:"ml-auto h-4 w-4"})]}));CTe.displayName=gre.displayName;const OTe=G.forwardRef(({className:e,...t},r)=>m.jsx(yre,{ref:r,className:_r("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));OTe.displayName=yre.displayName;const ng=G.forwardRef(({className:e,sideOffset:t=4,...r},n)=>m.jsx(PTe,{children:m.jsx(cre,{ref:n,sideOffset:t,className:_r("z-[100] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));ng.displayName=cre.displayName;const Ca=G.forwardRef(({className:e,inset:t,...r},n)=>m.jsx(dre,{ref:n,className:_r("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));Ca.displayName=dre.displayName;const ITe=G.forwardRef(({className:e,children:t,checked:r,...n},o)=>m.jsxs(hre,{ref:o,className:_r("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(pre,{children:m.jsx(Tf,{className:"h-4 w-4"})})}),t]}));ITe.displayName=hre.displayName;const kTe=G.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(fre,{ref:n,className:_r("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(pre,{children:m.jsx(tye,{className:"h-2 w-2 fill-current"})})}),t]}));kTe.displayName=fre.displayName;const n4=G.forwardRef(({className:e,inset:t,...r},n)=>m.jsx(ure,{ref:n,className:_r("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));n4.displayName=ure.displayName;const i0=G.forwardRef(({className:e,...t},r)=>m.jsx(mre,{ref:r,className:_r("-mx-1 my-1 h-px bg-muted",e),...t}));i0.displayName=mre.displayName;const i4=()=>{const{user:e}=Di();return wa(),Wi({queryKey:["profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await Ut.from("profiles").select("*").eq("id",e.id).single();if(r)throw r;return t},enabled:!!e})},RTe=()=>{const{user:e}=Di(),{toast:t}=wa(),r=Na();return Xa({mutationFn:async({display_name:n,phone:o,avatar_url:l,language_preference:d})=>{if(!e)throw new Error("User not authenticated");const{data:i,error:g}=await Ut.from("profiles").update({display_name:n,phone:o,avatar_url:l,language_preference:d}).eq("id",e.id).select().single();if(g)throw g;return i},onSuccess:()=>{r.invalidateQueries({queryKey:["profile"]}),t({title:"Success",description:"Profile updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update profile",variant:"destructive"})}})},jTe=()=>{const{user:e}=Di(),t=Na();return Xa({mutationFn:async r=>{if(!e)return;const{error:n}=await Ut.from("profiles").update({language_preference:r}).eq("id",e.id);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]})}})},NTe=()=>{const{user:e}=Di(),{toast:t}=wa();return Xa({mutationFn:async r=>{if(!e)throw new Error("User not authenticated");const n=r.name.split(".").pop(),o=`${Date.now()}.${n}`,l=`${e.id}/${o}`,{error:d}=await Ut.storage.from("avatars").upload(l,r,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=Ut.storage.from("avatars").getPublicUrl(l);return i},onError:()=>{t({title:"Error",description:"Failed to upload avatar",variant:"destructive"})}})},$M=[{code:"en",name:"English",flag:""},{code:"zh",name:"",flag:""},{code:"pt",name:"Portugus",flag:""}],MTe=()=>{const{i18n:e}=Ki(),{user:t}=Di(),r=jTe(),n=$M.find(l=>l.code===e.language)||$M[0],o=l=>{e.changeLanguage(l),t&&r.mutate(l)};return m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsx(lr,{variant:"ghost",size:"icon",title:"Change Language",children:m.jsx(C0,{className:"w-5 h-5"})})}),m.jsx(ng,{align:"end",children:$M.map(l=>m.jsxs(Ca,{onClick:()=>o(l.code),className:`cursor-pointer ${n.code===l.code?"bg-accent":""}`,children:[m.jsx("span",{className:"mr-2",children:l.flag}),m.jsx("span",{children:l.name})]},l.code))})]})},Tc=()=>{const{user:e}=Di(),{data:t,isLoading:r}=Wi({queryKey:["user-roles",e==null?void 0:e.id],queryFn:async()=>{if(!e)return"user";const{data:i,error:g}=await Ut.from("user_roles").select("role").eq("user_id",e.id).single();if(g)throw g;return i.role},enabled:!!e});return{role:t??"user",hasRole:i=>t===i,isAdmin:t==="admin",isSupervisor:t==="supervisor",isMerchant:t==="merchant",isLoading:r}},DTe=xb("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Qn({className:e,variant:t,...r}){return m.jsx("div",{className:_r(DTe({variant:t}),e),...r})}function m3(e,[t,r]){return Math.min(r,Math.max(t,e))}function LTe(e,t){return G.useReducer((r,n)=>t[r][n]??r,e)}var a4="ScrollArea",[vre,Iet]=Ks(a4),[FTe,Mu]=vre(a4),_re=G.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:o,scrollHideDelay:l=600,...d}=e,[i,g]=G.useState(null),[x,S]=G.useState(null),[E,A]=G.useState(null),[C,N]=G.useState(null),[k,R]=G.useState(null),[L,j]=G.useState(0),[F,B]=G.useState(0),[U,Z]=G.useState(!1),[X,te]=G.useState(!1),se=hi(t,ne=>g(ne)),oe=LT(o);return m.jsx(FTe,{scope:r,type:n,dir:oe,scrollHideDelay:l,scrollArea:i,viewport:x,onViewportChange:S,content:E,onContentChange:A,scrollbarX:C,onScrollbarXChange:N,scrollbarXEnabled:U,onScrollbarXEnabledChange:Z,scrollbarY:k,onScrollbarYChange:R,scrollbarYEnabled:X,onScrollbarYEnabledChange:te,onCornerWidthChange:j,onCornerHeightChange:B,children:m.jsx(bn.div,{dir:oe,...d,ref:se,style:{position:"relative","--radix-scroll-area-corner-width":L+"px","--radix-scroll-area-corner-height":F+"px",...e.style}})})});_re.displayName=a4;var xre="ScrollAreaViewport",bre=G.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:o,...l}=e,d=Mu(xre,r),i=G.useRef(null),g=hi(t,i,d.onViewportChange);return m.jsxs(m.Fragment,{children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),m.jsx(bn.div,{"data-radix-scroll-area-viewport":"",...l,ref:g,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...e.style},children:m.jsx("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});bre.displayName=xre;var kh="ScrollAreaScrollbar",o4=G.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(kh,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:d}=o,i=e.orientation==="horizontal";return G.useEffect(()=>(i?l(!0):d(!0),()=>{i?l(!1):d(!1)}),[i,l,d]),o.type==="hover"?m.jsx(zTe,{...n,ref:t,forceMount:r}):o.type==="scroll"?m.jsx(BTe,{...n,ref:t,forceMount:r}):o.type==="auto"?m.jsx(wre,{...n,ref:t,forceMount:r}):o.type==="always"?m.jsx(s4,{...n,ref:t}):null});o4.displayName=kh;var zTe=G.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(kh,e.__scopeScrollArea),[l,d]=G.useState(!1);return G.useEffect(()=>{const i=o.scrollArea;let g=0;if(i){const x=()=>{window.clearTimeout(g),d(!0)},S=()=>{g=window.setTimeout(()=>d(!1),o.scrollHideDelay)};return i.addEventListener("pointerenter",x),i.addEventListener("pointerleave",S),()=>{window.clearTimeout(g),i.removeEventListener("pointerenter",x),i.removeEventListener("pointerleave",S)}}},[o.scrollArea,o.scrollHideDelay]),m.jsx(ys,{present:r||l,children:m.jsx(wre,{"data-state":l?"visible":"hidden",...n,ref:t})})}),BTe=G.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Mu(kh,e.__scopeScrollArea),l=e.orientation==="horizontal",d=Pk(()=>g("SCROLL_END"),100),[i,g]=LTe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return G.useEffect(()=>{if(i==="idle"){const x=window.setTimeout(()=>g("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(x)}},[i,o.scrollHideDelay,g]),G.useEffect(()=>{const x=o.viewport,S=l?"scrollLeft":"scrollTop";if(x){let E=x[S];const A=()=>{const C=x[S];E!==C&&(g("SCROLL"),d()),E=C};return x.addEventListener("scroll",A),()=>x.removeEventListener("scroll",A)}},[o.viewport,l,g,d]),m.jsx(ys,{present:r||i!=="hidden",children:m.jsx(s4,{"data-state":i==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:Rr(e.onPointerEnter,()=>g("POINTER_ENTER")),onPointerLeave:Rr(e.onPointerLeave,()=>g("POINTER_LEAVE"))})})}),wre=G.forwardRef((e,t)=>{const r=Mu(kh,e.__scopeScrollArea),{forceMount:n,...o}=e,[l,d]=G.useState(!1),i=e.orientation==="horizontal",g=Pk(()=>{if(r.viewport){const x=r.viewport.offsetWidth<r.viewport.scrollWidth,S=r.viewport.offsetHeight<r.viewport.scrollHeight;d(i?x:S)}},10);return D0(r.viewport,g),D0(r.content,g),m.jsx(ys,{present:n||l,children:m.jsx(s4,{"data-state":l?"visible":"hidden",...o,ref:t})})}),s4=G.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,o=Mu(kh,e.__scopeScrollArea),l=G.useRef(null),d=G.useRef(0),[i,g]=G.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),x=Pre(i.viewport,i.content),S={...n,sizes:i,onSizesChange:g,hasThumb:x>0&&x<1,onThumbChange:A=>l.current=A,onThumbPointerUp:()=>d.current=0,onThumbPointerDown:A=>d.current=A};function E(A,C){return GTe(A,d.current,i,C)}return r==="horizontal"?m.jsx($Te,{...S,ref:t,onThumbPositionChange:()=>{if(o.viewport&&l.current){const A=o.viewport.scrollLeft,C=qW(A,i,o.dir);l.current.style.transform=`translate3d(${C}px, 0, 0)`}},onWheelScroll:A=>{o.viewport&&(o.viewport.scrollLeft=A)},onDragScroll:A=>{o.viewport&&(o.viewport.scrollLeft=E(A,o.dir))}}):r==="vertical"?m.jsx(UTe,{...S,ref:t,onThumbPositionChange:()=>{if(o.viewport&&l.current){const A=o.viewport.scrollTop,C=qW(A,i);l.current.style.transform=`translate3d(0, ${C}px, 0)`}},onWheelScroll:A=>{o.viewport&&(o.viewport.scrollTop=A)},onDragScroll:A=>{o.viewport&&(o.viewport.scrollTop=E(A))}}):null}),$Te=G.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,l=Mu(kh,e.__scopeScrollArea),[d,i]=G.useState(),g=G.useRef(null),x=hi(t,g,l.onScrollbarXChange);return G.useEffect(()=>{g.current&&i(getComputedStyle(g.current))},[g]),m.jsx(Ere,{"data-orientation":"horizontal",...o,ref:x,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Ak(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.x),onDragScroll:S=>e.onDragScroll(S.x),onWheelScroll:(S,E)=>{if(l.viewport){const A=l.viewport.scrollLeft+S.deltaX;e.onWheelScroll(A),Ore(A,E)&&S.preventDefault()}},onResize:()=>{g.current&&l.viewport&&d&&n({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:g.current.clientWidth,paddingStart:_O(d.paddingLeft),paddingEnd:_O(d.paddingRight)}})}})}),UTe=G.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...o}=e,l=Mu(kh,e.__scopeScrollArea),[d,i]=G.useState(),g=G.useRef(null),x=hi(t,g,l.onScrollbarYChange);return G.useEffect(()=>{g.current&&i(getComputedStyle(g.current))},[g]),m.jsx(Ere,{"data-orientation":"vertical",...o,ref:x,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Ak(r)+"px",...e.style},onThumbPointerDown:S=>e.onThumbPointerDown(S.y),onDragScroll:S=>e.onDragScroll(S.y),onWheelScroll:(S,E)=>{if(l.viewport){const A=l.viewport.scrollTop+S.deltaY;e.onWheelScroll(A),Ore(A,E)&&S.preventDefault()}},onResize:()=>{g.current&&l.viewport&&d&&n({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:g.current.clientHeight,paddingStart:_O(d.paddingTop),paddingEnd:_O(d.paddingBottom)}})}})}),[VTe,Sre]=vre(kh),Ere=G.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:o,onThumbChange:l,onThumbPointerUp:d,onThumbPointerDown:i,onThumbPositionChange:g,onDragScroll:x,onWheelScroll:S,onResize:E,...A}=e,C=Mu(kh,r),[N,k]=G.useState(null),R=hi(t,se=>k(se)),L=G.useRef(null),j=G.useRef(""),F=C.viewport,B=n.content-n.viewport,U=Io(S),Z=Io(g),X=Pk(E,10);function te(se){if(L.current){const oe=se.clientX-L.current.left,ne=se.clientY-L.current.top;x({x:oe,y:ne})}}return G.useEffect(()=>{const se=oe=>{const ne=oe.target;(N==null?void 0:N.contains(ne))&&U(oe,B)};return document.addEventListener("wheel",se,{passive:!1}),()=>document.removeEventListener("wheel",se,{passive:!1})},[F,N,B,U]),G.useEffect(Z,[n,Z]),D0(N,X),D0(C.content,X),m.jsx(VTe,{scope:r,scrollbar:N,hasThumb:o,onThumbChange:Io(l),onThumbPointerUp:Io(d),onThumbPositionChange:Z,onThumbPointerDown:Io(i),children:m.jsx(bn.div,{...A,ref:R,style:{position:"absolute",...A.style},onPointerDown:Rr(e.onPointerDown,se=>{se.button===0&&(se.target.setPointerCapture(se.pointerId),L.current=N.getBoundingClientRect(),j.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",C.viewport&&(C.viewport.style.scrollBehavior="auto"),te(se))}),onPointerMove:Rr(e.onPointerMove,te),onPointerUp:Rr(e.onPointerUp,se=>{const oe=se.target;oe.hasPointerCapture(se.pointerId)&&oe.releasePointerCapture(se.pointerId),document.body.style.webkitUserSelect=j.current,C.viewport&&(C.viewport.style.scrollBehavior=""),L.current=null})})})}),vO="ScrollAreaThumb",Tre=G.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=Sre(vO,e.__scopeScrollArea);return m.jsx(ys,{present:r||o.hasThumb,children:m.jsx(qTe,{ref:t,...n})})}),qTe=G.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...o}=e,l=Mu(vO,r),d=Sre(vO,r),{onThumbPositionChange:i}=d,g=hi(t,E=>d.onThumbChange(E)),x=G.useRef(void 0),S=Pk(()=>{x.current&&(x.current(),x.current=void 0)},100);return G.useEffect(()=>{const E=l.viewport;if(E){const A=()=>{if(S(),!x.current){const C=HTe(E,i);x.current=C,i()}};return i(),E.addEventListener("scroll",A),()=>E.removeEventListener("scroll",A)}},[l.viewport,S,i]),m.jsx(bn.div,{"data-state":d.hasThumb?"visible":"hidden",...o,ref:g,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:Rr(e.onPointerDownCapture,E=>{const C=E.target.getBoundingClientRect(),N=E.clientX-C.left,k=E.clientY-C.top;d.onThumbPointerDown({x:N,y:k})}),onPointerUp:Rr(e.onPointerUp,d.onThumbPointerUp)})});Tre.displayName=vO;var l4="ScrollAreaCorner",Are=G.forwardRef((e,t)=>{const r=Mu(l4,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?m.jsx(WTe,{...e,ref:t}):null});Are.displayName=l4;var WTe=G.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,o=Mu(l4,r),[l,d]=G.useState(0),[i,g]=G.useState(0),x=!!(l&&i);return D0(o.scrollbarX,()=>{var E;const S=((E=o.scrollbarX)==null?void 0:E.offsetHeight)||0;o.onCornerHeightChange(S),g(S)}),D0(o.scrollbarY,()=>{var E;const S=((E=o.scrollbarY)==null?void 0:E.offsetWidth)||0;o.onCornerWidthChange(S),d(S)}),x?m.jsx(bn.div,{...n,ref:t,style:{width:l,height:i,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function _O(e){return e?parseInt(e,10):0}function Pre(e,t){const r=e/t;return isNaN(r)?0:r}function Ak(e){const t=Pre(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function GTe(e,t,r,n="ltr"){const o=Ak(r),l=o/2,d=t||l,i=o-d,g=r.scrollbar.paddingStart+d,x=r.scrollbar.size-r.scrollbar.paddingEnd-i,S=r.content-r.viewport,E=n==="ltr"?[0,S]:[S*-1,0];return Cre([g,x],E)(e)}function qW(e,t,r="ltr"){const n=Ak(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,l=t.scrollbar.size-o,d=t.content-t.viewport,i=l-n,g=r==="ltr"?[0,d]:[d*-1,0],x=m3(e,g);return Cre([0,d],[0,i])(x)}function Cre(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Ore(e,t){return e>0&&e<t}var HTe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function o(){const l={left:e.scrollLeft,top:e.scrollTop},d=r.left!==l.left,i=r.top!==l.top;(d||i)&&t(),r=l,n=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(n)};function Pk(e,t){const r=Io(e),n=G.useRef(0);return G.useEffect(()=>()=>window.clearTimeout(n.current),[]),G.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function D0(e,t){const r=Io(t);ko(()=>{let n=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(n),o.unobserve(e)}}},[e,r])}var Ire=_re,KTe=bre,ZTe=Are;const uv=G.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(Ire,{ref:n,className:_r("relative overflow-hidden",e),...r,children:[m.jsx(KTe,{className:"h-full w-full rounded-[inherit]",children:t}),m.jsx(kre,{}),m.jsx(ZTe,{})]}));uv.displayName=Ire.displayName;const kre=G.forwardRef(({className:e,orientation:t="vertical",...r},n)=>m.jsx(o4,{ref:n,orientation:t,className:_r("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:m.jsx(Tre,{className:"relative flex-1 rounded-full bg-border"})}));kre.displayName=o4.displayName;const XTe=()=>{const{user:e}=Di(),t=Na();return G.useEffect(()=>{if(!e)return;const r=Ut.channel("notifications-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications",e.id]}),t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ut.removeChannel(r)}},[e,t]),Wi({queryKey:["notifications",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:r,error:n}=await Ut.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;return r},enabled:!!e})},YTe=()=>{const{user:e}=Di(),t=Na();return G.useEffect(()=>{if(!e)return;const r=Ut.channel("notifications-unread-changes").on("postgres_changes",{event:"*",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},()=>{t.invalidateQueries({queryKey:["notifications-unread-count",e.id]})}).subscribe();return()=>{Ut.removeChannel(r)}},[e,t]),Wi({queryKey:["notifications-unread-count",e==null?void 0:e.id],queryFn:async()=>{if(!e)return 0;const{count:r,error:n}=await Ut.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n;return r||0},enabled:!!e})},JTe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{const{error:n}=await Ut.from("notifications").update({read:!0}).eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["notifications"]}),t.invalidateQueries({queryKey:["notifications-unread-count"]})},onError:()=>{e({title:"Error",description:"Failed to mark notification as read",variant:"destructive"})}})},QTe=()=>{const{user:e}=Di(),{toast:t}=wa(),r=Na();return Xa({mutationFn:async()=>{if(!e)throw new Error("User not authenticated");const{error:n}=await Ut.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(n)throw n},onSuccess:()=>{r.invalidateQueries({queryKey:["notifications"]}),r.invalidateQueries({queryKey:["notifications-unread-count"]}),t({title:"Success",description:"All notifications marked as read"})},onError:()=>{t({title:"Error",description:"Failed to mark all notifications as read",variant:"destructive"})}})};function di(e){const t=Object.prototype.toString.call(e);return e instanceof Date||typeof e=="object"&&t==="[object Date]"?new e.constructor(+e):typeof e=="number"||t==="[object Number]"||typeof e=="string"||t==="[object String]"?new Date(e):new Date(NaN)}function Ec(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Ll(e,t){const r=di(e);return isNaN(t)?Ec(e,NaN):(t&&r.setDate(r.getDate()+t),r)}function Cd(e,t){const r=di(e);if(isNaN(t))return Ec(e,NaN);if(!t)return r;const n=r.getDate(),o=Ec(e,r.getTime());o.setMonth(r.getMonth()+t+1,0);const l=o.getDate();return n>=l?o:(r.setFullYear(o.getFullYear(),o.getMonth(),n),r)}const c4=6048e5,eAe=864e5,jP=43200,WW=1440;let tAe={};function Ib(){return tAe}function Ah(e,t){var i,g,x,S;const r=Ib(),n=(t==null?void 0:t.weekStartsOn)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((S=(x=r.locale)==null?void 0:x.options)==null?void 0:S.weekStartsOn)??0,o=di(e),l=o.getDay(),d=(l<n?7:0)+l-n;return o.setDate(o.getDate()-d),o.setHours(0,0,0,0),o}function dv(e){return Ah(e,{weekStartsOn:1})}function Rre(e){const t=di(e),r=t.getFullYear(),n=Ec(e,0);n.setFullYear(r+1,0,4),n.setHours(0,0,0,0);const o=dv(n),l=Ec(e,0);l.setFullYear(r,0,4),l.setHours(0,0,0,0);const d=dv(l);return t.getTime()>=o.getTime()?r+1:t.getTime()>=d.getTime()?r:r-1}function Hm(e){const t=di(e);return t.setHours(0,0,0,0),t}function L0(e){const t=di(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function hh(e,t){const r=Hm(e),n=Hm(t),o=+r-L0(r),l=+n-L0(n);return Math.round((o-l)/eAe)}function rAe(e){const t=Rre(e),r=Ec(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),dv(r)}function g3(e,t){const r=t*7;return Ll(e,r)}function nAe(e,t){return Cd(e,t*12)}function iAe(e){let t;return e.forEach(function(r){const n=di(r);(t===void 0||t<n||isNaN(Number(n)))&&(t=n)}),t||new Date(NaN)}function aAe(e){let t;return e.forEach(r=>{const n=di(r);(!t||t>n||isNaN(+n))&&(t=n)}),t||new Date(NaN)}function gC(e,t){const r=di(e),n=di(t),o=r.getTime()-n.getTime();return o<0?-1:o>0?1:o}function oAe(e){return Ec(e,Date.now())}function yc(e,t){const r=Hm(e),n=Hm(t);return+r==+n}function u4(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function sAe(e){if(!u4(e)&&typeof e!="number")return!1;const t=di(e);return!isNaN(Number(t))}function F0(e,t){const r=di(e),n=di(t),o=r.getFullYear()-n.getFullYear(),l=r.getMonth()-n.getMonth();return o*12+l}function lAe(e,t,r){const n=Ah(e,r),o=Ah(t,r),l=+n-L0(n),d=+o-L0(o);return Math.round((l-d)/c4)}function cAe(e){return t=>{const n=(e?Math[e]:Math.trunc)(t);return n===0?0:n}}function uAe(e,t){return+di(e)-+di(t)}function dAe(e){const t=di(e);return t.setHours(23,59,59,999),t}function Ck(e){const t=di(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function hAe(e){const t=di(e);return+dAe(t)==+Ck(t)}function fAe(e,t){const r=di(e),n=di(t),o=gC(r,n),l=Math.abs(F0(r,n));let d;if(l<1)d=0;else{r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-o*l);let i=gC(r,n)===-o;hAe(di(e))&&l===1&&gC(e,n)===1&&(i=!1),d=o*(l-Number(i))}return d===0?0:d}function pAe(e,t,r){const n=uAe(e,t)/1e3;return cAe(r==null?void 0:r.roundingMethod)(n)}function Sc(e){const t=di(e);return t.setDate(1),t.setHours(0,0,0,0),t}function jre(e){const t=di(e),r=Ec(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function d4(e,t){var i,g,x,S;const r=Ib(),n=(t==null?void 0:t.weekStartsOn)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.weekStartsOn)??r.weekStartsOn??((S=(x=r.locale)==null?void 0:x.options)==null?void 0:S.weekStartsOn)??0,o=di(e),l=o.getDay(),d=(l<n?-7:0)+6-(l-n);return o.setDate(o.getDate()+d),o.setHours(23,59,59,999),o}function Nre(e){return d4(e,{weekStartsOn:1})}const mAe={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},gAe=(e,t,r)=>{let n;const o=mAe[e];return typeof o=="string"?n=o:t===1?n=o.one:n=o.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+n:n+" ago":n};function UM(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const yAe={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},vAe={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},_Ae={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},xAe={date:UM({formats:yAe,defaultWidth:"full"}),time:UM({formats:vAe,defaultWidth:"full"}),dateTime:UM({formats:_Ae,defaultWidth:"full"})},bAe={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},wAe=(e,t,r,n)=>bAe[e];function oS(e){return(t,r)=>{const n=r!=null&&r.context?String(r.context):"standalone";let o;if(n==="formatting"&&e.formattingValues){const d=e.defaultFormattingWidth||e.defaultWidth,i=r!=null&&r.width?String(r.width):d;o=e.formattingValues[i]||e.formattingValues[d]}else{const d=e.defaultWidth,i=r!=null&&r.width?String(r.width):e.defaultWidth;o=e.values[i]||e.values[d]}const l=e.argumentCallback?e.argumentCallback(t):t;return o[l]}}const SAe={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},EAe={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},TAe={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},AAe={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},PAe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},CAe={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},OAe=(e,t)=>{const r=Number(e),n=r%100;if(n>20||n<10)switch(n%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},IAe={ordinalNumber:OAe,era:oS({values:SAe,defaultWidth:"wide"}),quarter:oS({values:EAe,defaultWidth:"wide",argumentCallback:e=>e-1}),month:oS({values:TAe,defaultWidth:"wide"}),day:oS({values:AAe,defaultWidth:"wide"}),dayPeriod:oS({values:PAe,defaultWidth:"wide",formattingValues:CAe,defaultFormattingWidth:"wide"})};function sS(e){return(t,r={})=>{const n=r.width,o=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],l=t.match(o);if(!l)return null;const d=l[0],i=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],g=Array.isArray(i)?RAe(i,E=>E.test(d)):kAe(i,E=>E.test(d));let x;x=e.valueCallback?e.valueCallback(g):g,x=r.valueCallback?r.valueCallback(x):x;const S=t.slice(d.length);return{value:x,rest:S}}}function kAe(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function RAe(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function jAe(e){return(t,r={})=>{const n=t.match(e.matchPattern);if(!n)return null;const o=n[0],l=t.match(e.parsePattern);if(!l)return null;let d=e.valueCallback?e.valueCallback(l[0]):l[0];d=r.valueCallback?r.valueCallback(d):d;const i=t.slice(o.length);return{value:d,rest:i}}}const NAe=/^(\d+)(th|st|nd|rd)?/i,MAe=/\d+/i,DAe={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},LAe={any:[/^b/i,/^(a|c)/i]},FAe={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},zAe={any:[/1/i,/2/i,/3/i,/4/i]},BAe={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},$Ae={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},UAe={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},VAe={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},qAe={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},WAe={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},GAe={ordinalNumber:jAe({matchPattern:NAe,parsePattern:MAe,valueCallback:e=>parseInt(e,10)}),era:sS({matchPatterns:DAe,defaultMatchWidth:"wide",parsePatterns:LAe,defaultParseWidth:"any"}),quarter:sS({matchPatterns:FAe,defaultMatchWidth:"wide",parsePatterns:zAe,defaultParseWidth:"any",valueCallback:e=>e+1}),month:sS({matchPatterns:BAe,defaultMatchWidth:"wide",parsePatterns:$Ae,defaultParseWidth:"any"}),day:sS({matchPatterns:UAe,defaultMatchWidth:"wide",parsePatterns:VAe,defaultParseWidth:"any"}),dayPeriod:sS({matchPatterns:qAe,defaultMatchWidth:"any",parsePatterns:WAe,defaultParseWidth:"any"})},h4={code:"en-US",formatDistance:gAe,formatLong:xAe,formatRelative:wAe,localize:IAe,match:GAe,options:{weekStartsOn:0,firstWeekContainsDate:1}};function HAe(e){const t=di(e);return hh(t,jre(t))+1}function Mre(e){const t=di(e),r=+dv(t)-+rAe(t);return Math.round(r/c4)+1}function Dre(e,t){var S,E,A,C;const r=di(e),n=r.getFullYear(),o=Ib(),l=(t==null?void 0:t.firstWeekContainsDate)??((E=(S=t==null?void 0:t.locale)==null?void 0:S.options)==null?void 0:E.firstWeekContainsDate)??o.firstWeekContainsDate??((C=(A=o.locale)==null?void 0:A.options)==null?void 0:C.firstWeekContainsDate)??1,d=Ec(e,0);d.setFullYear(n+1,0,l),d.setHours(0,0,0,0);const i=Ah(d,t),g=Ec(e,0);g.setFullYear(n,0,l),g.setHours(0,0,0,0);const x=Ah(g,t);return r.getTime()>=i.getTime()?n+1:r.getTime()>=x.getTime()?n:n-1}function KAe(e,t){var i,g,x,S;const r=Ib(),n=(t==null?void 0:t.firstWeekContainsDate)??((g=(i=t==null?void 0:t.locale)==null?void 0:i.options)==null?void 0:g.firstWeekContainsDate)??r.firstWeekContainsDate??((S=(x=r.locale)==null?void 0:x.options)==null?void 0:S.firstWeekContainsDate)??1,o=Dre(e,t),l=Ec(e,0);return l.setFullYear(o,0,n),l.setHours(0,0,0,0),Ah(l,t)}function Lre(e,t){const r=di(e),n=+Ah(r,t)-+KAe(r,t);return Math.round(n/c4)+1}function Ra(e,t){const r=e<0?"-":"",n=Math.abs(e).toString().padStart(t,"0");return r+n}const qp={y(e,t){const r=e.getFullYear(),n=r>0?r:1-r;return Ra(t==="yy"?n%100:n,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):Ra(r+1,2)},d(e,t){return Ra(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return Ra(e.getHours()%12||12,t.length)},H(e,t){return Ra(e.getHours(),t.length)},m(e,t){return Ra(e.getMinutes(),t.length)},s(e,t){return Ra(e.getSeconds(),t.length)},S(e,t){const r=t.length,n=e.getMilliseconds(),o=Math.trunc(n*Math.pow(10,r-3));return Ra(o,t.length)}},gx={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},GW={G:function(e,t,r){const n=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(n,{width:"abbreviated"});case"GGGGG":return r.era(n,{width:"narrow"});case"GGGG":default:return r.era(n,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const n=e.getFullYear(),o=n>0?n:1-n;return r.ordinalNumber(o,{unit:"year"})}return qp.y(e,t)},Y:function(e,t,r,n){const o=Dre(e,n),l=o>0?o:1-o;if(t==="YY"){const d=l%100;return Ra(d,2)}return t==="Yo"?r.ordinalNumber(l,{unit:"year"}):Ra(l,t.length)},R:function(e,t){const r=Rre(e);return Ra(r,t.length)},u:function(e,t){const r=e.getFullYear();return Ra(r,t.length)},Q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(n);case"QQ":return Ra(n,2);case"Qo":return r.ordinalNumber(n,{unit:"quarter"});case"QQQ":return r.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,t,r){const n=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(n);case"qq":return Ra(n,2);case"qo":return r.ordinalNumber(n,{unit:"quarter"});case"qqq":return r.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,t,r){const n=e.getMonth();switch(t){case"M":case"MM":return qp.M(e,t);case"Mo":return r.ordinalNumber(n+1,{unit:"month"});case"MMM":return r.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(n,{width:"wide",context:"formatting"})}},L:function(e,t,r){const n=e.getMonth();switch(t){case"L":return String(n+1);case"LL":return Ra(n+1,2);case"Lo":return r.ordinalNumber(n+1,{unit:"month"});case"LLL":return r.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(n,{width:"wide",context:"standalone"})}},w:function(e,t,r,n){const o=Lre(e,n);return t==="wo"?r.ordinalNumber(o,{unit:"week"}):Ra(o,t.length)},I:function(e,t,r){const n=Mre(e);return t==="Io"?r.ordinalNumber(n,{unit:"week"}):Ra(n,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):qp.d(e,t)},D:function(e,t,r){const n=HAe(e);return t==="Do"?r.ordinalNumber(n,{unit:"dayOfYear"}):Ra(n,t.length)},E:function(e,t,r){const n=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(n,{width:"short",context:"formatting"});case"EEEE":default:return r.day(n,{width:"wide",context:"formatting"})}},e:function(e,t,r,n){const o=e.getDay(),l=(o-n.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return Ra(l,2);case"eo":return r.ordinalNumber(l,{unit:"day"});case"eee":return r.day(o,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(o,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(o,{width:"short",context:"formatting"});case"eeee":default:return r.day(o,{width:"wide",context:"formatting"})}},c:function(e,t,r,n){const o=e.getDay(),l=(o-n.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return Ra(l,t.length);case"co":return r.ordinalNumber(l,{unit:"day"});case"ccc":return r.day(o,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(o,{width:"narrow",context:"standalone"});case"cccccc":return r.day(o,{width:"short",context:"standalone"});case"cccc":default:return r.day(o,{width:"wide",context:"standalone"})}},i:function(e,t,r){const n=e.getDay(),o=n===0?7:n;switch(t){case"i":return String(o);case"ii":return Ra(o,t.length);case"io":return r.ordinalNumber(o,{unit:"day"});case"iii":return r.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(n,{width:"short",context:"formatting"});case"iiii":default:return r.day(n,{width:"wide",context:"formatting"})}},a:function(e,t,r){const o=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},b:function(e,t,r){const n=e.getHours();let o;switch(n===12?o=gx.noon:n===0?o=gx.midnight:o=n/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},B:function(e,t,r){const n=e.getHours();let o;switch(n>=17?o=gx.evening:n>=12?o=gx.afternoon:n>=4?o=gx.morning:o=gx.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(o,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(o,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(o,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let n=e.getHours()%12;return n===0&&(n=12),r.ordinalNumber(n,{unit:"hour"})}return qp.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):qp.H(e,t)},K:function(e,t,r){const n=e.getHours()%12;return t==="Ko"?r.ordinalNumber(n,{unit:"hour"}):Ra(n,t.length)},k:function(e,t,r){let n=e.getHours();return n===0&&(n=24),t==="ko"?r.ordinalNumber(n,{unit:"hour"}):Ra(n,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):qp.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):qp.s(e,t)},S:function(e,t){return qp.S(e,t)},X:function(e,t,r){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(t){case"X":return KW(n);case"XXXX":case"XX":return by(n);case"XXXXX":case"XXX":default:return by(n,":")}},x:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"x":return KW(n);case"xxxx":case"xx":return by(n);case"xxxxx":case"xxx":default:return by(n,":")}},O:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+HW(n,":");case"OOOO":default:return"GMT"+by(n,":")}},z:function(e,t,r){const n=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+HW(n,":");case"zzzz":default:return"GMT"+by(n,":")}},t:function(e,t,r){const n=Math.trunc(e.getTime()/1e3);return Ra(n,t.length)},T:function(e,t,r){const n=e.getTime();return Ra(n,t.length)}};function HW(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),o=Math.trunc(n/60),l=n%60;return l===0?r+String(o):r+String(o)+t+Ra(l,2)}function KW(e,t){return e%60===0?(e>0?"-":"+")+Ra(Math.abs(e)/60,2):by(e,t)}function by(e,t=""){const r=e>0?"-":"+",n=Math.abs(e),o=Ra(Math.trunc(n/60),2),l=Ra(n%60,2);return r+o+t+l}const ZW=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},Fre=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},ZAe=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],n=r[1],o=r[2];if(!o)return ZW(e,t);let l;switch(n){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",ZW(n,t)).replace("{{time}}",Fre(o,t))},XAe={p:Fre,P:ZAe},YAe=/^D+$/,JAe=/^Y+$/,QAe=["D","DD","YY","YYYY"];function e2e(e){return YAe.test(e)}function t2e(e){return JAe.test(e)}function r2e(e,t,r){const n=n2e(e,t,r);if(console.warn(n),QAe.includes(e))throw new RangeError(n)}function n2e(e,t,r){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${n} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const i2e=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,a2e=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,o2e=/^'([^]*?)'?$/,s2e=/''/g,l2e=/[a-zA-Z]/;function Is(e,t,r){var S,E,A,C,N,k,R,L;const n=Ib(),o=(r==null?void 0:r.locale)??n.locale??h4,l=(r==null?void 0:r.firstWeekContainsDate)??((E=(S=r==null?void 0:r.locale)==null?void 0:S.options)==null?void 0:E.firstWeekContainsDate)??n.firstWeekContainsDate??((C=(A=n.locale)==null?void 0:A.options)==null?void 0:C.firstWeekContainsDate)??1,d=(r==null?void 0:r.weekStartsOn)??((k=(N=r==null?void 0:r.locale)==null?void 0:N.options)==null?void 0:k.weekStartsOn)??n.weekStartsOn??((L=(R=n.locale)==null?void 0:R.options)==null?void 0:L.weekStartsOn)??0,i=di(e);if(!sAe(i))throw new RangeError("Invalid time value");let g=t.match(a2e).map(j=>{const F=j[0];if(F==="p"||F==="P"){const B=XAe[F];return B(j,o.formatLong)}return j}).join("").match(i2e).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const F=j[0];if(F==="'")return{isToken:!1,value:c2e(j)};if(GW[F])return{isToken:!0,value:j};if(F.match(l2e))throw new RangeError("Format string contains an unescaped latin alphabet character `"+F+"`");return{isToken:!1,value:j}});o.localize.preprocessor&&(g=o.localize.preprocessor(i,g));const x={firstWeekContainsDate:l,weekStartsOn:d,locale:o};return g.map(j=>{if(!j.isToken)return j.value;const F=j.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&t2e(F)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&e2e(F))&&r2e(F,t,String(e));const B=GW[F[0]];return B(i,F,o.localize,x)}).join("")}function c2e(e){const t=e.match(o2e);return t?t[1].replace(s2e,"'"):e}function u2e(e,t,r){const n=Ib(),o=(r==null?void 0:r.locale)??n.locale??h4,l=2520,d=gC(e,t);if(isNaN(d))throw new RangeError("Invalid time value");const i=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:d});let g,x;d>0?(g=di(t),x=di(e)):(g=di(e),x=di(t));const S=pAe(x,g),E=(L0(x)-L0(g))/1e3,A=Math.round((S-E)/60);let C;if(A<2)return r!=null&&r.includeSeconds?S<5?o.formatDistance("lessThanXSeconds",5,i):S<10?o.formatDistance("lessThanXSeconds",10,i):S<20?o.formatDistance("lessThanXSeconds",20,i):S<40?o.formatDistance("halfAMinute",0,i):S<60?o.formatDistance("lessThanXMinutes",1,i):o.formatDistance("xMinutes",1,i):A===0?o.formatDistance("lessThanXMinutes",1,i):o.formatDistance("xMinutes",A,i);if(A<45)return o.formatDistance("xMinutes",A,i);if(A<90)return o.formatDistance("aboutXHours",1,i);if(A<WW){const N=Math.round(A/60);return o.formatDistance("aboutXHours",N,i)}else{if(A<l)return o.formatDistance("xDays",1,i);if(A<jP){const N=Math.round(A/WW);return o.formatDistance("xDays",N,i)}else if(A<jP*2)return C=Math.round(A/jP),o.formatDistance("aboutXMonths",C,i)}if(C=fAe(x,g),C<12){const N=Math.round(A/jP);return o.formatDistance("xMonths",N,i)}else{const N=C%12,k=Math.trunc(C/12);return N<3?o.formatDistance("aboutXYears",k,i):N<9?o.formatDistance("overXYears",k,i):o.formatDistance("almostXYears",k+1,i)}}function _f(e,t){return u2e(e,oAe(e),t)}function d2e(e){const t=di(e),r=t.getFullYear(),n=t.getMonth(),o=Ec(e,0);return o.setFullYear(r,n+1,0),o.setHours(0,0,0,0),o.getDate()}function h2e(e){return Math.trunc(+di(e)/1e3)}function f2e(e){const t=di(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}function p2e(e,t){return lAe(f2e(e),Sc(e),t)+1}function y3(e,t){const r=di(e),n=di(t);return r.getTime()>n.getTime()}function zre(e,t){const r=di(e),n=di(t);return+r<+n}function f4(e,t){const r=di(e),n=di(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()}function m2e(e,t){const r=di(e),n=di(t);return r.getFullYear()===n.getFullYear()}function yC(e,t){return Ll(e,-t)}function VM(e,t){const r=di(e),n=r.getFullYear(),o=r.getDate(),l=Ec(e,0);l.setFullYear(n,t,15),l.setHours(0,0,0,0);const d=d2e(l);return r.setMonth(t,Math.min(o,d)),r}function XW(e,t){const r=di(e);return isNaN(+r)?Ec(e,NaN):(r.setFullYear(t),r)}const g2e=()=>{const{t:e}=Ki(),{data:t=[]}=XTe(),{data:r=0}=YTe(),n=JTe(),o=QTe(),l=(i,g)=>{g||n.mutate(i)},d=i=>{switch(i){case"comment_reply":return"";case"new_activity":return"";case"activity_update":return"";case"new_user":return"";case"merchant_joined":return"";default:return""}};return m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsxs(lr,{variant:"ghost",size:"icon",className:"relative",children:[m.jsx(qY,{className:"h-5 w-5"}),r>0&&m.jsx(Qn,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:r>9?"9+":r})]})}),m.jsxs(ng,{align:"end",className:"w-80 max-h-[500px]",children:[m.jsxs(n4,{className:"flex items-center justify-between",children:[m.jsx("span",{children:e("notifications.title")}),r>0&&m.jsxs(lr,{variant:"ghost",size:"sm",onClick:()=>o.mutate(),disabled:o.isPending,children:[m.jsx(Zge,{className:"h-4 w-4 mr-1"}),e("notifications.markAllRead")]})]}),m.jsx(i0,{}),m.jsx(uv,{className:"h-[400px]",children:t.length===0?m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("notifications.noNotifications")}):t.map(i=>m.jsx(Ca,{className:`flex flex-col items-start p-3 cursor-pointer ${i.read?"":"bg-secondary/50"}`,asChild:!0,children:m.jsx(Vi,{to:i.link||"#",onClick:()=>l(i.id,i.read),children:m.jsxs("div",{className:"flex items-start gap-2 w-full",children:[m.jsx("span",{className:"text-2xl",children:d(i.type)}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsx("p",{className:"font-semibold text-sm truncate",children:i.title}),!i.read&&m.jsx(Qn,{variant:"default",className:"h-2 w-2 p-0 rounded-full"})]}),m.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 mt-1",children:i.content}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:_f(new Date(i.created_at),{addSuffix:!0})})]})]})})},i.id))})]})]})},y2e=()=>{var E,A,C,N,k,R,L,j;const[e,t]=G.useState(!1),{user:r,signOut:n}=Di(),{t:o,i18n:l}=Ki(),{isAdmin:d,isSupervisor:i,isMerchant:g}=Tc(),{data:x}=i4();G.useEffect(()=>{x!=null&&x.language_preference&&x.language_preference!==l.language&&l.changeLanguage(x.language_preference)},[x,l]);const S=[{to:"/",icon:Cs,label:o("nav.map")},{to:"/restaurants",icon:HY,label:o("nav.restaurants")},{to:"/activities",icon:$l,label:o("nav.activities")},{to:"/map",icon:ZY,label:o("nav.mapView")},{to:"/join-us",icon:Qo,label:o("nav.joinUs")}];return m.jsx("nav",{className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border shadow-soft",children:m.jsxs("div",{className:"container mx-auto px-3 sm:px-4 h-14 sm:h-16 flex items-center justify-between",children:[m.jsx(Vi,{to:"/",className:"flex items-center gap-2",children:m.jsx("img",{src:i1e,alt:"Logo",className:"w-[35px] h-[35px] md:w-[45px] md:h-[45px] object-contain drop-shadow-md"})}),m.jsx("div",{className:"hidden lg:flex items-center gap-6",children:S.map(F=>m.jsxs(Vi,{to:F.to,className:"flex items-center gap-2 text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(F.icon,{className:"w-4 h-4"}),m.jsx("span",{children:F.label})]},F.to))}),m.jsxs("div",{className:"flex items-center gap-1 sm:gap-3",children:[m.jsx(MTe,{}),r&&m.jsx(g2e,{}),r?m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsx(lr,{variant:"ghost",size:"icon",className:"rounded-full h-8 w-8 sm:h-10 sm:w-10",children:m.jsxs(qm,{className:"w-7 h-7 sm:w-8 sm:h-8",children:[m.jsx(Wm,{src:(x==null?void 0:x.avatar_url)||((E=r.user_metadata)==null?void 0:E.avatar_url)}),m.jsx(Gm,{className:"text-xs sm:text-sm",children:((C=(A=x==null?void 0:x.display_name)==null?void 0:A[0])==null?void 0:C.toUpperCase())||((R=(k=(N=r.user_metadata)==null?void 0:N.display_name)==null?void 0:k[0])==null?void 0:R.toUpperCase())||((j=(L=r.email)==null?void 0:L[0])==null?void 0:j.toUpperCase())})]})})}),m.jsxs(ng,{align:"end",children:[m.jsx(n4,{children:o("nav.myAccount")}),m.jsx(i0,{}),m.jsx(Ca,{asChild:!0,children:m.jsxs(Vi,{to:"/profile",className:"cursor-pointer",children:[m.jsx(yM,{className:"w-4 h-4 mr-2"}),o("nav.profile")]})}),(g||i)&&m.jsx(Ca,{asChild:!0,children:m.jsxs(Vi,{to:"/merchant-restaurants",className:"cursor-pointer",children:[m.jsx(Qo,{className:"w-4 h-4 mr-2"}),o("nav.manageRestaurants")]})}),(d||i)&&m.jsxs(m.Fragment,{children:[m.jsx(i0,{}),m.jsx(Ca,{asChild:!0,children:m.jsxs(Vi,{to:"/admin",className:"cursor-pointer",children:[m.jsx(hc,{className:"w-4 h-4 mr-2"}),o("nav.admin")]})})]}),m.jsx(i0,{}),m.jsxs(Ca,{onClick:()=>n(),className:"cursor-pointer",children:[m.jsx(yq,{className:"w-4 h-4 mr-2"}),o("nav.signOut")]})]})]}):m.jsx(lr,{asChild:!0,className:"hidden lg:flex",children:m.jsx(Vi,{to:"/auth",children:o("nav.signIn")})}),m.jsxs(Jee,{open:e,onOpenChange:t,children:[m.jsx(oSe,{asChild:!0,className:"lg:hidden",children:m.jsx(lr,{size:"icon",className:"h-8 w-8 sm:h-10 sm:w-10 bg-primary text-primary-foreground hover:bg-primary/90 rounded-lg",children:m.jsx(XY,{className:"w-4 sm:w-5 h-4 sm:h-5"})})}),m.jsx(KB,{side:"right",className:"w-64 sm:w-80",children:m.jsxs("div",{className:"flex flex-col gap-4 mt-8",children:[S.map(F=>m.jsxs(Vi,{to:F.to,onClick:()=>t(!1),className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(F.icon,{className:"w-5 h-5"}),m.jsx("span",{children:F.label})]},F.to)),m.jsx("div",{className:"border-t border-border my-4"}),r?m.jsxs(m.Fragment,{children:[m.jsxs(Vi,{to:"/profile",onClick:()=>t(!1),className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(yM,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.profile")})]}),(g||i)&&m.jsxs(Vi,{to:"/merchant-restaurants",onClick:()=>t(!1),className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(Qo,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.manageRestaurants")})]}),(d||i)&&m.jsxs(Vi,{to:"/admin",onClick:()=>t(!1),className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(hc,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.admin")})]}),m.jsxs("button",{onClick:()=>{n(),t(!1)},className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(yq,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.signOut")})]})]}):m.jsxs(Vi,{to:"/auth",onClick:()=>t(!1),className:"flex items-center gap-3 text-lg text-muted-foreground hover:text-primary transition-colors",children:[m.jsx(yM,{className:"w-5 h-5"}),m.jsx("span",{children:o("nav.signIn")})]})]})})]})]})]})})},Qr=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:_r("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Qr.displayName="Card";const Mi=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:_r("flex flex-col space-y-1.5 p-6",e),...t}));Mi.displayName="CardHeader";const Ji=G.forwardRef(({className:e,...t},r)=>m.jsx("h3",{ref:r,className:_r("text-2xl font-semibold leading-none tracking-tight",e),...t}));Ji.displayName="CardTitle";const Do=G.forwardRef(({className:e,...t},r)=>m.jsx("p",{ref:r,className:_r("text-sm text-muted-foreground",e),...t}));Do.displayName="CardDescription";const dn=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:_r("p-6 pt-0",e),...t}));dn.displayName="CardContent";const Ok=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:_r("flex items-center p-6 pt-0",e),...t}));Ok.displayName="CardFooter";const v2e="/assets/lisbon-hero-BSeJ4NyM.jpg",_2e="/assets/map-icon-CwlHKRle.png",x2e=()=>{const{t:e}=Ki(),[t,r]=G.useState(null);return G.useEffect(()=>{(async()=>{try{const l=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();l&&r({order_count:l.order_count||0,reserve_count:l.reserve_count||0})}catch(o){console.error("Failed to fetch stats:",o)}})()},[]),m.jsxs("div",{className:"min-h-screen",children:[m.jsxs("section",{className:"relative min-h-screen flex items-start overflow-hidden",children:[m.jsxs("div",{className:"absolute inset-0",children:[m.jsx("img",{src:v2e,alt:"Lisbon cityscape",className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-background/90 via-background/70 to-background/90"})]}),t&&m.jsx("div",{className:"absolute top-3 sm:top-4 left-3 z-20",children:m.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(hye,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"text-sm text-muted-foreground",children:e("home.stats.delivery")}),m.jsx("span",{className:"font-bold text-foreground text-sm",children:t.order_count})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Gge,{className:"w-4 h-4 text-accent"}),m.jsx("span",{className:"text-sm text-muted-foreground",children:e("home.stats.reservation")}),m.jsx("span",{className:"font-bold text-foreground text-sm",children:t.reserve_count})]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xl sm:text-2xl font-bold text-foreground",children:e("home.hero.brandName")}),m.jsx("img",{src:_2e,alt:"map icon",className:"w-5 sm:w-8 h-5 sm:h-8 object-contain flex-shrink-0"})]})]})}),m.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:m.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[m.jsx(Vi,{to:"/map",className:"inline-block",children:m.jsxs("div",{className:"inline-flex items-center gap-2 px-3 sm:px-4 py-1.5 sm:py-2 rounded-full bg-primary/10 border border-primary/20 backdrop-blur-sm hover:bg-primary/20 transition-colors cursor-pointer",children:[m.jsx(Cs,{className:"w-3.5 sm:w-4 h-3.5 sm:h-4 text-primary"}),m.jsx("span",{className:"text-xs sm:text-sm font-medium text-primary",children:e("home.hero.subtitle")})]})}),m.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-foreground leading-tight px-4 drop-shadow-lg",children:e("home.hero.title")}),m.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-foreground/80 max-w-2xl mx-auto px-4 drop-shadow-md",children:e("home.hero.description")}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center pt-2 sm:pt-4 px-4",children:[m.jsx(lr,{size:"lg",asChild:!0,className:"text-base sm:text-lg shadow-lg hover:shadow-xl transition-shadow w-full sm:w-auto",children:m.jsxs(Vi,{to:"/restaurants",children:[m.jsx(Tv,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.hero.exploreBtn")]})}),m.jsx(lr,{size:"lg",variant:"outline",asChild:!0,className:"text-base sm:text-lg w-full sm:w-auto backdrop-blur-sm",children:m.jsxs(Vi,{to:"/activities",children:[m.jsx($l,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.hero.activitiesBtn")]})})]})]})})]}),m.jsx("section",{className:"py-16 sm:py-24 px-4 bg-secondary/20",children:m.jsxs("div",{className:"container mx-auto max-w-6xl",children:[m.jsxs("div",{className:"text-center mb-12 sm:mb-16",children:[m.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground mb-3 sm:mb-4",children:e("home.features.title")}),m.jsx("p",{className:"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto px-4",children:e("home.features.description")})]}),m.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8",children:[m.jsx(Vi,{to:"/map",children:m.jsxs(Qr,{className:"group p-6 sm:p-8 border-border/50 hover:border-primary/50 transition-all hover:shadow-large cursor-pointer h-full",children:[m.jsx("div",{className:"w-14 sm:w-16 h-14 sm:h-16 rounded-2xl bg-gradient-to-br from-primary to-primary-light flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform",children:m.jsx(Cs,{className:"w-7 sm:w-8 h-7 sm:h-8 text-primary-foreground"})}),m.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:e("home.features.map.title")}),m.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[e("home.features.map.desc"),m.jsx(gM,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})}),m.jsx(Vi,{to:"/restaurants",children:m.jsxs(Qr,{className:"group p-6 sm:p-8 border-border/50 hover:border-accent/50 transition-all hover:shadow-large cursor-pointer h-full",children:[m.jsx("div",{className:"w-14 sm:w-16 h-14 sm:h-16 rounded-2xl bg-gradient-to-br from-accent to-warning flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform",children:m.jsx(wc,{className:"w-7 sm:w-8 h-7 sm:h-8 text-accent-foreground"})}),m.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:e("home.features.reviews.title")}),m.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[e("home.features.reviews.desc"),m.jsx(gM,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})}),m.jsx(Vi,{to:"/activities",className:"sm:col-span-2 md:col-span-1",children:m.jsxs(Qr,{className:"group p-6 sm:p-8 border-border/50 hover:border-success/50 transition-all hover:shadow-large cursor-pointer h-full",children:[m.jsx("div",{className:"w-14 sm:w-16 h-14 sm:h-16 rounded-2xl bg-gradient-to-br from-success to-accent flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform",children:m.jsx($l,{className:"w-7 sm:w-8 h-7 sm:h-8 text-white"})}),m.jsx("h3",{className:"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground",children:e("home.features.events.title")}),m.jsxs("p",{className:"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2",children:[e("home.features.events.desc"),m.jsx(gM,{className:"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})})]})]})}),m.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[m.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),m.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),m.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),m.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[m.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:e("home.cta.title")}),m.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:e("home.cta.description")}),m.jsx(lr,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl w-full sm:w-auto mx-4",children:m.jsxs(Vi,{to:"/join-us",children:[m.jsx(QY,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),e("home.cta.button")]})})]})]})]})},an=G.forwardRef(({className:e,type:t,...r},n)=>m.jsx("input",{type:t,className:_r("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));an.displayName="Input";const p4=(e,t)=>Wi({queryKey:["restaurants",e,t],queryFn:async()=>{let r=Ut.from("restaurants").select("*").eq("visible",!0).order("rating",{ascending:!1});if(e&&(r=r.or(`name.ilike.%${e}%,address.ilike.%${e}%`)),t){const d=t.split(",").flatMap(i=>[`type.cs.{${i}}`,`type_en.cs.{${i}}`,`type_pt.cs.{${i}}`]);r=r.or(d.join(","))}const{data:n,error:o}=await r;if(o)throw o;return n}}),b2e=e=>Wi({queryKey:["restaurant",e],queryFn:async()=>{const{data:t,error:r}=await Ut.from("restaurants").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),Bre=()=>{const{user:e}=Di();return Wi({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;return t.map(n=>n.restaurant_id)},enabled:!!e})},$re=()=>{const{user:e}=Di(),t=Na();return Xa({mutationFn:async r=>{if(!e)throw new Error("Must be logged in");const{data:n}=await Ut.from("favorites").select("id").eq("user_id",e.id).eq("restaurant_id",r).maybeSingle();if(n){const{error:o}=await Ut.from("favorites").delete().eq("id",n.id);if(o)throw o;return{action:"removed"}}else{const{error:o}=await Ut.from("favorites").insert({user_id:e.id,restaurant_id:r});if(o)throw o;return{action:"added"}}},onSuccess:r=>{t.invalidateQueries({queryKey:["favorites"]}),Vr.success(r.action==="added"?"Added to favorites!":"Removed from favorites")},onError:r=>{r.message==="Must be logged in"?Vr.error("Please sign in to favorite restaurants"):Vr.error("Failed to update favorites")}})},Ure=()=>{const{i18n:e}=Ki(),t=e.language;return Wi({queryKey:["restaurant-types",t],queryFn:async()=>{const r=t==="zh"?"type":t==="pt"?"type_pt":"type_en",{data:n,error:o}=await Ut.from("restaurants").select("type, type_en, type_pt").order("type");if(o)throw o;const l=n.flatMap(i=>i[r]||i.type_en||i.type||[]);return Array.from(new Set(l)).sort()}})},$T=(e,t,r,n)=>{const l=NP(r-e),d=NP(n-t),i=Math.sin(l/2)*Math.sin(l/2)+Math.cos(NP(e))*Math.cos(NP(r))*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))},NP=e=>e*Math.PI/180,Ik=()=>new Promise((e,t)=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):t(new Error("Geolocation is not supported by this browser."))}),Vre=(e,t,r)=>{const n=/iPad|iPhone|iPod/.test(navigator.userAgent),o=/Android/.test(navigator.userAgent);n?window.open(`maps://maps.apple.com/?daddr=${e},${t}&q=${encodeURIComponent(r)}`,"_blank"):o?window.open(`geo:${e},${t}?q=${e},${t}(${encodeURIComponent(r)})`,"_blank"):window.open(`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`,"_blank")};var qre={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(mc,function(){var r,n,o;function l(i,g){if(!r)r=g;else if(!n)n=g;else{var x="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",S={};r(S),o=g(S),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(o.workerUrl=window.URL.createObjectURL(new Blob([x],{type:"text/javascript"})))}}l(["exports"],function(i){var g=1e-6,x=typeof Float32Array<"u"?Float32Array:Array;function S(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=c*_-p*f;return b?(u[0]=_*(b=1/b),u[1]=-f*b,u[2]=-p*b,u[3]=c*b,u):null}function E(){var u=new x(9);return x!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[5]=0,u[6]=0,u[7]=0),u[0]=1,u[4]=1,u[8]=1,u}function A(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=a[4],T=a[5],I=a[6],M=a[7],$=a[8];return u[0]=b*$-T*M,u[1]=p*M-f*$,u[2]=f*T-p*b,u[3]=T*I-_*$,u[4]=c*$-p*I,u[5]=p*_-c*T,u[6]=_*M-b*I,u[7]=f*I-c*M,u[8]=c*b-f*_,u}function C(u,a,c){var f=a[0],p=a[1],_=a[2],b=a[3],T=a[4],I=a[5],M=a[6],$=a[7],V=a[8],q=c[0],Y=c[1],J=c[2],ae=c[3],ce=c[4],de=c[5],we=c[6],Te=c[7],Oe=c[8];return u[0]=q*f+Y*b+J*M,u[1]=q*p+Y*T+J*$,u[2]=q*_+Y*I+J*V,u[3]=ae*f+ce*b+de*M,u[4]=ae*p+ce*T+de*$,u[5]=ae*_+ce*I+de*V,u[6]=we*f+Te*b+Oe*M,u[7]=we*p+Te*T+Oe*$,u[8]=we*_+Te*I+Oe*V,u}function N(){var u=new x(16);return x!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u}function k(u){var a=new x(16);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a[3]=u[3],a[4]=u[4],a[5]=u[5],a[6]=u[6],a[7]=u[7],a[8]=u[8],a[9]=u[9],a[10]=u[10],a[11]=u[11],a[12]=u[12],a[13]=u[13],a[14]=u[14],a[15]=u[15],a}function R(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function L(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=a[4],T=a[5],I=a[6],M=a[7],$=a[8],V=a[9],q=a[10],Y=a[11],J=a[12],ae=a[13],ce=a[14],de=a[15],we=c*T-f*b,Te=c*I-p*b,Oe=c*M-_*b,Ue=f*I-p*T,De=f*M-_*T,Ge=p*M-_*I,Je=$*ae-V*J,tt=$*ce-q*J,Et=$*de-Y*J,ct=V*ce-q*ae,Tt=V*de-Y*ae,kt=q*de-Y*ce,Dt=we*kt-Te*Tt+Oe*ct+Ue*Et-De*tt+Ge*Je;return Dt?(u[0]=(T*kt-I*Tt+M*ct)*(Dt=1/Dt),u[1]=(p*Tt-f*kt-_*ct)*Dt,u[2]=(ae*Ge-ce*De+de*Ue)*Dt,u[3]=(q*De-V*Ge-Y*Ue)*Dt,u[4]=(I*Et-b*kt-M*tt)*Dt,u[5]=(c*kt-p*Et+_*tt)*Dt,u[6]=(ce*Oe-J*Ge-de*Te)*Dt,u[7]=($*Ge-q*Oe+Y*Te)*Dt,u[8]=(b*Tt-T*Et+M*Je)*Dt,u[9]=(f*Et-c*Tt-_*Je)*Dt,u[10]=(J*De-ae*Oe+de*we)*Dt,u[11]=(V*Oe-$*De-Y*we)*Dt,u[12]=(T*tt-b*ct-I*Je)*Dt,u[13]=(c*ct-f*tt+p*Je)*Dt,u[14]=(ae*Te-J*Ue-ce*we)*Dt,u[15]=($*Ue-V*Te+q*we)*Dt,u):null}function j(u,a,c){var f=a[0],p=a[1],_=a[2],b=a[3],T=a[4],I=a[5],M=a[6],$=a[7],V=a[8],q=a[9],Y=a[10],J=a[11],ae=a[12],ce=a[13],de=a[14],we=a[15],Te=c[0],Oe=c[1],Ue=c[2],De=c[3];return u[0]=Te*f+Oe*T+Ue*V+De*ae,u[1]=Te*p+Oe*I+Ue*q+De*ce,u[2]=Te*_+Oe*M+Ue*Y+De*de,u[3]=Te*b+Oe*$+Ue*J+De*we,u[4]=(Te=c[4])*f+(Oe=c[5])*T+(Ue=c[6])*V+(De=c[7])*ae,u[5]=Te*p+Oe*I+Ue*q+De*ce,u[6]=Te*_+Oe*M+Ue*Y+De*de,u[7]=Te*b+Oe*$+Ue*J+De*we,u[8]=(Te=c[8])*f+(Oe=c[9])*T+(Ue=c[10])*V+(De=c[11])*ae,u[9]=Te*p+Oe*I+Ue*q+De*ce,u[10]=Te*_+Oe*M+Ue*Y+De*de,u[11]=Te*b+Oe*$+Ue*J+De*we,u[12]=(Te=c[12])*f+(Oe=c[13])*T+(Ue=c[14])*V+(De=c[15])*ae,u[13]=Te*p+Oe*I+Ue*q+De*ce,u[14]=Te*_+Oe*M+Ue*Y+De*de,u[15]=Te*b+Oe*$+Ue*J+De*we,u}function F(u,a,c){var f,p,_,b,T,I,M,$,V,q,Y,J,ae=c[0],ce=c[1],de=c[2];return a===u?(u[12]=a[0]*ae+a[4]*ce+a[8]*de+a[12],u[13]=a[1]*ae+a[5]*ce+a[9]*de+a[13],u[14]=a[2]*ae+a[6]*ce+a[10]*de+a[14],u[15]=a[3]*ae+a[7]*ce+a[11]*de+a[15]):(p=a[1],_=a[2],b=a[3],T=a[4],I=a[5],M=a[6],$=a[7],V=a[8],q=a[9],Y=a[10],J=a[11],u[0]=f=a[0],u[1]=p,u[2]=_,u[3]=b,u[4]=T,u[5]=I,u[6]=M,u[7]=$,u[8]=V,u[9]=q,u[10]=Y,u[11]=J,u[12]=f*ae+T*ce+V*de+a[12],u[13]=p*ae+I*ce+q*de+a[13],u[14]=_*ae+M*ce+Y*de+a[14],u[15]=b*ae+$*ce+J*de+a[15]),u}function B(u,a,c){var f=c[0],p=c[1],_=c[2];return u[0]=a[0]*f,u[1]=a[1]*f,u[2]=a[2]*f,u[3]=a[3]*f,u[4]=a[4]*p,u[5]=a[5]*p,u[6]=a[6]*p,u[7]=a[7]*p,u[8]=a[8]*_,u[9]=a[9]*_,u[10]=a[10]*_,u[11]=a[11]*_,u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15],u}function U(u,a,c){var f=Math.sin(c),p=Math.cos(c),_=a[4],b=a[5],T=a[6],I=a[7],M=a[8],$=a[9],V=a[10],q=a[11];return a!==u&&(u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[3],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[4]=_*p+M*f,u[5]=b*p+$*f,u[6]=T*p+V*f,u[7]=I*p+q*f,u[8]=M*p-_*f,u[9]=$*p-b*f,u[10]=V*p-T*f,u[11]=q*p-I*f,u}function Z(u,a,c){var f=Math.sin(c),p=Math.cos(c),_=a[0],b=a[1],T=a[2],I=a[3],M=a[8],$=a[9],V=a[10],q=a[11];return a!==u&&(u[4]=a[4],u[5]=a[5],u[6]=a[6],u[7]=a[7],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=_*p-M*f,u[1]=b*p-$*f,u[2]=T*p-V*f,u[3]=I*p-q*f,u[8]=_*f+M*p,u[9]=b*f+$*p,u[10]=T*f+V*p,u[11]=I*f+q*p,u}function X(u,a,c){var f=Math.sin(c),p=Math.cos(c),_=a[0],b=a[1],T=a[2],I=a[3],M=a[4],$=a[5],V=a[6],q=a[7];return a!==u&&(u[8]=a[8],u[9]=a[9],u[10]=a[10],u[11]=a[11],u[12]=a[12],u[13]=a[13],u[14]=a[14],u[15]=a[15]),u[0]=_*p+M*f,u[1]=b*p+$*f,u[2]=T*p+V*f,u[3]=I*p+q*f,u[4]=M*p-_*f,u[5]=$*p-b*f,u[6]=V*p-T*f,u[7]=q*p-I*f,u}function te(u,a){return u[0]=a[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=a[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=a[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function se(u,a,c){var f,p,_,b=c[0],T=c[1],I=c[2],M=Math.sqrt(b*b+T*T+I*I);return M<g?null:(b*=M=1/M,T*=M,I*=M,f=Math.sin(a),p=Math.cos(a),u[0]=b*b*(_=1-p)+p,u[1]=T*b*_+I*f,u[2]=I*b*_-T*f,u[3]=0,u[4]=b*T*_-I*f,u[5]=T*T*_+p,u[6]=I*T*_+b*f,u[7]=0,u[8]=b*I*_+T*f,u[9]=T*I*_-b*f,u[10]=I*I*_+p,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u)}function oe(u,a){var c=a[0],f=a[1],p=a[2],_=a[4],b=a[5],T=a[6],I=a[8],M=a[9],$=a[10];return u[0]=Math.sqrt(c*c+f*f+p*p),u[1]=Math.sqrt(_*_+b*b+T*T),u[2]=Math.sqrt(I*I+M*M+$*$),u}function ne(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=c+c,T=f+f,I=p+p,M=c*b,$=f*b,V=f*T,q=p*b,Y=p*T,J=p*I,ae=_*b,ce=_*T,de=_*I;return u[0]=1-V-J,u[1]=$+de,u[2]=q-ce,u[3]=0,u[4]=$-de,u[5]=1-M-J,u[6]=Y+ae,u[7]=0,u[8]=q+ce,u[9]=Y-ae,u[10]=1-M-V,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}var ee=j;function ie(){var u=new x(3);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u}function he(u){var a=new x(3);return a[0]=u[0],a[1]=u[1],a[2]=u[2],a}function Se(u){var a=u[0],c=u[1],f=u[2];return Math.sqrt(a*a+c*c+f*f)}function Ce(u,a,c){var f=new x(3);return f[0]=u,f[1]=a,f[2]=c,f}function fe(u,a,c,f){return u[0]=a,u[1]=c,u[2]=f,u}function _e(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u[2]=a[2]+c[2],u}function be(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u[2]=a[2]-c[2],u}function Pe(u,a,c){return u[0]=a[0]*c[0],u[1]=a[1]*c[1],u[2]=a[2]*c[2],u}function ye(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u}function ge(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u}function ke(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u}function Qe(u,a,c,f){return u[0]=a[0]+c[0]*f,u[1]=a[1]+c[1]*f,u[2]=a[2]+c[2]*f,u}function He(u,a){var c=a[0]-u[0],f=a[1]-u[1],p=a[2]-u[2];return Math.sqrt(c*c+f*f+p*p)}function $e(u,a){var c=a[0]-u[0],f=a[1]-u[1],p=a[2]-u[2];return c*c+f*f+p*p}function Xe(u){var a=u[0],c=u[1],f=u[2];return a*a+c*c+f*f}function ft(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u}function ze(u,a){var c=a[0],f=a[1],p=a[2],_=c*c+f*f+p*p;return _>0&&(_=1/Math.sqrt(_)),u[0]=a[0]*_,u[1]=a[1]*_,u[2]=a[2]*_,u}function ut(u,a){return u[0]*a[0]+u[1]*a[1]+u[2]*a[2]}function At(u,a,c){var f=a[0],p=a[1],_=a[2],b=c[0],T=c[1],I=c[2];return u[0]=p*I-_*T,u[1]=_*b-f*I,u[2]=f*T-p*b,u}function xt(u,a,c,f){var p=a[0],_=a[1],b=a[2];return u[0]=p+f*(c[0]-p),u[1]=_+f*(c[1]-_),u[2]=b+f*(c[2]-b),u}function nr(u,a,c){var f=a[0],p=a[1],_=a[2],b=c[3]*f+c[7]*p+c[11]*_+c[15];return u[0]=(c[0]*f+c[4]*p+c[8]*_+c[12])/(b=b||1),u[1]=(c[1]*f+c[5]*p+c[9]*_+c[13])/b,u[2]=(c[2]*f+c[6]*p+c[10]*_+c[14])/b,u}function Vt(u,a,c){var f=a[0],p=a[1],_=a[2];return u[0]=f*c[0]+p*c[3]+_*c[6],u[1]=f*c[1]+p*c[4]+_*c[7],u[2]=f*c[2]+p*c[5]+_*c[8],u}function dr(u,a,c){var f=c[0],p=c[1],_=c[2],b=c[3],T=a[0],I=a[1],M=a[2],$=p*M-_*I,V=_*T-f*M,q=f*I-p*T;return u[0]=T+b*($+=$)+p*(q+=q)-_*(V+=V),u[1]=I+b*V+_*$-f*q,u[2]=M+b*q+f*V-p*$,u}function Br(u){return u[0]=0,u[1]=0,u[2]=0,u}function Yr(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]}var _t=be,Mt=Pe,Ke=Se;function at(){var u=new x(4);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0,u[3]=0),u}function dt(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u[2]=a[2]*c,u[3]=a[3]*c,u}function tr(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=c*c+f*f+p*p+_*_;return b>0&&(b=1/Math.sqrt(b)),u[0]=c*b,u[1]=f*b,u[2]=p*b,u[3]=_*b,u}function Qt(u,a,c){var f=a[0],p=a[1],_=a[2],b=a[3];return u[0]=c[0]*f+c[4]*p+c[8]*_+c[12]*b,u[1]=c[1]*f+c[5]*p+c[9]*_+c[13]*b,u[2]=c[2]*f+c[6]*p+c[10]*_+c[14]*b,u[3]=c[3]*f+c[7]*p+c[11]*_+c[15]*b,u}function er(){var u=new x(4);return x!=Float32Array&&(u[0]=0,u[1]=0,u[2]=0),u[3]=1,u}function Pr(u){return u[0]=0,u[1]=0,u[2]=0,u[3]=1,u}function sn(u,a,c){c*=.5;var f=a[0],p=a[1],_=a[2],b=a[3],T=Math.sin(c),I=Math.cos(c);return u[0]=f*I+b*T,u[1]=p*I+_*T,u[2]=_*I-p*T,u[3]=b*I-f*T,u}function fn(u,a,c){c*=.5;var f=a[0],p=a[1],_=a[2],b=a[3],T=Math.sin(c),I=Math.cos(c);return u[0]=f*I-_*T,u[1]=p*I+b*T,u[2]=_*I+f*T,u[3]=b*I-p*T,u}ie(),at();var Ai,mi,Zi,Rs=tr,Ua=(Ai=ie(),mi=Ce(1,0,0),Zi=Ce(0,1,0),function(u,a,c){var f=ut(a,c);return f<-.999999?(At(Ai,mi,a),Ke(Ai)<1e-6&&At(Ai,Zi,a),ze(Ai,Ai),function(p,_,b){b*=.5;var T=Math.sin(b);p[0]=T*_[0],p[1]=T*_[1],p[2]=T*_[2],p[3]=Math.cos(b)}(u,Ai,Math.PI),u):f>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(At(Ai,a,c),u[0]=Ai[0],u[1]=Ai[1],u[2]=Ai[2],u[3]=1+f,Rs(u,u))});function wi(){var u=new x(2);return x!=Float32Array&&(u[0]=0,u[1]=0),u}function _s(u,a){var c=new x(2);return c[0]=u,c[1]=a,c}function zo(u,a,c){return u[0]=a,u[1]=c,u}function js(u,a,c){return u[0]=a[0]+c[0],u[1]=a[1]+c[1],u}function Bo(u,a,c){return u[0]=a[0]-c[0],u[1]=a[1]-c[1],u}function ts(u,a,c){return u[0]=a[0]*c,u[1]=a[1]*c,u}function ji(u){var a=u[0],c=u[1];return Math.sqrt(a*a+c*c)}function oo(u,a){var c=a[0],f=a[1],p=c*c+f*f;return p>0&&(p=1/Math.sqrt(p)),u[0]=a[0]*p,u[1]=a[1]*p,u}function ml(u,a){return u[0]*a[0]+u[1]*a[1]}er(),er(),E();var xr,wn,On=Bo;function Ii(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}wi();var ha=function(){if(wn)return xr;function u(a,c,f,p){this.cx=3*a,this.bx=3*(f-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*c,this.by=3*(p-c)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=f,this.p2y=p}return wn=1,xr=u,u.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,c){if(c===void 0&&(c=1e-6),a<0)return 0;if(a>1)return 1;for(var f=a,p=0;p<8;p++){var _=this.sampleCurveX(f)-a;if(Math.abs(_)<c)return f;var b=this.sampleCurveDerivativeX(f);if(Math.abs(b)<1e-6)break;f-=_/b}var T=0,I=1;for(f=a,p=0;p<20&&(_=this.sampleCurveX(f),!(Math.abs(_-a)<c));p++)a>_?T=f:I=f,f=.5*(I-T)+T;return f},solve:function(a,c){return this.sampleCurveY(this.solveCurveX(a,c))}},xr}(),$o=Ii(ha);function Nt(u,a){this.x=u,this.y=a}function Uo(u,a){if(Array.isArray(u)){if(!Array.isArray(a)||u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(!Uo(u[c],a[c]))return!1;return!0}if(typeof u=="object"&&u!==null&&a!==null){if(typeof a!="object"||Object.keys(u).length!==Object.keys(a).length)return!1;for(const c in u)if(!Uo(u[c],a[c]))return!1;return!0}return u===a}Nt.prototype={clone(){return new Nt(this.x,this.y)},add(u){return this.clone()._add(u)},sub(u){return this.clone()._sub(u)},multByPoint(u){return this.clone()._multByPoint(u)},divByPoint(u){return this.clone()._divByPoint(u)},mult(u){return this.clone()._mult(u)},div(u){return this.clone()._div(u)},rotate(u){return this.clone()._rotate(u)},rotateAround(u,a){return this.clone()._rotateAround(u,a)},matMult(u){return this.clone()._matMult(u)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(u){return this.x===u.x&&this.y===u.y},dist(u){return Math.sqrt(this.distSqr(u))},distSqr(u){const a=u.x-this.x,c=u.y-this.y;return a*a+c*c},angle(){return Math.atan2(this.y,this.x)},angleTo(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith(u){return this.angleWithSep(u.x,u.y)},angleWithSep(u,a){return Math.atan2(this.x*a-this.y*u,this.x*u+this.y*a)},_matMult(u){const a=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=a,this},_add(u){return this.x+=u.x,this.y+=u.y,this},_sub(u){return this.x-=u.x,this.y-=u.y,this},_mult(u){return this.x*=u,this.y*=u,this},_div(u){return this.x/=u,this.y/=u,this},_multByPoint(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint(u){return this.x/=u.x,this.y/=u.y,this},_unit(){return this._div(this.mag()),this},_perp(){const u=this.y;return this.y=this.x,this.x=-u,this},_rotate(u){const a=Math.cos(u),c=Math.sin(u),f=c*this.x+a*this.y;return this.x=a*this.x-c*this.y,this.y=f,this},_rotateAround(u,a){const c=Math.cos(u),f=Math.sin(u),p=a.y+f*(this.x-a.x)+c*(this.y-a.y);return this.x=a.x+c*(this.x-a.x)-f*(this.y-a.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Nt},Nt.convert=function(u){if(u instanceof Nt)return u;if(Array.isArray(u))return new Nt(+u[0],+u[1]);if(u.x!==void 0&&u.y!==void 0)return new Nt(+u.x,+u.y);throw new Error("Expected [x, y] or {x, y} point format")};const gl=Math.PI/180,rs=180/Math.PI;function xn(u){return u*gl}function ns(u){return u*rs}const Gb=[[0,0],[1,0],[1,1],[0,1]];function dg(u){if(u<=0)return 0;if(u>=1)return 1;const a=u*u,c=a*u;return 4*(u<.5?c:3*(u-a)+c-.75)}function st(u,a,c,f){const p=new $o(u,a,c,f);return function(_){return p.solve(_)}}const pe=st(.25,.1,.25,1);function ve(u,a,c){return Math.min(c,Math.max(a,u))}function Ne(u,a,c){return(c=ve((c-u)/(a-u),0,1))*c*(3-2*c)}function Ye(u,a,c){const f=c-a,p=((u-a)%f+f)%f+a;return p===a?c:p}function Ze(u,a,c){if(!u.length)return c(null,[]);let f=u.length;const p=new Array(u.length);let _=null;u.forEach((b,T)=>{a(b,(I,M)=>{I&&(_=I),p[T]=M,--f==0&&c(_,p)})})}let nt=1;function vt(){return nt++}function it(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log2(u)))}function gt(u,a){u.forEach(c=>{a[c]&&(a[c]=a[c].bind(a))})}function Ht(u,a,c){const f={};for(const p in u)f[p]=a.call(this,u[p],p,u);return f}function zt(u,a,c){const f={};for(const p in u)a.call(this,u[p],p,u)&&(f[p]=u[p]);return f}function Tr(u){return Array.isArray(u)?u.map(Tr):typeof u=="object"&&u?Ht(u,Tr):u}function Gr(u,a){for(let c=0;c<u.length;c++)if(a.indexOf(u[c])>=0)return!0;return!1}const Ur={};function kr(u){Ur[u]||(typeof console<"u"&&console.warn(u),Ur[u]=!0)}function gn(u,a,c){return(c.y-u.y)*(a.x-u.x)>(a.y-u.y)*(c.x-u.x)}function Sn(u){let a=0;for(let c,f,p=0,_=u.length,b=_-1;p<_;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}function fi([u,a,c]){const f=xn(a+90),p=xn(c);return{x:u*Math.cos(f)*Math.sin(p),y:u*Math.sin(f)*Math.sin(p),z:u*Math.cos(p),azimuthal:a,polar:c}}function sa(u){return(typeof self<"u"||u!==void 0)&&typeof WorkerGlobalScope<"u"&&(u!==void 0?u:self)instanceof WorkerGlobalScope}function Fa(u){const a={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,p,_)=>{const b=p||_;return a[f]=!b||b.toLowerCase(),""}),a["max-age"]){const c=parseInt(a["max-age"],10);isNaN(c)?delete a["max-age"]:a["max-age"]=c}return a}let Sa=null;function _a(u,a){return[u[4*a],u[4*a+1],u[4*a+2],u[4*a+3]]}function li(u,a,c,f){for(;a<c;){const p=a+c>>1;u[p]<f?a=p+1:c=p}return a}function Rn(u,a,c,f){for(;a<c;){const p=a+c>>1;u[p]<=f?a=p+1:c=p}return a}function Li(u){return u>0?1/(1.001-u):1+u}function na(u){return u>0?1-1/(1.001-u):-u}function gi(u,a,c){return(u-a.min)*(c.max-c.min)/(a.max-a.min)+c.min}const Fi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fi.API_URL)return null;try{const u=new URL(Fi.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ja(u){return Fi.API_URL_REGEX.test(u)}function is(u){return Fi.API_SPRITE_REGEX.test(u)}let Xl,Mh,so,Yl,xs,Pc;function Zs(){return Xl==null&&(Xl=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Xl}const Xs={now:()=>Yl!==void 0?Yl:performance.now(),setNow(u){Yl=u},restoreNow(){Yl=void 0},frame(u){const a=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(a)}},getImageData(u,a=0){const{width:c,height:f}=u;xs||(xs=document.createElement("canvas"));const p=xs.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(c>xs.width||f>xs.height)&&(xs.width=c,xs.height=f),p.clearRect(-a,-a,c+2*a,f+2*a),p.drawImage(u,0,0,c,f),p.getImageData(-a,-a,c+2*a,f+2*a)},resolveURL:u=>(Mh||(Mh=document.createElement("a")),Mh.href=u,Mh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(so==null&&(so=window.matchMedia("(prefers-reduced-motion: reduce)")),so.matches)},hasCanvasFingerprintNoise(){if(Pc!==void 0)return Pc;if(!Zs())return Pc=!1,!1;const u=new OffscreenCanvas(85,1),a=u.getContext("2d",{willReadFrequently:!0});let c=0;for(let p=0;p<u.width;++p)a.fillStyle=`rgba(${c++},${c++},${c++}, 255)`,a.fillRect(p,0,1,1);const f=a.getImageData(0,0,u.width,u.height);c=0;for(let p=0;p<f.data.length;++p)if(p%4!=3&&c++!==f.data[p])return Pc=!0,!0;return Pc=!1,!1}};function Mv(u,a){const c=u.indexOf("?");if(c<0)return`${u}?${new URLSearchParams(a).toString()}`;const f=new URLSearchParams(u.slice(c));for(const p in a)f.set(p,a[p]);return`${u.slice(0,c)}?${f.toString()}`}function hg(u,a={persistentParams:[]}){const c=u.indexOf("?");if(c<0)return u;const f=new URLSearchParams,p=new URLSearchParams(u.slice(c));for(const b of a.persistentParams){const T=p.get(b);T&&f.set(b,T)}const _=f.toString();return`${u.slice(0,c)}${_.length>0?`?${_}`:""}`}const fg="mapbox-tiles";let pg=500,Ns=50;const Cc=["language","worldview","jobid"];let bs,yl;function zu(){try{return caches}catch{}}function Dh(){const u=zu();u&&bs==null&&(bs=u.open(fg))}let Dv=1/0;const Lv={supported:!1,testSupport:function(u){!Hb&&Ld&&(oA?Kb(u):ru=u)}};let ru,Ld,Hb=!1,oA=!1;const Jl=typeof self<"u"?self:{};function Kb(u){const a=u.createTexture();u.bindTexture(u.TEXTURE_2D,a);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,Ld),u.isContextLost())return;Lv.supported=!0}catch{}u.deleteTexture(a),Hb=!0}Jl.document&&(Ld=Jl.document.createElement("img"),Ld.onload=function(){ru&&Kb(ru),ru=null,oA=!0},Ld.onerror=function(){Hb=!0,ru=null},Ld.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Lh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Lh);class Fh extends Error{constructor(a,c,f){c===401&&Ja(f)&&(a+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(a),this.status=c,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zb=sa()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,mg=function(u,a){if(!(/^file:/.test(c=u.url)||/^file:/.test(Zb())&&!/^\w+:/.test(c))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(f,p){const _=new AbortController,b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Zb(),referrerPolicy:f.referrerPolicy,signal:_.signal});let T=!1,I=!1;const M=($=b.url).indexOf("sku=")>0&&Ja($);var $;f.type==="json"&&b.headers.set("Accept","application/json");const V=(Y,J,ae)=>{if(I)return;if(Y&&Y.message!=="SecurityError"&&kr(Y.toString()),J&&ae)return q(J);const ce=Date.now();fetch(b).then(de=>{if(de.ok){const we=M?de.clone():null;return q(de,we,ce)}return p(new Fh(de.statusText,de.status,f.url))}).catch(de=>{de.name!=="AbortError"&&p(new Error(`${de.message} ${f.url}`))})},q=(Y,J,ae)=>{(f.type==="arrayBuffer"?Y.arrayBuffer():f.type==="json"?Y.json():Y.text()).then(ce=>{I||(J&&ae&&function(de,we,Te){if(Dh(),bs==null)return;const Oe=Fa(we.headers.get("Cache-Control")||"");if(Oe["no-store"])return;const Ue={status:we.status,statusText:we.statusText,headers:new Headers};we.headers.forEach((Je,tt)=>Ue.headers.set(tt,Je)),Oe["max-age"]&&Ue.headers.set("Expires",new Date(Te+1e3*Oe["max-age"]).toUTCString());const De=Ue.headers.get("Expires");if(!De||new Date(De).getTime()-Te<42e4)return;let Ge=hg(de.url,{persistentParams:Cc});if(we.status===206){const Je=de.headers.get("Range");if(!Je)return;Ue.status=200,Ge=Mv(Ge,{range:Je})}(function(Je,tt){if(yl===void 0)try{new Response(new ReadableStream),yl=!0}catch{yl=!1}yl?tt(Je.body):Je.blob().then(tt).catch(Et=>kr(Et.message))})(we,Je=>{const tt=new Response((Et=we.status)!==200&&Et!==404&&[101,103,204,205,304].includes(Et)?null:Je,Ue);var Et;Dh(),bs!=null&&bs.then(ct=>ct.put(Ge,tt)).catch(ct=>kr(ct.message))})}(b,J,ae),T=!0,p(null,ce,Y.headers))}).catch(ce=>{I||p(new Error(ce.message))})};return M?function(Y,J){if(Dh(),bs==null)return J(null);bs.then(ae=>{let ce=hg(Y.url,{persistentParams:Cc});const de=Y.headers.get("Range");de&&(ce=Mv(ce,{range:de})),ae.match(ce).then(we=>{const Te=function(Oe){if(!Oe)return!1;const Ue=new Date(Oe.headers.get("Expires")||0),De=Fa(Oe.headers.get("Cache-Control")||"");return Number(Ue)>Date.now()&&!De["no-cache"]}(we);ae.delete(ce).catch(J),Te&&ae.put(ce,we.clone()).catch(J),J(null,we,Te)}).catch(J)}).catch(J)}(b,V):V(null,null),{cancel:()=>{I=!0,T||_.abort()}}}(u,a);if(sa(self)&&self.worker.actor)return self.worker.actor.send("getResource",u,a,void 0,!0)}var c;return function(f,p){const _=new XMLHttpRequest;_.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const b in f.headers)_.setRequestHeader(b,f.headers[b]);return f.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=f.credentials==="include",_.onerror=()=>{p(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let b=_.response;if(f.type==="json")try{b=JSON.parse(_.response)}catch(I){return p(I)}const T=new Headers;_.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(I=>{const M=I.split(": "),$=M.shift(),V=M.join(": ");T.append($,V)}),p(null,b,T)}else p(new Fh(_.statusText,_.status,f.url))},_.send(f.body),{cancel:()=>_.abort()}}(u,a)},Zf=function(u,a){return mg(Object.assign(u,{type:"arrayBuffer"}),a)};function Zn(u){const a=document.createElement("a");return a.href=u,a.protocol===location.protocol&&a.host===location.host}const Xb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gg,yg;gg=[],yg=0;const Yb=function(u,a){if(Lv.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),yg>=Fi.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:u,callback:a,cancelled:!1,cancel(){this.cancelled=!0}};return gg.push(_),_}yg++;let c=!1;const f=()=>{if(!c)for(c=!0,yg--;gg.length&&yg<Fi.MAX_PARALLEL_IMAGE_REQUESTS;){const _=gg.shift(),{requestParameters:b,callback:T,cancelled:I}=_;I||(_.cancel=Yb(b,T).cancel)}},p=Zf(u,(_,b,T)=>{f(),_?a(_):b&&(self.createImageBitmap?function(I,M){const $=new Blob([new Uint8Array(I)],{type:"image/png"});createImageBitmap($).then(V=>{M(null,V)}).catch(V=>{M(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(I,M)=>a(I,M,T)):function(I,M){const $=new Image;$.onload=()=>{M(null,$),URL.revokeObjectURL($.src),$.onload=null,requestAnimationFrame(()=>{$.src=Xb})},$.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Blob([new Uint8Array(I)],{type:"image/png"});$.src=I.byteLength?URL.createObjectURL(V):Xb}(b,(I,M)=>a(I,M,T)))});return{cancel:()=>{p.cancel(),f()}}};var vg,_g,xg,zh={exports:{}},sA={exports:{}},Fv={exports:{}},LR=function(){if(xg)return zh.exports;xg=1;var u=(vg||(vg=1,sA.exports=function(c,f){var p,_,b,T,I,M,$,V;for(_=c.length-(p=3&c.length),b=f,I=3432918353,M=461845907,V=0;V<_;)$=255&c.charCodeAt(V)|(255&c.charCodeAt(++V))<<8|(255&c.charCodeAt(++V))<<16|(255&c.charCodeAt(++V))<<24,++V,b=27492+(65535&(T=5*(65535&(b=(b^=$=(65535&($=($=(65535&$)*I+((($>>>16)*I&65535)<<16)&4294967295)<<15|$>>>17))*M+((($>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch($=0,p){case 3:$^=(255&c.charCodeAt(V+2))<<16;case 2:$^=(255&c.charCodeAt(V+1))<<8;case 1:b^=$=(65535&($=($=(65535&($^=255&c.charCodeAt(V)))*I+((($>>>16)*I&65535)<<16)&4294967295)<<15|$>>>17))*M+((($>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),sA.exports),a=(_g||(_g=1,Fv.exports=function(c,f){for(var p,_=c.length,b=f^_,T=0;_>=4;)p=1540483477*(65535&(p=255&c.charCodeAt(T)|(255&c.charCodeAt(++T))<<8|(255&c.charCodeAt(++T))<<16|(255&c.charCodeAt(++T))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++T;switch(_){case 3:b^=(255&c.charCodeAt(T+2))<<16;case 2:b^=(255&c.charCodeAt(T+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(T)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Fv.exports);return zh.exports=u,zh.exports.murmur3=u,zh.exports.murmur2=a,zh.exports}(),bg=Ii(LR);class vl{constructor(a,...c){Object.assign(this,c[0]||{}),this.type=a}}class wg extends vl{constructor(a,c={}){super("error",Object.assign({error:a},c))}}function Xf(u,a,c){c[u]&&c[u].indexOf(a)!==-1||(c[u]=c[u]||[],c[u].push(a))}function Sg(u,a,c){if(c&&c[u]){const f=c[u].indexOf(a);f!==-1&&c[u].splice(f,1)}}class Bu{on(a,c){return this._listeners=this._listeners||{},Xf(a,c,this._listeners),this}off(a,c){return Sg(a,c,this._listeners),Sg(a,c,this._oneTimeListeners),this}once(a,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Xf(a,c,this._oneTimeListeners),this):new Promise(f=>{this.once(a,f)})}fire(a,c){const f=typeof a=="string"?new vl(a,c):a,p=f.type;if(this.listens(p)){f.target=this;const _=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const I of _)I.call(this,f);const b=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const I of b)Sg(p,I,this._oneTimeListeners),I.call(this,f);const T=this._eventedParent;if(T){const I=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(f,I),T.fire(f)}}else f instanceof wg&&console.error(f.error);return this}listens(a){return!!(this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a))}setEventedParent(a,c){return this._eventedParent=a,this._eventedParentData=c,this}}class Qa{constructor(a){typeof a=="string"?this.name=a:(this.name=a.name,this.iconsetId=a.iconsetId)}static from(a){return new Qa(a)}static toString(a){return a.iconsetId?`${a.name}${a.iconsetId}`:a.name}static parse(a){const[c,f]=a.split("");return new Qa({name:c,iconsetId:f})}static isEqual(a,c){return a.name===c.name&&a.iconsetId===c.iconsetId}toString(){return Qa.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Jb,Qb={},ew=function(){if(Jb)return Qb;Jb=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function a(_){return(_=Math.round(_))<0?0:_>255?255:_}function c(_){return a(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function f(_){return(b=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:b>1?1:b;var b}function p(_,b,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?_+(b-_)*T*6:2*T<1?b:3*T<2?_+(b-_)*(2/3-T)*6:_}try{Qb.parseCSSColor=function(_){var b,T=_.replace(/ /g,"").toLowerCase();if(T in u)return u[T].slice();if(T[0]==="#")return T.length===4?(b=parseInt(T.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:T.length===7&&(b=parseInt(T.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var I=T.indexOf("("),M=T.indexOf(")");if(I!==-1&&M+1===T.length){var $=T.substr(0,I),V=T.substr(I+1,M-(I+1)).split(","),q=1;switch($){case"rgba":if(V.length!==4)return null;q=f(V.pop());case"rgb":return V.length!==3?null:[c(V[0]),c(V[1]),c(V[2]),q];case"hsla":if(V.length!==4)return null;q=f(V.pop());case"hsl":if(V.length!==3)return null;var Y=(parseFloat(V[0])%360+360)%360/360,J=f(V[1]),ae=f(V[2]),ce=ae<=.5?ae*(J+1):ae+J-ae*J,de=2*ae-ce;return[a(255*p(de,ce,Y+1/3)),a(255*p(de,ce,Y)),a(255*p(de,ce,Y-1/3)),q];default:return null}}return null}}catch{}return Qb}();class ri{constructor(a,c,f,p=1){this.r=a,this.g=c,this.b=f,this.a=p}static parse(a){if(!a)return;if(a instanceof ri)return a;if(typeof a!="string")return;const c=ew.parseCSSColor(a);return c?new ri(c[0]/255,c[1]/255,c[2]/255,c[3]):void 0}toString(){const[a,c,f,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*a)},${Math.round(255*c)},${Math.round(255*f)},${p})`}toNonPremultipliedRenderColor(a){const{r:c,g:f,b:p,a:_}=this;return new lA(a,c,f,p,_)}toPremultipliedRenderColor(a){const{r:c,g:f,b:p,a:_}=this;return new cA(a,c*_,f*_,p*_,_)}clone(){return new ri(this.r,this.g,this.b,this.a)}}class tw{constructor(a,c,f,p,_,b=!1){if(this.premultiplied=!1,this.premultiplied=b,a){const T=a.image.height,I=T*T;this.premultiplied?(c=_===0?0:c/_*(T-1),f=_===0?0:f/_*(T-1),p=_===0?0:p/_*(T-1)):(c*=T-1,f*=T-1,p*=T-1);const M=Math.floor(c),$=Math.floor(f),V=Math.floor(p),q=Math.ceil(c),Y=Math.ceil(f),J=Math.ceil(p),ae=c-M,ce=f-$,de=p-V,we=a.image.data,Te=4*(M+$*I+V*T),Oe=4*(M+$*I+J*T),Ue=4*(M+Y*I+V*T),De=4*(M+Y*I+J*T),Ge=4*(q+$*I+V*T),Je=4*(q+$*I+J*T),tt=4*(q+Y*I+V*T),Et=4*(q+Y*I+J*T);if(Te<0||Et>=we.length)throw new Error("out of range");this.r=$r($r($r(we[Te],we[Oe],de),$r(we[Ue],we[De],de),ce),$r($r(we[Ge],we[Je],de),$r(we[tt],we[Et],de),ce),ae)/255*(this.premultiplied?_:1),this.g=$r($r($r(we[Te+1],we[Oe+1],de),$r(we[Ue+1],we[De+1],de),ce),$r($r(we[Ge+1],we[Je+1],de),$r(we[tt+1],we[Et+1],de),ce),ae)/255*(this.premultiplied?_:1),this.b=$r($r($r(we[Te+2],we[Oe+2],de),$r(we[Ue+2],we[De+2],de),ce),$r($r(we[Ge+2],we[Je+2],de),$r(we[tt+2],we[Et+2],de),ce),ae)/255*(this.premultiplied?_:1),this.a=_}else this.r=c,this.g=f,this.b=p,this.a=_}toArray(){const{r:a,g:c,b:f,a:p}=this;return[255*a,255*c,255*f,p]}toHslaArray(){let{r:a,g:c,b:f,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const J=1/p;a*=J,c*=J,f*=J}const _=Math.min(Math.max(a,0),1),b=Math.min(Math.max(c,0),1),T=Math.min(Math.max(f,0),1),I=Math.min(_,b,T),M=Math.max(_,b,T),$=M-I,V=.5*(I+M);if($===0)return[0,0,100*V,p];const q=V>.5?$/(2-M-I):$/(M+I);let Y;switch(M){case _:Y=60*((b-T)/$+(b<T?6:0));break;case b:Y=60*((T-_)/$+2);break;default:Y=60*((_-b)/$+4)}return[Y,100*q,100*V,p]}toArray01(){const{r:a,g:c,b:f,a:p}=this;return[a,c,f,p]}toArray01Scaled(a){const{r:c,g:f,b:p}=this;return[c*a,f*a,p*a]}toArray01Linear(){const{r:a,g:c,b:f,a:p}=this;return[Math.pow(a,2.2),Math.pow(c,2.2),Math.pow(f,2.2),p]}}class lA extends tw{constructor(a,c,f,p,_){super(a,c,f,p,_,!1)}}class cA extends tw{constructor(a,c,f,p,_){super(a,c,f,p,_,!0)}}function $r(u,a,c){return u*(1-c)+a*c}function Eg(u,a,c){return u.map((f,p)=>$r(f,a[p],c))}ri.black=new ri(0,0,0,1),ri.white=new ri(1,1,1,1),ri.transparent=new ri(0,0,0,0),ri.red=new ri(1,0,0,1),ri.blue=new ri(0,0,1,1);var $u=Object.freeze({__proto__:null,array:Eg,color:function(u,a,c){return new ri($r(u.r,a.r,c),$r(u.g,a.g,c),$r(u.b,a.b,c),$r(u.a,a.a,c))},number:$r});class Ql extends Error{constructor(a,c){super(c),this.message=c,this.key=a}}class ec{constructor(a,c=[]){this.parent=a,this.bindings={};for(const[f,p]of c)this.bindings[f]=p}concat(a){return new ec(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Yf={kind:"null"},Cr={kind:"number"},$n={kind:"string"},ei={kind:"boolean"},Ys={kind:"color"},Jf={kind:"object"},ai={kind:"value"},Tg={kind:"collator"},Bh={kind:"formatted"},Ag={kind:"resolvedImage"};function bo(u,a){return{kind:"array",itemType:u,N:a}}function Va(u){if(u.kind==="array"){const a=Va(u.itemType);return typeof u.N=="number"?`array<${a}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${a}>`}return u.kind}const FR=[Yf,Cr,$n,ei,Ys,Bh,Jf,bo(ai),Ag];function Pg(u,a){if(a.kind==="error")return null;if(u.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Pg(u.itemType,a.itemType))&&(typeof u.N!="number"||u.N===a.N))return null}else{if(u.kind===a.kind)return null;if(u.kind==="value"){for(const c of FR)if(!Pg(c,a))return null}}return`Expected ${Va(u)} but found ${Va(a)} instead.`}function rw(u,a){return a.some(c=>c.kind===u.kind)}function Cg(u,a){return a.some(c=>c==="null"?u===null:c==="array"?Array.isArray(u):c==="object"?u&&!Array.isArray(u)&&typeof u=="object":c===typeof u)}function zv(u,a){return u.kind==="array"&&a.kind==="array"?u.N===a.N&&zv(u.itemType,a.itemType):u.kind===a.kind}class nw{constructor(a,c,f){this.sensitivity=a?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,c){return this.collator.compare(a,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Og{constructor(a,c,f,p,_){this.text=a.normalize?a.normalize():a,this.image=c,this.scale=f,this.fontStack=p,this.textColor=_}}class fo{constructor(a){this.sections=a}static fromString(a){return new fo([new Og(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||!!a.image&&a.image.hasPrimary())}static factory(a){return a instanceof fo?a:fo.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}serialize(){const a=["format"];for(const c of this.sections){if(c.image){const p=c.image.getPrimary().id.toString();a.push(["image",p]);continue}a.push(c.text);const f={};c.fontStack&&(f["text-font"]=["literal",c.fontStack.split(",")]),c.scale&&(f["font-scale"]=c.scale),c.textColor&&(f["text-color"]=["rgba"].concat(c.textColor.toNonPremultipliedRenderColor(null).toArray())),a.push(f)}return a}}class Uu{constructor(a,c={}){if(this.id=Qa.from(a),this.options=Object.assign({},c),c.transform){const{a:f,b:p,c:_,d:b,e:T,f:I}=c.transform;this.options.transform=new DOMMatrix([f,p,_,b,T,I])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a,b:c,c:f,d:p,e:_,f:b}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a,b:c,c:f,d:p,e:_,f:b}})}static parse(a){let c,f,p,_;try{({name:c,iconsetId:f,params:p,transform:_}=JSON.parse(a)||{})}catch{return null}if(!c)return null;const{a:b,b:T,c:I,d:M,e:$,f:V}=_||{};return new Uu({name:c,iconsetId:f},{params:p,transform:new DOMMatrix([b,T,I,M,$,V])})}scaleSelf(a,c){return this.options.transform.scaleSelf(a,c),this}}class Ms{constructor(a,c,f,p,_=!1){this.primaryId=Qa.from(a),this.primaryOptions=c,f&&(this.secondaryId=Qa.from(f)),this.secondaryOptions=p,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Uu(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Uu(this.secondaryId,this.secondaryOptions):null}static from(a){return typeof a=="string"?Ms.build({name:a}):a}static build(a,c,f,p){return!a||typeof a=="object"&&!("name"in a)?null:new Ms(a,f,c,p)}}function Bv(u,a,c,f){return typeof u=="number"&&u>=0&&u<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[u,a,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[u,a,c,f]:[u,a,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qf(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof ri||u instanceof nw||u instanceof fo||u instanceof Ms)return!0;if(Array.isArray(u)){for(const a of u)if(!Qf(a))return!1;return!0}if(typeof u=="object"){for(const a in u)if(!Qf(u[a]))return!1;return!0}return!1}function lo(u){if(u===null)return Yf;if(typeof u=="string")return $n;if(typeof u=="boolean")return ei;if(typeof u=="number")return Cr;if(u instanceof ri)return Ys;if(u instanceof nw)return Tg;if(u instanceof fo)return Bh;if(u instanceof Ms)return Ag;if(Array.isArray(u)){const a=u.length;let c;for(const f of u){const p=lo(f);if(c){if(c===p)continue;c=ai;break}c=p}return bo(c||ai,a)}return Jf}function nu(u){const a=typeof u;return u===null?"":a==="string"||a==="number"||a==="boolean"?String(u):u instanceof fo||u instanceof Ms||u instanceof ri?u.toString():JSON.stringify(u)}class Vu{constructor(a,c){this.type=a,this.value=c}static parse(a,c){if(a.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Qf(a[1]))return c.error("invalid value");const f=a[1];let p=lo(f);const _=c.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new Vu(p,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof fo?this.value.serialize():this.value}}class Ea{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const pn={string:$n,number:Cr,boolean:ei,object:Jf};class Sr{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");let f,p=1;const _=a[0];if(_==="array"){let T,I;if(a.length>2){const M=a[1];if(typeof M!="string"||!(M in pn)||M==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=pn[M],p++}else T=ai;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=a[2],p++}f=bo(T,I)}else f=pn[_];const b=[];for(;p<a.length;p++){const T=c.parse(a[p],p,ai);if(!T)return null;b.push(T)}return new Sr(f,b)}evaluate(a){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(a);if(!Pg(this.type,lo(f)))return f;if(c===this.args.length-1)throw new Ea(`The expression ${JSON.stringify(this.args[c].serialize())} evaluated to ${Va(lo(f))} but was expected to be of type ${Va(this.type)}.`)}return null}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=this.type,c=[a.kind];if(a.kind==="array"){const f=a.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){c.push(f.kind);const p=a.N;(typeof p=="number"||this.args.length>1)&&c.push(p)}}return c.concat(this.args.map(f=>f.serialize()))}}class $h{constructor(a){this.type=Bh,this.sections=a}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const f=a[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=a.length-1;++b){const T=a[b];if(_&&typeof T=="object"&&!Array.isArray(T)){_=!1;let I=null;if(T["font-scale"]&&(I=c.parseObjectValue(T["font-scale"],b,"font-scale",Cr),!I))return null;let M=null;if(T["text-font"]&&(M=c.parseObjectValue(T["text-font"],b,"text-font",bo($n)),!M))return null;let $=null;if(T["text-color"]&&($=c.parseObjectValue(T["text-color"],b,"text-color",Ys),!$))return null;const V=p[p.length-1];V.scale=I,V.font=M,V.textColor=$}else{const I=c.parse(a[b],b,ai);if(!I)return null;const M=I.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:I,scale:null,font:null,textColor:null})}}return new $h(p)}evaluate(a){return new fo(this.sections.map(c=>{const f=c.content.evaluate(a);return zv(lo(f),Ag)?new Og("",f,null,null,null):new Og(nu(f),null,c.scale?c.scale.evaluate(a):null,c.font?c.font.evaluate(a).join(","):null,c.textColor?c.textColor.evaluate(a):null)}))}eachChild(a){for(const c of this.sections)a(c.content),c.scale&&a(c.scale),c.font&&a(c.font),c.textColor&&a(c.textColor)}outputDefined(){return!1}serialize(){const a=["format"];for(const c of this.sections){a.push(c.content.serialize());const f={};c.scale&&(f["font-scale"]=c.scale.serialize()),c.font&&(f["text-font"]=c.font.serialize()),c.textColor&&(f["text-color"]=c.textColor.serialize()),a.push(f)}return a}}class Xr{constructor(a,c,f,p){this._imageWarnHistory={},this.type=Ag,this.namePrimary=a,this.nameSecondary=c,f&&(this.paramsPrimary=f.params,this.iconsetIdPrimary=f.iconset?f.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(a,c){if(a.length<2)return c.error("Expected two or more arguments.");let f=1;const p=[];function _(){if(f<a.length){const T=c.parse(a[f],f++,$n);return T?(p.push({image:T,options:{}}),!0):(c.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function b(){if(f<a.length){const I=a[f];if((T=I)===null||typeof T!="object"||Array.isArray(T))return!0;const M=I.params,$=I.iconset,V=c.concat(f);if(!M&&!$)return f++,!0;if(M){if(typeof M!="object"||M.constructor!==Object)return V.error('Image options "params" should be an object'),!1;const q={},Y=V.concat(void 0,"params");for(const J in M){if(!J)return Y.error("Image parameter name should be non-empty"),!1;const ae=Y.concat(void 0,J).parse(M[J],void 0,Ys,void 0,{typeAnnotation:"coerce"});if(!ae)return!1;q[J]=ae}p[p.length-1].options.params=q}if($){if(typeof $!="object"||$.constructor!==Object)return V.error('Image options "iconset" should be an object'),!1;if(!$.id)return V.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=$}return f++,!0}var T;return!0}for(let T=0;T<2;T++)if(!_()||!b())return;return new Xr(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(a,c){const f={};if(c){for(const p in c)if(c[p])try{f[p]=c[p].evaluate(a)}catch{continue}if(Object.keys(f).length!==0)return{params:f}}}evaluate(a){const c={name:this.namePrimary.evaluate(a),iconsetId:this.iconsetIdPrimary},f=this.nameSecondary?{name:this.nameSecondary.evaluate(a),iconsetId:this.iconsetIdSecondary}:void 0,p=Ms.build(c,f,this.paramsPrimary?this.evaluateParams(a,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(a,this.paramsSecondary):void 0);if(p&&a.availableImages){const _=p.getPrimary().id;if(p.available=a.availableImages.some(b=>Qa.isEqual(b,_)),p.available){const b=p.getSecondary()?p.getSecondary().id:null;b&&(p.available=a.availableImages.some(T=>Qa.isEqual(T,b)))}}return p}eachChild(a){if(a(this.namePrimary),this.paramsPrimary)for(const c in this.paramsPrimary)this.paramsPrimary[c]&&a(this.paramsPrimary[c]);if(this.nameSecondary&&(a(this.nameSecondary),this.paramsSecondary))for(const c in this.paramsSecondary)this.paramsSecondary[c]&&a(this.paramsSecondary[c])}outputDefined(){return!1}serializeOptions(a,c){const f={};if(c&&(f.iconset={id:c}),a){f.params={};for(const p in a)a[p]&&(f.params[p]=a[p].serialize())}return Object.keys(f).length>0?f:void 0}serialize(){const a=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const c=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);c&&a.push(c)}if(this.nameSecondary&&(a.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const c=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);c&&a.push(c)}return a}}function ep(u){return qr(u)?"string":Ig(u)?"number":Uv(u)?"boolean":Array.isArray(u)?"array":u===null?"null":$v(u)?"object":typeof u}function $v(u){return u!=null&&!Array.isArray(u)&&typeof u!="function"&&!(u instanceof String||u instanceof Number||u instanceof Boolean)&&typeof u=="object"}function qr(u){return typeof u=="string"||u instanceof String}function Ig(u){return typeof u=="number"||u instanceof Number}function Uv(u){return typeof u=="boolean"||u instanceof Boolean}const uA={"to-boolean":ei,"to-color":Ys,"to-number":Cr,"to-string":$n};class iu{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expected at least one argument.");const f=a[0],p=[];let _=Yf;if(f==="to-array"){if(!Array.isArray(a[1]))return null;const b=a[1].length;if(c.expectedType){if(c.expectedType.kind!=="array")return c.error(`Expected ${c.expectedType.kind} but found array.`);_=bo(c.expectedType.itemType,b)}else{if(!(b>0&&Qf(a[1][0])))return null;_=bo(lo(a[1][0]),b)}for(let T=0;T<b;T++){const I=a[1][T];let M;if(Array.isArray(I))M=c.parse(I,void 0,_.itemType);else{const $=ep(I);if($!==_.itemType.kind)return c.error(`Expected ${_.itemType.kind} but found ${$}.`);M=c.registry.literal.parse(["literal",I===void 0?null:I],c)}if(!M)return null;p.push(M)}}else{if((f==="to-boolean"||f==="to-string")&&a.length!==2)return c.error("Expected one argument.");_=uA[f];for(let b=1;b<a.length;b++){const T=c.parse(a[b],b,ai);if(!T)return null;p.push(T)}}return new iu(_,p)}evaluate(a){if(this.type.kind==="boolean")return!!this.args[0].evaluate(a);if(this.type.kind==="color"){let c,f;for(const p of this.args){if(c=p.evaluate(a),f=null,c instanceof ri)return c;if(typeof c=="string"){const _=a.parseColor(c);if(_)return _}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:Bv(c[0],c[1],c[2],c[3]),!f))return new ri(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new Ea(f||`Could not parse color from value '${typeof c=="string"?c:String(JSON.stringify(c))}'`)}if(this.type.kind==="number"){let c=null;for(const f of this.args){if(c=f.evaluate(a),c===null)return 0;const p=Number(c);if(!isNaN(p))return p}throw new Ea(`Could not convert ${JSON.stringify(c)} to number.`)}return this.type.kind==="formatted"?fo.fromString(nu(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Ms.build(nu(this.args[0].evaluate(a))):this.type.kind==="array"?this.args.map(c=>c.evaluate(a)):nu(this.args[0].evaluate(a))}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $h([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xr(this.args[0]).serialize();const a=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(c=>{a.push(c.serialize())}),a}}const Vv=["Unknown","Point","LineString","Polygon"];class wo{constructor(a,c,f){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=a,this.options=c,this.iconImageUseTheme=f}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Vv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(a){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,c=this.featureDistanceData.scale,{x:f,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(f*c-a[0])+this.featureDistanceData.bearing[1]*(p*c-a[1])}return 0}parseColor(a){let c=this._parseColorCache[a];return c||(c=this._parseColorCache[a]=ri.parse(a)),c}getConfig(a){return this.options?this.options.get(a):null}}class as{constructor(a,c,f,p,_){this.name=a,this.type=c,this._evaluate=f,this.args=p,this._overloadIndex=_}evaluate(a){if(!this._evaluate){const c=as.definitions[this.name];this._evaluate=Array.isArray(c)?c[2]:c.overloads[this._overloadIndex][1]}return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(a=>a.serialize()))}static parse(a,c){const f=a[0],p=as.definitions[f];if(!p)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=[];let I=null,M=-1;for(const[$,V]of b){if(Array.isArray($)&&$.length!==a.length-1)continue;T.push($),M++,I=new Qv(c.registry,c.path,null,c.scope,void 0,c._scope,c.options,c.iconImageUseTheme);const q=[];let Y=!1;for(let J=1;J<a.length;J++){const ae=a[J],ce=Array.isArray($)?$[J-1]:$.type,de=I.parse(ae,1+q.length,ce);if(!de){Y=!0;break}q.push(de)}if(!Y)if(Array.isArray($)&&$.length!==q.length)I.error(`Expected ${$.length} arguments, but found ${q.length} instead.`);else{for(let J=0;J<q.length;J++){const ae=Array.isArray($)?$[J]:$.type,ce=q[J];I.concat(J+1).checkSubtype(ae,ce.type)}if(I.errors.length===0)return new as(f,_,V,q,M)}}if(T.length===1)c.errors.push(...I.errors);else{const $=(T.length?T:b.map(([q])=>q)).map(Uh).join(" | "),V=[];for(let q=1;q<a.length;q++){const Y=c.parse(a[q],1+V.length);if(!Y)return null;V.push(Va(Y.type))}c.error(`Expected arguments of type ${$}, but found (${V.join(", ")}) instead.`)}return null}static register(a,c){as.definitions=c;for(const f in c)a[f]=as}}function Uh(u){return Array.isArray(u)?`(${u.map(Va).join(", ")})`:`(${Va(u.type)}...)`}class tp{constructor(a,c,f){this.type=Tg,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=c}static parse(a,c){if(a.length!==2)return c.error("Expected one argument.");const f=a[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const p=f["case-sensitive"]===void 0?c.parse(!1,1,ei):c.parseObjectValue(f["case-sensitive"],1,"case-sensitive",ei);if(!p)return null;const _=f["diacritic-sensitive"]===void 0?c.parse(!1,1,ei):c.parseObjectValue(f["diacritic-sensitive"],1,"diacritic-sensitive",ei);if(!_)return null;let b=null;return f.locale&&(b=c.parseObjectValue(f.locale,1,"locale",$n),!b)?null:new tp(p,_,b)}evaluate(a){return new nw(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}serialize(){const a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]}}function qu(u,a,c=0,f=u.length-1,p=zR){for(;f>c;){if(f-c>600){const I=f-c+1,M=a-c+1,$=Math.log(I),V=.5*Math.exp(2*$/3),q=.5*Math.sqrt($*V*(I-V)/I)*(M-I/2<0?-1:1);qu(u,a,Math.max(c,Math.floor(a-M*V/I+q)),Math.min(f,Math.floor(a+(I-M)*V/I+q)),p)}const _=u[a];let b=c,T=f;for(So(u,c,a),p(u[f],_)>0&&So(u,c,f);b<T;){for(So(u,b,T),b++,T--;p(u[b],_)<0;)b++;for(;p(u[T],_)>0;)T--}p(u[c],_)===0?So(u,c,T):(T++,So(u,T,f)),T<=a&&(c=T+1),a<=T&&(f=T-1)}}function So(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}function zR(u,a){return u<a?-1:u>a?1:0}function BR(u){let a=0;for(let c,f,p=0,_=u.length,b=_-1;p<_;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}function kg(u,a){u[0]=Math.min(u[0],a[0]),u[1]=Math.min(u[1],a[1]),u[2]=Math.max(u[2],a[0]),u[3]=Math.max(u[3],a[1])}function Fd(u,a){return!(u[0]<=a[0]||u[2]>=a[2]||u[1]<=a[1]||u[3]>=a[3])}function dA(u,a,c){const f=u[0]-a[0],p=u[1]-a[1],_=u[0]-c[0],b=u[1]-c[1];return f*b-_*p==0&&f*_<=0&&p*b<=0}function tc(u,a,c=!1){let f=!1;for(let T=0,I=a.length;T<I;T++){const M=a[T];for(let $=0,V=M.length,q=V-1;$<V;q=$++){const Y=M[q],J=M[$];if(dA(u,Y,J))return c;(_=Y)[1]>(p=u)[1]!=(b=J)[1]>p[1]&&p[0]<(b[0]-_[0])*(p[1]-_[1])/(b[1]-_[1])+_[0]&&(f=!f)}}var p,_,b;return f}function hA(u,a,c,f){const p=f[0]-c[0],_=f[1]-c[1],b=(u[0]-c[0])*_-p*(u[1]-c[1]),T=(a[0]-c[0])*_-p*(a[1]-c[1]);return b>0&&T<0||b<0&&T>0}function qv(u,a,c,f){return(p=[f[0]-c[0],f[1]-c[1]])[0]*(_=[a[0]-u[0],a[1]-u[1]])[1]-p[1]*_[0]!=0&&!(!hA(u,a,c,f)||!hA(c,f,u,a));var p,_}function Rg(u){const a=new Nt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),c=new Nt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const f of u[0])a.x>f.x&&(a.x=f.x),a.y>f.y&&(a.y=f.y),c.x<f.x&&(c.x=f.x),c.y<f.y&&(c.y=f.y);return{min:a,max:c}}const zd=8192;function $R(u,a){const c=(180+u[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,p=Math.pow(2,a.z);return[Math.round(c*p*zd),Math.round(f*p*zd)]}function fA(u,a){for(let c=0;c<a.length;c++)if(tc(u,a[c]))return!0;return!1}function UR(u,a,c){for(const f of c)for(let p=0,_=f.length,b=_-1;p<_;b=p++)if(qv(u,a,f[b],f[p]))return!0;return!1}function Bd(u,a){for(let c=0;c<u.length;++c)if(!tc(u[c],a))return!1;for(let c=0;c<u.length-1;++c)if(UR(u[c],u[c+1],a))return!1;return!0}function VR(u,a){for(let c=0;c<a.length;c++)if(Bd(u,a[c]))return!0;return!1}function iw(u,a,c){const f=[];for(let p=0;p<u.length;p++){const _=[];for(let b=0;b<u[p].length;b++){const T=$R(u[p][b],c);kg(a,T),_.push(T)}f.push(_)}return f}function Wv(u,a,c){const f=[];for(let p=0;p<u.length;p++){const _=iw(u[p],a,c);f.push(_)}return f}function aw(u,a,c,f){if(u[0]<c[0]||u[0]>c[2]){const p=.5*f;let _=u[0]-c[0]>p?-f:c[0]-u[0]>p?f:0;_===0&&(_=u[0]-c[2]>p?-f:c[2]-u[0]>p?f:0),u[0]+=_}kg(a,u)}function ow(u,a,c,f){const p=Math.pow(2,f.z)*zd,_=[f.x*zd,f.y*zd],b=[];if(!u)return b;for(const T of u)for(const I of T){const M=[I.x+_[0],I.y+_[1]];aw(M,a,c,p),b.push(M)}return b}function rc(u,a,c,f){const p=Math.pow(2,f.z)*zd,_=[f.x*zd,f.y*zd],b=[];if(!u)return b;for(const I of u){const M=[];for(const $ of I){const V=[$.x+_[0],$.y+_[1]];kg(a,V),M.push(V)}b.push(M)}if(a[2]-a[0]<=p/2){(T=a)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of b)for(const M of I)aw(M,a,c,p)}var T;return b}class Vh{constructor(a,c){this.type=ei,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Qf(a[1])){const f=a[1];if(f.type==="FeatureCollection")for(let p=0;p<f.features.length;++p){const _=f.features[p].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Vh(f,f.features[p].geometry)}else if(f.type==="Feature"){const p=f.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Vh(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Vh(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(c,f){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(f.type==="Polygon"){const T=iw(f.coordinates,_,b),I=ow(c.geometry(),p,_,b);if(!Fd(p,_))return!1;for(const M of I)if(!tc(M,T))return!1}if(f.type==="MultiPolygon"){const T=Wv(f.coordinates,_,b),I=ow(c.geometry(),p,_,b);if(!Fd(p,_))return!1;for(const M of I)if(!fA(M,T))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(c,f){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=c.canonicalID();if(!b)return!1;if(f.type==="Polygon"){const T=iw(f.coordinates,_,b),I=rc(c.geometry(),p,_,b);if(!Fd(p,_))return!1;for(const M of I)if(!Bd(M,T))return!1}if(f.type==="MultiPolygon"){const T=Wv(f.coordinates,_,b),I=rc(c.geometry(),p,_,b);if(!Fd(p,_))return!1;for(const M of I)if(!VR(M,T))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const jg={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},sw=1/298.257223563,lw=sw*(2-sw),rp=Math.PI/180;class np{static fromTile(a,c,f){const p=Math.PI*(1-2*(a+.5)/Math.pow(2,c)),_=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/rp;return new np(_,f)}static get units(){return jg}constructor(a,c){if(a===void 0)throw new Error("No latitude given.");if(c&&!jg[c])throw new Error(`Unknown unit ${c}. Use one of: ${Object.keys(jg).join(", ")}`);const f=6378.137*rp*(c?jg[c]:1),p=Math.cos(a*rp),_=1/(1-lw*(1-p*p)),b=Math.sqrt(_);this.kx=f*b*p,this.ky=f*b*_*(1-lw)}distance(a,c){const f=_l(a[0]-c[0])*this.kx,p=(a[1]-c[1])*this.ky;return Math.sqrt(f*f+p*p)}bearing(a,c){const f=_l(c[0]-a[0])*this.kx;return Math.atan2(f,(c[1]-a[1])*this.ky)/rp}destination(a,c,f){const p=f*rp;return this.offset(a,Math.sin(p)*c,Math.cos(p)*c)}offset(a,c,f){return[a[0]+c/this.kx,a[1]+f/this.ky]}lineDistance(a){let c=0;for(let f=0;f<a.length-1;f++)c+=this.distance(a[f],a[f+1]);return c}area(a){let c=0;for(let f=0;f<a.length;f++){const p=a[f];for(let _=0,b=p.length,T=b-1;_<b;T=_++)c+=_l(p[_][0]-p[T][0])*(p[_][1]+p[T][1])*(f?-1:1)}return Math.abs(c)/2*this.kx*this.ky}along(a,c){let f=0;if(c<=0)return a[0];for(let p=0;p<a.length-1;p++){const _=a[p],b=a[p+1],T=this.distance(_,b);if(f+=T,f>c)return Gv(_,b,(c-(f-T))/T)}return a[a.length-1]}pointToSegmentDistance(a,c,f){let[p,_]=c,b=_l(f[0]-p)*this.kx,T=(f[1]-_)*this.ky;if(b!==0||T!==0){const I=(_l(a[0]-p)*this.kx*b+(a[1]-_)*this.ky*T)/(b*b+T*T);I>1?(p=f[0],_=f[1]):I>0&&(p+=b/this.kx*I,_+=T/this.ky*I)}return b=_l(a[0]-p)*this.kx,T=(a[1]-_)*this.ky,Math.sqrt(b*b+T*T)}pointOnLine(a,c){let f=1/0,p=a[0][0],_=a[0][1],b=0,T=0;for(let I=0;I<a.length-1;I++){let M=a[I][0],$=a[I][1],V=_l(a[I+1][0]-M)*this.kx,q=(a[I+1][1]-$)*this.ky,Y=0;V===0&&q===0||(Y=(_l(c[0]-M)*this.kx*V+(c[1]-$)*this.ky*q)/(V*V+q*q),Y>1?(M=a[I+1][0],$=a[I+1][1]):Y>0&&(M+=V/this.kx*Y,$+=q/this.ky*Y)),V=_l(c[0]-M)*this.kx,q=(c[1]-$)*this.ky;const J=V*V+q*q;J<f&&(f=J,p=M,_=$,b=I,T=Y)}return{point:[p,_],index:b,t:Math.max(0,Math.min(1,T))}}lineSlice(a,c,f){let p=this.pointOnLine(f,a),_=this.pointOnLine(f,c);if(p.index>_.index||p.index===_.index&&p.t>_.t){const M=p;p=_,_=M}const b=[p.point],T=p.index+1,I=_.index;!cw(f[T],b[0])&&T<=I&&b.push(f[T]);for(let M=T+1;M<=I;M++)b.push(f[M]);return cw(f[I],_.point)||b.push(_.point),b}lineSliceAlong(a,c,f){let p=0;const _=[];for(let b=0;b<f.length-1;b++){const T=f[b],I=f[b+1],M=this.distance(T,I);if(p+=M,p>a&&_.length===0&&_.push(Gv(T,I,(a-(p-M))/M)),p>=c)return _.push(Gv(T,I,(c-(p-M))/M)),_;p>a&&_.push(I)}return _}bufferPoint(a,c){const f=c/this.ky,p=c/this.kx;return[a[0]-p,a[1]-f,a[0]+p,a[1]+f]}bufferBBox(a,c){const f=c/this.ky,p=c/this.kx;return[a[0]-p,a[1]-f,a[2]+p,a[3]+f]}insideBBox(a,c){return _l(a[0]-c[0])>=0&&_l(a[0]-c[2])<=0&&a[1]>=c[1]&&a[1]<=c[3]}}function cw(u,a){return u[0]===a[0]&&u[1]===a[1]}function Gv(u,a,c){const f=_l(a[0]-u[0]);return[u[0]+f*c,u[1]+(a[1]-u[1])*c]}function _l(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Hv{constructor(a=[],c=(f,p)=>f<p?-1:f>p?1:0){if(this.data=a,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],c=this.data.pop();return--this.length>0&&(this.data[0]=c,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:c,compare:f}=this,p=c[a];for(;a>0;){const _=a-1>>1,b=c[_];if(f(p,b)>=0)break;c[a]=b,a=_}c[a]=p}_down(a){const{data:c,compare:f}=this,p=this.length>>1,_=c[a];for(;a<p;){let b=1+(a<<1);const T=b+1;if(T<this.length&&f(c[T],c[b])<0&&(b=T),f(c[b],_)>=0)break;c[a]=c[b],a=b}c[a]=_}}var Yt=8192;function uw(u,a){return a.dist-u.dist}const ip=100,ap=50;function Ng(u){const a=[1/0,1/0,-1/0,-1/0];if(a.length!==u.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==u[c])return!1;return!0}function Mg(u){return u[1]-u[0]+1}function au(u,a){const c=u[1]>=u[0]&&u[1]<a;return c||console.warn("Distance Expression: Index is out of range"),c}function Kv(u,a){if(u[0]>u[1])return[null,null];const c=Mg(u);if(a){if(c===2)return[u,null];const f=Math.floor(c/2);return[[u[0],u[0]+f],[u[0]+f,u[1]]]}{if(c===1)return[u,null];const f=Math.floor(c/2)-1;return[[u[0],u[0]+f],[u[0]+f+1,u[1]]]}}function nc(u,a){const c=[1/0,1/0,-1/0,-1/0];if(!au(a,u.length))return c;for(let f=a[0];f<=a[1];++f)kg(c,u[f]);return c}function In(u){const a=[1/0,1/0,-1/0,-1/0];for(let c=0;c<u.length;++c)for(let f=0;f<u[c].length;++f)kg(a,u[c][f]);return a}function op(u,a,c){if(Ng(u)||Ng(a))return NaN;let f=0,p=0;return u[2]<a[0]&&(f=a[0]-u[2]),u[0]>a[2]&&(f=u[0]-a[2]),u[1]>a[3]&&(p=u[1]-a[3]),u[3]<a[1]&&(p=a[1]-u[3]),c.distance([0,0],[f,p])}function qR(u){return 360*u-180}function WR(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Zv(u,a){const c=Math.pow(2,a.z),f=(u.y/Yt+a.y)/c;return[qR((u.x/Yt+a.x)/c),WR(f)]}function GR(u,a){const c=[];for(let f=0;f<u.length;++f)c.push(Zv(u[f],a));return c}function Qi(u,a,c){const f=c.pointOnLine(a,u).point;return c.distance(u,f)}function pA(u,a,c,f,p){const _=c.slice(f[0],f[1]+1);let b=1/0;for(let T=a[0];T<=a[1];++T)if((b=Math.min(b,Qi(u[T],_,p)))===0)return 0;return b}function dw(u,a,c,f,p){const _=Math.min(p.pointToSegmentDistance(u,c,f),p.pointToSegmentDistance(a,c,f)),b=Math.min(p.pointToSegmentDistance(c,u,a),p.pointToSegmentDistance(f,u,a));return Math.min(_,b)}function HR(u,a,c,f,p){if(!au(a,u.length)||!au(f,c.length))return NaN;let _=1/0;for(let b=a[0];b<a[1];++b)for(let T=f[0];T<f[1];++T){if(qv(u[b],u[b+1],c[T],c[T+1]))return 0;_=Math.min(_,dw(u[b],u[b+1],c[T],c[T+1],p))}return _}function KR(u,a,c,f,p){if(!au(a,u.length)||!au(f,c.length))return NaN;let _=1/0;for(let b=a[0];b<=a[1];++b)for(let T=f[0];T<=f[1];++T)if((_=Math.min(_,p.distance(u[b],c[T])))===0)return _;return _}function ZR(u,a,c){if(tc(u,a,!0))return 0;let f=1/0;for(const p of a){const _=p.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[_-1]&&(f=Math.min(f,c.pointToSegmentDistance(u,p[_-1],p[0])))===0||(f=Math.min(f,Qi(u,p,c)))===0)return f}return f}function XR(u,a,c,f){if(!au(a,u.length))return NaN;for(let _=a[0];_<=a[1];++_)if(tc(u[_],c,!0))return 0;let p=1/0;for(let _=a[0];_<a[1];++_)for(const b of c)for(let T=0,I=b.length,M=I-1;T<I;M=T++){if(qv(u[_],u[_+1],b[M],b[T]))return 0;p=Math.min(p,dw(u[_],u[_+1],b[M],b[T],f))}return p}function mA(u,a){for(const c of u)for(let f=0;f<=c.length-1;++f)if(tc(c[f],a,!0))return!0;return!1}function YR(u,a,c,f=1/0){const p=In(u),_=In(a);if(f!==1/0&&op(p,_,c)>=f)return f;if(Fd(p,_)){if(mA(u,a))return 0}else if(mA(a,u))return 0;let b=f;for(const T of u)for(let I=0,M=T.length,$=M-1;I<M;$=I++)for(const V of a)for(let q=0,Y=V.length,J=Y-1;q<Y;J=q++){if(qv(T[$],T[I],V[J],V[q]))return 0;b=Math.min(b,dw(T[$],T[I],V[J],V[q],c))}return b}function Xv(u,a,c,f,p,_,b){if(_===null||b===null)return;const T=op(nc(f,_),nc(p,b),c);T<a&&u.push({dist:T,range1:_,range2:b})}function JR(u,a,c,f,p=1/0){let _=Math.min(f.distance(u[0],c[0][0]),p);if(_===0)return _;const b=new Hv([{dist:0,range1:[0,u.length-1],range2:[0,0]}],uw),T=a?ap:ip,I=In(c);for(;b.length;){const M=b.pop();if(M.dist>=_)continue;const $=M.range1;if(Mg($)<=T){if(!au($,u.length))return NaN;if(a){const V=XR(u,$,c,f);if((_=Math.min(_,V))===0)return _}else for(let V=$[0];V<=$[1];++V){const q=ZR(u[V],c,f);if((_=Math.min(_,q))===0)return _}}else{const V=Kv($,a);if(V[0]!==null){const q=op(nc(u,V[0]),I,f);q<_&&b.push({dist:q,range1:V[0],range2:[0,0]})}if(V[1]!==null){const q=op(nc(u,V[1]),I,f);q<_&&b.push({dist:q,range1:V[1],range2:[0,0]})}}}return _}function gA(u,a,c,f,p,_=1/0){let b=Math.min(_,p.distance(u[0],c[0]));if(b===0)return b;const T=new Hv([{dist:0,range1:[0,u.length-1],range2:[0,c.length-1]}],uw),I=a?ap:ip,M=f?ap:ip;for(;T.length;){const $=T.pop();if($.dist>=b)continue;const V=$.range1,q=$.range2;if(Mg(V)<=I&&Mg(q)<=M){if(!au(V,u.length)||!au(q,c.length))return NaN;if(a&&f?b=Math.min(b,HR(u,V,c,q,p)):a||f?a&&!f?b=Math.min(b,pA(c,q,u,V,p)):!a&&f&&(b=Math.min(b,pA(u,V,c,q,p))):b=Math.min(b,KR(u,V,c,q,p)),b===0)return b}else{const Y=Kv(V,a),J=Kv(q,f);Xv(T,b,p,u,c,Y[0],J[0]),Xv(T,b,p,u,c,Y[0],J[1]),Xv(T,b,p,u,c,Y[1],J[0]),Xv(T,b,p,u,c,Y[1],J[1])}}return b}function hw(u,a,c,f,p=1/0){let _=p;const b=nc(u,[0,u.length-1]);for(const T of c)if(!(_!==1/0&&op(b,nc(T,[0,T.length-1]),f)>=_)&&(_=Math.min(_,gA(u,a,T,!0,f,_)),_===0))return _;return _}function Yv(u,a,c,f,p=1/0){let _=p;const b=nc(u,[0,u.length-1]);for(const T of c){if(_!==1/0&&op(b,In(T),f)>=_)continue;const I=JR(u,a,T,f,_);if(isNaN(I))return I;if((_=Math.min(_,I))===0)return _}return _}function fw(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class qh{constructor(a,c){this.type=Cr,this.geojson=a,this.geometries=c}static parse(a,c){if(a.length!==2)return c.error(`'distance' expression requires either one argument, but found ' ${a.length-1} instead.`);if(Qf(a[1])){const f=a[1];if(f.type==="FeatureCollection"){for(let p=0;p<f.features.length;++p)if(fw(f.features[p].geometry.type))return new qh(f,f.features[p].geometry)}else if(f.type==="Feature"){if(fw(f.geometry.type))return new qh(f,f.geometry)}else if(fw(f.type))return new qh(f,f)}return c.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(a){const c=a.geometry(),f=a.canonicalID();if(c!=null&&f!=null){if(a.geometryType()==="Point")return function(p,_,b){const T=[];for(const M of p)for(const $ of M)T.push(Zv($,_));const I=new np(T[0][1],"meters");return b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString"?gA(T,!1,b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",I):b.type==="MultiLineString"?hw(T,!1,b.coordinates,I):b.type==="Polygon"||b.type==="MultiPolygon"?Yv(T,!1,b.type==="Polygon"?[b.coordinates]:b.coordinates,I):null}(c,f,this.geometries);if(a.geometryType()==="LineString")return function(p,_,b){const T=[];for(const M of p){const $=[];for(const V of M)$.push(Zv(V,_));T.push($)}const I=new np(T[0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return hw(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",T,I);if(b.type==="MultiLineString"){let M=1/0;for(let $=0;$<b.coordinates.length;$++){const V=hw(b.coordinates[$],!0,T,I,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}if(b.type==="Polygon"||b.type==="MultiPolygon"){let M=1/0;for(let $=0;$<T.length;$++){const V=Yv(T[$],!0,b.type==="Polygon"?[b.coordinates]:b.coordinates,I,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}return null}(c,f,this.geometries);if(a.geometryType()==="Polygon")return function(p,_,b){const T=[];for(const M of function($,V){const q=$.length;if(q<=1)return[$];const Y=[];let J,ae;for(let ce=0;ce<q;ce++){const de=BR($[ce]);de!==0&&($[ce].area=Math.abs(de),ae===void 0&&(ae=de<0),ae===de<0?(J&&Y.push(J),J=[$[ce]]):J.push($[ce]))}return J&&Y.push(J),Y}(p)){const $=[];for(let V=0;V<M.length;++V)$.push(GR(M[V],_));T.push($)}const I=new np(T[0][0][0][1],"meters");if(b.type==="Point"||b.type==="MultiPoint"||b.type==="LineString")return Yv(b.type==="Point"?[b.coordinates]:b.coordinates,b.type==="LineString",T,I);if(b.type==="MultiLineString"){let M=1/0;for(let $=0;$<b.coordinates.length;$++){const V=Yv(b.coordinates[$],!0,T,I,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}return b.type==="Polygon"||b.type==="MultiPolygon"?function(M,$,V){let q=1/0;for(const Y of M)for(const J of $){const ae=YR(Y,J,V,q);if(isNaN(ae))return ae;if((q=Math.min(q,ae))===0)return q}return q}(b.type==="Polygon"?[b.coordinates]:b.coordinates,T,I):null}(c,f,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function sp(u){if(u instanceof as&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Vh||u instanceof qh)return!1;if(u instanceof cp)return u.featureConstant;let a=!0;return u.eachChild(c=>{a&&!sp(c)&&(a=!1)}),a}function Dg(u){if(u instanceof as&&u.name==="feature-state")return!1;let a=!0;return u.eachChild(c=>{a&&!Dg(c)&&(a=!1)}),a}function lp(u,a){if(u instanceof as&&a.indexOf(u.name)>=0)return!1;let c=!0;return u.eachChild(f=>{c&&!lp(f,a)&&(c=!1)}),c}function yA(u,a,c){return[u,a,c].filter(Boolean).join("")}function pw(u,a){switch(u){case"string":return nu(a);case"number":return+a;case"boolean":return!!a;case"color":return ri.parse(a);case"formatted":return fo.fromString(nu(a));case"resolvedImage":return Ms.build(nu(a))}return a}function vA(u,a,c,f){return f!==void 0&&(u=f*Math.round(u/f)),a!==void 0&&u<a&&(u=a),c!==void 0&&u>c&&(u=c),u}class cp{constructor(a,c,f,p=!1){this.type=a,this.key=c,this.scope=f,this.featureConstant=p}static parse(a,c){let f=c.expectedType;if(f==null&&(f=ai),a.length<2||a.length>3)return c.error("Invalid number of arguments for 'config' expression.");const p=c.parse(a[1],1);if(!(p instanceof Vu))return c.error("Key name of 'config' expression must be a string literal.");let _,b=!0;const T=nu(p.value);if(a.length>=3){const I=c.parse(a[2],2);if(!(I instanceof Vu))return c.error("Scope of 'config' expression must be a string literal.");_=nu(I.value)}if(c.options){const I=yA(T,_,c._scope),M=c.options.get(I);M&&(b=sp(M.value||M.default))}return new cp(f,T,_,b)}evaluate(a){const c=yA(this.key,this.scope,a.scope),f=a.getConfig(c);if(!f)return null;const{type:p,value:_,values:b,minValue:T,maxValue:I,stepValue:M}=f,$=f.default.evaluate(a);let V=$;if(_){const q=a.scope;a.scope=(q||"").split("").slice(1).join(""),V=_.evaluate(a),a.scope=q}return p&&(V=pw(p,V)),V===void 0||T===void 0&&I===void 0&&M===void 0||(typeof V=="number"?V=vA(V,T,I,M):Array.isArray(V)&&(V=V.map(q=>typeof q=="number"?vA(q,T,I,M):q))),_!==void 0&&V!==void 0&&b&&!b.includes(V)&&(V=$,p&&(V=pw(p,V))),(p&&p!==this.type||V!==void 0&&!zv(lo(V),this.type))&&(V=pw(this.type.kind,V)),V}eachChild(){}outputDefined(){return!1}serialize(){const a=["config",this.key];return this.scope&&a.concat(this.scope),a}}class Jv{constructor(a,c){this.type=c.type,this.name=a,this.boundExpression=c}static parse(a,c){if(a.length!==2||typeof a[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=a[1];return c.scope.has(f)?new Jv(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qv{constructor(a,c=[],f,p=new ec,_=[],b,T,I){this.registry=a,this.path=c,this.key=c.map(M=>typeof M=="string"?`['${M}']`:`[${M}]`).join(""),this.scope=p,this.errors=_,this.expectedType=f,this._scope=b,this.options=T,this.iconImageUseTheme=I}parse(a,c,f,p,_={}){return c||f?this.concat(c,null,f,p)._parse(a,_):this._parse(a,_)}parseObjectValue(a,c,f,p,_,b={}){return this.concat(c,f,p,_)._parse(a,b)}_parse(a,c){function f(p,_,b){return b==="assert"?new Sr(_,[p]):b==="coerce"?new iu(_,[p]):p}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof a[0]=="string"?this.registry[a[0]]:void 0;if(p){let _=p.parse(a,this);if(!_)return null;if(this.expectedType){const b=this.expectedType,T=_.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(b,T))return null}else _=f(_,b,c.typeAnnotation||"coerce");else _=f(_,b,c.typeAnnotation||"assert")}if(!(_ instanceof Vu)&&_.type.kind!=="resolvedImage"&&mw(_)){const b=new wo(this._scope,this.options,this.iconImageUseTheme);try{_=new Vu(_.type,_.evaluate(b))}catch(T){return this.error(T.message),null}}return _}return iu.parse(["to-array",a],this)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,c,f,p){let _=typeof a=="number"?this.path.concat(a):this.path;_=typeof c=="string"?_.concat(c):_;const b=p?this.scope.concat(p):this.scope;return new Qv(this.registry,_,f||null,b,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(a,...c){const f=`${this.key}${c.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ql(f,a))}checkSubtype(a,c){const f=Pg(a,c);return f&&this.error(f),f}}function mw(u){if(u instanceof Jv)return mw(u.boundExpression);if(u instanceof as&&u.name==="error"||u instanceof tp||u instanceof Vh||u instanceof qh||u instanceof cp)return!1;const a=u instanceof iu||u instanceof Sr;let c=!0;return u.eachChild(f=>{c=a?c&&mw(f):c&&f instanceof Vu}),!!c&&sp(u)&&lp(u,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function e_(u,a){const c=u.length-1;let f,p,_=0,b=c,T=0;for(;_<=b;)if(T=Math.floor((_+b)/2),f=u[T],p=u[T+1],f<=a){if(T===c||a<p)return T;_=T+1}else{if(!(f>a))throw new Ea("Input is not a number.");b=T-1}return 0}class Lg{constructor(a,c,f){this.type=a,this.input=c,this.labels=[],this.outputs=[];for(const[p,_]of f)this.labels.push(p),this.outputs.push(_)}static parse(a,c){if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(a[1],1,Cr);if(!f)return null;const p=[];let _=null;c.expectedType&&c.expectedType.kind!=="value"&&(_=c.expectedType);for(let b=1;b<a.length;b+=2){const T=b===1?-1/0:a[b],I=a[b+1],M=b,$=b+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(p.length&&p[p.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const V=c.parse(I,$,_);if(!V)return null;_=_||V.type,p.push([T,V])}return new Lg(_,f,p)}evaluate(a){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);const p=this.input.evaluate(a);if(p<=c[0])return f[0].evaluate(a);const _=c.length;return p>=c[_-1]?f[_-1].evaluate(a):f[e_(c,p)].evaluate(a)}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){const a=["step",this.input.serialize()];for(let c=0;c<this.labels.length;c++)c>0&&a.push(this.labels[c]),a.push(this.outputs[c].serialize());return a}}const _A=.95047,xA=1.08883,bA=4/29,up=6/29,t_=3*up*up,QR=up*up*up,wA=Math.PI/180,ej=180/Math.PI;function gw(u){return u>QR?Math.pow(u,1/3):u/t_+bA}function yw(u){return u>up?u*u*u:t_*(u-bA)}function r_(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function n_(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Wh(u){const a=n_(u.r),c=n_(u.g),f=n_(u.b),p=gw((.4124564*a+.3575761*c+.1804375*f)/_A),_=gw((.2126729*a+.7151522*c+.072175*f)/1);return{l:116*_-16,a:500*(p-_),b:200*(_-gw((.0193339*a+.119192*c+.9503041*f)/xA)),alpha:u.a}}function vw(u){let a=(u.l+16)/116,c=isNaN(u.a)?a:a+u.a/500,f=isNaN(u.b)?a:a-u.b/200;return a=1*yw(a),c=_A*yw(c),f=xA*yw(f),new ri(r_(3.2404542*c-1.5371385*a-.4985314*f),r_(-.969266*c+1.8760108*a+.041556*f),r_(.0556434*c-.2040259*a+1.0572252*f),u.alpha)}function SA(u,a,c){const f=a-u;return u+c*(f>180||f<-180?f-360*Math.round(f/360):f)}const Fg={forward:Wh,reverse:vw,interpolate:function(u,a,c){return{l:$r(u.l,a.l,c),a:$r(u.a,a.a,c),b:$r(u.b,a.b,c),alpha:$r(u.alpha,a.alpha,c)}}},Gh={forward:function(u){const{l:a,a:c,b:f}=Wh(u),p=Math.atan2(f,c)*ej;return{h:p<0?p+360:p,c:Math.sqrt(c*c+f*f),l:a,alpha:u.a}},reverse:function(u){const a=u.h*wA,c=u.c;return vw({l:u.l,a:Math.cos(a)*c,b:Math.sin(a)*c,alpha:u.alpha})},interpolate:function(u,a,c){return{h:SA(u.h,a.h,c),c:$r(u.c,a.c,c),l:$r(u.l,a.l,c),alpha:$r(u.alpha,a.alpha,c)}}};var i_=Object.freeze({__proto__:null,hcl:Gh,lab:Fg});class xl{constructor(a,c,f,p,_){this.type=a,this.operator=c,this.interpolation=f,this.input=p,this.labels=[],this.outputs=[];for(const[b,T]of _)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(a,c,f,p){let _=0;if(a.name==="exponential")_=_w(c,a.base,f,p);else if(a.name==="linear")_=_w(c,1,f,p);else if(a.name==="cubic-bezier"){const b=a.controlPoints;_=new $o(b[0],b[1],b[2],b[3]).solve(_w(c,1,f,p))}return _}static parse(a,c){let[f,p,_,...b]=a;if(!Array.isArray(p)||p.length===0)return c.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const M=p[1];if(typeof M!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:M}}else{if(p[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const M=p.slice(1);if(M.length!==4||M.some($=>typeof $!="number"||$<0||$>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}}if(a.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length-1>3&&(a.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(_=c.parse(_,2,Cr),!_)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Ys:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let M=0;M<b.length;M+=2){const $=b[M],V=b[M+1],q=M+3,Y=M+4;if(typeof $!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(T.length&&T[T.length-1][0]>=$)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const J=c.parse(V,Y,I);if(!J)return null;I=I||J.type,T.push([$,J])}return I.kind==="number"||I.kind==="color"||I.kind==="array"&&I.itemType.kind==="number"&&typeof I.N=="number"?new xl(I,f,p,_,T):c.error(`Type ${Va(I)} is not interpolatable.`)}evaluate(a){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(a);const p=this.input.evaluate(a);if(p<=c[0])return f[0].evaluate(a);const _=c.length;if(p>=c[_-1])return f[_-1].evaluate(a);const b=e_(c,p),T=xl.interpolationFactor(this.interpolation,p,c[b],c[b+1]),I=f[b].evaluate(a),M=f[b+1].evaluate(a);return this.operator==="interpolate"?$u[this.type.kind.toLowerCase()](I,M,T):this.operator==="interpolate-hcl"?Gh.reverse(Gh.interpolate(Gh.forward(I),Gh.forward(M),T)):Fg.reverse(Fg.interpolate(Fg.forward(I),Fg.forward(M),T))}eachChild(a){a(this.input);for(const c of this.outputs)a(c)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}serialize(){let a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const c=[this.operator,a,this.input.serialize()];for(let f=0;f<this.labels.length;f++)c.push(this.labels[f],this.outputs[f].serialize());return c}}function _w(u,a,c,f){const p=f-c,_=u-c;return p===0?0:a===1?_/p:(Math.pow(a,_)-1)/(Math.pow(a,p)-1)}class zg{constructor(a,c){this.type=a,this.args=c}static parse(a,c){if(a.length<2)return c.error("Expectected at least one argument.");let f=null;const p=c.expectedType;p&&p.kind!=="value"&&(f=p);const _=[];for(const T of a.slice(1)){const I=c.parse(T,1+_.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,_.push(I)}const b=p&&_.some(T=>Pg(p,T.type));return new zg(b?ai:f,_)}evaluate(a){let c,f=null,p=0;for(const _ of this.args){if(p++,f=_.evaluate(a),f&&f instanceof Ms&&!f.available&&(c||(c=f),f=null,p===this.args.length))return c;if(f!==null)break}return f}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}serialize(){const a=["coalesce"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class Bg{constructor(a,c){this.type=c.type,this.bindings=[].concat(a),this.result=c}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const c of this.bindings)a(c[1]);a(this.result)}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const f=[];for(let _=1;_<a.length-1;_+=2){const b=a[_];if(typeof b!="string")return c.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return c.error("Variable names must contain only alphanumeric characters or '_'.",_);const T=c.parse(a[_+1],_+1);if(!T)return null;f.push([b,T])}const p=c.parse(a[a.length-1],a.length-1,c.expectedType,f);return p?new Bg(f,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const a=["let"];for(const[c,f]of this.bindings)a.push(c,f.serialize());return a.push(this.result.serialize()),a}}class xw{constructor(a,c,f){this.type=a,this.index=c,this.input=f}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,Cr),p=c.parse(a[2],2,bo(c.expectedType||ai));return f&&p?new xw(p.type.itemType,f,p):null}evaluate(a){const c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ea("Array index out of bounds: negative index");if(c>=f.length)throw new Ea("Array index out of bounds: index exceeds array size");if(c!==Math.floor(c))throw new Ea("Array index must be an integer. Use at-interpolated for fractional indices");return f[c]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class bw{constructor(a,c,f){this.type=a,this.index=c,this.input=f}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,Cr),p=c.parse(a[2],2,bo(c.expectedType||ai));return f&&p?new bw(p.type.itemType,f,p):null}evaluate(a){const c=this.index.evaluate(a),f=this.input.evaluate(a);if(c<0)throw new Ea(`Array index out of bounds: ${c} < 0.`);if(c>f.length-1)throw new Ea(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c===Math.floor(c))return f[c];const p=Math.floor(c),_=Math.ceil(c),b=f[p],T=f[_];if(typeof b!="number"||typeof T!="number")throw new Ea(`Cannot interpolate between non-number values at index ${c}.`);const I=c-p;return b*(1-I)+T*I}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ww{constructor(a,c){this.type=ei,this.needle=a,this.haystack=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,ai),p=c.parse(a[2],2,ai);return f&&p?rw(f.type,[ei,$n,Cr,Yf,ai])?new ww(f,p):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Va(f.type)} instead`):null}evaluate(a){const c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(f==null)return!1;if(!Cg(c,["boolean","string","number","null"]))throw new Ea(`Expected first argument to be of type boolean, string, number or null, but found ${Va(lo(c))} instead.`);if(!Cg(f,["string","array"]))throw new Ea(`Expected second argument to be of type array or string, but found ${Va(lo(f))} instead.`);return f.indexOf(c)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class $g{constructor(a,c,f){this.type=Cr,this.needle=a,this.haystack=c,this.fromIndex=f}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,ai),p=c.parse(a[2],2,ai);if(!f||!p)return null;if(!rw(f.type,[ei,$n,Cr,Yf,ai]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${Va(f.type)} instead`);if(a.length===4){const _=c.parse(a[3],3,Cr);return _?new $g(f,p,_):null}return new $g(f,p)}evaluate(a){const c=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!Cg(c,["boolean","string","number","null"]))throw new Ea(`Expected first argument to be of type boolean, string, number or null, but found ${Va(lo(c))} instead.`);if(!Cg(f,["string","array"]))throw new Ea(`Expected second argument to be of type array or string, but found ${Va(lo(f))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(a);return f.indexOf(c,p)}return f.indexOf(c)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class a_{constructor(a,c,f,p,_,b){this.inputType=a,this.type=c,this.input=f,this.cases=p,this.outputs=_,this.otherwise=b}static parse(a,c){if(a.length<5)return c.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return c.error("Expected an even number of arguments.");let f,p;c.expectedType&&c.expectedType.kind!=="value"&&(p=c.expectedType);const _={},b=[];for(let M=2;M<a.length-1;M+=2){let $=a[M];const V=a[M+1];Array.isArray($)||($=[$]);const q=c.concat(M);if($.length===0)return q.error("Expected at least one branch label.");for(const J of $){if(typeof J!="number"&&typeof J!="string")return q.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return q.error("Numeric branch labels must be integer values.");if(f){if(q.checkSubtype(f,lo(J)))return null}else f=lo(J);if(_[String(J)]!==void 0)return q.error("Branch labels must be unique.");_[String(J)]=b.length}const Y=c.parse(V,M,p);if(!Y)return null;p=p||Y.type,b.push(Y)}const T=c.parse(a[1],1,ai);if(!T)return null;const I=c.parse(a[a.length-1],a.length-1,p);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new a_(f,p,T,_,b,I):null}evaluate(a){const c=this.input.evaluate(a);return(zv(lo(c),this.inputType)&&this.outputs[this.cases[c]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["match",this.input.serialize()],c=Object.keys(this.cases).sort(),f=[],p={};for(const b of c){const T=p[this.cases[b]];T===void 0?(p[this.cases[b]]=f.length,f.push([this.cases[b],[b]])):f[T][1].push(b)}const _=b=>this.inputType.kind==="number"?Number(b):b;for(const[b,T]of f)a.push(T.length===1?_(T[0]):T.map(_)),a.push(this.outputs[b].serialize());return a.push(this.otherwise.serialize()),a}}class dp{constructor(a,c,f){this.type=a,this.branches=c,this.otherwise=f}static parse(a,c){if(a.length<4)return c.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const p=[];for(let b=1;b<a.length-1;b+=2){const T=c.parse(a[b],b,ei);if(!T)return null;const I=c.parse(a[b+1],b+1,f);if(!I)return null;p.push([T,I]),f=f||I.type}const _=c.parse(a[a.length-1],a.length-1,f);return _?new dp(f,p,_):null}evaluate(a){for(const[c,f]of this.branches)if(c.evaluate(a))return f.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[c,f]of this.branches)a(c),a(f);a(this.otherwise)}outputDefined(){return this.branches.every(([a,c])=>c.outputDefined())&&this.otherwise.outputDefined()}serialize(){const a=["case"];return this.eachChild(c=>{a.push(c.serialize())}),a}}class o_{constructor(a,c,f,p){this.type=a,this.input=c,this.beginIndex=f,this.endIndex=p}static parse(a,c){if(a.length<=2||a.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,ai),p=c.parse(a[2],2,Cr);if(!f||!p)return null;if(!rw(f.type,[bo(ai),$n,ai]))return c.error(`Expected first argument to be of type array or string, but found ${Va(f.type)} instead`);if(a.length===4){const _=c.parse(a[3],3,Cr);return _?new o_(f.type,f,p,_):null}return new o_(f.type,f,p)}evaluate(a){const c=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!Cg(c,["string","array"]))throw new Ea(`Expected first argument to be of type array or string, but found ${Va(lo(c))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(a);return c.slice(f,p)}return c.slice(f)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class s_{constructor(a,c){this.type=bo($n),this.str=a,this.delimiter=c}static parse(a,c){if(a.length!==3)return c.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=c.parse(a[1],1,$n),p=c.parse(a[2],2,$n);return f&&p?new s_(f,p):void 0}evaluate(a){const c=this.str.evaluate(a),f=this.delimiter.evaluate(a);return c.split(f)}eachChild(a){a(this.str),a(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function EA(u,a){return u==="=="||u==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function TA(u,a,c,f){return f.compare(a,c)===0}function hp(u,a,c){const f=u!=="=="&&u!=="!=";return class Wre{constructor(_,b,T){this.type=ei,this.lhs=_,this.rhs=b,this.collator=T,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const T=_[0];let I=b.parse(_[1],1,ai);if(!I)return null;if(!EA(T,I.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Va(I.type)}'.`);let M=b.parse(_[2],2,ai);if(!M)return null;if(!EA(T,M.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Va(M.type)}'.`);if(I.type.kind!==M.type.kind&&I.type.kind!=="value"&&M.type.kind!=="value")return b.error(`Cannot compare types '${Va(I.type)}' and '${Va(M.type)}'.`);f&&(I.type.kind==="value"&&M.type.kind!=="value"?I=new Sr(M.type,[I]):I.type.kind!=="value"&&M.type.kind==="value"&&(M=new Sr(I.type,[M])));let $=null;if(_.length===4){if(I.type.kind!=="string"&&M.type.kind!=="string"&&I.type.kind!=="value"&&M.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if($=b.parse(_[3],3,Tg),!$)return null}return new Wre(I,M,$)}evaluate(_){const b=this.lhs.evaluate(_),T=this.rhs.evaluate(_);if(f&&this.hasUntypedArgument){const I=lo(b),M=lo(T);if(I.kind!==M.kind||I.kind!=="string"&&I.kind!=="number")throw new Ea(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${I.kind}, ${M.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=lo(b),M=lo(T);if(I.kind!=="string"||M.kind!=="string")return a(_,b,T)}return this.collator?c(_,b,T,this.collator.evaluate(_)):a(_,b,T)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[u];return this.eachChild(b=>{_.push(b.serialize())}),_}}}const AA=hp("==",function(u,a,c){return a===c},TA),PA=hp("!=",function(u,a,c){return a!==c},function(u,a,c,f){return!TA(0,a,c,f)}),tj=hp("<",function(u,a,c){return a<c},function(u,a,c,f){return f.compare(a,c)<0}),rj=hp(">",function(u,a,c){return a>c},function(u,a,c,f){return f.compare(a,c)>0}),nj=hp("<=",function(u,a,c){return a<=c},function(u,a,c,f){return f.compare(a,c)<=0}),l_=hp(">=",function(u,a,c){return a>=c},function(u,a,c,f){return f.compare(a,c)>=0});class Sw{constructor(a,c,f,p,_,b){this.type=$n,this.number=a,this.locale=c,this.currency=f,this.unit=p,this.minFractionDigits=_,this.maxFractionDigits=b}static parse(a,c){if(a.length!==3)return c.error("Expected two arguments.");const f=c.parse(a[1],1,Cr);if(!f)return null;const p=a[2];if(typeof p!="object"||Array.isArray(p))return c.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=c.parseObjectValue(p.locale,2,"locale",$n),!_))return null;let b=null;if(p.currency&&(b=c.parseObjectValue(p.currency,2,"currency",$n),!b))return null;let T=null;if(p.unit&&(T=c.parseObjectValue(p.unit,2,"unit",$n),!T))return null;let I=null;if(p["min-fraction-digits"]&&(I=c.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",Cr),!I))return null;let M=null;return p["max-fraction-digits"]&&(M=c.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",Cr),!M)?null:new Sw(f,_,b,T,I,M)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(a):void 0,unit:this.unit?this.unit.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.unit&&a(this.unit),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.unit&&(a.unit=this.unit.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]}}class Ew{constructor(a){this.type=Cr,this.input=a}static parse(a,c){if(a.length!==2)return c.error(`Expected 1 argument, but found ${a.length-1} instead.`);const f=c.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${Va(f.type)} instead.`):new Ew(f):null}evaluate(a){const c=this.input.evaluate(a);if(typeof c=="string"||Array.isArray(c))return c.length;throw new Ea(`Expected value to be of type string or array, but found ${Va(lo(c))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}serialize(){const a=["length"];return this.eachChild(c=>{a.push(c.serialize())}),a}}function CA(u){return function(){u=1831565813+(u|=0)|0;let a=Math.imul(u^u>>>15,1|u);return a=a+Math.imul(a^a>>>7,61|a)^a,((a^a>>>14)>>>0)/4294967296}}const fp={"==":AA,"!=":PA,">":rj,"<":tj,">=":l_,"<=":nj,array:Sr,at:xw,"at-interpolated":bw,boolean:Sr,case:dp,coalesce:zg,collator:tp,format:$h,image:Xr,in:ww,"index-of":$g,interpolate:xl,"interpolate-hcl":xl,"interpolate-lab":xl,length:Ew,let:Bg,literal:Vu,match:a_,number:Sr,"number-format":Sw,object:Sr,slice:o_,step:Lg,string:Sr,"to-boolean":iu,"to-color":iu,"to-number":iu,"to-string":iu,var:Jv,within:Vh,distance:qh,config:cp,split:s_};function Tw(u,[a,c,f,p]){a=a.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const _=p?p.evaluate(u):1,b=Bv(a,c,f,_);if(b)throw new Ea(b);return new ri(a/255,c/255,f/255,_)}function OA(u,[a,c,f,p]){a=a.evaluate(u),c=c.evaluate(u),f=f.evaluate(u);const _=p?p.evaluate(u):1,b=function(M,$,V,q){return typeof M=="number"&&M>=0&&M<=360?typeof $=="number"&&$>=0&&$<=100&&typeof V=="number"&&V>=0&&V<=100?q===void 0||typeof q=="number"&&q>=0&&q<=1?null:`Invalid hsla value [${[M,$,V,q].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof q=="number"?[M,$,V,q]:[M,$,V]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof q=="number"?[M,$,V,q]:[M,$,V]).join(", ")}]: 'h' must be between 0 and 360.`}(a,c,f,_);if(b)throw new Ea(b);const T=`hsla(${a}, ${c}%, ${f}%, ${_})`,I=ri.parse(T);if(!I)throw new Ea(`Failed to parse HSLA color: ${T}`);return I}function IA(u,a){return u in a}function c_(u,a){const c=a[u];return c===void 0?null:c}function Wu(u){return{type:u}}function Ug(u){if(u instanceof cp)return new Set([u.key]);let a=new Set;return u.eachChild(c=>{a=new Set([...a,...Ug(c)])}),a}function u_(u){if(u instanceof as&&u.name==="is-active-floor")return!0;let a=!1;return u.eachChild(c=>{!a&&u_(c)&&(a=!0)}),a}function Hh(u){return{result:"success",value:u}}function $d(u){return{result:"error",value:u}}function Aw(u,a){return!!u&&!!u.parameters&&u.parameters.indexOf(a)>-1}function d_(u){return u["property-type"]==="data-driven"}function Pw(u){return Aw(u.expression,"measure-light")}function Cw(u){return Aw(u.expression,"zoom")}function h_(u){return!!u.expression&&u.expression.interpolated}function f_(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Ow(u){return u}function p_(u,a){const c=a.type==="color",f=u.stops&&typeof u.stops[0][0]=="object",p=f||!(f||u.property!==void 0),_=u.type||(h_(a)?"exponential":"interval");if(c&&((u=Object.assign({},u)).stops&&(u.stops=u.stops.map(M=>[M[0],ri.parse(M[1])])),u.default=ri.parse(u.default?u.default:a.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!i_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let b,T,I;if(_==="exponential")b=kA;else if(_==="interval")b=Ud;else if(_==="categorical"){b=ij,T=Object.create(null);for(const M of u.stops)T[M[0]]=M[1];I=typeof u.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);b=aj}if(f){const M={},$=[];for(let Y=0;Y<u.stops.length;Y++){const J=u.stops[Y],ae=J[0].zoom;M[ae]===void 0&&(M[ae]={zoom:ae,type:u.type,property:u.property,default:u.default,stops:[]},$.push(ae)),M[ae].stops.push([J[0].value,J[1]])}const V=[];for(const Y of $)V.push([M[Y].zoom,p_(M[Y],a)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:xl.interpolationFactor.bind(void 0,q),zoomStops:V.map(Y=>Y[0]),evaluate:({zoom:Y},J)=>kA({stops:V,base:u.base},a,Y).evaluate(Y,J)}}if(p){const M=_==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:xl.interpolationFactor.bind(void 0,M),zoomStops:u.stops.map($=>$[0]),evaluate:({zoom:$})=>b(u,a,$,T,I)}}return{kind:"source",evaluate(M,$){const V=$&&$.properties?$.properties[u.property]:void 0;return V===void 0?pp(u.default,a.default):b(u,a,V,T,I)}}}function pp(u,a,c){return u!==void 0?u:a!==void 0?a:c!==void 0?c:void 0}function ij(u,a,c,f,p){return pp(typeof c===p?f[c]:void 0,u.default,a.default)}function Ud(u,a,c){if(!Ig(c))return pp(u.default,a.default);const f=u.stops.length;if(f===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[f-1][0])return u.stops[f-1][1];const p=e_(u.stops.map(_=>_[0]),c);return u.stops[p][1]}function kA(u,a,c){const f=u.base!==void 0?u.base:1;if(!Ig(c))return pp(u.default,a.default);const p=u.stops.length;if(p===1||c<=u.stops[0][0])return u.stops[0][1];if(c>=u.stops[p-1][0])return u.stops[p-1][1];const _=e_(u.stops.map($=>$[0]),c),b=function($,V,q,Y){const J=Y-q,ae=$-q;return J===0?0:V===1?ae/J:(Math.pow(V,ae)-1)/(Math.pow(V,J)-1)}(c,f,u.stops[_][0],u.stops[_+1][0]),T=u.stops[_][1],I=u.stops[_+1][1];let M=$u[a.type]||Ow;if(u.colorSpace&&u.colorSpace!=="rgb"){const $=i_[u.colorSpace];M=(V,q)=>$.reverse($.interpolate($.forward(V),$.forward(q),b))}return typeof T.evaluate=="function"?{evaluate(...$){const V=T.evaluate.apply(void 0,$),q=I.evaluate.apply(void 0,$);if(V!==void 0&&q!==void 0)return M(V,q,b)}}:M(T,I,b)}function aj(u,a,c){return a.type==="color"?c=ri.parse(c):a.type==="formatted"?c=fo.fromString(c.toString()):a.type==="resolvedImage"?c=Ms.build(c.toString()):ep(c)===a.type||a.type==="enum"&&a.values[c]||(c=void 0),pp(c,u.default,a.default)}as.register(fp,{error:[{kind:"error"},[$n],(u,[a])=>{throw new Ea(a.evaluate(u))}],typeof:[$n,[ai],(u,[a])=>Va(lo(a.evaluate(u)))],"to-rgba":[bo(Cr,4),[Ys],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[bo(Cr,4),[Ys],(u,[a])=>a.evaluate(u).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ys,[Cr,Cr,Cr],Tw],rgba:[Ys,[Cr,Cr,Cr,Cr],Tw],hsl:[Ys,[Cr,Cr,Cr],OA],hsla:[Ys,[Cr,Cr,Cr,Cr],OA],has:{type:ei,overloads:[[[$n],(u,[a])=>IA(a.evaluate(u),u.properties())],[[$n,Jf],(u,[a,c])=>IA(a.evaluate(u),c.evaluate(u))]]},get:{type:ai,overloads:[[[$n],(u,[a])=>c_(a.evaluate(u),u.properties())],[[$n,Jf],(u,[a,c])=>c_(a.evaluate(u),c.evaluate(u))]]},"feature-state":[ai,[$n],(u,[a])=>c_(a.evaluate(u),u.featureState||{})],properties:[Jf,[],u=>u.properties()],"geometry-type":[$n,[],u=>u.geometryType()],worldview:[$n,[],u=>u.globals.worldview||""],"is-active-floor":[ei,Wu($n),(u,a)=>{if(!(u.globals.activeFloors&&u.globals.activeFloors.size>0))return!1;const c=u.globals.activeFloors;return a.some(f=>{const p=f.evaluate(u);return c.has(p)})}],id:[ai,[],u=>u.id()],zoom:[Cr,[],u=>u.globals.zoom],pitch:[Cr,[],u=>u.globals.pitch||0],"distance-from-center":[Cr,[],u=>u.distanceFromCenter()],"measure-light":[Cr,[$n],(u,[a])=>u.measureLight(a.evaluate(u))],"heatmap-density":[Cr,[],u=>u.globals.heatmapDensity||0],"line-progress":[Cr,[],u=>u.globals.lineProgress||0],"raster-value":[Cr,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[Cr,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[Cr,[],u=>u.globals.skyRadialProgress||0],accumulated:[ai,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Cr,Wu(Cr),(u,a)=>{let c=0;for(const f of a)c+=f.evaluate(u);return c}],"*":[Cr,Wu(Cr),(u,a)=>{let c=1;for(const f of a)c*=f.evaluate(u);return c}],"-":{type:Cr,overloads:[[[Cr,Cr],(u,[a,c])=>a.evaluate(u)-c.evaluate(u)],[[Cr],(u,[a])=>-a.evaluate(u)]]},"/":[Cr,[Cr,Cr],(u,[a,c])=>a.evaluate(u)/c.evaluate(u)],"%":[Cr,[Cr,Cr],(u,[a,c])=>a.evaluate(u)%c.evaluate(u)],ln2:[Cr,[],()=>Math.LN2],pi:[Cr,[],()=>Math.PI],e:[Cr,[],()=>Math.E],"^":[Cr,[Cr,Cr],(u,[a,c])=>Math.pow(a.evaluate(u),c.evaluate(u))],sqrt:[Cr,[Cr],(u,[a])=>Math.sqrt(a.evaluate(u))],log10:[Cr,[Cr],(u,[a])=>Math.log(a.evaluate(u))/Math.LN10],ln:[Cr,[Cr],(u,[a])=>Math.log(a.evaluate(u))],log2:[Cr,[Cr],(u,[a])=>Math.log2(a.evaluate(u))],sin:[Cr,[Cr],(u,[a])=>Math.sin(a.evaluate(u))],cos:[Cr,[Cr],(u,[a])=>Math.cos(a.evaluate(u))],tan:[Cr,[Cr],(u,[a])=>Math.tan(a.evaluate(u))],asin:[Cr,[Cr],(u,[a])=>Math.asin(a.evaluate(u))],acos:[Cr,[Cr],(u,[a])=>Math.acos(a.evaluate(u))],atan:[Cr,[Cr],(u,[a])=>Math.atan(a.evaluate(u))],min:[Cr,Wu(Cr),(u,a)=>Math.min(...a.map(c=>c.evaluate(u)))],max:[Cr,Wu(Cr),(u,a)=>Math.max(...a.map(c=>c.evaluate(u)))],abs:[Cr,[Cr],(u,[a])=>Math.abs(a.evaluate(u))],round:[Cr,[Cr],(u,[a])=>{const c=a.evaluate(u);return c<0?-Math.round(-c):Math.round(c)}],floor:[Cr,[Cr],(u,[a])=>Math.floor(a.evaluate(u))],ceil:[Cr,[Cr],(u,[a])=>Math.ceil(a.evaluate(u))],"filter-==":[ei,[$n,ai],(u,[a,c])=>u.properties()[a.value]===c.value],"filter-id-==":[ei,[ai],(u,[a])=>u.id()===a.value],"filter-type-==":[ei,[$n],(u,[a])=>u.geometryType()===a.value],"filter-<":[ei,[$n,ai],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f<p}],"filter-id-<":[ei,[ai],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c<f}],"filter->":[ei,[$n,ai],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f>p}],"filter-id->":[ei,[ai],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c>f}],"filter-<=":[ei,[$n,ai],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f<=p}],"filter-id-<=":[ei,[ai],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c<=f}],"filter->=":[ei,[$n,ai],(u,[a,c])=>{const f=u.properties()[a.value],p=c.value;return typeof f==typeof p&&f>=p}],"filter-id->=":[ei,[ai],(u,[a])=>{const c=u.id(),f=a.value;return typeof c==typeof f&&c>=f}],"filter-has":[ei,[ai],(u,[a])=>a.value in u.properties()],"filter-has-id":[ei,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[ei,[bo($n)],(u,[a])=>a.value.indexOf(u.geometryType())>=0],"filter-id-in":[ei,[bo(ai)],(u,[a])=>a.value.indexOf(u.id())>=0],"filter-in-small":[ei,[$n,bo(ai)],(u,[a,c])=>c.value.indexOf(u.properties()[a.value])>=0],"filter-in-large":[ei,[$n,bo(ai)],(u,[a,c])=>function(f,p,_,b){for(;_<=b;){const T=_+b>>1;if(p[T]===f)return!0;p[T]>f?b=T-1:_=T+1}return!1}(u.properties()[a.value],c.value,0,c.value.length-1)],all:{type:ei,overloads:[[[ei,ei],(u,[a,c])=>a.evaluate(u)&&c.evaluate(u)],[Wu(ei),(u,a)=>{for(const c of a)if(!c.evaluate(u))return!1;return!0}]]},any:{type:ei,overloads:[[[ei,ei],(u,[a,c])=>a.evaluate(u)||c.evaluate(u)],[Wu(ei),(u,a)=>{for(const c of a)if(c.evaluate(u))return!0;return!1}]]},"!":[ei,[ei],(u,[a])=>!a.evaluate(u)],"is-supported-script":[ei,[$n],(u,[a])=>{const c=u.globals&&u.globals.isSupportedScript;return!c||c(a.evaluate(u))}],upcase:[$n,[$n],(u,[a])=>a.evaluate(u).toUpperCase()],downcase:[$n,[$n],(u,[a])=>a.evaluate(u).toLowerCase()],concat:[$n,Wu(ai),(u,a)=>a.map(c=>nu(c.evaluate(u))).join("")],"resolved-locale":[$n,[Tg],(u,[a])=>a.evaluate(u).resolvedLocale()],random:[Cr,[Cr,Cr,ai],(u,a)=>{const[c,f,p]=a.map(b=>b.evaluate(u));if(c>f||c===f)return c;let _;if(typeof p=="string")_=function(b){let T=0;if(b.length===0)return T;for(let I=0;I<b.length;I++)T=(T<<5)-T+b.charCodeAt(I),T|=0;return T}(p);else{if(typeof p!="number")throw new Ea(`Invalid seed input: ${p}`);_=p}return c+CA(_)()*(f-c)}]});class m_{constructor(a,c,f,p,_){this.expression=a,this._warningHistory={},this._scope=f,this._options=p,this._iconImageUseTheme=_,this._evaluator=new wo(f,p,_),this._defaultValue=c?function(b){return b.type==="color"&&(f_(b.default)||Array.isArray(b.default))?new ri(0,0,0,0):b.type==="color"?ri.parse(b.default)||null:b.default===void 0?null:b.default}(c):null,this._enumValues=c&&c.type==="enum"?c.values:null,this.configDependencies=Ug(a),this.isIndoorDependent=u_(a)}evaluateWithoutErrorHandling(a,c,f,p,_,b,T,I){return this._evaluator.globals=a,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(a,c,f,p,_,b,T,I,M){this._evaluator||(this._evaluator=new wo(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=a,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this._evaluator.iconImageUseTheme=M||null;try{const $=this.expression.evaluate(this._evaluator);if($==null||typeof $=="number"&&$!=$)return this._defaultValue;if(this._enumValues&&!($ in this._enumValues))throw new Ea(`Expected value to be one of ${Object.keys(this._enumValues).map(V=>JSON.stringify(V)).join(", ")}, but found ${JSON.stringify($)} instead.`);return $}catch($){return this._warningHistory[$.message]||(this._warningHistory[$.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${$.message}`)),this._defaultValue}}}function g_(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in fp}function ou(u,a,c,f,p){const _=new Qv(fp,[],a?function(T){const I={color:Ys,string:$n,number:Cr,enum:$n,boolean:ei,formatted:Bh,resolvedImage:Ag};return T.type==="array"?bo(I[T.value]||ai,T.length):I[T.type]}(a):void 0,void 0,void 0,c,f,p),b=_.parse(u,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return b?Hh(new m_(b,a,c,f,p)):$d(_.errors)}class Vg{constructor(a,c,f,p){this.kind=a,this._styleExpression=c,this.isLightConstant=f,this.isLineProgressConstant=p,this.isStateDependent=a!=="constant"&&!Dg(c.expression),this.configDependencies=Ug(c.expression),this.isIndoorDependent=u_(c.expression)}evaluateWithoutErrorHandling(a,c,f,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,p,_,b)}evaluate(a,c,f,p,_,b,T){return this._styleExpression.evaluate(a,c,f,p,_,b,void 0,void 0,T)}}class Vd{constructor(a,c,f,p,_,b){this.kind=a,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=a!=="camera"&&!Dg(c.expression),this.isIndoorDependent=u_(c.expression),this.isLightConstant=_,this.isLineProgressConstant=b,this.configDependencies=Ug(c.expression),this.interpolationType=p}evaluateWithoutErrorHandling(a,c,f,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(a,c,f,p,_,b)}evaluate(a,c,f,p,_,b){return this._styleExpression.evaluate(a,c,f,p,_,b)}interpolationFactor(a,c,f){return this.interpolationType?xl.interpolationFactor(this.interpolationType,a,c,f):0}}function Iw(u,a,c,f,p){if((u=ou(u,a,c,f,p)).result==="error")return u;const _=u.value.expression,b=sp(_);if(!b&&!d_(a))return $d([new Ql("","data expressions not supported")]);const T=lp(_,["zoom","pitch","distance-from-center"]);if(!T&&!Cw(a))return $d([new Ql("","zoom expressions not supported")]);const I=lp(_,["measure-light"]);if(!I&&!Pw(a))return $d([new Ql("","measure-light expression not supported")]);const M=lp(_,["line-progress"]);if(!M&&!function(q){return Aw(q.expression,"line-progress")}(a))return $d([new Ql("","line-progress expression not supported")]);const $=a.expression&&a.expression.relaxZoomRestriction,V=v_(_);return V||T||$?V instanceof Ql?$d([V]):V instanceof xl&&!h_(a)?$d([new Ql("",'"interpolate" expressions cannot be used with this property')]):Hh(V?new Vd(b&&M?"camera":"composite",u.value,V.labels,V instanceof xl?V.interpolation:void 0,I,M):new Vg(b&&M?"constant":"source",u.value,I,M)):$d([new Ql("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class y_{constructor(a,c){this._parameters=a,this._specification=c,Object.assign(this,p_(this._parameters,this._specification))}static deserialize(a){return new y_(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function v_(u){let a=null;if(u instanceof Bg)a=v_(u.result);else if(u instanceof zg){for(const c of u.args)if(a=v_(c),a)break}else(u instanceof Lg||u instanceof xl)&&u.input instanceof as&&u.input.name==="zoom"&&(a=u);return a instanceof Ql||u.eachChild(c=>{const f=v_(c);f instanceof Ql?a=f:a&&f&&a!==f&&(a=new Ql("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}var qg,__,RA=function(){if(__)return qg;__=1,qg=a;var u=3;function a(c,f,p){var _=this.cells=[];if(c instanceof ArrayBuffer){this.arrayBuffer=c;var b=new Int32Array(this.arrayBuffer);c=b[0],this.d=(f=b[1])+2*(p=b[2]);for(var T=0;T<this.d*this.d;T++){var I=b[u+T],M=b[u+T+1];_.push(I===M?null:b.subarray(I,M))}var $=b[u+_.length+1];this.keys=b.subarray(b[u+_.length],$),this.bboxes=b.subarray($),this.insert=this._insertReadonly}else{this.d=f+2*p;for(var V=0;V<this.d*this.d;V++)_.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=c,this.padding=p,this.scale=f/c,this.uid=0;var q=p/f*c;this.min=-q,this.max=c+q}return a.prototype.insert=function(c,f,p,_,b){this._forEachCell(f,p,_,b,this._insertCell,this.uid++),this.keys.push(c),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(b)},a.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},a.prototype._insertCell=function(c,f,p,_,b,T){this.cells[b].push(T)},a.prototype.query=function(c,f,p,_,b){var T=this.min,I=this.max;if(c<=T&&f<=T&&I<=p&&I<=_&&!b)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(c,f,p,_,this._queryCell,M,{},b),M},a.prototype._queryCell=function(c,f,p,_,b,T,I,M){var $=this.cells[b];if($!==null)for(var V=this.keys,q=this.bboxes,Y=0;Y<$.length;Y++){var J=$[Y];if(I[J]===void 0){var ae=4*J;(M?M(q[ae+0],q[ae+1],q[ae+2],q[ae+3]):c<=q[ae+2]&&f<=q[ae+3]&&p>=q[ae+0]&&_>=q[ae+1])?(I[J]=!0,T.push(V[J])):I[J]=!1}}},a.prototype._forEachCell=function(c,f,p,_,b,T,I,M){for(var $=this._convertToCellCoord(c),V=this._convertToCellCoord(f),q=this._convertToCellCoord(p),Y=this._convertToCellCoord(_),J=$;J<=q;J++)for(var ae=V;ae<=Y;ae++){var ce=this.d*ae+J;if((!M||M(this._convertFromCellCoord(J),this._convertFromCellCoord(ae),this._convertFromCellCoord(J+1),this._convertFromCellCoord(ae+1)))&&b.call(this,c,f,p,_,ce,T,I,M))return}},a.prototype._convertFromCellCoord=function(c){return(c-this.padding)/this.scale},a.prototype._convertToCellCoord=function(c){return Math.max(0,Math.min(this.d-1,Math.floor(c*this.scale)+this.padding))},a.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var c=this.cells,f=u+this.cells.length+1+1,p=0,_=0;_<this.cells.length;_++)p+=this.cells[_].length;var b=new Int32Array(f+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var T=f,I=0;I<c.length;I++){var M=c[I];b[u+I]=T,b.set(M,T),T+=M.length}return b[u+c.length]=T,b.set(this.keys,T),b[u+c.length+1]=T+=this.keys.length,b.set(this.bboxes,T),T+=this.bboxes.length,b.buffer},qg}(),Kh=Ii(RA);const mp={};function gr(u,a,c={}){Object.defineProperty(u,"_classRegistryKey",{value:a,writable:!1}),mp[a]={klass:u,omit:c.omit||[]}}gr(Object,"Object"),Kh.serialize=function(u,a){const c=u.toArrayBuffer();return a&&a.add(c),{buffer:c}},Kh.deserialize=function(u){return new Kh(u.buffer)},Object.defineProperty(Kh,"name",{value:"Grid"}),gr(Kh,"Grid"),delete Nt.prototype.constructor,typeof DOMMatrix<"u"&&gr(DOMMatrix,"DOMMatrix"),gr(ri,"Color"),gr(Error,"Error"),gr(fo,"Formatted"),gr(Og,"FormattedSection"),gr(Fh,"AJAXError"),gr(Ms,"ResolvedImage"),gr(y_,"StylePropertyFunction"),gr(m_,"StyleExpression",{omit:["_evaluator"]}),gr(Qa,"ImageId"),gr(Uu,"ImageVariant"),gr(Vd,"ZoomDependentExpression"),gr(Vg,"ZoomConstantExpression"),gr(as,"CompoundExpression",{omit:["_evaluate"]});for(const u in fp)mp[fp[u]._classRegistryKey]||gr(fp[u],`Expression${u}`);function kw(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function Gu(u){return self.ImageBitmap&&u instanceof ImageBitmap}function qd(u,a){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(kw(u)||Gu(u))return a&&a.add(u),u;if(ArrayBuffer.isView(u))return a&&a.add(u.buffer),u;if(u instanceof ImageData)return a&&a.add(u.data.buffer),u;if(Array.isArray(u)){const c=[];for(const f of u)c.push(qd(f,a));return c}if(u instanceof Map){const c={$name:"Map",entries:[]};for(const[f,p]of u.entries())c.entries.push(qd(f),qd(p,a));return c}if(u instanceof Set){const c={$name:"Set"};let f=0;for(const p of u.values())c[++f]=qd(p);return c}if(u instanceof DOMMatrix){const c={$name:"DOMMatrix"},f=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const p of f)c[p]=u[p];return c}if(typeof u=="bigint")return{$name:"BigInt",value:u.toString()};if(typeof u=="object"){const c=u.constructor,f=c._classRegistryKey;if(!f)throw new Error(`Can't serialize object of unregistered class "${c.name}".`);const p=c.serialize?c.serialize(u,a):{};if(!c.serialize){for(const _ in u)u.hasOwnProperty(_)&&(mp[f].omit.indexOf(_)>=0||(p[_]=qd(u[_],a)));u instanceof Error&&(p.message=u.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(p.$name=f),p}throw new Error("can't serialize object of type "+typeof u)}function Wd(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||kw(u)||Gu(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Wd);if(typeof u=="object"){const a=u.$name||"Object";if(a==="Map"){const p=u.entries||[],_=new Map;for(let b=0;b<p.length;b+=2)_.set(Wd(p[b]),Wd(p[b+1]));return _}if(a==="Set"){const p=new Set;for(const _ of Object.keys(u))_!=="$name"&&p.add(Wd(u[_]));return p}if(a==="DOMMatrix"){let p;return p=u.is2D?[u.a,u.b,u.c,u.d,u.e,u.f]:[u.m11,u.m12,u.m13,u.m14,u.m21,u.m22,u.m23,u.m24,u.m31,u.m32,u.m33,u.m34,u.m41,u.m42,u.m43,u.m44],new DOMMatrix(p)}if(a==="BigInt")return BigInt(u.value);const{klass:c}=mp[a];if(!c)throw new Error(`Can't deserialize unregistered class "${a}".`);if(c.deserialize)return c.deserialize(u);const f=Object.create(c.prototype);for(const p of Object.keys(u))p!=="$name"&&(f[p]=Wd(u[p]));return f}throw new Error("can't deserialize object of type "+typeof u)}const jr={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,Osage:u=>u>=66736&&u<=66815,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function Rw(u){for(const a of u)if(b_(a.charCodeAt(0)))return!0;return!1}function jA(u){for(const a of u)if(!x_(a.charCodeAt(0)))return!1;return!0}function x_(u){return!(jr.Arabic(u)||jr["Arabic Supplement"](u)||jr["Arabic Extended-A"](u)||jr["Arabic Presentation Forms-A"](u)||jr["Arabic Presentation Forms-B"](u))}function b_(u){return!(u!==746&&u!==747&&(u<4352||!(jr["Bopomofo Extended"](u)||jr.Bopomofo(u)||jr["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||jr["CJK Compatibility Ideographs"](u)||jr["CJK Compatibility"](u)||jr["CJK Radicals Supplement"](u)||jr["CJK Strokes"](u)||!(!jr["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||jr["CJK Unified Ideographs Extension A"](u)||jr["CJK Unified Ideographs"](u)||jr["Enclosed CJK Letters and Months"](u)||jr["Hangul Compatibility Jamo"](u)||jr["Hangul Jamo Extended-A"](u)||jr["Hangul Jamo Extended-B"](u)||jr["Hangul Jamo"](u)||jr["Hangul Syllables"](u)||jr.Hiragana(u)||jr["Ideographic Description Characters"](u)||jr.Kanbun(u)||jr["Kangxi Radicals"](u)||jr["Katakana Phonetic Extensions"](u)||jr.Katakana(u)&&u!==12540||!(!jr["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!jr["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||jr["Unified Canadian Aboriginal Syllabics"](u)||jr["Unified Canadian Aboriginal Syllabics Extended"](u)||jr["Vertical Forms"](u)||jr["Yijing Hexagram Symbols"](u)||jr["Yi Syllables"](u)||jr["Yi Radicals"](u))))}function jw(u){return!(b_(u)||function(a){return!!(jr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||jr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||jr["Letterlike Symbols"](a)||jr["Number Forms"](a)||jr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||jr["Control Pictures"](a)&&a!==9251||jr["Optical Character Recognition"](a)||jr["Enclosed Alphanumerics"](a)||jr["Geometric Shapes"](a)||jr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||jr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||jr["CJK Symbols and Punctuation"](a)||jr.Katakana(a)||jr["Private Use Area"](a)||jr["CJK Compatibility Forms"](a)||jr["Small Form Variants"](a)||jr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(u))}function Nw(u){return jr.Arabic(u)||jr["Arabic Supplement"](u)||jr["Arabic Extended-A"](u)||jr["Arabic Presentation Forms-A"](u)||jr["Arabic Presentation Forms-B"](u)}function NA(u){return u>=1424&&u<=2303||jr["Arabic Presentation Forms-A"](u)||jr["Arabic Presentation Forms-B"](u)}function oj(u,a){return!(!a&&NA(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||jr.Khmer(u))}function sj(u){for(const a of u)if(NA(a.charCodeAt(0)))return!0;return!1}const Js={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Mw=null,ws=Js.unavailable,Gd=null;const MA=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(ws=Js.error),Mw&&Mw(u)};function Dw(){Lw.fire(new vl("pluginStateChange",{pluginStatus:ws,pluginURL:Gd}))}const Lw=new Bu,Fw=function(){return ws},zw=function(){if(ws!==Js.deferred||!Gd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws=Js.loading,Dw(),Gd&&Zf({url:Gd},u=>{u?MA(u):(ws=Js.loaded,Dw())})},Qs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ws===Js.loaded||Qs.applyArabicShaping!=null,isLoading:()=>ws===Js.loading,setState(u){ws=u.pluginStatus,Gd=u.pluginURL},isParsing:()=>ws===Js.parsing,isParsed:()=>ws===Js.parsed,getPluginURL:()=>Gd};class ki{constructor(a,c){this.zoom=a,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.transition=c.transition,this.pitch=c.pitch,this.brightness=c.brightness,this.worldview=c.worldview,this.activeFloors=c.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(a){return function(c,f){for(const p of c)if(!oj(p.charCodeAt(0),f))return!1;return!0}(a,Qs.isLoaded())}}class Wg{constructor(a,c,f,p,_){this.property=a,this.value=c,this.expression=function(b,T,I,M,$){if(f_(b))return new y_(b,T);if(g_(b)||Array.isArray(b)&&b.length>0){const V=Iw(b,T,I,M,$);if(V.result==="error")throw new Error(V.value.map(q=>`${q.key}: ${q.message}`).join(", "));return V.value}{let V=b;return typeof b=="string"&&T.type==="color"&&(V=ri.parse(b)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>V}}}(c===void 0?a.specification.default:c,a.specification,f,p,_)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,c,f,p){return this.property.possiblyEvaluate(this,a,c,f,p)}}class gp{constructor(a,c,f,p){this.property=a,this.value=new Wg(a,void 0,c,f,p)}transitioned(a,c){return new LA(this.property,this.value,c,Object.assign({},a.transition,this.transition),a.now)}untransitioned(){return new LA(this.property,this.value,null,{},0)}}class DA{constructor(a,c,f,p){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues),this._scope=c,this._options=f,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Tr(this._values[a].value.value)}setValue(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new gp(this._values[a].property,this._scope,this._options,this._iconImageUseTheme)),this._values[a].value=new Wg(this._values[a].property,c===null?void 0:Tr(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].value.isIndoorDependent())}setTransitionOrValue(a,c){c&&(this._options=c);const f=this._properties.properties;if(a)for(const p in a){const _=a[p];if(p.endsWith("-transition")){const b=p.slice(0,-11);f[b]&&this.setTransition(b,_)}else f.hasOwnProperty(p)&&this.setValue(p,_)}}getTransition(a){return Tr(this._values[a].transition)}setTransition(a,c){this._values.hasOwnProperty(a)||(this._values[a]=new gp(this._values[a].property)),this._values[a].transition=Tr(c)||void 0}serialize(){const a={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(a[c]=f);const p=this.getTransition(c);p!==void 0&&(a[`${c}-transition`]=p)}return a}transitioned(a,c){const f=new Hu(this._properties);for(const p of Object.keys(this._values))f._values[p]=this._values[p].transitioned(a,c._values[p]);return f}untransitioned(){const a=new Hu(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].untransitioned();return a}isIndoorDependent(){return this._isIndoorDependent}}class LA{constructor(a,c,f,p,_){const b=p.delay||0,T=p.duration||0;_=_||0,this.property=a,this.value=c,this.begin=_+b,this.end=this.begin+T,a.specification.transition&&(p.delay||p.duration)&&(this.prior=f)}possiblyEvaluate(a,c,f){const p=a.now||0,_=this.value.possiblyEvaluate(a,c,f),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(a,c,f);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,c,f),_,dg(T))}}return _}}class Hu{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,c,f){const p=new Zh(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(a,c,f);return p}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Bw{constructor(a,c,f,p){this._properties=a,this._values=Object.create(a.defaultPropertyValues),this._scope=c,this._options=f,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(a){return Tr(this._values[a].value)}setValue(a,c){this._values[a]=new Wg(this._values[a].property,c===null?void 0:Tr(c),this._scope,this._options,this._iconImageUseTheme),this._values[a].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[a].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[a].isIndoorDependent())}serialize(){const a={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(a[c]=f)}return a}possiblyEvaluate(a,c,f,p){const _=new Zh(this._properties);for(const b of Object.keys(this._values))_._values[b]=this._values[b].possiblyEvaluate(a,c,f,p);return _}isIndoorDependent(){return this._isIndoorDependent}}class ic{constructor(a,c,f,p){this.property=a,this.value=c,this.parameters=f,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,c,f,p){return this.property.evaluate(this.value,this.parameters,a,c,f,p,this.iconImageUseTheme)}}class Zh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class qt{constructor(a){this.specification=a}possiblyEvaluate(a,c){return a.expression.evaluate(c)}interpolate(a,c,f){const p=$u[this.specification.type];return p?p(a,c,f):a}}class sr{constructor(a,c){this.specification=a,this.overrides=c}possiblyEvaluate(a,c,f,p,_){return a.expression.kind==="constant"||a.expression.kind==="camera"?new ic(this,{kind:"constant",value:a.expression.evaluate(c,null,{},f,p,void 0,_)},c):new ic(this,a.expression,c,_)}interpolate(a,c,f){if(a.value.kind!=="constant"||c.value.kind!=="constant")return a;if(a.value.value===void 0||c.value.value===void 0)return new ic(this,{kind:"constant",value:void 0},a.parameters);const p=$u[this.specification.type];return p?new ic(this,{kind:"constant",value:p(a.value.value,c.value.value,f)},a.parameters):a}evaluate(a,c,f,p,_,b,T){return a.kind==="constant"?a.value:a.evaluate(c,f,p,_,b,void 0,T)}}class yp{constructor(a){this.specification=a}possiblyEvaluate(a,c,f,p){return!!a.expression.evaluate(c,null,{},f,p)}interpolate(){return!1}}class la{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const c=new ki(0,{});for(const f in a){const p=a[f];p.specification.overridable&&this.overridableProperties.push(f);const _=this.defaultPropertyValues[f]=new Wg(p,void 0),b=this.defaultTransitionablePropertyValues[f]=new gp(p);this.defaultTransitioningPropertyValues[f]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=_.possiblyEvaluate(c)}}}gr(sr,"DataDrivenProperty"),gr(qt,"DataConstantProperty"),gr(yp,"ColorRampProperty");var lt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function $w(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function vp(u){if(Array.isArray(u))return u.map(vp);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const a={};for(const c in u)a[c]=vp(u[c]);return a}return $w(u)}function _p(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const a of u.slice(1))if(!_p(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}function w_(u,a="",c=null,f="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};_p(u)||(u=bl(u));const p=u;let _=!0;try{_=function($){if(!bp($))return $;let V=vp($);return xp(V),V=S_(V),V}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let b=null,T=null;if(f!=="background"&&f!=="sky"&&f!=="slot"){T=lt[`filter_${f}`];const $=ou(_,T,a,c);if($.result==="error")throw new Error($.value.map(V=>`${V.key}: ${V.message}`).join(", "));b=(V,q,Y)=>$.value.evaluate(V,q,{},Y)}let I=null,M=null;if(_!==p){const $=ou(p,T,a,c);if($.result==="error")throw new Error($.value.map(V=>`${V.key}: ${V.message}`).join(", "));I=(V,q,Y,J,ae)=>$.value.evaluate(V,q,{},Y,void 0,void 0,J,ae),M=!sp($.value.expression)}return{filter:b,dynamicFilter:I||void 0,needGeometry:zA(_),needFeature:!!M}}function S_(u){if(!Array.isArray(u))return u;const a=function(c){if(lj.has(c[0])){for(let f=1;f<c.length;f++)if(bp(c[f]))return!0}return c}(u);return a===!0?a:a.map(c=>S_(c))}function xp(u){let a=!1;const c=[];if(u[0]==="case"){for(let f=1;f<u.length-1;f+=2)a=a||bp(u[f]),c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="match"){a=a||bp(u[1]);for(let f=2;f<u.length-1;f+=2)c.push(u[f+1]);c.push(u[u.length-1])}else if(u[0]==="step"){a=a||bp(u[1]);for(let f=1;f<u.length-1;f+=2)c.push(u[f+1])}a&&(u.length=0,u.push("any",...c));for(let f=1;f<u.length;f++)xp(u[f])}function bp(u){if(!Array.isArray(u))return!1;if((a=u[0])==="pitch"||a==="distance-from-center")return!0;var a;for(let c=1;c<u.length;c++)if(bp(u[c]))return!0;return!1}const lj=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function FA(u,a){return u<a?-1:u>a?1:0}function zA(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let a=1;a<u.length;a++)if(zA(u[a]))return!0;return!1}function bl(u){if(!u)return!0;const a=u[0];return u.length<=1?a!=="any":a==="=="?Uw(u[1],u[2],"=="):a==="!="?E_(Uw(u[1],u[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Uw(u[1],u[2],a):a==="any"?(c=u.slice(1),["any"].concat(c.map(bl))):a==="all"?["all"].concat(u.slice(1).map(bl)):a==="none"?["all"].concat(u.slice(1).map(bl).map(E_)):a==="in"?Vw(u[1],u.slice(2)):a==="!in"?E_(Vw(u[1],u.slice(2))):a==="has"?BA(u[1]):a!=="!has"||E_(BA(u[1]));var c}function Uw(u,a,c){switch(u){case"$type":return[`filter-type-${c}`,a];case"$id":return[`filter-id-${c}`,a];default:return[`filter-${c}`,u,a]}}function Vw(u,a){if(a.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(c=>typeof c!=typeof a[0])?["filter-in-large",u,["literal",a.sort(FA)]]:["filter-in-small",u,["literal",a]]}}function BA(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function E_(u){return["!",u]}const Gg="";function Xh(u,a){return a?`${u}${Gg}${a}`:u}let $A;const UA=()=>$A||($A=new la({"icon-size":new sr(lt.layout_symbol["icon-size"]),"icon-image":new sr(lt.layout_symbol["icon-image"]),"icon-rotate":new sr(lt.layout_symbol["icon-rotate"]),"icon-offset":new sr(lt.layout_symbol["icon-offset"])}));class cj{constructor(a,c,f,p,_,b){this.cachedIconPrimary=null;const T=ou(a,lt.appearance.condition);if(T.result==="success"&&(this.condition=T.value),this.name=c,f){this.properties=new Zh(UA()),this.unevaluatedLayout=new Bw(UA(),p,_,b);for(const I in f)this.unevaluatedLayout.setValue(I,f[I])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(a){this.cachedIconPrimary=a}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(a){return!(this.condition||!a.isHidden||this.name!=="hidden")||this.condition.evaluate(a.globals,a.feature,a.featureState,a.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(a){return this.properties.get(a)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(a,c,f){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(a,void 0,c,f))}serialize(){const a={};return a.condition=this.condition.expression.serialize(),this.name&&(a.name=this.name),this.unevaluatedLayout&&(a.properties=this.unevaluatedLayout.serialize()),a}}const VA="-transition",uj=new Set(["fill","line","background","hillshade","raster"]);class os extends Bu{constructor(a,c,f,p,_,b){if(super(),this.id=a.id,this.fqid=Xh(this.id,f),this.type=a.type,this.scope=f,this.lut=p,this.options=_,this.iconImageUseTheme=b,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},a.type!=="custom"){if(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type&&a.type!=="background"&&a.type!=="sky"&&a.type!=="slot"){this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter;const T=ou(this.filter,lt[`filter_${a.type}`]);T.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...T.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||T.value.isIndoorDependent)}if(a.slot&&(this.slot=a.slot),a.appearances&&this.setAppearances(a.appearances),c.layout&&(this._unevaluatedLayout=new Bw(c.layout,this.scope,_,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),c.paint){this._transitionablePaint=new DA(c.paint,this.scope,_);for(const T in a.paint)this.setPaintProperty(T,a.paint[T]);for(const T in a.layout)this.setLayoutProperty(T,a.layout[T]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Zh(c.paint)}}}onAdd(a){}onRemove(a){}isDraped(a){return!this.is3D(!0)&&uj.has(this.type)}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,c){if(this.type==="custom"&&a==="visibility")return void(this.visibility=c);const f=this._unevaluatedLayout;f._properties.properties[a]&&(f.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),a==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(a){this.appearances=[],a.forEach(c=>{this.appearances.push(new cj(c.condition,c.name,c.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(a){return a.endsWith(VA)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}isPaintProperty(a){return!!this._transitionablePaint._properties.properties[a]}setPaintProperty(a,c){const f=this._transitionablePaint,p=f._properties.properties;if(a.endsWith(VA)){const V=a.slice(0,-11);return p[V]&&f.setTransition(V,c||void 0),!1}if(!p[a])return!1;const _=f._values[a],b=_.value.isDataDriven(),T=_.value;f.setValue(a,c),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...f.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||f.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(a);const I=f._values[a].value,M=I.isDataDriven(),$=a.endsWith("pattern")||a==="line-dasharray";return M||b||$||this._handleOverridablePaintPropertyUpdate(a,T,I)}_handleSpecialPaintPropertyUpdate(a){}getProgramIds(){return null}getDefaultProgramParams(a,c,f){return null}_handleOverridablePaintPropertyUpdate(a,c,f){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,c){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,c,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,c)}serialize(){const a={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(a.appearances=this.appearances.map(c=>c.serialize())),zt(a,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}is3D(a){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const a in this.paint._values){const c=this.paint.get(a);if(c instanceof ic&&d_(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}for(const a of this.appearances)if(!Dg(a.condition.expression))return!0;return!1}compileFilter(a){this._filterCompiled||(this._featureFilter=w_(this.filter,this.scope,a),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(a){this._stats&&(a.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(a,c,f){return{}}queryRadius(a){}queryIntersectsFeature(a,c,f,p,_,b,T,I,M){}}const dj={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hg{constructor(a,c){this._structArray=a,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.capacity=-1,this.resize(0)}static serialize(a,c){return a._trim(),c&&c.add(a.arrayBuffer),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const c=Object.create(this.prototype);return c.arrayBuffer=a.arrayBuffer,c.length=a.length,c.capacity=a.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...a){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...a){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function En(u,a=1){let c=0,f=0;return{members:u.map(p=>{const _=dj[p.type].BYTES_PER_ELEMENT,b=c=qw(c,Math.max(a,_)),T=p.components||1;return f=Math.max(f,_),c+=_*T,{name:p.name,type:p.type,components:T,offset:b}}),size:qw(c,Math.max(f,a)),alignment:a}}function qw(u,a){return Math.ceil(u/a)*a}class Ds extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.int16[p+0]=c,this.int16[p+1]=f,a}}Ds.prototype.bytesPerElement=4,gr(Ds,"StructArrayLayout2i4");class Yh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const _=3*a;return this.int16[_+0]=c,this.int16[_+1]=f,this.int16[_+2]=p,a}}Yh.prototype.bytesPerElement=6,gr(Yh,"StructArrayLayout3i6");class wp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,c,f,p)}emplace(a,c,f,p,_){const b=4*a;return this.int16[b+0]=c,this.int16[b+1]=f,this.int16[b+2]=p,this.int16[b+3]=_,a}}wp.prototype.bytesPerElement=8,gr(wp,"StructArrayLayout4i8");class Ku extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.float32[1*a+0]=c,a}}Ku.prototype.bytesPerElement=4,gr(Ku,"StructArrayLayout1f4");class Ww extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const _=4*a,b=2*a;return this.int16[_+0]=c,this.int16[_+1]=f,this.float32[b+1]=p,a}}Ww.prototype.bytesPerElement=8,gr(Ww,"StructArrayLayout2i1f8");class Gw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const _=4*a;return this.int16[_+0]=c,this.int16[_+1]=f,this.int16[_+2]=p,a}}Gw.prototype.bytesPerElement=8,gr(Gw,"StructArrayLayout3i8");class T_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,_)}emplace(a,c,f,p,_,b){const T=5*a;return this.int16[T+0]=c,this.int16[T+1]=f,this.int16[T+2]=p,this.int16[T+3]=_,this.int16[T+4]=b,a}}T_.prototype.bytesPerElement=10,gr(T_,"StructArrayLayout5i10");class A_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,f,p,_,b,T)}emplace(a,c,f,p,_,b,T,I){const M=6*a,$=12*a,V=3*a;return this.int16[M+0]=c,this.int16[M+1]=f,this.uint8[$+4]=p,this.uint8[$+5]=_,this.uint8[$+6]=b,this.uint8[$+7]=T,this.float32[V+2]=I,a}}A_.prototype.bytesPerElement=12,gr(A_,"StructArrayLayout2i4ub1f12");class wl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const _=3*a;return this.float32[_+0]=c,this.float32[_+1]=f,this.float32[_+2]=p,a}}wl.prototype.bytesPerElement=12,gr(wl,"StructArrayLayout3f12");class Hd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,_)}emplace(a,c,f,p,_,b){const T=6*a,I=3*a;return this.uint16[T+0]=c,this.uint16[T+1]=f,this.uint16[T+2]=p,this.uint16[T+3]=_,this.float32[I+2]=b,a}}Hd.prototype.bytesPerElement=12,gr(Hd,"StructArrayLayout4ui1f12");class Jh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,c,f,p)}emplace(a,c,f,p,_){const b=4*a;return this.uint16[b+0]=c,this.uint16[b+1]=f,this.uint16[b+2]=p,this.uint16[b+3]=_,a}}Jh.prototype.bytesPerElement=8,gr(Jh,"StructArrayLayout4ui8");class P_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,a,c,f,p,_,b)}emplace(a,c,f,p,_,b,T){const I=6*a;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=p,this.int16[I+3]=_,this.int16[I+4]=b,this.int16[I+5]=T,a}}P_.prototype.bytesPerElement=12,gr(P_,"StructArrayLayout6i12");class C_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V,q){const Y=this.length;return this.resize(Y+1),this.emplace(Y,a,c,f,p,_,b,T,I,M,$,V,q)}emplace(a,c,f,p,_,b,T,I,M,$,V,q,Y){const J=12*a;return this.int16[J+0]=c,this.int16[J+1]=f,this.int16[J+2]=p,this.int16[J+3]=_,this.uint16[J+4]=b,this.uint16[J+5]=T,this.uint16[J+6]=I,this.uint16[J+7]=M,this.int16[J+8]=$,this.int16[J+9]=V,this.int16[J+10]=q,this.int16[J+11]=Y,a}}C_.prototype.bytesPerElement=24,gr(C_,"StructArrayLayout4i4ui4i24");class Sp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,a,c,f,p,_,b)}emplace(a,c,f,p,_,b,T){const I=10*a,M=5*a;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=p,this.float32[M+2]=_,this.float32[M+3]=b,this.float32[M+4]=T,a}}Sp.prototype.bytesPerElement=20,gr(Sp,"StructArrayLayout3i3f20");class Kd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,c,f,p)}emplace(a,c,f,p,_){const b=4*a;return this.float32[b+0]=c,this.float32[b+1]=f,this.float32[b+2]=p,this.float32[b+3]=_,a}}Kd.prototype.bytesPerElement=16,gr(Kd,"StructArrayLayout4f16");class Hw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint32[1*a+0]=c,a}}Hw.prototype.bytesPerElement=4,gr(Hw,"StructArrayLayout1ul4");class ac extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.uint16[p+0]=c,this.uint16[p+1]=f,a}}ac.prototype.bytesPerElement=4,gr(ac,"StructArrayLayout2ui4");class Kw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V,q,Y){const J=this.length;return this.resize(J+1),this.emplace(J,a,c,f,p,_,b,T,I,M,$,V,q,Y)}emplace(a,c,f,p,_,b,T,I,M,$,V,q,Y,J){const ae=20*a,ce=10*a;return this.int16[ae+0]=c,this.int16[ae+1]=f,this.int16[ae+2]=p,this.int16[ae+3]=_,this.int16[ae+4]=b,this.float32[ce+3]=T,this.float32[ce+4]=I,this.float32[ce+5]=M,this.float32[ce+6]=$,this.int16[ae+14]=V,this.uint32[ce+8]=q,this.uint16[ae+18]=Y,this.uint16[ae+19]=J,a}}Kw.prototype.bytesPerElement=40,gr(Kw,"StructArrayLayout5i4f1i1ul2ui40");class O_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,f,p,_,b,T)}emplace(a,c,f,p,_,b,T,I){const M=8*a;return this.int16[M+0]=c,this.int16[M+1]=f,this.int16[M+2]=p,this.int16[M+4]=_,this.int16[M+5]=b,this.int16[M+6]=T,this.int16[M+7]=I,a}}O_.prototype.bytesPerElement=16,gr(O_,"StructArrayLayout3i2i2i16");class Ep extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,_)}emplace(a,c,f,p,_,b){const T=4*a,I=8*a;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=p,this.int16[I+6]=_,this.int16[I+7]=b,a}}Ep.prototype.bytesPerElement=16,gr(Ep,"StructArrayLayout2f1f2i16");class Tp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,a,c,f,p,_,b)}emplace(a,c,f,p,_,b,T){const I=20*a,M=5*a;return this.uint8[I+0]=c,this.uint8[I+1]=f,this.float32[M+1]=p,this.float32[M+2]=_,this.float32[M+3]=b,this.float32[M+4]=T,a}}Tp.prototype.bytesPerElement=20,gr(Tp,"StructArrayLayout2ub4f20");class Gi extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f){const p=this.length;return this.resize(p+1),this.emplace(p,a,c,f)}emplace(a,c,f,p){const _=3*a;return this.uint16[_+0]=c,this.uint16[_+1]=f,this.uint16[_+2]=p,a}}Gi.prototype.bytesPerElement=6,gr(Gi,"StructArrayLayout3ui6");class Ap extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue){const De=this.length;return this.resize(De+1),this.emplace(De,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue)}emplace(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue,De){const Ge=30*a,Je=15*a,tt=60*a;return this.int16[Ge+0]=c,this.int16[Ge+1]=f,this.int16[Ge+2]=p,this.float32[Je+2]=_,this.float32[Je+3]=b,this.uint16[Ge+8]=T,this.uint16[Ge+9]=I,this.uint32[Je+5]=M,this.uint32[Je+6]=$,this.uint32[Je+7]=V,this.uint16[Ge+16]=q,this.uint16[Ge+17]=Y,this.uint16[Ge+18]=J,this.float32[Je+10]=ae,this.float32[Je+11]=ce,this.uint8[tt+48]=de,this.uint8[tt+49]=we,this.uint8[tt+50]=Te,this.uint32[Je+13]=Oe,this.int16[Ge+28]=Ue,this.uint8[tt+58]=De,a}}Ap.prototype.bytesPerElement=60,gr(Ap,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Zw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue,De,Ge,Je,tt,Et,ct,Tt,kt,Dt,Zt,$t,Rt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue,De,Ge,Je,tt,Et,ct,Tt,kt,Dt,Zt,$t,Rt)}emplace(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue,De,Ge,Je,tt,Et,ct,Tt,kt,Dt,Zt,$t,Rt,Bt){const bt=20*a,yt=40*a,Ft=80*a;return this.float32[bt+0]=c,this.float32[bt+1]=f,this.int16[yt+4]=p,this.int16[yt+5]=_,this.int16[yt+6]=b,this.int16[yt+7]=T,this.int16[yt+8]=I,this.int16[yt+9]=M,this.int16[yt+10]=$,this.int16[yt+11]=V,this.int16[yt+12]=q,this.uint16[yt+13]=Y,this.uint16[yt+14]=J,this.uint16[yt+15]=ae,this.uint16[yt+16]=ce,this.uint16[yt+17]=de,this.uint16[yt+18]=we,this.uint16[yt+19]=Te,this.uint16[yt+20]=Oe,this.uint16[yt+21]=Ue,this.uint16[yt+22]=De,this.uint16[yt+23]=Ge,this.uint16[yt+24]=Je,this.uint16[yt+25]=tt,this.uint16[yt+26]=Et,this.uint16[yt+27]=ct,this.uint32[bt+14]=Tt,this.float32[bt+15]=kt,this.float32[bt+16]=Dt,this.float32[bt+17]=Zt,this.float32[bt+18]=$t,this.uint8[Ft+76]=Rt,this.uint16[yt+39]=Bt,a}}Zw.prototype.bytesPerElement=80,gr(Zw,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Xw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b){const T=this.length;return this.resize(T+1),this.emplace(T,a,c,f,p,_,b)}emplace(a,c,f,p,_,b,T){const I=6*a;return this.float32[I+0]=c,this.float32[I+1]=f,this.float32[I+2]=p,this.float32[I+3]=_,this.float32[I+4]=b,this.float32[I+5]=T,a}}Xw.prototype.bytesPerElement=24,gr(Xw,"StructArrayLayout6f24");class Qh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,a,c,f,p,_)}emplace(a,c,f,p,_,b){const T=5*a;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=p,this.float32[T+3]=_,this.float32[T+4]=b,a}}Qh.prototype.bytesPerElement=20,gr(Qh,"StructArrayLayout5f20");class Yw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,f,p,_,b,T)}emplace(a,c,f,p,_,b,T,I){const M=7*a;return this.float32[M+0]=c,this.float32[M+1]=f,this.float32[M+2]=p,this.float32[M+3]=_,this.float32[M+4]=b,this.float32[M+5]=T,this.float32[M+6]=I,a}}Yw.prototype.bytesPerElement=28,gr(Yw,"StructArrayLayout7f28");class Kg extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V){const q=this.length;return this.resize(q+1),this.emplace(q,a,c,f,p,_,b,T,I,M,$,V)}emplace(a,c,f,p,_,b,T,I,M,$,V,q){const Y=11*a;return this.float32[Y+0]=c,this.float32[Y+1]=f,this.float32[Y+2]=p,this.float32[Y+3]=_,this.float32[Y+4]=b,this.float32[Y+5]=T,this.float32[Y+6]=I,this.float32[Y+7]=M,this.float32[Y+8]=$,this.float32[Y+9]=V,this.float32[Y+10]=q,a}}Kg.prototype.bytesPerElement=44,gr(Kg,"StructArrayLayout11f44");class Jw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M){const $=this.length;return this.resize($+1),this.emplace($,a,c,f,p,_,b,T,I,M)}emplace(a,c,f,p,_,b,T,I,M,$){const V=9*a;return this.float32[V+0]=c,this.float32[V+1]=f,this.float32[V+2]=p,this.float32[V+3]=_,this.float32[V+4]=b,this.float32[V+5]=T,this.float32[V+6]=I,this.float32[V+7]=M,this.float32[V+8]=$,a}}Jw.prototype.bytesPerElement=36,gr(Jw,"StructArrayLayout9f36");class Zd extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c){const f=this.length;return this.resize(f+1),this.emplace(f,a,c)}emplace(a,c,f){const p=2*a;return this.float32[p+0]=c,this.float32[p+1]=f,a}}Zd.prototype.bytesPerElement=8,gr(Zd,"StructArrayLayout2f8");class Qw extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,c,f,p){const _=this.length;return this.resize(_+1),this.emplace(_,a,c,f,p)}emplace(a,c,f,p,_){const b=6*a;return this.uint32[3*a+0]=c,this.uint16[b+2]=f,this.uint16[b+3]=p,this.uint16[b+4]=_,a}}Qw.prototype.bytesPerElement=12,gr(Qw,"StructArrayLayout1ul3ui12");class I_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint16[1*a+0]=c,a}}I_.prototype.bytesPerElement=2,gr(I_,"StructArrayLayout1ui2");class k_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce){const de=this.length;return this.resize(de+1),this.emplace(de,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce)}emplace(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de){const we=16*a;return this.float32[we+0]=c,this.float32[we+1]=f,this.float32[we+2]=p,this.float32[we+3]=_,this.float32[we+4]=b,this.float32[we+5]=T,this.float32[we+6]=I,this.float32[we+7]=M,this.float32[we+8]=$,this.float32[we+9]=V,this.float32[we+10]=q,this.float32[we+11]=Y,this.float32[we+12]=J,this.float32[we+13]=ae,this.float32[we+14]=ce,this.float32[we+15]=de,a}}k_.prototype.bytesPerElement=64,gr(k_,"StructArrayLayout16f64");class Pp extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,c,f,p,_,b,T){const I=this.length;return this.resize(I+1),this.emplace(I,a,c,f,p,_,b,T)}emplace(a,c,f,p,_,b,T,I){const M=10*a,$=5*a;return this.uint16[M+0]=c,this.uint16[M+1]=f,this.uint16[M+2]=p,this.uint16[M+3]=_,this.float32[$+2]=b,this.float32[$+3]=T,this.float32[$+4]=I,a}}Pp.prototype.bytesPerElement=20,gr(Pp,"StructArrayLayout4ui3f20");class e1 extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.int16[1*a+0]=c,a}}e1.prototype.bytesPerElement=2,gr(e1,"StructArrayLayout1i2");class R_ extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(a){const c=this.length;return this.resize(c+1),this.emplace(c,a)}emplace(a,c){return this.uint8[1*a+0]=c,a}}R_.prototype.bytesPerElement=1,gr(R_,"StructArrayLayout1ub1");class t1 extends Hg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}t1.prototype.size=40;class qA extends Kw{get(a){return new t1(this,a)}}gr(qA,"CollisionBoxArray");class j_ extends Hg{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(a){this._structArray.uint8[this._pos1+49]=a}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(a){this._structArray.uint8[this._pos1+50]=a}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(a){this._structArray.uint32[this._pos4+13]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(a){this._structArray.uint8[this._pos1+58]=a}}j_.prototype.size=60;class Zg extends Ap{get(a){return new j_(this,a)}}gr(Zg,"PlacedSymbolArray");class r1 extends Hg{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(a){this._structArray.uint32[this._pos4+14]=a}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(a){this._structArray.float32[this._pos4+18]=a}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}r1.prototype.size=80;class WA extends Zw{get(a){return new r1(this,a)}}gr(WA,"SymbolInstanceArray");class n1 extends Ku{getoffsetX(a){return this.float32[1*a+0]}}gr(n1,"GlyphOffsetArray");class GA extends Ds{getx(a){return this.int16[2*a+0]}gety(a){return this.int16[2*a+1]}}gr(GA,"SymbolLineVertexArray");class N_ extends Hg{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}N_.prototype.size=12;class HA extends Qw{get(a){return new N_(this,a)}}gr(HA,"FeatureIndexArray");class KA extends ac{geta_centroid_pos0(a){return this.uint16[2*a+0]}geta_centroid_pos1(a){return this.uint16[2*a+1]}}gr(KA,"FillExtrusionCentroidArray");class ZA extends Hg{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ZA.prototype.size=6;class XA extends Yh{get(a){return new ZA(this,a)}}gr(XA,"FillExtrusionWallArray");const YA=En([{name:"a_pos",components:2,type:"Int16"}],4),hj=En([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),fj=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ea{constructor(a=[]){this.segments=a}_prepareSegment(a,c,f,p){let _=this.segments[this.segments.length-1];return a>ea.MAX_VERTEX_ARRAY_LENGTH&&kr(`Max vertices per segment is ${ea.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!_||_.vertexLength+a>ea.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p)&&(_={vertexOffset:c,primitiveOffset:f,vertexLength:0,primitiveLength:0},p!==void 0&&(_.sortKey=p),this.segments.push(_)),_}prepareSegment(a,c,f,p){return this._prepareSegment(a,c.length,f.length,p)}get(){return this.segments}destroy(){for(const a of this.segments)for(const c in a.vaos)a.vaos[c].destroy()}static simpleSegment(a,c,f,p){return new ea([{vertexOffset:a,primitiveOffset:c,vertexLength:f,primitiveLength:p,vaos:{},sortKey:0}])}}function JA(u,a){return 256*(u=ve(Math.floor(u),0,255))+ve(Math.floor(a),0,255)}ea.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gr(ea,"SegmentVector");const pj=En([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mj=En([{name:"a_pattern_b",components:4,type:"Uint16"}]),gj=En([{name:"a_dash",components:4,type:"Uint16"}]);class Xg{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(a,c,f,p){this.ids.push(Yg(a)),this.positions.push(c,f,p)}eachPosition(a,c){const f=Yg(a);let p=0,_=this.ids.length-1;for(;p<_;){const b=p+_>>1;this.ids[b]>=f?_=b:p=b+1}for(;this.ids[p]===f;)c(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(a,c){const f=new Float64Array(a.ids),p=new Uint32Array(a.positions);return i1(f,p,0,f.length-1),c&&(c.add(f.buffer),c.add(p.buffer)),{ids:f,positions:p}}static deserialize(a){const c=new Xg;let f;c.ids=a.ids,c.positions=a.positions;for(const p of c.ids)p!==f&&c.uniqueIds.push(p),f=p;return c.indexed=!0,c}}function Yg(u){const a=+u;return Number.isSafeInteger(a)?a:bg(String(u))}function i1(u,a,c,f){for(;c<f;){const p=u[c+f>>1];let _=c-1,b=f+1;for(;;){do _++;while(u[_]<p);do b--;while(u[b]>p);if(_>=b)break;M_(u,_,b),M_(a,3*_,3*b),M_(a,3*_+1,3*b+1),M_(a,3*_+2,3*b+2)}b-c<f-b?(i1(u,a,c,b),c=b+1):(i1(u,a,b+1,f),f=b)}}function M_(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}gr(Xg,"FeaturePositionMap");class oc{constructor(a){this.gl=a.gl,this.initialized=!1}fetchUniformLocation(a,c){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(a,c),this.initialized=!0),!!this.location}set(a,c,f){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class D_ extends oc{constructor(a){super(a),this.current=0}set(a,c,f){this.fetchUniformLocation(a,c)&&this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}}class Ia extends oc{constructor(a){super(a),this.current=0}set(a,c,f){this.fetchUniformLocation(a,c)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class su extends oc{constructor(a){super(a),this.current=[0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1])))}}class Cp extends oc{constructor(a){super(a),this.current=[0,0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2])))}}class Jg extends oc{constructor(a){super(a),this.current=[0,0,0,0]}set(a,c,f){this.fetchUniformLocation(a,c)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class a1 extends oc{constructor(a){super(a),this.current=ri.transparent.toPremultipliedRenderColor(null)}set(a,c,f){this.fetchUniformLocation(a,c)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const QA=new Float32Array(16);class Qg extends oc{constructor(a){super(a),this.current=QA}set(a,c,f){if(this.fetchUniformLocation(a,c)){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let p=1;p<16;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}}}const yj=new Float32Array(9),e2=new Float32Array(4);class o1 extends oc{constructor(a){super(a),this.current=e2}set(a,c,f){if(this.fetchUniformLocation(a,c)){for(let p=0;p<4;p++)if(f[p]!==this.current[p]){this.current=f,this.gl.uniformMatrix2fv(this.location,!1,f);break}}}}function s1(u){return[JA(255*u.r,255*u.g),JA(255*u.b,255*u.a)]}function L_(u,a,c,f,p,_,b,T){return!!u&&(u.kind==="composite"||u.kind==="source"?u.evaluate(new ki(0,{brightness:_,worldview:T}),a,c,p,f,b)==="none":u.value==="none")}class F_{constructor(a,c,f,p){this.value=a,this.uniformNames=c.map(_=>`u_${_}`),this.type=f,this.context=p}setUniform(a,c,f,p,_){const b=p.constantOr(this.value);c.set(a,_,b instanceof ri?b.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):b)}getBinding(a,c){return this.type==="color"?new a1(a):new Ia(a)}}class ey{constructor(a,c){this.uniformNames=c.map(f=>`u_${f}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(a,c){this.pixelRatio=a.pixelRatio||1,this.pattern=a.tl.concat(a.br),this.patternTransition=c?c.tl.concat(c.br):this.pattern}setUniform(a,c,f,p,_){let b=null;_!=="u_pattern"&&_!=="u_dash"||(b=this.pattern),_==="u_pattern_b"&&(b=this.patternTransition),_==="u_pixel_ratio"&&(b=this.pixelRatio),b&&c.set(a,_,b)}getBinding(a,c){return c==="u_pattern"||c==="u_pattern_b"||c==="u_dash"?new Jg(a):new Ia(a)}}class Zu{constructor(a,c,f,p){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(_=>({name:`a_${_}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(a,c,f,p,_,b,T,I){const M=this.paintVertexArray.length,$=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new ki(0,{brightness:b,worldview:I}),c,{},_,p,T):this.expression.kind==="constant"&&this.expression.value,V=L_(this.lutExpression,c,{},p,_,b,T,I);this.paintVertexArray.resize(a),this._setPaintValue(M,a,$,V?null:this.context.lut)}updatePaintArray(a,c,f,p,_,b,T,I){const M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:T,worldview:I},f,p,void 0,_):this.expression.kind==="constant"&&this.expression.value,$=L_(this.lutExpression,f,p,_,void 0,T,void 0,I);this._setPaintValue(a,c,M,$?null:this.context.lut)}_setPaintValue(a,c,f,p){if(this.type==="color"){const _=s1(f.toPremultipliedRenderColor(p));for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,_[0],_[1])}else{for(let _=a;_<c;_++)this.paintVertexArray.emplace(_,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oc{constructor(a,c,f,p,_,b){this.expression=a,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=p,this.context=_,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,c,f,p,_,b,T,I){const M=this.expression.evaluate(new ki(this.context.zoom,{brightness:b,worldview:I}),c,{},_,p,T),$=this.expression.evaluate(new ki(this.context.zoom+1,{brightness:b,worldview:I}),c,{},_,p,T),V=L_(this.lutExpression,c,{},p,_,b,T,I),q=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(q,a,M,$,V?null:this.context.lut)}updatePaintArray(a,c,f,p,_,b,T,I){const M=this.expression.evaluate({zoom:this.context.zoom,brightness:T,worldview:I},f,p,void 0,_),$=this.expression.evaluate({zoom:this.context.zoom+1,brightness:T,worldview:I},f,p,void 0,_),V=L_(this.lutExpression,f,p,_,void 0,T,void 0,I);this._setPaintValue(a,c,M,$,V?null:this.context.lut)}_setPaintValue(a,c,f,p,_){if(this.type==="color"){const b=s1(f.toPremultipliedRenderColor(_)),T=s1(f.toPremultipliedRenderColor(_));for(let I=a;I<c;I++)this.paintVertexArray.emplace(I,b[0],b[1],T[0],T[1])}else{for(let b=a;b<c;b++)this.paintVertexArray.emplace(b,f,p);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(p))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,c,f,p,_){const b=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,T=ve(this.expression.interpolationFactor(b,this.context.zoom,this.context.zoom+1),0,1);c.set(a,_,T)}getBinding(a,c){return new Ia(a)}}class Vo{constructor(a,c,f,p,_){this.expression=a,this.layerId=_,this.paintVertexAttributes=(f==="array"?gj:pj).members;for(let b=0;b<c.length;++b);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Jh}populatePaintArray(a,c,f,p){const _=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValues(_,a,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(a,c,f,p,_,b,T){this._setPaintValues(a,c,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(a,c,f,p){if(!p||!f)return;const _=p[f[0]],b=p[f[1]];if(_){if(_){const{tl:T,br:I,pixelRatio:M}=_;for(let $=a;$<c;$++)this.paintVertexArray.emplace($,T[0],T[1],I[0],I[1],M)}if(b){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:T,br:I}=b;for(let M=a;M<c;M++)this.paintTransitionVertexArray.emplace(M,T[0],T[1],I[0],I[1])}}}upload(a){const c=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,c)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=a.createVertexBuffer(this.paintTransitionVertexArray,mj.members,c))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Xu{constructor(a,c,f=()=>!0){this.binders={},this._buffers=[],this.context=c;const p=[];for(const _ in a.paint._values){const b=a.paint.get(_);if(_.endsWith("-use-theme")||!f(_)||!(b instanceof ic&&d_(b.property.specification)))continue;const T=_j(_,a.type),I=b.value,M=b.property.specification.type,$=!!b.property.useIntegerZoom,V=_==="line-dasharray"||_.endsWith("pattern"),q=a.paint.get(`${_}-use-theme`),Y=_==="line-dasharray"&&a.layout.get("line-cap").value.kind!=="constant"||q&&q.value.kind!=="constant";if(I.kind!=="constant"||Y)if(I.kind==="source"||Y||V){const J=l1(_,M,"source");this.binders[_]=V?new Vo(I,T,M,J,a.id):new Zu(I,T,M,J),p.push(`/a_${_}`)}else{const J=l1(_,M,"composite");this.binders[_]=new Oc(I,T,M,$,c,J),p.push(`/z_${_}`)}else this.binders[_]=V?new ey(I.value,T):new F_(I.value,T,M,c),p.push(`/u_${_}`);q&&(this.binders[_].lutExpression=q.value)}this.cacheKey=p.sort().join("")}getMaxValue(a){const c=this.binders[a];return c instanceof Zu||c instanceof Oc?c.maxValue:0}populatePaintArrays(a,c,f,p,_,b,T,I){for(const M in this.binders){const $=this.binders[M];$.context=this.context,($ instanceof Zu||$ instanceof Oc||$ instanceof Vo)&&$.populatePaintArray(a,c,f,p,_,b,T,I)}}setConstantPatternPositions(a,c){for(const f in this.binders){const p=this.binders[f];p instanceof ey&&p.setConstantPatternPositions(a,c)}}getPatternTransitionVertexBuffer(a){const c=this.binders[a];return c instanceof Vo?c.paintTransitionVertexBuffer:null}updatePaintArrays(a,c,f,p,_,b,T,I,M,$){let V=!1;const q=Object.keys(a),Y=q.length!==0&&!I,J=Y?q:c.uniqueIds;this.context.lut=_.lut;for(const ae in this.binders){const ce=this.binders[ae];if(ce.context=this.context,(ce instanceof Zu||ce instanceof Oc||ce instanceof Vo)&&ce.expression&&ce.expression.kind&&ce.expression.kind!=="constant"&&(ce.expression.isStateDependent===!0||ce.expression.isLightConstant===!1)){const de=_.paint.get(ae);ce.expression=de.value;for(const we of J){const Te=a[we.toString()];c.eachPosition(we,(Oe,Ue,De)=>{const Ge=p.feature(Oe);ce.updatePaintArray(Ue,De,Ge,Te,b,T,M,$)})}if(!Y)for(const we of f.uniqueIds){const Te=a[we.toString()];f.eachPosition(we,(Oe,Ue,De)=>{const Ge=p.feature(Oe);ce.updatePaintArray(Ue,De,Ge,Te,b,T,M,$)})}V=!0}}return V}defines(){const a=[];for(const c in this.binders){const f=this.binders[c];(f instanceof F_||f instanceof ey)&&a.push(...f.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a){const c=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof F_||p instanceof ey||p instanceof Oc)for(const _ of p.uniformNames)c.push({name:_,property:f,binding:p.getBinding(a,_)})}return c}setUniforms(a,c,f,p,_){for(const{name:b,property:T,binding:I}of f)this.binders[T].setUniform(a,I,_,p.get(T),b)}updatePaintBuffers(){this._buffers=[];for(const a in this.binders){const c=this.binders[a];(c instanceof Zu||c instanceof Oc||c instanceof Vo)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer),c instanceof Vo&&c.paintTransitionVertexBuffer&&this._buffers.push(c.paintTransitionVertexBuffer)}}upload(a){for(const c in this.binders){const f=this.binders[c];(f instanceof Zu||f instanceof Oc||f instanceof Vo)&&f.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const c=this.binders[a];(c instanceof Zu||c instanceof Oc||c instanceof Vo)&&c.destroy()}}}class Ic{constructor(a,c,f=()=>!0){this.programConfigurations={};for(const p of a)this.programConfigurations[p.id]=new Xu(p,c,f);this.needsUpload=!1,this._featureMap=new Xg,this._featureMapWithoutIds=new Xg,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(a,c,f,p,_,b,T,I,M){for(const $ in this.programConfigurations)this.programConfigurations[$].populatePaintArrays(a,c,p,_,b,T,I,M);c.id!==void 0?this._featureMap.add(c.id,f,this._bufferOffset,a):(this._featureMapWithoutIds.add(this._idlessCounter,f,this._bufferOffset,a),this._idlessCounter+=1),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,c,f,p,_,b,T,I){for(const M of f)this.needsUpload=this.programConfigurations[M.id].updatePaintArrays(a,this._featureMap,this._featureMapWithoutIds,c,M,p,_,b,T||0,I)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}const vj={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function _j(u,a){return vj[u]||[u.replace(`${a}-`,"").replace(/-/g,"_")]}const xj={"line-pattern":{source:Hd,composite:Hd},"fill-pattern":{source:Hd,composite:Hd},"fill-extrusion-pattern":{source:Hd,composite:Hd},"line-dasharray":{source:Jh,composite:Jh}},bj={color:{source:Zd,composite:Kd},number:{source:Ku,composite:Zd}};function l1(u,a,c){const f=xj[u];return f&&f[c]||bj[a][c]}gr(F_,"ConstantBinder"),gr(ey,"PatternConstantBinder"),gr(Zu,"SourceExpressionBinder"),gr(Vo,"PatternCompositeBinder"),gr(Oc,"CompositeExpressionBinder"),gr(Xu,"ProgramConfiguration",{omit:["_buffers"]}),gr(Ic,"ProgramConfigurationSet");const Ls=Yt/Math.PI/2,y=5,s=6,h=16383,v=64,w=[v,32,16],P=-Ls,O=Ls;function D(u,a,c,f=Ls){return c=xn(c),[u*Math.sin(c)*f,-a*f,u*Math.cos(c)*f]}function z(u,a,c){return D(Math.cos(xn(u)),Math.sin(xn(u)),a,c)}const W=63710088e-1,H=2*Math.PI*W;class Q{constructor(a,c){if(isNaN(a)||isNaN(c))throw new Error(`Invalid LngLat object: (${a}, ${c})`);if(this.lng=+a,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const c=Math.PI/180,f=this.lat*c,p=a.lat*c,_=Math.sin(f)*Math.sin(p)+Math.cos(f)*Math.cos(p)*Math.cos((a.lng-this.lng)*c);return W*Math.acos(Math.min(_,1))}toBounds(a=0){const c=360*a/40075017,f=c/Math.cos(Math.PI/180*this.lat);return new K({lng:this.lng-f,lat:this.lat-c},{lng:this.lng+f,lat:this.lat+c})}toEcef(a){return z(this.lat,this.lng,Ls+a*Ls/W)}static convert(a){if(a instanceof Q)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Q(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Q(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class K{constructor(a,c){a&&(c?this.setSouthWest(a).setNorthEast(c):Array.isArray(a)&&a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1]))}setNorthEast(a){return this._ne=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}setSouthWest(a){return this._sw=a instanceof Q?new Q(a.lng,a.lat):Q.convert(a),this}extend(a){const c=this._sw,f=this._ne;let p,_;if(a instanceof Q)p=a,_=a;else{if(!(a instanceof K))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(K.convert(a)):this.extend(Q.convert(a)):typeof a=="object"&&a!==null&&a.hasOwnProperty("lat")&&(a.hasOwnProperty("lon")||a.hasOwnProperty("lng"))?this.extend(Q.convert(a)):this;if(p=a._sw,_=a._ne,!p||!_)return this}return c||f?(c.lng=Math.min(p.lng,c.lng),c.lat=Math.min(p.lat,c.lat),f.lng=Math.max(_.lng,f.lng),f.lat=Math.max(_.lat,f.lat)):(this._sw=new Q(p.lng,p.lat),this._ne=new Q(_.lng,_.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:c,lat:f}=Q.convert(a);let p=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&p}static convert(a){if(a)return a instanceof K?a:new K(a)}}const re=0,le=25.5;function ue(u){return H*Math.cos(u*Math.PI/180)}function xe(u){return(180+u)/360}function me(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Ee(u,a){return u/ue(a)}function Ie(u){return 360*u-180}function Ae(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function Be(u,a){return u*ue(Ae(a))}const Re=85.051129;function Ve(u){return Math.cos(xn(ve(u,-Re,Re)))}function Fe(u,a){const c=ve(a,re,le),f=Math.pow(2,c);return Ve(u)*H/(512*f)}function Me(u){return 1/Math.cos(u*Math.PI/180)}function qe(u,a=0){const c=Math.exp(Math.PI*(1-(u.y+a/Yt)/(1<<u.z)*2));return 80150034*c/(c*c+1)/Yt/(1<<u.z)}class ot{constructor(a,c,f=0){this.x=+a,this.y=+c,this.z=+f}static fromLngLat(a,c=0){const f=Q.convert(a);return new ot(xe(f.lng),me(f.lat),Ee(c,f.lat))}toLngLat(){return new Q(Ie(this.x),Ae(this.y))}toAltitude(){return Be(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/H*Me(Ae(this.y))}}function rt(u,a,c,f,p,_,b,T,I){const M=(a+f)/2,$=(c+p)/2,V=new Nt(M,$);T(V),function(q,Y,J,ae,ce,de){const we=J-ce,Te=ae-de;return Math.abs((ae-Y)*we-(J-q)*Te)/Math.hypot(we,Te)}(V.x,V.y,_.x,_.y,b.x,b.y)>=I?(rt(u,a,c,M,$,_,V,T,I),rt(u,M,$,f,p,V,b,T,I)):u.push(b)}function wt(u,a,c){let f=u[0],p=f.x,_=f.y;a(f);const b=[f];for(let T=1;T<u.length;T++){const I=u[T],{x:M,y:$}=I;a(I),rt(b,p,_,M,$,f,I,a,c),p=M,_=$,f=I}return b}function pt(u,a,c,f){if(f(a,c)){const p=a.add(c)._mult(.5);pt(u,a,p,f),pt(u,p,c,f)}else u.push(c)}function Ot(u,a){let c=u[0];const f=[c];for(let p=1;p<u.length;p++){const _=u[p];pt(f,c,_,a),c=_}return f}const Kt=Math.pow(2,14)-1,ht=-Kt-1;function et(u,a){const c=Math.round(u.x*a),f=Math.round(u.y*a);return u.x=ve(c,ht,Kt),u.y=ve(f,ht,Kt),(c<u.x||c>u.x+1||f<u.y||f>u.y+1)&&kr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function It(u,a,c){const f=u.loadGeometry(),p=u.extent,_=Yt/p;if(a&&c&&c.projection.isReprojectedInTileSpace){const b=1<<a.z,{scale:T,x:I,y:M,projection:$}=c,V=q=>{const Y=Ie((a.x+q.x/p)/b),J=Ae((a.y+q.y/p)/b),ae=$.project(Y,J);q.x=(ae.x*T-I)*p,q.y=(ae.y*T-M)*p};for(let q=0;q<f.length;q++)if(u.type!==1)f[q]=wt(f[q],V,1);else{const Y=[];for(const J of f[q])J.x<0||J.x>=p||J.y<0||J.y>=p||(V(J),Y.push(J));f[q]=Y}}for(const b of f)for(const T of b)et(T,_);return f}function mt(u,a){return{type:u.type,id:u.id,properties:u.properties,geometry:a?It(u):[]}}class Lt{constructor(a,c,f,p,_){this.properties={},this.extent=f,this.type=0,this.id=void 0,this._pbf=a,this._geometry=-1,this._keys=p,this._values=_,a.readFields(Jt,this,c)}loadGeometry(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos,f=[];let p,_=1,b=0,T=0,I=0;for(;a.pos<c;){if(b<=0){const M=a.readVarint();_=7&M,b=M>>3}if(b--,_===1||_===2)T+=a.readSVarint(),I+=a.readSVarint(),_===1&&(p&&f.push(p),p=[]),p&&p.push(new Nt(T,I));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&f.push(p),f}bbox(){const a=this._pbf;a.pos=this._geometry;const c=a.readVarint()+a.pos;let f=1,p=0,_=0,b=0,T=1/0,I=-1/0,M=1/0,$=-1/0;for(;a.pos<c;){if(p<=0){const V=a.readVarint();f=7&V,p=V>>3}if(p--,f===1||f===2)_+=a.readSVarint(),b+=a.readSVarint(),_<T&&(T=_),_>I&&(I=_),b<M&&(M=b),b>$&&($=b);else if(f!==7)throw new Error(`unknown command ${f}`)}return[T,M,I,$]}toGeoJSON(a,c,f){const p=this.extent*Math.pow(2,f),_=this.extent*a,b=this.extent*c,T=this.loadGeometry();function I(q){return[360*(q.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+b)/p)*Math.PI))-90]}function M(q){return q.map(I)}let $;if(this.type===1){const q=[];for(const J of T)q.push(J[0]);const Y=M(q);$=q.length===1?{type:"Point",coordinates:Y[0]}:{type:"MultiPoint",coordinates:Y}}else if(this.type===2){const q=T.map(M);$=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=function(J){const ae=J.length;if(ae<=1)return[J];const ce=[];let de,we;for(let Te=0;Te<ae;Te++){const Oe=yr(J[Te]);Oe!==0&&(we===void 0&&(we=Oe<0),we===Oe<0?(de&&ce.push(de),de=[J[Te]]):de&&de.push(J[Te]))}return de&&ce.push(de),ce}(T),Y=[];for(const J of q)Y.push(J.map(M));$=Y.length===1?{type:"Polygon",coordinates:Y[0]}:{type:"MultiPolygon",coordinates:Y}}}const V={type:"Feature",geometry:$,properties:this.properties};return this.id!=null&&(V.id=this.id),V}}function Jt(u,a,c){u===1?a.id=c.readVarint():u===2?function(f,p){const _=f.readVarint()+f.pos;for(;f.pos<_;){const b=p._keys[f.readVarint()],T=p._values[f.readVarint()];p.properties[b]=T}}(c,a):u===3?a.type=c.readVarint():u===4&&(a._geometry=c.pos)}function yr(u){let a=0;for(let c,f,p=0,_=u.length,b=_-1;p<_;b=p++)c=u[p],f=u[b],a+=(f.x-c.x)*(c.y+f.y);return a}Lt.types=["Unknown","Point","LineString","Polygon"];class Wt{constructor(a,c){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Xt,this,c),this.length=this._features.length}feature(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];const c=this._pbf.readVarint()+this._pbf.pos;return new Lt(this._pbf,c,this.extent,this._keys,this._values)}}function Xt(u,a,c){u===15?a.version=c.readVarint():u===1?a.name=c.readString():u===5?a.extent=c.readVarint():u===2?a._features.push(c.pos):u===3?a._keys.push(c.readString()):u===4&&a._values.push(function(f){let p=null;const _=f.readVarint()+f.pos;for(;f.pos<_;){const b=f.readVarint()>>3;p=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(c))}class br{constructor(a,c){this.layers=a.readFields(hr,{},c)}}function hr(u,a,c){if(u===3){const f=new Wt(c,c.readVarint()+c.pos);f.length&&(a[f.name]=f)}}const cr="3d_elevation_id",fr="level";class Nr{constructor(){this._valid=!1}reset(a){return this.feature=a,this._valid=!0,this._geometry=a.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(a,c){return this._valid&&a(c(this._geometry)),this}require(a,c,f){return this.get(a,!0,c,f)}optional(a,c,f){return this.get(a,!1,c,f)}success(){return this._valid}get(a,c,f,p){const _=this.feature.properties.hasOwnProperty(a)?+this.feature.properties[a]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?f(p?p(_):_):c&&(this._valid=!1),this}}class Tn{constructor(a,c){this.featureFunc=a,this.vertexFunc=c}parseFeature(a,c,f){return this.featureFunc(a,c,f)}parseVertex(a,c,f){return this.vertexFunc(a,c,f)}}const Nn=new Tn((u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).optional("fixed_height_relative",f=>{c.constantHeight=f},Wr.decodeRelativeHeight).geometry(f=>{c.bounds=f},Rg).success(),(u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height_relative",f=>{c.height=f},Wr.decodeRelativeHeight).geometry(f=>{c.position=f},Wr.getPoint).success()),pi=new Tn((u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).optional("fixed_height",f=>{c.constantHeight=f},Wr.decodeMetricHeight).geometry(f=>{c.bounds=f},Rg).success(),(u,a,c)=>u.reset(a).require(cr,f=>{c.id=f}).require("elevation_idx",f=>{c.idx=f}).require("extent",f=>{c.extent=f}).require("height",f=>{c.height=f},Wr.decodeMetricHeight).geometry(f=>{c.position=f},Wr.getPoint).success());class Wr{static getPoint(a){return _s(a[0][0].x,a[0][0].y)}static decodeRelativeHeight(a){return 1e-4*a*5}static decodeMetricHeight(a){return 1e-4*a}static getVersionSchema(a){return a?a==="1.0.1"?pi:void 0:Nn}static parse(a){const c=[],f=[],p=a.length,_=new Nr;for(let b=0;b<p;b++){const T=a.feature(b),I=T.properties.version,M=Wr.getVersionSchema(I);if(M===void 0){kr(`Unknown elevation feature version number ${I||"(unknown)"}`);continue}const $=T.properties.type;if(!$)continue;const V=Lt.types[T.type];if(V==="Point"&&$==="curve_point"){const q={};M.parseVertex(_,T,q)&&c.push(q)}else if(V==="Polygon"&&$==="curve_meta"){const q={};M.parseFeature(_,T,q)&&f.push(q)}}return{vertices:c,features:f}}}class jn{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,f){const p=ml(c,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1])/p;return f[0]=this.pos[0]+this.dir[0]*_,f[1]=this.pos[1]+this.dir[1]*_,!0}}class on{constructor(a,c){this.pos=a,this.dir=c}intersectsPlane(a,c,f){const p=ut(c,this.dir);if(Math.abs(p)<1e-6)return!1;const _=((a[0]-this.pos[0])*c[0]+(a[1]-this.pos[1])*c[1]+(a[2]-this.pos[2])*c[2])/p;return f[0]=this.pos[0]+this.dir[0]*_,f[1]=this.pos[1]+this.dir[1]*_,f[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(a,c,f){if(function(Y,J){var ae=Y[0],ce=Y[1],de=Y[2],we=J[0],Te=J[1],Oe=J[2];return Math.abs(ae-we)<=g*Math.max(1,Math.abs(ae),Math.abs(we))&&Math.abs(ce-Te)<=g*Math.max(1,Math.abs(ce),Math.abs(Te))&&Math.abs(de-Oe)<=g*Math.max(1,Math.abs(de),Math.abs(Oe))}(this.pos,a)||c===0)return f[0]=f[1]=f[2]=0,!1;const[p,_,b]=this.dir,T=this.pos[0]-a[0],I=this.pos[1]-a[1],M=this.pos[2]-a[2],$=p*p+_*_+b*b,V=2*(T*p+I*_+M*b),q=V*V-4*$*(T*T+I*I+M*M-c*c);if(q<0){const Y=Math.max(-V/2,0),J=T+p*Y,ae=I+_*Y,ce=M+b*Y,de=Math.hypot(J,ae,ce);return f[0]=J*c/de,f[1]=ae*c/de,f[2]=ce*c/de,!1}{const Y=(-V-Math.sqrt(q))/(2*$);if(Y<0){const J=Math.hypot(T,I,M);return f[0]=T*c/J,f[1]=I*c/J,f[2]=M*c/J,!1}return f[0]=T+p*Y,f[1]=I+_*Y,f[2]=M+b*Y,!0}}}class oi{constructor(a,c,f,p,_){this.TL=a,this.TR=c,this.BR=f,this.BL=p,this.horizon=_}static fromInvProjectionMatrix(a,c,f){const p=[-1,1,1],_=[1,1,1],b=[1,-1,1],T=[-1,-1,1],I=nr(p,p,a),M=nr(_,_,a),$=nr(b,b,a),V=nr(T,T,a);return new oi(I,M,$,V,c/f)}}function Mn(u,a,c){let f=1/0,p=-1/0;const _=[];for(const b of u){_t(_,b,a);const T=ut(_,c);f=Math.min(f,T),p=Math.max(p,T)}return[f,p]}function Ti(u,a){let c=!0;for(let f=0;f<u.planes.length;f++){const p=u.planes[f];let _=0;for(let b=0;b<a.length;b++)_+=+(ut(p,a[b])+p[3]>=0);if(_===0)return 0;_!==a.length&&(c=!1)}return c?2:1}function Un(u,a){for(const c of u.projections){const f=Mn(a,u.points[0],c.axis);if(c.projection[1]<f[0]||c.projection[0]>f[1])return 0}return 1}function ln(u,a){let c=0;const f=[0,0,0,0];for(let b=0;b<u.length;b++)f[0]=u[b][0],f[1]=u[b][1],f[2]=u[b][2],f[3]=1,(p=f)[0]*(_=a)[0]+p[1]*_[1]+p[2]*_[2]+p[3]*_[3]>=0&&c++;var p,_;return c}class Xn{constructor(a,c){this.points=a||new Array(8).fill([0,0,0]),this.planes=c||new Array(6).fill([0,0,0,0]),this.bounds=mn.fromPoints(this.points),this.projections=[],this.frustumEdges=[_t([],this.points[2],this.points[3]),_t([],this.points[0],this.points[3]),_t([],this.points[4],this.points[0]),_t([],this.points[5],this.points[1]),_t([],this.points[6],this.points[2]),_t([],this.points[7],this.points[3])];for(const f of this.frustumEdges){const p=[0,-f[2],f[1]],_=[f[2],0,-f[0]];this.projections.push({axis:p,projection:Mn(this.points,this.points[0],p)}),this.projections.push({axis:_,projection:Mn(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(a,c,f,p){const _=Math.pow(2,f),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const $=Qt([],M,a),V=1/$[3]/c*_;return(q=$)[0]=(Y=$)[0]*(J=[V,V,p?1/$[3]:V,V])[0],q[1]=Y[1]*J[1],q[2]=Y[2]*J[2],q[3]=Y[3]*J[3],q;var q,Y,J}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const $=ze([],At([],_t([],b[M[0]],b[M[1]]),_t([],b[M[2]],b[M[1]]))),V=-ut($,b[M[1]]);return $.concat(V)}),I=[];for(let M=0;M<b.length;M++)I.push([b[M][0],b[M][1],b[M][2]]);return new Xn(I,T)}intersectsPrecise(a,c,f){for(let p=0;p<c.length;p++)if(!ln(a,c[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!ln(a,this.planes[p]))return 0;for(const p of f)for(const _ of this.frustumEdges){const b=At([],p,_),T=Se(b);if(T===0)continue;ke(b,b,1/T);const I=Mn(this.points,this.points[0],b),M=Mn(a,this.points[0],b);if(I[0]>M[1]||M[0]>I[1])return 0}return 1}containsPoint(a){for(const c of this.planes){const f=c[3];if(ut([c[0],c[1],c[2]],a)+f<0)return!1}return!0}}class mn{static fromPoints(a){const c=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const p of a)ye(c,c,p),ge(f,f,p);return new mn(c,f)}static fromTileIdAndHeight(a,c,f){const p=1<<a.canonical.z,_=a.canonical.x,b=a.canonical.y;return new mn([_/p,b/p,c],[(_+1)/p,(b+1)/p,f])}static applyTransform(a,c){const f=a.getCorners();for(let p=0;p<f.length;++p)nr(f[p],f[p],c);return mn.fromPoints(f)}static applyTransformFast(a,c){const f=[c[12],c[13],c[14]],p=[...f];for(let _=0;_<3;_++)for(let b=0;b<3;b++){const T=c[4*b+_],I=T*a.min[b],M=T*a.max[b];f[_]+=Math.min(I,M),p[_]+=Math.max(I,M)}return new mn(f,p)}static projectAabbCorners(a,c){const f=a.getCorners();for(let p=0;p<f.length;++p)nr(f[p],f[p],c);return f}constructor(a,c){this.min=a,this.max=c,this.center=ke([],_e([],this.min,this.max),.5)}quadrant(a){const c=[a%2==0,a<2],f=he(this.min),p=he(this.max);for(let _=0;_<c.length;_++)f[_]=c[_]?this.min[_]:this.center[_],p[_]=c[_]?this.center[_]:this.max[_];return p[2]=this.max[2],new mn(f,p)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}distanceZ(a){return Math.max(Math.min(this.max[2],a[2]),this.min[2])-a[2]}getCorners(){const a=this.min,c=this.max;return[[a[0],a[1],a[2]],[c[0],a[1],a[2]],[c[0],c[1],a[2]],[a[0],c[1],a[2]],[a[0],a[1],c[2]],[c[0],a[1],c[2]],[c[0],c[1],c[2]],[a[0],c[1],c[2]]]}intersects(a){return this.intersectsAabb(a.bounds)?Ti(a,this.getCorners()):0}intersectsFlat(a){return this.intersectsAabb(a.bounds)?Ti(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(a,c){return c||this.intersects(a)?Un(a,this.getCorners()):0}intersectsPreciseFlat(a,c){return c||this.intersectsFlat(a)?Un(a,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(a){for(let c=0;c<3;++c)if(this.min[c]>a.max[c]||a.min[c]>this.max[c])return!1;return!0}intersectsAabbXY(a){return!(this.min[0]>a.max[0]||a.min[0]>this.max[0]||this.min[1]>a.max[1]||a.min[1]>this.max[1])}encapsulate(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a.min[c]),this.max[c]=Math.max(this.max[c],a.max[c])}encapsulatePoint(a){for(let c=0;c<3;c++)this.min[c]=Math.min(this.min[c],a[c]),this.max[c]=Math.max(this.max[c],a[c])}closestPoint(a){return[Math.max(Math.min(this.max[0],a[0]),this.min[0]),Math.max(Math.min(this.max[1],a[1]),this.min[1]),Math.max(Math.min(this.max[2],a[2]),this.min[2])]}}gr(mn,"Aabb");class Ni{constructor(a,c){this.feature=a,this.metersToTile=c,this.index=0}get(){const a=this.feature.vertices[this.index],c=this.feature.vertexProps[this.index].dir,f=c[1],p=-c[0],_=(a.extent+1)*this.metersToTile;return[new Nt(Math.trunc(a.position[0]+f*_),Math.trunc(a.position[1]+p*_)),new Nt(Math.trunc(a.position[0]-f*_),Math.trunc(a.position[1]-p*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ti{constructor(a,c,f,p,_,b){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[wi(),wi(),wi(),wi(),wi(),wi(),wi()],this.id=a,this.heightRange={min:f,max:f},this.safeArea=c,this.constantHeight=f,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=_,this.edges=this.edges.filter(T=>{return T.a<this.vertices.length&&T.b<this.vertices.length&&!((I=this.vertices[T.a].position)[0]===(M=this.vertices[T.b].position)[0]&&I[1]===M[1]);var I,M}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const T of this.vertices)this.vertexProps.push({dir:_s(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,T.height),this.heightRange.max=Math.max(this.heightRange.max,T.height);for(const T of this.edges){const I=this.vertices[T.a].position,M=this.vertices[T.b].position,$=Bo(wi(),M,I),V=ji($),q=ts(wi(),$,1/V);this.edgeProps.push({vec:$,dir:q,len:V});const Y=this.vertexProps[T.a].dir,J=this.vertexProps[T.b].dir;js(Y,Y,q),js(J,J,q)}for(const T of this.vertexProps)T.dir[0]===0&&T.dir[1]===0||oo(T.dir,T.dir);this.tessellate(b)}}pointElevation(a){if(this.constantHeight!=null)return this.constantHeight;const c=this.getClosestEdge(a);if(c==null)return 0;const[f,p]=c;return $r(this.vertices[this.edges[f].a].height,this.vertices[this.edges[f].b].height,p)}computeSlopeNormal(a,c){const f=this.getClosestEdge(a);if(!f)return Ce(0,0,1);const p=f[0],_=this.edges[p],b=this.edgeProps[p].vec,T=Ce(b[0],b[1],(this.vertices[_.b].height-this.vertices[_.a].height)*c),I=Ce(T[1],-T[0],0);At(I,I,T);const M=Se(I);return M>0?ke(I,I,1/M):fe(I,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(a){if(this.edges.length===0)return;let c=0,f=Number.POSITIVE_INFINITY,p=0;const[_,b,T,I,M,$,V]=this._tmpVec2;zo(V,a.x,a.y);const q=new jn(V,null);for(let Y=0;Y<this.edges.length;Y++){const J=this.edges[Y],ae=this.edgeProps[Y].dir;q.dir=ae;const ce=this.vertices[J.a].position,de=this.vertices[J.b].position,we=q.intersectsPlane(ce,this.vertexProps[J.a].dir,_),Te=q.intersectsPlane(de,this.vertexProps[J.b].dir,b);if(!we||!Te)continue;Bo(T,b,_),Bo(I,V,_);const Oe=ml(T,T),Ue=Oe>0?ml(I,T)/Oe:0,De=ve(Ue,0,1),Ge=Math.abs((Ue-De)*this.edgeProps[Y].len);Bo(M,V,ce),zo($,ae[1],-ae[0]);const Je=Ge+Math.abs(ml(M,$));Je<f&&(c=Y,f=Je,p=De)}return[c,p]}tessellate(a){const c=ie(),f=ie(),p=ie(),_=ie();for(let b=this.edges.length-1;b>=0;--b){const T=this.edges[b].a,I=this.edges[b].b,{position:M,height:$,extent:V}=this.vertices[T],{position:q,height:Y,extent:J}=this.vertices[I],ae=this.vertexProps[T].dir,ce=this.vertexProps[I].dir;if(fe(c,M[0]/a,M[1]/a,$),fe(f,q[0]/a,q[1]/a,Y),fe(p,ae[1],-ae[0],0),ke(p,p,V),fe(_,ce[1],-ce[0],0),ke(_,_,J),this.distSqLines(Ce(c[0]+.5*p[0],c[1]+.5*p[1],c[2]+.5*p[2]),Ce(f[0]-.5*_[0],f[1]-.5*_[1],f[2]-.5*_[2]),Ce(c[0]-.5*p[0],c[1]-.5*p[1],c[2]-.5*p[2]),Ce(f[0]+.5*_[0],f[1]+.5*_[1],f[2]+.5*_[2]))<=.0025000000000000005)continue;const de=this.vertices.length,we=js(wi(),M,q);this.vertices.push({position:ts(we,we,.5),height:.5*($+Y),extent:.5*(V+J)});const Te=js(wi(),ae,ce);this.vertexProps.push({dir:oo(Te,Te)}),this.edges.splice(b,1),this.edgeProps.splice(b,1),this.edges.push({a:T,b:de}),this.edges.push({a:de,b:I});const Oe=Bo(wi(),this.vertices[de].position,M),Ue=ji(Oe),De={vec:Oe,dir:ts(wi(),Oe,1/Ue),len:Ue};this.edgeProps.push(De),this.edgeProps.push(De)}}distSqLines(a,c,f,p){const _=be(ie(),c,a),b=be(ie(),p,f),T=be(ie(),a,f),I=ut(_,_),M=ut(_,b),$=ut(_,T),V=ut(b,b),q=ut(b,T),Y=I*V-M*M;if(Y===0)return $e(xt(_,f,p,ut(T,b)/ut(b,b)),a);const J=(I*q-M*$)/Y;return $e(xt(_,a,c,(M*q-$*V)/Y),xt(b,f,p,J))}}class Hr{static parseFrom(a,c){const f=Wr.parse(a);if(!f)return[];let{vertices:p,features:_}=f;const b=1/qe(c);_.sort(($,V)=>$.id-V.id),p.sort(($,V)=>$.id-V.id||$.idx-V.idx),p=p.filter(($,V,q)=>V===q.findIndex(Y=>Y.id===$.id&&Y.idx===$.idx));const T=new Array;let I=0;const M=p.length;for(const $ of _){if($.constantHeight){T.push(new ti($.id,$.bounds,$.constantHeight));continue}for(;I!==M&&p[I].id<$.id;)I++;if(I===M||p[I].id!==$.id)continue;const V=new Array,q=new Array,Y=I;for(;I!==M&&p[I].id===$.id;){const J=p[I];if(V.push({position:J.position,height:J.height,extent:J.extent}),I!==Y&&p[I-1].idx===J.idx-1){const ae=I-Y;q.push({a:ae-1,b:ae})}I++}T.push(new ti($.id,$.bounds,void 0,V,q,b))}return T}static getElevationFeature(a,c){if(!c)return;const f=+a.properties[cr];return Number.isNaN(f)?void 0:c.find(p=>p.id===f)}}class Ln{constructor(a,c){this.zScale=1,this.xOffset=0,this.yOffset=0,a.equals(c)||(this.zScale=Math.pow(2,c.z-a.z),this.xOffset=(a.x*this.zScale-c.x)*Yt,this.yOffset=(a.y*this.zScale-c.y)*Yt)}constantElevation(a,c){if(a.constantHeight!=null)return this.computeBiasedHeight(a.constantHeight,c)}pointElevation(a,c,f){const p=this.constantElevation(c,f);return p??(a.x=a.x*this.zScale+this.xOffset,a.y=a.y*this.zScale+this.yOffset,this.computeBiasedHeight(c.pointElevation(a),f))}computeBiasedHeight(a,c){return c<=0?a:a+c*Ne(0,c,a>=0?a:Math.abs(.5*a))}}gr(ti,"ElevationFeature");class Xi{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.projection=a.projection,this.layoutVertexArray=new Ds,this.indexArray=new Gi,this.segments=new ea,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ku),this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){const _=this.layers[0],b=[];let T=null;_.type==="circle"&&(T=_.layout.get("circle-sort-key"));for(const{feature:M,id:$,index:V,sourceLayerIndex:q}of a){const Y=this.layers[0]._featureFilter.needGeometry,J=mt(M,Y);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),J,f))continue;const ae=T?T.evaluate(J,{},f):void 0,ce={id:$,properties:M.properties,type:M.type,sourceLayerIndex:q,index:V,geometry:Y?J.geometry:It(M,f,p),patterns:{},sortKey:ae};b.push(ce)}T&&b.sort((M,$)=>M.sortKey-$.sortKey);let I=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new P_,I=p.projection);for(const M of b){const{geometry:$,index:V,sourceLayerIndex:q}=M,Y=a[V].feature;this.addFeature(M,$,V,c.availableImages,f,I,c.brightness,c.elevationFeatures),c.featureIndex.insert(Y,$,V,q,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(a,c,f,p,_,b,T){this.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,YA.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,fj.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,hj.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(a,c,f,p,_,b,T,I){let M;this.elevationMode!=="none"&&(M=Hr.getElevationFeature(a,I));for(const $ of c)for(const V of $){const q=V.x,Y=V.y;if(q<0||q>=Yt||Y<0||Y>=Yt)continue;if(b){const ce=b.projectTilePoint(q,Y,_),de=b.upVector(_,q,Y);this.addGlobeExtVertex(ce,de),this.addGlobeExtVertex(ce,de),this.addGlobeExtVertex(ce,de),this.addGlobeExtVertex(ce,de)}const J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ae=J.vertexLength;if(this.addCircleVertex(q,Y,-1,-1),this.addCircleVertex(q,Y,1,-1),this.addCircleVertex(q,Y,1,1),this.addCircleVertex(q,Y,-1,1),this.elevationMode!=="none"){const ce=M?M.pointElevation(new Nt(q,Y)):0;this.hasElevation=this.hasElevation||ce!==0;for(let de=0;de<4;de++)this.elevatedLayoutVertexArray.emplaceBack(ce)}this.indexArray.emplaceBack(ae,ae+1,ae+2),this.indexArray.emplaceBack(ae,ae+2,ae+3),J.vertexLength+=4,J.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},p,_,T,void 0,this.worldview)}addCircleVertex(a,c,f,p){this.layoutVertexArray.emplaceBack(2*a+(f+1)/2,2*c+(p+1)/2)}addGlobeExtVertex(a,c){this.globeExtVertexArray.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}}function xa(u,a){for(let c=0;c<u.length;c++)if(po(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(po(u,a[c]))return!0;return!!Ss(u,a)}function ta(u,a,c){return!!po(u,a)||!!jo(a,u,c)}function ca(u,a){if(u.length===1)return sc(a,u[0]);for(let c=0;c<a.length;c++){const f=a[c];for(let p=0;p<f.length;p++)if(po(u,f[p]))return!0}for(let c=0;c<u.length;c++)if(sc(a,u[c]))return!0;for(let c=0;c<a.length;c++)if(Ss(u,a[c]))return!0;return!1}function Fs(u,a,c){if(u.length>1){if(Ss(u,a))return!0;for(let f=0;f<a.length;f++)if(jo(a[f],u,c))return!0}for(let f=0;f<u.length;f++)if(jo(u[f],a,c))return!0;return!1}function Ss(u,a){if(u.length===0||a.length===0)return!1;for(let c=0;c<u.length-1;c++){const f=u[c],p=u[c+1];for(let _=0;_<a.length-1;_++)if(Ro(f,p,a[_],a[_+1]))return!0}return!1}function Ro(u,a,c,f){return gn(u,c,f)!==gn(a,c,f)&&gn(u,a,c)!==gn(u,a,f)}function qo(u,a,c){return(u.x-c.x)*(a.y-c.y)-(u.y-c.y)*(a.x-c.x)}function Sl(u,a,c,f){const p=qo(u,a,f),_=qo(u,a,c);if(Math.sign(p)===Math.sign(_))return;const b=qo(c,f,u),T=b+_-p;return Math.sign(b)!==Math.sign(T)?[b/(b-T),_/(_-p)]:void 0}function jo(u,a,c){const f=c*c;if(a.length===1)return u.distSqr(a[0])<f;for(let p=1;p<a.length;p++)if(El(u,a[p-1],a[p])<f)return!0;return!1}function El(u,a,c){const f=a.distSqr(c);if(f===0)return u.distSqr(a);const p=((u.x-a.x)*(c.x-a.x)+(u.y-a.y)*(c.y-a.y))/f;return u.distSqr(p<0?a:p>1?c:c.sub(a)._mult(p)._add(a))}function sc(u,a){let c,f,p,_=!1;for(let b=0;b<u.length;b++){c=u[b];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],p=c[I],f.y>a.y!=p.y>a.y&&a.x<(p.x-f.x)*(a.y-f.y)/(p.y-f.y)+f.x&&(_=!_)}return _}function po(u,a){let c=!1;for(let f=0,p=u.length-1;f<u.length;p=f++){const _=u[f],b=u[p];_.y>a.y!=b.y>a.y&&a.x<(b.x-_.x)*(a.y-_.y)/(b.y-_.y)+_.x&&(c=!c)}return c}function ia(u,a,c,f,p){for(const b of u)if(a<=b.x&&c<=b.y&&f>=b.x&&p>=b.y)return!0;const _=[new Nt(a,c),new Nt(a,p),new Nt(f,p),new Nt(f,c)];if(u.length>2){for(const b of _)if(po(u,b))return!0}for(let b=0;b<u.length-1;b++)if(ba(u[b],u[b+1],_))return!0;return!1}function ba(u,a,c){const f=c[0],p=c[2];if(u.x<f.x&&a.x<f.x||u.x>p.x&&a.x>p.x||u.y<f.y&&a.y<f.y||u.y>p.y&&a.y>p.y)return!1;const _=gn(u,a,c[0]);return _!==gn(u,a,c[1])||_!==gn(u,a,c[2])||_!==gn(u,a,c[3])}function Si(u,a,c,f,p,_){let b=a.y-u.y,T=u.x-a.x;if(_=_||0){const I=b*b+T*T;if(I===0)return!0;const M=Math.sqrt(I);b/=M,T/=M}return!((c.x-u.x)*b+(c.y-u.y)*T-_<0||(f.x-u.x)*b+(f.y-u.y)*T-_<0||(p.x-u.x)*b+(p.y-u.y)*T-_<0)}function Ta(u,a,c,f,p,_,b){return!(Si(u,a,f,p,_,b)||Si(a,c,f,p,_,b)||Si(c,u,f,p,_,b)||Si(f,p,u,a,c,b)||Si(p,_,u,a,c,b)||Si(_,f,u,a,c,b))}function mo(u,a,c){const f=a.paint.get(u).value;return f.kind==="constant"?f.value:c.programConfigurations.get(a.id).getMaxValue(u)}function aa(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function Tl(u,a,c,f,p){if(!a[0]&&!a[1])return u;const _=Nt.convert(a)._mult(p);c==="viewport"&&_._rotate(-f);const b=[];for(let T=0;T<u.length;T++)b.push(u[T].sub(_));return b}function Op(u,a,c,f){const p=Nt.convert(u)._mult(f);return a==="viewport"&&p._rotate(-c),p}let Yu,Ip;function kp(u,a,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[u*f-2*Math.PI*6378137/2,a*f-2*Math.PI*6378137/2]}gr(Xi,"CircleBucket",{omit:["layers"]});class Al{constructor(a,c,f){this.z=a,this.x=c,this.y=f,this.key=Pl(0,a,a,c,f)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}isChildOf(a){const c=this.z-a.z;return a.z===0||a.z<this.z&&a.x===this.x>>c&&a.y===this.y>>c}url(a,c){const f=function(_,b,T){var I=kp(256*_,256*(b=Math.pow(2,T)-b-1),T),M=kp(256*(_+1),256*(b+1),T);return I[0]+","+I[1]+","+M[0]+","+M[1]}(this.x,this.y,this.z),p=function(_,b,T){let I,M="";for(let $=_;$>0;$--)I=1<<$-1,M+=(b&I?1:0)+(T&I?2:0);return M}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lu{constructor(a,c){this.wrap=a,this.canonical=c,this.key=Pl(a,c.z,c.z,c.x,c.y)}}class co{constructor(a,c,f,p,_){this.overscaledZ=a,this.wrap=c,this.canonical=new Al(f,+p,+_),this.key=c===0&&a===f?this.canonical.key:Pl(c,a,f,p,_)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){const c=this.canonical.z-a;return a>this.canonical.z?new co(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new co(a,this.wrap,a,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(a,c=!0){if(this.overscaledZ===a&&c)return this.key;if(a>this.canonical.z)return Pl(this.wrap*+c,a,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-a;return Pl(this.wrap*+c,a,a,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(a){if(a.wrap!==this.wrap)return!1;const c=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.z<this.canonical.z&&a.canonical.x===this.canonical.x>>c&&a.canonical.y===this.canonical.y>>c}children(a){if(this.overscaledZ>=a)return[new co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,p=2*this.canonical.y;return[new co(c,this.wrap,c,f,p),new co(c,this.wrap,c,f+1,p),new co(c,this.wrap,c,f,p+1),new co(c,this.wrap,c,f+1,p+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new co(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lu(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pl(u,a,c,f,p){const _=1<<Math.min(c,22);let b=_*(p%_)+f%_;return u&&c<22&&(b+=_*_*((u<0?-2*u-1:2*u)%(1<<2*(22-c)))),16*(32*b+c)+(a-c)}const ef=[u=>{let a=u.canonical.x-1,c=u.wrap;return a<0&&(a=(1<<u.canonical.z)-1,c--),new co(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>{let a=u.canonical.x+1,c=u.wrap;return a===1<<u.canonical.z&&(a=0,c++),new co(u.overscaledZ,c,u.canonical.z,a,u.canonical.y)},u=>new co(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new co(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];gr(Al,"CanonicalTileID"),gr(co,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const t2=En([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:z_}=t2,Fce=En([{name:"a_pos_3",components:3,type:"Int16"}]);var e$=En([{name:"a_pos",type:"Int16",components:2}]);function r2(u){return u*Ls/W}const zce=[new mn([P,P,P],[O,O,O]),new mn([P,P,P],[0,0,O]),new mn([0,P,P],[O,0,O]),new mn([P,0,P],[0,O,O]),new mn([0,0,P],[O,O,O])];function t$(u,a,c,f=!0){const p=ke([],u._camera.position,u.worldSize),_=[a,c,1,1];Qt(_,_,u.pixelMatrixInverse),dt(_,_,1/_[3]);const b=ze([],_t([],_,p)),T=u.globeMatrix,I=[T[12],T[13],T[14]],M=_t([],I,p),$=Se(M),V=ze([],M),q=u.worldSize/(2*Math.PI),Y=ut(V,b),J=Math.asin(q/$);if(J<Math.acos(Y)){if(!f)return null;const Et=[],ct=[];ke(Et,b,$/Y),ze(ct,_t(ct,Et,M)),ze(b,_e(b,M,ke(b,ct,Math.tan(J)*$)))}const ae=[];new on(p,b).closestPointOnSphere(I,q,ae);const ce=ze([],_a(T,0)),de=ze([],_a(T,1)),we=ze([],_a(T,2)),Te=ut(ce,ae),Oe=ut(de,ae),Ue=ut(we,ae),De=ns(Math.asin(-Oe/q));let Ge=ns(Math.atan2(Te,Ue));Ge=u.center.lng+function(Et,ct){const Tt=(ct-Et+180)%360-180;return Tt<-180?Tt+360:Tt}(u.center.lng,Ge);const Je=xe(Ge),tt=ve(me(De),0,1);return new ot(Je,tt)}class Bce{constructor(a,c,f){this.a=_t([],a,f),this.b=_t([],c,f),this.center=f;const p=ze([],this.a),_=ze([],this.b);this.angle=Math.acos(ut(p,_))}}function wj(u,a){if(u.angle===0)return null;let c;return c=u.a[a]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[a]/u.a[a]/Math.sin(u.angle)-1/Math.tan(u.angle)),c<0||c>1?null:function(f,p,_,b){const T=Math.sin(_);return f*(Math.sin((1-b)*_)/T)+p*(Math.sin(b*_)/T)}(u.a[a],u.b[a],u.angle,ve(c,0,1))+u.center[a]}function Xd(u){if(u.z<=1)return zce[u.z+2*u.y+u.x];const a=Sj(n2(u));return mn.fromPoints(a)}function tf(u,a,c){return ke(u,u,1-c),Qe(u,u,a,c)}function r$(u,a,c){for(const f of u)nr(f,f,a),ke(f,f,c)}function n$(u,a,c,f){const p=a/u.worldSize,_=u.globeMatrix;if(c.z<=1){const tt=Xd(c).getCorners();return r$(tt,_,p),mn.fromPoints(tt)}const b=n2(c,f),T=Sj(b,Ls+r2(u._tileCoverLift));r$(T,_,p);const I=Number.MAX_VALUE,M=[-I,-I,-I],$=[I,I,I];if(b.contains(u.center)){for(const ct of T)ye($,$,ct),ge(M,M,ct);M[2]=0;const tt=u.point,Et=[tt.x*p,tt.y*p,0];return ye($,$,Et),ge(M,M,Et),new mn($,M)}if(u._tileCoverLift>0){for(const tt of T)ye($,$,tt),ge(M,M,tt);return new mn($,M)}const V=[_[12]*p,_[13]*p,_[14]*p],q=b.getCenter(),Y=ve(u.center.lat,-Re,Re),J=ve(q.lat,-Re,Re),ae=xe(u.center.lng),ce=me(Y);let de=ae-xe(q.lng);const we=ce-me(J);de>.5?de-=1:de<-.5&&(de+=1);let Te=0;Math.abs(de)>Math.abs(we)?Te=de>=0?1:3:(Te=we>=0?0:2,Qe(V,V,[_[4]*p,_[5]*p,_[6]*p],-Math.sin(xn(we>=0?b.getSouth():b.getNorth()))*Ls));const Oe=T[Te],Ue=T[(Te+1)%4],De=new Bce(Oe,Ue,V),Ge=[wj(De,0)||Oe[0],wj(De,1)||Oe[1],wj(De,2)||Oe[2]],Je=Rp(u.zoom);if(Je>0){const tt=function({x:ct,y:Tt,z:kt},Dt,Zt,$t,Rt){const Bt=1/(1<<kt);let bt=ct*Bt,yt=bt+Bt,Ft=Tt*Bt,Gt=Ft+Bt,jt=0;const pr=(bt+yt)/2-$t;return pr>.5?jt=-1:pr<-.5&&(jt=1),bt=((bt+jt)*Dt-($t*=Dt))*Zt+$t,yt=((yt+jt)*Dt-$t)*Zt+$t,Ft=(Ft*Dt-(Rt*=Dt))*Zt+Rt,Gt=(Gt*Dt-Rt)*Zt+Rt,[[bt,Gt,0],[yt,Gt,0],[yt,Ft,0],[bt,Ft,0]]}(c,a,u._pixelsPerMercatorPixel,ae,ce);for(let ct=0;ct<T.length;ct++)tf(T[ct],tt[ct],Je);const Et=_e([],tt[Te],tt[(Te+1)%4]);ke(Et,Et,.5),tf(Ge,Et,Je)}for(const tt of T)ye($,$,tt),ge(M,M,tt);return $[2]=Math.min(Oe[2],Ue[2]),ye($,$,Ge),ge(M,M,Ge),new mn($,M)}function n2({x:u,y:a,z:c},f=!1){const p=1/(1<<c),_=new Q(Ie(u*p),a===(1<<c)-1&&f?-90:Ae((a+1)*p)),b=new Q(Ie((u+1)*p),a===0&&f?90:Ae(a*p));return new K(_,b)}function Sj(u,a=Ls){const c=xn(u.getNorth()),f=xn(u.getSouth()),p=Math.cos(c),_=Math.cos(f),b=Math.sin(c),T=Math.sin(f),I=u.getWest(),M=u.getEast();return[D(_,T,I,a),D(_,T,M,a),D(p,b,M,a),D(p,b,I,a)]}function c1(u,a,c,f){const p=1<<c.z,_=(u/Yt+c.x)/p;return z(Ae((a/Yt+c.y)/p),Ie(_),f)}function i2({min:u,max:a}){return h/Math.max(a[0]-u[0],a[1]-u[1],a[2]-u[2])}const i$=new Float64Array(16);function a2(u){const a=i2(u),c=te(i$,[a,a,a]);return F(c,c,ft([],u.min))}function Ej(u){const a=(f=u.min,(c=i$)[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=f[0],c[13]=f[1],c[14]=f[2],c[15]=1,c);var c,f;const p=1/i2(u);return B(a,a,[p,p,p])}function Tj(u){const a=Yt/(2*Math.PI);return u/(2*Math.PI)/a}function a$(u,a){return Yt/(512*Math.pow(2,u))*i2(Xd(a))}function o$(u,a,c,f,p){const _=Tj(c),b=[u,a,-c/(2*Math.PI)],T=R(new Float64Array(16));return F(T,T,b),B(T,T,[_,_,_]),U(T,T,xn(-p)),Z(T,T,xn(-f)),T}function Rp(u){return Ne(y,s,u)}function s$(u,a){const c=z(a.lat,a.lng),f=function(J){const ae=z(J._center.lat,J._center.lng);let ce=At([],Ce(0,1,0),ae);const de=se([],-J.angle,ae);ce=nr(ce,ce,de),se(de,-J._pitch,ce);const we=ze([],ae);return ke(we,we,r2(J.cameraToCenterDistance/J.pixelsPerMeter)),nr(we,we,de),_e([],ae,we)}(u);return b=(p=be([],f,c))[0],T=p[1],I=p[2],M=(_=c)[0],$=_[1],V=_[2],Y=(q=Math.sqrt((b*b+T*T+I*I)*(M*M+$*$+V*V)))&&ut(p,_)/q,Math.acos(Math.min(Math.max(Y,-1),1));var p,_,b,T,I,M,$,V,q,Y}function Aj(u,a){return s$(u,a)>Math.PI/2*1.01}const l$=xn(85),$ce=Math.cos(l$),Uce=Math.sin(l$),Vce=N(),c$=u=>{const a=[];return u.paint.get("circle-pitch-alignment")==="map"&&a.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&a.push("SCALE_WITH_MAP"),a};function u$(u,a,c,f,p,_,b,T,I){if(_&&u.queryGeometry.isAboveHorizon)return!1;_&&(I*=u.pixelToTileUnitsFactor);const M=u.tileID.canonical,$=c.projection.upVectorScale(M,c.center.lat,c.worldSize).metersToTile;for(const V of a)for(const q of V){const Y=q.add(T),J=p&&c.elevation?c.elevation.exaggeration()*p.getElevationAt(Y.x,Y.y,!0):0,ae=c.projection.projectTilePoint(Y.x,Y.y,M);if(J>0){const Te=c.projection.upVector(M,Y.x,Y.y);ae.x+=Te[0]*$*J,ae.y+=Te[1]*$*J,ae.z+=Te[2]*$*J}const ce=_?Y:qce(ae.x,ae.y,ae.z,f),de=_?u.tilespaceRays.map(Te=>Gce(Te,J)):u.queryGeometry.screenGeometry,we=Qt([],[ae.x,ae.y,ae.z,1],f);if(!b&&_?I*=we[3]/c.cameraToCenterDistance:b&&!_&&(I*=c.cameraToCenterDistance/we[3]),_){const Te=Ae((q.y/Yt+M.y)/(1<<M.z));I/=c.projection.pixelsPerMeter(Te,1)/Ee(1,Te)}if(ta(de,ce,I))return!0}return!1}function qce(u,a,c,f){const p=Qt([],[u,a,c,1],f);return new Nt(p[0]/p[3],p[1]/p[3])}const d$=Ce(0,0,0),Wce=Ce(0,0,1);function Gce(u,a){const c=ie();return d$[2]=a,u.intersectsPlane(d$,Wce,c),new Nt(c[0],c[1])}class h$ extends Xi{}let f$,p$,m$,g$;function y$(u,{width:a,height:c},f,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==a*c*f)throw new RangeError("mismatched image size")}else p=new Uint8Array(a*c*f);return u.width=a,u.height=c,u.data=p,u}function v$(u,a,c){const{width:f,height:p}=a;f===u.width&&p===u.height||(Pj(u,a,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,f),height:Math.min(u.height,p)},c,null),u.width=f,u.height=p,u.data=a.data)}function Pj(u,a,c,f,p,_,b,T){if(p.width===0||p.height===0)return a;if(p.width>u.width||p.height>u.height||c.x>u.width-p.width||c.y>u.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>a.width||p.height>a.height||f.x>a.width-p.width||f.y>a.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const I=u.data,M=a.data,$=_===4&&T;for(let V=0;V<p.height;V++){const q=((c.y+V)*u.width+c.x)*_,Y=((f.y+V)*a.width+f.x)*_;if($)for(let J=0;J<p.width;J++){const ae=q+J*_+3,ce=Y+J*_;M[ce+0]=255,M[ce+1]=255,M[ce+2]=255,M[ce+3]=I[ae]}else if(b)for(let J=0;J<p.width;J++){const ae=q+J*_,ce=Y+J*_,de=new ri(I[ae+0]/255,I[ae+1]/255,I[ae+2]/255,I[ae+3]).toNonPremultipliedRenderColor(b).toArray();M[ce+0]=de[0],M[ce+1]=de[1],M[ce+2]=de[2],M[ce+3]=de[3]}else for(let J=0;J<p.width*_;J++)M[Y+J]=I[q+J]}return a}gr(h$,"HeatmapBucket",{omit:["layers"]});class jp{constructor(a,c){y$(this,a,1,c)}resize(a){v$(this,new jp(a),1)}clone(){return new jp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,f,p,_){Pj(a,c,f,p,_,1,null)}}class Wo{constructor(a,c){y$(this,a,4,c)}resize(a){v$(this,new Wo(a),4)}replace(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Wo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,c,f,p,_,b,T){Pj(a,c,f,p,_,4,b,T)}}class _${constructor(a,c){this.width=a.width,this.height=a.height,this.data=c instanceof Uint8Array?new Float32Array(c.buffer):c}}function u1(u){const a={},c=u.resolution||256,f=u.clips?u.clips.length:1,p=u.image||new Wo({width:c,height:f}),_=(b,T,I)=>{a[u.evaluationKey]=I;const M=u.expression.evaluate(a),$=M?M.toNonPremultipliedRenderColor(null):null;$&&(p.data[b+T+0]=Math.floor(255*$.r),p.data[b+T+1]=Math.floor(255*$.g),p.data[b+T+2]=Math.floor(255*$.b),p.data[b+T+3]=Math.floor(255*$.a))};if(u.clips)for(let b=0,T=0;b<f;++b,T+=4*c)for(let I=0,M=0;I<c;I++,M+=4){const $=I/(c-1),{start:V,end:q}=u.clips[b];_(T,M,V*(1-$)+q*$)}else for(let b=0,T=0;b<c;b++,T+=4)_(0,T,b/(c-1));return p}gr(jp,"AlphaImage"),gr(Wo,"RGBAImage");const Hce=En([{name:"a_pos",components:2,type:"Int16"}],4),Kce=En([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Zce=En([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Xce=En([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function B_(u,a,c=2){const f=a&&a.length,p=f?a[0]*c:u.length;let _=x$(u,0,p,c,!0);const b=[];if(!_||_.next===_.prev)return b;let T,I,M;if(f&&(_=function($,V,q,Y){const J=[];for(let ae=0,ce=V.length;ae<ce;ae++){const de=x$($,V[ae]*Y,ae<ce-1?V[ae+1]*Y:$.length,Y,!1);de===de.next&&(de.steiner=!0),J.push(iue(de))}J.sort(tue);for(let ae=0;ae<J.length;ae++)q=rue(J[ae],q);return q}(u,a,_,c)),u.length>80*c){T=u[0],I=u[1];let $=T,V=I;for(let q=c;q<p;q+=c){const Y=u[q],J=u[q+1];Y<T&&(T=Y),J<I&&(I=J),Y>$&&($=Y),J>V&&(V=J)}M=Math.max($-T,V-I),M=M!==0?32767/M:0}return d1(_,b,c,T,I,M,0),b}function x$(u,a,c,f,p){let _;if(p===function(b,T,I,M){let $=0;for(let V=T,q=I-M;V<I;V+=M)$+=(b[q]-b[V])*(b[V+1]+b[q+1]),q=V;return $}(u,a,c,f)>0)for(let b=a;b<c;b+=f)_=E$(b/f|0,u[b],u[b+1],_);else for(let b=c-f;b>=a;b-=f)_=E$(b/f|0,u[b],u[b+1],_);return _&&$_(_,_.next)&&(p1(_),_=_.next),_}function ty(u,a){if(!u)return u;a||(a=u);let c,f=u;do if(c=!1,f.steiner||!$_(f,f.next)&&go(f.prev,f,f.next)!==0)f=f.next;else{if(p1(f),f=a=f.prev,f===f.next)break;c=!0}while(c||f!==a);return a}function d1(u,a,c,f,p,_,b){if(!u)return;!b&&_&&function(I,M,$,V){let q=I;do q.z===0&&(q.z=Cj(q.x,q.y,M,$,V)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==I);q.prevZ.nextZ=null,q.prevZ=null,function(Y){let J,ae=1;do{let ce,de=Y;Y=null;let we=null;for(J=0;de;){J++;let Te=de,Oe=0;for(let De=0;De<ae&&(Oe++,Te=Te.nextZ,Te);De++);let Ue=ae;for(;Oe>0||Ue>0&&Te;)Oe!==0&&(Ue===0||!Te||de.z<=Te.z)?(ce=de,de=de.nextZ,Oe--):(ce=Te,Te=Te.nextZ,Ue--),we?we.nextZ=ce:Y=ce,ce.prevZ=we,we=ce;de=Te}we.nextZ=null,ae*=2}while(J>1)}(q)}(u,f,p,_);let T=u;for(;u.prev!==u.next;){const I=u.prev,M=u.next;if(_?Jce(u,f,p,_):Yce(u))a.push(I.i,u.i,M.i),p1(u),u=M.next,T=M.next;else if((u=M)===T){b?b===1?d1(u=Qce(ty(u),a),a,c,f,p,_,2):b===2&&eue(u,a,c,f,p,_):d1(ty(u),a,c,f,p,_,1);break}}}function Yce(u){const a=u.prev,c=u,f=u.next;if(go(a,c,f)>=0)return!1;const p=a.x,_=c.x,b=f.x,T=a.y,I=c.y,M=f.y,$=Math.min(p,_,b),V=Math.min(T,I,M),q=Math.max(p,_,b),Y=Math.max(T,I,M);let J=f.next;for(;J!==a;){if(J.x>=$&&J.x<=q&&J.y>=V&&J.y<=Y&&h1(p,T,_,I,b,M,J.x,J.y)&&go(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function Jce(u,a,c,f){const p=u.prev,_=u,b=u.next;if(go(p,_,b)>=0)return!1;const T=p.x,I=_.x,M=b.x,$=p.y,V=_.y,q=b.y,Y=Math.min(T,I,M),J=Math.min($,V,q),ae=Math.max(T,I,M),ce=Math.max($,V,q),de=Cj(Y,J,a,c,f),we=Cj(ae,ce,a,c,f);let Te=u.prevZ,Oe=u.nextZ;for(;Te&&Te.z>=de&&Oe&&Oe.z<=we;){if(Te.x>=Y&&Te.x<=ae&&Te.y>=J&&Te.y<=ce&&Te!==p&&Te!==b&&h1(T,$,I,V,M,q,Te.x,Te.y)&&go(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Oe.x>=Y&&Oe.x<=ae&&Oe.y>=J&&Oe.y<=ce&&Oe!==p&&Oe!==b&&h1(T,$,I,V,M,q,Oe.x,Oe.y)&&go(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;Te&&Te.z>=de;){if(Te.x>=Y&&Te.x<=ae&&Te.y>=J&&Te.y<=ce&&Te!==p&&Te!==b&&h1(T,$,I,V,M,q,Te.x,Te.y)&&go(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Oe&&Oe.z<=we;){if(Oe.x>=Y&&Oe.x<=ae&&Oe.y>=J&&Oe.y<=ce&&Oe!==p&&Oe!==b&&h1(T,$,I,V,M,q,Oe.x,Oe.y)&&go(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function Qce(u,a){let c=u;do{const f=c.prev,p=c.next.next;!$_(f,p)&&w$(f,c,c.next,p)&&f1(f,p)&&f1(p,f)&&(a.push(f.i,c.i,p.i),p1(c),p1(c.next),c=u=p),c=c.next}while(c!==u);return ty(c)}function eue(u,a,c,f,p,_){let b=u;do{let T=b.next.next;for(;T!==b.prev;){if(b.i!==T.i&&aue(b,T)){let I=S$(b,T);return b=ty(b,b.next),I=ty(I,I.next),d1(b,a,c,f,p,_,0),void d1(I,a,c,f,p,_,0)}T=T.next}b=b.next}while(b!==u)}function tue(u,a){let c=u.x-a.x;return c===0&&(c=u.y-a.y,c===0)&&(c=(u.next.y-u.y)/(u.next.x-u.x)-(a.next.y-a.y)/(a.next.x-a.x)),c}function rue(u,a){const c=function(p,_){let b=_;const T=p.x,I=p.y;let M,$=-1/0;if($_(p,b))return b;do{if($_(p,b.next))return b.next;if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){const ae=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(ae<=T&&ae>$&&($=ae,M=b.x<b.next.x?b:b.next,ae===T))return M}b=b.next}while(b!==_);if(!M)return null;const V=M,q=M.x,Y=M.y;let J=1/0;b=M;do{if(T>=b.x&&b.x>=q&&T!==b.x&&b$(I<Y?T:$,I,q,Y,I<Y?$:T,I,b.x,b.y)){const ae=Math.abs(I-b.y)/(T-b.x);f1(b,p)&&(ae<J||ae===J&&(b.x>M.x||b.x===M.x&&nue(M,b)))&&(M=b,J=ae)}b=b.next}while(b!==V);return M}(u,a);if(!c)return a;const f=S$(c,u);return ty(f,f.next),ty(c,c.next)}function nue(u,a){return go(u.prev,u,a.prev)<0&&go(a.next,u,u.next)<0}function Cj(u,a,c,f,p){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-c)*p|0)|u<<8))|u<<4))|u<<2))|u<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-f)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function iue(u){let a=u,c=u;do(a.x<c.x||a.x===c.x&&a.y<c.y)&&(c=a),a=a.next;while(a!==u);return c}function b$(u,a,c,f,p,_,b,T){return(p-b)*(a-T)>=(u-b)*(_-T)&&(u-b)*(f-T)>=(c-b)*(a-T)&&(c-b)*(_-T)>=(p-b)*(f-T)}function h1(u,a,c,f,p,_,b,T){return!(u===b&&a===T)&&b$(u,a,c,f,p,_,b,T)}function aue(u,a){return u.next.i!==a.i&&u.prev.i!==a.i&&!function(c,f){let p=c;do{if(p.i!==c.i&&p.next.i!==c.i&&p.i!==f.i&&p.next.i!==f.i&&w$(p,p.next,c,f))return!0;p=p.next}while(p!==c);return!1}(u,a)&&(f1(u,a)&&f1(a,u)&&function(c,f){let p=c,_=!1;const b=(c.x+f.x)/2,T=(c.y+f.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&b<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==c);return _}(u,a)&&(go(u.prev,u,a.prev)||go(u,a.prev,a))||$_(u,a)&&go(u.prev,u,u.next)>0&&go(a.prev,a,a.next)>0)}function go(u,a,c){return(a.y-u.y)*(c.x-a.x)-(a.x-u.x)*(c.y-a.y)}function $_(u,a){return u.x===a.x&&u.y===a.y}function w$(u,a,c,f){const p=s2(go(u,a,c)),_=s2(go(u,a,f)),b=s2(go(c,f,u)),T=s2(go(c,f,a));return p!==_&&b!==T||!(p!==0||!o2(u,c,a))||!(_!==0||!o2(u,f,a))||!(b!==0||!o2(c,u,f))||!(T!==0||!o2(c,a,f))}function o2(u,a,c){return a.x<=Math.max(u.x,c.x)&&a.x>=Math.min(u.x,c.x)&&a.y<=Math.max(u.y,c.y)&&a.y>=Math.min(u.y,c.y)}function s2(u){return u>0?1:u<0?-1:0}function f1(u,a){return go(u.prev,u,u.next)<0?go(u,a,u.next)>=0&&go(u,u.prev,a)>=0:go(u,a,u.prev)<0||go(u,u.next,a)<0}function S$(u,a){const c=Oj(u.i,u.x,u.y),f=Oj(a.i,a.x,a.y),p=u.next,_=a.prev;return u.next=a,a.prev=u,c.next=p,p.prev=c,f.next=c,c.prev=f,_.next=f,f.prev=_,f}function E$(u,a,c,f){const p=Oj(u,a,c);return f?(p.next=f.next,p.prev=f,f.next.prev=p,f.next=p):(p.prev=p,p.next=p),p}function p1(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Oj(u,a,c){return{i:u,x:a,y:c,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function m1(u,a){const c=u.length;if(c<=1)return[u];const f=[];let p,_;for(let b=0;b<c;b++){const T=Sn(u[b]);T!==0&&(u[b].area=Math.abs(T),_===void 0&&(_=T<0),_===T<0?(p&&f.push(p),p=[u[b]]):p.push(u[b]))}if(p&&f.push(p),a>1)for(let b=0;b<f.length;b++)f[b].length<=a||(qu(f[b],a,1,f[b].length-1,oue),f[b]=f[b].slice(0,a));return f}function oue(u,a){return a.area-u.area}function T$(u,a,c=1){if(!u)return null;const f=typeof u=="string"?Ms.from(u).getPrimary():u.getPrimary(),p=typeof u=="string"?null:u.getSecondary();for(const _ of[f,p]){if(!_)continue;const b=_.id.toString();a.has(b)||a.set(b,[]),_.scaleSelf(c),a.get(b).push(_)}return{primary:f.toString(),secondary:p?p.toString():null}}function Ij(u,a,c,f){const p=f.patternDependencies;let _=!1;for(const b of a){const T=b.paint.get(`${u}-pattern`);T.isConstant()||(_=!0),T$(T.constantOr(null),p,c)&&(_=!0)}return _}function kj(u,a,c,f,p,_){const b=_.patternDependencies;for(const T of a){const I=T.paint.get(`${u}-pattern`).value;if(I.kind!=="constant"){let M=I.evaluate({zoom:f},c,{},_.availableImages);M=M&&M.name?M.name:M;const $=T$(M,b,p);if(!$)continue;const{primary:V,secondary:q}=$;V&&(c.patterns[T.id]=[V,q].filter(Boolean))}}return c}class A${constructor(){this.polygons=new Map}add(a,...c){const f=this.polygons.get(a);f?f.push(...c):this.polygons.set(a,c)}merge(a){for(const[c,f]of a.polygons)this.add(c,...f)}}class rf{constructor(){this.portals=[]}static isOnBorder(a,c){return a<=0&&c<=0||a>=Yt&&c>=Yt}static evaluate(a){if(a.length===0)return new rf;let c=[];for(const I of a)c.push(...I.portals);if(c.length===0)return new rf;for(const I of c){const M=I.va,$=I.vb;(rf.isOnBorder(M.x,$.x)||rf.isOnBorder(M.y,$.y))&&(I.type="border")}const f=c.filter(I=>I.type!=="unevaluated"),p=c.filter(I=>I.type==="unevaluated");if(p.length===0)return new rf;p.sort((I,M)=>I.hash===M.hash?I.isTunnel===M.isTunnel?0:I.isTunnel?-1:1:I.hash<M.hash?1:-1),c=f.concat(p);let _=f.length,b=_,T=_;do if(b++,b===c.length||c[_].hash!==c[b].hash){if(b-_==2){T<_&&(c[T]=c[_],c[_]=null);const I=c[T],M=c[b-1];I.type=I.isTunnel!==M.isTunnel?"tunnel":"polygon",I.connection={a:I.connection.a,b:M.connection.a},T++}_=b}while(_!==c.length);return c.splice(T),c.sort((I,M)=>I.hash<M.hash?1:-1),{portals:c}}}gr(rf,"ElevationPortalGraph"),gr(A$,"ElevationPolygons");class sue{constructor(a,c,f){this.outPositions=a,this.outNormals=c,this.outIndices=f,this.vertexLookup=new Map}addVertex(a,c,f){let p=a[2];f!=null&&(p*=f);const _=`${a[0]},${a[1]},${a[2]},${c[0]},${c[1]},${c[2]}`,b=this.vertexLookup.get(_);if(b!=null)return b;const T=this.outPositions.length;this.vertexLookup.set(_,T);const I=Math.trunc(16384*c[0]),M=Math.trunc(16384*c[1]),$=Math.trunc(16384*c[2]);return this.outPositions.emplaceBack(a[0],a[1],p),this.outNormals.emplaceBack(I,M,$),T}addTriangle(a,c,f){this.outIndices.emplaceBack(a,c,f)}addTriangles(a,c,f){if(a.length===0)return;const p=f.length===1,_=ie(),b=ie();for(let T=0;T<a.length;T+=3){const I=c[a[T+0]],M=c[a[T+1]],$=c[a[T+2]],V=p?f[0]:f[a[T+1]],q=p?f[0]:f[a[T+2]];fe(_,I.x,I.y,p?f[0]:f[a[T+0]]);const Y=this.addVertex(_,b);fe(_,M.x,M.y,V);const J=this.addVertex(_,b);fe(_,$.x,$.y,q);const ae=this.addVertex(_,b);this.outIndices.emplaceBack(Y,J,ae)}}addQuad(a,c,f,p,_,b){const T=this.addVertex(a,_,b),I=this.addVertex(c,_,b),M=this.addVertex(f,_,b),$=this.addVertex(p,_,b);this.addTriangle(T,I,M),this.addTriangle(M,$,T)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Cl{constructor(a,c,f,p){this.unevaluatedPortals=new rf,this.portalPolygons=new A$,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ww,this.vertexNormals=new Gw,this.indexArray=new Gi,this.tileToMeters=qe(a),this.bridgeProgramConfigurations=new Ic(c,{zoom:f,lut:p},_=>_!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ic(c,{zoom:f,lut:p},_=>_!=="fill-bridge-guard-rail-color")}addVertices(a,c){const f=this.unevalVertices.length;for(let p=0;p<a.length;p++)this.unevalVertices.push(a[p]),this.unevalHeights.push(c[p]);return f}addTriangles(a,c,f){const p=f?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of a)p.push(_+c)}addRenderableRing(a,c,f,p,_,b){const T=[new Nt(_.min.x,_.min.y),new Nt(_.max.x,_.min.y),new Nt(_.max.x,_.max.y),new Nt(_.min.x,_.max.y)];for(let I=0;I<f-1;I++){const M=c+I,$=M+1,V=this.unevalVertices[M],q=this.unevalVertices[$];if(!(V.x>=_.min.x&&V.x<=_.max.x&&V.y>=_.min.y&&V.y<=_.max.y||q.x>=_.min.x&&q.x<=_.max.x&&q.y>=_.min.y&&q.y<=_.max.y||ba(V,q,T))||this.isOnBorder(V.x,q.x)||this.isOnBorder(V.y,q.y))continue;const Y=Cl.computeEdgeHash(this.unevalVertices[M],this.unevalVertices[$]);let J,ae=this.vertexHashLookup.get(Cl.computePosHash(V));ae!=null?J=ae.next:(ae=this.vertexHashLookup.get(Cl.computePosHash(q)),J=ae!=null?ae.prev:Y),this.unevalEdges.push({polygonIdx:a,a:M,b:$,hash:Y,portalHash:J,isTunnel:p,type:"unevaluated",featureInfo:b})}}addPortalCandidates(a,c,f,p,_){if(c.length===0)return;this.portalPolygons.add(a,{geometry:c,zLevel:_});const b=c[0];this.vertexHashLookup.clear();let T=Cl.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let I=0;I<b.length-1;I++){const M=b[I+0],$=b[I+1],V=_s($.x-M.x,$.y-M.y),q=ji(V);if(q===0)continue;let Y="unevaluated";const J=p.pointElevation(M),ae=p.pointElevation($);Math.abs(J)<.01&&Math.abs(ae)<.01?Y="entrance":(this.isOnBorder(M.x,$.x)||this.isOnBorder(M.y,$.y))&&(Y="border");const ce=Cl.computeEdgeHash(M,$);this.unevaluatedPortals.portals.push({connection:{a,b:void 0},va:M,vb:$,vab:V,length:q,hash:ce,isTunnel:f,type:Y});const de=Cl.computePosHash(M);this.vertexHashLookup.set(de,{prev:T,next:ce}),T=ce}}construct(a){if(this.unevalVertices.length===0)return;const c=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),f=q=>{q.primitiveLength=this.indexArray.length-q.primitiveOffset},p=new sue(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(a.portals,this.unevalEdges);const _=c(),b=c(),T=c(),I=(q,Y)=>{q.sort((ae,ce)=>ae.type===Y&&ce.type!==Y?-1:ae.type!==Y&&ce.type===Y?1:0);const J=q.findIndex(ae=>ae.type!==Y);return J>=0?J:q.length};let M=0;this.unevalEdges.length>0&&(M=I(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},this.tileToMeters)),f(T);const $=c(),V=c();if(this.unevalEdges.length>0){const q=this.unevalEdges.splice(M),Y=I(q,"tunnel")+M;this.unevalEdges.push(...q),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:M},{min:M,max:Y})}f($),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),f(V),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),f(b),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),f(_),this.maskSegments=ea.simpleSegment(0,V.primitiveOffset,0,V.primitiveLength),this.depthSegments=ea.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableBridgeSegments=ea.simpleSegment(0,T.primitiveOffset,0,T.primitiveLength),this.renderableTunnelSegments=ea.simpleSegment(0,$.primitiveOffset,0,$.primitiveLength),this.shadowCasterSegments=ea.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(a,c,f,p,_,b,T,I){this.bridgeProgramConfigurations.updatePaintArrays(a,c,_,f,p,b,T,I),this.tunnelProgramConfigurations.updatePaintArrays(a,c,_,f,p,b,T,I)}upload(a){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=a.createVertexBuffer(this.vertexPositions,Zce.members),this.vertexBufferNormal=a.createVertexBuffer(this.vertexNormals,Xce.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(a),this.tunnelProgramConfigurations.upload(a))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(a,c,f,p,_){const b=(T,I)=>{for(let M=0;M<I.length-1;M++){const $=I[M].featureIndex,V=I[M+1].vertexStart,q=a.feature($);T.populatePaintArrays(V,q,$,{},f,c,p,void 0,_)}};b(this.bridgeProgramConfigurations,this.bridgeFeatureSections),b(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(a,c,f,p,_){const b=new Map;for(let T=p;T<_;T++){const I=f[T],M=I.a,$=I.b,V=Cl.computePosHash(a[M]),q=Cl.computePosHash(a[$]);let Y=b.get(V);Y||(Y={},b.set(V,Y));let J=b.get(q);J||(J={},b.set(q,J)),c[M]<=0&&c[$]<=0||(Y.to=$,J.from=M)}return b}isTerminalVertex(a,c){const f=Cl.computePosHash(this.unevalVertices[a]),p=c.get(f);return!p||!p.from||!p.to}constructBridgeStructures(a,c,f,p,_,b){a.clearVertexLookup();const T=this.computeVertexConnections(c,f,p,_.min,_.max),I=1/b,M=.5*I,$=(Zt,$t)=>fe(Zt,c[$t].x,c[$t].y,f[$t]*I),V=ie(),q=ie(),Y=ie(),J=ie(),ae=ie(),ce=(Zt,$t)=>{const Rt=T.get(Cl.computePosHash(c[$t])),Bt=Rt.from,bt=Rt.to;if(!Bt||!bt)return;$(V,Bt),$(q,$t),$(Y,bt),Br(J),Yr(V,q)||(_t(ae,q,V),ze(J,ae)),Yr(Y,q)||(_t(ae,Y,q),_e(J,J,ze(ae,ae)));const yt=Ke(J);return yt>0?ke(Zt,J,1/yt):void 0};let de=Number.POSITIVE_INFINITY;this.sortSubarray(p,_.min,_.max,(Zt,$t)=>Zt.featureInfo.featureIndex-$t.featureInfo.featureIndex);const we=ie(),Te=ie(),Oe=ie(),Ue=ie(),De=ie(),Ge=ie(),Je=ie(),tt=ie(),Et=ie(),ct=[ie(),ie(),ie(),ie()],Tt=[ie(),ie(),ie(),ie()],kt=[{coord:new Nt(0,0),height:0},{coord:new Nt(0,0),height:0}],Dt=(Zt,$t)=>Zt>$t;for(let Zt=_.min;Zt<_.max;Zt++){const $t=p[Zt];if(!$t.featureInfo.guardRailEnabled||!this.prepareEdgePoints(kt,c,f,$t,Dt))continue;const[Rt,Bt]=kt;if(fe(we,Rt.coord.x,Rt.coord.y,I*Rt.height),fe(Te,Bt.coord.x,Bt.coord.y,I*Bt.height),Yr(we,Te))continue;_t(Oe,Te,we),ze(Oe,Oe);const bt=ce(tt,$t.a)||Oe,yt=ce(Et,$t.b)||Oe;fe(Ue,bt[1],-bt[0],0),ze(Ue,Ue),fe(De,yt[1],-yt[0],0),ze(De,De),At(tt,Ue,bt),ze(Ge,tt),At(tt,De,yt),ze(Je,tt),_e(ct[0],we,ke(tt,_t(tt,Ue,Ge),M)),_e(ct[1],we,ke(tt,_e(tt,Ue,Ge),M)),_e(ct[2],we,ke(tt,Ge,M)),ct[3]=we,_e(Tt[0],Te,ke(tt,_t(tt,De,Je),M)),_e(Tt[1],Te,ke(tt,_e(tt,De,Je),M)),_e(Tt[2],Te,ke(tt,Je,M)),Tt[3]=Te,de=this.addFeatureSection($t.featureInfo.featureIndex,de,this.bridgeFeatureSections,a);const Ft=a.addVertex(ct[0],Ue,b),Gt=a.addVertex(ct[1],Ue,b),jt=a.addVertex(Tt[0],De,b),pr=a.addVertex(Tt[1],De,b);a.addTriangle(Ft,Gt,jt),a.addTriangle(Gt,pr,jt);const vr=a.addVertex(ct[1],Ge,b),ur=a.addVertex(ct[2],Ge,b),ir=a.addVertex(Tt[1],Je,b),Kr=a.addVertex(Tt[2],Je,b);a.addTriangle(vr,ur,ir),a.addTriangle(ur,Kr,ir),ft(Ue,Ue),ft(De,De);const or=a.addVertex(ct[2],Ue,b),Or=a.addVertex(ct[3],Ue,b),Jr=a.addVertex(Tt[2],De,b),yn=a.addVertex(Tt[3],De,b);a.addTriangle(or,Or,Jr),a.addTriangle(Or,yn,Jr);const Fn=this.isTerminalVertex($t.a,T),tn=this.isTerminalVertex($t.b,T);Rt.height<.01&&Fn&&a.addQuad(ct[3],ct[2],ct[1],ct[0],ft(bt,bt),b),Bt.height<.01&&tn&&a.addQuad(Tt[0],Tt[1],Tt[2],Tt[3],yt,b)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}constructTunnelStructures(a,c,f,p,_,b){a.clearVertexLookup();let T=Number.POSITIVE_INFINITY;const I=(de,we)=>de.featureInfo.featureIndex-we.featureInfo.featureIndex;this.sortSubarray(p,_.min,_.max,I),this.sortSubarray(p,b.min,b.max,I);const M=de=>ze(de,de),$=[{coord:new Nt(0,0),height:0},{coord:new Nt(0,0),height:0}],V=(de,we)=>de<we,q=ie(),Y=ie(),J=ie(),ae=ie(),ce=ie();for(let de=_.min;de<_.max;de++){if(!this.prepareEdgePoints($,c,f,p[de],V))continue;const[we,Te]=$,Oe=M(fe(ce,-(Te.coord.y-we.coord.y),Te.coord.x-we.coord.x,0));T=this.addFeatureSection(p[de].featureInfo.featureIndex,T,this.tunnelFeatureSections,a),a.addQuad(fe(q,we.coord.x,we.coord.y,we.height),fe(Y,Te.coord.x,Te.coord.y,Te.height),fe(J,Te.coord.x,Te.coord.y,p[de].isTunnel?-.1:0),fe(ae,we.coord.x,we.coord.y,p[de].isTunnel?-.1:0),Oe)}for(let de=b.min;de<b.max;de++){const we=p[de];we.isTunnel&&([we.a,we.b]=[we.b,we.a]);const Te=c[we.a],Oe=c[we.b],Ue=M(fe(ce,-(Oe.y-Te.y),Oe.x-Te.x,0));T=this.addFeatureSection(we.featureInfo.featureIndex,T,this.tunnelFeatureSections,a),a.addQuad(fe(q,Oe.x,Oe.y,0),fe(Y,Te.x,Te.y,0),fe(J,Te.x,Te.y,f[we.a]+4),fe(ae,Oe.x,Oe.y,f[we.b]+4),Ue),a.addQuad(fe(q,Te.x,Te.y,0),fe(Y,Oe.x,Oe.y,0),fe(J,Oe.x,Oe.y,f[we.b]+4),fe(ae,Te.x,Te.y,f[we.a]+4),Ue)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:a.getVertexCount()})}setElevatedPoint(a,c,f,p){a.coord.x=c,a.coord.y=f,a.height=p}prepareEdgePoints(a,c,f,p,_){let b=c[p.a].x,T=c[p.a].y,I=c[p.b].x,M=c[p.b].y,$=f[p.a],V=f[p.b];const q=_($,0),Y=_(V,0);if(q&&Y)return this.setElevatedPoint(a[0],b,T,$),this.setElevatedPoint(a[1],I,M,V),!0;if(!q&&!Y)return!1;if(q){if(!Y){const J=V/(V-$);I=$r(I,b,J),M=$r(M,T,J),V=$r(V,$,J)}}else{const J=$/($-V);b=$r(b,I,J),T=$r(T,M,J),$=$r($,V,J)}return this.setElevatedPoint(a[0],b,T,$),this.setElevatedPoint(a[1],I,M,V),!0}prepareEdges(a,c){if(c.length===0)return;c.sort((T,I)=>T.hash===I.hash?I.polygonIdx-T.polygonIdx:I.hash>T.hash?1:-1);let f=0,p=0,_=0,b=c[f].polygonIdx;do p++,(p===c.length||c[f].hash!==c[p].hash)&&((p-f==1||c[p-1].polygonIdx!==b)&&(_<f&&(c[_]=c[f],c[f]=null),c[_].type="none",_++),f=p,f!==c.length&&(b=c[f].polygonIdx));while(f!==c.length);if(c.splice(_),c.length!==0&&a.length!==0){c.sort((M,$)=>M.portalHash<$.portalHash?1:-1);let T=0,I=0;for(;T!==c.length&&I!==a.length;){const M=c[T],$=a[I];M.portalHash>$.hash?T++:$.hash>M.portalHash?I++:(M.type=$.type,T++)}}}isOnBorder(a,c){return a<=0&&c<=0||a>=Yt&&c>=Yt}addFeatureSection(a,c,f,p){return a!==c&&(c=a,f.push({featureIndex:a,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),c}sortSubarray(a,c,f,p){const _=a.slice(c,f);_.sort(p),a.splice(c,_.length,..._)}static computeEdgeHash(a,c){return(a.y===c.y&&a.x>c.x||a.y>c.y)&&([a,c]=[c,a]),BigInt(Cl.computePosHash(a))<<32n|BigInt(Cl.computePosHash(c))}static computePosHash(a){return((65535&a.x)<<16|65535&a.y)>>>0}}var P$,C$={exports:{}},O$=(P$||(P$=1,function(u,a){(function(c){function f(Le,je){return Le>je?1:Le<je?-1:0}var p=function(Le,je){Le===void 0&&(Le=f),je===void 0&&(je=!1),this._compare=Le,this._root=null,this._size=0,this._noDuplicates=!!je},_={size:{configurable:!0}};function b(Le,je,Pt,rr,Ct){var ar=Ct-rr;if(ar>0){var Ar=rr+Math.floor(ar/2),Er={key:je[Ar],data:Pt[Ar],parent:Le};return Er.left=b(Er,je,Pt,rr,Ar),Er.right=b(Er,je,Pt,Ar+1,Ct),Er}return null}function T(Le,je,Pt,rr,Ct){if(!(Pt>=rr)){for(var ar=Le[Pt+rr>>1],Ar=Pt-1,Er=rr+1;;){do Ar++;while(Ct(Le[Ar],ar)<0);do Er--;while(Ct(Le[Er],ar)>0);if(Ar>=Er)break;var rn=Le[Ar];Le[Ar]=Le[Er],Le[Er]=rn,rn=je[Ar],je[Ar]=je[Er],je[Er]=rn}T(Le,je,Pt,Er,Ct),T(Le,je,Er+1,rr,Ct)}}p.prototype.rotateLeft=function(Le){var je=Le.right;je&&(Le.right=je.left,je.left&&(je.left.parent=Le),je.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=je:Le.parent.right=je:this._root=je,je&&(je.left=Le),Le.parent=je},p.prototype.rotateRight=function(Le){var je=Le.left;je&&(Le.left=je.right,je.right&&(je.right.parent=Le),je.parent=Le.parent),Le.parent?Le===Le.parent.left?Le.parent.left=je:Le.parent.right=je:this._root=je,je&&(je.right=Le),Le.parent=je},p.prototype._splay=function(Le){for(;Le.parent;){var je=Le.parent;je.parent?je.left===Le&&je.parent.left===je?(this.rotateRight(je.parent),this.rotateRight(je)):je.right===Le&&je.parent.right===je?(this.rotateLeft(je.parent),this.rotateLeft(je)):je.left===Le&&je.parent.right===je?(this.rotateRight(je),this.rotateLeft(je)):(this.rotateLeft(je),this.rotateRight(je)):je.left===Le?this.rotateRight(je):this.rotateLeft(je)}},p.prototype.splay=function(Le){for(var je,Pt,rr,Ct,ar;Le.parent;)(Pt=(je=Le.parent).parent)&&Pt.parent?((rr=Pt.parent).left===Pt?rr.left=Le:rr.right=Le,Le.parent=rr):(Le.parent=null,this._root=Le),Ct=Le.left,ar=Le.right,Le===je.left?(Pt&&(Pt.left===je?(je.right?(Pt.left=je.right,Pt.left.parent=Pt):Pt.left=null,je.right=Pt,Pt.parent=je):(Ct?(Pt.right=Ct,Ct.parent=Pt):Pt.right=null,Le.left=Pt,Pt.parent=Le)),ar?(je.left=ar,ar.parent=je):je.left=null,Le.right=je,je.parent=Le):(Pt&&(Pt.right===je?(je.left?(Pt.right=je.left,Pt.right.parent=Pt):Pt.right=null,je.left=Pt,Pt.parent=je):(ar?(Pt.left=ar,ar.parent=Pt):Pt.left=null,Le.right=Pt,Pt.parent=Le)),Ct?(je.right=Ct,Ct.parent=je):je.right=null,Le.left=je,je.parent=Le)},p.prototype.replace=function(Le,je){Le.parent?Le===Le.parent.left?Le.parent.left=je:Le.parent.right=je:this._root=je,je&&(je.parent=Le.parent)},p.prototype.minNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.left;)Le=Le.left;return Le},p.prototype.maxNode=function(Le){if(Le===void 0&&(Le=this._root),Le)for(;Le.right;)Le=Le.right;return Le},p.prototype.insert=function(Le,je){var Pt=this._root,rr=null,Ct=this._compare;if(this._noDuplicates)for(;Pt;){if(rr=Pt,Ct(Pt.key,Le)===0)return;Pt=Ct(Pt.key,Le)<0?Pt.right:Pt.left}else for(;Pt;)rr=Pt,Pt=Ct(Pt.key,Le)<0?Pt.right:Pt.left;return Pt={key:Le,data:je,left:null,right:null,parent:rr},rr?Ct(rr.key,Pt.key)<0?rr.right=Pt:rr.left=Pt:this._root=Pt,this.splay(Pt),this._size++,Pt},p.prototype.find=function(Le){for(var je=this._root,Pt=this._compare;je;){var rr=Pt(je.key,Le);if(rr<0)je=je.right;else{if(!(rr>0))return je;je=je.left}}return null},p.prototype.contains=function(Le){for(var je=this._root,Pt=this._compare;je;){var rr=Pt(Le,je.key);if(rr===0)return!0;je=rr<0?je.left:je.right}return!1},p.prototype.remove=function(Le){var je=this.find(Le);if(!je)return!1;if(this.splay(je),je.left)if(je.right){var Pt=this.minNode(je.right);Pt.parent!==je&&(this.replace(Pt,Pt.right),Pt.right=je.right,Pt.right.parent=Pt),this.replace(je,Pt),Pt.left=je.left,Pt.left.parent=Pt}else this.replace(je,je.left);else this.replace(je,je.right);return this._size--,!0},p.prototype.removeNode=function(Le){if(!Le)return!1;if(this.splay(Le),Le.left)if(Le.right){var je=this.minNode(Le.right);je.parent!==Le&&(this.replace(je,je.right),je.right=Le.right,je.right.parent=je),this.replace(Le,je),je.left=Le.left,je.left.parent=je}else this.replace(Le,Le.left);else this.replace(Le,Le.right);return this._size--,!0},p.prototype.erase=function(Le){var je=this.find(Le);if(je){this.splay(je);var Pt=je.left,rr=je.right,Ct=null;Pt&&(Pt.parent=null,Ct=this.maxNode(Pt),this.splay(Ct),this._root=Ct),rr&&(Pt?Ct.right=rr:this._root=rr,rr.parent=Ct),this._size--}},p.prototype.pop=function(){var Le=this._root,je=null;if(Le){for(;Le.left;)Le=Le.left;je={key:Le.key,data:Le.data},this.remove(Le.key)}return je},p.prototype.next=function(Le){var je=Le;if(je)if(je.right)for(je=je.right;je&&je.left;)je=je.left;else for(je=Le.parent;je&&je.right===Le;)Le=je,je=je.parent;return je},p.prototype.prev=function(Le){var je=Le;if(je)if(je.left)for(je=je.left;je&&je.right;)je=je.right;else for(je=Le.parent;je&&je.left===Le;)Le=je,je=je.parent;return je},p.prototype.forEach=function(Le){for(var je=this._root,Pt=[],rr=!1,Ct=0;!rr;)je?(Pt.push(je),je=je.left):Pt.length>0?(Le(je=Pt.pop(),Ct++),je=je.right):rr=!0;return this},p.prototype.range=function(Le,je,Pt,rr){for(var Ct=[],ar=this._compare,Ar=this._root;Ct.length!==0||Ar;)if(Ar)Ct.push(Ar),Ar=Ar.left;else{if(ar((Ar=Ct.pop()).key,je)>0)break;if(ar(Ar.key,Le)>=0&&Pt.call(rr,Ar))return this;Ar=Ar.right}return this},p.prototype.keys=function(){for(var Le=this._root,je=[],Pt=[],rr=!1;!rr;)Le?(je.push(Le),Le=Le.left):je.length>0?(Le=je.pop(),Pt.push(Le.key),Le=Le.right):rr=!0;return Pt},p.prototype.values=function(){for(var Le=this._root,je=[],Pt=[],rr=!1;!rr;)Le?(je.push(Le),Le=Le.left):je.length>0?(Le=je.pop(),Pt.push(Le.data),Le=Le.right):rr=!0;return Pt},p.prototype.at=function(Le){for(var je=this._root,Pt=[],rr=!1,Ct=0;!rr;)if(je)Pt.push(je),je=je.left;else if(Pt.length>0){if(je=Pt.pop(),Ct===Le)return je;Ct++,je=je.right}else rr=!0;return null},p.prototype.load=function(Le,je,Pt){if(Le===void 0&&(Le=[]),je===void 0&&(je=[]),Pt===void 0&&(Pt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var rr=Le.length;return Pt&&T(Le,je,0,rr-1,this._compare),this._root=b(null,Le,je,0,rr),this._size=rr,this},p.prototype.min=function(){var Le=this.minNode(this._root);return Le?Le.key:null},p.prototype.max=function(){var Le=this.maxNode(this._root);return Le?Le.key:null},p.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},p.createTree=function(Le,je,Pt,rr,Ct){return new p(Pt,Ct).load(Le,je,rr)},Object.defineProperties(p.prototype,_);var I=0,M=1,$=2,V=3,q=0,Y=1,J=2,ae=3;function ce(Le,je,Pt){je===null?(Le.inOut=!1,Le.otherInOut=!0):(Le.isSubject===je.isSubject?(Le.inOut=!je.inOut,Le.otherInOut=je.otherInOut):(Le.inOut=!je.otherInOut,Le.otherInOut=je.isVertical()?!je.inOut:je.inOut),je&&(Le.prevInResult=!de(je,Pt)||je.isVertical()?je.prevInResult:je));var rr=de(Le,Pt);Le.resultTransition=rr?function(Ct,ar){var Ar,Er=!Ct.inOut,rn=!Ct.otherInOut;switch(ar){case q:Ar=Er&&rn;break;case Y:Ar=Er||rn;break;case ae:Ar=Er^rn;break;case J:Ar=Ct.isSubject?Er&&!rn:rn&&!Er}return Ar?1:-1}(Le,Pt):0}function de(Le,je){switch(Le.type){case I:switch(je){case q:return!Le.otherInOut;case Y:return Le.otherInOut;case J:return Le.isSubject&&Le.otherInOut||!Le.isSubject&&!Le.otherInOut;case ae:return!0}break;case $:return je===q||je===Y;case V:return je===J;case M:return!1}return!1}var we=function(Le,je,Pt,rr,Ct){this.left=je,this.point=Le,this.otherEvent=Pt,this.isSubject=rr,this.type=Ct||I,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Te={inResult:{configurable:!0}};function Oe(Le,je){return Le[0]===je[0]&&Le[1]===je[1]}we.prototype.isBelow=function(Le){var je=this.point,Pt=this.otherEvent.point;return this.left?(je[0]-Le[0])*(Pt[1]-Le[1])-(Pt[0]-Le[0])*(je[1]-Le[1])>0:(Pt[0]-Le[0])*(je[1]-Le[1])-(je[0]-Le[0])*(Pt[1]-Le[1])>0},we.prototype.isAbove=function(Le){return!this.isBelow(Le)},we.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Te.inResult.get=function(){return this.resultTransition!==0},we.prototype.clone=function(){var Le=new we(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Le.contourId=this.contourId,Le.resultTransition=this.resultTransition,Le.prevInResult=this.prevInResult,Le.isExteriorRing=this.isExteriorRing,Le.inOut=this.inOut,Le.otherInOut=this.otherInOut,Le},Object.defineProperties(we.prototype,Te);var Ue=11102230246251565e-32,De=134217729,Ge=(3+8*Ue)*Ue;function Je(Le,je,Pt,rr,Ct){var ar,Ar,Er,rn,Dr=je[0],wr=rr[0],Vn=0,yi=0;wr>Dr==wr>-Dr?(ar=Dr,Dr=je[++Vn]):(ar=wr,wr=rr[++yi]);var zr=0;if(Vn<Le&&yi<Pt)for(wr>Dr==wr>-Dr?(Er=ar-((Ar=Dr+ar)-Dr),Dr=je[++Vn]):(Er=ar-((Ar=wr+ar)-wr),wr=rr[++yi]),ar=Ar,Er!==0&&(Ct[zr++]=Er);Vn<Le&&yi<Pt;)wr>Dr==wr>-Dr?(Er=ar-((Ar=ar+Dr)-(rn=Ar-ar))+(Dr-rn),Dr=je[++Vn]):(Er=ar-((Ar=ar+wr)-(rn=Ar-ar))+(wr-rn),wr=rr[++yi]),ar=Ar,Er!==0&&(Ct[zr++]=Er);for(;Vn<Le;)Er=ar-((Ar=ar+Dr)-(rn=Ar-ar))+(Dr-rn),Dr=je[++Vn],ar=Ar,Er!==0&&(Ct[zr++]=Er);for(;yi<Pt;)Er=ar-((Ar=ar+wr)-(rn=Ar-ar))+(wr-rn),wr=rr[++yi],ar=Ar,Er!==0&&(Ct[zr++]=Er);return ar===0&&zr!==0||(Ct[zr++]=ar),zr}function tt(Le){return new Float64Array(Le)}var Et=33306690738754716e-32,ct=22204460492503146e-32,Tt=11093356479670487e-47,kt=tt(4),Dt=tt(8),Zt=tt(12),$t=tt(16),Rt=tt(4);function Bt(Le,je,Pt){var rr=function(Ct,ar,Ar,Er,rn,Dr){var wr=(ar-Dr)*(Ar-rn),Vn=(Ct-rn)*(Er-Dr),yi=wr-Vn;if(wr===0||Vn===0||wr>0!=Vn>0)return yi;var zr=Math.abs(wr+Vn);return Math.abs(yi)>=Et*zr?yi:-function(Dn,vi,ni,oa,Bi,Pi,ci){var Hn,nn,Kn,Ci,Lr,zn,$i,fa,Aa,qa,Ui,za,el,Ba,Il,Go,Rc,tl,kl=Dn-Bi,Ho=ni-Bi,Rl=vi-Pi,jc=oa-Pi;kt[0]=(Il=(fa=kl-($i=(zn=De*kl)-(zn-kl)))*(qa=jc-(Aa=(zn=De*jc)-(zn-jc)))-((Ba=kl*jc)-$i*Aa-fa*Aa-$i*qa))-((Ui=Il-(Rc=(fa=Rl-($i=(zn=De*Rl)-(zn-Rl)))*(qa=Ho-(Aa=(zn=De*Ho)-(zn-Ho)))-((Go=Rl*Ho)-$i*Aa-fa*Aa-$i*qa)))+(Lr=Il-Ui))+(Lr-Rc),kt[1]=(el=Ba-((za=Ba+Ui)-(Lr=za-Ba))+(Ui-Lr))-((Ui=el-Go)+(Lr=el-Ui))+(Lr-Go),kt[2]=za-((tl=za+Ui)-(Lr=tl-za))+(Ui-Lr),kt[3]=tl;var To=function(zp,eh){for(var X2=eh[0],ox=1;ox<4;ox++)X2+=eh[ox];return X2}(0,kt),Es=ct*ci;if(To>=Es||-To>=Es||(Hn=Dn-(kl+(Lr=Dn-kl))+(Lr-Bi),Kn=ni-(Ho+(Lr=ni-Ho))+(Lr-Bi),nn=vi-(Rl+(Lr=vi-Rl))+(Lr-Pi),Ci=oa-(jc+(Lr=oa-jc))+(Lr-Pi),Hn===0&&nn===0&&Kn===0&&Ci===0)||(Es=Tt*ci+Ge*Math.abs(To),(To+=kl*Ci+jc*Hn-(Rl*Kn+Ho*nn))>=Es||-To>=Es))return To;Rt[0]=(Il=(fa=Hn-($i=(zn=De*Hn)-(zn-Hn)))*(qa=jc-(Aa=(zn=De*jc)-(zn-jc)))-((Ba=Hn*jc)-$i*Aa-fa*Aa-$i*qa))-((Ui=Il-(Rc=(fa=nn-($i=(zn=De*nn)-(zn-nn)))*(qa=Ho-(Aa=(zn=De*Ho)-(zn-Ho)))-((Go=nn*Ho)-$i*Aa-fa*Aa-$i*qa)))+(Lr=Il-Ui))+(Lr-Rc),Rt[1]=(el=Ba-((za=Ba+Ui)-(Lr=za-Ba))+(Ui-Lr))-((Ui=el-Go)+(Lr=el-Ui))+(Lr-Go),Rt[2]=za-((tl=za+Ui)-(Lr=tl-za))+(Ui-Lr),Rt[3]=tl;var Qd=Je(4,kt,4,Rt,Dt);Rt[0]=(Il=(fa=kl-($i=(zn=De*kl)-(zn-kl)))*(qa=Ci-(Aa=(zn=De*Ci)-(zn-Ci)))-((Ba=kl*Ci)-$i*Aa-fa*Aa-$i*qa))-((Ui=Il-(Rc=(fa=Rl-($i=(zn=De*Rl)-(zn-Rl)))*(qa=Kn-(Aa=(zn=De*Kn)-(zn-Kn)))-((Go=Rl*Kn)-$i*Aa-fa*Aa-$i*qa)))+(Lr=Il-Ui))+(Lr-Rc),Rt[1]=(el=Ba-((za=Ba+Ui)-(Lr=za-Ba))+(Ui-Lr))-((Ui=el-Go)+(Lr=el-Ui))+(Lr-Go),Rt[2]=za-((tl=za+Ui)-(Lr=tl-za))+(Ui-Lr),Rt[3]=tl;var Fp=Je(Qd,Dt,4,Rt,Zt);Rt[0]=(Il=(fa=Hn-($i=(zn=De*Hn)-(zn-Hn)))*(qa=Ci-(Aa=(zn=De*Ci)-(zn-Ci)))-((Ba=Hn*Ci)-$i*Aa-fa*Aa-$i*qa))-((Ui=Il-(Rc=(fa=nn-($i=(zn=De*nn)-(zn-nn)))*(qa=Kn-(Aa=(zn=De*Kn)-(zn-Kn)))-((Go=nn*Kn)-$i*Aa-fa*Aa-$i*qa)))+(Lr=Il-Ui))+(Lr-Rc),Rt[1]=(el=Ba-((za=Ba+Ui)-(Lr=za-Ba))+(Ui-Lr))-((Ui=el-Go)+(Lr=el-Ui))+(Lr-Go),Rt[2]=za-((tl=za+Ui)-(Lr=tl-za))+(Ui-Lr),Rt[3]=tl;var ax=Je(Fp,Zt,4,Rt,$t);return $t[ax-1]}(Ct,ar,Ar,Er,rn,Dr,zr)}(Le[0],Le[1],je[0],je[1],Pt[0],Pt[1]);return rr>0?-1:rr<0?1:0}function bt(Le,je){var Pt=Le.point,rr=je.point;return Pt[0]>rr[0]?1:Pt[0]<rr[0]?-1:Pt[1]!==rr[1]?Pt[1]>rr[1]?1:-1:function(Ct,ar,Ar,Er){return Ct.left!==ar.left?Ct.left?1:-1:Bt(Ar,Ct.otherEvent.point,ar.otherEvent.point)!==0?Ct.isBelow(ar.otherEvent.point)?-1:1:!Ct.isSubject&&ar.isSubject?1:-1}(Le,je,Pt)}function yt(Le,je,Pt){var rr=new we(je,!1,Le,Le.isSubject),Ct=new we(je,!0,Le.otherEvent,Le.isSubject);return Oe(Le.point,Le.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Le),rr.contourId=Ct.contourId=Le.contourId,bt(Ct,Le.otherEvent)>0&&(Le.otherEvent.left=!0,Ct.left=!1),Le.otherEvent.otherEvent=Ct,Le.otherEvent=rr,Pt.push(Ct),Pt.push(rr),Pt}function Ft(Le,je){return Le[0]*je[1]-Le[1]*je[0]}function Gt(Le,je){return Le[0]*je[0]+Le[1]*je[1]}function jt(Le,je,Pt){var rr=function(rn,Dr,wr,Vn,yi){var zr=[Dr[0]-rn[0],Dr[1]-rn[1]],Dn=[Vn[0]-wr[0],Vn[1]-wr[1]];function vi(zn,$i,fa){return[zn[0]+$i*fa[0],zn[1]+$i*fa[1]]}var ni=[wr[0]-rn[0],wr[1]-rn[1]],oa=Ft(zr,Dn),Bi=oa*oa,Pi=Gt(zr,zr);if(Bi>0){var ci=Ft(ni,Dn)/oa;if(ci<0||ci>1)return null;var Hn=Ft(ni,zr)/oa;return Hn<0||Hn>1?null:ci===0||ci===1?[vi(rn,ci,zr)]:Hn===0||Hn===1?[vi(wr,Hn,Dn)]:[vi(rn,ci,zr)]}if((Bi=(oa=Ft(ni,zr))*oa)>0)return null;var nn=Gt(zr,ni)/Pi,Kn=nn+Gt(zr,Dn)/Pi,Ci=Math.min(nn,Kn),Lr=Math.max(nn,Kn);return Ci<=1&&Lr>=0?Ci===1?[vi(rn,Ci>0?Ci:0,zr)]:Lr===0?[vi(rn,Lr<1?Lr:1,zr)]:[vi(rn,Ci>0?Ci:0,zr),vi(rn,Lr<1?Lr:1,zr)]:null}(Le.point,Le.otherEvent.point,je.point,je.otherEvent.point),Ct=rr?rr.length:0;if(Ct===0||Ct===1&&(Oe(Le.point,je.point)||Oe(Le.otherEvent.point,je.otherEvent.point))||Ct===2&&Le.isSubject===je.isSubject)return 0;if(Ct===1)return Oe(Le.point,rr[0])||Oe(Le.otherEvent.point,rr[0])||yt(Le,rr[0],Pt),Oe(je.point,rr[0])||Oe(je.otherEvent.point,rr[0])||yt(je,rr[0],Pt),1;var ar=[],Ar=!1,Er=!1;return Oe(Le.point,je.point)?Ar=!0:bt(Le,je)===1?ar.push(je,Le):ar.push(Le,je),Oe(Le.otherEvent.point,je.otherEvent.point)?Er=!0:bt(Le.otherEvent,je.otherEvent)===1?ar.push(je.otherEvent,Le.otherEvent):ar.push(Le.otherEvent,je.otherEvent),Ar&&Er||Ar?(je.type=M,Le.type=je.inOut===Le.inOut?$:V,Ar&&!Er&&yt(ar[1].otherEvent,ar[0].point,Pt),2):Er?(yt(ar[0],ar[1].point,Pt),3):ar[0]!==ar[3].otherEvent?(yt(ar[0],ar[1].point,Pt),yt(ar[1],ar[2].point,Pt),3):(yt(ar[0],ar[1].point,Pt),yt(ar[3].otherEvent,ar[2].point,Pt),3)}function pr(Le,je){if(Le===je)return 0;if(Bt(Le.point,Le.otherEvent.point,je.point)!==0||Bt(Le.point,Le.otherEvent.point,je.otherEvent.point)!==0)return Oe(Le.point,je.point)?Le.isBelow(je.otherEvent.point)?-1:1:Le.point[0]===je.point[0]?Le.point[1]<je.point[1]?-1:1:bt(Le,je)===1?je.isAbove(Le.point)?-1:1:Le.isBelow(je.point)?-1:1;if(Le.isSubject!==je.isSubject)return Le.isSubject?-1:1;var Pt=Le.point,rr=je.point;return Pt[0]===rr[0]&&Pt[1]===rr[1]?(Pt=Le.otherEvent.point)[0]===(rr=je.otherEvent.point)[0]&&Pt[1]===rr[1]?0:Le.contourId>je.contourId?1:-1:bt(Le,je)===1?1:-1}var vr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ur(Le,je,Pt,rr){var Ct,ar=Le+1,Ar=je[Le].point,Er=je.length;for(ar<Er&&(Ct=je[ar].point);ar<Er&&Ct[0]===Ar[0]&&Ct[1]===Ar[1];){if(!Pt[ar])return ar;++ar<Er&&(Ct=je[ar].point)}for(ar=Le-1;Pt[ar]&&ar>rr;)ar--;return ar}vr.prototype.isExterior=function(){return this.holeOf==null};var ir=or,Kr=or;function or(Le,je){if(!(this instanceof or))return new or(Le,je);if(this.data=Le||[],this.length=this.data.length,this.compare=je||Or,this.length>0)for(var Pt=(this.length>>1)-1;Pt>=0;Pt--)this._down(Pt)}function Or(Le,je){return Le<je?-1:Le>je?1:0}or.prototype={push:function(Le){this.data.push(Le),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Le=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Le}},peek:function(){return this.data[0]},_up:function(Le){for(var je=this.data,Pt=this.compare,rr=je[Le];Le>0;){var Ct=Le-1>>1,ar=je[Ct];if(Pt(rr,ar)>=0)break;je[Le]=ar,Le=Ct}je[Le]=rr},_down:function(Le){for(var je=this.data,Pt=this.compare,rr=this.length>>1,Ct=je[Le];Le<rr;){var ar=1+(Le<<1),Ar=ar+1,Er=je[ar];if(Ar<this.length&&Pt(je[Ar],Er)<0&&(ar=Ar,Er=je[Ar]),Pt(Er,Ct)>=0)break;je[Le]=Er,Le=ar}je[Le]=Ct}},ir.default=Kr;var Jr=Math.max,yn=Math.min,Fn=0;function tn(Le,je,Pt,rr,Ct,ar){var Ar,Er,rn,Dr,wr,Vn;for(Ar=0,Er=Le.length-1;Ar<Er;Ar++)if(Dr=Le[Ar+1],wr=new we(rn=Le[Ar],!1,void 0,je),Vn=new we(Dr,!1,wr,je),wr.otherEvent=Vn,rn[0]!==Dr[0]||rn[1]!==Dr[1]){wr.contourId=Vn.contourId=Pt,ar||(wr.isExteriorRing=!1,Vn.isExteriorRing=!1),bt(wr,Vn)>0?Vn.left=!0:wr.left=!0;var yi=rn[0],zr=rn[1];Ct[0]=yn(Ct[0],yi),Ct[1]=yn(Ct[1],zr),Ct[2]=Jr(Ct[2],yi),Ct[3]=Jr(Ct[3],zr),rr.push(wr),rr.push(Vn)}}var Wn=[];function Gn(Le,je,Pt){typeof Le[0][0][0]=="number"&&(Le=[Le]),typeof je[0][0][0]=="number"&&(je=[je]);var rr=function(zr,Dn,vi){var ni=null;return zr.length*Dn.length==0&&(vi===q?ni=Wn:vi===J?ni=zr:vi!==Y&&vi!==ae||(ni=zr.length===0?Dn:zr)),ni}(Le,je,Pt);if(rr)return rr===Wn?null:rr;var Ct=[1/0,1/0,-1/0,-1/0],ar=[1/0,1/0,-1/0,-1/0],Ar=function(zr,Dn,vi,ni,oa){var Bi,Pi,ci,Hn,nn,Kn,Ci=new ir(null,bt);for(ci=0,Hn=zr.length;ci<Hn;ci++)for(nn=0,Kn=(Bi=zr[ci]).length;nn<Kn;nn++)(Pi=nn===0)&&Fn++,tn(Bi[nn],!0,Fn,Ci,vi,Pi);for(ci=0,Hn=Dn.length;ci<Hn;ci++)for(nn=0,Kn=(Bi=Dn[ci]).length;nn<Kn;nn++)Pi=nn===0,oa===J&&(Pi=!1),Pi&&Fn++,tn(Bi[nn],!1,Fn,Ci,ni,Pi);return Ci}(Le,je,Ct,ar,Pt);if(rr=function(zr,Dn,vi,ni,oa){var Bi=null;return(vi[0]>ni[2]||ni[0]>vi[2]||vi[1]>ni[3]||ni[1]>vi[3])&&(oa===q?Bi=Wn:oa===J?Bi=zr:oa!==Y&&oa!==ae||(Bi=zr.concat(Dn))),Bi}(Le,je,Ct,ar,Pt))return rr===Wn?null:rr;for(var Er=function(zr){var Dn,vi,ni=function(ci){var Hn,nn,Kn,Ci,Lr=[];for(nn=0,Kn=ci.length;nn<Kn;nn++)((Hn=ci[nn]).left&&Hn.inResult||!Hn.left&&Hn.otherEvent.inResult)&&Lr.push(Hn);for(var zn=!1;!zn;)for(zn=!0,nn=0,Kn=Lr.length;nn<Kn;nn++)nn+1<Kn&&bt(Lr[nn],Lr[nn+1])===1&&(Ci=Lr[nn],Lr[nn]=Lr[nn+1],Lr[nn+1]=Ci,zn=!1);for(nn=0,Kn=Lr.length;nn<Kn;nn++)(Hn=Lr[nn]).otherPos=nn;for(nn=0,Kn=Lr.length;nn<Kn;nn++)(Hn=Lr[nn]).left||(Ci=Hn.otherPos,Hn.otherPos=Hn.otherEvent.otherPos,Hn.otherEvent.otherPos=Ci);return Lr}(zr),oa={},Bi=[],Pi=function(){if(!oa[Dn]){var ci=Bi.length,Hn=function(Lr,zn,$i){var fa=new vr;if(Lr.prevInResult!=null){var Aa=Lr.prevInResult,qa=Aa.outputContourId;if(Aa.resultTransition>0){var Ui=zn[qa];if(Ui.holeOf!=null){var za=Ui.holeOf;zn[za].holeIds.push($i),fa.holeOf=za,fa.depth=zn[qa].depth}else zn[qa].holeIds.push($i),fa.holeOf=qa,fa.depth=zn[qa].depth+1}else fa.holeOf=null,fa.depth=zn[qa].depth}else fa.holeOf=null,fa.depth=0;return fa}(ni[Dn],Bi,ci),nn=function(Lr){oa[Lr]=!0,Lr<ni.length&&ni[Lr]&&(ni[Lr].outputContourId=ci)},Kn=Dn,Ci=Dn;for(Hn.points.push(ni[Dn].point);nn(Kn),nn(Kn=ni[Kn].otherPos),Hn.points.push(ni[Kn].point),!((Kn=ur(Kn,ni,oa,Ci))==Ci||Kn>=ni.length)&&ni[Kn];);Bi.push(Hn)}};for(Dn=0,vi=ni.length;Dn<vi;Dn++)Pi();return Bi}(function(zr,Dn,vi,ni,oa,Bi){for(var Pi,ci,Hn,nn=new p(pr),Kn=[],Ci=Math.min(ni[2],oa[2]);zr.length!==0;){var Lr=zr.pop();if(Kn.push(Lr),Bi===q&&Lr.point[0]>Ci||Bi===J&&Lr.point[0]>ni[2])break;if(Lr.left){ci=Pi=nn.insert(Lr),Pi=Pi!==(Hn=nn.minNode())?nn.prev(Pi):null,ci=nn.next(ci);var zn=Pi?Pi.key:null;if(ce(Lr,zn,Bi),ci&&jt(Lr,ci.key,zr)===2&&(ce(Lr,zn,Bi),ce(ci.key,Lr,Bi)),Pi&&jt(Pi.key,Lr,zr)===2){var $i=Pi;ce(zn,($i=$i!==Hn?nn.prev($i):null)?$i.key:null,Bi),ce(Lr,zn,Bi)}}else ci=Pi=nn.find(Lr=Lr.otherEvent),Pi&&ci&&(Pi=Pi!==Hn?nn.prev(Pi):null,ci=nn.next(ci),nn.remove(Lr),ci&&Pi&&jt(Pi.key,ci.key,zr))}return Kn}(Ar,0,0,Ct,ar,Pt)),rn=[],Dr=0;Dr<Er.length;Dr++){var wr=Er[Dr];if(wr.isExterior()){for(var Vn=[wr.points],yi=0;yi<wr.holeIds.length;yi++)Vn.push(Er[wr.holeIds[yi]].points);rn.push(Vn)}}return rn}var Yi={UNION:Y,DIFFERENCE:J,INTERSECTION:q,XOR:ae};c.diff=function(Le,je){return Gn(Le,je,J)},c.intersection=function(Le,je){return Gn(Le,je,q)},c.operations=Yi,c.union=function(Le,je){return Gn(Le,je,Y)},c.xor=function(Le,je){return Gn(Le,je,ae)},Object.defineProperty(c,"__esModule",{value:!0})})(a)}(0,C$.exports)),C$.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function l2(u,a,c,f){const p=[],_=f===0?(b,T,I,M,$,V)=>{b.push(new Nt(V,I+(V-T)/(M-T)*($-I)))}:(b,T,I,M,$,V)=>{b.push(new Nt(T+(V-I)/($-I)*(M-T),V))};for(const b of u){const T=[];for(const I of b){if(I.length<=2)continue;const M=[];for(let q=0;q<I.length-1;q++){const Y=I[q].x,J=I[q].y,ae=I[q+1].x,ce=I[q+1].y,de=f===0?Y:J,we=f===0?ae:ce;de<a?we>a&&_(M,Y,J,ae,ce,a):de>c?we<c&&_(M,Y,J,ae,ce,c):M.push(I[q]),we<a&&de>=a&&_(M,Y,J,ae,ce,a),we>c&&de<=c&&_(M,Y,J,ae,ce,c)}let $=I[I.length-1];const V=f===0?$.x:$.y;V>=a&&V<=c&&M.push($),M.length&&($=M[M.length-1],M[0].x===$.x&&M[0].y===$.y||M.push(M[0]),T.push(M))}T.length&&p.push(T)}return p}function lue(u,a){const c=Rj(u),f=Rj([a]),p=O$.intersection(c,f);return p==null?[]:I$(p)}function cue(u,a){let f=Rj(u,65536);const p=[];for(;a.valid();a.next()){const[_,b]=a.get(),T=_.x*65536,I=_.y*65536,M=b.x*65536,$=b.y*65536,V=M-T,q=$-I,Y=Math.hypot(V,q);if(Y===0)continue;const J=Math.trunc(q/Y*3),ae=-Math.trunc(V/Y*3);p.push([[[T,I],[M,$],[M+J,$+ae],[T+J,I+ae],[T,I]]])}return p.length>0&&(f=O$.diff(f,p)),I$(f,1/65536)}function Rj(u,a=1){return[u.map(c=>c.map(f=>[f.x*a,f.y*a]))]}function I$(u,a=1){return u.map(c=>c.map((f,p)=>{const _=f.map(b=>new Nt(b[0]*a,b[1]*a).round());return p>0&&_.reverse(),_}))}class jj{constructor(a,c){this.layoutVertexArray=new Ds,this.indexArray=new Gi,this.lineIndexArray=new ac,this.triangleSegments=new ea,this.lineSegments=new ea,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.uploaded=!1,c&&(this.elevatedLayoutVertexArray=new Ku)}update(a,c,f,p,_,b,T,I){this.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,I)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Hce.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.lineIndexBuffer=a.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=a.createVertexBuffer(this.elevatedLayoutVertexArray,Kce.members))),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(a,c,f,p,_,b,T){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,c,f,p,_,b,void 0,T)}}class Nj{constructor(a){this.zoom=a.zoom,this.pixelRatio=a.pixelRatio,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=a.lut,this.bufferData=new jj(a,!1),this.elevationBufferData=new jj(a,!0),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=a.sourceLayerIndex,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.hasPattern=Ij("fill",this.layers,this.pixelRatio,c);const _=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:T,id:I,index:M,sourceLayerIndex:$}of a){const V=this.layers[0]._featureFilter.needGeometry,q=mt(T,V);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),q,f))continue;const Y=_?_.evaluate(q,{},f,c.availableImages):void 0,J={id:I,properties:T.properties,type:T.type,sourceLayerIndex:$,index:M,geometry:V?q.geometry:It(T,f,p),patterns:{},sortKey:Y};b.push(J)}_&&b.sort((T,I)=>T.sortKey-I.sortKey);for(const T of b){const{geometry:I,index:M,sourceLayerIndex:$}=T;if(this.hasPattern){const V=kj("fill",this.layers,T,this.zoom,this.pixelRatio,c);this.patternFeatures.push(V)}else this.addFeature(T,I,M,f,{},c.availableImages,c.brightness,c.elevationFeatures);c.featureIndex.insert(a[M].feature,I,M,$,this.index)}}update(a,c,f,p,_,b,T){this.bufferData.update(a,c,f,p,_,b,T,this.worldview),this.elevationBufferData.update(a,c,f,p,_,b,T,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(a,c,f,p,_,b,T,this.worldview)}addFeatures(a,c,f,p,_,b){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,c,f,p,b,a.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(a){this.bufferData.upload(a),this.elevationBufferData.upload(a),this.elevatedStructures&&this.elevatedStructures.upload(a)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(a,c,f,p,_,b=[],T,I){const M=m1(c,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(a,M,p,f,I):this.addGeometry(M,this.bufferData),this.bufferData.populatePaintArrays(a,f,_,b,p,T,this.worldview),this.elevationBufferData.populatePaintArrays(a,f,_,b,p,T,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(a,c,f,p,_){this.elevatedStructures&&(this.elevatedStructures.construct(a),this.elevatedStructures.populatePaintArrays(c,f,p,_,this.worldview))}addElevatedRoadFeature(a,c,f,p,_){const b=new Array,T=Hr.getElevationFeature(a,_);if(!T)return void this.addGeometry(c,this.bufferData);{const M=this.clipPolygonsToTile(c,1);M.length>0&&b.push({polygons:M,elevationFeature:T,elevationTileID:f})}const I={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(a,{},f),featureIndex:p};for(const M of b)if(M.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Cl(M.elevationTileID,this.layers,this.zoom,this.lut));const V=M.elevationFeature.isTunnel();let q=0;a.properties.hasOwnProperty(fr)&&(q=+a.properties[fr]);for(const Y of M.polygons)this.elevatedStructures.addPortalCandidates(M.elevationFeature.id,Y,V,M.elevationFeature,q)}M.elevationFeature.constantHeight==null&&(M.polygons=this.prepareElevatedPolygons(M.polygons,M.elevationFeature,M.elevationTileID));const $=new Ln(f,M.elevationTileID);this.addElevatedGeometry(M.polygons,$,M.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,I)}}addElevatedGeometry(a,c,f,p,_,b){const T={elevation:f,elevationSampler:c,bias:p,index:_,featureInfo:b},[I,M]=this.addGeometry(a,this.elevationBufferData,T);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:I,max:M}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,I),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,M))}addGeometry(a,c,f){let p=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,b=null;f&&(b=f.elevationSampler.constantElevation(f.elevation,f.bias),b!=null&&(p=b,_=b));const T=(I,M,$)=>{if(f!=null)if(M.push(I),b!=null)c.elevatedLayoutVertexArray.emplaceBack(b),$.push(b);else{const V=f.elevationSampler.pointElevation(I,f.elevation,f.bias);c.elevatedLayoutVertexArray.emplaceBack(V),$.push(V),p=Math.min(p,V),_=Math.max(_,V)}};for(const I of a){let M=0;for(const Te of I)M+=Te.length;const $=c.triangleSegments.prepareSegment(M,c.layoutVertexArray,c.indexArray),V=$.vertexLength,q=[],Y=[],J=[],ae=[],ce=[],de=c.layoutVertexArray.length;for(const Te of I){if(Te.length===0)continue;Te!==I[0]&&Y.push(q.length/2);const Oe=c.lineSegments.prepareSegment(Te.length,c.layoutVertexArray,c.lineIndexArray),Ue=Oe.vertexLength;f&&ce.push(c.layoutVertexArray.length-de),T(Te[0],J,ae),c.layoutVertexArray.emplaceBack(Te[0].x,Te[0].y),c.lineIndexArray.emplaceBack(Ue+Te.length-1,Ue),q.push(Te[0].x),q.push(Te[0].y);for(let De=1;De<Te.length;De++)T(Te[De],J,ae),c.layoutVertexArray.emplaceBack(Te[De].x,Te[De].y),c.lineIndexArray.emplaceBack(Ue+De-1,Ue+De),q.push(Te[De].x),q.push(Te[De].y);Oe.vertexLength+=Te.length,Oe.primitiveLength+=Te.length}const we=B_(q,Y);for(let Te=0;Te<we.length;Te+=3)c.indexArray.emplaceBack(V+we[Te],V+we[Te+1],V+we[Te+2]);if(we.length>0&&f&&this.elevationMode==="hd-road-base"){const Te=f.elevation.isTunnel(),Oe=f.elevation.safeArea,Ue=this.elevatedStructures.addVertices(J,ae);this.elevatedStructures.addTriangles(we,Ue,Te);const De=ce.length;if(De>0){for(let Ge=0;Ge<De-1;Ge++)this.elevatedStructures.addRenderableRing(f.index,ce[Ge]+Ue,ce[Ge+1]-ce[Ge],Te,Oe,f.featureInfo);this.elevatedStructures.addRenderableRing(f.index,ce[De-1]+Ue,J.length-ce[De-1],Te,Oe,f.featureInfo)}}$.vertexLength+=M,$.primitiveLength+=we.length/3}return[p,_]}prepareElevatedPolygons(a,c,f){const p=1/qe(f),_=[];for(const b of a){const T=cue(b,new Ni(c,p));_.push(...T)}return _}clipPolygonsToTile(a,c){const f=-c,p=-c,_=Yt+c,b=Yt+c;let T=0;const I=[],M=[];for(;T<a.length;T++){const q=a[T],Y=Rg(q);(Y.min.x>=f&&Y.max.x<=_&&Y.min.y>=p&&Y.max.y<=b?I:M).push(q)}if(I.length===a.length)return a;const $=[new Nt(f,p),new Nt(_,p),new Nt(_,b),new Nt(f,b),new Nt(f,p)],V=I;for(const q of M)V.push(...lue(q,$));return V}}let k$,R$,j$,N$;gr(Nj,"FillBucket",{omit:["layers","patternFeatures"]}),gr(jj,"FillBufferData"),gr(Cl,"ElevatedStructures");class c2{constructor(a,c,f,p){if(this.triangleCount=c.length/3,this.min=new Nt(0,0),this.max=new Nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||a.length===0)return;const[_,b]=[a[0].clone(),a[0].clone()];for(let V=1;V<a.length;++V){const q=a[V];_.x=Math.min(_.x,q.x),_.y=Math.min(_.y,q.y),b.x=Math.max(b.x,q.x),b.y=Math.max(b.y,q.y)}if(p){const V=Math.ceil(Math.max(b.x-_.x,b.y-_.y)/p);f=Math.max(f,V)}if(f===0)return;this.min=_,this.max=b;const T=this.max.sub(this.min);T.x=Math.max(T.x,1),T.y=Math.max(T.y,1);const I=Math.max(T.x,T.y)/f;this.cellsX=Math.max(1,Math.ceil(T.x/I)),this.cellsY=Math.max(1,Math.ceil(T.y/I)),this.xScale=1/I,this.yScale=1/I;const M=[];for(let V=0;V<this.triangleCount;V++){const q=a[c[3*V+0]].sub(this.min),Y=a[c[3*V+1]].sub(this.min),J=a[c[3*V+2]].sub(this.min),ae=Yd(Math.floor(Math.min(q.x,Y.x,J.x)),this.xScale,this.cellsX),ce=Yd(Math.floor(Math.max(q.x,Y.x,J.x)),this.xScale,this.cellsX),de=Yd(Math.floor(Math.min(q.y,Y.y,J.y)),this.yScale,this.cellsY),we=Yd(Math.floor(Math.max(q.y,Y.y,J.y)),this.yScale,this.cellsY),Te=new Nt(0,0),Oe=new Nt(0,0),Ue=new Nt(0,0),De=new Nt(0,0);for(let Ge=de;Ge<=we;++Ge){Te.y=Oe.y=Ge*I,Ue.y=De.y=(Ge+1)*I;for(let Je=ae;Je<=ce;++Je)Te.x=Ue.x=Je*I,Oe.x=De.x=(Je+1)*I,(Ta(q,Y,J,Te,Oe,De)||Ta(q,Y,J,Te,De,Ue))&&M.push({cellIdx:Ge*this.cellsX+Je,triIdx:V})}}if(M.length===0)return;M.sort((V,q)=>V.cellIdx-q.cellIdx||V.triIdx-q.triIdx);let $=0;for(;$<M.length;){const V=M[$].cellIdx,q={start:this.payload.length,len:0};for(;$<M.length&&M[$].cellIdx===V;)++q.len,this.payload.push(M[$++].triIdx);this.cells[V]=q}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(a,c){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>a.x||a.y>this.max.y||this.min.y>a.y)return;const f=Yd(a.x-this.min.x,this.xScale,this.cellsX),p=Yd(a.y-this.min.y,this.yScale,this.cellsY),_=this.cells[p*this.cellsX+f];if(_){this._lazyInitLookup();for(let b=0;b<_.len;b++){const T=this.payload[_.start+b],I=Math.floor(T/8),M=1<<T%8;if(!(this.lookup[I]&M)&&(this.lookup[I]|=M,c.push(T),c.length===this.triangleCount))return}}}query(a,c,f){if(this.triangleCount===0||this.cells.length===0||a.x>this.max.x||this.min.x>c.x||a.y>this.max.y||this.min.y>c.y)return;this._lazyInitLookup();const p=Yd(a.x-this.min.x,this.xScale,this.cellsX),_=Yd(c.x-this.min.x,this.xScale,this.cellsX),b=Yd(a.y-this.min.y,this.yScale,this.cellsY),T=Yd(c.y-this.min.y,this.yScale,this.cellsY);for(let I=b;I<=T;I++)for(let M=p;M<=_;M++){const $=this.cells[I*this.cellsX+M];if($)for(let V=0;V<$.len;V++){const q=this.payload[$.start+V],Y=Math.floor(q/8),J=1<<q%8;if(!(this.lookup[Y]&J)&&(this.lookup[Y]|=J,f.push(q),f.length===this.triangleCount))return}}}}function Yd(u,a,c){return Math.max(0,Math.min(c-1,Math.floor(u*a)))}gr(c2,"TriangleGridIndex");class M${constructor(a){this.zoom=a.zoom,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.footprints=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){for(const f of this.footprints)c.push({footprint:f,id:a})}updateAppearances(a,c,f,p){}populate(a,c,f,p){const _=[];for(const{feature:b,id:T,index:I,sourceLayerIndex:M}of a){const $=this.layers[0]._featureFilter.needGeometry,V=mt(b,$);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),V,f))continue;const q={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:I,geometry:$?V.geometry:It(b,f,p),patterns:{}};_.push(q)}for(const b of _){const{geometry:T,index:I,sourceLayerIndex:M}=b;this.addFeature(b,T,I,f,{},c.availableImages,c.brightness),c.featureIndex.insert(a[I].feature,T,I,M,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(a){}update(a,c,f,p,_,b,T){}destroy(){}addFeature(a,c,f,p,_,b=[],T){for(const I of m1(c,2)){const M=[],$=[],V=[],q=new Nt(1/0,1/0),Y=new Nt(-1/0,-1/0);for(const ce of I)if(ce.length!==0){ce!==I[0]&&V.push($.length/2);for(let de=0;de<ce.length;de++)$.push(ce[de].x),$.push(ce[de].y),M.push(ce[de]),q.x=Math.min(q.x,ce[de].x),q.y=Math.min(q.y,ce[de].y),Y.x=Math.max(Y.x,ce[de].x),Y.y=Math.max(Y.y,ce[de].y)}const J=B_($,V),ae=new c2(M,J,8,256);this.footprints.push({vertices:M,indices:J,grid:ae,min:q,max:Y})}}}gr(M$,"ClipBucket",{omit:["layers"]});const uue=En([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),due=En([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),hue=En([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),fue=En([{name:"a_centroid_pos",components:2,type:"Uint16"}]),pue=En([{name:"a_join_normal_inside",components:3,type:"Int16"}]),mue=En([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),gue=En([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:yue}=uue,g1=Number.MAX_SAFE_INTEGER,D$=g1-1;function L$(u,a,c,f){return u.order<a||u.order===g1||!(u.clipMask&c)||function(p,_){return _.length!==0&&_.find(b=>b===p)===void 0}(f,u.clipScope)}function u2(u,a){return u.x-a.x||u.y-a.y}function F$(u,a){return u2(u.min,a.min)===0&&u2(u.max,a.max)===0}function Mj(u,a){return!(u.min.x>a.max.x||u.max.x<a.min.x||u.min.y>a.max.y||u.max.y<a.min.y)}function d2(u,a){if(u.length!==a.length)return!1;for(let c=0;c<u.length;c++)if(u[c].sourceId!==a[c].sourceId||!F$(u[c],a[c])||u[c].order!==a[c].order||u[c].clipMask!==a[c].clipMask||!Uo(u[c].clipScope,a[c].clipScope))return!1;return!0}function z$(u,a,c){const f=1/Yt,p=1/(1<<c.canonical.z),_=(a.x*f+c.canonical.x)*p+c.wrap,b=(a.y*f+c.canonical.y)*p;return{min:new Nt((u.x*f+c.canonical.x)*p+c.wrap,(u.y*f+c.canonical.y)*p),max:new Nt(_,b)}}function vue(u,a,c){const f=1<<c.canonical.z,p=((a.x-c.wrap)*f-c.canonical.x)*Yt,_=(a.y*f-c.canonical.y)*Yt;return{min:new Nt(((u.x-c.wrap)*f-c.canonical.x)*Yt,(u.y*f-c.canonical.y)*Yt),max:new Nt(p,_)}}function Dj(u,a,c,f,p,_,b){const T=u.indices,I=u.vertices,M=[];for(let $=f;$<f+p;$+=3){const V=a[c[$+0]+_],q=a[c[$+1]+_],Y=a[c[$+2]+_],J=Math.min(V.x,q.x,Y.x),ae=Math.max(V.x,q.x,Y.x),ce=Math.min(V.y,q.y,Y.y),de=Math.max(V.y,q.y,Y.y);M.length=0,u.grid.query(new Nt(J,ce),new Nt(ae,de),M);for(let we=0;we<M.length;we++){const Te=M[we];if(Ta(I[T[3*Te+0]],I[T[3*Te+1]],I[T[3*Te+2]],V,q,Y,b))return!0}}return!1}function B$(u,a,c,f){if(!u||!c)return!1;let p=u.vertices;if(!a.canonical.equals(f.canonical)||a.wrap!==f.wrap){if(c.vertices.length<u.vertices.length)return B$(c,f,u,a);const _=a.canonical,b=f.canonical,T=Math.pow(2,b.z-_.z);p=u.vertices.map(I=>new Nt((I.x+_.x*Yt)*T-b.x*Yt,(I.y+_.y*Yt)*T-b.y*Yt))}return Dj(c,p,u.indices,0,u.indices.length,0,0)}function $$(u,a,c,f){const p=Math.pow(2,f.z-c.z);return new Nt((u+c.x*Yt)*p-f.x*Yt,(a+c.y*Yt)*p-f.y*Yt)}function Lj(u,a){const c=[];a.grid.queryPoint(u,c);const f=a.indices,p=a.vertices;for(let _=0;_<c.length;_++){const b=c[_];if(po([p[f[3*b+0]],p[f[3*b+1]],p[f[3*b+2]]],u))return!0}return!1}const Fj=[new Nt(0,0),new Nt(Yt,0),new Nt(Yt,Yt),new Nt(0,Yt)];function U$(u,a){const c=[];let f=[];if(!a||u.length<2)return[u];if(u.length===2)return ba(u[0],u[1],Fj)?[u]:[];for(let p=0;p<u.length+2;p++){const _=u[p%u.length],b=u[(p+1)%u.length],T=ba(p===0?u[u.length-1]:u[(p-1)%u.length],_,Fj),I=ba(_,b,Fj),M=T||I;M&&f.push(_),M&&I||f.length>0&&(f.length>1&&c.push(f),f=[])}return f.length>1&&c.push(f),c}const zj=Lt.types,_ue=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],xue=["fill-extrusion-flood-light-ground-radius"],bue=Math.pow(2,13),wue=Math.pow(2,15)-1,V$=new Nt(0,1),Np=2147483648,q$=7,W$=450;function y1(u,a,c,f,p,_,b,T){u.emplaceBack((a<<1)+b,(c<<1)+_,(Math.floor(f*bue)<<1)+p,Math.round(T))}function v1(u,a,c){u.emplaceBack(a.x*Yt,a.y*Yt,c?1:0)}function h2(u,a,c,f,p,_){u.emplaceBack(a.x,a.y,(c.x<<1)+f,(c.y<<1)+p,_)}function _1(u,a,c){u.emplaceBack(a.x,a.y,a.z,c[0]*16384,c[1]*16384,c[2]*16384)}class G${constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class H${constructor(){this.centroidXY=new Nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class K${constructor(){this.acc=new Nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(a,c){a.min.x===Number.MAX_VALUE&&(a.min.x=a.max.x=c.x,a.min.y=a.max.y=c.y)}appendEdge(a,c,f){this.accCount++,this.acc._add(c);let p=!!this.borders;c.x<a.min.x?(a.min.x=c.x,p=!0):c.x>a.max.x&&(a.max.x=c.x,p=!0),c.y<a.min.y?(a.min.y=c.y,p=!0):c.y>a.max.y&&(a.max.y=c.y,p=!0),((c.x===0||c.x===Yt)&&c.x===f.x)!=((c.y===0||c.y===Yt)&&c.y===f.y)&&this.processBorderOverlap(c,f),p&&this.checkBorderIntersection(c,f)}checkBorderIntersection(a,c){c.x<0!=a.x<0&&this.addBorderIntersection(0,$r(c.y,a.y,(0-c.x)/(a.x-c.x))),c.x>Yt!=a.x>Yt&&this.addBorderIntersection(1,$r(c.y,a.y,(Yt-c.x)/(a.x-c.x))),c.y<0!=a.y<0&&this.addBorderIntersection(2,$r(c.x,a.x,(0-c.y)/(a.y-c.y))),c.y>Yt!=a.y>Yt&&this.addBorderIntersection(3,$r(c.x,a.x,(Yt-c.y)/(a.y-c.y)))}addBorderIntersection(a,c){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[a];c<f[0]&&(f[0]=c),c>f[1]&&(f[1]=c)}processBorderOverlap(a,c){if(a.x===c.x){if(a.y===c.y)return;const f=a.x===0?0:1;this.addBorderIntersection(f,c.y),this.addBorderIntersection(f,a.y)}else{const f=a.y===0?2:3;this.addBorderIntersection(f,c.x),this.addBorderIntersection(f,a.x)}}centroid(){return this.accCount===0?new Nt(0,0):new Nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((a,c)=>a+ +(c[0]!==Number.MAX_VALUE),0):0}}function Z$(u,a){const c=u.add(a)._unit(),f=ve(u.x*c.x+u.y*c.y,-1,1);var p,_,b;return p=Math.acos(f),Math.min(4,Math.max(-4,Math.tan(p)))/4*wue*((_=u).x*(b=a).y-_.y*b.x<0?-1:1)}const Sue=[u=>u.x<0,u=>u.x>Yt,u=>u.y<0,u=>u.y>Yt];function Eue(u,a,c,f){const p=[4];if(f===0)return p;c._mult(f);const _=u.sub(c),b=a.sub(c),T=[u,a,_,b];for(let I=0;I<4;I++)for(const M of T)if(Sue[I](M)){p.push(I);break}return p}class Bj{constructor(a){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new T_,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut},c=>xue.includes(c)),this._segments=new ea,this.hiddenByLandmarkVertexArray=new R_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ea}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(a,c,f,p=!1){const _=a.length;if(_>2){let b=Math.max(0,this._segments.get().length-1);const T=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[b].length);let I;b!==this._segments.get().length-1&&(b++,this._segmentToGroundQuads[b]=[],this._segmentToRegionTriCounts[b]=[0,0,0,0,0]);{const M=a[0],$=a[1];I=Z$(M.sub(a[_-1])._perp()._unit(),$.sub(M)._perp()._unit())}for(let M=0;M<_;M++){const $=M===_-1?0:M+1,V=a[M],q=a[$],Y=a[$===_-1?0:$+1],J=q.sub(V)._perp()._unit(),ae=Z$(J,Y.sub(q)._perp()._unit()),ce=I,de=ae;if($j(V,q,c)||p&&J$(V,c)&&J$(q,c)){I=ae;continue}const we=T.vertexLength;h2(this.vertexArray,V,q,1,1,ce),h2(this.vertexArray,V,q,1,0,ce),h2(this.vertexArray,V,q,0,1,de),h2(this.vertexArray,V,q,0,0,de),T.vertexLength+=4;const Te=Eue(V,q,J,f);for(const Oe of Te)this._segmentToGroundQuads[b].push({id:we,region:Oe}),this._segmentToRegionTriCounts[b][Oe]+=2,T.primitiveLength+=2;I=ae}}}prepareBorderSegments(){if(!this.hasData())return;const a=this._segments.get(),c=a.length;for(let f=0;f<c;f++)this._segmentToGroundQuads[f].sort((p,_)=>p.region-_.region);for(let f=0;f<c;f++){const p=this._segmentToGroundQuads[f],_=a[f],b=this._segmentToRegionTriCounts[f];b.reduce((I,M)=>I+M,0);let T=0;for(let I=0;I<=4;I++){const M=b[I];if(M!==0){let $=this.regionSegments[I];$||($=this.regionSegments[I]=new ea);const V={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+T,vertexLength:_.vertexLength,primitiveLength:M};$.get().push(V)}T+=M}for(let I=0;I<p.length;I++){const M=p[I].id;this.indexArray.emplaceBack(M,M+1,M+3),this.indexArray.emplaceBack(M,M+3,M+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(a,c,f,p,_,b,T){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,a,c,f,p,_,b,void 0,T)}upload(a){this.hasData()&&(this.vertexBuffer=a.createVertexBuffer(this.vertexArray,due.members),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=a.createVertexBuffer(this.groundRadiusArray,hue.members)))}uploadPaintProperties(a){this.hasData()&&this.programConfigurations.upload(a)}update(a,c,f,p,_,b,T,I){this.hasData()&&this.programConfigurations.updatePaintArrays(a,c,f,p,_,b,T,I)}updateHiddenByLandmark(a){this.updateHiddenByLandmarkRange(a.groundVertexArrayOffset,a.groundVertexCount,!!(a.flags&Np))}updateHiddenByLandmarkRange(a,c,f){if(!this.hasData())return;const p=c+a;if(c!==0){for(let _=a;_<p;++_)this.hiddenByLandmarkVertexArray.emplace(_,f?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(a){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=a.createVertexBuffer(this.hiddenByLandmarkVertexArray,mue.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let a=0;a<=4;a++){const c=this.regionSegments[a];c&&c.destroy()}}}}class f2{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaling=a.overscaling,this.layers=a.layers,this.pixelRatio=a.pixelRatio,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=a.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gi,this.footprintVertices=new Ds,this.footprintSegments=[],this.layoutVertexArray=new wp,this.centroidVertexArray=new KA,this.wallVertexArray=new XA,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut},c=>_ue.includes(c)),this.segments=new ea,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.groundEffect=new Bj(a),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.features=[],this.hasPattern=Ij("fill-extrusion",this.layers,this.pixelRatio,c),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=qe(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:b,index:T,sourceLayerIndex:I}of a){const M=this.layers[0]._featureFilter.needGeometry,$=mt(_,M);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),$,f))continue;const V={id:b,sourceLayerIndex:I,index:T,geometry:M?$.geometry:It(_,f,p),properties:_.properties,type:_.type,patterns:{}},q=this.layoutVertexArray.length,Y=zj[V.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:kj("fill-extrusion",this.layers,V,this.zoom,this.pixelRatio,c)});else if(this.wallMode)for(const J of V.geometry)for(const ae of U$(J,Y))this.addFeature(_.id,V,[ae],T,f,{},c.availableImages,p,c.brightness);else this.addFeature(_.id,V,V.geometry,T,f,{},c.availableImages,p,c.brightness);c.featureIndex.insert(_,V.geometry,T,I,this.index,q)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(a,c,f,p,_,b){for(const{featureId:T,feature:I}of this.features){const M=zj[I.type]==="Polygon",{geometry:$}=I;if(this.wallMode)for(const V of $)for(const q of U$(V,M))this.addFeature(T,I,[q],I.index,c,f,p,_,b);else this.addFeature(T,I,$,I.index,c,f,p,_,b)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(a,c,f,p,_,b,T){this.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,this.worldview),this.groundEffect.update(a,c,_,f,p,b,T,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,yue),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.wallVertexBuffer=a.createVertexBuffer(this.wallVertexArray,pue.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=a.createVertexBuffer(this.layoutVertexExtArray,gue.members,!0)),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}uploadCentroid(a){this.groundEffect.uploadHiddenByLandmark(a),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,fue.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,c,f,p,_,b,T,I,M){const $=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(c,{})/this.tileToMeter,V=[new Nt(0,0),new Nt(Yt,Yt)],q=I.projection,Y=q.name==="globe",J=this.wallMode||zj[c.type]==="Polygon",ae=new K$;ae.centroidDataIndex=this.centroidData.length;const ce=new H$;ce.buildingId=a,c.properties&&c.properties.hasOwnProperty("building_id")&&(ce.buildingId=c.properties.building_id);const de=this.layers[0].paint.get("fill-extrusion-base").evaluate(c,{},_)<=0,we=this.layers[0].paint.get("fill-extrusion-height").evaluate(c,{},_);let Te;if(ce.height=we,ce.vertexArrayOffset=this.layoutVertexArray.length,ce.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new P_),this.wallMode){if(Y)return void kr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(f.length!==1)return;Te=function(ct){const Tt=ct[0].x===ct[ct.length-1].x&&ct[0].y===ct[ct.length-1].y;(function(ur){let ir=0;const Kr=ur.length;for(let or=0;or<Kr;or++)ir+=(ur[(or+1)%Kr].x-ur[or].x)*(ur[(or+1)%Kr].y+ur[or].y);return ir>=0})(ct)||(ct=ct.reverse());const Dt={geometry:[],joinNormals:[],indices:[]},Zt=[],$t=[],Rt=[];let Bt=ct.length;for(;Bt>=2&&ct[Bt-1].equals(ct[Bt-2]);)Bt--;if(Bt<(Tt?3:2))return Dt;let bt,yt,Ft,Gt,jt,pr=0;for(;pr<Bt-1&&ct[pr].equals(ct[pr+1]);)pr++;Tt&&(bt=ct[Bt-2],jt=ct[pr].sub(bt)._unit()._perp());for(let ur=pr;ur<Bt;ur++){if(Ft=ur===Bt-1?Tt?ct[pr+1]:void 0:ct[ur+1],Ft&&ct[ur].equals(Ft))continue;jt&&(Gt=jt),bt&&(yt=bt),bt=ct[ur],jt=Ft?Ft.sub(bt)._unit()._perp():Gt,Gt=Gt||jt;let ir=Gt.add(jt);ir.x===0&&ir.y===0||ir._unit();const Kr=ir.x*jt.x+ir.y*jt.y,or=Kr!==0?1/Kr:1/0,Or=Gt.x*jt.y-Gt.y*jt.x>0;let Jr="miter";const yn=2;Jr==="miter"&&or>yn&&(Jr="bevel"),Jr==="bevel"&&(or>100&&(Jr="flipbevel"),or<yn&&(Jr="miter"));const Fn=(tn,Wn,Gn,Yi)=>{const Le=new Nt(tn.x,tn.y),je=new Nt(tn.x,tn.y);Le.x+=Wn.x*Yi,Le.y+=Wn.y*Yi,je.x-=Wn.x*Math.max(Gn,1),je.y-=Wn.y*Math.max(Gn,1),Rt.push(Wn),Zt.push(Le),$t.push(je)};if(Jr==="miter")ir._mult(or),Fn(bt,ir,0,0);else if(Jr==="flipbevel")ir=jt.mult(-1),Fn(bt,ir,0,0),Fn(bt,ir.mult(-1),0,0);else{const tn=-Math.sqrt(or*or-1),Wn=Or?tn:0,Gn=Or?0:tn;yt&&Fn(bt,Gt,Wn,Gn),Ft&&Fn(bt,jt,Wn,Gn)}}Dt.geometry=[...Zt,...$t.reverse(),Zt[0]],Dt.joinNormals=[...Rt,...Rt.reverse(),Rt[Rt.length-1]];const vr=Dt.geometry.length-1;for(let ur=0;ur<vr/2;ur++)if(ur+1<vr/2){let ir=ur,Kr=ur+1,or=vr-1-ur,Or=vr-2-ur;ir=ir===0?vr-1:ir-1,Kr=Kr===0?vr-1:Kr-1,or=or===0?vr-1:or-1,Or=Or===0?vr-1:Or-1,Dt.indices.push(or),Dt.indices.push(Kr),Dt.indices.push(ir),Dt.indices.push(or),Dt.indices.push(Or),Dt.indices.push(Kr)}return Dt}(f[0]),f=[Te.geometry]}const Oe=(ct,Tt)=>ct<(Tt.length-1)/2||ct===Tt.length-1,Ue=this.wallMode?[f]:m1(f,500);for(let ct=Ue.length-1;ct>=0;ct--){const Tt=Ue[ct];(Tt.length===0||(De=Tt[0]).every(kt=>kt.x<=0)||De.every(kt=>kt.x>=Yt)||De.every(kt=>kt.y<=0)||De.every(kt=>kt.y>=Yt))&&Ue.splice(ct,1)}var De;let Ge;if(Y)Ge=rU(Ue,V,_);else{Ge=[];for(const ct of Ue)Ge.push({polygon:ct,bounds:V})}const Je=J?this.edgeRadius:0,tt=Je>0&&this.zoom<17,Et=(ct,Tt)=>{if(ct.length===0)return!1;const kt=ct[ct.length-1];return Tt.x===kt.x&&Tt.y===kt.y};for(const{polygon:ct,bounds:Tt}of Ge){let kt=0,Dt=0;for(const Bt of ct)J&&!Bt[0].equals(Bt[Bt.length-1])&&Bt.push(Bt[0]),Dt+=J?Bt.length-1:Bt.length;const Zt=this.segments.prepareSegment((J?5:4)*Dt,this.layoutVertexArray,this.indexArray);ce.footprintSegIdx<0&&(ce.footprintSegIdx=this.footprintSegments.length),ce.polygonSegIdx<0&&(ce.polygonSegIdx=this.polygonSegments.length);const $t={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Rt=new G$;if(Rt.vertexOffset=this.footprintVertices.length,Rt.indexOffset=3*this.footprintIndices.length,Rt.ringIndices=[],J){const Bt=[],bt=[];kt=Zt.vertexLength;for(let Ft=0;Ft<ct.length;Ft++){const Gt=ct[Ft];Gt.length&&Ft!==0&&bt.push(Bt.length/2);const jt=[];let pr,vr;pr=Gt[1].sub(Gt[0])._perp()._unit(),Rt.ringIndices.push(Gt.length-1);for(let ur=1;ur<Gt.length;ur++){const ir=Gt[ur],Kr=Gt[ur===Gt.length-1?1:ur+1],or=ir.clone();if(Je){vr=Kr.sub(ir)._perp()._unit();const Or=pr.add(vr)._unit(),Jr=Je*Math.min(4,1/(pr.x*Or.x+pr.y*Or.y));or.x+=Jr*Or.x,or.y+=Jr*Or.y,or.x=Math.round(or.x),or.y=Math.round(or.y),pr=vr}if(!de||Je!==0&&!tt||Et(jt,or)||jt.push(or),y1(this.layoutVertexArray,or.x,or.y,0,0,1,1,0),this.wallMode){const Or=Oe(ur,Gt);v1(this.wallVertexArray,Te.joinNormals[ur],!Or)}Zt.vertexLength++,this.footprintVertices.emplaceBack(ir.x,ir.y),Bt.push(ir.x,ir.y),Y&&_1(this.layoutVertexExtArray,q.projectTilePoint(or.x,or.y,_),q.upVector(_,or.x,or.y))}de&&(Je===0||tt)&&(jt.length!==0&&Et(jt,jt[0])&&jt.pop(),this.groundEffect.addData(jt,Tt,$))}const yt=this.wallMode?Te.indices:B_(Bt,bt);for(let Ft=0;Ft<yt.length;Ft+=3)this.footprintIndices.emplaceBack(Rt.vertexOffset+yt[Ft+0],Rt.vertexOffset+yt[Ft+1],Rt.vertexOffset+yt[Ft+2]),this.indexArray.emplaceBack(kt+yt[Ft],kt+yt[Ft+2],kt+yt[Ft+1]),Zt.primitiveLength++;Rt.indexCount+=yt.length,Rt.vertexCount+=this.footprintVertices.length-Rt.vertexOffset}for(let Bt=0;Bt<ct.length;Bt++){const bt=ct[Bt];ae.startRing(ce,bt[0]);let yt=bt.length>4&&Q$(bt[bt.length-2],bt[0],bt[1]),Ft=Je?Tue(bt[bt.length-2],bt[0],bt[1],Je):0;const Gt=[];let jt,pr,vr;pr=bt[1].sub(bt[0])._perp()._unit();let ur=!0;for(let ir=1,Kr=0;ir<bt.length;ir++){let or=bt[ir-1],Or=bt[ir];const Jr=bt[ir===bt.length-1?1:ir+1];if(ae.appendEdge(ce,Or,or),$j(Or,or,Tt)){Je&&(pr=Jr.sub(Or)._perp()._unit(),ur=!ur);continue}const yn=Or.sub(or)._perp(),Fn=yn.x/(Math.abs(yn.x)+Math.abs(yn.y)),tn=yn.y>0?1:0,Wn=or.dist(Or);if(Kr+Wn>32768&&(Kr=0),Je){vr=Jr.sub(Or)._perp()._unit();let je=Y$(or,Or,Jr,X$(pr,vr),Je);isNaN(je)&&(je=0);const Pt=Or.sub(or)._unit();or=or.add(Pt.mult(Ft))._round(),Or=Or.add(Pt.mult(-je))._round(),Ft=je,pr=vr,de&&this.zoom>=17&&(Et(Gt,or)||Gt.push(or),Et(Gt,Or)||Gt.push(Or))}const Gn=Zt.vertexLength,Yi=bt.length>4&&Q$(or,Or,Jr);let Le=eU(Kr,yt,ur);if(y1(this.layoutVertexArray,or.x,or.y,Fn,tn,0,0,Le),y1(this.layoutVertexArray,or.x,or.y,Fn,tn,0,1,Le),this.wallMode){const je=Oe(ir-1,bt),Pt=Te.joinNormals[ir-1];v1(this.wallVertexArray,Pt,je),v1(this.wallVertexArray,Pt,je)}if(Kr+=Wn,Le=eU(Kr,Yi,!ur),yt=Yi,y1(this.layoutVertexArray,Or.x,Or.y,Fn,tn,0,0,Le),y1(this.layoutVertexArray,Or.x,Or.y,Fn,tn,0,1,Le),this.wallMode){const je=Oe(ir,bt),Pt=Te.joinNormals[ir];v1(this.wallVertexArray,Pt,je),v1(this.wallVertexArray,Pt,je)}if(Zt.vertexLength+=4,this.indexArray.emplaceBack(Gn+0,Gn+1,Gn+2),this.indexArray.emplaceBack(Gn+1,Gn+3,Gn+2),Zt.primitiveLength+=2,Je){const je=kt+(ir===1?bt.length-2:ir-2),Pt=ir===1?kt:je+1;if(this.indexArray.emplaceBack(Gn+1,je,Gn+3),this.indexArray.emplaceBack(je,Pt,Gn+3),Zt.primitiveLength+=2,jt===void 0&&(jt=Gn),!$j(Jr,bt[ir],Tt)){const rr=ir===bt.length-1?jt:Zt.vertexLength;this.indexArray.emplaceBack(Gn+2,Gn+3,rr),this.indexArray.emplaceBack(Gn+3,rr+1,rr),this.indexArray.emplaceBack(Gn+3,Pt,rr+1),Zt.primitiveLength+=3}ur=!ur}if(Y){const je=this.layoutVertexExtArray,Pt=q.projectTilePoint(or.x,or.y,_),rr=q.projectTilePoint(Or.x,Or.y,_),Ct=q.upVector(_,or.x,or.y),ar=q.upVector(_,Or.x,Or.y);_1(je,Pt,Ct),_1(je,Pt,Ct),_1(je,rr,ar),_1(je,rr,ar)}}J&&(kt+=bt.length-1),de&&Je&&this.zoom>=17&&(Gt.length!==0&&Et(Gt,Gt[0])&&Gt.pop(),this.groundEffect.addData(Gt,Tt,$,Je>0))}this.footprintSegments.push(Rt),$t.triangleCount=this.indexArray.length-$t.triangleArrayOffset,this.polygonSegments.push($t),++ce.footprintSegLen,++ce.polygonSegLen}if(ce.vertexCount=this.layoutVertexArray.length-ce.vertexArrayOffset,ce.groundVertexCount=this.groundEffect.vertexArray.length-ce.groundVertexArrayOffset,ce.vertexCount!==0){if(ce.centroidXY=ae.borders?V$:this.encodeCentroid(ae,ce),this.centroidData.push(ce),ae.borders){this.featuresOnBorder.push(ae);const ct=this.featuresOnBorder.length-1;for(let Tt=0;Tt<ae.borders.length;Tt++)ae.borders[Tt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Tt].push(ct)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,c,p,b,T,_,M,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(c,p,b,T,_,M,this.worldview),this.maxHeight=Math.max(this.maxHeight,we)}}sortBorders(){for(let a=0;a<this.borderFeatureIndices.length;a++)this.borderFeatureIndices[a].sort((c,f)=>this.featuresOnBorder[c].borders[a][0]-this.featuresOnBorder[f].borders[a][0])}splitToSubtiles(){const a=[];for(let T=0;T<this.centroidData.length;T++){const I=this.centroidData[T],M=+(I.min.y+I.max.y>Yt),$=2*M+(+(I.min.x+I.max.x>Yt)^M);for(let V=0;V<I.polygonSegLen;V++){const q=I.polygonSegIdx+V;a.push({centroidIdx:T,subtile:$,polygonSegmentIdx:q,triangleSegmentIdx:this.polygonSegments[q].triangleSegIdx})}}const c=new Gi;a.sort((T,I)=>T.triangleSegmentIdx===I.triangleSegmentIdx?T.subtile-I.subtile:T.triangleSegmentIdx-I.triangleSegmentIdx);let f=0,p=0,_=0;for(const T of a){if(T.triangleSegmentIdx!==f)break;_++}const b=a.length;for(;p!==a.length;){f=a[p].triangleSegmentIdx;let T=0,I=p,M=p;for(let $=I;$<_&&a[$].subtile===T;$++)M++;for(;I!==_;){const $=a[I];T=$.subtile;const V=this.centroidData[$.centroidIdx].min.clone(),q=this.centroidData[$.centroidIdx].max.clone(),Y={vertexOffset:this.segments.segments[f].vertexOffset,primitiveOffset:c.length,vertexLength:this.segments.segments[f].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let J=I;J<M;J++){const ae=a[J],ce=this.polygonSegments[ae.polygonSegmentIdx],de=this.centroidData[ae.centroidIdx].min,we=this.centroidData[ae.centroidIdx].max,Te=this.indexArray.uint16;for(let Oe=ce.triangleArrayOffset;Oe<ce.triangleArrayOffset+ce.triangleCount;Oe++)c.emplaceBack(Te[3*Oe],Te[3*Oe+1],Te[3*Oe+2]);Y.primitiveLength+=ce.triangleCount,V.x=Math.min(V.x,de.x),V.y=Math.min(V.y,de.y),q.x=Math.max(q.x,we.x),q.y=Math.max(q.y,we.y)}Y.primitiveLength>0&&this.triangleSubSegments.push({segment:Y,min:V,max:q}),I=M;for(let J=I;J<_&&a[J].subtile===a[I].subtile;J++)M++}p=_;for(let $=p;$<b&&a[$].triangleSegmentIdx===a[p].triangleSegmentIdx;$++)_++}c._trim(),this.indexArray=c}getVisibleSegments(a,c,f){const p=new ea;if(this.wallMode){for(const ae of this.triangleSubSegments)p.segments.push(ae.segment);return p}let _=0,b=0;const T=1<<a.canonical.z;if(c){const ae=c.getMinMaxForTile(a);ae&&(_=ae.min,b=ae.max)}b+=this.maxHeight;const I=a.toUnwrapped();let M;const $=[I.canonical.x/T+I.wrap,I.canonical.y/T],V=[(I.canonical.x+1)/T+I.wrap,(I.canonical.y+1)/T],q=(ae,ce,de)=>[ae[0]*(1-de[0])+ce[0]*de[0],ae[1]*(1-de[1])+ce[1]*de[1]],Y=[],J=[];for(const ae of this.triangleSubSegments){Y[0]=ae.min.x/Yt,Y[1]=ae.min.y/Yt,J[0]=ae.max.x/Yt,J[1]=ae.max.y/Yt;const ce=q($,V,Y),de=q($,V,J);if(new mn([ce[0],ce[1],_],[de[0],de[1],b]).intersectsPrecise(f)===0){M&&(p.segments.push(M),M=void 0);continue}const we=ae.segment;M&&M.vertexOffset!==we.vertexOffset&&(p.segments.push(M),M=void 0),M?(M.vertexLength+=we.vertexLength,M.primitiveLength+=we.primitiveLength):M={vertexOffset:we.vertexOffset,primitiveLength:we.primitiveLength,vertexLength:we.vertexLength,primitiveOffset:we.primitiveOffset,sortKey:void 0,vaos:{}}}return M&&p.segments.push(M),p}encodeCentroid(a,c){const f=a.centroid(),p=c.span(),_=Math.min(7,Math.round(p.x*this.tileToMeter/10)),b=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new Nt(ve(f.x,1,Yt-1)<<3|_,ve(f.y,1,Yt-1)<<3|b)}encodeBorderCentroid(a){if(!a.borders)return new Nt(0,0);const c=a.borders,f=Number.MAX_VALUE;if(c[0][0]!==f||c[1][0]!==f){const p=c[0][0]!==f?0:1;return new Nt(6|(c[0][0]!==f?0:65528),(c[p][0]+c[p][1])/2<<3|6)}{const p=c[2][0]!==f?2:3;return new Nt((c[p][0]+c[p][1])/2<<3|6,6|(c[2][0]!==f?0:65528))}}showCentroid(a){const c=this.centroidData[a.centroidDataIndex];c.flags&=2147483647,c.centroidXY.x=0,c.centroidXY.y=0,this.writeCentroidToBuffer(c)}writeCentroidToBuffer(a){this.groundEffect.updateHiddenByLandmark(a);const c=a.vertexArrayOffset,f=a.vertexCount+a.vertexArrayOffset,p=a.flags&Np?V$:a.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(c);if(this.centroidVertexArray.geta_centroid_pos1(c)!==p.y||_!==p.x){for(let b=c;b<f;++b)this.centroidVertexArray.emplace(b,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of this.centroidData)this.writeCentroidToBuffer(a)}updateReplacement(a,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());if(d2(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const b of this.centroidData)b.flags&=2147483647;const _=[];for(const b of this.activeReplacements){if(b.order<f)continue;const T=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));if(b.footprint.buildingId){const I=b.footprint.buildingId;for(const M of this.centroidData)M.buildingId===I&&(M.flags|=Np)}else for(const I of this.centroidData)if(!(I.flags&Np||b.min.x>I.max.x||I.min.x>b.max.x||b.min.y>I.max.y||I.min.y>b.max.y))for(let M=0;M<I.footprintSegLen;M++){const $=this.footprintSegments[I.footprintSegIdx+M];if(_.length=0,Aue(this.footprintVertices,$.vertexOffset,$.vertexCount,b.footprintTileId.canonical,a.canonical,_),Dj(b.footprint,_,this.footprintIndices.uint16,$.indexOffset,$.indexCount,-$.vertexOffset,-T)){I.flags|=Np;break}}}for(const b of this.centroidData)this.writeCentroidToBuffer(b);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(a,c,f){let p=!1;for(let _=0;_<f.footprintSegLen;_++){const b=this.footprintSegments[f.footprintSegIdx+_];let T=0;for(const I of b.ringIndices){for(let M=T,$=I+T-1;M<I+T;$=M++){const V=this.footprintVertices.int16[2*(M+b.vertexOffset)+0],q=this.footprintVertices.int16[2*(M+b.vertexOffset)+1],Y=this.footprintVertices.int16[2*($+b.vertexOffset)+1];q>c!=Y>c&&a<(this.footprintVertices.int16[2*($+b.vertexOffset)+0]-V)*(c-q)/(Y-q)+V&&(p=!p)}T=I}}return p}getHeightAtTileCoord(a,c){let f=Number.NEGATIVE_INFINITY,p=!0;const _=4*(a+Yt)*Yt+(c+Yt);if(this.partLookup.hasOwnProperty(_)){const b=this.partLookup[_];return b?{height:b.height,hidden:!!(b.flags&Np)}:void 0}for(const b of this.centroidData)a>b.max.x||b.min.x>a||c>b.max.y||b.min.y>c||b.height<=f||this.footprintContainsPoint(a,c,b)&&(f=b.height,this.partLookup[_]=b,p=!!(b.flags&Np));if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:p};this.partLookup[_]=void 0}}function X$(u,a){const c=u.add(a)._unit();return u.x*c.x+u.y*c.y}function Tue(u,a,c,f){const p=a.sub(u)._perp()._unit(),_=c.sub(a)._perp()._unit();return Y$(u,a,c,X$(p,_),f)}function Y$(u,a,c,f,p){const _=Math.sqrt(1-f*f);return Math.min(u.dist(a)/3,a.dist(c)/3,p*_/f)}function $j(u,a,c){return u.x<c[0].x&&a.x<c[0].x||u.x>c[1].x&&a.x>c[1].x||u.y<c[0].y&&a.y<c[0].y||u.y>c[1].y&&a.y>c[1].y}function J$(u,a){return u.x<a[0].x||u.x>a[1].x||u.y<a[0].y||u.y>a[1].y}function Q$(u,a,c){if(u.x<0||u.x>=Yt||a.x<0||a.x>=Yt||c.x<0||c.x>=Yt)return!1;const f=c.sub(a),p=f.perp(),_=u.sub(a);return(f.x*_.x+f.y*_.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(_.x*_.x+_.y*_.y))>-.866&&p.x*_.x+p.y*_.y<0}function eU(u,a,c){const f=a?2|u:-3&u;return c?1|f:-2&f}function tU(){const u=Math.PI/32,a=Math.tan(u),c=W;return c*Math.sqrt(1+2*a*a)-c}function rU(u,a,c){const f=1<<c.z,p=Ie(c.x/f),_=Ie((c.x+1)/f),b=Ae(c.y/f),T=Ae((c.y+1)/f);return function(I,M,$,V,q=0,Y){const J=[];if(!I.length||!$||!V)return J;const ae=(De,Ge)=>{for(const Je of De)J.push({polygon:Je,bounds:Ge})},ce=Math.ceil(Math.log2($)),de=Math.ceil(Math.log2(V)),we=ce-de,Te=[];for(let De=0;De<Math.abs(we);De++)Te.push(we>0?0:1);for(let De=0;De<Math.min(ce,de);De++)Te.push(0),Te.push(1);let Oe=I;if(Oe=l2(Oe,M[0].y-q,M[1].y+q,1),Oe=l2(Oe,M[0].x-q,M[1].x+q,0),!Oe.length)return J;const Ue=[];for(Te.length?Ue.push({polygons:Oe,bounds:M,depth:0}):ae(Oe,M);Ue.length;){const De=Ue.pop(),Ge=De.depth,Je=Te[Ge],tt=De.bounds[0],Et=De.bounds[1],ct=Je===0?tt.x:tt.y,Tt=Je===0?Et.x:Et.y,kt=Y?Y(Je,ct,Tt):.5*(ct+Tt),Dt=l2(De.polygons,ct-q,kt+q,Je),Zt=l2(De.polygons,kt-q,Tt+q,Je);if(Dt.length){const $t=[tt,new Nt(Je===0?kt:Et.x,Je===1?kt:Et.y)];Te.length>Ge+1?Ue.push({polygons:Dt,bounds:$t,depth:Ge+1}):ae(Dt,$t)}if(Zt.length){const $t=[new Nt(Je===0?kt:tt.x,Je===1?kt:tt.y),Et];Te.length>Ge+1?Ue.push({polygons:Zt,bounds:$t,depth:Ge+1}):ae(Zt,$t)}}return J}(u,a,Math.ceil((_-p)/11.25),Math.ceil((b-T)/11.25),1,(I,M,$)=>{if(I===0)return .5*(M+$);{const V=Ae((c.y+M/Yt)/f);return(me(.5*(Ae((c.y+$/Yt)/f)+V))*f-c.y)*Yt}})}function Aue(u,a,c,f,p,_){const b=Math.pow(2,f.z-p.z);for(let T=0;T<c;T++){let I=u.int16[2*(T+a)+0],M=u.int16[2*(T+a)+1];I=(I+p.x*Yt)*b-f.x*Yt,M=(M+p.y*Yt)*b-f.y*Yt,_.push(new Nt(I,M))}}let nU,iU;gr(f2,"FillExtrusionBucket",{omit:["layers","features"]}),gr(H$,"PartData"),gr(G$,"FootprintSegment"),gr(K$,"BorderCentroidData"),gr(Bj,"GroundEffect");class ry extends Nt{constructor(a,c,f){super(a,c),this.z=f}}class aU extends ry{constructor(a,c,f,p){super(a,c,f),this.w=p}}function oU(u,a,c,f){const p=c==="x"?"y":"x",_=(f-u[c])/(a[c]-u[c]);u[p]=Math.round(u[p]+(a[p]-u[p])*_),u[c]=f,u.hasOwnProperty("z")&&(u.z=$r(u.z,a.z,_)),u.hasOwnProperty("w")&&(u.w=$r(u.w,a.w,_))}function sU(u,a,c,f){const p=c,_=f;for(const b of["x","y"]){let T=u,I=a;T[b]>=I[b]&&(T=a,I=u),T[b]<p&&I[b]>p&&oU(T,I,b,p),T[b]<_&&I[b]>_&&oU(I,T,b,_)}}function p2(u,a,c,f,p,_){const b=[];for(let T=0;T<u.length;T++){const I=u[T];let M;const $=b.length;let V=0;for(let q=0;q<I.length-1;q++){let Y=I[q],J=I[q+1],ae=0;const ce=V;let de,we;_&&(ae=Math.hypot(J.x-Y.x,J.y-Y.y),V+=ae,de=Y,we=J),Y.x<a&&J.x<a||(Y.x<a?Y=new Nt(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x<a&&(J=new Nt(a,Y.y+(a-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y<c&&J.y<c||(Y.y<c?Y=new Nt(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round():J.y<c&&(J=new Nt(Y.x+(c-Y.y)/(J.y-Y.y)*(J.x-Y.x),c)._round()),Y.x>=f&&J.x>=f||(Y.x>=f?Y=new Nt(f,Y.y+(f-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round():J.x>=f&&(J=new Nt(f,Y.y+(f-Y.x)/(J.x-Y.x)*(J.y-Y.y))._round()),Y.y>=p&&J.y>=p||(Y.y>=p?Y=new Nt(Y.x+(p-Y.y)/(J.y-Y.y)*(J.x-Y.x),p)._round():J.y>=p&&(J=new Nt(Y.x+(p-Y.y)/(J.y-Y.y)*(J.x-Y.x),p)._round()),M&&Y.equals(M[M.length-1])||(M=[Y],b.push(M),_&&_.push({progress:{min:ce+lU(de,we,Y)*ae,max:1},parentIndex:T,prevPoint:de,nextPoint:we})),M.push(J),_&&(_[_.length-1].progress.max=ce+lU(de,we,J)*ae,_[_.length-1].nextPoint=we)))))}if(_&&V>0)for(let q=$;q<b.length;q++)_[q].progress.min/=V,_[q].progress.max/=V}return b}function Pue(u,a,c,f,p){if(u.length<2)return void f.push(u);const _=[];for(;a.valid();){const[M,$]=a.get();for(let V=0;V<u.length-1;V++){const q=u[V],Y=u[V+1],J=Sl(q,Y,M,$);if(J){const[ae]=J,ce=new Nt($r(q.x,Y.x,ae),$r(q.y,Y.y,ae));_.push({t:V+ae,distance:0,point:ce})}}a.next()}if(_.length===0)return void f.push(u);_.sort((M,$)=>M.t-$.t);let b=0,T=0,I=[];for(f.push(I);b!==u.length;){if(T===_.length){for(;b!==u.length;)I.length!==0&&I[I.length-1].equals(u[b])||I.push(u[b]),b++;break}_[T].t<=b?(I.length!==0&&I[I.length-1].equals(_[T].point)||I.push(_[T].point),Math.trunc(_[T].t),T++):(I.length!==0&&I[I.length-1].equals(u[b])||I.push(u[b]),b++)}}function lU(u,a,c){return u.x!==a.x?(c.x-u.x)/(a.x-u.x):u.y!==a.y?(c.y-u.y)/(a.y-u.y):0}function x1(u,a){return u.x*a.x+u.y*a.y}function cU(u,a){if(u.length===1){let c=0;const f=a[c++];let p;for(;!p||f.equals(p);)if(p=a[c++],!p)return 1/0;for(;c<a.length;c++){const _=a[c],b=u[0],T=p.sub(f),I=_.sub(f),M=b.sub(f),$=x1(T,T),V=x1(T,I),q=x1(I,I),Y=x1(M,T),J=x1(M,I),ae=$*q-V*V,ce=(q*Y-V*J)/ae,de=($*J-V*Y)/ae,we=f.z*(1-ce-de)+p.z*ce+_.z*de;if(isFinite(we))return we}return 1/0}{let c=1/0;for(const f of a)c=Math.min(c,f.z);return c}}function uU(u,a,c){let f=1/0;ca(c,a)&&(f=cU(c,a[0]));for(let p=0;p<a.length;p++){const _=a[p],b=u[p];for(let T=0;T<_.length-1;T++){const I=_[T],M=[I,_[T+1],b[T+1],b[T],I];xa(c,M)&&(f=Math.min(f,cU(c,M)))}}return f!==1/0&&f}function dU(u,a,c,f,p,_,b,T,I,M,$){return u.projection.name==="globe"?function(V,q,Y,J,ae,ce,de,we,Te,Oe,Ue){const De=[],Ge=[],Je=V.projection.upVectorScale(Ue,V.center.lat,V.worldSize).metersToTile,tt=[0,0,0,1],Et=[0,0,0,1],ct=(kt,Dt,Zt,$t)=>{kt[0]=Dt,kt[1]=Zt,kt[2]=$t,kt[3]=1},Tt=tU();Y>0&&(Y+=Tt),J+=Tt;for(const kt of q){const Dt=[],Zt=[];for(const $t of kt){const Rt=$t.x+ae.x,Bt=$t.y+ae.y,bt=V.projection.projectTilePoint(Rt,Bt,Ue),yt=V.projection.upVector(Ue,$t.x,$t.y);let Ft=Y,Gt=J;if(de){const jt=hU(Rt,Bt,Y,J,de,we,Te,Oe);Ft+=jt.base,Gt+=jt.top}Y!==0?ct(tt,bt.x+yt[0]*Je*Ft,bt.y+yt[1]*Je*Ft,bt.z+yt[2]*Je*Ft):ct(tt,bt.x,bt.y,bt.z),ct(Et,bt.x+yt[0]*Je*Gt,bt.y+yt[1]*Je*Gt,bt.z+yt[2]*Je*Gt),nr(tt,tt,ce),nr(Et,Et,ce),Dt.push(new ry(tt[0],tt[1],tt[2])),Zt.push(new ry(Et[0],Et[1],Et[2]))}De.push(Dt),Ge.push(Zt)}return[De,Ge]}(u,a,c,f,p,_,b,T,I,M,$):b?function(V,q,Y,J,ae,ce,de,we,Te){const Oe=[],Ue=[],De=[0,0,0,1];for(const Ge of V){const Je=[],tt=[];for(const Et of Ge){const ct=Et.x+J.x,Tt=Et.y+J.y,kt=hU(ct,Tt,q,Y,ce,de,we,Te);De[0]=ct,De[1]=Tt,De[2]=kt.base,De[3]=1,Qt(De,De,ae),De[3]=Math.max(De[3],1e-5);const Dt=new ry(De[0]/De[3],De[1]/De[3],De[2]/De[3]);De[0]=ct,De[1]=Tt,De[2]=kt.top,De[3]=1,Qt(De,De,ae),De[3]=Math.max(De[3],1e-5);const Zt=new ry(De[0]/De[3],De[1]/De[3],De[2]/De[3]);Je.push(Dt),tt.push(Zt)}Oe.push(Je),Ue.push(tt)}return[Oe,Ue]}(a,c,f,p,_,b,T,I,M):function(V,q,Y,J,ae){const ce=[],de=[],we=ae[8]*q,Te=ae[9]*q,Oe=ae[10]*q,Ue=ae[11]*q,De=ae[8]*Y,Ge=ae[9]*Y,Je=ae[10]*Y,tt=ae[11]*Y;for(const Et of V){const ct=[],Tt=[];for(const kt of Et){const Dt=kt.x+J.x,Zt=kt.y+J.y,$t=ae[0]*Dt+ae[4]*Zt+ae[12],Rt=ae[1]*Dt+ae[5]*Zt+ae[13],Bt=ae[2]*Dt+ae[6]*Zt+ae[14],bt=ae[3]*Dt+ae[7]*Zt+ae[15],yt=$t+we,Ft=Rt+Te,Gt=Bt+Oe,jt=Math.max(bt+Ue,1e-5),pr=$t+De,vr=Rt+Ge,ur=Bt+Je,ir=Math.max(bt+tt,1e-5);ct.push(new ry(yt/jt,Ft/jt,Gt/jt)),Tt.push(new ry(pr/ir,vr/ir,ur/ir))}ce.push(ct),de.push(Tt)}return[ce,de]}(a,c,f,p,_)}function hU(u,a,c,f,p,_,b,T){const I=b*p.getElevationAt(u,a,!0,!0),M=_[0]!==0,$=M?_[1]===0?b*(_[0]/q$-W$):b*function(V,q,Y){const J=Math.floor(q[0]/8),ae=Math.floor(q[1]/8),ce=10*(q[0]-8*J),de=10*(q[1]-8*ae),we=V.getElevationAt(J,ae,!0,!0),Te=V.getMeterToDEM(Y),Oe=Math.floor(.5*(ce*Te-1)),Ue=Math.floor(.5*(de*Te-1)),De=V.tileCoordToPixel(J,ae),Ge=2*Oe+1,Je=2*Ue+1,tt=function(Zt,$t,Rt,Bt,bt){return[Zt.getElevationAtPixel($t,Rt,!0),Zt.getElevationAtPixel($t+bt,Rt,!0),Zt.getElevationAtPixel($t,Rt+bt,!0),Zt.getElevationAtPixel($t+Bt,Rt+bt,!0)]}(V,De.x-Oe,De.y-Ue,Ge,Je),Et=Math.abs(tt[0]-tt[1]),ct=Math.abs(tt[2]-tt[3]),Tt=Math.abs(tt[0]-tt[2])+Math.abs(tt[1]-tt[3]),kt=Math.min(.25,.5*Te*(Et+ct)/Ge),Dt=Math.min(.25,.5*Te*Tt/Je);return we+Math.max(kt*ce,Dt*de)}(p,_,T):I;return{base:I+(c===0?-1:c),top:M?Math.max($+f,I+c+2):I+f}}class Cue{constructor(a){this._callback=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Oue{constructor(){this.tasks={},this.taskQueue=[],gt(["process"],this),this.invoker=new Cue(this.process),this.nextId=0}add(a,c){const f=this.nextId++,p=function({type:_,isSymbolTile:b,zoom:T}){return T=T||0,_==="message"?0:_!=="maybePrepare"||b?_!=="parseTile"||b?_==="parseTile"&&b?300-T:_==="maybePrepare"&&b?400-T:500:200-T:100-T}(c);if(p===0){try{a()}finally{}return null}return this.tasks[f]={fn:a,metadata:c,priority:p,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const a=this.pick();if(a===null)return;const c=this.tasks[a];if(delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),!c)return;c.fn()}finally{}}pick(){let a=null,c=1/0;for(let p=0;p<this.taskQueue.length;p++){const _=this.tasks[this.taskQueue[p]];_.priority<c&&(c=_.priority,a=p)}if(a===null)return null;const f=this.taskQueue[a];return this.taskQueue.splice(a,1),f}remove(){this.invoker.remove()}}class fU{constructor(a,c,f){this.target=a,this.parent=c,this.mapId=f,this.callbacks={},this.cancelCallbacks={},gt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Oue}send(a,c,f,p,_=!1,b){const T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(f.metadata=b,this.callbacks[T]=f);const I=new Set;return this.target.postMessage({id:T,type:a,hasCallback:!!f,targetMapId:p,mustQueue:_,sourceMapId:this.mapId,data:qd(c,I)},I),{cancel:()=>{f&&delete this.callbacks[T],this.target.postMessage({id:T,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(a){const c=a.data;if(!c)return;const f=c.id;if(f&&(!c.targetMapId||this.mapId===c.targetMapId))if(c.type==="<cancel>"){const p=this.cancelCallbacks[f];delete this.cancelCallbacks[f],p&&p.cancel()}else if(c.mustQueue||sa(self)){const p=this.callbacks[f],_=this.scheduler.add(()=>this.processTask(f,c),p&&p.metadata||{type:"message"});_&&(this.cancelCallbacks[f]=_)}else this.processTask(f,c)}processTask(a,c){if(delete this.cancelCallbacks[a],c.type==="<response>"){const f=this.callbacks[a];delete this.callbacks[a],f&&(c.error?f(Wd(c.error)):f(null,Wd(c.data)))}else{const f=new Set,p=c.hasCallback?(b,T)=>{this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:b?qd(b):null,data:qd(T,f)},f)}:()=>{},_=Wd(c.data);if(this.parent[c.type])this.parent[c.type](c.sourceMapId,_,p);else if(this.parent.getWorkerSource){const b=c.type.split("."),{source:T,scope:I}=_;this.parent.getWorkerSource(c.sourceMapId,b[0],T,I)[b[1]](_,p)}else p(new Error(`Could not find function ${c.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var b1={workerUrl:"",workerClass:null,workerParams:void 0};const Uj="mapboxgl_preloaded_worker_pool";class ny{constructor(){this.active={}}acquire(a,c=ny.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<c;)this.workers.push(b1.workerClass!=null?new b1.workerClass:new self.Worker(b1.workerUrl,b1.workerParams));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.workers&&this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uj]}numActive(){return Object.keys(this.active).length}}ny.workerCount=2;class U_{constructor(a,c,f="Worker",p=ny.workerCount){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=vt();const _=this.workerPool.acquire(this.id,p);for(let b=0;b<_.length;b++){const T=new U_.Actor(_[b],c,this.id);T.name=`${f} ${b}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,c,f){Ze(this.actors,(p,_)=>{p.send(a,c,_)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}let w1,Vj;function m2(){return w1||(w1=new ny),w1}U_.Actor=fU;class Iue{constructor(a){this.module=a}createIntArray(a){const c=new Int32Array(a),f=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heap32.set(c,f/c.BYTES_PER_ELEMENT),f}createFloatArray(a){const c=new Float32Array(a),f=this.module.malloc(c.length*c.BYTES_PER_ELEMENT);return this.module.heapF32.set(c,f/c.BYTES_PER_ELEMENT),f}createStringBuffer(a){const c=this.module.malloc(a.length+1);for(let f=0;f<a.length;++f)this.module.heapU8[c+f]=a.charCodeAt(f);return this.module.heapU8[c+a.length]=0,c}readStringBuffer(a){let c="";for(;this.module.heapU8[a]!==0;)c+=String.fromCharCode(this.module.heapU8[a]),++a;return c}setStyle(a){const c=a.entranceColorRgb,f=a.facadeGlazingColorRgb,p=a.roofColorRgb,_=a.wallColorRgb,b=a.normalScale;this.module.setStyle(c[0],c[1],c[2],f[0],f[1],f[2],p[0],p[1],p[2],_[0],_[1],_[2],b[0],b[1],b[2],a.tileToMeters)}setAOOptions(a,c){this.module.setAOOptions(a?1:0,c)}setMetricOptions(a,c){this.module.setMetricOptions(a?1:0,c)}setStructuralOptions(a){this.module.setStructuralOptions(a?1:0)}setFacadeOptions(a,c){this.module.setFacadeOptions(a,c?1:0)}setFauxFacadeOptions(a,c,f){this.module.setFauxFacadeOptions(a?1:0,c?1:0,f)}setFacadeClassifierOptions(a){this.module.setFacadeClassifierOptions(a)}generateMesh(a,c){for(const T of a){const I=this.createStringBuffer(T.roofType),M=[0],$=[];for(const Y of T.coordinates)if(Array.isArray(Y)){for(const J of Y)$.push(J.x),$.push(J.y);M.push($.length)}const V=this.createIntArray(M),q=this.createFloatArray($);this.module.addFeature(T.id,T.sourceId,T.minHeight,T.height,I,T.roofType.length,q,V,M.length-1),this.module.free(I),this.module.free(V),this.module.free(q)}for(const T of c){let I;I=T.entrances?JSON.parse(T.entrances):[];const M=this.createFloatArray(I),$=[];for(const q of T.coordinates)$.push(q.x),$.push(q.y);const V=this.createFloatArray($);this.module.addFacade(T.sourceId,T.crossPerc,T.distanceToRoad,M,I.length,V,$.length),this.module.free(M),this.module.free(V)}if(!this.module.generateMesh()){const T=this.module.getLastError();return this.readStringBuffer(T)}const f=this.module.getMeshCount(),p=new Array(f);for(let T=0;T<f;T++){const I=this.module.getPositionsPtr(T),M=this.module.getPositionsLength(T),$=new Float32Array(this.module.heapF32.buffer,I,M),V=this.module.getNormalsPtr(T),q=this.module.getNormalsLength(T),Y=new Float32Array(this.module.heapF32.buffer,V,q),J=this.module.getColorsPtr(T),ae=this.module.getColorsLength(T),ce=new Uint8Array(this.module.heapU8.buffer,J,ae),de=this.module.getAOPtr(T),we=this.module.getAOLength(T),Te=new Float32Array(this.module.heapF32.buffer,de,we),Oe=this.module.getUVPtr(T),Ue=this.module.getUVLength(T),De=new Float32Array(this.module.heapF32.buffer,Oe,Ue),Ge=this.module.getFauxFacadePtr(T),Je=this.module.getFauxFacadeLength(T),tt=new Uint8Array(this.module.heapU8.buffer,Ge,Je),Et=this.module.getIndicesPtr(T),ct=this.module.getIndicesLength(T),Tt=new Int32Array(this.module.heap32.buffer,Et,ct),kt=this.module.getBuildingPart(T),Dt=this.readStringBuffer(kt);p[T]={positions:$,normals:Y,colors:ce,ao:Te,uv:De,isFauxFacade:tt,indices:Tt,buildingPart:Dt}}const _=this.module.getRingCount(),b=[];for(let T=0;T<_;T++){const I=this.module.getRingPtr(T),M=this.module.getRingLength(T),$=new Float32Array(this.module.heapF32.buffer,I,M);b.push($)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:b}}}let S1,qj,Ju,V_,Wj,q_=null,W_=null,pU=null,g2=null;function mU(){return sa(self)&&self.worker.dracoUrl?self.worker.dracoUrl:qj||Fi.DRACO_URL}function gU(){if(sa(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(V_)return V_;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return V_=WebAssembly.validate(u)?Fi.MESHOPT_SIMD_URL:Fi.MESHOPT_URL,V_}function kue(){return g2}const y2={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Rue={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},E1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function yU(u,a,c){const f=c.json.bufferViews.length,p=c.buffers.length;a.bufferView=f,c.json.bufferViews[f]={buffer:p,byteLength:u.byteLength},c.buffers[p]=u}const Gj="KHR_draco_mesh_compression";function jue(u,a){const c=u.extensions&&u.extensions[Gj];if(!c)return;const f=new Ju.Decoder,p=bU(a,c.bufferView),_=new Ju.Mesh;if(!f.DecodeArrayToMesh(p,p.byteLength,_))throw new Error("Failed to decode Draco mesh");const b=a.json.accessors[u.indices],T=y2[b.componentType],I=b.count*T.BYTES_PER_ELEMENT,M=Ju._malloc(I);T===Uint16Array?f.GetTrianglesUInt16Array(_,I,M):f.GetTrianglesUInt32Array(_,I,M),yU(Ju.memory.buffer.slice(M,M+I),b,a),Ju._free(M);for(const $ of Object.keys(c.attributes)){const V=f.GetAttributeByUniqueId(_,c.attributes[$]),q=a.json.accessors[u.attributes[$]],Y=Rue[q.componentType],J=q.count*E1[q.type]*y2[q.componentType].BYTES_PER_ELEMENT,ae=Ju._malloc(J);f.GetAttributeDataArrayForAllPoints(_,V,Ju[Y],J,ae),yU(Ju.memory.buffer.slice(ae,ae+J),q,a),Ju._free(ae)}f.destroy(),_.destroy(),delete u.extensions[Gj]}const v2="EXT_meshopt_compression";function Nue(u,a){if(!u.extensions||!u.extensions[v2])return;const c=u.extensions[v2],f=new Uint8Array(a.buffers[c.buffer],c.byteOffset||0,c.byteLength||0),p=new Uint8Array(c.count*c.byteStride);Wj.decodeGltfBuffer(p,c.count,c.byteStride,f,c.mode,c.filter),u.buffer=a.buffers.length,u.byteOffset=0,a.buffers[u.buffer]=p.buffer,delete u.extensions[v2]}const vU=1179937895,_U=new TextDecoder("utf8");function xU(u,a){return new URL(u,a).href}function Mue(u,a,c,f){return fetch(xU(u.uri,f)).then(p=>p.arrayBuffer()).then(p=>{a.buffers[c]=p})}function bU(u,a){const c=u.json.bufferViews[a];return new Uint8Array(u.buffers[c.buffer],c.byteOffset||0,c.byteLength)}function Due(u,a,c,f){if(u.uri){const p=xU(u.uri,f);return fetch(p).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{a.images[c]=_})}if(u.bufferView!==void 0){const p=bU(a,u.bufferView),_=new Blob([p],{type:u.mimeType});return createImageBitmap(_).then(b=>{a.images[c]=b})}}function wU(u,a=0,c){const f={json:null,images:[],buffers:[]};if(new Uint32Array(u,a,1)[0]===vU){const $=new Uint32Array(u,a);let V=2;const q=($[V++]>>2)-3,Y=$[V++]>>2;if(V++,f.json=JSON.parse(_U.decode($.subarray(V,V+Y))),V+=Y,V<q){const J=$[V++];V++;const ae=a+(V<<2);f.buffers[0]=u.slice(ae,ae+J)}}else f.json=JSON.parse(_U.decode(new Uint8Array(u,a)));const{buffers:p,images:_,meshes:b,extensionsUsed:T,bufferViews:I}=f.json;let M=Promise.resolve();if(p){const $=[];for(let V=0;V<p.length;V++){const q=p[V];q.uri?$.push(Mue(q,f,V,c)):f.buffers[V]||(f.buffers[V]=null)}M=Promise.all($)}return M.then(()=>{const $=[],V=T&&T.includes(Gj),q=T&&T.includes(v2);if(V&&$.push(function(){if(!Ju)return S1??(S1=function(Y){let J,ae=null;function ce(){J=new Uint8Array(ae.buffer)}function de(){throw new Error("Unexpected Draco error.")}const we={a:{a:de,d:function(Te,Oe,Ue){return J.copyWithin(Te,Oe,Oe+Ue)},c:function(Te){const Oe=J.length,Ue=Math.max(Te>>>0,Math.ceil(1.2*Oe)),De=Math.ceil((Ue-Oe)/65536);try{return ae.grow(De),ce(),!0}catch{return!1}},b:de}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Y,we):Y.then(Te=>Te.arrayBuffer()).then(Te=>WebAssembly.instantiate(Te,we))).then(Te=>{const{Rb:Oe,Qb:Ue,P:De,T:Ge,X:Je,Ja:tt,La:Et,Qa:ct,Va:Tt,Wa:kt,eb:Dt,jb:Zt,f:$t,e:Rt,yb:Bt,zb:bt,Ab:yt,Bb:Ft,Db:Gt,Gb:jt}=Te.instance.exports;ae=Rt;const pr=(()=>{let vr=0,ur=0,ir=0,Kr=0;return or=>{ir&&(Oe(Kr),Oe(vr),ur+=ir,ir=vr=0),vr||(ur+=128,vr=Ue(ur));const Or=or.length+7&-8;let Jr=vr;Or>=ur&&(ir=Or,Jr=Kr=Ue(Or));for(let yn=0;yn<or.length;yn++)J[Jr+yn]=or[yn];return Jr}})();return ce(),$t(),{memory:Rt,_free:Oe,_malloc:Ue,Mesh:class{constructor(){this.ptr=De()}destroy(){Ge(this.ptr)}},Decoder:class{constructor(){this.ptr=tt()}destroy(){Zt(this.ptr)}DecodeArrayToMesh(vr,ur,ir){const Kr=pr(vr),or=Et(this.ptr,Kr,ur,ir.ptr);return!!Je(or)}GetAttributeByUniqueId(vr,ur){return{ptr:ct(this.ptr,vr.ptr,ur)}}GetTrianglesUInt16Array(vr,ur,ir){Tt(this.ptr,vr.ptr,ur,ir)}GetTrianglesUInt32Array(vr,ur,ir){kt(this.ptr,vr.ptr,ur,ir)}GetAttributeDataArrayForAllPoints(vr,ur,ir,Kr,or){Dt(this.ptr,vr.ptr,ur.ptr,ir,Kr,or)}},DT_INT8:Bt(),DT_UINT8:bt(),DT_INT16:yt(),DT_UINT16:Ft(),DT_UINT32:Gt(),DT_FLOAT32:jt()}})}(fetch(mU())),S1.then(Y=>{Ju=Y,S1=void 0}))}()),q&&$.push(function(){if(Wj)return;const Y=function(J){let ae;const ce=WebAssembly.instantiateStreaming(J,{}).then(Te=>{ae=Te.instance,ae.exports.__wasm_call_ctors()}),de={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},we={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:ce,supported:!0,decodeGltfBuffer(Te,Oe,Ue,De,Ge,Je){(function(tt,Et,ct,Tt,kt,Dt,Zt){const $t=tt.exports.sbrk,Rt=Tt+3&-4,Bt=$t(Rt*kt),bt=$t(Dt.length),yt=new Uint8Array(tt.exports.memory.buffer);yt.set(Dt,bt);const Ft=Et(Bt,Tt,kt,bt,Dt.length);if(Ft===0&&Zt&&Zt(Bt,Rt,kt),ct.set(yt.subarray(Bt,Bt+Tt*kt)),$t(Bt-$t(0)),Ft!==0)throw new Error(`Malformed buffer data: ${Ft}`)})(ae,ae.exports[we[Ge]],Te,Oe,Ue,De,ae.exports[de[Je]])}}}(fetch(gU()));return Y.ready.then(()=>{Wj=Y})}()),_)for(let Y=0;Y<_.length;Y++)$.push(Due(_[Y],f,Y,c));return($.length?Promise.all($):Promise.resolve()).then(()=>{if(V&&b)for(const{primitives:Y}of b)for(const J of Y)jue(J,f);if(q&&b&&I)for(const Y of I)Nue(Y,f);return f})})}function SU(u){return fetch(u).then(a=>a.arrayBuffer()).then(a=>wU(a,0,u))}function Hj(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Kj(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Zj{constructor(a,c,f,p){this.context=a,this.format=f,this.useMipmap=p&&p.useMipmap,this.texture=a.gl.createTexture(),this.update(c,{premultiply:p&&p.premultiply})}update(a,c){const f=a&&a instanceof HTMLVideoElement&&a.width===0?a.videoWidth:a.width,p=a&&a instanceof HTMLVideoElement&&a.height===0?a.videoHeight:a.height,{context:_}=this,{gl:b}=_,{x:T,y:I}=c&&c.position?c.position:{x:0,y:0},M=T+f,$=I+p;!this.size||this.size[0]===M&&this.size[1]===$||(b.bindTexture(b.TEXTURE_2D,null),b.deleteTexture(this.texture),this.texture=b.createTexture(),this.size=null),b.bindTexture(b.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA8&&(!c||c.premultiply!==!1));const V=a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||ImageBitmap&&a instanceof ImageBitmap;if(!this.size&&M>0&&$>0){const q=this.useMipmap?Math.floor(Math.log2(Math.max(M,$)))+1:1;b.texStorage2D(b.TEXTURE_2D,q,this.format,M,$),this.size=[M,$]}this.size&&(V?b.texSubImage2D(b.TEXTURE_2D,0,T,I,Hj(this.format),Kj(this.format),a):"data"in a&&a.data&&b.texSubImage2D(b.TEXTURE_2D,0,T,I,f,p,Hj(this.format),Kj(this.format),a.data)),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(a,c,f=!1){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),a!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!f?a===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),c!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,c),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,c),this.wrapS=c)}bindExtraParam(a,c,f,p,_){const{context:b}=this,{gl:T}=b;T.bindTexture(T.TEXTURE_2D,this.texture),c!==this.magFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,c),this.magFilter=c),a!==this.minFilter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,this.useMipmap?a===T.NEAREST?T.NEAREST_MIPMAP_NEAREST:T.LINEAR_MIPMAP_LINEAR:a),this.minFilter=a),f!==this.wrapS&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,f),this.wrapS=f),p!==this.wrapT&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,p),this.wrapT=p),_!==this.compareMode&&(_?(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.COMPARE_REF_TO_TEXTURE),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_FUNC,_)):T.texParameteri(T.TEXTURE_2D,T.TEXTURE_COMPARE_MODE,T.NONE),this.compareMode=_)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}class T1{constructor(a,c){this.context=a,this.texture=c}bind(a,c){const{context:f}=this,{gl:p}=f;p.bindTexture(p.TEXTURE_2D,this.texture),a!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,a),this.minFilter=a),c!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,c),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,c),this.wrapS=c)}}const Lue=En([{name:"a_pos_3f",components:3,type:"Float32"}]),Fue=En([{name:"a_color_3f",components:3,type:"Float32"}]),zue=En([{name:"a_color_4f",components:4,type:"Float32"}]),Bue=En([{name:"a_uv_2f",components:2,type:"Float32"}]),$ue=En([{name:"a_normal_3f",components:3,type:"Float32"}]),Uue=En([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Vue=En([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function EU(u,a){const c=_2(u.projection,u.zoom,u.width,u.height),f=function(_,b,T,I,M){const $=new Q(T.lng-180*Mp,T.lat),V=new Q(T.lng+180*Mp,T.lat),q=_.project($.lng,$.lat),Y=_.project(V.lng,V.lat),J=-Math.atan2(Y.y-q.y,Y.x-q.x),ae=ot.fromLngLat(T);ae.y=ve(ae.y,-1+Mp,1-Mp);const ce=ae.toLngLat(),de=_.project(ce.lng,ce.lat),we=ot.fromLngLat(ce);we.x+=Mp;const Te=we.toLngLat(),Oe=_.project(Te.lng,Te.lat),Ue=AU(Oe.x-de.x,Oe.y-de.y,J),De=ot.fromLngLat(ce);De.y+=Mp;const Ge=De.toLngLat(),Je=_.project(Ge.lng,Ge.lat),tt=AU(Je.x-de.x,Je.y-de.y,J),Et=Math.abs(Ue.x)/Math.abs(tt.y),ct=R([]);X(ct,ct,-J*(1-(M?0:I)));const Tt=R([]);return B(Tt,Tt,[1,1-(1-Et)*I,1]),Tt[4]=-tt.x/tt.y*I,X(Tt,Tt,J),j(Tt,ct,Tt),Tt}(u.projection,0,u.center,c,a),p=TU(u);return B(f,f,[p,p,1]),f}function TU(u){const a=u.projection,c=_2(u.projection,u.zoom,u.width,u.height),f=Xj(a,u.center),p=Xj(a,Q.convert(a.center));return Math.pow(2,f*c+(1-c)*p)}function _2(u,a,c,f,p=1/0){const _=u.range;if(!_)return 0;const b=Math.min(p,Math.max(c,f)),T=Math.log2(b/1024);return Ne(_[0]+T,_[1]+T,a)}const Mp=1/4e4;function Xj(u,a){const c=ve(a.lat,-Re,Re),f=new Q(a.lng-180*Mp,c),p=new Q(a.lng+180*Mp,c),_=u.project(f.lng,c),b=u.project(p.lng,c),T=ot.fromLngLat(f),I=ot.fromLngLat(p),M=b.x-_.x,$=b.y-_.y,V=I.x-T.x,q=I.y-T.y,Y=Math.sqrt((V*V+q*q)/(M*M+$*$));return Math.log2(Y)}function AU(u,a,c){const f=Math.cos(c),p=Math.sin(c);return{x:u*f-a*p,y:u*p+a*f}}function PU(u,a,c){R(u),X(u,u,xn(a[2])),U(u,u,xn(a[0])),Z(u,u,xn(a[1])),B(u,u,c),j(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function x2(u,a,c,f,p,_,b,T){const I=[c[0]-a[0],c[1]-a[1],0],M=[f[0]-a[0],f[1]-a[1],0];if(Se(I)<1e-12||Se(M)<1e-12)return Pr(u);const $=At([],I,M);ze($,$),be(M,f,a),I[2]=(_-p)*T,M[2]=(b-p)*T;const V=I;return At(V,I,M),ze(V,V),Ua(u,$,V)}function b2(u,a,c=!1){const f=Rp(a.zoom),p=function(_,b,T){const I=b.worldSize,M=[_[12],_[13],_[14]],$=Ae(M[1]/I),V=Ie(M[0]/I),q=R([]),Y=Ee(1,$)*I,J=Ee(1,0)*I*Fe($,b.zoom),ae=1/Tj(I);let ce=J*ae;if(T){const Oe=_2(b.projection,b.zoom,b.width,b.height,1024);ce=ae*b.projection.pixelSpaceConversion(b.center.lat,I,Oe)}const de=z($,V);_e(de,de,ke([],ze([],de),Y*ce*M[2]));const we=function(Oe){const Ue=[Oe[0],Oe[1],Oe[2]];let De=[0,1,0];const Ge=At([],De,Ue);return At(De,Ue,Ge),Xe(De)===0&&(De=[0,1,0],At(Ge,Ue,De)),ze(Ge,Ge),ze(De,De),ze(Ue,Ue),[Ge[0],Ge[1],Ge[2],0,De[0],De[1],De[2],0,Ue[0],Ue[1],Ue[2],0,Oe[0],Oe[1],Oe[2],1]}(de);B(q,q,[ce,ce,ce*Y]),F(q,q,[-M[0],-M[1],-M[2]]);const Te=j([],b.globeMatrix,we);return j(Te,Te,q),j(Te,Te,_),Te}(u,a,c);if(f>0){const _=function(b,T){const I=T.worldSize,M=Ee(1,0)*I*Fe(T.center.lat,T.zoom)/Tj(I),$=Ee(1,T.center.lat)*I,V=R([]);Z(V,V,xn(T.center.lng)),U(V,V,xn(T.center.lat)),F(V,V,[0,0,Ls]),B(V,V,[M,M,M*$]);const q=T.point;return F(V,V,[-q.x,-q.y,0]),j(V,V,b),j(V,T.globeMatrix,V)}(u,a);return function(b,T,I){const M=(J,ae,ce)=>{const de=Se(J),we=Se(ae),Te=tf(J,ae,ce);return ke(Te,Te,1/Se(Te)*$r(de,we,ce))},$=M([b[0],b[1],b[2]],[T[0],T[1],T[2]],I),V=M([b[4],b[5],b[6]],[T[4],T[5],T[6]],I),q=M([b[8],b[9],b[10]],[T[8],T[9],T[10]],I),Y=tf([b[12],b[13],b[14]],[T[12],T[13],T[14]],I);return[$[0],$[1],$[2],0,V[0],V[1],V[2],0,q[0],q[1],q[2],0,Y[0],Y[1],Y[2],1]}(p,_,f)}return p}function Yj(u,a,c,f){const p=mn.projectAabbCorners(f,c);let _=Number.MAX_VALUE;for(let T=0;T<p.length;++T){const I=p[T];I[0]=(.5*I[0]+.5)*a.width,I[1]=(.5-.5*I[1])*a.height,I[2]<_&&(_=I[2])}const b=function(T){const I=[];let M=0;for(let Y=1;Y<T.length;Y++)(T[Y][0]<T[M][0]||T[Y][0]===T[M][0]&&T[Y][1]<T[M][1])&&(M=Y);let $,V=M;const q=new Uint8Array(T.length);do{if(q[V])break;I.push(new Nt(T[V][0],T[V][1])),q[V]=1,$=(V+1)%T.length;for(let Y=0;Y<T.length;Y++){if(T[Y][0]===T[$][0]&&T[Y][1]===T[$][1]||T[Y][0]===T[V][0]&&T[Y][1]===T[V][1])continue;const J=[T[Y][0]-T[V][0],T[Y][1]-T[V][1]],ae=[T[$][0]-T[V][0],T[$][1]-T[V][1]],ce=J[0]*ae[1]-J[1]*ae[0];(ce>0||ce===0&&J[0]*ae[0]+J[1]*ae[1]>=0&&J[0]*J[0]+J[1]*J[1]>ae[0]*ae[0]+ae[1]*ae[1])&&($=Y)}V=$}while(V!==M);return I.length>0&&I.push(I[0]),I}(p);if(xa(u,b))return _}const iy=64,G_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function w2(u,a,c,f,p,_,b,T,I,M=!1){const $=c.zoom,V=c.project(f),q=Fe(f.lat,$),Y=1/q;R(u),F(u,u,[V.x+b[0]*Y,V.y+b[1]*Y,b[2]]);let J=1,ae=1;const ce=c.worldSize;if(M){if(c.projection.name==="mercator"){let Oe=0;c.elevation&&(Oe=c.elevation.getAtPointOrZero(new ot(V.x/ce,V.y/ce),0));const Ue=Qt([],[V.x,V.y,Oe,1],c.projMatrix)[3]/c.cameraToCenterDistance;J=Ue,ae=Ue*Fe(c.center.lat,$)}else if(c.projection.name==="globe"){const Oe=b2(u,c),Ue=[0,0,0,1];Qt(Ue,Ue,j([],c.projMatrix,Oe));const De=Ue[3]/c.cameraToCenterDistance,Ge=Rp($),Je=c.projection.pixelsPerMeter(f.lat,ce)*Fe(f.lat,$),tt=c.projection.pixelsPerMeter(c.center.lat,ce)*Fe(c.center.lat,$);J=De/$r(Je,Ve(c.center.lat),Ge),ae=De*q/Je,J*=tt,ae*=tt}}else J=Y;B(u,u,[J,J,ae]);const de=[...u],we=a.orientation,Te=[];if(PU(Te,[we[0]+(p?p[0]:0),we[1]+(p?p[1]:0),we[2]+(p?p[2]:0)],_),j(u,de,Te),T&&c.elevation){let Oe=0;const Ue=[];if(I&&c.elevation){Oe=function(Ge,Je,tt,Et,ct){const Tt=Je.elevation;if(!Tt)return 0;const kt=mn.projectAabbCorners(tt,Et),Dt=Ee(1,ct.lat)*Je.worldSize,Zt=function(ur,ir){const Kr=[0,0,1],or=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Or of or){const Jr=ur[Or.corners[0]],yn=ur[Or.corners[1]],Fn=ur[Or.corners[2]],tn=[yn[0]-Jr[0],yn[1]-Jr[1],ir*(yn[2]-Jr[2])],Wn=At(tn,tn,[Fn[0]-Jr[0],Fn[1]-Jr[1],ir*(Fn[2]-Jr[2])]);ze(Wn,Wn),Or.dotProductWithUp=ut(Wn,Kr)}return or.sort((Or,Jr)=>Or.dotProductWithUp-Jr.dotProductWithUp),or[0].corners}(kt,Dt),$t=kt[Zt[0]],Rt=kt[Zt[1]],Bt=kt[Zt[2]],bt=kt[Zt[3]],yt=Tt.getAtPointOrZero(new ot($t[0]/Je.worldSize,$t[1]/Je.worldSize),0),Ft=Tt.getAtPointOrZero(new ot(Rt[0]/Je.worldSize,Rt[1]/Je.worldSize),0),Gt=Tt.getAtPointOrZero(new ot(Bt[0]/Je.worldSize,Bt[1]/Je.worldSize),0),jt=Tt.getAtPointOrZero(new ot(bt[0]/Je.worldSize,bt[1]/Je.worldSize),0),pr=(yt+jt)/2,vr=(Ft+Gt)/2;return pr>vr?Ft<Gt?x2(Ge,Rt,bt,$t,Ft,jt,yt,Dt):x2(Ge,Bt,$t,bt,Gt,yt,jt,Dt):yt<jt?x2(Ge,$t,Rt,Bt,yt,Ft,Gt,Dt):x2(Ge,bt,Bt,Rt,jt,Gt,Ft,Dt),Math.max(pr,vr)}(Ue,c,a.aabb,u,f);const De=j([],ne([],Ue),Te);j(u,de,De)}else Oe=c.elevation.getAtPointOrZero(new ot(V.x/ce,V.y/ce),0);Oe!==0&&(u[14]+=Oe)}}class CU{constructor(a,c,f,p,_){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=a,this.uri=c,this.position=f!=null?new Q(f[0],f[1]):new Q(0,0),this.orientation=p??[0,0,0],this.nodes=_,this.uploaded=!1,this.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,c){j(a.globalMatrix,c,a.localMatrix);const f=this.nodeOverrides.get(a.name);if(f!==void 0){const b=[];_=f.orientation,R(p=b),Z(p,p,xn(_[1])),X(p,p,xn(_[2])),U(p,p,xn(_[0])),j(a.globalMatrix,a.globalMatrix,b)}var p,_;if(a.meshes)for(const b of a.meshes){const T=mn.applyTransformFast(b.aabb,a.globalMatrix);this.aabb.encapsulate(T)}if(a.children)for(const b of a.children)this._applyTransformations(b,a.globalMatrix)}computeBoundsAndApplyParent(){const a=R([]);this.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.nodes)this._applyTransformations(c,a)}computeModelMatrix(a,c,f,p,_,b,T=!1){w2(this.matrix,this,a.transform,this.position,c,f,p,_,b,T)}upload(a){if(!this.uploaded){for(const c of this.nodes)Jj(c,a);for(const c of this.nodes)S2(c);this.uploaded=!0}}destroy(){for(const a of this.nodes)Qj(a)}}function A1(u,a,c=!1){u.uploaded||(u.gfxTexture=new Zj(a,u.image,c?a.gl.R8:a.gl.RGBA8,{useMipmap:u.sampler.minFilter>=a.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function que(u,a,c){u.indexBuffer=a.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=a.createVertexBuffer(u.vertexArray,Lue.members,!1,!0),u.normalArray&&(u.normalBuffer=a.createVertexBuffer(u.normalArray,$ue.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=a.createVertexBuffer(u.texcoordArray,Bue.members,!1,!0)),u.colorArray&&(u.colorBuffer=a.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?Fue:zue).members,!1,!0)),u.featureArray&&(u.pbrBuffer=a.createVertexBuffer(u.featureArray,Vue.members,!0)),u.segments=ea.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const f=u.material;f.pbrMetallicRoughness.baseColorTexture&&A1(f.pbrMetallicRoughness.baseColorTexture,a),f.pbrMetallicRoughness.metallicRoughnessTexture&&A1(f.pbrMetallicRoughness.metallicRoughnessTexture,a),f.normalTexture&&A1(f.normalTexture,a),f.occlusionTexture&&A1(f.occlusionTexture,a,c),f.emissionTexture&&A1(f.emissionTexture,a)}function Jj(u,a,c){if(u.meshes)for(const f of u.meshes)que(f,a,c);if(u.children)for(const f of u.children)Jj(f,a,c)}function S2(u){if(u.meshes)for(const a of u.meshes)a.indexArray.destroy(),a.vertexArray.destroy(),a.colorArray&&a.colorArray.destroy(),a.normalArray&&a.normalArray.destroy(),a.texcoordArray&&a.texcoordArray.destroy(),a.featureArray&&a.featureArray.destroy();if(u.children)for(const a of u.children)S2(a)}function Qj(u){if(u.meshes)for(const c of u.meshes)c.vertexBuffer&&(c.vertexBuffer.destroy(),c.indexBuffer.destroy(),c.normalBuffer&&c.normalBuffer.destroy(),c.texcoordBuffer&&c.texcoordBuffer.destroy(),c.colorBuffer&&c.colorBuffer.destroy(),c.pbrBuffer&&c.pbrBuffer.destroy(),c.segments.destroy(),c.material&&((a=c.material).pbrMetallicRoughness.baseColorTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture&&a.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),a.pbrMetallicRoughness.metallicRoughnessTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&a.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),a.normalTexture&&a.normalTexture.gfxTexture&&a.normalTexture.gfxTexture.destroy(),a.emissionTexture&&a.emissionTexture.gfxTexture&&a.emissionTexture.gfxTexture.destroy(),a.occlusionTexture&&a.occlusionTexture.gfxTexture&&a.occlusionTexture.gfxTexture.destroy()));var a;if(u.children)for(const c of u.children)Qj(c)}function ay(u,a){const c=u.json.bufferViews[a.bufferView],f=y2[a.componentType];return new f(u.buffers[c.buffer],(a.byteOffset||0)+(c.byteOffset||0),a.count*(c.byteStride&&c.byteStride!==E1[a.type]*f.BYTES_PER_ELEMENT?c.byteStride/f.BYTES_PER_ELEMENT:E1[a.type]))}function eN(u,a,c,f){const p=y2[a.componentType],_=function($){switch($){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),b=u.json.bufferViews[a.bufferView],T=b.byteStride?b.byteStride/p.BYTES_PER_ELEMENT:E1[a.type],I=c.float32,M=I.length/c.capacity;for(let $=0,V=0;$<a.count*T;$+=T,V+=M)for(let q=0;q<M;q++)I[V+q]=f[$+q]*_;c._trim()}function Wue(u,a,c){const f=u.indices,p=u.attributes,_={};_.indexArray=new Gi;const b=a.json.accessors[f],T=b.count/3;_.indexArray.reserve(T);const I=ay(a,b);for(let q=0;q<T;q++)_.indexArray.emplaceBack(I[3*q],I[3*q+1],I[3*q+2]);_.indexArray._trim(),_.vertexArray=new wl;const M=a.json.accessors[p.POSITION];_.vertexArray.reserve(M.count);const $=ay(a,M);for(let q=0;q<M.count;q++)_.vertexArray.emplaceBack($[3*q],$[3*q+1],$[3*q+2]);if(_.vertexArray._trim(),_.aabb=new mn(M.min,M.max),_.centroid=function(q,Y){const J=[0,0,0],ae=q.length;if(ae>0){for(let ce=0;ce<ae;ce++){const de=3*q[ce];J[0]+=Y[de],J[1]+=Y[de+1],J[2]+=Y[de+2]}J[0]/=ae,J[1]/=ae,J[2]/=ae}return J}(I,$),p.COLOR_0!==void 0){const q=a.json.accessors[p.COLOR_0],Y=E1[q.type],J=ay(a,q);_.colorArray=Y===3?new wl:new Kd,_.colorArray.resize(q.count),eN(a,q,_.colorArray,J)}if(p.NORMAL!==void 0){_.normalArray=new wl;const q=a.json.accessors[p.NORMAL];_.normalArray.resize(q.count);const Y=ay(a,q);eN(a,q,_.normalArray,Y)}if(p.TEXCOORD_0!==void 0&&c.length>0){_.texcoordArray=new Zd;const q=a.json.accessors[p.TEXCOORD_0];_.texcoordArray.resize(q.count);const Y=ay(a,q);eN(a,q,_.texcoordArray,Y)}if(p._FEATURE_ID_RGBA4444!==void 0){const q=a.json.accessors[p._FEATURE_ID_RGBA4444];a.json.extensionsUsed&&a.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=ay(a,q))}p._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(ay(a,a.json.accessors[p._FEATURE_RGBA4444]).buffer));const V=u.material;return _.material=function(q,Y){const{emissiveFactor:J=[0,0,0],alphaMode:ae="OPAQUE",alphaCutoff:ce=.5,normalTexture:de,occlusionTexture:we,emissiveTexture:Te,doubleSided:Oe,name:Ue}=q,{baseColorFactor:De=[1,1,1,1],metallicFactor:Ge=1,roughnessFactor:Je=1,baseColorTexture:tt,metallicRoughnessTexture:Et}=q.pbrMetallicRoughness||{},ct=we?Y[we.index]:void 0;if(we&&we.extensions&&we.extensions.KHR_texture_transform&&ct){const Tt=we.extensions.KHR_texture_transform;ct.offsetScale=[Tt.offset[0],Tt.offset[1],Tt.scale[0],Tt.scale[1]]}return{name:Ue,pbrMetallicRoughness:{baseColorFactor:new ri(...De),metallicFactor:Ge,roughnessFactor:Je,baseColorTexture:tt?Y[tt.index]:void 0,metallicRoughnessTexture:Et?Y[Et.index]:void 0},doubleSided:Oe,emissiveFactor:new ri(...J),alphaMode:ae,alphaCutoff:ce,normalTexture:de?Y[de.index]:void 0,occlusionTexture:ct,emissionTexture:Te?Y[Te.index]:void 0,defined:q.defined===void 0}}(V!==void 0?a.json.materials[V]:{defined:!1},c),_}function OU(u,a,c){const{matrix:f,rotation:p,translation:_,scale:b,mesh:T,extras:I,children:M,name:$}=u,V={};if(V.name=$,V.localMatrix=f||function(q,Y,J,ae){var ce=Y[0],de=Y[1],we=Y[2],Te=Y[3],Oe=ce+ce,Ue=de+de,De=we+we,Ge=ce*Oe,Je=ce*Ue,tt=ce*De,Et=de*Ue,ct=de*De,Tt=we*De,kt=Te*Oe,Dt=Te*Ue,Zt=Te*De,$t=ae[0],Rt=ae[1],Bt=ae[2];return q[0]=(1-(Et+Tt))*$t,q[1]=(Je+Zt)*$t,q[2]=(tt-Dt)*$t,q[3]=0,q[4]=(Je-Zt)*Rt,q[5]=(1-(Ge+Tt))*Rt,q[6]=(ct+kt)*Rt,q[7]=0,q[8]=(tt+Dt)*Bt,q[9]=(ct-kt)*Bt,q[10]=(1-(Ge+Et))*Bt,q[11]=0,q[12]=J[0],q[13]=J[1],q[14]=J[2],q[15]=1,q}([],p||[0,0,0,1],_||[0,0,0],b||[1,1,1]),V.globalMatrix=k(V.localMatrix),T!==void 0){V.meshes=c[T];const q=V.anchor=[0,0];for(const Y of V.meshes){const{min:J,max:ae}=Y.aabb;q[0]+=J[0]+ae[0],q[1]+=J[1]+ae[1]}q[0]=Math.floor(q[0]/V.meshes.length/2),q[1]=Math.floor(q[1]/V.meshes.length/2)}if(I&&(I.id&&(V.id=I.id),I.lights&&(V.lights=function(q){if(!q.length)return[];const Y=function(we){const Te=atob(we),Oe=new Uint8Array(Te.length);for(let Ue=0;Ue<Te.length;Ue++)Oe[Ue]=Te.codePointAt(Ue);return Oe}(q),J=[],ae=Y.length/24,ce=new Uint16Array(Y.buffer),de=new Float32Array(Y.buffer);for(let we=0;we<ae;we++){const Te=ce[2*we*6]/30,Oe=ce[2*we*6+1]/30,Ue=ce[2*we*6+10]/100,De=de[6*we+1],Ge=de[6*we+2],Je=de[6*we+3],tt=de[6*we+4],Et=Je-De,ct=tt-Ge,Tt=Math.hypot(Et,ct);J.push({pos:[De+.5*Et,Ge+.5*ct,Oe],normal:[ct/Tt,-Et/Tt,0],width:Tt,height:Te,depth:Ue,points:[De,Ge,Je,tt]})}return J}(I.lights)),I.MAPBOX_geometry_bloom&&(V.isGeometryBloom=I.MAPBOX_geometry_bloom)),M){const q=[];for(const Y of M)q.push(OU(a.json.nodes[Y],a,c));V.children=q}return V}function Gue(u){if(u.vertices.length===0||u.indices.length===0)return null;const a=new c2(u.vertices,u.indices,8,256),[c,f]=[a.min.clone(),a.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:a,min:c,max:f}}function Hue(u){if(!u.extras||!u.extras.ground)return null;const a=u.extras.ground;if(!a||!Array.isArray(a)||a.length===0)return null;const c=a[0];if(!c||!Array.isArray(c)||c.length===0)return null;const f=[];for(const b of c){if(!Array.isArray(b)||b.length!==2)continue;const T=b[0],I=b[1];typeof T=="number"&&typeof I=="number"&&f.push(new Nt(T,I))}if(f.length<3)return null;f.length>1&&f[f.length-1].equals(f[0])&&f.pop();let p=0;for(let b=0;b<f.length;b++){const T=f[b],I=f[(b+1)%f.length],M=f[(b+2)%f.length];p+=(T.x-I.x)*(M.y-I.y)-(M.x-I.x)*(T.y-I.y)}p>0&&f.reverse();const _=B_(f.flatMap(b=>[b.x,b.y]),[]);return _.length===0?null:{vertices:f,indices:_}}function Kue(u,a){const c=[],f=[];let p=0;const _=[];for(const b of u){p=c.length;const T=b.vertexArray.float32,I=b.indexArray.uint16;for(let M=0;M<b.vertexArray.length;M++)_[0]=T[3*M+0],_[1]=T[3*M+1],_[2]=T[3*M+2],nr(_,_,a),c.push(new Nt(_[0],_[1]));for(let M=0;M<3*b.indexArray.length;M++)f.push(I[M]+p)}if(f.length%3!=0)return null;for(let b=0;b<f.length;b+=3){const T=c[f[b+0]],I=c[f[b+1]],M=c[f[b+2]];(T.x-I.x)*(M.y-I.y)-(M.x-I.x)*(T.y-I.y)>0&&([f[b+1],f[b+2]]=[f[b+2],f[b+1]])}return{vertices:c,indices:f}}function tN(u){const a=function(I,M){const $=[],V=WebGL2RenderingContext;if(I.json.textures)for(const q of I.json.textures){const Y={magFilter:V.LINEAR,minFilter:V.NEAREST,wrapS:V.REPEAT,wrapT:V.REPEAT};q.sampler!==void 0&&Object.assign(Y,I.json.samplers[q.sampler]),$.push({image:M[q.source],sampler:Y,uploaded:!1})}return $}(u,u.images),c=function(I,M){const $=[];for(const V of I.json.meshes){const q=[];for(const Y of V.primitives)q.push(Wue(Y,I,M));$.push(q)}return $}(u,a),{scenes:f,scene:p,nodes:_}=u.json,b=f?f[p||0].nodes:[..._.keys()],T=[];for(const I of b)T.push(OU(_[I],u,c));return function(I,M,$){const V={},q=new Set;for(let Y=0;Y<I.length;Y++){const J=$[M[Y]];if(!J.extras)continue;const ae=J.extras["mapbox:footprint:version"],ce=J.extras["mapbox:footprint:id"];(ae||ce)&&q.add(Y),ae==="1.0.0"&&ce&&(V[ce]=Y)}for(let Y=0;Y<I.length;Y++){if(q.has(Y))continue;const J=I[Y],ae=$[M[Y]];if(!ae.extras)continue;let ce=null;J.id in V&&(ce=Kue(I[V[J.id]].meshes,J.localMatrix)),ce||(ce=Hue(ae)),ce&&(J.footprint=Gue(ce))}if(q.size>0){const Y=Array.from(q.values()).sort((J,ae)=>J-ae);for(let J=Y.length-1;J>=0;J--)I.splice(Y[J],1)}}(T,b,u.json.nodes),T}function Zue(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const a=u.vertexArray.float32,c=u.aabb.min[0]-1,f=u.aabb.min[1]-1,p=iy/(u.aabb.max[0]-c+2),_=iy/(u.aabb.max[1]-f+2);for(let b=0;b<a.length;b+=3){const T=a[b+2],I=(a[b+0]-c)*p|0,M=(a[b+1]-f)*_|0;T>u.heightmap[M*iy+I]&&(u.heightmap[M*iy+I]=T)}}function IU(u,a,c,f,p){c.reserve(c.length+4*u.length),f.reserve(f.length+10*u.length),p.reserve(p.length+10*u.length);let _=f.length;for(const b of u){const T=Math.min(10,Math.max(4,1.3*b.height))*a,I=[-b.normal[1],b.normal[0],0],M=Math.min(.29,.1*b.width/b.depth),$=b.width-2*b.depth*a*(M+.01),V=Qe([],b.pos,I,$/2),q=Qe([],b.pos,I,-$/2),Y=[V[0],V[1],V[2]+b.height],J=[q[0],q[1],q[2]+b.height],ae=Qe([],b.normal,I,M);ke(ae,ae,T);const ce=Qe([],b.normal,I,-M);ke(ce,ce,T),_e(ae,V,ae),_e(ce,q,ce),V[2]+=.1,q[2]+=.1,f.emplaceBack(ae[0],ae[1],ae[2]),f.emplaceBack(ce[0],ce[1],ce[2]),f.emplaceBack(V[0],V[1],V[2]),f.emplaceBack(q[0],q[1],q[2]),f.emplaceBack(Y[0],Y[1],Y[2]),f.emplaceBack(J[0],J[1],J[2]),f.emplaceBack(V[0],V[1],V[2]),f.emplaceBack(q[0],q[1],q[2]),f.emplaceBack(ae[0],ae[1],ae[2]),f.emplaceBack(ce[0],ce[1],ce[2]);const de=$/T/2;p.emplaceBack(-de-M,-1,de,.8),p.emplaceBack(de+M,-1,de,.8),p.emplaceBack(-de,0,de,1.3),p.emplaceBack(de,0,de,1.3),p.emplaceBack(de+M,-.8,de,.7),p.emplaceBack(de+M,-.8,de,.7),p.emplaceBack(0,0,de,1.3),p.emplaceBack(0,0,de,1.3),p.emplaceBack(de+M,-1.2,de,.8),p.emplaceBack(de+M,-1.2,de,.8),c.emplaceBack(6+_,4+_,8+_),c.emplaceBack(7+_,9+_,5+_),c.emplaceBack(0+_,1+_,2+_),c.emplaceBack(1+_,3+_,2+_),_+=10}}function Xue(u,a){const c={};c.indexArray=new Gi,c.vertexArray=new wl,c.colorArray=new Kd,IU(u,a,c.indexArray,c.vertexArray,c.colorArray);const f={defined:!0};f.emissiveFactor=ri.black;const p={};return p.baseColorFactor=ri.white,f.pbrMetallicRoughness=p,c.material=f,c.aabb=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),c}const kU=En([{name:"a_pos_3f",components:3,type:"Float32"}]),Yue=En([{name:"a_normal_3",components:3,type:"Int16"}]),Jue=En([{name:"a_centroid_3",components:3,type:"Int16"}]),RU=En([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Que=En([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),ede=En([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),tde=En([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),rde=En([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),nde=En([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),jU=Lt.types,E2=32767;function ide(u,a){const c=Yt+a;for(const f of u)for(const p of f)if(p.x<-a||p.x>c||p.y<-a||p.y>c)return!1;return!0}class NU{constructor(){this.layoutVertexArray=new wl,this.layoutAttenuationArray=new Kd,this.layoutColorArray=new ac,this.indexArray=new Gi,this.indexArrayForConflation=new Gi,this.segmentsBucket=new ea}}class rN{constructor(){this.layoutVertexArray=new wl,this.layoutNormalArray=new Yh,this.layoutCentroidArray=new Yh,this.layoutColorArray=new ac,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new I_,this.layoutAOArray=new Ku,this.indexArray=new Gi,this.indexArrayForConflation=new Gi,this.segmentsBucket=new ea,this.entranceBloom=new NU}}class MU{constructor(a){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new rN,this.buildingWithFacade=new rN,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=a.zoom,this.canonical=a.canonical,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.hasPattern=!1,this.worldview=a.worldview,this.lut=a.lut,this.buildingWithFacade.layoutFacadePaintArray=new ac,this.buildingWithFacade.layoutFacadeDataArray=new Jh,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new ac,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.projection=a.projection,this.groundEffect=new Bj(a),this.groundEffect.groundRadiusArray=new Ku,this.hasAppearances=null}updateFootprints(a,c){for(const f of this.footprints)c.push({footprint:f,id:a})}updateAppearances(a,c,f,p){}prepare(){return function(){if(g2!=null||pU!=null)return null;if(W_!=null)return W_;const a=fetch(Fi.BUILDING_GEN_URL);return W_=function(c){let f,p,_,b;function T(){f=new Uint8Array(b.buffer),p=new Int32Array(b.buffer),_=new Float32Array(b.buffer)}function I(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},$={a:{a:I,f:function(V){const q=f.length,Y=Math.max(V>>>0,Math.ceil(1.2*q)),J=Math.ceil((Y-q)/65536);try{return b.grow(J),T(),!0}catch{return!1}},g:I,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(c,$):c.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,$))).then(V=>{const q=V.instance.exports;return(0,q.g)(),b=q.f,T(),new Iue({setStyle:q.h,setAOOptions:q.i,setMetricOptions:q.j,setStructuralOptions:q.k,setFacadeOptions:q.l,setFauxFacadeOptions:q.m,setFacadeClassifierOptions:q.n,addFeature:q.o,addFacade:q.p,generateMesh:q.q,getLastError:q.r,getOuterRingLength:q.s,getMeshCount:q.t,getPositionsPtr:q.u,getPositionsLength:q.v,getNormalsPtr:q.w,getNormalsLength:q.x,getColorsPtr:q.y,getColorsLength:q.z,getAOPtr:q.A,getAOLength:q.B,getUVPtr:q.C,getUVLength:q.D,getFauxFacadePtr:q.E,getFauxFacadeLength:q.F,getIndicesPtr:q.G,getIndicesLength:q.H,getBuildingPart:q.I,getRingCount:q.J,getRingPtr:q.K,getRingLength:q.L,free:q.M,malloc:q.N,heapU8:f,heap32:p,heapF32:_})})}(a).then(c=>(W_=null,g2=c,g2)).catch(c=>{kr("Could not load building-gen"),W_=null,pU=c}),W_}()}populate(a,c,f,p){const _=kue();if(!_)return;const b=qe(f);this.tileToMeter=b,this.brightness=c.brightness,_.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,b],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:b,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const T=new Map,I=new Map;for(const{feature:M}of a){if(jU[M.type]!=="LineString"){T.set(M.id,M.properties.source_id);continue}const $=this.layers[0]._featureFilter.needGeometry,V=mt(M,$);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),V,f))continue;const q=$?V.geometry:It(M,f,p),Y=[];for(const de of q)for(const we of de)Y.push({x:we.x,y:we.y});const J={coordinates:Y,crossPerc:M.properties.cross_perc,distanceToRoad:M.properties.distance_to_road,entrances:M.properties.entrances,sourceId:0},ae=M.properties.source_id;let ce=I.get(ae);ce||(ce=[],I.set(ae,ce)),ce.push(J)}this.maxHeight=0;for(const{feature:M,id:$,index:V,sourceLayerIndex:q}of a){if(jU[M.type]==="LineString")continue;const Y=this.layers[0]._featureFilter.needGeometry,J=mt(M,Y);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom),J,f))continue;const ae=Y?J.geometry:It(M,f,p),ce=m1(ae,500);if(!ide(ae,163))continue;const de=this.layers[0],we=de.layout.get("building-roof-shape").evaluate(M,{},f);if(we==="flat")continue;const Te=de.layout.get("building-base").evaluate(M,{},f),Oe=de.layout.get("building-height").evaluate(M,{},f),Ue=de.layout.get("building-flood-light-ground-radius").evaluate(M,{},f),De=de.paint.get("building-ambient-occlusion-intensity"),Ge=Ue/this.tileToMeter;let Je=de.layout.get("building-flood-light-wall-radius").evaluate(M,{},f);Je=ve(Je,0,2048);const tt=Je/2048*E2,Et=T.get($);let ct;ct=I.has(Et)?I.get(Et):[];const Tt=ct.length!==0&&de.layout.get("building-facade").evaluate(M,{},f);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(Tt,!1,1);let kt=0,Dt=0,Zt=0,$t=0,Rt=0,Bt=0;if(Tt){let Ct=Math.round(de.layout.get("building-facade-floors").evaluate(M,{},f));if(Te===0){Ct=Math.max(1,Ct-(ct.length>0?1:0));let Ar=4;if(Oe>100){const Er=[10,13,15];Ar=Er[M.id?M.id%Er.length:0],_.setFacadeOptions(Ar,!0)}Rt=1.6803*Ar/b}else Rt=Te/b;Bt=Oe/b,Rt=Math.min(Rt,Bt),Zt=de.layout.get("building-facade-unit-width").evaluate(M,{},f)/b,$t=(Bt-Rt)/Ct,_.setFauxFacadeOptions(!0,!0,Zt);const ar=de.layout.get("building-facade-window").evaluate(M,{},f);kt=ar[0],Dt=ar[1]}const bt=[],yt=new Nt(1/0,1/0),Ft=new Nt(-1/0,-1/0),Gt=new Nt(0,0);let jt=0;for(const Ct of ce)if(Ct.length>0){const ar=[];for(const Ar of Ct){const Er=[];for(let rn=Ar.length-1;rn>=0;rn--){const Dr=Ar[rn];Er.push({x:Dr.x,y:Dr.y}),yt.x=Math.min(yt.x,Dr.x),yt.y=Math.min(yt.y,Dr.y),Ft.x=Math.max(Ft.x,Dr.x),Ft.y=Math.max(Ft.y,Dr.y),Gt.x+=Dr.x,Gt.y+=Dr.y,jt++}ar.push(Er)}bt.push({id:M.id?M.id:0,height:Oe,minHeight:Te,sourceId:0,roofType:we,coordinates:ar})}Gt.x/=jt||1,Gt.y/=jt||1;const pr=_.generateMesh(bt,ct);if(typeof pr=="string"){kr(`Unable to generate building ${M.id}: ${pr}`);continue}if(pr.meshes.length===0||pr.modifiedPolygonRings.length===0)continue;let vr=0;for(const Ct of pr.meshes)vr+=Ct.positions.length/3;const ur=Tt?this.buildingWithFacade:this.buildingWithoutFacade,ir=ur.segmentsBucket.prepareSegment(vr,ur.layoutVertexArray,ur.indexArray),Kr=[];let or=null,Or=0,Jr=-1;const yn=ur.layoutVertexArray.length,Fn=ur.indexArray.length;let tn=0;for(const Ct of pr.meshes){const ar=ur.layoutVertexArray.length;if(Ct.buildingPart==="entrance"){const wr=new Array;for(let Dn=0;Dn<Ct.positions.length;Dn+=12){const vi=Ct.positions[Dn+0],ni=Ct.positions[Dn+1],oa=Ct.positions[Dn+3],Bi=Ct.positions[Dn+4],Pi=Ct.positions[Dn+2],ci=Ct.positions[Dn+8]-Pi,Hn=1,nn=oa-vi,Kn=Bi-ni,Ci=Math.hypot(nn,Kn);wr.push({pos:[vi+.5*nn,ni+.5*Kn,Pi],normal:[Kn/Ci,-nn/Ci,0],width:Ci,height:ci,depth:Hn,points:[vi,ni,oa,Bi]})}const Vn=ur.entranceBloom.segmentsBucket.prepareSegment(10*wr.length,ur.entranceBloom.layoutVertexArray,ur.entranceBloom.indexArray),yi=ur.entranceBloom.layoutVertexArray.length;Or=ur.entranceBloom.indexArray.length,IU(wr,.5/this.tileToMeter,ur.entranceBloom.indexArray,ur.entranceBloom.layoutVertexArray,ur.entranceBloom.layoutAttenuationArray);const zr=ur.entranceBloom.layoutVertexArray.length-yi;Jr=ur.entranceBloom.indexArray.length-Or;for(let Dn=0;Dn<zr;Dn++)ur.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Vn.vertexLength+=zr,Vn.primitiveLength+=Jr,or={part:Ct.buildingPart,vertexOffset:yi,vertexLength:zr}}for(let wr=0;wr<Ct.positions.length;wr+=3)tn=Math.max(tn,Ct.positions[wr+2]),ur.layoutVertexArray.emplaceBack(Ct.positions[wr],Ct.positions[wr+1],Ct.positions[wr+2]);const Ar=Math.floor(Gt.x),Er=Math.floor(Gt.y),rn=Math.floor(tn);for(let wr=0;wr<Ct.positions.length;wr+=3)ur.layoutCentroidArray.emplaceBack(Ar,Er,rn),ur.layoutFloodLightDataArray.emplaceBack(Ct.buildingPart==="wall"?tt:0);for(let wr=0;wr<Ct.normals.length;wr+=3)ur.layoutNormalArray.emplaceBack(Ct.normals[wr+0]*E2,Ct.normals[wr+1]*E2,Ct.normals[wr+2]*E2);for(let wr=0;wr<Ct.ao.length;wr++)ur.layoutAOArray.emplaceBack(Ct.ao[wr]);for(let wr=0;wr<Ct.colors.length;wr+=3){const Vn=1+(Ct.ao[wr/3]-1)*De;ur.layoutColorArray.emplaceBack(Ct.colors[wr]*Vn<<8|Ct.colors[wr+1]*Vn,Ct.colors[wr+2]*Vn<<8)}if(Tt){for(let wr=0;wr<Ct.positions.length;wr+=3)ur.layoutFacadePaintArray.emplaceBack(65535,255);for(let wr=0;wr<Ct.isFauxFacade.length;wr++)if(Ct.isFauxFacade[wr]){const Vn=1|Math.min(65535,Math.floor(Ct.uv[2*wr]*pr.outerRingLength)),yi=Math.floor(255*kt)<<8|Math.floor(255*Dt),zr=Math.floor(65535*Math.min(1,Zt/Yt)),Dn=Math.floor(65535*Math.min(1,$t/Yt));ur.layoutFacadeDataArray.emplaceBack(Vn,yi,zr,Dn);const vi=Math.floor(65535*Math.min(1,Rt/Yt)),ni=Math.floor(65535*Math.min(1,Bt/Yt));ur.layoutFacadeVerticalRangeArray.emplaceBack(vi,ni)}else ur.layoutFacadeDataArray.emplaceBack(0,0,0,0),ur.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Dr=ir.vertexLength;for(let wr=0;wr<Ct.indices.length;wr+=3)ur.indexArray.emplaceBack(Dr+Ct.indices[wr],Dr+Ct.indices[wr+1],Dr+Ct.indices[wr+2]);ir.vertexLength+=Ct.positions.length/3,ir.primitiveLength+=Ct.indices.length/3,(Ct.buildingPart==="roof"||Ct.buildingPart==="wall"||Ct.buildingPart==="facade_glazing"||Ct.buildingPart==="entrance")&&Kr.push({part:Ct.buildingPart,vertexOffset:ar,vertexLength:Ct.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,tn),this.buildingFeatures.push({promoteId:$,feature:J,hasFauxFacade:Tt,segment:ir,parts:Kr,buildingBloom:or});const Wn=ur.indexArray.length-Fn,Gn=[],Yi=[],Le=new Nt(1/0,1/0),je=new Nt(-1/0,-1/0),Pt=this.groundEffect.vertexArray.length;for(const Ct of pr.modifiedPolygonRings){const ar=[],Ar=new Nt(1/0,1/0),Er=new Nt(-1/0,-1/0);for(let rn=0;rn<Ct.length;rn+=2){const Dr=Ct.length-rn-2;Ar.x=Math.min(Ar.x,Ct[Dr]),Ar.y=Math.min(Ar.y,Ct[Dr+1]),Er.x=Math.max(Er.x,Ct[Dr]),Er.y=Math.max(Er.y,Ct[Dr+1]);const wr=new Nt(Ct[Dr],Ct[Dr+1]);ar.push(wr),Gn.push(wr.x,wr.y),Yi.push(wr.clone())}Le.x=Math.min(Le.x,Ar.x),Le.y=Math.min(Le.y,Ar.y),je.x=Math.max(je.x,Er.x),je.y=Math.max(je.y,Er.y),this.groundEffect.addData(ar,[Ar,Er],Ge)}const rr=this.groundEffect.vertexArray.length-Pt;for(let Ct=0;Ct<rr;Ct++)this.groundEffect.groundRadiusArray.emplaceBack(Ue);(yt.x<0||Ft.x>Yt||yt.y<0||Ft.y>Yt)&&this.featuresOnBorder.push({featureId:M.id,footprintIndex:this.footprints.length});{const Ct=B_(Gn,null,2),ar=new c2(Yi,Ct,8,256);let Ar=M.id;M.properties&&M.properties.hasOwnProperty("building_id")&&(Ar=M.properties.building_id);const Er={vertices:Yi,indices:Ct,grid:ar,min:Le,max:je,buildingId:Ar,hiddenFlags:0,indicesOffset:Fn,indicesLength:Wn,bloomIndicesOffset:Or,bloomIndicesLength:Jr,groundEffectVertexOffset:Pt,groundEffectVertexLength:rr,hasFauxFacade:Tt,segment:ir,height:tn};M.id!==void 0&&this.featureFootprintLookup.set(M.id,this.footprints.length),this.footprints.push(Er)}this.programConfigurations.populatePaintArrays(ur.layoutVertexArray.length,M,V,{},c.availableImages,f,c.brightness),this.groundEffect.addPaintPropertiesData(M,V,{},c.availableImages,f,c.brightness),c.featureIndex.insert(M,ae,V,q,this.index,yn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(a,c,f,p,_,b,T){this.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T),this.groundEffect.update(a,c,_,f,p,b,T),this.evaluate(this.layers[0],a),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(a){const c=f=>{f.layoutVertexBuffer=a.createVertexBuffer(f.layoutVertexArray,kU.members),f.layoutNormalBuffer=a.createVertexBuffer(f.layoutNormalArray,Yue.members),f.layoutCentroidBuffer=a.createVertexBuffer(f.layoutCentroidArray,Jue.members),f.layoutFloodLightDataBuffer=a.createVertexBuffer(f.layoutFloodLightDataArray,nde.members),f.layoutFacadeDataArray&&f.layoutFacadeDataArray.length&&(f.layoutFacadeDataBuffer=a.createVertexBuffer(f.layoutFacadeDataArray,ede.members)),f.layoutFacadeVerticalRangeArray&&f.layoutFacadeVerticalRangeArray.length&&(f.layoutFacadeVerticalRangeBuffer=a.createVertexBuffer(f.layoutFacadeVerticalRangeArray,tde.members)),f.entranceBloom.layoutVertexArray.length&&(f.entranceBloom.layoutVertexBuffer=a.createVertexBuffer(f.entranceBloom.layoutVertexArray,kU.members),f.entranceBloom.layoutAttenuationBuffer=a.createVertexBuffer(f.entranceBloom.layoutAttenuationArray,rde.members)),this.uploadUpdatedColorBuffer(a),this.uploadUpdatedIndexBuffer(a)};this.uploaded||(c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.groundEffect.upload(a)),this.groundEffect.uploadPaintProperties(a),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){const a=c=>{c.layoutVertexBuffer&&(c.layoutVertexBuffer.destroy(),c.layoutNormalBuffer.destroy(),c.layoutColorBuffer.destroy(),c.segmentsBucket.destroy(),c.indexBuffer&&c.indexBuffer.destroy(),c.entranceBloom.layoutVertexBuffer&&(c.entranceBloom.layoutVertexBuffer.destroy(),c.entranceBloom.layoutColorBuffer.destroy(),c.entranceBloom.layoutAttenuationBuffer.destroy(),c.entranceBloom.indexBuffer.destroy(),c.entranceBloom.segmentsBucket.destroy()))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(a,c,f=!0){let p=!1;const _=f?c:0,b=0|(f?-1:~c);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const T of a){const I=this.footprints[T],M=I.hiddenFlags&b|_;I.hiddenFlags!==M&&(I.hiddenFlags=M,p=!0,this.groundEffect.updateHiddenByLandmarkRange(I.groundEffectVertexOffset,I.groundEffectVertexLength,I.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(a){if(this.groundEffect.uploadHiddenByLandmark(a),this.indexArrayForConflationUploaded)return;const c=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};c(this.buildingWithoutFacade),c(this.buildingWithFacade);for(const p of this.footprints){const _=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,b=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let I=p.indicesOffset;I<b;I++)_.indexArrayForConflation.uint16[3*I+0]=0,_.indexArrayForConflation.uint16[3*I+1]=0,_.indexArrayForConflation.uint16[3*I+2]=0;const T=p.bloomIndicesOffset+p.bloomIndicesLength;for(let I=p.bloomIndicesOffset;I<T;I++)_.entranceBloom.indexArrayForConflation.uint16[3*I+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*I+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*I+2]=0}}const f=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=a.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=a.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};f(this.buildingWithoutFacade),f(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(a){const c=f=>{f.layoutColorBuffer?f.layoutColorBuffer.updateData(f.layoutColorArray):f.layoutColorBuffer=a.createVertexBuffer(f.layoutColorArray,RU.members,!0),f.layoutFacadePaintArray&&(f.layoutFacadePaintBuffer?f.layoutFacadePaintBuffer.updateData(f.layoutFacadePaintArray):f.layoutFacadePaintBuffer=a.createVertexBuffer(f.layoutFacadePaintArray,Que.members,!0)),f.entranceBloom.layoutColorBuffer?f.entranceBloom.layoutColorBuffer.updateData(f.entranceBloom.layoutColorArray):f.entranceBloom.layoutColorBuffer=a.createVertexBuffer(f.entranceBloom.layoutColorArray,RU.members,!0)};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(a,c){const f=a.paint.get("building-ambient-occlusion-intensity");for(const p of this.buildingFeatures){const _=c[p.promoteId],b=p.feature;b.properties["building-part"]="roof";const T=a.paint.get("building-color").evaluate(b,_,this.canonical).toPremultipliedRenderColor(this.lut),I=a.paint.get("building-emissive-strength").evaluate(b,_,this.canonical);b.properties["building-part"]="wall";const M=a.paint.get("building-color").evaluate(b,_,this.canonical).toPremultipliedRenderColor(this.lut),$=a.paint.get("building-emissive-strength").evaluate(b,_,this.canonical);b.properties["building-part"]="window";const V=a.paint.get("building-color").evaluate(b,_,this.canonical).toPremultipliedRenderColor(this.lut),q=a.paint.get("building-emissive-strength").evaluate(b,_,this.canonical);b.properties["building-part"]="door";const Y=a.paint.get("building-color").evaluate(b,_,this.canonical).toPremultipliedRenderColor(this.lut),J=a.paint.get("building-emissive-strength").evaluate(b,_,this.canonical),ae=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const de of p.parts){let we,Te=T;de.part==="roof"?(Te=T,we=I):de.part==="wall"?(Te=M,we=$):de.part==="facade_glazing"?(Te=V,we=q):de.part==="entrance"&&(Te=Y,we=J),we=ve(we,0,1);for(let Oe=0;Oe<de.vertexLength;Oe++){const Ue=de.vertexOffset+Oe,De=1+(ae.layoutAOArray.float32[Ue]-1)*f;ae.layoutColorArray.emplace(Ue,Te.r*De*255<<8|Te.g*De*255,Te.b*De*255<<8|255*we),p.hasFauxFacade&&ae.layoutFacadePaintArray.emplace(Ue,255*V.r<<8|255*V.g,255*V.b<<8|255*q)}}const ce=p.buildingBloom;if(ce)for(let de=0;de<ce.vertexLength;de++)ae.entranceBloom.layoutColorArray.emplace(ce.vertexOffset+de,255*Y.r<<8|255*Y.g,255*Y.b<<8|51*J)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(a,c,f){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const p=c.getReplacementRegionsForTile(a.toUnwrapped());if(d2(this.activeReplacements,p))return;this.activeReplacements=p;for(const b of this.footprints)b.hiddenFlags&=-2;const _=[];for(const b of this.activeReplacements){if(b.order<=D$)continue;const T=Math.max(1,Math.pow(2,b.footprintTileId.canonical.z-a.canonical.z));for(const I of this.footprints)I.min.x>b.max.x||I.max.x<b.min.x||I.min.y>b.max.y||I.max.y<b.min.y||(_.length=0,ade(I.vertices,0,I.vertices.length,b.footprintTileId.canonical,a.canonical,_),Dj(b.footprint,_,I.indices,0,I.indices.length,0,-T)&&(I.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(a){if(a.id!==void 0){const c=this.featureFootprintLookup.get(a.id);return this.footprints[c]}return null}getHeightAtTileCoord(a,c){let f=Number.NEGATIVE_INFINITY,p=!0;const _=4*(a+Yt)*Yt+(c+Yt);if(this.footprintLookup.hasOwnProperty(_)){const T=this.footprintLookup[_];return T?{height:T.height,hidden:T.hiddenFlags!==0}:void 0}const b=new Nt(a,c);for(const T of this.footprints)a>T.max.x||T.min.x>a||c>T.max.y||T.min.y>c||T.height<=f||Lj(b,T)&&(f=T.height,this.footprintLookup[_]=T,p=T.hiddenFlags!==0);if(f!==Number.NEGATIVE_INFINITY)return{height:f,hidden:p};this.footprintLookup[_]=void 0}}function ade(u,a,c,f,p,_){const b=Math.pow(2,f.z-p.z);for(let T=0;T<c;T++){let I=u[T+a].x,M=u[T+a].y;I=(I+p.x*Yt)*b-f.x*Yt,M=(M+p.y*Yt)*b-f.y*Yt,_.push(new Nt(I,M))}}let DU,LU;gr(MU,"BuildingBucket",{omit:["layers"]}),gr(rN,"BuildingGeometry"),gr(NU,"BuildingBloomGeometry");const ode=En([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),sde=En([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:lde}=ode,cde=En([{name:"a_packed",components:3,type:"Float32"}]),{members:ude}=cde,dde=En([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:hde}=dde;class FU{constructor(a,c){this.width=a,this.height=c,this.nextRow=0,this.image=new jp({width:a,height:c}),this.positions={},this.uploaded=!1}getDash(a,c){const f=this.getKey(a,c);return this.positions[f]}trim(){const a=this.width,c=this.height=it(this.nextRow);this.image.resize({width:a,height:c})}getKey(a,c){return a.join(",")+c}getDashRanges(a,c,f){const p=[];let _=a.length%2==1?-a[a.length-1]*f:0,b=a[0]*f,T=!0;p.push({left:_,right:b,isDash:T,zeroLength:a[0]===0});let I=a[0];for(let M=1;M<a.length;M++){T=!T;const $=a[M];_=I*f,I+=$,b=I*f,p.push({left:_,right:b,isDash:T,zeroLength:$===0})}return p}addRoundDash(a,c,f){const p=c/2;for(let _=-f;_<=f;_++){const b=this.width*(this.nextRow+f+_);let T=0,I=a[T];for(let M=0;M<this.width;M++){M/I.right>1&&(I=a[++T]);const $=Math.abs(M-I.left),V=Math.abs(M-I.right),q=Math.min($,V);let Y;const J=_/f*(p+1);if(I.isDash){const ae=p-Math.abs(J);Y=Math.sqrt(q*q+ae*ae)}else Y=p-Math.sqrt(q*q+J*J);this.image.data[b+M]=Math.max(0,Math.min(255,Y+128))}}}addRegularDash(a,c){for(let I=a.length-1;I>=0;--I){const M=a[I],$=a[I+1];M.zeroLength?a.splice(I,1):$&&$.isDash===M.isDash&&($.left=M.left,a.splice(I,1))}const f=a[0],p=a[a.length-1];f.isDash===p.isDash&&(f.left=p.left-this.width,p.right=f.right+this.width);const _=this.width*this.nextRow;let b=0,T=a[b];for(let I=0;I<this.width;I++){I/T.right>1&&(T=a[++b]);const M=Math.abs(I-T.left),$=Math.abs(I-T.right),V=Math.min(M,$);this.image.data[_+I]=Math.max(0,Math.min(255,(T.isDash?V:-V)+c+128))}}addDash(a,c){const f=this.getKey(a,c);if(this.positions[f])return this.positions[f];const p=c==="round",_=p?7:0,b=2*_+1;if(this.nextRow+b>this.height)return kr("LineAtlas out of space"),null;a.length===0&&a.push(1);let T=0;for(let $=0;$<a.length;$++)a[$]<0&&(kr("Negative value is found in line dasharray, replacing values with 0"),a[$]=0),T+=a[$];if(T!==0){const $=this.width/T,V=this.getDashRanges(a,this.width,$);p?this.addRoundDash(V,$,_):this.addRegularDash(V,c==="square"?.5*$:0)}const I=this.nextRow+_;this.nextRow+=b;const M={tl:[I,_],br:[T,0]};return this.positions[f]=M,M}}gr(FU,"LineAtlas");const fde=Lt.types,pde=Math.cos(Math.PI/180*37.5),mde=Math.cos(Math.PI/180*5);class nN{constructor(a){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=a.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=a.overscaling,this.pixelRatio=a.pixelRatio,this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.index=a.index,this.projection=a.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new A_,this.layoutVertexArray2=new wl,this.patternVertexArray=new wl,this.indexArray=new Gi,this.programConfigurations=new Ic(a.layers,{zoom:a.zoom,lut:a.lut}),this.segments=new ea,this.maxLineLength=0,this.zOffsetVertexArray=new wl,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.tessellationStep=a.tessellationStep?a.tessellationStep:Yt/64,this.worldview=a.worldview,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.hasPattern=Ij("line",this.layers,this.pixelRatio,c);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=qe(f);const b=this.layers[0].layout.get("line-elevation-reference");if(b==="hd-road-markup")this.elevationType="road";else{const q=this.layers[0].layout.get("line-z-offset"),Y=q.isConstant()&&!q.constantOr(0);this.elevationType=b!=="sea"&&b!=="ground"&&Y?"none":"offset",this.elevationType==="offset"&&b==="none"&&kr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const T=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&T!==void 0;const I=[];for(const{feature:q,id:Y,index:J,sourceLayerIndex:ae}of a){const ce=this.layers[0]._featureFilter.needGeometry,de=mt(q,ce);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),de,f))continue;const we=_?_.evaluate(de,{},f):void 0,Te={id:Y,properties:q.properties,type:q.type,sourceLayerIndex:ae,index:J,geometry:ce?de.geometry:It(q,f,p),patterns:{},sortKey:we};I.push(Te)}_&&I.sort((q,Y)=>q.sortKey-Y.sortKey);const{lineAtlas:M,featureIndex:$}=c,V=this.addConstantDashes(M);for(const q of I){const{geometry:Y,index:J,sourceLayerIndex:ae}=q;if(V&&this.addFeatureDashes(q,M),this.hasPattern){const ce=kj("line",this.layers,q,this.zoom,this.pixelRatio,c);this.patternFeatures.push(ce)}else this.addFeature(q,Y,J,f,M.positions,c.availableImages,c.brightness,c.elevationFeatures);$.insert(a[J].feature,Y,J,ae,this.index)}}addConstantDashes(a){let c=!1;for(const f of this.layers){const p=f.paint.get("line-dasharray").value,_=f.layout.get("line-cap").value;if(p.kind!=="constant"||_.kind!=="constant")c=!0;else{const b=_.value,T=p.value;if(!T)continue;a.addDash(T,b)}}return c}addFeatureDashes(a,c){const f=this.zoom;for(const p of this.layers){const _=p.paint.get("line-dasharray").value,b=p.layout.get("line-cap").value;if(_.kind==="constant"&&b.kind==="constant")continue;let T,I;if(_.kind==="constant"){if(T=_.value,!T)continue}else T=_.evaluate({zoom:f},a);I=b.kind==="constant"?b.value:b.evaluate({zoom:f},a),c.addDash(T,I),a.patterns[p.id]=[c.getKey(T,I)]}}update(a,c,f,p,_,b,T,I){this.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,I)}addFeatures(a,c,f,p,_,b){for(const T of this.patternFeatures)this.addFeature(T,T.geometry,T.index,c,f,p,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,ude)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=a.createVertexBuffer(this.patternVertexArray,hde)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,sde.members,!0)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,lde),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a,c){let f,p;if(c&&c>0?(f=`mapbox_clip_start_${c}`,p=`mapbox_clip_end_${c}`):(f="mapbox_clip_start",p="mapbox_clip_end"),a.properties&&a.properties.hasOwnProperty(f)&&a.properties.hasOwnProperty(p))return{start:+a.properties[f],end:+a.properties[p]}}addFeature(a,c,f,p,_,b,T,I){const M=this.layers[0].layout,$=M.get("line-join").evaluate(a,{}),V=M.get("line-cap").evaluate(a,{}),q=M.get("line-miter-limit"),Y=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(a),this.lineFeature=a;const J=!(!a.properties||!a.properties.hasOwnProperty("mapbox_line_metrics"))&&a.properties.mapbox_line_metrics;this.zOffsetValue=M.get("line-z-offset").value;const ae=this.layers[0].paint.get("line-width").value;if(ae.kind!=="constant"&&ae.isLineProgressConstant===!1&&(this.variableWidthValue=ae),this.elevationType==="road"){const ce=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(a,c,p,I,$,V,q,Y)){const[de,we]=this.clipRuntimeLinesToTile(c,1);for(let Te=0;Te<de.length;Te++){const Oe=de[Te],Ue=we[Te],De={progress:{min:Ue.progress.min,max:Ue.progress.max},nextDir:this.computeSegNextDir(Ue,Oe),prevDir:this.computeSegPrevDir(Ue,Oe)};this.addLine(Oe,a,p,$,V,q,Y,De,J&&Ue.parentIndex>0?Ue.parentIndex:null)}this.fillNonElevatedRoadSegment(ce)}}else for(let ce=0;ce<c.length;ce++)this.addLine(c[ce],a,p,$,V,q,Y,void 0,J&&ce>0?ce:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,_,b,p,T,void 0,this.worldview)}computeSegNextDir(a,c){return a.nextPoint.sub(c.at(-2)).unit()}computeSegPrevDir(a,c){return c[1].sub(a.prevPoint).unit()}clipLinesToTile(a,c){return p2(a,-c,-c,Yt+c,Yt+c)}clipRuntimeLinesToTile(a,c){const f=[];return[p2(a,-c,-c,Yt+c,Yt+c,f),f]}addElevatedRoadFeature(a,c,f,p,_,b,T,I){const M=[],$=Hr.getElevationFeature(a,p);if($){const V=this.clipLinesToTile(c,1),q=this.prepareElevatedLines(V,$,f);for(const Y of q)M.push({geometry:Y,elevation:$,elevationTileID:f,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(M.length===0)return!1;for(const V of M){const q=this.layoutVertexArray.length;this.addLine(V.geometry,a,f,_,b,T,I);const Y=new Ln(f,V.elevationTileID);if(V.elevation)for(let J=q;J<this.layoutVertexArray.length;J++){const ae=new Nt(this.layoutVertexArray.int16[6*J]>>1,this.layoutVertexArray.int16[6*J+1]>>1),ce=Y.pointElevation(ae,V.elevation,.05);this.updateHeightRange(ce),this.zOffsetVertexArray.emplaceBack(ce,0,0)}else this.fillNonElevatedRoadSegment(q)}return!0}prepareElevatedLines(a,c,f){if(c.constantHeight!=null)return a;const p=[],_=1/qe(f);for(const b of a)Pue(b,new Ni(c,_),0,p);return p}fillNonElevatedRoadSegment(a){for(let c=a;c<this.layoutVertexArray.length;c++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(a){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,a),this.heightRange.max=Math.max(this.heightRange.max,a)):this.heightRange={min:a,max:a}}addLine(a,c,f,p,_,b,T,I,M){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=M?this.lineFeatureClips(c,M):this.lineClips;const $=p==="none";this.patternJoinNone=this.hasPattern&&$,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const V=I&&I.progress.min>0,q=I&&I.progress.max<1;if(this.lineClips){let tt={min:this.lineClips.start,max:this.lineClips.end},Et=1;if(I){const kt=this.lineClips.end-this.lineClips.start;tt=function(Dt,Zt,$t){return{min:gi(Dt.min,Zt,$t),max:gi(Dt.max,Zt,$t)}}(I.progress,{min:0,max:1},tt),kt>0&&(Et=(tt.max-tt.min)/kt)}const ct=+c.properties.mapbox_clip_feature_len,Tt=+c.properties.mapbox_clip_seg_len;if(Number.isNaN(ct)||Number.isNaN(Tt)){for(let Dt=0;Dt<a.length-1;Dt++)this.totalDistance+=a[Dt].dist(a[Dt+1]);const kt=this.totalDistance/(tt.max-tt.min);this.totalFeatureLength=Number.isFinite(kt)?kt:0,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ct,this.distance=Tt*Et,this.lineClips.start=tt.min,this.lineClips.end=tt.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Y=fde[c.type]==="Polygon";let J=a.length;for(;J>=2&&a[J-1].equals(a[J-2]);)J--;let ae=0;for(;ae<J-1&&a[ae].equals(a[ae+1]);)ae++;if(J<(Y?3:2))return;p==="bevel"&&(b=1.05);const ce=this.segments.prepareSegment(10*J,this.layoutVertexArray,this.indexArray);let de,we,Te,Oe,Ue,De,Ge,Je;I&&I.prevDir&&(De=I.prevDir.perp()),I&&I.nextDir&&(Ge=I.nextDir.perp()),this.e1=this.e2=-1,Y&&(de=a[J-2],Ue=a[ae].sub(de)._unit()._perp());for(let tt=ae;tt<J;tt++){if(Te=tt===J-1?Y?a[ae+1]:void 0:a[tt+1],Te&&a[tt].equals(Te))continue;Ue&&(Oe=Ue),de&&(we=de),de=a[tt],Je=this.evaluateLineProgressFeatures(we?we.dist(de):0),Ue=Te?Te.sub(de)._unit()._perp():Oe,Oe=Oe||Ue;const Et=we&&Te;let ct=Et?p:Y||$?"butt":_;const Tt=Oe.x*Ue.x+Oe.y*Ue.y;if($){const yt=function(Ft){if(Ft.patternJoinNone){const Gt=Ft.segmentPoints.length/2,jt=Ft.lineSoFar-Ft.segmentStart;for(let pr=0;pr<Gt;++pr){const vr=Ft.segmentPoints[2*pr+1],ur=Math.round(Ft.segmentPoints[2*pr])+.5+.25*vr;Ft.patternVertexArray.emplaceBack(ur,jt,Ft.segmentStart),Ft.patternVertexArray.emplaceBack(ur,jt,Ft.segmentStart)}Ft.segmentPoints.length=0}Ft.e1=Ft.e2=-1};if(Et&&Tt<mde){this.updateDistance(we,de),this.addCurrentVertex(de,Oe,1,1,ce,Je),yt(this),this.addCurrentVertex(de,Ue,-1,-1,ce,Je);continue}if(we){if(!Te){this.updateDistance(we,de),this.addCurrentVertex(de,Oe,1,1,ce,Je),yt(this);continue}ct="miter"}}let kt=Oe.add(Ue);kt.x===0&&kt.y===0||kt._unit();const Dt=kt.x*Ue.x+kt.y*Ue.y,Zt=Dt!==0?1/Dt:1/0,$t=2*Math.sqrt(2-2*Dt),Rt=Dt<pde&&we&&Te,Bt=Oe.x*Ue.y-Oe.y*Ue.x>0,bt=this.overscaling<=16?15*Yt/(512*this.overscaling):0;if(Et&&ct==="round"){if(Zt<T)ct="miter";else if(Zt<=2){const yt=iN(de,-10,Yt+10);ct=this.elevationType==="offset"&&(yt||this.hasCrossSlope)?"miter":"fakeround"}}if(ct==="miter"&&Zt>b&&(ct="bevel"),ct==="bevel"&&(Zt>2&&(ct="flipbevel"),Zt<b&&(ct="miter")),we&&!(ct==="miter"&&Rt)&&this.updateDistance(we,de),ct==="miter")if(Rt){const yt=de.dist(we);if(yt>2*bt){const Gt=de.sub(de.sub(we)._mult(bt/yt)._round());this.updateDistance(we,Gt),this.addCurrentVertex(Gt,Oe,0,0,ce,Je),we=Gt}this.updateDistance(we,de),kt._mult(Zt),this.addCurrentVertex(de,kt,0,0,ce,Je);const Ft=de.dist(Te);if(Ft>2*bt){const Gt=de.add(Te.sub(de)._mult(bt/Ft)._round());this.updateDistance(de,Gt),this.addCurrentVertex(Gt,Ue,0,0,ce,Je),de=Gt}}else kt._mult(Zt),this.addCurrentVertex(de,kt,0,0,ce,Je);else if(ct==="flipbevel"){if(Zt>100)kt=Ue.mult(-1);else{const yt=Zt*Oe.add(Ue).mag()/Oe.sub(Ue).mag();kt._perp()._mult(yt*(Bt?-1:1))}this.addCurrentVertex(de,kt,0,0,ce,Je),this.addCurrentVertex(de,kt.mult(-1),0,0,ce,Je)}else if(ct==="bevel"||ct==="fakeround"){Je!=null&&we&&this.addCurrentVertex(de,Ge||Oe,-1,-1,ce,Je);const yt=de.dist(we)<=2*bt&&ct!=="bevel",Ft=kt.mult(Bt?1:-1);Ft._mult(Zt);const Gt=Ue.mult(Bt?-1:1),jt=Oe.mult(Bt?-1:1),pr=this.evaluateLineProgressFeatures(this.distance);if(Je==null&&(this.addHalfVertex(de,Ft.x,Ft.y,!1,!Bt,0,ce,pr),yt||this.addHalfVertex(de,Ft.x+2*jt.x,Ft.y+2*jt.y,!1,Bt,0,ce,pr)),ct==="fakeround"){const vr=Math.round(180*$t/Math.PI/20);this.addHalfVertex(de,jt.x,jt.y,!1,Bt,0,ce,pr);for(let ur=0;ur<vr;ur++){let ir=ur/vr;if(ir!==.5){const or=ir-.5;ir+=ir*or*(ir-1)*((1.0904+Tt*(Tt*(3.55645-1.43519*Tt)-3.2452))*or*or+(.848013+Tt*(.215638*Tt-1.06021)))}const Kr=Gt.sub(jt)._mult(ir)._add(jt)._unit();this.addHalfVertex(de,Kr.x,Kr.y,!1,Bt,0,ce,pr)}this.addHalfVertex(de,Gt.x,Gt.y,!1,Bt,0,ce,pr)}yt||Je!=null||this.addHalfVertex(de,Ft.x+2*Gt.x,Ft.y+2*Gt.y,!1,Bt,0,ce,pr),Je!=null&&Te&&this.addCurrentVertex(de,De||Ue,1,1,ce,Je)}else if(ct==="butt")this.addCurrentVertex(de,kt,0,0,ce,Je);else if(ct==="square"){if(!we){const yt=V?0:-1;this.addCurrentVertex(de,kt,yt,yt,ce,Je)}if(this.addCurrentVertex(de,kt,0,0,ce,Je),we){const yt=q?0:1;this.addCurrentVertex(de,kt,yt,yt,ce,Je)}}else if(ct==="round"){if(we){const yt=!Et&&Ge?Ge:Oe;this.addCurrentVertex(de,yt,0,0,ce,Je),!Et&&q||this.addCurrentVertex(de,yt,1,1,ce,Je,!0)}if(Te){const yt=!Et&&De?De:Ue;!Et&&V||this.addCurrentVertex(de,yt,-1,-1,ce,Je,!0),this.addCurrentVertex(de,yt,0,0,ce,Je)}}}}addVerticesTo(a,c,f,p,_,b,T,I,M,$){const V=(c.w-a.w)/this.tessellationStep|0;let q=0;const Y=this.scaledDistance;if(V>1){this.lineSoFar=a.w;const ae=(c.x-a.x)/V,ce=(c.y-a.y)/V,de=(c.z-a.z)/V,we=(c.w-a.w)/V;for(let Te=1;Te<V;++Te){a.x+=ae,a.y+=ce,a.z+=de,this.lineSoFar+=we,q+=we;const Oe=this.evaluateLineProgressFeatures(this.prevDistance+q);this.scaledDistance=(this.prevDistance+q)/this.totalDistance,this.addHalfVertex(a,f,p,$,!1,T,M,Oe),this.addHalfVertex(a,_,b,$,!0,-I,M,Oe)}}this.lineSoFar=c.w,this.scaledDistance=Y;const J=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(c,f,p,$,!1,T,M,J),this.addHalfVertex(c,_,b,$,!0,-I,M,J)}evaluateLineProgressFeatures(a){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+a)/this.totalFeatureLength):kr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let c=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(c=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:c}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:c}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:c}}addCurrentVertex(a,c,f,p,_,b,T=!1){const I=c.x+c.y*f,M=c.y-c.x*f,$=c.y*p-c.x,V=-c.y-c.x*p;if(b!=null){const q=this.elevationType==="offset",Y=-10,J=Yt+10,ae=b.zOffset,ce=new aU(a.x,a.y,ae,this.lineSoFar),de=!!q&&iN(a,Y,J),we=this.lineSoFar,Te=this.distance;if(this.currentVertex)if(de){const Oe=this.currentVertexIsOutside,Ue=this.currentVertex,De=new aU(a.x,a.y,ae,this.lineSoFar);if(sU(Ue,De,Y,J),!iN(De,Y,J)){if(Oe){this.e1=this.e2=-1,this.distance-=Ue.dist(ce),this.lineSoFar=Ue.w;const Ge=this.evaluateLineProgressFeatures(Ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ue,I,M,T,!1,f,_,Ge),this.addHalfVertex(Ue,$,V,T,!0,-p,_,Ge),this.prevDistance=this.distance}this.distance=this.prevDistance+Ue.dist(De),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ue,De,I,M,$,V,f,p,_,T),this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}}else{const Oe=this.currentVertex;if(this.currentVertexIsOutside){sU(Oe,ce,Y,J),this.e1=this.e2=-1,this.distance-=Oe.dist(ce),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Oe.w;const Ue=this.evaluateLineProgressFeatures(Oe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Oe,I,M,T,!1,f,_,Ue),this.addHalfVertex(Oe,$,V,T,!0,-p,_,Ue),this.prevDistance=this.distance,this.distance=Te,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Oe,ce,I,M,$,V,f,p,_,T)}else de||(this.addHalfVertex(a,I,M,T,!1,f,_,b),this.addHalfVertex(a,$,V,T,!0,-p,_,b));this.currentVertex=ce,this.currentVertexIsOutside=de,this.lineSoFar=we}else this.addHalfVertex(a,I,M,T,!1,f,_,b),this.addHalfVertex(a,$,V,T,!0,-p,_,b)}addHalfVertex({x:a,y:c},f,p,_,b,T,I,M){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),b||this.segmentPoints.push(this.lineSoFar-this.segmentStart,T)),this.layoutVertexArray.emplaceBack((a<<1)+(_?1:0),(c<<1)+(b?1:0),Math.round(63*f)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const V=$r(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,V)}const $=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,$),I.primitiveLength++),b?this.e2=$:this.e1=$,M!=null&&this.zOffsetVertexArray.emplaceBack(M.zOffset,M.variableWidth,M.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(a,c){this.prevDistance=this.distance,this.distance+=a.dist(c),this.updateScaledDistance()}}function iN(u,a,c){return u.x<a||u.x>c||u.y<a||u.y>c}let zU,BU;function $U(u,a,c){return a*(Yt/(u.tileSize*Math.pow(2,c-u.tileID.overscaledZ)))}gr(nN,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const UU=(u,a,c)=>(1-c)*u+c*a;function VU(u,a){return 1/$U(u,1,a.tileZoom)}function qU(u,a,c,f){return u.translatePosMatrix(f||a.tileID.projMatrix,a,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const WU=u=>{const a=[];GU(u)&&a.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&a.push("RENDER_LINE_GRADIENT");const c=u.paint.get("line-trim-offset");c[0]===0&&c[1]===0||a.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&a.push("RENDER_LINE_BORDER");const f=u.layout.get("line-join").constantOr("miter")==="none",p=!!u.paint.get("line-pattern").constantOr(1);return f&&p&&a.push("LINE_JOIN_NONE"),a};function GU(u){const a=u.paint.get("line-dasharray").value;return a.kind!=="constant"||a.value}let aN;const HU=()=>aN||(aN={layout:zU||(zU=new la({"line-cap":new sr(lt.layout_line["line-cap"]),"line-join":new sr(lt.layout_line["line-join"]),"line-miter-limit":new qt(lt.layout_line["line-miter-limit"]),"line-round-limit":new qt(lt.layout_line["line-round-limit"]),"line-sort-key":new sr(lt.layout_line["line-sort-key"]),"line-z-offset":new sr(lt.layout_line["line-z-offset"]),"line-elevation-reference":new qt(lt.layout_line["line-elevation-reference"]),"line-cross-slope":new qt(lt.layout_line["line-cross-slope"]),visibility:new qt(lt.layout_line.visibility),"line-width-unit":new qt(lt.layout_line["line-width-unit"])})),paint:BU||(BU=new la({"line-opacity":new sr(lt.paint_line["line-opacity"]),"line-color":new sr(lt.paint_line["line-color"]),"line-translate":new qt(lt.paint_line["line-translate"]),"line-translate-anchor":new qt(lt.paint_line["line-translate-anchor"]),"line-width":new sr(lt.paint_line["line-width"]),"line-gap-width":new sr(lt.paint_line["line-gap-width"]),"line-offset":new sr(lt.paint_line["line-offset"]),"line-blur":new sr(lt.paint_line["line-blur"]),"line-dasharray":new sr(lt.paint_line["line-dasharray"]),"line-pattern":new sr(lt.paint_line["line-pattern"]),"line-pattern-cross-fade":new qt(lt.paint_line["line-pattern-cross-fade"]),"line-gradient":new yp(lt.paint_line["line-gradient"]),"line-trim-offset":new qt(lt.paint_line["line-trim-offset"]),"line-trim-fade-range":new qt(lt.paint_line["line-trim-fade-range"]),"line-trim-color":new qt(lt.paint_line["line-trim-color"]),"line-emissive-strength":new qt(lt.paint_line["line-emissive-strength"]),"line-border-width":new sr(lt.paint_line["line-border-width"]),"line-border-color":new sr(lt.paint_line["line-border-color"]),"line-occlusion-opacity":new qt(lt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},aN);class gde extends sr{possiblyEvaluate(a,c){return c=new ki(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,transition:c.transition,worldview:c.worldview}),super.possiblyEvaluate(a,c)}evaluate(a,c,f,p){return c=Object.assign({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(a,c,f,p)}}let P1;function KU(u,a){return a>0?a+2*u:u}const yde=En([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vde=En([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),_de=En([{name:"a_projected_pos",components:4,type:"Float32"}],4);En([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xde=En([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),bde=En([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),wde=En([{name:"a_texb",components:2,type:"Uint16"}]),Sde=En([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Ede=En([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ZU=En([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Tde=En([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);En([{name:"triangle",components:3,type:"Uint16"}]),En([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),En([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),En([{type:"Float32",name:"offsetX"}]),En([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Eo=24;function Ade(u,a,c){return u.sections.forEach(f=>{f.text=function(p,_,b){const T=_.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),Qs.applyArabicShaping&&(p=Qs.applyArabicShaping(p)),p}(f.text,a,c)}),u}const C1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Pde(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function Cde(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}const oN=4294967296,XU=1/oN,YU=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let T2=class{constructor(u=new Uint8Array(16)){this.buf=ArrayBuffer.isView(u)?u:new Uint8Array(u),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(u,a,c=this.length){for(;this.pos<c;){const f=this.readVarint(),p=f>>3,_=this.pos;this.type=7&f,u(p,a,this),this.pos===_&&this.skip(f)}return a}readMessage(u,a){return this.readFields(u,a,this.readVarint()+this.pos)}readFixed32(){const u=this.dataView.getUint32(this.pos,!0);return this.pos+=4,u}readSFixed32(){const u=this.dataView.getInt32(this.pos,!0);return this.pos+=4,u}readFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*oN;return this.pos+=8,u}readSFixed64(){const u=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*oN;return this.pos+=8,u}readFloat(){const u=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,u}readDouble(){const u=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,u}readVarint(u){const a=this.buf;let c,f;return f=a[this.pos++],c=127&f,f<128?c:(f=a[this.pos++],c|=(127&f)<<7,f<128?c:(f=a[this.pos++],c|=(127&f)<<14,f<128?c:(f=a[this.pos++],c|=(127&f)<<21,f<128?c:(f=a[this.pos],c|=(15&f)<<28,function(p,_,b){const T=b.buf;let I,M;if(M=T[b.pos++],I=(112&M)>>4,M<128||(M=T[b.pos++],I|=(127&M)<<3,M<128)||(M=T[b.pos++],I|=(127&M)<<10,M<128)||(M=T[b.pos++],I|=(127&M)<<17,M<128)||(M=T[b.pos++],I|=(127&M)<<24,M<128)||(M=T[b.pos++],I|=(1&M)<<31,M<128))return H_(p,I,_);throw new Error("Expected varint not more than 10 bytes")}(c,u,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const u=this.readVarint();return u%2==1?(u+1)/-2:u/2}readBoolean(){return!!this.readVarint()}readString(){const u=this.readVarint()+this.pos,a=this.pos;return this.pos=u,u-a>=12&&YU?YU.decode(this.buf.subarray(a,u)):function(c,f,p){let _="",b=f;for(;b<p;){const T=c[b];let I,M,$,V=null,q=T>239?4:T>223?3:T>191?2:1;if(b+q>p)break;q===1?T<128&&(V=T):q===2?(I=c[b+1],(192&I)==128&&(V=(31&T)<<6|63&I,V<=127&&(V=null))):q===3?(I=c[b+1],M=c[b+2],(192&I)==128&&(192&M)==128&&(V=(15&T)<<12|(63&I)<<6|63&M,(V<=2047||V>=55296&&V<=57343)&&(V=null))):q===4&&(I=c[b+1],M=c[b+2],$=c[b+3],(192&I)==128&&(192&M)==128&&(192&$)==128&&(V=(15&T)<<18|(63&I)<<12|(63&M)<<6|63&$,(V<=65535||V>=1114112)&&(V=null))),V===null?(V=65533,q=1):V>65535&&(V-=65536,_+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),_+=String.fromCharCode(V),b+=q}return _}(this.buf,a,u)}readBytes(){const u=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,u);return this.pos=u,a}readPackedVarint(u=[],a){const c=this.readPackedEnd();for(;this.pos<c;)u.push(this.readVarint(a));return u}readPackedSVarint(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSVarint());return u}readPackedBoolean(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readBoolean());return u}readPackedFloat(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFloat());return u}readPackedDouble(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readDouble());return u}readPackedFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed32());return u}readPackedSFixed32(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed32());return u}readPackedFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readFixed64());return u}readPackedSFixed64(u=[]){const a=this.readPackedEnd();for(;this.pos<a;)u.push(this.readSFixed64());return u}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(u){const a=7&u;if(a===0)for(;this.buf[this.pos++]>127;);else if(a===2)this.pos=this.readVarint()+this.pos;else if(a===5)this.pos+=4;else{if(a!==1)throw new Error(`Unimplemented type: ${a}`);this.pos+=8}}writeTag(u,a){this.writeVarint(u<<3|a)}realloc(u){let a=this.length||16;for(;a<this.pos+u;)a*=2;if(a!==this.length){const c=new Uint8Array(a);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=a}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeSFixed32(u){this.realloc(4),this.dataView.setInt32(this.pos,u,!0),this.pos+=4}writeFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*XU),!0),this.pos+=8}writeSFixed64(u){this.realloc(8),this.dataView.setInt32(this.pos,-1&u,!0),this.dataView.setInt32(this.pos+4,Math.floor(u*XU),!0),this.pos+=8}writeVarint(u){(u=+u||0)>268435455||u<0?function(a,c){let f,p;if(a>=0?(f=a%4294967296|0,p=a/4294967296|0):(f=~(-a%4294967296),p=~(-a/4294967296),4294967295^f?f=f+1|0:(f=0,p=p+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(_,b,T){T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,_>>>=7,T.buf[T.pos++]=127&_|128,T.buf[T.pos]=127&(_>>>=7)}(f,0,c),function(_,b){const T=(7&_)<<4;b.buf[b.pos++]|=T|((_>>>=3)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_|((_>>>=7)?128:0),_&&(b.buf[b.pos++]=127&_)))))}(p,c)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))}writeSVarint(u){this.writeVarint(u<0?2*-u-1:2*u)}writeBoolean(u){this.writeVarint(+u)}writeString(u){u=String(u),this.realloc(4*u.length),this.pos++;const a=this.pos;this.pos=function(f,p,_){for(let b,T,I=0;I<p.length;I++){if(b=p.charCodeAt(I),b>55295&&b<57344){if(!T){b>56319||I+1===p.length?(f[_++]=239,f[_++]=191,f[_++]=189):T=b;continue}if(b<56320){f[_++]=239,f[_++]=191,f[_++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(f[_++]=239,f[_++]=191,f[_++]=189,T=null);b<128?f[_++]=b:(b<2048?f[_++]=b>>6|192:(b<65536?f[_++]=b>>12|224:(f[_++]=b>>18|240,f[_++]=b>>12&63|128),f[_++]=b>>6&63|128),f[_++]=63&b|128)}return _}(this.buf,u,this.pos);const c=this.pos-a;c>=128&&JU(a,c,this),this.pos=a-1,this.writeVarint(c),this.pos+=c}writeFloat(u){this.realloc(4),this.dataView.setFloat32(this.pos,u,!0),this.pos+=4}writeDouble(u){this.realloc(8),this.dataView.setFloat64(this.pos,u,!0),this.pos+=8}writeBytes(u){const a=u.length;this.writeVarint(a),this.realloc(a);for(let c=0;c<a;c++)this.buf[this.pos++]=u[c]}writeRawMessage(u,a){this.pos++;const c=this.pos;u(a,this);const f=this.pos-c;f>=128&&JU(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f}writeMessage(u,a,c){this.writeTag(u,2),this.writeRawMessage(a,c)}writePackedVarint(u,a){a.length&&this.writeMessage(u,Ode,a)}writePackedSVarint(u,a){a.length&&this.writeMessage(u,Ide,a)}writePackedBoolean(u,a){a.length&&this.writeMessage(u,jde,a)}writePackedFloat(u,a){a.length&&this.writeMessage(u,kde,a)}writePackedDouble(u,a){a.length&&this.writeMessage(u,Rde,a)}writePackedFixed32(u,a){a.length&&this.writeMessage(u,Nde,a)}writePackedSFixed32(u,a){a.length&&this.writeMessage(u,Mde,a)}writePackedFixed64(u,a){a.length&&this.writeMessage(u,Dde,a)}writePackedSFixed64(u,a){a.length&&this.writeMessage(u,Lde,a)}writeBytesField(u,a){this.writeTag(u,2),this.writeBytes(a)}writeFixed32Field(u,a){this.writeTag(u,5),this.writeFixed32(a)}writeSFixed32Field(u,a){this.writeTag(u,5),this.writeSFixed32(a)}writeFixed64Field(u,a){this.writeTag(u,1),this.writeFixed64(a)}writeSFixed64Field(u,a){this.writeTag(u,1),this.writeSFixed64(a)}writeVarintField(u,a){this.writeTag(u,0),this.writeVarint(a)}writeSVarintField(u,a){this.writeTag(u,0),this.writeSVarint(a)}writeStringField(u,a){this.writeTag(u,2),this.writeString(a)}writeFloatField(u,a){this.writeTag(u,5),this.writeFloat(a)}writeDoubleField(u,a){this.writeTag(u,1),this.writeDouble(a)}writeBooleanField(u,a){this.writeVarintField(u,+a)}};function H_(u,a,c){return c?4294967296*a+(u>>>0):4294967296*(a>>>0)+(u>>>0)}function JU(u,a,c){const f=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));c.realloc(f);for(let p=c.pos-1;p>=u;p--)c.buf[p+f]=c.buf[p]}function Ode(u,a){for(let c=0;c<u.length;c++)a.writeVarint(u[c])}function Ide(u,a){for(let c=0;c<u.length;c++)a.writeSVarint(u[c])}function kde(u,a){for(let c=0;c<u.length;c++)a.writeFloat(u[c])}function Rde(u,a){for(let c=0;c<u.length;c++)a.writeDouble(u[c])}function jde(u,a){for(let c=0;c<u.length;c++)a.writeBoolean(u[c])}function Nde(u,a){for(let c=0;c<u.length;c++)a.writeFixed32(u[c])}function Mde(u,a){for(let c=0;c<u.length;c++)a.writeSFixed32(u[c])}function Dde(u,a){for(let c=0;c<u.length;c++)a.writeFixed64(u[c])}function Lde(u,a){for(let c=0;c<u.length;c++)a.writeSFixed64(u[c])}const sN=3;function Fde(u,a,c){a.glyphs=[],u===1&&c.readMessage(zde,a)}function zde(u,a,c){if(u===3){const{id:f,bitmap:p,width:_,height:b,left:T,top:I,advance:M}=c.readMessage(Bde,{});a.glyphs.push({id:f,bitmap:new jp({width:_+2*sN,height:b+2*sN},p),metrics:{width:_,height:b,left:T,top:I,advance:M}})}else u===4?a.ascender=c.readSVarint():u===5&&(a.descender=c.readSVarint())}function Bde(u,a,c){u===1?a.id=c.readVarint():u===2?a.bitmap=c.readBytes():u===3?a.width=c.readVarint():u===4?a.height=c.readVarint():u===5?a.left=c.readSVarint():u===6?a.top=c.readSVarint():u===7&&(a.advance=c.readVarint())}const QU=sN,Ol={horizontal:1,vertical:2,horizontalOnly:3};class O1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(a,c){const f=new O1;return f.scale=a||1,f.fontStack=c,f}static forImage(a){const c=new O1;return c.image=a,c}}class K_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,c,f){const p=new K_;for(let _=0;_<a.sections.length;_++){const b=a.sections[_];b.image?p.addImageSection(b,f):p.addTextSection(b,c)}return p}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSections(){return this.sections}getSectionIndex(a){return this.sectionIndex[a]}getCodePoint(a){return this.text.codePointAt(a)}verticalizePunctuation(a){this.text=function(c,f){let p="";for(let _=0;_<c.length;_++){const b=c.charCodeAt(_+1)||null,T=c.charCodeAt(_-1)||null;p+=!f&&(b&&jw(b)&&!C1[c[_+1]]||T&&jw(T)&&!C1[c[_-1]])||!C1[c[_]]?c[_]:C1[c[_]]}return p}(this.text,a)}trim(){let a=0;for(let f=0;f<this.text.length&&A2[this.text.charCodeAt(f)];f++)a++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=a&&A2[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(a,c),this.sectionIndex=this.sectionIndex.slice(a,c)}substring(a,c){const f=new K_;return f.text=this.text.substring(a,c),f.sectionIndex=this.sectionIndex.slice(a,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,c)=>Math.max(a,this.sections[c].scale),0)}addTextSection(a,c){this.text+=a.text,this.sections.push(O1.forText(a.scale,a.fontStack||c));const f=this.sections.length-1;for(let p=0;p<a.text.length;++p)this.sectionIndex.push(f)}addImageSection(a,c){const f=a.image?a.image.getPrimary():null;if(!f)return void kr("Can't add FormattedSection with an empty image.");f.scaleSelf(c);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(O1.forImage(f)),this.sectionIndex.push(this.sections.length-1)):kr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function lN(u,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae=1){const ce=K_.fromFeature(u,p,ae);V===Ol.vertical&&ce.verticalizePunctuation(q);let de=[];const we=function(Ge,Je,tt,Et,ct,Tt){if(!Ge)return[];const kt=[],Dt=function(Bt,bt,yt,Ft,Gt,jt){let pr=0;for(let vr=0;vr<Bt.length();vr++){const ur=Bt.getSection(vr);pr+=eV(Bt.getCodePoint(vr),ur,Ft,Gt,bt,jt)}return pr/Math.max(1,Math.ceil(pr/yt))}(Ge,Je,tt,Et,ct,Tt),Zt=Ge.text.indexOf("")>=0;let $t=0;for(let Bt=0;Bt<Ge.length();Bt++){const bt=Ge.getSection(Bt),yt=Ge.getCodePoint(Bt);if(A2[yt]||($t+=eV(yt,bt,Et,ct,Je,Tt)),Bt<Ge.length()-1){const Ft=!((Rt=yt)<11904||!(jr["Bopomofo Extended"](Rt)||jr.Bopomofo(Rt)||jr["CJK Compatibility Forms"](Rt)||jr["CJK Compatibility Ideographs"](Rt)||jr["CJK Compatibility"](Rt)||jr["CJK Radicals Supplement"](Rt)||jr["CJK Strokes"](Rt)||jr["CJK Symbols and Punctuation"](Rt)||jr["CJK Unified Ideographs Extension A"](Rt)||jr["CJK Unified Ideographs"](Rt)||jr["Enclosed CJK Letters and Months"](Rt)||jr["Halfwidth and Fullwidth Forms"](Rt)||jr.Hiragana(Rt)||jr["Ideographic Description Characters"](Rt)||jr["Kangxi Radicals"](Rt)||jr["Katakana Phonetic Extensions"](Rt)||jr.Katakana(Rt)||jr["Vertical Forms"](Rt)||jr["Yi Radicals"](Rt)||jr["Yi Syllables"](Rt)));($de[yt]||Ft||bt.image)&&kt.push(rV(Bt+1,$t,Dt,kt,Ude(yt,Ge.getCodePoint(Bt+1),Ft&&Zt),!1))}}var Rt;return nV(rV(Ge.length(),$t,Dt,kt,0,!0))}(ce,M,_,a,f,Y),{processBidirectionalText:Te,processStyledBidirectionalText:Oe}=Qs;if(Te&&ce.sections.length===1){const Ge=Te(ce.toString(),we);for(const Je of Ge){const tt=new K_;tt.text=Je,tt.sections=ce.sections;for(let Et=0;Et<Je.length;Et++)tt.sectionIndex.push(0);de.push(tt)}}else if(Oe){const Ge=Oe(ce.text,ce.sectionIndex,we);for(const Je of Ge){const tt=new K_;tt.text=Je[0],tt.sectionIndex=Je[1],tt.sections=ce.sections,de.push(tt)}}else de=function(Ge,Je){const tt=[],Et=Ge.text;let ct=0;for(const Tt of Je)tt.push(Ge.substring(ct,Tt)),ct=Tt;return ct<Et.length&&tt.push(Ge.substring(ct,Et.length)),tt}(ce,we);const Ue=[],De={positionedLines:Ue,text:ce.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Ge,Je,tt,Et,ct,Tt,kt,Dt,Zt,$t,Rt,Bt){let bt=0,yt=0,Ft=0;const Gt=Dt==="right"?1:Dt==="left"?0:.5;let jt=!1;for(const or of ct){const Or=or.getSections();for(const Jr of Or){if(Jr.image)continue;const yn=Je[Jr.fontStack];if(yn&&(jt=yn.ascender!==void 0&&yn.descender!==void 0,!jt))break}if(!jt)break}let pr=0;for(const or of ct){or.trim();const Or=or.getMaxScale(),Jr=(Or-1)*Eo,yn={positionedGlyphs:[],lineOffset:0};Ge.positionedLines[pr]=yn;const Fn=yn.positionedGlyphs;let tn=0;if(!or.length()){yt+=Tt,++pr;continue}let Wn=0,Gn=0;for(let Le=0;Le<or.length();Le++){const je=or.getSection(Le),Pt=or.getSectionIndex(Le),rr=or.getCodePoint(Le);let Ct=je.scale,ar=null,Ar=null,Er=null,rn=Eo,Dr=0,wr=Zt;wr===Ol.vertical&&((vr=rr)===12312||vr===12313||vr===12316||vr===12540||vr===12448)&&(wr=Ol.horizontal);const Vn=!(wr===Ol.horizontal||!Rt&&!b_(rr)||Rt&&(A2[rr]||Nw(rr)));if(je.image){const yi=Et.get(je.image.toString());if(!yi)continue;Er=je.image,Ge.iconsInText=Ge.iconsInText||!0,Ar=yi.paddedRect;const zr=yi.displaySize;Ct=Ct*Eo/Bt,ar={width:zr[0],height:zr[1],left:0,top:-QU,advance:Vn?zr[1]:zr[0],localGlyph:!1},Dr=jt?-ar.height*Ct:Or*Eo-17-zr[1]*Ct,rn=ar.advance;const Dn=(Vn?zr[0]:zr[1])*Ct-Eo*Or;Dn>0&&Dn>tn&&(tn=Dn)}else{const yi=tt[je.fontStack];if(!yi)continue;yi[rr]&&(Ar=yi[rr]);const zr=Je[je.fontStack];if(!zr)continue;const Dn=zr.glyphs[rr];if(!Dn)continue;if(ar=Dn.metrics,rn=rr!==8203?Eo:0,jt){const vi=zr.ascender!==void 0?Math.abs(zr.ascender):0,ni=zr.descender!==void 0?Math.abs(zr.descender):0,oa=(vi+ni)*Ct;Wn<oa&&(Wn=oa,Gn=(vi-ni)/2*Ct),Dr=-vi*Ct}else Dr=(Or-Ct)*Eo-17}Vn?(Ge.verticalizable=!0,Fn.push({glyph:rr,image:Er,x:bt,y:yt+Dr,vertical:Vn,scale:Ct,localGlyph:ar.localGlyph,fontStack:je.fontStack,sectionIndex:Pt,metrics:ar,rect:Ar}),bt+=rn*Ct+$t):(Fn.push({glyph:rr,image:Er,x:bt,y:yt+Dr,vertical:Vn,scale:Ct,localGlyph:ar.localGlyph,fontStack:je.fontStack,sectionIndex:Pt,metrics:ar,rect:Ar}),bt+=ar.advance*Ct+$t)}Fn.length!==0&&(Ft=Math.max(bt-$t,Ft),jt?iV(Fn,Gt,tn,Gn,Tt*Or/2):iV(Fn,Gt,tn,0,Tt/2)),bt=0;const Yi=Tt*Or+tn;yn.lineOffset=Math.max(tn,Jr),yt+=Yi,++pr}var vr;const ur=yt,{horizontalAlign:ir,verticalAlign:Kr}=cN(kt);(function(or,Or,Jr,yn,Fn,tn){const Wn=(Or-Jr)*Fn,Gn=-tn*yn;for(const Yi of or)for(const Le of Yi.positionedGlyphs)Le.x+=Wn,Le.y+=Gn})(Ge.positionedLines,Gt,ir,Kr,Ft,ur),Ge.top+=-Kr*ur,Ge.bottom=Ge.top+ur,Ge.left+=-ir*Ft,Ge.right=Ge.left+Ft,Ge.hasBaseline=jt}(De,a,c,f,de,b,T,I,V,M,q,J),!function(Ge){for(const Je of Ge)if(Je.positionedGlyphs.length!==0)return!1;return!0}(Ue))return De}const A2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},$de={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function eV(u,a,c,f,p,_){if(a.image){const b=f.get(a.image.toString());return b?b.displaySize[0]*a.scale*Eo/_+p:0}{const b=c[a.fontStack],T=b&&b.glyphs[u];return T?T.metrics.advance*a.scale+p:0}}function tV(u,a,c,f){const p=Math.pow(u-a,2);return f?u<a?p/2:2*p:p+Math.abs(c)*c}function Ude(u,a,c){let f=0;return u===10&&(f-=1e4),c&&(f+=150),u!==40&&u!==65288||(f+=50),a!==41&&a!==65289||(f+=50),f}function rV(u,a,c,f,p,_){let b=null,T=tV(a,c,p,_);for(const I of f){const M=tV(a-I.x,c,p,_)+I.badness;M<=T&&(b=I,T=M)}return{index:u,x:a,priorBreak:b,badness:T}}function nV(u){return u?nV(u.priorBreak).concat(u.index):[]}function cN(u){let a=.5,c=.5;switch(u){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:a,verticalAlign:c}}function iV(u,a,c,f,p){if(!(a||c||f||p))return;const _=u.length-1,b=u[_],T=(b.x+b.metrics.advance*b.scale)*a;for(let I=0;I<=_;I++)u[I].x-=T,u[I].y+=c+f+p}function aV(u){return u.imagePrimary!==void 0&&u.top!==void 0&&u.bottom!==void 0&&u.left!==void 0&&u.right!==void 0}function P2(u,a,c,f){const{horizontalAlign:p,verticalAlign:_}=cN(f),b=c[0]-u.displaySize[0]*p,T=c[1]-u.displaySize[1]*_;return{imagePrimary:u,imageSecondary:a,top:T,bottom:T+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function uN(u,a,c,f,p,_){const b=u.imagePrimary;let T;if(b.content){const ce=b.content,de=b.pixelRatio||1;T=[ce[0]/de,ce[1]/de,b.displaySize[0]-ce[2]/de,b.displaySize[1]-ce[3]/de]}const I=a.left*_,M=a.right*_;let $,V,q,Y;c==="width"||c==="both"?(Y=p[0]+I-f[3],V=p[0]+M+f[1]):(Y=p[0]+(I+M-b.displaySize[0])/2,V=Y+b.displaySize[0]);const J=a.top*_,ae=a.bottom*_;return c==="height"||c==="both"?($=p[1]+J-f[0],q=p[1]+ae+f[2]):($=p[1]+(J+ae-b.displaySize[1])/2,q=$+b.displaySize[1]),{imagePrimary:b,imageSecondary:void 0,top:$,right:V,bottom:q,left:Y,collisionPadding:T}}function oV(u){return!u.imagePrimary.stretchX}function sV(u){return!u.imagePrimary.stretchY}function lV(u){return{width:u.right-u.left,height:u.bottom-u.top}}const Qu=128;function Z_(u,a,c){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new ki(u+1,{worldview:c}))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:_}=f;let b=0;for(;b<p.length&&p[b]<=u;)b++;b=Math.max(0,b-1);let T=b;for(;T<p.length&&p[T]<u+1;)T++;T=Math.min(p.length-1,T);const I=p[b],M=p[T];return f.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:M,minSize:f.evaluate(new ki(I,{worldview:c})),maxSize:f.evaluate(new ki(M,{worldview:c})),interpolationType:_}}}function dN(u,{uSize:a,uSizeT:c},{lowerSize:f,upperSize:p}){return u.kind==="source"?f/Qu:u.kind==="composite"?$r(f/Qu,p/Qu,c):a}function X_(u,a,c=1){let f=0,p=0;if(u.kind==="constant")p=u.layoutSize*c;else if(u.kind!=="source"){const{interpolationType:_,minZoom:b,maxZoom:T}=u,I=_?ve(xl.interpolationFactor(_,a,b,T),0,1):0;u.kind==="camera"?p=$r(u.minSize,u.maxSize,I)*c:f=I*c}return{uSizeT:f,uSize:p}}class nf extends Nt{constructor(a,c,f,p,_){super(a,c),this.angle=p,this.z=f,_!==void 0&&(this.segment=_)}clone(){return new nf(this.x,this.y,this.z,this.angle,this.segment)}}function cV(u,a,c,f,p){if(a.segment===void 0)return!0;let _=a,b=a.segment+1,T=0;for(;T>-c/2;){if(b--,b<0)return!1;T-=u[b].dist(_),_=u[b]}T+=u[b].dist(u[b+1]),b++;const I=[];let M=0;for(;T<c/2;){const $=u[b],V=u[b+1];if(!V)return!1;let q=u[b-1].angleTo($)-$.angleTo(V);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:q}),M+=q;T-I[0].distance>f;)M-=I.shift().angleDelta;if(M>p)return!1;b++,T+=$.dist(V)}return!0}function uV(u){let a=0;for(let c=0;c<u.length-1;c++)a+=u[c].dist(u[c+1]);return a}function dV(u,a,c){return u?.6*a*c:0}function hV(u,a){return Math.max(u?u.right-u.left:0,a?a.right-a.left:0)}function Vde(u,a,c,f,p,_){const b=dV(c,p,_),T=hV(c,f)*_;let I=0;const M=uV(u)/2;for(let $=0;$<u.length-1;$++){const V=u[$],q=u[$+1],Y=V.dist(q);if(I+Y>M){const J=(M-I)/Y,ae=$r(V.x,q.x,J),ce=$r(V.y,q.y,J),de=new nf(ae,ce,0,q.angleTo(V),$);return!b||cV(u,de,T,b,a)?de:void 0}I+=Y}}function qde(u,a,c,f,p,_,b,T,I){const M=dV(f,_,b),$=hV(f,p),V=$*b,q=u[0].x===0||u[0].x===I||u[0].y===0||u[0].y===I;return a-V<a/4&&(a=V+a/4),fV(u,q?a/2*T%a:($/2+2*_)*b*T%a,a,M,c,V,q,!1,I)}function fV(u,a,c,f,p,_,b,T,I){const M=_/2,$=uV(u);let V=0,q=a-c,Y=[];for(let J=0;J<u.length-1;J++){const ae=u[J],ce=u[J+1],de=ae.dist(ce),we=ce.angleTo(ae);for(;q+c<V+de;){q+=c;const Te=(q-V)/de,Oe=$r(ae.x,ce.x,Te),Ue=$r(ae.y,ce.y,Te);if(Oe>=0&&Oe<I&&Ue>=0&&Ue<I&&q-M>=0&&q+M<=$){const De=new nf(Oe,Ue,0,we,J);f&&!cV(u,De,_,f,p)||Y.push(De)}}V+=de}return T||Y.length||b||(Y=fV(u,V/2,c,f,p,_,b,!0,I)),Y}function pV(u){let a=0,c=0;for(const b of u)a+=b.w*b.h,c=Math.max(c,b.w);u.sort((b,T)=>T.h-b.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),c),h:1/0}];let p=0,_=0;for(const b of u)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(b.w>I.w||b.h>I.h)){if(b.x=I.x,b.y=I.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===I.w&&b.h===I.h){const M=f.pop();M&&T<f.length&&(f[T]=M)}else b.h===I.h?(I.x+=b.w,I.w-=b.w):b.w===I.w?(I.y+=b.h,I.h-=b.h):(f.push({x:I.x+b.w,y:I.y,w:I.w-b.w,h:b.h}),I.y+=b.h,I.h-=b.h);break}}return{w:p,h:_,fill:a/(p*_)||0}}gr(nf,"Anchor");const oy=1;class I1{static getImagePositionScale(a,c,f){if(c&&a&&a.options&&a.options.transform){const p=a.options.transform;return{x:p.a,y:p.d}}return{x:f,y:f}}constructor(a,c,f,p){this.paddedRect=a;const{pixelRatio:_,version:b,stretchX:T,stretchY:I,content:M,sdf:$,usvg:V}=c;this.pixelRatio=_,this.stretchX=T,this.stretchY=I,this.content=M,this.version=b,this.padding=f,this.sdf=$,this.usvg=V,this.scale=I1.getImagePositionScale(p,V,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function hN(u,a,c){const f=Uu.parse(u),p=function(_,b,T=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*T[0])+2*b,h:(_.data?_.data.height:_.height*T[1])+2*b}}(a,c,[f.options.transform.a,f.options.transform.d]);return{bin:p,imagePosition:new I1(p,a,c,f),imageVariant:f}}class mV{constructor(a,c,f){const p=new Map,_=new Map;this.haveRenderCallbacks=[];const b=[];this.addImages(a,p,oy,b),this.addImages(c,_,2,b);const{w:T,h:I}=pV(b),M=new Wo({width:T||1,height:I||1});for(const[$,V]of a.entries()){const q=p.get($).paddedRect;Wo.copy(V.data,M,{x:0,y:0},{x:q.x+oy,y:q.y+oy},V.data,null,V.sdf)}for(const[$,V]of c.entries()){const q=_.get($),Y=q.paddedRect;let J=q.padding;const ae=Y.x+J,ce=Y.y+J,de=V.data.width,we=V.data.height;J=J>1?J-1:J,Wo.copy(V.data,M,{x:0,y:0},{x:ae,y:ce},V.data,f),Wo.copy(V.data,M,{x:0,y:we-J},{x:ae,y:ce-J},{width:de,height:J},f),Wo.copy(V.data,M,{x:0,y:0},{x:ae,y:ce+we},{width:de,height:J},f),Wo.copy(V.data,M,{x:de-J,y:0},{x:ae-J,y:ce},{width:J,height:we},f),Wo.copy(V.data,M,{x:0,y:0},{x:ae+de,y:ce},{width:J,height:we},f),Wo.copy(V.data,M,{x:de-J,y:we-J},{x:ae-J,y:ce-J},{width:J,height:J},f),Wo.copy(V.data,M,{x:0,y:we-J},{x:ae+de,y:ce-J},{width:J,height:J},f),Wo.copy(V.data,M,{x:0,y:0},{x:ae+de,y:ce+we},{width:J,height:J},f),Wo.copy(V.data,M,{x:de-J,y:0},{x:ae-J,y:ce+we},{width:J,height:J},f)}this.lut=f,this.image=M,this.iconPositions=p,this.patternPositions=_}addImages(a,c,f,p){for(const[_,b]of a.entries()){const{bin:T,imagePosition:I,imageVariant:M}=hN(_,b,f);c.set(_,I),p.push(T),b.hasRenderCallback&&this.haveRenderCallbacks.push(M.id)}}patchUpdatedImages(a,c,f){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>a.hasImage(p,f)),a.dispatchRenderCallbacks(this.haveRenderCallbacks,f);for(const p of a.getUpdatedImages(f)){for(const _ of this.iconPositions.keys()){const b=Uu.parse(_);if(Qa.isEqual(b.id,p)){const T=a.getImage(p,f);this.patchUpdatedImage(this.iconPositions.get(_),T,c,null)}}for(const _ of this.patternPositions.keys()){const b=Uu.parse(_);if(Qa.isEqual(b.id,p)){const T=a.getImage(p,f);this.patchUpdatedImage(this.patternPositions.get(_),T,c,this.lut)}}}}patchUpdatedImage(a,c,f,p=null){if(!a||!c||a.version===c.version)return;a.version=c.version;const[_,b]=a.tl,T=a.sdf;if(this.lut||T){const I={width:c.data.width,height:c.data.height},M=new Wo(I);Wo.copy(c.data,M,{x:0,y:0},{x:0,y:0},I,p,T),f.update(M,{position:{x:_,y:b}})}else f.update(c.data,{position:{x:_,y:b}})}}gr(I1,"ImagePosition"),gr(mV,"ImageAtlas");const k1=1e20;function gV(u,a,c,f,p,_,b,T,I){for(let M=a;M<a+f;M++)yV(u,c*_+M,_,p,b,T,I);for(let M=c;M<c+p;M++)yV(u,M*_+a,1,f,b,T,I)}function yV(u,a,c,f,p,_,b){_[0]=0,b[0]=-k1,b[1]=k1,p[0]=u[a];for(let T=1,I=0,M=0;T<f;T++){p[T]=u[a+T*c];const $=T*T;do{const V=_[I];M=(p[T]-p[V]+$-V*V)/(T-V)/2}while(M<=b[I]&&--I>-1);I++,_[I]=T,b[I]=M,b[I+1]=k1}for(let T=0,I=0;T<f;T++){for(;b[I+1]<T;)I++;const M=_[I],$=T-M;u[a+T*c]=p[M]+$*$}}const ed=2,fN={none:0,ideographs:1,all:2};class Y_{constructor(a,c,f){this.requestManager=a,this.localGlyphMode=c,this.localFontFamily=f,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(a){this.url=a}getGlyphs(a,c){const f=[],p=this.url||Fi.GLYPHS_URL;for(const _ in a)for(const b of a[_])f.push({stack:_,id:b});Ze(f,({stack:_,id:b},T)=>{let I=this.entries[_];I||(I=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=I.glyphs[b];if(M!==void 0)return void T(null,{stack:_,id:b,glyph:M});if(M=this._tinySDF(I,_,b),M)return I.glyphs[b]=M,void T(null,{stack:_,id:b,glyph:M});const $=Math.floor(b/256);if(256*$>65535)return kr("glyphs > 65535 not supported"),void T(null,{stack:_,id:b,glyph:M});if(I.ranges[$])return void T(null,{stack:_,id:b,glyph:M});let V=I.requests[$];V||(V=I.requests[$]=[],Y_.loadGlyphRange(_,$,p,this.requestManager,(q,Y)=>{if(Y){I.ascender=Y.ascender,I.descender=Y.descender;for(const J in Y.glyphs)this._doesCharSupportLocalGlyph(+J)||(I.glyphs[+J]=Y.glyphs[+J]);I.ranges[$]=!0}for(const J of V)J(q,Y);delete I.requests[$]})),V.push((q,Y)=>{q?T(q):Y&&T(null,{stack:_,id:b,glyph:Y.glyphs[b]||null})})},(_,b)=>{if(_)c(_);else if(b){const T={};for(const{stack:I,id:M,glyph:$}of b)T[I]===void 0&&(T[I]={}),T[I].glyphs===void 0&&(T[I].glyphs={}),T[I].glyphs[M]=$&&{id:$.id,bitmap:$.bitmap.clone(),metrics:$.metrics},T[I].ascender=this.entries[I].ascender,T[I].descender=this.entries[I].descender;c(null,T)}})}_doesCharSupportLocalGlyph(a){return this.localGlyphMode!==fN.none&&(this.localGlyphMode===fN.all?!!this.localFontFamily:!!this.localFontFamily&&(jr["CJK Unified Ideographs"](a)||jr["Hangul Syllables"](a)||jr.Hiragana(a)||jr.Katakana(a)||jr["CJK Symbols and Punctuation"](a)||jr["CJK Unified Ideographs Extension A"](a)||jr["CJK Unified Ideographs Extension B"](a)||jr.Osage(a)))}_tinySDF(a,c,f){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(f))return;let _=a.tinySDF;if(!_){let ae="400";/bold/i.test(c)?ae="900":/medium/i.test(c)?ae="500":/light/i.test(c)&&(ae="200"),_=a.tinySDF=new Y_.TinySDF({fontFamily:p,fontWeight:ae,fontSize:24*ed,buffer:3*ed,radius:8*ed}),_.fontWeight=ae}if(this.localGlyphs[_.fontWeight][f])return this.localGlyphs[_.fontWeight][f];const b=String.fromCodePoint(f),{data:T,width:I,height:M,glyphWidth:$,glyphHeight:V,glyphLeft:q,glyphTop:Y,glyphAdvance:J}=_.draw(b);return this.localGlyphs[_.fontWeight][f]={id:f,bitmap:new jp({width:I,height:M},T),metrics:{width:$/ed,height:V/ed,left:q/ed,top:Y/ed-27,advance:J/ed,localGlyph:!0}}}}Y_.loadGlyphRange=function(u,a,c,f,p){const _=256*a,b=_+255,T=f.transformRequest(f.normalizeGlyphsURL(c).replace("{fontstack}",u).replace("{range}",`${_}-${b}`),Lh.Glyphs);Zf(T,(I,M)=>{if(I)p(I);else if(M){const $={},V=function(q){return new T2(q).readFields(Fde,{})}(M);for(const q of V.glyphs)$[q.id]=q;p(null,{glyphs:$,ascender:V.ascender,descender:V.descender})}})},Y_.TinySDF=class{constructor({fontSize:u=24,buffer:a=3,radius:c=8,cutoff:f=.25,fontFamily:p="sans-serif",fontWeight:_="normal",fontStyle:b="normal",lang:T=null}={}){this.buffer=a,this.cutoff=f,this.radius=c,this.lang=T;const I=this.size=u+4*a,M=this._createCanvas(I),$=this.ctx=M.getContext("2d",{willReadFrequently:!0});$.font=`${b} ${_} ${u}px ${p}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(u){const a=document.createElement("canvas");return a.width=a.height=u,a}draw(u){const{width:a,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:p,actualBoundingBoxRight:_}=this.ctx.measureText(u),b=Math.ceil(c),T=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-p))),I=Math.min(this.size-this.buffer,b+Math.ceil(f)),M=T+2*this.buffer,$=I+2*this.buffer,V=Math.max(M*$,0),q=new Uint8ClampedArray(V),Y={data:q,width:M,height:$,glyphWidth:T,glyphHeight:I,glyphTop:b,glyphLeft:0,glyphAdvance:a};if(T===0||I===0)return Y;const{ctx:J,buffer:ae,gridInner:ce,gridOuter:de}=this;this.lang&&(J.lang=this.lang),J.clearRect(ae,ae,T,I),J.fillText(u,ae,ae+b);const we=J.getImageData(ae,ae,T,I);de.fill(k1,0,V),ce.fill(0,0,V);for(let Te=0;Te<I;Te++)for(let Oe=0;Oe<T;Oe++){const Ue=we.data[4*(Te*T+Oe)+3]/255;if(Ue===0)continue;const De=(Te+ae)*M+Oe+ae;if(Ue===1)de[De]=0,ce[De]=k1;else{const Ge=.5-Ue;de[De]=Ge>0?Ge*Ge:0,ce[De]=Ge<0?Ge*Ge:0}}gV(de,0,0,M,$,M,this.f,this.v,this.z),gV(ce,ae,ae,T,I,M,this.f,this.v,this.z);for(let Te=0;Te<V;Te++){const Oe=Math.sqrt(de[Te])-Math.sqrt(ce[Te]);q[Te]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return Y}};const Jd=oy;function vV(u,a){return u+a[1]-a[0]}function pN(u,a,c,f,p=1){const _=[],b=u.imagePrimary,T=b.pixelRatio,I=b.paddedRect.w-2*Jd,M=b.paddedRect.h-2*Jd,$=(u.right-u.left)*p,V=(u.bottom-u.top)*p,q=b.stretchX||[[0,I]],Y=b.stretchY||[[0,M]],J=q.reduce(vV,0),ae=Y.reduce(vV,0),ce=I-J,de=M-ae;let we=0,Te=J,Oe=0,Ue=ae,De=0,Ge=ce,Je=0,tt=de;if(b.content&&f){const ct=b.content;we=C2(q,0,ct[0]),Oe=C2(Y,0,ct[1]),Te=C2(q,ct[0],ct[2]),Ue=C2(Y,ct[1],ct[3]),De=ct[0]-we,Je=ct[1]-Oe,Ge=ct[2]-ct[0]-Te,tt=ct[3]-ct[1]-Ue}const Et=(ct,Tt,kt,Dt)=>{const Zt=O2(ct.stretch-we,Te,$,u.left*p),$t=I2(ct.fixed-De,Ge,ct.stretch,J),Rt=O2(Tt.stretch-Oe,Ue,V,u.top*p),Bt=I2(Tt.fixed-Je,tt,Tt.stretch,ae),bt=O2(kt.stretch-we,Te,$,u.left*p),yt=I2(kt.fixed-De,Ge,kt.stretch,J),Ft=O2(Dt.stretch-Oe,Ue,V,u.top*p),Gt=I2(Dt.fixed-Je,tt,Dt.stretch,ae),jt=new Nt(Zt,Rt),pr=new Nt(bt,Rt),vr=new Nt(bt,Ft),ur=new Nt(Zt,Ft),ir=new Nt($t/T,Bt/T),Kr=new Nt(yt/T,Gt/T),or=a*Math.PI/180;if(or){const Wn=Math.sin(or),Gn=Math.cos(or),Yi=[Gn,-Wn,Wn,Gn];jt._matMult(Yi),pr._matMult(Yi),ur._matMult(Yi),vr._matMult(Yi)}const Or=ct.stretch+ct.fixed,Jr=kt.stretch+kt.fixed,yn=Tt.stretch+Tt.fixed,Fn=Dt.stretch+Dt.fixed,tn=u.imageSecondary;return{tl:jt,tr:pr,bl:ur,br:vr,texPrimary:{x:b.paddedRect.x+Jd+Or,y:b.paddedRect.y+Jd+yn,w:Jr-Or,h:Fn-yn},texSecondary:tn?{x:tn.paddedRect.x+Jd+Or,y:tn.paddedRect.y+Jd+yn,w:Jr-Or,h:Fn-yn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ir,pixelOffsetBR:Kr,minFontScaleX:Ge/T/$,minFontScaleY:tt/T/V,isSDF:c}};if(f&&(b.stretchX||b.stretchY)){const ct=_V(q,ce,J),Tt=_V(Y,de,ae);for(let kt=0;kt<ct.length-1;kt++){const Dt=ct[kt],Zt=ct[kt+1];for(let $t=0;$t<Tt.length-1;$t++)_.push(Et(Dt,Tt[$t],Zt,Tt[$t+1]))}}else _.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:M+1}));return _}function Wde(u,a){const c=u.stretchY||[[0,u.paddedRect.h-2*Jd]];return a&&(u.stretchX||u.stretchY)?xV(u.stretchX||[[0,u.paddedRect.w-2*Jd]])*xV(c):1}function C2(u,a,c){let f=0;for(const p of u)f+=Math.max(a,Math.min(c,p[1]))-Math.max(a,Math.min(c,p[0]));return f}function _V(u,a,c){const f=[{fixed:-Jd,stretch:0}];for(const[p,_]of u){const b=f[f.length-1];f.push({fixed:p-b.stretch,stretch:b.stretch}),f.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return f.push({fixed:a+Jd,stretch:c}),f}function xV(u){return 2*u.length+1}function O2(u,a,c,f){return u/a*c+f}function I2(u,a,c,f){return u-a*c/f}function Gde(u,a,c,f){const p=a+u.positionedLines[f].lineOffset;return f===0?c+p/2:c+(p+(a+u.positionedLines[f-1].lineOffset))/2}function Hde(u,a=1,c=!1){let f=1/0,p=1/0,_=-1/0,b=-1/0;const T=u[0];for(let Y=0;Y<T.length;Y++){const J=T[Y];(!Y||J.x<f)&&(f=J.x),(!Y||J.y<p)&&(p=J.y),(!Y||J.x>_)&&(_=J.x),(!Y||J.y>b)&&(b=J.y)}const I=Math.min(_-f,b-p);let M=I/2;const $=new Hv([],Kde);if(I===0)return new Nt(f,p);for(let Y=f;Y<_;Y+=I)for(let J=p;J<b;J+=I)$.push(new J_(Y+M,J+M,M,u));let V=function(Y){let J=0,ae=0,ce=0;const de=Y[0];for(let we=0,Te=de.length,Oe=Te-1;we<Te;Oe=we++){const Ue=de[we],De=de[Oe],Ge=Ue.x*De.y-De.x*Ue.y;ae+=(Ue.x+De.x)*Ge,ce+=(Ue.y+De.y)*Ge,J+=3*Ge}return new J_(ae/J,ce/J,0,Y)}(u),q=$.length;for(;$.length;){const Y=$.pop();(Y.d>V.d||!V.d)&&(V=Y,c&&console.log("found best %d after %d probes",Math.round(1e4*Y.d)/1e4,q)),Y.max-V.d<=a||(M=Y.h/2,$.push(new J_(Y.p.x-M,Y.p.y-M,M,u)),$.push(new J_(Y.p.x+M,Y.p.y-M,M,u)),$.push(new J_(Y.p.x-M,Y.p.y+M,M,u)),$.push(new J_(Y.p.x+M,Y.p.y+M,M,u)),q+=4)}return c&&(console.log(`num probes: ${q}`),console.log(`best distance: ${V.d}`)),V.p}function Kde(u,a){return a.max-u.max}class J_{constructor(a,c,f,p){this.p=new Nt(a,c),this.h=f,this.d=function(_,b){let T=!1,I=1/0;for(let M=0;M<b.length;M++){const $=b[M];for(let V=0,q=$.length,Y=q-1;V<q;Y=V++){const J=$[V],ae=$[Y];J.y>_.y!=ae.y>_.y&&_.x<(ae.x-J.x)*(_.y-J.y)/(ae.y-J.y)+J.x&&(T=!T),I=Math.min(I,El(_,J,ae))}}return(T?1:-1)*Math.sqrt(I)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const Zde=Object.keys,mN=Number.POSITIVE_INFINITY,Xde=Math.sqrt(2);function k2(u,a,c,f){const p=u.collisionPadding||[0,0,0,0],_={top:u.top-p[1],bottom:u.bottom+p[3],left:u.left-p[0],right:u.right+p[2],scaled:!1};return f!==void 0&&function(b,T){b.top*=T,b.bottom*=T,b.left*=T,b.right*=T,b.scaled=!0}(_,f),c&&function(b,T){if(!T)return;const I=xn(T),M=new Nt(b.left,b.top),$=new Nt(b.right,b.top),V=new Nt(b.left,b.bottom),q=new Nt(b.right,b.bottom);M._rotateAround(I,new Nt(0,0)),$._rotateAround(I,new Nt(0,0)),V._rotateAround(I,new Nt(0,0)),q._rotateAround(I,new Nt(0,0)),b.left=Math.min(M.x,$.x,V.x,q.x),b.right=Math.max(M.x,$.x,V.x,q.x),b.top=Math.min(M.y,$.y,V.y,q.y),b.bottom=Math.max(M.y,$.y,V.y,q.y)}(_,c),a?{top:Math.min(a.top,_.top),bottom:Math.max(a.bottom,_.bottom),left:Math.min(a.left,_.left),right:Math.max(a.right,_.right),scaled:a.scaled||_.scaled}:_}function bV(u,[a,c]){let f=0,p=0;if(c===mN){a<0&&(a=0);const _=a/Xde;switch(u){case"top-right":case"top-left":p=_-7;break;case"bottom-right":case"bottom-left":p=7-_;break;case"bottom":p=7-a;break;case"top":p=a-7}switch(u){case"top-right":case"bottom-right":f=-_;break;case"top-left":case"bottom-left":f=_;break;case"left":f=a;break;case"right":f=-a}}else{switch(a=Math.abs(a),c=Math.abs(c),u){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(u){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}}return[f,p]}function Yde(u,a,c,f,p,_,b,T,I,M,$){const V=u.layers[0],q=V.appearances;if(q.length===0)return{iconBBox:null,iconVerticalBBox:null};let Y=null,J=null;const ae=f.get("icon-rotate").evaluate(p,{},_);a&&(Y=k2(a,Y,ae,b),c)&&(J=k2(c,J,ae+90,b));const[ce,de]=f.get("icon-size-scale-range"),we=ve(1,ce,de);for(const Te of q){const Oe=Te.getUnevaluatedProperties(),Ue=Oe._values["icon-image"].value!==void 0,De=Oe._values["icon-size"].value!==void 0,Ge=Oe._values["icon-offset"].value!==void 0,Je=Oe._values["icon-rotate"].value!==void 0;if(Ue||De||Ge||Je){const tt=Ge?V.getAppearanceValueAndResolveTokens(Te,"icon-offset",p,_,[]):null,Et=tt&&Array.isArray(tt)?tt:T,ct=Je?V.getAppearanceValueAndResolveTokens(Te,"icon-rotate",p,_,[]):null,Tt=typeof ct=="number"?ct:ae,kt=De?V.getAppearanceValueAndResolveTokens(Te,"icon-size",p,_,[]):null,Dt=typeof kt=="number"?kt*I.iconScaleFactor:b;let Zt=null,$t=null,Rt=null;if(Ue){const Bt=V.getAppearanceValueAndResolveTokens(Te,"icon-image",p,_,[]);if(Bt){const bt=u.getResolvedImageFromTokens(Bt),yt=Oe._values["icon-size"],Ft=R1(bt,Z_(u.zoom,yt,u.worldview),yt,_,u.zoom,p,u.pixelRatio,we,u.worldview);Rt=M.get(Ft.iconPrimary.toString())}}else a&&(Rt=a.imagePrimary);Rt&&(Zt=P2(Rt,null,Et,$),u.allowVerticalPlacement&&($t=P2(Rt,null,Et,$))),Zt&&(Y=k2(Zt,Y,Tt,Dt)),$t&&(J=k2($t,J,Tt+90,Dt))}}return{iconBBox:Y,iconVerticalBBox:J}}function R2(u,a,c,f,p,_,b,T,I){if(!a||!a.usvg)return;const M=lV(f),$=lV(p),V=_!=="both"&&_!=="width"||!oV(f)?1:$.width/M.width,q=_!=="both"&&_!=="height"||!sV(f)?1:$.height/M.height;c.scaleSelf(V,q);const Y=c.toString();b.set(Y,c),T.set(Y,a);const{imagePosition:J}=hN(Y,a,oy);I.set(Y,J)}function wV(u,a,c,f,p,_,b,T,I){if(!u)return;const M=function($,V,q,Y,J,ae){if($.kind==="camera")return $.maxSize;if($.kind==="composite"){const ce=V.possiblyEvaluate(new ki($.maxZoom,{worldview:ae}),q).evaluate(J,{},q),de=V.possiblyEvaluate(new ki($.minZoom,{worldview:ae}),q).evaluate(J,{},q);return Math.max(ce,de)}return V.possiblyEvaluate(new ki(Y,{worldview:ae})).evaluate(J,{},q)}(a,c,f,p,_,I);return u.scaleSelf(M*T*b)}function R1(u,a,c,f,p,_,b,T,I){return{iconPrimary:wV(u.getPrimary(),a,c,f,p,_,b,T,I),iconSecondary:wV(u.getSecondary(),a,c,f,p,_,b,T,I)}}function Jde(u,a,c){if(!a)return;const f=c.get(u.toString()),p=c.get(a.toString());f&&p&&(f.paddedRect.w===p.paddedRect.w&&f.paddedRect.h===p.paddedRect.h||kr(`Mismatch in icon variant sizes: ${u.toString()} and ${a.toString()}`),f.usvg!==p.usvg&&kr(`Mismatch in icon variant image types: ${u.id} and ${a.id}`))}function SV(u,a,c,f){if(!u)return;const p=a.get(c.toString());if(u.imagePrimary=p,f){const _=a.get(f.toString());u.imageSecondary=_}}function Qde(u,a){for(const c in u.horizontal)EV(u.horizontal[c],a);EV(u.vertical,a)}function EV(u,a){if(u){for(const c of u.positionedLines)for(const f of c.positionedGlyphs)if(f.image!==null){const p=f.image.toString();f.rect=a.get(p).paddedRect}}}function gN(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ehe(u,a,c,f,p,_,b,T,I){const M=yN(_.horizontal)||_.vertical,$=c.get("icon-text-fit-padding").evaluate(f,{},p);let V,q=a;return a&&I!=="none"&&(u.allowVerticalPlacement&&_.vertical&&(V=uN(a,_.vertical,I,$,T,b)),M&&(q=uN(a,M,I,$,T,b))),{defaultShapedIcon:q,verticallyShapedIcon:V}}function the(u,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we,Te,Oe,Ue){let De=b.textMaxSize.evaluate(a,{},q);De===void 0?De=T*b.textScaleFactor:De*=b.textScaleFactor;const Ge=u.layers[0].layout,Je=Eo,tt=T*b.textScaleFactor/Je,Et=yN(c.horizontal)||c.vertical;if(ce!=="none"&&u.appearanceFeatureData&&a.index<u.appearanceFeatureData.length){const jt=u.appearanceFeatureData[a.index];jt&&(jt.textShaping=Et,jt.iconTextFitPadding=Ge.get("icon-text-fit-padding").evaluate(a,{},q),jt.fontScale=tt)}const ct=Y.name==="globe",Tt=u.tilePixelRatio*De/Je,kt=(bt=u.overscaling,u.zoom>18&&bt>2&&(bt>>=1),Math.max(Yt/(512*bt),1)*Ge.get("symbol-spacing")),Dt=Ge.get("text-padding")*u.tilePixelRatio,Zt=Ge.get("icon-padding")*u.tilePixelRatio,$t=xn(Ge.get("text-max-angle")),Rt=Ge.get("icon-rotation-alignment")==="map"&&Te!=="point",Bt=kt/2;var bt;u.hasAnyIconTextFit===!1&&ce!=="none"&&(u.hasAnyIconTextFit=!0);const yt=a.properties?+a.properties[cr]:null,Ft=yt&&u.elevationFeatureIdToIndex?u.elevationFeatureIdToIndex.get(yt):65535,Gt=(jt,pr,vr)=>{if(pr.x<0||pr.x>=Yt||pr.y<0||pr.y>=Yt)return;let ur=null;if(ct){const{x:ir,y:Kr,z:or}=Y.projectTilePoint(pr.x,pr.y,vr);ur={anchor:new nf(ir,Kr,or,0,void 0),up:Y.upVector(vr,pr.x,pr.y)}}(function(ir,Kr,or,Or,Jr,yn,Fn,tn,Wn,Gn,Yi,Le,je,Pt,rr,Ct,ar,Ar,Er,rn,Dr,wr,Vn,yi,zr,Dn,vi,ni,oa,Bi,Pi){const ci=ir.addToLineVertexArray(Kr,Or);let Hn,nn,Kn,Ci,Lr,zn,$i,fa=0,Aa=0,qa=0,Ui=0,za=-1,el=-1;const Ba={};let Il=bg("");const Go=or?or.anchor:Kr,Rc=ni!=="none";let tl=0,kl=0;if(Wn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const To=Wn.layout.get("text-offset").evaluate(Dr,{},zr);tl=To[0]*Eo,kl=To[1]*Eo}else tl=Wn.layout.get("text-radial-offset").evaluate(Dr,{},zr)*Eo,kl=mN;if(ir.allowVerticalPlacement&&Jr.vertical){const To=Jr.vertical;if(rr)zn=vN(To),tn&&($i=vN(tn));else{const Es=Wn.layout.get("text-rotate").evaluate(Dr,{},zr)+90;Kn=j2(Gn,Go,Kr,Yi,Le,je,To,Pt,Es,Ct),tn&&(Ci=j2(Gn,Go,Kr,Yi,Le,je,tn,Ar,Es,null,Pi))}}if(yn){const To=ir.iconSizeData,Es=Wn.layout.get("icon-rotate").evaluate(Dr,{},zr),Qd=pN(yn,Es,Vn,Rc,wr.iconScaleFactor),Fp=tn?pN(tn,Es,Vn,Rc,wr.iconScaleFactor):void 0;nn=j2(Gn,Go,Kr,Yi,Le,je,yn,Ar,Es,null,Bi);const ax=function(eh,X2,ox,pfe,V6,q6,mfe,gfe){const W6=eh.layers[0],G6=W6.appearances;let sx=X2.length;if(ox&&(sx=Math.max(sx,ox.length)),G6.length===0)return sx;const[yfe,vfe]=pfe.get("icon-size-scale-range"),_fe=ve(1,yfe,vfe);for(const H6 of G6){const K6=H6.getUnevaluatedProperties();if(K6._values["icon-image"].value!==void 0){const Z6=W6.getAppearanceValueAndResolveTokens(H6,"icon-image",V6,q6,[]);if(Z6){const X6=eh.getResolvedImageFromTokens(Z6);if(X6){const Y6=K6._values["icon-size"],xfe=R1(X6,Z_(eh.zoom,Y6,eh.worldview),Y6,q6,eh.zoom,V6,eh.pixelRatio,_fe,eh.worldview),bfe=mfe.get(xfe.iconPrimary.toString());sx=Math.max(sx,Wde(bfe,gfe))}}}}return sx}(ir,Qd,Fp,Wn.layout,Dr,zr,ir.iconAtlasPositions,Rc);fa=4*ax;let zp=null;To.kind==="source"?(zp=[Qu*Wn.layout.get("icon-size").evaluate(Dr,{},zr)*wr.iconScaleFactor],zp[0]>af&&kr(`${ir.layerIds[0]}: Value for "icon-size" is >= ${j1}. Reduce your "icon-size".`)):To.kind==="composite"&&(zp=[Qu*wr.compositeIconSizes[0].evaluate(Dr,{},zr)*wr.iconScaleFactor,Qu*wr.compositeIconSizes[1].evaluate(Dr,{},zr)*wr.iconScaleFactor],(zp[0]>af||zp[1]>af)&&kr(`${ir.layerIds[0]}: Value for "icon-size" is >= ${j1}. Reduce your "icon-size".`)),ir.addSymbols(ir.icon,Qd,zp,rn,Er,Dr,void 0,or,Kr,ci.lineStartIndex,ci.lineLength,-1,yi,zr,Dn,vi,ir.symbolInstances.length,ax),za=ir.icon.placedSymbolArray.length-1,Fp&&(Aa=4*ax,ir.addSymbols(ir.icon,Fp,zp,rn,Er,Dr,Ol.vertical,or,Kr,ci.lineStartIndex,ci.lineLength,-1,yi,zr,Dn,vi,ir.symbolInstances.length,ax),el=ir.icon.placedSymbolArray.length-1)}for(const To in Jr.horizontal){const Es=To,Qd=Jr.horizontal[Es];Hn||(Il=bg(Qd.text),rr?Lr=vN(Qd):Hn=j2(Gn,Go,Kr,Yi,Le,je,Qd,Pt,Wn.layout.get("text-rotate").evaluate(Dr,{},zr),Ct));const Fp=Qd.positionedLines.length===1;if(qa+=TV(ir,or,Kr,Qd,Fn,Wn,rr,Dr,Ct,ci,Jr.vertical?Ol.horizontal:Ol.horizontalOnly,Fp?Zde(Jr.horizontal):[Es],Ba,za,wr,yi,zr,ir.symbolInstances.length,Dn),Fp)break}Jr.vertical&&(Ui+=TV(ir,or,Kr,Jr.vertical,Fn,Wn,rr,Dr,Ct,ci,Ol.vertical,["vertical"],Ba,el,wr,yi,zr,ir.symbolInstances.length,Dn));let Ho=-1;const Rl=(To,Es)=>To?Math.max(To,Es):Es;Ho=Rl(Lr,Ho),Ho=Rl(zn,Ho),Ho=Rl($i,Ho);const jc=Ho>-1?1:0;ir.glyphOffsetArray.length>=65535&&kr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dr.sortKey!==void 0&&ir.addToSortKeyRanges(ir.symbolInstances.length,Dr.sortKey),ir.symbolInstances.emplaceBack(Kr.x,Kr.y,Go.x,Go.y,Go.z,Ba.right>=0?Ba.right:-1,Ba.center>=0?Ba.center:-1,Ba.left>=0?Ba.left:-1,Ba.vertical>=0?Ba.vertical:-1,za,el,Il,Hn!==void 0?Hn:ir.collisionBoxArray.length,Hn!==void 0?Hn+1:ir.collisionBoxArray.length,Kn!==void 0?Kn:ir.collisionBoxArray.length,Kn!==void 0?Kn+1:ir.collisionBoxArray.length,nn!==void 0?nn:ir.collisionBoxArray.length,nn!==void 0?nn+1:ir.collisionBoxArray.length,Ci||ir.collisionBoxArray.length,Ci?Ci+1:ir.collisionBoxArray.length,Yi,qa,Ui,fa,Aa,jc,0,tl,kl,Ho,0,Rc?1:0,oa)})(u,pr,ur,jt,c,f,_,p,u.layers[0],u.collisionBoxArray,a.index,a.sourceLayerIndex,u.index,Dt,we,M,0,Zt,Rt,de,a,b,$,V,q,J,ae,ce,Ft,Oe,Ue)};if(Te==="line")for(const jt of p2(a.geometry,0,0,Yt,Yt)){const pr=qde(jt,kt,$t,c.vertical||Et,f,Je,Tt,u.overscaling,Yt);for(const vr of pr)Et&&rhe(u,Et.text,Bt,vr)||Gt(jt,vr,q)}else if(Te==="line-center"){for(const jt of a.geometry)if(jt.length>1){const pr=Vde(jt,$t,c.vertical||Et,f,Je,Tt);pr&&Gt(jt,pr,q)}}else if(a.type==="Polygon")for(const jt of m1(a.geometry,0)){const pr=Hde(jt,16);Gt(jt[0],new nf(pr.x,pr.y,0,0,void 0),q)}else if(a.type==="LineString")for(const jt of a.geometry)Gt(jt,new nf(jt[0].x,jt[0].y,0,0,void 0),q);else if(a.type==="Point")for(const jt of a.geometry)for(const pr of jt)Gt([pr],new nf(pr.x,pr.y,0,0,void 0),q)}const j1=255,af=j1*Qu;function TV(u,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we){const Te=function(De,Ge,Je,tt,Et,ct,Tt,kt){const Dt=[];if(Ge.positionedLines.length===0)return Dt;const Zt=tt.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,$t=function(Ft){const Gt=Ft[0],jt=Ft[1],pr=Gt*jt;return pr>0?[Gt,-jt]:pr<0?[-Gt,jt]:Gt===0?[jt,Gt]:[jt,-Gt]}(Je);let Rt=Math.abs(Ge.top-Ge.bottom);for(const Ft of Ge.positionedLines)Rt-=Ft.lineOffset;const Bt=Ge.positionedLines.length,bt=Rt/Bt;let yt=Ge.top-Je[1];for(let Ft=0;Ft<Bt;++Ft){const Gt=Ge.positionedLines[Ft];yt=Gde(Ge,bt,yt,Ft);for(const jt of Gt.positionedGlyphs){if(!jt.rect)continue;const pr=jt.rect||{};let vr=QU+1,ur=!0,ir=1,Kr=0;if(jt.image){const Er=Tt.get(jt.image.toString());if(!Er)continue;if(Er.sdf){kr("SDF images are not supported in formatted text and will be ignored.");continue}ur=!1,ir=Er.pixelRatio,vr=oy/ir}const or=(Et||kt)&&jt.vertical,Or=jt.metrics.advance*jt.scale/2,Jr=jt.metrics,yn=jt.rect;if(yn===null)continue;kt&&Ge.verticalizable&&(Kr=jt.image?Or-jt.metrics.width*jt.scale/2:0);const Fn=Et?[jt.x+Or,jt.y]:[0,0];let tn=[0,0],Wn=[0,0],Gn=!1;Et||(or?(Wn=[jt.x+Or+$t[0],jt.y+$t[1]-Kr],Gn=!0):tn=[jt.x+Or+Je[0],jt.y+Je[1]-Kr]);const Yi=yn.w*jt.scale/(ir*(jt.localGlyph?ed:1)),Le=yn.h*jt.scale/(ir*(jt.localGlyph?ed:1));let je,Pt,rr,Ct;if(or){const Er=jt.y-yt,rn=new Nt(-Or,Or-Er),Dr=-Math.PI/2,wr=new Nt(...Wn);je=new Nt(-Or+tn[0],tn[1]),je._rotateAround(Dr,rn)._add(wr),je.x+=-Er+Or,je.y-=(Jr.left-vr)*jt.scale;const Vn=jt.image?Jr.advance*jt.scale:Eo*jt.scale,yi=String.fromCodePoint(jt.glyph);Pde(yi)?je.x+=(1-vr)*jt.scale:Cde(yi)?je.x+=Vn-Jr.height*jt.scale+(-vr-1)*jt.scale:je.x+=jt.image||Jr.width+2*vr===yn.w&&Jr.height+2*vr===yn.h?(Vn-Le)/2:(Vn-(Jr.height+2*vr)*jt.scale)/2,Pt=new Nt(je.x,je.y-Yi),rr=new Nt(je.x+Le,je.y),Ct=new Nt(je.x+Le,je.y-Yi)}else{const Er=(Jr.left-vr)*jt.scale-Or+tn[0],rn=(-Jr.top-vr)*jt.scale+tn[1],Dr=Er+Yi,wr=rn+Le;je=new Nt(Er,rn),Pt=new Nt(Dr,rn),rr=new Nt(Er,wr),Ct=new Nt(Dr,wr)}if(Zt){let Er;Er=Et?new Nt(0,0):Gn?new Nt($t[0],$t[1]):new Nt(Je[0],Je[1]),je._rotateAround(Zt,Er),Pt._rotateAround(Zt,Er),rr._rotateAround(Zt,Er),Ct._rotateAround(Zt,Er)}const ar=new Nt(0,0),Ar=new Nt(0,0);Dt.push({tl:je,tr:Pt,bl:rr,br:Ct,texPrimary:pr,texSecondary:void 0,writingMode:Ge.writingMode,glyphOffset:Fn,sectionIndex:jt.sectionIndex,isSDF:ur,pixelOffsetTL:ar,pixelOffsetBR:Ar,minFontScaleX:0,minFontScaleY:0})}}return Dt}(0,f,I,_,b,T,p,u.allowVerticalPlacement),Oe=u.textSizeData;let Ue=null;Oe.kind==="source"?(Ue=[Qu*_.layout.get("text-size").evaluate(T,{},ce)*J.textScaleFactor],Ue[0]>af&&kr(`${u.layerIds[0]}: Value for "text-size" is >= ${j1}. Reduce your "text-size".`)):Oe.kind==="composite"&&(Ue=[Qu*J.compositeTextSizes[0].evaluate(T,{},ce)*J.textScaleFactor,Qu*J.compositeTextSizes[1].evaluate(T,{},ce)*J.textScaleFactor],(Ue[0]>af||Ue[1]>af)&&kr(`${u.layerIds[0]}: Value for "text-size" is >= ${j1}. Reduce your "text-size".`)),u.addSymbols(u.text,Te,Ue,I,b,T,$,a,c,M.lineStartIndex,M.lineLength,Y,ae,ce,we,!1,de,Te.length);for(const De of V)q[De]=u.text.placedSymbolArray.length-1;return 4*Te.length}function yN(u){for(const a in u)return u[a];return null}function j2(u,a,c,f,p,_,b,T,I,M,$){let V,q,Y,J;if(V=$?$.top:b.top,q=$?$.bottom:b.bottom,Y=$?$.left:b.left,J=$?$.right:b.right,aV(b)&&b.collisionPadding){const ae=b.collisionPadding;Y-=ae[0],V-=ae[1],J+=ae[2],q+=ae[3]}if(I){const ae=new Nt(Y,V),ce=new Nt(J,V),de=new Nt(Y,q),we=new Nt(J,q),Te=xn(I);let Oe=new Nt(0,0);M&&(Oe=new Nt(M[0],M[1])),ae._rotateAround(Te,Oe),ce._rotateAround(Te,Oe),de._rotateAround(Te,Oe),we._rotateAround(Te,Oe),Y=Math.min(ae.x,ce.x,de.x,we.x),J=Math.max(ae.x,ce.x,de.x,we.x),V=Math.min(ae.y,ce.y,de.y,we.y),q=Math.max(ae.y,ce.y,de.y,we.y)}return u.emplaceBack(a.x,a.y,a.z,c.x,c.y,Y,V,J,q,T,f,p,_),u.length-1}function vN(u){aV(u)&&u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const a=u.bottom-u.top;return a>0?Math.max(10,a):null}function rhe(u,a,c,f){const p=u.compareText;if(a in p){const _=p[a];for(let b=_.length-1;b>=0;b--)if(f.dist(_[b])<c)return!0}else p[a]=[];return p[a].push(f),!1}function AV(u,a){const c=u.fovAboveCenter,f=u.elevation?u.elevation.getMinElevationBelowMSL()*a:0,p=(u._camera.position[2]*u.worldSize-f)/Math.cos(u._pitch),_=Math.sin(c)*p/Math.sin(Math.max(Math.PI/2-u._pitch-c,.01));let b=Math.sin(u._pitch)*_+p;const T=p*(1/u._horizonShift);if(!u.elevation||u.elevation.exaggeration()===0){let I=Math.max(u.zoom-17,0);u.isOrthographic&&(I/=10),b*=1+I}return Math.min(1.01*b,T)}function N1(u,a){if(!a.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:a};const c=Math.pow(2,-u.z),f=u.x*c,p=(u.x+1)*c,_=u.y*c,b=(u.y+1)*c,T=Ie(f),I=Ie(p),M=Ae(_),$=Ae(b),V=a.project(T,M),q=a.project(I,M),Y=a.project(I,$),J=a.project(T,$);let ae=Math.min(V.x,q.x,Y.x,J.x),ce=Math.min(V.y,q.y,Y.y,J.y),de=Math.max(V.x,q.x,Y.x,J.x),we=Math.max(V.y,q.y,Y.y,J.y);const Te=c/16;function Oe(De,Ge,Je,tt,Et,ct){const Tt=(Je+Et)/2,kt=(tt+ct)/2,Dt=a.project(Ie(Tt),Ae(kt)),Zt=Math.max(0,ae-Dt.x,ce-Dt.y,Dt.x-de,Dt.y-we);ae=Math.min(ae,Dt.x),de=Math.max(de,Dt.x),ce=Math.min(ce,Dt.y),we=Math.max(we,Dt.y),Zt>Te&&(Oe(De,Dt,Je,tt,Tt,kt),Oe(Dt,Ge,Tt,kt,Et,ct))}Oe(V,q,f,_,p,_),Oe(q,Y,p,_,p,b),Oe(Y,J,p,b,f,b),Oe(J,V,f,b,f,_),ae-=Te,ce-=Te,de+=Te,we+=Te;const Ue=1/Math.max(de-ae,we-ce);return{scale:Ue,x:ae*Ue,y:ce*Ue,x2:de*Ue,y2:we*Ue,projection:a}}function PV(u,{x:a,y:c},f=0){return new Nt(((a-f)*u.scale-u.x)*Yt,(c*u.scale-u.y)*Yt)}const nhe=R(new Float32Array(16));class Dp{constructor(a){this.spec=a,this.name=a.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(a,c){return{x:0,y:0,z:0}}unproject(a,c){return new Q(0,0)}projectTilePoint(a,c,f){return{x:a,y:c,z:0}}locationPoint(a,c,f,p=!0){return a._coordinatePoint(a.locationCoordinate(c,f),p)}pixelsPerMeter(a,c){return Ee(1,a)*c}pixelSpaceConversion(a,c,f){return 1}farthestPixelDistance(a){return AV(a,a.pixelsPerMeter)}pointCoordinate(a,c,f,p){const _=a.horizonLineFromTop(!1),b=new Nt(c,Math.max(_,f));return a.rayIntersectionCoordinate(a.pointRayIntersection(b,p))}pointCoordinate3D(a,c,f){const p=new Nt(c,f);if(a.elevation)return a.elevation.pointCoordinate(p);{const _=this.pointCoordinate(a,p.x,p.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(a,c){if(a.elevation&&a.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(a,c.x,c.y);const f=a.horizonLineFromTop();return c.y<f}createInversionMatrix(a,c){return nhe}createTileMatrix(a,c,f){let p,_,b;const T=f.canonical,I=R(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=N1(T,this);p=1,_=M.x+f.wrap*M.scale,b=M.y,B(I,I,[p/M.scale,p/M.scale,a.pixelsPerMeter/c])}else p=c/a.zoomScale(T.z),_=(T.x+Math.pow(2,T.z)*f.wrap)*p,b=T.y*p;return F(I,I,[_,b,0]),B(I,I,[p/Yt,p/Yt,1]),I}upVector(a,c,f){return[0,0,1]}upVectorScale(a,c,f){return{metersToTile:1}}}class ihe extends Dp{constructor(a){super(a),this.range=[4,7],this.center=a.center||[-96,37.5];const[c,f]=this.parallels=a.parallels||[29.5,45.5],p=Math.sin(xn(c));this.n=(p+Math.sin(xn(f)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(a,c){const{n:f,c:p,r0:_}=this,b=xn(a-this.center[0]),T=xn(c),I=Math.sqrt(p-2*f*Math.sin(T))/f;return{x:I*Math.sin(b*f),y:I*Math.cos(b*f)-_,z:0}}unproject(a,c){const{n:f,c:p,r0:_}=this,b=_+c;let T=Math.atan2(a,Math.abs(b))*Math.sign(b);b*f<0&&(T-=Math.PI*Math.sign(a)*Math.sign(b));const I=xn(this.center[0])*f;T=Ye(T,-Math.PI-I,Math.PI-I);const M=ve(ns(T/f)+this.center[0],-180,180),$=Math.asin(ve((p-(a*a+b*b)*f*f)/(2*f),-1,1)),V=ve(ns($),-Re,Re);return new Q(M,V)}}const M1=1.340264,D1=-.081106,L1=893e-6,F1=.003796,N2=Math.sqrt(3)/2;class ahe extends Dp{project(a,c){c=c/180*Math.PI,a=a/180*Math.PI;const f=Math.asin(N2*Math.sin(c)),p=f*f,_=p*p*p;return{x:.5*(a*Math.cos(f)/(N2*(M1+3*D1*p+_*(7*L1+9*F1*p)))/Math.PI+.5),y:1-.5*(f*(M1+D1*p+_*(L1+F1*p))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,p=f*f,_=p*p*p;for(let $,V,q,Y=0;Y<12&&(V=f*(M1+D1*p+_*(L1+F1*p))-c,q=M1+3*D1*p+_*(7*L1+9*F1*p),$=V/q,f=ve(f-$,-Math.PI/3,Math.PI/3),p=f*f,_=p*p*p,!(Math.abs($)<1e-12));++Y);const b=N2*a*(M1+3*D1*p+_*(7*L1+9*F1*p))/Math.cos(f),T=Math.asin(Math.sin(f)/N2),I=ve(180*b/Math.PI,-180,180),M=ve(180*T/Math.PI,-Re,Re);return new Q(I,M)}}class ohe extends Dp{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){return{x:.5+a/360,y:.5-c/360,z:0}}unproject(a,c){const f=360*(a-.5),p=ve(360*(.5-c),-Re,Re);return new Q(f,p)}}const Q_=Math.PI/2;function M2(u){return Math.tan((Q_+u)/2)}class she extends Dp{constructor(a){super(a),this.center=a.center||[0,30];const[c,f]=this.parallels=a.parallels||[30,30];let p=xn(c),_=xn(f);this.southernCenter=p+_<0,this.southernCenter&&(p=-p,_=-_);const b=Math.cos(p),T=M2(p);this.n=p===_?Math.sin(p):Math.log(b/Math.cos(_))/Math.log(M2(_)/T),this.f=b*Math.pow(M2(p),this.n)/this.n}project(a,c){c=xn(c),this.southernCenter&&(c=-c),a=xn(a-this.center[0]);const f=1e-6,{n:p,f:_}=this;_>0?c<-Q_+f&&(c=-Q_+f):c>Q_-f&&(c=Q_-f);const b=_/Math.pow(M2(c),p);let T=b*Math.sin(p*a),I=_-b*Math.cos(p*a);return T=.5*(T/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:T,y:this.southernCenter?I:1-I,z:0}}unproject(a,c){a=(2*a-.5)*Math.PI,this.southernCenter&&(c=1-c),c=(2*(1-c)-.5)*Math.PI;const{n:f,f:p}=this,_=p-c,b=Math.sign(_),T=Math.sign(f)*Math.sqrt(a*a+_*_);let I=Math.atan2(a,Math.abs(_))*b;_*f<0&&(I-=Math.PI*Math.sign(a)*b);const M=ve(ns(I/f)+this.center[0],-180,180),$=ve(ns(2*Math.atan(Math.pow(p/T,1/f))-Q_),-Re,Re);return new Q(M,this.southernCenter?-$:$)}}class CV extends Dp{constructor(a){super(a),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(a,c){return{x:xe(a),y:me(c),z:0}}unproject(a,c){const f=Ie(a),p=Ae(c);return new Q(f,p)}}const OV=xn(Re);class lhe extends Dp{project(a,c){const f=(c=xn(c))*c,p=f*f;return{x:.5*((a=xn(a))*(.8707-.131979*f+p*(p*(.003971*f-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(c*(1.007226+f*(.015085+p*(.028874*f-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(a,c){a=(2*a-.5)*Math.PI;let f=c=(2*(1-c)-1)*Math.PI,p=25,_=0,b=f*f;do{b=f*f;const M=b*b;_=(f*(1.007226+b*(.015085+M*(.028874*b-.044475-.005916*M)))-c)/(1.007226+b*(.045255+M*(.259866*b-.311325-.005916*11*M))),f=ve(f-_,-OV,OV)}while(Math.abs(_)>1e-6&&--p>0);b=f*f;const T=ve(ns(a/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),I=ns(f);return new Q(T,I)}}const IV=xn(Re);class che extends Dp{project(a,c){c=xn(c),a=xn(a);const f=Math.cos(c),p=2/Math.PI,_=Math.acos(f*Math.cos(a/2)),b=Math.sin(_)/_,T=.5*(a*p+2*f*Math.sin(a/2)/b)||0,I=.5*(c+Math.sin(c)/b)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(a,c){let f=a=(2*a-.5)*Math.PI,p=c=(2*(1-c)-1)*Math.PI,_=25;const b=1e-6;let T=0,I=0;do{const M=Math.cos(p),$=Math.sin(p),V=2*$*M,q=$*$,Y=M*M,J=Math.cos(f/2),ae=Math.sin(f/2),ce=2*J*ae,de=ae*ae,we=1-Y*J*J,Te=we?1/we:0,Oe=we?Math.acos(M*J)*Math.sqrt(1/we):0,Ue=.5*(2*Oe*M*ae+2*f/Math.PI)-a,De=.5*(Oe*$+p)-c,Ge=.5*Te*(Y*de+Oe*M*J*q)+1/Math.PI,Je=Te*(ce*V/4-Oe*$*ae),tt=.125*Te*(V*ae-Oe*$*Y*ce),Et=.5*Te*(q*J+Oe*de*M)+.5,ct=Je*tt-Et*Ge;T=(De*Je-Ue*Et)/ct,I=(Ue*tt-De*Ge)/ct,f=ve(f-T,-Math.PI,Math.PI),p=ve(p-I,-IV,IV)}while((Math.abs(T)>b||Math.abs(I)>b)&&--_>0);return new Q(ns(f),ns(p))}}class kV extends Dp{constructor(a){super(a),this.center=a.center||[0,0],this.parallels=a.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(xn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(a,c){const{scale:f,cosPhi:p}=this;return{x:xn(a)*p*f+.5,y:-Math.sin(xn(c))/p*f+.5,z:0}}unproject(a,c){const{scale:f,cosPhi:p}=this,_=-(c-.5)/f,b=ve(ns((a-.5)/f)/p,-180,180),T=Math.asin(ve(_*p,-1,1)),I=ve(ns(T),-Re,Re);return new Q(b,I)}}class uhe extends CV{constructor(a){super(a),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(a,c,f){const p=c1(a,c,f);return nr(p,p,a2(Xd(f))),{x:p[0],y:p[1],z:p[2]}}locationPoint(a,c,f){const p=z(c.lat,c.lng),_=ze([],p),b=f?a._centerAltitude+f:a.elevation?a.elevation.getAtPointOrZero(a.locationCoordinate(c),a._centerAltitude):a._centerAltitude;Qe(p,p,_,Ee(1,0)*Yt*b);const T=R(new Float64Array(16));return j(T,a.pixelMatrix,a.globeMatrix),nr(p,p,T),new Nt(p[0],p[1])}pixelsPerMeter(a,c){return Ee(1,0)*c}pixelSpaceConversion(a,c,f){const p=Ee(1,a)*c,_=$r(Ee(1,45)*c,p,f);return this.pixelsPerMeter(a,c)/_}createTileMatrix(a,c,f){const p=Ej(Xd(f.canonical));return j(new Float64Array(16),a.globeMatrix,p)}createInversionMatrix(a,c){const{center:f}=a,p=a2(Xd(c));return Z(p,p,xn(f.lng)),U(p,p,xn(f.lat)),B(p,p,[a._pixelsPerMercatorPixel,a._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(a,c,f,p){return t$(a,c,f,!0)||new ot(0,0)}pointCoordinate3D(a,c,f){const p=this.pointCoordinate(a,c,f,0);return[p.x,p.y,p.z]}isPointAboveHorizon(a,c){return!t$(a,c.x,c.y,!1)}farthestPixelDistance(a){const c=function(p,_){const b=p.cameraToCenterDistance,T=p._centerAltitude*_,I=p._camera,M=p._camera.forward(),$=_e([],ke([],M,-b),[0,0,T]),V=p.worldSize/(2*Math.PI),q=[0,0,-V],Y=p.width/p.height,J=Math.tan(p.fovAboveCenter),ae=ke([],I.up(),J),ce=ke([],I.right(),J*Y),de=ze([],_e([],_e([],M,ae),ce)),we=[];let Te;if(new on($,de).closestPointOnSphere(q,V,we)){const Oe=_e([],we,q),Ue=_t([],Oe,$);Te=Math.cos(p.fovAboveCenter)*Se(Ue)}else{const Oe=_t([],$,q),Ue=_t([],q,$);ze(Ue,Ue);const De=Se(Oe)-V;Te=Math.sqrt(De*(De+2*V));const Ge=Math.acos(Te/(V+De))-Math.acos(ut(M,Ue));Te*=Math.cos(Ge)}return 1.01*Te}(a,this.pixelsPerMeter(a.center.lat,a.worldSize)),f=Rp(a.zoom);if(f>0){const p=AV(a,Ee(1,a.center.lat)*a.worldSize),_=a.worldSize/(2*Math.PI),b=Math.max(a.width,a.height)/a.worldSize*Math.PI;return $r(c,p+_*(1-Math.cos(b)),Math.pow(f,10))}return c}upVector(a,c,f){return c1(c,f,a,1)}upVectorScale(a){return{metersToTile:r2(i2(Xd(a)))}}}function RV(u){const a=u.parallels,c=!!a&&Math.abs(a[0]+a[1])<.01;switch(u.name){case"mercator":return new CV(u);case"equirectangular":return new ohe(u);case"naturalEarth":return new lhe(u);case"equalEarth":return new ahe(u);case"winkelTripel":return new che(u);case"albers":return c?new kV(u):new ihe(u);case"lambertConformalConic":return c?new kV(u):new she(u);case"globe":return new uhe(u)}throw new Error(`Invalid projection name: ${u.name}`)}const dhe=Lt.types,hhe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function z1(u,a,c,f,p,_,b,T,I,M,$,V,q){const Y=T?Math.min(af,Math.round(T[0])):0,J=T?Math.min(af,Math.round(T[1])):0;u.emplaceBack(a,c,Math.round(32*f),Math.round(32*p),_,b,(Y<<1)+(I?1:0),0+(J<<1),16*M,16*$,256*V,256*q)}function B1(u,a,c){u.emplaceBack(a,c)}function $1(u,a,c,f,p,_,b){u.emplaceBack(a,c,f,p,_,b)}const D2=(u,a,c,f)=>{for(let p=0;p<a;p++)u.emplaceBack(c[0],c[1],c[2],f[0],f[1],f[2])};function ex(u,a,c,f,p){u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p),u.emplaceBack(a,c,f,p)}function fhe(u){for(const a of u.sections)if(sj(a.text))return!0;return!1}class _N{constructor(a){this.layoutVertexArray=new C_,this.indexArray=new Gi,this.programConfigurations=a,this.segments=new ea,this.dynamicLayoutVertexArray=new Kd,this.opacityVertexArray=new Hw,this.placedSymbolArray=new Zg,this.iconTransitioningVertexArray=new ac,this.globeExtVertexArray=new Sp,this.zOffsetVertexArray=new Ku,this.orientationVertexArray=new Xw,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(a,c){const f=[],p=this.layoutVertexArray.uint16;for(let _=0;_<c;++_){const b=12*(a+_);f.push(...p.slice(b,b+12))}return f}updateIconVertexData(a,c,f,p,_,b,T,I,M,$,V,q,Y){const J=this.layoutVertexArray.uint16,ae=12*a;J[ae]=c,J[ae+1]=f,J[ae+2]=p,J[ae+3]=_,J[ae+4]=b,J[ae+5]=T,J[ae+6]=I,J[ae+7]=M,J[ae+8]=$,J[ae+9]=V,J[ae+10]=q,J[ae+11]=Y}upload(a,c,f,p,_,b){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,yde.members,!!b),this.indexBuffer=a.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,_de.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,hhe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=a.createVertexBuffer(this.iconTransitioningVertexArray,wde.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=a.createVertexBuffer(this.globeExtVertexArray,vde.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=a.createVertexBuffer(this.zOffsetVertexArray,xde.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=a.createVertexBuffer(this.orientationVertexArray,bde.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||p)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}gr(_N,"SymbolBuffers");class xN{constructor(a,c,f){this.layoutVertexArray=new a,this.layoutAttributes=c,this.indexArray=new f,this.segments=new ea,this.collisionVertexArray=new Tp,this.collisionVertexArrayExt=new Kd}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Sde.members,!0),this.collisionVertexBufferExt=a.createVertexBuffer(this.collisionVertexArrayExt,Ede.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gr(xN,"CollisionBuffers");class L2{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(b=>b.fqid),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=R([]),this.placementViewportMatrix=R([]);const c=this.layers[0]._unevaluatedLayout._values;this.worldview=a.worldview,this.textSizeData=Z_(this.zoom,c["text-size"],this.worldview),this.iconSizeData=Z_(this.zoom,c["icon-size"],this.worldview);const f=this.layers[0].layout,p=f.get("symbol-sort-key"),_=f.get("symbol-z-order");this.lut=a.lut,this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(b=>Ol[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=a.sourceID,this.projection=a.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(a){const c=this.layers[0].getAppearances();return!(!c||c.length===0)&&c.some(f=>f.getProperty(a)!=null)}createArrays(){this.text=new _N(new Ic(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("text")||a.startsWith("symbol"))),this.icon=new _N(new Ic(this.layers,{zoom:this.zoom,lut:this.lut},a=>a.startsWith("icon")||a.startsWith("symbol"))),this.glyphOffsetArray=new n1,this.lineVertexArray=new GA,this.symbolInstances=new WA}calculateGlyphDependencies(a,c,f,p,_){for(const b of a){const T=b.codePointAt(0);if(T===void 0)break;if(c[T]=!0,p&&_&&T<=65535){const I=C1[b];I&&(c[I.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(a,c,f,p,_,b){let T=1;const I=a.getUnevaluatedProperties()._values["icon-size"],M=Z_(this.zoom,I,this.worldview),$=X_(M,c);if(M.kind!=="constant"&&M.kind!=="camera"||(T=$.uSize),M.kind==="composite"){const{minZoom:V,maxZoom:q}=M,Y=I.possiblyEvaluate(new ki(V,{worldview:this.worldview}),p),J=I.possiblyEvaluate(new ki(q,{worldview:this.worldview}),p),ae=Y.evaluate(f,{},p,_);T=ae+(J.evaluate(f,{},p,_)-ae)*$.uSizeT}return M.kind==="source"&&(T=I.possiblyEvaluate(new ki(this.zoom,{worldview:this.worldview}),p).evaluate(f,{},p,_)),T*b}updateFootprints(a,c){}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);return!d2(this.activeReplacements,f)&&(this.activeReplacements=f,!0)}getResolvedImageFromTokens(a){return typeof a=="string"?Ms.build(a):a}populate(a,c,f,p){const _=this.layers[0],b=_.layout,T=this.projection.name==="globe",I=b.get("text-font"),M=b.get("text-field"),$=b.get("icon-image"),[V,q]=b.get("icon-size-scale-range"),Y=ve(c.scaleFactor||1,V,q),J=(M.value.kind!=="constant"||M.value.value instanceof fo&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(I.value.kind!=="constant"||I.value.value.length>0),ae=$.value.kind!=="constant"||!!$.value.value||Object.keys($.parameters).length>0,ce=this.hasAnyAppearanceProperty("icon-image"),de=b.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!J&&!ae&&!ce)return;const we=c.iconDependencies,Te=c.glyphDependencies,Oe=c.availableImages,Ue=new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),De=Ge=>{const Je=Ge.id.toString();we.has(Je)?we.get(Je).push(Ge):we.set(Je,[Ge])};for(const Ge of a){const{feature:Je,id:tt,index:Et,sourceLayerIndex:ct}=Ge,Tt=_._featureFilter.needGeometry,kt=mt(Je,Tt);if(!_._featureFilter.filter(Ue,kt,f))continue;if(Tt||(kt.geometry=It(Je,f,p)),T&&Je.type!==1&&f.z<=5){const Ft=kt.geometry,Gt=.98078528056,jt=(pr,vr)=>ut(c1(pr.x,pr.y,f,1),c1(vr.x,vr.y,f,1))<Gt;for(let pr=0;pr<Ft.length;pr++)Ft[pr]=Ot(Ft[pr],jt)}let Dt,Zt;if(J){const Ft=_.getValueAndResolveTokens("text-field",kt,f,Oe),Gt=fo.factory(Ft);fhe(Gt)&&(this.hasRTLText=!0),(!this.hasRTLText||Fw()==="unavailable"||this.hasRTLText&&Qs.isParsed())&&(Dt=Ade(Gt,_,kt))}if(ae){const Ft=_.getValueAndResolveTokens("icon-image",kt,f,Oe);Zt=this.getResolvedImageFromTokens(Ft)}const $t=this.layers[0];let Rt=!1;if(!Zt&&ce){const Ft=$t.getAppearances();for(const Gt of Ft)if(Gt.getProperty("icon-image")){const jt=$t.getAppearanceValueAndResolveTokens(Gt,"icon-image",kt,f,Oe);if(jt){Zt=this.getResolvedImageFromTokens(jt),Rt=!0;break}}}if(!Dt&&!Zt)continue;const Bt=this.sortFeaturesByKey?de.evaluate(kt,{},f):void 0,bt={id:tt,text:Dt,icon:Zt,index:Et,sourceLayerIndex:ct,geometry:kt.geometry,properties:Je.properties,type:dhe[Je.type],sortKey:Bt};if(this.features.push(bt),this.appearanceFeatureData.push({id:tt,properties:Je.properties,usesAppearanceIconAsPlaceholder:Rt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Zt){const Ft=$t._unevaluatedLayout._values,{iconPrimary:Gt,iconSecondary:jt}=R1(Zt,this.iconSizeData,Ft["icon-size"],f,this.zoom,bt,this.pixelRatio,Y,this.worldview);De(Gt),jt&&(this.hasAnySecondaryIcon=!0,De(jt))}const yt=$t.getAppearances();if(yt.length!==0&&yt.forEach(Ft=>{if(!Ft.getProperty("icon-image"))return;const Gt=this.getCombinedIconPrimary(Ft,$t,kt,f,Oe,bt,Y);Gt&&De(Gt)}),Dt){const Ft=I.evaluate(kt,{},f).join(","),Gt=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ol.vertical)>=0;for(const jt of Dt.sections)if(jt.image){const pr=jt.image.getPrimary().scaleSelf(this.pixelRatio),vr=pr.id.toString(),ur=we.get(vr)||[];ur.push(pr),we.set(vr,ur)}else{const pr=Rw(Dt.toString()),vr=jt.fontStack||Ft,ur=Te[vr]=Te[vr]||{};this.calculateGlyphDependencies(jt.text,ur,Gt,this.allowVerticalPlacement,pr)}}}if(b.get("symbol-placement")==="line"&&(this.features=function(Ge){const Je={},tt={},Et=[];let ct=0;function Tt($t){Et.push(Ge[$t]),ct++}function kt($t,Rt,Bt){const bt=tt[$t];return delete tt[$t],tt[Rt]=bt,Et[bt].geometry[0].pop(),Et[bt].geometry[0]=Et[bt].geometry[0].concat(Bt[0]),bt}function Dt($t,Rt,Bt){const bt=Je[Rt];return delete Je[Rt],Je[$t]=bt,Et[bt].geometry[0].shift(),Et[bt].geometry[0]=Bt[0].concat(Et[bt].geometry[0]),bt}function Zt($t,Rt,Bt){const bt=Bt?Rt[0][Rt[0].length-1]:Rt[0][0];return`${$t}:${bt.x}:${bt.y}`}for(let $t=0;$t<Ge.length;$t++){const Rt=Ge[$t],Bt=Rt.geometry,bt=Rt.text?Rt.text.toString():null;if(!bt){Tt($t);continue}const yt=Zt(bt,Bt),Ft=Zt(bt,Bt,!0);if(yt in tt&&Ft in Je&&tt[yt]!==Je[Ft]){const Gt=Dt(yt,Ft,Bt),jt=kt(yt,Ft,Et[Gt].geometry);delete Je[yt],delete tt[Ft],tt[Zt(bt,Et[jt].geometry,!0)]=jt,Et[Gt].geometry=null}else yt in tt?kt(yt,Ft,Bt):Ft in Je?Dt(yt,Ft,Bt):(Tt($t),Je[yt]=ct-1,tt[Ft]=ct-1)}return Et.filter($t=>$t.geometry)}(this.features)),b.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",c.elevationFeatures){!this.elevationFeatures&&c.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ge of c.elevationFeatures)this.elevationFeatureIdToIndex.set(Ge.id,this.elevationFeatures.length),this.elevationFeatures.push(Ge)}}else b.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ge,Je)=>Ge.sortKey-Je.sortKey)}getCombinedIconPrimary(a,c,f,p,_,b,T){let I,M;const $=a.getUnevaluatedProperties();if($._values["icon-image"].value!==void 0){const V=c.getAppearanceValueAndResolveTokens(a,"icon-image",f,p,_);I=this.getResolvedImageFromTokens(V)}else{const V=c.getValueAndResolveTokens("icon-image",f,p,_);I=this.getResolvedImageFromTokens(V)}if(I){const V=$._values["icon-size"]||c._unevaluatedLayout._values["icon-size"];M=R1(I,Z_(this.zoom,V,this.worldview),V,p,this.zoom,b,this.pixelRatio,T,this.worldview).iconPrimary}return M}updateAppearanceBasedIconTextures(a,c,f,p){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const _=this.layers[0];let b=!1,T=0;const I=_.layout,[M,$]=I.get("icon-size-scale-range"),V=ve(1,M,$);for(let q=0;q<this.symbolInstances.length;q++){const Y=this.symbolInstances.get(q),J=this.appearanceFeatureData[Y.featureIndex];if(J&&Y.placedIconSymbolIndex>=0){const ae=J.id,ce=c&&ae!==void 0?c[String(ae)]:void 0,de={type:"Point",id:J.id,properties:J.properties,geometry:[]},we=this.layers[0].appearances&&this.layers[0].appearances.find(Te=>Te.isActive({globals:p,feature:de,canonical:a,featureState:ce}));if(J.activeAppearance===we)continue;if(we){J.activeAppearance=we;const Te={sortKey:void 0,text:void 0,icon:null,index:Y.featureIndex,sourceLayerIndex:Y.featureIndex,geometry:[],properties:J.properties,type:"Point",id:J.id};if(!we.hasCachedIconPrimary()){const Ge=this.getCombinedIconPrimary(we,_,de,a,f,Te,V);we.setCachedIconPrimary(Ge)}const Oe=we.getCachedIconPrimary();if(!Oe)continue;const Ue=Oe.toString(),De=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ue);if(De){const Ge=_.getAppearanceValueAndResolveTokens(we,"icon-offset",de,a,f),Je=Ge&&Array.isArray(Ge)?Ge:[0,0];let tt=P2(De,void 0,Je,_.layout.get("icon-anchor").evaluate(de,{},a));const Et=_.getAppearanceValueAndResolveTokens(we,"icon-rotate",de,a,f),ct=typeof Et=="number"?Et:0,Tt=De.sdf,kt=_.layout.get("icon-text-fit").constantOr("none");kt!=="none"&&J.textShaping&&J.iconTextFitPadding&&J.fontScale&&(tt=uN(tt,J.textShaping,kt,J.iconTextFitPadding,Je,J.fontScale));const Dt=this.calculateEffectiveAppearanceIconSize(we,p.zoom,de,a,f,V),Zt=0,$t=1+(Math.min(af,Math.round(Dt*Qu))<<1),Rt=pN(tt,ct,Tt,kt!=="none",V);J.isUsingAppearanceVertexData||(J.isUsingAppearanceVertexData=!0,J.layoutBasedVertexData=this.icon.getIconVertexData(T,Y.numIconVertices));for(let bt=0;bt<Rt.length;++bt){const yt=Rt[bt],Ft=J.layoutBasedVertexData[0]||Y.tileAnchorX,Gt=J.layoutBasedVertexData[1]||Y.tileAnchorY,jt=16*yt.pixelOffsetTL.x,pr=16*yt.pixelOffsetTL.y,vr=16*yt.pixelOffsetBR.x,ur=16*yt.pixelOffsetBR.y,ir=16*yt.minFontScaleX,Kr=16*yt.minFontScaleY;this.icon.updateIconVertexData(T,Ft,Gt,Math.round(32*yt.tl.x),Math.round(32*yt.tl.y),yt.texPrimary.x,yt.texPrimary.y,Zt,$t,jt,pr,ir,Kr),this.icon.updateIconVertexData(T+1,Ft,Gt,Math.round(32*yt.tr.x),Math.round(32*yt.tr.y),yt.texPrimary.x+yt.texPrimary.w,yt.texPrimary.y,Zt,$t,vr,pr,ir,Kr),this.icon.updateIconVertexData(T+2,Ft,Gt,Math.round(32*yt.bl.x),Math.round(32*yt.bl.y),yt.texPrimary.x,yt.texPrimary.y+yt.texPrimary.h,Zt,$t,jt,ur,ir,Kr),this.icon.updateIconVertexData(T+3,Ft,Gt,Math.round(32*yt.br.x),Math.round(32*yt.br.y),yt.texPrimary.x+yt.texPrimary.w,yt.texPrimary.y+yt.texPrimary.h,Zt,$t,vr,ur,ir,Kr),T+=4}const Bt=Y.numIconVertices-4*Rt.length;for(let bt=0;bt<Bt;++bt)this.icon.updateIconVertexData(T+bt,0,0,0,0,0,0,0,0,0,0,0,0);b=!0}else T+=Y.numIconVertices}else if(J.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(T,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(T+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(T+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(T+3,0,0,0,0,0,0,0,0,0,0,0,0),b=!0),T+=Y.numIconVertices,J.activeAppearance=null;else if(J.isUsingAppearanceVertexData){const Oe=J.layoutBasedVertexData.length/12;for(let Ue=0;Ue<Oe;++Ue){const De=Ue*12;this.icon.updateIconVertexData(T+Ue,J.layoutBasedVertexData[De+0],J.layoutBasedVertexData[De+1],J.layoutBasedVertexData[De+2],J.layoutBasedVertexData[De+3],J.layoutBasedVertexData[De+4],J.layoutBasedVertexData[De+5],J.layoutBasedVertexData[De+6],J.layoutBasedVertexData[De+7],J.layoutBasedVertexData[De+8],J.layoutBasedVertexData[De+9],J.layoutBasedVertexData[De+10],J.layoutBasedVertexData[De+11])}T+=Oe,J.isUsingAppearanceVertexData=!1,J.activeAppearance=null,b=!0}else T+=Y.numIconVertices,J.activeAppearance=null}}return b}update(a,c,f,p,_,b,T){this.text.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,this.worldview),this.icon.programConfigurations.updatePaintArrays(a,c,_,f,p,b,T,this.worldview)}updateRoadElevation(a){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let c=!1;const f=qe(a),p=1/f;let _=!1,b=!1;for(let T=0;T<this.symbolInstances.length;T++){const I=this.symbolInstances.get(T),M=Ce(1,0,0),$=Ce(0,1,0),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:q,numIconVertices:Y,numVerticalIconVertices:J}=I,ae=V>0||q>0,ce=Y>0,de=this.elevationFeatures[I.elevationFeatureIndex];if(de){const we=new Nt(I.tileAnchorX,I.tileAnchorY),Te=.075+de.pointElevation(we);I.zOffset!==Te&&(c=!0,I.zOffset=Te),Te!==0&&(this.hasAnyZOffset=!0);const Oe=de.computeSlopeNormal(we,p),Ue=Ua(er(),Ce(0,0,1),Oe);dr(M,M,Ue),dr($,$,Ue),M[2]*=f,$[2]*=f,M[0]===1&&M[1]===0&&M[2]===0&&$[0]===0&&$[1]===1&&$[2]===0||(_=_||ae,b=b||ce)}if(ae&&(D2(this.text.orientationVertexArray,V,M,$),D2(this.text.orientationVertexArray,q,M,$)),ce){const{placedIconSymbolIndex:we,verticalPlacedIconSymbolIndex:Te}=I;we>=0&&D2(this.icon.orientationVertexArray,Y,M,$),Te>=0&&D2(this.icon.orientationVertexArray,J,M,$)}}_||(this.text.orientationVertexArray=void 0),b||(this.icon.orientationVertexArray=void 0),c&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const a=(_,b,T)=>{f+=b,f>_.length&&_.resize(f);for(let I=-b;I<0;I++)_.emplace(I+f,T)},c=(_,b,T)=>{p+=b,p>_.length&&_.resize(p);for(let I=-b;I<0;I++)_.emplace(I+p,T)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let f=0,p=0;for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_),{numHorizontalGlyphVertices:T,numVerticalGlyphVertices:I,numIconVertices:M}=b,$=b.zOffset,V=M>0;if((T>0||I>0)&&(a(this.text.zOffsetVertexArray,T,$),a(this.text.zOffsetVertexArray,I,$)),V){const{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:Y}=b;q>=0&&c(this.icon.zOffsetVertexArray,M,$),Y>=0&&c(this.icon.zOffsetVertexArray,b.numVerticalIconVertices,$)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a,c,f,p,_){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(b=>b.appearances&&b.appearances.length>0)),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(a,c,f,p){return!!(a&&c&&f)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(a,c,f,p)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=RV(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,c){const f=this.lineVertexArray.length;if(a.segment!==void 0)for(const{x:p,y:_}of c)this.lineVertexArray.emplaceBack(p,_);return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae,ce,de,we){const Te=a.indexArray,Oe=a.layoutVertexArray,Ue=a.globeExtVertexArray,De=a.segments.prepareSegment(4*we,Oe,Te,this.canOverlap?b.sortKey:void 0),Ge=this.glyphOffsetArray.length,Je=De.vertexLength,tt=this.allowVerticalPlacement&&T===Ol.vertical?Math.PI/2:0,Et=b.text&&b.text.sections;for(let kt=0;kt<c.length;kt++){const{tl:Dt,tr:Zt,bl:$t,br:Rt,texPrimary:Bt,texSecondary:bt,pixelOffsetTL:yt,pixelOffsetBR:Ft,minFontScaleX:Gt,minFontScaleY:jt,glyphOffset:pr,isSDF:vr,sectionIndex:ur}=c[kt],ir=De.vertexLength,Kr=pr[1];if(z1(Oe,M.x,M.y,Dt.x,Kr+Dt.y,Bt.x,Bt.y,f,vr,yt.x,yt.y,Gt,jt),z1(Oe,M.x,M.y,Zt.x,Kr+Zt.y,Bt.x+Bt.w,Bt.y,f,vr,Ft.x,yt.y,Gt,jt),z1(Oe,M.x,M.y,$t.x,Kr+$t.y,Bt.x,Bt.y+Bt.h,f,vr,yt.x,Ft.y,Gt,jt),z1(Oe,M.x,M.y,Rt.x,Kr+Rt.y,Bt.x+Bt.w,Bt.y+Bt.h,f,vr,Ft.x,Ft.y,Gt,jt),I){const{x:or,y:Or,z:Jr}=I.anchor,[yn,Fn,tn]=I.up;$1(Ue,or,Or,Jr,yn,Fn,tn),$1(Ue,or,Or,Jr,yn,Fn,tn),$1(Ue,or,Or,Jr,yn,Fn,tn),$1(Ue,or,Or,Jr,yn,Fn,tn),ex(a.dynamicLayoutVertexArray,or,Or,Jr,tt)}else ex(a.dynamicLayoutVertexArray,M.x,M.y,M.z,tt);if(ce){const or=bt||Bt;B1(a.iconTransitioningVertexArray,or.x,or.y),B1(a.iconTransitioningVertexArray,or.x+or.w,or.y),B1(a.iconTransitioningVertexArray,or.x,or.y+or.h),B1(a.iconTransitioningVertexArray,or.x+or.w,or.y+or.h)}Te.emplaceBack(ir,ir+1,ir+2),Te.emplaceBack(ir+1,ir+2,ir+3),De.vertexLength+=4,De.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pr[0]),kt!==c.length-1&&ur===c[kt+1].sectionIndex||a.programConfigurations.populatePaintArrays(Oe.length,b,b.index,{},Y,J,ae,Et&&Et[ur],this.worldview)}const ct=we-c.length;ct!==0&&this._addNullVertices(ct,Oe,f,I,Ue,a,ce,De,Te);const Tt=I?I.anchor:M;a.placedSymbolArray.emplaceBack(Tt.x,Tt.y,Tt.z,M.x,M.y,Ge,this.glyphOffsetArray.length-Ge,Je,$,V,M.segment,f?f[0]:0,f?f[1]:0,p[0],p[1],T,0,0,0,q,0),a.symbolInstanceIndices.push(de)}_addNullVertices(a,c,f,p,_,b,T,I,M){for(let $=0;$<a;$++){for(let q=0;q<4;q++)z1(c,0,0,0,0,0,0,f,!1,0,0,0,0),p&&$1(_,0,0,0,0,0,0),ex(b.dynamicLayoutVertexArray,0,0,0,0),T&&B1(b.iconTransitioningVertexArray,0,0);const V=I.vertexLength;M.emplaceBack(V,V+1,V+2),M.emplaceBack(V+1,V+2,V+3),I.vertexLength+=4,I.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(a,c,f,p,_,b,T){a.emplaceBack(c,f,p,_,b,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(a,c,f,p,_,b,T){const I=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),M=I.vertexLength,$=T.tileAnchorX,V=T.tileAnchorY;for(let Y=0;Y<4;Y++)f.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(f.collisionVertexArrayExt,c,a.padding,T.zOffset),this._commitLayoutVertex(f.layoutVertexArray,p,_,b,$,V,new Nt(a.x1,a.y1)),this._commitLayoutVertex(f.layoutVertexArray,p,_,b,$,V,new Nt(a.x2,a.y1)),this._commitLayoutVertex(f.layoutVertexArray,p,_,b,$,V,new Nt(a.x2,a.y2)),this._commitLayoutVertex(f.layoutVertexArray,p,_,b,$,V,new Nt(a.x1,a.y2)),I.vertexLength+=4;const q=f.indexArray;q.emplaceBack(M,M+1),q.emplaceBack(M+1,M+2),q.emplaceBack(M+2,M+3),q.emplaceBack(M+3,M),I.primitiveLength+=4}_addTextDebugCollisionBoxes(a,c,f,p,_,b){for(let T=p;T<_;T++){const I=f.get(T),M=this.getSymbolInstanceTextSize(a,b,c,T);this._addCollisionDebugVertices(I,M,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(a,c,f,p,_,b){for(let T=p;T<_;T++){const I=f.get(T),M=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._addCollisionDebugVertices(I,M,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,b)}}generateCollisionDebugBuffers(a,c,f){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xN(O_,ZU.members,ac),this.iconCollisionBox=new xN(O_,ZU.members,ac);const p=X_(this.iconSizeData,a),_=X_(this.textSizeData,a,f);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._addTextDebugCollisionBoxes(_,a,c,T.textBoxStartIndex,T.textBoxEndIndex,T),this._addTextDebugCollisionBoxes(_,a,c,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T),this._addIconDebugCollisionBoxes(p,a,c,T.iconBoxStartIndex,T.iconBoxEndIndex,T),this._addIconDebugCollisionBoxes(p,a,c,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T)}}getSymbolInstanceTextSize(a,c,f,p){const _=this.text.placedSymbolArray.get(c.rightJustifiedTextSymbolIndex>=0?c.rightJustifiedTextSymbolIndex:c.centerJustifiedTextSymbolIndex>=0?c.centerJustifiedTextSymbolIndex:c.leftJustifiedTextSymbolIndex>=0?c.leftJustifiedTextSymbolIndex:c.verticalPlacedTextSymbolIndex>=0?c.verticalPlacedTextSymbolIndex:p),b=dN(this.textSizeData,a,_)/Eo;return this.tilePixelRatio*b}getSymbolInstanceIconSize(a,c,f){const p=this.icon.placedSymbolArray.get(f),_=dN(this.iconSizeData,a,p);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(a,c,f,p){a.emplaceBack(c,-f,-f,p),a.emplaceBack(c,f,-f,p),a.emplaceBack(c,f,f,p),a.emplaceBack(c,-f,f,p)}_updateTextDebugCollisionBoxes(a,c,f,p,_,b,T){for(let I=p;I<_;I++){const M=f.get(I),$=this.getSymbolInstanceTextSize(a,b,c,I);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,$,M.padding,b.zOffset)}}_updateIconDebugCollisionBoxes(a,c,f,p,_,b,T){for(let I=p;I<_;I++){const M=f.get(I),$=this.getSymbolInstanceIconSize(a,c,b.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,$,M.padding,b.zOffset)}}updateCollisionDebugBuffers(a,c,f,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=X_(this.iconSizeData,a,p),b=X_(this.textSizeData,a,f);for(let T=0;T<this.symbolInstances.length;T++){const I=this.symbolInstances.get(T);this._updateTextDebugCollisionBoxes(b,a,c,I.textBoxStartIndex,I.textBoxEndIndex,I,f),this._updateTextDebugCollisionBoxes(b,a,c,I.verticalTextBoxStartIndex,I.verticalTextBoxEndIndex,I,f),this._updateIconDebugCollisionBoxes(_,a,c,I.iconBoxStartIndex,I.iconBoxEndIndex,I,p),this._updateIconDebugCollisionBoxes(_,a,c,I.verticalIconBoxStartIndex,I.verticalIconBoxEndIndex,I,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(a,c,f,p,_,b,T,I,M){const $={};if(c<f){const{x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe,featureIndex:Ue}=a.get(c);$.textBox={x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe},$.textFeatureIndex=Ue}if(p<_){const{x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe,featureIndex:Ue}=a.get(p);$.verticalTextBox={x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe},$.verticalTextFeatureIndex=Ue}if(b<T){const{x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe,featureIndex:Ue}=a.get(b);$.iconBox={x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe},$.iconFeatureIndex=Ue}if(I<M){const{x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe,featureIndex:Ue}=a.get(I);$.verticalIconBox={x1:V,y1:q,x2:Y,y2:J,padding:ae,projectedAnchorX:ce,projectedAnchorY:de,projectedAnchorZ:we,tileAnchorX:Te,tileAnchorY:Oe},$.verticalIconFeatureIndex=Ue}return $}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(a,c){const f=a.placedSymbolArray.get(c),p=f.vertexStartIndex+4*f.numGlyphs;for(let _=f.vertexStartIndex;_<p;_+=4)a.indexArray.emplaceBack(_,_+1,_+2),a.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(a),f=Math.cos(a),p=[],_=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const I=this.symbolInstances.get(T);p.push(0|Math.round(c*I.tileAnchorX+f*I.tileAnchorY)),_.push(I.featureIndex)}return b.sort((T,I)=>p[T]-p[I]||_[I]-_[T]),b}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let a=0;a<this.symbolInstances.length;++a)this.symbolInstanceIndexesSortedZOffset.push(a)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((a,c)=>this.symbolInstances.get(c).zOffset-this.symbolInstances.get(a).zOffset)}addToSortKeyRanges(a,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:M}=f;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&b!==_&&b!==p&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(a){const c=this.symbolInstances.get(this.text.symbolInstanceIndices[a]).elevationFeatureIndex;let f;return this.elevationFeatures&&c<this.elevationFeatures.length&&(f=this.elevationFeatures[c]),f}}function jV(u,a){return a.replace(/{([^{}]+)}/g,(c,f)=>f in u?String(u[f]):"")}let NV,MV,bN;gr(L2,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),L2.addDynamicAttributes=ex;class DV{constructor(a){this.type=a.property.overrides?a.property.overrides.runtimeType:Yf,this.defaultValue=a}evaluate(a){if(a.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(a.formattedSection))return c.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gr(DV,"FormatSectionOverride",{omit:["defaultValue"]});const wN=()=>bN||(bN={layout:NV||(NV=new la({"symbol-placement":new qt(lt.layout_symbol["symbol-placement"]),"symbol-spacing":new qt(lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qt(lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sr(lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qt(lt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new qt(lt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new qt(lt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new qt(lt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qt(lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new qt(lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qt(lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new sr(lt.layout_symbol["icon-size"]),"icon-size-scale-range":new qt(lt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new sr(lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sr(lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new sr(lt.layout_symbol["icon-image"]),"icon-image-use-theme":new qt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new sr(lt.layout_symbol["icon-rotate"]),"icon-padding":new qt(lt.layout_symbol["icon-padding"]),"icon-keep-upright":new qt(lt.layout_symbol["icon-keep-upright"]),"icon-offset":new sr(lt.layout_symbol["icon-offset"]),"icon-anchor":new sr(lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qt(lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qt(lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qt(lt.layout_symbol["text-rotation-alignment"]),"text-field":new sr(lt.layout_symbol["text-field"]),"text-font":new sr(lt.layout_symbol["text-font"]),"text-size":new sr(lt.layout_symbol["text-size"]),"text-size-scale-range":new qt(lt.layout_symbol["text-size-scale-range"]),"text-max-width":new sr(lt.layout_symbol["text-max-width"]),"text-line-height":new sr(lt.layout_symbol["text-line-height"]),"text-letter-spacing":new sr(lt.layout_symbol["text-letter-spacing"]),"text-justify":new sr(lt.layout_symbol["text-justify"]),"text-radial-offset":new sr(lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qt(lt.layout_symbol["text-variable-anchor"]),"text-anchor":new sr(lt.layout_symbol["text-anchor"]),"text-max-angle":new qt(lt.layout_symbol["text-max-angle"]),"text-writing-mode":new qt(lt.layout_symbol["text-writing-mode"]),"text-rotate":new sr(lt.layout_symbol["text-rotate"]),"text-padding":new qt(lt.layout_symbol["text-padding"]),"text-keep-upright":new qt(lt.layout_symbol["text-keep-upright"]),"text-transform":new sr(lt.layout_symbol["text-transform"]),"text-offset":new sr(lt.layout_symbol["text-offset"]),"text-allow-overlap":new qt(lt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qt(lt.layout_symbol["text-ignore-placement"]),"text-optional":new qt(lt.layout_symbol["text-optional"]),visibility:new qt(lt.layout_symbol.visibility)})),paint:MV||(MV=new la({"icon-opacity":new sr(lt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new sr(lt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new sr(lt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new sr(lt.paint_symbol["text-emissive-strength"]),"icon-color":new sr(lt.paint_symbol["icon-color"]),"icon-halo-color":new sr(lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new sr(lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sr(lt.paint_symbol["icon-halo-blur"]),"icon-translate":new qt(lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new qt(lt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new qt(lt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new sr(lt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new sr(lt.paint_symbol["text-occlusion-opacity"]),"text-color":new sr(lt.paint_symbol["text-color"],{runtimeType:Ys,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new sr(lt.paint_symbol["text-halo-color"]),"text-halo-width":new sr(lt.paint_symbol["text-halo-width"]),"text-halo-blur":new sr(lt.paint_symbol["text-halo-blur"]),"text-translate":new qt(lt.paint_symbol["text-translate"]),"text-translate-anchor":new qt(lt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new qt(lt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new qt(lt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new qt(lt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new qt(lt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new sr(lt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},bN);class F2 extends os{constructor(a,c,f,p){super(a,wN(),c,f,p,a.layout?a.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=R([]),this.hasOcclusionOpacityProperties=a.paint!==void 0&&("icon-occlusion-opacity"in a.paint||"text-occlusion-opacity"in a.paint)}_handleSpecialPaintPropertyUpdate(a){a!=="icon-occlusion-opacity"&&a!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(a,c){super.recalculate(a,c),this.appearances&&this.appearances.forEach(p=>{p.recalculate(a,c,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const p=[];for(const _ of f)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(a,c,f,p){return this._saturation===a&&this._contrast===c&&this._brightnessMin===f&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(_,b,T,I){_=na(_),b=Li(b);const M=N(),$=_/3,V=1-2*$,q=[V,$,$,0,$,V,$,0,$,$,V,0,0,0,0,1],Y=.5-.5*b,J=I-T;return j(M,[J,0,0,0,0,J,0,0,0,0,J,0,T,T,T,1],[b,0,0,0,0,b,0,0,0,0,b,0,Y,Y,Y,1]),j(M,M,q),M}(a,c,f,p),this._saturation=a,this._contrast=c,this._brightnessMin=f,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(a,c,f,p){const _=this.layout.get(a).evaluate(c,{},f,p),b=this._unevaluatedLayout._values[a];return b.isDataDriven()||g_(b.value)||!_?_:jV(c.properties,_)}getAppearanceValueAndResolveTokens(a,c,f,p,_){const b=a.getProperty(c);if(!b)return;const T=b.evaluate(f,{},p,_),I=a.getUnevaluatedProperties()._values[c];return I.isDataDriven()||g_(I.value)||!T||typeof T!="string"?T:jV(f.properties,T)}createBucket(a){return new L2(a)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const a of wN().paint.overridableProperties){if(!F2.hasPaintOverride(this.layout,a))continue;const c=this.paint.get(a),f=new DV(c),p=new m_(f,c.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=c.value.kind==="constant"||c.value.kind==="source"?new Vg("source",p):new Vd("composite",p,c.value.zoomStops,c.value.interpolationType),this.paint._values[a]=new ic(c.property,_,c.parameters)}}_handleOverridablePaintPropertyUpdate(a,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&F2.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,c){const f=a.get("text-field"),p=wN().paint.properties[c];let _=!1;const b=T=>{for(const I of T)if(p.overrides&&p.overrides.hasOverride(I))return void(_=!0)};if(f.value.kind==="constant"&&f.value.value instanceof fo)b(f.value.value.sections);else if(f.value.kind==="source"){const T=M=>{_||(M instanceof Vu&&lo(M.value)===Bh?b(M.value.sections):M instanceof $h?b(M.sections):M.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(a,c,f){return{config:new Xu(this,{zoom:c,lut:f}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let LV,FV,zV,BV;var SN=En([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function z2(u,a,c,f,p,_,b,T){const I=[u,a,1,c,f,1,p,_,1],M=[b,T,1],$=A([],I),[V,q,Y]=Vt(M,M,$);return C(I,I,[V,0,0,0,q,0,0,0,Y])}function $V(u,a,c,f,p,_,b,T){const I=function(M,$,V,q,Y,J,ae,ce){const de=z2(0,0,1,0,1,1,0,1),we=z2(M,$,V,q,Y,J,ae,ce);return C(we,we,A([],de))}(u,a,c,f,p,_,b,T);return[I[2]/I[8]/Yt,I[5]/I[8]/Yt]}function B2(u){return[u[0],Math.min(Math.max(u[1],-Re),Re)]}class UV extends Bu{constructor(a,c,f,p){super(),this.id=a,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=c,this._dirty=!1}load(a,c){if(this._loaded=c||!1,this.fire(new vl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return a&&(this.coordinates=a),this._loaded=!0,void this._finishLoading();this._imageRequest=Yb(this.map._requestManager.transformRequest(this.url,Lh.Image),(f,p)=>{this._imageRequest=null,this._loaded=!0,f?this.fire(new wg(f)):p&&(this.image=p instanceof HTMLImageElement?Xs.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading())})}loaded(){return this._loaded}updateImage(a){return a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}setTexture(a){if(!(a.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new T1(this.map.painter.context,a.handle),this.width=a.dimensions[0],this.height=a.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new vl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(a){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof T1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(a){if(this.coordinates=a,this._boundsArray=void 0,this._unsupportedCoords=!1,!a.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let c=a[0][1],f=a[0][1];for(const _ of a)_[1]>f&&(f=_[1]),_[1]<c&&(c=_[1]);const p=(f+c)/2;if(p>Re?this.onNorthPole=!0:p<-Re&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=a.map(ot.fromLngLat);this.tileID=function(b){let T=1/0,I=1/0,M=-1/0,$=-1/0;for(const ae of b)T=Math.min(T,ae.x),I=Math.min(I,ae.y),M=Math.max(M,ae.x),$=Math.max($,ae.y);const V=Math.max(M-T,$-I),q=Math.max(0,Math.floor(-Math.log2(V))),Y=Math.pow(2,q);let J=Math.floor((T+M)/2*Y);return J>1&&(J-=1),new Al(q,J,Math.floor((I+$)/2*Y))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new vl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof T1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(a){for(const de in this.tiles){const we=this.tiles[de];we.state!=="loaded"&&(we.state="loaded",we.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const c=N1(new Al(0,0,0),this.map.transform.projection),f=[c.projection.project(this.coordinates[0][0],this.coordinates[0][1]),c.projection.project(this.coordinates[1][0],this.coordinates[1][1]),c.projection.project(this.coordinates[2][0],this.coordinates[2][1]),c.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(de){const we=de[1].x-de[0].x,Te=de[1].y-de[0].y,Oe=de[2].x-de[1].x,Ue=de[2].y-de[1].y,De=de[3].x-de[2].x,Ge=de[3].y-de[2].y,Je=de[0].x-de[3].x,tt=de[0].y-de[3].y,Et=we*Ue-Oe*Te,ct=Oe*Ge-De*Ue,Tt=De*tt-Je*Ge,kt=Je*Te-we*tt;return Et>0&&ct>0&&Tt>0&&kt>0||Et<0&&ct<0&&Tt<0&&kt<0}(f))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=N1(this.tileID,this.map.transform.projection),[_,b,T,I]=this.coordinates.map(de=>{const we=p.projection.project(de[0],de[1]);return PV(p,we)._round()});this.perspectiveTransform=$V(_.x,_.y,b.x,b.y,T.x,T.y,I.x,I.y);const M=this._boundsArray=new wp;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(b.x,b.y,Yt,0),M.emplaceBack(I.x,I.y,0,Yt),M.emplaceBack(T.x,T.y,Yt,Yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=a.createVertexBuffer(M,SN.members),this.boundsSegments=ea.simpleSegment(0,0,4,2);const $=[],V=[B2((q=this.coordinates)[0]),B2(q[1]),B2(q[2]),B2(q[3])];var q;const[Y,J,ae,ce]=function(de){let we=de[0][0],Te=we,Oe=de[0][1],Ue=Oe;for(let De=1;De<de.length;De++)de[De][0]<we?we=de[De][0]:de[De][0]>Te&&(Te=de[De][0]),de[De][1]<Oe?Oe=de[De][1]:de[De][1]>Ue&&(Ue=de[De][1]);return[we,Oe,Te-we,Ue-Oe]}(V);{const de=new wp,[we,Te,Oe,Ue]=function(Rt){let Bt=Rt[0].x,bt=Bt,yt=Rt[0].y,Ft=yt;for(let Gt=1;Gt<Rt.length;Gt++)Rt[Gt].x<Bt?Bt=Rt[Gt].x:Rt[Gt].x>bt&&(bt=Rt[Gt].x),Rt[Gt].y<yt?yt=Rt[Gt].y:Rt[Gt].y>Ft&&(Ft=Rt[Gt].y);return[Bt,yt,bt-Bt,Ft-yt]}(f),De=Rt=>[(Rt.x-we)/Oe,(Rt.y-Te)/Ue],[Ge,Je,tt,Et]=f.map(De),ct=function(Rt,Bt,bt,yt,Ft,Gt,jt,pr){const vr=z2(0,0,1,0,1,1,0,1);return C(vr,vr,A([],z2(Rt,Bt,bt,yt,Ft,Gt,jt,pr)))}(Ge[0],Ge[1],Je[0],Je[1],tt[0],tt[1],Et[0],Et[1]);this.elevatedGlobePerspectiveTransform=$V(Ge[0],Ge[1],Je[0],Je[1],tt[0],tt[1],Et[0],Et[1]);const Tt=(Rt,Bt)=>{$.push(Rt.lng);const bt=Math.round((Rt.lng-Y)/ae*Yt),yt=Math.round((Rt.lat-J)/ce*Yt),Ft=De(Bt),Gt=Vt([],[Ft[0],Ft[1],1],ct),jt=Math.round(Gt[0]/Gt[2]*Yt),pr=Math.round(Gt[1]/Gt[2]*Yt);de.emplaceBack(bt,yt,jt,pr)},kt=f[3].x-f[0].x,Dt=f[3].y-f[0].y,Zt=f[2].x-f[1].x,$t=f[2].y-f[1].y;for(let Rt=0;Rt<65;Rt++){const Bt=Rt/64,bt=[f[0].x+Bt*kt,f[0].y+Bt*Dt],yt=[f[1].x+Bt*Zt,f[1].y+Bt*$t],Ft=yt[0]-bt[0],Gt=yt[1]-bt[1];for(let jt=0;jt<65;jt++){const pr=jt/64,vr={x:bt[0]+Ft*pr,y:bt[1]+Gt*pr};Tt(c.projection.unproject(vr.x,vr.y),vr)}}this.elevatedGlobeVertexBuffer=a.createVertexBuffer(de,SN.members)}{this.maxLongitudeTriangleSize=0;let de=[],we=new Gi;const Te=(Oe,Ue,De)=>{we.emplaceBack(Oe,Ue,De);const Ge=$[Oe],Je=$[Ue],tt=$[De],Et=Math.min(Math.min(Ge,Je),tt),ct=Math.max(Math.max(Ge,Je),tt)-Et;ct>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ct),de.push(Et+ct/2)};for(let Oe=0;Oe<64;Oe++)for(let Ue=0;Ue<64;Ue++){const De=65*Oe+Ue,Ge=De+1,Je=De+65,tt=Je+1;Te(De,Je,Ge),Te(Ge,Je,tt)}[de,we]=function(Oe,Ue){const De=Array.from({length:Oe.length},(tt,Et)=>Et);De.sort((tt,Et)=>Oe[tt]-Oe[Et]);const Ge=[],Je=new Gi;for(let tt=0;tt<De.length;tt++){const Et=De[tt];Ge.push(Oe[Et]);const ct=3*Et,Tt=ct+1;Je.emplaceBack(Ue.uint16[ct],Ue.uint16[Tt],Ue.uint16[Tt+1])}return[Ge,Je]}(de,we),this.elevatedGlobeTrianglesCenterLongitudes=de,this.elevatedGlobeIndexBuffer=a.createIndexBuffer(we)}this.elevatedGlobeSegments=ea.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ae/Yt,0,ce/Yt,0,0,J,Y,0])}prepare(){const a=Object.keys(this.tiles).length!==0;if(this.tileID&&!a)return;const c=this.map.painter.context,f=c.gl;!this._dirty||this.texture instanceof T1||(this.texture?this.texture.update(this.image):(this.texture=new Zj(c,this.image,f.RGBA8),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this._dirty=!1),a&&this._prepareData(c)}loadTile(a,c){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},c(null)):(a.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(a){const c=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!c)return null;const f=this.elevatedGlobeTrianglesCenterLongitudes;let p=(_=a+180)+360*Math.round((f[0]-_)/360);var _;const b=new ea,T=(V,q)=>{b.segments.push({vertexOffset:0,primitiveOffset:V,vertexLength:c.segments[0].vertexLength,primitiveLength:q,sortKey:void 0,vaos:{}})},I=.51*this.maxLongitudeTriangleSize;if(Math.abs(f[0]-p)<=I){const V=Rn(f,0,f.length,p+I);return V===f.length||T(V,li(f,V+1,f.length,p+360-I)-V),b}p<f[0]&&(p+=360);const M=li(f,0,f.length,p-I);if(M===f.length)return T(0,f.length),b;T(0,M-0);const $=Rn(f,M+1,f.length,p+I);return $!==f.length&&T($,f.length-$),b}}const phe=(Math.pow(256,2)-1)/16907520;class VV extends os{constructor(a,c,f,p){super(a,{layout:zV||(zV=new la({visibility:new qt(lt.layout_raster.visibility)})),paint:BV||(BV=new la({"raster-opacity":new qt(lt.paint_raster["raster-opacity"]),"raster-color":new yp(lt.paint_raster["raster-color"]),"raster-color-mix":new qt(lt.paint_raster["raster-color-mix"]),"raster-color-range":new qt(lt.paint_raster["raster-color-range"]),"raster-hue-rotate":new qt(lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qt(lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qt(lt.paint_raster["raster-brightness-max"]),"raster-saturation":new qt(lt.paint_raster["raster-saturation"]),"raster-contrast":new qt(lt.paint_raster["raster-contrast"]),"raster-resampling":new qt(lt.paint_raster["raster-resampling"]),"raster-fade-duration":new qt(lt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new qt(lt.paint_raster["raster-emissive-strength"]),"raster-array-band":new qt(lt.paint_raster["raster-array-band"]),"raster-elevation":new qt(lt.paint_raster["raster-elevation"]),"raster-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(a){return!(a&&a._source instanceof UV&&(a._source.onNorthPole||a._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(a){a!=="raster-color"&&a!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(a){if(!this.hasColorMap()||!this._curRampRange)return;const c=this._transitionablePaint._values["raster-color"].value.expression,[f,p]=a||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(f)&&isNaN(p)||f===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=u1({expression:c,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:f,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[f,p])}}let qV,WV,GV,HV,KV;class ZV extends os{constructor(a,c,f,p){super(a,{layout:qV||(qV=new la({visibility:new qt(lt["layout_raster-particle"].visibility)})),paint:WV||(WV=new la({"raster-particle-array-band":new qt(lt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new qt(lt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new yp(lt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new qt(lt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new qt(lt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new qt(lt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new qt(lt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new qt(lt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},c,f,p),this._updateColorRamp(),this.lastInvalidatedAt=Xs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(a){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(a){return!1}_handleSpecialPaintPropertyUpdate(a){a!=="raster-particle-color"&&a!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),a==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const a=this._transitionablePaint._values["raster-particle-color"].value.expression,c=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=u1({expression:a,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:c}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Xs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class mhe extends os{constructor(a,c){super(a,{},c,null),this.implementation=a,a.slot&&(this.slot=a.slot)}is3D(a){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(a){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)}onRemove(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)}}function EN(u,a,c){const f=[0,0,1],p=Pr([]);return fn(p,p,c?-xn(u)+Math.PI:xn(u)),sn(p,p,-xn(a)),dr(f,f,p),ze(f,f)}const XV={None:0,Model:1,Symbol:2,FillExtrusion:4};class $2{constructor(a,c,f,p){this.message=(a?`${a}: `:"")+f,p&&(this.identifier=p),c!=null&&c.__line__&&(this.line=c.__line__)}}function TN(u,a){const c=u.indexOf("://")===-1;try{return new URL(u,c&&a?"http://example.com":void 0),!0}catch{return!1}}class YV{constructor(a,c){this.feature=a,this.instancedDataOffset=c,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class JV{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new k_,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(a){const c=16*a,f=this.instancedDataArray.float32;let p=Math.floor(f[c+2]);const _=1.05*(f[c+2]-p);return p/=100,[f[c]%1*1.05,f[c+1]%1*1.05,_,p]}tileCoordinatesForInstance(a){const c=16*a,f=this.instancedDataArray.float32;let p=f[c+0];return p=p>Yt?p-Yt:p,new Nt(Math.trunc(p),Math.trunc(f[c+1]))}translationForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+4],f[c+5],f[c+6]]}rotationScaleForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+7],f[c+8],f[c+9],f[c+10],f[c+11],f[c+12],f[c+13],f[c+14],f[c+15]]}transformForInstance(a){const c=16*a,f=this.instancedDataArray.float32;return[f[c+7],f[c+8],f[c+9],f[c+4],f[c+10],f[c+11],f[c+12],f[c+5],f[c+13],f[c+14],f[c+15],f[c+6],0,0,0,1]}}class AN{constructor(a){this.zoom=a.zoom,this.canonical=a.canonical,this.overscaledZ=this.canonical.z+Math.log2(a.overscaling),this.layers=a.layers,this.layerIds=this.layers.map(c=>c.fqid),this.projection=a.projection,this.index=a.index,this.worldview=a.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=a.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(a,c){}updateAppearances(a,c,f,p){}populate(a,c,f,p){this.tileToMeter=qe(f);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:b,id:T,index:I,sourceLayerIndex:M}of a){const $=T??(b.properties&&b.properties.hasOwnProperty("id")?b.properties.id:void 0),V=mt(b,_);if(!this.layers[0]._featureFilter.filter(new ki(this.zoom,{worldview:this.worldview,activeFloors:c.activeFloors}),V,f))continue;const q={id:$,sourceLayerIndex:M,index:I,geometry:_?V.geometry:It(b,f,p),properties:b.properties,type:b.type,patterns:{}},Y=this.addFeature(q,q.geometry,V);Y&&c.featureIndex.insert(b,q.geometry,I,M,this.index,this.instancesPerModel[Y].instancedDataArray.length,Yt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const a=this.layers[0].modelManager,c=this.layers[0].scope;let f=0;for(const p of this.modelUris){const _=a.getModel(p,c);if(!_)continue;const b=this.instancesPerModel[p];if(b){const T=.5*He(_.aabb.max,_.aabb.min)*b.maxScale+b.maxXYTranslationDistance,I=Math.min(Yt,Math.max(T/this.tileToMeter,Yt/32));f=Math.max(I,f)}}return f}update(a,c,f,p){for(const _ in this.instancesPerModel){const b=this.instancesPerModel[_];for(const T in a)b.idToFeaturesIndex.hasOwnProperty(T)&&(this.evaluate(b.features[b.idToFeaturesIndex[T]],a[T],b,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let a=!1;for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const p of f.features){const _=this.layers[0],b=p.feature,T=this.canonical,I=_.paint.get("model-rotation").evaluate(b,{},T),M=_.paint.get("model-scale").evaluate(b,{},T),$=_.paint.get("model-translation").evaluate(b,{},T);Yr(p.rotation,I)&&Yr(p.scale,M)&&Yr(p.translation,$)||(this.evaluate(p,p.featureStates,f,!0),a=!0)}}return a}updateReplacement(a,c,f,p){if(c.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=c.updateTime;const _=c.getReplacementRegionsForTile(a.toUnwrapped(),!0);if(d2(this.activeReplacements,_))return!1;this.activeReplacements=_;let b=!1;for(const T in this.instancesPerModel){const I=this.instancesPerModel[T],M=I.instancedDataArray;for(const $ of I.features){const V=$.instancedDataOffset,q=$.instancedDataCount;for(let Y=0;Y<q;Y++){const J=16*(Y+V);let ae=M.float32[J+0];const ce=ae>Yt;ae=ce?ae-Yt:ae;const de=Math.floor(ae),we=Math.floor(M.float32[J+1]);let Te=!1;for(const Oe of this.activeReplacements)if(!L$(Oe,f,XV.Model,p)&&!(Oe.min.x>de||de>Oe.max.x||Oe.min.y>we||we>Oe.max.y)&&(Te=Lj($$(de,we,a.canonical,Oe.footprintTileId.canonical),Oe.footprint),Te))break;M.float32[J]=Te?ae+Yt:ae,b=b||Te!==ce}}}return b}isEmpty(){for(const a in this.instancesPerModel)if(this.instancesPerModel[a].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(a){if(!this.uploaded)for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length<0||f.instancedDataArray.length===0||(f.instancedDataBuffer?f.instancedDataBuffer.updateData(f.instancedDataArray):f.instancedDataBuffer=a.createVertexBuffer(f.instancedDataArray,Uue.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];f.instancedDataArray.length!==0&&f.instancedDataBuffer&&f.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(a&&this.modelUris&&this.modelsRequested)for(const c of this.modelUris)a.removeModel(c,"",!0)}addFeature(a,c,f){const p=this.layers[0],_=p.layout.get("model-id").evaluate(f,{},this.canonical);if(!_)return kr(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),_;(TN(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new JV);const b=this.instancesPerModel[_],T=b.instancedDataArray,I=new YV(f,T.length);for(const M of c)for(const $ of M){if($.x<0||$.x>=Yt||$.y<0||$.y>=Yt)continue;if(this.lookupDim!==0){const q=(this.lookupDim-1)/Yt,Y=this.lookupDim*($.y*q|0)+$.x*q|0;if(this.lookup){if(this.lookup[Y]!==0)continue;this.lookup[Y]=1}}this.instanceCount++;const V=T.length;T.resize(V+1),b.instancesEvaluatedElevation.push(0),T.float32[16*V]=$.x,T.float32[16*V+1]=$.y}return I.instancedDataCount=b.instancedDataArray.length-I.instancedDataOffset,I.instancedDataCount>0&&(a.id&&(b.idToFeaturesIndex[a.id]=b.features.length),b.features.push(I),this.evaluate(I,{},b,!1)),_}getModelUris(){return this.modelUris}evaluate(a,c,f,p){const _=this.layers[0],b=a.feature,T=this.canonical,I=a.rotation=_.paint.get("model-rotation").evaluate(b,c,T),M=a.scale=_.paint.get("model-scale").evaluate(b,c,T),$=a.translation=_.paint.get("model-translation").evaluate(b,c,T),V=Object.assign({},_.paint.get("model-color").evaluate(b,c,T));V.a=_.paint.get("model-color-mix-intensity").evaluate(b,c,T);const q=[];this.maxVerticalOffset<$[2]&&(this.maxVerticalOffset=$[2]);const Y=$[0]*$[0]+$[1]*$[1],J=Y>0?Math.sqrt(Y):0;f.maxScale=Math.max(Math.max(f.maxScale,M[0]),Math.max(M[1],M[2])),f.maxXYTranslationDistance=Math.max(f.maxXYTranslationDistance,J),this.maxScale=Math.max(Math.max(this.maxScale,M[0]),Math.max(M[1],M[2])),PU(q,I,M);const ae=Math.round(100*V.a)+V.b/1.05;for(let ce=0;ce<a.instancedDataCount;++ce){const de=a.instancedDataOffset+ce,we=16*de,Te=f.instancedDataArray.float32;let Oe=0;p&&(Oe=Te[we+6]-f.instancesEvaluatedElevation[de]);const Ue=0|Te[we+1];Te[we]=(0|Te[we])+V.r/1.05,Te[we+1]=Ue+V.g/1.05,Te[we+2]=ae,Te[we+3]=1/(T.z>10?this.tileToMeter:qe(T,Ue)),Te[we+4]=$[0],Te[we+5]=$[1],Te[we+6]=$[2]+Oe,Te[we+7]=q[0],Te[we+8]=q[1],Te[we+9]=q[2],Te[we+10]=q[4],Te[we+11]=q[5],Te[we+12]=q[6],Te[we+13]=q[8],Te[we+14]=q[9],Te[we+15]=q[10],f.instancesEvaluatedElevation[de]=$[2]}}}let QV,e6;gr(AN,"ModelBucket",{omit:["layers"]}),gr(JV,"PerModelAttributes"),gr(YV,"ModelFeature");class tx{constructor(a,c,f){this._demTile=a,this._dem=this._demTile.dem,this._scale=c,this._offset=f}static create(a,c,f){const p=f||a.findDEMTileFor(c);if(!p||!p.dem)return;const _=p.dem,b=p.tileID,T=1<<c.canonical.z-b.canonical.z;return new tx(p,_.dim/Yt/T,[(c.canonical.x/T-b.canonical.x)*_.dim,(c.canonical.y/T-b.canonical.y)*_.dim])}tileCoordToPixel(a,c){const f=c*this._scale+this._offset[1];return new Nt(Math.floor(a*this._scale+this._offset[0]),Math.floor(f))}getElevationAt(a,c,f,p){const _=a*this._scale+this._offset[0],b=c*this._scale+this._offset[1],T=Math.floor(_),I=Math.floor(b),M=this._dem;return p=!!p,f?$r($r(M.get(T,I,p),M.get(T,I+1,p),b-I),$r(M.get(T+1,I,p),M.get(T+1,I+1,p),b-I),_-T):M.get(T,I,p)}getElevationAtPixel(a,c,f){return this._dem.get(a,c,!!f)}getMeterToDEM(a){return(1<<this._demTile.tileID.canonical.z)*Ee(1,a)*this._dem.stride}}const PN=new Float32Array(262144),sy=new Uint8Array(262144);function t6(u){let a=0;if(u.meshes)for(const c of u.meshes)a=Math.max(a,c.aabb.max[2]);if(u.children)for(const c of u.children)a=Math.max(a,t6(c));return a}function r6(u,a,c){if(u.meshes)for(const f of u.meshes){if(f.aabb.min[0]===1/0)continue;const p=mn.applyTransform(f.aabb,u.globalMatrix);c.insert(a,p.min[0],p.min[1],p.max[0],p.max[1])}if(u.children)for(const f of u.children)r6(f,a,c)}const n6=["","wall","door","roof","window","lamp","logo"];class i6{constructor(a){this.node=a,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:a.id,geometry:[],properties:{height:t6(a)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let a=0;const c=new mn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const f of this.node.meshes)this.node.lightMeshIndex!==a&&(f.transformedAabb=mn.applyTransformFast(f.aabb,this.node.globalMatrix),c.encapsulate(f.transformedAabb)),a++;this.aabb=c}return this.aabb}}class U2{constructor(a,c,f,p,_,b,T,I){this.id=f,this.layers=a,this.layerIds=this.layers.map(M=>M.fqid),this.stateDependentLayerIds=this.layers.filter(M=>M.isStateDependent()).map(M=>M.id),this.modelTraits|=G_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=G_.HasMapboxMeshFeatures),_&&(this.modelTraits|=G_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=b,this.worldview=I,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const M of c)this.nodesInfo.push(new i6(M)),r6(M,T.featureIndexArray.length,T.grid),T.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,T.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(a,c){for(const f of this.getNodesInfo()){const p=f.node;p.footprint&&c.push({footprint:p.footprint,id:a})}}updateAppearances(a,c,f,p){}update(a){const c=Object.keys(a).length!==0;if(c&&!this.stateDependentLayers.length)return;const f=c?this.stateDependentLayers:this.layers;if(!Uo(a,this.states))for(const p of f)this.evaluate(p,a);this.states=structuredClone(a)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(a){if(!this.needsUpload)return;const c=this.getNodesInfo();for(const f of c){const p=f.node;this.uploaded?this.updatePbrBuffer(p):Jj(p,a,!0)}for(const f of c)S2(f.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(a){let c=!1;if(!a.meshes)return c;for(const f of a.meshes)f.pbrBuffer&&(f.pbrBuffer.updateData(f.featureArray),c=!0);return c}needsReEvaluation(a,c,f){const p=a.transform.projectionOptions,_=a.style.getBrightness(),b=this.brightness!==_;if(!this.uploaded||this.dirty||p.name!==this.projection.name||U1(f.paint.get("model-color").value,b)||U1(f.paint.get("model-color-mix-intensity").value,b)||U1(f.paint.get("model-roughness").value,b)||U1(f.paint.get("model-emissive-strength").value,b)||U1(f.paint.get("model-height-based-emissive-strength-multiplier").value,b)){this.projection=p,this.brightness=_;const T=this.getNodesInfo();for(const I of T)I.state=null;return!0}return!1}evaluateTransform(a,c){if(a.transform.zoom===this.zoom)return;this.zoom=a.transform.zoom;const f=this.getNodesInfo(),p=this.id.canonical;for(const _ of f){const b=_.feature;_.evaluatedTranslation=c.paint.get("model-translation").evaluate(b,{},p),_.evaluatedScale=c.paint.get("model-scale").evaluate(b,{},p)}}evaluate(a,c){const f=this.getNodesInfo();for(const p of f){if(!p.node.meshes)continue;const _=p.feature,b=c&&c[_.id];if(Uo(b,p.state))continue;p.state=structuredClone(b);const T=p.node.meshes&&p.node.meshes[0].featureData,I=p.evaluatedColor[2],M=p.evaluatedRMEA[2],$=this.id.canonical;if(p.hasTranslucentParts=!1,T){for(let V=0;V<n6.length;V++){const q=n6[V];q.length&&(_.properties.part=q);const Y=a.paint.get("model-color").evaluate(_,b,$).toPremultipliedRenderColor(null),J=a.paint.get("model-color-mix-intensity").evaluate(_,b,$);p.evaluatedColor[V]=[Y.r,Y.g,Y.b,J],p.evaluatedRMEA[V][0]=a.paint.get("model-roughness").evaluate(_,b,$),p.evaluatedRMEA[V][2]=a.paint.get("model-emissive-strength").evaluate(_,b,$),p.evaluatedRMEA[V][3]=Y.a,p.emissionHeightBasedParams[V]=a.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,b,$),!p.hasTranslucentParts&&Y.a<1&&(p.hasTranslucentParts=!0)}delete _.properties.part,yhe(p,I!==p.evaluatedColor[2]||M!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=a.paint.get("model-emissive-strength").evaluate(_,b,$);p.evaluatedTranslation=a.paint.get("model-translation").evaluate(_,b,$),p.evaluatedScale=a.paint.get("model-scale").evaluate(_,b,$),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(a,c,f,p){const _=a.findDEMTileFor(f);if(_&&(_.tileID.canonical!==this.terrainTile||c!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const b=tx.create(a,f,_);if(!b)return;this.modelTraits&G_.HasMapboxMeshFeatures&&this.updateDEM(a,b,f,p);for(const T of this.getNodesInfo()){const I=T.node;if(!I.footprint||!I.footprint.vertices||!I.footprint.vertices.length)continue;const M=I.footprint.vertices;let $=b.getElevationAt(M[0].x,M[0].y,!0,!0);for(let V=1;V<M.length;V++)$=Math.min($,b.getElevationAt(M[V].x,M[V].y,!0,!0));I.elevation=$}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=c}}updateDEM(a,c,f,p){let _=c._dem._modifiedForSources[p];if(_===void 0&&(c._dem._modifiedForSources[p]=[],_=c._dem._modifiedForSources[p]),_.includes(f.canonical))return;const b=c._dem.dim;_.push(f.canonical);let T=!1;for(const I of this.getNodesInfo()){const M=I.node;if(!M.footprint||!M.footprint.grid)continue;const $=M.footprint.grid,V=c.tileCoordToPixel($.min.x,$.min.y),q=c.tileCoordToPixel($.max.x,$.max.y),Y=Math.min(Math.min(b-q.y,V.x),Math.min(V.y,b-q.x));if(Y<0)continue;const J=ve(Y,2,5);let ae=Math.max(0,V.x-J),ce=Math.max(0,V.y-J),de=Math.min(q.x+J,b-1),we=Math.min(q.y+J,b-1);for(let De=ce;De<=we;++De)for(let Ge=ae;Ge<=de;++Ge)sy[De*b+Ge]=255;let Te=0,Oe=0;for(let De=0;De<$.cellsY;++De)for(let Ge=0;Ge<$.cellsX;++Ge){if(!$.cells[De*$.cellsX+Ge])continue;const Je=c.tileCoordToPixel($.min.x+Ge/$.xScale,$.min.y+De/$.yScale),tt=c.tileCoordToPixel($.min.x+(Ge+1)/$.xScale,$.min.y+(De+1)/$.yScale);for(let Et=Je.y;Et<=Math.min(tt.y+1,b-1);++Et)for(let ct=Je.x;ct<=Math.min(tt.x+1,b-1);++ct)sy[Et*b+ct]===255&&(sy[Et*b+ct]=0,Te+=c.getElevationAtPixel(ct,Et),Oe++)}const Ue=Te/Oe;ae=Math.max(1,V.x-J),ce=Math.max(1,V.y-J),de=Math.min(q.x+J,b-2),we=Math.min(q.y+J,b-2),T=!0;for(let De=ce;De<=we;++De)for(let Ge=ae;Ge<=de;++Ge)sy[De*b+Ge]===0&&(PN[De*b+Ge]=c._dem.set(Ge,De,Ue));for(let De=1;De<J;++De){ae=Math.max(1,V.x-De),ce=Math.max(1,V.y-De),de=Math.min(q.x+De,b-2),we=Math.min(q.y+De,b-2);for(let Ge=ce;Ge<=we;++Ge)for(let Je=ae;Je<=de;++Je){const tt=Ge*b+Je;if(sy[tt]===255){let Et=0,ct=0,Tt=-1,kt=-1;for(let Dt=-1;Dt<=1;++Dt)for(let Zt=-1;Zt<=1;++Zt){const $t=(Ge+Dt)*b+Je+Zt;if(sy[$t]>=De)continue;const Rt=PN[$t],Bt=Math.abs(Rt);Bt>ct&&(Et=Rt,ct=Bt,Tt=Zt,kt=Dt)}if(ct>.1){const Dt=1-(De+.5*Math.abs(Tt*kt))/J;let Zt=c._dem.get(Je,Ge)+Et*Dt;const $t=c._dem.get(Je+Tt,Ge+kt),Rt=c._dem.get(Je-Tt,Ge-kt,!0);(Zt-$t)*(Zt-Rt)>0&&(Zt=($t+Rt)/2),PN[tt]=c._dem.set(Je,Ge,Zt),sy[tt]=De}}}}}T&&(c._demTile.needsDEMTextureUpload=!0,c._dem._timestamp=Xs.now())}setFilter(a){this.filter=a?w_(a):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(a=>this.filter.filter(new ki(this.id.overscaledZ,{worldview:this.worldview}),a.feature,this.id.canonical)):this.nodesInfo}destroy(){const a=this.getNodesInfo();for(const c of a)S2(c.node),Qj(c.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(a,c){if(c.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=c.updateTime;const f=c.getReplacementRegionsForTile(a.toUnwrapped());for(const p of this.getNodesInfo()){const _=p.node.footprint;p.hiddenByReplacement=!!_&&!f.find(b=>b.footprint===_)}}getHeightAtTileCoord(a,c){const f=[],p=[0,0,0],_=R([]);for(const b of this.getNodesInfo()){const T=b.node.meshes[0],I=T.transformedAabb;if(a<I.min[0]||c<I.min[1]||a>I.max[0]||c>I.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};L(_,b.node.globalMatrix),p[0]=a,p[1]=c,nr(p,p,_);const M=(p[0]-T.aabb.min[0])/(T.aabb.max[0]-T.aabb.min[0])*iy|0,$=Math.min(63,(p[1]-T.aabb.min[1])/(T.aabb.max[1]-T.aabb.min[1])*iy|0)*iy+Math.min(63,M),V=T.heightmap[$];if(!(V<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:V,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Nt(a,c),new Nt(a,c),f),f.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function U1(u,a){return u instanceof Vg&&!u.isLightConstant&&a}function ghe(u,a,c,f,p,_,b,T){let I=(61440&a|(61440&a)>>4)>>8,M=(3840&a|(3840&a)>>4)>>4,$=240&a|(240&a)>>4;c[3]>0&&(I=$r(I,255*c[0],c[3]),M=$r(M,255*c[1],c[3]),$=$r($,255*c[2],c[3]));const V=I<<8|M,q=$<<8|Math.floor(255*f[3]),Y=function(De){const Ge=ve(De,0,2);return Math.min(Math.round(.5*Ge*255),255)}(f[2])<<8|15*f[0]<<4|15*f[1],J=ve(p[0],0,1),ae=ve(p[1],0,1),ce=ve(p[2],0,1),de=ve(p[3],0,1);let we,Te,Oe,Ue;if(J!==ae&&b!==_&&ae!==J){const De=b-_;Te=1/(De*(ae-J)),Oe=-(_+De*J)/(De*(ae-J));const Ge=ve(p[4],-1,1);Ue=Math.pow(10,Ge),we=255*ce<<8|255*de}else we=65535,Te=0,Oe=1,Ue=1;if(u.emplaceBack(V,q,Y,we,Te,Oe,Ue),T){const De=T.length;T.clear();for(let Ge=0;Ge<De;Ge++)T.emplaceBack(V,q,Y,we,Te,Oe,Ue)}}function yhe(u,a,c){const f=u.node;let p=0;const _=c&G_.HasMeshoptCompression;for(const b of f.meshes){if(f.lights&&f.lightMeshIndex===p||!b.featureData)continue;b.featureArray=new Pp,b.featureArray.reserve(b.featureData.length);let T=a;for(const I of b.featureData){const M=_?65535&I:I>>16&65535,$=_?I>>16&65535:65535&I,V=(15&$)<8?15&$:0,q=u.evaluatedRMEA[V],Y=u.evaluatedColor[V],J=u.emissionHeightBasedParams[V];let ae;if(T&&V===2&&f.lights&&(ae=new Pp,ae.resize(10*f.lights.length)),ghe(b.featureArray,M,Y,q,J,b.aabb.min[2],b.aabb.max[2],ae),ae&&T){T=!1;const ce=f.meshes[f.lightMeshIndex];ce.featureArray=ae,ce.featureArray._trim()}}b.featureArray._trim(),p++}}gr(U2,"Tiled3dModelBucket",{omit:["layers"]}),gr(i6,"Tiled3dModelFeature");const vhe=["id","tile","layer","source","sourceLayer","state"];class ly{constructor(a,c,f,p,_){this.type="Feature",this._vectorTileFeature=a,this._z=c,this._x=f,this._y=p,this.properties=a?a.properties:{},this.id=_}clone(){const a=new ly(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(a.state=Object.assign({},this.state)),this.layer&&(a.layer=Object.assign({},this.layer)),this.source&&(a.source=this.source),this.sourceLayer&&(a.sourceLayer=this.sourceLayer),a}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const c of vhe)this[c]!==void 0&&(a[c]=this[c]);return a}}class cy extends Bu{constructor(a,c,f,p){super(),this.id=a,this.type="model",this.models=[],this._loaded=!1,this._options=c,this._modelsInfo=new Map}load(){const a=[];for(const c in this._options.models){const f=this._options.models[c],p=this._modelsInfo.get(c);if(p){const _=p.model;_.position=f.position!=null?new Q(f.position[0],f.position[1]):new Q(0,0),_.orientation=f.orientation!=null?f.orientation:[0,0,0],p.modelSpec=f,cy.applyModelSpecification(_,f),_.computeBoundsAndApplyParent(),this.models.push(_)}else{const _=SU(this.map._requestManager.transformRequest(f.uri,Lh.Model).url).then(b=>{if(!b)return;const T=tN(b),I=new CU(c,f.uri,f.position,f.orientation,T);cy.applyModelSpecification(I,f),I.computeBoundsAndApplyParent(),this.models.push(I),this._modelsInfo.set(c,{modelSpec:f,model:I})}).catch(b=>{this.fire(new wg(new Error(`Could not load model ${c} from ${f.uri}: ${b.message}`)))});a.push(_)}}Promise.allSettled(a).then(()=>{this._loaded=!0,this.fire(new vl("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this._loaded=!0,this.fire(new wg(new Error(`Could not load models: ${c.message}`)))})}static applyModelSpecification(a,c){c.nodeOverrides&&cy.convertNodeOverrides(a,c.nodeOverrides),c.materialOverrides&&cy.convertMaterialOverrides(a,c.materialOverrides),c.nodeOverrideNames&&(a.nodeOverrideNames=[...c.nodeOverrideNames]),c.materialOverrideNames&&(a.materialOverrideNames=[...c.materialOverrideNames]),c.featureProperties&&(a.featureProperties=c.featureProperties)}static convertNodeOverrides(a,c){if(Array.isArray(c)&&c.every(f=>typeof f=="string")){a.nodeOverrideNames=[];for(const f of c)a.nodeOverrideNames.push(f)}else Object.entries(c).forEach(([f,p])=>{const _={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const b=p.orientation;b&&(_.orientation=b)}a.nodeOverrides.set(f,_)})}static convertMaterialOverrides(a,c){if(Array.isArray(c)&&c.every(f=>typeof f=="string")){a.materialOverrideNames=[];for(const f of c)a.materialOverrideNames.push(f)}else Object.entries(c).forEach(([f,p])=>{const _={color:new ri(1,1,1),colorMix:0,emissionStrength:0,opacity:1},b=p["model-color"];b!==void 0&&(_.color.r=b[0],_.color.g=b[1],_.color.b=b[2]);const T=p["model-color-mix-intensity"];T!==void 0&&(_.colorMix=T);const I=p["model-emissive-strength"];I!==void 0&&(_.emissionStrength=I);const M=p["model-opacity"];M!==void 0&&(_.opacity=M),a.materialOverrides.set(f,_)})}onAdd(a){this.map=a,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(a,c){}serialize(){return this._options}setProperty(a,c){return!1}reload(){const a=Xh(this.id,this.scope);this.map.style.clearSource(a),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(a){this.models=[];const c=new Map;for(const f in a){const p=a[f];if(this._modelsInfo.has(f)){const _=this._modelsInfo.get(f);_&&_.modelSpec.uri===p.uri&&c.set(f,_)}}this._modelsInfo=c,this._options.models=a,this._loaded=!1,this.load()}}function CN(u,a,c,f){const p=1<<u.z;a.lat=Ae((f/Yt+u.y)/p),a.lng=Ie((c/Yt+u.x)/p)}function _he(u,a,c,f){const p=u.getNodesInfo()[a];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let _=Number.MAX_VALUE;const b=p.node,T=c.tile,I=f.calculatePosMatrix(T.tileID.toUnwrapped(),f.worldSize),M=p.evaluatedScale;let $=0;f.elevation&&b.elevation&&($=b.elevation*f.elevation.exaggeration()),F(I,I,[(b.anchor?b.anchor[0]:0)*(M[0]-1),(b.anchor?b.anchor[1]:0)*(M[1]-1),$]),B(I,I,M);const V=c.queryGeometry,q=V.isPointQuery()?V.screenBounds:V.screenGeometry,Y=function(ae){const ce=j([],I,ae.globalMatrix);j(ce,f.expandedFarZProjMatrix,ce);for(let de=0;de<ae.meshes.length;++de){const we=ae.meshes[de];if(de===ae.lightMeshIndex)continue;const Te=Yj(q,f,ce,we.aabb);Te!=null&&(_=Math.min(Te,_))}if(ae.children)for(const de of ae.children)Y(de)};if(Y(b),_===Number.MAX_VALUE)return;const J=new Q(0,0);return CN(T.tileID.canonical,J,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:_,position:J,feature:p.feature}}const xhe={circle:class extends os{constructor(u,a,c,f){super(u,{layout:Yu||(Yu=new la({"circle-sort-key":new sr(lt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new qt(lt.layout_circle["circle-elevation-reference"]),visibility:new qt(lt.layout_circle.visibility)})),paint:Ip||(Ip=new la({"circle-radius":new sr(lt.paint_circle["circle-radius"]),"circle-color":new sr(lt.paint_circle["circle-color"]),"circle-blur":new sr(lt.paint_circle["circle-blur"]),"circle-opacity":new sr(lt.paint_circle["circle-opacity"]),"circle-translate":new qt(lt.paint_circle["circle-translate"]),"circle-translate-anchor":new qt(lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qt(lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qt(lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sr(lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sr(lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sr(lt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new qt(lt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}createBucket(u){return new Xi(u)}queryRadius(u){const a=u;return mo("circle-radius",this,a)+mo("circle-stroke-width",this,a)+aa(this.paint.get("circle-translate"))}queryIntersectsFeature(u,a,c,f,p,_,b,T){const I=Op(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,u.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(a,c)+this.paint.get("circle-stroke-width").evaluate(a,c);return u$(u,f,_,b,T,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",I,M)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,a,c){const f=c$(this);return{config:new Xu(this,{zoom:a,lut:c}),defines:f,overrideFog:!1}}is3D(u){return!u&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends os{createBucket(u){return new h$(u)}constructor(u,a,c,f){super(u,{layout:f$||(f$=new la({visibility:new qt(lt.layout_heatmap.visibility)})),paint:p$||(p$=new la({"heatmap-radius":new sr(lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sr(lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qt(lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yp(lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qt(lt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(u){return mo("heatmap-radius",this,u)}queryIntersectsFeature(u,a,c,f,p,_,b,T){const I=this.paint.get("heatmap-radius").evaluate(a,c);return u$(u,f,_,b,T,!0,!0,new Nt(0,0),I)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,a,c){return u==="heatmap"?{config:new Xu(this,{zoom:a,lut:c}),overrideFog:!1}:{}}},hillshade:class extends os{constructor(u,a,c,f){super(u,{layout:m$||(m$=new la({visibility:new qt(lt.layout_hillshade.visibility)})),paint:g$||(g$=new la({"hillshade-illumination-direction":new qt(lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qt(lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qt(lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qt(lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qt(lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qt(lt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new qt(lt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}},fill:class extends os{constructor(u,a,c,f){super(u,{layout:k$||(k$=new la({"fill-sort-key":new sr(lt.layout_fill["fill-sort-key"]),visibility:new qt(lt.layout_fill.visibility),"fill-elevation-reference":new qt(lt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new sr(lt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:R$||(R$=new la({"fill-antialias":new qt(lt.paint_fill["fill-antialias"]),"fill-opacity":new sr(lt.paint_fill["fill-opacity"]),"fill-color":new sr(lt.paint_fill["fill-color"]),"fill-outline-color":new sr(lt.paint_fill["fill-outline-color"]),"fill-translate":new qt(lt.paint_fill["fill-translate"]),"fill-translate-anchor":new qt(lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new sr(lt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new qt(lt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new qt(lt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new sr(lt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new sr(lt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new sr(lt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}getProgramIds(){const u=this.paint.get("fill-pattern"),a=u&&u.constantOr(1),c=[a?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&c.push(a&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),c}getDefaultProgramParams(u,a,c){return{config:new Xu(this,{zoom:a,lut:c}),overrideFog:!1}}recalculate(u,a){super.recalculate(u,a);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new Nj(u)}queryRadius(){return aa(this.paint.get("fill-translate"))}queryIntersectsFeature(u,a,c,f,p,_){return!u.queryGeometry.isAboveHorizon&&ca(Tl(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,u.pixelToTileUnitsFactor),f)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(u){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const a=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return u!=null?a&&!u:a}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends os{constructor(u,a,c,f){super(u,{layout:nU||(nU=new la({visibility:new qt(lt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new qt(lt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:iU||(iU=new la({"fill-extrusion-opacity":new qt(lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sr(lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qt(lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qt(lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new sr(lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new qt(lt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new sr(lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sr(lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new qt(lt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new qt(lt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new qt(lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new qt(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new qt(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new qt(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new qt(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new qt(lt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new qt(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new qt(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new sr(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new sr(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new qt(lt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new qt(lt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new qt(lt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new qt(lt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new sr(lt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new sr(lt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new qt(lt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new f2(u)}queryRadius(){return aa(this.paint.get("fill-extrusion-translate"))}is3D(u){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,a,c,f,p,_,b,T,I){const M=Op(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,u.pixelToTileUnitsFactor),$=this.paint.get("fill-extrusion-height").evaluate(a,c),V=this.paint.get("fill-extrusion-base").evaluate(a,c),q=[0,0],Y=T&&_.elevation,J=_.elevation?_.elevation.exaggeration():1,ae=u.tile.getBucket(this);if(Y&&ae instanceof f2){const Oe=ae.centroidVertexArray,Ue=I+1;Ue<Oe.length&&(q[0]=Oe.geta_centroid_pos0(Ue),q[1]=Oe.geta_centroid_pos1(Ue))}if(q[0]===0&&q[1]===1)return!1;_.projection.name==="globe"&&(f=rU([f],[new Nt(0,0),new Nt(Yt,Yt)],u.tileID.canonical).map(Oe=>Oe.polygon).flat());const ce=Y?T:null,[de,we]=dU(_,f,V,$,M,b,ce,q,J,_.center.lat,u.tileID.canonical),Te=u.queryGeometry;return uU(de,we,Te.isPointQuery()?Te.screenBounds:Te.screenGeometry)}},building:class extends os{constructor(u,a,c,f){super(u,{layout:DU||(DU=new la({visibility:new qt(lt.layout_building.visibility),"building-facade":new sr(lt.layout_building["building-facade"]),"building-facade-floors":new sr(lt.layout_building["building-facade-floors"]),"building-facade-unit-width":new sr(lt.layout_building["building-facade-unit-width"]),"building-facade-window":new sr(lt.layout_building["building-facade-window"]),"building-roof-shape":new sr(lt.layout_building["building-roof-shape"]),"building-height":new sr(lt.layout_building["building-height"]),"building-base":new sr(lt.layout_building["building-base"]),"building-flood-light-wall-radius":new sr(lt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new sr(lt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new sr(lt.layout_building["building-flip-roof-orientation"])})),paint:LU||(LU=new la({"building-opacity":new qt(lt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new qt(lt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new qt(lt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new qt(lt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new qt(lt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new qt(lt.paint_building["building-vertical-scale"]),"building-cast-shadows":new qt(lt.paint_building["building-cast-shadows"]),"building-color":new sr(lt.paint_building["building-color"]),"building-emissive-strength":new sr(lt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new qt(lt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new qt(lt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new qt(lt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new qt(lt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new qt(lt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new MU(u)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(u){return!0}queryRadius(u){return 0}queryIntersectsFeature(u,a,c,f,p,_,b,T,I){let M=this.layout.get("building-height").evaluate(a,c);const $=this.layout.get("building-base").evaluate(a,c),V=u.tile.getBucket(this).getFootprint(a);if(V){if(V.hiddenFlags!==0)return!1;M=V.height}const[q,Y]=dU(_,f,$,M,new Nt(0,0),b,null,[0,0],1,_.center.lat,u.tileID.canonical),J=u.queryGeometry;return uU(q,Y,J.isPointQuery()?J.screenBounds:J.screenGeometry)}},line:class extends os{constructor(u,a,c,f){const p=HU();super(u,p,a,c,f),p.layout&&(this.layout=new Zh(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const a=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=a._styleExpression&&a._styleExpression.expression instanceof Lg,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,a){super.recalculate(u,a),this.paint._values["line-floorwidth"]=(()=>{if(P1)return P1;const c=HU();return P1=new gde(c.paint.properties["line-width"].specification),P1.useIntegerZoom=!0,P1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new nN(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,a,c){const f=WU(this);return{config:new Xu(this,{zoom:a,lut:c}),defines:f,overrideFog:!1}}queryRadius(u){const a=u,c=KU(mo("line-width",this,a),mo("line-gap-width",this,a)),f=mo("line-offset",this,a);return c/2+Math.abs(f)+aa(this.paint.get("line-translate"))}queryIntersectsFeature(u,a,c,f,p,_){if(u.queryGeometry.isAboveHorizon)return!1;const b=Tl(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,u.pixelToTileUnitsFactor),T=u.pixelToTileUnitsFactor/2*KU(this.paint.get("line-width").evaluate(a,c),this.paint.get("line-gap-width").evaluate(a,c)),I=this.paint.get("line-offset").evaluate(a,c);return I&&(f=function(M,$){const V=[],q=new Nt(0,0);for(let Y=0;Y<M.length;Y++){const J=M[Y],ae=[];for(let ce=0;ce<J.length;ce++){const de=J[ce],we=J[ce+1],Te=ce===0?q:de.sub(J[ce-1])._unit()._perp(),Oe=ce===J.length-1?q:we.sub(de)._unit()._perp(),Ue=Te._add(Oe)._unit();Ue._mult(1/(Ue.x*Oe.x+Ue.y*Oe.y)),ae.push(Ue._mult($)._add(de))}V.push(ae)}return V}(f,I*u.pixelToTileUnitsFactor)),function(M,$,V){for(let q=0;q<$.length;q++){const Y=$[q];if(M.length>=3){for(let J=0;J<Y.length;J++)if(po(M,Y[J]))return!0}if(Fs(M,Y,V))return!0}return!1}(b,f,T)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(u){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:F2,background:class extends os{constructor(u,a,c,f){super(u,{layout:LV||(LV=new la({visibility:new qt(lt.layout_background.visibility)})),paint:FV||(FV=new la({"background-pitch-alignment":new qt(lt.paint_background["background-pitch-alignment"]),"background-color":new qt(lt.paint_background["background-color"]),"background-pattern":new qt(lt.paint_background["background-pattern"]),"background-opacity":new qt(lt.paint_background["background-opacity"]),"background-emissive-strength":new qt(lt.paint_background["background-emissive-strength"]),"background-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,a,c){return{overrideFog:!1}}is3D(u){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:VV,"raster-particle":ZV,sky:class extends os{constructor(u,a,c,f){super(u,{layout:GV||(GV=new la({visibility:new qt(lt.layout_sky.visibility)})),paint:HV||(HV=new la({"sky-type":new qt(lt.paint_sky["sky-type"]),"sky-atmosphere-sun":new qt(lt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new qt(lt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new qt(lt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new qt(lt.paint_sky["sky-gradient-radius"]),"sky-gradient":new yp(lt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new qt(lt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new qt(lt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new qt(lt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=u1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const a=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==a.azimuthal||this._lightPosition.polar!==a.polar}return!1}getCenter(u,a){if(this.paint.get("sky-type")==="atmosphere"){const f=this.paint.get("sky-atmosphere-sun"),p=!f,_=u.style.light,b=_.properties.get("position");return p&&_.properties.get("anchor")==="viewport"&&kr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?EN(b.azimuthal,90-b.polar,a):EN(f[0],90-f[1],a)}const c=this.paint.get("sky-gradient-center");return EN(c[0],90-c[1],a)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends os{constructor(u,a,c,f){super(u,{paint:KV||(KV=new la({}))},a,null)}},model:class extends os{constructor(u,a,c,f){super(u,{layout:QV||(QV=new la({visibility:new qt(lt.layout_model.visibility),"model-id":new sr(lt.layout_model["model-id"])})),paint:e6||(e6=new la({"model-opacity":new sr(lt.paint_model["model-opacity"]),"model-rotation":new sr(lt.paint_model["model-rotation"]),"model-scale":new sr(lt.paint_model["model-scale"]),"model-translation":new sr(lt.paint_model["model-translation"]),"model-color":new sr(lt.paint_model["model-color"]),"model-color-mix-intensity":new sr(lt.paint_model["model-color-mix-intensity"]),"model-type":new qt(lt.paint_model["model-type"]),"model-cast-shadows":new qt(lt.paint_model["model-cast-shadows"]),"model-receive-shadows":new qt(lt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new qt(lt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new sr(lt.paint_model["model-emissive-strength"]),"model-roughness":new sr(lt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new sr(lt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new qt(lt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new qt(lt.paint_model["model-front-cutoff"]),"model-elevation-reference":new qt(lt.paint_model["model-elevation-reference"]),"model-color-use-theme":new sr({type:"string",default:"default","property-type":"data-driven"})}))},a,c,f),this.layer=u,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new AN(u)}getProgramIds(){return["model"]}is3D(u){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof U2?Yt-1:0}queryRenderedFeatures(u,a,c){const f=a.getSource();if(!(f&&f instanceof cy))return{};const p=f,_={};_[this.id]=[];const b=_[this.id];let T=0;for(const I of p.models){const M=a.getFeatureState(this.sourceLayer,I.id),$={type:"Unknown",id:I.id,properties:I.featureProperties},V=this.paint.get("model-rotation").evaluate($,M),q=this.paint.get("model-scale").evaluate($,M),Y=this.paint.get("model-translation").evaluate($,M),J=this.paint.get("model-elevation-reference");let ae=[];w2(ae,I,c,I.position,V,q,Y,J==="ground",J==="ground",!1),c.projection.name==="globe"&&(ae=b2(ae,c));const ce=j([],c.projMatrix,ae),de=Yj(u.isPointQuery()?u.screenBounds:u.screenGeometry,c,ce,I.aabb);if(de!=null){const we=new ly(void 0,0,0,0,I.id);we.layer=this.layer,we.properties=structuredClone(I.featureProperties),we.properties.layer=this.id,we.properties.uri=I.uri,we.properties.orientation=I.orientation,we.sourceLayer=this.sourceLayer,we.geometry={type:"Point",coordinates:[I.position.lng,I.position.lat]},we.state=M,we.source=this.source,b.push({featureIndex:T,feature:we,intersectionZ:de})}++T}return _}queryIntersectsFeature(u,a,c,f,p,_){if(!this.modelManager)return!1;const b=this.modelManager,T=u.tile.getBucket(this);if(!(T&&T instanceof AN))return!1;for(const I in T.instancesPerModel){const M=T.instancesPerModel[I],$=a.id!==void 0?a.id:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty($)){const V=M.features[M.idToFeaturesIndex[$]],q=b.getModel(I,this.scope);if(!q)return!1;let Y=[];const J=new Q(0,0),ae=T.canonical;let ce=Number.MAX_VALUE;for(let de=0;de<V.instancedDataCount;++de){const we=16*(V.instancedDataOffset+de),Te=M.instancedDataArray.float32,Oe=[Te[we+4],Te[we+5],Te[we+6]];CN(ae,J,Math.floor(Te[we]),Math.floor(Te[we+1])),w2(Y,q,_,J,V.rotation,V.scale,Oe,!1,!1,!1),_.projection.name==="globe"&&(Y=b2(Y,_));const Ue=j([],_.projMatrix,Y),De=u.queryGeometry,Ge=Yj(De.isPointQuery()?De.screenBounds:De.screenGeometry,_,Ue,q.aabb);Ge!=null&&(ce=Math.min(Ge,ce))}return ce!==Number.MAX_VALUE&&ce}}return!1}_handleOverridablePaintPropertyUpdate(u,a,c){return!(!this.layout||a.isDataDriven()||c.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const a=this._transitionablePaint._values[u];return a!=null&&a.value!=null&&a.value.expression!=null&&a.value.expression instanceof Vd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends os{constructor(u,a,c,f){super(u,{layout:j$||(j$=new la({"clip-layer-types":new qt(lt.layout_clip["clip-layer-types"]),"clip-layer-scope":new qt(lt.layout_clip["clip-layer-scope"])})),paint:N$||(N$=new la({}))},a,c,f)}recalculate(u,a){super.recalculate(u,a)}createBucket(u){return new M$(u)}is3D(u){return!0}}},ON=new ri(0,0,0),IN={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},kN={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},V2={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},bhe={PAINT_ORDER_FILL_AND_STROKE:1},V1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},a6={MASK_TYPE_LUMINANCE:1};function whe(u,a,c){u===1&&a.icons.push(function(f,p){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:b}=_;if(b.content_area){const{content_area:T}=b;T.left==null&&(T.left=0),T.top==null&&(T.top=T.left),T.width==null&&(T.width=_.usvg_tree.width),T.height==null&&(T.height=T.width)}if(b.text_placeholder){const{text_placeholder:T}=b;T.top==null&&(T.top=T.left),T.height==null&&(T.height=T.width)}return b.stretch_x&&b.stretch_x.length&&o6(b,"x"),b.stretch_y&&b.stretch_y.length&&o6(b,"y"),_}(f.readFields(She,{name:void 0},p))}(c,c.readVarint()+c.pos))}function o6(u,a){const c=[],f=u[`stretch_${a}`];let p=null;for(let _=0;_<f.length;_++)p===null?p=c.length===0?f[0]:c[c.length-1][1]+f[_]:(c.push([p,p+f[_]]),p=null);u[`stretch_${a}_areas`]=c}function She(u,a,c){u===1?a.name=c.readString():u===2?a.metadata=function(f,p){return f.readFields(Ehe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(c,c.readVarint()+c.pos):u===3&&(a.usvg_tree=function(f,p){return f.readFields(Phe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(c,c.readVarint()+c.pos),a.data="usvg_tree")}function Ehe(u,a,c){u===1?a.stretch_x=c.readPackedVarint():u===2?a.stretch_y=c.readPackedVarint():u===3?a.content_area=s6(c,c.readVarint()+c.pos):u===4?a.variables.push(function(f,p){return f.readFields(Ahe,{name:void 0},p)}(c,c.readVarint()+c.pos)):u===5&&(a.text_placeholder=s6(c,c.readVarint()+c.pos))}function s6(u,a){return u.readFields(The,{},a)}function The(u,a,c){u===1?a.left=c.readVarint():u===2?a.width=c.readVarint():u===3?a.top=c.readVarint():u===4&&(a.height=c.readVarint())}function Ahe(u,a,c){u===1?a.name=c.readString():u===2&&(a.rgb_color=G2(c.readVarint()),a.value="rgb_color")}function Phe(u,a,c){u===1?a.width=a.height=c.readVarint():u===2?a.height=c.readVarint():u===3?a.children.push(q2(c,c.readVarint()+c.pos)):u===4?a.linear_gradients.push(function(f,p){return f.readFields(Nhe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(c,c.readVarint()+c.pos)):u===5?a.radial_gradients.push(function(f,p){return f.readFields(Dhe,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(c,c.readVarint()+c.pos)):u===7?a.clip_paths.push(function(f,p){return f.readFields(Lhe,{children:[]},p)}(c,c.readVarint()+c.pos)):u===8&&a.masks.push(function(f,p){const _=f.readFields(Fhe,{left:0,width:20,mask_type:a6.MASK_TYPE_LUMINANCE,children:[]},p);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(c,c.readVarint()+c.pos))}function q2(u,a){return u.readFields(Che,{},a)}function Che(u,a,c){u===1?(a.group=function(f,p){return f.readFields(Ohe,{opacity:255,children:[]},p)}(c,c.readVarint()+c.pos),a.node="group"):u===2&&(a.path=function(f,p){return f.readFields(khe,{paint_order:1,commands:[],step:1,diffs:[],rule:IN.PATH_RULE_NON_ZERO},p)}(c,c.readVarint()+c.pos),a.node="path")}function Ohe(u,a,c){u===1?a.transform=W2(c,c.readVarint()+c.pos):u===2?a.opacity=c.readVarint():u===5?a.clip_path_idx=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(q2(c,c.readVarint()+c.pos))}function W2(u,a){return u.readFields(Ihe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},a)}function Ihe(u,a,c){u===1?a.sx=c.readFloat():u===2?a.ky=c.readFloat():u===3?a.kx=c.readFloat():u===4?a.sy=c.readFloat():u===5?a.tx=c.readFloat():u===6&&(a.ty=c.readFloat())}function khe(u,a,c){u===1?a.fill=function(f,p){return f.readFields(Rhe,{rgb_color:ON,paint:"rgb_color",opacity:255},p)}(c,c.readVarint()+c.pos):u===2?a.stroke=function(f,p){return f.readFields(jhe,{rgb_color:ON,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(c,c.readVarint()+c.pos):u===3?a.paint_order=c.readVarint():u===5?c.readPackedVarint(a.commands):u===6?a.step=c.readFloat():u===7?c.readPackedSVarint(a.diffs):u===8&&(a.rule=c.readVarint())}function Rhe(u,a,c){u===1?(a.rgb_color=G2(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5&&(a.opacity=c.readVarint())}function G2(u){return new ri((u>>16&255)/255,(u>>8&255)/255,(255&u)/255,1)}function jhe(u,a,c){u===1?(a.rgb_color=G2(c.readVarint()),a.paint="rgb_color"):u===2?(a.linear_gradient_idx=c.readVarint(),a.paint="linear_gradient_idx"):u===3?(a.radial_gradient_idx=c.readVarint(),a.paint="radial_gradient_idx"):u===5?c.readPackedFloat(a.dasharray):u===6?a.dashoffset=c.readFloat():u===7?a.miterlimit=c.readFloat():u===8?a.opacity=c.readVarint():u===9?a.width=c.readFloat():u===10?a.linecap=c.readVarint():u===11&&(a.linejoin=c.readVarint())}function Nhe(u,a,c){u===1?a.transform=W2(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(l6(c,c.readVarint()+c.pos)):u===4?a.x1=c.readFloat():u===5?a.y1=c.readFloat():u===6?a.x2=c.readFloat():u===7&&(a.y2=c.readFloat())}function l6(u,a){return u.readFields(Mhe,{offset:0,opacity:255,rgb_color:ON},a)}function Mhe(u,a,c){u===1?a.offset=c.readFloat():u===2?a.opacity=c.readVarint():u===3&&(a.rgb_color=G2(c.readVarint()))}function Dhe(u,a,c){u===1?a.transform=W2(c,c.readVarint()+c.pos):u===2?a.spread_method=c.readVarint():u===3?a.stops.push(l6(c,c.readVarint()+c.pos)):u===4?a.cx=c.readFloat():u===5?a.cy=c.readFloat():u===6?a.r=c.readFloat():u===7?a.fx=c.readFloat():u===8?a.fy=c.readFloat():u===9&&(a.fr=c.readFloat())}function Lhe(u,a,c){u===1?a.transform=W2(c,c.readVarint()+c.pos):u===2?a.clip_path_idx=c.readVarint():u===3&&a.children.push(q2(c,c.readVarint()+c.pos))}function Fhe(u,a,c){u===1?a.left=a.top=c.readFloat():u===2?a.width=a.height=c.readFloat():u===3?a.top=c.readFloat():u===4?a.height=c.readFloat():u===5?a.mask_type=c.readVarint():u===6?a.mask_idx=c.readVarint():u===7&&a.children.push(q2(c,c.readVarint()+c.pos))}class zhe{static calculate(a={},c=[]){const f=new Map,p=new Map;if(Object.keys(a).length===0)return f;c.forEach(_=>{p.set(_.name,_.rgb_color||new ri(0,0,0))});for(const[_,b]of Object.entries(a))p.has(_)?f.set(p.get(_).toString(),b):console.warn(`Ignoring unknown image variable "${_}"`);return f}}function rx(u,a=255,c){const f=a/255,p=u.toString(),_=c.has(p)?c.get(p).clone():u.clone();return _.a*=f,_.toString()}function q1(u,a){if(!Zs()){const c=document.createElement("canvas");return c.width=u,c.height=a,c}return new OffscreenCanvas(u,a)}function Bhe(u,a){const c=zhe.calculate(a.params,u.metadata?u.metadata.variables:[]),f=u.usvg_tree,p=f.width,_=f.height,b=a.transform?a.transform:new DOMMatrix,T=Math.max(1,Math.round(p*b.a)),I=Math.max(1,Math.round(_*b.d)),M=new DOMMatrix([T/p,0,0,I/_,0,0]),$=q1(T,I).getContext("2d");return RN($,M,f,f,c),$.getImageData(0,0,T,I)}function RN(u,a,c,f,p){for(const _ of f.children)c6(u,a,c,_,p)}function c6(u,a,c,f,p){f.group?(u.save(),function(_,b,T,I,M){const $=I.mask_idx!=null?T.masks[I.mask_idx]:null,V=I.clip_path_idx!=null?T.clip_paths[I.clip_path_idx]:null;if(I.transform&&(b=nx(I.transform).preMultiplySelf(b)),!function(J,ae,ce){return J.opacity!==255||ae||ce}(I,V!=null,$!=null))return void RN(_,b,T,I,M);const q=q1(_.canvas.width,_.canvas.height),Y=q.getContext("2d");RN(Y,b,T,I,M),V&&g6(Y,b,T,V),$&&y6(Y,b,T,$,M),_.globalAlpha=I.opacity/255,_.drawImage(q,0,0)}(u,a,c,f.group,p),u.restore()):f.path&&(u.save(),function(_,b,T,I,M){_.setTransform(b),I.paint_order===bhe.PAINT_ORDER_FILL_AND_STROKE?(u6(_,T,I,M),h6(_,T,I,M)):(h6(_,T,I,M),u6(_,T,I,M))}(u,a,c,f.path,p),u.restore())}function u6(u,a,c,f){const p=c.fill;if(!p)return;const _=p.opacity/255;switch(u.save(),u.beginPath(),v6(c,u),p.paint){case"rgb_color":u.fillStyle=rx(p.rgb_color,p.opacity,f);break;case"linear_gradient_idx":{const b=a.linear_gradients[p.linear_gradient_idx];b.transform&&u.setTransform(nx(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=f6(u,b,_,f);break}case"radial_gradient_idx":{const b=a.radial_gradients[p.radial_gradient_idx];b.transform&&u.setTransform(nx(b.transform).preMultiplySelf(u.getTransform())),u.fillStyle=p6(u,b,_,f)}}u.fill(d6(c)),u.restore()}function d6(u){return u.rule===IN.PATH_RULE_NON_ZERO?"nonzero":u.rule===IN.PATH_RULE_EVEN_ODD?"evenodd":void 0}function h6(u,a,c,f){const p=c.stroke;if(!p)return;const _=_6(c);u.lineWidth=p.width,u.miterLimit=p.miterlimit,u.setLineDash(p.dasharray),u.lineDashOffset=p.dashoffset;const b=p.opacity/255;switch(p.paint){case"rgb_color":u.strokeStyle=rx(p.rgb_color,p.opacity,f);break;case"linear_gradient_idx":u.strokeStyle=f6(u,a.linear_gradients[p.linear_gradient_idx],b,f,!0);break;case"radial_gradient_idx":u.strokeStyle=p6(u,a.radial_gradients[p.radial_gradient_idx],b,f,!0)}switch(p.linejoin){case V2.LINE_JOIN_MITER_CLIP:case V2.LINE_JOIN_MITER:u.lineJoin="miter";break;case V2.LINE_JOIN_ROUND:u.lineJoin="round";break;case V2.LINE_JOIN_BEVEL:u.lineJoin="bevel"}switch(p.linecap){case kN.LINE_CAP_BUTT:u.lineCap="butt";break;case kN.LINE_CAP_ROUND:u.lineCap="round";break;case kN.LINE_CAP_SQUARE:u.lineCap="square"}u.stroke(_)}function f6(u,a,c,f,p=!1){if(a.stops.length===1){const q=a.stops[0];return rx(q.rgb_color,q.opacity*c,f)}const{x1:_,y1:b,x2:T,y2:I}=a;let M=new DOMPoint(_,b),$=new DOMPoint(T,I);if(p){const q=nx(a.transform);M=q.transformPoint(M),$=q.transformPoint($)}const V=u.createLinearGradient(M.x,M.y,$.x,$.y);for(const q of a.stops)V.addColorStop(q.offset,rx(q.rgb_color,q.opacity*c,f));return V}function p6(u,a,c,f,p=!1){if(a.stops.length===1){const de=a.stops[0];return rx(de.rgb_color,de.opacity*c,f)}const _=nx(a.transform),{fx:b,fy:T,fr:I,cx:M,cy:$,r:V}=a;let q=new DOMPoint(b,T),Y=new DOMPoint(M,$),J=I,ae=V;if(p){q=_.transformPoint(q),Y=_.transformPoint(Y);const de=(_.a+_.d)/2;J=I*de,ae=a.r*de}const ce=u.createRadialGradient(q.x,q.y,J,Y.x,Y.y,ae);for(const de of a.stops)ce.addColorStop(de.offset,rx(de.rgb_color,de.opacity*c,f));return ce}function m6(u,a,c,f){const p=f.transform?nx(f.transform).preMultiplySelf(a):a,_=q1(u.canvas.width,u.canvas.height),b=_.getContext("2d");for(const I of f.children)if(I.group)m6(b,p,c,I.group);else if(I.path){const M=I.path,$=new Path2D;$.addPath(_6(M),p),b.fill($,d6(M))}const T=f.clip_path_idx!=null?c.clip_paths[f.clip_path_idx]:null;T&&g6(b,p,c,T),u.globalCompositeOperation="source-over",u.drawImage(_,0,0)}function g6(u,a,c,f){const p=q1(u.canvas.width,u.canvas.height);m6(p.getContext("2d"),a,c,f),u.globalCompositeOperation="destination-in",u.drawImage(p,0,0)}function y6(u,a,c,f,p){if(f.children.length===0)return;const _=f.mask_idx!=null?c.masks[f.mask_idx]:null;_&&y6(u,a,c,_,p);const b=u.canvas.width,T=u.canvas.height,I=q1(b,T),M=I.getContext("2d"),$=f.width,V=f.height,q=f.left,Y=f.top,J=new Path2D,ae=new Path2D;ae.rect(q,Y,$,V),J.addPath(ae,a),M.clip(J);for(const we of f.children)c6(M,a,c,we,p);const ce=M.getImageData(0,0,b,T),de=ce.data;if(f.mask_type===a6.MASK_TYPE_LUMINANCE)for(let we=0;we<de.length;we+=4)de[we+3]=de[we+3]/255*(.2126*de[we]+.7152*de[we+1]+.0722*de[we+2]);M.putImageData(ce,0,0),u.globalCompositeOperation="destination-in",u.drawImage(I,0,0)}function nx(u){return u?new DOMMatrix([u.sx,u.ky,u.kx,u.sy,u.tx,u.ty]):new DOMMatrix}function v6(u,a){const c=u.step;let f=u.diffs[0]*c,p=u.diffs[1]*c;a.moveTo(f,p);for(let _=0,b=2;_<u.commands.length;_++)switch(u.commands[_]){case V1.PATH_COMMAND_MOVE:f+=u.diffs[b++]*c,p+=u.diffs[b++]*c,a.moveTo(f,p);break;case V1.PATH_COMMAND_LINE:f+=u.diffs[b++]*c,p+=u.diffs[b++]*c,a.lineTo(f,p);break;case V1.PATH_COMMAND_QUAD:{const T=f+u.diffs[b++]*c,I=p+u.diffs[b++]*c;f=T+u.diffs[b++]*c,p=I+u.diffs[b++]*c,a.quadraticCurveTo(T,I,f,p);break}case V1.PATH_COMMAND_CUBIC:{const T=f+u.diffs[b++]*c,I=p+u.diffs[b++]*c,M=T+u.diffs[b++]*c,$=I+u.diffs[b++]*c;f=M+u.diffs[b++]*c,p=$+u.diffs[b++]*c,a.bezierCurveTo(T,I,M,$,f,p);break}case V1.PATH_COMMAND_CLOSE:a.closePath()}return a}function _6(u){return v6(u,new Path2D)}class H2{constructor(a){this.capacity=a,this.cache=new Map}get(a){if(!this.cache.has(a))return;const c=this.cache.get(a);return this.cache.delete(a),this.cache.set(a,c),c}put(a,c){this.cache.has(a)?this.cache.delete(a):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(a,c)}delete(a){this.cache.delete(a)}}gr(H2,"LRUCache");class jN{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(a){return new Wo(a,a.data)}getFromCache(a,c,f){return this.cacheMap.has(f)||this.cacheMap.set(f,new H2(150)),this.cacheMap.get(f).get(Xh(a.toString(),c))}setInCache(a,c,f,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new H2(150));const _=this.cacheDependenciesMap.get(p),b=Xh(a.id.toString(),f);_.get(b)||_.set(b,new Set);const T=this.cacheMap.get(p),I=a.toString();_.get(b).add(I),T.put(Xh(a.toString(),f),c)}removeImagesFromCacheByIds(a,c,f=0){if(!this.cacheMap.has(f)||!this.cacheDependenciesMap.has(f))return;const p=this.cacheMap.get(f),_=this.cacheDependenciesMap.get(f);for(const b of a){const T=Xh(b.toString(),c);if(_.has(T)){for(const I of _.get(T))p.delete(I);_.delete(T)}}}rasterize(a,c,f,p,_=Bhe){const b=this.getFromCache(a,f,p);if(b)return b.clone();const T=_(c.icon,a.options),I=jN._getImage(T);return this.setInCache(a,I,f,p),I.clone()}}class x6{constructor(a){this.size=a,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(a,c){const f=this.toIdx(a,c);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(a,c){return this.leaves[this.toIdx(a,c)]}toIdx(a,c){return c*this.size+a}}function b6(u,a,c,f){let p=0,_=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(f[b])<1e-15){if(c[b]<u[b]||c[b]>a[b])return null}else{const T=1/f[b];let I=(u[b]-c[b])*T,M=(a[b]-c[b])*T;if(I>M){const $=I;I=M,M=$}if(I>p&&(p=I),M<_&&(_=M),p>_)return null}return p}function w6(u,a,c,f,p,_,b,T,I,M,$){const V=f-u,q=p-a,Y=_-c,J=b-u,ae=T-a,ce=I-c,de=$[1]*ce-$[2]*ae,we=$[2]*J-$[0]*ce,Te=$[0]*ae-$[1]*J,Oe=V*de+q*we+Y*Te;if(Math.abs(Oe)<1e-15)return null;const Ue=1/Oe,De=M[0]-u,Ge=M[1]-a,Je=M[2]-c,tt=(De*de+Ge*we+Je*Te)*Ue;if(tt<0||tt>1)return null;const Et=Ge*Y-Je*q,ct=Je*V-De*Y,Tt=De*q-Ge*V,kt=($[0]*Et+$[1]*ct+$[2]*Tt)*Ue;return kt<0||tt+kt>1?null:(J*Et+ae*ct+ce*Tt)*Ue}function S6(u,a,c){return(u-a)/(c-a)}function E6(u,a,c,f,p,_,b,T,I){const M=1<<c,$=_-f,V=b-p,q=(u+1)/M*$+f,Y=(a+0)/M*V+p,J=(a+1)/M*V+p;T[0]=(u+0)/M*$+f,T[1]=Y,I[0]=q,I[1]=J}class T6{constructor(a){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=a,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const c=function(_){const b=Math.ceil(Math.log2(_.dim/8)),T=[];let I=Math.ceil(Math.pow(2,b));const M=1/I,$=(Y,J,ae,ce,de)=>{const we=ce?1:0,Te=(Y+1)*ae-we,Oe=J*ae,Ue=(J+1)*ae-we;de[0]=Y*ae,de[1]=Oe,de[2]=Te,de[3]=Ue};let V=new x6(I);const q=[];for(let Y=0;Y<I*I;Y++){$(Y%I,Math.floor(Y/I),M,!1,q);const J=Lp(q[0],q[1],_),ae=Lp(q[2],q[1],_),ce=Lp(q[2],q[3],_),de=Lp(q[0],q[3],_);V.minimums.push(Math.min(J,ae,ce,de)),V.maximums.push(Math.max(J,ae,ce,de)),V.leaves.push(1)}for(T.push(V),I/=2;I>=1;I/=2){const Y=T[T.length-1];V=new x6(I);for(let J=0;J<I*I;J++){$(J%I,Math.floor(J/I),2,!0,q);const ae=Y.getElevation(q[0],q[1]),ce=Y.getElevation(q[2],q[1]),de=Y.getElevation(q[2],q[3]),we=Y.getElevation(q[0],q[3]),Te=Y.isLeaf(q[0],q[1]),Oe=Y.isLeaf(q[2],q[1]),Ue=Y.isLeaf(q[2],q[3]),De=Y.isLeaf(q[0],q[3]),Ge=Math.min(ae.min,ce.min,de.min,we.min),Je=Math.max(ae.max,ce.max,de.max,we.max),tt=Te&&Oe&&Ue&&De;V.maximums.push(Je),V.minimums.push(Ge),V.leaves.push(Je-Ge<=5&&tt?1:0)}T.push(V)}return T}(this.dem),f=c.length-1,p=c[f];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(c,0,0,f,0)}raycastRoot(a,c,f,p,_,b,T=1){return b6([a,c,-100],[f,p,this.maximums[0]*T],_,b)}raycast(a,c,f,p,_,b,T=1){if(!this.nodeCount)return null;const I=this.raycastRoot(a,c,f,p,_,b,T);if(I==null)return null;const M=[],$=[],V=[],q=[],Y=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;Y.length>0;){const{idx:J,t:ae,nodex:ce,nodey:de,depth:we}=Y.pop();if(this.leaves[J]){E6(ce,de,we,a,c,f,p,V,q);const Oe=1<<we,Ue=(ce+0)/Oe,De=(ce+1)/Oe,Ge=(de+0)/Oe,Je=(de+1)/Oe,tt=Lp(Ue,Ge,this.dem)*T,Et=Lp(De,Ge,this.dem)*T,ct=Lp(De,Je,this.dem)*T,Tt=Lp(Ue,Je,this.dem)*T,kt=w6(V[0],V[1],tt,q[0],V[1],Et,q[0],q[1],ct,_,b),Dt=w6(q[0],q[1],ct,V[0],q[1],Tt,V[0],V[1],tt,_,b),Zt=Math.min(kt!==null?kt:Number.MAX_VALUE,Dt!==null?Dt:Number.MAX_VALUE);if(Zt!==Number.MAX_VALUE)return Zt;{const $t=Qe([],_,b,ae);if(A6(tt,Et,Tt,ct,S6($t[0],V[0],q[0]),S6($t[1],V[1],q[1]))>=$t[2])return ae}continue}let Te=0;for(let Oe=0;Oe<this._siblingOffset.length;Oe++){E6((ce<<1)+this._siblingOffset[Oe][0],(de<<1)+this._siblingOffset[Oe][1],we+1,a,c,f,p,V,q),V[2]=-100,q[2]=this.maximums[this.childOffsets[J]+Oe]*T;const Ue=b6(V,q,_,b);if(Ue!=null){const De=Ue;M[Oe]=De;let Ge=!1;for(let Je=0;Je<Te&&!Ge;Je++)De>=M[$[Je]]&&($.splice(Je,0,Oe),Ge=!0);Ge||($[Te]=Oe),Te++}}for(let Oe=0;Oe<Te;Oe++){const Ue=$[Oe];Y.push({idx:this.childOffsets[J]+Ue,t:M[Ue],nodex:(ce<<1)+this._siblingOffset[Ue][0],nodey:(de<<1)+this._siblingOffset[Ue][1],depth:we+1})}}return null}_addNode(a,c,f){return this.minimums.push(a),this.maximums.push(c),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(a,c,f,p,_){if(a[p].isLeaf(c,f)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const b=p-1,T=a[b];let I=0,M=0;for(let $=0;$<this._siblingOffset.length;$++){const V=2*c+this._siblingOffset[$][0],q=2*f+this._siblingOffset[$][1],Y=T.getElevation(V,q),J=T.isLeaf(V,q),ae=this._addNode(Y.min,Y.max,J);J&&(I|=1<<$),M||(M=ae)}for(let $=0;$<this._siblingOffset.length;$++)I&1<<$||this._construct(a,2*c+this._siblingOffset[$][0],2*f+this._siblingOffset[$][1],b,M+$)}}function A6(u,a,c,f,p,_){return $r($r(u,c,_),$r(a,f,_),p)}function Lp(u,a,c){const f=c.dim,p=ve(u*f-.5,0,f-1),_=ve(a*f-.5,0,f-1),b=Math.floor(p),T=Math.floor(_),I=Math.min(b+1,f-1),M=Math.min(T+1,f-1);return A6(c.get(b,T),c.get(I,T),c.get(b,M),c.get(I,M),p-b,_-T)}const $he={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Uhe(u,a,c){return(256*u*256+256*a+c)/10-1e4}function Vhe(u,a,c){return 256*u+a+c/256-32768}class K2{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(a,c,f,p=!1){if(this.uid=a,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&f!=="mapbox"&&f!=="terrarium")return void kr(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=c.height;const _=this.dim=c.height-2,b=new Uint32Array(c.data.buffer);if(this.pixels=new Uint8Array(c.data.buffer),this.floatView=new Float32Array(c.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let I=0;I<_;I++)b[this._idx(-1,I)]=b[this._idx(0,I)],b[this._idx(_,I)]=b[this._idx(_-1,I)],b[this._idx(I,-1)]=b[this._idx(I,0)],b[this._idx(I,_)]=b[this._idx(I,_-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(_,-1)]=b[this._idx(_-1,0)],b[this._idx(-1,_)]=b[this._idx(0,_-1)],b[this._idx(_,_)]=b[this._idx(_-1,_-1)]}const T=f==="terrarium"?Vhe:Uhe;for(let I=0;I<b.length;++I){const M=4*I;this.floatView[I]=T(this.pixels[M],this.pixels[M+1],this.pixels[M+2])}this._timestamp=Xs.now()}_buildQuadTree(){this._tree=new T6(this)}get(a,c,f=!1){f&&(a=ve(a,-1,this.dim),c=ve(c,-1,this.dim));const p=this._idx(a,c);return this.floatView[p]}set(a,c,f){const p=this._idx(a,c),_=this.floatView[p];return this.floatView[p]=f,f-_}static getUnpackVector(a){return $he[a]}_idx(a,c){if(a<-1||a>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(a+1)}static pack(a,c){const f=[0,0,0,0],p=K2.getUnpackVector(c);let _=Math.floor((a+p[3])/p[2]);return f[2]=_%256,_=Math.floor(_/256),f[1]=_%256,_=Math.floor(_/256),f[0]=_,f}getPixels(){return new _$({width:this.stride,height:this.stride},this.pixels)}backfillBorder(a,c,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let p=c*this.dim,_=c*this.dim+this.dim,b=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:p=_-1;break;case 1:_=p+1}switch(f){case-1:b=T-1;break;case 1:T=b+1}const I=-c*this.dim,M=-f*this.dim;for(let $=b;$<T;$++)for(let V=p;V<_;V++){const q=4*this._idx(V,$),Y=4*this._idx(V+I,$+M);this.pixels[q+0]=a.pixels[Y+0],this.pixels[q+1]=a.pixels[Y+1],this.pixels[q+2]=a.pixels[Y+2],this.pixels[q+3]=a.pixels[Y+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function qhe(u,a,c){u===1?a.headerLength=c.readFixed32():u===2?a.x=c.readVarint():u===3?a.y=c.readVarint():u===4?a.z=c.readVarint():u===5&&a.layers.push(function(f,p){return f.readFields(Zhe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(c,c.readVarint()+c.pos))}function Whe(u,a,c){u===1?(a.delta_filter=function(f,p){return f.readFields(Ghe,{blockSize:0},p)}(c,c.readVarint()+c.pos),a.filter="delta_filter"):u===2?(c.readVarint(),a.filter="zigzag_filter"):u===3?(c.readVarint(),a.filter="bitshuffle_filter"):u===4&&(c.readVarint(),a.filter="byteshuffle_filter")}function Ghe(u,a,c){u===1&&(a.blockSize=c.readVarint())}function Hhe(u,a,c){u===1?(c.readVarint(),a.codec="gzip_data"):u===2?(c.readVarint(),a.codec="jpeg_image"):u===3?(c.readVarint(),a.codec="webp_image"):u===4&&(c.readVarint(),a.codec="png_image")}function Khe(u,a,c){let f=0,p=0;u===1?a.firstByte=c.readFixed64():u===2?a.lastByte=c.readFixed64():u===3?a.filters.push(function(_,b){return _.readFields(Whe,{},b)}(c,c.readVarint()+c.pos)):u===4?a.codec=function(_,b){return _.readFields(Hhe,{},b)}(c,c.readVarint()+c.pos):u===5?p=c.readFloat():u===6?f=c.readFloat():u===7?a.bands.push(c.readString()):u===8?a.offset=c.readDouble():u===9&&(a.scale=c.readDouble()),a.offset===0&&(a.offset=p),a.scale===0&&(a.scale=f)}function Zhe(u,a,c){u===1?a.version=c.readVarint():u===2?a.name=c.readString():u===3?a.units=c.readString():u===4?a.tileSize=c.readVarint():u===5?a.buffer=c.readVarint():u===6?a.pixelFormat=c.readVarint():u===7&&a.dataIndex.push(function(f,p){return f.readFields(Khe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(c,c.readVarint()+c.pos))}function Xhe(u,a,c){if(u===2)(function(f,p,_){f.readFields(Yhe,_,p)})(c,c.readVarint()+c.pos,a);else if(u===3)throw new Error("Not implemented")}function Yhe(u,a,c){if(u===1){let f=0;const p=c.readVarint()+c.pos;for(;c.pos<p;)a[f++]=c.readVarint()}}function Jhe(u,a){if(a.length!==4)throw new Error(`Expected data of dimension 4 but got ${a.length}.`);let c=a[3];for(let f=2;f>=1;f--){const p=f===1?1:0,_=f===2?1:0;for(let b=0;b<a[0];b++){const T=a[1]*b;for(let I=p;I<a[1];I++){const M=a[2]*(I+T);for(let $=_;$<a[2];$++){const V=a[3]*($+M);for(let q=0;q<a[3];q++){const Y=V+q;u[Y]+=u[Y-c]}}}}c*=a[f]}return u}function Qhe(u){for(let a=0,c=u.length;a<c;a++)u[a]=u[a]>>>1^-(1&u[a]);return u}function efe(u,a){switch(a){case"uint32":return u;case"uint16":for(let c=0;c<u.length;c+=2){const f=u[c],p=u[c+1];u[c]=(240&f)>>4|(61440&f)>>8|(240&p)<<4|61440&p,u[c+1]=15&f|(3840&f)>>4|(15&p)<<8|(3840&p)<<4}return u;case"uint8":for(let c=0;c<u.length;c+=4){const f=u[c],p=u[c+1],_=u[c+2],b=u[c+3];u[c+0]=(192&f)>>6|(192&p)>>4|(192&_)>>2|192&b,u[c+1]=(48&f)>>4|(48&p)>>2|48&_|(48&b)<<2,u[c+2]=(12&f)>>2|12&p|(12&_)<<2|(12&b)<<4,u[c+3]=3&f|(3&p)<<2|(3&_)<<4|(3&b)<<6}return u;default:throw new Error(`Invalid pixel format, "${a}"`)}}gr(K2,"DEMData"),gr(T6,"DemMinMaxQuadTree",{omit:["dem"]});var kc=Uint8Array,W1=Uint16Array,tfe=Int32Array,P6=new kc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),C6=new kc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rfe=new kc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),O6=function(u,a){for(var c=new W1(31),f=0;f<31;++f)c[f]=a+=1<<u[f-1];var p=new tfe(c[30]);for(f=1;f<30;++f)for(var _=c[f];_<c[f+1];++_)p[_]=_-c[f]<<5|f;return{b:c,r:p}},I6=O6(P6,2),k6=I6.b,nfe=I6.r;k6[28]=258,nfe[258]=28;for(var ife=O6(C6,0).b,R6=new W1(32768),eo=0;eo<32768;++eo){var ix=(43690&eo)>>1|(21845&eo)<<1;R6[eo]=((65280&(ix=(61680&(ix=(52428&ix)>>2|(13107&ix)<<2))>>4|(3855&ix)<<4))>>8|(255&ix)<<8)>>1}var G1=function(u,a,c){for(var f=u.length,p=0,_=new W1(a);p<f;++p)u[p]&&++_[u[p]-1];var b,T=new W1(a);for(p=1;p<a;++p)T[p]=T[p-1]+_[p-1]<<1;b=new W1(1<<a);var I=15-a;for(p=0;p<f;++p)if(u[p])for(var M=p<<4|u[p],$=a-u[p],V=T[u[p]-1]++<<$,q=V|(1<<$)-1;V<=q;++V)b[R6[V]>>I]=M;return b},H1=new kc(288);for(eo=0;eo<144;++eo)H1[eo]=8;for(eo=144;eo<256;++eo)H1[eo]=9;for(eo=256;eo<280;++eo)H1[eo]=7;for(eo=280;eo<288;++eo)H1[eo]=8;var j6=new kc(32);for(eo=0;eo<32;++eo)j6[eo]=5;var afe=G1(H1,9),ofe=G1(j6,5),NN=function(u){for(var a=u[0],c=1;c<u.length;++c)u[c]>a&&(a=u[c]);return a},td=function(u,a,c){var f=a/8|0;return(u[f]|u[f+1]<<8)>>(7&a)&c},MN=function(u,a){var c=a/8|0;return(u[c]|u[c+1]<<8|u[c+2]<<16)>>(7&a)},sfe=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rd=function(u,a,c){var f=new Error(a||sfe[u]);if(f.code=u,Error.captureStackTrace&&Error.captureStackTrace(f,rd),!c)throw f;return f},lfe=new kc(0),cfe=typeof TextDecoder<"u"&&new TextDecoder;try{cfe.decode(lfe,{stream:!0})}catch{}const ufe={gzip_data:"gzip"};class cu extends Error{constructor(a){super(a),this.name="MRTError"}}const dfe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},N6={uint32:1,uint16:2,uint8:4},hfe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let DN;class Z2{constructor(a=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=a}getLayer(a){const c=this.layers[a];if(!c)throw new cu(`Layer '${a}' not found`);return c}getHeaderLength(a){const c=new Uint8Array(a),f=new DataView(a);if(c[0]!==13)throw new cu("File is not a valid MRT.");return f.getUint32(1,!0)}parseHeader(a){const c=new Uint8Array(a),f=this.getHeaderLength(a);if(c.length<f)throw new cu(`Expected header with length >= ${f} but got buffer of length ${c.length}`);const p=new DN(c.subarray(0,f)).readFields(qhe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new cu(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const _ of p.layers)this.layers[_.name]=new M6(_,{cacheSize:this._cacheSize});return this}createDecodingTask(a){const c=[],f=this.getLayer(a.layerName);for(let p of a.blockIndices){const _=f.dataIndex[p],b=_.firstByte-a.firstByte,T=_.lastByte-a.firstByte;if(f._blocksInProgress.has(p))continue;const I={layerName:f.name,firstByte:b,lastByte:T,pixelFormat:f.pixelFormat,blockIndex:p,blockShape:[_.bands.length].concat(f.bandShape),buffer:f.buffer,codec:_.codec.codec,filters:_.filters.map(M=>M.filter)};f._blocksInProgress.add(p),c.push(I)}return new D6(c,()=>{c.forEach(p=>f._blocksInProgress.delete(p.blockIndex))},(p,_)=>{if(c.forEach(b=>f._blocksInProgress.delete(b.blockIndex)),p)throw p;_.forEach(b=>{this.getLayer(b.layerName).processDecodedData(b)})})}}class M6{constructor({version:a,name:c,units:f,tileSize:p,pixelFormat:_,buffer:b,dataIndex:T},I){if(this.version=a,this.version!==1)throw new cu(`Cannot parse raster layer encoded with MRT version ${a}`);this.name=c,this.units=f,this.tileSize=p,this.buffer=b,this.pixelFormat=dfe[_],this.dataIndex=T,this.bandShape=[p+2*b,p+2*b,N6[this.pixelFormat]],this._decodedBlocks=new H2(I?I.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return N6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:a})=>a).flat()}processDecodedData(a){const c=a.blockIndex.toString();this._decodedBlocks.get(c)||this._decodedBlocks.put(c,a.data)}getBlockForBand(a){let c=0;switch(typeof a){case"string":for(const[f,p]of this.dataIndex.entries()){for(const[_,b]of p.bands.entries())if(b===a)return{bandIndex:c+_,blockIndex:f,blockBandIndex:_};c+=p.bands.length}break;case"number":for(const[f,p]of this.dataIndex.entries()){if(a>=c&&a<c+p.bands.length)return{bandIndex:a,blockIndex:f,blockBandIndex:a-c};c+=p.bands.length}break;default:throw new cu(`Invalid band \`${JSON.stringify(a)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(a){let c=1/0,f=-1/0;const p=[],_=new Set;for(const b of a){const{blockIndex:T}=this.getBlockForBand(b);if(T<0)throw new cu(`Invalid band: ${JSON.stringify(b)}`);const I=this.dataIndex[T];p.includes(T)||p.push(T),_.add(T),c=Math.min(c,I.firstByte),f=Math.max(f,I.lastByte)}if(_.size>this.cacheSize)throw new cu(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:c,lastByte:f,blockIndices:p}}hasBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0}hasDataForBand(a){const{blockIndex:c}=this.getBlockForBand(a);return c>=0&&!!this._decodedBlocks.get(c.toString())}getBandView(a){const{blockIndex:c,blockBandIndex:f}=this.getBlockForBand(a);if(c<0)throw new cu(`Band not found: ${JSON.stringify(a)}`);const p=this._decodedBlocks.get(c.toString());if(!p)throw new cu(`Data for band ${JSON.stringify(a)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[c],b=this.bandShape.reduce((M,$)=>M*$,1),T=f*b,I=p.subarray(T,T+b);return{data:I,bytes:new Uint8Array(I.buffer).subarray(I.byteOffset,I.byteOffset+I.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}Z2.setPbf=function(u){DN=u};class D6{constructor(a,c,f){this.tasks=a,this._onCancel=c,this._onComplete=f,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(a,c){this._finalized||(this._onComplete(a,c),this._finalized=!0)}}Z2.performDecoding=function(u,a){const c=new Uint8Array(u);return Promise.all(a.tasks.map(f=>{const{layerName:p,firstByte:_,lastByte:b,pixelFormat:T,blockShape:I,blockIndex:M,filters:$,codec:V}=f,q=c.subarray(_,b+1),Y=new Uint32Array(I[0]*I[1]*I[2]);let J;if(V!=="gzip_data")throw new cu(`Unhandled codec: ${V}`);return J=function(ae,ce){if(!globalThis.DecompressionStream&&ce==="gzip_data")return Promise.resolve(((Oe=function(Ge){Ge[0]==31&&Ge[1]==139&&Ge[2]==8||rd(6,"invalid gzip data");var Je=Ge[3],tt=10;4&Je&&(tt+=2+(Ge[10]|Ge[11]<<8));for(var Et=(Je>>3&1)+(Je>>4&1);Et>0;Et-=!Ge[tt++]);return tt+(2&Je)}(Te=ae))+8>Te.length&&rd(6,"invalid gzip data"),function(Ge,Je,tt,Et){var ct=Ge.length;if(!ct||Je.f&&!Je.l)return tt||new kc(0);var Tt=!tt,kt=Tt||Je.i!=2,Dt=Je.i;Tt&&(tt=new kc(3*ct));var Zt,$t,Rt=function(oa){var Bi=tt.length;if(oa>Bi){var Pi=new kc(Math.max(2*Bi,oa));Pi.set(tt),tt=Pi}},Bt=Je.f||0,bt=Je.p||0,yt=Je.b||0,Ft=Je.l,Gt=Je.d,jt=Je.m,pr=Je.n,vr=8*ct;do{if(!Ft){Bt=td(Ge,bt,1);var ur=td(Ge,bt+1,3);if(bt+=3,!ur){var ir=Ge[(Le=4+((bt+7)/8|0))-4]|Ge[Le-3]<<8,Kr=Le+ir;if(Kr>ct){Dt&&rd(0);break}kt&&Rt(yt+ir),tt.set(Ge.subarray(Le,Kr),yt),Je.b=yt+=ir,Je.p=bt=8*Kr,Je.f=Bt;continue}if(ur==1)Ft=afe,Gt=ofe,jt=9,pr=5;else if(ur==2){var or=td(Ge,bt,31)+257,Or=td(Ge,bt+10,15)+4,Jr=or+td(Ge,bt+5,31)+1;bt+=14;for(var yn=new kc(Jr),Fn=new kc(19),tn=0;tn<Or;++tn)Fn[rfe[tn]]=td(Ge,bt+3*tn,7);bt+=3*Or;var Wn=NN(Fn),Gn=(1<<Wn)-1,Yi=G1(Fn,Wn);for(tn=0;tn<Jr;){var Le,je=Yi[td(Ge,bt,Gn)];if(bt+=15&je,(Le=je>>4)<16)yn[tn++]=Le;else{var Pt=0,rr=0;for(Le==16?(rr=3+td(Ge,bt,3),bt+=2,Pt=yn[tn-1]):Le==17?(rr=3+td(Ge,bt,7),bt+=3):Le==18&&(rr=11+td(Ge,bt,127),bt+=7);rr--;)yn[tn++]=Pt}}var Ct=yn.subarray(0,or),ar=yn.subarray(or);jt=NN(Ct),pr=NN(ar),Ft=G1(Ct,jt),Gt=G1(ar,pr)}else rd(1);if(bt>vr){Dt&&rd(0);break}}kt&&Rt(yt+131072);for(var Ar=(1<<jt)-1,Er=(1<<pr)-1,rn=bt;;rn=bt){var Dr=(Pt=Ft[MN(Ge,bt)&Ar])>>4;if((bt+=15&Pt)>vr){Dt&&rd(0);break}if(Pt||rd(2),Dr<256)tt[yt++]=Dr;else{if(Dr==256){rn=bt,Ft=null;break}var wr=Dr-254;Dr>264&&(wr=td(Ge,bt,(1<<(zr=P6[tn=Dr-257]))-1)+k6[tn],bt+=zr);var Vn=Gt[MN(Ge,bt)&Er],yi=Vn>>4;if(Vn||rd(3),bt+=15&Vn,ar=ife[yi],yi>3){var zr=C6[yi];ar+=MN(Ge,bt)&(1<<zr)-1,bt+=zr}if(bt>vr){Dt&&rd(0);break}kt&&Rt(yt+131072);var Dn=yt+wr;if(yt<ar){var vi=0-ar,ni=Math.min(ar,Dn);for(vi+yt<0&&rd(3);yt<ni;++yt)tt[yt]=(void 0)[vi+yt]}for(;yt<Dn;++yt)tt[yt]=tt[yt-ar]}}Je.l=Ft,Je.p=rn,Je.b=yt,Je.f=Bt,Ft&&(Bt=1,Je.m=jt,Je.d=Gt,Je.n=pr)}while(!Bt);return yt!=tt.length&&Tt?(Zt=tt,(($t=yt)==null||$t>Zt.length)&&($t=Zt.length),new kc(Zt.subarray(0,$t))):tt.subarray(0,yt)}(Te.subarray(Oe,-8),{i:2},new kc(((de=Te)[(we=de.length)-4]|de[we-3]<<8|de[we-2]<<16|de[we-1]<<24)>>>0))));var de,we,Te,Oe;const Ue=ufe[ce];if(!Ue)throw new Error(`Unhandled codec: ${ce}`);const De=new globalThis.DecompressionStream(Ue);return new Response(new Blob([ae]).stream().pipeThrough(De)).arrayBuffer().then(Ge=>new Uint8Array(Ge))}(q,V).then(ae=>(function(ce,de){ce.readFields(Xhe,de)}(new DN(ae),Y),new hfe[T](Y.buffer))),J.then(ae=>{for(let ce=$.length-1;ce>=0;ce--)switch($[ce]){case"delta_filter":Jhe(ae,I);break;case"zigzag_filter":Qhe(ae);break;case"bitshuffle_filter":efe(ae,T);break;default:throw new cu(`Unhandled filter "${$[ce]}"`)}return{layerName:p,blockIndex:M,data:ae}}).catch(ae=>{throw ae})}))},gr(D6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),gr(Z2,"MapboxRasterTile"),gr(M6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class L6{constructor(a){this._stringToNumber={},this._numberToString=[];for(let c=0;c<a.length;c++){const f=a[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(a){return this._stringToNumber[a]}decode(a){return this._numberToString[a]}}class F6{constructor(a,c){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Kh(Yt,16,0),this.featureIndexArray=new HA,this.promoteId=c,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(a,c,f,p,_,b=0,T=0){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,p,_,b);const M=this.grid;for(let $=0;$<c.length;$++){const V=c[$],q=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<V.length;Y++){const J=V[Y];q[0]=Math.min(q[0],J.x),q[1]=Math.min(q[1],J.y),q[2]=Math.max(q[2],J.x),q[3]=Math.max(q[3],J.y)}T!==0&&(q[0]-=T,q[1]-=T,q[2]+=T,q[3]+=T),q[0]<Yt&&q[1]<Yt&&q[2]>=0&&q[3]>=0&&M.insert(I,q[0],q[1],q[2],q[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new br(new T2(this.rawTileData)).layers,this.sourceLayerCoder=new L6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const a in this.vtLayers)this.vtFeatures[a]=[]}return this.vtLayers}query(a,c){const{tilespaceGeometry:f,transform:p,tileTransform:_,pixelPosMatrix:b,availableImages:T,worldview:I}=c;this.loadVTLayers(),this.serializedLayersCache.clear();const M=c.queryRadius?c.queryRadius:0,$=f.bufferedTilespaceBounds,V=this.grid.query($.min.x,$.min.y,$.max.x,$.max.y,(ae,ce,de,we)=>ia(f.bufferedTilespaceGeometry,ae-M,ce-M,de+M,we+M));V.sort(ffe);let q=null;p.elevation&&V.length>0&&(q=tx.create(p.elevation,this.tileID));const Y={};let J;for(let ae=0;ae<V.length;ae++){const ce=V[ae];if(ce===J)continue;J=ce;const de=this.featureIndexArray.get(ce);let we=null;this.is3DTile?this.loadMatchingModelFeature(Y,de,a,f,p,I):this.loadMatchingFeature(Y,de,a,T,I,(Te,Oe,Ue,De=0)=>(we||(we=It(Te,this.tileID.canonical,_)),Oe.queryIntersectsFeature(f,Te,Ue,we,this.z,p,b,q,De)))}return Y}loadMatchingFeature(a,c,f,p,_,b){const{featureIndex:T,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:$}=c,V=this.bucketLayerIDs[I],q=f.layers,Y=Object.keys(q);if(Y.length&&!Gr(Y,V))return;const J=f.sourceCache,ae=this.sourceLayerCoder.decode(M),ce=this.vtLayers[ae].feature(T),de=this.getId(ce,ae);for(let we=0;we<V.length;we++){const Te=V[we];if(!q[Te])continue;const{styleLayer:Oe,targets:Ue}=q[Te];let De={};de!==void 0&&(De=J.getFeatureState(Oe.sourceLayer,de));const Ge=!b||b(ce,Oe,De,$);if(!Ge)continue;const Je=new ly(ce,this.z,this.x,this.y,de);Je.tile=this.tileID.canonical,Je.state=De;let tt=this.serializedLayersCache.get(Te);tt||(tt=Oe.serialize(),tt.id=Te,this.serializedLayersCache.set(Te,tt)),Je.source=tt.source,Je.sourceLayer=tt["source-layer"],Je.layer=Object.assign({},tt),Je.layer.paint=z6(tt.paint,Oe.paint,ce,De,p),Je.layer.layout=z6(tt.layout,Oe.layout,ce,De,p);let Et=!1;for(const ct of Ue){this.updateFeatureProperties(Je,ct);const{filter:Tt}=ct;if(Tt){if(ce.properties=Je.properties,Tt.needGeometry){const kt=mt(ce,!0);if(!Tt.filter(new ki(this.tileID.overscaledZ,{worldview:_}),kt,this.tileID.canonical))continue}else if(!Tt.filter(new ki(this.tileID.overscaledZ,{worldview:_}),ce))continue}Et=!0,ct.targetId&&this.addFeatureVariant(Je,ct)}Et&&this.appendToResult(a,Te,T,Je,Ge)}}loadMatchingModelFeature(a,c,f,p,_,b){const{featureIndex:T,bucketIndex:I}=c,M=this.bucketLayerIDs[I],$=f.layers,V=Object.keys($);if(!V.length||Gr(V,M))for(let q=0;q<M.length;q++){const Y=M[q],{styleLayer:J,targets:ae}=$[Y];if(J.type!=="model")continue;const ce=p.tile,de=ce.getBucket(J);if(!(de&&de instanceof U2))continue;const we=_he(de,T,p,_);if(!we)continue;const{z:Te,x:Oe,y:Ue}=ce.tileID.canonical,{feature:De,intersectionZ:Ge,position:Je}=we;let tt={};De.id!==void 0&&(tt=f.sourceCache.getFeatureState(J.sourceLayer,De.id));const Et=new ly({},Te,Oe,Ue,De.id);Et.tile=this.tileID.canonical,Et.state=tt,Et.properties=De.properties,Et.geometry={type:"Point",coordinates:[Je.lng,Je.lat]};let ct=this.serializedLayersCache.get(Y);ct||(ct=J.serialize(),ct.id=Y,this.serializedLayersCache.set(Y,ct)),Et.source=ct.source,Et.sourceLayer=ct["source-layer"],Et.layer=Object.assign({},ct);let Tt=!1;for(const kt of ae){this.updateFeatureProperties(Et,kt);const{filter:Dt}=kt;if(Dt){if(De.properties=Et.properties,Dt.needGeometry){if(!Dt.filter(new ki(this.tileID.overscaledZ,{worldview:b}),De,this.tileID.canonical))continue}else if(!Dt.filter(new ki(this.tileID.overscaledZ,{worldview:b}),De))continue}Tt=!0,kt.targetId&&this.addFeatureVariant(Et,kt)}Tt&&this.appendToResult(a,Y,T,Et,Ge)}}updateFeatureProperties(a,c,f){if(c.properties){const p={};for(const _ in c.properties){const b=c.properties[_].evaluate({zoom:this.z},a._vectorTileFeature,a.state,a.tile,f);b!=null&&(p[_]=b)}a.properties=p}}addFeatureVariant(a,c,f){const p={target:c.target,namespace:c.namespace,uniqueFeatureID:c.uniqueFeatureID};c.properties&&(p.properties=a.properties),a.variants=a.variants||{},a.variants[c.targetId]=a.variants[c.targetId]||[],a.variants[c.targetId].push(p)}appendToResult(a,c,f,p,_){let b=a[c];b===void 0&&(b=a[c]=[]),b.push({featureIndex:f,feature:p,intersectionZ:_})}lookupSymbolFeatures(a,c,f,p,_,b){const T={};this.loadVTLayers();for(const I of a)this.loadMatchingFeature(T,{bucketIndex:c,sourceLayerIndex:f,featureIndex:I,layoutVertexArrayOffset:0},p,_,b);return T}loadFeature(a){const{featureIndex:c,sourceLayerIndex:f}=a;this.loadVTLayers();const p=this.sourceLayerCoder.decode(f),_=this.vtFeatures[p];if(_[c])return _[c];const b=this.vtLayers[p].feature(c);return _[c]=b,b}hasLayer(a){for(const c of this.bucketLayerIDs)for(const f of c)if(a===f)return!0;return!1}getId(a,c){let f=a.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[c];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const _=ou(p);if(_.result!=="success"){const b=_.value.map(T=>`${T.key}: ${T.message}`).join(", ");return void kr(`Failed to create expression for promoteId: ${b}`)}this.promoteIdExpression=_.value}f=this.promoteIdExpression.evaluate({zoom:0},a)}else f=a.properties[p];typeof f=="boolean"&&(f=Number(f))}return f}}function z6(u,a,c,f,p){return Ht(u,(_,b)=>{const T=a instanceof Zh?a.get(b):null;return T&&T.evaluate?T.evaluate(c,f,void 0,p):T})}function ffe(u,a){return a-u}gr(F6,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const B6=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class LN{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(a,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=f>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=B6[15&f];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(a,2,1),[T]=new Uint32Array(a,4,1);return new LN(T,b,_,a)}constructor(a,c=64,f=Float64Array,p){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const _=B6.indexOf(this.ArrayType),b=2*a*this.ArrayType.BYTES_PER_ELEMENT,T=a*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${f}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+T+I,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+I),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+T+I,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=a)}add(a,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=a,this.coords[this._pos++]=c,f}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return FN(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,c,f,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:T}=this,I=[0,_.length-1,0],M=[];for(;I.length;){const $=I.pop()||0,V=I.pop()||0,q=I.pop()||0;if(V-q<=T){for(let ce=q;ce<=V;ce++){const de=b[2*ce],we=b[2*ce+1];de>=a&&de<=f&&we>=c&&we<=p&&M.push(_[ce])}continue}const Y=q+V>>1,J=b[2*Y],ae=b[2*Y+1];J>=a&&J<=f&&ae>=c&&ae<=p&&M.push(_[Y]),($===0?a<=J:c<=ae)&&(I.push(q),I.push(Y-1),I.push(1-$)),($===0?f>=J:p>=ae)&&(I.push(Y+1),I.push(V),I.push(1-$))}return M}within(a,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,T=[0,p.length-1,0],I=[],M=f*f;for(;T.length;){const $=T.pop()||0,V=T.pop()||0,q=T.pop()||0;if(V-q<=b){for(let ce=q;ce<=V;ce++)U6(_[2*ce],_[2*ce+1],a,c)<=M&&I.push(p[ce]);continue}const Y=q+V>>1,J=_[2*Y],ae=_[2*Y+1];U6(J,ae,a,c)<=M&&I.push(p[Y]),($===0?a-f<=J:c-f<=ae)&&(T.push(q),T.push(Y-1),T.push(1-$)),($===0?a+f>=J:c+f>=ae)&&(T.push(Y+1),T.push(V),T.push(1-$))}return I}}function FN(u,a,c,f,p,_){if(p-f<=c)return;const b=f+p>>1;$6(u,a,b,f,p,_),FN(u,a,c,f,b-1,1-_),FN(u,a,c,b+1,p,1-_)}function $6(u,a,c,f,p,_){for(;p>f;){if(p-f>600){const M=p-f+1,$=c-f+1,V=Math.log(M),q=.5*Math.exp(2*V/3),Y=.5*Math.sqrt(V*q*(M-q)/M)*($-M/2<0?-1:1);$6(u,a,c,Math.max(f,Math.floor(c-$*q/M+Y)),Math.min(p,Math.floor(c+(M-$)*q/M+Y)),_)}const b=a[2*c+_];let T=f,I=p;for(K1(u,a,f,c),a[2*p+_]>b&&K1(u,a,f,p);T<I;){for(K1(u,a,T,I),T++,I--;a[2*T+_]<b;)T++;for(;a[2*I+_]>b;)I--}a[2*f+_]===b?K1(u,a,f,I):(I++,K1(u,a,I,p)),I<=c&&(f=I+1),c<=I&&(p=I-1)}}function K1(u,a,c,f){zN(u,c,f),zN(a,2*c,2*f),zN(a,2*c+1,2*f+1)}function zN(u,a,c){const f=u[a];u[a]=u[c],u[c]=f}function U6(u,a,c,f){const p=u-c,_=a-f;return p*p+_*_}i.$=Uv,i.A=Uu,i.B=Xh,i.C=2,i.D=U_,i.E=Bu,i.F=I1,i.G=pV,i.H=$v,i.I=Qa,i.J=$w,i.K=ep,i.L=Ig,i.M=h_,i.N=d_,i.O=Cw,i.P=Nt,i.Q=g_,i.R=Lh,i.S=vp,i.T=Zj,i.U=ou,i.V=$2,i.W=Iw,i.X=lp,i.Y=sp,i.Z=Dg,i._=as,i.a=function(u){return Fi.API_CDN_URL_REGEX.test(u)},i.a$=wp,i.a0=qr,i.a1=ew,i.a2=_p,i.a3=class extends $2{},i.a4=f_,i.a5=Pw,i.a6=lt,i.a7=function(u){const a=u.value;return a?qr(a)?TN(a,!0)?[]:[new $2(u.key,a,`invalid url "${a}"`)]:[new $2(u.key,a,`string expected, "${ep(a)}" found`)]:[]},i.a8=DA,i.a9=la,i.aA=ve,i.aB=j,i.aC=Qt,i.aD=Ls,i.aE=po,i.aF=xe,i.aG=wt,i.aH=function(u,a){const c={};for(let f=0;f<a.length;f++){const p=a[f];p in u&&(c[p]=u[p])}return c},i.aI=K,i.aJ=me,i.aK=class{constructor(u){this.entries={},this.scheduler=u}request(u,a,c,f){const p=this.entries[u]=this.entries[u]||{callbacks:[]};if(p.result){const[_,b]=p.result;return this.scheduler?this.scheduler.add(()=>{f(_,b)},a):f(_,b),()=>{}}return p.callbacks.push(f),p.cancel||(p.cancel=c((_,b)=>{p.result=[_,b];for(const T of p.callbacks)this.scheduler?this.scheduler.add(()=>{T(_,b)},a):T(_,b);setTimeout(()=>delete this.entries[u],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==f),p.callbacks.length||(p.cancel(),delete this.entries[u]))}}},i.aL=function(u,a,c){const f=JSON.stringify(u.request);return u.data&&(this.deduped.entries[f]={result:[null,u.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},p=>{const _=Zf(u.request,(b,T,I)=>{b?p(b):T&&p(null,{vectorTile:c?void 0:new br(new T2(T)),rawData:T,responseHeaders:new Map(I.entries())})});return()=>{_.cancel(),p()}},a)},i.aM=function(u){return u?{cacheControl:u.get("Cache-Control"),expires:u.get("Expires")}:{cacheControl:void 0,expires:void 0}},i.aN=function(u){Dv++,Dv>Ns&&(u.getActor().send("enforceCacheSizeLimit",pg),Dv=0)},i.aO=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log2(u)))},i.aP=co,i.aQ=VV,i.aR=ZV,i.aS=Q,i.aT=UV,i.aU=function(u,a){const c=document.createElement("video");c.muted=!0,c.onloadstart=function(){a(null,c)};for(let f=0;f<u.length;f++){const p=document.createElement("source");Zn(u[f])||(c.crossOrigin="Anonymous"),p.src=u[f],c.appendChild(p)}return{cancel:()=>{}}},i.aV=T1,i.aW=cy,i.aX=gt,i.aY=N1,i.aZ=Ie,i.a_=Ae,i.aa=qt,i.ab=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return fi(u.expression.evaluate(a))}interpolate(u,a,c){return{x:$r(u.x,a.x,c),y:$r(u.y,a.y,c),z:$r(u.z,a.z,c),azimuthal:$r(u.azimuthal,a.azimuthal,c),polar:$r(u.polar,a.polar,c)}}},i.ac=ki,i.ad=Vd,i.ae=ot,i.af=nr,i.ag=Se,i.ah=Ne,i.ai=Zh,i.aj=Rp,i.ak=$r,i.al=Yt,i.am=Eg,i.an=xn,i.ao=ri,i.ap=class{constructor(u){this.specification=u}possiblyEvaluate(u,a){return function([c,f]){const p=fi([1,c,f]);return{x:p.x,y:p.y,z:p.z}}(u.expression.evaluate(a))}interpolate(u,a,c){return{x:$r(u.x,a.x,c),y:$r(u.y,a.y,c),z:$r(u.z,a.z,c)}}},i.aq=function(u,a,c=0,f=!0){const p=new Nt(c,c),_=u.sub(p),b=a.add(p),T=[_,new Nt(b.x,_.y),b,new Nt(_.x,b.y)];return f&&T.push(_.clone()),T},i.ar=function(u,a){const c=[];for(let f=0;f<u.length;f++){const p=Ye(f-1,-1,u.length-1),_=Ye(f+1,-1,u.length-1),b=u[f],T=u[_],I=u[p].sub(b).unit(),M=T.sub(b).unit(),$=M.angleWithSep(I.x,I.y),V=I.add(M).unit().mult(-1*a/Math.sin($/2));c.push(b.add(V))}return c},i.as=PV,i.at=ia,i.au=function(u,a,c=0){return Ce(((a.x-c)*u.scale-u.x)*Yt,(a.y*u.scale-u.y)*Yt,Be(a.z,a.y))},i.av=_t,i.aw=ze,i.ax=on,i.ay=$U,i.az=function(u){let a=1/0,c=1/0,f=-1/0,p=-1/0;for(const _ of u)a=Math.min(a,_.x),c=Math.min(c,_.y),f=Math.max(f,_.x),p=Math.max(p,_.y);return{min:new Nt(a,c),max:new Nt(f,p)}},i.b=function(u){return Fi.API_FONTS_REGEX.test(u)},i.b$=Lj,i.b0=Gi,i.b1=vt,i.b2=qA,i.b3=L2,i.b4=function(){Qs.isLoading()||Qs.isLoaded()||Fw()!=="deferred"||zw()},i.b5=w_,i.b6=mt,i.b7=ly,i.b8=Fa,i.b9=nN,i.bA=X,i.bB=N,i.bC=function(u,a){const{x:c,y:f}=u.point,p=o$(c,f,u.worldSize/u._pixelsPerMercatorPixel,0,0);return j(p,p,Ej(Xd(a)))},i.bD=S,i.bE=Br,i.bF=He,i.bG=Qe,i.bH=At,i.bI=ut,i.bJ=X_,i.bK=Ol,i.bL=dN,i.bM=function(u,a,c,f,p){const _=5*a+2;u.float32[_+0]=c,u.float32[_+1]=f,u.float32[_+2]=p},i.bN=ex,i.bO=_s,i.bP=ts,i.bQ=js,i.bR=On,i.bS=Ye,i.bT=function(u,a,c,f){var p=new x(4);return p[0]=u,p[1]=a,p[2]=c,p[3]=f,p},i.bU=class{isDataAvailableAtPoint(u){const a=this._source();if(this.isUsingMockSource()||!a||u.y<0||u.y>1)return!1;const c=a.getSource().maxzoom,f=1<<c,p=Math.floor(u.x),_=Math.floor((u.x-p)*f),b=Math.floor(u.y*f),T=this.findDEMTileFor(new co(c,p,c,_,b));return!(!T||!T.dem)}getAtPointOrZero(u,a=0){return this.getAtPoint(u,a)||0}getAtPoint(u,a,c=!0){if(this.isUsingMockSource())return null;a==null&&(a=null);const f=this._source();if(!f||u.y<0||u.y>1)return a;const p=f.getSource().maxzoom,_=1<<p,b=Math.floor(u.x),T=u.x-b,I=new co(p,b,p,Math.floor(T*_),Math.floor(u.y*_)),M=this.findDEMTileFor(I);if(!M||!M.dem)return a;const $=M.dem,V=1<<M.tileID.canonical.z,q=(T*V-M.tileID.canonical.x)*$.dim,Y=(u.y*V-M.tileID.canonical.y)*$.dim,J=Math.floor(q),ae=Math.floor(Y);return(c?this.exaggeration():1)*$r($r($.get(J,ae),$.get(J,ae+1),Y-ae),$r($.get(J+1,ae),$.get(J+1,ae+1),Y-ae),q-J)}static getAtTileOffset(u,a,c,f){const p=1<<u.canonical.z;return f?f.pointElevation(a):c?c.getAtPointOrZero(new ot(u.wrap+(u.canonical.x+a.x/Yt)/p,(u.canonical.y+a.y/Yt)/p)):0}static getAtTileOffsetFunc(u,a,c,f){return(p,_,b)=>{const T=this.getAtTileOffset(u,p,_,b),I=f.upVector(u.canonical,p.x,p.y);return ke(I,I,T*f.upVectorScale(u.canonical,a,c).metersToTile),I}}getForTilePoints(u,a,c,f){if(this.isUsingMockSource())return!1;const p=tx.create(this,u,f);return!!p&&(a.forEach(_=>{_[2]=this.exaggeration()*p.getElevationAt(_[0],_[1],c)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const a=this.findDEMTileFor(u);if(!a||!a.dem)return null;const c=a.dem.tree,f=a.tileID,p=1<<u.canonical.z-f.canonical.z;let _=u.canonical.x/p-f.canonical.x,b=u.canonical.y/p-f.canonical.y,T=0;for(let I=0;I<u.canonical.z-f.canonical.z&&!c.leaves[T];I++){_*=2,b*=2;const M=2*Math.floor(b)+Math.floor(_);T=c.childOffsets[T]+M,_%=1,b%=1}return{min:this.exaggeration()*c.minimums[T],max:this.exaggeration()*c.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,a,c){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let a=!1,c=Number.MAX_VALUE,f=Number.MIN_VALUE;for(const p of u){const _=this.getMinMaxForTile(p.tileID);_&&(c=Math.min(c,_.min),f=Math.max(f,_.max),a=!0)}return a?{min:c,max:f}:null}},i.bV=p2,i.bW=xa,i.bX=Eo,i.bY=L$,i.bZ=XV,i.b_=$$,i.ba=Nj,i.bb=It,i.bc=Ds,i.bd=I_,i.be=e$,i.bf=ea,i.bg=B_,i.bh=SN,i.bi=function(u,a){const c=Rp(a.zoom);if(c===0)return Xd(u);const f=n2(u),p=Sj(f),_=xe(f.getWest())*a.worldSize,b=xe(f.getEast())*a.worldSize,T=me(f.getNorth())*a.worldSize,I=me(f.getSouth())*a.worldSize,M=[_,T,0],$=[b,T,0],V=[_,I,0],q=[b,I,0],Y=L([],a.globeMatrix);return nr(M,M,Y),nr($,$,Y),nr(V,V,Y),nr(q,q,Y),p[0]=tf(p[0],V,c),p[1]=tf(p[1],q,c),p[2]=tf(p[2],$,c),p[3]=tf(p[3],M,c),mn.fromPoints(p)},i.bj=a2,i.bk=L,i.bl=c1,i.bm=tf,i.bn=Yh,i.bo=Fce,i.bp=te,i.bq=F,i.br=Z2,i.bs=T2,i.bt=Zf,i.bu=function(u,a){const c=[];for(const f in u)f in a||c.push(f);return c},i.bv=Ze,i.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bx=Uo,i.by=k,i.bz=R,i.c=is,i.c$=function(u){return u*u*u*u*u},i.c0=cN,i.c1=bV,i.c2=gN,i.c3=LN,i.c4=ke,i.c5=Ke,i.c6=Pr,i.c7=function(u,a,c){c*=.5;var f=a[0],p=a[1],_=a[2],b=a[3],T=Math.sin(c),I=Math.cos(c);return u[0]=f*I+p*T,u[1]=p*I-f*T,u[2]=_*I+b*T,u[3]=b*I-_*T,u},i.c8=sn,i.c9=_a,i.cA=Xn,i.cB=TU,i.cC=Al,i.cD=n$,i.cE=function(u,a,c,f,p,_,b,T,I){if(I.name==="globe")return n$(u,a,new Al(c,f,p),!1);const M=N1({z:c,x:f,y:p},I);return new mn([(_+M.x/M.scale)*a,a*(M.y/M.scale),b],[(_+M.x2/M.scale)*a,a*(M.y2/M.scale),T])},i.cF=function(u,a,c){return u[0]=Math.min(a[0],c[0]),u[1]=Math.min(a[1],c[1]),u[2]=Math.min(a[2],c[2]),u[3]=Math.min(a[3],c[3]),u},i.cG=function(u,a,c){return u[0]=Math.max(a[0],c[0]),u[1]=Math.max(a[1],c[1]),u[2]=Math.max(a[2],c[2]),u[3]=Math.max(a[3],c[3]),u},i.cH=function(u){const a=Math.round((u+45+360)%360/90)%4;return Gb[a]},i.cI=Re,i.cJ=dt,i.cK=s,i.cL=function(u){const a=R(new Float64Array(16));j(a,u.pixelMatrix,u.globeMatrix);const c=[0,P,0],f=[0,O,0];return nr(c,c,a),nr(f,f,a),[c[0]>0&&c[0]<=u.width&&c[1]>0&&c[1]<=u.height&&!Aj(u,new Q(u.center.lat,90)),f[0]>0&&f[0]<=u.width&&f[1]>0&&f[1]<=u.height&&!Aj(u,new Q(u.center.lat,-90))]},i.cM=function(u,a){const{scale:c}=u.tileTransform,f=c*Yt/(u.tileSize*Math.pow(2,a.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return function(p,_,b){var T=_[1],I=_[2],M=_[3],$=b[0],V=b[1];return p[0]=_[0]*$,p[1]=T*$,p[2]=I*V,p[3]=M*V,p}(new Float32Array(4),a.inverseAdjustmentMatrix,[f,f])},i.cN=_2,i.cO=ee,i.cP=EU,i.cQ=function(u){const a=EU(u,!0);return S([],[a[0],a[1],a[4],a[5]])},i.cR=B,i.cS=oi,i.cT=U,i.cU=function(u){const{x:a,y:c}=u.point,{lng:f,lat:p}=u._center;return o$(a,c,u.worldSize,f,p)},i.cV=Pe,i.cW=ns,i.cX=Pl,i.cY=ba,i.cZ=y,i.c_=function(u,a,c){let f=0;for(let p=0;p<2;++p)u[p]>0&&(f+=(u[p]-0)*(u[p]-0)),a[p]<0&&(f+=(0-a[p])*(0-a[p]));return f},i.ca=function(u,a){return u[0]=-a[0],u[1]=-a[1],u[2]=-a[2],u[3]=a[3],u},i.cb=ne,i.cc=function(u,a,c,f,p){var _=1/Math.tan(a/2);if(u[0]=_/c,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=_,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,p!=null&&p!==1/0){var b=1/(f-p);u[10]=(p+f)*b,u[14]=2*p*f*b}else u[10]=-1,u[14]=-2*f;return u},i.cd=function(u,a,c,f,p,_,b){var T=1/(a-c),I=1/(f-p),M=1/(_-b);return u[0]=-2*T,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*I,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*M,u[11]=0,u[12]=(a+c)*T,u[13]=(p+f)*I,u[14]=(b+_)*M,u[15]=1,u},i.ce=Ee,i.cf=function(u,a,c){u[4*a+0]=c[0],u[4*a+1]=c[1],u[4*a+2]=c[2],u[4*a+3]=c[3]},i.cg=D_,i.ch=Cp,i.ci=Ia,i.cj=su,i.ck=Qg,i.cl=RV,i.cm=function(){var u=new x(4);return x!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u},i.cn=function(u,a,c){var f=a[0],p=a[1],_=a[2],b=a[3],T=Math.sin(c),I=Math.cos(c);return u[0]=f*I+_*T,u[1]=p*I+b*T,u[2]=f*-T+_*I,u[3]=p*-T+b*I,u},i.co=function(u,a){return u[0]===a[0]&&u[1]===a[1]&&u[2]===a[2]&&u[3]===a[3]},i.cp=Yr,i.cq=function(u){var a=u[0],c=u[1],f=u[2],p=u[3];return Math.sqrt(a*a+c*c+f*f+p*p)},i.cr=Rs,i.cs=dr,i.ct=lu,i.cu=3,i.cv=2,i.cw=7,i.cx=6,i.cy=xt,i.cz=ie,i.d=function(u){return Fi.API_TILEJSON_REGEX.test(u)},i.d$=c$,i.d0=ue,i.d1=45,i.d2=Jg,i.d3=function(u,a,c){const f=Math.sqrt(u*u+a*a+c*c),p=f>0?Math.acos(c/f)*rs:0;let _=u!==0||a!==0?Math.atan2(-a,-u)*rs+90:0;return _<0&&(_+=360),[f,_,p]},i.d4=Ce,i.d5=fi,i.d6=qe,i.d7=_e,i.d8=mn,i.d9=be,i.dA=a1,i.dB=class extends oc{constructor(u){super(u),this.current=yj}set(u,a,c){if(this.fetchUniformLocation(u,a)){for(let f=0;f<9;f++)if(c[f]!==this.current[f]){this.current=c,this.gl.uniformMatrix3fv(this.location,!1,c);break}}}},i.dC=dg,i.dD=function(u,a,c){const f=Rp(c.zoom),p=u.style.map._antialias,_=u.terrain&&u.terrain.exaggeration()>0;return f===0&&!p&&!_},i.dE=function(u){const a=u.pixelsPerMeter,c=a/Ee(1,u.center.lat),f=R(new Float64Array(16));return F(f,f,[u.point.x,u.point.y,0]),B(f,f,[c,c,a]),Float32Array.from(f)},i.dF=n2,i.dG=function(u){const a=Re-5;u=ve(u,-a,a)/a*90;const c=Math.pow(Math.abs(Math.sin(xn(u))),3);return Math.round(c*(w.length-1))},i.dH=function(u,a,c,f){const p=a.getNorth(),_=a.getSouth(),b=a.getWest(),T=a.getEast(),I=1<<u.z,M=T-b,$=p-_,V=M/v,q=-$/w[c],Y=[0,V,0,q,0,0,p,b,0];if(u.z>0){const J=180/f;C(Y,Y,[J/M+1,0,0,0,J/$+1,0,-.5*J/V,.5*J/q,1])}return Y[2]=I,Y[5]=u.x,Y[8]=u.y,Y},i.dI=Xd,i.dJ=function(u,a,c){const f=R(new Float64Array(16)),p=(a/(1<<u)-.5)*Math.PI*2;return Z(f,c.globeMatrix,p),Float32Array.from(f)},i.dK=_$,i.dL=r2,i.dM=function(u,a){return[Math.pow(u[0],2.2)*a,Math.pow(u[1],2.2)*a,Math.pow(u[2],2.2)*a]},i.dN=E,i.dO=function(u,a){var c=Math.sin(a),f=Math.cos(a);return u[0]=f,u[1]=c,u[2]=0,u[3]=-c,u[4]=f,u[5]=0,u[6]=0,u[7]=0,u[8]=1,u},i.dP=Vt,i.dQ=a$,i.dR=Li,i.dS=na,i.dT=256,i.dU=function(u,a){const c=[0,0,0];return nr(c,c,a2(Xd(a.canonical))),nr(c,c,u),c},i.dV=u=>({u_matrix:new Qg(u),u_texsize:new su(u),u_pixels_to_tile_units:new o1(u),u_device_pixel_ratio:new Ia(u),u_width_scale:new Ia(u),u_floor_width_scale:new Ia(u),u_image:new D_(u),u_units_to_pixels:new su(u),u_tile_units_to_pixels:new Ia(u),u_alpha_discard_threshold:new Ia(u),u_trim_offset:new su(u),u_trim_fade_range:new su(u),u_trim_color:new Jg(u),u_emissive_strength:new Ia(u),u_zbias_factor:new Ia(u),u_tile_to_meter:new Ia(u),u_ground_shadow_factor:new Cp(u),u_pattern_transition:new Ia(u)}),i.dW=u=>({u_matrix:new Qg(u),u_pixels_to_tile_units:new o1(u),u_device_pixel_ratio:new Ia(u),u_width_scale:new Ia(u),u_floor_width_scale:new Ia(u),u_units_to_pixels:new su(u),u_dash_image:new D_(u),u_gradient_image:new D_(u),u_image_height:new Ia(u),u_texsize:new su(u),u_tile_units_to_pixels:new Ia(u),u_alpha_discard_threshold:new Ia(u),u_trim_offset:new su(u),u_trim_fade_range:new su(u),u_trim_color:new Jg(u),u_emissive_strength:new Ia(u),u_zbias_factor:new Ia(u),u_tile_to_meter:new Ia(u),u_ground_shadow_factor:new Cp(u)}),i.dX=u=>({u_camera_to_center_distance:new Ia(u),u_extrude_scale:new o1(u),u_device_pixel_ratio:new Ia(u),u_matrix:new Qg(u),u_inv_rot_matrix:new Qg(u),u_merc_center:new su(u),u_tile_id:new Cp(u),u_zoom_transition:new Ia(u),u_up_dir:new Cp(u),u_emissive_strength:new Ia(u)}),i.dY=Ep,i.dZ=Tde,i.d_=class{constructor(u,a,c,f){this.context=u,this.format=f,this.size=c,this.texture=u.gl.createTexture();const[p,_,b]=this.size,{gl:T}=u;T.bindTexture(T.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in a&&a.data&&T.texImage3D(T.TEXTURE_3D,0,this.format,p,_,b,0,Hj(this.format),Kj(this.format),a.data)}bind(u,a){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_3D,this.texture),u!==this.minFilter&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MAG_FILTER,u),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_MIN_FILTER,u),this.minFilter=u),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_3D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},i.da=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},i.db=SU,i.dc=tN,i.dd=CU,i.de=TN,i.df=function(u,a){return u.readFields(whe,{icons:[]},a)},i.dg=m2,i.dh=Y_,i.di=fN,i.dj=Zb,i.dk=MA,i.dl=hg,i.dm=bg,i.dn=Tr,i.dp=function(u){const a=u.indexOf(Gg);return a>=0?u.slice(0,a):u},i.dq=function(u){return u.indexOf(Gg)>=0},i.dr=function(u){const a=u.lastIndexOf(Gg);return a>=0?u.slice(a+1):""},i.ds=function(u){const a=[],c=u.id;return c===void 0&&a.push({message:`layers.${c}: missing required property "id"`}),u.render===void 0&&a.push({message:`layers.${c}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&a.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),a},i.dt=function(u,a,c,f){return u.type==="custom"?new mhe(u,a):new xhe[u.type](u,a,c,f)},i.du=zt,i.dv=function(u){const a=u.indexOf(Gg);return a>=0?u.slice(a+1):""},i.dw=class extends ly{constructor(u,a){super(u._vectorTileFeature,u._z,u._x,u._y,u.id),u.state&&(this.state=Object.assign({},u.state)),this.target=a.target,this.namespace=a.namespace,a.properties&&(this.properties=a.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=u.source,this.sourceLayer=u.sourceLayer,this.layer=u.layer)}toJSON(){const u=super.toJSON();return u.target=this.target,u.namespace=this.namespace,u}},i.dx=Lw,i.dy=mg,i.dz=function(u){return u({pluginStatus:ws,pluginURL:Gd}),Lw.on("pluginStateChange",u),u},i.e=Fi,i.e$=function([u,a,c]){const f=Math.hypot(u,a,c),p=Math.atan2(u,c),_=.5*Math.PI-Math.acos(-a/f);return new Q(ns(p),ns(_))},i.e0=(u,a,c,f,p,_)=>{const b=u.transform,T=b.projection.name==="globe";let I;if(_.paint.get("circle-pitch-alignment")==="map")if(T){const $=a$(b.zoom,a.canonical)*b._pixelsPerMercatorPixel;I=Float32Array.from([$,0,0,$])}else I=b.calculatePixelsToTileUnitsMatrix(c);else I=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const M={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(b.projection),u_matrix:u.translatePosMatrix(a.projMatrix,c,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xs.devicePixelRatio,u_extrude_scale:I,u_inv_rot_matrix:Vce,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(T){M.u_inv_rot_matrix=f,M.u_merc_center=p,M.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],M.u_zoom_transition=Rp(b.zoom);const $=p[0]*Yt,V=p[1]*Yt;M.u_up_dir=b.projection.upVector(new Al(0,0,0),$,V)}return M},i.e1=WU,i.e2=Ms,i.e3=(u,a,c,f,p,_,b,T,I,M)=>{const $=u.transform,V=$.pitch<15?UU(.07,.7,ve((14-$.zoom)/5,0,1)):.07,q=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:qU(u,a,c,f),u_texsize:a.imageAtlasTexture?a.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:$.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:b,u_image:0,u_tile_units_to_pixels:VU(a,$),u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(q?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:qe(a.tileID.canonical,0),u_ground_shadow_factor:I,u_pattern_transition:M}},i.e4=(u,a,c,f,p,_,b,T,I,M)=>{const $=u.transform,V=$.calculatePixelsToTileUnitsMatrix(a),q=c.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Y=$.pitch<15?UU(.07,.7,ve((14-$.zoom)/5,0,1)):.07;return{u_matrix:qU(u,a,c,f),u_pixels_to_tile_units:V,u_device_pixel_ratio:_,u_width_scale:b,u_floor_width_scale:T,u_units_to_pixels:[1/$.pixelsToGLUnits[0],1/$.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:GU(c)&&a.lineAtlasTexture?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:VU(a,u.transform),u_alpha_discard_threshold:0,u_trim_offset:I,u_trim_fade_range:c.paint.get("line-trim-fade-range"),u_trim_color:c.paint.get("line-trim-color").toPremultipliedRenderColor(q?null:c.lut).toArray01(),u_emissive_strength:c.paint.get("line-emissive-strength"),u_zbias_factor:Y,u_tile_to_meter:qe(a.tileID.canonical,0),u_ground_shadow_factor:M}},i.e5=it,i.e6=u1,i.e7=Be,i.e8=ef,i.e9=f2,i.eA=CN,i.eB=w2,i.eC=b2,i.eD=[1,1,1],i.eE=tx,i.eF=at,i.eG=function(u,a,c,f){var p=a[0],_=a[1],b=a[2],T=a[3];return u[0]=p+f*(c[0]-p),u[1]=_+f*(c[1]-_),u[2]=b+f*(c[2]-b),u[3]=T+f*(c[3]-T),u},i.eH=G_,i.eI=ac,i.eJ=Zd,i.eK=function(u,a,c,f,p,_,b,T,I,M,$,V,q,Y,J,ae){var ce=new x(16);return ce[0]=u,ce[1]=a,ce[2]=c,ce[3]=f,ce[4]=p,ce[5]=_,ce[6]=b,ce[7]=T,ce[8]=I,ce[9]=M,ce[10]=$,ce[11]=V,ce[12]=q,ce[13]=Y,ce[14]=J,ce[15]=ae,ce},i.eL=W,i.eM=Jw,i.eN=Kg,i.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Nt(1/0,1/0),max:new Nt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,a=!1){const c=z$(new Nt(0,0),new Nt(Yt,Yt),u),f=[];if(a&&!Mj(c,this._globalClipBounds))return f;for(const p of this._activeRegions){if(p.hiddenByOverlap||!Mj(c,p))continue;const _=vue(p.min,p.max,u);f.push({min:_.min,max:_.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return f}setSources(u){this._setSources(u.map(a=>({getSourceId:()=>a.cache.id,getFootprints:()=>{const c=[];for(const f of a.cache.getVisibleCoordinates()){const p=a.cache.getTile(f).buckets[a.layer];p&&p.updateFootprints(f.toUnwrapped(),c)}return c},getOrder:()=>a.order,getClipMask:()=>a.clipMask,getClipScope:()=>a.clipScope})))}_addSource(u){const a=u.getFootprints();if(a.length===0)return;const c=u.getOrder(),f=u.getClipMask(),p=u.getClipScope();for(const _ of a){if(!_.footprint)continue;const b=z$(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:b.min,max:b.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:c,clipMask:f,clipScope:p})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((a,c)=>a.priority-c.priority||u2(a.min,c.min)||u2(a.max,c.max)||a.order-c.order||a.clipMask-c.clipMask||function(f,p){const _=(b,T)=>b+T;return f.length-p.length||f.reduce(_,"").localeCompare(p.reduce(_,""))}(a.clipScope,c.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let a=0;for(;!u&&a!==this._activeRegions.length;){const c=this._activeRegions[a],f=this._prevRegions[a];u=c.priority!==f.priority||!F$(c,f)||c.order!==f.order||c.clipMask!==f.clipMask||!Uo(c.clipScope,f.clipScope),this._activeRegions[a].hiddenByOverlap=f.hiddenByOverlap,++a}}if(u){++this._updateTime;for(const c of this._activeRegions)c.order!==g1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,c.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,c.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,c.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,c.max.y));const a=c=>{const f=this._activeRegions;if(c>=f.length)return c;const p=f[c].priority;for(;c<f.length&&f[c].priority===p;)++c;return c};if(this._sourceIds.length>1){let c=0,f=a(c);for(;c!==f;){let p=c;const _=c;for(;p!==f;){const b=this._activeRegions[p];b.hiddenByOverlap=!1;for(let T=0;T<_;T++){const I=this._activeRegions[T];if(!I.hiddenByOverlap&&b.order===g1&&Mj(b,I)&&(b.hiddenByOverlap=B$(b.footprint,b.tileId,I.footprint,I.tileId),b.hiddenByOverlap))break}++p}c=f,f=a(c)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let a=u.length-1;a>=0;a--)this._addSource(u[a]);this._computeReplacement()}},i.eP=g1,i.eQ=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,a){const c=new Ds,f=new Gi,p=[],_=u+1+2,b=a[0]+1,T=a[0]+1+(1+a.length),I=(M,$,V)=>{let q=M===_-1?M-2:M===0?M:M-1;return q+=V?24575:0,[q,$]};for(let M=0;M<_;++M)c.emplaceBack(...I(M,0,!0));for(let M=0;M<b;++M)for(let $=0;$<_;++$)c.emplaceBack(...I($,M,($===0||$===_-1)&&!0));for(let M=0;M<a.length;++M){const $=a[M];for(let V=0;V<_;++V)c.emplaceBack(...I(V,$,!0))}for(let M=0;M<a.length;++M){const $=f.length,V=a[M]+1+2,q=new Gi;for(let ae=0;ae<V-1;ae++){const ce=ae===V-2,de=ce?_*(T-a.length+M-ae):_;for(let we=0;we<_-1;we++){const Te=ae*_+we;ae===0||ce||we===0||we===_-2?(q.emplaceBack(Te+1,Te,Te+de),q.emplaceBack(Te+de,Te+de+1,Te+1)):(f.emplaceBack(Te+1,Te,Te+de),f.emplaceBack(Te+de,Te+de+1,Te+1))}}const Y=ea.simpleSegment(0,$,c.length,f.length-$);for(let ae=0;ae<q.uint16.length;ae+=3)f.emplaceBack(q.uint16[ae],q.uint16[ae+1],q.uint16[ae+2]);const J=ea.simpleSegment(0,$,c.length,f.length-$);p.push({withoutSkirts:Y,withSkirts:J})}return{vertices:c,indices:f,segments:p}}_createGrid(u){const a=this._fillGridMeshWithLods(v,w);this._gridSegments=a.segments,this._gridBuffer=u.createVertexBuffer(a.vertices,e$.members),this._gridIndexBuffer=u.createIndexBuffer(a.indices,!0)}_createPoles(u){const a=new Gi;for(let b=0;b<=v;b++)a.emplaceBack(0,b+1,b+2);this._poleIndexBuffer=u.createIndexBuffer(a,!0);const c=new Qh,f=new Qh,p=new Qh,_=new Qh;this._poleSegments=[];for(let b=0,T=0;b<y;b++){const I=360/(1<<b);c.emplaceBack(0,-Ls,0,.5,0),f.emplaceBack(0,-Ls,0,.5,1),p.emplaceBack(0,-Ls,0,.5,.5),_.emplaceBack(0,-Ls,0,.5,.5);for(let M=0;M<=v;M++){let $=M/v,V=0;const q=$r(0,I,$),[Y,J,ae]=D($ce,Uce,q,Ls);c.emplaceBack(Y,J,ae,$,V),f.emplaceBack(Y,J,ae,$,1-V);const ce=xn(q);$=.5+.5*Math.sin(ce),V=.5+.5*Math.cos(ce),p.emplaceBack(Y,J,ae,$,V),_.emplaceBack(Y,J,ae,$,1-V)}this._poleSegments.push(ea.simpleSegment(T,0,66,64)),T+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(c,z_,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(f,z_,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(p,z_,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(_,z_,!1)}getGridBuffers(u,a){return[this._gridBuffer,this._gridIndexBuffer,a?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,a){return[a?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,a?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},i.eR=D$,i.eS=st,i.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.eU=pe,i.eV=Me,i.eW=function(u,a,c){return u[0]=a[0]/c[0],u[1]=a[1]/c[1],u[2]=a[2]/c[2],u},i.eX=Mt,i.eY=z,i.eZ=Xe,i.e_=fe,i.ea=tU,i.eb=Np,i.ec=W$,i.ed=q$,i.ee=Fe,i.ef=function(u,a){if(u===a){var c=a[1],f=a[2],p=a[3],_=a[6],b=a[7],T=a[11];u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=c,u[6]=a[9],u[7]=a[13],u[8]=f,u[9]=_,u[11]=a[14],u[12]=p,u[13]=b,u[14]=T}else u[0]=a[0],u[1]=a[4],u[2]=a[8],u[3]=a[12],u[4]=a[1],u[5]=a[5],u[6]=a[9],u[7]=a[13],u[8]=a[2],u[9]=a[6],u[10]=a[10],u[11]=a[14],u[12]=a[3],u[13]=a[7],u[14]=a[11],u[15]=a[15];return u},i.eg=phe,i.eh=En,i.ei=e1,i.ej=256,i.ek=Ej,i.el=wl,i.em=Z,i.en=function(u,a){return u[0]=a[0],u[1]=a[1],u[2]=a[2],u[3]=a[4],u[4]=a[5],u[5]=a[6],u[6]=a[8],u[7]=a[9],u[8]=a[10],u},i.eo=Qh,i.ep=Yw,i.eq=CA,i.er=function(u,a,c,f,p){return ve((u-a)/(c-a)*(p-f)+f,f,p)},i.es=fn,i.et=function(u,a){var c=a[0],f=a[1],p=a[2],_=a[3],b=a[4],T=a[5],I=a[6],M=a[7],$=a[8],V=$*b-T*M,q=-$*_+T*I,Y=M*_-b*I,J=c*V+f*q+p*Y;return J?(u[0]=V*(J=1/J),u[1]=(-$*f+p*M)*J,u[2]=(T*f-p*b)*J,u[3]=q*J,u[4]=($*c-p*I)*J,u[5]=(-T*c+p*_)*J,u[6]=Y*J,u[7]=(-M*c+f*I)*J,u[8]=(b*c-f*_)*J,u):null},i.eu=2,i.ev=ft,i.ew=er,i.ex=oe,i.ey=function(u,a){var c=new x(3);oe(c,a);var f=1/c[0],p=1/c[1],_=1/c[2],b=a[0]*f,T=a[1]*p,I=a[2]*_,M=a[4]*f,$=a[5]*p,V=a[6]*_,q=a[8]*f,Y=a[9]*p,J=a[10]*_,ae=b+$+J,ce=0;return ae>0?(ce=2*Math.sqrt(ae+1),u[3]=.25*ce,u[0]=(V-Y)/ce,u[1]=(q-I)/ce,u[2]=(T-M)/ce):b>$&&b>J?(ce=2*Math.sqrt(1+b-$-J),u[3]=(V-Y)/ce,u[0]=.25*ce,u[1]=(T+M)/ce,u[2]=(q+I)/ce):$>J?(ce=2*Math.sqrt(1+$-b-J),u[3]=(q-I)/ce,u[0]=(T+M)/ce,u[1]=.25*ce,u[2]=(V+Y)/ce):(ce=2*Math.sqrt(1+J-b-$),u[3]=(T-M)/ce,u[0]=(q+I)/ce,u[1]=(V+Y)/ce,u[2]=.25*ce),u},i.ez=function(u,a){var c=2*Math.acos(a[3]),f=Math.sin(c/2);return f>g?(u[0]=a[0]/f,u[1]=a[1]/f,u[2]=a[2]/f):(u[0]=1,u[1]=0,u[2]=0),c},i.f=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c))))},i.f0=tr,i.f1=Xj,i.f2=function(u){const a=u.navigator?u.navigator.userAgent:null;return!!function(c){if(Sa==null){const f=c.navigator?c.navigator.userAgent:null;Sa=!!c.safari||!(!f||!(/\b(iPad|iPhone|iPod)\b/.test(f)||f.match("Safari")&&!f.match("Chrome")))}return Sa}(u)&&!(!a||!(a.match("Version/15.4")||a.match("Version/15.5")||a.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},i.f3=function(u,a){pg=u,Ns=a},i.f4=Aj,i.f5=s$,i.f6=function(u){const a=[0,0,0],c=R(new Float64Array(16));return j(c,u.pixelMatrix,u.globeMatrix),nr(a,a,c),new Nt(a[0],a[1])},i.f7=function(){const u=w1;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(Uj),w1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.f8=function(){m2().acquire(Uj)},i.f9=Fw,i.fA=Lt,i.fB=function(u){let a=0;if(new Uint32Array(u,0,1)[0]!==vU){const c=new Uint32Array(u,0,7),[,,f,p,_,b]=c;a=c.byteLength+p+_+b+_,(f!==u.byteLength||a>=u.byteLength)&&kr("Invalid b3dm header information.")}return wU(u,a)},i.fC=function(u,a){const c=tN(u);for(const f of c){for(const p of f.meshes)Zue(p);f.lights&&(f.lightMeshIndex=f.meshes.length,f.meshes.push(Xue(f.lights,a)))}return c},i.fD=U2,i.fE=sa,i.fF=fU,i.fG=Qs,i.fH=Js,i.fI=function(u){Dh(),bs!=null&&bs.then(a=>{a.keys().then(c=>{for(let f=0;f<c.length-u;f++)a.delete(c[f]).catch(p=>kr(p.message))}).catch(c=>kr(c.message))}).catch(a=>kr(a.message))},i.fa=function(u,a,c=!1){if(ws===Js.deferred||ws===Js.loading||ws===Js.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gd=Xs.resolveURL(u),ws=Js.deferred,Mw=a,Dw(),c||zw()},i.fb=function(u){V_=Xs.resolveURL(u),q_||(q_=new U_(m2(),new Bu)),q_.broadcast("setMeshoptUrl",V_)},i.fc=gU,i.fd=function(u){qj=Xs.resolveURL(u),q_||(q_=new U_(m2(),new Bu)),q_.broadcast("setDracoUrl",qj)},i.fe=mU,i.ff=b1,i.fg=function(u){const a=zu();if(!a)return;const c=a.delete(fg);u&&c.then(()=>u()).catch(u)},i.fh=ny,i.fi=gr,i.fj=jp,i.fk=ed,i.fl=L6,i.fm=F6,i.fn=FU,i.fo=cr,i.fp="hd_road_elevation",i.fq=Hr,i.fr=Ht,i.fs=rf,i.ft=hN,i.fu=oy,i.fv=function(u,a,c,f,p,_,b,T=1,I,M,$){u.createArrays(),u.tilePixelRatio=Yt/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const V=u.layers[0].layout,q=u.layers[0]._unevaluatedLayout._values,Y={};Y.scaleFactor=T,Y.textSizeScaleRange=V.get("text-size-scale-range"),Y.iconSizeScaleRange=V.get("icon-size-scale-range");const[J,ae]=Y.textSizeScaleRange,[ce,de]=Y.iconSizeScaleRange;Y.textScaleFactor=ve(Y.scaleFactor,J,ae),Y.iconScaleFactor=ve(Y.scaleFactor,ce,de);const we=q["text-size"],Te=q["icon-size"];if(u.textSizeData.kind==="composite"){const{minZoom:tt,maxZoom:Et}=u.textSizeData;Y.compositeTextSizes=[we.possiblyEvaluate(new ki(tt,{worldview:$}),_),we.possiblyEvaluate(new ki(Et,{worldview:$}),_)]}if(u.iconSizeData.kind==="composite"){const{minZoom:tt,maxZoom:Et}=u.iconSizeData;Y.compositeIconSizes=[Te.possiblyEvaluate(new ki(tt,{worldview:$}),_),Te.possiblyEvaluate(new ki(Et,{worldview:$}),_)]}Y.layoutTextSize=we.possiblyEvaluate(new ki(b+1,{worldview:$}),_),Y.layoutIconSize=Te.possiblyEvaluate(new ki(b+1,{worldview:$}),_),Y.textMaxSize=we.possiblyEvaluate(new ki(18,{worldview:$}),_);const Oe=V.get("symbol-placement"),Ue=V.get("text-rotation-alignment")==="map"&&Oe!=="point",De=V.get("text-size");let Ge=!1;const Je=[];for(const tt of u.features){const Et=V.get("text-font").evaluate(tt,{},_).join(","),ct=De.evaluate(tt,{},_)*Y.textScaleFactor,Tt=Y.layoutTextSize.evaluate(tt,{},_)*Y.textScaleFactor,kt=Y.layoutIconSize.evaluate(tt,{},_)*Y.iconScaleFactor,Dt={horizontal:{},vertical:void 0},Zt=tt.text;let $t,Rt=[0,0];if(Zt){const yn=Zt.toString(),Fn=V.get("text-letter-spacing").evaluate(tt,{},_)*Eo,tn=V.get("text-line-height").evaluate(tt,{},_)*Eo,Wn=jA(yn)?Fn:0,Gn=V.get("text-anchor").evaluate(tt,{},_),Yi=V.get("text-variable-anchor");if(!Yi){const Ct=V.get("text-radial-offset").evaluate(tt,{},_);if(Ct)Rt=bV(Gn,[Ct*Eo,mN]);else{const ar=V.get("text-offset").evaluate(tt,{},_);Rt=[ar[0]*Eo,ar[1]*Eo]}}let Le=Ue?"center":V.get("text-justify").evaluate(tt,{},_);const je=Oe==="point",Pt=je?V.get("text-max-width").evaluate(tt,{},_)*Eo:1/0,rr=Ct=>{u.allowVerticalPlacement&&Rw(yn)&&(Dt.vertical=lN(Zt,a,c,p,Et,Pt,tn,Gn,Ct,Wn,Rt,Ol.vertical,!0,Tt,ct,I))};if(!Ue&&Yi){const Ct=Le==="auto"?Yi.map(Ar=>gN(Ar)):[Le];let ar=!1;for(let Ar=0;Ar<Ct.length;Ar++){const Er=Ct[Ar];if(!Dt.horizontal[Er])if(ar)Dt.horizontal[Er]=Dt.horizontal[0];else{const rn=lN(Zt,a,c,p,Et,Pt,tn,"center",Er,Wn,Rt,Ol.horizontal,!1,Tt,ct,I);rn&&(Dt.horizontal[Er]=rn,ar=rn.positionedLines.length===1)}}rr("left")}else{if(Le==="auto"&&(Le=gN(Gn)),je||V.get("text-writing-mode").indexOf("horizontal")>=0||!Rw(yn)){const Ct=lN(Zt,a,c,p,Et,Pt,tn,Gn,Le,Wn,Rt,Ol.horizontal,!1,Tt,ct,I);Ct&&(Dt.horizontal[Le]=Ct)}rr(je?"left":Le)}}let Bt,bt,yt,Ft,Gt,jt,pr=!1;const vr=V.get("icon-text-fit").evaluate(tt,{},_);if(tt.icon&&tt.icon.hasPrimary()){const yn=R1(tt.icon,u.iconSizeData,q["icon-size"],_,u.zoom,tt,I,Y.iconScaleFactor,$);Bt=yn.iconPrimary,yt=yn.iconSecondary;const Fn=Bt.toString();if(bt=f.get(Fn),bt&&(Gt=V.get("icon-offset").evaluate(tt,{},_),jt=V.get("icon-anchor").evaluate(tt,{},_),$t=P2(p.get(Fn),yt?p.get(yt.toString()):void 0,Gt,jt),pr=bt.sdf,u.sdfIcons===void 0?u.sdfIcons=bt.sdf:u.sdfIcons!==bt.sdf&&kr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(bt.pixelRatio!==u.pixelRatio||V.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0)),yt){const tn=yt.toString();Ft=f.get(tn)}}Ge=Ge||!(!tt.icon||!tt.icon.hasSecondary());const ur=yN(Dt.horizontal)||Dt.vertical;u.iconsInText||(u.iconsInText=!!ur&&ur.iconsInText);const ir=Tt*Y.textScaleFactor/Eo,{defaultShapedIcon:Kr,verticallyShapedIcon:or}=ehe(u,$t,V,tt,_,Dt,ir,Gt,vr);vr!=="none"&&$t&&(oV($t)||sV($t))&&(R2(0,bt,Bt,$t,Kr,vr,M,f,p),R2(0,Ft,yt,$t,Kr,vr,M,f,p),or&&(R2(0,bt,Bt,$t,or,vr,M,f,p),R2(0,Ft,yt,$t,or,vr,M,f,p))),$t=Kr;const{iconBBox:Or,iconVerticalBBox:Jr}=Yde(u,$t,or,V,tt,_,kt,Gt,Y,p,jt);Je.push({feature:tt,shapedTextOrientations:Dt,shapedText:ur,shapedIcon:$t,iconPrimary:Bt,iconSecondary:yt,iconOffset:Gt,iconAnchor:jt,verticallyShapedIcon:or,layoutTextSize:Tt,layoutIconSize:kt,textOffset:Rt,isSDFIcon:pr,iconTextFit:vr,iconCollisionBounds:Or,iconVerticalCollisionBounds:Jr})}return{featureData:Je,sizes:Y,hasAnySecondaryIcon:Ge,textAlongLine:Ue,symbolPlacement:Oe}},i.fw=mV,i.fx=function(u,a,c,f,p,_,b,T,I,M){u.iconAtlasPositions=M.iconPositions;const{featureData:$,hasAnySecondaryIcon:V,sizes:q,textAlongLine:Y,symbolPlacement:J}=a;for(const ae of $){const{shapedIcon:ce,verticallyShapedIcon:de,feature:we,shapedTextOrientations:Te,shapedText:Oe,layoutTextSize:Ue,textOffset:De,isSDFIcon:Ge,iconPrimary:Je,iconSecondary:tt,iconTextFit:Et,iconOffset:ct,iconCollisionBounds:Tt,iconVerticalCollisionBounds:kt}=ae;SV(ce,M.iconPositions,Je,tt),SV(de,M.iconPositions,Je,tt),Qde(Te,M.iconPositions),Jde(Je,tt,M.iconPositions),(Oe||ce)&&the(u,we,Te,ce,de,I,q,Ue,0,De,Ge,f,p,b,T,V,Et,ct,Y,J,Tt,kt)}c&&u.generateCollisionDebugBuffers(_,u.collisionBoxArray,q.textScaleFactor)},i.fy=br,i.fz=K2,i.g=function(u,a){return mg(Object.assign(u,{method:"GET"}),a)},i.h=function(u){return u.indexOf("mapbox:")===0},i.i=function(u){return Fi.API_STYLE_REGEX.test(u)&&!is(u)},i.j=Ja,i.k=Lv,i.l=function(u){return decodeURIComponent(atob(u).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.m=function(u,a){return mg(Object.assign(u,{type:"json"}),a)},i.n=Yb,i.o=Xs,i.p=function(u,a){return mg(Object.assign(u,{method:"POST"}),a)},i.q=Wo,i.r=Zs,i.s=function(u){try{const a=self[u];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=function(){return Vj||(Vj=new ny),Vj},i.u=function(){return function u(a){return a?(a^Math.random()*(16>>a/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},i.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},i.w=kr,i.x=jN,i.y=wg,i.z=vl}),l(["./shared"],function(i){function g(st){const pe=st?st.url.toString():void 0;return pe?performance.getEntriesByName(pe):[]}function x(st){if(typeof st=="number"||typeof st=="boolean"||typeof st=="string"||st==null)return JSON.stringify(st);if(Array.isArray(st)){let ve="[";for(const Ne of st)ve+=`${x(Ne)},`;return`${ve}]`}let pe="{";for(const ve of Object.keys(st).sort())pe+=`${ve}:${x(st[ve])},`;return`${pe}}`}function S(st){let pe="";for(const ve of i.bw)pe+=`/${x(st[ve])}`;return pe}class E{constructor(pe){this.keyCache={},this._layers={},this._layerConfigs={},pe&&this.replace(pe)}replace(pe,ve){this._layerConfigs={},this._layers={},this.update(pe,[],ve)}update(pe,ve,Ne){this._options=Ne;for(const Ze of pe)this._layerConfigs[Ze.id]=Ze,(this._layers[Ze.id]=i.dt(Ze,this.scope,null,this._options)).compileFilter(Ne),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id];for(const Ze of ve)delete this.keyCache[Ze],delete this._layerConfigs[Ze],delete this._layers[Ze];this.familiesBySource={};const Ye=function(Ze,nt){const vt={};for(let gt=0;gt<Ze.length;gt++){const Ht=Ze[gt];let zt=nt&&nt[Ht.id];zt||(Ht.type==="symbol"?zt=Ht.id:(zt=S(Ht),Ht.type==="line"&&Ht.paint&&function Gr(Ur){return typeof Ur=="string"&&Ur==="line-progress"||(Array.isArray(Ur)?Ur.some(Gr):!(!Ur||typeof Ur!="object")&&Object.values(Ur).some(Gr))}(Ht.paint["line-width"])&&(zt+=`/${x(Ht.paint["line-width"])}`))),nt&&(nt[Ht.id]=zt);let Tr=vt[zt];Tr||(Tr=vt[zt]=[]),Tr.push(Ht)}const it=[];for(const gt in vt)it.push(vt[gt]);return it}(Object.values(this._layerConfigs),this.keyCache);for(const Ze of Ye){const nt=Ze.map(Tr=>this._layers[Tr.id]),vt=nt[0];if(vt.visibility==="none")continue;const it=vt.source||"";let gt=this.familiesBySource[it];gt||(gt=this.familiesBySource[it]={});const Ht=vt.sourceLayer||"_geojsonTileLayer";let zt=gt[Ht];zt||(zt=gt[Ht]=[]),zt.push(nt)}}}const A=1*i.fk;class C{constructor(pe){const ve={},Ne=[];for(const vt in pe){const it=pe[vt],gt=ve[vt]={};for(const Ht in it.glyphs){const zt=it.glyphs[+Ht];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Tr=zt.metrics.localGlyph?A:1,Gr={x:0,y:0,w:zt.bitmap.width+2*Tr,h:zt.bitmap.height+2*Tr};Ne.push(Gr),gt[Ht]=Gr}}const{w:Ye,h:Ze}=i.G(Ne),nt=new i.fj({width:Ye||1,height:Ze||1});for(const vt in pe){const it=pe[vt];for(const gt in it.glyphs){const Ht=it.glyphs[+gt];if(!Ht||Ht.bitmap.width===0||Ht.bitmap.height===0)continue;const zt=ve[vt][gt],Tr=Ht.metrics.localGlyph?A:1;i.fj.copy(Ht.bitmap,nt,{x:0,y:0},{x:zt.x+Tr,y:zt.y+Tr},Ht.bitmap)}}this.image=nt,this.positions=ve}}function N(st,pe,ve){st[pe]?ve&&(st[pe].center=ve):st[pe]={floorIds:new Set,center:ve||[0,0],floors:{}}}function k(st,pe,ve,Ne){for(const Ye of pe)N(st,Ye),st[Ye].floors[ve]=Ne,st[Ye].floorIds.add(ve)}function R(st){return{id:st.properties.id.toString(),center:st.properties.center.toString().split(";").map(Number)}}function L(st){return{id:st.properties.id.toString(),isDefault:!!st.properties.is_default&&st.properties.is_default,connections:st.properties.connected_floor_ids?new Set(st.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:st.properties.conflicted_floor_ids?new Set(st.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:st.properties.building_ids?new Set(st.properties.building_ids.toString().split(";")):new Set,name:st.properties.name.toString(),zIndex:st.properties.z_index}}function j(st,pe){return pe.every(ve=>st.properties&&st.properties[ve]!=null)}function F(st){return j(st,["type","id","name"])&&st.properties.type==="building"}function B(st){return j(st,["type","id","name","z_index"])&&st.properties.type==="floor"}i.fi(C,"GlyphAtlas");class U{constructor(pe){this.tileID=new i.aP(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),this.tileZoom=pe.tileZoom,this.uid=pe.uid,this.zoom=pe.zoom,this.lut=pe.lut,this.canonical=pe.tileID.canonical,this.pixelRatio=pe.pixelRatio,this.tileSize=pe.tileSize,this.source=pe.source,this.scope=pe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=pe.showCollisionBoxes,this.collectResourceTiming=!!pe.request&&pe.request.collectResourceTiming,this.promoteId=pe.promoteId,this.isSymbolTile=pe.isSymbolTile,this.tileTransform=i.aY(pe.tileID.canonical,pe.projection),this.projection=pe.projection,this.worldview=pe.worldview,this.localizableLayerIds=pe.localizableLayerIds,this.brightness=pe.brightness,this.extraShadowCaster=!!pe.extraShadowCaster,this.tessellationStep=pe.tessellationStep,this.scaleFactor=pe.scaleFactor,this.worldview=pe.worldview,this.indoor=pe.indoor}parse(pe,ve,Ne,Ye,Ze,nt){this.status="parsing",this.data=pe,this.collisionBoxArray=new i.b2;const vt=new i.fl(Object.keys(pe.layers).sort()),it=new i.fm(this.tileID,this.promoteId);it.bucketLayerIDs=[];const gt={},Ht=new i.fn(256,256),zt={featureIndex:it,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ht,availableImages:Ne,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const kr=this.indoor.indoorState.activeFloorsVisible,gn=function(Sn,fi,sa){const Fa=function(li,Rn){if(!li)return i.w("No source layers defined in indoor specification"),Rn;if(li.size===0)return Rn;const Li=li.difference(Rn);for(const na of Li)i.w(`Missing source layer required in indoor specification: ${na}`);return Rn.intersection(Rn)}(fi.sourceLayers,new Set(Object.keys(Sn.layers))),Sa=fi.indoorState,_a=function(li,Rn,Li,na){const gi=new Set,Fi=new Set,Ja=new Set,is=new Map,Xl={},Mh=so=>{const Yl=is.get(so)||new Set;for(const xs of gi)if((is.get(xs)||new Set).has(so)||Yl.has(xs))return!0;return!1};for(const so of Rn){const Yl=li.layers[so];if(Yl)for(let xs=0;xs<Yl.length;xs++){const Pc=Yl.feature(xs);if(F(Pc)){const{id:Zs,center:Xs}=R(Pc);N(Xl,Zs,Xs),gi.add(Zs)}else if(B(Pc)){const{id:Zs,isDefault:Xs,connections:Mv,conflicts:hg,buildings:fg,name:pg,zIndex:Ns}=L(Pc);k(Xl,fg,Zs,{name:pg,zIndex:Ns}),is.set(Zs,hg),(Zs===na||Mv.has(na))&&gi.add(Zs),Fi.add(Zs),Xs&&Ja.add(Zs)}}else i.w(`indoor source layer not found: ${so}`)}if(Li)for(const so of Li)Fi.has(so)&&(Mh(so)||gi.add(so));for(const so of Ja)gi.has(so)||Mh(so)||gi.add(so);return{buildings:Xl,activeFloors:gi}}(Sn,Fa,Sa.lastActiveFloors,Sa.selectedFloorId);return sa.send("setIndoorData",_a),_a}(pe,this.indoor,Ze);zt.activeFloors=kr?gn.activeFloors:void 0}const Tr=[],Gr=ve.familiesBySource[this.source];for(const kr in Gr){const gn=pe.layers[kr];if(!gn)continue;let Sn=!1,fi=!1,sa=!1;for(const li of Gr[kr])li[0].type==="symbol"?Sn=!0:fi=!0,li[0].is3D()&&li[0].type!=="model"&&(sa=!0);if(this.extraShadowCaster&&!sa||this.isSymbolTile===!0&&!Sn||this.isSymbolTile===!1&&!fi)continue;gn.version===1&&i.w(`Vector tile source "${this.source}" layer "${kr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fa=vt.encode(kr),Sa=[];let _a=!1;for(let li=0,Rn=0;li<gn.length;li++){const Li=gn.feature(li),na=it.getId(Li,kr);if(this.localizableLayerIds&&this.localizableLayerIds.has(kr)){const gi=Li.properties?Li.properties.worldview:null;if(this.worldview&&typeof gi=="string")if(gi==="all")Li.properties.$localized=!0;else{if(!gi.split(",").includes(this.worldview))continue;Li.properties.$localized=!0,Li.properties.worldview=this.worldview}}!_a&&Li.properties&&Li.properties.hasOwnProperty(i.fo)&&(_a=!0),Sa.push({feature:Li,id:na,index:Rn,sourceLayerIndex:Fa}),Rn++}_a&&!zt.elevationFeatures&&pe.layers.hasOwnProperty(i.fp)&&(zt.elevationFeatures=i.fq.parseFrom(pe.layers[i.fp],this.canonical));for(const li of Gr[kr]){const Rn=li[0];if(this.extraShadowCaster&&(!Rn.is3D()||Rn.type==="model")||this.isSymbolTile!==void 0&&Rn.type==="symbol"!==this.isSymbolTile||Rn.minzoom&&this.zoom<Math.floor(Rn.minzoom)||Rn.maxzoom&&this.zoom>=Rn.maxzoom||Rn.visibility==="none")continue;Z(li,this.zoom,zt.brightness,Ne,this.worldview);const Li=gt[Rn.id]=Rn.createBucket({index:it.bucketLayerIDs.length,layers:li,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fa,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ye,worldview:this.worldview});it.bucketLayerIDs.push(li.map(gi=>i.B(gi.id,gi.scope)));let na=Li.prepare?Li.prepare():null;na!=null?(na=na.then(()=>Li.populate(Sa,zt,this.tileID.canonical,this.tileTransform)),Tr.push(na)):Li.populate(Sa,zt,this.tileID.canonical,this.tileTransform)}}const Ur=()=>{let kr,gn,Sn,fi,sa,Fa;Ht.trim();const Sa={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},_a=()=>{if(kr)return this.status="done",nt(kr);if(this.extraShadowCaster)this.status="done",nt(null,{buckets:Object.values(gt).filter(Rn=>!Rn.isEmpty()),featureIndex:it,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:zt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(gn&&Sn&&fi){const Rn=new C(gn),Li=new Map;for(const[Fi,Ja]of Sn.entries()){const{imagePosition:is}=i.ft(Fi,Ja,i.fu);Li.set(Fi,is)}const na={};for(const Fi in gt){const Ja=gt[Fi];Ja instanceof i.b3&&(Z(Ja.layers,this.zoom,zt.brightness,Ne,this.worldview),na[Fi]=i.fv(Ja,gn,Rn.positions,Sn,Li,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,sa,this.worldview))}const gi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ze,Sn,sa,()=>{gi.iconsPending=!1,li(na,Rn,gi)}),this.rasterizeIfNeeded(Ze,fi,Fa,()=>{gi.patternsPending=!1,li(na,Rn,gi)})}},li=(Rn,Li,na,gi)=>{if(na.iconsPending||na.patternsPending)return;const Fi=new i.fw(Sn,fi,this.lut);for(const Ja in gt){const is=gt[Ja];if(Ja in Rn)i.fx(is,Rn[Ja],this.showCollisionBoxes,Ne,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Sn,Fi);else if(is.hasPattern&&(is instanceof i.b9||is instanceof i.ba||is instanceof i.e9)){Z(is.layers,this.zoom,zt.brightness,Ne,this.worldview);const Xl=Object.fromEntries(Fi.patternPositions);is.addFeatures(zt,this.tileID.canonical,Xl,Ne,this.tileTransform,this.brightness)}}this.status="done",nt(null,{buckets:Object.values(gt).filter(Ja=>!Ja.isEmpty()),featureIndex:it,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Li.image,lineAtlas:Ht,imageAtlas:Fi,brightness:zt.brightness})};if(!this.extraShadowCaster){const Rn=i.fr(zt.glyphDependencies,gi=>Object.keys(gi).map(Number));Object.keys(Rn).length?Ze.send("getGlyphs",{uid:this.uid,stacks:Rn},(gi,Fi)=>{kr||(kr=gi,gn=Fi,_a())},void 0,!1,Sa):gn={};const Li=Array.from(zt.iconDependencies.keys()).map(gi=>i.I.parse(gi));Li.length?Ze.send("getImages",{images:Li,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(gi,Fi)=>{kr||(kr=gi,Sn=new Map,sa=this.updateImageMapAndGetImageTaskQueue(Sn,Fi,zt.iconDependencies),_a())},void 0,!1,Sa):(Sn=new Map,sa=new Map);const na=Array.from(zt.patternDependencies.keys()).map(gi=>i.I.parse(gi));na.length?Ze.send("getImages",{images:na,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(gi,Fi)=>{kr||(kr=gi,fi=new Map,Fa=this.updateImageMapAndGetImageTaskQueue(fi,Fi,zt.patternDependencies),_a())},void 0,!1,Sa):(fi=new Map,Fa=new Map)}if(zt.elevationFeatures&&zt.elevationFeatures.length>0){const Rn=[];for(const na of Object.values(gt))if(na instanceof i.ba){const gi=na.getUnevaluatedPortalGraph();gi&&Rn.push(gi)}const Li=i.fs.evaluate(Rn);for(const na of Object.values(gt))if(na instanceof i.ba){const gi=pe.layers[vt.decode(na.sourceLayerIndex)];na.setEvaluatedPortalGraph(Li,gi,this.tileID.canonical,zt.availableImages,zt.brightness)}}_a()};Tr.length>0?Promise.allSettled(Tr).then(Ur).catch(nt):Ur()}updateParameters(pe){this.scaleFactor=pe.scaleFactor,this.showCollisionBoxes=pe.showCollisionBoxes,this.projection=pe.projection,this.brightness=pe.brightness,this.tileTransform=i.aY(pe.tileID.canonical,pe.projection),this.extraShadowCaster=pe.extraShadowCaster,this.lut=pe.lut,this.worldview=pe.worldview,this.indoor=pe.indoor}rasterizeIfNeeded(pe,ve,Ne,Ye){Array.from(ve.values()).some(Ze=>Ze.usvg)?this.rasterize(pe,ve,Ne,Ye):Ye()}updateImageMapAndGetImageTaskQueue(pe,ve,Ne){const Ye=new Map;for(const Ze of ve.keys()){const nt=Ne.get(Ze)||[];for(const vt of nt){const it=vt.toString(),gt=ve.get(vt.id.toString());gt.usvg?Ye.has(it)||(Ye.set(it,vt),pe.set(it,Object.assign({},gt))):pe.set(it,gt)}}return Ye}rasterize(pe,ve,Ne,Ye){this.rasterizeTask=pe.send("rasterizeImages",{scope:this.scope,tasks:Ne},(Ze,nt)=>{if(!Ze)for(const[vt,it]of nt.entries()){const gt=Object.assign(ve.get(vt),{data:it});ve.set(vt,gt)}Ye()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Z(st,pe,ve,Ne,Ye){const Ze=new i.ac(pe,{brightness:ve,worldview:Ye});for(const nt of st)nt.recalculate(Ze,Ne)}class X extends i.E{constructor(pe,ve,Ne,Ye,Ze,nt,vt){super(),this.actor=pe,this.layerIndex=ve,this.availableImages=Ne,this.availableModels=Ye,this.loadVectorData=nt||i.aL,this.loading={},this.loaded={},this.deduped=new i.aK(pe.scheduler),this.isSpriteLoaded=Ze,this.scheduler=pe.scheduler,this.brightness=vt}loadTile(pe,ve){const Ne=pe.uid,Ye=pe&&pe.request,Ze=Ye&&Ye.collectResourceTiming,nt=this.loading[Ne]=new U(pe);nt.abort=this.loadVectorData(pe,(vt,it)=>{const gt=!this.loading[Ne];if(delete this.loading[Ne],nt.cancelRasterize(),gt||vt||!it)return nt.status="done",gt||(this.loaded[Ne]=nt),ve(vt);const Ht=it.rawData,zt={},Tr=i.aM(it.responseHeaders);Tr&&Tr.expires&&(zt.expires=Tr.expires),Tr&&Tr.cacheControl&&(zt.cacheControl=Tr.cacheControl),nt.vectorTile=it.vectorTile||new i.fy(new i.bs(Ht));const Gr=()=>{nt.parse(nt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ur,kr)=>{if(Ur||!kr)return ve(Ur);const gn={};if(Ze){const Sn=g(Ye);Sn.length>0&&(gn.resourceTiming=JSON.parse(JSON.stringify(Sn)))}ve(null,Object.assign({rawTileData:Ht.slice(0),responseHeaders:it.responseHeaders},kr,zt,gn))})};this.isSpriteLoaded?Gr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Gr,{type:"parseTile",isSymbolTile:pe.isSymbolTile,zoom:pe.tileZoom}):Gr()}),this.loaded=this.loaded||{},this.loaded[Ne]=nt})}reloadTile(pe,ve){const Ne=this.loaded,Ye=pe.uid;if(Ne&&Ne[Ye]){const Ze=Ne[Ye];Ze.updateParameters(pe);const nt=(vt,it)=>{const gt=Ze.reloadCallback;gt&&(delete Ze.reloadCallback,Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,gt)),ve(vt,it)};Ze.status==="parsing"?Ze.reloadCallback=nt:Ze.status==="done"&&(Ze.vectorTile?Ze.parse(Ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,nt):nt())}else ve(null,void 0)}abortTile(pe,ve){const Ne=pe.uid,Ye=this.loading[Ne];Ye&&(Ye.abort&&Ye.abort(),delete this.loading[Ne]),ve()}removeTile(pe,ve){const Ne=this.loaded,Ye=pe.uid;Ne&&Ne[Ye]&&delete Ne[Ye],ve()}}class te{loadTile(pe,ve){const{uid:Ne,encoding:Ye,rawImageData:Ze,padding:nt}=pe,vt=ImageBitmap&&Ze instanceof ImageBitmap?this.getImageData(Ze,nt):Ze;ve(null,new i.fz(Ne,vt,Ye,nt<1))}reloadTile(pe,ve){ve(null,null)}abortTile(pe,ve){ve()}removeTile(pe,ve){ve()}getImageData(pe,ve){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(pe.width,pe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=pe.width,this.offscreenCanvas.height=pe.height,this.offscreenCanvasContext.drawImage(pe,0,0,pe.width,pe.height);const Ne=this.offscreenCanvasContext.getImageData(-ve,-ve,pe.width+2*ve,pe.height+2*ve);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ne}}i.br.setPbf(i.bs);class se{constructor(pe){this._mrt=new i.br(pe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=pe.uid,this.tileID=pe.tileID,this.source=pe.source}parse(pe,ve){const Ne=this._mrt;this.status="parsing",this._entireBuffer=pe;try{Ne.parseHeader(pe),this._isHeaderLoaded=!0;const Ye=[];for(const Ze in Ne.layers){const nt=Ne.getLayer(Ze),vt=nt.getDataRange(nt.getBandList()),it=Ne.createDecodingTask(vt),gt=pe.slice(vt.firstByte,vt.lastByte+1),Ht=i.br.performDecoding(gt,it).then(zt=>it.complete(null,zt)).catch(zt=>it.complete(zt,null));Ye.push(Ht)}Promise.allSettled(Ye).then(()=>ve(null,Ne)).catch(Ze=>ve(Ze))}catch(Ye){ve(Ye)}}}class oe{constructor(pe){this.actor=pe,this.loading={},this.loaded={}}loadTile(pe,ve){const Ne=pe.uid,Ye=pe.request,Ze=this.loading[Ne]=new se(pe),{cancel:nt}=i.bt(Ye,(vt,it,gt)=>{const Ht=!this.loading[Ne];if(delete this.loading[Ne],Ht||vt||!it)return Ze.status="done",Ht||(this.loaded[Ne]=Ze),ve(vt);Ze.parse(it,(zt,Tr)=>{if(zt||!Tr)return ve(zt);ve(null,Tr,gt)}),this.loaded[Ne]=Ze});Ze.abort=nt}reloadTile(pe,ve){ve(null,void 0)}abortTile(pe,ve){const Ne=pe.uid,Ye=this.loading[Ne];Ye&&(Ye.abort&&Ye.abort(),delete this.loading[Ne]),ve()}removeTile(pe,ve){const Ne=pe.uid;this.loaded[Ne]&&delete this.loaded[Ne],ve()}decodeRasterArray(pe,ve){i.br.performDecoding(pe.buffer,pe.task).then(Ne=>ve(null,Ne)).catch(Ne=>ve(Ne))}}const ne=i.fA.prototype.toGeoJSON;class ee{constructor(pe){this._feature=pe,this.extent=i.al,this.type=pe.type,this.properties=pe.tags,"id"in pe&&!isNaN(pe.id)&&(this.id=parseInt(pe.id,10))}loadGeometry(){if(this._feature.type===1){const pe=[];for(const ve of this._feature.geometry)pe.push([new i.P(ve[0],ve[1])]);return pe}{const pe=[];for(const ve of this._feature.geometry){const Ne=[];for(const Ye of ve)Ne.push(new i.P(Ye[0],Ye[1]));pe.push(Ne)}return pe}}toGeoJSON(pe,ve,Ne){return ne.call(this,pe,ve,Ne)}}class ie{constructor(pe,ve){this.name=pe,this.extent=i.al,this.length=ve.length,this._jsonFeatures=ve}feature(pe){return new ee(this._jsonFeatures[pe])}}class he{constructor(pe){this.layers={},this.extent=i.al;for(const ve of Object.keys(pe))this.layers[ve]=new ie(ve,pe[ve])}}const Se=64/4096,Ce=128;class fe{constructor(){this.features=new Map}clear(){this.features.clear()}load(pe=[],ve){for(const Ne of pe){const Ye=Ne.id;if(Ye==null)continue;let Ze=this.features.get(Ye);Ze&&this.updateCache(Ze,ve),Ne.geometry?(Ze=be(Ne),this.updateCache(Ze,ve),this.features.set(Ye,Ze)):this.features.delete(Ye),this.updateCache(Ze,ve)}}updateCache(pe,ve){for(const{canonical:Ne,uid:Ye}of Object.values(ve)){const{z:Ze,x:nt,y:vt}=Ne;_e(pe,Math.pow(2,Ze),nt,vt)&&delete ve[Ye]}}getTile(pe,ve,Ne){const Ye=Math.pow(2,pe),Ze=[];for(const nt of this.features.values())_e(nt,Ye,ve,Ne)&&Ze.push(ke(nt,Ye,ve,Ne));return{features:Ze}}getFeatures(){return[...this.features.values()]}}function _e({minX:st,minY:pe,maxX:ve,maxY:Ne},Ye,Ze,nt){return st<(Ze+1+Se)/Ye&&pe<(nt+1+Se)/Ye&&ve>(Ze-Se)/Ye&&Ne>(nt-Se)/Ye}function be(st){const{id:pe,geometry:ve,properties:Ne}=st;if(!ve)return;if(ve.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ye,coordinates:Ze}=ve,nt={id:pe,type:1,geometry:[],tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},vt=nt.geometry;if(Ye==="Point")Pe(Ze,vt,nt);else if(Ye==="MultiPoint")for(const it of Ze)Pe(it,vt,nt);else if(Ye==="LineString")nt.type=2,ye(Ze,vt,nt);else if(Ye==="MultiLineString")nt.type=2,ge(Ze,vt,nt);else if(Ye==="Polygon")nt.type=3,ge(Ze,vt,nt,!0);else{if(Ye!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");nt.type=3;for(const it of Ze)ge(it,vt,nt,!0)}return nt}function Pe([st,pe],ve,Ne){const Ye=i.aF(st);let Ze=i.aJ(pe);Ze=Ze<0?0:Ze>1?1:Ze,ve.push(Ye,Ze),Ne.minX=Math.min(Ne.minX,Ye),Ne.minY=Math.min(Ne.minY,Ze),Ne.maxX=Math.max(Ne.maxX,Ye),Ne.maxY=Math.max(Ne.maxY,Ze)}function ye(st,pe,ve,Ne=!1,Ye=!1){const Ze=[];for(const nt of st)Pe(nt,Ze,ve);pe.push(Ze),Ne&&function(nt,vt){let it=0;for(let gt=0,Ht=nt.length,zt=Ht-2;gt<Ht;zt=gt,gt+=2)it+=(nt[gt]-nt[zt])*(nt[gt+1]+nt[zt+1]);if(it>0===vt)for(let gt=0,Ht=nt.length;gt<Ht/2;gt+=2){const zt=nt[gt],Tr=nt[gt+1];nt[gt]=nt[Ht-2-gt],nt[gt+1]=nt[Ht-1-gt],nt[Ht-2-gt]=zt,nt[Ht-1-gt]=Tr}}(Ze,Ye)}function ge(st,pe,ve,Ne=!1){for(let Ye=0;Ye<st.length;Ye++)ye(st[Ye],pe,ve,Ne,Ye===0)}function ke(st,pe,ve,Ne){const{id:Ye,type:Ze,geometry:nt,tags:vt}=st,it=[];if(Ze===1)(function(gt,Ht,zt,Tr,Gr){for(let Ur=0;Ur<gt.length;Ur+=2){const kr=Math.round(i.al*(gt[Ur+0]*Ht-zt)),gn=Math.round(i.al*(gt[Ur+1]*Ht-Tr));Gr.push([kr,gn])}})(nt,pe,ve,Ne,it);else for(const gt of nt)Qe(gt,pe,ve,Ne,it);return{id:Ye,type:Ze,geometry:it,tags:vt}}function Qe(st,pe,ve,Ne,Ye){const Ze=-Ce,nt=i.al+Ce;let vt;for(let it=0;it<st.length-2;it+=2){let gt=Math.round(i.al*(st[it+0]*pe-ve)),Ht=Math.round(i.al*(st[it+1]*pe-Ne)),zt=Math.round(i.al*(st[it+2]*pe-ve)),Tr=Math.round(i.al*(st[it+3]*pe-Ne));const Gr=zt-gt,Ur=Tr-Ht;gt<Ze&&zt<Ze||(gt<Ze?(Ht+=Math.round(Ur*((Ze-gt)/Gr)),gt=Ze):zt<Ze&&(Tr=Ht+Math.round(Ur*((Ze-gt)/Gr)),zt=Ze),Ht<Ze&&Tr<Ze||(Ht<Ze?(gt+=Math.round(Gr*((Ze-Ht)/Ur)),Ht=Ze):Tr<Ze&&(zt=gt+Math.round(Gr*((Ze-Ht)/Ur)),Tr=Ze),gt>=nt&&zt>=nt||(gt>=nt?(Ht+=Math.round(Ur*((nt-gt)/Gr)),gt=nt):zt>=nt&&(Tr=Ht+Math.round(Ur*((nt-gt)/Gr)),zt=nt),Ht>=nt&&Tr>=nt||(Ht>=nt?(gt+=Math.round(Gr*((nt-Ht)/Ur)),Ht=nt):Tr>=nt&&(zt=gt+Math.round(Gr*((nt-Ht)/Ur)),Tr=nt),vt&&gt===vt[vt.length-1][0]&&Ht===vt[vt.length-1][1]||(vt=[[gt,Ht]],Ye.push(vt)),vt.push([zt,Tr])))))}}function He({name:st,features:pe},ve){ve.writeStringField(1,st),ve.writeVarintField(5,i.al);const Ne=new Map,Ye=new Map,Ze={keys:Ne,values:Ye,feature:null};for(const nt of pe)Ze.feature=nt,ve.writeMessage(2,$e,Ze);for(const nt of Ne.keys())ve.writeStringField(3,nt);for(const nt of Ye.keys())ve.writeMessage(4,At,nt)}function $e(st,pe){const ve=st.feature;ve.id!==void 0&&Number.isSafeInteger(+ve.id)&&pe.writeVarintField(1,+ve.id),ve.tags&&pe.writeMessage(2,Xe,st),pe.writeVarintField(3,ve.type),pe.writeMessage(4,ut,ve)}function Xe({keys:st,values:pe,feature:ve},Ne){for(const Ye of Object.keys(ve.tags)){let Ze=ve.tags[Ye];if(Ze===null)continue;let nt=st.get(Ye);nt===void 0&&(nt=st.size,st.set(Ye,nt)),Ne.writeVarint(nt);const vt=typeof Ze;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(Ze=JSON.stringify(Ze));let it=pe.get(Ze);it===void 0&&(it=pe.size,pe.set(Ze,it)),Ne.writeVarint(it)}}function ft(st,pe){return(pe<<3)+(7&st)}function ze(st){return st<<1^st>>31}function ut(st,pe){const{geometry:ve,type:Ne}=st;let Ye=0,Ze=0;if(Ne===1){pe.writeVarint(ft(1,ve.length));for(const nt of ve){const vt=nt[0]-Ye,it=nt[1]-Ze;pe.writeVarint(ze(vt)),pe.writeVarint(ze(it)),Ye+=vt,Ze+=it}}else for(const nt of ve){pe.writeVarint(ft(1,1));const vt=nt.length-(Ne===3?1:0);for(let it=0;it<vt;it++){it===1&&pe.writeVarint(ft(2,vt-1));const gt=nt[it][0]-Ye,Ht=nt[it][1]-Ze;pe.writeVarint(ze(gt)),pe.writeVarint(ze(Ht)),Ye+=gt,Ze+=Ht}Ne===3&&pe.writeVarint(ft(7,1))}}function At(st,pe){const ve=typeof st;ve==="string"?pe.writeStringField(1,st):ve==="boolean"?pe.writeBooleanField(7,st):ve==="number"&&(st%1!=0?pe.writeDoubleField(3,st):st<0?pe.writeSVarintField(6,st):pe.writeVarintField(5,st))}const xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:st=>st},nr=Math.fround||(Vt=new Float32Array(1),st=>(Vt[0]=+st,Vt[0]));var Vt;const dr=3,Br=5,Yr=6;class _t{constructor(pe){this.options=Object.assign(Object.create(xt),pe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(pe){const{log:ve,minZoom:Ne,maxZoom:Ye}=this.options;ve&&console.time("total time");const Ze=`prepare ${pe.length} points`;ve&&console.time(Ze),this.points=pe;const nt=[];for(let it=0;it<pe.length;it++){const gt=pe[it];if(!gt.geometry)continue;const[Ht,zt]=gt.geometry.coordinates,Tr=nr(at(Ht)),Gr=nr(dt(zt));nt.push(Tr,Gr,1/0,it,-1,1),this.options.reduce&&nt.push(0)}let vt=this.trees[Ye+1]=this._createTree(nt);ve&&console.timeEnd(Ze);for(let it=Ye;it>=Ne;it--){const gt=+Date.now();vt=this.trees[it]=this._createTree(this._cluster(vt,it)),ve&&console.log("z%d: %d clusters in %dms",it,vt.numItems,+Date.now()-gt)}return ve&&console.timeEnd("total time"),this}getClusters(pe,ve){let Ne=((pe[0]+180)%360+360)%360-180;const Ye=Math.max(-90,Math.min(90,pe[1]));let Ze=pe[2]===180?180:((pe[2]+180)%360+360)%360-180;const nt=Math.max(-90,Math.min(90,pe[3]));if(pe[2]-pe[0]>=360)Ne=-180,Ze=180;else if(Ne>Ze){const zt=this.getClusters([Ne,Ye,180,nt],ve),Tr=this.getClusters([-180,Ye,Ze,nt],ve);return zt.concat(Tr)}const vt=this.trees[this._limitZoom(ve)],it=vt.range(at(Ne),dt(nt),at(Ze),dt(Ye)),gt=vt.data,Ht=[];for(const zt of it){const Tr=this.stride*zt;Ht.push(gt[Tr+Br]>1?Mt(gt,Tr,this.clusterProps):this.points[gt[Tr+dr]])}return Ht}getChildren(pe){const ve=this._getOriginId(pe),Ne=this._getOriginZoom(pe),Ye="No cluster with the specified id.",Ze=this.trees[Ne];if(!Ze)throw new Error(Ye);const nt=Ze.data;if(ve*this.stride>=nt.length)throw new Error(Ye);const vt=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),it=Ze.within(nt[ve*this.stride],nt[ve*this.stride+1],vt),gt=[];for(const Ht of it){const zt=Ht*this.stride;nt[zt+4]===pe&&gt.push(nt[zt+Br]>1?Mt(nt,zt,this.clusterProps):this.points[nt[zt+dr]])}if(gt.length===0)throw new Error(Ye);return gt}getLeaves(pe,ve,Ne){const Ye=[];return this._appendLeaves(Ye,pe,ve=ve||10,Ne=Ne||0,0),Ye}getTile(pe,ve,Ne){const Ye=this.trees[this._limitZoom(pe)],Ze=Math.pow(2,pe),{extent:nt,radius:vt}=this.options,it=vt/nt,gt=(Ne-it)/Ze,Ht=(Ne+1+it)/Ze,zt={features:[]};return this._addTileFeatures(Ye.range((ve-it)/Ze,gt,(ve+1+it)/Ze,Ht),Ye.data,ve,Ne,Ze,zt),ve===0&&this._addTileFeatures(Ye.range(1-it/Ze,gt,1,Ht),Ye.data,Ze,Ne,Ze,zt),ve===Ze-1&&this._addTileFeatures(Ye.range(0,gt,it/Ze,Ht),Ye.data,-1,Ne,Ze,zt),zt.features.length?zt:null}getClusterExpansionZoom(pe){let ve=this._getOriginZoom(pe)-1;for(;ve<=this.options.maxZoom;){const Ne=this.getChildren(pe);if(ve++,Ne.length!==1)break;pe=Ne[0].properties.cluster_id}return ve}_appendLeaves(pe,ve,Ne,Ye,Ze){const nt=this.getChildren(ve);for(const vt of nt){const it=vt.properties;if(it&&it.cluster?Ze+it.point_count<=Ye?Ze+=it.point_count:Ze=this._appendLeaves(pe,it.cluster_id,Ne,Ye,Ze):Ze<Ye?Ze++:pe.push(vt),pe.length===Ne)break}return Ze}_createTree(pe){const ve=new i.c3(pe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ne=0;Ne<pe.length;Ne+=this.stride)ve.add(pe[Ne],pe[Ne+1]);return ve.finish(),ve.data=pe,ve}_addTileFeatures(pe,ve,Ne,Ye,Ze,nt){for(const vt of pe){const it=vt*this.stride,gt=ve[it+Br]>1;let Ht,zt,Tr;if(gt)Ht=Ke(ve,it,this.clusterProps),zt=ve[it],Tr=ve[it+1];else{const kr=this.points[ve[it+dr]];Ht=kr.properties;const[gn,Sn]=kr.geometry.coordinates;zt=at(gn),Tr=dt(Sn)}const Gr={type:1,geometry:[[Math.round(this.options.extent*(zt*Ze-Ne)),Math.round(this.options.extent*(Tr*Ze-Ye))]],tags:Ht};let Ur;Ur=gt||this.options.generateId?ve[it+dr]:this.points[ve[it+dr]].id,Ur!==void 0&&(Gr.id=Ur),nt.features.push(Gr)}}_limitZoom(pe){return Math.max(this.options.minZoom,Math.min(Math.floor(+pe),this.options.maxZoom+1))}_cluster(pe,ve){const{radius:Ne,extent:Ye,reduce:Ze,minPoints:nt}=this.options,vt=Ne/(Ye*Math.pow(2,ve)),it=pe.data,gt=[],Ht=this.stride;for(let zt=0;zt<it.length;zt+=Ht){if(it[zt+2]<=ve)continue;it[zt+2]=ve;const Tr=it[zt],Gr=it[zt+1],Ur=pe.within(it[zt],it[zt+1],vt),kr=it[zt+Br];let gn=kr;for(const Sn of Ur){const fi=Sn*Ht;it[fi+2]>ve&&(gn+=it[fi+Br])}if(gn>kr&&gn>=nt){let Sn,fi=Tr*kr,sa=Gr*kr,Fa=-1;const Sa=(zt/Ht<<5)+(ve+1)+this.points.length;for(const _a of Ur){const li=_a*Ht;if(it[li+2]<=ve)continue;it[li+2]=ve;const Rn=it[li+Br];fi+=it[li]*Rn,sa+=it[li+1]*Rn,it[li+4]=Sa,Ze&&(Sn||(Sn=this._map(it,zt,!0),Fa=this.clusterProps.length,this.clusterProps.push(Sn)),Ze(Sn,this._map(it,li)))}it[zt+4]=Sa,gt.push(fi/gn,sa/gn,1/0,Sa,-1,gn),Ze&&gt.push(Fa)}else{for(let Sn=0;Sn<Ht;Sn++)gt.push(it[zt+Sn]);if(gn>1)for(const Sn of Ur){const fi=Sn*Ht;if(!(it[fi+2]<=ve)){it[fi+2]=ve;for(let sa=0;sa<Ht;sa++)gt.push(it[fi+sa])}}}}return gt}_getOriginId(pe){return pe-this.points.length>>5}_getOriginZoom(pe){return(pe-this.points.length)%32}_map(pe,ve,Ne){if(pe[ve+Br]>1){const nt=this.clusterProps[pe[ve+Yr]];return Ne?Object.assign({},nt):nt}const Ye=this.points[pe[ve+dr]].properties,Ze=this.options.map(Ye);return Ne&&Ze===Ye?Object.assign({},Ze):Ze}}function Mt(st,pe,ve){return{type:"Feature",id:st[pe+dr],properties:Ke(st,pe,ve),geometry:{type:"Point",coordinates:[(Ne=st[pe],360*(Ne-.5)),tr(st[pe+1])]}};var Ne}function Ke(st,pe,ve){const Ne=st[pe+Br],Ye=Ne>=1e4?`${Math.round(Ne/1e3)}k`:Ne>=1e3?Math.round(Ne/100)/10+"k":Ne,Ze=st[pe+Yr],nt=Ze===-1?{}:Object.assign({},ve[Ze]);return Object.assign(nt,{cluster:!0,cluster_id:st[pe+dr],point_count:Ne,point_count_abbreviated:Ye})}function at(st){return st/360+.5}function dt(st){const pe=Math.sin(st*Math.PI/180),ve=.5-.25*Math.log((1+pe)/(1-pe))/Math.PI;return ve<0?0:ve>1?1:ve}function tr(st){const pe=(180-360*st)*Math.PI/180;return 360*Math.atan(Math.exp(pe))/Math.PI-90}function Qt(st,pe,ve,Ne){let Ye=Ne;const Ze=pe+(ve-pe>>1);let nt,vt=ve-pe;const it=st[pe],gt=st[pe+1],Ht=st[ve],zt=st[ve+1];for(let Tr=pe+3;Tr<ve;Tr+=3){const Gr=er(st[Tr],st[Tr+1],it,gt,Ht,zt);if(Gr>Ye)nt=Tr,Ye=Gr;else if(Gr===Ye){const Ur=Math.abs(Tr-Ze);Ur<vt&&(nt=Tr,vt=Ur)}}Ye>Ne&&(nt-pe>3&&Qt(st,pe,nt,Ne),st[nt+2]=Ye,ve-nt>3&&Qt(st,nt,ve,Ne))}function er(st,pe,ve,Ne,Ye,Ze){let nt=Ye-ve,vt=Ze-Ne;if(nt!==0||vt!==0){const it=((st-ve)*nt+(pe-Ne)*vt)/(nt*nt+vt*vt);it>1?(ve=Ye,Ne=Ze):it>0&&(ve+=nt*it,Ne+=vt*it)}return nt=st-ve,vt=pe-Ne,nt*nt+vt*vt}function Pr(st,pe,ve,Ne){const Ye={id:st??null,type:pe,geometry:ve,tags:Ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")sn(Ye,ve);else if(pe==="Polygon")sn(Ye,ve[0]);else if(pe==="MultiLineString")for(const Ze of ve)sn(Ye,Ze);else if(pe==="MultiPolygon")for(const Ze of ve)sn(Ye,Ze[0]);return Ye}function sn(st,pe){for(let ve=0;ve<pe.length;ve+=3)st.minX=Math.min(st.minX,pe[ve]),st.minY=Math.min(st.minY,pe[ve+1]),st.maxX=Math.max(st.maxX,pe[ve]),st.maxY=Math.max(st.maxY,pe[ve+1])}function fn(st,pe,ve,Ne){if(!pe.geometry)return;const Ye=pe.geometry.coordinates;if(Ye&&Ye.length===0)return;const Ze=pe.geometry.type,nt=Math.pow(ve.tolerance/((1<<ve.maxZoom)*ve.extent),2);let vt=[],it=pe.id;if(ve.promoteId?it=pe.properties[ve.promoteId]:ve.generateId&&(it=Ne||0),Ze==="Point")Ai(Ye,vt);else if(Ze==="MultiPoint")for(const gt of Ye)Ai(gt,vt);else if(Ze==="LineString")mi(Ye,vt,nt,!1);else if(Ze==="MultiLineString"){if(ve.lineMetrics){for(const gt of Ye)vt=[],mi(gt,vt,nt,!1),st.push(Pr(it,"LineString",vt,pe.properties));return}Zi(Ye,vt,nt,!1)}else if(Ze==="Polygon")Zi(Ye,vt,nt,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(const gt of pe.geometry.geometries)fn(st,{id:it,geometry:gt,properties:pe.properties},ve,Ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const gt of Ye){const Ht=[];Zi(gt,Ht,nt,!0),vt.push(Ht)}}st.push(Pr(it,Ze,vt,pe.properties))}function Ai(st,pe){pe.push(Rs(st[0]),Ua(st[1]),0)}function mi(st,pe,ve,Ne){let Ye,Ze,nt=0;for(let it=0;it<st.length;it++){const gt=Rs(st[it][0]),Ht=Ua(st[it][1]);pe.push(gt,Ht,0),it>0&&(nt+=Ne?(Ye*Ht-gt*Ze)/2:Math.sqrt(Math.pow(gt-Ye,2)+Math.pow(Ht-Ze,2))),Ye=gt,Ze=Ht}const vt=pe.length-3;pe[2]=1,Qt(pe,0,vt,ve),pe[vt+2]=1,pe.size=Math.abs(nt),pe.start=0,pe.end=pe.size}function Zi(st,pe,ve,Ne){for(let Ye=0;Ye<st.length;Ye++){const Ze=[];mi(st[Ye],Ze,ve,Ne),pe.push(Ze)}}function Rs(st){return st/360+.5}function Ua(st){const pe=Math.sin(st*Math.PI/180),ve=.5-.25*Math.log((1+pe)/(1-pe))/Math.PI;return ve<0?0:ve>1?1:ve}function wi(st,pe,ve,Ne,Ye,Ze,nt,vt){if(Ne/=pe,Ze>=(ve/=pe)&&nt<Ne)return st;if(nt<ve||Ze>=Ne)return null;const it=[];for(const gt of st){const Ht=gt.geometry;let zt=gt.type;const Tr=Ye===0?gt.minX:gt.minY,Gr=Ye===0?gt.maxX:gt.maxY;if(Tr>=ve&&Gr<Ne){it.push(gt);continue}if(Gr<ve||Tr>=Ne)continue;let Ur=[];if(zt==="Point"||zt==="MultiPoint")_s(Ht,Ur,ve,Ne,Ye);else if(zt==="LineString")zo(Ht,Ur,ve,Ne,Ye,!1,vt.lineMetrics);else if(zt==="MultiLineString")Bo(Ht,Ur,ve,Ne,Ye,!1);else if(zt==="Polygon")Bo(Ht,Ur,ve,Ne,Ye,!0);else if(zt==="MultiPolygon")for(const kr of Ht){const gn=[];Bo(kr,gn,ve,Ne,Ye,!0),gn.length&&Ur.push(gn)}if(Ur.length){if(vt.lineMetrics&&zt==="LineString"){for(const kr of Ur)it.push(Pr(gt.id,zt,kr,gt.tags));continue}zt!=="LineString"&&zt!=="MultiLineString"||(Ur.length===1?(zt="LineString",Ur=Ur[0]):zt="MultiLineString"),zt!=="Point"&&zt!=="MultiPoint"||(zt=Ur.length===3?"Point":"MultiPoint"),it.push(Pr(gt.id,zt,Ur,gt.tags))}}return it.length?it:null}function _s(st,pe,ve,Ne,Ye){for(let Ze=0;Ze<st.length;Ze+=3){const nt=st[Ze+Ye];nt>=ve&&nt<=Ne&&ts(pe,st[Ze],st[Ze+1],st[Ze+2])}}function zo(st,pe,ve,Ne,Ye,Ze,nt){let vt=js(st);const it=Ye===0?ji:oo;let gt,Ht,zt=st.start;for(let gn=0;gn<st.length-3;gn+=3){const Sn=st[gn],fi=st[gn+1],sa=st[gn+2],Fa=st[gn+3],Sa=st[gn+4],_a=Ye===0?Sn:fi,li=Ye===0?Fa:Sa;let Rn=!1;nt&&(gt=Math.sqrt(Math.pow(Sn-Fa,2)+Math.pow(fi-Sa,2))),_a<ve?li>ve&&(Ht=it(vt,Sn,fi,Fa,Sa,ve),nt&&(vt.start=zt+gt*Ht)):_a>Ne?li<Ne&&(Ht=it(vt,Sn,fi,Fa,Sa,Ne),nt&&(vt.start=zt+gt*Ht)):ts(vt,Sn,fi,sa),li<ve&&_a>=ve&&(Ht=it(vt,Sn,fi,Fa,Sa,ve),Rn=!0),li>Ne&&_a<=Ne&&(Ht=it(vt,Sn,fi,Fa,Sa,Ne),Rn=!0),!Ze&&Rn&&(nt&&(vt.end=zt+gt*Ht),pe.push(vt),vt=js(st)),nt&&(zt+=gt)}let Tr=st.length-3;const Gr=st[Tr],Ur=st[Tr+1],kr=Ye===0?Gr:Ur;kr>=ve&&kr<=Ne&&ts(vt,Gr,Ur,st[Tr+2]),Tr=vt.length-3,Ze&&Tr>=3&&(vt[Tr]!==vt[0]||vt[Tr+1]!==vt[1])&&ts(vt,vt[0],vt[1],vt[2]),vt.length&&pe.push(vt)}function js(st){const pe=[];return pe.size=st.size,pe.start=st.start,pe.end=st.end,pe}function Bo(st,pe,ve,Ne,Ye,Ze){for(const nt of st)zo(nt,pe,ve,Ne,Ye,Ze,!1)}function ts(st,pe,ve,Ne){st.push(pe,ve,Ne)}function ji(st,pe,ve,Ne,Ye,Ze){const nt=(Ze-pe)/(Ne-pe);return ts(st,Ze,ve+(Ye-ve)*nt,1),nt}function oo(st,pe,ve,Ne,Ye,Ze){const nt=(Ze-ve)/(Ye-ve);return ts(st,pe+(Ne-pe)*nt,Ze,1),nt}function ml(st,pe){const ve=[];for(let Ne=0;Ne<st.length;Ne++){const Ye=st[Ne],Ze=Ye.type;let nt;if(Ze==="Point"||Ze==="MultiPoint"||Ze==="LineString")nt=xr(Ye.geometry,pe);else if(Ze==="MultiLineString"||Ze==="Polygon"){nt=[];for(const vt of Ye.geometry)nt.push(xr(vt,pe))}else if(Ze==="MultiPolygon"){nt=[];for(const vt of Ye.geometry){const it=[];for(const gt of vt)it.push(xr(gt,pe));nt.push(it)}}ve.push(Pr(Ye.id,Ze,nt,Ye.tags))}return ve}function xr(st,pe){const ve=[];ve.size=st.size,st.start!==void 0&&(ve.start=st.start,ve.end=st.end);for(let Ne=0;Ne<st.length;Ne+=3)ve.push(st[Ne]+pe,st[Ne+1],st[Ne+2]);return ve}function wn(st,pe){if(st.transformed)return st;const ve=1<<st.z,Ne=st.x,Ye=st.y;for(const Ze of st.features){const nt=Ze.geometry,vt=Ze.type;if(Ze.geometry=[],vt===1)for(let it=0;it<nt.length;it+=2)Ze.geometry.push(On(nt[it],nt[it+1],pe,ve,Ne,Ye));else for(let it=0;it<nt.length;it++){const gt=[];for(let Ht=0;Ht<nt[it].length;Ht+=2)gt.push(On(nt[it][Ht],nt[it][Ht+1],pe,ve,Ne,Ye));Ze.geometry.push(gt)}}return st.transformed=!0,st}function On(st,pe,ve,Ne,Ye,Ze){return[Math.round(ve*(st*Ne-Ye)),Math.round(ve*(pe*Ne-Ze))]}function Ii(st,pe,ve,Ne,Ye){const Ze=pe===Ye.maxZoom?0:Ye.tolerance/((1<<pe)*Ye.extent),nt={features:[],numPoints:0,numSimplified:0,numFeatures:st.length,source:null,x:ve,y:Ne,z:pe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const vt of st)ha(nt,vt,Ze,Ye);return nt}function ha(st,pe,ve,Ne){const Ye=pe.geometry,Ze=pe.type,nt=[];if(st.minX=Math.min(st.minX,pe.minX),st.minY=Math.min(st.minY,pe.minY),st.maxX=Math.max(st.maxX,pe.maxX),st.maxY=Math.max(st.maxY,pe.maxY),Ze==="Point"||Ze==="MultiPoint")for(let vt=0;vt<Ye.length;vt+=3)nt.push(Ye[vt],Ye[vt+1]),st.numPoints++,st.numSimplified++;else if(Ze==="LineString")$o(nt,Ye,st,ve,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(let vt=0;vt<Ye.length;vt++)$o(nt,Ye[vt],st,ve,Ze==="Polygon",vt===0);else if(Ze==="MultiPolygon")for(let vt=0;vt<Ye.length;vt++){const it=Ye[vt];for(let gt=0;gt<it.length;gt++)$o(nt,it[gt],st,ve,!0,gt===0)}if(nt.length){let vt=pe.tags||null;if(Ze==="LineString"&&Ne.lineMetrics){vt={};for(const gt in pe.tags)vt[gt]=pe.tags[gt];vt.mapbox_clip_start=Ye.start/Ye.size,vt.mapbox_clip_end=Ye.end/Ye.size}const it={geometry:nt,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:vt};pe.id!==null&&(it.id=pe.id),st.features.push(it)}}function $o(st,pe,ve,Ne,Ye,Ze){const nt=Ne*Ne;if(Ne>0&&pe.size<(Ye?nt:Ne))return void(ve.numPoints+=pe.length/3);const vt=[];for(let it=0;it<pe.length;it+=3)(Ne===0||pe[it+2]>nt)&&(ve.numSimplified++,vt.push(pe[it],pe[it+1])),ve.numPoints++;Ye&&function(it,gt){let Ht=0;for(let zt=0,Tr=it.length,Gr=Tr-2;zt<Tr;Gr=zt,zt+=2)Ht+=(it[zt]-it[Gr])*(it[zt+1]+it[Gr+1]);if(Ht>0===gt)for(let zt=0,Tr=it.length;zt<Tr/2;zt+=2){const Gr=it[zt],Ur=it[zt+1];it[zt]=it[Tr-2-zt],it[zt+1]=it[Tr-1-zt],it[Tr-2-zt]=Gr,it[Tr-1-zt]=Ur}}(vt,Ze),st.push(vt)}const Nt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Uo{constructor(pe,ve){const Ne=(ve=this.options=function(Ze,nt){for(const vt in nt)Ze[vt]=nt[vt];return Ze}(Object.create(Nt),ve)).debug;if(Ne&&console.time("preprocess data"),ve.maxZoom<0||ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ve.promoteId&&ve.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ye=function(Ze,nt){const vt=[];if(Ze.type==="FeatureCollection")for(let it=0;it<Ze.features.length;it++)fn(vt,Ze.features[it],nt,it);else fn(vt,Ze.type==="Feature"?Ze:{geometry:Ze},nt);return vt}(pe,ve);this.tiles={},this.tileCoords=[],Ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ve.indexMaxZoom,ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ye=function(Ze,nt){const vt=nt.buffer/nt.extent;let it=Ze;const gt=wi(Ze,1,-1-vt,vt,0,-1,2,nt),Ht=wi(Ze,1,1-vt,2+vt,0,-1,2,nt);return(gt||Ht)&&(it=wi(Ze,1,-vt,1+vt,0,-1,2,nt)||[],gt&&(it=ml(gt,1).concat(it)),Ht&&(it=it.concat(ml(Ht,-1)))),it}(Ye,ve),Ye.length&&this.splitTile(Ye,0,0,0),Ne&&(Ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(pe,ve,Ne,Ye,Ze,nt,vt){const it=[pe,ve,Ne,Ye],gt=this.options,Ht=gt.debug;for(;it.length;){Ye=it.pop(),Ne=it.pop(),ve=it.pop(),pe=it.pop();const zt=1<<ve,Tr=gl(ve,Ne,Ye);let Gr=this.tiles[Tr];if(!Gr&&(Ht>1&&console.time("creation"),Gr=this.tiles[Tr]=Ii(pe,ve,Ne,Ye,gt),this.tileCoords.push({z:ve,x:Ne,y:Ye}),Ht)){Ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ve,Ne,Ye,Gr.numFeatures,Gr.numPoints,Gr.numSimplified),console.timeEnd("creation"));const Rn=`z${ve}`;this.stats[Rn]=(this.stats[Rn]||0)+1,this.total++}if(Gr.source=pe,Ze==null){if(ve===gt.indexMaxZoom||Gr.numPoints<=gt.indexMaxPoints)continue}else{if(ve===gt.maxZoom||ve===Ze)continue;if(Ze!=null){const Rn=Ze-ve;if(Ne!==nt>>Rn||Ye!==vt>>Rn)continue}}if(Gr.source=null,pe.length===0)continue;Ht>1&&console.time("clipping");const Ur=.5*gt.buffer/gt.extent,kr=.5-Ur,gn=.5+Ur,Sn=1+Ur;let fi=null,sa=null,Fa=null,Sa=null,_a=wi(pe,zt,Ne-Ur,Ne+gn,0,Gr.minX,Gr.maxX,gt),li=wi(pe,zt,Ne+kr,Ne+Sn,0,Gr.minX,Gr.maxX,gt);pe=null,_a&&(fi=wi(_a,zt,Ye-Ur,Ye+gn,1,Gr.minY,Gr.maxY,gt),sa=wi(_a,zt,Ye+kr,Ye+Sn,1,Gr.minY,Gr.maxY,gt),_a=null),li&&(Fa=wi(li,zt,Ye-Ur,Ye+gn,1,Gr.minY,Gr.maxY,gt),Sa=wi(li,zt,Ye+kr,Ye+Sn,1,Gr.minY,Gr.maxY,gt),li=null),Ht>1&&console.timeEnd("clipping"),it.push(fi||[],ve+1,2*Ne,2*Ye),it.push(sa||[],ve+1,2*Ne,2*Ye+1),it.push(Fa||[],ve+1,2*Ne+1,2*Ye),it.push(Sa||[],ve+1,2*Ne+1,2*Ye+1)}}getTile(pe,ve,Ne){pe=+pe,ve=+ve,Ne=+Ne;const Ye=this.options,{extent:Ze,debug:nt}=Ye;if(pe<0||pe>24)return null;const vt=1<<pe,it=gl(pe,ve=ve+vt&vt-1,Ne);if(this.tiles[it])return wn(this.tiles[it],Ze);nt>1&&console.log("drilling down to z%d-%d-%d",pe,ve,Ne);let gt,Ht=pe,zt=ve,Tr=Ne;for(;!gt&&Ht>0;)Ht--,zt>>=1,Tr>>=1,gt=this.tiles[gl(Ht,zt,Tr)];return gt&&gt.source?(nt>1&&(console.log("found parent tile z%d-%d-%d",Ht,zt,Tr),console.time("drilling down")),this.splitTile(gt.source,Ht,zt,Tr,pe,ve,Ne),nt>1&&console.timeEnd("drilling down"),this.tiles[it]?wn(this.tiles[it],Ze):null):null}}function gl(st,pe,ve){return 32*((1<<st)*ve+pe)+st}function rs(st,pe){const ve=st.tileID.canonical;if(!this._geoJSONIndex)return void pe(null,null);const Ne=this._geoJSONIndex.getTile(ve.z,ve.x,ve.y);if(!Ne)return void pe(null,null);const Ye=gt=>gt.tags&&"3d_elevation_id"in gt.tags&&"source"in gt.tags&&gt.tags.source==="elevation",Ze=Ne.features.filter(gt=>Ye(gt));let nt={_geojsonTileLayer:Ne.features};Ze.length>0&&(nt={_geojsonTileLayer:Ne.features.filter(gt=>!Ye(gt)),hd_road_elevation:Ze});const vt=new he(nt),it=function(gt){const Ht=new i.bs;for(const zt of Object.keys(gt))Ht.writeMessage(3,He,{name:zt,features:gt[zt]});return Ht.finish()}(nt).buffer;pe(null,{vectorTile:vt,rawData:it})}class xn extends X{constructor(pe,ve,Ne,Ye,Ze,nt,vt){super(pe,ve,Ne,Ye,Ze,rs,vt),nt&&(this.loadGeoJSON=nt),this._dynamicIndex=new fe}loadData(pe,ve){const Ne=pe&&pe.request,Ye=Ne&&Ne.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(pe,(Ze,nt)=>{if(Ze||!nt)return ve(Ze);if(typeof nt!="object")return ve(new Error(`Input data given to '${pe.source}' is not a valid GeoJSON object.`));{try{if(pe.filter){const it=i.U(pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(it.result==="error")throw new Error(it.value.map(gt=>`${gt.key}: ${gt.message}`).join(", "));nt.features=nt.features.filter(gt=>it.value.evaluate({zoom:0},gt))}pe.dynamic?(nt.type==="Feature"&&(nt={type:"FeatureCollection",features:[nt]}),pe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(nt.features,this.loaded),pe.cluster&&(nt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=pe.cluster?new _t(function({superclusterOptions:it,clusterProperties:gt}){if(!gt||!it)return it;const Ht={},zt={},Tr={accumulated:null,zoom:0},Gr={properties:null},Ur=Object.keys(gt);for(const kr of Ur){const[gn,Sn]=gt[kr],fi=i.U(Sn),sa=i.U(typeof gn=="string"?[gn,["accumulated"],["get",kr]]:gn);Ht[kr]=fi.value,zt[kr]=sa.value}return it.map=kr=>{Gr.properties=kr;const gn={};for(const Sn of Ur)gn[Sn]=Ht[Sn].evaluate(Tr,Gr);return gn},it.reduce=(kr,gn)=>{Gr.properties=gn;for(const Sn of Ur)Tr.accumulated=kr[Sn],kr[Sn]=zt[Sn].evaluate(Tr,Gr)},it}(pe)).load(nt.features):pe.dynamic?this._dynamicIndex:function(it,gt){return new Uo(it,gt)}(nt,pe.geojsonVtOptions)}catch(it){return ve(it)}const vt={};if(Ye){const it=g(Ne);it&&(vt.resourceTiming={},vt.resourceTiming[pe.source]=JSON.parse(JSON.stringify(it)))}ve(null,vt)}})}reloadTile(pe,ve){const Ne=this.loaded;return Ne&&Ne[pe.uid]?pe.partial?ve(null,void 0):super.reloadTile(pe,ve):this.loadTile(pe,ve)}loadGeoJSON(pe,ve){if(pe.request)i.m(pe.request,ve);else{if(typeof pe.data!="string")return ve(new Error(`Input data given to '${pe.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ve(null,JSON.parse(pe.data))}catch{return ve(new Error(`Input data given to '${pe.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(pe,ve){try{ve(null,this._geoJSONIndex.getClusterExpansionZoom(pe.clusterId))}catch(Ne){ve(Ne)}}getClusterChildren(pe,ve){try{ve(null,this._geoJSONIndex.getChildren(pe.clusterId))}catch(Ne){ve(Ne)}}getClusterLeaves(pe,ve){try{ve(null,this._geoJSONIndex.getLeaves(pe.clusterId,pe.limit,pe.offset))}catch(Ne){ve(Ne)}}}class ns{constructor(pe,ve,Ne){this.tileID=new i.aP(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),this.tileZoom=pe.tileZoom,this.uid=pe.uid,this.zoom=pe.zoom,this.canonical=pe.tileID.canonical,this.pixelRatio=pe.pixelRatio,this.tileSize=pe.tileSize,this.source=pe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=pe.projection,this.brightness=ve,this.worldview=Ne}parse(pe,ve,Ne,Ye){this.status="parsing";const Ze=new i.aP(Ne.tileID.overscaledZ,Ne.tileID.wrap,Ne.tileID.canonical.z,Ne.tileID.canonical.x,Ne.tileID.canonical.y),nt=[],vt=ve.familiesBySource[Ne.source],it=new i.fm(Ze,Ne.promoteId);it.bucketLayerIDs=[],it.is3DTile=!0,i.fB(pe).then(gt=>{if(!gt)return Ye(new Error("Could not parse tile"));const Ht=gt.json.extensionsUsed&&gt.json.extensionsUsed.includes("MAPBOX_mesh_features")||gt.json.asset.extras&&gt.json.asset.extras.MAPBOX_mesh_features,zt=gt.json.extensionsUsed&&gt.json.extensionsUsed.includes("EXT_meshopt_compression"),Tr=new i.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Gr in vt)for(const Ur of vt[Gr]){const kr=Ur[0];it.bucketLayerIDs.push(Ur.map(fi=>i.B(fi.id,fi.scope))),kr.recalculate(Tr,[]);const gn=i.fC(gt,1/i.d6(Ne.tileID.canonical)),Sn=new i.fD(Ur,gn,Ze,Ht,zt,this.brightness,it,this.worldview);Ht||(Sn.needsUpload=!0),nt.push(Sn),Sn.evaluate(kr)}this.status="done",Ye(null,{buckets:nt,featureIndex:it,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(gt=>Ye(new Error(gt.message)))}}class Gb{constructor(pe,ve,Ne,Ye,Ze,nt,vt,it){this.actor=pe,this.layerIndex=ve,this.availableImages=Ne,this.availableModels=Ye,this.brightness=vt,this.loading={},this.loaded={},this.worldview=it}loadTile(pe,ve){const Ne=pe.uid,Ye=this.loading[Ne]=new ns(pe,this.brightness,this.worldview);i.bt(pe.request,(Ze,nt)=>{const vt=!this.loading[Ne];return delete this.loading[Ne],vt||Ze?(Ye.status="done",vt||(this.loaded[Ne]=Ye),ve(Ze)):nt&&nt.byteLength!==0?void Ye.parse(nt,this.layerIndex,pe,(it,gt)=>{Ye.status="done",this.loaded=this.loaded||{},this.loaded[Ne]=Ye,it||!gt?ve(it):ve(null,gt)}):(Ye.status="done",this.loaded[Ne]=Ye,ve())})}reloadTile(pe,ve){const Ne=this.loaded,Ye=pe.uid;if(Ne&&Ne[Ye]){const Ze=Ne[Ye];Ze.projection=pe.projection,Ze.brightness=pe.brightness;const nt=(vt,it)=>{Ze.reloadCallback&&(delete Ze.reloadCallback,this.loadTile(pe,ve)),ve(vt,it)};Ze.status==="parsing"?Ze.reloadCallback=nt:Ze.status==="done"&&this.loadTile(pe,ve)}}abortTile(pe,ve){const Ne=pe.uid;this.loading[Ne]&&delete this.loading[Ne],ve()}removeTile(pe,ve){const Ne=this.loaded,Ye=pe.uid;Ne&&Ne[Ye]&&delete Ne[Ye],ve()}}class dg{constructor(pe){this.self=pe,this.actor=new i.fF(pe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new i.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=i.cl({name:"mercator"}),this.workerSourceTypes={vector:X,geojson:xn,"raster-dem":te,"raster-array":oe,"batched-model":Gb},this.workerSources={},this.self.registerWorkerSource=(ve,Ne)=>{if(this.workerSourceTypes[ve])throw new Error(`Worker source with name "${ve}" already registered.`);this.workerSourceTypes[ve]=Ne},this.self.registerRTLTextPlugin=ve=>{if(i.fG.isParsed())throw new Error("RTL text plugin already registered.");i.fG.setState({pluginStatus:i.fH.parsed,pluginURL:i.fG.getPluginURL()}),i.fG.applyArabicShaping=ve.applyArabicShaping,i.fG.processBidirectionalText=ve.processBidirectionalText,i.fG.processStyledBidirectionalText=ve.processStyledBidirectionalText;for(const Ne of this.rtlPluginParsingListeners)Ne(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(pe,ve,Ne){delete this.layerIndexes[pe],delete this.availableImages[pe],delete this.availableModels[pe],delete this.workerSources[pe],Ne()}checkIfReady(pe,ve,Ne){Ne()}setReferrer(pe,ve){this.referrer=ve}spriteLoaded(pe,ve){this.isSpriteLoaded[pe]||(this.isSpriteLoaded[pe]={});const{scope:Ne,isLoaded:Ye}=ve;if(this.isSpriteLoaded[pe][Ne]=Ye,this.workerSources[pe]&&this.workerSources[pe][Ne])for(const Ze in this.workerSources[pe][Ne]){const nt=this.workerSources[pe][Ne][Ze];for(const vt in nt){const it=nt[vt];it instanceof X&&(it.isSpriteLoaded=Ye,it.fire(new i.z("isSpriteLoaded")))}}}setImages(pe,ve,Ne){this.availableImages[pe]||(this.availableImages[pe]={});const{scope:Ye,images:Ze}=ve;if(this.availableImages[pe][Ye]=Ze,this.workerSources[pe]&&this.workerSources[pe][Ye]){for(const nt in this.workerSources[pe][Ye]){const vt=this.workerSources[pe][Ye][nt];for(const it in vt)vt[it].availableImages=Ze}Ne()}else Ne()}setModels(pe,{scope:ve,models:Ne},Ye){if(this.availableModels[pe]||(this.availableModels[pe]={}),this.availableModels[pe][ve]=Ne,this.workerSources[pe]&&this.workerSources[pe][ve]){for(const Ze in this.workerSources[pe][ve]){const nt=this.workerSources[pe][ve][Ze];for(const vt in nt)nt[vt].availableModels=Ne}Ye()}else Ye()}setProjection(pe,ve){this.projections[pe]=i.cl(ve)}setBrightness(pe,ve,Ne){this.brightness=ve,Ne()}setWorldview(pe,ve,Ne){this.worldview=ve,Ne()}setLayers(pe,ve,Ne){this.getLayerIndex(pe,ve.scope).replace(ve.layers,ve.options),Ne()}updateLayers(pe,ve,Ne){this.getLayerIndex(pe,ve.scope).update(ve.layers,ve.removedIds,ve.options),Ne()}loadTile(pe,ve,Ne){ve.projection=this.projections[pe]||this.defaultProjection,this.getWorkerSource(pe,ve.type,ve.source,ve.scope).loadTile(ve,Ne)}decodeRasterArray(pe,ve,Ne){this.getWorkerSource(pe,ve.type,ve.source,ve.scope).decodeRasterArray(ve,Ne)}reloadTile(pe,ve,Ne){ve.projection=this.projections[pe]||this.defaultProjection,this.getWorkerSource(pe,ve.type,ve.source,ve.scope).reloadTile(ve,Ne)}abortTile(pe,ve,Ne){this.getWorkerSource(pe,ve.type,ve.source,ve.scope).abortTile(ve,Ne)}removeTile(pe,ve,Ne){this.getWorkerSource(pe,ve.type,ve.source,ve.scope).removeTile(ve,Ne)}removeSource(pe,ve,Ne){if(!(this.workerSources[pe]&&this.workerSources[pe][ve.scope]&&this.workerSources[pe][ve.scope][ve.type]&&this.workerSources[pe][ve.scope][ve.type][ve.source]))return;const Ye=this.workerSources[pe][ve.scope][ve.type][ve.source];delete this.workerSources[pe][ve.scope][ve.type][ve.source],Ye.removeSource!==void 0?Ye.removeSource(ve,Ne):Ne()}loadWorkerSource(pe,ve,Ne){try{this.self.importScripts(ve.url),Ne()}catch(Ye){Ne(Ye.toString())}}syncRTLPluginState(pe,ve,Ne){if(i.fG.isParsed())Ne(null,!0);else if(i.fG.isParsing())this.rtlPluginParsingListeners.push(Ne);else try{i.fG.setState(ve);const Ye=i.fG.getPluginURL();!i.fG.isLoaded()||i.fG.isParsed()||i.fG.isParsing()||Ye==null||(i.fG.setState({pluginStatus:i.fH.parsing,pluginURL:i.fG.getPluginURL()}),this.self.importScripts(Ye),i.fG.isParsed()?Ne(null,!0):this.rtlPluginParsingListeners.push(Ne))}catch(Ye){Ne(Ye.toString())}}setDracoUrl(pe,ve){this.dracoUrl=ve}getAvailableImages(pe,ve){this.availableImages[pe]||(this.availableImages[pe]={});let Ne=this.availableImages[pe][ve];return Ne||(Ne=[]),Ne}getAvailableModels(pe,ve){this.availableModels[pe]||(this.availableModels[pe]={});let Ne=this.availableModels[pe][ve];return Ne||(Ne={}),Ne}getLayerIndex(pe,ve){this.layerIndexes[pe]||(this.layerIndexes[pe]={});let Ne=this.layerIndexes[pe][ve];return Ne||(Ne=this.layerIndexes[pe][ve]=new E,Ne.scope=ve),Ne}getWorkerSource(pe,ve,Ne,Ye){const Ze=this.workerSources;return Ze[pe]||(Ze[pe]={}),Ze[pe][Ye]||(Ze[pe][Ye]={}),Ze[pe][Ye][ve]||(Ze[pe][Ye][ve]={}),this.isSpriteLoaded[pe]||(this.isSpriteLoaded[pe]={}),Ze[pe][Ye][ve][Ne]||(Ze[pe][Ye][ve][Ne]=new this.workerSourceTypes[ve]({send:(nt,vt,it,gt,Ht,zt)=>this.actor.send(nt,vt,it,pe,Ht,zt),scheduler:this.actor.scheduler},this.getLayerIndex(pe,Ye),this.getAvailableImages(pe,Ye),this.getAvailableModels(pe,Ye),this.isSpriteLoaded[pe][Ye],void 0,this.brightness,this.worldview)),Ze[pe][Ye][ve][Ne]}rasterizeImagesWorker(pe,ve,Ne){const Ye=new Map;for(const[Ze,{image:nt,imageVariant:vt}]of ve.tasks.entries()){const it=this.imageRasterizer.rasterize(vt,nt,ve.scope,pe);Ye.set(Ze,it)}Ne(void 0,Ye)}removeRasterizedImages(pe,ve,Ne){this.imageRasterizer.removeImagesFromCacheByIds(ve.imageIds,ve.scope,pe),Ne()}enforceCacheSizeLimit(pe,ve){i.fI(ve)}getWorkerPerformanceMetrics(pe,ve,Ne){Ne(void 0,void 0)}}return i.fE(self)&&(self.worker=new dg(self)),dg}),l(["./shared"],function(i){var g="3.16.0";const x={create:"create",load:"load",fullLoad:"fullLoad"},S={mark(y){performance.mark(y)},measure(y,s,h){performance.measure(y,s,h)}};function E(y){const s=y.name.split("?")[0];return i.a(s)&&s.includes("mapbox-gl.js")?"javascript":i.a(s)&&s.includes("mapbox-gl.css")?"css":i.b(s)?"fontRange":i.c(s)?"sprite":i.i(s)?"style":i.d(s)?"tilejson":"other"}var A,C={},N=function(){if(A)return C;function y(v){return!s(v)}function s(v){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,O,D=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(D);try{O=new Worker(z),P=!0}catch{P=!1}return O&&O.terminate(),URL.revokeObjectURL(z),P}()?function(){var P=document.createElement("canvas");P.width=P.height=1;var O=P.getContext("2d");if(!O)return!1;var D=O.getImageData(0,0,1,1);return D&&D.width===P.width}()?(h[w=v&&v.failIfMajorPerformanceCaveat]===void 0&&(h[w]=function(P){var O,D=function(z){var W=document.createElement("canvas"),H=Object.create(y.webGLContextAttributes);return H.failIfMajorPerformanceCaveat=z,W.getContext("webgl2",H)}(P);if(!D)return!1;try{O=D.createShader(D.VERTEX_SHADER)}catch{return!1}return!(!O||D.isContextLost())&&(D.shaderSource(O,"void main() {}"),D.compileShader(O),D.getShaderParameter(O,D.COMPILE_STATUS)===!0)}(w)),h[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}A=1,C.supported=y,C.notSupportedReason=s;var h={};return y.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},C}();function k(y,s,h){const v=document.createElement(y);return s!=null&&(v.className=s),h&&h.appendChild(v),v}function R(y,s,h){const v=document.createElementNS("http://www.w3.org/2000/svg",y);for(const w of Object.keys(s))v.setAttributeNS(null,w,String(s[w]));return h&&h.appendChild(v),v}const L=typeof document<"u"?document.documentElement&&document.documentElement.style:null,j=L&&L.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;function B(){L&&j&&(F=L[j],L[j]="none")}function U(){L&&j&&(L[j]=F)}function Z(y){y.preventDefault(),y.stopPropagation(),window.removeEventListener("click",Z,!0)}function X(){window.addEventListener("click",Z,!0),window.setTimeout(()=>{window.removeEventListener("click",Z,!0)},0)}function te(y,s){const h=y.getBoundingClientRect();return ne(y,h,s)}function se(y,s){const h=y.getBoundingClientRect(),v=[];for(let w=0;w<s.length;w++)v.push(ne(y,h,s[w]));return v}function oe(y){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&y.button===2&&y.ctrlKey?0:y.button}function ne(y,s,h){const v=y.offsetWidth===s.width?1:y.offsetWidth/s.width;return new i.P((h.clientX-s.left)*v,(h.clientY-s.top)*v)}const ee="01",ie="NO_ACCESS_TOKEN";class he{constructor(s,h,v){this._transformRequestFn=s,this._customAccessToken=h,this._silenceAuthErrors=!!v,this._createSkuToken()}_createSkuToken(){const s=function(){let h="";for(let v=0;v<10;v++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ee,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeStyleURL(s,h){if(!i.h(s))return s;const v=Ce(s);return v.params.push(`sdk=js-${g}`),v.path=`/styles/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeGlyphsURL(s,h){if(!i.h(s))return s;const v=Ce(s);return v.path=`/fonts/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeModelURL(s,h){if(!i.h(s))return s;const v=Ce(s);return v.path=`/models/v1${v.path}`,this._makeAPIURL(v,this._customAccessToken||h)}normalizeSourceURL(s,h,v,w){if(!i.h(s))return s;const P=Ce(s);return P.path=`/v4/${P.authority}.json`,P.params.push("secure"),v&&P.params.push(`language=${v}`),w&&P.params.push(`worldview=${w}`),this._makeAPIURL(P,this._customAccessToken||h)}normalizeIconsetURL(s,h){const v=Ce(s);return i.h(s)?(v.path=`/styles/v1${v.path}/iconset.pbf`,this._makeAPIURL(v,this._customAccessToken||h)):fe(v)}normalizeSpriteURL(s,h,v,w){const P=Ce(s);return i.h(s)?(P.path=`/styles/v1${P.path}/sprite${h}${v}`,this._makeAPIURL(P,this._customAccessToken||w)):(P.path+=`${h}${v}`,fe(P))}normalizeTileURL(s,h,v){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!i.h(s))return s;const w=Ce(s);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||v&&w.authority!=="raster"&&v===512?"@2x":""}${i.k.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${i.e.RASTER_URL_PREFIX}${w.path}`:w.authority==="rasterarrays"?w.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${w.path}`:w.authority==="3dtiles"?w.path=`/${i.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${i.e.TILE_URL_VERSION}${w.path}`);const P=this._customAccessToken||function(O){for(const D of O){const z=D.match(/^access_token=(.*)$/);if(z)return z[1]}return null}(w.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&P&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,P)}canonicalizeTileURL(s,h){const v=Ce(s);if(!v.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!v.path.match(/\.[\w]+$/))return s;let w="mapbox://";v.path.match(/^\/raster\/v1\//)?w+=`raster/${v.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:v.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${v.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${v.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let P=v.params;return h&&(P=P.filter(O=>!O.match(/^access_token=/))),P.length&&(w+=`?${P.join("&")}`),w}canonicalizeTileset(s,h){const v=!!h&&i.h(h),w=[];for(const P of s.tiles||[])i.j(P)?w.push(this.canonicalizeTileURL(P,v)):w.push(P);return w}_makeAPIURL(s,h){const v="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=Ce(i.e.API_URL);if(s.protocol=w.protocol,s.authority=w.authority,s.protocol==="http"){const P=s.params.indexOf("secure");P>=0&&s.params.splice(P,1)}if(w.path!=="/"&&(s.path=`${w.path}${s.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return fe(s);if(h=h||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${v}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${v}`)}return s.params=s.params.filter(P=>P.indexOf("access_token")===-1),s.params.push(`access_token=${h||""}`),fe(s)}}const Se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ce(y){const s=y.match(Se);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function fe(y){const s=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${s}`}const _e="mapbox.eventData";function be(y){if(!y)return null;const s=y.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(i.l(s[1]))}catch{return null}}class Pe{constructor(s){this.type=s,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const h=be(i.e.ACCESS_TOKEN);let v="";return v=h&&h.u?i.f(h.u):i.e.ACCESS_TOKEN||"",s?`${_e}.${s}:${v}`:`${_e}:${v}`}fetchEventData(){const s=i.s("localStorage"),h=this.getStorageKey(),v=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp");if(s)try{const P=localStorage.getItem(h);P&&(this.eventData=JSON.parse(P));const O=localStorage.getItem(v);O&&(this.anonId=O);const D=localStorage.getItem(w);D&&(this.anonIdTimestamp=Number(D));const z=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<z)&&this.refreshUUID()}catch{i.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=i.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const s=i.s("localStorage"),h=this.getStorageKey(),v=this.getStorageKey("uuid"),w=this.getStorageKey("uuidTimestamp"),P=this.anonId,O=this.anonIdTimestamp;if(s&&P)try{localStorage.setItem(v,P),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData)),O&&localStorage.setItem(w,O.toString())}catch{i.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,h,v,w){if(!i.e.EVENTS_URL)return;const P=Ce(i.e.EVENTS_URL);P.params.push(`access_token=${w||i.e.ACCESS_TOKEN||""}`);const O={event:this.type,created:new Date(s).toISOString()},D=h?Object.assign(O,h):O,z={url:fe(P),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};this.pendingRequest=i.p(z,W=>{this.pendingRequest=null,v(W),this.saveEventData(),this.processRequests(w)})}queueRequest(s,h){this.queue.push(s),this.processRequests(h)}}const ye=new class extends Pe{constructor(y){super("appUserTurnstile"),this._customAccessToken=y}postTurnstileEvent(y,s){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(y)&&y.some(h=>i.h(h)||i.j(h))&&this.queueRequest(Date.now(),s)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=be(i.e.ACCESS_TOKEN),h=s?s.u:i.e.ACCESS_TOKEN;let v=h!==this.eventData.tokenU;i.v(this.anonId)||(this.refreshUUID(),v=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const P=new Date(this.eventData.lastSuccess),O=new Date(w),D=(w-this.eventData.lastSuccess)/864e5;v=v||D>=1||D<-1||P.getDate()!==O.getDate()}else v=!0;v?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ee,"enabled.telemetry":!1,userId:this.anonId},P=>{P||(this.eventData.lastSuccess=w,this.eventData.tokenU=h)},y):this.processRequests()}},ge=ye.postTurnstileEvent.bind(ye),ke=new class extends Pe{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(y,s,h,v){this.skuToken=s,this.errorCb=v,i.e.EVENTS_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(ie)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID(),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:g,skuId:ee,skuToken:this.skuToken,userId:this.anonId},v=>{v?this.errorCb(v):s&&(this.success[s]=!0)},y))}remove(){this.errorCb=null}},Qe=ke.postMapLoadEvent.bind(ke),He=new class extends Pe{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(y){let s=this.mapInstanceIdMap.get(y);return s||(s=i.u(),this.mapInstanceIdMap.set(y,s)),s}getEventId(y){const s=this.eventIdPerMapInstanceMap.get(y)||0;return this.eventIdPerMapInstanceMap.set(y,s+1),s}postStyleLoadEvent(y,s){const{map:h,style:v,importedStyles:w}=s;if(!i.e.EVENTS_URL||!y&&!i.e.ACCESS_TOKEN)return;const P=this.getMapInstanceId(h),O={mapInstanceId:P,eventId:this.getEventId(P),style:v};w.length&&(O.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:O},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:h}=this.queue.shift();this.postEvent(s,h,()=>{},y)}},$e=He.postStyleLoadEvent.bind(He),Xe=new class extends Pe{constructor(y){super("metrics"),y&&(this.data=y)}postMetricsEvent(y){if(!i.e.EVENTS_URL||!y&&!i.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),i.v(this.anonId)||this.refreshUUID();const s=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:s},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:h}=this.queue.shift();this.postEvent(s,h,()=>{},y)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),ft=Xe.postMetricsEvent.bind(Xe),ze=new class extends Pe{constructor(){super("gljs.performance")}postPerformanceEvent(y,s){i.e.EVENTS_URL&&(y||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},y)}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:h}=this.queue.shift(),v=function(w){const P=performance.getEntriesByType("resource"),O=performance.getEntriesByType("mark"),D=function(re){const le={};if(re){for(const ue in re)if(ue!=="other")for(const xe of re[ue]){const me=`${ue}ResolveRangeMin`,Ee=`${ue}ResolveRangeMax`,Ie=`${ue}RequestCount`,Ae=`${ue}RequestCachedCount`;le[me]=Math.min(le[me]||1/0,xe.startTime),le[Ee]=Math.max(le[Ee]||-1/0,xe.responseEnd);const Be=Re=>{le[Re]===void 0&&(le[Re]=0),++le[Re]};xe.transferSize!==void 0&&xe.transferSize===0&&Be(Ae),Be(Ie)}}return le}(function(re,le){const ue={};if(re)for(const xe of re){const me=le(xe);ue[me]===void 0&&(ue[me]=[]),ue[me].push(xe)}return ue}(P,E)),z=window.devicePixelRatio,W=navigator.connection||navigator.mozConnection||navigator.webkitConnection,H=W?W.effectiveType:void 0,Q={counters:[],metadata:[],attributes:[]},K=(re,le,ue)=>{ue!=null&&re.push({name:le,value:ue.toString()})};for(const re in D)K(Q.counters,re,D[re]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(K(Q.counters,"interactionRangeMin",w.interactionRange[0]),K(Q.counters,"interactionRangeMax",w.interactionRange[1])),O)for(const re of Object.values(x)){const le=O.find(ue=>ue.name===re);le&&K(Q.counters,re,le.startTime)}return K(Q.counters,"visibilityHidden",w.visibilityHidden),K(Q.attributes,"style",function(re){if(re)for(const le of re){const ue=le.name.split("?")[0];if(i.i(ue)){const xe=ue.split("/").slice(-2);if(xe.length===2)return`mapbox://styles/${xe[0]}/${xe[1]}`}}}(P)),K(Q.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),K(Q.attributes,"fogEnabled",w.fogEnabled?"true":"false"),K(Q.attributes,"projection",w.projection),K(Q.attributes,"zoom",w.zoom),K(Q.metadata,"devicePixelRatio",z),K(Q.metadata,"connectionEffectiveType",H),K(Q.metadata,"navigatorUserAgent",navigator.userAgent),K(Q.metadata,"screenWidth",window.screen.width),K(Q.metadata,"screenHeight",window.screen.height),K(Q.metadata,"windowWidth",window.innerWidth),K(Q.metadata,"windowHeight",window.innerHeight),K(Q.metadata,"mapWidth",w.width/z),K(Q.metadata,"mapHeight",w.height/z),K(Q.metadata,"webglRenderer",w.renderer),K(Q.metadata,"webglVendor",w.vendor),K(Q.metadata,"sdkVersion",g),K(Q.metadata,"sdkIdentifier","mapbox-gl-js"),Q}(h);for(const w of v.metadata);for(const w of v.counters);for(const w of v.attributes);this.postEvent(s,v,()=>{},y)}},ut=ze.postPerformanceEvent.bind(ze),At=new class extends Pe{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(y,s,h,v){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const w=Ce(i.e.API_URL+i.e.SESSION_PATH);w.params.push(`sku=${s||""}`),w.params.push(`access_token=${v||i.e.ACCESS_TOKEN||""}`);const P={url:fe(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(P,O=>{this.pendingRequest=null,h(O),this.saveEventData(),this.processRequests(v)})}getSessionAPI(y,s,h,v){this.skuToken=s,this.errorCb=v,i.e.SESSION_PATH&&i.e.API_URL&&(h||i.e.ACCESS_TOKEN?this.queueRequest({id:y,timestamp:Date.now()},h):this.errorCb(new Error(ie)))}processRequests(y){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||this.getSession(h,this.skuToken,v=>{v?this.errorCb(v):s&&(this.success[s]=!0)},y)}remove(){this.errorCb=null}},xt=At.getSessionAPI.bind(At),nr=new Set;function Vt(y,s){s?nr.add(y):nr.delete(y)}class dr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){const h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(i.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Br(y){const{userImage:s}=y;return!!(s&&s.render&&s.render())&&(y.data.replace(new Uint8Array(s.data.buffer)),!0)}class Yr extends i.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&i.r()&&(this.imageRasterizerDispatcher=new i.D(i.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new i.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const h=this.atlasTexture.get(s);h&&(h.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(s.id,s)}removeImageProvider(s,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(s)}getPendingImageProviders(){const s=[];for(const h of this.imageProviders.values())for(const v of h.values())v.hasPendingRequests()&&s.push(v);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,h){if(this.loaded.get(h)!==s&&(this.loaded.set(h,s),s)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,h,w);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images.get(h).get(s.toString())}addImage(s,h,v){this._validate(s,v)&&this.images.get(h).set(s.toString(),v)}_validate(s,h){let v=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),v=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),v=!1),this._validateContent(h.content,h)||(this.fire(new i.y(new Error(`Image "${s.name}" has invalid "content" value`))),v=!1),v}_validateStretch(s,h){if(!s)return!0;let v=0;for(const w of s){if(w[0]<v||w[1]<w[0]||h<w[1])return!1;v=w[1]}return!0}_validateContent(s,h){return s?s.length!==4||!h.usvg&&(s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,h,v){const w=this.images.get(h).get(s.toString());v.version=w.version+1,this.images.get(h).set(s.toString(),v),this.updatedImages.get(h).add(s),this.removeFromImageRasterizerCache(s,h)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,h){this.spriteFormat!=="raster"&&(i.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([s],h))}removeImage(s,h){const v=this.images.get(h),w=v.get(s.toString());v.delete(s.toString()),this.patterns.get(h).delete(s.toString()),this.removeFromImageRasterizerCache(s,h),w.userImage&&w.userImage.onRemove&&w.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(h=>i.I.from(h))}getImages(s,h,v){const w=[],P=[],O=this.imageProviders.get(h);for(const H of s){if(!H.iconsetId){w.push(H);continue}const Q=O.get(H.iconsetId);Q&&(this.getImage(H,h)?P.push(H):Q.addPendingRequest(H))}if(w.length===0)return void this._notify(P,h,v);let D=!0;const z=!!this.loaded.get(h),W=this.images.get(h);if(!z)for(const H of w)W.has(H.toString())||(D=!1);z||D?this._notify(w,h,v):this.requestors.push({ids:w,scope:h,callback:v})}rasterizeImages(s,h){const v=new Map,{tasks:w,scope:P}=s;for(const[O,D]of w.entries()){const z=this.getImage(D.id,P);z&&v.set(O,{image:z,imageVariant:D})}this._rasterizeImages(P,v,h)}_rasterizeImages(s,h,v){if(i.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:s},v);else{const w=new Map;for(const[P,{image:O,imageVariant:D}]of h.entries())w.set(P,this.imageRasterizer.rasterize(D,O,s,0));v(void 0,w)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,h,v){const w=this.images.get(h),P=new Map;for(const O of s){if(!w.get(O.toString())){if(O.iconsetId)continue;this.fire(new i.z("styleimagemissing",{id:O.name}))}const D=w.get(O.toString());if(!D){i.w(`Image "${O.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const z={data:D.usvg?null:D.data.clone(),pixelRatio:D.pixelRatio,sdf:D.sdf,usvg:D.usvg,version:D.version,stretchX:D.stretchX,stretchY:D.stretchY,content:D.content,hasRenderCallback:!!(D.userImage&&D.userImage.render)};D.usvg&&Object.assign(z,{width:D.icon.usvg_tree.width,height:D.icon.usvg_tree.height}),P.set(i.I.toString(O),z)}v(null,P)}getPixelSize(s){const{width:h,height:v}=this.atlasImage.get(s);return{width:h,height:v}}getPattern(s,h,v){const w=s.toString(),P=this.patterns.get(h),O=P.get(w),D=this.getImage(s,h);if(!D)return null;if(O){if(O.position.version===D.version)return O.position;O.position.version=D.version}else{if(D.usvg&&!D.data){const z=this.getPatternInFlightId(w,h);if(this.patternsInFlight.has(z))return null;this.patternsInFlight.add(z);const W=new i.A(s).scaleSelf(i.o.devicePixelRatio),H=new Map([[W.toString(),{image:D,imageVariant:W}]]);return this._rasterizeImages(h,H,(Q,K)=>this.storePatternImage(W,h,D,v,K)),null}this.storePattern(s,h,D)}return this._updatePatternAtlas(h,v),P.get(w).position}getPatternInFlightId(s,h){return i.B(s,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,h,v,w,P){const O=s.toString(),D=P?P.get(O):void 0;D&&(v.data=D,this.storePattern(s.id,h,v),this._updatePatternAtlas(h,w),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),h)))}storePattern(s,h,v){const w={w:v.data.width+2*i.C,h:v.data.height+2*i.C,x:0,y:0},P=new i.F(w,v,i.C);this.patterns.get(h).set(s.toString(),{bin:w,position:P})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,h){const v=s.gl;let w=this.atlasTexture.get(h);w?this.dirty&&(w.update(this.atlasImage.get(h)),this.dirty=!1):(w=new i.T(s,this.atlasImage.get(h),v.RGBA8),this.atlasTexture.set(h,w)),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){const v=this.patterns.get(s),w=Array.from(v.values()).map(({bin:W})=>W),{w:P,h:O}=i.G(w),D=this.atlasImage.get(s);D.resize({width:P||1,height:O||1});const z=this.images.get(s);for(const[W,{bin:H,position:Q}]of v.entries()){let K=Q.padding;const re=H.x+K,le=H.y+K,ue=z.get(W).data,xe=ue.width,me=ue.height;K=K>1?K-1:K,i.q.copy(ue,D,{x:0,y:0},{x:re,y:le},{width:xe,height:me},h),i.q.copy(ue,D,{x:0,y:me-K},{x:re,y:le-K},{width:xe,height:K},h),i.q.copy(ue,D,{x:0,y:0},{x:re,y:le+me},{width:xe,height:K},h),i.q.copy(ue,D,{x:xe-K,y:0},{x:re-K,y:le},{width:K,height:me},h),i.q.copy(ue,D,{x:0,y:0},{x:re+xe,y:le},{width:K,height:me},h),i.q.copy(ue,D,{x:xe-K,y:me-K},{x:re-K,y:le-K},{width:K,height:K},h),i.q.copy(ue,D,{x:0,y:me-K},{x:re+xe,y:le-K},{width:K,height:K},h),i.q.copy(ue,D,{x:0,y:0},{x:re+xe,y:le+me},{width:K,height:K},h),i.q.copy(ue,D,{x:xe-K,y:0},{x:re-K,y:le+me},{width:K,height:K},h)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,h){const v=this.images.get(h);for(const w of s){if(this.callbackDispatchedThisFrame.get(h).has(w.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(w.toString());const P=v.get(w.toString());Br(P)&&this.updateImage(w,h,P)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function _t(y){const s=y.value,h=y.valueSpec,v=y.style,w=y.styleSpec,P=y.key,O=y.arrayElementValidator||ji;if(!Array.isArray(s))return[new i.V(P,s,`array expected, ${i.K(s)} found`)];if(h.length&&s.length!==h.length)return[new i.V(P,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new i.V(P,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let D={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};w.$version<7&&(D.function=h.function),i.H(h.value)&&(D=h.value);let z=[];for(let W=0;W<s.length;W++)z=z.concat(O({array:s,arrayIndex:W,value:s[W],valueSpec:D,style:v,styleSpec:w,key:`${P}[${W}]`},!0));return z}function Mt(y){const s=y.key,h=y.value,v=y.valueSpec;if(!i.L(h))return[new i.V(s,h,`number expected, ${i.K(h)} found`)];if(h!=h)return[new i.V(s,h,"number expected, NaN found")];if("minimum"in v){let w=v.minimum;if(Array.isArray(v.minimum)&&(w=v.minimum[y.arrayIndex]),h<w)return[new i.V(s,h,`${h} is less than the minimum value ${w}`)]}if("maximum"in v){let w=v.maximum;if(Array.isArray(v.maximum)&&(w=v.maximum[y.arrayIndex]),h>w)return[new i.V(s,h,`${h} is greater than the maximum value ${w}`)]}return[]}function Ke(y){const s=y.key,h=y.value;if(!i.H(h))return[new i.V(s,h,`object expected, ${i.K(h)} found`)];const v=y.valueSpec,w=i.J(h.type);let P,O,D,z={};const W=w!=="categorical"&&h.property===void 0,H=!W,Q=function(ue){const xe=ue.stops;return Array.isArray(xe)&&Array.isArray(xe[0])&&i.H(xe[0][0])}(h),K=oo({key:y.key,value:y.value,valueSpec:y.styleSpec.function,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{stops:function(ue){if(w==="identity")return[new i.V(ue.key,ue.value,'identity function may not have a "stops" property')];let xe=[];const me=ue.value;return xe=xe.concat(_t({key:ue.key,value:me,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:re})),Array.isArray(me)&&me.length===0&&xe.push(new i.V(ue.key,me,"array must have at least one stop")),xe},default:function(ue){return ji({key:ue.key,value:ue.value,valueSpec:v,style:ue.style,styleSpec:ue.styleSpec})}}});return w==="identity"&&W&&K.push(new i.V(y.key,y.value,'missing required property "property"')),w==="identity"||h.stops||K.push(new i.V(y.key,y.value,'missing required property "stops"')),w==="exponential"&&v.expression&&!i.M(v)&&K.push(new i.V(y.key,y.value,"exponential functions not supported")),y.styleSpec.$version>=8&&(H&&!i.N(v)?K.push(new i.V(y.key,y.value,"property functions not supported")):W&&!i.O(v)&&K.push(new i.V(y.key,y.value,"zoom functions not supported"))),w!=="categorical"&&!Q||h.property!==void 0||K.push(new i.V(y.key,y.value,'"property" property is required')),K;function re(ue){let xe=[];const me=ue.value,Ee=ue.key;if(!Array.isArray(me))return[new i.V(Ee,me,`array expected, ${i.K(me)} found`)];if(me.length!==2)return[new i.V(Ee,me,`array length 2 expected, length ${me.length} found`)];if(Q){if(!i.H(me[0]))return[new i.V(Ee,me,`object expected, ${i.K(me[0])} found`)];const Ie=me[0];if(Ie.zoom===void 0)return[new i.V(Ee,me,"object stop key must have zoom")];if(Ie.value===void 0)return[new i.V(Ee,me,"object stop key must have value")];const Ae=i.J(Ie.zoom);if(typeof Ae!="number")return[new i.V(Ee,Ie.zoom,"stop zoom values must be numbers")];if(D&&D>Ae)return[new i.V(Ee,Ie.zoom,"stop zoom values must appear in ascending order")];Ae!==D&&(D=Ae,O=void 0,z={}),xe=xe.concat(oo({key:`${Ee}[0]`,value:me[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Mt,value:le}}))}else xe=xe.concat(le({key:`${Ee}[0]`,value:me[0],style:ue.style,styleSpec:ue.styleSpec},me));return i.Q(i.S(me[1]))?xe.concat([new i.V(`${Ee}[1]`,me[1],"expressions are not allowed in function stops.")]):xe.concat(ji({key:`${Ee}[1]`,value:me[1],valueSpec:v,style:ue.style,styleSpec:ue.styleSpec}))}function le(ue,xe){const me=i.K(ue.value),Ee=i.J(ue.value),Ie=ue.value!==null?ue.value:xe;if(P){if(me!==P)return[new i.V(ue.key,Ie,`${me} stop domain type must match previous stop domain type ${P}`)]}else P=me;if(me!=="number"&&me!=="string"&&me!=="boolean"&&typeof Ee!="number"&&typeof Ee!="string"&&typeof Ee!="boolean")return[new i.V(ue.key,Ie,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&w!=="categorical"){let Ae=`number expected, ${me} found`;return i.N(v)&&w===void 0&&(Ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(ue.key,Ie,Ae)]}return w!=="categorical"||me!=="number"||typeof Ee=="number"&&isFinite(Ee)&&Math.floor(Ee)===Ee?w!=="categorical"&&me==="number"&&typeof Ee=="number"&&typeof O=="number"&&O!==void 0&&Ee<O?[new i.V(ue.key,Ie,"stop domain values must appear in ascending order")]:(O=Ee,w==="categorical"&&Ee in z?[new i.V(ue.key,Ie,"stop domain values must be unique")]:(z[Ee]=!0,[])):[new i.V(ue.key,Ie,`integer expected, found ${String(Ee)}`)]}}function at(y){const s=(y.expressionContext==="property"?i.W:i.U)(i.S(y.value),y.valueSpec);if(s.result==="error")return s.value.map(v=>new i.V(`${y.key}${v.key}`,y.value,v.message));const h=s.value.expression||s.value._styleExpression.expression;if(y.expressionContext==="property"&&y.propertyKey==="text-font"&&!h.outputDefined())return[new i.V(y.key,y.value,`Invalid data expression for "${y.propertyKey}". Output values must be contained as literals within the expression.`)];if(y.expressionContext==="property"&&y.propertyType==="layout"&&!i.Z(h))return[new i.V(y.key,y.value,'"feature-state" data expressions are not supported with layout properties.')];if(y.expressionContext==="filter")return dt(h,y);if(y.expressionContext==="appearance")return tr(h,y);if(y.expressionContext&&y.expressionContext.indexOf("cluster")===0){if(!i.X(h,["zoom","feature-state"]))return[new i.V(y.key,y.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(y.expressionContext==="cluster-initial"&&!i.Y(h))return[new i.V(y.key,y.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dt(y,s){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const w of s.valueSpec.expression.parameters)h.delete(w);if(h.size===0)return[];const v=[];return y instanceof i._&&h.has(y.name)?[new i.V(s.key,s.value,`["${y.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(y.eachChild(w=>{v.push(...dt(w,s))}),v)}function tr(y,s){const h=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const w of s.valueSpec.expression.parameters)h.add(w);if(h.size===0)return[];const v=[];return y instanceof i._&&!h.has(y.name)?[new i.V(s.key,s.value,`["${y.name}"] is not an allowed parameter`)]:(y.eachChild(w=>{v.push(...tr(w,s))}),v)}function Qt(y){const s=y.key,h=y.value,v=y.valueSpec,w=[];return Array.isArray(v.values)?v.values.indexOf(i.J(h))===-1&&w.push(new i.V(s,h,`expected one of [${v.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(v.values).indexOf(i.J(h))===-1&&w.push(new i.V(s,h,`expected one of [${Object.keys(v.values).join(", ")}], ${JSON.stringify(h)} found`)),w}function er(y){return i.a2(i.S(y.value))?at(Object.assign({},y,{expressionContext:"filter",valueSpec:y.styleSpec[`filter_${y.layerType||"fill"}`]})):Pr(y)}function Pr(y){const s=y.value,h=y.key;if(!Array.isArray(s))return[new i.V(h,s,`array expected, ${i.K(s)} found`)];if(s.length<1)return[new i.V(h,s,"filter array must have at least 1 element")];const v=y.styleSpec;let w=Qt({key:`${h}[0]`,value:s[0],valueSpec:v.filter_operator});switch(i.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&i.J(s[1])==="$type"&&w.push(new i.V(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&w.push(new i.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(i.a0(s[1])||w.push(new i.V(`${h}[1]`,s[1],`string expected, ${i.K(s[1])} found`)));for(let P=2;P<s.length;P++)i.J(s[1])==="$type"?w=w.concat(Qt({key:`${h}[${P}]`,value:s[P],valueSpec:v.geometry_type})):i.a0(s[P])||i.L(s[P])||i.$(s[P])||w.push(new i.V(`${h}[${P}]`,s[P],`string, number, or boolean expected, ${i.K(s[P])} found.`));break;case"any":case"all":case"none":for(let P=1;P<s.length;P++)w=w.concat(Pr({key:`${h}[${P}]`,value:s[P],style:y.style,styleSpec:y.styleSpec}));break;case"has":case"!has":s.length!==2?w.push(new i.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):i.a0(s[1])||w.push(new i.V(`${h}[1]`,s[1],`string expected, ${i.K(s[1])} found`))}return w}function sn(y,s){const h=y.key,v=y.style,w=y.layer,P=y.styleSpec,O=y.value,D=y.objectKey,z=P[`${s}_${y.layerType}`];if(!z)return[];const W=D.match(/^(.*)-use-theme$/);if(W&&z[W[1]])return i.Q(i.S(O))?[].concat(ji({key:h,value:O,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:v,styleSpec:P,expressionContext:"property",propertyType:s,propertyKey:D})):ji({key:h,value:O,valueSpec:{type:"string"},style:v,styleSpec:P});const H=D.match(/^(.*)-transition$/);if(s==="paint"&&H&&z[H[1]]&&z[H[1]].transition)return ji({key:h,value:O,valueSpec:P.transition,style:v,styleSpec:P});const Q=y.valueSpec||z[D];if(!Q)return[new i.a3(h,O,`unknown property "${D}"`)];let K;if(i.a0(O)&&i.N(Q)&&!Q.tokens&&(K=/^{([^}]+)}$/.exec(O))){const le=`\`{ "type": "identity", "property": ${K?JSON.stringify(K[1]):'"_"'} }\``;return[new i.V(h,O,`"${D}" does not support interpolation syntax
Use an identity property function instead: ${le}.`)]}const re=[];if(y.layerType==="symbol")D!=="text-field"||!v||v.glyphs||v.imports||re.push(new i.V(h,O,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&i.a4(i.S(O))&&i.J(O.type)==="identity"&&re.push(new i.V(h,O,'"text-font" does not support identity functions'));else if(y.layerType==="model"&&s==="paint"&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&i.N(Q)&&(i.a5(Q)||i.O(Q))){const le=i.W(i.S(O),Q).value,ue="expression"in le&&le.expression||"_styleExpression"in le&&le._styleExpression&&le._styleExpression.expression;ue&&!i.X(ue,["measure-light"])&&(D==="model-emissive-strength"&&i.Y(ue)&&i.Z(ue)||re.push(new i.V(h,O,`${D} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return re.concat(ji({key:y.key,value:O,valueSpec:Q,style:v,styleSpec:P,expressionContext:"property",propertyType:s,propertyKey:D}))}function fn(y){return sn(y,"paint")}function Ai(y){return sn(y,"layout")}function mi(y){let s=[];const h=y.value,v=y.key,w=y.style,P=y.styleSpec;if(!i.H(h))return[new i.V(v,h,"object expected")];h.type||h.ref||s.push(new i.V(v,h,'either "type" or "ref" is required'));let O=i.J(h.type);const D=i.J(h.ref);if(h.id){const z=i.J(h.id);for(let W=0;W<y.arrayIndex;W++){const H=w.layers[W];i.J(H.id)===z&&s.push(new i.V(v,h.id,`duplicate layer id "${z}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let z;["type","source","source-layer","filter","layout"].forEach(W=>{W in h&&s.push(new i.V(v,h[W],`"${W}" is prohibited for ref layers`))}),w.layers.forEach(W=>{i.J(W.id)===D&&(z=W)}),z?z.ref?s.push(new i.V(v,h.ref,"ref cannot reference another ref layer")):O=i.J(z.type):typeof D=="string"&&s.push(new i.V(v,h.ref,`ref layer "${D}" not found`))}else if(O!=="background"&&O!=="sky"&&O!=="slot")if(h.source)if(i.a0(h.source)){const z=w.sources&&w.sources[h.source],W=z&&i.J(z.type);z?W==="vector"&&O==="raster"?s.push(new i.V(v,h.source,`layer "${h.id}" requires a raster source`)):W==="raster"&&O!=="raster"?s.push(new i.V(v,h.source,`layer "${h.id}" requires a vector source`)):W!=="vector"||h["source-layer"]?W==="raster-dem"&&O!=="hillshade"?s.push(new i.V(v,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):W!=="raster-array"||["raster","raster-particle"].includes(O)?O==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&W==="geojson"&&!z.lineMetrics?s.push(new i.V(v,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):O==="raster-particle"&&W!=="raster-array"&&s.push(new i.V(v,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new i.V(v,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new i.V(v,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new i.V(v,h.source,`source "${h.source}" not found`))}else s.push(new i.V(`${v}.source`,h.source,'"source" must be a string'));else s.push(new i.V(v,h,'missing required property "source"'));return s=s.concat(oo({key:v,value:h,valueSpec:P.layer,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${v}.type`,value:h.type,valueSpec:P.layer.type,style:y.style,styleSpec:y.styleSpec,object:h,objectKey:"type"}),filter:z=>er(Object.assign({layerType:O},z)),layout:z=>oo({layer:h,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":W=>Ai(Object.assign({layerType:O},W))}}),paint:z=>oo({layer:h,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":W=>fn(Object.assign({layerType:O,layer:h},W))}}),appearances(z){const W=_t({key:z.key,value:z.value,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:K=>function(re){const{key:le,layer:ue,layerType:xe}=re,me=i.J(re.value),Ee=i.J(me.name),Ie=i.J(me.condition),Ae=oo({key:le,value:me,valueSpec:re.styleSpec.appearance,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{condition:Be=>function(Re){const Ve=[];return Ve.push(...at({key:Re.key,value:Re.object.condition,valueSpec:i.a6.appearance.condition,expressionContext:"appearance"})),Ve}(Object.assign({layer:ue,layerType:xe},Be)),properties:Be=>function(Re){const Ve=[],{styleSpec:Fe,layer:Me,layerType:qe}=Re,ot=Fe[`paint_${qe}`],rt=Fe[`layout_${qe}`],wt=Re.object[Re.objectKey];for(const pt in wt){const Ot=pt in ot?"paint":pt in rt?"layout":void 0;if(!Ot){Ve.push(new i.V(Re.key,pt,`unknown property "${pt}" for layer type "${qe}"`));continue}const Kt=Object.assign({},Re,{key:`${Re.key}.${pt}`,object:wt,objectKey:pt,layer:Me,layerType:qe,value:wt[pt],valueSpec:Ot==="paint"?ot[pt]:rt[pt]});Ve.push(...sn(Kt,Ot))}return Ve}(Object.assign({layer:ue,layerType:xe},Be))}});return Ee!=="hidden"&&Ie===void 0&&Ae.push(new i.V(re.key,"name",'Appearance with name different than "hidden" must have a condition')),Ae}(Object.assign({layerType:O,layer:h},K))}),H=Array.isArray(z.value)?z.value:[],Q=new Set;return H.forEach((K,re)=>{const le=i.J(K.name);if(le)if(Q.has(le)){const ue=i.J(h.id);W.push(new i.V(z.key,le,`Duplicated appearance name "${le}" for layer "${ue}"`))}else Q.add(le)}),W}}})),s}function Zi({key:y,value:s}){return i.a0(s)?[]:[new i.V(y,s,`string expected, ${i.K(s)} found`)]}const Rs={promoteId:function y({key:s,value:h}){if(i.a0(h))return Zi({key:s,value:h});if(Array.isArray(h)){const w=[],P=i.S(h),O=i.U(P);return O.result==="error"&&O.value.forEach(D=>{w.push(new i.V(`${s}${D.key}`,null,`${D.message}`))}),i.X(O.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||w.push(new i.V(`${s}`,null,"promoteId expression should be only feature dependent")),w}if(!i.H(h))return[new i.V(s,h,`string, expression or object expected, "${i.K(h)}" found`)];const v=[];for(const w in h)v.push(...y({key:`${s}.${w}`,value:h[w]}));return v}};function Ua(y){const s=y.value,h=y.key,v=y.styleSpec,w=y.style;if(!i.H(s))return[new i.V(h,s,`object expected, ${i.K(s)} found`)];if(!("type"in s))return[new i.V(h,s,'"type" is required')];const P=i.J(s.type);let O=[];switch(["vector","raster","raster-dem","raster-array"].includes(P)&&("url"in s||"tiles"in s||O.push(new i.a3(h,s,'Either "url" or "tiles" is required.'))),P){case"vector":case"raster":case"raster-dem":case"raster-array":return O=O.concat(oo({key:h,value:s,valueSpec:v[`source_${P.replace("-","_")}`],style:y.style,styleSpec:v,objectElementValidators:Rs})),O;case"geojson":if(O=oo({key:h,value:s,valueSpec:v.source_geojson,style:w,styleSpec:v,objectElementValidators:Rs}),"cluster"in s&&"clusterProperties"in s){if(!i.H(s.clusterProperties))return[new i.V(`${h}.clusterProperties`,s,`object expected, ${i.K(s)} found`)];for(const D in s.clusterProperties){const z=s.clusterProperties[D];if(!Array.isArray(z))return[new i.V(`${h}.clusterProperties.${D}`,z,"array expected")];const[W,H]=z,Q=typeof W=="string"?[W,["accumulated"],["get",D]]:W;O.push(...at({key:`${h}.${D}.map`,value:H,expressionContext:"cluster-map"})),O.push(...at({key:`${h}.${D}.reduce`,value:Q,expressionContext:"cluster-reduce"}))}}return O;case"video":return oo({key:h,value:s,valueSpec:v.source_video,style:w,styleSpec:v});case"image":return oo({key:h,value:s,valueSpec:v.source_image,style:w,styleSpec:v});case"canvas":return[new i.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qt({key:`${h}.type`,value:s.type,valueSpec:{values:wi(v)}})}}function wi(y){return y.source.reduce((s,h)=>{const v=y[h];return v.type.type==="enum"&&(s=s.concat(Object.keys(v.type.values||{}))),s},[])}function _s(y){const s=y.value,h=y.styleSpec,v=h.light,w=y.style;if(s===void 0)return[];if(!i.H(s))return[new i.V("light",s,`object expected, ${i.K(s)} found`)];let P=[];for(const O in s){const D=O.match(/^(.*)-transition$/),z=O.match(/^(.*)-use-theme$/);P=P.concat(z&&v[z[1]]?ji({key:O,value:s[O],valueSpec:{type:"string"},style:w,styleSpec:h}):D&&v[D[1]]&&v[D[1]].transition?ji({key:O,value:s[O],valueSpec:h.transition,style:w,styleSpec:h}):v[O]?ji({key:O,value:s[O],valueSpec:v[O],style:w,styleSpec:h}):[new i.V(O,s[O],`unknown property "${O}"`)])}return P}function zo(y){const s=y.value;if(!s)return[];const h=y.key;if(!i.H(s))return[new i.V(h,s,`object expected, ${i.K(s)} found`)];let v=[];const w=y.styleSpec,P=w["light-3d"],O=y.style,D=y.style.lights;for(const H of["type","id"])if(!(H in s))return v=v.concat([new i.V(h,s,`missing property "${H}"`)]),v;if(!i.a0(s.type))return v=v.concat([new i.V(`${h}.type`,s.type,"string expected")]),v;if(D)for(let H=0;H<y.arrayIndex;H++){const Q=i.J(s.type),K=D[H];i.J(K.type)===Q&&v.push(new i.V(h,s.id,`duplicate light type "${s.type}", previously defined at line ${K.id.__line__}`))}const z=`properties_light_${s.type}`;if(!(z in w))return v=v.concat([new i.V(`${h}.type`,s,`Invalid light type ${s.type}`)]),v;const W=w[z];for(const H in s)if(H==="properties"){const Q=s[H];if(!i.H(Q))return v=v.concat([new i.V("properties",Q,`object expected, ${i.K(Q)} found`)]),v;for(const K in Q){const re=K.match(/^(.*)-transition$/),le=K.match(/^(.*)-use-theme$/);v=v.concat(le&&W[le[1]]?ji({key:H,value:Q[K],valueSpec:{type:"string"},style:O,styleSpec:w}):re&&W[re[1]]&&W[re[1]].transition?ji({key:H,value:s[H],valueSpec:w.transition,style:O,styleSpec:w}):W[K]?ji({key:K,value:Q[K],valueSpec:W[K],style:O,styleSpec:w}):[new i.a3(y.key,Q[K],`unknown property "${K}"`)])}}else v=v.concat(P[H]?ji({key:H,value:s[H],valueSpec:P[H],style:O,styleSpec:w}):[new i.a3(H,s[H],`unknown property "${H}"`)]);return v}function js(y){const s=y.value,h=y.key,v=y.style,w=y.styleSpec,P=w.terrain;if(s==null)return[];if(!i.H(s))return[new i.V("terrain",s,`object expected, ${i.K(s)} found`)];let O=[];for(const D in s){const z=D.match(/^(.*)-transition$/),W=D.match(/^(.*)-use-theme$/);O=O.concat(W&&P[W[1]]?ji({key:D,value:s[D],valueSpec:{type:"string"},style:v,styleSpec:w}):z&&P[z[1]]&&P[z[1]].transition?ji({key:D,value:s[D],valueSpec:w.transition,style:v,styleSpec:w}):P[D]?ji({key:D,value:s[D],valueSpec:P[D],style:v,styleSpec:w}):[new i.a3(D,s[D],`unknown property "${D}"`)])}if(s.source)if(i.a0(s.source)){const D=v.sources&&v.sources[s.source],z=D&&i.J(D.type);D?z!=="raster-dem"&&O.push(new i.V(`${h}.source`,s.source,`terrain cannot be used with a source of type ${z}, it only be used with a "raster-dem" source type`)):O.push(new i.V(`${h}.source`,s.source,`source "${s.source}" not found`))}else O.push(new i.V(`${h}.source`,s.source,"source must be a string"));else O.push(new i.V(h,s,'terrain is missing required property "source"'));return O}function Bo(y){const s=y.value,h=y.style,v=y.styleSpec,w=v.fog;if(s===void 0)return[];if(!i.H(s))return[new i.V("fog",s,`object expected, ${i.K(s)} found`)];let P=[];for(const O in s){const D=O.match(/^(.*)-transition$/),z=O.match(/^(.*)-use-theme$/);P=P.concat(z&&w[z[1]]?ji({key:O,value:s[O],valueSpec:{type:"string"},style:h,styleSpec:v}):D&&w[D[1]]&&w[D[1]].transition?ji({key:O,value:s[O],valueSpec:v.transition,style:h,styleSpec:v}):w[O]?ji({key:O,value:s[O],valueSpec:w[O],style:h,styleSpec:v}):[new i.a3(O,s[O],`unknown property "${O}"`)])}return P}const ts={"*":()=>[],array:_t,boolean:function(y){const s=y.value,h=y.key;return i.$(s)?[]:[new i.V(h,s,`boolean expected, ${i.K(s)} found`)]},number:Mt,color:function({key:y,value:s}){return i.a0(s)?i.a1.parseCSSColor(s)===null?[new i.V(y,s,`color expected, "${s}" found`)]:[]:[new i.V(y,s,`color expected, ${i.K(s)} found`)]},enum:Qt,filter:er,function:Ke,layer:mi,object:oo,source:Ua,model:i.a7,light:_s,"light-3d":zo,terrain:js,fog:Bo,string:Zi,formatted:function(y){return Zi(y).length===0?[]:at(y)},resolvedImage:function(y){return Zi(y).length===0?[]:at(y)},projection:function(y){const s=y.value,h=y.styleSpec,v=h.projection,w=y.style;if(i.H(s)){let P=[];for(const O in s)P=P.concat(ji({key:O,value:s[O],valueSpec:v[O],style:w,styleSpec:h}));return P}return i.a0(s)?[]:[new i.V("projection",s,`object or string expected, ${i.K(s)} found`)]},import:function(y){const s=y.key,{value:h,styleSpec:v}=y;if(!i.H(h))return[new i.V(s,h,"import must be an object")];const{data:w,...P}=h;Object.defineProperty(P,"__line__",{value:h.__line__,enumerable:!1});let O=oo(Object.assign({},y,{value:P,valueSpec:v.import}));return i.J(P.id)===""&&O.push(new i.V(`${y.key}.id`,P,"import id can't be an empty string")),w&&(O=O.concat(xr(w,v,{key:`${y.key}.data`}))),O},iconset:function(y){const s=y.value,h=y.key,v=y.styleSpec,w=y.style;if(!i.H(s))return[new i.V(h,s,"object expected")];if(!s.type)return[new i.V(h,s,'"type" is required')];const P=i.J(s.type);let O=[];if(O=O.concat(oo({key:h,value:s,valueSpec:v[`iconset_${P}`],style:w,styleSpec:v})),function(D,z){return!(D!=="source"||!z.source)}(P,s)){const D=w.sources&&w.sources[s.source],z=D&&i.J(D.type);D?z!=="raster-array"&&O.push(new i.V(h,s.source,`iconset cannot be used with a source of type ${String(z)}, it only be used with a "raster-array" source type`)):O.push(new i.V(h,s.source,`source "${s.source}" not found`))}return O}};function ji(y,s=!1){const h=y.value,v=y.valueSpec,w=y.styleSpec;if(v.expression){if(i.a4(i.J(h)))return Ke(y);if(i.Q(i.S(h)))return at(y)}if(v.type&&ts[v.type]){const P=ts[v.type](y);return s===!0&&P.length>0&&Array.isArray(y.value)?at(y):P}return oo(Object.assign({},y,{valueSpec:v.type?w[v.type]:v}))}function oo(y){const s=y.key,h=y.value,v=y.valueSpec||{},w=y.objectElementValidators||{},P=y.style,O=y.styleSpec;if(!i.H(h))return[new i.V(s,h,`object expected, ${i.K(h)} found`)];let D=[];for(const z in h){const W=z.split(".")[0];let H;w[W]?H=w[W]:v[W]?H=ji:w["*"]?H=w["*"]:v["*"]&&(H=ji),H?D=D.concat(H({key:(s&&`${s}.`)+z,value:h[z],valueSpec:v[W]||v["*"],style:P,styleSpec:O,object:h,objectKey:z},h)):D.push(new i.a3(s,h[z],`unknown property "${z}"`))}for(const z in v){if(w[z])continue;const W=v[z];W.required&&W.default===void 0&&h[z]===void 0&&D.push(new i.V(s,h,`missing required property "${z}"`))}return D}function ml({key:y,value:s}){const h=Zi({key:y,value:s});if(h.length)return h;const v=s;return v.indexOf("{fontstack}")===-1&&h.push(new i.V(y,s,'"glyphs" url must include a "{fontstack}" token')),v.indexOf("{range}")===-1&&h.push(new i.V(y,s,'"glyphs" url must include a "{range}" token')),h}function xr(y,s=i.a6,h={}){return oo({key:h.key||"",value:y,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:y,objectElementValidators:{glyphs:ml}})}function wn(y,s=i.a6){return st(xr(y,s))}const On=y=>st(Ua(y)),Ii=y=>st(_s(y)),ha=y=>st(zo(y)),$o=y=>st(js(y)),Nt=y=>st(Bo(y)),Uo=y=>st(function(s){const h=s.value,v=s.style,w=s.styleSpec,P=w.snow;if(h===void 0)return[];if(!i.H(h))return[new i.V("snow",h,`object expected, ${i.K(h)} found`)];let O=[];for(const D in h){const z=D.match(/^(.*)-transition$/);O=O.concat(z&&P[z[1]]&&P[z[1]].transition?ji({key:D,value:h[D],valueSpec:w.transition,style:v,styleSpec:w}):P[D]?ji({key:D,value:h[D],valueSpec:P[D],style:v,styleSpec:w}):[new i.a3(D,h[D],`unknown property "${D}"`)])}return O}(y)),gl=y=>st(function(s){const h=s.value,v=s.style,w=s.styleSpec,P=w.rain;if(h===void 0)return[];if(!i.H(h))return[new i.V("rain",h,`object expected, ${i.K(h)} found`)];let O=[];for(const D in h){const z=D.match(/^(.*)-transition$/);O=O.concat(z&&P[z[1]]&&P[z[1]].transition?ji({key:D,value:h[D],valueSpec:w.transition,style:v,styleSpec:w}):P[D]?ji({key:D,value:h[D],valueSpec:P[D],style:v,styleSpec:w}):[new i.a3(D,h[D],`unknown property "${D}"`)])}return O}(y)),rs=y=>st(mi(y)),xn=y=>st(er(y)),ns=y=>st(fn(y)),Gb=y=>st(Ai(y)),dg=y=>st(i.a7(y));function st(y){return y.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function pe(y,s){let h=!1;if(s&&s.length)for(const v of s)v instanceof i.a3?i.w(v.message):(y.fire(new i.y(new Error(v.message))),h=!0);return h}const ve=i.a6.light;let Ne;class Ye extends i.E{constructor(s,h="flat"){super(),this._transitionable=new i.a8(Ne||(Ne=new i.a9({anchor:new i.aa(ve.anchor),position:new i.ab(ve.position),color:new i.aa(ve.color),intensity:new i.aa(ve.intensity)}))),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,v={}){this._validate(Ii,s,v)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||v.validate!==!1)&&pe(this,s.call(wn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}const Ze=i.a6.terrain;let nt=class extends i.E{constructor(y,s,h,v,w){super(),this.scope=h,this._transitionable=new i.a8(new i.a9({source:new i.aa(Ze.source),exaggeration:new i.aa(Ze.exaggeration)}),h,v),this._transitionable.setTransitionOrValue(y,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=w}get(){return this._transitionable.serialize()}set(y,s){this._transitionable.setTransitionOrValue(y,s)}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}getExaggeration(y){return this._transitioning.possiblyEvaluate(new i.ac(y,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const y=this._transitionable._values.exaggeration;if(!y)return null;const s=y.value.expression;if(!s)return null;let h=-1,v=-1,w=1;for(const P of s.zoomStops)w=s.evaluate(new i.ac(P,{worldview:this.worldview})),w>.01?(h=P,v=-1):v=P;return w<.01&&h>0&&v>h?[h,v]:null}isZoomDependent(){const y=this._transitionable._values.exaggeration;return y!=null&&y.value!=null&&y.value.expression!=null&&y.value.expression instanceof i.ad}};const vt=45,it=65,gt=.05;function Ht(y,s,h,v){const w=i.ah(vt,it,h),[P,O]=zt(y,v);let D=1-Math.min(1,Math.exp((s-P)/(O-P)*-6));return D*=D*D,D=Math.min(1,1.00747*D),D*w*y.alpha}function zt(y,s){const h=.5/Math.tan(.5*s);return[y.range[0]+h,y.range[1]+h]}function Tr(y,s,h,v,w){const P=i.af([],[s,h,v],w.mercatorFogMatrix);return Ht(y,i.ag(P),w.pitch,w._fov)}function Gr(y,s,h,v,w,P,O){const D=[[h,v,0],[w,v,0],[w,P,0],[h,P,0]];let z=Number.MAX_VALUE,W=-Number.MAX_VALUE;for(const H of D){const Q=i.af([],H,s),K=i.ag(Q);z=Math.min(z,K),W=Math.max(W,K)}return[Ht(y,z,O.pitch,O._fov),Ht(y,W,O.pitch,O._fov)]}const Ur=i.a6.fog;class kr extends i.E{constructor(s,h,v,w){super();const P=new i.a9({range:new i.aa(Ur.range),color:new i.aa(Ur.color),"color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.aa(Ur["high-color"]),"high-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.aa(Ur["space-color"]),"space-color-use-theme":new i.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.aa(Ur["horizon-blend"]),"star-intensity":new i.aa(Ur["star-intensity"]),"vertical-range":new i.aa(Ur["vertical-range"])});this._transitionable=new i.a8(P,v,new Map(w)),this.set(s,w),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new i.ai(P),this.scope=v}get state(){const s=this._transform,h=s.projection.name==="globe",v=i.aj(s.zoom),w=this.properties.get("range"),P=[.5,3];return{range:h?[i.ak(P[0],w[0],v),i.ak(P[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,v={}){if(this._validate(Nt,s,v))return;const w=Object.assign({},s);for(const P of Object.keys(Ur))w[P]===void 0&&(w[P]=Ur[P].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ah(vt,it,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(v,w,P){const O=i.ae.fromLngLat(w),D=P.elevation?P.elevation.getAtPointOrZero(O):0;return Tr(v,O.x,O.y,D,P)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Gr(this.state,h,0,0,i.al,i.al,this._transform)}getOpacityForBounds(s,h,v,w,P){return this._transform.projection.supportsFog?Gr(this.state,s,h,v,w,P,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?zt(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const v of h){const w=s.points[v];let P;if(w[2]>=0)P=w;else{const O=s.points[v-4];P=i.am(O,w,O[2]/(O[2]-w[2]))}if(Tr(this.state,P[0],P[1],0,this._transform)>=gt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,v){return(!v||v.validate!==!1)&&pe(this,s.call(wn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}}let gn,Sn,fi,sa,Fa=class extends i.E{constructor(y,s,h,v){super();const w=gn||(gn=new i.a9({density:new i.aa(i.a6.snow.density),intensity:new i.aa(i.a6.snow.intensity),color:new i.aa(i.a6.snow.color),opacity:new i.aa(i.a6.snow.opacity),vignette:new i.aa(i.a6.snow.vignette),"vignette-color":new i.aa(i.a6.snow["vignette-color"]),"center-thinning":new i.aa(i.a6.snow["center-thinning"]),direction:new i.aa(i.a6.snow.direction),"flake-size":new i.aa(i.a6.snow["flake-size"])}));this._transitionable=new i.a8(w,h,new Map(v)),this.set(y,v),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(w),this.scope=h}get state(){const y=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),v=i.an(h[0]),w=-Math.max(i.an(h[1]),.01),P=[Math.cos(v)*Math.cos(w),Math.sin(v)*Math.cos(w),Math.sin(w)],O=this.properties.get("vignette"),D=this.properties.get("vignette-color");return D.a=O,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*y),direction:P,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:D}}get(){return this._transitionable.serialize()}set(y,s,h={}){if(this._validate(Uo,y,h))return;const v=Object.assign({},y),w=i.a6.snow;for(const P of Object.keys(w))v[P]===void 0&&(v[P]=w[P].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,s,h){return(!h||h.validate!==!1)&&pe(this,y.call(wn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}},Sa=class extends i.E{constructor(y,s,h,v){super();const w=Sn||(Sn=new i.a9({density:new i.aa(i.a6.rain.density),intensity:new i.aa(i.a6.rain.intensity),color:new i.aa(i.a6.rain.color),opacity:new i.aa(i.a6.rain.opacity),vignette:new i.aa(i.a6.rain.vignette),"vignette-color":new i.aa(i.a6.rain["vignette-color"]),"center-thinning":new i.aa(i.a6.rain["center-thinning"]),direction:new i.aa(i.a6.rain.direction),"droplet-size":new i.aa(i.a6.rain["droplet-size"]),"distortion-strength":new i.aa(i.a6.rain["distortion-strength"])}));this._transitionable=new i.a8(w,h,new Map(v)),this.set(y,v),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.ai(w),this.scope=h}get state(){const y=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),v=i.an(h[0]),w=-Math.max(i.an(h[1]),.01),P=[Math.cos(v)*Math.cos(w),Math.sin(v)*Math.cos(w),Math.sin(w)],O=this.properties.get("vignette-color");return O.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.ao(s.r,s.g,s.b,s.a*y),direction:P,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:O}}get(){return this._transitionable.serialize()}set(y,s,h={}){if(this._validate(gl,y,h))return;const v=Object.assign({},y),w=i.a6.rain;for(const P of Object.keys(w))v[P]===void 0&&(v[P]=w[P].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(y){this._transitionable.setTransitionOrValue(this._options,new Map(y))}updateTransitions(y){this._transitioning=this._transitionable.transitioned(y,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(y){this.properties=this._transitioning.possiblyEvaluate(y)}_validate(y,s,h){return(!h||h.validate!==!1)&&pe(this,y.call(wn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a6})))}};class _a extends i.E{constructor(s,h,v,w){super(),this.scope=v,this._options=s,this.properties=new i.ai(h),this._transitionable=new i.a8(h,v,new Map(w)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class li{constructor(s,h,v){this.screenBounds=s,this.cameraPoint=v.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,h){let v,w;if(s instanceof i.P||typeof s[0]=="number"){const P=i.P.convert(s);v=[P],w=h.isPointAboveHorizon(P)}else{const P=i.P.convert(s[0]),O=i.P.convert(s[1]),D=P.add(O)._div(2);v=[P,O],w=i.aq(P,O).every(z=>h.isPointAboveHorizon(z))&&h.isPointAboveHorizon(D)}return new li(v,w,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return i.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.aq(h,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(w[3]=this.cameraPoint)),i.ar(w,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],w=i.aq(h,v,s),P=this.cameraPoint.clone();switch(3*((P.y>h.y)+(P.y>v.y))+((P.x>h.x)+(P.x>v.x))){case 0:w[0]=P,w[4]=P.clone();break;case 1:w.splice(1,0,P);break;case 2:w[1]=P;break;case 3:w.splice(4,0,P);break;case 5:w.splice(2,0,P);break;case 6:w[3]=P;break;case 7:w.splice(3,0,P);break;case 8:w[2]=P}return w}containsTile(s,h,v,w=0){const P=Math.max(s.queryPadding,s.evaluateQueryRenderedFeaturePadding())/h._pixelsPerMercatorPixel+1,O=v?this._bufferedCameraMercator(P,h):this._bufferedScreenMercator(P,h);let D=s.tileID.wrap+(O.unwrapped?w:0);const z=O.polygon.map(xe=>i.as(s.tileTransform,xe,D));if(!i.at(z,0,0,i.al,i.al))return;D=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const W=this.screenGeometryMercator.polygon.map(xe=>i.au(s.tileTransform,xe,D)),H=W.map(xe=>new i.P(xe[0],xe[1])),Q=h.getFreeCameraOptions().position||new i.ae(0,0,0),K=i.au(s.tileTransform,Q,D),re=W.map(xe=>{const me=i.av(xe,xe,K);return i.aw(me,me),new i.ax(K,me)}),le=i.ay(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:re,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(ue=i.az(z),ue.min.x=i.aA(ue.min.x,0,i.al),ue.min.y=i.aA(ue.min.y,0,i.al),ue.max.x=i.aA(ue.max.x,0,i.al),ue.max.y=i.aA(ue.max.y,0,i.al),ue),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:le};var ue}_bufferedScreenMercator(s,h){const v=na(s);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(P=>h.pointCoordinate3D(P)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(s,h){const v=na(s);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(P=>h.pointCoordinate3D(P)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(s,h){const v=function(P,O){const D=i.aB([],O.pixelMatrix,O.globeMatrix),z=[0,-i.aD,0,1],W=[0,i.aD,0,1],H=[0,0,0,1];i.aC(z,z,D),i.aC(W,W,D),i.aC(H,H,D);const Q=new i.P(z[0]/z[3],z[1]/z[3]),K=new i.P(W[0]/W[3],W[1]/W[3]),re=i.aE(P,Q)&&z[3]<H[3],le=i.aE(P,K)&&W[3]<H[3];if(!re&&!le)return null;const ue=function(Ve,Fe,Me){for(let qe=1;qe<Ve.length;qe++){const ot=Li(Fe.pointCoordinate3D(Ve[qe-1]).x),rt=Li(Fe.pointCoordinate3D(Ve[qe]).x);if(Me<0){if(ot<rt)return{idx:qe,t:-ot/(rt-1-ot)}}else if(rt<ot)return{idx:qe,t:(1-ot)/(rt+1-ot)}}return null}(P,O,re?-1:1);if(!ue)return null;const{idx:xe,t:me}=ue;let Ee=xe>1?Rn(P.slice(0,xe),O):[],Ie=xe<P.length?Rn(P.slice(xe),O):[];Ee=Ee.map(Ve=>new i.P(Li(Ve.x),Ve.y)),Ie=Ie.map(Ve=>new i.P(Li(Ve.x),Ve.y));const Ae=[...Ee];Ae.length===0&&Ae.push(Ie[Ie.length-1]);const Be=i.ak(Ae[Ae.length-1].y,(Ie.length===0?Ee[0]:Ie[0]).y,me);let Re;return Re=re?[new i.P(0,Be),new i.P(0,0),new i.P(1,0),new i.P(1,Be)]:[new i.P(1,Be),new i.P(1,1),new i.P(0,1),new i.P(0,Be)],Ae.push(...Re),Ie.length===0?Ae.push(Ee[0]):Ae.push(...Ie),{polygon:Ae.map(Ve=>new i.ae(Ve.x,Ve.y)),unwrapped:!1}}(s,h);if(v)return v;const w=function(P,O){let D=!1,z=-1/0,W=0;for(let Q=0;Q<P.length-1;Q++)P[Q].x>z&&(z=P[Q].x,W=Q);for(let Q=0;Q<P.length-1;Q++){const K=(W+Q)%(P.length-1),re=P[K],le=P[K+1];Math.abs(re.x-le.x)>.5&&(re.x<le.x?(re.x+=1,K===0&&(P[P.length-1].x+=1)):(le.x+=1,K+1===P.length-1&&(P[0].x+=1)),D=!0)}const H=i.aF(O.center.lng);return D&&H<Math.abs(H-1)&&P.forEach(Q=>{Q.x-=1}),{polygon:P,unwrapped:D}}(Rn(s,h).map(P=>new i.P(Li(P.x),P.y)),h);return{polygon:w.polygon.map(P=>new i.ae(P.x,P.y)),unwrapped:w.unwrapped}}}function Rn(y,s){return i.aG(y,h=>{const v=s.pointCoordinate3D(h);h.x=v.x,h.y=v.y},1/256)}function Li(y){return y<0?1+y%1:y%1}function na(y){return 100*y|0}function gi(y,s,h,v,w){const P=function(D,z){if(D)return w(D);if(z){if(y.url&&z.tiles&&y.tiles&&delete y.tiles,z.variants){if(!Array.isArray(z.variants))return w(new Error("variants must be an array"));for(const H of z.variants){if(H==null||typeof H!="object"||H.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(H.capabilities))return w(new Error("capabilities must be an array"));if(H.capabilities.length===1&&H.capabilities[0]==="meshopt"){z=Object.assign(z,H);break}}}const W=i.aH(Object.assign({},z,y),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);W.tiles=s.canonicalizeTileset(W,y.url),w(null,W)}},O=function(D,z,W){if(!D)return null;if(!z&&!W)return D;W=W||D.worldview_default;const H=Object.values(D.language||{});if(H.length===0)return null;const Q=Object.values(D.worldview||{});if(Q.length===0)return null;const K=H.every(le=>le===z),re=Q.every(le=>le===W);return K&&re?D:z in(D.language_options||{})||W in(D.worldview_options||{})?null:D.language_options&&D.worldview_options?D:null}(y.data,h,v);return O?i.o.frame(()=>P(null,O)):y.url?i.m(s.transformRequest(s.normalizeSourceURL(y.url,null,h,v),i.R.Source),P):i.o.frame(()=>{const{data:D,...z}=y;P(null,z)})}function Fi(y,s){const h=Math.pow(2,s.z),v=Math.floor(i.aF(y.getWest())*h),w=Math.floor(i.aJ(y.getNorth())*h),P=Math.ceil(i.aF(y.getEast())*h),O=Math.ceil(i.aJ(y.getSouth())*h);return s.x>=v&&s.x<P&&s.y>=w&&s.y<O}class Ja{constructor(s,h,v){this.bounds=s?i.aI.convert(this.validateBounds(s)):null,this.minzoom=h||0,this.maxzoom=v||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const h of s)this.extraBounds.push(i.aI.convert(this.validateBounds(h)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!Fi(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Fi(h,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const h=new Ja(s.bounds,s.minzoom,s.maxzoom);return h.addExtraBounds(s.extra_bounds),h}}class is extends i.E{constructor(s,h,v,w){if(super(),this.id=s,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,i.aH(h,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new i.aK}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map.getWorldview();this._tileJSONRequest=gi(this._options,this.map._requestManager,h,v,(w,P)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),v&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new i.y(w));else if(P){if(Object.assign(this,P),this.hasWorldviews=!!P.worldview_options,P.worldview_default&&(this.worldviewDefault=P.worldview_default),P.vector_layers){this.vectorLayers=P.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const O of P.vector_layers)this.vectorLayerIds.push(O.id),P.worldview&&P.worldview[O.source]&&this.localizableLayerIds.add(O.id)}this.tileBounds=Ja.fromTileJSON(P),ge(P.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(w)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,h){const v=s.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(v),P=this.map._requestManager.transformRequest(w,i.R.Tile),O=this.map.style?this.map.style.getLut(this.scope):null,D=O?{image:O.image.clone()}:null,z={request:P,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:D,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&i.h(v)&&(z.localizableLayerIds=this.localizableLayerIds),z.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",z,W.bind(this));else if(s.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",z,W.bind(this),void 0,!0);else{const H=i.aL.call({deduped:this._deduped},z,(Q,K)=>{if(Q||!K)W.call(this,Q);else{const re=i.aM(K.responseHeaders);z.data={cacheControl:re.cacheControl,expires:re.expires,rawData:K.rawData.slice(0)},s.actor&&s.actor.send("loadTile",z,W.bind(this),void 0,!0)}},!0);s.request={cancel:H}}function W(H,Q){return delete s.request,s.aborted?h(null):H&&H.status!==404?h(H):(Q&&Q.resourceTiming&&(s.resourceTiming=Q.resourceTiming),this.map._refreshExpiredTiles&&Q&&s.setExpiryData(Q),s.loadVectorData(Q,this.map.painter),i.aN(this.dispatcher),h(null,Q),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Xl extends i.E{constructor(s,h,v,w){super(),this.id=s,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},h),Object.assign(this,i.aH(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=gi(this._options,this.map._requestManager,null,h,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?this.fire(new i.y(v)):w&&(Object.assign(this,w),w.raster_layers&&(this.rasterLayers=w.raster_layers,this.rasterLayerIds=this.rasterLayers.map(P=>P.id)),this.tileBounds=Ja.fromTileJSON(w),ge(w.tiles),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(v)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const v=i.o.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);s.request=i.n(this.map._requestManager.transformRequest(w,i.R.Tile),(P,O,D)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(P)return s.state="errored",h(P);if(!O)return h(null);const z=i.aM(D);this.map._refreshExpiredTiles&&s.setExpiryData(z),s.setTexture(O,this.map.painter),s.state="loaded",i.aN(this.dispatcher),h(null)})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof i.T?(s.destroy(!0),s.texture&&s.texture instanceof i.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mh([y,s],h,v,{scaled:w=!0}={}){const{tileSize:P,buffer:O}=v,{x:D,y:z,z:W}=h;if(!isFinite(D)||!isFinite(z)||!isFinite(W))throw new Error("Invalid MRT header");const H=2**W,Q=H*i.aF(y),K=H*i.aJ(s);return function([re,le],ue,{scaled:xe=!0}={}){if(!ue)throw new Error("bandView is undefined");const{data:me,tileSize:Ee,buffer:Ie,offset:Ae,scale:Be,dimension:Re}=ue;if(re<-Ie||re>Ee+Ie||le<-Ie||le>Ee+Ie)throw new Error(`Point (${re}, ${le}) out of bounds for tileSize=${Ee}, buffer=${Ie}`);const Ve=(le+Ie)*(Ee+2*Ie)+(re+Ie);if(new Uint32Array(me.buffer)[Ve]===4294967295)return null;let Fe=[];Fe=xe?[]:new ue.data.constructor(Re);for(let Me=0;Me<Re;Me++)Fe[Me]=Math.round(1e12*(me[Re*Ve+Me]*Be+Ae))/1e12;return Fe}([Math.min(Math.max(-O,Math.floor((Q-D)*P)),P-1+O),Math.min(Math.max(-O,Math.floor((K-z)*P)),P-1+O)],v,{scaled:w})}class so extends Xl{constructor(s,h,v,w){super(s,h,v,w),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},h)}triggerRepaint(s){const h=this.map.painter._terrain,v=this.map.style.getSourceCache(this.id);h&&h.enabled&&v&&h._clearRenderCacheForTile(v.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){const v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,i.R.Tile),P={request:w,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=w,s.actor||(s.actor=this.dispatcher.getActor());const O=(D,z,W)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(D)return D.name==="AbortError"?void 0:(s.state="errored",h(D));if(this.map._refreshExpiredTiles&&z){const H=i.aM(W);s.setExpiryData(H)}if(this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!z)return h(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=z}h(null)};s.request=this.partial?s.fetchHeader(void 0,O.bind(this)):s.actor.send("loadTile",P,O.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){const v=s.texturePerLayer;if(s.flushAllQueues(),v.size){s.destroy(!0);for(const w of v.values())this.map.painter.saveTileTexture(w)}else s.destroy()}prepareTile(s,h,v,w){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(h,v,w,(P,O)=>{if(P)return s.state="errored",this.fire(new i.y(P)),void this.triggerRepaint(s);O&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(v,O,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:P})=>P===s),v=h&&h.fields,w=v&&v.bands&&v.bands;return w?w[0]:0}getTextureDescriptor(s,h,v){if(!s)return;const w=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let P=null;h instanceof i.aQ?P=h.paint.get("raster-array-band"):h instanceof i.aR&&(P=h.paint.get("raster-particle-array-band"));const O=P||this.getInitialBand(w);if(O==null)return;if(!s.textureDescriptorPerLayer.get(h.id))return void this.prepareTile(s,w,h.id,O);if(s.updateNeeded(h.id,O)&&!v)return;const D=s.textureDescriptorPerLayer.get(h.id);return Object.assign({},D,{texture:s.texturePerLayer.get(h.id)})}getImages(s,h){const v=new Map;for(const w of s)for(const P of h){const[O,D]=P.split("/"),z=w.getLayer(O);if(!z||!z.hasBand(D)||!z.hasDataForBand(D))continue;const{bytes:W,tileSize:H,buffer:Q}=z.getBandView(D),K=H+2*Q,re={data:new i.q({width:K,height:K},W),pixelRatio:2,sdf:!1,usvg:!1,version:0};v.set(P,re)}return v}queryRasterArrayValueByBandId(s,h,v){const w=h._mrt;return new Promise(P=>{const O={},D=new Set;for(const[z,W]of Object.entries(w.layers)){if(v.layerName&&z!==v.layerName)continue;const H={};O[z]=H;for(const{bands:Q}of W.dataIndex)for(const K of Q)v.bands&&!v.bands.includes(K)||(D.add(i.B(z,K)),h.fetchBand(z,null,K,re=>{i.o.frame(()=>{H[K]=re?null:Mh([s.lng,s.lat],w,W.getBandView(K)),D.delete(i.B(z,K)),D.size===0&&P(O)})},!1))}D.size===0&&P(O)})}_loadTileForQuery(s,h){if(this._loadTileLoaded[s.uid])return void h(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(h);this._loadTilePending[s.uid]=[h];const v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(v,i.R.Tile);s.actor.send("loadTile",{request:w,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(P,O,D)=>{if(P)return this._loadTilePending[s.uid].forEach(z=>z(P,null)),void delete this._loadTilePending[s.uid];if(!O)return this._loadTilePending[s.uid].forEach(z=>z(null,null)),void delete this._loadTilePending[s.uid];if(this.map._refreshExpiredTiles&&O){const z=i.aM(D);s.setExpiryData(z)}s._mrt=O,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach(z=>z(null,O)),this._loadTileLoaded[s.uid]=!0,delete this._loadTilePending[s.uid]},void 0,!0)}queryRasterArrayValueByAllBands(s,h,v){return new Promise((w,P)=>{this._loadTileForQuery(h,(O,D)=>{O?P(O):w(D?this.queryRasterArrayValueByBandId(s,h,v):null)})})}queryRasterArrayValue(s,h){const v=i.aS.convert(s),w=this.findLoadedParent(v);return w&&w._mrt?h.bands||!this.partial?this.queryRasterArrayValueByBandId(v,w,h):this.queryRasterArrayValueByAllBands(v,w,h):Promise.resolve(null)}findLoadedParent(s){const h=i.ae.fromLngLat(s,this.map.transform.tileSize),v=this.maxzoom+1,w=1<<v,P=Math.floor(h.x),O=Math.floor((h.x-P)*w),D=Math.floor(h.y*w),z=this.map.style.getSourceCache(this.id),W=new i.aP(v,P,v,O,D);return z.findLoadedParent(W,this.minzoom)}}const Yl={vector:is,raster:Xl,"raster-dem":class extends Xl{constructor(y,s,h,v){super(y,s,h,v),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(y,s){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,P){w&&(y.state="errored",s(w)),P&&(y.dem=P,y.dem.onDeserialize(),y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0,y.state="loaded",s(null))}y.request=i.n(this.map._requestManager.transformRequest(h,i.R.Tile),(function(w,P,O){if(delete y.request,y.aborted)y.state="unloaded",s(null);else if(w)y.state="errored",s(w);else if(P){const D=i.aM(O);this.map._refreshExpiredTiles&&y.setExpiryData(D);const z=ImageBitmap&&P instanceof ImageBitmap&&i.r(),W=1-(P.width-i.aO(P.width))/2;W<1||y.neighboringTiles||(y.neighboringTiles=this._getNeighboringTiles(y.tileID));const H=z?P:i.o.getImageData(P,W),Q={uid:y.uid,tileID:y.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:H,encoding:this.encoding,padding:W};y.actor&&y.state!=="expired"||(y.actor=this.dispatcher.getActor(),y.actor.send("loadTile",Q,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(y){const s=y.canonical,h=Math.pow(2,s.z),v=(s.x-1+h)%h,w=s.x===0?y.wrap-1:y.wrap,P=(s.x+1+h)%h,O=s.x+1===h?y.wrap+1:y.wrap,D={};return D[new i.aP(y.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},D[new i.aP(y.overscaledZ,O,s.z,P,s.y).key]={backfilled:!1},s.y>0&&(D[new i.aP(y.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1},D[new i.aP(y.overscaledZ,y.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},D[new i.aP(y.overscaledZ,O,s.z,P,s.y-1).key]={backfilled:!1}),s.y+1<h&&(D[new i.aP(y.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1},D[new i.aP(y.overscaledZ,y.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},D[new i.aP(y.overscaledZ,O,s.z,P,s.y+1).key]={backfilled:!1}),D}},"raster-array":so,geojson:class extends i.E{constructor(y,s,h,v){super(),this.id=y,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(v),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const w=i.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*w,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*w,extent:i.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:i.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*w,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(y){this.map=y,this.setData(this._data)}setData(y){return this._data=y,this._updateWorkerData(),this}updateData(y){if(!this._options.dynamic)return this.fire(new i.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof y!="string"&&(y.type==="Feature"&&(y={type:"FeatureCollection",features:[y]}),y.type!=="FeatureCollection"))return this.fire(new i.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof y!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const h of this._data.features)s.set(h.id,h);for(const h of y.features)s.set(h.id,h);this._data.features=[...s.values()]}else this._data=y;return this._updateWorkerData(!0),this}getClusterExpansionZoom(y,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:y,source:this.id,scope:this.scope},s),this}getClusterChildren(y,s){return this.actor.send("geojson.getClusterChildren",{clusterId:y,source:this.id,scope:this.scope},s),this}getClusterLeaves(y,s,h,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:y,limit:s,offset:h},v),this}_updateWorkerData(y=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:y},this.workerOptions);s.scope=this.scope;const h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(i.o.resolveURL(h),i.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(v,w)=>{if(this._loaded=!0,this._pendingLoad=null,v)this.fire(new i.y(v));else{const P={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(P.resourceTiming=w.resourceTiming[this.id]),y&&(this._partialReload=!0),this.fire(new i.z("data",P)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(y),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const y=i.B(this.id,this.scope);this.map.style.clearSource(y),this._updateWorkerData()}loadTile(y,s){const h=y.actor?"reloadTile":"loadTile";y.actor=this.actor;const v=this.map.style?this.map.style.getLut(this.scope):null,w=v?{image:v.image.clone()}:null,P=this._partialReload,O={type:this.type,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:i.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:y.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:P,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};y.request=this.actor.send(h,O,(D,z)=>P&&!z?(y.state="loaded",s(null)):(delete y.request,y.destroy(),y.aborted?s(null):D?s(D):(y.loadVectorData(z,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(y){y.request&&(y.request.cancel(),delete y.request),y.aborted=!0}unloadTile(y,s){this.actor.send("removeTile",{uid:y.uid,type:this.type,source:this.id,scope:this.scope}),y.destroy()}onRemove(y){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aT{constructor(y,s,h,v){super(y,s,h,v),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const y=this.options;this.urls=[];for(const s of y.urls)this.urls.push(this.map._requestManager.transformRequest(s,i.R.Source).url);i.aU(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new i.y(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(y){if(this.video){const s=this.video.seekable;y<s.start(0)||y>s.end(0)?this.fire(new i.y(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=y}}getVideo(){return this.video}onAdd(y){this.map||(this.map=y,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const y=this.map.painter.context,s=y.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(y,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(y)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aT,model:i.aW,"batched-model":class extends i.E{constructor(y,s,h,v){super(),this.type="batched-model",this.id=y,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(y){this.map=y,this.load()}reload(){this.cancelTileJSONRequest();const y=i.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(y))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(y){this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=gi(this._options,this.map._requestManager,s,h,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.y(v))):w&&(Object.assign(this,w),w.bounds&&(this.tileBounds=new Ja(w.bounds,this.minzoom,this.maxzoom)),ge(w.tiles,this.map._requestManager._customAccessToken),this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))),y&&y(v)})}hasTransition(){return!1}hasTile(y){return!this.tileBounds||this.tileBounds.contains(y.canonical)}loaded(){return this._loaded}loadTile(y,s){const h=this.map._requestManager.normalizeTileURL(y.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(h,i.R.Tile),data:void 0,uid:y.uid,tileID:y.tileID,tileZoom:y.tileZoom,zoom:y.tileID.overscaledZ,tileSize:this.tileSize*y.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:y.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.o.devicePixelRatio,promoteId:this.promoteId};if(y.actor&&y.state!=="expired")if(y.state==="loading")y.reloadCallback=s;else{if(y.buckets){const P=Object.values(y.buckets);for(const O of P)O.dirty=!0;return void(y.state="loaded")}y.request=y.actor.send("reloadTile",v,w.bind(this))}else y.actor=this.dispatcher.getActor(),y.request=y.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(P,O){return y.aborted?s(null):P&&P.status!==404?s(P):(this.map._refreshExpiredTiles&&O&&y.setExpiryData(O),y.loadModelData(O,this.map.painter),y.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends i.aT{constructor(y,s,h,v){super(y,s,h,v),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(P=>typeof P!="number"))||this.fire(new i.y(new i.V(`sources.${y}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.y(new i.V(`sources.${y}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new i.y(new i.V(`sources.${y}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new i.y(new i.V(`sources.${y}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.y(new i.V(`sources.${y}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(y){this.map=y,this.load(),this.canvas&&this.animate&&this.play()}onRemove(y){this.pause()}prepare(){let y=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,y=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,y=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!y&&!this._playing||this.texture instanceof i.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const y of[this.canvas.width,this.canvas.height])if(isNaN(y)||y<=0)return!0;return!1}},custom:class extends i.E{constructor(y,s,h,v){super(),this.id=y,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ja(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,i.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(y){this.map=y,this._loaded=!1,this.fire(new i.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(y),this.load()}onRemove(y){this._implementation.onRemove&&this._implementation.onRemove(y)}hasTile(y){if(this._implementation.hasTile){const{x:s,y:h,z:v}=y.canonical;return this._implementation.hasTile({x:s,y:h,z:v})}return!this.tileBounds||this.tileBounds.contains(y.canonical)}loadTile(y,s){const{x:h,y:v,z:w}=y.tileID.canonical,P=new AbortController;y.request=Promise.resolve(this._implementation.loadTile({x:h,y:v,z:w},{signal:P.signal})).then((function(O){return delete y.request,y.aborted?(y.state="unloaded",s(null)):O===void 0?(y.state="errored",s(null)):O===null?(this.loadTileData(y,{width:this.tileSize,height:this.tileSize,data:null}),y.state="loaded",s(null)):function(D){return D instanceof ImageData||D instanceof HTMLCanvasElement||D instanceof ImageBitmap||D instanceof HTMLImageElement}(O)?(this.loadTileData(y,O),y.state="loaded",void s(null)):(y.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(O=>{O.name!=="AbortError"&&(y.state="errored",s(O))}),y.request.cancel=()=>P.abort()}loadTileData(y,s){y.setTexture(s,this.map.painter)}unloadTile(y,s){if(y.texture&&y.texture instanceof i.T?(y.destroy(!0),y.texture&&y.texture instanceof i.T&&this.map.painter.saveTileTexture(y.texture)):y.destroy(),this._implementation.unloadTile){const{x:h,y:v,z:w}=y.tileID.canonical;this._implementation.unloadTile({x:h,y:v,z:w})}s&&s()}abortTile(y,s){y.request&&y.request.cancel&&(y.request.cancel(),delete y.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(y=>({x:y.canonical.x,y:y.canonical.y,z:y.canonical.z}))}_clearTiles(){const y=i.B(this.id,this.scope);this.map.style.clearSource(y)}_update(){this.fire(new i.z("data",{dataType:"source",sourceDataType:"content"}))}}},xs=function(y,s,h,v){const w=new Yl[s.type](y,s,h,v);if(w.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${w.id}`);return i.aX(["load","abort","unload","serialize","prepare"],w),w};function Pc(y,s,h=""){return`${h}:${s.id||""}:${s.layer.id}:${function(v){if("layerId"in v)return`layer:${v.layerId}`;{const{featuresetId:w,importId:P}=v;return`featureset:${w}${P?`:import:${P}`:""}`}}(y.target)}`}function Zs(y,s,h,v=""){if(y.uniqueFeatureID){const w=Pc(y,s,v);if(h.has(w))return!0;h.add(w)}return!1}function Xs(y,s,h,v,w=!1){const P=s.sourceCache.transform,O=s.sourceCache.tilesIn(y,s.has3DLayers,w);O.sort(fg);const D=[];for(const z of O){const W=z.tile.queryRenderedFeatures(s,z,h,v,P,w);Object.keys(W).length&&D.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:W})}for(const z in s.layers){const W=s.layers[z];if(W.styleLayer){const H=W.styleLayer.queryRenderedFeatures(y,s.sourceCache,v);Object.keys(H).length&&D.push({wrappedTileID:0,queryResults:H})}}return D.length===0?{}:function(z){const W={},H={};for(const Q of z){const K=Q.queryResults,re=Q.wrappedTileID,le=H[re]=H[re]||{};for(const ue in K){const xe=K[ue],me=le[ue]=le[ue]||{},Ee=W[ue]=W[ue]||[];for(const Ie of xe)me[Ie.featureIndex]||(me[Ie.featureIndex]=!0,Ee.push(Ie))}}return W}(D)}function Mv(y,s,h,v,w,P){const O={},D=v.queryRenderedSymbols(y),z=[];for(const W of Object.keys(D).map(Number))z.push(w[W]);z.sort(fg);for(const W of z){const H=W.featureIndex.lookupSymbolFeatures(D[W.bucketInstanceId],W.bucketIndex,W.sourceLayerIndex,s,h,P);for(const Q in H){const K=O[Q]=O[Q]||[],re=H[Q];re.sort((le,ue)=>{const xe=W.featureSortOrder;if(xe){const me=xe.indexOf(le.featureIndex);return xe.indexOf(ue.featureIndex)-me}return ue.featureIndex-le.featureIndex});for(const le of re)K.push(le)}}return O}function hg(y,s){const h=y.getRenderableIds().map(P=>y.getTileByID(P)),v=[],w={};for(let P=0;P<h.length;P++){const O=h[P],D=O.tileID.canonical.key;w[D]||(w[D]=!0,O.querySourceFeatures(v,s))}return v}function fg(y,s){const h=y.tileID,v=s.tileID;return h.overscaledZ-v.overscaledZ||h.canonical.y-v.canonical.y||h.wrap-v.wrap||h.canonical.x-v.canonical.x}function pg(y,s){const h={};if(!s)return h;for(const v of y){const w=v.layerIds.map(P=>s.getLayer(P)).filter(Boolean);if(w.length!==0){v.layers=w,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(P=>w.filter(O=>O.id===P)[0]));for(const P of w)h[P.fqid]=v}}return h}const Ns=32,Cc=33,bs=new Uint16Array(8184);for(let y=0;y<2046;y++){let s=y+2,h=0,v=0,w=0,P=0,O=0,D=0;for(1&s?w=P=O=Ns:h=v=D=Ns;(s>>=1)>1;){const W=h+w>>1,H=v+P>>1;1&s?(w=h,P=v,h=O,v=D):(h=w,v=P,w=O,P=D),O=W,D=H}const z=4*y;bs[z+0]=h,bs[z+1]=v,bs[z+2]=w,bs[z+3]=P}const yl=new Uint16Array(2178),zu=new Uint8Array(1089),Dh=new Uint16Array(1089);function Dv(y){return y===0?-.03125:y===32?.03125:0}const Lv={type:2,extent:i.al,loadGeometry:()=>[[new i.P(0,0),new i.P(i.al+1,0),new i.P(i.al+1,i.al+1),new i.P(0,i.al+1),new i.P(0,0)]]};class ru{constructor(s,h,v,w,P,O){this.tileID=s,this.uid=i.b1(),this.uses=0,this.tileSize=h,this.tileZoom=v,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=P,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection),this.worldview=O,this._hasAppearances=null}registerFadeDuration(s){const h=s+this.timeAdded;h<i.o.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,h,v){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=pg(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const P=this.buckets[w];if(P instanceof i.b3){if(this.hasSymbolBuckets=!0,!v)break;P.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const P=this.buckets[w];if(P instanceof i.b3&&P.hasRTLText){this.hasRTLText=!0,i.b4();break}}this.queryPadding=0;for(const w in this.buckets){const P=this.buckets[w],O=h.style.getOwnLayer(w);if(!O)continue;const D=O.queryRadius(P);this.queryPadding=Math.max(this.queryPadding,D)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new i.b2}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,h,v){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,pg(s.buckets,h.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s,h){for(const P in this.buckets){const O=this.buckets[P];if(O.uploadPending()){let D={},z=[],W={zoom:0,pitch:0,brightness:0,worldview:""};if(h){if(h.style){z=h.style.listImages();const H=O.layers[0],Q=H.sourceLayer||"_geojsonTileLayer",K=h.style.getLayerSourceCache(H);K&&(D=K._state.getState(Q,void 0))}W={zoom:h.transform.zoom||0,pitch:h.transform.pitch||0,brightness:h.style.getBrightness()||0,worldview:h.worldview||""}}O.upload(s,this.tileID.canonical,D,z,W)}}const v=s.gl,w=this.imageAtlas;w&&!w.uploaded&&(this.imageAtlasTexture=new i.T(s,w.image,v.RGBA8,{useMipmap:!!w.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(s,this.glyphAtlasImage,v.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(s,this.lineAtlas.image,v.R8),this.lineAtlas.uploaded=!0)}prepare(s,h,v){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,v),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=h.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(h)),(this._lastUpdatedBrightness||w||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}evaluateQueryRenderedFeaturePadding(){let s=0;for(const h in this.buckets){const v=this.buckets[h];v.evaluateQueryRenderedFeaturePadding&&(s=Math.max(s,v.evaluateQueryRenderedFeaturePadding()))}return s}queryRenderedFeatures(s,h,v,w,P,O){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const D=this.evaluateQueryRenderedFeaturePadding(),z=function(W,H){const Q=i.bp([],[.5*W.width,.5*-W.height,1]);return i.bq(Q,Q,[1,-1,0]),i.aB(Q,Q,W.calculateProjMatrix(H.toUnwrapped())),Float32Array.from(Q)}(P,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:h,pixelPosMatrix:z,transform:w,availableImages:v,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:D})}querySourceFeatures(s,h){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),P=h?h.sourceLayer:"",O=w._geojsonTileLayer||w[P];if(!O)return;const D=i.b5(h&&h.filter),{z,x:W,y:H}=this.tileID.canonical,Q={z,x:W,y:H};for(let K=0;K<O.length;K++){const re=O.feature(K);if(D.needGeometry){const xe=i.b6(re,!0);if(!D.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),xe,this.tileID.canonical))continue}else if(!D.filter(new i.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re))continue;const le=v.getId(re,P),ue=new i.b7(re,z,W,H,le);ue.tile=Q,s.push(ue)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const v=i.b8(s.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(h)if(this.expirationTime<h)w=!0;else{const P=this.expirationTime-h;P?this.expirationTime=v+Math.max(P,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}hasAppearances(s){for(const h in this.buckets)if(s.style.hasLayer(h)&&this.buckets[h].layers.some(v=>v.appearances&&v.appearances.length>0))return!0;return!1}updateBuckets(s,h){if(!this.latestFeatureIndex||!s.style)return;const v=this.latestFeatureIndex.loadVTLayers(),w=s.style.listImages(),P=s.style.getBrightness();for(const O in this.buckets){if(!s.style.hasLayer(O))continue;const D=this.buckets[O],z=D.layers[0],W=z.sourceLayer||"_geojsonTileLayer",H=v[W],Q=s.style.getLayerSourceCache(z);let K={};Q&&(K=Q._state.getState(W,void 0));const re=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},le=Object.keys(K).length>0&&!h;if(D.hasAppearances=D.layers.some(xe=>xe.appearances&&xe.appearances.length>0),(le&&D.stateDependentLayers.length!==0||h)&&D.update(K,H,w,re,le?D.stateDependentLayers:D.layers,h,P),le&&D.stateDependentLayers.length!==0||h||D.hasAppearances){const xe={zoom:s.transform.zoom,pitch:s.transform.pitch,brightness:s.style.getBrightness()||0,worldview:s.worldview};D.updateAppearances(this.tileID.canonical,K,w,xe)}(D instanceof i.b9||D instanceof i.ba)&&s._terrain&&s._terrain.enabled&&Q&&D.uploadPending()&&s._terrain._clearRenderCacheForTile(Q.id,this.tileID);const ue=s&&s.style&&s.style.getOwnLayer(O);ue&&(this.queryPadding=Math.max(this.queryPadding,ue.queryRadius(D)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=i.o.now()+s}setTexture(s,h){const v=h.context,w=v.gl;this.texture=this.texture||h.getTileTexture(s.width),this.texture&&this.texture instanceof i.T?this.texture.update(s):(this.texture=new i.T(v,s,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(s,h){const v={};for(const w of h)v[w]=!0;this.dependencies[s]=v}hasDependency(s,h){for(const v of s){const w=this.dependencies[v];if(w){for(const P of h)if(w[P])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const v=i.bb(Lv,this.tileID.canonical,this.tileTransform)[0],w=new i.bc,P=new i.bd;for(let O=0;O<v.length;O++){const{x:D,y:z}=v[O];w.emplaceBack(D,z),P.emplaceBack(O)}P.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(P),this._tileDebugBuffer=s.createVertexBuffer(w,i.be.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,w.length,P.length)}_makeTileBoundsBuffers(s,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const v=i.bb(Lv,this.tileID.canonical,this.tileTransform)[0];let w,P;if(this.isRaster){const O=function(D,z){const W=i.aY(D,z),H=Math.pow(2,D.z);for(let xe=0;xe<Cc;xe++)for(let me=0;me<Cc;me++){const Ee=i.aZ((D.x+(me+Dv(me))/Ns)/H),Ie=i.a_((D.y+(xe+Dv(xe))/Ns)/H),Ae=z.project(Ee,Ie),Be=xe*Cc+me;yl[2*Be+0]=Math.round((Ae.x*W.scale-W.x)*i.al),yl[2*Be+1]=Math.round((Ae.y*W.scale-W.y)*i.al)}zu.fill(0),Dh.fill(0);for(let xe=2045;xe>=0;xe--){const me=4*xe,Ee=bs[me+0],Ie=bs[me+1],Ae=bs[me+2],Be=bs[me+3],Re=Ee+Ae>>1,Ve=Ie+Be>>1,Fe=Re+Ve-Ie,Me=Ve+Ee-Re,qe=Ie*Cc+Ee,ot=Be*Cc+Ae,rt=Ve*Cc+Re,wt=Math.hypot((yl[2*qe+0]+yl[2*ot+0])/2-yl[2*rt+0],(yl[2*qe+1]+yl[2*ot+1])/2-yl[2*rt+1])>=16;zu[rt]=zu[rt]||(wt?1:0),xe<1022&&(zu[rt]=zu[rt]||zu[(Ie+Me>>1)*Cc+(Ee+Fe>>1)]||zu[(Be+Me>>1)*Cc+(Ae+Fe>>1)])}const Q=new i.a$,K=new i.b0;let re=0;function le(xe,me){const Ee=me*Cc+xe;return Dh[Ee]===0&&(Q.emplaceBack(yl[2*Ee+0],yl[2*Ee+1],xe*i.al/Ns,me*i.al/Ns),Dh[Ee]=++re),Dh[Ee]-1}function ue(xe,me,Ee,Ie,Ae,Be){const Re=xe+Ee>>1,Ve=me+Ie>>1;if(Math.abs(xe-Ae)+Math.abs(me-Be)>1&&zu[Ve*Cc+Re])ue(Ae,Be,xe,me,Re,Ve),ue(Ee,Ie,Ae,Be,Re,Ve);else{const Fe=le(xe,me),Me=le(Ee,Ie),qe=le(Ae,Be);K.emplaceBack(Fe,Me,qe)}}return ue(0,0,Ns,Ns,Ns,0),ue(Ns,Ns,0,0,0,Ns),{vertices:Q,indices:K}}(this.tileID.canonical,h);w=O.vertices,P=O.indices}else{w=new i.a$,P=new i.b0;for(const{x:D,y:z}of v)w.emplaceBack(D,z,0,0);const O=i.bg(w.int16.subarray(0,4*w.length),void 0,4);for(let D=0;D<O.length;D+=3)P.emplaceBack(O[D],O[D+1],O[D+2])}this._tileBoundsBuffer=s.createVertexBuffer(w,i.bh.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(P),this._tileBoundsSegments=i.bf.simpleSegment(0,0,w.length,P.length)}_makeGlobeTileDebugBuffers(s,h){const v=h.projection;if(!v||v.name!=="globe"||h.freezeTileCoverage)return;const w=this.tileID.canonical,P=i.bi(w,h),O=i.bj(P),D=i.aj(h.zoom);let z;D>0&&(z=i.bk(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,w,h,O,z,D),this._makeGlobeTileDebugTextBuffer(s,w,h,O,z,D)}_globePoint(s,h,v,w,P,O,D){let z=i.bl(s,h,v);if(O){const W=1<<v.z,H=i.aF(w.center.lng),Q=i.aJ(w.center.lat),K=(v.x+.5)/W-H;let re=0;K>.5?re=-1:K<-.5&&(re=1);let le=(s/i.al+v.x)/W+re,ue=(h/i.al+v.y)/W;le=(le-H)*w._pixelsPerMercatorPixel+H,ue=(ue-Q)*w._pixelsPerMercatorPixel+Q;const xe=[le*w.worldSize,ue*w.worldSize,0];i.af(xe,xe,O),z=i.bm(z,xe,D)}return i.af(z,z,P)}_makeGlobeTileDebugBorderBuffer(s,h,v,w,P,O){const D=new i.bc,z=new i.bd,W=new i.bn,H=(K,re,le,ue,xe)=>{const me=(le-K)/(xe-1),Ee=(ue-re)/(xe-1),Ie=D.length;for(let Ae=0;Ae<xe;Ae++){const Be=K+Ae*me,Re=re+Ae*Ee;D.emplaceBack(Be,Re);const Ve=this._globePoint(Be,Re,h,v,w,P,O);W.emplaceBack(Ve[0],Ve[1],Ve[2]),z.emplaceBack(Ie+Ae)}},Q=i.al;H(0,0,Q,0,16),H(Q,0,Q,Q,16),H(Q,Q,0,Q,16),H(0,Q,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(z),this._tileDebugBuffer=s.createVertexBuffer(D,i.be.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(W,i.bo.members),this._tileDebugSegments=i.bf.simpleSegment(0,0,D.length,z.length)}_makeGlobeTileDebugTextBuffer(s,h,v,w,P,O){const D=i.al/4,z=new i.bc,W=new i.b0,H=new i.bn,Q=25;W.reserve(32),z.reserve(Q),H.reserve(Q);const K=(re,le)=>Q*re+le;for(let re=0;re<Q;re++){const le=re*D;for(let ue=0;ue<Q;ue++){const xe=ue*D;z.emplaceBack(xe,le);const me=this._globePoint(xe,le,h,v,w,P,O);H.emplaceBack(me[0],me[1],me[2])}}for(let re=0;re<4;re++)for(let le=0;le<4;le++){const ue=K(re,le),xe=K(re,le+1),me=K(re+1,le),Ee=K(re+1,le+1);W.emplaceBack(ue,xe,me),W.emplaceBack(me,xe,Ee)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(W),this._tileDebugTextBuffer=s.createVertexBuffer(z,i.be.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(H,i.bo.members),this._tileDebugTextSegments=i.bf.simpleSegment(0,0,Q,32)}destroy(s=!1){for(const h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.br.setPbf(i.bs);class Ld extends ru{constructor(s,h,v,w,P){super(s,h,v,w,P),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,h,v){const w=v.context,P=w.gl;let O=this.texturePerLayer.get(s)||v.getTileTexture(h.width);O&&O instanceof i.T?O.update(h,{premultiply:!1}):O=new i.T(w,h,P.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,O)}flushQueues(s){const h=this._workQueuePerLayer.get(s)||[],v=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()();for(;v.length;)v.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const h=this._workQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const h=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}}fetchHeader(s=16384,h){const v=this._mrt=new i.br(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=i.bt(w,(P,O,D)=>{if(P)h(P);else try{const z=v.getHeaderLength(O);if(z>s)return void(this.request=this.fetchHeader(z,h));v.parseHeader(O),this._isHeaderLoaded=!0;let W=0;for(const H of Object.values(v.layers))W=Math.max(W,H.dataIndex[H.dataIndex.length-1].lastByte);O.byteLength>=W&&(this.entireBuffer=O),h(null,this.entireBuffer||O,D)}catch(z){h(z)}}),this.request}fetchBandForRender(s,h,v,w){this.fetchBand(s,h,v,P=>{if(P)return void w(P);this.updateTextureDescriptor(s,h,v);const O=this.textureDescriptorPerLayer.get(h);w(null,O?O.img:null)})}fetchBand(s,h,v,w,P=!0){const O=this._mrt;if(!this._isHeaderLoaded||!O)return void w(new Error("Tile header is not ready"));const D=this.actor;if(!D)return void w(new Error("Can't fetch tile band without an actor"));let z;const W=i.B(String(v),i.B(this.tileID.key,s));let H=this._taskQueue.get(W);H?H.add(w):(H=new Set,H.add(w),this._taskQueue.set(W,H));const Q=(ue,xe)=>{z.complete(ue,xe),ue?w(ue):(H.values().forEach(me=>me(null,xe)),this._taskQueue.delete(W))},K=(ue,xe)=>{if(ue)return w(ue);const me=D.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:xe,task:z},Q,void 0,!0);if(h!==null){const Ee=this._workQueuePerLayer.get(h)||[];Ee.push(()=>{me&&me.cancel(),z.cancel()}),this._workQueuePerLayer.has(h)||this._workQueuePerLayer.set(h,Ee)}};let re;try{re=O.getLayer(s)}catch(ue){if(this.state==="reloading")return;throw ue}if(!re)return void w(new Error(`Unknown sourceLayer "${s}"`));if(re.hasDataForBand(v))return H.values().forEach(ue=>ue(null,null)),void this._taskQueue.delete(W);const le=re.getDataRange([v]);if(z=O.createDecodingTask(le),!z||z.tasks.length)if(h!==null&&this.flushQueues(h),this.entireBuffer)K(null,this.entireBuffer.slice(le.firstByte,le.lastByte+1));else{const ue=Object.assign({},this.requestParams,{headers:{Range:`bytes=${le.firstByte}-${le.lastByte}`}}),xe=i.bt(ue,K);if(h!==null){const me=this._fetchQueuePerLayer.get(h)||[];me.push(()=>{xe.cancel(),z.cancel()}),this._fetchQueuePerLayer.has(h)||this._fetchQueuePerLayer.set(h,me)}}}updateNeeded(s,h){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==h||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,h,v){if(!this._mrt)return;const w=this._mrt.getLayer(s);if(!w||!w.hasBand(v)||!w.hasDataForBand(v))return;const{bytes:P,tileSize:O,buffer:D,offset:z,scale:W}=w.getBandView(v),H=O+2*D,Q=new i.q({width:H,height:H},P),K=this.texturePerLayer.get(h);K&&K instanceof i.T&&K.update(Q,{premultiply:!1}),this.textureDescriptorPerLayer.set(h,{layer:s,band:v,img:Q,buffer:D,offset:z,tileSize:O,format:w.pixelFormat,mix:[W,256*W,65536*W,16777216*W]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const h of this.texturePerLayer.values())h&&h instanceof i.T&&h.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Hb{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,v){const w=s.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const P={value:h,timeout:void 0};if(v!==void 0&&(P.timeout=setTimeout(()=>{this.remove(s,P)},v)),this.data[w].push(P),this.order.push(w),this.order.length>this.max){const O=this._getAndRemoveByKey(this.order[0]);O&&this.onRemove(O)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const v=s.wrapped().key,w=h===void 0?0:this.data[v].indexOf(h),P=this.data[v][w];return this.data[v].splice(w,1),P.timeout&&clearTimeout(P.timeout),this.data[v].length===0&&delete this.data[v],this.onRemove(P.value),this.order.splice(this.order.indexOf(v),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const v in this.data)for(const w of this.data[v])s(w.value)||h.push(w);for(const v of h)this.remove(v.value.tileID,v)}}class oA{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,v){const w=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][w]=this.stateChanges[s][w]||{},Object.assign(this.stateChanges[s][w],v),this.deletedStates[s]===null){this.deletedStates[s]={};for(const P in this.state[s])P!==w&&(this.deletedStates[s][P]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][w]===null){this.deletedStates[s][w]={};for(const P in this.state[s][w])v[P]||(this.deletedStates[s][w][P]=null)}else for(const P in v)this.deletedStates[s]&&this.deletedStates[s][w]&&this.deletedStates[s][w][P]===null&&delete this.deletedStates[s][w][P]}removeFeatureState(s,h,v){if(this.deletedStates[s]===null)return;const w=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},v&&h!==void 0)this.deletedStates[s][w]!==null&&(this.deletedStates[s][w]=this.deletedStates[s][w]||{},this.deletedStates[s][w][v]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][w])for(v in this.deletedStates[s][w]={},this.stateChanges[s][w])this.deletedStates[s][w][v]=null;else this.deletedStates[s][w]=null;else this.deletedStates[s]=null}getState(s,h){const v=this.state[s]||{},w=this.stateChanges[s]||{},P=this.deletedStates[s];if(P===null)return{};if(h!==void 0){const D=String(h),z=Object.assign({},v[D],w[D]);if(P){const W=P[h];if(W===null)return{};for(const H in W)delete z[H]}return z}const O=Object.assign({},v,w);if(P)for(const D in P)delete O[D];return O}initializeTileState(s,h){s.refreshFeatureState(h)}coalesceChanges(s,h){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const P={};for(const O in this.stateChanges[w])this.state[w][O]||(this.state[w][O]={}),Object.assign(this.state[w][O],this.stateChanges[w][O]),P[O]=this.state[w][O];v[w]=P}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const P={};if(this.deletedStates[w]===null)for(const O in this.state[w])P[O]={},this.state[w][O]={};else for(const O in this.deletedStates[w]){if(this.deletedStates[w][O]===null)this.state[w][O]={};else if(this.state[w][O])for(const D of Object.keys(this.deletedStates[w][O]))delete this.state[w][O][D];P[O]=this.state[w][O]}v[w]=v[w]||{},Object.assign(v[w],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0)for(const w in s)s[w].refreshFeatureState(h)}}class Jl extends i.E{constructor(s,h,v){super(),this.id=s,this._onlySymbols=v,h.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new Hb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new oA,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,h){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const v=this._tiles[h];v.upload(s,this.map?this.map.painter:void 0),v.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Kb).map(s=>s.key)}getRenderableIds(s,h){const v=[];for(const w in this._tiles)this._isIdRenderable(+w,s,h)&&v.push(this._tiles[w]);return s?v.sort((w,P)=>{const O=w.tileID,D=P.tileID,z=new i.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle),W=new i.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return O.overscaledZ-D.overscaledZ||W.y-z.y||W.x-z.x}).map(w=>w.tileID.key):v.map(w=>w.tileID).sort(Kb).map(w=>w.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h,v){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())&&(v||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,h){const v=this._tiles[s];v&&(v.state!=="loading"&&(v.state=h),this._loadTile(v,this._tileLoaded.bind(this,v,s,h)))}_tileLoaded(s,h,v,w,P){if(w){if(s.state="errored",w.status!==404)this._source.fire(new i.y(w,{tile:s}));else{if(this._source.fire(new i.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const D=this.map.painter.terrain;this.update(this.transform,D.getScaledDemTileSize(),!0),D.resetTileLookupCache(this.id)}else this.update(this.transform)}return}s.timeAdded=i.o.now(),v==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null);let O=new Map;P&&P.responseHeaders&&(O=P.responseHeaders),this._source.fire(new i.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id,responseHeaders:O}))}_backfillDEM(s){const h=this.getRenderableIds();for(let w=0;w<h.length;w++){const P=h[w];if(s.neighboringTiles&&s.neighboringTiles[P]){const O=this.getTileByID(P);v(s,O),v(O,s)}}function v(w,P){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let O=P.tileID.canonical.x-w.tileID.canonical.x;const D=P.tileID.canonical.y-w.tileID.canonical.y,z=Math.pow(2,w.tileID.canonical.z),W=P.tileID.key;O===0&&D===0||Math.abs(D)>1||(Math.abs(O)>1&&(Math.abs(O+z)===1?O+=z:Math.abs(O-z)===1&&(O-=z)),P.dem&&w.dem&&(w.dem.backfillBorder(P.dem,O,D),w.neighboringTiles&&w.neighboringTiles[W]&&(w.neighboringTiles[W].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,v,w){for(const P in this._tiles){let O=this._tiles[P];if(w[P]||!O.hasData()||O.tileID.overscaledZ<=h||O.tileID.overscaledZ>v)continue;let D=O.tileID;for(;O&&O.tileID.overscaledZ>h+1;){const W=O.tileID.scaledTo(O.tileID.overscaledZ-1);O=this._tiles[W.key],O&&O.hasData()&&(D=W)}let z=D;for(;z.overscaledZ>h;)if(z=z.scaledTo(z.overscaledZ-1),s[z.key]){w[D.key]=D;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const v=this._loadedParentTiles[s.key];return v&&v.tileID.overscaledZ>=h?v:null}for(let v=s.overscaledZ-1;v>=h;v--){const w=s.scaledTo(v),P=this._getLoadedTile(w);if(P)return P}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,h){h=h||this._source.tileSize;const v=Math.ceil(s.width/h)+1,w=Math.ceil(s.height/h)+1,P=Math.floor(v*w*5),O=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,P):P,D=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(D)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const v={};for(const w in this._tiles){const P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),v[P.tileID.key]=P}this._tiles=v;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(s,h,v,w,P){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!v)return;this.updateCacheSize(s,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const O=this._source.type==="batched-model";let D,z=this._source.maxzoom;const W=this.map&&this.map.painter?this.map.painter._terrain:null;if(W&&W.sourceCache===this&&W.attenuationRange()){const K=W.attenuationRange()[0],re=Math.floor(K)-Math.log2(W.getDemUpscale());z>re&&(z=re)}if(this.used||this.usedForTerrain){if(this._source.tileID)D=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(K=>new i.aP(K.canonical.z,K.wrap,K.canonical.z,K.canonical.x,K.canonical.y));else if(this.tileCoverLift!==0){const K=s.clone();K.tileCoverLift=this.tileCoverLift,D=K.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!v,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:O}),this._source.minzoom<=1&&s.projection.name==="globe"&&(D.push(new i.aP(1,0,1,0,0)),D.push(new i.aP(1,0,1,1,0)),D.push(new i.aP(1,0,1,0,1)),D.push(new i.aP(1,0,1,1,1)))}else if(D=s.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:z,roundZoom:this._source.roundZoom&&!v,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:O}),this._source.hasTile){const K=this._source.hasTile.bind(this._source);D=D.filter(re=>K(re))}}else D=[];if(D.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Lh(this._source.type)){const K=s.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!v}),re=Math.min(K,this._source.maxzoom);if(O){const le=s.extendTileCover(D,re);for(const ue of le)D.push(ue)}else if(P){const le=s.extendTileCoverToNearPlane(D,this.transform.getFrustum(re),re);for(const ue of le)D.push(ue)}else if(this.castsShadows&&w){const le=s.extendTileCover(D,re,w);for(const ue of le)this._shadowCasterTiles[ue.key]=!0,D.push(ue)}}const H=this._updateRetainedTiles(D);if(Lh(this._source.type)&&D.length!==0){const K={},re={},le=Object.keys(H);for(const xe of le){const me=H[xe],Ee=this._tiles[xe];if(!Ee||Ee.fadeEndTime&&Ee.fadeEndTime<=i.o.now())continue;const Ie=this.findLoadedParent(me,Math.max(me.overscaledZ-Jl.maxOverzooming,this._source.minzoom));Ie&&(this._addTile(Ie.tileID),K[Ie.tileID.key]=Ie.tileID),re[xe]=me}const ue=D[D.length-1].overscaledZ;for(const xe in this._tiles){const me=this._tiles[xe];if(H[xe]||!me.hasData())continue;let Ee=me.tileID;for(;Ee.overscaledZ>ue;){Ee=Ee.scaledTo(Ee.overscaledZ-1);const Ie=this._tiles[Ee.key];if(Ie&&Ie.hasData()&&re[Ee.key]){H[xe]=me.tileID;break}}}for(const xe in K)H[xe]||(this._coveredTiles[xe]=!0,H[xe]=K[xe])}for(const K in H)this._tiles[K].clearFadeHold();const Q=i.bu(this._tiles,H);for(const K of Q){const re=this._tiles[K];re.hasSymbolBuckets&&!re.holdingForFade()?re.setHoldDuration(this.map._fadeDuration):re.hasSymbolBuckets&&!re.symbolFadeFinished()||this._removeTile(+K)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const h={};if(s.length===0)return h;const v={},w=s.reduce((W,H)=>Math.min(W,H.overscaledZ),1/0),P=s[0].overscaledZ,O=Math.max(P-Jl.maxOverzooming,this._source.minzoom),D=Math.max(P+Jl.maxUnderzooming,this._source.minzoom),z={};for(const W of s){const H=this._addTile(W);h[W.key]=W,H.hasData()||w<this._source.maxzoom&&(z[W.key]=W)}this._retainLoadedChildren(z,w,D,h);for(const W of s){let H=this._tiles[W.key];if(H.hasData())continue;if(W.canonical.z>=this._source.maxzoom){const K=W.children(this._source.maxzoom)[0],re=this.getTile(K);if(re&&re.hasData()){h[K.key]=K;continue}}else{const K=W.children(this._source.maxzoom);if(h[K[0].key]&&h[K[1].key]&&h[K[2].key]&&h[K[3].key])continue}let Q=H.wasRequested();for(let K=W.overscaledZ-1;K>=O;--K){const re=W.scaledTo(K);if(v[re.key]||(v[re.key]=!0,H=this.getTile(re),!H&&Q&&(H=this._addTile(re)),H&&(h[re.key]=re,Q=H.wasRequested(),H.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let v,w=this._tiles[s].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){v=this._loadedParentTiles[w.key];break}h.push(w.key);const P=w.scaledTo(w.overscaledZ-1);if(v=this._getLoadedTile(P),v)break;w=P}for(const P of h)this._loadedParentTiles[P]=v}}_addTile(s){let h=this._tiles[s.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const v=!!h;if(!v){const w=this.map?this.map.painter:null,P=this._source.tileSize*s.overscaleFactor();h=this._source.type==="raster-array"?new Ld(s,P,this.transform.tileZoom,w,this._isRaster):new ru(s,P,this.transform.tileZoom,w,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))}return h.uses++,this._tiles[s.key]=h,v||this._source.fire(new i.z("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const v=h.getExpiryTimeout();v&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},v))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,h,v){const w=[],P=this.transform;if(!P)return w;const O=P.projection.name==="globe",D=i.aF(P.center.lng);for(const z in this._tiles){const W=this._tiles[z];if(v&&W.clearQueryDebugViz(),W.holdingForFade())continue;let H;if(O){const Q=W.tileID.canonical;if(Q.z===0){const K=[Math.abs(i.aA(D,...Fh(Q,-1))-D),Math.abs(i.aA(D,...Fh(Q,1))-D)];H=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(i.aA(D,...Fh(Q,-1))-D),Math.abs(i.aA(D,...Fh(Q,0))-D),Math.abs(i.aA(D,...Fh(Q,1))-D)];H=[K.indexOf(Math.min(...K))-1]}}else H=[0];for(const Q of H){const K=s.containsTile(W,P,h,Q);K&&w.push(K)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,h){const v=this.getRenderableIds(s,h).map(P=>this._tiles[P].tileID),w=this.transform.projection.name==="globe";for(const P of v)P.projMatrix=this.transform.calculateProjMatrix(P.toUnwrapped()),P.expandedProjMatrix=w?this.transform.calculateProjMatrix(P.toUnwrapped(),!1,!0):P.projMatrix;return v}sortCoordinatesByDistance(s){const h=s.slice(),v=this.transform._camera.position,w=this.transform._camera.forward(),P={};for(const O of h){const D=1/(1<<O.canonical.z);P[O.key]=((O.canonical.x+.5)*D+O.wrap-v[0])*w[0]+((O.canonical.y+.5)*D-v[1])*w[1]-v[2]*w[2]}return h.sort((O,D)=>P[O.key]-P[D.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(Lh(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=i.o.now())return!0}return!1}setFeatureState(s,h,v){this._state.updateState(s=s||"_geojsonTileLayer",h,v)}removeFeatureState(s,h,v){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,v)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,v){const w=this._tiles[s];w&&w.setDependencies(h,v)}reloadTilesForDependencies(s,h){for(const v in this._tiles)this._tiles[v].hasDependency(s,h)&&this._reloadTile(+v,"reloading");this._cache.filter(v=>!v.hasDependency(s,h))}_preloadTiles(s,h){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(s,h))};return void this._source.on("data",z)}const v=new Map,w=Array.isArray(s)?s:[s],P=this.map.painter.terrain,O=this.usedForTerrain&&P?P.getScaledDemTileSize():this._source.tileSize;for(const z of w){const W=z.coveringTiles({tileSize:O,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const H of W)v.set(H.key,H);this.usedForTerrain&&z.updateElevation(!1)}const D=Array.from(v.values());i.bv(D,(z,W)=>{const H=new ru(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(H,Q=>{this._source.type==="raster-dem"&&H.dem&&this._backfillDEM(H),W(Q,H)})},h)}}function Kb(y,s){const h=Math.abs(2*y.wrap)-+(y.wrap<0),v=Math.abs(2*s.wrap)-+(s.wrap<0);return y.overscaledZ-s.overscaledZ||v-h||s.canonical.y-y.canonical.y||s.canonical.x-y.canonical.x}function Lh(y){return y==="raster"||y==="image"||y==="video"||y==="custom"}function Fh(y,s){const h=1<<y.z;return[y.x/h+s,(y.x+1)/h+s]}Jl.maxOverzooming=10,Jl.maxUnderzooming=3;class Zb{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,h=!1;for(const v in this.style._mergedLayers){const w=this.style._mergedLayers[v];if(w.type==="fill-extrusion"||w.type==="building")this.layers.push({layer:w,visible:s,visibilityChanged:h});else if(w.type==="model"){const P=this.style.getLayerSource(w);P&&P.type==="batched-model"&&this.layers.push({layer:w,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(const h of this.layers){const v=h.layer;let w=!1;v.type==="fill-extrusion"?w=!v.isHidden(s)&&v.paint.get("fill-extrusion-opacity")>0:v.type==="building"?w=!v.isHidden(s)&&v.paint.get("building-opacity")>0:v.type==="model"&&(w=!v.isHidden(s)&&v.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&h.visible,h.visible=w}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(const w of this.layers){const P=w.layer,O=this.style.getLayerSourceCache(P);let D=1;P.type==="fill-extrusion"?D=w.visible?P.paint.get("fill-extrusion-vertical-scale"):0:P.type==="building"&&(D=w.visible?P.paint.get("building-vertical-scale"):0);let z=O?O.getTile(h):null;if(!z&&O)for(const W in O._tiles){const H=O._tiles[W];if(h.canonical.isChildOf(H.tileID.canonical)){z=H;break}}this.currentBuildingBuckets.push({bucket:z?z.getBucket(P):null,tileID:z?z.tileID:h,verticalScale:D})}s.hasAnyZOffset=!1;let v=!1;for(let w=0;w<s.symbolInstances.length;w++){const P=s.symbolInstances.get(w),O=P.zOffset,D=this._getHeightAtTileOffset(h,P.tileAnchorX,P.tileAnchorY);P.zOffset=D!==Number.NEGATIVE_INFINITY?D:O,v||O===P.zOffset||(v=!0),s.hasAnyZOffset||P.zOffset===0||(s.hasAnyZOffset=!0)}v&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,v,w){let P=h,O=v;if(s.canonical.z!==w.canonical.z){const D=w.canonical,z=1/(1<<s.canonical.z-D.z);P=(h+s.canonical.x*i.al)*z-D.x*i.al|0,O=(v+s.canonical.y*i.al)*z-D.y*i.al|0}return{tileX:P,tileY:O}}_getHeightAtTileOffset(s,h,v){let w,P;for(let O=0;O<this.layers.length;++O){const D=this.layers[O].layer;if(D.type!=="fill-extrusion"&&D.type!=="building")continue;const{bucket:z,tileID:W,verticalScale:H}=this.currentBuildingBuckets[O];if(!z)continue;const{tileX:Q,tileY:K}=this._mapCoordToOverlappingTile(s,h,v,W),re=z.getHeightAtTileCoord(Q,K);re&&re.height!==void 0&&(re.hidden?w=re.height:P=Math.max(re.height*H,P||0))}if(P!==void 0)return P;for(let O=0;O<this.layers.length;++O){const D=this.layers[O];if(D.layer.type!=="model"||!D.visible)continue;const{bucket:z,tileID:W}=this.currentBuildingBuckets[O];if(!z)continue;const{tileX:H,tileY:Q}=this._mapCoordToOverlappingTile(s,h,v,W),K=z.getHeightAtTileCoord(H,Q);if(K&&!K.hidden)return K.height===void 0&&w!==void 0?Math.min(K.maxHeight,w)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function mg(y,s){const h={};for(const v in y)v!=="ref"&&(h[v]=y[v]);return i.bw.forEach(v=>{v in s&&(h[v]=s[v])}),h}function Zf(y){y=y.slice();const s=Object.create(null);for(let h=0;h<y.length;h++)s[y[h].id]=y[h];for(let h=0;h<y.length;h++)"ref"in y[h]&&(y[h]=mg(y[h],s[y[h].ref]));return y}const Zn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Xb(y,s,h){h.push({command:Zn.addSource,args:[y,s[y]]})}function gg(y,s,h){s.push({command:Zn.removeSource,args:[y]}),h[y]=!0}function yg(y,s,h,v){gg(y,h,v),Xb(y,s,h)}function Yb(y,s,h){let v;for(v in y[h])if(y[h].hasOwnProperty(v)&&v!=="data"&&!i.bx(y[h][v],s[h][v]))return!1;for(v in s[h])if(s[h].hasOwnProperty(v)&&v!=="data"&&!i.bx(y[h][v],s[h][v]))return!1;return!0}function vg(y,s,h,v,w,P){let O;for(O in s=s||{},y=y||{})y.hasOwnProperty(O)&&(i.bx(y[O],s[O])||h.push({command:P,args:[v,O,s[O],w]}));for(O in s)s.hasOwnProperty(O)&&!y.hasOwnProperty(O)&&(i.bx(y[O],s[O])||h.push({command:P,args:[v,O,s[O],w]}))}function _g(y){return y.id}function xg(y,s){return y[s.id]=s,y}function zh(y,s,h){const v=s.createTileMatrix(y,y.worldSize,h.toUnwrapped());return i.aB(new Float32Array(16),y.projMatrix,v)}function sA(y,s,h){if(s.projection.name===h.projection.name)return y.projMatrix;const v=h.clone();return v.setProjection(s.projection),zh(v,s.getProjection(),y)}function Fv(y,s,h){return s.name===h.projection.name?y.projMatrix:zh(h,s,y)}class LR{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=i.aA(s,0,1);let h=1,v=this._distances[h];const w=s*this.paddedLength+this.padding;for(;v<w&&h<this._distances.length;)v=this._distances[++h];const P=h-1,O=this._distances[P],D=v-O,z=D>0?(w-O)/D:0;return this.points[P].mult(1-z).add(this.points[h].mult(z))}}class bg{constructor(s,h,v){const w=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(s/v),this.yCellCount=Math.ceil(h/v);for(let O=0;O<this.xCellCount*this.yCellCount;O++)w.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,v,w,P){this._forEachCell(h,v,w,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(P)}insertCircle(s,h,v,w){this._forEachCell(h-w,v-w,h+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(v),this.circles.push(w)}_insertBoxCell(s,h,v,w,P,O){this.boxCells[P].push(O)}_insertCircleCell(s,h,v,w,P,O){this.circleCells[P].push(O)}_query(s,h,v,w,P,O){if(v<0||s>this.width||w<0||h>this.height)return!P&&[];const D=[];if(s<=0&&h<=0&&this.width<=v&&this.height<=w){if(P)return!0;for(let z=0;z<this.boxKeys.length;z++)D.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const W=this.circles[3*z],H=this.circles[3*z+1],Q=this.circles[3*z+2];D.push({key:this.circleKeys[z],x1:W-Q,y1:H-Q,x2:W+Q,y2:H+Q})}return O?D.filter(O):D}return this._forEachCell(s,h,v,w,this._queryCell,D,{hitTest:P,seenUids:{box:{},circle:{}}},O),P?D.length>0:D}_queryCircle(s,h,v,w,P){const O=s-v,D=s+v,z=h-v,W=h+v;if(D<0||O>this.width||W<0||z>this.height)return!w&&[];const H=[];return this._forEachCell(O,z,D,W,this._queryCellCircle,H,{hitTest:w,circle:{x:s,y:h,radius:v},seenUids:{box:{},circle:{}}},P),w?H.length>0:H}query(s,h,v,w,P){return this._query(s,h,v,w,!1,P)}hitTest(s,h,v,w,P){return this._query(s,h,v,w,!0,P)}hitTestCircle(s,h,v,w){return this._queryCircle(s,h,v,!0,w)}_queryCell(s,h,v,w,P,O,D,z){const W=D.seenUids,H=this.boxCells[P];if(H!==null){const K=this.bboxes;for(const re of H)if(!W.box[re]){W.box[re]=!0;const le=4*re;if(s<=K[le+2]&&h<=K[le+3]&&v>=K[le+0]&&w>=K[le+1]&&(!z||z(this.boxKeys[re]))){if(D.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[re],x1:K[le],y1:K[le+1],x2:K[le+2],y2:K[le+3]})}}}const Q=this.circleCells[P];if(Q!==null){const K=this.circles;for(const re of Q)if(!W.circle[re]){W.circle[re]=!0;const le=3*re;if(this._circleAndRectCollide(K[le],K[le+1],K[le+2],s,h,v,w)&&(!z||z(this.circleKeys[re]))){if(D.hitTest)return O.push(!0),!0;{const ue=K[le],xe=K[le+1],me=K[le+2];O.push({key:this.circleKeys[re],x1:ue-me,y1:xe-me,x2:ue+me,y2:xe+me})}}}}}_queryCellCircle(s,h,v,w,P,O,D,z){const W=D.circle,H=D.seenUids,Q=this.boxCells[P];if(Q!==null){const re=this.bboxes;for(const le of Q)if(!H.box[le]){H.box[le]=!0;const ue=4*le;if(this._circleAndRectCollide(W.x,W.y,W.radius,re[ue+0],re[ue+1],re[ue+2],re[ue+3])&&(!z||z(this.boxKeys[le])))return O.push(!0),!0}}const K=this.circleCells[P];if(K!==null){const re=this.circles;for(const le of K)if(!H.circle[le]){H.circle[le]=!0;const ue=3*le;if(this._circlesCollide(re[ue],re[ue+1],re[ue+2],W.x,W.y,W.radius)&&(!z||z(this.circleKeys[le])))return O.push(!0),!0}}}_forEachCell(s,h,v,w,P,O,D,z){const W=this._convertToXCellCoord(s),H=this._convertToYCellCoord(h),Q=this._convertToXCellCoord(v),K=this._convertToYCellCoord(w);for(let re=W;re<=Q;re++)for(let le=H;le<=K;le++)if(P.call(this,s,h,v,w,this.xCellCount*le+re,O,D,z))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,v,w,P,O){const D=w-s,z=P-h,W=v+O;return W*W>D*D+z*z}_circleAndRectCollide(s,h,v,w,P,O,D){const z=(O-w)/2,W=Math.abs(s-(w+z));if(W>z+v)return!1;const H=(D-P)/2,Q=Math.abs(h-(P+H));if(Q>H+v)return!1;if(W<=z||Q<=H)return!0;const K=W-z,re=Q-H;return K*K+re*re<=v*v}}const vl={unknown:0,flipRequired:1,flipNotRequired:2},wg=Math.tan(85*Math.PI/180);function Xf(y,s,h,v,w,P,O){const D=i.bB();if(h)if(P.name==="globe"){const z=i.bC(w,s);i.aB(D,D,z)}else{const z=i.bD([],O);D[0]=z[0],D[1]=z[1],D[4]=z[2],D[5]=z[3],v||i.bA(D,D,w.angle)}else i.aB(D,w.labelPlaneMatrix,y);return D}function Sg(y,s,h,v,w,P,O){const D=Xf(y,s,h,v,w,P,O);return P.name==="globe"&&h||(D[2]=D[6]=D[10]=D[14]=0),D}function Bu(y,s,h,v,w,P,O){if(h){if(P.name==="globe"){const D=Xf(y,s,h,v,w,P,O);return i.bk(D,D),i.aB(D,y,D),D}{const D=i.by(y),z=i.bz([]);return z[0]=O[0],z[1]=O[1],z[4]=O[2],z[5]=O[3],i.aB(D,D,z),v||i.bA(D,D,-w.angle),D}}return w.glCoordMatrix}function Qa(y,s,h,v){const w=[y,s,h,1];h?i.aC(w,w,v):Ql(w,w,v);const P=w[3];return w[0]/=P,w[1]/=P,w[2]/=P,w}function Jb(y,s){return Math.min(.5+y/s*.5,1.5)}function Qb(y,s){const h=y[0]/y[3],v=y[1]/y[3];return h>=-s[0]&&h<=s[0]&&v>=-s[1]&&v<=s[1]}function ew(y,s,h,v,w,P,O,D,z,W,H=1){const Q=h.transform,K=v?y.textSizeData:y.iconSizeData,re=i.bJ(K,h.transform.zoom,H),le=Q.projection.name==="globe",ue=[256/h.width*2+1,256/h.height*2+1],xe=v?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;xe.clear();let me=null;le&&(me=v?y.text.globeExtVertexArray:y.icon.globeExtVertexArray);const Ee=y.lineVertexArray,Ie=v?y.text.placedSymbolArray:y.icon.placedSymbolArray,Ae=h.transform.width/h.transform.height;let Be,Re=!1;for(let Ve=0;Ve<Ie.length;Ve++){const Fe=Ie.get(Ve),{numGlyphs:Me,writingMode:qe}=Fe;if(qe!==i.bK.vertical||Re||Be===i.bK.horizontal||(Re=!0),Be=qe,(Fe.hidden||qe===i.bK.vertical)&&!Re){$u(Me,xe);continue}Re=!1;const ot=new i.P(Fe.tileAnchorX,Fe.tileAnchorY),rt=y.elevationType==="road",wt=!!Q.elevation||rt;let{x:pt,y:Ot,z:Kt}=Q.projection.projectTilePoint(ot.x,ot.y,W.canonical),ht=null;if(wt){const fr=rt?y.getElevationFeatureForText(Ve):null;ht={getElevation:z,elevation:Q.elevation,elevationFeature:fr};const[Nr,Tn,Nn]=z(ot,Q.elevation,fr);pt+=Nr,Ot+=Tn,Kt+=Nn}const et=[pt,Ot,Kt,1];if(i.aC(et,et,s),!Qb(et,ue)){$u(Me,xe);continue}const It=et[3],mt=Jb(h.transform.getCameraToCenterDistance(Q.projection),It),Lt=i.bL(K,re,Fe),Jt=O?Lt/mt:Lt*mt,yr=Qa(pt,Ot,Kt,w);if(yr[3]<=0){$u(Me,xe);continue}let Wt={};const Xt=i.an(y.layers[0].layout.get("text-max-angle")),br=Math.cos(Xt),hr=O?null:ht,cr=lA(Fe,Jt,!1,D,s,w,P,y.glyphOffsetArray,Ee,xe,me,yr,ot,Wt,Ae,hr,Q.projection,W,O,br);Re=cr.useVertical,hr&&cr.needsFlipping&&(Wt={}),(cr.notEnoughRoom||Re||cr.needsFlipping&&lA(Fe,Jt,!0,D,s,w,P,y.glyphOffsetArray,Ee,xe,me,yr,ot,Wt,Ae,hr,Q.projection,W,O,br).notEnoughRoom)&&$u(Me,xe)}v?(y.text.dynamicLayoutVertexBuffer.updateData(xe),me&&y.text.globeExtVertexBuffer&&y.text.globeExtVertexBuffer.updateData(me)):(y.icon.dynamicLayoutVertexBuffer.updateData(xe),me&&y.icon.globeExtVertexBuffer&&y.icon.globeExtVertexBuffer.updateData(me))}function ri(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe){const{lineStartIndex:me,glyphStartIndex:Ee,segment:Ie}=D,Ae=Ee+D.numGlyphs,Be=me+D.lineLength,Re=s.getoffsetX(Ee),Ve=s.getoffsetX(Ae-1),Fe=Eg(y*Re,h,v,w,P,O,Ie,me,Be,z,W,H,Q,K,!0,re,le,ue,xe);if(!Fe)return null;const Me=Eg(y*Ve,h,v,w,P,O,Ie,me,Be,z,W,H,Q,K,!0,re,le,ue,xe);return Me?{first:Fe,last:Me}:null}function tw(y,s,h,v){return y===i.bK.horizontal&&Math.abs(v)>Math.abs(h)?{useVertical:!0}:y===i.bK.vertical?v>0?{needsFlipping:!0}:null:s!==vl.unknown&&function(w,P){return w===0||Math.abs(P/w)>wg}(h,v)?s===vl.flipRequired?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function lA(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee,Ie){const Ae=s/24,Be=y.lineOffsetX*Ae,Re=y.lineOffsetY*Ae,{lineStartIndex:Ve,glyphStartIndex:Fe,numGlyphs:Me,segment:qe,writingMode:ot,flipState:rt}=y,wt=Ve+y.lineLength,pt=Ot=>{if(H){const[It,mt,Lt]=Ot.up,Jt=W.length;i.bM(H,Jt+0,It,mt,Lt),i.bM(H,Jt+1,It,mt,Lt),i.bM(H,Jt+2,It,mt,Lt),i.bM(H,Jt+3,It,mt,Lt)}const[Kt,ht,et]=Ot.point;i.bN(W,Kt,ht,et,Ot.angle)};if(Me>1){const Ot=ri(Ae,D,Be,Re,h,Q,K,y,z,P,re,ue,!1,xe,me,Ee,Ie);if(!Ot)return{notEnoughRoom:!0};if(v&&!h){let[Kt,ht,et]=Ot.first.point,[It,mt,Lt]=Ot.last.point;[Kt,ht]=Qa(Kt,ht,et,O),[It,mt]=Qa(It,mt,Lt,O);const Jt=tw(ot,rt,(It-Kt)*le,mt-ht);if(y.flipState=Jt&&Jt.needsFlipping?vl.flipRequired:vl.flipNotRequired,Jt)return Jt}pt(Ot.first);for(let Kt=Fe+1;Kt<Fe+Me-1;Kt++){const ht=Eg(Ae*D.getoffsetX(Kt),Be,Re,h,Q,K,qe,Ve,wt,z,P,re,ue,!1,!1,xe,me,Ee,Ie);if(!ht)return W.length-=4*(Kt-Fe),{notEnoughRoom:!0};pt(ht)}pt(Ot.last)}else{if(v&&!h){const Kt=Qa(K.x,K.y,0,w),ht=Ve+qe+1,et=new i.P(z.getx(ht),z.gety(ht)),It=Qa(et.x,et.y,0,w),mt=It[3]>0?It:$r(K,et,Kt,1,w,void 0,xe,me.canonical),Lt=tw(ot,rt,(mt[0]-Kt[0])*le,mt[1]-Kt[1]);if(y.flipState=Lt&&Lt.needsFlipping?vl.flipRequired:vl.flipNotRequired,Lt)return Lt}const Ot=Eg(Ae*D.getoffsetX(Fe),Be,Re,h,Q,K,qe,Ve,wt,z,P,re,ue,!1,!1,xe,me,Ee,Ie);if(!Ot)return{notEnoughRoom:!0};pt(Ot)}return{}}function cA(y,s,h,v,w){const{x:P,y:O,z:D}=v.projectTilePoint(y.x,y.y,s);if(!w)return Qa(P,O,D,h);const[z,W,H]=w.getElevation(y,w.elevation,w.elevationFeature);return Qa(P+z,O+W,D+H,h)}function $r(y,s,h,v,w,P,O,D){const z=cA(y.sub(s)._unit()._add(y),D,w,O,P);return i.av(z,h,z),i.aw(z,z),i.bG(z,h,z,v)}function Eg(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee){const Ie=v?y-s:y+s;let Ae=Ie>0?1:-1,Be=0;v&&(Ae*=-1,Be=Math.PI),Ae<0&&(Be+=Math.PI);let Re=D+O+(Ae>0?0:1)|0,Ve=w,Fe=w,Me=0,qe=0;const ot=Math.abs(Ie),rt=[],wt=[];let pt=P,Ot=pt,Kt=i.bE([]);const ht=()=>$r(Ot,pt,Fe,ot-Me+1,H,K,ue,xe.canonical);for(;Me+qe<=ot;){if(Re+=Ae,Re<D||Re>=z)return null;if(Fe=Ve,Ot=pt,rt.push(Fe),re&&wt.push(Ot),pt=new i.P(W.getx(Re),W.gety(Re)),Ve=Q[Re],!Ve){const hr=cA(pt,xe.canonical,H,ue,K);Ve=hr[3]>0?Q[Re]=hr:ht()}Me+=qe;const Xt=i.av([],Ve,Fe),br=i.bF(Fe,Ve);if(h&&br>0&&qe>0&&i.bI(Kt,Xt)/(qe*br)<Ee)return null;qe=br,Kt=Xt}le&&K&&(Q[Re]&&(Ve=ht(),qe=i.bF(Fe,Ve),Kt=i.av([],Ve,Fe)),Q[Re]=Ve);const et=(ot-Me)/qe,It=pt.sub(Ot)._mult(et)._add(Ot),mt=i.bG([],Fe,Kt,et);let Lt=[0,0,1],Jt=Kt[0],yr=Kt[1];if(me&&(Lt=ue.upVector(xe.canonical,It.x,It.y),Lt[0]!==0||Lt[1]!==0||Lt[2]!==1)){const Xt=[Lt[2],0,-Lt[0]],br=i.bH([],Lt,Xt);i.aw(Xt,Xt),i.aw(br,br),Jt=i.bI(Kt,Xt),yr=i.bI(Kt,br)}if(h){const Xt=i.bH([],Lt,Kt);i.aw(Xt,Xt),i.bG(mt,mt,Xt,h*Ae)}const Wt=Be+Math.atan2(yr,Jt);return rt.push(mt),re&&wt.push(It),{point:mt,angle:Wt,path:rt,tilePath:wt,up:Lt}}function $u(y,s){const h=s.length,v=h+4*y;s.resize(v),s.float32.fill(-1/0,4*h,4*v)}function Ql(y,s,h){const v=s[0],w=s[1];return y[0]=h[0]*v+h[4]*w+h[12],y[1]=h[1]*v+h[5]*w+h[13],y[3]=h[3]*v+h[7]*w+h[15],y}const ec=100;class Yf{constructor(s,h,v=new bg(s.width+200,s.height+200,25),w=new bg(s.width+200,s.height+200,25)){this.transform=s,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ec,this.screenBottomBoundary=s.height+ec,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,v,w,P,O,D,z,W,H,Q){let K=v.projectedAnchorX,re=v.projectedAnchorY,le=v.projectedAnchorZ;const ue=v.tileAnchorX,xe=v.tileAnchorY,me=v.elevation,Ee=v.tileID,Ie=s.getProjection();if(me&&Ee){const[wt,pt,Ot]=Ie.upVector(Ee.canonical,v.tileAnchorX,v.tileAnchorY),Kt=Ie.upVectorScale(Ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=wt*me*Kt,re+=pt*me*Kt,le+=Ot*me*Kt}const Ae=s.projection.name==="globe",Be=s.projection.name==="globe"?i.aj(this.transform.zoom):0;if(Ee&&Ae&&Be<1&&!O){const wt=1<<Ee.canonical.z,pt=i.bO(ue,xe);i.bP(pt,pt,1/i.al),i.bQ(pt,pt,i.bO(Ee.canonical.x,Ee.canonical.y)),i.bP(pt,pt,1/wt),i.bR(pt,pt,i.bO(w[0],w[1])),pt[0]=i.bS(pt[0],-.5,.5),i.bP(pt,pt,i.al);const Ot=i.bT(pt[0],pt[1],i.al/(2*Math.PI),1);i.aC(Ot,Ot,P),K=i.ak(K,Ot[0],Be),re=i.ak(re,Ot[1],Be),le=i.ak(le,Ot[2],Be)}const Re=this.projectAndGetPerspectiveRatio(H,K,re,le,v.tileID,Ie.name==="globe"||!!me||this.transform.pitch>0,Ie),Ve=W*Re.perspectiveRatio,Fe=(v.x1*h+D.x-v.padding)*Ve+Re.point.x,Me=(v.y1*h+D.y-v.padding)*Ve+Re.point.y,qe=(v.x2*h+D.x+v.padding)*Ve+Re.point.x,ot=(v.y2*h+D.y+v.padding)*Ve+Re.point.y,rt=Re.perspectiveRatio<=.55||Re.occluded;return!this.isInsideGrid(Fe,Me,qe,ot)||!z&&this.grid.hitTest(Fe,Me,qe,ot,Q)||rt?{box:[],offscreen:!1,occluded:Re.occluded}:{box:[Fe,Me,qe,ot],offscreen:this.isOffscreen(Fe,Me,qe,ot),occluded:!1}}placeCollisionCircles(s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe){const me=[],Ee=this.transform.elevation,Ie=s.getProjection(),Ae=s.elevationType==="road",Be=!!Ee||Ae,Re=i.bU.getAtTileOffsetFunc(xe,this.transform.center.lat,this.transform.worldSize,Ie),Ve=new i.P(v.tileAnchorX,v.tileAnchorY),Fe=new i.P(v.tileAnchorX,v.tileAnchorY);let{x:Me,y:qe,z:ot}=Ie.projectTilePoint(Fe.x,Fe.y,xe.canonical),rt=null;if(Be){const br=Ae?s.getElevationFeatureForText(w):null;rt={getElevation:Re,elevation:Ee,elevationFeature:br};const[hr,cr,fr]=Re(Ve,Ee,br);Me+=hr,qe+=cr,ot+=fr}const wt=Ie.name==="globe",pt=this.projectAndGetPerspectiveRatio(z,Me,qe,ot,xe,wt||!!Ee||this.transform.pitch>0,Ie),{perspectiveRatio:Ot}=pt,Kt=(K?D/Ot:D*Ot)/i.bX,ht=Qa(Me,qe,ot,W),et=v.lineOffsetX*Kt,It=v.lineOffsetY*Kt,mt=i.an(s.layers[0].layout.get("text-max-angle")),Lt=Math.cos(mt),Jt=pt.signedDistanceFromCamera>0?ri(Kt,O,et,It,Ae&&v.flipState===1,ht,Fe,v,P,W,{},Be&&!K?rt:null,K&&Be,Ie,xe,K,Lt):null;let yr=!1,Wt=!1,Xt=!0;if(Jt&&!pt.occluded){const br=.5*le*Ot+ue,hr=new i.P(-100,-100),cr=new i.P(this.screenRightBoundary,this.screenBottomBoundary),fr=new LR,{first:Nr,last:Tn}=Jt,Nn=Nr.path.length;let pi=[];for(let on=Nn-1;on>=1;on--)pi.push(Nr.path[on]);for(let on=1;on<Tn.path.length;on++)pi.push(Tn.path[on]);const Wr=2.5*br;H&&(pi=pi.map(([on,oi,Mn],Ti)=>(Be&&!wt&&(Mn=Re(Ti<Nn-1?Nr.tilePath[Nn-1-Ti]:Tn.tilePath[Ti-Nn+2],Ee,rt.elevationFeature)[2]),Qa(on,oi,Mn,H))),pi.some(on=>on[3]<=0)&&(pi=[]));let jn=[];if(pi.length>0){let on=1/0,oi=-1/0,Mn=1/0,Ti=-1/0;for(const Un of pi)on=Math.min(on,Un[0]),Mn=Math.min(Mn,Un[1]),oi=Math.max(oi,Un[0]),Ti=Math.max(Ti,Un[1]);oi>=hr.x&&on<=cr.x&&Ti>=hr.y&&Mn<=cr.y&&(jn=[pi.map(Un=>new i.P(Un[0],Un[1]))],(on<hr.x||oi>cr.x||Mn<hr.y||Ti>cr.y)&&(jn=i.bV(jn,hr.x,hr.y,cr.x,cr.y)))}for(const on of jn){fr.reset(on,.25*br);let oi=0;oi=fr.length<=.5*br?1:Math.ceil(fr.paddedLength/Wr)+1;for(let Mn=0;Mn<oi;Mn++){const Ti=Mn/Math.max(oi-1,1),Un=fr.lerp(Ti),ln=Un.x+ec,Xn=Un.y+ec;me.push(ln,Xn,br,0);const mn=ln-br,Ni=Xn-br,ti=ln+br,Hr=Xn+br;if(Xt=Xt&&this.isOffscreen(mn,Ni,ti,Hr),Wt=Wt||this.isInsideGrid(mn,Ni,ti,Hr),!h&&this.grid.hitTestCircle(ln,Xn,br,re)&&(yr=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:yr,occluded:!1}}}}return{circles:!Q&&yr||!Wt?[]:me,offscreen:Xt,collisionDetected:yr,occluded:pt.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let v=1/0,w=1/0,P=-1/0,O=-1/0;for(const H of s){const Q=new i.P(H.x+ec,H.y+ec);v=Math.min(v,Q.x),w=Math.min(w,Q.y),P=Math.max(P,Q.x),O=Math.max(O,Q.y),h.push(Q)}const D=this.grid.query(v,w,P,O).concat(this.ignoredGrid.query(v,w,P,O)),z={},W={};for(const H of D){const Q=H.key;if(z[Q.bucketInstanceId]===void 0&&(z[Q.bucketInstanceId]={}),z[Q.bucketInstanceId][Q.featureIndex])continue;const K=[new i.P(H.x1,H.y1),new i.P(H.x2,H.y1),new i.P(H.x2,H.y2),new i.P(H.x1,H.y2)];i.bW(h,K)&&(z[Q.bucketInstanceId][Q.featureIndex]=!0,W[Q.bucketInstanceId]===void 0&&(W[Q.bucketInstanceId]=[]),W[Q.bucketInstanceId].push(Q.featureIndex))}return W}insertCollisionBox(s,h,v,w,P){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:P},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,v,w,P){const O=h?this.ignoredGrid:this.grid,D={bucketInstanceId:v,featureIndex:w,collisionGroupID:P};for(let z=0;z<s.length;z+=4)O.insertCircle(D,s[z],s[z+1],s[z+2])}projectAndGetPerspectiveRatio(s,h,v,w,P,O,D){const z=[h,v,w,1];let W=!1;w||this.transform.pitch>0?(i.aC(z,z,s),this.fogState&&P&&D.name!=="globe"&&(W=function(K,re,le,ue,xe,me){const Ee=me.calculateFogTileMatrix(xe),Ie=[re,le,ue];return i.af(Ie,Ie,Ee),Ht(K,i.ag(Ie),me.pitch,me._fov)}(this.fogState,h,v,w,P.toUnwrapped(),this.transform)>.9)):Ql(z,z,s);const H=z[3];return{point:new i.P((z[0]/H+1)/2*this.transform.width+ec,(-z[1]/H+1)/2*this.transform.height+ec),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(D)/H*.5,1.5),signedDistanceFromCamera:H,occluded:O&&z[2]>H||W}}isOffscreen(s,h,v,w){return v<ec||s>=this.screenRightBoundary||w<ec||h>this.screenBottomBoundary}isInsideGrid(s,h,v,w){return v>=0&&s<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=i.bz([]);return i.bq(s,s,[-100,-100,0]),s}}class Cr{constructor(s,h,v,w){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class $n{constructor(s,h,v,w,P,O=!1){this.text=new Cr(s?s.text:null,h,v,P),this.icon=new Cr(s?s.icon:null,h,w,P),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ei{constructor(s,h,v,w=!1){this.text=s,this.icon=h,this.skipFade=v,this.clipped=w}}class Ys{constructor(){this.invProjMatrix=i.bB(),this.viewportMatrix=i.bB(),this.circles=[]}}class Jf{constructor(s,h,v,w,P){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=P}}class ai{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:v=>v.collisionGroupID===h}}return this.collisionGroups[s]}}function Tg(y,s,h,v,w){const{horizontalAlign:P,verticalAlign:O}=i.c0(y),D=-(P-.5)*s,z=-(O-.5)*h,W=i.c1(y,v);return new i.P(D+W[0]*w,z+W[1]*w)}function Bh(y,s,h,v,w){const P=new i.P(y,s);return h&&P._rotate(v?w:-w),P}class Ag{constructor(s,h,v,w,P,O){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Yf(this.transform,P),this.buildingIndex=O,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ai(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,h,v,w,P=1){const O=v.getBucket(h),D=v.latestFeatureIndex;if(!O||!D||h.fqid!==O.layerIds[0])return;const z=O.layers[0].layout,W=O.layers[0].paint,H=v.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),K=v.tileSize/i.al,re=v.tileID.toUnwrapped();this.transform.setProjection(O.projection);const le=(ue=v.tileID,xe=O.getProjection(),me=this.transform,xe.name===this.projection?me.calculateProjMatrix(ue.toUnwrapped()):zh(me,xe,ue));var ue,xe,me;const Ee=z.get("text-pitch-alignment")==="map",Ie=z.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const Ae=h.dynamicFilter(),Be=h.dynamicFilterNeedsFeature(),Re=this.transform.calculatePixelsToTileUnitsMatrix(v),Ve=Sg(le,v.tileID.canonical,Ee,Ie,this.transform,O.getProjection(),Re);let Fe=null;const Me=O.getProjection().createInversionMatrix(this.transform,v.tileID.canonical);if(Ee){const et=Bu(le,v.tileID.canonical,Ee,Ie,this.transform,O.getProjection(),Re);Fe=i.aB([],this.transform.labelPlaneMatrix,et)}let qe=null;Ae&&v.latestFeatureIndex&&(qe={unwrappedTileID:re,dynamicFilter:Ae,dynamicFilterNeedsFeature:Be}),this.retainedQueryData[O.bucketInstanceId]=new Jf(O.bucketInstanceId,D,O.sourceLayerIndex,O.index,v.tileID);const[ot,rt]=O.layers[0].layout.get("text-size-scale-range"),wt=i.aA(P,ot,rt),[pt,Ot]=z.get("icon-size-scale-range"),Kt=i.aA(P,pt,Ot),ht={bucket:O,layout:z,paint:W,posMatrix:le,invMatrix:Me,mercatorCenter:[i.aF(this.transform.center.lng),i.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ve,labelToScreenMatrix:Fe,clippingData:qe,scale:Q,textPixelRatio:K,holdingForFade:v.holdingForFade(),collisionBoxArray:H,partiallyEvaluatedTextSize:i.bJ(O.textSizeData,this.transform.zoom,wt),partiallyEvaluatedIconSize:i.bJ(O.iconSizeData,this.transform.zoom,Kt),collisionGroup:this.collisionGroups.get(O.sourceID),latestFeatureIndex:v.latestFeatureIndex};if(w)for(const et of O.sortKeyRanges){const{sortKey:It,symbolInstanceStart:mt,symbolInstanceEnd:Lt}=et;s.push({sortKey:It,symbolInstanceStart:mt,symbolInstanceEnd:Lt,parameters:ht})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:O.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee,Ie,Ae,Be){const{textOffset0:Re,textOffset1:Ve,crossTileID:Fe}=ue,Me=[Re,Ve],qe=Tg(s,O,D,Me,z),ot=this.collisionIndex.placeCollisionBox(me,z,h,v,w,P,Bh(qe.x,qe.y,W,H,this.transform.angle),le,Q,K,re.predicate);if(Ie){const rt=me.getSymbolInstanceIconSize(Be,this.transform.zoom,ue.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(me,rt,Ie,v,w,P,Bh(qe.x,qe.y,W,H,this.transform.angle),le,Q,K,re.predicate).box.length===0)return}if(ot.box.length>0){let rt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&(rt=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:Me,width:O,height:D,anchor:s,textScale:z,prevAnchor:rt},this.markUsedJustification(me,s,ue,Ee),me.allowVerticalPlacement&&(this.markUsedOrientation(me,Ee,ue),this.placedOrientations[Fe]=Ee),{shift:qe,placedGlyphBoxes:ot}}}placeLayerBucketPart(s,h,v,w,P=1){const{bucket:O,layout:D,paint:z,posMatrix:W,textLabelPlaneMatrix:H,labelToScreenMatrix:Q,clippingData:K,textPixelRatio:re,mercatorCenter:le,invMatrix:ue,holdingForFade:xe,collisionBoxArray:me,partiallyEvaluatedTextSize:Ee,partiallyEvaluatedIconSize:Ie,collisionGroup:Ae,latestFeatureIndex:Be}=s.parameters,Re=D.get("text-optional"),Ve=D.get("icon-optional"),Fe=D.get("text-allow-overlap"),Me=D.get("icon-allow-overlap"),qe=D.get("text-rotation-alignment")==="map",ot=D.get("icon-rotation-alignment")==="map",rt=D.get("text-pitch-alignment")==="map",wt=z.get("symbol-z-offset"),pt=D.get("symbol-elevation-reference")==="sea",Ot=D.get("symbol-placement"),[Kt,ht]=D.get("text-size-scale-range"),[et,It]=D.get("icon-size-scale-range"),mt=i.aA(P,Kt,ht),Lt=i.aA(P,et,It),Jt=D.get("text-variable-anchor"),yr=qe&&Ot!=="point",Wt=ot&&Ot!=="point",Xt=Jt&&O.hasTextData(),br=O.hasIconTextFit()&&Xt&&O.hasIconData();this.transform.setProjection(O.projection);const hr=Xt||yr,cr=Wt||br;let fr=Fe&&(Me||!O.hasIconData()||Ve),Nr=Me&&(Fe||!O.hasTextData()||Re);const Tn=!wt.isConstant();!O.collisionArrays&&me&&O.deserializeCollisionBoxes(me),v&&w&&O.updateCollisionDebugBuffers(this.transform.zoom,me,mt,Lt);const Nn=(Wr,jn,on)=>{const{crossTileID:oi,numVerticalGlyphVertices:Mn}=Wr;let Ti=null;if(K&&K.dynamicFilterNeedsFeature||Tn){const ia=this.retainedQueryData[O.bucketInstanceId];Ti=Be.loadFeature({featureIndex:Wr.featureIndex,bucketIndex:ia.bucketIndex,sourceLayerIndex:ia.sourceLayerIndex,layoutVertexArrayOffset:0})}if(K&&!(0,K.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:O.worldview},Ti,this.retainedQueryData[O.bucketInstanceId].tileID.canonical,new i.P(Wr.tileAnchorX,Wr.tileAnchorY),this.transform.calculateDistanceTileData(K.unwrappedTileID)))return this.placements[oi]=new ei(!1,!1,!1,!0),void h.add(oi);const Un=wt.evaluate(Ti,{});if(h.has(oi))return;if(xe)return void(this.placements[oi]=new ei(!1,!1,!1));let ln=!1,Xn=!1,mn=!0,Ni=!1,ti=!1,Hr=null,Ln={box:null,offscreen:null,occluded:null},Xi={box:null},xa=null,ta=null,ca=null,Fs=0,Ss=0,Ro=0;on.textFeatureIndex?Fs=on.textFeatureIndex:Wr.useRuntimeCollisionCircles&&(Fs=Wr.featureIndex),on.verticalTextFeatureIndex&&(Ss=on.verticalTextFeatureIndex);const qo=O.elevationFeatures?O.elevationFeatures[Wr.elevationFeatureIndex]:void 0,Sl=ia=>{ia.tileID=this.retainedQueryData[O.bucketInstanceId].tileID;const ba=this.transform.elevation;ia.elevation=pt?Un:Un+i.bU.getAtTileOffset(ia.tileID,new i.P(ia.tileAnchorX,ia.tileAnchorY),ba,qo),ia.elevation+=Wr.zOffset},jo=on.textBox;if(jo){Sl(jo);const ia=Si=>{let Ta=i.bK.horizontal;if(O.allowVerticalPlacement&&!Si&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[oi];mo&&(this.placedOrientations[oi]=mo,Ta=mo,this.markUsedOrientation(O,Ta,Wr))}return Ta},ba=(Si,Ta)=>{if(O.allowVerticalPlacement&&Mn>0&&on.verticalTextBox){for(const mo of O.writingModes)if(mo===i.bK.vertical?(Ln=Ta(),Xi=Ln):Ln=Si(),Ln&&Ln.box&&Ln.box.length)break}else Ln=Si()};if(Jt){let Si=Jt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oi]){const aa=this.prevPlacement.variableOffsets[oi];Si.indexOf(aa.anchor)>0&&(Si=Si.filter(Tl=>Tl!==aa.anchor),Si.unshift(aa.anchor))}const Ta=(aa,Tl,Op)=>{const Yu=O.getSymbolInstanceTextSize(Ee,Wr,this.transform.zoom,jn),Ip=(aa.x2-aa.x1)*Yu+2*aa.padding,kp=(aa.y2-aa.y1)*Yu+2*aa.padding,Al=Wr.hasIconTextFit&&!Me?Tl:null;Al&&Sl(Al);let lu={box:[],offscreen:!1,occluded:!1};const co=Fe?2*Si.length:Si.length;for(let Pl=0;Pl<co;++Pl){const ef=this.attemptAnchorPlacement(Si[Pl%Si.length],aa,le,ue,hr,Ip,kp,Yu,qe,rt,re,W,Ae,Pl>=Si.length,Wr,jn,O,Op,Al,Ee,Ie);if(ef&&(lu=ef.placedGlyphBoxes,lu&&lu.box&&lu.box.length)){ln=!0,Hr=ef.shift;break}}return lu};ba(()=>Ta(jo,on.iconBox,i.bK.horizontal),()=>{const aa=on.verticalTextBox;return aa&&Sl(aa),O.allowVerticalPlacement&&!(Ln&&Ln.box&&Ln.box.length)&&Mn>0&&aa?Ta(aa,on.verticalIconBox,i.bK.vertical):{box:null,offscreen:null,occluded:null}}),Ln&&(ln=Ln.box,mn=Ln.offscreen,Ni=Ln.occluded);const mo=ia(!(!Ln||!Ln.box));if(!ln&&this.prevPlacement){const aa=this.prevPlacement.variableOffsets[oi];aa&&(this.variableOffsets[oi]=aa,this.markUsedJustification(O,aa.anchor,Wr,mo))}}else{const Si=(Ta,mo)=>{const aa=O.getSymbolInstanceTextSize(Ee,Wr,this.transform.zoom,jn),Tl=this.collisionIndex.placeCollisionBox(O,aa,Ta,le,ue,hr,new i.P(0,0),Fe,re,W,Ae.predicate);return Tl&&Tl.box&&Tl.box.length&&(this.markUsedOrientation(O,mo,Wr),this.placedOrientations[oi]=mo),Tl};ba(()=>Si(jo,i.bK.horizontal),()=>{const Ta=on.verticalTextBox;return O.allowVerticalPlacement&&Mn>0&&Ta?(Sl(Ta),Si(Ta,i.bK.vertical)):{box:null,offscreen:null,occluded:null}}),ia(!!(Ln&&Ln.box&&Ln.box.length))}}if(xa=Ln,ln=xa&&xa.box&&xa.box.length>0,mn=xa&&xa.offscreen,Ni=xa&&xa.occluded,Wr.useRuntimeCollisionCircles){const ia=Wr.centerJustifiedTextSymbolIndex>=0?Wr.centerJustifiedTextSymbolIndex:Wr.verticalPlacedTextSymbolIndex,ba=O.text.placedSymbolArray.get(ia),Si=i.bL(O.textSizeData,Ee,ba),Ta=D.get("text-padding");ta=this.collisionIndex.placeCollisionCircles(O,Fe,ba,ia,O.lineVertexArray,O.glyphOffsetArray,Si,W,H,Q,v,rt,Ae.predicate,Wr.collisionCircleDiameter*Si/i.bX,Ta,this.retainedQueryData[O.bucketInstanceId].tileID),ln=Fe||ta.circles.length>0&&!ta.collisionDetected,mn=mn&&ta.offscreen,Ni=ta.occluded}if(on.iconFeatureIndex&&(Ro=on.iconFeatureIndex),on.iconBox){const ia=ba=>{Sl(ba);const Si=Wr.hasIconTextFit&&Hr?Bh(Hr.x,Hr.y,qe,rt,this.transform.angle):new i.P(0,0),Ta=O.getSymbolInstanceIconSize(Ie,this.transform.zoom,Wr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(O,Ta,ba,le,ue,cr,Si,Me,re,W,Ae.predicate)};Xi&&Xi.box&&Xi.box.length&&on.verticalIconBox?(ca=ia(on.verticalIconBox),Xn=ca.box.length>0):(ca=ia(on.iconBox),Xn=ca.box.length>0),mn=mn&&ca.offscreen,ti=ca.occluded}const El=Re||Wr.numHorizontalGlyphVertices===0&&Mn===0,sc=Ve||Wr.numIconVertices===0;if(El||sc?sc?El||(Xn=Xn&&ln):ln=Xn&&ln:Xn=ln=Xn&&ln,ln&&xa&&xa.box&&this.collisionIndex.insertCollisionBox(xa.box,D.get("text-ignore-placement"),O.bucketInstanceId,Xi&&Xi.box&&Ss?Ss:Fs,Ae.ID),Xn&&ca&&this.collisionIndex.insertCollisionBox(ca.box,D.get("icon-ignore-placement"),O.bucketInstanceId,Ro,Ae.ID),ta&&(ln&&this.collisionIndex.insertCollisionCircles(ta.circles,D.get("text-ignore-placement"),O.bucketInstanceId,Fs,Ae.ID),v)){const ia=O.bucketInstanceId;let ba=this.collisionCircleArrays[ia];ba===void 0&&(ba=this.collisionCircleArrays[ia]=new Ys);for(let Si=0;Si<ta.circles.length;Si+=4)ba.circles.push(ta.circles[Si+0]),ba.circles.push(ta.circles[Si+1]),ba.circles.push(ta.circles[Si+2]),ba.circles.push(ta.collisionDetected?1:0)}const po=O.projection.name!=="globe";fr=fr&&(po||!Ni),Nr=Nr&&(po||!ti),this.placements[oi]=new ei(ln||fr,Xn||Nr,mn||O.justReloaded),h.add(oi)},pi=this.retainedQueryData[O.bucketInstanceId].tileID;if(O.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(O,pi),O.elevationType==="road"&&O.updateRoadElevation(pi.canonical),O.updateZOffset(),O.sortFeaturesByY){const Wr=O.getSortedSymbolIndexes(this.transform.angle);for(let jn=Wr.length-1;jn>=0;--jn){const on=Wr[jn];Nn(O.symbolInstances.get(on),on,O.collisionArrays[on])}O.hasAnyZOffset&&i.w(`${O.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(O.hasAnyZOffset){const Wr=O.getSortedIndexesByZOffset();for(let jn=0;jn<Wr.length;++jn){const on=Wr[jn];Nn(O.symbolInstances.get(on),on,O.collisionArrays[on])}}else for(let Wr=s.symbolInstanceStart;Wr<s.symbolInstanceEnd;Wr++)Nn(O.symbolInstances.get(Wr),Wr,O.collisionArrays[Wr]);if(v&&O.bucketInstanceId in this.collisionCircleArrays){const Wr=this.collisionCircleArrays[O.bucketInstanceId];i.bk(Wr.invProjMatrix,W),Wr.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1}markUsedJustification(s,h,v,w){const{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:z,crossTileID:W}=v,H=i.c2(h),Q=w===i.bK.vertical?z:H==="left"?P:H==="center"?O:H==="right"?D:-1;P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=Q>=0&&P!==Q?0:W),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=Q>=0&&O!==Q?0:W),D>=0&&(s.text.placedSymbolArray.get(D).crossTileID=Q>=0&&D!==Q?0:W),z>=0&&(s.text.placedSymbolArray.get(z).crossTileID=Q>=0&&z!==Q?0:W)}markUsedOrientation(s,h,v){const w=h===i.bK.horizontal||h===i.bK.horizontalOnly?h:0,P=h===i.bK.vertical?h:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:D,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:W}=v,H=s.text.placedSymbolArray;O>=0&&(H.get(O).placedOrientation=w),D>=0&&(H.get(D).placedOrientation=w),z>=0&&(H.get(z).placedOrientation=w),W>=0&&(H.get(W).placedOrientation=P)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let v=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(s):1,P=h?h.opacities:{},O=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const z in this.placements){const W=this.placements[z],H=P[z];H?(this.opacities[z]=new $n(H,w,W.text,W.icon,null,W.clipped),v=v||W.text!==H.text.placed||W.icon!==H.icon.placed):(this.opacities[z]=new $n(null,w,W.text,W.icon,W.skipFade,W.clipped),v=v||W.text||W.icon)}for(const z in P){const W=P[z];if(!this.opacities[z]){const H=new $n(W,w,!1,!1);H.isHidden()||(this.opacities[z]=H,v=v||W.text.placed||W.icon.placed)}}for(const z in O)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=O[z]);for(const z in D)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=D[z]);v?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,v,w){const P=new Set;for(const O of h){const D=O.getBucket(s);D&&O.latestFeatureIndex&&s.fqid===D.layerIds[0]&&(this.updateBucketOpacities(D,P,O,O.collisionBoxArray,v,w,O.tileID,s.scope),D.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(D,O.tileID),D.elevationType==="road"&&D.updateRoadElevation(O.tileID.canonical),D.updateZOffset())}}updateBucketOpacities(s,h,v,w,P,O,D,z){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const W=s.layers[0].layout,H=s.layers[0].paint,Q=!!s.layers[0].dynamicFilter(),K=new $n(null,0,!1,!1,!0),re=W.get("text-allow-overlap"),le=W.get("icon-allow-overlap"),ue=W.get("text-variable-anchor"),xe=W.get("text-rotation-alignment")==="map",me=W.get("text-pitch-alignment")==="map",Ee=H.get("symbol-z-offset"),Ie=W.get("symbol-elevation-reference")==="sea",Ae=!Ee.isConstant(),Be=new $n(null,0,re&&(le||!s.hasIconData()||W.get("icon-optional")),le&&(re||!s.hasTextData()||W.get("text-optional")),!0);!s.collisionArrays&&w&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(w);const Re=(Fe,Me,qe)=>{for(let ot=0;ot<Me/4;ot++)Fe.opacityVertexArray.emplaceBack(qe)};let Ve=0;O&&s.updateReplacement(D,O);for(let Fe=0;Fe<s.symbolInstances.length;Fe++){const Me=s.symbolInstances.get(Fe),{numHorizontalGlyphVertices:qe,numVerticalGlyphVertices:ot,crossTileID:rt,numIconVertices:wt,tileAnchorX:pt,tileAnchorY:Ot}=Me;let Kt=null;const ht=this.retainedQueryData[s.bucketInstanceId];Ae&&Me&&ht&&(Kt=v.latestFeatureIndex.loadFeature({featureIndex:Me.featureIndex,bucketIndex:ht.bucketIndex,sourceLayerIndex:ht.sourceLayerIndex,layoutVertexArrayOffset:0}));const et=Ee.evaluate(Kt,{}),It=h.has(rt);let mt=this.opacities[rt];It?mt=K:mt||(mt=Be,this.opacities[rt]=mt),h.add(rt);const Lt=qe>0||ot>0,Jt=wt>0,yr=this.placedOrientations[rt],Wt=yr===i.bK.vertical,Xt=yr===i.bK.horizontal||yr===i.bK.horizontalOnly;!Lt&&!Jt||mt.isHidden()||Ve++;let br=!1;if((Lt||Jt)&&O)for(const hr of s.activeReplacements){if(i.bY(hr,P,i.bZ.Symbol,z)||hr.min.x>pt||pt>hr.max.x||hr.min.y>Ot||Ot>hr.max.y)continue;const cr=i.b_(pt,Ot,D.canonical,hr.footprintTileId.canonical);if(br=i.b$(cr,hr.footprint),br)break}if(Lt){const hr=br?fo:Og(mt.text);Re(s.text,qe,Wt?fo:hr),Re(s.text,ot,Xt?fo:hr);const cr=mt.text.isHidden(),{leftJustifiedTextSymbolIndex:fr,centerJustifiedTextSymbolIndex:Nr,rightJustifiedTextSymbolIndex:Tn,verticalPlacedTextSymbolIndex:Nn}=Me,pi=s.text.placedSymbolArray,Wr=cr||Wt?1:0;fr>=0&&(pi.get(fr).hidden=Wr),Nr>=0&&(pi.get(Nr).hidden=Wr),Tn>=0&&(pi.get(Tn).hidden=Wr),Nn>=0&&(pi.get(Nn).hidden=cr||Xt?1:0);const jn=this.variableOffsets[rt];jn&&this.markUsedJustification(s,jn.anchor,Me,yr);const on=this.placedOrientations[rt];on&&(this.markUsedJustification(s,"left",Me,on),this.markUsedOrientation(s,on,Me))}if(Jt){const hr=br?fo:Og(mt.icon),{placedIconSymbolIndex:cr,verticalPlacedIconSymbolIndex:fr}=Me,Nr=s.icon.placedSymbolArray,Tn=mt.icon.isHidden()?1:0;cr>=0&&(Re(s.icon,wt,Wt?fo:hr),Nr.get(cr).hidden=Tn),fr>=0&&(Re(s.icon,Me.numVerticalIconVertices,Xt?fo:hr),Nr.get(fr).hidden=Tn)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const hr=s.collisionArrays[Fe];if(hr){let cr=new i.P(0,0),fr=!0;if(hr.textBox||hr.verticalTextBox){if(ue){const Tn=this.variableOffsets[rt];Tn?(cr=Tg(Tn.anchor,Tn.width,Tn.height,Tn.textOffset,Tn.textScale),xe&&cr._rotate(me?this.transform.angle:-this.transform.angle)):fr=!1}Q&&(fr=!mt.clipped),hr.textBox&&bo(s.textCollisionBox.collisionVertexArray,mt.text.placed,!fr||Wt,et,Ie,cr.x,cr.y),hr.verticalTextBox&&bo(s.textCollisionBox.collisionVertexArray,mt.text.placed,!fr||Xt,et,Ie,cr.x,cr.y)}const Nr=fr&&!!(!Xt&&hr.verticalIconBox);hr.iconBox&&bo(s.iconCollisionBox.collisionVertexArray,mt.icon.placed,Nr,et,Ie,Me.hasIconTextFit?cr.x:0,Me.hasIconTextFit?cr.y:0),hr.verticalIconBox&&bo(s.iconCollisionBox.collisionVertexArray,mt.icon.placed,!Nr,et,Ie,Me.hasIconTextFit?cr.x:0,Me.hasIconTextFit?cr.y:0)}}}if(s.fullyClipped=Ve===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Fe.invProjMatrix,s.placementViewportMatrix=Fe.viewportMatrix,s.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const v=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*v>s}setStale(){this.stale=!0}}function bo(y,s,h,v,w,P,O){y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0),y.emplaceBack(s?1:0,h?1:0,P||0,O||0,v,w?1:0)}const Va=Math.pow(2,25),FR=Math.pow(2,24),Pg=Math.pow(2,17),rw=Math.pow(2,16),Cg=Math.pow(2,9),zv=Math.pow(2,8),nw=Math.pow(2,1);function Og(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const s=y.placed?1:0,h=Math.floor(127*y.opacity);return h*Va+s*FR+h*Pg+s*rw+h*Cg+s*zv+h*nw+s}const fo=0;class Uu{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,v,w,P,O){const D=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(D,w,s[this._currentTileIndex],this._sortAcrossTiles,O),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((z,W)=>z.sortKey-W.sortKey));this._currentPartIndex<D.length;){const z=D[this._currentPartIndex];if(h.placeLayerBucketPart(z,this._seenCrossTileIDs,v,z.symbolInstanceStart===0,O),this._currentPartIndex++,P())return!0}return!1}}class Ms{constructor(s,h,v,w,P,O,D,z,W){this.placement=new Ag(s,P,O,D,z,W),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(s,h,v,w,P){const O=i.o.now(),D=()=>{const z=i.o.now()-O;return!this._forceFullPlacement&&z>2};for(;this._currentPlacementIndex>=0;){const z=h[s[this._currentPlacementIndex]],W=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=W)&&(!z.maxzoom||z.maxzoom>W)){const H=z,Q=H.layout.get("symbol-z-elevate"),K=H.layout.get("symbol-sort-key").constantOr(1)!==void 0,re=H.layout.get("symbol-z-order"),le=re==="viewport-y"||re==="auto"&&!(re!=="viewport-y"&&K),ue=H.layout.get("text-allow-overlap")||H.layout.get("icon-allow-overlap")||H.layout.get("text-ignore-placement")||H.layout.get("icon-ignore-placement"),xe=le&&ue,me=this._inProgressLayer=this._inProgressLayer||new Uu(H),Ee=i.B(z.source,z.scope);if(me.continuePlacement(Q||xe?w[Ee]:v[Ee],this.placement,this._showCollisionBoxes,z,D,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Bv=512/i.al/2;class Qf{constructor(s,h,v){this.tileID=s,this.bucketInstanceId=v,this.index=new i.c3(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=s.canonical.x*i.al,P=s.canonical.y*i.al;for(let O=0;O<h.length;O++){const{key:D,crossTileID:z,tileAnchorX:W,tileAnchorY:H}=h.get(O),Q=Math.floor((w+W)*Bv),K=Math.floor((P+H)*Bv);this.index.add(Q,K),this.keys.push(D),this.crossTileIDs.push(z)}this.index.finish()}findMatches(s,h,v){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),P=Bv/Math.pow(2,h.canonical.z-this.tileID.canonical.z),O=h.canonical.x*i.al,D=h.canonical.y*i.al;for(let z=0;z<s.length;z++){const W=s.get(z);if(W.crossTileID)continue;const{key:H,tileAnchorX:Q,tileAnchorY:K}=W,re=Math.floor((O+Q)*P),le=Math.floor((D+K)*P),ue=this.index.range(re-w,le-w,re+w,le+w).sort((xe,me)=>xe-me);for(const xe of ue){const me=this.crossTileIDs[xe];if(this.keys[xe]===H&&!v.has(me)){v.add(me),W.crossTileID=me;break}}}}}class lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const v in this.indexes){const w=this.indexes[v],P={};for(const O in w){const D=w[O];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),P[D.tileID.key]=D}this.indexes[v]=P}this.lng=s}addBucket(s,h,v){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let P=0;P<h.symbolInstances.length;P++)h.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const w=this.usedCrossTileIDs[s.overscaledZ];for(const P in this.indexes){const O=this.indexes[P];if(Number(P)>s.overscaledZ)for(const D in O){const z=O[D];z.tileID.isChildOf(s)&&z.findMatches(h.symbolInstances,s,w)}else{const D=O[s.scaledTo(Number(P)).key];D&&D.findMatches(h.symbolInstances,s,w)}}for(let P=0;P<h.symbolInstances.length;P++){const O=h.symbolInstances.get(P);O.crossTileID||(O.crossTileID=v.generate(),w.add(O.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Qf(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const v of h.crossTileIDs)this.usedCrossTileIDs[s].delete(v)}removeStaleBuckets(s){let h=!1;for(const v in this.indexes){const w=this.indexes[v];for(const P in w)s[w[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[P]),delete w[P],h=!0)}return h}}class Vu{constructor(){this.layerIndexes={},this.crossTileIDs=new lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,v,w){let P=this.layerIndexes[s.fqid];P===void 0&&(P=this.layerIndexes[s.fqid]=new nu);let O=!1;const D={};w.name!=="globe"&&P.handleWrapJump(v);for(const z of h){const W=z.getBucket(s);W&&s.fqid===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),P.addBucket(z.tileID,W,this.crossTileIDs)&&(O=!0),D[W.bucketInstanceId]=!0)}return P.removeStaleBuckets(D)&&(O=!0),O}pruneUnusedLayers(s){const h={};s.forEach(v=>{h[v]=!0});for(const v in this.layerIndexes)h[v]||delete this.layerIndexes[v]}}const Ea=771;class pn{constructor(s,h,v,w){this.blendFunction=s,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=v,this.blendEquation=w}}pn.Replace=[1,0,1,0],pn.disabled=new pn(pn.Replace,i.ao.transparent,[!1,!1,!1,!1]),pn.unblended=new pn(pn.Replace,i.ao.transparent,[!0,!0,!0,!0]),pn.alphaBlended=new pn([1,Ea,1,Ea],i.ao.transparent,[!0,!0,!0,!0]),pn.alphaBlendedNonPremultiplied=new pn([770,Ea,770,Ea],i.ao.transparent,[!0,!0,!0,!0]),pn.multiply=new pn([774,0,774,0],i.ao.transparent,[!0,!0,!0,!0]),pn.additive=new pn([1,1,1,1],i.ao.transparent,[!0,!0,!0,!0]);class Sr{constructor(s,h,v){this.func=s,this.mask=h,this.range=v}}Sr.ReadOnly=!1,Sr.ReadWrite=!0,Sr.disabled=new Sr(519,Sr.ReadOnly,[0,1]);const $h=7680;class Xr{constructor(s,h,v,w,P,O){this.test=s,this.ref=h,this.mask=v,this.fail=w,this.depthFail=P,this.pass=O}}Xr.disabled=new Xr({func:519,mask:0},0,0,$h,$h,$h);const ep=1029,$v=2305;class qr{constructor(s,h,v){this.enable=s,this.mode=h,this.frontFace=v}}function Ig(y,s){const h=i.c9(y,3);i.cb(y,s),i.cf(y,3,h)}function Uv(y,s){const h=i.c6([]);return i.c7(h,h,-s),i.c8(h,h,-y),h}function uA(y,s){const h=[y[0],y[1],0],v=[s[0],s[1],0];if(i.ag(h)>=1e-15){const O=i.aw([],h);i.c4(v,O,i.bI(v,O)),s[0]=v[0],s[1]=v[1]}const w=i.bH([],s,y);if(i.c5(w)<1e-15)return null;const P=Math.atan2(-w[1],w[0]);return Uv(Math.atan2(Math.sqrt(y[0]*y[0]+y[1]*y[1]),-y[2]),P)}qr.disabled=new qr(!1,ep,$v),qr.backCCW=new qr(!0,ep,$v),qr.backCW=new qr(!0,ep,2304),qr.frontCW=new qr(!0,1028,2304),qr.frontCCW=new qr(!0,1028,$v);class iu{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof i.ae?s:new i.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=i.bS(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h,v){if(this.orientation=null,!this.position)return;const w=this.position,P=v||(this._elevation?this._elevation.getAtPointOrZero(i.ae.fromLngLat(s)):0),O=i.ae.fromLngLat(s,P),D=[O.x-w.x,O.y-w.y,O.z-w.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=uA(D,h)}setPitchBearing(s,h){this.orientation=Uv(i.an(s),i.an(-h))}}class Vv{constructor(s,h){this._transform=i.bz([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new i.ae(s[0],s[1],s[2])}get position(){const s=i.c9(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&i.cf(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||i.c6([]),s&&Ig(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Uv(s,h),Ig(this._transform,this._orientation)}forward(){const s=i.c9(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=i.c9(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=i.c9(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const v=new Float64Array(16);return i.bk(v,this.getWorldToCamera(s,h)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,v){const w=this.position;i.c4(w,w,-s);const P=new Float64Array(16);return i.bp(P,[v,v,v]),i.bq(P,P,w),P[10]*=h,P}getWorldToCamera(s,h){const v=new Float64Array(16),w=new Float64Array(4),P=this.position;return i.ca(w,this._orientation),i.c4(P,P,-s),i.cb(v,w),i.bq(v,v,P),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=h,v[9]*=h,v[10]*=h,v[11]*=h,v}getCameraToClipPerspective(s,h,v,w){const P=new Float64Array(16);return i.cc(P,s,h,v,w),P}getCameraToClipOrthographic(s,h,v,w,P,O){const D=new Float64Array(16);return i.cd(D,s,h,v,w,P,O),D}getDistanceToElevation(s,h=!1){const v=s===0?0:i.ce(s,h?i.a_(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new Vv([...this.position],[...this.orientation])}}const wo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class as{constructor(s=0,h=0,v=0,w=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=v,this.right=w}interpolate(s,h,v){return h.top!=null&&s.top!=null&&(this.top=i.ak(s.top,h.top,v)),h.bottom!=null&&s.bottom!=null&&(this.bottom=i.ak(s.bottom,h.bottom,v)),h.left!=null&&s.left!=null&&(this.left=i.ak(s.left,h.left,v)),h.right!=null&&s.right!=null&&(this.right=i.ak(s.right,h.right,v)),this}getCenter(s,h){const v=i.aA((this.left+s-this.right)/2,0,s),w=i.aA((this.top+h-this.bottom)/2,0,h);return new i.P(v,w)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Uh=15;class tp{constructor(s,h,v,w,P,O,D){this.tileSize=512,this._renderWorldCopies=P===void 0||P,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(O),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new i.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new as,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Vv,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new tp(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Uh}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(s||v)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return i.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=i.cl(this.projectionOptions);const v=this.getProjection(),w=!i.bx(h,v);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.cl({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bS(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=i.cm(),i.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=i.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=i.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,P=0;for(let O=0;O<h.length;O++){const D=new i.P(h[O][0]*this.width,v+h[O][1]*(this.height-v)),z=s.pointCoordinate(D);if(!z)continue;const W=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);w+=z[3]*W,P+=W}return P===0?NaN:w/P}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*h,w=this._mercatorZfromZoom(s),P=this._mercatorZfromZoom(this._maxZoom),O=Math.max(w-v,P);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let v;v=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const w=i.ag(i.av([],this._camera.position,v));return i.aA(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!i.co(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const v=[s.position.x,s.position.y,s.position.z];i.cp(v,this._camera.position)||(this._setCameraPosition(v),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new iu;return h.position=new i.ae(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!i.cq(s))return!1;i.cr(s,s);const h=i.cs([],[0,0,-1],s),v=i.cs([],[0,-1,0],s);if(v[2]<0)return!1;const w=uA(h,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;s[2]=i.aA(s[2],w/v,w/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,v){this._unmodified=!1,this._edgeInsets.interpolate(s,h,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new i.ct(0,s)];if(this.renderWorldCopies){const v=this.pointCoordinate(new i.P(0,0)),w=this.pointCoordinate(new i.P(this.width,0)),P=this.pointCoordinate(new i.P(this.width,this.height)),O=this.pointCoordinate(new i.P(0,this.height)),D=Math.floor(Math.min(v.x,w.x,P.x,O.x)),z=Math.floor(Math.max(v.x,w.x,P.x,O.x)),W=1;for(let H=D-W;H<=z+W;H++)H!==0&&h.push(new i.ct(H,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,h,v){let w=[];const P=v!=null,O=!P;if(O&&this.zoom<h||P&&v[0]===0&&v[1]===0)return w;const D=new Set,z=(H,Q,K,re,le)=>{const ue=i.cX(Q,H,K,re,le);D.has(ue)||(w.push(new i.aP(H,Q,K,re,le)),D.add(ue))};for(let H=0;H<s.length;H++){const Q=s[H];if(O&&Q.canonical.z!==h)continue;const K=Q.canonical,re=Q.overscaledZ,le=Q.wrap,ue=1<<K.z,xe=K.x+1<ue,me=K.x>0,Ee=K.y+1<ue,Ie=K.y>0,Ae=Q.wrap-(me?0:1),Be=Q.wrap+(xe?0:1),Re=me?K.x-1:ue-1,Ve=xe?K.x+1:0;if(P)v[0]<0?(z(re,Be,K.z,Ve,K.y),v[1]<0&&Ee&&(z(re,le,K.z,K.x,K.y+1),z(re,Be,K.z,Ve,K.y+1)),v[1]>0&&Ie&&(z(re,le,K.z,K.x,K.y-1),z(re,Be,K.z,Ve,K.y-1))):v[0]>0?(z(re,Ae,K.z,Re,K.y),v[1]<0&&Ee&&(z(re,le,K.z,K.x,K.y+1),z(re,Ae,K.z,Re,K.y+1)),v[1]>0&&Ie&&(z(re,le,K.z,K.x,K.y-1),z(re,Ae,K.z,Re,K.y-1))):v[1]<0&&Ee?z(re,le,K.z,K.x,K.y+1):Ie&&z(re,le,K.z,K.x,K.y-1);else{const Fe=Q.visibleQuadrants;1&Fe&&(z(re,Ae,K.z,Re,K.y),Ie&&(z(re,le,K.z,K.x,K.y-1),z(re,Ae,K.z,Re,K.y-1))),2&Fe&&(z(re,Be,K.z,Ve,K.y),Ie&&(z(re,le,K.z,K.x,K.y-1),z(re,Be,K.z,Ve,K.y-1))),4&Fe&&(z(re,Ae,K.z,Re,K.y),Ee&&(z(re,le,K.z,K.x,K.y+1),z(re,Ae,K.z,Re,K.y+1))),8&Fe&&(z(re,Be,K.z,Ve,K.y),Ee&&(z(re,le,K.z,K.x,K.y+1),z(re,Be,K.z,Ve,K.y+1)))}}const W=[];for(const H of w)w.some(Q=>H.isChildOf(Q))||W.push(H);if(w=W.filter(H=>!s.some(Q=>!!(H.overscaledZ<h&&Q.isChildOf(H))||H.equals(Q)||H.isChildOf(Q))),O){const H=1<<h,Q=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[H*Q.x,H*Q.y],re=4,le=re*re;w=w.filter(ue=>{const xe=ue.canonical.x+.5-K[0],me=ue.canonical.y+.5-K[1];return xe*xe+me*me<le})}return w}extendTileCoverToNearPlane(s,h,v){const w=[],P=new Set;for(const Ee of s)P.add(Ee.key);const O=(Ee,Ie,Ae,Be,Re)=>{const Ve=i.cX(Ie,Ee,Ae,Be,Re);P.has(Ve)||(w.push(new i.aP(Ee,Ie,Ae,Be,Re)),P.add(Ve))},D=s.reduce((Ee,Ie)=>Math.max(Ee,Ie.overscaledZ),v),z=1<<v,W=[new i.P(0,0),new i.P(i.al,0),new i.P(i.al,i.al),new i.P(0,i.al)],H=new i.P(0,0),Q=new i.P(0,0),K=(Ee,Ie)=>{const Ae=Math.floor(Ee[0]),Be=Math.floor(Ee[1]),Re=(Ee[0]-Ae)*i.al,Ve=(Ee[1]-Be)*i.al,Fe=Math.floor(Ie[0]),Me=Math.floor(Ie[1]),qe=(Ie[0]-Fe)*i.al,ot=(Ie[1]-Me)*i.al;for(let rt=-1;rt<=1;rt++){const wt=Ae+rt;if(!(wt<0||wt>=z)){H.x=Re-rt*i.al,Q.x=qe-(wt-Fe)*i.al;for(let pt=-1;pt<=1;pt++){const Ot=Be+pt;H.y=Ve-pt*i.al,Q.y=ot-(Ot-Me)*i.al,i.cY(H,Q,W)&&O(D,0,v,wt,Ot)}}}},re=h.points,le=re[i.cu],ue=re[i.cv],xe=this._projectToGround(le,re[i.cw]),me=this._projectToGround(ue,re[i.cx]);return K(le,xe),K(ue,me),w}_projectToGround(s,h){return i.cy(i.cz(),s,h,s[2]/(s[2]-h[2]))}coveringTiles(s){let h=this.coveringZoomLevel(s);const v=h,w=this.elevation&&this.elevation.exaggeration(),P=w&&!s.isTerrainDEM,O=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const D=this.locationCoordinate(this.center),z=this.center.lat,W=1<<h,H=[W*D.x,W*D.y,0],Q=this.projection.name==="globe",K=!Q,re=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,K),le=Q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ue=W*i.ce(1,this.center.lat),xe=this._camera.position[2]/i.ce(1,this.center.lat),me=[W*le.x,W*le.y,xe*(K?1:ue)],Ee=Q||w,Ie=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),Ae=this.isLODDisabled(!0)?h:0;let Be;if(this._elevation&&s.isTerrainDEM)Be=1e4*this._elevation.exaggeration();else if(this._elevation){const et=this._elevation.getMinMaxForVisibleTiles();Be=et?et.max:this._centerAltitude}else Be=this._centerAltitude;const Re=s.isTerrainDEM?-Be:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ve=this.projection.isReprojectedInTileSpace?i.cB(this):1,Fe=et=>{const mt=new i.ae(et.x+25e-6,et.y,et.z),Lt=new i.ae(et.x,et.y+25e-6,et.z),Jt=et.toLngLat(),yr=mt.toLngLat(),Wt=Lt.toLngLat(),Xt=this.locationCoordinate(Jt),br=this.locationCoordinate(yr),hr=this.locationCoordinate(Wt),cr=Math.hypot(br.x-Xt.x,br.y-Xt.y),fr=Math.hypot(hr.x-Xt.x,hr.y-Xt.y);return Math.sqrt(cr*fr)*Ve/25e-6},Me=et=>{const It=Be,mt=Re;return{aabb:i.cE(this,W,0,0,0,et,mt,It,this.projection),zoom:0,x:0,y:0,minZ:mt,maxZ:It,wrap:et,fullyVisible:!1}},qe=[];let ot=[];const rt=h,wt=s.reparseOverscaled?v:h,pt=(xe-this._centerAltitude)*ue,Ot=et=>{if(!this._elevation||!et.tileID||!O)return;const It=this._elevation.getMinMaxForTile(et.tileID),mt=et.aabb;It?(mt.min[2]=It.min,mt.max[2]=It.max,mt.center[2]=(mt.min[2]+mt.max[2])/2):(et.shouldSplit=ht(et),et.shouldSplit||(mt.min[2]=mt.max[2]=mt.center[2]=this._centerAltitude))},Kt=(et,It)=>{if(.707*It<et)return 1;const mt=It/et;return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)},ht=et=>{if(et.zoom<Ae)return!0;if(et.zoom===rt)return!1;if(et.shouldSplit!=null)return et.shouldSplit;const It=et.aabb.distanceX(me),mt=et.aabb.distanceY(me);let Lt=pt,Jt=1;if(Q){Lt=et.aabb.distanceZ(me);const fr=Math.pow(2,et.zoom),Nr=i.a_((et.y+1)/fr),Tn=i.a_(et.y/fr),Nn=Math.min(Math.max(z,Nr),Tn),pi=i.d0(Nn)/i.d0(z);if(Jt=Nn===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pi/this._mercatorScaleRatio),this.zoom<=i.cZ&&et.zoom===rt-1&&pi>=.9)return!0}else if(P&&(Lt=et.aabb.distanceZ(me)*ue),this.projection.isReprojectedInTileSpace&&v<=5){const fr=Math.pow(2,et.zoom),Nr=Fe(new i.ae((et.x+.5)/fr,(et.y+.5)/fr));Jt=Nr>.85?1:Nr}if(!O&&!Q){const fr=Math.sqrt(It*It+mt*mt+Lt*Lt);let Nr=(1<<rt-et.zoom)*Ie*Jt;return Nr*=Kt(Math.max(Lt,pt),fr),fr<Nr}let yr=Number.MAX_VALUE,Wt=0;const Xt=et.aabb.getCorners(),br=[];for(const fr of Xt){i.av(br,fr,me),Q||(P?br[2]*=ue:br[2]=pt);const Nr=i.bI(br,this._camera.forward());Nr<yr&&(yr=Nr,Wt=Math.abs(br[2]))}let hr=(1<<rt-et.zoom)*Ie*Jt;if(hr*=Kt(Math.max(Wt,pt),yr),yr<hr)return!0;const cr=et.aabb.closestPoint(H);return cr[0]===H[0]&&cr[1]===H[1]};if(this.renderWorldCopies)for(let et=1;et<=3;et++)qe.push(Me(-et)),qe.push(Me(et));for(qe.push(Me(0));qe.length>0;){const et=qe.pop(),It=et.x,mt=et.y;let Lt=et.fullyVisible;const Jt=()=>this.projection.name==="globe"&&(et.y===0||et.y===(1<<et.zoom)-1);if(!Lt){let yr=Ee?et.aabb.intersects(re):et.aabb.intersectsFlat(re);if(yr===0&&Jt()){const Wt=new i.cC(et.zoom,It,mt);yr=i.cD(this,W,Wt,!0).intersects(re)}if(yr===0)continue;Lt=yr===2}if(et.zoom!==rt&&ht(et))for(let yr=0;yr<4;yr++){const Wt=(It<<1)+yr%2,Xt=(mt<<1)+(yr>>1),br={aabb:O?et.aabb.quadrant(yr):i.cE(this,W,et.zoom+1,Wt,Xt,et.wrap,et.minZ,et.maxZ,this.projection),zoom:et.zoom+1,x:Wt,y:Xt,wrap:et.wrap,fullyVisible:Lt,tileID:void 0,shouldSplit:void 0,minZ:et.minZ,maxZ:et.maxZ};P&&!Q&&(br.tileID=new i.aP(et.zoom+1===rt?wt:et.zoom+1,et.wrap,et.zoom+1,Wt,Xt),Ot(br)),qe.push(br)}else{const yr=et.zoom===rt?wt:et.zoom;if(s.minzoom&&s.minzoom>yr)continue;let Wt=0;if(!Lt){let cr=Ee?et.aabb.intersectsPrecise(re):et.aabb.intersectsPreciseFlat(re);if(cr===0&&Jt()){const fr=new i.cC(et.zoom,It,mt);cr=i.cD(this,W,fr,!0).intersectsPrecise(re)}if(cr===0)continue;if(s.calculateQuadrantVisibility)if(re.containsPoint(et.aabb.center))Wt=15;else for(let fr=0;fr<4;fr++)et.aabb.quadrant(fr).intersects(re)!==0&&(Wt|=1<<fr)}const Xt=H[0]-(.5+It+(et.wrap<<et.zoom))*(1<<h-et.zoom),br=H[1]-.5-mt,hr=et.tileID?et.tileID:new i.aP(yr,et.wrap,et.zoom,It,mt);s.calculateQuadrantVisibility&&(hr.visibleQuadrants=Wt),ot.push({tileID:hr,distanceSq:Xt*Xt+br*br})}}if(this.fogCullDistSq){const et=this.fogCullDistSq,It=this.horizonLineFromTop();ot=ot.filter(mt=>{const Lt=[0,0,0,1],Jt=[i.al,i.al,0,1],yr=this.calculateFogTileMatrix(mt.tileID.toUnwrapped());i.aC(Lt,Lt,yr),i.aC(Jt,Jt,yr);const Wt=i.cF([],Lt,Jt),Xt=i.cG([],Lt,Jt),br=i.c_(Wt,Xt);if(br===0)return!0;let hr=!1;const cr=this._elevation;if(cr&&br>et&&It!==0){const fr=this.calculateProjMatrix(mt.tileID.toUnwrapped());let Nr;s.isTerrainDEM||(Nr=cr.getMinMaxForTile(mt.tileID)),Nr||(Nr={min:Re,max:Be});const Tn=i.cH(this.rotation),Nn=[Tn[0]*i.al,Tn[1]*i.al,Nr.max];i.af(Nn,Nn,fr),hr=(1-Nn[1])*this.height*.5<It}return br<et||hr})}return ot.sort((et,It)=>et.distanceSq-It.distanceSq).map(et=>et.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const h=i.aA(s.lat,-i.cI,i.cI),v=this.projection.project(s.lng,h);return new i.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let v,w;const P=this.centerPoint;if(this.projection.name==="globe"){const D=this.worldSize;v=(h.x-P.x)/D,w=(h.y-P.y)/D}else{const D=this.pointCoordinate(h),z=this.pointCoordinate(P);v=D.x-z.x,w=D.y-z.y}const O=this.locationCoordinate(s);this.setLocation(new i.ae(O.x-v,O.y-w))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,h){return this.projection.locationPoint(this,s,h)}locationPoint3D(s,h){return this.projection.locationPoint(this,s,h,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,h){return this.coordinateLocation(this.pointCoordinate3D(s,h))}locationCoordinate(s,h){const v=h?i.ce(h,s.lat):void 0,w=this.projection.project(s.lng,s.lat);return new i.ae(w.x,w.y,v)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const v=h??this._centerAltitude,w=[s.x,s.y,0,1],P=[s.x,s.y,1,1];i.aC(w,w,this.pixelMatrixInverse),i.aC(P,P,this.pixelMatrixInverse);const O=P[3];i.cJ(w,w,1/w[3]),i.cJ(P,P,1/O);const D=w[2],z=P[2];return{p0:w,p1:P,t:D===z?0:(v-D)/(z-D)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],v=[s.x,s.y,1,1];return i.aC(h,h,this.pixelMatrixInverse),i.aC(v,v,this.pixelMatrixInverse),i.cJ(h,h,1/h[3]),i.cJ(v,v,1/v[3]),h[2]=i.ce(h[2],this._center.lat)*this.worldSize,v[2]=i.ce(v[2],this._center.lat)*this.worldSize,i.cJ(h,h,1/this.worldSize),i.cJ(v,v,1/this.worldSize),new i.ax([h[0],h[1],h[2]],i.aw([],i.av([],v,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:v,t:w}=s,P=i.ce(h[2],this._center.lat),O=i.ce(v[2],this._center.lat);return new i.ae(i.ak(h[0],v[0],w)/this.worldSize,i.ak(h[1],v[1],w)/this.worldSize,i.ak(P,O,w))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s,h){if(!this.elevation)return this.pointCoordinate(s,h);let v=this.projection.pointCoordinate3D(this,s.x,s.y);if(v)return new i.ae(v[0],v[1],v[2]);let w=0,P=this.horizonLineFromTop();if(s.y>P)return this.pointCoordinate(s,h);const O=.02*P,D=s.clone();for(let z=0;z<10&&P-w>O;z++){D.y=i.ak(w,P,.66);const W=this.projection.pointCoordinate3D(this,D.x,D.y);W?(P=D.y,v=W):w=D.y}return v?new i.ae(v[0],v[1],v[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=i.cK)return!this.isPointAboveHorizon(s);const h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){const v=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,w=[s.x*this.worldSize,s.y*this.worldSize,v+s.toAltitude(),1];return i.aC(w,w,this.pixelMatrix),w[3]>0?new i.P(w[0]/w[3],w[1]/w[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,P=this.pointLocation3D(new i.P(h,s)),O=this.pointLocation3D(new i.P(w,s)),D=this.pointLocation3D(new i.P(w,v)),z=this.pointLocation3D(new i.P(h,v));let W=Math.min(P.lng,O.lng,D.lng,z.lng),H=Math.max(P.lng,O.lng,D.lng,z.lng),Q=Math.min(P.lat,O.lat,D.lat,z.lat),K=Math.max(P.lat,O.lat,D.lat,z.lat);const re=Math.pow(2,-this.zoom)/16*270,le=this.projection.name==="globe"?1:4,ue=(xe,me,Ee,Ie,Ae)=>{const Be=(xe+Ee)/2,Re=(me+Ie)/2,Ve=new i.P(Be,Re),{lng:Fe,lat:Me}=this.pointLocation3D(Ve),qe=Math.max(0,W-Fe,Q-Me,Fe-H,Me-K);W=Math.min(W,Fe),H=Math.max(H,Fe),Q=Math.min(Q,Me),K=Math.max(K,Me),(Ae<le||qe>re)&&(ue(xe,me,Be,Re,Ae+1),ue(Be,Re,Ee,Ie,Ae+1))};if(ue(h,s,w,s,1),ue(w,s,w,v,1),ue(w,v,h,v,1),ue(h,v,h,s,1),this.projection.name==="globe"){const[xe,me]=i.cL(this);xe?(K=90,H=180,W=-180):me&&(Q=-90,H=180,W=-180)}return new i.aI(new i.aS(W,Q),new i.aS(H,K))}_getBoundsRectangular(s,h){const{top:v,left:w}=this._edgeInsets,P=this.height-this._edgeInsets.bottom,O=this.width-this._edgeInsets.right,D=new i.P(w,v),z=new i.P(O,v),W=new i.P(O,P),H=new i.P(w,P);let Q=this.pointCoordinate(D,s),K=this.pointCoordinate(z,s);const re=this.pointCoordinate(W,h),le=this.pointCoordinate(H,h),ue=(xe,me)=>(me.y-xe.y)/(me.x-xe.x);return Q.y>1&&K.y>=0?Q=new i.ae((1-le.y)/ue(le,Q)+le.x,1):Q.y<0&&K.y<=1&&(Q=new i.ae(-le.y/ue(le,Q)+le.x,0)),K.y>1&&Q.y>=0?K=new i.ae((1-re.y)/ue(re,K)+re.x,1):K.y<0&&Q.y<=1&&(K=new i.ae(-re.y/ue(re,K)+re.x,0)),new i.aI().extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(re))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((v,w)=>{if(w.dem){const P=w.dem.tree;v.min=Math.min(v.min,P.minimums[0]),v.max=Math.max(v.max,P.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-i.cI,this.maxLat=i.cI,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.aF(this.minLng)*this.tileSize,this.worldMaxX=i.aF(this.maxLng)*this.tileSize,this.worldMinY=i.aJ(this.maxLat)*this.tileSize,this.worldMaxY=i.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,v=this._distanceTileDataCache;if(v[h])return v[h];const w=s.canonical,P=1/this.height,O=this.cameraWorldSize,D=O/this.zoomScale(w.z),z=(w.x+Math.pow(2,w.z)*s.wrap)*D,W=w.y*D,H=this.point;H.x*=O/this.worldSize,H.y*=O/this.worldSize;const Q=this.angle,K=Math.sin(-Q),re=-Math.cos(-Q);return v[h]={bearing:[K,re],center:[(H.x-z)*P,(H.y-W)*P],scale:D/i.al*P},v[h]}calculateFogTileMatrix(s){const h=s.key,v=this._fogTileMatrixCache;if(v[h])return v[h];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return i.aB(w,this.worldToFogMatrix,w),v[h]=new Float32Array(w),v[h]}calculateProjMatrix(s,h=!1,v=!1){const w=s.key;let P;if(P=v?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,P[w])return P[w];const O=this.calculatePosMatrix(s,this.worldSize);let D;return D=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,i.aB(O,D,O),P[w]=new Float32Array(O),P[w]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,v=this._pixelsToTileUnitsCache;if(v[h])return v[h];const w=i.cM(s,this);return v[h]=w,v[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,h=i.bp([],[s,s,s]);return i.aB(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const h=i.ce(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(h),w=this._camera.forward(),P=i.ce(1,this._center.lat);v[2]/=P,w[2]/=P,i.aw(w,w);const O=s.raycast(v,w,s.exaggeration());if(O){const D=i.bG([],v,w,O),z=new i.ae(D[0],D[1],i.ce(D[2],i.a_(D[1]))),W=(z.z+i.ag([z.x-v[0],z.y-v[1],z.z-v[2]*P]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(W),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,v=i.ce(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),P=h.getAtPointOrZero(new i.ae(...w)),O=this.pixelsPerMeter/this.worldSize*P,D=this._minimumHeightOverTerrain(),z=w[2]-O;if(z<=D)if(z<0||s){const W=this.locationCoordinate(this._center,this._centerAltitude),H=[w[0],w[1],W.z-w[2]],Q=i.ag(H);H[2]-=(D-z)/this._pixelsPerMercatorPixel;const K=i.ag(H);if(K===0)return;i.c4(H,H,Q/K*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],W.z*this._pixelsPerMercatorPixel-H[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const K=this.center;return K.lat=i.aA(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(K.lng=i.aA(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const h=this._unmodified,{x:v,y:w}=this.point;let P=0,O=v,D=w;const z=this.width/2,W=this.height/2,H=this.worldMinY*this.scale,Q=this.worldMaxY*this.scale;if(w-W<H&&(D=H+W),w+W>Q&&(D=Q-W),Q-H<this.height&&(P=Math.max(P,this.height/(Q-H)),D=(Q+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,re=this.worldMaxX*this.scale,le=this.worldSize/2-(K+re)/2;O=(v+le+this.worldSize)%this.worldSize-le,O-z<K&&(O=K+z),O+z>re&&(O=re-z),re-K<this.width&&(P=Math.max(P,this.width/(re-K)),O=(re+K)/2)}O===v&&D===w||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(O,D))),P&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(P)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.projection.name==="globe",v=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.ce(1,this.center.lat)/i.ce(1,i.d1));const w=i.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const P=this.projection.zAxisUnit==="meters"?v:1,O=this._camera.getWorldToCamera(this.worldSize,P);let D;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-s.x/this.width,z[9]=2*s.y/this.height,this.isOrthographic){let Me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),qe=Me*this.aspect,ot=-qe,rt=-Me;qe-=s.x,ot-=s.x,Me+=s.y,rt+=s.y,D=this._camera.getCameraToClipOrthographic(ot,qe,rt,Me,this._nearZ,this._farZ),((wt,pt,Ot,Kt)=>{for(let ht=0;ht<16;ht++)wt[ht]=i.ak(pt[ht],Ot[ht],Kt)})(D,D,z,i.c$(this.pitch>=Uh?1:this.pitch/Uh))}else D=z;const W=i.cO([],z,O);let H=i.cO([],D,O);if(this.projection.isReprojectedInTileSpace){const Me=this.locationCoordinate(this.center),qe=i.bz([]);i.bq(qe,qe,[Me.x*this.worldSize,Me.y*this.worldSize,0]),i.aB(qe,qe,i.cP(this)),i.bq(qe,qe,[-Me.x*this.worldSize,-Me.y*this.worldSize,0]),i.aB(H,H,qe),i.aB(W,W,qe),this.inverseAdjustmentMatrix=i.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.cR([],H,[this.worldSize,this.worldSize,this.worldSize/P,1]),this.projMatrix=H,this.invProjMatrix=i.bk(new Float64Array(16),this.projMatrix),h){const Me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Me[8]=2*-s.x/this.width,Me[9]=2*s.y/this.height,this.expandedFarZProjMatrix=i.cO([],Me,O)}else this.expandedFarZProjMatrix=this.projMatrix;const Q=i.bk([],D);this.frustumCorners=i.cS.fromInvProjectionMatrix(Q,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const K=new Float32Array(16);i.bz(K),i.cR(K,K,[1,-1,1]),i.cT(K,K,this._pitch),i.bA(K,K,this.angle);const re=i.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.by(re);const le=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;re[8]=2*-s.x/this.width,re[9]=2*(s.y+le)/this.height,this.skyboxMatrix=i.aB(K,re,K);const ue=this.point,xe=ue.x,me=ue.y,Ee=this.width%2/2,Ie=this.height%2/2,Ae=Math.cos(this.angle),Be=Math.sin(this.angle),Re=xe-Math.round(xe)+Ae*Ee+Be*Ie,Ve=me-Math.round(me)+Ae*Ie+Be*Ee,Fe=new Float64Array(H);if(i.bq(Fe,Fe,[Re>.5?Re-1:Re,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=Fe,H=i.bB(),i.cR(H,H,[this.width/2,-this.height/2,1]),i.bq(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=i.bB(),i.cR(H,H,[1,-1,1]),i.bq(H,H,[-1,-1,0]),i.cR(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=i.aB(new Float64Array(16),this.labelPlaneMatrix,W),this._calcFogMatrices(),this._distanceTileDataCache={},H=i.bk(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=H,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.cU(this);const Me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.af(Me,Me,O),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=H;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,P=[s,s,h];i.c4(P,P,w),i.c4(v,v,-1),i.cV(v,v,P);const O=i.bB();i.bq(O,O,v),i.cR(O,O,P),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,w)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,P=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*P,w.y/this.worldSize-v[1]*P,s/this.worldSize*this._centerAltitude-v[2]*P]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=s[2];let P=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(P=Math.min((h-v)/w,1)),this._camera.position=i.bG([],this._camera.position,s,P),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),P=i.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.an(this._maxPitch)),D=Math.max((s[2]-P)/Math.cos(v),O),z=this._zoomFromMercatorZ(D);i.bG(s,s,h,D),this._pitch=i.aA(v,i.an(this.minPitch),i.an(this.maxPitch)),this.angle=i.bS(w,-Math.PI,Math.PI),this._setZoom(i.aA(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,v=i.cK,w=0,P=1/0;for(;v-h>1e-6&&v>h;){const O=h+.5*(v-h),D=this.tileSize*Math.pow(2,O),z=this.getCameraToCenterDistance(this.projection,O,D),W=this.scaleZoom(z/(Math.max(0,s)*this.tileSize)),H=Math.abs(O-W);H<P&&(P=H,w=O),O<W?h=O:v=O}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const v=Math.min(s.x,h.x),w=Math.max(s.x,h.x),P=Math.min(s.y,h.y),O=Math.max(s.y,h.y);if(P<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const D=[new i.P(v,P),new i.P(w,O),new i.P(v,O),new i.P(w,P)],z=this.renderWorldCopies?-3:0,W=this.renderWorldCopies?4:1;for(const H of D){const Q=this.pointRayIntersection(H);if(Q.t<0)return!0;const K=this.rayIntersectionCoordinate(Q);if(K.x<z||K.y<0||K.x>W||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(s,h){const v=i.ag(i.av([],this._camera.position,s)),w=this._zoomFromMercatorZ(v)+h;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([h,v,w],P){const O=[h,v,w,1];i.aC(O,O,P);const D=O[3]=Math.max(O[3],1e-6);return O[0]/=D,O[1]/=D,O[2]/=D,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,v=this.worldSize){const w=i.cN(s,h,this.width,this.height,1024),P=s.pixelSpaceConversion(this.center.lat,v,w);let O=.5/Math.tan(.5*this._fov)*this.height*P;return this.isOrthographic&&(O=i.ak(1,O,i.c$(this.pitch>=Uh?1:this.pitch/Uh))),O}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.aB(s,s,this.globeMatrix),s}getFrustum(s){return i.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const qu=(y,s)=>{if(s>0&&y.terrain&&i.w("Cutoff is currently disabled on terrain"),s<=0||y.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=y.transform,v=Math.max(Math.abs(h._zoom-(y.minCutoffZoom-1)),1),w=h.isLODDisabled(!1)?i.ah(60,45,h.pitch):i.ah(30,15,h.pitch),P=h._farZ-h._nearZ,O=s*h.height,D=((1-(z=w))*h.cameraToCenterDistance+z*(h._farZ+O))*v;var z;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(D-h._nearZ)/P,(D-O-h._nearZ)/P]}}},So={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class zR{constructor(s,h){this.aabb=s,this.lastCascade=h}}class BR{add(s,h){const v=this.receivers[s.key];v!==void 0?(v.aabb.min[0]=Math.min(v.aabb.min[0],h.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],h.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],h.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],h.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],h.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],h.max[2])):this.receivers[s.key]=new zR(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,v){const w=i.d8.fromPoints(s.points);let P=0;for(const O in this.receivers){const D=this.receivers[O];if(!D||!w.intersectsAabb(D.aabb))continue;D.aabb.min=w.closestPoint(D.aabb.min),D.aabb.max=w.closestPoint(D.aabb.max);const z=D.aabb.getCorners();for(let W=0;W<v.length;W++){let H=!0;for(const Q of z){const K=[Q[0]*h,Q[1]*h,Q[2]];if(i.af(K,K,v[W].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){H=!1;break}}if(D.lastCascade=W,P=Math.max(P,W),H)break}}return P+1}}class kg{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new BR,this._depthMode=new Sr(s.context.gl.LEQUAL,Sr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(So,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(So,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(So,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!h||!h.properties)return;const w=h.properties.get("shadow-intensity");if(!h.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((le,ue)=>{const xe=v.style._mergedLayers[ue];return le+(xe.hasShadowPass()&&!xe.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const P=v.context,O=So.shadowMapResolution,D=So.shadowMapResolution;if(this._cascades.length===0||So.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let le=0;le<So.cascadeCount;++le){const ue=v._shadowMapDebug,xe=P.gl,me=P.createFramebuffer(O,D,ue,"texture"),Ee=new i.T(P,{width:O,height:D,data:null},xe.DEPTH_COMPONENT16);if(me.depthAttachment.set(Ee.texture),ue){const Ie=new i.T(P,{width:O,height:D,data:null},xe.RGBA8);me.colorAttachment.set(Ie.texture)}this._cascades.push({framebuffer:me,texture:Ee,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.cA,scale:0})}}this.shadowDirection=dA(h);let z=0;if(s.elevation){const le=s.elevation,ue=[1e4,-1e4];le.visibleDemTiles.filter(xe=>xe.dem).forEach(xe=>{const me=xe.dem.tree;ue[0]=Math.min(ue[0],me.minimums[0]),ue[1]=Math.max(ue[1],me.maximums[0])}),ue[0]!==1e4&&(z=(ue[1]-ue[0])*le.exaggeration())}const W=1.5*s.cameraToCenterDistance,H=3*W,Q=new Float64Array(16);for(let le=0;le<this._cascades.length;++le){const ue=this._cascades[le];let xe=s.height/50,me=1;So.cascadeCount===1?me=H:le===0?me=W:(xe=W,me=H);const[Ee,Ie]=hA(s,this.shadowDirection,xe,me,So.shadowMapResolution,z);ue.scale=s.scale,ue.matrix=Ee,ue.boundingSphereRadius=Ie,i.bk(Q,ue.matrix),ue.frustum=i.cA.fromInvProjectionMatrix(Q,1,0,!0),ue.far=me}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/So.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=So.shadowMapResolution,this._uniformValues.u_shadowmap_0=wo.ShadowMap0,this._uniformValues.u_shadowmap_1=wo.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const re=v.transform.elevation;for(const le of this._groundShadowTiles){let ue={min:0,max:0};if(re){const xe=re.getMinMaxForTile(le);xe&&(ue=xe)}this.addShadowReceiver(le.toUnwrapped(),ue.min,ue.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,So.shadowMapResolution,So.shadowMapResolution]);for(let P=0;P<this._numCascadesToRender;++P){v.currentShadowCascade=P,w.bindFramebuffer.set(this._cascades[P].framebuffer.framebuffer),w.clear({color:i.ao.white,depth:1});for(const O of s.order){const D=s._mergedLayers[O];if(!D.hasShadowPass()||D.isHidden(v.transform.zoom))continue;const z=s.getLayerSourceCache(D),W=z?h[z.id]:void 0;(D.type==="model"||W&&W.length)&&v.renderLayer(v,z,D,W)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,h=s.style,v=s.context,w=v.gl,P=h.directionalLight,O=h.ambientLight;if(!P||!O)return;const D=[],z=qu(s,s.longestCutoffRange);z.shouldRenderCutoff&&D.push("RENDER_CUTOFF"),D.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&D.push("NORMAL_OFFSET");const W=tc(h,P,O),H=new Sr(w.LEQUAL,Sr.ReadOnly,s.depthRangeFor3D),Q=new Xr({func:w.EQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.KEEP);for(const K of this._groundShadowTiles){const re=K.toUnwrapped(),le=s.isTileAffectedByFog(K),ue=s.getOrCreateProgram("groundShadow",{defines:D,overrideFog:le});this.setupShadows(re,ue),s.uploadCommonUniforms(v,ue,re,null,z);const xe={u_matrix:s.transform.calculateProjMatrix(re),u_ground_shadow_factor:W};ue.draw(s,w.TRIANGLES,H,Q,pn.multiply,qr.disabled,xe,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?pn.unblended:pn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const h=this.painter.transform,v=h.calculatePosMatrix(s,h.worldSize);return i.aB(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(s){const h=i.by(s);return i.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,s),h}setupShadows(s,h,v){if(!this.enabled)return;const w=this.painter.transform,P=this.painter.context,O=P.gl,D=this._uniformValues,z=new Float64Array(16),W=w.calculatePosMatrix(s,w.worldSize);for(let H=0;H<this._cascades.length;H++)i.aB(z,this._cascades[H].matrix,W),D[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),P.activeTexture.set(O.TEXTURE0+wo.ShadowMap0+H),this._cascades[H].texture.bindExtraParam(O.LINEAR,O.LINEAR,O.CLAMP_TO_EDGE,O.CLAMP_TO_EDGE,O.GREATER);if(this.useNormalOffset=!!v,this.useNormalOffset){const H=i.d6(s.canonical),Q=2/w.tileSize*i.al/So.shadowMapResolution,K=Q*this._cascades[0].boundingSphereRadius,re=Q*this._cascades[this._cascades.length-1].boundingSphereRadius,le=(v==="vector-tile"?1:3)*function(ue,xe,me,Ee,Ie){const Ae=i.aA((ue-22)/-22,0,1);return .125*(1-Ae)+4*Ae}(w.zoom);D.u_shadow_normal_offset=[H,K*le,re*le],D.u_shadow_bias=[1e-4,.0012,.012]}else D.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(P,D)}setupShadowsFromMatrix(s,h,v=!1){if(!this.enabled)return;const w=this.painter.context,P=w.gl,O=this._uniformValues,D=new Float64Array(16);for(let z=0;z<So.cascadeCount;z++)i.aB(D,this._cascades[z].matrix,s),O[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),w.activeTexture.set(P.TEXTURE0+wo.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(P.LINEAR,P.LINEAR,P.CLAMP_TO_EDGE,P.CLAMP_TO_EDGE,P.GREATER);if(this.useNormalOffset=v,v){const z=So.normalOffset;O.u_shadow_normal_offset=[1,z,z],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(w,O)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,v,w){if(w[2]>=0)return{};const P=function(z,W,H){const Q=H/(1<<z.canonical.z);return new i.d8([z.canonical.x*Q+z.wrap*H,z.canonical.y*Q+z.wrap*H,0],[(z.canonical.x+1)*Q+z.wrap*H,(z.canonical.y+1)*Q+z.wrap*H,W])}(s,h,v).getCorners(),O=h/-w[2];w[0]<0?(i.d7(P[0],P[0],[w[0]*O,0,0]),i.d7(P[3],P[3],[w[0]*O,0,0])):w[0]>0&&(i.d7(P[1],P[1],[w[0]*O,0,0]),i.d7(P[2],P[2],[w[0]*O,0,0])),w[1]<0?(i.d7(P[0],P[0],[0,w[1]*O,0]),i.d7(P[1],P[1],[0,w[1]*O,0])):w[1]>0&&(i.d7(P[2],P[2],[0,w[1]*O,0]),i.d7(P[3],P[3],[0,w[1]*O,0]));const D={};return D.vertices=P,D.planes=[Fd(P[1],P[0],P[4]),Fd(P[2],P[1],P[5]),Fd(P[3],P[2],P[6]),Fd(P[0],P[3],P[7])],D}addShadowReceiver(s,h,v){this._receivers.add(s,i.d8.fromTileIdAndHeight(s,h,v))}getMaxCascadeForTile(s){const h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Fd(y,s,h){const v=i.av([],h,s),w=i.av([],y,s),P=i.bH([],v,w),O=i.ag(P);return O===0?[0,0,1,0]:(i.c4(P,P,1/O),[P[0],P[1],P[2],-i.bI(P,s)])}function dA(y){const s=y.properties.get("direction"),h=i.d3(s.x,s.y,s.z);h[2]=i.aA(h[2],0,75);const v=i.d5([h[0],h[1],h[2]]);return i.d4(v.x,v.y,v.z)}function tc(y,s,h){const v=s.properties.get("color-use-theme")==="none",w=s.properties.get("color"),P=s.properties.get("intensity"),O=s.properties.get("direction"),D=[O.x,O.y,O.z],z=h.properties.get("color-use-theme")==="none",W=h.properties.get("color"),H=h.properties.get("intensity"),Q=Math.max(i.bI([0,0,1],D),0),K=[0,0,0];i.c4(K,W.toPremultipliedRenderColor(z?null:y.getLut(s.scope)).toArray01Linear().slice(0,3),H);const re=[0,0,0];return i.c4(re,w.toPremultipliedRenderColor(v?null:y.getLut(h.scope)).toArray01Linear().slice(0,3),Q*P),i.da([K[0]>0?K[0]/(K[0]+re[0]):0,K[1]>0?K[1]/(K[1]+re[1]):0,K[2]>0?K[2]/(K[2]+re[2]):0])}function hA(y,s,h,v,w,P){const O=y.zoom,D=y.scale,z=y.worldSize,W=1/z,H=y.aspect,Q=Math.sqrt(1+H*H)*Math.tan(.5*y.fovX),K=Q*Q,re=v-h,le=v+h;let ue,xe;K>re/le?(ue=v,xe=v*Q):(ue=.5*le*(1+K),xe=.5*Math.sqrt(re*re+2*(v*v+h*h)*K+le*le*K*K));const me=y.projection.pixelsPerMeter(y.center.lat,z),Ee=y._camera.getCameraToWorldMercator(),Ie=[0,0,-ue*W];i.af(Ie,Ie,Ee);let Ae=xe*W;const Be=y._edgeInsets;if(!(Be.left===0&&Be.top===0&&Be.right===0&&Be.bottom===0||Be.left===Be.right&&Be.top===Be.bottom)){const Lt=y._camera.getWorldToCamera(y.worldSize,y.projection.zAxisUnit==="meters"?me:1),Jt=y._camera.getCameraToClipPerspective(y._fov,y.width/y.height,h,v);Jt[8]=2*-y.centerOffset.x/y.width,Jt[9]=2*y.centerOffset.y/y.height;const yr=new Float64Array(16);i.cO(yr,Jt,Lt);const Wt=new Float64Array(16);i.bk(Wt,yr);const Xt=i.cA.fromInvProjectionMatrix(Wt,z,O,!0);for(const br of Xt.points){const hr=((Re=br)[0]/=D,Re[1]/=D,Re[2]=i.ce(Re[2],y._center.lat),Re);Ae=Math.max(Ae,i.c5(i.d9([],Ie,hr)))}}var Re;Ae*=w/(w-1);const Ve=Math.acos(s[2]),Fe=Math.atan2(-s[0],-s[1]),Me=new Vv;Me.position=Ie,Me.setPitchBearing(Ve,Fe);const qe=Me.getWorldToCamera(z,me),ot=Ae*z,rt=Math.min(y._mercatorZfromZoom(17)*z*-2,-2*ot),wt=Me.getCameraToClipOrthographic(-ot,ot,-ot,ot,rt,(ot+P*me)/s[2]),pt=new Float64Array(16);i.aB(pt,wt,qe);const Ot=i.d4(Math.floor(1e6*Ie[0])/1e6*z,Math.floor(1e6*Ie[1])/1e6*z,0),Kt=.5*w,ht=[0,0,0];i.af(ht,Ot,pt),i.c4(ht,ht,Kt);const et=[Math.floor(ht[0]),Math.floor(ht[1]),Math.floor(ht[2])],It=[0,0,0];i.av(It,ht,et),i.c4(It,It,-1/Kt);const mt=new Float64Array(16);return i.bz(mt),i.bq(mt,mt,It),i.aB(pt,mt,pt),[pt,ot]}class qv extends i.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,h){return i.db(this.requestManager.transformRequest(h,i.R.Model).url).then(v=>{if(!v)return;const w=i.dc(v),P=new i.dd(s,h,void 0,void 0,w);return P.computeBoundsAndApplyParent(),P}).catch(v=>{if(v&&v.status===404)return null;this.fire(new i.y(new Error(`Could not load model ${s} from ${h}: ${v.message}`)))})}load(s,h,v={forceReload:!1}){this.models[h]||(this.models[h]={});const w=Object.keys(s),P=[],O=[];for(const D of w){const z=s[D];this.hasURLBeenRequested(z)&&!v.forceReload||(this.modelByURL[z]={modelId:D,scope:h},P.push(this.loadModel(D,z)),O.push(D)),this.models[h][D]||(this.models[h][D]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+O.length,Promise.allSettled(P).then(D=>{for(let z=0;z<D.length;z++){const{status:W}=D[z];if(W==="rejected")continue;const{value:H}=D[z];this.models[h][O[z]]||(this.models[h][O[z]]={model:null,numReferences:1}),this.models[h][O[z]].model=H}this.numModelsLoading[h]-=O.length,this.fire(new i.z("data",{dataType:"style"}))}).catch(D=>{this.fire(new i.y(new Error(`Could not load models: ${D.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h,v={exactIdMatch:!1}){return!!(v.exactIdMatch?this.getModel(s,h):this.getModelByURL(this.modelUris[h][s]))}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}getModelByURL(s){if(!s)return null;const h=this.modelByURL[s];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(s,h){return this.models[h]&&this.models[h][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,h,v){this.models[v]||(this.models[v]={}),this.modelUris[v]||(this.modelUris[v]={});const w=this.requestManager.normalizeModelURL(h);if((this.hasModel(s,v,{exactIdMatch:!0})||this.hasModelBeenAdded(s,v))&&this.modelUris[v][s]===w)this.models[v][s].numReferences++;else if(this.hasURLBeenRequested(w)){const{scope:P,modelId:O}=this.modelByURL[w];this.models[P][O].numReferences++}else this.modelUris[v][s]=w,this.load({[s]:this.modelUris[v][s]},v)}addModelURLs(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const v=this.modelUris[h];for(const w in s)v[w]=this.requestManager.normalizeModelURL(s[w])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const v={};for(const w of s)this.hasModel(w,h,{exactIdMatch:!0})||this.hasURLBeenRequested(w)?this.models[h][w].numReferences++:this.modelUris[h][w]&&!this.hasURLBeenRequested(w)?v[w]=this.modelUris[h][w]:!this.hasURLBeenRequested(w)&&i.de(w,!1)&&(this.modelUris[h][w]=this.requestManager.normalizeModelURL(w),v[w]=this.modelUris[h][w]);this.load(v,h)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,h,v=!1,w=!1){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0||w)){const P=this.modelUris[h][s];v||delete this.modelUris[h][s],delete this.modelByURL[P];const O=this.models[h][s].model;if(!O)return;delete this.models[h][s],O.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const h of Object.keys(this.models[s])){const v=this.models[s][h].model;delete this.models[s][h],v&&v.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(const v in this.models[h])this.models[h][v].model&&this.models[h][v].model.upload(s.context)}}const Rg=i.a6.colorTheme,zd=new i.a9({data:new i.aa(Rg.data)});function $R(y){if(!y.metadata||!y.metadata.content_area)return;const s=i.o.devicePixelRatio,{left:h,top:v,width:w,height:P}=y.metadata.content_area,O=h*s,D=v*s;return[O,D,O+w*s,D+P*s]}function fA(y){if(y)return y.map(([s,h])=>[s*i.o.devicePixelRatio,h*i.o.devicePixelRatio])}class UR{constructor(s,h,v){this.id=s,this.scope=h,this.sourceCache=v,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return s;const v=this.sourceCache.getSource();if(!(v instanceof so))return s;const w=h.map(O=>this.sourceCache.getTile(O)),P=v.getImages(w,Array.from(this.pendingRequests));for(const[O,D]of P)s.set(i.I.from({name:O,iconsetId:this.id}),D),this.pendingRequests.delete(O);for(const O of this.pendingRequests)this.missingRequests.add(O);return this.pendingRequests.clear(),s}}const Bd=(y,s)=>pe(y,s&&s.filter(h=>h.identifier!=="source.canvas")),VR=i.aH(Zn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),iw=i.aH(Zn,["setCenter","setZoom","setBearing","setPitch"]),Wv=new Set(["background","sky","slot","custom"]),aw={version:8,layers:[],sources:{}},ow={duration:300,delay:0};class rc extends i.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=Object.assign({},ow),this._buildingIndex=new Zb(this),this.crossTileSymbolIndex=new Vu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=h.styleChanges||new dr,this.dispatcher=h.dispatcher?h.dispatcher:new i.D(i.dg(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new Yr(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new i.dh(s._requestManager,h.localFontFamily?i.di.all:h.localIdeographFontFamily?i.di.ideographs:i.di.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new qv(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._indoorDependentLayers=h.indoorDependentLayers?h.indoorDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",i.dj());const v=this;this._rtlTextPluginCallback=rc.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(P,O)=>{if(i.dk(P),O&&O.every(D=>D))for(const D in v._sourceCaches){const z=v._sourceCaches[D],W=z.getSource().type;W!=="vector"&&W!=="geojson"||z.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const P=this.getOwnSource(w.sourceId);if(P&&P.vectorLayerIds)for(const O in this._layers){const D=this._layers[O];D.source===P.id&&this._validateLayer(D)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(i.h(s))return s;const h=i.dl(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${i.dm(JSON.stringify(s))}`}_diffStyle(s,h,v){this.globalId=this._getGlobalId(s);const w=(P,O)=>{try{O(null,this.setState(P,v))}catch(D){O(D,!1)}};if(typeof s=="string"){const P=this.map._requestManager.normalizeStyleURL(s),O=this.map._requestManager.transformRequest(P,i.R.Style);i.m(O,(D,z)=>{D?this.fire(new i.y(D)):z&&w(z,h)})}else typeof s=="object"&&w(s,h)}loadURL(s,h={}){this.fire(new i.z("dataloading",{dataType:"style"}));const v=typeof h.validate=="boolean"?h.validate:!i.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);const w=this.importsCache.get(s);if(w)return this._load(w,v);const P=this.map._requestManager.transformRequest(s,i.R.Style);this._request=i.m(P,(O,D)=>{if(this._request=null,O)this.fire(new i.y(O));else if(D)return this.importsCache.set(s,D),this._load(D,v)})}loadJSON(s,h={}){this.fire(new i.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=i.o.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new i.z("dataloading",{dataType:"style"})),this._load(aw,!1)}_loadImports(s,h,v){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const P of s){const O=this._createFragmentStyle(P),D=new Promise(H=>{O.once("style.import.load",H),O.once("error",H)}).then(()=>this.mergeAll());if(w.push(D),this.resolvedImports.has(P.url)){O.loadEmpty();continue}const z=P.data||this.importsCache.get(P.url);z?(O.loadJSON(z,{validate:h}),this._isInternalStyle(z)&&(O.globalId=null)):P.url?O.loadURL(P.url,{validate:h}):O.loadEmpty();const W={style:O,id:P.id,config:P.config};if(v){const H=this.fragments.findIndex(({id:Q})=>Q===v);this.fragments=this.fragments.slice(0,H).concat(W).concat(this.fragments.slice(H))}else this.fragments.push(W)}return Promise.allSettled(w)}getImportGlobalIds(s=this,h=new Set){for(const v of s.fragments)v.style.globalId&&h.add(v.style.globalId),this.getImportGlobalIds(v.style,h);return[...h.values()]}_createFragmentStyle(s){const h=this.scope?i.B(s.id,this.scope):s.id;let v;const w=this._initialConfig&&this._initialConfig[h];(s.config||w)&&(v=Object.assign({},s.config,w));const P=new rc(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:v,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return P.setEventedParent(this.map,{style:P}),P}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){if(this._isInternalStyle(s)){const P=Object.assign({},aw,{imports:[{id:"basemap",data:s,url:""}]},s.center?{center:s.center}:{},s.bearing?{bearing:s.bearing}:{},s.pitch?{pitch:s.pitch}:{},s.zoom?{zoom:s.zoom}:{},s.light?{light:s.light}:{});return this._importedAsBasemap=!0,void this._load(P,h)}if(this.updateConfig(this._config,s.schema),h&&Bd(this,wn(s)))return;this._loaded=!0,this.stylesheet=i.dn(s);const v=()=>{for(const z in s.sources)this.addSource(z,s.sources[z],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const z in s.iconsets)this.addIconset(z,s.iconsets[z]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const P=Zf(this.stylesheet.layers);if(this._order=P.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new Ye(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ye(this.stylesheet.light)),this._layers={};for(const z of P){const W=i.dt(z,this.scope,this._styleColorTheme.lut,this.options);W.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(W.fqid),W.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(W.fqid),this._hasAppearances=this._hasAppearances||W.getAppearances().length!==0,W.setEventedParent(this,{layer:{id:W.id}}),this._layers[W.id]=W;const H=this.getOwnLayerSourceCache(W),Q=!!this.directionalLight&&this.directionalLight.shadowsEnabled();H&&W.canCastShadows()&&Q&&(H.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const O=this.stylesheet.terrain;O&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(O,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.z("data",{dataType:"style"}));const D=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new i.z(D?"style.load":"style.import.load"))}).catch(z=>{this.fire(new i.y(new Error("Failed to load imports",z))),this.fire(new i.z(D?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.z(D?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const w=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(w){const P=this._evaluateColorThemeData(w);this._loadColorTheme(P).then(()=>{v()}).catch(O=>{i.w(`Couldn't load color theme from the stylesheet: ${O}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let s,h,v,w,P,O,D,z,W,H;const Q={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(K=>{if(K.stylesheet){if(K.light!=null&&(s=K.light),K.stylesheet.lights)for(const re of K.stylesheet.lights)re.type==="ambient"&&K.ambientLight!=null&&(h=K.ambientLight),re.type==="directional"&&K.directionalLight!=null&&(v=K.directionalLight);w=this._prioritizeTerrain(w,K.terrain,K.stylesheet.terrain),K.stylesheet.fog&&K.fog!=null&&(P=K.fog),K.stylesheet.snow&&K.snow!=null&&(O=K.snow),K.stylesheet.rain&&K.rain!=null&&(D=K.rain),K.stylesheet.camera!=null&&(H=K.stylesheet.camera),K.stylesheet.projection!=null&&(z=K.stylesheet.projection),K.stylesheet.transition!=null&&(W=K.stylesheet.transition),Q[K.scope]=K._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=v,this.fog=P,this.snow=O,this.rain=D,this._styleColorThemeForScope=Q,w===null?delete this.terrain:this.terrain=w,this.camera=H||{"camera-projection":"perspective"},this.projection=z||{name:"mercator"},this.transition=Object.assign({},ow,W),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(s){const h=v=>{for(const w of v.fragments)h(w.style);s(v)};h(this)}_prioritizeTerrain(s,h,v){const w=s&&s.drapeRenderMode===0;return v===null?h&&h.drapeRenderMode===0?h:w?s:null:h!=null&&(!s||w||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},h={},v={};this.forEachFragmentStyle(w=>{for(const P in w._sourceCaches){const O=i.B(P,w.scope);s[O]=w._sourceCaches[P]}for(const P in w._otherSourceCaches){const O=i.B(P,w.scope);h[O]=w._otherSourceCaches[P]}for(const P in w._symbolSourceCaches){const O=i.B(P,w.scope);v[O]=w._symbolSourceCaches[P]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=v}mergeIndoor(){this.forEachFragmentStyle(s=>{if(s.stylesheet&&s.stylesheet.indoor)for(const h of Object.values(s.stylesheet.indoor)){const v=h,w=i.B(v.sourceId,s.scope);this._mergedIndoor[w]=new Set(v.sourceLayers||[])}})}mergeLayers(){const s={},h=[],v={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(O=>{for(const D of O._order){const z=O._layers[D];if(z.type==="slot"){const W=i.dp(D);if(s[W])continue;s[W]=[]}z.slot&&s[z.slot]?s[z.slot].push(z):h.push(z)}}),this._mergedOrder=[];let w=-1;const P=(O=[])=>{for(const D of O)if(D.type==="slot"){const z=i.dp(D.id);s[z]&&P(s[z]),this._mergedSlots.push(z)}else{const z=i.B(D.id,D.scope);this._mergedOrder.push(z),v[z]=D,D.is3D(!!this.terrain)&&(this._has3DLayers=!0,w=this._mergedOrder.length-1),D.type==="circle"&&(this._hasCircleLayers=!0),D.type==="symbol"&&(this._hasSymbolLayers=!0),D.type==="clip"&&(this._clipLayerPresent=!0)}};if(P(h),this._has3DLayers){const O={};for(let D=0;D<this._mergedOrder.length;++D){const z=this._mergedOrder[D];O[z]=D===w?1:D<w?v[z].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((D,z)=>O[D]-O[z])}this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,v,w,P){const O=Object.assign({},v);for(const z of Object.keys(Rg))O[z]===void 0&&(O[z]=Rg[z].default);const D=new i.a8(zd,h,new Map(w));return D.setTransitionOrValue(O,w),D.untransitioned().possiblyEvaluate(new i.ac(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((v,w)=>{const P="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void v();let O=s;O.startsWith(P)||(O=P+O);const D=i.I.from("mapbox-reserved-lut"),z=new Image;z.src=O,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void v();this._styleColorTheme.lutLoading=!1;const{width:W,height:H,data:Q}=i.o.getImageData(z);if(H>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(W!==H*H)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(D)&&this.removeImage(D),this.addImage(D,{data:new i.q({width:W,height:H},Q),pixelRatio:1,sdf:!1,usvg:!1,version:0});const K=this.imageManager.getImage(D,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:s},v()):w(new Error("Missing LUT image."))}})}getLut(s){const h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,v,w){let P,O,D;const z=i.o.devicePixelRatio>1?"@2x":"";let W=i.m(v.transformRequest(v.normalizeSpriteURL(h,z,".json"),i.R.SpriteJSON),(K,re)=>{W=null,D||(D=K,P=re,Q())}),H=i.n(v.transformRequest(v.normalizeSpriteURL(h,z,".png"),i.R.SpriteImage),(K,re)=>{H=null,D||(D=K,O=re,Q())});function Q(){if(D)w(D);else if(P&&O){const K=i.o.getImageData(O),re={};for(const le in P){const{width:ue,height:xe,x:me,y:Ee,sdf:Ie,pixelRatio:Ae,stretchX:Be,stretchY:Re,content:Ve}=P[le],Fe=new i.q({width:ue,height:xe});i.q.copy(K,Fe,{x:me,y:Ee},{x:0,y:0},{width:ue,height:xe},null),re[le]={data:Fe,pixelRatio:Ae!==void 0?Ae:1,sdf:Ie!==void 0&&Ie,stretchX:Be,stretchY:Re,content:Ve,usvg:!1,version:0}}w(null,re)}}return{cancel(){W&&(W.cancel(),W=null),H&&(H.cancel(),H=null)}}}(s,this.map._requestManager,(h,v)=>{if(this._spriteRequest=null,h)this.fire(new i.y(h));else if(v){const w=new Map;for(const P in v)w.set(i.I.from(P),v[P]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))})}addIconset(s,h){if(h.type==="sprite")return void this._loadSprite(h.url);const v=this.getOwnSourceCache(h.source);if(!v)return void this.fire(new i.y(new Error(`Source "${h.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const w=v.getSource();if(w.type!=="raster-array")return void this.fire(new i.y(new Error(`Source "${h.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));w.partial=!1;const P=new UR(s,this.scope,v);this.imageManager.addImageProvider(P,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!i.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const h=this.map._spriteFormat==="auto";var v,w;this._spriteRequest=(w=(P,O)=>{if(this._spriteRequest=null,P)h?this._loadSprite(s):this.fire(new i.y(P));else if(O){const D=new Map;for(const z in O)D.set(i.I.from(z),O[z]);this.addImages(D)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.z("data",{dataType:"style"}))},i.bt((v=this.map._requestManager).transformRequest(v.normalizeIconsetURL(s),i.R.Iconset),(P,O)=>{if(P)return void w(P);const D={},z=i.df(new i.bs(O));for(const W of z.icons){const H={version:1,pixelRatio:i.o.devicePixelRatio,content:$R(W),stretchX:W.metadata?fA(W.metadata.stretch_x_areas):void 0,stretchY:W.metadata?fA(W.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:W};D[W.name]=H}w(null,D)}))}_validateLayer(s){const h=this.getOwnSource(s.source);if(!h)return;const v=s.sourceLayer;v&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(v)===-1)&&this.fire(new i.y(new Error(`Source layer "${v}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{const v=this.fragments[h];return v&&v.style&&(s.data=v.style.serialize()),s})}_serializeSources(){const s={};for(const h in this._sourceCaches){const v=this._sourceCaches[h].getSource();s[v.id]||(s[v.id]=v.serialize())}return s}_serializeLayers(s){const h=[];for(const v of s){const w=this._layers[v];w&&w.type!=="custom"&&h.push(w.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const h=this.getOwnLayer(s);if(h)return h;this.fire(new i.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const h=this.getOwnSource(s);if(h)return h;this.fire(new i.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,h){const v=this.map.painter;if(v)for(let w=s.minzoom||0;w<(s.maxzoom||25.5);w++){const P=s.getProgramIds();if(P)for(const O of P){const D=s.getDefaultProgramParams(O,h.zoom,this._styleColorTheme.lut);D&&(v.style=this,this.fog&&(v._fogVisible=!0,D.overrideFog=!0,v.getOrCreateProgram(O,D)),v._fogVisible=!1,D.overrideFog=!1,v.getOrCreateProgram(O,D),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(D.overrideRtt=!0,v.getOrCreateProgram(O,D)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const v=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const D=this._changes.getLayerUpdatesByScope();for(const z in D){const{updatedIds:W,removedIds:H}=D[z];(W||H)&&(this._updateWorkerLayers(z,W,H),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const P={};for(const D in this._mergedSourceCaches){const z=this._mergedSourceCaches[D];P[D]=z.used,z.used=!1,z.tileCoverLift=0}for(const D of this._mergedOrder){const z=this._mergedLayers[D];if(z.recalculate(s,this._availableImages),!z.isHidden(s.zoom)){const W=this.getLayerSourceCache(z);W&&(W.used=!0,W.tileCoverLift=Math.max(W.tileCoverLift,z.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(z,s)}):this.precompilePrograms(z,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();const O=this.imageManager.getPendingImageProviders();for(const D of O)D.sourceCache.used=!0;for(const D in P){const z=this._mergedSourceCaches[D];P[D]!==z.used&&z.getSource().fire(new i.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:z.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),v&&this.fire(new i.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const h of s){const v=h.resolvePendingRequests(),w=this.getFragmentStyle(h.scope);w&&w.addImages(v)}}_updateTilesForChangedImages(){const s={};for(const h in this._mergedSourceCaches){const v=this._mergedSourceCaches[h].getSource().scope;s[v]=s[v]||this._changes.getUpdatedImages(v),s[v].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s[v])}for(const h in s)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(s,h,v){const w=this.getFragmentStyle(s);w&&this.dispatcher.broadcast("updateLayers",{layers:h?w._serializeLayers(h):[],scope:s,removedIds:v||[],options:w.options})}setState(s,h){if(this._checkLoaded(),Bd(this,wn(s)))return!1;(s=i.dn(s)).layers=Zf(s.layers);const v=function(O,D){if(!O)return[{command:Zn.setStyle,args:[D]}];let z=[];try{if(!i.bx(O.version,D.version))return[{command:Zn.setStyle,args:[D]}];if(i.bx(O.center,D.center)||z.push({command:Zn.setCenter,args:[D.center]}),i.bx(O.zoom,D.zoom)||z.push({command:Zn.setZoom,args:[D.zoom]}),i.bx(O.bearing,D.bearing)||z.push({command:Zn.setBearing,args:[D.bearing]}),i.bx(O.pitch,D.pitch)||z.push({command:Zn.setPitch,args:[D.pitch]}),i.bx(O.sprite,D.sprite)||z.push({command:Zn.setSprite,args:[D.sprite]}),i.bx(O.glyphs,D.glyphs)||z.push({command:Zn.setGlyphs,args:[D.glyphs]}),i.bx(O.imports,D.imports)||function(re=[],le=[],ue){le=le||[];const xe=(re=re||[]).map(_g),me=le.map(_g),Ee=re.reduce(xg,{}),Ie=le.reduce(xg,{}),Ae=xe.slice();let Be,Re,Ve,Fe;for(Be=0,Re=0;Be<xe.length;Be++)Ve=xe[Be],Ie.hasOwnProperty(Ve)?Re++:(ue.push({command:Zn.removeImport,args:[Ve]}),Ae.splice(Ae.indexOf(Ve,Re),1));for(Be=0,Re=0;Be<me.length;Be++)Ve=me[me.length-1-Be],Ae[Ae.length-1-Be]!==Ve&&(Ee.hasOwnProperty(Ve)?(ue.push({command:Zn.removeImport,args:[Ve]}),Ae.splice(Ae.lastIndexOf(Ve,Ae.length-Re),1)):Re++,Fe=Ae[Ae.length-Be],ue.push({command:Zn.addImport,args:[Ie[Ve],Fe]}),Ae.splice(Ae.length-Be,0,Ve));for(const Me of le){const qe=Ee[Me.id];qe&&(delete qe.data,i.bx(qe,Me)||ue.push({command:Zn.updateImport,args:[Me.id,Me]}))}}(O.imports,D.imports,z),i.bx(O.transition,D.transition)||z.push({command:Zn.setTransition,args:[D.transition]}),i.bx(O.light,D.light)||z.push({command:Zn.setLight,args:[D.light]}),i.bx(O.fog,D.fog)||z.push({command:Zn.setFog,args:[D.fog]}),i.bx(O.snow,D.snow)||z.push({command:Zn.setSnow,args:[D.snow]}),i.bx(O.rain,D.rain)||z.push({command:Zn.setRain,args:[D.rain]}),i.bx(O.projection,D.projection)||z.push({command:Zn.setProjection,args:[D.projection]}),i.bx(O.lights,D.lights)||z.push({command:Zn.setLights,args:[D.lights]}),i.bx(O.camera,D.camera)||z.push({command:Zn.setCamera,args:[D.camera]}),i.bx(O.iconsets,D.iconsets)||function(re,le,ue){let xe;for(xe in le=le||{},re=re||{})re.hasOwnProperty(xe)&&(le.hasOwnProperty(xe)||ue.push({command:Zn.removeIconset,args:[xe]}));for(xe in le){if(!le.hasOwnProperty(xe))continue;const me=le[xe];re.hasOwnProperty(xe)?i.bx(re[xe],me)||(ue.push({command:Zn.removeIconset,args:[xe]}),ue.push({command:Zn.addIconset,args:[xe,me]})):ue.push({command:Zn.addIconset,args:[xe,me]})}}(O.iconsets,D.iconsets,z),!i.bx(O["color-theme"],D["color-theme"]))return[{command:Zn.setStyle,args:[D]}];const W={},H=[];(function(re,le,ue,xe){let me;for(me in le=le||{},re=re||{})re.hasOwnProperty(me)&&(le.hasOwnProperty(me)||gg(me,ue,xe));for(me in le){if(!le.hasOwnProperty(me))continue;const Ee=le[me];re.hasOwnProperty(me)?i.bx(re[me],Ee)||(re[me].type==="geojson"&&Ee.type==="geojson"&&Yb(re,le,me)?ue.push({command:Zn.setGeoJSONSourceData,args:[me,Ee.data]}):yg(me,le,ue,xe)):Xb(me,le,ue)}})(O.sources,D.sources,H,W);const Q=[];O.layers&&O.layers.forEach(re=>{re.source&&W[re.source]?z.push({command:Zn.removeLayer,args:[re.id]}):Q.push(re)});let K=O.terrain;K&&W[K.source]&&(z.push({command:Zn.setTerrain,args:[void 0]}),K=void 0),z=z.concat(H),i.bx(K,D.terrain)||z.push({command:Zn.setTerrain,args:[D.terrain]}),function(re,le,ue){le=le||[];const xe=(re=re||[]).map(_g),me=le.map(_g),Ee=re.reduce(xg,{}),Ie=le.reduce(xg,{}),Ae=xe.slice(),Be=Object.create(null);let Re,Ve,Fe,Me,qe,ot,rt;for(Re=0,Ve=0;Re<xe.length;Re++)Fe=xe[Re],Ie.hasOwnProperty(Fe)?Ve++:(ue.push({command:Zn.removeLayer,args:[Fe]}),Ae.splice(Ae.indexOf(Fe,Ve),1));for(Re=0,Ve=0;Re<me.length;Re++)Fe=me[me.length-1-Re],Ae[Ae.length-1-Re]!==Fe&&(Ee.hasOwnProperty(Fe)?(ue.push({command:Zn.removeLayer,args:[Fe]}),Ae.splice(Ae.lastIndexOf(Fe,Ae.length-Ve),1)):Ve++,ot=Ae[Ae.length-Re],ue.push({command:Zn.addLayer,args:[Ie[Fe],ot]}),Ae.splice(Ae.length-Re,0,Fe),Be[Fe]=!0);for(Re=0;Re<me.length;Re++)if(Fe=me[Re],Me=Ee[Fe],qe=Ie[Fe],!Be[Fe]&&!i.bx(Me,qe))if(i.bx(Me.source,qe.source)&&i.bx(Me["source-layer"],qe["source-layer"])&&i.bx(Me.type,qe.type)){for(rt in vg(Me.layout,qe.layout,ue,Fe,null,Zn.setLayoutProperty),vg(Me.paint,qe.paint,ue,Fe,null,Zn.setPaintProperty),i.bx(Me.slot,qe.slot)||ue.push({command:Zn.setSlot,args:[Fe,qe.slot]}),i.bx(Me.filter,qe.filter)||ue.push({command:Zn.setFilter,args:[Fe,qe.filter]}),i.bx(Me.minzoom,qe.minzoom)&&i.bx(Me.maxzoom,qe.maxzoom)||ue.push({command:Zn.setLayerZoomRange,args:[Fe,qe.minzoom,qe.maxzoom]}),Me)Me.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?vg(Me[rt],qe[rt],ue,Fe,rt.slice(6),Zn.setPaintProperty):i.bx(Me[rt],qe[rt])||ue.push({command:Zn.setLayerProperty,args:[Fe,rt,qe[rt]]}));for(rt in qe)qe.hasOwnProperty(rt)&&!Me.hasOwnProperty(rt)&&rt!=="layout"&&rt!=="paint"&&rt!=="filter"&&rt!=="metadata"&&rt!=="minzoom"&&rt!=="maxzoom"&&rt!=="slot"&&(rt.indexOf("paint.")===0?vg(Me[rt],qe[rt],ue,Fe,rt.slice(6),Zn.setPaintProperty):i.bx(Me[rt],qe[rt])||ue.push({command:Zn.setLayerProperty,args:[Fe,rt,qe[rt]]}))}else ue.push({command:Zn.removeLayer,args:[Fe]}),ot=Ae[Ae.lastIndexOf(Fe)+1],ue.push({command:Zn.addLayer,args:[qe,ot]})}(Q,D.layers,z)}catch(W){console.warn("Unable to compute style diff:",W),z=[{command:Zn.setStyle,args:[D]}]}return z}(this.serialize(),s).filter(O=>!(O.command in iw));if(v.length===0)return!1;const w=v.filter(O=>!(O.command in VR));if(w.length>0)throw new Error(`Unimplemented: ${w.map(O=>O.command).join(", ")}.`);const P=[];return v.forEach(O=>{P.push(this[O.command](...O.args))}),h&&Promise.all(P).then(h).catch(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[h,v]of s.entries()){if(this.getImage(h))return this.fire(new i.y(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,v),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this}addImage(s,h){return this.getImage(s)?this.fire(new i.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this)}updateImage(s,h,v=!1){this.imageManager.updateImage(s,this.scope,h),v&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(s){return this.modelManager.addModelURLs(s,this.scope),this._updateWorkerModels(),this.fire(new i.z("data",{dataType:"style"})),this}addModel(s,h,v={}){return this._checkLoaded(),this._validate(dg,`models.${s}`,h,null,v)||(this.modelManager.addModel(s,h,this.scope),this.fire(new i.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope,!1,!0),this.fire(new i.z("data",{dataType:"style"})),this):this.fire(new i.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,h,v={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(On,`sources.${s}`,h,null,v))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=xs(s,h,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const P=O=>{const D=(O?"symbol:":"other:")+w.id,z=i.B(D,this.scope),W=this._sourceCaches[D]=new Jl(z,w,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=W,W.onAdd(this.map)};P(!1),h.type!=="vector"&&h.type!=="geojson"||P(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const w=Object.entries(this.stylesheet.iconsets).find(([P,O])=>O.type==="source"&&O.source===s);if(w)return this.fire(new i.y(new Error(`Source "${s}" cannot be removed while iconset "${w[0]}" is using it.`)))}const v=this.getOwnSourceCaches(s);for(const w of v){const P=i.dp(w.id);delete this._sourceCaches[P],this._changes.discardSourceCacheUpdate(w.id),w.fire(new i.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){const h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){const s=[];for(const h in this._otherSourceCaches){const v=this.getOwnSourceCache(h);v&&s.push(v.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const h in s){const v=s[h]._tiles;for(const w in v){const P=v[w];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const P of s){if(this._validate(ha,"lights",P))return;switch(P.type){case"ambient":if(this.ambientLight){const O=this.ambientLight;O.set(P),O.updateTransitions(h)}else this.ambientLight=new _a(P,fi||(fi=new i.a9({color:new i.aa(i.a6.properties_light_ambient.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const O=this.directionalLight;O.set(P),O.updateTransitions(h)}else this.directionalLight=new _a(P,sa||(sa=new i.a9({direction:new i.ap(i.a6.properties_light_directional.direction),color:new i.aa(i.a6.properties_light_directional.color),"color-use-theme":new i.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.aa(i.a6.properties_light_directional.intensity),"cast-shadows":new i.aa(i.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new i.aa(i.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.aa(i.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const v=Object.assign(h,{worldview:this.map.getWorldview()}),w=new i.ac(this.z||0,v);this.ambientLight&&this.ambientLight.recalculate(w),this.directionalLight&&this.directionalLight.recalculate(w),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;const v=K=>.2126*(K[0]<=.03928?K[0]/12.92:Math.pow((K[0]+.055)/1.055,2.4))+.7152*(K[1]<=.03928?K[1]/12.92:Math.pow((K[1]+.055)/1.055,2.4))+.0722*(K[2]<=.03928?K[2]/12.92:Math.pow((K[2]+.055)/1.055,2.4)),w=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=s.properties.get("intensity"),O=s.properties.get("direction"),D=1-i.d3(O.x,O.y,O.z)[2]/90,z=v(w)*P*D,W=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),H=h.properties.get("intensity"),Q=v(W)*H;return Number(((z+Q)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(i.dq(s)){const h=i.dr(s),v=this.fragments.find(({id:P})=>P===h);if(!v)return;const w=i.dp(s);return v.style.getFragmentStyle(w)}{const h=this.fragments.find(({id:v})=>v===s);return h?h.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const h={},v=(w,P="")=>`${w}::${P}`;this._featuresetSelectors={};for(const w in s){const P=this._featuresetSelectors[w]=[];for(const O of s[w].selectors){if(O.featureNamespace){const z=this.getOwnLayer(O.layer);if(!z){i.w(`Layer is undefined for selector: ${O.layer}`);continue}const W=v(z.source,z.sourceLayer);if(W in h&&h[W]!==O.featureNamespace){i.w(`"featureNamespace ${O.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}h[W]=O.featureNamespace}let D;if(O.properties)for(const z in O.properties){const W=i.U(O.properties[z]);W.result==="success"&&(D=D||{},D[z]=W.value)}P.push({layerId:O.layer,namespace:O.featureNamespace,properties:D,uniqueFeatureID:O._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const h=this.getFragmentStyle(s);if(!h||!h.stylesheet.featuresets)return[];const v=[];for(const w in h.stylesheet.featuresets)v.push({featuresetId:w,importId:h.scope?h.scope:void 0});return v}getFeaturesetLayers(s,h){const v=this.getFragmentStyle(h),w=v.stylesheet.featuresets;if(!w||!w[s])return this.fire(new i.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const P=[];for(const O of w[s].selectors){const D=v.getOwnLayer(O.layer);D&&P.push(D)}return P}getConfigProperty(s,h){const v=this.getFragmentStyle(s);if(!v)return null;const w=i.B(h,v.scope),P=v.options.get(w),O=P?P.value||P.default:null;return O?O.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(s,h){const v=i.B(s,h);return this._mergedIndoor[v]}setIndoorData(s,h){this.map.indoor.setIndoorData(h)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(s,h,v){const w=this.getFragmentStyle(s);if(!w)return;const P=w.stylesheet.schema;if(!P||!P[h])return;const O=i.U(v);if(O.result!=="success")return void Bd(this,O.value);const D=O.value.expression,z=i.B(h,w.scope),W=w.options.get(z);if(!W)return;let H;const{minValue:Q,maxValue:K,stepValue:re,type:le,values:ue}=P[h],xe=i.U(P[h].default);xe.result==="success"&&(H=xe.value.expression),H?(this.options.set(z,Object.assign({},W,{value:D,default:H,minValue:Q,maxValue:K,stepValue:re,type:le,values:ue})),this.updateConfigDependencies(h)):this.fire(new i.y(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){const h=this.getFragmentStyle(s);if(!h)return null;const v=h.stylesheet.schema;if(!v)return null;const w={};for(const P in v){const O=i.B(P,h.scope),D=h.options.get(O),z=D?D.value||D.default:null;w[P]=z?z.serialize():null}return w}setConfig(s,h){const v=this.getFragmentStyle(s);v&&(v.updateConfig(h,v.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){const v=this.getFragmentStyle(s);v&&(v.stylesheet.schema=h,v.updateConfig(v._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(const v in h){let w,P;const O=i.U(h[v].default);if(O.result==="success"&&(w=O.value.expression),s&&s[v]!==void 0){const K=i.U(s[v]);K.result==="success"&&(P=K.value.expression)}const{minValue:D,maxValue:z,stepValue:W,type:H,values:Q}=h[v];if(w){const K=i.B(v,this.scope);this.options.set(K,{default:w,value:P,minValue:D,maxValue:z,stepValue:W,type:H,values:Q})}else this.fire(new i.y(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new i.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(s,h=()=>!0){for(const v of s){const w=this.getLayer(v);w&&h(w)&&(w.possiblyEvaluateVisibility(),this._updateLayer(w),this._changes.setDirty())}}updateConfigDependencies(s){this._updateLayers(this._configDependentLayers,h=>!s||h.expressionDependencies.configDependencies.has(s)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const v=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(v){const w=h._evaluateColorThemeData(v);(!h._styleColorTheme.lut&&w!==""||h._styleColorTheme.lut&&w!==h._styleColorTheme.lut.data)&&h.setColorTheme(v)}}),this._changes.setDirty()}addLayer(s,h,v={}){this._checkLoaded();const w=s.id;if(this._layers[w])return void this.fire(new i.y(new Error(`Layer with id "${w}" already exists on this map`)));let P;if(s.type==="custom"){if(Bd(this,i.ds(s)))return;P=i.dt(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(w,s.source),s=i.dn(s),s=Object.assign(s,{source:w})),this._validate(rs,`layers.${w}`,s,{arrayIndex:-1},v))return;P=i.dt(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}})}const O=i.B(P.source,P.scope);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(O),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(O);let D=this._order.length;if(h){const Q=this._order.indexOf(h);if(Q===-1)return void this.fire(new i.y(new Error(`Layer with id "${h}" does not exist on this map.`)));P.slot===this._layers[h].slot?D=Q:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(D,0,w),this._layerOrderChanged=!0,this._layers[w]=P;const z=this.getOwnLayerSourceCache(P),W=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&P.canCastShadows()&&W&&(z.castsShadows=!0);const H=this._changes.getRemovedLayer(P);if(H&&P.source&&z&&P.type!=="custom"){this._changes.discardLayerRemoval(P);const Q=i.B(P.source,P.scope);H.type!==P.type?this._changes.updateSourceCache(Q,"clear"):(this._changes.updateSourceCache(Q,"reload"),z.pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map),P.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();const v=this._checkLayer(s);if(!v||s===h)return;const w=this._order.indexOf(s);this._order.splice(w,1);let P=this._order.length;if(h){const O=this._order.indexOf(h);if(O===-1)return void this.fire(new i.y(new Error(`Layer with id "${h}" does not exist on this map.`)));v.slot===this._layers[h].slot?P=O:i.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(P,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);const v=this._order.indexOf(s);this._order.splice(v,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(h.fqid),this._indoorDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const w=this.getOwnLayerSourceCache(h);if(w&&w.castsShadows){let P=!1;for(const O in this._layers)if(this._layers[O].source===h.source&&this._layers[O].canCastShadows()){P=!0;break}w.castsShadows=P}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,v){this._checkLoaded();const w=this._checkLayer(s);w&&(w.minzoom===h&&w.maxzoom===v||(h!=null&&(w.minzoom=h),v!=null&&(w.maxzoom=v),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();const v=this._checkLayer(s);v&&v.slot!==h&&(v.slot=h,this._updateLayer(v))}setFilter(s,h,v={}){this._checkLoaded();const w=this._checkLayer(s);if(w&&!i.bx(w.filter,h))return h==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(xn,`layers.${w.id}.filter`,h,{layerType:w.type},v)||(w.filter=i.dn(h),this._updateLayer(w)))}getFilter(s){const h=this._checkLayer(s);if(h)return i.dn(h.filter)}setLayoutProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);if(P&&!i.bx(P.getLayoutProperty(h),v)){if(v!=null&&(!w||w.validate!==!1)&&Bd(P,Gb.call(wn,{key:`layers.${s}.layout.${h}`,layerType:P.type,objectKey:h,value:v,styleSpec:i.a6,style:{glyphs:!0,sprite:!0}})))return;P.setLayoutProperty(h,v),P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),this._updateLayer(P)}}setLayerProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);P&&(h==="appearances"?(P.setAppearances(v),this._changes.setDirty()):P.isPaintProperty(h)?this.setPaintProperty(s,h,v,w):this.setLayoutProperty(s,h,v,w))}getLayoutProperty(s,h){const v=this._checkLayer(s);if(v)return v.getLayoutProperty(h)}setPaintProperty(s,h,v,w={}){this._checkLoaded();const P=this._checkLayer(s);if(!P||i.bx(P.getPaintProperty(h),v)||v!=null&&(!w||w.validate!==!1)&&Bd(P,ns.call(wn,{key:`layers.${s}.paint.${h}`,layerType:P.type,objectKey:h,value:v,styleSpec:i.a6})))return;const O=P.setPaintProperty(h,v);P.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(P.fqid),P.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(P.fqid),O&&this._updateLayer(P),this._changes.updatePaintProperties(P)}getPaintProperty(s,h){const v=this._checkLayer(s);if(v)return v.getPaintProperty(h)}setFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:z,importId:W}=s.target,H=this.getFragmentStyle(W),Q=H.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of Q)H.setFeatureState({id:s.id,source:K,sourceLayer:re},h)}else if("layerId"in s.target){const{layerId:z}=s.target,W=this.getLayer(z);this.setFeatureState({id:s.id,source:W.source,sourceLayer:W.sourceLayer},h)}return}const v=s.source,w=s.sourceLayer,P=this._checkSource(v);if(!P)return;const O=P.type;if(O==="geojson"&&w)return void this.fire(new i.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(O==="vector"&&!w)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided.")));const D=this.getOwnSourceCaches(v);for(const z of D)z.setFeatureState(w,s.id,h)}removeFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:z,importId:W}=s.target,H=this.getFragmentStyle(W),Q=H.getFeaturesetLayers(z);for(const{source:K,sourceLayer:re}of Q)H.removeFeatureState({id:s.id,source:K,sourceLayer:re},h)}else if("layerId"in s.target){const{layerId:z}=s.target,W=this.getLayer(z);this.removeFeatureState({id:s.id,source:W.source,sourceLayer:W.sourceLayer},h)}return}const v=s.source,w=this._checkSource(v);if(!w)return;const P=w.type,O=P==="vector"?s.sourceLayer:void 0;if(P==="vector"&&!O)return void this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new i.y(new Error("A feature id is required to remove its specific state property.")));const D=this.getOwnSourceCaches(v);for(const z of D)z.removeFeatureState(O,s.id,h)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let P;if("featuresetId"in s.target){const{featuresetId:O,importId:D}=s.target,z=this.getFragmentStyle(D),W=z.getFeaturesetLayers(O);for(const{source:H,sourceLayer:Q}of W){const K=z.getFeatureState({id:s.id,source:H,sourceLayer:Q});if(K&&!P)P=K;else if(!i.bx(P,K))return void this.fire(new i.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:O}=s.target,D=this.getLayer(O);P=this.getFeatureState({id:s.id,source:D.source,sourceLayer:D.sourceLayer})}return P}const h=s.source,v=s.sourceLayer,w=this._checkSource(h);if(w){if(w.type!=="vector"||v)return s.id===void 0&&this.fire(new i.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(v,s.id);this.fire(new i.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return i.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>v!==void 0)}_updateFilteredLayers(s){for(const h of Object.values(this._mergedLayers))s(h)&&this._updateLayer(h)}_updateLayer(s){this._changes.updateLayer(s);const h=this.getLayerSourceCache(s),v=i.B(s.source,s.scope),w=this._changes.getUpdatedSourceCaches();s.source&&!w[v]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(v,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=D=>this._mergedLayers[D].is3D(!!this.terrain),v=this.order,w={},P=[];for(let D=v.length-1;D>=0;D--){const z=v[D];if(h(z)){w[z]=D;for(const W of s){const H=W[z];if(H)for(const Q of H)P.push(Q)}}}P.sort((D,z)=>z.intersectionZ-D.intersectionZ);const O=[];for(let D=v.length-1;D>=0;D--){const z=v[D];if(h(z))for(let W=P.length-1;W>=0;W--){const H=P[W].feature;if(H.layer&&w[H.layer.id]<D)break;O.push(H),P.pop()}else for(const W of s){const H=W[z];if(H)for(const Q of H)O.push(Q.feature)}}return O}queryRasterValue(s,h,v){const w=this.getOwnSource(s);return w?w.type!=="raster-array"?(this.fire(new i.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):w.queryRasterArrayValue(h,v):(this.fire(new i.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,h,v){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(xn,"queryRenderedFeatures.filter",h.filter,null,h),w=i.b5(h.filter));const P={},O=H=>{if(Wv.has(H.type))return;const Q=this.getOwnLayerSourceCache(H),K=P[Q.id]=P[Q.id]||{sourceCache:Q,layers:{},has3DLayers:!1};H.is3D(!!this.terrain)&&(K.has3DLayers=!0),K.layers[H.fqid]=K.layers[H.fqid]||{styleLayer:H,targets:[]},K.layers[H.fqid].targets.push({filter:w})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new i.y(new Error("parameters.layers must be an Array."))),[];for(const H of h.layers){const Q=this._layers[H];if(!Q)return this.fire(new i.y(new Error(`The layer '${H}' does not exist in the map's style and cannot be queried for features.`))),[];O(Q)}}else for(const H in this._layers)O(this._layers[H]);const D=this._queryRenderedFeatures(s,P,v),z=this._flattenAndSortRenderedFeatures(D),W=[];for(const H of z)i.dv(H.layer.id)===this.scope&&W.push(H);return W}queryRenderedFeatureset(s,h,v){let w;h&&!Array.isArray(h)&&h.filter&&(this._validate(xn,"queryRenderedFeatures.filter",h.filter,null,h),w=i.b5(h.filter));const P="mock",O=[];if(h&&h.target)O.push(Object.assign({},h,{targetId:P,filter:w}));else{const H=this.getFeaturesetDescriptors();for(const Q of H)O.push({targetId:P,filter:w,target:Q});for(const{style:Q}of this.fragments){const K=Q.getFeaturesetDescriptors();for(const re of K)O.push({targetId:P,filter:w,target:re})}}const D=this.queryRenderedTargets(s,O,v),z=[],W=new Set;for(const H of D)for(const Q of H.variants[P])Zs(Q,H,W)||z.push(new i.dw(H,Q));return z}queryRenderedTargets(s,h,v){const w={},P=(D,z,W,H)=>{const Q=w[z.id]=w[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};if(Q.layers[D.fqid]=Q.layers[D.fqid]||{styleLayer:D,targets:[]},D.is3D(!!this.terrain)&&(Q.has3DLayers=!0),!H)return W.uniqueFeatureID=!1,void Q.layers[D.fqid].targets.push(W);Q.layers[D.fqid].targets.push(Object.assign({},W,{namespace:H.namespace,properties:H.properties,uniqueFeatureID:H.uniqueFeatureID}))};for(const D of h)if("featuresetId"in D.target){const{featuresetId:z,importId:W}=D.target,H=this.getFragmentStyle(W);if(!H||!H._featuresetSelectors)continue;const Q=H._featuresetSelectors[z];if(!Q){this.fire(new i.y(new Error(`The featureset '${z}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const K of Q){const re=H.getOwnLayer(K.layerId);re&&!Wv.has(re.type)&&P(re,H.getOwnLayerSourceCache(re),D,K)}}else if("layerId"in D.target){const{layerId:z}=D.target,W=this.getLayer(z);if(!W||Wv.has(W.type))continue;P(W,this.getLayerSourceCache(W),D)}const O=this._queryRenderedFeatures(s,w,v);return this._flattenAndSortRenderedFeatures(O)}_queryRenderedFeatures(s,h,v){const w=[],P=!!this.map._showQueryGeometry,O=li.createFromScreenPoints(s,v);for(const D in h){const z=Xs(O,h[D],this._availableImages,v,P);Object.keys(z).length&&w.push(z)}if(this.placement)for(const D in h){if(!h[D].sourceCache._onlySymbols)continue;const z=Mv(O.screenGeometry,h[D],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(z).length&&w.push(z)}return w}querySourceFeatures(s,h){const v=h&&h.filter;v&&this._validate(xn,"querySourceFeatures.filter",v,null,h);let w=[];const P=this.getOwnSourceCaches(s);for(const O of P)w=w.concat(hg(O,h));return w}addSourceType(s,h,v){return rc.getSourceType(s)?v(new Error(`A source type called "${s}" already exists.`)):(rc.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,v={}){this._checkLoaded();const w=this.light.getLight();let P=!1;for(const D in s)if(!i.bx(s[D],w[D])){P=!0;break}if(!P)return;const O=this._getTransitionParameters();this.light.setLight(s,h,v),this.light.updateTransitions(O)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let v=s;const w=s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if(typeof v.source=="object"){const D="terrain-dem-src";this.addSource(D,v.source),v=i.dn(v),v=Object.assign(v,{source:D})}const P=Object.assign({},v),O={};if(this.terrain&&w){P.source=this.terrain.get().source;const D=this.terrain?this.getFragmentStyle(this.terrain.scope):null;D&&(O.style=D.serialize())}if(this._validate($o,"terrain",P,O))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&h!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,h),this.fire(new i.z("data",{dataType:"style"}))}else{const P=this.terrain,O=P.get();for(const D of Object.keys(i.a6.terrain))!v.hasOwnProperty(D)&&i.a6.terrain[D].default&&(v[D]=i.a6.terrain[D].default);for(const D in s)if(!i.bx(s[D],O[D])){P.set(s,this.options),this.stylesheet.terrain=s;const z=this._getTransitionParameters({duration:0});P.updateTransitions(z),this.fire(new i.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new kr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_createSnow(s){const h=this.snow=new Fa(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_createRain(s){const h=this.rain=new Sa(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.snow=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!i.bx(h.get(),s)){h.set(s,this.options),this.stylesheet.rain=h.get();const v=this._getTransitionParameters({duration:0});h.updateTransitions(v)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void s();const v=this._evaluateColorThemeData(h);this._loadColorTheme(v).then(()=>{this.fire(new i.z("colorthemeset")),s()}).catch(w=>{i.w(`Couldn't set color theme: ${w}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,h){const v=this.getFragmentStyle(s);v&&(v._styleColorTheme.colorThemeOverride=h,v._reloadColorTheme())}_getTransitionParameters(s){return{now:i.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],h=[];for(const v of this._mergedOrder)this.isLayerDraped(this._mergedLayers[v])?s.push(v):h.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const v=this.terrain=new nt(s,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,v,w,P={}){if(P&&P.validate===!1)return!1;const O=Object.assign({},this.serialize());return Bd(this,s.call(wn,Object.assign({key:h,style:O,value:v,styleSpec:i.a6},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const h=this.getSourceCaches(s);for(const v of h)v.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const h=this._mergedLayers[s];h._clear&&h._clear()}}reloadSource(s){const h=this.getSourceCaches(s);for(const v of h)v.resume(),v.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let h;this.directionalLight&&(h=dA(this.directionalLight));const v=new Set;for(const w in this._mergedLayers){const P=this._mergedLayers[w];P.hasElevation()&&!v.has(P.source)&&v.add(P.source)}for(const w in this._mergedSourceCaches){const P=this._mergedSourceCaches[w],O=v.has(P._source.id);P.update(s,void 0,void 0,h,O)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_updatePlacement(s,h,v,w,P,O,D=!1){let z=!1,W=!1;const H={},Q={};for(const K of this._mergedOrder){const re=this._mergedLayers[K];if(re.type!=="symbol")continue;const le=i.B(re.source,re.scope);let ue=H[le];if(!ue){const me=this.getLayerSourceCache(re);if(!me)continue;const Ee=me.getRenderableIds(!0).map(Ie=>me.getTileByID(Ie));Q[le]=Ee.slice(),ue=H[le]=Ee.sort((Ie,Ae)=>Ae.tileID.overscaledZ-Ie.tileID.overscaledZ||(Ie.tileID.isLessThan(Ae.tileID)?-1:1))}const xe=this.crossTileSymbolIndex.addLayer(re,ue,h.center.lng,h.projection);z=z||xe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),D=D||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new i.z("neworder")),(D||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.o.now(),h.zoom))&&(this.pauseablePlacement=new Ms(h,this._mergedOrder,D,v,w,P,this.placement,this.fog&&h.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,H,Q,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.o.now()),W=!0),z&&this.pauseablePlacement.placement.setStale()),W||z){this._buildingIndex.onNewFrame(h.zoom);for(let K=0;K<this._mergedOrder.length;K++){const re=this._mergedLayers[this._mergedOrder[K]];if(re.type!=="symbol")continue;const le=this.isLayerClipped(re);this.placement.updateLayerOpacities(re,H[i.B(re.source,re.scope)],K,le?O:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.o.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();const v=this.stylesheet.imports=this.stylesheet.imports||[];if(v.findIndex(({id:P})=>P===s.id)!==-1)return void this.fire(new i.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return v.push(s),this._loadImports([s],!0);const w=v.findIndex(({id:P})=>P===h);return w===-1&&this.fire(new i.y(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=v.slice(0,w).concat(s).concat(v.slice(w)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(s);return w===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==v[w].url&&this.setImportUrl(s,h.url),i.bx(h.config,v[w].config)||this.setImportConfig(s,h.config,h.data.schema),i.bx(h.data,v[w].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let v=this.stylesheet.imports||[];const w=this.getImportIndex(s);if(w===-1)return this;const P=this.getImportIndex(h);if(P===-1)return this;const O=v[w],D=this.fragments[w];return v=v.filter(({id:z})=>z!==s),this.fragments=this.fragments.filter(({id:z})=>z!==s),this.stylesheet.imports=v.slice(0,P).concat(O).concat(v.slice(P)),this.fragments=this.fragments.slice(0,P).concat(D).concat(this.fragments.slice(P)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(s);if(w===-1)return this;v[w].url=h;const P=this.fragments[w];return P.style=this._createFragmentStyle(v[w]),P.style.on("style.import.load",()=>this.mergeAll()),P.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();const v=this.getImportIndex(s),w=this.stylesheet.imports||[];return v===-1?this:h?(this.fragments[v].style.setState(h),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(s,w[v].url))}setImportConfig(s,h,v){this._checkLoaded();const w=this.getImportIndex(s),P=this.stylesheet.imports||[];if(w===-1)return this;h?P[w].config=h:delete P[w].config;const O=this.fragments[w];v&&O.style.stylesheet&&(O.style.stylesheet.schema=v);const D=O.style.stylesheet&&O.style.stylesheet.schema;return O.config=h,O.style.updateConfig(h,D),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const h=this.stylesheet.imports||[],v=this.getImportIndex(s);v!==-1&&(h.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports())}getImportIndex(s){const h=(this.stylesheet.imports||[]).findIndex(v=>v.id===s);return h===-1&&this.fire(new i.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const h in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[h];v&&s.push(v.getSource())}return s}getSource(s,h){const v=this.getSourceCache(s,h);return v&&v.getSource()}getLayerSource(s){const h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){const v=i.B(s,h);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(s){const h=i.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const h in s){const v=s[h];v==="reload"?this.reloadSource(h):v==="clear"&&this.clearSource(h)}}updateLayers(s){const h=this._changes.getUpdatedPaintProperties();for(const v of h){const w=this.getLayer(v);w&&w.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,h,v){this.imageManager.getImages(h.images,h.scope,v),this._updateTilesForChangedImages();const w=O=>{if(O){const D=h.images.map(z=>i.I.toString(z));O.setDependencies(h.tileID.key,h.type,D)}},P=i.B(h.source,h.scope);w(this._mergedOtherSourceCaches[P]),w(this._mergedSymbolSourceCaches[P]),h.images.some(O=>O.iconsetId)&&this.fire(new i.z("data",{dataType:"style"}))}rasterizeImages(s,h,v){this.imageManager.rasterizeImages(h,v)}getGlyphs(s,h,v){this.glyphManager.getGlyphs(h.stacks,v)}getResource(s,h,v){return i.dy(h,v)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new i.y(new Error(`There is no source with ID '${s}'`))),!1):h.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const v=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),w=s.type==="building";if(s.is3D(!!this.terrain)){if(v||w||h&&h.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}rc.getSourceType=function(y){return Yl[y]},rc.setSourceType=function(y,s){Yl[y]=s},rc.registerForPluginStateChange=i.dz;class Vh extends i.E{constructor(s){super(),this._style=s,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},i.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(s){s===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=s,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(s){this._activeFloorsVisible=s,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(s){for(const[h,v]of Object.entries(s.buildings))if(this._buildings[h])for(const w of v.floorIds)this._buildings[h].floors[w]||(this._buildings[h].floors[w]=v.floors[w]);else this._buildings[h]=v;for(const h of s.activeFloors)this._activeFloors.add(h);this._updateIndoorSelector()}getIndoorTileOptions(s,h){const v=this._style.getIndoorSourceLayers(s,h);return v&&this._indoorState?{sourceLayers:v,indoorState:this._indoorState}:null}_updateUI(s,h,v){const w=function(P,O,D,z){let W=null,H=Number.MAX_SAFE_INTEGER;if(z<16)return null;for(const[Q,K]of Object.entries(P)){const re=K.center;if(re){const le=O.distanceTo(i.aS.convert(re));le<H&&D.contains(re)&&(H=le,W=Q)}}return W}(this._buildings,h,v,s);w!==this._closestBuildingId&&(this._closestBuildingId=w,this._updateIndoorSelector())}_updateIndoorSelector(){const s=this._buildings,h=this._closestBuildingId,v=h&&s?s[h]:void 0;if(!v)return void this.fire(new i.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let w=null;for(const O of v.floorIds)if(this._activeFloors&&this._activeFloors.has(O)){w=O;break}const P=Array.from(v.floorIds).map(O=>({id:O,name:v.floors[O].name,zIndex:v.floors[O].zIndex})).sort((O,D)=>D.zIndex-O.zIndex);this.fire(new i.z("selector-update",{selectedFloorId:w,activeFloorsVisible:this._activeFloorsVisible,floors:P}))}_updateActiveFloors(){const s=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:s,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var jg=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,sw=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,lw=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,rp="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",np=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,cw=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gv=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,_l=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hv=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Yt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,uw=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ip=[];nc(jg,ip),nc(lw,ip),nc(sw,ip);const ap={"_prelude_fog.vertex.glsl":cw,"_prelude_terrain.vertex.glsl":np,"_prelude_shadow.vertex.glsl":Yt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Gv,"_prelude_shadow.fragment.glsl":uw,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_l,"_prelude_raster_particle.glsl":Hv},Ng={};In("",np),In(Gv,cw),In(uw,Yt),In(_l,""),In(Hv,"");const Mg=In(sw,lw),au=jg;var Kv={background:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:In(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:In("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:In(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:In(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:In("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:In("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:In("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:In(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:In(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:In(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:In(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:In(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:In("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:In("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:In(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:In(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:In("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:In(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rp),skyboxGradient:In(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,rp),skyboxCapture:In(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:In(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:In(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:In(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:In(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:In("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:In("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:In("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:In("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function nc(y,s){const h=y.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of h)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const P of w)s.includes(P)||s.push(P)}}function In(y,s){const h=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,w={},P=[],O=[];if(y=y.replace(h,(z,W)=>(O.push(W),"")),(s=s.replace(h,(z,W)=>(P.push(W),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let D=[...ip];nc(y,D),nc(s,D);for(const z of[...P,...O])ap[z]||console.error(`Undefined include: ${z}`),Ng[z]||(Ng[z]=[],nc(ap[z],Ng[z])),D=[...D,...Ng[z]];return{fragmentSource:y=y.replace(v,(z,W,H,Q,K)=>(w[K]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_${K}
in ${H} ${Q} ${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:W==="initialize"?`
#ifdef HAS_UNIFORM_u_${K}
    ${H} ${Q} ${K} = u_${K};
#endif
`:W==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Q} ${K};
#endif
`:W==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(v,(z,W,H,Q,K)=>{const re=`MATERIAL_ATTRIBUTE_OFFSET_${K}`,le=Q==="float"?"vec2":Q,ue=`GET_ATTRIBUTE_${le}(a_${K}, materialInfo, ${re})`,xe=K.match(/color/)?"color":le;return W==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${K}
in ${H} ${Q} a_${K};
#endif
`:w[K]?W==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
    #if !defined(${re})
        in ${H} ${le} a_${K};
    #endif
out ${H} ${Q} ${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:W==="initialize"?xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    ${K} = a_${K};
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${K}) 
    #ifdef ${re}
        ${K} = unpack_mix_${xe}(${ue}, u_${K}_t);
    #else
        ${K} = unpack_mix_${xe}(a_${K}, u_${K}_t);
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:W==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    in ${H} ${Q} a_${K};
    out ${H} ${Q} ${K};
#endif
`:W==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${K} = a_${K};
#endif
`:void 0:W==="define"?`
#ifndef HAS_UNIFORM_u_${K}
uniform lowp float u_${K}_t;
    #if !defined(${re})
        in ${H} ${le} a_${K};
    #endif  
#else
uniform ${H} ${Q} u_${K};
#endif
`:W==="define-instanced"?xe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${K}0;
in vec4 a_${K}1;
in vec4 a_${K}2;
in vec4 a_${K}3;
#else
uniform ${H} ${Q} u_${K};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${H} ${le} a_${K};
#else
uniform ${H} ${Q} u_${K};
#endif
`:W==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${K}
    ${H} ${Q} ${K} = a_${K};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${K}
    #ifdef ${re}
        ${H} ${Q} ${K} = ${ue};
    #else
        ${H} ${Q} ${K} = a_${K};
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`:`
#ifndef HAS_UNIFORM_u_${K}
    #ifdef ${re}
        ${H} ${Q} ${K} = unpack_mix_${xe}(${ue}, u_${K}_t);
    #else
        ${H} ${Q} ${K} = unpack_mix_${xe}(a_${K}, u_${K}_t);
    #endif
#else
    ${H} ${Q} ${K} = u_${K};
#endif
`}),usedDefines:D,vertexIncludes:P,fragmentIncludes:O}}class op{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,v,w,P,O,D,z){this.context=s;let W=this.boundPaintVertexBuffers.length!==w.length;for(let Q=0;!W&&Q<w.length;Q++)this.boundPaintVertexBuffers[Q]!==w[Q]&&(W=!0);let H=this.boundDynamicVertexBuffers.length!==D.length;for(let Q=0;!H&&Q<D.length;Q++)this.boundDynamicVertexBuffers[Q]!==D[Q]&&(H=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==v||W||H||this.boundIndexBuffer!==P||this.boundVertexOffset!==O)this.freshBind(h,v,w,P,O,D,z);else{s.bindVertexArrayOES.set(this.vao);for(const Q of D)Q&&(Q.bind(),z&&Q.instanceCount&&Q.setVertexAttribDivisor(s.gl,h,z));P&&P.dynamicDraw&&P.bind()}}freshBind(s,h,v,w,P,O,D){const z=this.context,W=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=P,this.boundDynamicVertexBuffers=O,h.enableAttributes(W,s),h.bind(),h.setVertexAttribPointers(W,s,P);for(const H of v)H.enableAttributes(W,s),H.bind(),H.setVertexAttribPointers(W,s,P);for(const H of O)H&&(H.enableAttributes(W,s),H.bind(),H.setVertexAttribPointers(W,s,P),D&&H.instanceCount&&H.setVertexAttribDivisor(W,s,D));w&&w.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function qR(y,s){const h=Math.pow(2,s.canonical.z),v=s.canonical.y;return[new i.ae(0,v/h).toLngLat().lat,new i.ae(0,(v+1)/h).toLngLat().lat]}function WR(y,s,h,v,w,P,O){const D=y.context,z=D.gl,W=h.hillshadeFBO;if(!W)return;y.prepareDrawTile();const H=y.isTileAffectedByFog(s),Q=y.getOrCreateProgram("hillshade",{overrideFog:H});D.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,W.colorAttachment.get());const K=((xe,me,Ee,Ie)=>{const Ae=Ee.paint.get("hillshade-shadow-color"),Be=Ee.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Re=Ee.paint.get("hillshade-highlight-color"),Ve=Ee.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Fe=Ee.paint.get("hillshade-accent-color"),Me=Ee.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",qe=Ee.paint.get("hillshade-emissive-strength");let ot=i.an(Ee.paint.get("hillshade-illumination-direction"));if(Ee.paint.get("hillshade-illumination-anchor")==="viewport")ot-=xe.transform.angle;else if(xe.style&&xe.style.enable3dLights()&&xe.style.directionalLight){const wt=xe.style.directionalLight.properties.get("direction"),pt=i.d3(wt.x,wt.y,wt.z);ot=i.an(pt[1])}const rt=!xe.options.moving;return{u_matrix:Ie||xe.transform.calculateProjMatrix(me.tileID.toUnwrapped(),rt),u_image:0,u_latrange:qR(0,me.tileID),u_light:[Ee.paint.get("hillshade-exaggeration"),ot],u_shadow:Ae.toPremultipliedRenderColor(Be?null:Ee.lut),u_highlight:Re.toPremultipliedRenderColor(Ve?null:Ee.lut),u_emissive_strength:qe,u_accent:Fe.toPremultipliedRenderColor(Me?null:Ee.lut)}})(y,h,v,y.terrain?s.projMatrix:null);y.uploadCommonUniforms(D,Q,s.toUnwrapped());const{tileBoundsBuffer:re,tileBoundsIndexBuffer:le,tileBoundsSegments:ue}=y.getTileBoundsBuffers(h);Q.draw(y,z.TRIANGLES,w,P,O,qr.disabled,K,v.id,re,le,ue)}function Zv(y,s,h){if(!s.needsDEMTextureUpload)return;const v=y.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||y.getTileTexture(h.stride);const P=h.getPixels();s.demTexture?s.demTexture.update(P,{premultiply:!1}):s.demTexture=new i.T(v,P,w.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function GR(y,s,h){const v=y.context,w=v.gl;if(!s.dem)return;const P=s.dem;if(v.activeTexture.set(w.TEXTURE1),Zv(y,s,P),!s.demTexture)return;s.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const O=P.dim;v.activeTexture.set(w.TEXTURE0);let D=s.hillshadeFBO;if(!D){const K=new i.T(v,{width:O,height:O,data:null},w.RGBA8);K.bind(w.LINEAR,w.CLAMP_TO_EDGE),D=s.hillshadeFBO=v.createFramebuffer(O,O,!0,"renderbuffer"),D.colorAttachment.set(K.texture)}v.bindFramebuffer.set(D.framebuffer),v.viewport.set([0,0,O,O]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:W,tileBoundsSegments:H}=y.getMercatorTileBoundsBuffers(),Q=[];y.linearFloatFilteringSupported()&&Q.push("TERRAIN_DEM_FLOAT_FORMAT"),y.getOrCreateProgram("hillshadePrepare",{defines:Q}).draw(y,w.TRIANGLES,Sr.disabled,Xr.disabled,pn.unblended,qr.disabled,((K,re)=>{const le=re.stride,ue=i.bB();return i.cd(ue,0,i.al,-i.al,0,0,1),i.bq(ue,ue,[0,-i.al,0]),{u_matrix:ue,u_image:1,u_dimension:[le,le],u_zoom:K.overscaledZ}})(s.tileID,P),h.id,z,W,H),s.needsHillshadePrepare=!1}class Qi{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class pA extends Qi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class dw extends Qi{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class HR extends Qi{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class KR extends Qi{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class ZR extends Qi{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class XR extends Qi{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class mA extends Qi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class YR extends Qi{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Xv extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class JR extends Qi{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class gA extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class hw extends Qi{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Yv extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class fw extends Qi{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class qh extends Qi{getDefault(){return i.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class sp extends Qi{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Dg extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class lp extends Qi{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class yA extends Qi{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let pw=class extends Qi{getDefault(){return null}set(y){(y!==this.current||this.dirty)&&(this.gl.useProgram(y),this.current=y,this.dirty=!1)}};class vA extends Qi{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class cp extends Qi{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Jv extends Qi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Qv extends Qi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class mw extends Qi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class e_ extends Qi{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Lg extends Qi{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class _A extends Qi{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class xA extends Qi{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class bA extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class up extends Qi{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class t_ extends Qi{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class QR extends t_{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class wA extends t_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ej extends t_{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class gw extends wA{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const yw=(y,s,h)=>({u_matrix:y,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:h}),r_=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue)=>({u_proj_matrix:Float32Array.from(y),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:h,u_zoom_transition:w,u_merc_center:P,u_image0:0,u_frustum_tl:O,u_frustum_tr:D,u_frustum_br:z,u_frustum_bl:W,u_globe_pos:H,u_globe_radius:Q,u_viewport:K,u_grid_matrix:ue?Float32Array.from(ue):new Float32Array(9),u_skirt_height:re,u_far_z_cutoff:le});function n_(y,s){return y!=null&&s!=null&&!(!y.hasData()||!s.hasData())&&y.demTexture!=null&&s.demTexture!=null&&y.tileID.key!==s.tileID.key}const Wh=new class{constructor(){this.operations={}}newMorphing(y,s,h,v,w){if(y in this.operations){const P=this.operations[y];P.to.tileID.key!==h.tileID.key&&(P.queued=h)}else this.operations[y]={startTime:v,phase:0,duration:w,from:s,to:h,queued:null}}getMorphValuesForProxy(y){if(!(y in this.operations))return null;const s=this.operations[y];return{from:s.from,to:s.to,phase:s.phase}}update(y){for(const s in this.operations){const h=this.operations[s];for(h.phase=(y-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,y)){delete this.operations[s];break}}}_nextOp(y,s){return!!y.queued&&(y.from=y.to,y.to=y.queued,y.queued=null,y.phase=0,y.startTime=s,!0)}_validOp(y){return y.from.hasData()&&y.to.hasData()}},vw={0:null,1:"TERRAIN_VERTEX_MORPHING"};function SA(y,s,h){if(s===0)return 0;const v=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-y)*Math.max(s,1)*v}function Fg(y,s){const h=1<<y.z;return!s&&(y.x===0||y.x===h-1)||y.y===0||y.y===h-1}const Gh=y=>({u_matrix:y});function i_(y,s,h,v,w){if(w>0){const P=i.o.now(),O=(P-y.timeAdded)/w,D=s?(P-s.timeAdded)/w:-1,z=h.getSource(),W=v.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),H=!s||Math.abs(s.tileID.overscaledZ-W)>Math.abs(y.tileID.overscaledZ-W),Q=H&&y.refreshedUponExpiration?1:i.aA(H?O:1-D,0,1);return s?{opacity:1,mix:1-Q,isFading:O<1}:{opacity:Q,mix:0,isFading:O<1}}return{opacity:1,mix:0,isFading:!1}}class xl extends Jl{constructor(s){const h=xs("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",h,!1),h.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class _w extends Jl{constructor(s){const h=xs("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,v){if(s.freezeTileCoverage)return;this.transform=s;const w=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((P,O)=>{if(P[O.key]="",!this._tiles[O.key]){const D=new ru(O,this._source.tileSize*O.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);D.state="loaded",this._tiles[O.key]=D}return P},{});for(const P in this._tiles)P in w||(this.freeFBO(P),this._tiles[P].unloadVectorData(),delete this._tiles[P])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const v=Object.values(h);this.renderCachePool.push(...v),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class zg extends i.aP{constructor(s,h,v){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=v}}class Bg extends i.bU{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,P]=function(z){const W=new i.bc,H=new i.b0,Q=131;W.reserve(17161),H.reserve(33800);const K=i.al/128,re=i.al+K/2,le=re+K;for(let xe=-K;xe<le;xe+=K)for(let me=-K;me<le;me+=K){const Ee=me<0||me>re||xe<0||xe>re?24575:0,Ie=i.aA(Math.round(me),0,i.al),Ae=i.aA(Math.round(xe),0,i.al);W.emplaceBack(Ie+Ee,Ae)}const ue=(xe,me)=>{const Ee=me*Q+xe;H.emplaceBack(Ee+1,Ee,Ee+Q),H.emplaceBack(Ee+Q,Ee+Q+1,Ee+1)};for(let xe=1;xe<129;xe++)for(let me=1;me<129;me++)ue(me,xe);return[0,129].forEach(xe=>{for(let me=0;me<130;me++)ue(me,xe),ue(xe,me)}),[W,H,32768]}(),O=s.context;this.gridBuffer=O.createVertexBuffer(v,i.be.members),this.gridIndexBuffer=O.createIndexBuffer(w),this.gridSegments=i.bf.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=i.bf.simpleSegment(0,0,v.length,P),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new _w(h.map),this.orthoMatrix=i.bB(),i.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.al,0,i.al,0,1);const D=O.gl;this._overlapStencilMode=new Xr({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xl(h.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,v){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const w=s.terrain.properties,P=s.terrain.drapeRenderMode===0,O=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.o.now();const D=s.terrain&&s.terrain.scope,z=w.get("source"),W=P?this._mockSourceCache:s.getSourceCache(z,D);if(!W)return void i.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=W,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=O?this.calculateExaggeration(h):w.get("exaggeration"),!h.projection.requiresDraping&&O&&this._exaggeration===0)return void this._disable();this.enabled=!0;const H=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Q=this.getScaledDemTileSize();this.sourceCache.update(h,Q,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,H(),this._initializing=!0),H(),h.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const h=this._previousCameraAltitude,v=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=v;const w=h!=null?v-h:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const P=s.zoom,O=this._style.terrain;if(!this._previousUpdateTimestamp)return O.getExaggeration(P);let D=P-this._previousZoom;const z=this._previousUpdateTimestamp;let W=P;this._evaluationZoom!=null&&(W=this._evaluationZoom,Math.abs(P-W)>.5&&(D=.5*(P-W+D)),D*w<0&&(W+=D)),this._evaluationZoom=W;const H=O.getExaggeration(W),Q=H===O.getExaggeration(Math.max(0,W-.1));if(Q&&Math.abs(H-this._exaggeration)<.01)return H;let K=Math.min(.1,.00375*(this._updateTimestamp-z));return(Q||H<.1||Math.abs(D)<1e-4)&&(K=Math.min(.2,4*K)),i.ak(this._exaggeration,H,K)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(i.ae.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=h.getIds().map(z=>{const W=h.getTileByID(z).tileID;return W.projMatrix=v.calculateProjMatrix(W.toUnwrapped()),W});(function(z,W){const H=W.transform.pointCoordinate(W.transform.getCameraPoint()),Q=new i.P(H.x,H.y);z.sort((K,re)=>{if(re.overscaledZ-K.overscaledZ)return re.overscaledZ-K.overscaledZ;const le=new i.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ue=new i.P(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),xe=Q.mult(1<<K.canonical.z);return xe.x-=.5,xe.y-=.5,xe.distSqr(le)-xe.distSqr(ue)})})(w,this.painter);const P=this.proxyToSource||{};this.proxyToSource={},w.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const O=this._style._mergedSourceCaches;for(const z in O){const W=O[z];if(!W.used||(W!==this.sourceCache&&this.resetTileLookupCache(W.id),this._setupProxiedCoordsForOrtho(W,s[z],P),W.usedForTerrain))continue;const H=s[z];W.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[h.id]=w.map(z=>new zg(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(P),this.renderingToTexture=!1;const D={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const W=this.terrainTileForTile[z.key];if(!W)continue;const H=W.tileID.key;H in D||(this._visibleDemTiles.push(W),D[H]=H)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const v=this._findTileCoveringTileID(h,this.sourceCache);v&&(this.terrainTileForTile[h.key]=v)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],P=w.dem;!P||w.demTexture&&!w.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),Zv(this.painter,w,P))}}_prepareDemTileUniforms(s,h,v,w){if(!h||h.demTexture==null)return!1;const P=s.tileID.canonical,O=Math.pow(2,h.tileID.canonical.z-P.z),D=w||"";return v[`u_dem_tl${D}`]=[P.x*O%1,P.y*O%1],v[`u_dem_scale${D}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const h=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const P=w.dem.tree.minimums[0];return P>0&&s++,v+P},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const v=this._getLoadedAreaMinimum(),w=new i.dK({width:1,height:1},new Float32Array([v]));this._emptyDEMTextureDirty=!1;let P=this._emptyDEMTexture;return P?P.update(w,{premultiply:!1}):P=this._emptyDEMTexture=new i.T(s,w,h.R32F,{premultiply:!1}),P}setupElevationDraw(s,h,v){const w=this.painter.context,P=w.gl,O={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};O.u_exaggeration=this.exaggeration();let D=null,z=null,W=1;if(v&&v.morphing&&this._useVertexMorphing){const re=v.morphing.srcDemTile,le=v.morphing.dstDemTile;W=v.morphing.phase,re&&le&&(this._prepareDemTileUniforms(s,re,O,"_prev")&&(z=re),this._prepareDemTileUniforms(s,le,O)&&(D=le))}const H=re=>re&&re.demTexture&&this.painter.linearFloatFilteringSupported()?P.LINEAR:P.NEAREST;let Q=null;var K;if(this.enabled?z&&D?(Q=D.demTexture,w.activeTexture.set(P.TEXTURE4),z.demTexture.bind(H(z),P.CLAMP_TO_EDGE),O.u_dem_lerp=W):(D=this.terrainTileForTile[s.tileID.key],Q=this._prepareDemTileUniforms(s,D,O)?D.demTexture:this.emptyDEMTexture):Q=this.emptyDEMTexture,w.activeTexture.set(P.TEXTURE2),Q&&(O.u_dem_size=(K=Q).size[0]===1?1:K.size[0]-2,Q.bind(H(D),P.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(v&&v.useDepthForOcclusion,h,O),v&&v.useMeterToDem&&D){const re=(1<<D.tileID.canonical.z)*i.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=re}if(v&&v.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),h.setTerrainUniformValues(w,O),this.painter.transform.projection.name==="globe"){const re=this.globeUniformValues(this.painter.transform,s.tileID.canonical,v&&v.useDenormalizedUpVectorScale);h.setGlobeUniformValues(w,re)}}globeUniformValues(s,h,v){const w=s.projection;return{u_tile_tl_up:w.upVector(h,0,0),u_tile_tr_up:w.upVector(h,i.al,0),u_tile_br_up:w.upVector(h,i.al,i.al),u_tile_bl_up:w.upVector(h,0,i.al),u_tile_up_scale:v?i.dL(1):w.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,v=this.painter.context;s.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,P,O,D,z){if(w.transform.projection.name==="globe")(function(W,H,Q,K,re){const le=W.context,ue=le.gl;let xe,me;const Ee=W.transform,Ie=i.dD(W,le,Ee),Ae=(wt,pt)=>{if(me===pt)return;const Ot=[vw[pt],"PROJECTION_GLOBE_VIEW"];Ie&&Ot.push("CUSTOM_ANTIALIASING");const Kt=W.isTileAffectedByFog(wt);xe=W.getOrCreateProgram("globeRaster",{defines:Ot,overrideFog:Kt}),me=pt},Be=W.colorModeForRenderPass(),Re=new Sr(ue.LEQUAL,Sr.ReadWrite,W.depthRangeFor3D);Wh.update(re);const Ve=i.dE(Ee),Fe=[i.aF(Ee.center.lng),i.aJ(Ee.center.lat)],Me=W.globeSharedBuffers,qe=[Ee.width*i.o.devicePixelRatio,Ee.height*i.o.devicePixelRatio],ot=Float32Array.from(Ee.globeMatrix),rt={useDenormalizedUpVectorScale:!0};{const wt=W.transform,pt=SA(wt.zoom,H.exaggeration(),H.sourceCache._source.tileSize);me=-1;const Ot=ue.TRIANGLES;for(const Kt of K){const ht=Q.getTile(Kt),et=Xr.disabled,It=H.prevTerrainTileForTile[Kt.key],mt=H.terrainTileForTile[Kt.key];n_(It,mt)&&Wh.newMorphing(Kt.key,It,mt,re,250),le.activeTexture.set(ue.TEXTURE0),ht.texture&&ht.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Lt=Wh.getMorphValuesForProxy(Kt.key),Jt=Lt?1:0;Lt&&Object.assign(rt,{morphing:{srcDemTile:Lt.from,dstDemTile:Lt.to,phase:i.dC(Lt.phase)}});const yr=i.dF(Kt.canonical),Wt=i.dG(yr.getCenter().lat),Xt=i.dH(Kt.canonical,yr,Wt,wt.worldSize/wt._pixelsPerMercatorPixel),br=i.bj(i.dI(Kt.canonical)),hr=r_(wt.expandedFarZProjMatrix,ot,Ve,br,i.aj(wt.zoom),Fe,wt.frustumCorners.TL,wt.frustumCorners.TR,wt.frustumCorners.BR,wt.frustumCorners.BL,wt.globeCenterInViewSpace,wt.globeRadius,qe,pt,wt._farZ,Xt);if(Ae(Kt,Jt),xe&&(H.setupElevationDraw(ht,xe,rt),W.uploadCommonUniforms(le,xe,Kt.toUnwrapped()),Me)){const[cr,fr,Nr]=Me.getGridBuffers(Wt,pt!==0);xe.draw(W,Ot,Re,et,Be,qr.backCCW,hr,"globe_raster",cr,fr,Nr)}}}if(Me&&(W.renderDefaultNorthPole||W.renderDefaultSouthPole)){const wt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ie&&wt.push("CUSTOM_ANTIALIASING"),xe=W.getOrCreateProgram("globeRaster",{defines:wt});for(const pt of K){const{x:Ot,y:Kt,z:ht}=pt.canonical,et=Kt===0,It=Kt===(1<<ht)-1,[mt,Lt,Jt,yr]=Me.getPoleBuffers(ht,!1);if(yr&&(et||It)){const Wt=Q.getTile(pt);le.activeTexture.set(ue.TEXTURE0),Wt.texture&&Wt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Xt=i.dJ(ht,Ot,Ee);const br=i.bj(i.dI(pt.canonical)),hr=(cr,fr)=>cr.draw(W,ue.TRIANGLES,Re,Xr.disabled,Be,qr.disabled,r_(Ee.expandedFarZProjMatrix,Xt,Xt,br,0,Fe,Ee.frustumCorners.TL,Ee.frustumCorners.TR,Ee.frustumCorners.BR,Ee.frustumCorners.BL,Ee.globeCenterInViewSpace,Ee.globeRadius,qe,0,Ee._farZ),"globe_pole_raster",fr,Jt,yr);H.setupElevationDraw(Wt,xe,rt),W.uploadCommonUniforms(le,xe,pt.toUnwrapped()),et&&W.renderDefaultNorthPole&&hr(xe,mt),It&&W.renderDefaultSouthPole&&(Xt=i.cR(i.bB(),Xt,[1,-1,1]),hr(xe,Lt))}}}})(w,P,O,D,z);else{const W=w.context,H=W.gl;let Q,K;const re=w.shadowRenderer,le=qu(w,w.longestCutoffRange),ue=Be=>{if(K===Be)return;const Re=[];Re.push(vw[Be]),le.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),re&&(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&Re.push("NORMAL_OFFSET")),Q=w.getOrCreateProgram("terrainRaster",{defines:Re}),K=Be},xe=w.colorModeForRenderPass(),me=new Sr(H.LEQUAL,Sr.ReadWrite,w.depthRangeFor3D);Wh.update(z);const Ee=w.transform,Ie=SA(Ee.zoom,P.exaggeration(),P.sourceCache._source.tileSize);let Ae=[0,0,0];if(re){const Be=w.style.directionalLight,Re=w.style.ambientLight;Be&&Re&&(Ae=tc(w.style,Be,Re))}{K=-1;const Be=H.TRIANGLES,[Re,Ve]=[P.gridIndexBuffer,P.gridSegments];for(const Fe of D){const Me=O.getTile(Fe),qe=Xr.disabled,ot=P.prevTerrainTileForTile[Fe.key],rt=P.terrainTileForTile[Fe.key];n_(ot,rt)&&Wh.newMorphing(Fe.key,ot,rt,z,250),W.activeTexture.set(H.TEXTURE0),Me.texture&&Me.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const wt=Wh.getMorphValuesForProxy(Fe.key),pt=wt?1:0;let Ot;wt&&(Ot={morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:i.dC(wt.phase)}});const Kt=yw(Fe.projMatrix,Fg(Fe.canonical,Ee.renderWorldCopies)?Ie/10:Ie,Ae);if(ue(pt),!Q)continue;P.setupElevationDraw(Me,Q,Ot);const ht=Fe.toUnwrapped();re&&re.setupShadows(ht,Q),w.uploadCommonUniforms(W,Q,ht,null,le),Q.draw(w,Be,me,qe,xe,qr.backCCW,Kt,"terrain_raster",P.gridBuffer,Re,Ve)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,v=this.painter.context,w=this.proxySourceCache,P=this.proxiedCoords[w.id],O=this._drapedRenderBatches.shift(),D=h.style.order,z=[];let W=0;for(const H of P){const Q=w.getTileByID(H.proxyTileKey),K=w.proxyCachedFBO[H.key]?w.proxyCachedFBO[H.key][s]:void 0,re=K!==void 0?w.renderCache[K]:this.pool[W++],le=K!==void 0;if(Q.texture=re.tex,le&&!re.dirty){z.push(Q.tileID);continue}let ue;v.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(v.clear({color:i.ao.transparent,stencil:0}),re.dirty=!1);for(let xe=O.start;xe<=O.end;++xe){const me=h.style._mergedLayers[D[xe]];if(me.isHidden(h.transform.zoom))continue;const Ee=h.style.getLayerSourceCache(me),Ie=Ee?this.proxyToSource[H.key][Ee.id]:[H];if(!Ie)continue;const Ae=Ie;v.viewport.set([0,0,re.fb.width,re.fb.height]),ue!==(Ee?Ee.id:null)&&(this._setupStencil(re,Ie,me,Ee),ue=Ee?Ee.id:null),h.renderLayer(h,Ee,me,Ae)}if(this._drapedRenderBatches.length===0)for(const xe of this._pendingGroundEffectLayers){const me=h.style._mergedLayers[D[xe]];if(me.isHidden(h.transform.zoom))continue;const Ee=h.style.getLayerSourceCache(me),Ie=Ee?this.proxyToSource[H.key][Ee.id]:[H];if(!Ie)continue;const Ae=Ie;v.viewport.set([0,0,re.fb.width,re.fb.height]),ue!==(Ee?Ee.id:null)&&(this._setupStencil(re,Ie,me,Ee),ue=Ee?Ee.id:null),h.renderLayer(h,Ee,me,Ae)}this.renderedToTile?(re.dirty=!0,z.push(Q.tileID)):le||--W,W===5&&(W=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,h.width,h.height]),O.end+1}postRender(){}isLayerOrderingCorrect(s){const h=s.order.length;let v=-1,w=h;for(let P=0;P<h;++P)this._style.isLayerDraped(s._mergedLayers[s.order[P]])?v=Math.max(v,P):w=Math.min(w,P);return w>v}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(P=>P.dem).map(P=>{const O=P.tileID,D=1<<O.overscaledZ,{x:z,y:W}=O.canonical,H=z/D,Q=(z+1)/D,K=W/D,re=(W+1)/D;return{minx:H,miny:K,maxx:Q,maxy:re,t:P.dem.tree.raycastRoot(H,K,Q,re,s,h,v),tile:P}});w.sort((P,O)=>(P.t!==null?P.t:Number.MAX_VALUE)-(O.t!==null?O.t:Number.MAX_VALUE));for(const P of w){if(P.t==null)return null;const O=P.tile.dem.tree.raycast(P.minx,P.miny,P.maxx,P.maxy,s,h,v);if(O!=null)return O}return null}_createFBO(){const s=this.painter.context,h=s.gl,v=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const w=new i.T(s,{width:v[0],height:v[1],data:null},h.RGBA8);w.bind(h.LINEAR,h.CLAMP_TO_EDGE);const P=s.createFramebuffer(v[0],v[1],!0,null);return P.colorAttachment.set(w.texture),P.depthAttachment=new gw(s,P.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,P.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):P.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:P,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._mergedLayers[s],v=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!v&&h.shouldRedrape():!v&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const v of this._style.getSources())if(v instanceof is){s=!0;break}if(!s)return;const h={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],P=this._style.getLayerSourceCache(w);if(P&&!h[P.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof i.ad){h[P.id]=!0;for(const O of this.proxyCoords){const D=this.proxyToSource[O.key][P.id];if(D)for(const z of D)this._clearRenderCacheForTile(P.id,z)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof Xl){s=!0;break}if(!s)return;const h={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],P=this._style.getLayerSourceCache(w);if(!P||h[P.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const O=w.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const z=this.proxyToSource[D.key][P.id];if(z)for(const W of z){const H=i_(P.getTile(W),P.findLoadedParent(W,0),P,this.painter.transform,O);(H.opacity!==1||H.mix!==0)&&this._clearRenderCacheForTile(P.id,W)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,h=s.length;if(h===0)return;const v=[];this._pendingGroundEffectLayers=[];let w,P=0,O=this._style._mergedLayers[s[P]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++P<h;)O=this._style._mergedLayers[s[P]];for(;P<h;++P){const D=this._style._mergedLayers[s[P]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?w===void 0&&(w=P):(D.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(P),w!==void 0&&(v.push({start:w,end:P-1}),w=void 0)))}if(w!==void 0&&v.push({start:w,end:P-1}),v.length!==0){const D=v[v.length-1];this._pendingGroundEffectLayers.every(z=>z>D.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const O=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let D=0;D<O.length;++D){const z=Object.values(O[D]);h.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let O=v.length-1;O>=0;O--){const D=v[O];if(h.getTileByID(D.key),h.proxyCachedFBO[D.key]!==void 0){const z=s[D.key],W=this.proxyToSource[D.key];let H=0;for(const Q in W){const K=W[Q],re=z[Q];if(!re||re.length!==K.length||K.some((le,ue)=>le!==re[ue]||w[Q]&&w[Q].hasOwnProperty(le.key))){H=-1;break}++H}for(const Q in h.proxyCachedFBO[D.key])h.renderCache[h.proxyCachedFBO[D.key][Q]].dirty=H<0||H!==Object.values(z).length}}const P=[...this._drapedRenderBatches];P.sort((O,D)=>D.end-D.start-(O.end-O.start));for(const O of P)for(const D of v){if(h.proxyCachedFBO[D.key])continue;let z=h.renderCachePool.pop();z===void 0&&h.renderCache.length<50&&(z=h.renderCache.length,h.renderCache.push(this._createFBO())),z!==void 0&&(h.proxyCachedFBO[D.key]={},h.proxyCachedFBO[D.key][O.start]=z,h.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const P=this.painter.context,O=P.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let D;if(v.isTileClipped())D=h.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(P.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Xr.disabled}_renderTileClippingMasks(s,h){const v=this.painter,w=this.painter.context,P=w.gl;v._tileClippingMaskIDs={},w.setColorMode(pn.disabled),w.setDepthMode(Sr.disabled);const O=v.getOrCreateProgram("clippingMask");for(const D of s){const z=v._tileClippingMaskIDs[D.key]=--h;O.draw(v,P.TRIANGLES,Sr.disabled,new Xr({func:P.ALWAYS,mask:0},z,255,P.KEEP,P.KEEP,P.REPLACE),pn.disabled,qr.disabled,Gh(D.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const v=[s.x,s.y,1,1];i.aC(v,v,h.pixelMatrixInverse),i.cJ(v,v,1/v[3]),v[0]/=h.worldSize,v[1]/=h.worldSize;const w=h._camera.position,P=i.ce(1,h.center.lat),O=[w[0],w[1],w[2]/P,0],D=i.d9([],v.slice(0,3),O);i.aw(D,D);const z=this.raycast(O,D,this._exaggeration);return z!==null&&z?(i.bG(O,O,D,z),O[3]=O[2],O[2]*=P,O):null}_setupProxiedCoordsForOrtho(s,h,v){if(s.getSource()instanceof i.aT)return this._setupProxiedCoordsForImageSource(s,h,v);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const w=this.proxiedCoords[s.id]=[],P=this.proxyCoords;for(let z=0;z<P.length;z++){const W=P[z],H=this._findTileCoveringTileID(W,s);if(H){const Q=this._createProxiedId(W,H,v[W.key]&&v[W.key][s.id]);w.push(Q),this.proxyToSource[W.key][s.id]=[Q]}}let O=!1;const D=new Set;for(let z=0;z<h.length;z++){const W=s.getTile(h[z]);if(!W||!W.hasData())continue;const H=this._findTileCoveringTileID(W.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==W.tileID.canonical.z){const Q=this.proxyToSource[H.tileID.key][s.id],K=this._createProxiedId(H.tileID,W,v[H.tileID.key]&&v[H.tileID.key][s.id]);Q?Q.splice(Q.length-1,0,K):this.proxyToSource[H.tileID.key][s.id]=[K];const re=this.proxyToSource[H.tileID.key][s.id];D.has(re)||D.add(re),w.push(K),O=!0}}if(this._sourceTilesOverlap[s.id]=O,O&&this._debugParams.sortTilesHiZFirst)for(const z of D)z.sort((W,H)=>H.overscaledZ-W.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,v){if(!s.getSource().loaded())return;const w=this.proxiedCoords[s.id]=[],P=this.proxyCoords,O=s.getSource(),D=O.tileID;if(!D)return;const z=new i.P(D.x,D.y)._div(1<<D.z),W=O.coordinates.map(i.ae.fromLngLat).reduce((Q,K)=>(Q.min.x=Math.min(Q.min.x,K.x-z.x),Q.min.y=Math.min(Q.min.y,K.y-z.y),Q.max.x=Math.max(Q.max.x,K.x-z.x),Q.max.y=Math.max(Q.max.y,K.y-z.y),Q),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(Q,K)=>{const re=Q.wrap+Q.canonical.x/(1<<Q.canonical.z),le=Q.canonical.y/(1<<Q.canonical.z),ue=i.al/(1<<Q.canonical.z),xe=K.wrap+K.canonical.x/(1<<K.canonical.z),me=K.canonical.y/(1<<K.canonical.z);return re+ue<xe+W.min.x||re>xe+W.max.x||le+ue<me+W.min.y||le>me+W.max.y};for(let Q=0;Q<P.length;Q++){const K=P[Q];for(let re=0;re<h.length;re++){const le=s.getTile(h[re]);if(!le||!le.hasData()||H(K,le.tileID))continue;const ue=this._createProxiedId(K,le,v[K.key]&&v[K.key][s.id]),xe=this.proxyToSource[K.key][s.id];xe?xe.push(ue):this.proxyToSource[K.key][s.id]=[ue],w.push(ue)}}}_createProxiedId(s,h,v){let w=this.orthoMatrix;if(v){const P=v.find(O=>O.key===h.tileID.key);if(P)return P}if(h.tileID.key!==s.key){const P=s.canonical.z-h.tileID.canonical.z;let O,D,z;w=i.bB();const W=h.tileID.wrap-s.wrap<<s.overscaledZ;P>0?(O=i.al>>P,D=O*((h.tileID.canonical.x<<P)-s.canonical.x+W),z=O*((h.tileID.canonical.y<<P)-s.canonical.y)):(O=i.al<<-P,D=i.al*(h.tileID.canonical.x-(s.canonical.x+W<<-P)),z=i.al*(h.tileID.canonical.y-(s.canonical.y<<-P))),i.cd(w,0,O,0,O,0,1),i.bq(w,w,[D,z,0])}return new zg(h.tileID,s.key,w)}_findTileCoveringTileID(s,h){let v=h.getTile(s);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[h.id],P=w[s.key];if(v=P?h.getTileByID(P):null,v&&v.hasData()||P===null)return v;let O=v?v.tileID:s,D=O.overscaledZ;const z=h.getSource().minzoom,W=[];if(!P){const Q=h.getSource().maxzoom;if(s.canonical.z>=Q){const K=s.canonical.z-Q;h.getSource().reparseOverscaled?(D=Math.max(s.canonical.z+2,h.transform.tileZoom),O=new i.aP(D,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K)):K!==0&&(D=Q,O=new i.aP(D,s.wrap,Q,s.canonical.x>>K,s.canonical.y>>K))}O.key!==s.key&&(W.push(O.key),v=h.getTile(O))}const H=Q=>{W.forEach(K=>{w[K]=Q}),W.length=0};for(D-=1;D>=z&&(!v||!v.hasData());D--){v&&H(v.tileID.key);const Q=O.calculateScaledKey(D);if(v=h.getTileByID(Q),v&&v.hasData())break;const K=w[Q];if(K===null)break;K===void 0?W.push(Q):v=h.getTileByID(K)}return H(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let v=this._tilesDirty[s];v||(v=this._tilesDirty[s]={}),v[h.key]=!0}}function xw(y,s,h){const v=function(D,z,W){const H=i.bI(z,D),Q=i.bI(W,[.2126,.7152,.0722]),K=(le,ue,xe)=>(1-xe)*le+xe*ue,re=K(1-.3*Math.min(Q,1),1,Math.min(H+1,1));return K(.92,1,Math.asin(i.aA(z[2],-1,1))/Math.PI+.5)*re}(y,[0,0,1],s),w=[0,0,0];i.c4(w,h.slice(0,3),v);const P=[0,0,0];i.c4(P,s.slice(0,3),y[2]);const O=[0,0,0];return i.d7(O,w,P),i.da(O)}const bw=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ww=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class $g{static cacheKey(s,h,v,w){let P=`${h}${w?w.cacheKey:""}`;for(const O of v)s.usedDefines.includes(O)&&(P+=`/${O}`);return P}constructor(s,h,v,w,P,O){const D=s.gl;this.program=D.createProgram(),this.configuration=w,this.name=h,this.fixedDefines=[...O];let z=w?w.defines():[];z=z.concat(O.map(le=>`#define ${le}`));const W=`#version 300 es
`;let H=W+z.concat("precision mediump float;",au,Mg.fragmentSource).join(`
`);for(const le of v.fragmentIncludes)H+=`
${ap[le]}`;H+=`
${v.fragmentSource}`;let Q=W+z.concat("precision highp float;",au,Mg.vertexSource).join(`
`);for(const le of v.vertexIncludes)Q+=`
${ap[le]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&v.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(Q+=`
uniform int u_instanceID;
`),Q+=`
${v.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(Q=Q.replaceAll("gl_InstanceID","u_instanceID"));const K=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(K,H),D.compileShader(K),D.attachShader(this.program,K);const re=D.createShader(D.VERTEX_SHADER);D.isContextLost()?this.failedToCreate=!0:(D.shaderSource(re,Q),D.compileShader(re),D.attachShader(this.program,re),this.attributes={},D.linkProgram(this.program),D.deleteShader(re),D.deleteShader(K),this.fixedUniforms=P(s),this.binderUniforms=w?w.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(le=>({u_instanceID:new i.cg(le)}))(s)),(O.includes("TERRAIN")||h.indexOf("symbol")!==-1||h.indexOf("circle")!==-1)&&(this.terrainUniforms=(le=>({u_dem:new i.cg(le),u_dem_prev:new i.cg(le),u_dem_tl:new i.cj(le),u_dem_scale:new i.ci(le),u_dem_tl_prev:new i.cj(le),u_dem_scale_prev:new i.ci(le),u_dem_size:new i.ci(le),u_dem_lerp:new i.ci(le),u_exaggeration:new i.ci(le),u_depth:new i.cg(le),u_depth_size_inv:new i.cj(le),u_depth_range_unpack:new i.cj(le),u_occluder_half_size:new i.ci(le),u_occlusion_depth_offset:new i.ci(le),u_meter_to_dem:new i.ci(le),u_label_plane_matrix_inv:new i.ck(le)}))(s)),O.includes("GLOBE")&&(this.globeUniforms=(le=>({u_tile_tl_up:new i.ch(le),u_tile_tr_up:new i.ch(le),u_tile_br_up:new i.ch(le),u_tile_bl_up:new i.ch(le),u_tile_up_scale:new i.ci(le)}))(s)),O.includes("FOG")&&(this.fogUniforms=(le=>({u_fog_matrix:new i.ck(le),u_fog_range:new i.cj(le),u_fog_color:new i.d2(le),u_fog_horizon_blend:new i.ci(le),u_fog_vertical_limit:new i.cj(le),u_fog_temporal_offset:new i.ci(le),u_frustum_tl:new i.ch(le),u_frustum_tr:new i.ch(le),u_frustum_br:new i.ch(le),u_frustum_bl:new i.ch(le),u_globe_pos:new i.ch(le),u_globe_radius:new i.ci(le),u_globe_transition:new i.ci(le),u_is_globe:new i.cg(le),u_viewport:new i.cj(le)}))(s)),O.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(le=>({u_cutoff_params:new i.d2(le)}))(s)),O.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(le=>({u_lighting_ambient_color:new i.ch(le),u_lighting_directional_dir:new i.ch(le),u_lighting_directional_color:new i.ch(le),u_ground_radiance:new i.ch(le)}))(s)),O.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(le=>({u_light_matrix_0:new i.ck(le),u_light_matrix_1:new i.ck(le),u_fade_range:new i.cj(le),u_shadow_normal_offset:new i.ch(le),u_shadow_intensity:new i.ci(le),u_shadow_texel_size:new i.ci(le),u_shadow_map_resolution:new i.ci(le),u_shadow_direction:new i.ch(le),u_shadow_bias:new i.ch(le),u_shadowmap_0:new i.cg(le),u_shadowmap_1:new i.cg(le)}))(s)))}getAttributeLocation(s,h){let v=this.attributes[h];return v===void 0&&(v=this.attributes[h]=s.getAttribLocation(this.program,h)),v}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w]&&v[w].set(this.program,w,h[w])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w]&&v[w].set(this.program,w,h[w])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;s.program.set(this.program);for(const w in h)v[w].set(this.program,w,h[w])}_drawDebugWireframe(s,h,v,w,P,O,D,z,W,H){const Q=s.options.wireframe;if(Q.terrain===!1&&Q.layers2D===!1&&Q.layers3D===!1)return;const K=s.context;if(!(!(!Q.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Q.layers2D||s._terrain&&s._terrain.renderingToTexture||!bw.includes(this.name))||!(!Q.layers3D||!ww.includes(this.name))))return;const re=K.gl,le=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,P,K);if(!le)return;const ue=[...this.fixedDefines];ue.push("DEBUG_WIREFRAME");const xe=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ue});K.program.set(xe.program);const me=(Ae,Be,Re)=>{if(Be[Ae]&&Re[Ae])for(const Ve in Be[Ae])Re[Ae][Ve]&&Re[Ae][Ve].set(Re.program,Ve,Be[Ae][Ve].current)};W&&W.setUniforms(xe.program,K,xe.binderUniforms,D,{zoom:z}),me("fixedUniforms",this,xe),me("terrainUniforms",this,xe),me("globeUniforms",this,xe),me("fogUniforms",this,xe),me("lightsUniforms",this,xe),me("shadowUniforms",this,xe),le.bind(),K.setColorMode(new pn([re.ONE,re.ONE_MINUS_SRC_ALPHA,re.ZERO,re.ONE],i.ao.transparent,[!0,!0,!0,!1])),K.setDepthMode(new Sr(h.func===re.LESS?re.LEQUAL:h.func,Sr.ReadOnly,h.range)),K.setStencilMode(Xr.disabled);const Ee=3*O.primitiveLength*2,Ie=3*O.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ae=H||1;for(let Be=0;Be<Ae;++Be)xe.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Be),re.drawElements(re.LINES,Ee,re.UNSIGNED_SHORT,Ie)}else H&&H>1?re.drawElementsInstanced(re.LINES,Ee,re.UNSIGNED_SHORT,Ie,H):re.drawElements(re.LINES,Ee,re.UNSIGNED_SHORT,Ie);P.bind(),K.program.set(this.program),K.setDepthMode(h),K.setStencilMode(v),K.setColorMode(w)}checkUniforms(s,h,v){if(this.fixedDefines.includes(h)){for(const w of Object.keys(v))if(!v[w].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${w} not set but required by ${h} being defined`)}}draw(s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe){const me=s.context,Ee=me.gl;if(this.failedToCreate)return;me.program.set(this.program),me.setDepthMode(v),me.setStencilMode(w),me.setColorMode(P),me.setCullFace(O);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,D[Be]);le&&le.setUniforms(this.program,me,this.binderUniforms,K,{zoom:re});const Ie={[Ee.POINTS]:1,[Ee.LINES]:2,[Ee.TRIANGLES]:3,[Ee.LINE_STRIP]:1}[h];this.checkUniforms(z,"RENDER_SHADOWS",this.shadowUniforms);const Ae=xe&&xe>0?1:void 0;for(const Be of Q.get()){const Re=Be.vaos||(Be.vaos={});if((Re[z]||(Re[z]=new op)).bind(me,this,W,le?le.getPaintVertexBuffers():[],H,Be.vertexOffset,ue||[],Ae),this.forceManualRenderingForInstanceIDShaders){const Ve=xe||1;for(let Fe=0;Fe<Ve;++Fe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Fe),H?Ee.drawElements(h,Be.primitiveLength*Ie,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Ie*2):Ee.drawArrays(h,Be.vertexOffset,Be.vertexLength)}else xe&&xe>1?Ee.drawElementsInstanced(h,Be.primitiveLength*Ie,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Ie*2,xe):H?Ee.drawElements(h,Be.primitiveLength*Ie,Ee.UNSIGNED_SHORT,Be.primitiveOffset*Ie*2):Ee.drawArrays(h,Be.vertexOffset,Be.vertexLength);h===Ee.TRIANGLES&&H&&this._drawDebugWireframe(s,v,w,P,H,Be,K,re,le,xe)}}}function a_(y,s,h=0){const v=Math.pow(2,s.tileID.overscaledZ),w=s.tileSize*Math.pow(2,y.transform.tileZoom)/v,P=w*(s.tileID.canonical.x+s.tileID.wrap*v),O=w*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.ay(s,1,y.transform.tileZoom),u_pixel_coord_upper:[P>>16,O>>16],u_pixel_coord_lower:[65535&P,65535&O],u_pattern_transition:h}}const dp={terrain:0,flat:1},o_=i.bB(),s_=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me)=>{const Ee=s.style.light,Ie=Ee.properties.get("position"),Ae=[Ie.x,Ie.y,Ie.z],Be=i.dN();Ee.properties.get("anchor")==="viewport"&&(i.dO(Be,-s.transform.angle),i.dP(Ae,Ae,Be));const Re=Ee.properties.get("color").toPremultipliedRenderColor(null),Ve=s.transform,Fe={u_matrix:y,u_lightpos:Ae,u_lightintensity:Ee.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_vertical_gradient:+h,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:o_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:dp[W],u_base_type:dp[H],u_ao:w,u_edge_radius:P,u_width_scale:O,u_flood_light_color:le,u_vertical_scale:ue,u_flood_light_intensity:xe,u_ground_shadow_factor:me};return Ve.projection.name==="globe"&&(Fe.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],Fe.u_zoom_transition=Q,Fe.u_inv_rot_matrix=re,Fe.u_merc_center=K,Fe.u_up_dir=Ve.projection.upVector(new i.cC(0,0,0),K[0]*i.al,K[1]*i.al),Fe.u_height_lift=z),Fe},EA=(y,s,h,v,w,P)=>({u_matrix:y,u_edge_radius:s,u_width_scale:h,u_vertical_scale:v,u_height_type:dp[w],u_base_type:dp[P]}),TA=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me)=>{const Ee=s_(y,s,h,v,w,P,O,D,W,H,Q,K,re,le,ue,xe,1,[0,0,0]),Ie={u_height_factor:-Math.pow(2,D.overscaledZ)/z.tileSize/8};return Object.assign(Ee,a_(s,z,me),Ie)},hp=(y,s,h,v,w,P,O,D,z,W,H)=>({u_matrix:s,u_opacity:h,u_ao_pass:v?1:0,u_meter_to_tile:w,u_ao:P,u_flood_light_intensity:O,u_flood_light_color:D,u_attenuation:z,u_edge_radius:W,u_fb:0,u_fb_size:H,u_dynamic_offset:1}),AA=(y,s,h)=>({u_matrix:y,u_emissive_strength:s,u_ground_shadow_factor:h}),PA=(y,s,h,v,w,P=0)=>Object.assign(AA(y,s,w),a_(h,v,P)),tj=(y,s,h,v)=>({u_matrix:y,u_world:h,u_emissive_strength:s,u_ground_shadow_factor:v}),rj=(y,s,h,v,w,P,O=0)=>Object.assign(PA(y,s,h,v,P,O),{u_world:w}),nj=(y,s)=>({u_matrix:y,u_ground_shadow_factor:s}),l_=(y,s,h,v,w)=>({u_matrix:y,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:h,u_height_scale:v,u_reset_depth:w}),Sw=(y,s,h,v,w,P,O,D,z)=>({u_matrix:y,u_normal_matrix:s,u_opacity:h,u_faux_facade_ao_intensity:v,u_camera_pos:w,u_tile_to_meter:P,u_facade_emissive_chance:O,u_flood_light_color:D,u_flood_light_intensity:z}),Ew=y=>({u_matrix:y}),CA=y=>({u_matrix:y}),fp=(y,s,h,v,w,P,O,D)=>{const z=i.al/P.tileSize;return{u_matrix:y,u_inv_rot_matrix:s,u_camera_to_center_distance:h.getCameraToCenterDistance(D),u_extrude_scale:[h.pixelsToGLUnits[0]/z,h.pixelsToGLUnits[1]/z],u_zoom_transition:v,u_tile_id:O,u_merc_center:w}},Tw=(y,s,h=1)=>({u_matrix:y,u_color:s,u_overlay:0,u_overlay_scale:h}),OA=i.bB(),IA=(y,s,h,v,w,P,O)=>{const D=y.transform,z=D.projection.name==="globe",W=z?i.dQ(D.zoom,s.canonical)*D._pixelsPerMercatorPixel:i.ay(h,1,P),H={u_matrix:s.projMatrix,u_extrude_scale:W,u_intensity:O,u_inv_rot_matrix:OA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){H.u_inv_rot_matrix=v,H.u_merc_center=w,H.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],H.u_zoom_transition=i.aj(D.zoom);const Q=w[0]*i.al,K=w[1]*i.al;H.u_up_dir=D.projection.upVector(new i.cC(0,0,0),Q,K)}return H};function c_(y,[s,h,v,w],[P,O]){if(P===O)return[0,0,0,0];const D=255*(y-1)/(y*(O-P));return[s*D,h*D,v*D,w*D]}function Wu(y,s,[h,v]){return h===v?0:.5/y+(s-h)*(y-1)/(y*(v-h))}const Ug=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee,Ie,Ae)=>({u_matrix:y,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:P,u_scale_parent:W,u_fade_t:H.mix,u_opacity:H.opacity*Q.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Q.paint.get("raster-brightness-min"),u_brightness_high:Q.paint.get("raster-brightness-max"),u_saturation_factor:i.dS(Q.paint.get("raster-saturation")),u_contrast_factor:i.dR(Q.paint.get("raster-contrast")),u_spin_weights:u_(Q.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:re,u_zoom_transition:O,u_merc_center:D,u_cutoff_params:z,u_colorization_mix:c_(i.dT,ue,me),u_colorization_offset:Wu(i.dT,xe,me),u_color_ramp:le,u_texture_offset:[Ie/(Ee+2*Ie),Ee/(Ee+2*Ie)],u_texture_res:[Ee+2*Ie,Ee+2*Ie],u_emissive_strength:Ae});function u_(y){y*=Math.PI/180;const s=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const Hh=.05,$d=(y,s,h,v,w,P,O,D,z,W,H,Q)=>({u_matrix:y,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:P,u_scale_parent:W,u_fade_t:H.mix,u_opacity:H.opacity,u_image0:0,u_image1:1,u_raster_elevation:Q,u_zoom_transition:O,u_merc_center:D,u_cutoff_params:z}),Aw=(y,s,h,v,w,P,O,D,z,W)=>({u_particle_texture:y,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:v,u_color_ramp:P,u_velocity_res:w,u_max_speed:O,u_uv_offset:D,u_data_scale:[255*z[0],255*z[1]],u_data_offset:W,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hh,Hh]}),d_=(y,s,h,v,w,P,O,D,z,W)=>({u_particle_texture:y,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:v,u_max_speed:w,u_speed_factor:P,u_reset_rate:O,u_rand_seed:Math.random(),u_uv_offset:D,u_data_scale:[255*z[0],255*z[1]],u_data_offset:W,u_particle_pos_scale:1.1,u_particle_pos_offset:[Hh,Hh]}),Pw=i.bB(),Cw=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee,Ie,Ae,Be,Re,Ve)=>{const Fe=w.transform,Me={u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Fe.getCameraToCenterDistance(Ee),u_rotate_symbol:+h,u_aspect_ratio:Fe.width/Fe.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:O,u_coord_matrix:D,u_is_text:+W,u_elevation_from_sea:z?1:0,u_pitch_with_map:+v,u_texsize:H,u_texsize_icon:Q,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Pw,u_up_vector:[0,-1,0],u_color_adj_mat:Be,u_icon_transition:Re||0,u_gamma_scale:v?w.transform.getCameraToCenterDistance(Ee)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:i.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ve||1,u_ground_shadow_factor:Ie,u_inv_matrix:i.bk(i.bB(),O),u_normal_scale:Ae,u_lutTexture:wo.LUT};return Ee.name==="globe"&&(Me.u_tile_id=[re.canonical.x,re.canonical.y,1<<re.canonical.z],Me.u_zoom_transition=le,Me.u_inv_rot_matrix=xe,Me.u_merc_center=ue,Me.u_camera_forward=Fe._camera.forward(),Me.u_ecef_origin=i.dU(Fe.globeMatrix,re.toUnwrapped()),Me.u_tile_matrix=Float32Array.from(Fe.globeMatrix),Me.u_up_vector=me),Me},h_=(y,s,h,v)=>({u_matrix:y,u_emissive_strength:s,u_opacity:h,u_color:v}),f_=(y,s,h,v,w,P,O,D,z)=>Object.assign(function(W,H,Q,K,re,le){const{width:ue,height:xe}=K.imageManager.getPixelSize(H),me=Math.pow(2,le.tileID.overscaledZ),Ee=le.tileSize*Math.pow(2,K.transform.tileZoom)/me,Ie=Ee*(le.tileID.canonical.x+le.tileID.wrap*me),Ae=Ee*le.tileID.canonical.y;return{u_image:0,u_pattern_tl:Q.tl,u_pattern_br:Q.br,u_texsize:[ue,xe],u_pattern_size:Q.displaySize,u_pattern_units_to_pixels:re?[K.transform.width,-1*K.transform.height]:[1/i.ay(le,1,K.transform.tileZoom),1/i.ay(le,1,K.transform.tileZoom)],u_pixel_coord_upper:[Ie>>16,Ae>>16],u_pixel_coord_lower:[65535&Ie,65535&Ae]}}(0,P,O,v,D,z),{u_matrix:y,u_emissive_strength:s,u_opacity:h}),Ow=new Float32Array(i.bz([])),p_=(y,s,h,v,w,P,O,D,z,W,H,Q,K,re=[0,0,0],le,ue,xe)=>{const me=w.style.light,Ee=me.properties.get("position"),Ie=[-Ee.x,-Ee.y,Ee.z],Ae=i.dN();me.properties.get("anchor")==="viewport"&&(i.dO(Ae,-w.transform.angle),i.dP(Ie,Ie,Ae));const Be=H.alphaMode==="MASK",Re=me.properties.get("color").toNonPremultipliedRenderColor(null),Ve=K.paint.get("model-ambient-occlusion-intensity"),Fe=K.paint.get("model-color").constantOr(i.ao.white).toNonPremultipliedRenderColor(null);return Fe.a=K.paint.get("model-color-mix-intensity").constantOr(0),xe&&(Fe.r=xe[0],Fe.g=xe[1],Fe.b=xe[2],Fe.a=xe[3]),ue&&(Fe.r=ue.color.r,Fe.g=ue.color.g,Fe.b=ue.color.b,Fe.a=ue.colorMix,Q=ue.emissionStrength,P=ue.opacity),{u_matrix:y,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:v||Ow,u_lightpos:Ie,u_lightintensity:me.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_camera_pos:re,u_opacity:P,u_baseTextureIsAlpha:0,u_alphaMask:+Be,u_alphaCutoff:H.alphaCutoff,u_baseColorFactor:O.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:D.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:z,u_roughnessFactor:W,u_baseColorTexture:wo.BaseColor,u_metallicRoughnessTexture:wo.MetallicRoughness,u_normalTexture:wo.Normal,u_occlusionTexture:wo.Occlusion,u_emissionTexture:wo.Emission,u_lutTexture:wo.LUT,u_color_mix:Fe.toArray01(),u_aoIntensity:Ve,u_emissive_strength:Q,u_occlusionTextureTransform:le||[0,0,0,0]}},pp=(y,s=Ow,h=Ow)=>({u_matrix:y,u_instance:s,u_node_matrix:h}),ij={fillExtrusion:y=>({u_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_vertical_gradient:new i.ci(y),u_opacity:new i.ci(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_ao:new i.cj(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_up_dir:new i.ch(y),u_height_lift:new i.ci(y),u_flood_light_color:new i.ch(y),u_vertical_scale:new i.ci(y),u_flood_light_intensity:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),fillExtrusionDepth:y=>({u_matrix:new i.ck(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_vertical_scale:new i.ci(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y)}),fillExtrusionPattern:y=>({u_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_vertical_gradient:new i.ci(y),u_height_factor:new i.ci(y),u_edge_radius:new i.ci(y),u_width_scale:new i.ci(y),u_ao:new i.cj(y),u_height_type:new i.cg(y),u_base_type:new i.cg(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_up_dir:new i.ch(y),u_height_lift:new i.ci(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_opacity:new i.ci(y),u_pattern_transition:new i.ci(y)}),fillExtrusionGroundEffect:y=>({u_matrix:new i.ck(y),u_opacity:new i.ci(y),u_ao_pass:new i.ci(y),u_meter_to_tile:new i.ci(y),u_ao:new i.cj(y),u_flood_light_intensity:new i.ci(y),u_flood_light_color:new i.ch(y),u_attenuation:new i.ci(y),u_edge_radius:new i.ci(y),u_fb:new i.cg(y),u_fb_size:new i.ci(y),u_dynamic_offset:new i.ci(y)}),fill:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),fillPattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_pattern_transition:new i.ci(y)}),fillOutline:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_world:new i.cj(y),u_ground_shadow_factor:new i.ch(y)}),fillOutlinePattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_world:new i.cj(y),u_image:new i.cg(y),u_texsize:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_tile_units_to_pixels:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_pattern_transition:new i.ci(y)}),building:y=>({u_matrix:new i.ck(y),u_normal_matrix:new i.ck(y),u_opacity:new i.ci(y),u_faux_facade_ao_intensity:new i.ci(y),u_camera_pos:new i.ch(y),u_tile_to_meter:new i.ci(y),u_facade_emissive_chance:new i.ci(y),u_flood_light_color:new i.ch(y),u_flood_light_intensity:new i.ci(y)}),buildingBloom:y=>({u_matrix:new i.ck(y)}),buildingDepth:y=>({u_matrix:new i.ck(y)}),elevatedStructuresDepth:y=>({u_matrix:new i.ck(y),u_depth_bias:new i.ci(y)}),elevatedStructures:y=>({u_matrix:new i.ck(y),u_ground_shadow_factor:new i.ch(y)}),elevatedStructuresDepthReconstruct:y=>({u_matrix:new i.ck(y),u_camera_pos:new i.ch(y),u_depth_bias:new i.ci(y),u_height_scale:new i.ci(y),u_reset_depth:new i.ci(y)}),circle:i.dX,collisionBox:y=>({u_matrix:new i.ck(y),u_inv_rot_matrix:new i.ck(y),u_camera_to_center_distance:new i.ci(y),u_extrude_scale:new i.cj(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_tile_id:new i.ch(y)}),collisionCircle:y=>({u_matrix:new i.ck(y),u_inv_matrix:new i.ck(y),u_camera_to_center_distance:new i.ci(y),u_viewport_size:new i.cj(y)}),debug:y=>({u_color:new i.dA(y),u_matrix:new i.ck(y),u_overlay:new i.cg(y),u_overlay_scale:new i.ci(y)}),clippingMask:y=>({u_matrix:new i.ck(y)}),heatmap:y=>({u_extrude_scale:new i.ci(y),u_intensity:new i.ci(y),u_matrix:new i.ck(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_up_dir:new i.ch(y)}),heatmapTexture:y=>({u_image:new i.cg(y),u_color_ramp:new i.cg(y),u_opacity:new i.ci(y)}),hillshade:y=>({u_matrix:new i.ck(y),u_image:new i.cg(y),u_latrange:new i.cj(y),u_light:new i.cj(y),u_shadow:new i.dA(y),u_highlight:new i.dA(y),u_emissive_strength:new i.ci(y),u_accent:new i.dA(y)}),hillshadePrepare:y=>({u_matrix:new i.ck(y),u_image:new i.cg(y),u_dimension:new i.cj(y),u_zoom:new i.ci(y)}),line:i.dW,linePattern:i.dV,raster:y=>({u_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_grid_matrix:new i.dB(y),u_tl_parent:new i.cj(y),u_scale_parent:new i.ci(y),u_fade_t:new i.ci(y),u_opacity:new i.ci(y),u_image0:new i.cg(y),u_image1:new i.cg(y),u_brightness_low:new i.ci(y),u_brightness_high:new i.ci(y),u_saturation_factor:new i.ci(y),u_contrast_factor:new i.ci(y),u_spin_weights:new i.ch(y),u_perspective_transform:new i.cj(y),u_raster_elevation:new i.ci(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_cutoff_params:new i.d2(y),u_colorization_mix:new i.d2(y),u_colorization_offset:new i.ci(y),u_color_ramp:new i.cg(y),u_texture_offset:new i.cj(y),u_texture_res:new i.cj(y),u_emissive_strength:new i.ci(y)}),rasterParticle:y=>({u_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_grid_matrix:new i.dB(y),u_tl_parent:new i.cj(y),u_scale_parent:new i.ci(y),u_fade_t:new i.ci(y),u_opacity:new i.ci(y),u_image0:new i.cg(y),u_image1:new i.cg(y),u_raster_elevation:new i.ci(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_cutoff_params:new i.d2(y)}),rasterParticleTexture:y=>({u_texture:new i.cg(y),u_opacity:new i.ci(y)}),rasterParticleDraw:y=>({u_particle_texture:new i.cg(y),u_particle_texture_side_len:new i.ci(y),u_tile_offset:new i.cj(y),u_velocity:new i.cg(y),u_color_ramp:new i.cg(y),u_velocity_res:new i.cj(y),u_max_speed:new i.ci(y),u_uv_offset:new i.cj(y),u_data_scale:new i.cj(y),u_data_offset:new i.ci(y),u_particle_pos_scale:new i.ci(y),u_particle_pos_offset:new i.cj(y)}),rasterParticleUpdate:y=>({u_particle_texture:new i.cg(y),u_particle_texture_side_len:new i.ci(y),u_velocity:new i.cg(y),u_velocity_res:new i.cj(y),u_max_speed:new i.ci(y),u_speed_factor:new i.ci(y),u_reset_rate:new i.ci(y),u_rand_seed:new i.ci(y),u_uv_offset:new i.cj(y),u_data_scale:new i.cj(y),u_data_offset:new i.ci(y),u_particle_pos_scale:new i.ci(y),u_particle_pos_offset:new i.cj(y)}),symbol:y=>({u_is_size_zoom_constant:new i.cg(y),u_is_size_feature_constant:new i.cg(y),u_size_t:new i.ci(y),u_size:new i.ci(y),u_camera_to_center_distance:new i.ci(y),u_rotate_symbol:new i.cg(y),u_aspect_ratio:new i.ci(y),u_fade_change:new i.ci(y),u_matrix:new i.ck(y),u_label_plane_matrix:new i.ck(y),u_coord_matrix:new i.ck(y),u_is_text:new i.cg(y),u_elevation_from_sea:new i.cg(y),u_pitch_with_map:new i.cg(y),u_texsize:new i.cj(y),u_texsize_icon:new i.cj(y),u_texture:new i.cg(y),u_texture_icon:new i.cg(y),u_gamma_scale:new i.ci(y),u_device_pixel_ratio:new i.ci(y),u_tile_id:new i.ch(y),u_zoom_transition:new i.ci(y),u_inv_rot_matrix:new i.ck(y),u_merc_center:new i.cj(y),u_camera_forward:new i.ch(y),u_tile_matrix:new i.ck(y),u_up_vector:new i.ch(y),u_ecef_origin:new i.ch(y),u_is_halo:new i.cg(y),u_icon_transition:new i.ci(y),u_color_adj_mat:new i.ck(y),u_scale_factor:new i.ci(y),u_ground_shadow_factor:new i.ch(y),u_inv_matrix:new i.ck(y),u_normal_scale:new i.ci(y),u_lutTexture:new i.cg(y)}),background:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_opacity:new i.ci(y),u_color:new i.dA(y)}),backgroundPattern:y=>({u_matrix:new i.ck(y),u_emissive_strength:new i.ci(y),u_opacity:new i.ci(y),u_image:new i.cg(y),u_pattern_tl:new i.cj(y),u_pattern_br:new i.cj(y),u_texsize:new i.cj(y),u_pattern_size:new i.cj(y),u_pixel_coord_upper:new i.cj(y),u_pixel_coord_lower:new i.cj(y),u_pattern_units_to_pixels:new i.cj(y)}),terrainRaster:y=>({u_matrix:new i.ck(y),u_image0:new i.cg(y),u_skirt_height:new i.ci(y),u_ground_shadow_factor:new i.ch(y)}),skybox:y=>({u_matrix:new i.ck(y),u_sun_direction:new i.ch(y),u_cubemap:new i.cg(y),u_opacity:new i.ci(y),u_temporal_offset:new i.ci(y)}),skyboxGradient:y=>({u_matrix:new i.ck(y),u_color_ramp:new i.cg(y),u_center_direction:new i.ch(y),u_radius:new i.ci(y),u_opacity:new i.ci(y),u_temporal_offset:new i.ci(y)}),skyboxCapture:y=>({u_matrix_3f:new i.dB(y),u_sun_direction:new i.ch(y),u_sun_intensity:new i.ci(y),u_color_tint_r:new i.d2(y),u_color_tint_m:new i.d2(y),u_luminance:new i.ci(y)}),globeRaster:y=>({u_proj_matrix:new i.ck(y),u_globe_matrix:new i.ck(y),u_normalize_matrix:new i.ck(y),u_merc_matrix:new i.ck(y),u_zoom_transition:new i.ci(y),u_merc_center:new i.cj(y),u_image0:new i.cg(y),u_grid_matrix:new i.dB(y),u_skirt_height:new i.ci(y),u_far_z_cutoff:new i.ci(y),u_frustum_tl:new i.ch(y),u_frustum_tr:new i.ch(y),u_frustum_br:new i.ch(y),u_frustum_bl:new i.ch(y),u_globe_pos:new i.ch(y),u_globe_radius:new i.ci(y),u_viewport:new i.cj(y)}),globeAtmosphere:y=>({u_frustum_tl:new i.ch(y),u_frustum_tr:new i.ch(y),u_frustum_br:new i.ch(y),u_frustum_bl:new i.ch(y),u_horizon:new i.ci(y),u_transition:new i.ci(y),u_fadeout_range:new i.ci(y),u_atmosphere_fog_color:new i.d2(y),u_high_color:new i.d2(y),u_space_color:new i.d2(y),u_temporal_offset:new i.ci(y),u_horizon_angle:new i.ci(y)}),model:y=>({u_matrix:new i.ck(y),u_lighting_matrix:new i.ck(y),u_normal_matrix:new i.ck(y),u_node_matrix:new i.ck(y),u_lightpos:new i.ch(y),u_lightintensity:new i.ci(y),u_lightcolor:new i.ch(y),u_camera_pos:new i.ch(y),u_opacity:new i.ci(y),u_baseColorFactor:new i.d2(y),u_emissiveFactor:new i.d2(y),u_metallicFactor:new i.ci(y),u_roughnessFactor:new i.ci(y),u_baseTextureIsAlpha:new i.cg(y),u_alphaMask:new i.cg(y),u_alphaCutoff:new i.ci(y),u_baseColorTexture:new i.cg(y),u_metallicRoughnessTexture:new i.cg(y),u_normalTexture:new i.cg(y),u_occlusionTexture:new i.cg(y),u_emissionTexture:new i.cg(y),u_lutTexture:new i.cg(y),u_color_mix:new i.d2(y),u_aoIntensity:new i.ci(y),u_emissive_strength:new i.ci(y),u_occlusionTextureTransform:new i.d2(y)}),modelDepth:y=>({u_matrix:new i.ck(y),u_instance:new i.ck(y),u_node_matrix:new i.ck(y)}),groundShadow:y=>({u_matrix:new i.ck(y),u_ground_shadow_factor:new i.ch(y)}),stars:y=>({u_matrix:new i.ck(y),u_up:new i.ch(y),u_right:new i.ch(y),u_intensity_multiplier:new i.ci(y)}),snowParticle:y=>({u_modelview:new i.ck(y),u_projection:new i.ck(y),u_time:new i.ci(y),u_cam_pos:new i.ch(y),u_velocityConeAperture:new i.ci(y),u_velocity:new i.ci(y),u_horizontalOscillationRadius:new i.ci(y),u_horizontalOscillationRate:new i.ci(y),u_boxSize:new i.ci(y),u_billboardSize:new i.ci(y),u_simpleShapeParameters:new i.cj(y),u_screenSize:new i.cj(y),u_thinningCenterPos:new i.cj(y),u_thinningShape:new i.ch(y),u_thinningAffectedRatio:new i.ci(y),u_thinningParticleOffset:new i.ci(y),u_particleColor:new i.d2(y),u_direction:new i.ch(y)}),rainParticle:y=>({u_modelview:new i.ck(y),u_projection:new i.ck(y),u_time:new i.ci(y),u_cam_pos:new i.ch(y),u_texScreen:new i.cg(y),u_velocityConeAperture:new i.ci(y),u_velocity:new i.ci(y),u_boxSize:new i.ci(y),u_rainDropletSize:new i.cj(y),u_distortionStrength:new i.ci(y),u_rainDirection:new i.ch(y),u_color:new i.d2(y),u_screenSize:new i.cj(y),u_thinningCenterPos:new i.cj(y),u_thinningShape:new i.ch(y),u_thinningAffectedRatio:new i.ci(y),u_thinningParticleOffset:new i.ci(y),u_shapeDirectionalPower:new i.ci(y),u_shapeNormalPower:new i.ci(y),u_mode:new i.ci(y)}),vignette:y=>({u_vignetteShape:new i.ch(y),u_vignetteColor:new i.d2(y)}),occlusion:y=>({u_matrix:new i.ck(y),u_anchorPos:new i.ch(y),u_screenSizePx:new i.cj(y),u_occluderSizePx:new i.cj(y),u_color:new i.d2(y)})};class Ud{constructor(s,h,v,w){this.id=Ud.uniqueIdxCounter,Ud.uniqueIdxCounter++,this.context=s;const P=s.gl;this.buffer=P.createBuffer(),this.dynamicDraw=!!v,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),P.bufferData(P.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||w||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Ud.uniqueIdxCounter,Ud.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ud.uniqueIdxCounter=0;const kA={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class aj{constructor(s,h,v,w,P,O){this.length=h.length,this.attributes=v,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.instanceCount=O,this.context=s;const D=s.gl;this.buffer=D.createBuffer(),s.bindVertexBuffer.set(this.buffer),D.bufferData(D.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?D.DYNAMIC_DRAW:D.STATIC_DRAW),this.dynamicDraw||P||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let v=0;v<this.attributes.length;v++){const w=h.getAttributeLocation(s,this.attributes[v].name);w!==-1&&s.enableVertexAttribArray(w)}}setVertexAttribPointers(s,h,v){for(let w=0;w<this.attributes.length;w++){const P=this.attributes[w],O=h.getAttributeLocation(s,P.name);O!==-1&&s.vertexAttribPointer(O,P.components,s[kA[P.type]],!1,this.itemSize,P.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(s,h,v){for(let w=0;w<this.attributes.length;w++){const P=h.getAttributeLocation(s,this.attributes[w].name);P!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(P,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class m_{constructor(s,h,v,w,P){this.context=s,this.width=h,this.height=v;const O=this.framebuffer=s.gl.createFramebuffer();w&&(this.colorAttachment=new QR(s,O)),P&&(this.depthAttachmentType=P,this.depthAttachment=P==="renderbuffer"?new wA(s,O):new ej(s,O))}destroy(){const s=this.context.gl;if(this.colorAttachment){const h=this.colorAttachment.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class g_{constructor(s,h){this.gl=s,this.clearColor=new pA(this),this.clearDepth=new dw(this),this.clearStencil=new HR(this),this.colorMask=new KR(this),this.depthMask=new ZR(this),this.stencilMask=new XR(this),this.stencilFunc=new mA(this),this.stencilOp=new YR(this),this.stencilTest=new Xv(this),this.depthRange=new JR(this),this.depthTest=new gA(this),this.depthFunc=new hw(this),this.blend=new Yv(this),this.blendFunc=new fw(this),this.blendColor=new qh(this),this.blendEquation=new sp(this),this.cullFace=new Dg(this),this.cullFaceSide=new lp(this),this.frontFace=new yA(this),this.program=new pw(this),this.activeTexture=new vA(this),this.viewport=new cp(this),this.bindFramebuffer=new Jv(this),this.bindRenderbuffer=new Qv(this),this.bindTexture=new mw(this),this.bindVertexBuffer=new e_(this),this.bindElementBuffer=new Lg(this),this.bindVertexArrayOES=new _A(this),this.pixelStoreUnpack=new xA(this),this.pixelStoreUnpackPremultiplyAlpha=new bA(this),this.pixelStoreUnpackFlipY=new up(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,v){return new Ud(this,s,h,v)}createVertexBuffer(s,h,v,w,P){return new aj(this,s,h,v,w,P)}createRenderbuffer(s,h,v){const w=this.gl,P=w.createRenderbuffer();return this.bindRenderbuffer.set(P),w.renderbufferStorage(w.RENDERBUFFER,s,h,v),this.bindRenderbuffer.set(null),P}createFramebuffer(s,h,v,w){return new m_(this,s,h,v,w)}clear({color:s,depth:h,stencil:v,colorMask:w}){const P=this.gl;let O=0;s&&(O|=P.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(w||[!0,!0,!0,!0])),h!==void 0&&(O|=P.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),v!==void 0&&(O|=P.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),P.clear(O)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){i.bx(s.blendFunction,pn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ou;function Vg(y,s,h,v,w,P,O){const D=y.context,z=D.gl,W=y.transform,H=[i.aF(W.center.lng),i.aJ(W.center.lat)],Q=h.layout.get("symbol-placement"),K=h.layout.get("text-variable-anchor"),re=h.layout.get("icon-rotation-alignment")==="map",le=h.layout.get("text-rotation-alignment")==="map",ue=Q!=="point",xe=[];let me=0,Ee=0;for(let Me=0;Me<v.length;Me++){const qe=v[Me],ot=s.getTile(qe),rt=ot.getBucket(h);if(!rt)continue;const wt=rt.getProjection().createInversionMatrix(W,qe.canonical),pt=[],Ot=sA(qe,rt,W),Kt=!O&&re&&ue,ht=O&&le&&ue,et=K&&rt.hasTextData(),It=rt.hasIconTextFit()&&et&&rt.hasIconData(),mt=Kt||ht||O&&et||It,Lt=rt.projection.name==="globe",Jt=Lt?i.aj(W.zoom):0;Lt&&(pt.push("PROJECTION_GLOBE_VIEW"),mt&&pt.push("PROJECTED_POS_ON_VIEWPORT"));const yr=y.getOrCreateProgram("collisionBox",{defines:pt});let Wt=Ot;w[0]===0&&w[1]===0||(Wt=y.translatePosMatrix(Ot,ot,w,P));const Xt=O?rt.textCollisionBox:rt.iconCollisionBox,br=rt.collisionCircleArray;if(br.length>0){const cr=i.bB(),fr=Wt;i.cO(cr,rt.placementInvProjMatrix,W.glCoordMatrix),i.cO(cr,cr,rt.placementViewportMatrix),xe.push({circleArray:br,circleOffset:Ee,transform:fr,invTransform:cr,projection:rt.getProjection()}),me+=br.length/4,Ee=me}if(!Xt)continue;y.terrain&&y.terrain.setupElevationDraw(ot,yr);const hr=Lt?[qe.canonical.x,qe.canonical.y,1<<qe.canonical.z]:[0,0,0];yr.draw(y,z.LINES,Sr.disabled,Xr.disabled,y.colorModeForRenderPass(),qr.disabled,fp(Wt,wt,W,Jt,H,ot,hr,rt.getProjection()),h.id,Xt.layoutVertexBuffer,Xt.indexBuffer,Xt.segments,null,W.zoom,null,[Xt.collisionVertexBuffer,Xt.collisionVertexBufferExt])}if(!O||!xe.length)return;const Ie=y.getOrCreateProgram("collisionCircle"),Ae=new i.dY;Ae.resize(4*me),Ae._trim();let Be=0;for(const Me of xe)for(let qe=0;qe<Me.circleArray.length/4;qe++){const ot=4*qe,rt=Me.circleArray[ot+0],wt=Me.circleArray[ot+1],pt=Me.circleArray[ot+2],Ot=Me.circleArray[ot+3];Ae.emplace(Be++,rt,wt,pt,Ot,0),Ae.emplace(Be++,rt,wt,pt,Ot,1),Ae.emplace(Be++,rt,wt,pt,Ot,2),Ae.emplace(Be++,rt,wt,pt,Ot,3)}(!ou||ou.length<2*me)&&(ou=function(Me){const qe=2*Me,ot=new i.b0;ot.resize(qe),ot._trim();for(let rt=0;rt<qe;rt++){const wt=6*rt;ot.uint16[wt+0]=4*rt+0,ot.uint16[wt+1]=4*rt+1,ot.uint16[wt+2]=4*rt+2,ot.uint16[wt+3]=4*rt+2,ot.uint16[wt+4]=4*rt+3,ot.uint16[wt+5]=4*rt+0}return ot}(me));const Re=D.createIndexBuffer(ou,!0),Ve=D.createVertexBuffer(Ae,i.dZ.members,!0);for(const Me of xe){const qe={u_matrix:Me.transform,u_inv_matrix:Me.invTransform,u_camera_to_center_distance:(Fe=W).getCameraToCenterDistance(Me.projection),u_viewport_size:[Fe.width,Fe.height]};Ie.draw(y,z.TRIANGLES,Sr.disabled,Xr.disabled,y.colorModeForRenderPass(),qr.disabled,qe,h.id,Ve,Re,i.bf.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,W.zoom)}var Fe;Ve.destroy(),Re.destroy()}const Vd=i.bB();function Iw(y){const s=y._camera.getWorldToCamera(y.worldSize,1),h=i.aB([],s,y.globeMatrix);i.bk(h,h);const v=[0,0,0],w=[0,1,0,0];return i.aC(w,w,h),v[0]=w[0],v[1]=w[1],v[2]=w[2],i.aw(v,v),v}function y_({width:y,height:s,anchor:h,textOffset:v,textScale:w},P){const{horizontalAlign:O,verticalAlign:D}=i.c0(h),z=-(O-.5)*y,W=-(D-.5)*s,H=i.c1(h,v);return new i.P((z/w+H[0])*P,(W/w+H[1])*P)}function v_(y,s,h,v,w,P,O,D,z,W){const H=y.text.placedSymbolArray,Q=y.text.dynamicLayoutVertexArray,K=y.icon.dynamicLayoutVertexArray,re={},le=y.getProjection(),ue=Fv(O,le,w),xe=w.elevation,me=le.upVectorScale(O.canonical,w.center.lat,w.worldSize).metersToTile;Q.clear();for(let Ee=0;Ee<H.length;Ee++){const Ie=H.get(Ee),{tileAnchorX:Ae,tileAnchorY:Be,numGlyphs:Re}=Ie,Ve=Ie.hidden||!Ie.crossTileID||y.allowVerticalPlacement&&!Ie.placedOrientation?null:v[Ie.crossTileID];if(Ve){let Fe=0,Me=0,qe=0;const ot=y.elevationType==="road";if(xe||ot){const mt=ot?y.getElevationFeatureForText(Ee):null,Lt=i.bU.getAtTileOffset(O,new i.P(Ae,Be),xe,mt),[Jt,yr,Wt]=le.upVector(O.canonical,Ae,Be);Fe=Lt*Jt*me,Me=Lt*yr*me,qe=Lt*Wt*me}let[rt,wt,pt,Ot]=Qa(Ie.projectedAnchorX+Fe,Ie.projectedAnchorY+Me,Ie.projectedAnchorZ+qe,h?ue:P);const Kt=Jb(w.getCameraToCenterDistance(le),Ot);let ht=i.bL(y.textSizeData,z,Ie)*Kt/i.bX;h&&(ht*=y.tilePixelRatio/D);const et=y_(Ve,ht);h?({x:rt,y:wt,z:pt}=le.projectTilePoint(Ae+et.x,Be+et.y,O.canonical),[rt,wt,pt]=Qa(rt+Fe,wt+Me,pt+qe,P)):(s&&et._rotate(-w.angle),rt+=et.x,wt+=et.y,pt=0);const It=y.allowVerticalPlacement&&Ie.placedOrientation===i.bK.vertical?Math.PI/2:0;for(let mt=0;mt<Re;mt++)i.bN(Q,rt,wt,pt,It);W&&Ie.associatedIconIndex>=0&&(re[Ie.associatedIconIndex]={x:rt,y:wt,z:pt,angle:It})}else $u(Re,Q)}if(W){K.clear();const Ee=y.icon.placedSymbolArray;for(let Ie=0;Ie<Ee.length;Ie++){const Ae=Ee.get(Ie),{numGlyphs:Be}=Ae,Re=re[Ie];if(Ae.hidden||!Re)$u(Be,K);else{const{x:Ve,y:Fe,z:Me,angle:qe}=Re;for(let ot=0;ot<Be;ot++)i.bN(K,Ve,Fe,Me,qe)}}y.icon.dynamicLayoutVertexBuffer.updateData(K)}y.text.dynamicLayoutVertexBuffer.updateData(Q)}function qg(y,s,h,v,w,P,O={}){const D=h.paint.get("icon-translate"),z=h.paint.get("text-translate"),W=h.paint.get("icon-translate-anchor"),H=h.paint.get("text-translate-anchor"),Q=h.layout.get("icon-rotation-alignment"),K=h.layout.get("text-rotation-alignment"),re=h.layout.get("icon-pitch-alignment"),le=h.layout.get("text-pitch-alignment"),ue=h.layout.get("icon-keep-upright"),xe=h.layout.get("text-keep-upright"),me=h.paint.get("icon-color-saturation"),Ee=h.paint.get("icon-color-contrast"),Ie=h.paint.get("icon-color-brightness-min"),Ae=h.paint.get("icon-color-brightness-max"),Be=h.layout.get("symbol-elevation-reference")==="sea",Re=h.layout.get("icon-image-use-theme")==="none",Ve=y.context,Fe=Ve.gl,Me=y.transform,qe=Q==="map",ot=K==="map",rt=re==="map",wt=le==="map",pt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ot=!1;const Kt=y.depthModeForSublayer(0,Sr.ReadOnly),ht=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),et=[i.aF(Me.center.lng),i.aJ(Me.center.lat)],It=h.layout.get("text-variable-anchor"),mt=Me.projection.name==="globe",Lt=[],Jt=[0,-1,0];for(const yr of v){const Wt=s.getTile(yr),Xt=Wt.getBucket(h);if(!Xt||Xt.projection.name==="mercator"&&mt||Xt.fullyClipped)continue;const br=Xt.projection.name==="globe",hr=br?i.aj(Me.zoom):0,cr=Fv(yr,Xt.getProjection(),Me),fr=Me.calculatePixelsToTileUnitsMatrix(Wt),Nr=It&&Xt.hasTextData(),Tn=Xt.hasIconTextFit()&&Nr&&Xt.hasIconData(),Nn=Xt.getProjection().createInversionMatrix(Me,yr.canonical),pi=(1<<Wt.tileID.canonical.z)*i.al/y.transform.worldSize,Wr=ti=>{let Hr=[0,0,0];if(ti){const Ln=y.style.directionalLight,Xi=y.style.ambientLight;Ln&&Xi&&(Hr=tc(y.style,Ln,Xi))}return Hr},jn=ti=>{Me.depthOcclusionForSymbolsAndCircles&&(h.hasOcclusionOpacityProperties||y.terrain)&&(ti.push("DEPTH_D24"),ti.push("DEPTH_OCCLUSION"))},on=ti=>{h.lut&&!Re&&(h.lut.texture||(h.lut.texture=new i.d_(y.context,h.lut.image,[h.lut.image.height,h.lut.image.height,h.lut.image.height],Ve.gl.RGBA8)),Ve.activeTexture.set(Ve.gl.TEXTURE0+wo.LUT),h.lut.texture&&h.lut.texture.bind(Ve.gl.LINEAR,Ve.gl.CLAMP_TO_EDGE),ti.push("APPLY_LUT_ON_GPU"))},oi=()=>{const ti=qe&&h.layout.get("symbol-placement")!=="point",Hr=[];jn(Hr),on(Hr);const Ln=ti||Tn,Xi=Xt.elevationType==="road",xa=y.shadowRenderer,ta=Xi&&rt&&!!xa&&xa.enabled,ca=Wr(ta),Fs=Xi&&rt&&!y.terrain?ht:Kt,Ss=h.paint.get("icon-image-cross-fade");y.terrainRenderModeElevated()&&rt&&Hr.push("PITCH_WITH_MAP_TERRAIN"),br&&(Hr.push("PROJECTION_GLOBE_VIEW"),Ln&&Hr.push("PROJECTED_POS_ON_VIEWPORT")),Ss>0&&Xt.hasAnySecondaryIcon&&Hr.push("ICON_TRANSITION"),!Xt.icon.zOffsetVertexBuffer||Xi&&y.terrain||Hr.push("Z_OFFSET"),me===0&&Ee===0&&Ie===0&&Ae===1||Hr.push("COLOR_ADJUSTMENT"),Xt.sdfIcons&&Hr.push("RENDER_SDF"),ta&&Hr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&rt&&!y.terrain&&Xt.icon.orientationVertexBuffer&&Hr.push("ELEVATED_ROADS");const Ro=Xt.icon.programConfigurations.get(h.id),qo=y.getOrCreateProgram("symbol",{config:Ro,defines:Hr}),Sl=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],jo=Xt.iconSizeData,El=i.bJ(jo,Me.zoom),sc=rt||!Me.isOrthographic,po=Xf(cr,Wt.tileID.canonical,rt,qe,Me,Xt.getProjection(),fr),ia=Bu(cr,Wt.tileID.canonical,rt,qe,Me,Xt.getProjection(),fr),ba=y.translatePosMatrix(ia,Wt,D,W,!0),Si=y.translatePosMatrix(cr,Wt,D,W),Ta=Ln?Vd:po,mo=qe&&!rt&&!ti;let aa=Jt;!mt&&!Me.mercatorFromTransition||qe||(aa=Iw(Me));const Tl=br?aa:Jt,Op=h.getColorAdjustmentMatrix(me,Ee,Ie,Ae),Yu=Cw(jo.kind,El,mo,rt,y,Si,Ta,ba,Be,!1,Sl,[0,0],0,yr,hr,et,Nn,Tl,Xt.getProjection(),ca,pi,Op,Ss,null),Ip=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,kp=h.layout.get("icon-size").constantOr(0)!==1||Xt.iconsNeedLinear,Al=Xt.sdfIcons||y.options.rotating||y.options.zooming||kp||sc?Fe.LINEAR:Fe.NEAREST,lu=Xt.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,co=y.terrain&&rt&&ti?i.bk(i.bB(),po):Vd;if(ti&&Xt.icon){const Pl=i.bU.getAtTileOffsetFunc(yr,Me.center.lat,Me.worldSize,Xt.getProjection()),ef=Sg(cr,Wt.tileID.canonical,rt,qe,Me,Xt.getProjection(),fr),t2=h.layout.get("icon-size-scale-range"),z_=i.aA(y.scaleFactor,t2[0],t2[1]);ew(Xt,cr,y,!1,ef,ia,rt,ue,Pl,yr,z_)}return{program:qo,buffers:Xt.icon,uniformValues:Yu,atlasTexture:Ip,atlasTextureIcon:null,atlasInterpolation:Al,atlasInterpolationIcon:null,isSDF:Xt.sdfIcons,hasHalo:lu,depthMode:Fs,tile:Wt,renderWithShadows:ta,labelPlaneMatrixInv:co}},Mn=()=>{const ti=ot&&h.layout.get("symbol-placement")!=="point",Hr=[],Ln=ti||It||Tn,Xi=Xt.elevationType==="road",xa=y.shadowRenderer,ta=Xi&&wt&&!!xa&&xa.enabled,ca=Wr(ta),Fs=Xi&&wt&&!y.terrain?ht:Kt;y.terrainRenderModeElevated()&&wt&&Hr.push("PITCH_WITH_MAP_TERRAIN"),br&&(Hr.push("PROJECTION_GLOBE_VIEW"),Ln&&Hr.push("PROJECTED_POS_ON_VIEWPORT")),!Xt.text.zOffsetVertexBuffer||Xi&&y.terrain||Hr.push("Z_OFFSET"),Xt.iconsInText&&Hr.push("RENDER_TEXT_AND_SYMBOL"),Hr.push("RENDER_SDF"),ta&&Hr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Xi&&wt&&!y.terrain&&Xt.text.orientationVertexBuffer&&Hr.push("ELEVATED_ROADS"),jn(Hr);const Ss=Xt.text.programConfigurations.get(h.id),Ro=y.getOrCreateProgram("symbol",{config:Ss,defines:Hr});let qo,Sl=[0,0],jo=null;const El=Xt.textSizeData;Xt.iconsInText&&(Sl=Wt.imageAtlasTexture?Wt.imageAtlasTexture.size:[0,0],jo=Wt.imageAtlasTexture?Wt.imageAtlasTexture:null,qo=wt||!Me.isOrthographic||y.options.rotating||y.options.zooming||El.kind==="composite"||El.kind==="camera"?Fe.LINEAR:Fe.NEAREST);const sc=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture.size:[0,0],po=h.layout.get("text-size-scale-range"),ia=i.aA(y.scaleFactor,po[0],po[1]),ba=i.bJ(El,Me.zoom,ia),Si=Xf(cr,Wt.tileID.canonical,wt,ot,Me,Xt.getProjection(),fr),Ta=Bu(cr,Wt.tileID.canonical,wt,ot,Me,Xt.getProjection(),fr),mo=y.translatePosMatrix(Ta,Wt,z,H,!0),aa=y.translatePosMatrix(cr,Wt,z,H),Tl=Ln?Vd:Si,Op=ot&&!wt&&!ti;let Yu=Jt;!mt&&!Me.mercatorFromTransition||ot||(Yu=Iw(Me));const Ip=Cw(El.kind,ba,Op,wt,y,aa,Tl,mo,Be,!0,sc,Sl,0,yr,hr,et,Nn,br?Yu:Jt,Xt.getProjection(),ca,pi,null,null,ia),kp=Wt.glyphAtlasTexture?Wt.glyphAtlasTexture:null,Al=Fe.LINEAR,lu=h.paint.get("text-halo-width").constantOr(1)!==0,co=y.terrain&&wt&&ti?i.bk(i.bB(),Si):Vd;if(ti&&Xt.text){const Pl=i.bU.getAtTileOffsetFunc(yr,Me.center.lat,Me.worldSize,Xt.getProjection()),ef=Sg(cr,Wt.tileID.canonical,wt,ot,Me,Xt.getProjection(),fr);ew(Xt,cr,y,!0,ef,Ta,wt,xe,Pl,yr,ia)}return{program:Ro,buffers:Xt.text,uniformValues:Ip,atlasTexture:kp,atlasTextureIcon:jo,atlasInterpolation:Al,atlasInterpolationIcon:qo,isSDF:!0,hasHalo:lu,depthMode:Fs,tile:Wt,renderWithShadows:ta,labelPlaneMatrixInv:co}},Ti=Xt.icon.segments.get().length,Un=Xt.text.segments.get().length,ln=Ti&&!O.onlyText?oi():null,Xn=Un&&!O.onlyIcons?Mn():null,mn=h.paint.get("icon-opacity").constantOr(1),Ni=h.paint.get("text-opacity").constantOr(1);if(pt&&Xt.canOverlap){Ot=!0;const ti=mn&&!O.onlyText?Xt.icon.segments.get():[],Hr=Ni&&!O.onlyIcons?Xt.text.segments.get():[];for(const Ln of ti)Lt.push({segments:new i.bf([Ln]),sortKey:Ln.sortKey,state:ln});for(const Ln of Hr)Lt.push({segments:new i.bf([Ln]),sortKey:Ln.sortKey,state:Xn})}else O.onlyText||Lt.push({segments:mn?Xt.icon.segments:new i.bf([]),sortKey:0,state:ln}),O.onlyIcons||Lt.push({segments:Ni?Xt.text.segments:new i.bf([]),sortKey:0,state:Xn})}Ot&&Lt.sort((yr,Wt)=>yr.sortKey-Wt.sortKey);for(const yr of Lt){const Wt=yr.state;if(Wt)if(y.terrain?y.terrain.setupElevationDraw(Wt.tile,Wt.program,{useDepthForOcclusion:Me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Wt.labelPlaneMatrixInv}):y.setupDepthForOcclusion(Me.depthOcclusionForSymbolsAndCircles,Wt.program),Ve.activeTexture.set(Fe.TEXTURE0),Wt.atlasTexture&&Wt.atlasTexture.bind(Wt.atlasInterpolation,Fe.CLAMP_TO_EDGE,!0),Wt.atlasTextureIcon&&(Ve.activeTexture.set(Fe.TEXTURE1),Wt.atlasTextureIcon&&Wt.atlasTextureIcon.bind(Wt.atlasInterpolationIcon,Fe.CLAMP_TO_EDGE,!0)),Wt.renderWithShadows&&y.shadowRenderer.setupShadows(Wt.tile.tileID.toUnwrapped(),Wt.program,"vector-tile"),y.uploadCommonLightUniforms(y.context,Wt.program),Wt.hasHalo){const Xt=Wt.uniformValues;Xt.u_is_halo=1,__(Wt.buffers,yr.segments,h,y,Wt.program,Wt.depthMode,w,P,Xt,2),Xt.u_is_halo=0}else{if(Wt.isSDF){const Xt=Wt.uniformValues;Wt.hasHalo&&(Xt.u_is_halo=1,__(Wt.buffers,yr.segments,h,y,Wt.program,Wt.depthMode,w,P,Xt,1)),Xt.u_is_halo=0}__(Wt.buffers,yr.segments,h,y,Wt.program,Wt.depthMode,w,P,Wt.uniformValues,1)}}}function __(y,s,h,v,w,P,O,D,z,W){const H=[y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer,y.iconTransitioningVertexBuffer,y.globeExtVertexBuffer,y.zOffsetVertexBuffer,y.orientationVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,P,O,D,qr.disabled,z,h.id,y.layoutVertexBuffer,y.indexBuffer,s,h.paint,v.transform.zoom,y.programConfigurations.get(h.id),H,W)}function RA(y,s){const h=1<<y.canonical.z,v=(s.x*h-y.canonical.x-y.wrap*h)*i.al,w=(s.y*h-y.canonical.y)*i.al,P=i.e7(s.z,s.y);return i.d4(v,w,P)}function Kh(y,s,h,v,w){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const P=y.context.gl,O=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),D=new Sr(y.context.gl.GREATER,Sr.ReadWrite,y.depthRangeFor3D),z=function(re){let le=.01;return re.isOrthographic&&(le=i.ak(1e-4,le,i.c$(re.pitch>=Uh?1:re.pitch/Uh))),2*le}(y.transform),W=y.transform.getFreeCameraOptions().position,H="elevatedStructuresDepthReconstruct",Q=y.getOrCreateProgram(H,{defines:["DEPTH_RECONSTRUCTION"]}),K=y.getOrCreateProgram(H);for(const re of v){const le=s.getTile(re),ue=le.getBucket(h);if(!ue)continue;const xe=ue.elevatedStructures;if(!xe)continue;const me=ue.elevationBufferData.heightRange,Ee=RA(re.toUnwrapped(),W),Ie=y.translatePosMatrix(re.projMatrix,le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let Ae,Be,Re,Ve;if(w==="initialize"){if(!me||me.min>=1||xe.depthSegments.segments[0].primitiveLength===0)continue;Ae=l_(Ie,Ee,z,1,0),Be=O,Re=xe.depthSegments,Ve=Q}else if(w==="reset"){if(!me||me.min>=0||xe.maskSegments.segments[0].primitiveLength===0)continue;Ae=l_(Ie,Ee,0,0,1),Be=D,Re=xe.maskSegments,Ve=Q}else if(w==="geometry"){if(xe.depthSegments.segments[0].primitiveLength===0)continue;Ae=l_(Ie,Ee,z,1,0),Be=O,Re=xe.depthSegments,Ve=K}Ve.draw(y,P.TRIANGLES,Be,Xr.disabled,pn.disabled,qr.disabled,Ae,h.id,xe.vertexBuffer,xe.indexBuffer,Re,h.paint,y.transform.zoom)}}function mp(y,s,h){const{painter:v,sourceCache:w,layer:P,coords:O,colorMode:D,elevationType:z,terrainEnabled:W,pass:H}=y,Q=v.context.gl,K=P.paint.get("fill-pattern"),re=P.paint.get("fill-pattern-cross-fade"),le=K.constantOr(null);let ue=z;z!=="road"||s&&!W||(ue="none");const xe=ue==="road",me=y.painter.shadowRenderer,Ee=xe&&!!me&&me.enabled,Ie=new Sr(v.context.gl.LEQUAL,Sr.ReadOnly,v.depthRangeFor3D);let Ae=[0,0,0];if(Ee){const Ve=v.style.directionalLight,Fe=v.style.ambientLight;Ve&&Fe&&(Ae=tc(v.style,Ve,Fe))}const Be=K&&K.constantOr(1),Re=(Ve,Fe)=>{let Me,qe,ot,rt,wt;Fe?(Me=Be&&!P.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ot=Q.LINES):(Me=Be?"fillPattern":"fill",ot=Q.TRIANGLES);for(const pt of O){const Ot=w.getTile(pt);if(Be&&!Ot.patternsLoaded())continue;const Kt=Ot.getBucket(P);if(!Kt)continue;const ht=s?Kt.elevationBufferData:Kt.bufferData;if(ht.isEmpty())continue;v.prepareDrawTile();const et=ht.programConfigurations.get(P.id),It=v.isTileAffectedByFog(pt),mt=[],Lt=[];xe&&(mt.push("ELEVATED_ROADS"),Lt.push(ht.elevatedLayoutVertexBuffer)),Ee&&mt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Be&&(v.context.activeTexture.set(Q.TEXTURE0),Ot.imageAtlasTexture&&Ot.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),et.updatePaintBuffers());let Jt=!1;if(le&&Ot.imageAtlas){const hr=Ot.imageAtlas,cr=i.e2.from(le),fr=cr.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),Nr=cr.getSecondary(),Tn=hr.patternPositions.get(fr),Nn=Nr?hr.patternPositions.get(Nr.scaleSelf(i.o.devicePixelRatio).toString()):null;Jt=!!Tn&&!!Nn,Tn&&et.setConstantPatternPositions(Tn,Nn)}re>0&&(Jt||et.getPatternTransitionVertexBuffer("fill-pattern"))&&mt.push("FILL_PATTERN_TRANSITION");const yr=v.getOrCreateProgram(Me,{config:et,overrideFog:It,defines:mt}),Wt=v.translatePosMatrix(pt.projMatrix,Ot,P.paint.get("fill-translate"),P.paint.get("fill-translate-anchor"));Ee&&me.setupShadows(Ot.tileID.toUnwrapped(),yr,"vector-tile");const Xt=P.paint.get("fill-emissive-strength");if(Fe){rt=ht.lineIndexBuffer,wt=ht.lineSegments;const hr=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[Q.drawingBufferWidth,Q.drawingBufferHeight];qe=Me==="fillOutlinePattern"&&Be?rj(Wt,Xt,v,Ot,hr,Ae,re):tj(Wt,Xt,hr,Ae)}else rt=ht.indexBuffer,wt=ht.triangleSegments,qe=Be?PA(Wt,Xt,v,Ot,Ae,re):AA(Wt,Xt,Ae);v.uploadCommonUniforms(v.context,yr,pt.toUnwrapped());let br=Ve;(z==="road"&&!W||z==="offset")&&(br=Ie),yr.draw(v,ot,br,h||v.stencilModeForClipping(pt),D,qr.disabled,qe,P.id,ht.layoutVertexBuffer,rt,wt,P.paint,v.transform.zoom,et,Lt)}};v.renderPass===H&&Re(v.depthModeForSublayer(1,v.renderPass==="opaque"?Sr.ReadWrite:Sr.ReadOnly),!1),ue==="none"&&v.renderPass==="translucent"&&P.paint.get("fill-antialias")&&Re(v.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,Sr.ReadOnly),!0)}function gr(y,s,h,v,w,P,O,D){h.resetLayerRenderingStats(y);const z=y.context,W=z.gl,H=y.transform,Q=h.paint.get("fill-extrusion-pattern"),K=h.paint.get("fill-extrusion-pattern-cross-fade"),re=Q.constantOr(null),le=Q.constantOr(1),ue=h.paint.get("fill-extrusion-opacity"),xe=y.style.enable3dLights(),me=h.paint.get(xe&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Ee=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),me],Ie=h.layout.get("fill-extrusion-edge-radius"),Ae=Ie>0&&!h.paint.get("fill-extrusion-rounded-roof"),Be=Ae?0:Ie,Re=H.projection.name==="globe"?i.ea():0,Ve=H.projection.name==="globe",Fe=Ve?i.aj(H.zoom):0,Me=[i.aF(H.center.lng),i.aJ(H.center.lat)],qe=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ot=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(qe?null:h.lut).toArray01().slice(0,3),rt=h.paint.get("fill-extrusion-flood-light-intensity"),wt=h.paint.get("fill-extrusion-vertical-scale"),pt=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ot=h.paint.get("fill-extrusion-height-alignment"),Kt=h.paint.get("fill-extrusion-base-alignment"),ht=qu(y,h.paint.get("fill-extrusion-cutoff-fade-range")),et=[];let It;Ve&&et.push("PROJECTION_GLOBE_VIEW"),Ee[0]>0&&et.push("FAUX_AO"),Ae&&et.push("ZERO_ROOF_RADIUS"),D&&et.push("HAS_CENTROID"),rt>0&&et.push("FLOOD_LIGHT"),ht.shouldRenderCutoff&&et.push("RENDER_CUTOFF"),pt&&et.push("RENDER_WALL_MODE");const mt=y.renderPass==="shadow",Lt=y.shadowRenderer,Jt=mt&&!!Lt,yr=mt?qr.disabled:qr.backCCW;y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0);let Wt=[0,0,0];if(Lt){const hr=y.style.directionalLight,cr=y.style.ambientLight;hr&&cr&&(Wt=tc(y.style,hr,cr)),mt||(et.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Lt.useNormalOffset&&et.push("NORMAL_OFFSET")),It=et.concat(["SHADOWS_SINGLE_CASCADE"])}const Xt=Jt?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",br=h.getLayerRenderingStats();for(const hr of v){const cr=s.getTile(hr),fr=cr.getBucket(h);if(!fr||fr.projection.name!==H.projection.name)continue;let Nr=!1;Lt&&(Nr=Lt.getMaxCascadeForTile(hr.toUnwrapped())===0);const Tn=y.isTileAffectedByFog(hr),Nn=fr.programConfigurations.get(h.id);let pi=!1;if(re&&cr.imageAtlas){const Un=cr.imageAtlas,ln=i.e2.from(re),Xn=ln.getPrimary().scaleSelf(i.o.devicePixelRatio).toString(),mn=ln.getSecondary(),Ni=Un.patternPositions.get(Xn),ti=mn?Un.patternPositions.get(mn.scaleSelf(i.o.devicePixelRatio).toString()):null;pi=!!Ni&&!!ti,Ni&&Nn.setConstantPatternPositions(Ni,ti)}K>0&&(pi||Nn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&et.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Wr=y.getOrCreateProgram(Xt,{config:Nn,defines:Nr?It:et,overrideFog:Tn});if(y.terrain&&y.terrain.setupElevationDraw(cr,Wr,{useMeterToDem:!0}),!fr.centroidVertexBuffer){const Un=Wr.getAttributeLocation(W,"a_centroid_pos");Un!==-1&&W.vertexAttrib2f(Un,0,0)}!mt&&Lt&&Lt.setupShadows(cr.tileID.toUnwrapped(),Wr,"vector-tile"),le&&(y.context.activeTexture.set(W.TEXTURE0),cr.imageAtlasTexture&&cr.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Nn.updatePaintBuffers());const jn=h.paint.get("fill-extrusion-vertical-gradient"),on=1/fr.tileToMeter;let oi;if(mt&&Lt){if(jA(cr.tileID,fr.maxHeight,y))continue;const Un=Lt.calculateShadowPassMatrixFromTile(cr.tileID.toUnwrapped());oi=EA(Un,Be,on,wt,Ot,Kt)}else{const Un=y.translatePosMatrix(hr.expandedProjMatrix,cr,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ln=H.projection.createInversionMatrix(H,hr.canonical);oi=le?TA(Un,y,jn,ue,Ee,Be,on,hr,cr,Re,Ot,Kt,Fe,Me,ln,ot,wt,K):s_(Un,y,jn,ue,Ee,Be,on,hr,Re,Ot,Kt,Fe,Me,ln,ot,wt,rt,Wt)}y.uploadCommonUniforms(z,Wr,hr.toUnwrapped(),null,ht);let Mn=fr.segments;if(H.projection.name==="mercator"&&!mt&&(Mn=fr.getVisibleSegments(cr.tileID,y.terrain,y.transform.getFrustum(0)),!Mn.get().length))continue;if(br)if(mt)for(const Un of Mn.get())br.numRenderedVerticesInShadowPass+=Un.primitiveLength;else for(const Un of Mn.get())br.numRenderedVerticesInTransparentPass+=Un.primitiveLength;const Ti=[];(y.terrain||D)&&Ti.push(fr.centroidVertexBuffer),Ve&&Ti.push(fr.layoutVertexExtBuffer),pt&&Ti.push(fr.wallVertexBuffer),Wr.draw(y,z.gl.TRIANGLES,w,P,O,yr,oi,h.id,fr.layoutVertexBuffer,fr.indexBuffer,Mn,h.paint,y.transform.zoom,Nn,Ti)}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1)}class kw{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Gu(y,s,h,v,w,P,O,D,z,W,H,Q,K,re,le,ue,xe,me,Ee,Ie){const Ae=s.context,Be=Ae.gl,Re=s.transform,Ve=s.transform.zoom,Fe=[],Me=y.translate,qe=y.translateAnchor,ot=y.edgeRadius,rt=qu(s,y.cutoffFadeRange);H==="clear"?(Fe.push("CLEAR_SUBPASS"),Ie&&(Fe.push("CLEAR_FROM_TEXTURE"),Ae.activeTexture.set(Be.TEXTURE0),Ie.bind(Be.LINEAR,Be.CLAMP_TO_EDGE))):H==="sdf"&&Fe.push("SDF_SUBPASS"),me&&Fe.push("HAS_CENTROID"),rt.shouldRenderCutoff&&Fe.push("RENDER_CUTOFF");const wt=(pt,Ot,Kt,ht,et)=>{let It=Fe;Ot.groundRadiusBuffer!=null&&(It=Fe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const mt=Ot.programConfigurations.get(v.id),Lt=s.isTileAffectedByFog(pt),Jt=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:mt,defines:It,overrideFog:Lt}),yr=hp(s,ht,Q,W,et,[K,re*et],le,ue,xe,Ve>=17?0:ot*et,Ie?Ie.size[0]:0),Wt=[];me&&Wt.push(Ot.hiddenByLandmarkVertexBuffer),Ot.groundRadiusBuffer!=null&&Wt.push(Ot.groundRadiusBuffer),s.uploadCommonUniforms(Ae,Jt,pt.toUnwrapped(),null,rt),Jt.draw(s,Ae.gl.TRIANGLES,P,O,D,z,yr,v.id,Ot.vertexBuffer,Ot.indexBuffer,Kt,v.paint,Ve,mt,Wt)};for(const pt of w){const Ot=h.getTile(pt),Kt=Ot.getBucket(v);if(!Kt||Kt.projection.name!==Re.projection.name||!Kt.groundEffect||Kt.groundEffect&&!Kt.groundEffect.hasData())continue;const ht=Kt.groundEffect,et=1/Kt.tileToMeter;{const It=s.translatePosMatrix(pt.projMatrix,Ot,Me,qe),mt=ht.getDefaultSegment();wt(pt,ht,mt,It,et)}if(Ee)for(let It=0;It<4;It++){const mt=i.e8[It](pt),Lt=h.getTile(mt);if(!Lt)continue;const Jt=Lt.getBucket(v);if(!Jt||Jt.projection.name!==Re.projection.name||!Jt.groundEffect||Jt.groundEffect&&!Jt.groundEffect.hasData())continue;const yr=Jt.groundEffect;let Wt,Xt;It===0?(Wt=[-i.al,0,0],Xt=1):It===1?(Wt=[i.al,0,0],Xt=0):It===2?(Wt=[0,-i.al,0],Xt=3):(Wt=[0,i.al,0],Xt=2);const br=yr.regionSegments[Xt];if(!br)continue;const hr=new Float32Array(16);i.bq(hr,pt.projMatrix,Wt),wt(pt,yr,br,s.translatePosMatrix(hr,Ot,Me,qe),et)}}}function qd(y,s,h,v,w,P,O){v.centroidVertexArray.length===0&&v.createCentroidsBuffer();const D=P?P.findDEMTileFor(h):null;if(!(D&&D.dem||O))return;P&&D&&D.dem&&v.selfDEMTileTimestamp!==D.dem._timestamp&&(v.borderDoneWithNeighborZ=[-1,-1,-1,-1],v.selfDEMTileTimestamp=D.dem._timestamp);const z=me=>new i.P(Math.ceil((me+i.ec)*i.ed),0),W=me=>{const Ee=s.getSource().minzoom,Ie=Be=>{const Re=s.getTileByID(Be);if(Re&&Re.hasData())return Re.getBucket(w)},Ae=[0,-1,1];for(const Be of Ae){if(me.overscaledZ+Be<Ee)continue;const Re=Ie(me.calculateScaledKey(me.overscaledZ+Be));if(Re)return Re}},H=[0,0,0],Q=(me,Ee)=>(H[0]=Math.min(me.min.y,Ee.min.y),H[1]=Math.max(me.max.y,Ee.max.y),H[2]=i.al-Ee.min.x>me.max.x?Ee.min.x-i.al:me.max.x,H),K=(me,Ee)=>(H[0]=Math.min(me.min.x,Ee.min.x),H[1]=Math.max(me.max.x,Ee.max.x),H[2]=i.al-Ee.min.y>me.max.y?Ee.min.y-i.al:me.max.y,H),re=[(me,Ee)=>Q(me,Ee),(me,Ee)=>Q(Ee,me),(me,Ee)=>K(me,Ee),(me,Ee)=>K(Ee,me)],le=(me,Ee,Ie,Ae,Be,Re,Ve)=>{if(!P)return 0;const Fe=[[Re?Ie:me,Re?me:Ie,0],[Re?Ie:Ee,Re?Ee:Ie,0]],Me=Ve<0?i.al+Ve:Ve,qe=[Re?Me:(me+Ee)/2,Re?(me+Ee)/2:Me,0];return Ie===0&&Ve<0||Ie!==0&&Ve>0?P.getForTilePoints(Be,[qe],!0,Ae):Fe.push(qe),P.getForTilePoints(h,Fe,!0,D),Math.max(Fe[0][2],Fe[1][2],qe[2])/P.exaggeration()};for(let me=0;me<4;me++){const Ee=v.borderFeatureIndices[me];if(Ee.length===0)continue;const Ie=i.e8[me](h),Ae=W(Ie);if(!(Ae&&Ae instanceof i.e9))continue;const Be=P?P.findDEMTileFor(Ie):null;if(!(Be&&Be.dem||O)||(P&&Be&&Be.dem&&v.borderDEMTileTimestamp[me]!==Be.dem._timestamp&&(v.borderDoneWithNeighborZ[me]=-1,v.borderDEMTileTimestamp[me]=Be.dem._timestamp),v.borderDoneWithNeighborZ[me]===Ae.canonical.z))continue;Ae.centroidVertexArray.length===0&&Ae.createCentroidsBuffer();const Re=(me<2?1:5)-me,Ve=Ae.borderDoneWithNeighborZ[Re]!==v.canonical.z,Fe=Ae.borderFeatureIndices[Re];let Me=0;if(v.canonical.z!==Ae.canonical.z){for(const qe of Ee)v.showCentroid(v.featuresOnBorder[qe]);if(Ve)for(const qe of Fe)Ae.showCentroid(Ae.featuresOnBorder[qe]);v.borderDoneWithNeighborZ[me]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Re]=v.canonical.z}for(const qe of Ee){const ot=v.featuresOnBorder[qe],rt=v.centroidData[ot.centroidDataIndex],wt=ot.borders[me];let pt;for(;Me<Fe.length;){pt=Ae.featuresOnBorder[Fe[Me]];const Ot=pt.borders[Re];if(Ot[1]>wt[0]+3||Ot[0]>wt[0]-3)break;Ae.showCentroid(pt),Me++}if(pt&&Me<Fe.length){const Ot=Me;let Kt=0;for(;!(pt.borders[Re][0]>wt[1]-3)&&(Kt++,++Me!==Fe.length);)pt=Ae.featuresOnBorder[Fe[Me]];pt=Ae.featuresOnBorder[Fe[Ot]];let ht=!1;if(Kt>=1){const mt=pt.borders[Re];Math.abs(wt[0]-mt[0])<3&&Math.abs(wt[1]-mt[1])<3&&(Kt=1,ht=!0,Me=Ot+1)}else if(Kt===0){v.showCentroid(ot);continue}const et=Ae.centroidData[pt.centroidDataIndex];O&&ht&&(((ue=rt).flags|(xe=et).flags)&i.eb?(ue.flags|=i.eb,xe.flags|=i.eb):(ue.flags&=~i.eb,xe.flags&=~i.eb));const It=ot.intersectsCount()>1||pt.intersectsCount()>1;if(Kt>1)Me=Ot,rt.centroidXY=et.centroidXY=new i.P(0,0);else if(Be&&Be.dem&&!It){const mt=re[me](rt,et),Lt=me%2?i.al-1:0,Jt=le(mt[0],Math.min(i.al-1,mt[1]),Lt,Be,Ie,me<2,mt[2]);rt.centroidXY=et.centroidXY=z(Jt)}else It?rt.centroidXY=et.centroidXY=new i.P(0,0):(rt.centroidXY=v.encodeBorderCentroid(ot),et.centroidXY=Ae.encodeBorderCentroid(pt));v.writeCentroidToBuffer(rt),Ae.writeCentroidToBuffer(et)}else v.showCentroid(ot)}v.borderDoneWithNeighborZ[me]=Ae.canonical.z,Ae.borderDoneWithNeighborZ[Re]=v.canonical.z}var ue,xe;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(y)}const Wd=[1,0,0],jr=[0,1,0],Rw=[0,0,1];function jA(y,s,h){const v=h.transform,w=h.shadowRenderer;if(!w)return!0;const P=y.toUnwrapped(),O=v.tileSize*w._cascades[h.currentShadowCascade].scale;let D=s;if(v.elevation){const ue=v.elevation.getMinMaxForTile(y);ue&&(D+=ue.max)}const z=[...w.shadowDirection];z[2]=-z[2];const W=w.computeSimplifiedTileShadowVolume(P,D,O,z);if(!W)return!1;const H=[Wd,jr,Rw,z,[z[0],0,z[2]],[0,z[1],z[2]]],Q=v.projection.name==="globe",K=v.scaleZoom(O),re=i.cA.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,K,!Q),le=w.getCurrentCascadeFrustum();return re.intersectsPrecise(W.vertices,W.planes,H)===0||le.intersectsPrecise(W.vertices,W.planes,H)===0}function x_(y){const{painter:s,source:h,layer:v,coords:w}=y;let P=y.defines;const O=s.context,D=s.renderPass==="shadow",z=s.renderPass==="light-beam",W=s.shadowRenderer,H=i.ee(s.transform.center.lat,s.transform.zoom),Q=qu(s,v.paint.get("building-cutoff-fade-range"));Q.shouldRenderCutoff&&(P=P.concat("RENDER_CUTOFF")),y.floodLightIntensity>0&&(P=P.concat("FLOOD_LIGHT"));for(const K of w){const re=h.getTile(K),le=re.getBucket(v);if(!le)continue;W&&W.getMaxCascadeForTile(K.toUnwrapped())===0&&(P=P.concat("SHADOWS_SINGLE_CASCADE"));const ue=le.programConfigurations.get(v.id);let xe,me,Ee,Ie=s.translatePosMatrix(K.expandedProjMatrix,re,[0,0],"map");if(Ie=i.cR(i.bB(),Ie,[1,1,y.verticalScale]),D&&W){if(jA(re.tileID,le.maxHeight*H,s))continue;let Be=W.calculateShadowPassMatrixFromTile(re.tileID.toUnwrapped());Be=i.cR(i.bB(),Be,[1,1,y.verticalScale]),Ee=CA(Be),xe=me=s.getOrCreateProgram("buildingDepth",{config:ue,defines:P,overrideFog:!1})}else if(z)xe=me=s.getOrCreateProgram("buildingBloom",{config:ue,defines:P,overrideFog:!1}),Ee=Ew(Ie);else{const Be=s.transform.calculatePosMatrix(K.toUnwrapped(),s.transform.worldSize);i.cR(Be,Be,[1,1,y.verticalScale]);const Re=i.bB();i.cR(Re,Be,[1,-1,1/H]),i.bk(Re,Re),i.ef(Re,Re);const Ve=s.transform.getFreeCameraOptions().position,Fe=1<<K.canonical.z;if(Ee=Sw(Ie,Re,y.opacity,y.facadeAOIntensity,[((Ve.x-K.wrap)*Fe-K.canonical.x)*i.al,(Ve.y*Fe-K.canonical.y)*i.al,Ve.z*Fe*i.al],le.tileToMeter,y.facadeEmissiveChance,y.floodLightColor,y.floodLightIntensity),me=s.getOrCreateProgram("building",{config:ue,defines:P,overrideFog:!1}),y.depthOnly===!0)xe=me;else{const Me=P.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);xe=s.getOrCreateProgram("building",{config:ue,defines:Me,overrideFog:!1})}W&&(W.setupShadowsFromMatrix(Be,me,!0),xe!==me&&W.setupShadowsFromMatrix(Be,xe,!0))}const Ae=(Be,Re)=>{if(z){const Ve=Be.entranceBloom;Re.draw(s,O.gl.TRIANGLES,y.depthMode,Xr.disabled,y.blendMode,qr.disabled,Ee,v.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segmentsBucket,v.paint,s.transform.zoom,ue,[Ve.layoutAttenuationBuffer,Ve.layoutColorBuffer])}else{const Ve=Be.segmentsBucket;let Fe=[Be.layoutNormalBuffer,Be.layoutCentroidBuffer,Be.layoutColorBuffer,Be.layoutFloodLightDataBuffer];Be.layoutFacadePaintBuffer&&(Fe=Fe.concat([Be.layoutFacadeDataBuffer,Be.layoutFacadeVerticalRangeBuffer,Be.layoutFacadePaintBuffer])),Re.draw(s,O.gl.TRIANGLES,y.depthMode,Xr.disabled,y.blendMode,D?qr.disabled:qr.backCW,Ee,v.id,Be.layoutVertexBuffer,Be.indexBuffer,Ve,v.paint,s.transform.zoom,ue,Fe)}};s.uploadCommonUniforms(O,me,K.toUnwrapped(),null,Q),le.buildingWithoutFacade&&Ae(le.buildingWithoutFacade,me),le.buildingWithFacade&&(xe!==me&&s.uploadCommonUniforms(O,xe,K.toUnwrapped(),null,Q),Ae(le.buildingWithFacade,xe))}}function b_(y,s,h,v,w,P,O,D,z,W,H,Q,K){const re=y.context.gl,le=y.depthModeForSublayer(1,Sr.ReadOnly,re.LEQUAL,!0),ue=.1*(1-(xe=H))+3*xe;var xe;const me=y._showOverdrawInspector,Ee=Q,Ie=new kw;me||Gu(Ie,y,s,h,v,le,new Xr({func:re.ALWAYS,mask:255},255,255,re.KEEP,re.KEEP,re.REPLACE),new pn([re.ONE,re.ONE,re.ONE,re.ONE],i.ao.transparent,[!1,!1,!1,!0],re.MIN),qr.disabled,w,"sdf",P,O,D,z,W,ue,Ee,!1);{const Ae=me?Xr.disabled:new Xr({func:re.EQUAL,mask:255},255,255,re.KEEP,re.DECR,re.DECR),Be=me?y.colorModeForRenderPass():new pn([re.ONE_MINUS_DST_ALPHA,re.DST_ALPHA,re.ONE,re.ONE],i.ao.transparent,[!0,!0,!0,!0]);Gu(Ie,y,s,h,v,le,Ae,Be,qr.disabled,w,"color",P,O,D,z,W,ue,Ee,!1)}}function jw(y){return[y[0]*i.eg,y[1]*i.eg,y[2]*i.eg,0]}function Nw(y,s,h,v,w,P,O,D,z){const W=v.getSource(),H=h.globeSharedBuffers;if(!H)return;let Q,K,re;if(s&&(Q=v.getTile(s)),W instanceof i.aT?(K=W.texture,re=i.dJ(0,0,h.transform)):Q&&s&&(K=Q.texture,re=i.dJ(s.canonical.z,s.canonical.x,h.transform)),!K||!re)return;y||(re=i.cR(i.bB(),re,[1,-1,1]));const le=h.context,ue=le.gl,xe=w.paint.get("raster-resampling")==="nearest"?ue.NEAREST:ue.LINEAR,me=h.colorModeForDrapableLayerRenderPass(P),Ee=O.defines;Ee.push("GLOBE_POLES");const Ie=new Sr(ue.LEQUAL,Sr.ReadWrite,h.depthRangeFor3D),Ae=Float32Array.from(h.transform.expandedFarZProjMatrix),Be=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),le.activeTexture.set(ue.TEXTURE0),K.bind(xe,ue.CLAMP_TO_EDGE),le.activeTexture.set(ue.TEXTURE1),K.bind(xe,ue.CLAMP_TO_EDGE),"useMipmap"in K&&le.extTextureFilterAnisotropic&&h.transform.pitch>20&&ue.texParameterf(ue.TEXTURE_2D,le.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,le.extTextureFilterAnisotropicMax);const[Re,Ve,Fe,Me]=s?H.getPoleBuffers(s.canonical.z,!1):H.getPoleBuffers(0,!0),qe=w.paint.get("raster-elevation");let ot;y?(ot=Re,h.renderDefaultNorthPole=qe!==0):(ot=Ve,h.renderDefaultSouthPole=qe!==0);const rt=jw(O.mix),wt=((Ot,Kt,ht,et,It,mt,Lt,Jt,yr,Wt,Xt,br,hr)=>Ug(Ot,Kt,ht,new Float32Array(16),new Float32Array(9),[0,0],et,[0,0],[0,0,0,0],1,{opacity:1,mix:0},mt,[0,0],Jt,2,Wt,Xt,br,1,0,hr))(Ae,Be,re,i.aj(h.transform.zoom),0,w,0,qe,0,rt,O.offset,O.range,P),pt=h.getOrCreateProgram("raster",{defines:Ee});h.uploadCommonUniforms(le,pt,null),pt.draw(h,ue.TRIANGLES,Ie,z,me,D,wt,w.id,ot,Fe,Me)}function NA(y){const s=y._nearZ,h=y.projection.farthestPixelDistance(y),v=h-s,w=.2*y.height,P=s+w;return[s,h,(P-w-s)/v,(P-s)/v]}function oj(y,s,h,v){if(y)return s instanceof so&&y instanceof Ld?s.getTextureDescriptor(y,h,!0):{texture:y.texture,mix:jw(v.mix),offset:v.offset,buffer:0,tileSize:1}}var sj=i.eh([{name:"a_index",type:"Int16",components:1}]);class Js{constructor(s,h,v,w){const P={width:v[0],height:v[1],data:null},O=s.gl;this.targetColorTexture=new i.T(s,P,O.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(s,P,O.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,w),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const v=this.context.gl,w=h.width*h.height;this.particleTexture0=new i.T(this.context,h,v.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,h,v.RGBA8,{premultiply:!1,useMipmap:!1});const P=new i.ei;P.reserve(w);for(let O=0;O<w;O++)P.emplaceBack(O);this.particleIndexBuffer=this.context.createVertexBuffer(P,sj.members,!0),this.particleSegment=i.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=i.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Mw(y,s,h){if(!y)return null;const v=s.getTextureDescriptor(y,h,!0);if(!v)return null;let{texture:w,mix:P,offset:O,tileSize:D,buffer:z,format:W}=v;if(!w||!W)return null;let H=!1;return W==="uint32"&&(H=!0,P[3]=0,P=c_(i.ej,P,[0,h.paint.get("raster-particle-max-speed")]),O=Wu(i.ej,O,[0,h.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[z/(D+2*z),D/(D+2*z)],tileSize:D,scalarData:H,scale:P,offset:O,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[W]]}}function ws(y){const s=y._nearZ,h=y.projection.farthestPixelDistance(y),v=h-s,w=.2*y.height,P=s+w;return[s,h,(P-w-s)/v,(P-s)/v]}const Gd=new i.ao(1,0,0,1),MA=new i.ao(0,1,0,1),Dw=new i.ao(0,0,1,1),Lw=new i.ao(1,0,1,1),Fw=new i.ao(0,1,1,1);function zw(y,s,h,v,w,P){for(let O=0;O<h.length;O++)if(w){const W=new i.ao(v.r*.8,v.g*.8,v.b*.8,1);Qs(y,s,h[O],v,-1,-1,P),Qs(y,s,h[O],v,-1,1,P),Qs(y,s,h[O],v,1,1,P),Qs(y,s,h[O],v,1,-1,P),Qs(y,s,h[O],W,0,0,P)}else Qs(y,s,h[O],v,0,0,P)}function Qs(y,s,h,v,w,P,O){const D=y.context,z=y.transform,W=D.gl,H=z.projection.name==="globe",Q=H?["PROJECTION_GLOBE_VIEW"]:[];let K=i.by(h.projMatrix);if(H&&i.aj(z.zoom)>0){const rt=i.bi(h.canonical,z),wt=i.ek(rt);K=i.aB(new Float32Array(16),z.globeMatrix,wt),i.aB(K,z.projMatrix,K)}const re=i.bB();re[12]+=2*w/(i.o.devicePixelRatio*z.width),re[13]+=2*P/(i.o.devicePixelRatio*z.height),i.aB(K,re,K);const le=y.getOrCreateProgram("debug",{defines:Q}),ue=s.getTileByID(h.key);y.terrain&&y.terrain.setupElevationDraw(ue,le);const xe=Sr.disabled,me=Xr.disabled,Ee=y.colorModeForRenderPass(),Ie="$debug";D.activeTexture.set(W.TEXTURE0),y.emptyTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),H?ue._makeGlobeTileDebugBuffers(y.context,z):ue._makeDebugTileBoundsBuffers(y.context,z.projection);const Ae=ue._tileDebugBuffer||y.debugBuffer,Be=ue._tileDebugIndexBuffer||y.debugIndexBuffer,Re=ue._tileDebugSegments||y.debugSegments;if(le.draw(y,W.LINE_STRIP,xe,me,Ee,qr.disabled,Tw(K,v.toPremultipliedRenderColor(null)),Ie,Ae,Be,Re,null,null,null,[ue._globeTileDebugBorderBuffer]),O){const rt=ue.latestRawTileData,wt=Math.floor((rt&&rt.byteLength||0)/1024);let pt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(pt+=` => ${h.overscaledZ}`),pt+=` ${ue.state}`,pt+=` ${wt}kb`,function(Ot,Kt){Ot.initDebugOverlayCanvas();const ht=Ot.debugOverlayCanvas,et=Ot.context.gl,It=Ot.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,ht.width,ht.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(Kt,5,5),It.strokeText(Kt,5,5),Ot.debugOverlayTexture.update(ht),Ot.debugOverlayTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE)}(y,pt)}const Ve=s.getTile(h).tileSize,Fe=512/Math.min(Ve,512)*(h.overscaledZ/z.zoom)*.5,Me=ue._tileDebugTextBuffer||y.debugBuffer,qe=ue._tileDebugTextIndexBuffer||y.quadTriangleIndexBuffer,ot=ue._tileDebugTextSegments||y.debugSegments;le.draw(y,W.TRIANGLES,xe,me,pn.alphaBlended,qr.disabled,Tw(K,i.ao.transparent.toPremultipliedRenderColor(null),Fe),Ie,Me,qe,ot,null,null,null,[ue._globeTileDebugTextBuffer])}function ki(y,s,h,v){gp(y,0,s+h/2,y.transform.width,h,v)}function Wg(y,s,h,v){gp(y,s-h/2,0,h,y.transform.height,v)}function gp(y,s,h,v,w,P){const O=y.context,D=O.gl;D.enable(D.SCISSOR_TEST),D.scissor(s*i.o.devicePixelRatio,h*i.o.devicePixelRatio,v*i.o.devicePixelRatio,w*i.o.devicePixelRatio),O.clear({color:P}),D.disable(D.SCISSOR_TEST)}const DA=i.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:LA}=DA;function Hu(y,s,h,v){y.emplaceBack(s,h,v)}class Bw{constructor(s){this.vertexArray=new i.el,this.indices=new i.b0,Hu(this.vertexArray,-1,-1,1),Hu(this.vertexArray,1,-1,1),Hu(this.vertexArray,-1,1,1),Hu(this.vertexArray,1,1,1),Hu(this.vertexArray,-1,-1,-1),Hu(this.vertexArray,1,-1,-1),Hu(this.vertexArray,-1,1,-1),Hu(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,LA),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=i.bf.simpleSegment(0,0,36,12)}}function ic(y,s,h,v,w,P){const O=y.context.gl,D=s.paint.get("sky-atmosphere-color"),z=s.paint.get("sky-atmosphere-halo-color"),W=s.paint.get("sky-atmosphere-sun-intensity"),H=((Q,K,re,le,ue)=>({u_matrix_3f:Q,u_sun_direction:K,u_sun_intensity:re,u_color_tint_r:[le.r,le.g,le.b,le.a],u_color_tint_m:[ue.r,ue.g,ue.b,ue.a],u_luminance:5e-5}))(i.en(i.dN(),v),w,W,D.toPremultipliedRenderColor(null),z.toPremultipliedRenderColor(null));O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+P,s.skyboxTexture,0),h.draw(y,O.TRIANGLES,Sr.disabled,Xr.disabled,pn.unblended,qr.frontCW,H,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Zh=i.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class qt{constructor(s){const h=new i.eo;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const v=new i.b0;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Zh.members),this.indexBuffer=s.createIndexBuffer(v),this.segments=i.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const sr=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class yp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class la{constructor(s){this.colorModeAlphaBlendedWriteRGB=new pn([1,Ea,1,Ea],i.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new pn([1,0,1,0],i.ao.transparent,[!1,!1,!1,!0]),this.params=new yp,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new qt(h);const v=this.params.sizeRange,w=this.params.intensityRange,P=function(H){const Q=i.eq(30),K=[];for(let re=0;re<H;++re){const le=2*Math.PI*Q(),ue=Math.acos(1-2*Q())-.5*Math.PI;K.push(i.d4(Math.cos(ue)*Math.cos(le),Math.cos(ue)*Math.sin(le),Math.sin(ue)))}return K}(this.params.starsCount),O=i.eq(300),D=new i.ep,z=new i.b0;let W=0;for(let H=0;H<P.length;++H){const Q=i.c4([],P[H],200),K=Math.max(0,1+.01*v*(1*O()-.5)),re=Math.max(0,1+.01*w*(1*O()-.5));D.emplaceBack(Q[0],Q[1],Q[2],-1,-1,K,re),D.emplaceBack(Q[0],Q[1],Q[2],1,-1,K,re),D.emplaceBack(Q[0],Q[1],Q[2],1,1,K,re),D.emplaceBack(Q[0],Q[1],Q[2],-1,1,K,re),z.emplaceBack(W+0,W+1,W+2),z.emplaceBack(W+0,W+2,W+3),W+=4}this.starsVx=h.createVertexBuffer(D,sr.members),this.starsIdx=h.createIndexBuffer(z),this.starsSegments=i.bf.simpleSegment(0,0,D.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){const v=s.context,w=v.gl,P=s.transform,O=new Sr(w.LEQUAL,Sr.ReadOnly,[0,1]),D=i.aj(P.zoom),z=s.style.getLut(h.scope),W=h.properties.get("color-use-theme")==="none",H=h.properties.get("color").toNonPremultipliedRenderColor(W?null:z),Q=h.properties.get("high-color-use-theme")==="none",K=h.properties.get("high-color").toNonPremultipliedRenderColor(Q?null:z),re=h.properties.get("space-color-use-theme")==="none",le=h.properties.get("space-color").toNonPremultipliedRenderColor(re?null:z),ue=5e-4,xe=i.er(h.properties.get("horizon-blend"),0,1,ue,.25),me=i.dD(s,v,P)&&xe===ue?P.worldSize/(2*Math.PI*1.025)-1:P.globeRadius,Ee=s.frameCounter/1e3%1,Ie=i.ag(P.globeCenterInViewSpace),Ae=Math.sqrt(Math.pow(Ie,2)-Math.pow(me,2)),Be=Math.acos(Ae/Ie),Re=Ve=>{const Fe=P.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ve&&Fe.push("ALPHA_PASS");const Me=s.getOrCreateProgram("globeAtmosphere",{defines:Fe}),qe=((rt,wt,pt,Ot,Kt,ht,et,It,mt,Lt,Jt,yr)=>({u_frustum_tl:rt,u_frustum_tr:wt,u_frustum_br:pt,u_frustum_bl:Ot,u_horizon:Kt,u_transition:ht,u_fadeout_range:et,u_atmosphere_fog_color:It.toArray01(),u_high_color:mt.toArray01(),u_space_color:Lt.toArray01(),u_temporal_offset:Jt,u_horizon_angle:yr}))(P.frustumCorners.TL,P.frustumCorners.TR,P.frustumCorners.BR,P.frustumCorners.BL,P.frustumCorners.horizon,D,xe,H,K,le,Ee,Be);s.uploadCommonUniforms(v,Me);const ot=this.atmosphereBuffer;ot&&Me.draw(s,w.TRIANGLES,O,Xr.disabled,Ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qr.backCW,qe,Ve?"atmosphere_glow_alpha":"atmosphere_glow",ot.vertexBuffer,ot.indexBuffer,ot.segments)};Re(!1),Re(!0)}drawStars(s,h){const v=i.aA(h.properties.get("star-intensity"),0,1);if(v===0)return;const w=s.context,P=w.gl,O=s.transform,D=s.getOrCreateProgram("stars"),z=i.c6([]);i.c8(z,z,-O._pitch),i.c7(z,z,-O.angle),i.c8(z,z,i.an(O._center.lat)),i.es(z,z,-i.an(O._center.lng));const W=i.cb(new Float32Array(16),z),H=i.aB([],O.starsProjMatrix,W),Q=i.en([],W),K=i.et([],Q),re=[0,1,0];i.dP(re,re,K),i.c4(re,re,this.params.sizeMultiplier);const le=[1,0,0];i.dP(le,le,K),i.c4(le,le,this.params.sizeMultiplier);const ue=(xe=re,me=le,Ee=v,{u_matrix:Float32Array.from(H),u_up:xe,u_right:me,u_intensity_multiplier:Ee});var xe,me,Ee;s.uploadCommonUniforms(w,D),this.starsVx&&this.starsIdx&&D.draw(s,P.TRIANGLES,Sr.disabled,Xr.disabled,this.colorModeAlphaBlendedWriteRGB,qr.disabled,ue,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class lt{constructor(){this.visibleTiles=[]}updateBorders(s,h){const v=[],w=[],P=s._getRenderableCoordinates(!1,!0);for(const z of P){const W=s.getTile(z);if(!W.hasData())continue;const H=W.getBucket(h);H&&(H.isEmpty()||(v.push(z.key),w.push({bucket:H,tileID:z.canonical})))}let O=v.length!==this.visibleTiles.length;if(!O){v.sort();for(let z=0;z<v.length;z++)if(v[z]!==this.visibleTiles[z]){O=!0;break}}if(!O)return;const D=new Set;this.visibleTiles=v,w.sort((z,W)=>z.tileID.z-W.tileID.z||z.tileID.x-W.tileID.x||z.tileID.y-W.tileID.y);for(const z of w){const W=new Array,H=new Array,Q=z.bucket;for(const K of Q.featuresOnBorder)D.has(K.featureId)?H.push(K.footprintIndex):(D.add(K.featureId),W.push(K.footprintIndex));Q.updateFootprintHiddenFlags(W,i.eu,!1),Q.updateFootprintHiddenFlags(H,i.eu,!0)}}}function $w(y,s){const h=[...y],v=s.cameraWorldSizeForFog/s.worldSize,w=i.bz([]);return i.cR(w,w,[v,v,1]),i.aB(h,w,h),i.aB(h,s.worldToFogMatrix,h),h}function vp(y,s,h,v,w){const P=h.material,O=v.context,{baseColorTexture:D,metallicRoughnessTexture:z}=P.pbrMetallicRoughness,{normalTexture:W,occlusionTexture:H,emissionTexture:Q}=P;function K(le,ue,xe){if(le&&(y.push(ue),O.activeTexture.set(O.gl.TEXTURE0+xe),le.gfxTexture)){const{minFilter:me,magFilter:Ee,wrapS:Ie,wrapT:Ae}=le.sampler;le.gfxTexture.bindExtraParam(me,Ee,Ie,Ae)}}K(D,"HAS_TEXTURE_u_baseColorTexture",wo.BaseColor),K(z,"HAS_TEXTURE_u_metallicRoughnessTexture",wo.MetallicRoughness),K(W,"HAS_TEXTURE_u_normalTexture",wo.Normal),K(H,"HAS_TEXTURE_u_occlusionTexture",wo.Occlusion),K(Q,"HAS_TEXTURE_u_emissionTexture",wo.Emission),w&&(w.texture||(w.texture=new i.d_(v.context,w.image,[w.image.height,w.image.height,w.image.height],O.gl.RGBA8)),O.activeTexture.set(O.gl.TEXTURE0+wo.LUT),w.texture&&w.texture.bind(O.gl.LINEAR,O.gl.CLAMP_TO_EDGE),y.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(y.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(y.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(y.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(y.push("HAS_ATTRIBUTE_a_pbr"),y.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),P.alphaMode!=="OPAQUE"&&P.alphaMode!=="MASK"||y.push("UNPREMULT_TEXTURE_IN_SHADER"),P.defined||y.push("DIFFUSE_SHADED");const re=v.shadowRenderer;re&&(y.push("RENDER_SHADOWS","DEPTH_TEXTURE"),re.useNormalOffset&&y.push("NORMAL_OFFSET"))}function _p(y,s,h,v,w,P){const O=h.paint.get("model-opacity").constantOr(1),D=s.context,z=new Sr(s.context.gl.LEQUAL,y.isLightMesh?Sr.ReadOnly:Sr.ReadWrite,s.depthRangeFor3D),W=s.transform,H=y.mesh,Q=H.material,K=Q.pbrMetallicRoughness,re=s.style.fog;let le;le=s.transform.projection.zAxisUnit==="pixels"?[...y.nodeModelMatrix]:i.aB([],v.zScaleMatrix,y.nodeModelMatrix),i.aB(le,v.negCameraPosMatrix,le);const ue=i.bk([],le);i.ef(ue,ue);const xe=h.paint.get("model-color-use-theme").constantOr("default")==="none",me=h.paint.get("model-emissive-strength").constantOr(0),Ee=p_(new Float32Array(y.worldViewProjection),new Float32Array(le),new Float32Array(ue),null,s,O,K.baseColorFactor,Q.emissiveFactor,K.metallicFactor,K.roughnessFactor,Q,me,h,void 0,void 0,y.materialOverride,y.modelColor),Ie={defines:[]},Ae=[],Be=s.shadowRenderer;Be&&(Be.useNormalOffset=!1),vp(Ie.defines,Ae,H,s,xe?null:h.lut);let Re=null;if(re){const Me=$w(y.nodeModelMatrix,s.transform);if(Re=new Float32Array(Me),W.projection.name!=="globe"){const qe=H.aabb.min,ot=H.aabb.max,[rt,wt]=re.getOpacityForBounds(Me,qe[0],qe[1],ot[0],ot[1]);Ie.overrideFog=rt>=gt||wt>=gt}}const Ve=qu(s,h.paint.get("model-cutoff-fade-range"));Ve.shouldRenderCutoff&&Ie.defines.push("RENDER_CUTOFF");const Fe=s.getOrCreateProgram("model",Ie);s.uploadCommonUniforms(D,Fe,null,Re,Ve),s.renderPass!=="shadow"&&Be&&Be.setupShadowsFromMatrix(y.nodeModelMatrix,Fe),Fe.draw(s,D.gl.TRIANGLES,z,w,P,H.material.doubleSided?qr.disabled:qr.backCCW,Ee,h.id,H.vertexBuffer,H.indexBuffer,H.segments,h.paint,s.transform.zoom,void 0,Ae)}function w_(y,s,h){return y.type==="vector"?s.scope:h?"basemap":""}function S_(y,s,h,v,w,P,O,D,z){const W=y.transform,H=!!s.isGeometryBloom&&s.isGeometryBloom;if(H&&y.renderPass==="shadow")return;const Q=W.projection.name==="globe"?i.eC(h,W):[...h];i.aB(Q,Q,s.globalMatrix);const K=i.aB([],v,Q);if(s.meshes)for(const re of s.meshes){const le=D.get(re.material.name);if(le&&le.opacity<=0)continue;if(re.material.alphaMode!=="BLEND"){O.push({mesh:re,depth:0,modelIndex:w,worldViewProjection:K,nodeModelMatrix:Q,isLightMesh:H,materialOverride:le,modelColor:z});continue}const ue=i.af([],re.centroid,K);!W.isOrthographic&&ue[2]<=0||P.push({mesh:re,depth:ue[2],modelIndex:w,worldViewProjection:K,nodeModelMatrix:Q,isLightMesh:H,materialOverride:le,modelColor:z})}if(s.children)for(const re of s.children)S_(y,re,h,v,w,P,O,D,z)}function xp(y,s,h,v){const w=h.shadowRenderer;if(!w)return;const P=w.getShadowPassDepthMode(),O=w.getShadowPassColorMode(),D=w.calculateShadowPassMatrixFromMatrix(s),z=pp(D);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,P,Xr.disabled,O,qr.disabled,z,v.id,y.vertexBuffer,y.indexBuffer,y.segments,v.paint,h.transform.zoom,void 0,void 0)}function bp(y,s,h,v,w,P){for(const O of w){const D=Object.assign({},v);D.part=O;const z={type:"Unknown",id:s,properties:D},W={orientation:y.paint.get("model-rotation").evaluate(z,h)};P.set(O,W)}}function lj(y,s,h,v,w,P){for(const O of w){const D=Object.assign({},v);D.part=O;const z={type:"Unknown",id:s,properties:D},W={color:y.paint.get("model-color").evaluate(z,h),colorMix:y.paint.get("model-color-mix-intensity").evaluate(z,h),opacity:y.paint.get("model-opacity").evaluate(z,h),emissionStrength:y.paint.get("model-emissive-strength").evaluate(z,h)};P.set(O,W)}}function FA(y,s,h,v,w,P){if(h===1)for(const D of w)_p(D,y,s,P[D.modelIndex],Xr.disabled,y.colorModeForRenderPass());else{for(const D of w)_p(D,y,s,P[D.modelIndex],Xr.disabled,pn.disabled);for(const D of w)_p(D,y,s,P[D.modelIndex],y.stencilModeFor3D(),y.colorModeForRenderPass());y.resetStencilClippingMasks()}const O=pn.additive;for(const D of v)_p(D,y,s,P[D.modelIndex],Xr.disabled,D.isLightMesh?O:y.colorModeForRenderPass())}function zA(y,s,h){const v=s.updateZoomBasedPaintProperties(),w=function(P,O,D){let z,W,H,Q=P.terrain?P.terrain.exaggeration():0;if(P.terrain&&Q>0){const K=P.terrain,re=K.findDEMTileFor(D);re&&re.dem?z=i.eE.create(K,D,re):Q=0}if(Q===0&&(O.terrainElevationMin=0,O.terrainElevationMax=0),Q===O.validForExaggeration&&(Q===0||z&&z._demTile&&z._demTile.tileID===O.validForDEMTile.id&&z._dem._timestamp===O.validForDEMTile.timestamp))return!1;for(const K in O.instancesPerModel){const re=O.instancesPerModel[K];for(let le=0;le<re.instancedDataArray.length;++le){const ue=(z?Q*z.getElevationAt(0|re.instancedDataArray.float32[16*le],0|re.instancedDataArray.float32[16*le+1],!0,!0):0)+re.instancesEvaluatedElevation[le];re.instancedDataArray.float32[16*le+6]=ue,W=W?Math.min(O.terrainElevationMin,ue):ue,H=H?Math.max(O.terrainElevationMax,ue):ue}}return O.terrainElevationMin=W||0,O.terrainElevationMax=H||0,O.validForExaggeration=Q,O.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(y,s,h);(v||w)&&(s.uploaded=!1,s.upload(y.context))}const bl={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.d8([0,0,0],[i.al,i.al,0])};function Uw(y,s){const h=1<<y.canonical.z,v=s.getFreeCameraOptions().position,w=s.elevation,P=y.canonical.x/h,O=(y.canonical.x+1)/h,D=y.canonical.y/h,z=(y.canonical.y+1)/h;let W=s._centerAltitude;if(w){const re=w.getMinMaxForTile(y);re&&re.max>W&&(W=re.max)}const H=i.aA(v.x,P,O)-v.x,Q=i.aA(v.y,D,z)-v.y,K=i.ce(W,s.center.lat)-v.z;return s._zoomFromMercatorZ(Math.sqrt(H*H+Q*Q+K*K))}function Vw(y,s,h,v,w,P,O){const D=y.context,z=y.renderPass==="shadow",W=y.shadowRenderer,H=z&&W?W.getShadowPassDepthMode():new Sr(D.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),Q=y.isTileAffectedByFog(P),K=y.transform.projection.name==="globe";if(h.meshes)for(const re of h.meshes){const le=K?[]:["MODEL_POSITION_ON_GPU"],ue=[];let xe,me,Ee;const Ie=!K&&v.instancedDataArray.length>20;Ie&&le.push("INSTANCED_ARRAYS");const Ae=qu(y,s.paint.get("model-cutoff-fade-range"));if(Ae.shouldRenderCutoff&&le.push("RENDER_CUTOFF"),z&&W)xe=y.getOrCreateProgram("modelDepth",{defines:le}),me=pp(O.shadowTileMatrix,O.shadowTileMatrix,Float32Array.from(h.globalMatrix)),Ee=W.getShadowPassColorMode();else{vp(le,ue,re,y,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),xe=y.getOrCreateProgram("model",{defines:le,overrideFog:Q});const Re=re.material,Ve=Re.pbrMetallicRoughness,Fe=s.paint.get("model-opacity").constantOr(1),Me=s.paint.get("model-emissive-strength").constantOr(0);me=p_(P.expandedProjMatrix,Float32Array.from(h.globalMatrix),new Float32Array(16),null,y,Fe,Ve.baseColorFactor,Re.emissiveFactor,Ve.metallicFactor,Ve.roughnessFactor,Re,Me,s,w),W&&(O.shadowUniformsInitialized?xe.setShadowUniformValues(D,W.getShadowUniformValues()):(W.setupShadows(P.toUnwrapped(),xe,"model-tile"),O.shadowUniformsInitialized=!0)),Ee=Ae.shouldRenderCutoff||Fe<1||Re.alphaMode!=="OPAQUE"?pn.alphaBlended:pn.unblended}y.uploadCommonUniforms(D,xe,P.toUnwrapped(),null,Ae);const Be=re.material.doubleSided?qr.disabled:qr.backCCW;if(Ie)ue.push(v.instancedDataBuffer),xe.draw(y,D.gl.TRIANGLES,H,Xr.disabled,Ee,Be,me,s.id,re.vertexBuffer,re.indexBuffer,re.segments,s.paint,y.transform.zoom,void 0,ue,v.instancedDataArray.length);else{const Re=z?"u_instance":"u_normal_matrix";for(let Ve=0;Ve<v.instancedDataArray.length;++Ve)me[Re]=new Float32Array(v.instancedDataArray.arrayBuffer,64*Ve,16),xe.draw(y,D.gl.TRIANGLES,H,Xr.disabled,Ee,Be,me,s.id,re.vertexBuffer,re.indexBuffer,re.segments,s.paint,y.transform.zoom,void 0,ue)}}if(h.children)for(const re of h.children)Vw(y,s,re,v,w,P,O)}const BA=[1,-1,1];function E_(y,s,h,v){if(!h.modelManager)return!0;const w=h.modelManager;if(!h.shadowRenderer)return!0;const P=h.shadowRenderer,O=s.aabb;let D=!0,z=y.maxHeight;if(z===0){let H=0;for(const Q in y.instancesPerModel){const K=w.getModel(Q,v);K?H=Math.max(H,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):D=!1}z=y.maxScale*H*1.41+y.maxVerticalOffset,D&&(y.maxHeight=z)}O.max[2]=z,O.min[2]+=y.terrainElevationMin,O.max[2]+=y.terrainElevationMax,i.af(O.min,O.min,s.tileMatrix),i.af(O.max,O.max,s.tileMatrix);const W=O.intersects(P.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(y.isInsideFirstShadowMapFrustum=W===2),W===0}function Gg(y,s){const h=y.uniformValues.u_cutoff_params[0],v=y.uniformValues.u_cutoff_params[1],w=y.uniformValues.u_cutoff_params[2],P=y.uniformValues.u_cutoff_params[3];return v===h||P===w?1:i.aA(((s-h)/(v-h)-w)/(P-w),0,1)}function Xh(y,s,h,v){if(s.pitch<20)return 1;const w=s.getWorldToCameraMatrix();i.aB(w,w,y);const P=i.bT(h.min[0],h.min[1],h.min[2],1);let O=i.aC(i.eF(),P,w),D=O,z=O;P[1]=h.max[1],O=i.aC(i.eF(),P,w),D=O[1]<D[1]?O:D,z=O[1]>z[1]?O:z,P[0]=h.max[0],O=i.aC(i.eF(),P,w),D=O[1]<D[1]?O:D,z=O[1]>z[1]?O:z,P[1]=h.min[1],O=i.aC(i.eF(),P,w),D=O[1]<D[1]?O:D,z=O[1]>z[1]?O:z;const W=i.aA(v[0],0,1),H=100*s.pixelsPerMeter*i.aA(v[1],0,1),Q=i.aA(v[2],0,1),K=i.eG(i.eF(),D,z,W),re=Math.tan(.5*s.fovX),le=-K[2]*re;if(H===0)return K[1]<-Math.abs(le)?Q:1;const ue=(-Math.abs(le)-K[1])/H,xe=(Ee,Ie,Ae)=>(1-Ae)*Ee+Ae*Ie,me=i.aA(xe(1,Q,ue),Q,1);return xe(1,me,i.aA((s.pitch-20)/20,0,1))}class $A{}class UA{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,v){{const Q=this._storage.get(h.id);if(Q)return Q.lastUsedFrameIdx=s,Q.buf}const w=v.gl,P=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),O=new ArrayBuffer(P),D=new Int16Array(O);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(O));const z=new i.eI;for(let Q=0;Q<P/2;Q+=3){const K=D[Q],re=D[Q+1],le=D[Q+2];z.emplaceBack(K,re),z.emplaceBack(re,le),z.emplaceBack(le,K)}const W=v.bindVertexArrayOES.current,H=new $A;return H.buf=new Ud(v,z),H.lastUsedFrameIdx=s,this._storage.set(h.id,H),v.bindVertexArrayOES.set(W),H.buf}update(s){for(const[h,v]of this._storage)s-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(h))}destroy(){for(const[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}class cj{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const VA=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class uj{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class os{constructor(s,h){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...h,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...h,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const dj=i.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Hg{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,h){const v=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const O=new i.eJ,D=new i.b0;O.emplaceBack(-1,-1),O.emplaceBack(1,-1),O.emplaceBack(1,1),O.emplaceBack(-1,1),D.emplaceBack(0,1,2),D.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(O,dj.members),this.vignetteIdx=s.context.createIndexBuffer(D)}const w=i.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,v);const O={u_vignetteShape:(P={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:P.vignetteColor};v.draw(s,s.context.gl.TRIANGLES,Sr.disabled,Xr.disabled,pn.alphaBlended,qr.disabled,O,"vignette",this.vignetteVx,this.vignetteIdx,w)}var P}}class zi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,h){const v=s.getFreeCameraOptions().position,w=v.toAltitude(),P=v.toLngLat(),O=i.an(P.lng),D=i.an(P.lat),z=s.pixelsPerMeter/h,W=O*i.eL,H=i.eL*Math.log(Math.tan(Math.PI/4+D/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Q=-this._offsetYPrev+H,K=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+W)*z,this._accumulatedOffsetY+=Q*z,this._accumulatedElevation+=K*z,this._offsetXPrev=W,this._offsetYPrev=H,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function En(y,s){return[-(y[0]-Math.floor(y[0]/s)*s),-(y[1]-Math.floor(y[1]/s)*s),-(y[2]-Math.floor(y[2]/s)*s)]}function qw(y){const s=i.eq(1323123451230),h=[];for(let v=0;v<y;++v){const w=2*s()-1,P=2*s()-1,O=2*s()-1;h.push(i.d4(w,P,O))}return h}function Ds(y,s,h,v,w){const P=i.aA((w-h)/(v-h),0,1);return(1-P)*y+P*s}class Yh{constructor(s){this._movement=new zi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Hg,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,h){const v=s.transform;this._movement.update(v,this._ppmScaleFactor);const w=v.starsProjMatrix,P=i.c6([]);i.c8(P,P,i.an(90)-v._pitch),i.c7(P,P,-v.angle);const O=i.cb(new Float32Array(16),P),D=i.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),z=i.ef([],D),W=i.aB([],z,O),H=Date.now()/1e3;return this._accumulatedTimeFromStart+=(H-this._prevTime)*h,this._prevTime=H,{projectionMatrix:w,modelviewMatrix:W}}}class wp extends Yh{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new os(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const v=qw(this.particlesCount),w=new i.eM,P=new i.b0;let O=0;const D=i.eq(1323123451230);for(let z=0;z<v.length;++z){const W=v[z],H=[2*D()-1,D(),D(),D()];w.emplaceBack(W[0],W[1],W[2],-1,-1,...H),w.emplaceBack(W[0],W[1],W[2],1,-1,...H),w.emplaceBack(W[0],W[1],W[2],1,1,...H),w.emplaceBack(W[0],W[1],W[2],-1,1,...H),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.particlesVx=h.createVertexBuffer(w,VA.members),this.particlesIdx=h.createIndexBuffer(P)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=s.transform.zoom;if(h.revealStart>v)return;const w=Ds(0,1,h.revealStart,h.revealStart+h.revealRange,v);if(!this.particlesVx||!this.particlesIdx)return;const P=structuredClone(this._params);let O=[-P.direction.x,P.direction.y,-100];i.aw(O,O);const D=structuredClone(this._vignetteParams);D.strength*=w,P.overrideStyleParameters||(P.intensity=s.style.rain.state.density,P.timeFactor=s.style.rain.state.intensity,P.color=structuredClone(s.style.rain.state.color),O=structuredClone(s.style.rain.state.direction),P.screenThinning.intensity=s.style.rain.state.centerThinning,P.dropletSizeX=s.style.rain.state.dropletSize[0],P.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],P.distortionStrength=100*s.style.rain.state.distortionStrength,D.strength=1,D.color=structuredClone(s.style.rain.state.vignetteColor));const z=this.updateOnRender(s,P.timeFactor),W=s.context,H=W.gl,Q=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new i.T(W,{width:s.width,height:s.height,data:null},H.RGBA8)),P.distortionStrength>0&&(W.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),H.copyTexSubImage2D(H.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const K=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(W,K),W.activeTexture.set(H.TEXTURE0),this.screenTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const re=[P.color.r,P.color.g,P.color.b,P.color.a],le=(ue,xe)=>{const me=En(this._movement.getPosition(),ue),Ee=P.dropletSizeX,Ie=P.dropletSizeX*P.dropletSizeYScale,Ae=s.width/2,Be=s.height/2,Re=Ds(0,P.screenThinning.start,0,1,P.screenThinning.intensity),Ve=Ds(.001,P.screenThinning.range,0,1,P.screenThinning.intensity),Fe=Ds(0,P.screenThinning.particleOffset,0,1,P.screenThinning.intensity),Me=(qe={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:P.velocityConeAperture,velocity:P.velocity,boxSize:ue,rainDropletSize:[Ee,Ie],distortionStrength:P.distortionStrength,rainDirection:O,color:re,screenSize:[Q.width,Q.height],thinningCenterPos:[Ae,Be],thinningShape:[Re,Ve,Math.pow(10,P.screenThinning.fadePower)],thinningAffectedRatio:P.screenThinning.affectedRatio,thinningParticleOffset:Fe,shapeDirectionalPower:P.shapeDirPower,shapeNormalPower:P.shapeNormalPower,mode:xe?0:1},{u_modelview:Float32Array.from(qe.modelview),u_projection:Float32Array.from(qe.projection),u_time:qe.time,u_cam_pos:qe.camPos,u_texScreen:0,u_velocityConeAperture:qe.velocityConeAperture,u_velocity:qe.velocity,u_boxSize:qe.boxSize,u_rainDropletSize:qe.rainDropletSize,u_distortionStrength:qe.distortionStrength,u_rainDirection:qe.rainDirection,u_color:qe.color,u_screenSize:qe.screenSize,u_thinningCenterPos:qe.thinningCenterPos,u_thinningShape:qe.thinningShape,u_thinningAffectedRatio:qe.thinningAffectedRatio,u_thinningParticleOffset:qe.thinningParticleOffset,u_shapeDirectionalPower:qe.shapeDirectionalPower,u_shapeNormalPower:qe.shapeNormalPower,u_mode:qe.mode});var qe;const ot=Math.round(P.intensity*this.particlesCount),rt=i.bf.simpleSegment(0,0,4*ot,2*ot);K.draw(s,H.TRIANGLES,Sr.disabled,Xr.disabled,pn.alphaBlended,qr.disabled,Me,"rain_particles",this.particlesVx,this.particlesIdx,rt)};P.distortionStrength>0&&le(P.boxSize,!0),le(P.boxSize,!1),this._vignette.draw(s,D)}}const Ku=i.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ww extends Yh{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new os(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const v=qw(this.particlesCount),w=new i.eN,P=new i.b0;let O=0;const D=i.eq(1323123451230);for(let z=0;z<v.length;++z){const W=v[z],H=D(),Q=D(),K=D(),re=[z/v.length,H,Q,K],le=[D(),D()];w.emplaceBack(W[0],W[1],W[2],-1,-1,...re,...le),w.emplaceBack(W[0],W[1],W[2],1,-1,...re,...le),w.emplaceBack(W[0],W[1],W[2],1,1,...re,...le),w.emplaceBack(W[0],W[1],W[2],-1,1,...re,...le),P.emplaceBack(O+0,O+1,O+2),P.emplaceBack(O+0,O+2,O+3),O+=4}this.particlesVx=h.createVertexBuffer(w,Ku.members),this.particlesIdx=h.createIndexBuffer(P)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const h=structuredClone(this._params);let v=[-h.direction.x,h.direction.y,-100];i.aw(v,v);const w=structuredClone(this._vignetteParams),P=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},O=s.transform.zoom;if(P.revealStart>O)return;const D=Ds(0,1,P.revealStart,P.revealStart+P.revealRange,O);w.strength*=D,h.overrideStyleParameters||(h.intensity=s.style.snow.state.density,h.timeFactor=s.style.snow.state.intensity,h.color=structuredClone(s.style.snow.state.color),v=structuredClone(s.style.snow.state.direction),h.screenThinning.intensity=s.style.snow.state.centerThinning,h.billboardSize=2.79*s.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(s.style.snow.state.vignetteColor));const z=this.updateOnRender(s,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const W=s.context,H=W.gl,Q=s.transform,K=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(W,K),((re,le,ue)=>{const xe=En(this._movement.getPosition(),re),me=Q.width/2,Ee=Q.height/2,Ie=Ds(0,ue.screenThinning.start,0,1,ue.screenThinning.intensity),Ae=Ds(.001,ue.screenThinning.range,0,1,ue.screenThinning.intensity),Be=Ds(0,ue.screenThinning.particleOffset,0,1,ue.screenThinning.intensity),Re=(Ve={modelview:z.modelviewMatrix,projection:z.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:xe,velocityConeAperture:ue.velocityConeAperture,velocity:ue.velocity,horizontalOscillationRadius:ue.horizontalOscillationRadius,horizontalOscillationRate:ue.horizontalOscillationRate,boxSize:re,billboardSize:1*ue.billboardSize,simpleShapeParameters:[ue.shapeFadeStart,ue.shapeFadePower],screenSize:[Q.width,Q.height],thinningCenterPos:[me,Ee],thinningShape:[Ie,Ae,Math.pow(10,ue.screenThinning.fadePower)],thinningAffectedRatio:ue.screenThinning.affectedRatio,thinningParticleOffset:Be,color:[ue.color.r,ue.color.g,ue.color.b,ue.color.a],direction:v},{u_modelview:Float32Array.from(Ve.modelview),u_projection:Float32Array.from(Ve.projection),u_time:Ve.time,u_cam_pos:Ve.camPos,u_velocityConeAperture:Ve.velocityConeAperture,u_velocity:Ve.velocity,u_horizontalOscillationRadius:Ve.horizontalOscillationRadius,u_horizontalOscillationRate:Ve.horizontalOscillationRate,u_boxSize:Ve.boxSize,u_billboardSize:Ve.billboardSize,u_simpleShapeParameters:Ve.simpleShapeParameters,u_screenSize:Ve.screenSize,u_thinningCenterPos:Ve.thinningCenterPos,u_thinningShape:Ve.thinningShape,u_thinningAffectedRatio:Ve.thinningAffectedRatio,u_thinningParticleOffset:Ve.thinningParticleOffset,u_particleColor:Ve.color,u_direction:Ve.direction});var Ve;const Fe=Math.round(ue.intensity*this.particlesCount),Me=i.bf.simpleSegment(0,0,4*Fe,2*Fe);this.particlesVx&&this.particlesIdx&&K.draw(s,H.TRIANGLES,Sr.disabled,Xr.disabled,pn.alphaBlended,qr.disabled,Re,"snow_particles",this.particlesVx,this.particlesIdx,Me)})(h.boxSize,0,h),this._vignette.draw(s,w)}}const Gw={symbol:function(y,s,h,v,w){if(y.renderPass!=="translucent")return;const P=Xr.disabled,O=y.colorModeForRenderPass(),D=h.layout.get("text-variable-anchor"),z=h.layout.get("text-size-scale-range"),W=i.aA(y.scaleFactor,z[0],z[1]);D&&function(K,re,le,ue,xe,me,Ee,Ie){const Ae=re.transform,Be=xe==="map",Re=me==="map";for(const Ve of K){const Fe=ue.getTile(Ve),Me=Fe.getBucket(le);if(!Me||!Me.text||!Me.text.segments.get().length)continue;const qe=i.bJ(Me.textSizeData,Ae.zoom,Ie),ot=Fv(Ve,Me.getProjection(),Ae),rt=Ae.calculatePixelsToTileUnitsMatrix(Fe),wt=Xf(ot,Fe.tileID.canonical,Re,Be,Ae,Me.getProjection(),rt),pt=Me.hasIconTextFit()&&Me.hasIconData();qe&&v_(Me,Be,Re,Ee,Ae,wt,Ve,Math.pow(2,Ae.zoom-Fe.tileID.overscaledZ),qe,pt)}}(v,y,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w,W);const H=h.paint.get("icon-opacity").constantOr(1)!==0,Q=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(H||Q)?qg(y,s,h,v,P,O):(H&&qg(y,s,h,v,P,O,{onlyIcons:!0}),Q&&qg(y,s,h,v,P,O,{onlyText:!0})),s.map.showCollisionBoxes&&(Vg(y,s,h,v,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Vg(y,s,h,v,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(y,s,h,v){if(y.renderPass!=="translucent")return;const w=h.paint.get("circle-opacity"),P=h.paint.get("circle-stroke-width"),O=h.paint.get("circle-stroke-opacity"),D=h.layout.get("circle-sort-key").constantOr(1)!==void 0,z=h.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(P.constantOr(1)===0||O.constantOr(1)===0))return;const W=y.context,H=W.gl,Q=y.transform,K=!(!y.terrain||!y.terrain.enabled),re=h.layout.get("circle-elevation-reference"),le=y.depthModeForSublayer(0,Sr.ReadOnly),ue=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),xe=re==="none"||K?le:ue,me=Xr.disabled,Ee=y.colorModeForDrapableLayerRenderPass(z),Ie=Q.projection.name==="globe",Ae=[i.aF(Q.center.lng),i.aJ(Q.center.lat)],Be=[];for(let Ve=0;Ve<v.length;Ve++){const Fe=v[Ve],Me=s.getTile(Fe),qe=Me.getBucket(h);if(!qe||qe.projection.name!==Q.projection.name)continue;const ot=qe.programConfigurations.get(h.id),rt=qe.layoutVertexBuffer,wt=qe.globeExtVertexBuffer,pt=qe.indexBuffer,Ot=i.d$(h),Kt=[wt],ht=y.isTileAffectedByFog(Fe);Ie&&Ot.push("PROJECTION_GLOBE_VIEW"),Ot.push("DEPTH_D24"),y.terrain&&Q.depthOcclusionForSymbolsAndCircles&&Ot.push("DEPTH_OCCLUSION"),qe.hasElevation&&!y.terrain&&(Ot.push("ELEVATED_ROADS"),Kt.push(qe.elevatedLayoutVertexBuffer));const et=y.getOrCreateProgram("circle",{config:ot,defines:Ot,overrideFog:ht}),It=Q.projection.createInversionMatrix(Q,Fe.canonical),mt={programConfiguration:ot,program:et,layoutVertexBuffer:rt,dynamicBuffers:Kt,indexBuffer:pt,uniformValues:i.e0(y,Fe,Me,It,Ae,h),tile:Me};if(D){const Lt=qe.segments.get();for(const Jt of Lt)Be.push({segments:new i.bf([Jt]),sortKey:Jt.sortKey,state:mt})}else Be.push({segments:qe.segments,sortKey:0,state:mt})}D&&Be.sort((Ve,Fe)=>Ve.sortKey-Fe.sortKey);const Re={useDepthForOcclusion:Q.depthOcclusionForSymbolsAndCircles};for(const Ve of Be){const{programConfiguration:Fe,program:Me,layoutVertexBuffer:qe,dynamicBuffers:ot,indexBuffer:rt,uniformValues:wt,tile:pt}=Ve.state,Ot=Ve.segments;y.terrain&&y.terrain.setupElevationDraw(pt,Me,Re),y.uploadCommonUniforms(W,Me,pt.tileID.toUnwrapped()),Me.draw(y,H.TRIANGLES,xe,me,Ee,qr.disabled,wt,h.id,qe,rt,Ot,h.paint,Q.zoom,Fe,ot)}},heatmap:function(y,s,h,v){if(h.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const w=y.context,P=w.gl,O=Xr.disabled,D=new pn([P.ONE,P.ONE,P.ONE,P.ONE],i.ao.transparent,[!0,!0,!0,!0]);(function(re,le,ue,xe){const me=re.gl,Ee=le.width*xe,Ie=le.height*xe;re.activeTexture.set(me.TEXTURE1),re.viewport.set([0,0,Ee,Ie]);let Ae=ue.heatmapFbo;if(!Ae||Ae&&(Ae.width!==Ee||Ae.height!==Ie)){Ae&&Ae.destroy();const Be=me.createTexture();me.bindTexture(me.TEXTURE_2D,Be),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Ae=ue.heatmapFbo=re.createFramebuffer(Ee,Ie,!0,null),function(Re,Ve,Fe,Me,qe,ot){const rt=Re.gl;rt.texImage2D(rt.TEXTURE_2D,0,Re.extRenderToTextureHalfFloat?rt.RGBA16F:rt.RGBA,qe,ot,0,rt.RGBA,Re.extRenderToTextureHalfFloat?rt.HALF_FLOAT:rt.UNSIGNED_BYTE,null),Me.colorAttachment.set(Fe)}(re,0,Be,Ae,Ee,Ie)}else me.bindTexture(me.TEXTURE_2D,Ae.colorAttachment.get()),re.bindFramebuffer.set(Ae.framebuffer)})(w,y,h,y.transform.projection.name==="globe"?.5:.25),w.clear({color:i.ao.transparent});const z=y.transform,W=z.projection.name==="globe",H=W?["PROJECTION_GLOBE_VIEW"]:[],Q=W?qr.frontCCW:qr.disabled,K=[i.aF(z.center.lng),i.aJ(z.center.lat)];for(let re=0;re<v.length;re++){const le=v[re];if(s.hasRenderableParent(le))continue;const ue=s.getTile(le),xe=ue.getBucket(h);if(!xe||xe.projection.name!==z.projection.name)continue;const me=y.isTileAffectedByFog(le),Ee=xe.programConfigurations.get(h.id),Ie=y.getOrCreateProgram("heatmap",{config:Ee,defines:H,overrideFog:me}),{zoom:Ae}=y.transform;y.terrain&&y.terrain.setupElevationDraw(ue,Ie),y.uploadCommonUniforms(w,Ie,le.toUnwrapped());const Be=z.projection.createInversionMatrix(z,le.canonical);Ie.draw(y,P.TRIANGLES,Sr.disabled,O,D,Q,IA(y,le,ue,Be,K,Ae,h.paint.get("heatmap-intensity")),h.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,h.paint,y.transform.zoom,Ee,W?[xe.globeExtVertexBuffer]:null)}w.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(w,P){const O=w.context,D=O.gl,z=P.heatmapFbo;if(!z)return;O.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,z.colorAttachment.get()),O.activeTexture.set(D.TEXTURE1);let W=P.colorRampTexture;W||(W=P.colorRampTexture=new i.T(O,P.colorRamp,D.RGBA8)),W.bind(D.LINEAR,D.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,D.TRIANGLES,Sr.disabled,Xr.disabled,w.colorModeForRenderPass(),qr.disabled,((H,Q,K,re)=>({u_image:0,u_color_ramp:1,u_opacity:Q.paint.get("heatmap-opacity")}))(0,P),P.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,P.paint,w.transform.zoom)}(y,h))},line:function(y,s,h,v){if(y.renderPass!=="translucent")return;const w=h.paint.get("line-opacity"),P=h.paint.get("line-width");if(w.constantOr(1)===0||P.constantOr(1)===0)return;const O=h.paint.get("line-emissive-strength"),D=h.paint.get("line-occlusion-opacity"),z=h.layout.get("line-elevation-reference"),W=h.layout.get("line-width-unit")==="meters",H=z==="sea",Q=!(!y.terrain||!y.terrain.enabled),K=y.context,re=K.gl;if(h.hasElevatedBuckets&&y.transform.projection.name==="globe")return;const le=h.layout.get("line-cross-slope"),ue=le!==void 0,xe=le<1,me=y.colorModeForDrapableLayerRenderPass(O),Ee=y.terrain&&y.terrain.renderingToTexture,Ie=Ee?1:i.o.devicePixelRatio,Ae=h.paint.get("line-dasharray"),Be=Ae.constantOr(1),Re=h.layout.get("line-cap"),Ve=Ae.constantOr(null),Fe=Re.constantOr(null),Me=h.paint.get("line-pattern"),qe=Me.constantOr(1),ot=h.paint.get("line-pattern-cross-fade"),rt=Me.constantOr(null),wt=h.paint.get("line-opacity").constantOr(1);let pt=!qe&&wt!==1||y.depthOcclusion&&D>0&&D<1;const Ot=h.paint.get("line-gradient"),Kt=qe?"linePattern":"line",ht=i.e1(h);let et;if(Ee&&y.terrain&&y.terrain.clipOrMaskOverlapStencilType()&&(pt=!1),D!==0&&y.depthOcclusion){const Jt=h.paint._values["line-opacity"];Jt&&Jt.value&&Jt.value.kind==="constant"?et=Jt.value:i.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}P.value.kind!=="constant"&&P.value.isLineProgressConstant===!1&&ht.push("VARIABLE_LINE_WIDTH");const It=(Jt,yr,Wt,Xt,br,hr)=>{for(const cr of Jt){const fr=s.getTile(cr);if(qe&&!fr.patternsLoaded())continue;const Nr=fr.getBucket(h);if(!Nr||Nr.elevationType!=="none"&&!br||Nr.elevationType==="none"&&br)continue;y.prepareDrawTile();const Tn=[...yr],Nn=y.shadowRenderer,pi=Nr.elevationType==="road"&&!!Nn&&Nn.enabled;let Wr=[0,0,0];if(pi){const Hr=y.style.directionalLight,Ln=y.style.ambientLight;Hr&&Ln&&(Wr=tc(y.style,Hr,Ln)),Tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const jn=Nr.programConfigurations.get(h.id);let on=!1;if(rt&&fr.imageAtlas){const Hr=i.e2.from(rt),Ln=Hr.getPrimary().scaleSelf(Ie).toString(),Xi=fr.imageAtlas.patternPositions.get(Ln),xa=Hr.getSecondary(),ta=xa?fr.imageAtlas.patternPositions.get(xa.scaleSelf(Ie).toString()):null;on=!!Xi&&!!ta,Xi&&jn.setConstantPatternPositions(Xi,ta)}ot>0&&(on||jn.getPatternTransitionVertexBuffer("line-pattern"))&&Tn.push("LINE_PATTERN_TRANSITION");const oi=y.isTileAffectedByFog(cr),Mn=y.getOrCreateProgram(Kt,{config:jn,defines:Tn,overrideFog:oi});if(!qe&&Ve&&Fe&&fr.lineAtlas){const Hr=fr.lineAtlas.getDash(Ve,Fe);Hr&&jn.setConstantPatternPositions(Hr)}pi&&Nn.setupShadows(fr.tileID.toUnwrapped(),Mn,"vector-tile");let[Ti,Un]=h.paint.get("line-trim-offset");(Fe==="round"||Fe==="square")&&Ti!==Un&&(Ti===0&&(Ti-=1),Un===1&&(Un+=1));const ln=Ee?cr.projMatrix:null,Xn=W?1/Nr.tileToMeter/i.ay(fr,1,y.transform.zoom):1,mn=W?1/Nr.tileToMeter/i.ay(fr,1,Math.floor(y.transform.zoom)):1,Ni=qe?i.e3(y,fr,h,ln,Ie,Xn,mn,[Ti,Un],Wr,ot):i.e4(y,fr,h,ln,Nr.lineClipsArray.length,Ie,Xn,mn,[Ti,Un],Wr);if(Ot){const Hr=Nr.gradients[h.id];let Ln=Hr.texture;if(h.gradientVersion!==Hr.version){let Xi=256;if(h.stepInterpolant){const xa=s.getSource().maxzoom,ta=cr.canonical.z===xa?Math.ceil(1<<y.transform.maxZoom-cr.canonical.z):1;Xi=i.aA(i.e5(Nr.maxLineLength/i.al*1024*ta),256,K.maxTextureSize)}Hr.gradient=i.e6({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:Xi,image:Hr.gradient||void 0,clips:Nr.lineClipsArray}),Hr.texture?Hr.texture.update(Hr.gradient):Hr.texture=new i.T(K,Hr.gradient,re.RGBA8),Hr.version=h.gradientVersion,Ln=Hr.texture}K.activeTexture.set(re.TEXTURE1),Ln.bind(h.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}Be&&(K.activeTexture.set(re.TEXTURE0),fr.lineAtlasTexture&&fr.lineAtlasTexture.bind(re.LINEAR,re.REPEAT),jn.updatePaintBuffers()),qe&&(K.activeTexture.set(re.TEXTURE0),fr.imageAtlasTexture&&fr.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),jn.updatePaintBuffers()),br&&!H&&y.terrain.setupElevationDraw(fr,Mn),y.uploadCommonUniforms(K,Mn,cr.toUnwrapped());const ti=Hr=>{et!=null&&(et.value=wt*D),Mn.draw(y,re.TRIANGLES,Wt,Hr,me,qr.disabled,Ni,h.id,Nr.layoutVertexBuffer,Nr.indexBuffer,Nr.segments,h.paint,y.transform.zoom,jn,[Nr.layoutVertexBuffer2,Nr.patternVertexBuffer,Nr.zOffsetVertexBuffer]),et!=null&&(et.value=wt)};if(pt&&!br){const Hr=y.stencilModeForClipping(cr).ref;Hr===0&&Ee&&K.clear({stencil:0});const Ln={func:re.EQUAL,mask:255};Ni.u_alpha_discard_threshold=.8,ti(new Xr(Ln,Hr,255,re.KEEP,re.KEEP,re.INVERT)),Ni.u_alpha_discard_threshold=0,ti(new Xr(Ln,Hr,255,re.KEEP,re.KEEP,re.KEEP))}else Ni.u_alpha_discard_threshold=pt&&br&&hr?.8:0,ti(br?Xt:y.stencilModeForClipping(cr))}};let mt=y.depthModeForSublayer(0,Sr.ReadOnly);const Lt=new Sr(y.depthOcclusion?re.GREATER:re.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Jt=!Ee&&y.terrain;D!==0&&Jt?i.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Jt?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):It(v,ht,mt,Xr.disabled,!1,!0)}if(h.hasElevatedBuckets){z==="hd-road-markup"?Q||(mt=Lt,ht.push("ELEVATED_ROADS")):(ht.push("ELEVATED"),mt=Lt,ue&&ht.push(xe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),H&&ht.push("ELEVATION_REFERENCE_SEA"));const Jt=pt?y.stencilModeFor3D():Xr.disabled;y.forceTerrainMode=!0,It(v,ht,mt,Jt,!0,!0),pt&&It(v,ht,mt,Jt,!0,!1),y.forceTerrainMode=!1}pt&&(y.resetStencilClippingMasks(),Ee&&K.clear({stencil:0})),D===0||y.depthOcclusion||Ee||y.layersWithOcclusionOpacity.push(y.currentLayer)},fill:function(y,s,h,v){const w=h.paint.get("fill-color"),P=h.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const O=h.paint.get("fill-emissive-strength"),D=y.colorModeForDrapableLayerRenderPass(O),z=h.paint.get("fill-pattern"),W=y.opaquePassEnabledForLayer()&&!z.constantOr(1)&&w.constantOr(i.ao.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";let H="none";h.layout.get("fill-elevation-reference")!=="none"?H="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(H="offset");const Q=!(!y.terrain||!y.terrain.enabled),K={painter:y,sourceCache:s,layer:h,coords:v,colorMode:D,elevationType:H,terrainEnabled:Q,pass:W};if(y.renderPass!=="shadow")if(H!=="offset"){if(mp(K,!1),H==="road"){const re=!Q&&y.renderPass==="translucent";re&&Kh(y,s,h,v,"geometry"),mp(K,!0,Xr.disabled),re&&function(le){const{painter:ue,sourceCache:xe,layer:me,coords:Ee,colorMode:Ie}=le,Ae=ue.context.gl,Be=le.painter.shadowRenderer,Re=!!Be&&Be.enabled,Ve=new Sr(ue.context.gl.LEQUAL,Sr.ReadOnly,ue.depthRangeFor3D);let Fe=[0,0,0];if(Re){const qe=ue.style.directionalLight,ot=ue.style.ambientLight;qe&&ot&&(Fe=tc(ue.style,qe,ot))}const Me=qe=>{for(const ot of Ee){const rt=xe.getTile(ot),wt=rt.getBucket(me);if(!wt)continue;const pt=wt.elevatedStructures;if(!pt)continue;let Ot,Kt;if(qe?(Ot=pt.renderableBridgeSegments,Kt=pt.bridgeProgramConfigurations.get(me.id)):(Ot=pt.renderableTunnelSegments,Kt=pt.tunnelProgramConfigurations.get(me.id)),!Ot||Ot.segments[0].primitiveLength===0)continue;Kt.updatePaintBuffers(),ue.prepareDrawTile();const ht=ue.isTileAffectedByFog(ot),et=[];Re&&et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const It=ue.getOrCreateProgram("elevatedStructures",{config:Kt,overrideFog:ht,defines:et}),mt=ue.translatePosMatrix(ot.projMatrix,rt,me.paint.get("fill-translate"),me.paint.get("fill-translate-anchor"));Re&&Be.setupShadows(rt.tileID.toUnwrapped(),It,"vector-tile");const Lt=nj(mt,Fe);ue.uploadCommonUniforms(ue.context,It,ot.toUnwrapped()),It.draw(ue,Ae.TRIANGLES,Ve,Xr.disabled,Ie,qr.backCCW,Lt,me.id,pt.vertexBuffer,pt.indexBuffer,Ot,me.paint,ue.transform.zoom,Kt,[pt.vertexBufferNormal])}};Me(!0),Me(!1)}(K)}}else mp(K,!1,y.stencilModeFor3D());else y.shadowRenderer&&H==="road"&&!Q&&function(re){const{painter:le,sourceCache:ue,layer:xe,coords:me}=re,Ee=le.context.gl,Ie=re.painter.shadowRenderer;for(const Ae of me){const Be=ue.getTile(Ae),Re=Be.getBucket(xe);if(!Re)continue;const Ve=Re.elevatedStructures;if(!Ve||!Ve.shadowCasterSegments||Ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;le.prepareDrawTile();const Fe=Re.bufferData.programConfigurations.get(xe.id),Me=le.isTileAffectedByFog(Ae),qe=le.getOrCreateProgram("elevatedStructuresDepth",{config:Fe,overrideFog:Me}),ot=Ie.calculateShadowPassMatrixFromTile(Be.tileID.toUnwrapped());le.uploadCommonUniforms(le.context,qe,Ae.toUnwrapped());const rt={u_matrix:ot,u_depth_bias:0};qe.draw(le,Ee.TRIANGLES,Ie.getShadowPassDepthMode(),Xr.disabled,Ie.getShadowPassColorMode(),qr.disabled,rt,xe.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.shadowCasterSegments,xe.paint,le.transform.zoom,Fe)}}(K)},"fill-extrusion":function(y,s,h,v){const w=h.paint.get("fill-extrusion-opacity"),P=y.context,O=P.gl,D=y.terrain,z=D&&D.renderingToTexture;if(w===0)return;const W=y.conflationActive&&y.style.isLayerClipped(h,s.getSource()),H=y.style.order.indexOf(h.fqid);if(W&&function(Q,K,re,le,ue){for(const xe of le){const me=K.getTile(xe).getBucket(re);me&&(me.updateReplacement(xe,Q.replacementSource,ue),me.uploadCentroid(Q.context))}}(y,s,h,v,H),D||W)for(const Q of v){const K=s.getTile(Q).getBucket(h);K&&qd(y.context,s,Q,K,h,D,W)}if(y.renderPass==="shadow"&&y.shadowRenderer){const Q=y.shadowRenderer;if(D&&w<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ad)return;const K=Q.getShadowPassDepthMode(),re=Q.getShadowPassColorMode();gr(y,s,h,v,K,Xr.disabled,re,W)}else if(y.renderPass==="translucent"){const Q=!h.paint.get("fill-extrusion-pattern").constantOr(1),K=h.paint.get("fill-extrusion-color").constantOr(i.ao.white);if(!z&&K.a!==0){const re=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D);w===1&&Q?gr(y,s,h,v,re,Xr.disabled,pn.unblended,W):(gr(y,s,h,v,re,Xr.disabled,pn.disabled,W),gr(y,s,h,v,re,y.stencilModeFor3D(),y.colorModeForRenderPass(),W),y.resetStencilClippingMasks())}if(y.style.enable3dLights()&&Q&&(!D&&y.transform.projection.name!=="globe"||z)){const re=h.paint.get("fill-extrusion-opacity"),le=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ue=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),xe=h.paint.get("fill-extrusion-flood-light-intensity"),me=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ee=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(me?null:h.lut).toArray01().slice(0,3),Ie=le>0&&ue>0,Ae=xe>0,Be=(Fe,Me,qe)=>(1-qe)*Fe+qe*Me,Re=new kw;Re.translate=h.paint.get("fill-extrusion-translate"),Re.translateAnchor=h.paint.get("fill-extrusion-translate-anchor"),Re.edgeRadius=h.layout.get("fill-extrusion-edge-radius"),Re.cutoffFadeRange=h.paint.get("fill-extrusion-cutoff-fade-range");const Ve=Fe=>{const Me=y.depthModeForSublayer(1,Sr.ReadOnly,O.LEQUAL,!0),qe=h.paint.get(Fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ot=Be(.1,3,qe),rt=y._showOverdrawInspector;if(!rt){const wt=new Xr({func:O.ALWAYS,mask:255},255,255,O.KEEP,O.KEEP,O.REPLACE),pt=new pn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0],O.MIN);Gu(Re,y,s,h,v,Me,wt,pt,qr.disabled,Fe,"sdf",re,le,ue,xe,Ee,ot,W,!1)}{const wt=rt?Xr.disabled:new Xr({func:O.EQUAL,mask:255},255,255,O.KEEP,O.DECR,O.DECR),pt=rt?y.colorModeForRenderPass():new pn([O.ONE_MINUS_DST_ALPHA,O.DST_ALPHA,O.ONE,O.ONE],i.ao.transparent,[!0,!0,!0,!0]);Gu(Re,y,s,h,v,Me,wt,pt,qr.disabled,Fe,"color",re,le,ue,xe,Ee,ot,W,!1)}};if(z){const Fe=(Me,qe,ot)=>{const rt=y.depthModeForSublayer(1,Sr.ReadOnly,O.LEQUAL,!1),wt=h.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),pt=Be(.1,3,wt);{const Ot=new pn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0]);Gu(Re,y,s,h,v,rt,Xr.disabled,Ot,qr.disabled,Me,"clear",re,le,ue,xe,Ee,pt,W,qe)}{const Ot=new Xr({func:O.ALWAYS,mask:255},255,255,O.KEEP,O.KEEP,O.REPLACE),Kt=new pn([O.ONE,O.ONE,O.ONE,O.ONE],i.ao.transparent,[!1,!1,!1,!0],O.MIN);Gu(Re,y,s,h,v,rt,Ot,Kt,qr.disabled,Me,"sdf",re,le,ue,xe,Ee,pt,W,qe)}{const Ot=Me?O.ZERO:O.ONE_MINUS_DST_ALPHA,Kt=new Xr({func:O.EQUAL,mask:255},255,255,O.KEEP,O.DECR,O.DECR),ht=new pn([Ot,O.DST_ALPHA,O.ONE_MINUS_DST_ALPHA,O.ZERO],i.ao.transparent,[!0,!0,!0,!0]);Gu(Re,y,s,h,v,rt,Kt,ht,qr.disabled,Me,"color",re,le,ue,xe,Ee,pt,W,qe)}{const Ot=new pn([O.ONE,O.ONE,O.ONE,Me?O.ZERO:O.ONE],i.ao.transparent,[!1,!1,!1,!0],Me?O.FUNC_ADD:O.MAX);Gu(Re,y,s,h,v,rt,Xr.disabled,Ot,qr.disabled,Me,"clear",re,le,ue,xe,Ee,pt,W,qe,ot)}};if(Ie||Ae){let Me;if(y.prepareDrawTile(),D){const qe=D.drapeBufferSize[0],ot=D.drapeBufferSize[1];Me=D.framebufferCopyTexture,Me&&(!Me||Me.size[0]===qe&&Me.size[1]===ot)||(Me&&Me.destroy(),Me=D.framebufferCopyTexture=new i.T(P,new i.q({width:qe,height:ot}),O.RGBA8)),Me.bind(O.LINEAR,O.CLAMP_TO_EDGE),O.copyTexSubImage2D(O.TEXTURE_2D,0,0,0,0,0,qe,ot)}Ie&&Fe(!0,!1,Me),Ae&&Fe(!1,!0,Me)}}else Ie&&Ve(!0),Ae&&Ve(!1),(Ie||Ae)&&y.resetStencilClippingMasks()}}},building:function(y,s,h,v){y.currentLayer<y.firstLightBeamLayer&&(y.firstLightBeamLayer=y.currentLayer);const w=h.paint.get("building-ambient-occlusion-ground-intensity"),P=h.paint.get("building-ambient-occlusion-ground-radius"),O=h.paint.get("building-ambient-occlusion-ground-attenuation"),D=h.paint.get("building-opacity");if(D<=0)return;let z=w>0&&P>0,W=!0;const H=h.paint.get("building-vertical-scale");if(H<=0)return;(!y.shadowRenderer||H<1)&&(W=!1);const Q=y.conflationActive&&y.style.isLayerClipped(h,s.getSource()),K=y.style.order.indexOf(h.fqid);if(function(re,le,ue,xe,me,Ee){for(const Ie of Ee){const Ae=le.getTile(Ie).getBucket(ue);Ae&&(me&&Ae.updateReplacement(Ie,re.replacementSource,xe),Ae.uploadUpdatedIndexBuffer(re.context))}}(y,s,h,K,Q,v),function(re,le,ue,xe){for(const me of xe){const Ee=le.getTile(me).getBucket(ue);Ee&&Ee.needsEvaluation()&&Ee.uploadUpdatedColorBuffer(re.context)}}(y,s,h,v),h.resetLayerRenderingStats(y),y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!0),y.renderPass==="shadow"&&y.shadowRenderer){const re=y.shadowRenderer,le=[],ue=re.getShadowPassDepthMode();x_({painter:y,source:s,layer:h,coords:v,defines:le,blendMode:re.getShadowPassColorMode(),depthMode:ue,opacity:D,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(y.renderPass==="translucent"){let re=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];W&&(re=re.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),y.shadowRenderer&&y.shadowRenderer.useNormalOffset&&(re=re.concat("NORMAL_OFFSET"));const le=h.paint.get("building-facade-emissive-chance"),ue=h.paint.get("building-ambient-occlusion-intensity"),xe=h.paint.get("building-flood-light-intensity"),me=h.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Ee=h.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(me?null:h.lut).toArray01().slice(0,3),Ie=h.paint.get("building-flood-light-ground-attenuation"),Ae=xe>0,Be=new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D);D<1&&x_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:pn.disabled,depthMode:Be,opacity:D,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:xe,floodLightColor:Ee,depthOnly:!0});const Re=y.colorModeForRenderPass();x_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:Re,depthMode:Be,opacity:D,verticalScale:H,facadeEmissiveChance:le,facadeAOIntensity:ue,floodLightIntensity:xe,floodLightColor:Ee}),z&&b_(y,s,h,v,!0,D,w,P,xe,Ee,O,Q),Ae&&b_(y,s,h,v,!1,D,w,P,xe,Ee,Ie,Q)}else if(y.renderPass==="light-beam"){const re=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],le=new Sr(y.context.gl.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);x_({painter:y,source:s,layer:h,coords:v,defines:re,blendMode:pn.alphaBlended,depthMode:le,opacity:D,verticalScale:H,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}y.shadowRenderer&&(y.shadowRenderer.useNormalOffset=!1),y.resetStencilClippingMasks()},hillshade:function(y,s,h,v){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent"||y.style.disableElevatedTerrain)return;const w=y.context,P=y.terrain&&y.terrain.renderingToTexture,[O,D]=y.renderPass!=="translucent"||P?[{},v]:y.stencilConfigForOverlap(v);for(const z of D){const W=s.getTile(z);if(W.needsHillshadePrepare&&y.renderPass==="offscreen")GR(y,W,h);else if(y.renderPass==="translucent"){const H=y.depthModeForSublayer(0,Sr.ReadOnly),Q=h.paint.get("hillshade-emissive-strength"),K=y.colorModeForDrapableLayerRenderPass(Q),re=P&&y.terrain?y.terrain.stencilModeForRTTOverlap(z):O[z.overscaledZ];WR(y,z,W,h,H,re,K)}}w.viewport.set([0,0,y.width,y.height]),y.resetStencilClippingMasks()},raster:function(y,s,h,v,w,P){if(y.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const O=y.transform.projection.name==="globe",D=h.paint.get("raster-elevation")!==0,z=D&&O;if(y.renderElevatedRasterBackface&&!z)return;const W=y.context,H=W.gl,Q=s.getSource(),K=function(Re,Ve,Fe,Me){const qe=Ve.paint.get("raster-color"),ot=Re.type==="raster-array",rt=[],wt=Ve.paint.get("raster-resampling"),pt=Ve.paint.get("raster-color-mix");let Ot=Ve.paint.get("raster-color-range");const Kt=[pt[0],pt[1],pt[2],0],ht=pt[3];let et=wt==="nearest"?Me.NEAREST:Me.LINEAR;if(ot&&(rt.push("RASTER_ARRAY"),qe||rt.push("RASTER_COLOR"),wt==="linear"&&rt.push("RASTER_ARRAY_LINEAR"),et=Me.NEAREST,!Ot&&Re.rasterLayers)){const It=Re.rasterLayers.find(({id:mt})=>mt===Ve.sourceLayer);It&&It.fields&&It.fields.range&&(Ot=It.fields.range)}if(Ot=Ot||[0,1],qe){rt.push("RASTER_COLOR"),Fe.activeTexture.set(Me.TEXTURE2),Ve.updateColorRamp(Ot);let It=Ve.colorRampTexture;It||(It=Ve.colorRampTexture=new i.T(Fe,Ve.colorRamp,Me.RGBA8)),It.bind(Me.LINEAR,Me.CLAMP_TO_EDGE)}return{mix:Kt,range:Ot,offset:ht,defines:rt,resampling:et}}(Q,h,W,H);if(Q instanceof i.aT&&!v.length&&!O)return;const re=h.paint.get("raster-emissive-strength"),le=y.colorModeForDrapableLayerRenderPass(re),ue=y.terrain&&y.terrain.renderingToTexture,xe=!y.options.moving,me=h.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR;if(Q instanceof i.aT&&!v.length&&(Q.onNorthPole||Q.onSouthPole)){const Re=D?y.stencilModeFor3D():Xr.disabled;return void Nw(!!Q.onNorthPole,null,y,s,h,re,K,qr.disabled,Re)}if(!v.length)return;const[Ee,Ie]=Q instanceof i.aT||ue?[{},v]:y.stencilConfigForOverlap(v),Ae=Ie[Ie.length-1].overscaledZ;z&&K.defines.push("PROJECTION_GLOBE_VIEW"),D&&K.defines.push("RENDER_CUTOFF");const Be=(Re,Ve,Fe)=>{for(const Me of Re){const qe=Me.toUnwrapped(),ot=s.getTile(Me);if(ue&&(!ot||!ot.hasData()))continue;W.activeTexture.set(H.TEXTURE0);const rt=oj(ot,Q,h,K);if(!rt||!rt.texture)continue;const{texture:wt,mix:pt,offset:Ot,tileSize:Kt,buffer:ht}=rt;let et,It;ue?(et=Sr.disabled,It=Me.projMatrix):D?(et=new Sr(H.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D),It=O?Float32Array.from(y.transform.expandedFarZProjMatrix):y.transform.calculateProjMatrix(qe,xe)):(et=y.depthModeForSublayer(Me.overscaledZ-Ae,h.paint.get("raster-opacity")===1?Sr.ReadWrite:Sr.ReadOnly,H.LESS),It=y.transform.calculateProjMatrix(qe,xe));const mt=y.terrain&&ue?y.terrain.stencilModeForRTTOverlap(Me):Ee[Me.overscaledZ],Lt=P?0:h.paint.get("raster-fade-duration");ot.registerFadeDuration(Lt);const Jt=s.findLoadedParent(Me,0),yr=i_(ot,Jt,s,y.transform,Lt);let Wt,Xt;!yr.isFading&&ot.refreshedUponExpiration&&(ot.refreshedUponExpiration=!1),y.terrain&&y.terrain.prepareDrawTile(),W.activeTexture.set(H.TEXTURE0),wt.bind(me,H.CLAMP_TO_EDGE),W.activeTexture.set(H.TEXTURE1),Jt?(Jt.texture&&Jt.texture.bind(me,H.CLAMP_TO_EDGE),Wt=Math.pow(2,Jt.tileID.overscaledZ-ot.tileID.overscaledZ),Xt=[ot.tileID.canonical.x*Wt%1,ot.tileID.canonical.y*Wt%1]):wt.bind(me,H.CLAMP_TO_EDGE),"useMipmap"in wt&&W.extTextureFilterAnisotropic&&y.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const br=y.transform;let hr;const cr=D?NA(br):[0,0,0,0];let fr,Nr,Tn,Nn,pi,Wr=0;if(z&&Q instanceof i.aT&&Q.coordinates.length>3)fr=Float32Array.from(i.bj(i.dI(new i.cC(0,0,0)))),Nr=Float32Array.from(br.globeMatrix),Tn=Float32Array.from(i.dE(br)),Nn=[i.aF(br.center.lng),i.aJ(br.center.lat)],hr=Q.elevatedGlobePerspectiveTransform,pi=Q.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const Mn=i.dF(Me.canonical);Wr=i.dG(Mn.getCenter().lat),fr=Float32Array.from(i.bj(i.dI(Me.canonical))),Nr=Float32Array.from(br.globeMatrix),Tn=Float32Array.from(i.dE(br)),Nn=[i.aF(br.center.lng),i.aJ(br.center.lat)],hr=[0,0],pi=Float32Array.from(i.dH(Me.canonical,Mn,Wr,br.worldSize/br._pixelsPerMercatorPixel))}else hr=Q instanceof i.aT?Q.perspectiveTransform:[0,0],fr=new Float32Array(16),Nr=new Float32Array(9),Tn=new Float32Array(16),Nn=[0,0],pi=new Float32Array(9);const jn=Ug(It,fr,Nr,Tn,pi,Xt||[0,0],i.aj(y.transform.zoom),Nn,cr,Wt||1,yr,h,hr,D?h.paint.get("raster-elevation"):0,2,pt,Ot,K.range,Kt,ht,re),on=y.isTileAffectedByFog(Me),oi=y.getOrCreateProgram("raster",{defines:K.defines,overrideFog:on});if(y.uploadCommonUniforms(W,oi,qe),Q instanceof i.aT){const Mn=Q.elevatedGlobeVertexBuffer,Ti=Q.elevatedGlobeIndexBuffer;if(ue||!O)Q.boundsBuffer&&Q.boundsSegments&&oi.draw(y,H.TRIANGLES,et,Xr.disabled,le,qr.disabled,jn,h.id,Q.boundsBuffer,y.quadTriangleIndexBuffer,Q.boundsSegments);else if(Mn&&Ti){const Un=br.zoom<=i.cZ?Q.elevatedGlobeSegments:Q.getSegmentsForLongitude(br.center.lng);Un&&oi.draw(y,H.TRIANGLES,et,Xr.disabled,le,Ve,jn,h.id,Mn,Ti,Un)}}else if(z){et=new Sr(H.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D);const Mn=y.globeSharedBuffers;if(Mn){const[Ti,Un,ln]=Mn.getGridBuffers(Wr,!1);oi.draw(y,H.TRIANGLES,et,Fe||mt,y.colorModeForRenderPass(),Ve,jn,h.id,Ti,Un,ln)}}else{const{tileBoundsBuffer:Mn,tileBoundsIndexBuffer:Ti,tileBoundsSegments:Un}=y.getTileBoundsBuffers(ot);oi.draw(y,H.TRIANGLES,et,mt,le,qr.disabled,jn,h.id,Mn,Ti,Un)}}if(!(Q instanceof i.aT)&&z)for(const Me of Re){const qe=Me.canonical.y===(1<<Me.canonical.z)-1;Me.canonical.y===0&&Nw(!0,Me,y,s,h,re,K,Ve,Fe||Xr.disabled),qe&&Nw(!1,Me,y,s,h,re,K,Ve===qr.frontCW?qr.backCW:qr.frontCW,Fe||Xr.disabled)}};z?Be(Ie,y.renderElevatedRasterBackface?qr.backCW:qr.frontCW,y.stencilModeFor3D()):Be(Ie,qr.disabled,void 0),y.resetStencilClippingMasks()},"raster-particle":function(y,s,h,v,w,P){y.renderPass==="offscreen"&&function(O,D,z,W){if(!W.length)return;const H=O.context,Q=H.gl,K=D.getSource();if(!(K instanceof so))return;const re=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let le=z.particlePositionRGBAImage;if(!le||le.width!==re){const Ie=function(Ae){const Be=Ae*Ae,Re=new Uint8Array(4*Be),Ve=function(Me){return Me|=0,Me=Math.imul(2747636419^Me,2654435769),Me=Math.imul(Me^Me>>>16,2654435769),((Me=Math.imul(Me^Me>>>16,2654435769))>>>0)/4294967296},Fe=1/1.1;for(let Me=0;Me<Be;Me++){const qe=Fe*(Ve(2*Me+0)+Hh),ot=Fe*(Ve(2*Me+1)+Hh),rt=255*qe%1,wt=255*ot%1,pt=rt,Ot=ot-wt/255,Kt=wt;Re[4*Me+0]=255*(qe-rt/255),Re[4*Me+1]=255*pt,Re[4*Me+2]=255*Ot,Re[4*Me+3]=255*Kt}return Re}(re);le=z.particlePositionRGBAImage=new i.q({width:re,height:re},Ie)}let ue=z.particleFramebuffer;ue?ue.width!==re&&(ue.destroy(),ue=z.particleFramebuffer=H.createFramebuffer(re,re,!0,null)):ue=z.particleFramebuffer=H.createFramebuffer(re,re,!0,null);const xe=[];for(const Ie of W){const Ae=D.getTile(Ie);if(!(Ae instanceof Ld))continue;const Be=Mw(Ae,K,z);if(!Be)continue;const Re=[Ae.tileSize,Ae.tileSize];let Ve=z.tileFramebuffer;Ve||(Ve=z.tileFramebuffer=H.createFramebuffer(Re[0],Re[1],!0,null));let Fe=Ae.rasterParticleState;Fe||(Fe=Ae.rasterParticleState=new Js(H,Ie,Re,le));const Me=Fe.update(z.lastInvalidatedAt);Fe.particleTextureDimension!==re&&Fe.updateParticleTexture(Ie,le);const qe=Fe.targetColorTexture;Fe.targetColorTexture=Fe.backgroundColorTexture,Fe.backgroundColorTexture=qe;const ot=Fe.particleTexture0;Fe.particleTexture0=Fe.particleTexture1,Fe.particleTexture1=ot,xe.push([Ie,Be,Fe,Me])}if(xe.length===0)return;const me=i.o.now(),Ee=z.previousDrawTimestamp?.001*(me-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=me,z.hasColorMap()){H.activeTexture.set(Q.TEXTURE0+2);let Ie=z.colorRampTexture;Ie||(Ie=z.colorRampTexture=new i.T(H,z.colorRamp,Q.RGBA8)),Ie.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}H.bindFramebuffer.set(z.tileFramebuffer.framebuffer),function(Ie,Ae,Be){const Re=Ie.context,Ve=Re.gl,Fe=Ae.tileFramebuffer;Re.activeTexture.set(Ve.TEXTURE0);const Me={u_texture:0,u_opacity:1.05*(ot=Ae.paint.get("raster-particle-fade-opacity-factor"))/(ot+.05)},qe=Ie.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ot;for(const rt of Be){const[,,wt,pt]=rt;Fe.colorAttachment.set(wt.targetColorTexture.texture),Re.viewport.set([0,0,Fe.width,Fe.height]),Re.clear({color:i.ao.transparent}),pt&&(wt.backgroundColorTexture.bind(Ve.NEAREST,Ve.CLAMP_TO_EDGE),qe.draw(Ie,Ve.TRIANGLES,Sr.disabled,Xr.disabled,pn.alphaBlended,qr.disabled,Me,Ae.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments))}}(O,z,xe),function(Ie,Ae,Be,Re){const Ve=Ie.context,Fe=Ve.gl,Me=Be.tileFramebuffer,qe=Ie.transform.projection.name==="globe",ot=Be.paint.get("raster-particle-max-speed");for(const rt of Re){const[wt,pt,Ot]=rt;Ve.activeTexture.set(Fe.TEXTURE0+0),pt.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Me.colorAttachment.set(Ot.targetColorTexture.texture);const Kt=Ie.getOrCreateProgram("rasterParticleDraw",{defines:pt.defines,overrideFog:!1});Ve.activeTexture.set(Fe.TEXTURE0+1);const ht=pt.scalarData?[]:[0,1,2,3].map(mt=>i.e8[mt](wt));ht.push(wt);const et=wt.canonical.x,It=wt.canonical.y;for(const mt of ht){const Lt=Ae.getTile(qe?mt.wrapped():mt);if(!Lt)continue;const Jt=Lt.rasterParticleState;if(!Jt)continue;const yr=mt.canonical.x+(1<<mt.canonical.z)*(mt.wrap-wt.wrap),Wt=mt.canonical.y;Jt.particleTexture0.bind(Fe.NEAREST,Fe.CLAMP_TO_EDGE);const Xt=Aw(1,Jt.particleTexture0.size[0],[yr-et,Wt-It],0,pt.texture.size,2,ot,pt.textureOffset,pt.scale,pt.offset);Kt.draw(Ie,Fe.POINTS,Sr.disabled,Xr.disabled,pn.alphaBlended,qr.disabled,Xt,Be.id,Jt.particleIndexBuffer,void 0,Jt.particleSegment)}}}(O,D,z,xe),H.bindFramebuffer.set(z.particleFramebuffer.framebuffer),function(Ie,Ae,Be,Re){const Ve=Ie.context,Fe=Ve.gl,Me=Ae.paint.get("raster-particle-max-speed"),qe=Re*Ae.paint.get("raster-particle-speed-factor")*.15,ot=function(wt){return Math.pow(wt,6)}(.01+1*Ae.paint.get("raster-particle-reset-rate-factor")),rt=Ae.particleFramebuffer;Ve.viewport.set([0,0,rt.width,rt.height]);for(const wt of Be){const[,pt,Ot]=wt;Ve.activeTexture.set(Fe.TEXTURE0+0),pt.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Ve.activeTexture.set(Fe.TEXTURE0+1);const Kt=Ot.particleTexture0;Kt.bind(Fe.NEAREST,Fe.CLAMP_TO_EDGE);const ht=d_(1,Kt.size[0],0,pt.texture.size,Me,qe,ot,pt.textureOffset,pt.scale,pt.offset);rt.colorAttachment.set(Ot.particleTexture1.texture),Ve.clear({color:i.ao.transparent}),Ie.getOrCreateProgram("rasterParticleUpdate",{defines:pt.defines}).draw(Ie,Fe.TRIANGLES,Sr.disabled,Xr.disabled,pn.unblended,qr.disabled,ht,Ae.id,Ie.viewportBuffer,Ie.quadTriangleIndexBuffer,Ie.viewportSegments)}}(O,z,xe,Ee)}(y,s,h,v),y.renderPass==="translucent"&&(function(O,D,z,W,H){const Q=O.context,K=Q.gl,re=D.getSource().tileSize,le=5*(1-i.ah(i.cK,i.cK+1,O.transform.zoom))*re+z.paint.get("raster-particle-elevation"),ue=!O.options.moving,xe=O.transform.projection.name==="globe";if(!W.length)return;const[me,Ee]=O.stencilConfigForOverlap(W),Ie=[];xe&&Ie.push("PROJECTION_GLOBE_VIEW");const Ae=O.stencilModeFor3D();for(const Be of Ee){const Re=Be.toUnwrapped(),Ve=D.getTile(Be);if(!Ve.rasterParticleState)continue;const Fe=Ve.rasterParticleState,Me=100;Ve.registerFadeDuration(Me);const qe=D.findLoadedParent(Be,0),ot=i_(Ve,qe,D,O.transform,Me);let rt,wt;O.terrain&&O.terrain.prepareDrawTile(),Q.activeTexture.set(K.TEXTURE0),Fe.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Q.activeTexture.set(K.TEXTURE1),qe&&qe.rasterParticleState?(qe.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),rt=Math.pow(2,qe.tileID.overscaledZ-Ve.tileID.overscaledZ),wt=[Ve.tileID.canonical.x*rt%1,Ve.tileID.canonical.y*rt%1]):Fe.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const pt=xe?Float32Array.from(O.transform.expandedFarZProjMatrix):O.transform.calculateProjMatrix(Re,ue),Ot=O.transform,Kt=ws(Ot),ht=i.dF(Be.canonical),et=i.dG(ht.getCenter().lat);let It,mt,Lt,Jt,yr;xe?(It=Float32Array.from(i.bj(i.dI(Be.canonical))),mt=Float32Array.from(Ot.globeMatrix),Lt=Float32Array.from(i.dE(Ot)),Jt=[i.aF(Ot.center.lng),i.aJ(Ot.center.lat)],yr=Float32Array.from(i.dH(Be.canonical,ht,et,Ot.worldSize/Ot._pixelsPerMercatorPixel))):(It=new Float32Array(16),mt=new Float32Array(9),Lt=new Float32Array(16),Jt=[0,0],yr=new Float32Array(9));const Wt=$d(pt,It,mt,Lt,yr,wt||[0,0],i.aj(O.transform.zoom),Jt,Kt,rt||1,ot,le),Xt=O.isTileAffectedByFog(Be),br=O.getOrCreateProgram("rasterParticle",{defines:Ie,overrideFog:Xt});if(O.uploadCommonUniforms(Q,br,Re),xe){const hr=new Sr(K.LEQUAL,Sr.ReadOnly,O.depthRangeFor3D),cr=0,fr=O.globeSharedBuffers;if(fr){const[Nr,Tn,Nn]=fr.getGridBuffers(et,cr!==0);br.draw(O,K.TRIANGLES,hr,Ae,pn.alphaBlended,O.renderElevatedRasterBackface?qr.frontCCW:qr.backCCW,Wt,z.id,Nr,Tn,Nn)}}else{const hr=O.depthModeForSublayer(0,Sr.ReadOnly),cr=me[Be.overscaledZ],{tileBoundsBuffer:fr,tileBoundsIndexBuffer:Nr,tileBoundsSegments:Tn}=O.getTileBoundsBuffers(Ve);br.draw(O,K.TRIANGLES,hr,cr,pn.alphaBlended,qr.disabled,Wt,z.id,fr,Nr,Tn)}}O.resetStencilClippingMasks()}(y,s,h,v),y.style.map.triggerRepaint())},background:function(y,s,h,v){const w=h.paint.get("background-color"),P=h.paint.get("background-color-use-theme").constantOr("default")==="none",O=h.paint.get("background-opacity"),D=h.paint.get("background-emissive-strength"),z=h.paint.get("background-pitch-alignment")==="viewport";if(O===0)return;const W=y.context,H=W.gl,Q=y.transform,K=Q.tileSize,re=h.paint.get("background-pattern");let le;if(re!==void 0&&(re===null||(le=y.imageManager.getPattern(i.I.from(re.toString()),h.scope,y.style.getLut(h.scope)),!le)))return;const ue=!re&&w.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==ue)return;const xe=Xr.disabled,me=y.depthModeForSublayer(0,ue==="opaque"?Sr.ReadWrite:Sr.ReadOnly),Ee=y.colorModeForDrapableLayerRenderPass(D),Ie=re?"backgroundPattern":"background";let Ae,Be=v;if(Be||(Ae=y.getBackgroundTiles(),Be=Object.values(Ae).map(Re=>Re.tileID)),re&&(W.activeTexture.set(H.TEXTURE0),y.imageManager.bind(y.context,h.scope)),z){const Re=y.getOrCreateProgram(Ie,{overrideFog:!1,overrideRtt:!0}),Ve=new Float32Array(i.bz([])),Fe=new i.aP(0,0,0,0,0),Me=re?f_(Ve,D,O,y,0,h.scope,le,z,{tileID:Fe,tileSize:K}):h_(Ve,D,O,w.toPremultipliedRenderColor(P?null:h.lut));Re.draw(y,H.TRIANGLES,me,xe,Ee,qr.disabled,Me,h.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments)}else for(const Re of Be){const Ve=y.isTileAffectedByFog(Re),Fe=y.getOrCreateProgram(Ie,{overrideFog:Ve}),Me=Re.toUnwrapped(),qe=v?Re.projMatrix:y.transform.calculateProjMatrix(Me);y.prepareDrawTile();const ot=s?s.getTile(Re):Ae?Ae[Re.key]:new ru(Re,K,Q.zoom,y),rt=re?f_(qe,D,O,y,0,h.scope,le,z,{tileID:Re,tileSize:K}):h_(qe,D,O,w.toPremultipliedRenderColor(P?null:h.lut));y.uploadCommonUniforms(W,Fe,Me);const{tileBoundsBuffer:wt,tileBoundsIndexBuffer:pt,tileBoundsSegments:Ot}=y.getTileBoundsBuffers(ot);Fe.draw(y,H.TRIANGLES,me,xe,Ee,qr.disabled,rt,h.id,wt,pt,Ot)}},sky:function(y,s,h){const v=y._atmosphere?i.aj(y.transform.zoom):1,w=h.paint.get("sky-opacity")*v;if(w===0)return;const P=y.context,O=h.paint.get("sky-type"),D=new Sr(P.gl.LEQUAL,Sr.ReadOnly,[0,1]),z=y.frameCounter/1e3%1;O==="atmosphere"?y.renderPass==="offscreen"?h.needsSkyboxCapture(y)&&(function(W,H,Q,K){const re=W.context,le=re.gl;let ue=H.skyboxFbo;if(!ue){ue=H.skyboxFbo=re.createFramebuffer(32,32,!0,null),H.skyboxGeometry=new Bw(re),H.skyboxTexture=re.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,H.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Ie=0;Ie<6;++Ie)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Ie,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(ue.framebuffer),re.viewport.set([0,0,32,32]);const xe=H.getCenter(W,!0),me=W.getOrCreateProgram("skyboxCapture"),Ee=new Float64Array(16);i.bz(Ee),i.em(Ee,Ee,.5*-Math.PI),ic(W,H,me,Ee,xe,0),i.bz(Ee),i.em(Ee,Ee,.5*Math.PI),ic(W,H,me,Ee,xe,1),i.bz(Ee),i.cT(Ee,Ee,.5*-Math.PI),ic(W,H,me,Ee,xe,2),i.bz(Ee),i.cT(Ee,Ee,.5*Math.PI),ic(W,H,me,Ee,xe,3),i.bz(Ee),ic(W,H,me,Ee,xe,4),i.bz(Ee),i.em(Ee,Ee,Math.PI),ic(W,H,me,Ee,xe,5),re.viewport.set([0,0,W.width,W.height])}(y,h),h.markSkyboxValid(y)):y.renderPass==="sky"&&function(W,H,Q,K,re){const le=W.context,ue=le.gl,xe=W.transform,me=W.getOrCreateProgram("skybox");le.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_CUBE_MAP,H.skyboxTexture);const Ee=((Ie,Ae,Be,Re,Ve)=>({u_matrix:Ie,u_sun_direction:Ae,u_cubemap:0,u_opacity:Re,u_temporal_offset:Ve}))(xe.skyboxMatrix,H.getCenter(W,!1),0,K,re);W.uploadCommonUniforms(le,me),me.draw(W,ue.TRIANGLES,Q,Xr.disabled,W.colorModeForRenderPass(),qr.backCW,Ee,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(y,h,D,w,z):O==="gradient"&&y.renderPass==="sky"&&function(W,H,Q,K,re){const le=W.context,ue=le.gl,xe=W.transform,me=W.getOrCreateProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new Bw(le)),le.activeTexture.set(ue.TEXTURE0);let Ee=H.colorRampTexture;Ee||(Ee=H.colorRampTexture=new i.T(le,H.colorRamp,ue.RGBA8)),Ee.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const Ie=((Ae,Be,Re,Ve,Fe)=>({u_matrix:Ae,u_color_ramp:0,u_center_direction:Be,u_radius:i.an(Re),u_opacity:Ve,u_temporal_offset:Fe}))(xe.skyboxMatrix,H.getCenter(W,!1),H.paint.get("sky-gradient-radius"),K,re);W.uploadCommonUniforms(le,me),me.draw(W,ue.TRIANGLES,Q,Xr.disabled,W.colorModeForRenderPass(),qr.backCW,Ie,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(y,h,D,w,z)},custom:function(y,s,h,v){const w=y.context,P=h.implementation;if(!y.transform.projection.unsupportedLayers||!y.transform.projection.unsupportedLayers.includes("custom")||y.terrain&&(y.terrain.renderingToTexture||y.renderPass==="offscreen")&&h.isDraped(s)){if(y.renderPass==="offscreen"){const O=P.prerender;if(O){if(y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),y.transform.projection.name==="globe"){const D=y.transform.pointMerc;O.call(P,w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.aj(y.transform.zoom),[D.x,D.y],y.transform.pixelsPerMeterRatio)}else O.call(P,w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState()}}else if(y.renderPass==="translucent"){if(y.terrain&&y.terrain.renderingToTexture){const D=P.renderToTile;if(D){const z=v[0].canonical,W={x:z.x+v[0].wrap*(P.wrapTileId?0:1<<z.z),y:z.y,z:z.z};w.setDepthMode(Sr.disabled),w.setStencilMode(Xr.disabled),w.setColorMode(y.colorModeForRenderPass()),y.setCustomLayerDefaults(),D.call(P,w.gl,W),w.setDirty(),y.setBaseState()}return}y.setCustomLayerDefaults(),w.setColorMode(y.colorModeForRenderPass()),w.setStencilMode(Xr.disabled);const O=P.renderingMode==="3d"?new Sr(y.context.gl.LEQUAL,Sr.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,Sr.ReadOnly);if(w.setDepthMode(O),y.transform.projection.name==="globe"){const D=y.transform.pointMerc;P.render(w.gl,y.transform.customLayerMatrix(),y.transform.getProjection(),y.transform.globeToMercatorMatrix(),i.aj(y.transform.zoom),[D.x,D.y],y.transform.pixelsPerMeterRatio)}else P.render(w.gl,y.transform.customLayerMatrix());w.setDirty(),y.setBaseState(),w.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(y,s,h,v){if(y.renderPass==="opaque")return;const w=h.paint.get("model-opacity").constantOr(1),P=h.paint.get("model-elevation-reference"),O=P==="ground",D=P==="ground";if(w===0)return;const z=h.paint.get("model-cast-shadows");if(y.renderPass==="shadow"&&(!z||y.terrain&&w<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof i.ad))return;const W=y.shadowRenderer,H=h.paint.get("model-receive-shadows");W&&(W.useNormalOffset=!0,H||(W.enabled=!1));const Q=()=>{W&&(W.useNormalOffset=!0,H||(W.enabled=!0))},K=s.getSource();if(y.renderPass==="light-beam"&&K.type!=="batched-model")return;if(K.type==="vector"||K.type==="geojson")return function(Ae,Be,Re,Ve,Fe){const Me=Ae.transform,qe=Me.projection.name==="globe",ot=Me.getFreeCameraOptions().position;if(!Ae.modelManager)return;const rt=Ae.modelManager;Re.modelManager=rt;const wt=Ae.shadowRenderer;if(!Re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const pt=Re._unevaluatedLayout._values["model-id"],Ot=Object.assign({},Re.layout.get("model-id").parameters),Kt=Ae.style.order.indexOf(Re.fqid);for(const ht of Ve){const et=Be.getTile(ht).getBucket(Re);if(!et||et.projection.name!==Me.projection.name)continue;const It=et.getModelUris();if(It&&!et.modelsRequested&&(rt.addModelsFromBucket(It,Fe),et.modelsRequested=!0),qe)Ot.zoom=ht.overscaledZ;else{const hr=Uw(ht,Me);Ot.zoom=hr}const mt=pt.possiblyEvaluate(Ot);if(zA(Ae,et,ht),bl.shadowUniformsInitialized=!1,bl.useSingleShadowCascade=!!wt&&wt.getMaxCascadeForTile(ht.toUnwrapped())===0,Ae.renderPass==="shadow"&&wt){if(Ae.currentShadowCascade===1&&et.isInsideFirstShadowMapFrustum)continue;const hr=Me.calculatePosMatrix(ht.toUnwrapped(),Me.worldSize);if(bl.tileMatrix.set(hr),bl.shadowTileMatrix=Float32Array.from(wt.calculateShadowPassMatrixFromMatrix(hr)),bl.aabb.min=[0,0,0],bl.aabb.max[0]=bl.aabb.max[1]=i.al,bl.aabb.max[2]=0,E_(et,bl,Ae,Re.scope))continue}const Lt=1<<ht.canonical.z,Jt=[((ot.x-ht.wrap)*Lt-ht.canonical.x)*i.al,(ot.y*Lt-ht.canonical.y)*i.al,ot.z*Lt*i.al];Ae.conflationActive&&Object.keys(et.instancesPerModel).length>0&&Ae.style.isLayerClipped(Re,Be.getSource())&&et.updateReplacement(ht,Ae.replacementSource,Kt,Fe)&&(et.uploaded=!1,et.upload(Ae.context));let yr=0;const Wt=new Array,Xt=new Array,br=new Array;for(let hr in et.instancesPerModel){const cr=et.instancesPerModel[hr];cr.features.length>0&&!qe&&(hr=mt.evaluate(cr.features[0].feature,{}));const fr=rt.getModel(hr,Fe);if(fr||rt.hasURLBeenRequested(hr)||et.modelUris.includes(hr)||(et.modelUris.push(hr),et.modelsRequested=!1),fr&&fr.uploaded)if(qe){const Nr=i.c4([],[ot.x,ot.y,ot.z],Ae.transform.worldSize);i.ev(Nr,Nr);for(let Tn=0;Tn<cr.instancedDataArray.length;++Tn){const Nn=[0,0,0],pi=[1,1,1],Wr=i.ew(),jn=cr.tileCoordinatesForInstance(Tn),on=cr.transformForInstance(Tn);i.ex(pi,on),i.ey(Wr,on),i.ez(Nn,Wr);const oi=cr.translationForInstance(Tn),Mn=new i.aS(0,0);i.eA(et.canonical,Mn,jn.x,jn.y);const Ti=i.bB();i.eB(Ti,fr,Ae.transform,Mn,Nn,pi,oi,!0,!1,!1);const Un=cr.colorForInstance(Tn),ln=i.bz([]),Xn=i.ee(Mn.lat,Ae.transform.zoom),mn=i.bp([],[1,1,1/Xn]);i.bq(ln,ln,Nr),br.push({zScaleMatrix:mn,negCameraPosMatrix:ln});for(const Ni of fr.nodes)S_(Ae,Ni,Ti,Ae.transform.expandedFarZProjMatrix,yr,Wt,Xt,fr.materialOverrides,Un);++yr}}else for(const Nr of fr.nodes)Vw(Ae,Re,Nr,cr,Jt,ht,bl)}if(qe)if(Ae.renderPass==="shadow"){for(const hr of Xt)xp(hr.mesh,hr.nodeModelMatrix,Ae,Re);for(const hr of Wt)xp(hr.mesh,hr.nodeModelMatrix,Ae,Re)}else FA(Ae,Re,1,Wt,Xt,br)}}(y,s,h,v,w_(K,h,y.style._importedAsBasemap)),void Q();if(!K.loaded())return;if(K.type==="batched-model")return function(Ae,Be,Re,Ve){Re.resetLayerRenderingStats(Ae);const Fe=Ae.context,Me=Ae.transform,qe=Ae.style.fog,ot=Ae.shadowRenderer;if(Me.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${Me.projection.name} projection is not yet implemented`);const rt=Ae.transform.getFreeCameraOptions().position,wt=i.c4([],[rt.x,rt.y,rt.z],Ae.transform.worldSize),pt=i.ev([],wt),Ot=i.bz([]),Kt=i.ee(Me.center.lat,Me.zoom),ht=i.bp([],[1,1,1/Kt]);i.bq(Ot,Ot,pt);const et=Re.paint.get("model-opacity").constantOr(1),It=new Sr(Fe.gl.LEQUAL,Sr.ReadWrite,Ae.depthRangeFor3D),mt=new Sr(Fe.gl.LEQUAL,Sr.ReadOnly,Ae.depthRangeFor3D),Lt=new i.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Jt=Ae.renderPass==="shadow",yr=Jt&&ot?ot.getCurrentCascadeFrustum():Me.getFrustum(Me.scaleZoom(Me.worldSize)),Wt=Re.paint.get("model-front-cutoff"),Xt=Wt[2]<1,br=qu(Ae,Re.paint.get("model-cutoff-fade-range")),hr=Re.getLayerRenderingStats();(function(cr,fr,Nr,Tn){const Nn=cr.terrain?cr.terrain.exaggeration():0,pi=cr.transform.zoom;for(const Wr of Tn){const jn=fr.getTile(Wr).getBucket(Nr);jn&&(jn.setFilter(Nr.filter),cr.conflationActive&&jn.updateReplacement(Wr,cr.replacementSource),jn.evaluateTransform(cr,Nr),cr.terrain&&Nn>0&&jn.elevationUpdate(cr.terrain,Nn,Wr,Nr.source),jn.needsReEvaluation(cr,pi,Nr)&&jn.evaluate(Nr))}})(Ae,Be,Re,Ve),function(){let cr,fr,Nr;Xt?(cr=Ve.length-1,fr=-1,Nr=-1):(cr=0,fr=Ve.length,Nr=1);const Tn=new Float64Array(16),Nn=i.cz(),pi=new i.P(0,0);for(let Wr=cr;Wr!==fr;Wr+=Nr){const jn=Ve[Wr],on=Be.getTile(jn).getBucket(Re);if(!on||!on.uploaded)continue;let oi=!1;ot&&(oi=ot.getMaxCascadeForTile(jn.toUnwrapped())===0);const Mn=Me.calculatePosMatrix(jn.toUnwrapped(),Me.worldSize),Ti=on.modelTraits;!Jt&&Xt&&(i.bk(Tn,Mn),i.af(Nn,wt,Tn),pi.x=Nn[0],pi.y=Nn[1]);const Un=[];on.setFilter(Re.filter);for(const ln of on.getNodesInfo()){if(ln.hiddenByReplacement||!ln.node.meshes)continue;const Xn=ln.node;let mn=0;Ae.terrain&&Xn.elevation&&(mn=Xn.elevation*Ae.terrain.exaggeration());const Ni=(()=>{const qo=ln.aabb;return Lt.min=[...qo.min],Lt.max=[...qo.max],Lt.min[2]+=mn,Lt.max[2]+=mn,i.af(Lt.min,Lt.min,Mn),i.af(Lt.max,Lt.max,Mn),Lt})(),ti=ln.evaluatedScale;if(ti[0]<=1&&ti[1]<=1&&ti[2]<=1&&Ni.intersects(yr)===0)continue;if(!Jt&&Xt){const qo=.16666666666666666;ln.cameraCollisionOpacity=wt[0]>Ni.min[0]&&wt[0]<Ni.max[0]&&wt[1]>Ni.min[1]&&wt[1]<Ni.max[1]&&wt[2]*Kt<Ni.max[2]&&Xn.footprint&&i.b$(pi,Xn.footprint)?Math.max(ln.cameraCollisionOpacity-qo,0):Math.min(1,ln.cameraCollisionOpacity+qo)}const Hr=[...Mn],Ln=1/i.d6(jn.canonical),Xi=Xn.anchor?Xn.anchor[0]:0,xa=Xn.anchor?Xn.anchor[1]:0;i.bq(Hr,Hr,[Xi*(ti[0]-1)+ln.evaluatedTranslation[0]*Ln,xa*(ti[1]-1)+ln.evaluatedTranslation[1]*Ln,mn+ln.evaluatedTranslation[2]]),i.cp(ti,i.eD)||i.cR(Hr,Hr,ti);const ta=i.aB([],Hr,Xn.globalMatrix),ca=i.aB([],Me.expandedFarZProjMatrix,ta),Fs=i.aB([],Me.expandedFarZProjMatrix,Hr),Ss=i.aC([],[Xi,xa,mn,1],ca)[2];Xn.hidden=!1;let Ro=et;Jt||(Xt&&(Ro*=ln.cameraCollisionOpacity,Ro*=Xh(Hr,Me,ln.aabb,Wt)),Ro*=Gg(br,Ss)),Ro!==0?Un.push({nodeInfo:ln,depth:Ss,opacity:Ro,wvpForNode:ca,wvpForTile:Fs,nodeModelMatrix:ta,tileModelMatrix:Hr}):Xn.hidden=!0}Jt||Un.sort((ln,Xn)=>!Xt||ln.opacity===1&&Xn.opacity===1?ln.depth<Xn.depth?-1:1:ln.opacity===1?-1:Xn.opacity===1?1:ln.depth>Xn.depth?-1:1);for(const ln of Un){const Xn=ln.nodeInfo,mn=Xn.node;let Ni=i.aB([],ht,ln.tileModelMatrix);i.aB(Ni,Ot,Ni);const ti=i.bk([],Ni);i.ef(ti,ti),i.cR(ti,ti,BA),Ni=i.aB(Ni,Ni,mn.globalMatrix);const Hr=Ae.renderPass==="light-beam",Ln=Re.paint.get("model-color-use-theme").constantOr("default")==="none",Xi=Ti&i.eH.HasMapboxMeshFeatures,xa=Xi?0:Xn.evaluatedRMEA[0][2];for(let ta=0;ta<mn.meshes.length;++ta){const ca=mn.meshes[ta],Fs=ta===mn.lightMeshIndex;let Ss=ln.wvpForNode;if(Fs){if(!Hr&&!Ae.terrain&&Ae.shadowRenderer){Ae.currentLayer<Ae.firstLightBeamLayer&&(Ae.firstLightBeamLayer=Ae.currentLayer);continue}Ss=ln.wvpForTile}else if(Hr)continue;const Ro={defines:[]},qo=[];if(!Jt&&ot&&(ot.useNormalOffset=!!ca.normalBuffer),vp(Ro.defines,qo,ca,Ae,Ln?null:Re.lut),Xi||Ro.defines.push("DIFFUSE_SHADED"),oi&&Ro.defines.push("SHADOWS_SINGLE_CASCADE"),hr&&(Jt?hr.numRenderedVerticesInShadowPass+=ca.vertexArray.length:hr.numRenderedVerticesInTransparentPass+=ca.vertexArray.length),Jt){xp(ca,ln.nodeModelMatrix,Ae,Re);continue}let Sl=null;if(qe){const ba=$w(ln.nodeModelMatrix,Ae.transform);if(Sl=new Float32Array(ba),Me.projection.name!=="globe"){const Si=ca.aabb.min,Ta=ca.aabb.max,[mo,aa]=qe.getOpacityForBounds(ba,Si[0],Si[1],Ta[0],Ta[1]);Ro.overrideFog=mo>=gt||aa>=gt}}const jo=ca.material;let El;jo.occlusionTexture&&jo.occlusionTexture.offsetScale&&(El=jo.occlusionTexture.offsetScale,Ro.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const sc=Ae.getOrCreateProgram("model",Ro);!Jt&&ot&&ot.setupShadowsFromMatrix(ln.tileModelMatrix,sc,ot.useNormalOffset),Ae.uploadCommonUniforms(Fe,sc,null,Sl);const po=jo.pbrMetallicRoughness;po.metallicFactor=.9,po.roughnessFactor=.5;const ia=p_(new Float32Array(Ss),new Float32Array(Ni),new Float32Array(ti),new Float32Array(mn.globalMatrix),Ae,ln.opacity,po.baseColorFactor,jo.emissiveFactor,po.metallicFactor,po.roughnessFactor,jo,xa,Re,[0,0,0],El);!Fs&&(Xn.hasTranslucentParts||ln.opacity<1)&&sc.draw(Ae,Fe.gl.TRIANGLES,It,Xr.disabled,pn.disabled,qr.backCCW,ia,Re.id,ca.vertexBuffer,ca.indexBuffer,ca.segments,Re.paint,Ae.transform.zoom,void 0,qo),sc.draw(Ae,Fe.gl.TRIANGLES,Fs?mt:It,Xr.disabled,Fs||ln.opacity<1||Xn.hasTranslucentParts?pn.alphaBlended:pn.unblended,qr.backCCW,ia,Re.id,ca.vertexBuffer,ca.indexBuffer,ca.segments,Re.paint,Ae.transform.zoom,void 0,qo)}}}}()}(y,s,h,v),void Q();if(K.type!=="model")return;const re=K.getModels(),le=[],ue=y.transform.getFreeCameraOptions().position,xe=i.c4([],[ue.x,ue.y,ue.z],y.transform.worldSize);i.ev(xe,xe);const me=[],Ee=[];let Ie=0;for(const Ae of re){const Be=s.getFeatureState("",Ae.id),Re={type:"Unknown",id:Ae.id,properties:Ae.featureProperties},Ve=h.paint.get("model-rotation").evaluate(Re,Be),Fe=h.paint.get("model-scale").evaluate(Re,Be),Me=h.paint.get("model-translation").evaluate(Re,Be);bp(h,Ae.id,Be,Ae.featureProperties,Ae.nodeOverrideNames,Ae.nodeOverrides),lj(h,Ae.id,Be,Ae.featureProperties,Ae.materialOverrideNames,Ae.materialOverrides),Ae.nodeOverrides.size>0&&Ae.computeBoundsAndApplyParent(),Ae.computeModelMatrix(y,Ve,Fe,Me,D,O,!1);const qe=i.bz([]),ot=i.ee(Ae.position.lat,y.transform.zoom),rt=i.bp([],[1,1,1/ot]);i.bq(qe,qe,xe),le.push({zScaleMatrix:rt,negCameraPosMatrix:qe});for(const wt of Ae.nodes)S_(y,wt,Ae.matrix,y.transform.expandedFarZProjMatrix,Ie,me,Ee,Ae.materialOverrides);Ie++}if(me.sort((Ae,Be)=>Be.depth-Ae.depth),y.renderPass!=="shadow")FA(y,h,w,me,Ee,le),Q();else{for(const Ae of Ee)xp(Ae.mesh,Ae.nodeModelMatrix,y,h);for(const Ae of me)xp(Ae.mesh,Ae.nodeModelMatrix,y,h);Q()}}},T_={line:function(y,s,h){if(y.hasElevatedBuckets=!1,y.hasNonElevatedBuckets=!1,y._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||y._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const v=s.getVisibleCoordinates();for(const w of v){const P=s.getTile(w).getBucket(y);if(P&&(P.elevationType!=="none"?y.hasElevatedBuckets=!0:y.hasNonElevatedBuckets=!0,y.hasElevatedBuckets&&y.hasNonElevatedBuckets))break}}}else y.hasNonElevatedBuckets=!0},model:function(y,s,h){const v=s.getSource();if(!v.loaded())return;if(v.type==="vector"||v.type==="geojson"){const P=w_(v,y,h.style._importedAsBasemap);return void(h.modelManager&&h.modelManager.upload(h,P))}if(v.type==="batched-model"||v.type!=="model")return;const w=v.getModels();for(const P of w)P.upload(h.context)},raster:function(y,s,h){const v=s.getSource();if(!(v instanceof so&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const P=y.paint.get("raster-array-band")||v.getInitialBand(w);if(P==null)return;const O=s.getIds().map(D=>s.getTileByID(D));for(const D of O)D.updateNeeded(y.id,P)&&v.prepareTile(D,w,y.id,P)},"raster-particle":function(y,s,h){const v=s.getSource();if(!(v instanceof so&&v.loaded()))return;const w=y.sourceLayer||v.rasterLayerIds&&v.rasterLayerIds[0];if(!w)return;const P=y.paint.get("raster-particle-array-band")||v.getInitialBand(w);if(P==null)return;const O=s.getIds().map(D=>s.getTileByID(D));for(const D of O)D.updateNeeded(y.id,P)&&v.prepareTile(D,w,y.id,P)}},A_={fill:Kh},wl={fill:function(y,s,h,v){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const w=y.context.gl,P=new Sr(w.LEQUAL,Sr.ReadOnly,y.depthRangeFor3D),O=new Xr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),D=y.transform.getFreeCameraOptions().position,z=y.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const W of v){const H=s.getTile(W),Q=H.getBucket(h);if(!Q)continue;const K=Q.elevatedStructures;if(!K||K.depthSegments.segments[0].primitiveLength===0)continue;const re=RA(W.toUnwrapped(),D),le=y.translatePosMatrix(W.projMatrix,H,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ue=l_(le,re,0,1,0);z.draw(y,w.TRIANGLES,P,O,pn.disabled,qr.disabled,ue,h.id,K.vertexBuffer,K.indexBuffer,K.depthSegments,h.paint,y.transform.zoom)}}};class Hd{constructor(s,h,v,w,P,O){this.context=new g_(s,h),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=P,this._timeStamp=i.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const D=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const W of D)this._debugParams.enabledLayers[W]=!0;P.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),P.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),P.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),P.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),P.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),P.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const W of D)P.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],W);this.occlusionParams=new cj(P),this.setup(),this.numSublayers=Jl.maxUnderzooming+Jl.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new kg(this),this._wireframeDebugCache=new UA,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const z=new i.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,z,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w,this.worldview=O}updateTerrain(s,h){const v=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Bg(this,s));const w=this._terrain;this.transform.elevation=v?w:null,w.update(s,this.transform,h),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(s){const h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=h.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const P=v+.78*(w-v);this.transform.fogCullDistSq=P*P}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Bg(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*i.o.devicePixelRatio,this.height=h*i.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const s=this.context,h=new i.bc;h.emplaceBack(0,0),h.emplaceBack(i.al,0),h.emplaceBack(0,i.al),h.emplaceBack(i.al,i.al),this.tileExtentBuffer=s.createVertexBuffer(h,i.be.members),this.tileExtentSegments=i.bf.simpleSegment(0,0,4,2);const v=new i.bc;v.emplaceBack(0,0),v.emplaceBack(i.al,0),v.emplaceBack(0,i.al),v.emplaceBack(i.al,i.al),this.debugBuffer=s.createVertexBuffer(v,i.be.members),this.debugSegments=i.bf.simpleSegment(0,0,4,5);const w=new i.bc;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,i.be.members),this.viewportSegments=i.bf.simpleSegment(0,0,4,2);const P=new i.a$;P.emplaceBack(0,0,0,0),P.emplaceBack(i.al,0,i.al,0),P.emplaceBack(0,i.al,0,i.al),P.emplaceBack(i.al,i.al,i.al,i.al),this.mercatorBoundsBuffer=s.createVertexBuffer(P,i.bh.members),this.mercatorBoundsSegments=i.bf.simpleSegment(0,0,4,2);const O=new i.b0;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(O);const D=new i.bd;for(const W of[0,1,3,2,0])D.emplaceBack(W);this.debugIndexBuffer=s.createIndexBuffer(D),this.emptyTexture=new i.T(s,new i.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=i.bB();const z=this.context.gl;this.stencilClearMode=new Xr({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Sr.disabled,this.stencilClearMode,pn.disabled,qr.disabled,Gh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,v){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const z of v)if(this._tileClippingMaskIDs[z.key]===void 0){D=!0;break}if(!D)return}this.currentStencilSource=h.id;const w=this.context,P=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(pn.disabled),w.setDepthMode(Sr.disabled);const O=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of v){const z=h.getTile(D),W=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=this.getTileBoundsBuffers(z);O.draw(this,P.TRIANGLES,Sr.disabled,new Xr({func:P.ALWAYS,mask:0},W,255,P.KEEP,P.KEEP,P.REPLACE),pn.disabled,qr.disabled,Gh(D.projMatrix),"$clipping",H,Q,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Xr({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new Xr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,v=s.sort((O,D)=>D.overscaledZ-O.overscaledZ),w=v[v.length-1].overscaledZ,P=v[0].overscaledZ-w+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const O={};for(let D=0;D<P;D++)O[D+w]=new Xr({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=P,[O,v]}return[{[w]:Xr.disabled},v]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new pn([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new i.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?pn.unblended:pn.alphaBlended}colorModeForDrapableLayerRenderPass(s){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new pn([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new i.ao(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,h,v,w=!1){if(this.depthOcclusion)return new Sr(this.context.gl.GREATER,Sr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return Sr.disabled;const P=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Sr(v||this.context.gl.LEQUAL,h,[P,P])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,h=Math.ceil(this.width),v=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),P=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===v||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&v!==0&&(this.depthFBO=new m_(this.context,h,v,!1,"texture"),this.depthTexture=new i.T(this.context,{width:h,height:v,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),s.bindTexture(s.TEXTURE_2D,P),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,h,v,0,0,h,v,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){const v=i.o.now();this._dt=v-this._timeStamp,this._timeStamp=v,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;const w=this.style._mergedLayers,P=!(!this.terrain||!this.terrain.enabled),O=()=>this.style._getOrder(P).filter(ht=>{const et=w[ht];return!(et.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[et.type]});let D=O(),z=!1,W=!1,H=null;for(const ht of D){const et=w[ht];et.type==="circle"?z=!0:et.type==="building"?H=et:et.type==="symbol"&&(et.hasOcclusionOpacityProperties?W=!0:z=!0)}let Q=D.map(ht=>w[ht]);const K=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(i.o.now()),this.imageManager.beginFrame();let re=0,le=!1;for(const ht in K){const et=K[ht];et.used&&(et.prepare(this.context),et.getSource().usedInConflation&&++re)}let ue=!1;for(const ht of Q)ht.isHidden(this.transform.zoom)||(ht.type==="clip"&&(ue=!0),this.prepareLayer(ht));const xe={},me={},Ee={},Ie={},Ae={};for(const ht in K){const et=K[ht];xe[ht]=et.getVisibleCoordinates(),me[ht]=xe[ht].slice().reverse(),Ee[ht]=et.getVisibleCoordinates(!0).reverse(),Ie[ht]=et.getShadowCasterCoordinates(),Ae[ht]=et.sortCoordinatesByDistance(xe[ht])}const Be=ht=>{const et=this.style.getLayerSourceCache(ht);return et&&et.used?et.getSource():null};if(re||ue||this._clippingActiveLastFrame){const ht=[],et=[];let It=0;for(const mt of Q)this.isSourceForClippingOrConflation(mt,Be(mt))&&(ht.push(mt),et.push(It)),It++;if(ht&&(ue||ht.length>1)||this._clippingActiveLastFrame){ue=!1;const mt=[];for(let Lt=0;Lt<ht.length;Lt++){const Jt=ht[Lt],yr=et[Lt],Wt=this.style.getLayerSourceCache(Jt);if(!Wt||!Wt.used||!Wt.getSource().usedInConflation&&Jt.type!=="clip"&&Jt.type!=="building")continue;let Xt=i.eP,br=i.bZ.None;const hr=[];let cr=!0;if(Jt.type==="building")Xt=i.eR;else if(Jt.type==="clip"){Xt=yr;for(const fr of Jt.layout.get("clip-layer-types"))br|=fr==="model"?i.bZ.Model:fr==="symbol"?i.bZ.Symbol:i.bZ.FillExtrusion;for(const fr of Jt.layout.get("clip-layer-scope"))hr.push(fr);Jt.isHidden(this.transform.zoom)?cr=!1:ue=!0}cr&&mt.push({layer:Jt.fqid,cache:Wt,order:Xt,clipMask:br,clipScope:hr})}this.replacementSource.setSources(mt),le=!0}}this._clippingActiveLastFrame=ue,le||this.replacementSource.clear(),this.conflationActive=le,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let ht=0;ht<Q.length;ht++){const et=Q[ht],It=et.cutoffRange();if(this.longestCutoffRange=Math.max(It,this.longestCutoffRange),It>0){const mt=Be(et);mt&&(this.minCutoffZoom=Math.max(mt.minzoom,this.minCutoffZoom)),et.minzoom&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom))}et.is3D(P)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=ht),this._lastOcclusionLayer=ht)}const Re=this.style&&this.style.fog;Re?(this._fogVisible=Re.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Re.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Ee),this.opaquePassCutoff=0,D=O(),Q=D.map(ht=>w[ht]));const Ve=this._shadowRenderer;if(Ve){Ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const ht in K)for(const et of xe[ht]){let It={min:0,max:0};this.terrain&&(It=this.terrain.getMinMaxForTile(et)||It),Ve.addShadowReceiver(et.toUnwrapped(),It.min,It.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new la(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Fe&&!this._snow&&(this._snow=new Ww(this)),!Fe&&this._snow&&(this._snow.destroy(),delete this._snow),Me&&!this._rain&&(this._rain=new wp(this)),!Me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),H){this.buildingTileBorderManager||(this.buildingTileBorderManager=new lt);const ht=this.style.getLayerSourceCache(H);this.buildingTileBorderManager.updateBorders(ht,H)}if(!nr.has(this.context.gl))return;this.renderPass="offscreen";for(const ht of Q){const et=s.getLayerSourceCache(ht);if(!ht.hasOffscreenPass()||ht.isHidden(this.transform.zoom))continue;const It=et?me[et.id]:void 0;(ht.type==="custom"||ht.type==="raster"||ht.type==="raster-particle"||ht.isSky()||It&&It.length)&&this.renderLayer(this,et,ht,It)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Ie)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const qe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ot=(()=>{if(h.showOverdrawInspector)return i.ao.black;const ht=this.style.fog;if(ht&&this.transform.projection.supportsFog){const et=this.style.getLut(ht.scope);if(!qe){const It=ht.properties.get("color-use-theme")==="none",mt=ht.properties.get("color").toNonPremultipliedRenderColor(It?null:et).toArray01();return new i.ao(...mt)}if(qe){const It=ht.properties.get("space-color-use-theme")==="none",mt=ht.properties.get("space-color").toNonPremultipliedRenderColor(It?null:et).toArray01();return new i.ao(...mt)}}return i.ao.transparent})();if(this.context.clear({color:ot,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&qe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=D.length-1;this.currentLayer>=0;this.currentLayer--){const ht=Q[this.currentLayer],et=s.getLayerSourceCache(ht);if(ht.isSky())continue;const It=et?(ht.is3D(P)?Ae:me)[et.id]:void 0;this._renderTileClippingMasks(ht,et,It),this.renderLayer(this,et,ht,It)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&qe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const ht=Q[this.currentLayer],et=s.getLayerSourceCache(ht);ht.isSky()&&this.renderLayer(this,et,ht,et?me[et.id]:void 0)}function rt(ht,et){let It;return et&&(It=(ht.type==="symbol"?Ee:ht.is3D(P)?Ae:me)[et.id]),It}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<D.length;){const ht=Q[this.currentLayer];if(ht.type==="raster"||ht.type==="raster-particle"){const et=s.getLayerSourceCache(ht);this.renderLayer(this,et,ht,rt(ht,et))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let wt=0;Ve&&(wt=Ve.getShadowCastingLayerCount());let pt=!1,Ot=-1;for(let ht=0;ht<D.length;++ht){const et=Q[ht];et.isHidden(this.transform.zoom)||et.is3D(P)&&(Ot=ht)}W&&Ot===-1&&(z=!0);let Kt=!1;for(;this.currentLayer<D.length;){const ht=Q[this.currentLayer],et=s.getLayerSourceCache(ht);if(ht.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(ht)){if(ht.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Kt&&ht.is3D(P)&&!P){const It=this.currentLayer,mt=Lt=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Jt=Q[this.currentLayer];if(A_[Jt.type]){const yr=this.style.getLayerSourceCache(Jt);A_[Jt.type](this,yr,Jt,rt(Jt,yr),Lt)}}};mt("initialize"),mt("reset"),this.currentLayer=It,Kt=!0}if(z&&!pt&&this.terrain&&!this.transform.isOrthographic&&(pt=!0,this.blitDepth()),W&&Ot!==-1&&this.currentLayer===Ot+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(ht,et,et?xe[et.id]:void 0),this.renderLayer(this,et,ht,rt(ht,et)),!this.terrain&&Ve&&wt>0&&ht.hasShadowPass()&&--wt==0){{this.clearStencil(),this.resetStencilClippingMasks();const It=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const mt=Q[this.currentLayer];if(wl[mt.type]){const Lt=this.style.getLayerSourceCache(mt);wl[mt.type](this,Lt,mt,rt(mt,Lt))}}this.currentLayer=It}if(Ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const It=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=It;this.currentLayer++){const mt=Q[this.currentLayer];if(!mt.hasLightBeamPass())continue;const Lt=s.getLayerSourceCache(mt);this.renderLayer(this,Lt,mt,Lt?me[Lt.id]:void 0)}this.currentLayer=It,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const It=this.currentLayer;this.depthOcclusion=!0;for(const mt of this.layersWithOcclusionOpacity){this.currentLayer=mt;const Lt=Q[this.currentLayer],Jt=s.getLayerSourceCache(Lt),yr=Jt?me[Jt.id]:void 0;this.terrain||this._renderTileClippingMasks(Lt,Jt,Jt?xe[Jt.id]:void 0),this.renderLayer(this,Jt,Lt,yr)}this.depthOcclusion=!1,this.currentLayer=It,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ht=null;Q.forEach(et=>{const It=s.getLayerSourceCache(et);It&&!et.isHidden(this.transform.zoom)&&It.getVisibleCoordinates().length&&(!ht||ht.getSource().maxzoom<It.getSource().maxzoom)&&(ht=It)}),ht&&this.options.showTileBoundaries&&zw(this,ht,ht.getVisibleCoordinates(),i.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&zw(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ht){const et=ht.transform.padding;ki(ht,ht.transform.height-(et.top||0),3,Gd),ki(ht,et.bottom||0,3,MA),Wg(ht,et.left||0,3,Dw),Wg(ht,ht.transform.width-(et.right||0),3,Lw);const It=ht.transform.centerPoint;(function(mt,Lt,Jt,yr){gp(mt,Lt-1,Jt-10,2,20,yr),gp(mt,Lt-10,Jt-1,20,2,yr)})(ht,It.x,ht.transform.height-It.y,Fw)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),le||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:h}=this.transform.projection,v=!h||!h.includes(s.type);if(T_[s.type]&&(v||this.terrain&&s.type==="custom")){const w=this.style.getLayerSourceCache(s);T_[s.type](s,w,this)}this.gpuTimingEnd()}renderLayer(s,h,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||v.type==="model"||v.type==="raster"||v.type==="raster-particle"||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(v.type)&&(!s.terrain||v.type!=="custom")||v.type==="clip"||Gw[v.type](s,h,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[s.id];w||(w=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(h.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=this.context.gl,v=h.createQuery();this.deferredRenderGpuTimeQueries.push(v),h.beginQuery(s.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const v in s){const w=s[v],P=this.context.extTimerQuery,O=P.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;P.deleteQueryEXT(w.query),h[v]=O}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let v=0;for(const w of s)v+=h.getQueryParameter(w,h.QUERY_RESULT)/1e6,h.deleteQuery(w);return v}translatePosMatrix(s,h,v,w,P){if(!v[0]&&!v[1])return s;const O=P?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(O){const W=Math.sin(O),H=Math.cos(O);v=[v[0]*H-v[1]*W,v[0]*W+v[1]*H]}const D=[P?v[0]:i.ay(h,v[0],this.transform.zoom),P?v[1]:i.ay(h,v[1],this.transform.zoom),0],z=new Float32Array(16);return i.bq(z,s,D),z}saveTileTexture(s){if(s.context!==this.context)return;const h=s.size[0],v=this._tileTextures[h];v?v.push(s):this._tileTextures[h]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,v){const w=v===void 0?this.terrain&&this.terrain.renderingToTexture:v,P=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(P.push("LIGHTING_3D_MODE"),P.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||P.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||P.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(P.push("TERRAIN"),this.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&P.push("GLOBE"),!this._fogVisible||w||h!==void 0&&!h||P.push("FOG","FOG_DITHERING"),w&&P.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&P.push("OVERDRAW_INSPECTOR"),P}getOrCreateProgram(s,h){this.cache=this.cache||{};const v=h&&h.defines||[],w=h&&h.config,P=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(v),O=$g.cacheKey(Kv[s],s,P,w);return this.cache[O]||(this.cache[O]=new $g(this.context,s,Kv[s],w,ij[s],P)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const P=((O,D,z)=>{const W=O.properties.get("direction"),H=O.properties.get("color-use-theme")==="none",Q=O.properties.get("color").toNonPremultipliedRenderColor(H?null:z.getLut(O.scope)).toArray01(),K=O.properties.get("intensity"),re=D.properties.get("color-use-theme")==="none",le=D.properties.get("color").toNonPremultipliedRenderColor(re?null:z.getLut(D.scope)).toArray01(),ue=D.properties.get("intensity"),xe=[W.x,W.y,W.z],me=i.dM(le,ue),Ee=i.dM(Q,K);return{u_lighting_ambient_color:me,u_lighting_directional_dir:xe,u_lighting_directional_color:Ee,u_ground_radiance:xw(xe,Ee,me)}})(v,w,this.style);h.setLightsUniformValues(s,P)}}}uploadCommonUniforms(s,h,v,w,P){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;const O=this.style.fog;if(O){const D=O.getOpacity(this.transform.pitch),z=((W,H,Q,K,re,le,ue,xe,me,Ee,Ie,Ae)=>{const Be=W.transform,Re=H.properties.get("color-use-theme")==="none",Ve=H.properties.get("color").toNonPremultipliedRenderColor(Re?null:W.style.getLut(H.scope)).toArray01();Ve[3]=K;const Fe=W.frameCounter/1e3%1,[Me,qe]=H.properties.get("vertical-range");return{u_fog_matrix:Q?Be.calculateFogTileMatrix(Q):Ae||W.identityMat,u_fog_range:H.getFovAdjustedRange(Be._fov),u_fog_color:Ve,u_fog_horizon_blend:H.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Me,qe),qe],u_fog_temporal_offset:Fe,u_frustum_tl:re,u_frustum_tr:le,u_frustum_br:ue,u_frustum_bl:xe,u_globe_pos:me,u_globe_radius:Ee,u_viewport:Ie,u_globe_transition:i.aj(Be.zoom),u_is_globe:+(Be.projection.name==="globe")}})(this,O,v,D,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.o.devicePixelRatio,this.transform.height*i.o.devicePixelRatio],w);h.setFogUniformValues(s,z)}P&&h.setCutoffUniformValues(s,P.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)h[w.key]=s[w.key]||new ru(w,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=gt||h[1]>=gt}setupDepthForOcclusion(s,h,v){const w=this.context,P=w.gl,O=!!v;var D;v||(v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(P.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),v.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],v.u_depth_range_unpack=[2/((D=this.depthRangeFor3D)[1]-D[0]),-1-2*D[0]/(D[1]-D[0])],v.u_occluder_half_size=.5*this.occlusionParams.occluderSize,v.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE),w.activeTexture.set(P.TEXTURE0),O||h.setTerrainUniformValues(w,v)}}function Jh(y,s){let h=!1,v=null;const w=()=>{v=null,h&&(y(),v=setTimeout(w,s),h=!1)};return()=>(h=!0,v||w(),v)}class P_{constructor(s){this._hashName=s&&encodeURIComponent(s),i.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Jh(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=C_(s);if(this._hashName){const v=this._hashName;let w=!1;const P=location.hash.slice(1).split("&").map(O=>{const D=O.split("=")[0];return D===v?(w=!0,`${D}=${h}`):O}).filter(O=>O);return w||P.push(`${v}=${h}`),`#${P.join("&")}`}return`#${h}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(h=v)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(v=>isNaN(Number(v)))){const v=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function C_(y,s){const h=y.getCenter(),v=Math.round(100*y.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,w),O=Math.round(h.lng*P)/P,D=Math.round(h.lat*P)/P,z=y.getBearing(),W=y.getPitch();let H=s?`/${O}/${D}/${v}`:`${v}/${D}/${O}`;return(z||W)&&(H+="/"+Math.round(10*z)/10),W&&(H+=`/${Math.round(W)}`),H}const Sp={linearity:.3,easing:i.eS(0,0,.3,1)},Kd=Object.assign({deceleration:2500,maxSpeed:1400},Sp),Hw=Object.assign({deceleration:20,maxSpeed:1400},Sp),ac=Object.assign({deceleration:1e3,maxSpeed:360},Sp),Kw=Object.assign({deceleration:1e3,maxSpeed:90},Sp);class O_{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=i.o.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)h.zoom+=P.zoomDelta||0,h.bearing+=P.bearingDelta||0,h.pitch+=P.pitchDelta||0,P.panDelta&&h.pan._add(P.panDelta),P.around&&(h.around=P.around),P.pinchAround&&(h.pinchAround=P.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const P=Tp(h.pan.mag(),v,Object.assign({},Kd,s||{}));w.offset=h.pan.mult(P.amount/h.pan.mag()),w.center=this._map.transform.center,Ep(w,P)}if(h.zoom){const P=Tp(h.zoom,v,Hw);w.zoom=this._map.transform.zoom+P.amount,Ep(w,P)}if(h.bearing){const P=Tp(h.bearing,v,ac);w.bearing=this._map.transform.bearing+i.aA(P.amount,-179,179),Ep(w,P)}if(h.pitch){const P=Tp(h.pitch,v,Kw);w.pitch=this._map.transform.pitch+P.amount,Ep(w,P)}if(w.zoom||w.bearing){const P=h.pinchAround===void 0?h.around:h.pinchAround;w.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Ep(y,s){(!y.duration||y.duration<s.duration)&&(y.duration=s.duration,y.easing=s.easing)}function Tp(y,s,h){const{maxSpeed:v,linearity:w,deceleration:P}=h,O=i.aA(y*w/(s/1e3),-v,v),D=Math.abs(O)/(P*w);return{easing:h.easing,duration:1e3*D,amount:O*(D/2)}}class Gi extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v,w={}){const P=te(h.getCanvasContainer(),v),O=h.unproject(P);super(s,Object.assign({point:P,lngLat:O,originalEvent:v},w)),this._defaultPrevented=!1,this.target=h}}class Ap extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,v){const w=s==="touchend"?v.changedTouches:v.touches,P=se(h.getCanvasContainer(),w),O=P.map(z=>h.unproject(z)),D=P.reduce((z,W,H,Q)=>z.add(W.div(Q.length)),new i.P(0,0));super(s,{points:P,point:D,lngLats:O,lngLat:h.unproject(D),originalEvent:v}),this._defaultPrevented=!1}}class Zw extends i.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class Xw{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Zw(this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Gi(s.type,this._map,s))}mouseup(s){this._map.fire(new Gi(s.type,this._map,s))}preclick(s){const h=new MouseEvent("preclick",s);this._map.fire(new Gi(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Gi(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Gi(s.type,this._map,s))}mouseover(s){this._map.fire(new Gi(s.type,this._map,s))}mouseout(s){this._map.fire(new Gi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ap(s.type,this._map,s))}touchmove(s){this._map.fire(new Ap(s.type,this._map,s))}touchend(s){this._map.fire(new Ap(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ap(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qh{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Gi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Gi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yw{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(B(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const v=h,w=this._startPos,P=this._lastPos;if(!w||!P||P.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=k("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const O=Math.min(w.x,v.x),D=Math.max(w.x,v.x),z=Math.min(w.y,v.y),W=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${z}px)`,this._box.style.width=D-O+"px",this._box.style.height=W-z+"px")})}mouseupWindow(s,h){if(!this._active)return;const v=this._startPos,w=h;if(v&&s.button===0){if(this.reset(),X(),v.x!==w.x||v.y!==w.y)return this._map.fire(new i.z("boxzoomend",{originalEvent:s})),{cameraAnimation:P=>P.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),U(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new i.z(s,{originalEvent:h}))}}function Kg(y,s){const h={};for(let v=0;v<y.length;v++)h[y[v].identifier]=s[v];return h}class Jw{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const P=new i.P(0,0);for(const O of w)P._add(O);return P.div(w.length)}(h),this.touches=Kg(v,h)))}touchmove(s,h,v){if(this.aborted||!this.centroid)return;const w=Kg(v,h);for(const P in this.touches){const O=w[P];(!O||O.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(s,h,v){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Zd{constructor(s){this.singleTap=new Jw(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,v){this.singleTap.touchstart(s,h,v)}touchmove(s,h,v){this.singleTap.touchmove(s,h,v)}touchend(s,h,v){const w=this.singleTap.touchend(s,h,v);if(w){const P=s.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(w)<30;if(P&&O||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Qw{constructor(){this._zoomIn=new Zd({numTouches:1,numTaps:2}),this._zoomOut=new Zd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,v){this._zoomIn.touchstart(s,h,v),this._zoomOut.touchstart(s,h,v)}touchmove(s,h,v){this._zoomIn.touchmove(s,h,v),this._zoomOut.touchmove(s,h,v)}touchend(s,h,v){const w=this._zoomIn.touchend(s,h,v),P=this._zoomOut.touchend(s,h,v);return w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(w)},{originalEvent:s})}):P?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(P)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const I_={0:1,2:2},k_={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Pp{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const v=oe(s);this._correctButton(s,v)&&(this._lastPoint=h,this._eventButton=v)}mousemoveWindow(s,h){const v=this._lastPoint;if(v){if(s.preventDefault(),this._eventButton!=null&&function(w,P){const O=I_[P];return w.buttons===void 0||(w.buttons&O)!==O}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(v,h)}}mouseupWindow(s){this._lastPoint&&oe(s)===this._eventButton&&(this._moved&&X(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class e1 extends Pp{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class R_ extends Pp{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?k_[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const v=.8*(h.x-s.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class t1 extends Pp{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?k_[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const v=-.5*(h.y-s.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class qA{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),i.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(s,h,v){return this._calculateTransform(s,h,v)}touchmove(s,h,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!i.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,v)}}touchend(s,h,v){this._calculateTransform(s,h,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,v){v.length>0&&(this._active=!0);const w=Kg(v,h),P=new i.P(0,0),O=new i.P(0,0);let D=0;for(const W in w){const H=w[W],Q=this._touches[W];Q&&(P._add(H),O._add(H.sub(Q)),D++,w[W]=H)}if(this._touches=w,D<this._minTouches||!O.mag())return;const z=O.div(D);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(D),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class j_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,v){return{}}touchstart(s,h,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,v){const w=this._firstTwoTouches;if(!w)return;s.preventDefault();const[P,O]=w,D=Zg(v,h,P),z=Zg(v,h,O);if(!D||!z)return;const W=this._aroundCenter?null:D.add(z).div(2);return this._move([D,z],W,s)}touchend(s,h,v){if(!this._firstTwoTouches)return;const[w,P]=this._firstTwoTouches,O=Zg(v,h,w),D=Zg(v,h,P);O&&D||(this._active&&X(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Zg(y,s,h){for(let v=0;v<y.length;v++)if(y[v].identifier===h)return s[v]}function r1(y,s){return Math.log2(y/s)}class WA extends j_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const v=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(r1(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:r1(this._distance,v),pinchAround:h}}}function n1(y,s){return 180*y.angleWith(s)/Math.PI}class GA extends j_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const v=this._vector;if(this._vector=s[0].sub(s[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:n1(this._vector,v),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=n1(s,v);return Math.abs(w)<h}}function N_(y){return Math.abs(y.y)>Math.abs(y.x)}class HA extends j_{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,N_(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,v){const w=this._lastPoints;if(!w)return;const P=s[0].sub(w[0]),O=s[1].sub(w[1]);return this._map._cooperativeGestures&&!i.eT()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(P,O,v.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(P.y+O.y)/2*-.5})}gestureBeginsVertically(s,h,v){if(this._valid!==void 0)return this._valid;const w=s.mag()>=2,P=h.mag()>=2;if(!w&&!P)return;if(!w||!P)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const O=s.y>0==h.y>0;return N_(s)&&N_(h)&&O}}const KA={panStep:100,bearingStep:15,pitchStep:10};class ZA{constructor(){const s=KA;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,v=0,w=0,P=0,O=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?v=-1:(s.preventDefault(),P=-1);break;case 39:s.shiftKey?v=1:(s.preventDefault(),P=1);break;case 38:s.shiftKey?w=1:(s.preventDefault(),O=-1);break;case 40:s.shiftKey?w=-1:(s.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:D=>{const z=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:XA,zoom:h?Math.round(z)+h*(s.shiftKey?2:1):z,bearing:D.getBearing()+v*this._bearingStep,pitch:D.getPitch()+w*this._pitchStep,offset:[-P*this._panStep,-O*this._panStep],center:D.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function XA(y){return y*(2-y)}const YA=4.000244140625,hj=1/450;class fj{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=hj,i.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||i.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const v=i.o.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,h!==0&&h%YA==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=te(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const W=this._type==="wheel"&&Math.abs(this._delta)>YA?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*W)));this._delta<0&&H!==0&&(H=1/H);const Q=h(),K=Math.pow(2,Q),re=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(re*H))),this._type==="wheel"&&(this._startZoom=Q,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:h(),w=this._startZoom,P=this._easing;let O,D=!1;if(this._type==="wheel"&&w&&P){const W=Math.min((i.o.now()-this._lastWheelEventTime)/200,1),H=P(W);O=i.ak(w,v,H),W<1?this._frameId||(this._frameId=!0):D=!0}else O=v,D=!0;this._active=!0,D&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=O-h();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!D,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=i.eU;if(this._prevEase){const v=this._prevEase,w=(i.o.now()-v.start)/v.duration,P=v.easing(w+.01)-v.easing(w),O=.27/Math.sqrt(P*P+1e-4)*.01,D=Math.sqrt(.0729-O*O);h=i.eS(O,D,.25,1)}return this._prevEase={start:i.o.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=k("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ea{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class JA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(s.shiftKey?-1:1),around:v.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pj{constructor(){this._tap=new Zd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,v){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=h[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(s,h,v))}touchmove(s,h,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=h[0],P=w.y-this._swipePoint.y;return this._swipePoint=w,s.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(s,h,v)}touchend(s,h,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(s,h,v)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class mj{constructor(s,h,v){this._el=s,this._mousePan=h,this._touchPan=v}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gj{constructor(s,h,v){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xg{constructor(s,h,v,w){this._el=s,this._touchZoom=h,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Yg=y=>y.zoom||y.drag||y.pitch||y.rotate;class i1 extends i.z{}class M_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const v=i.av([],h,s);this.radius=i.ag(v[2]<0?i.eW([],v,this.constants):[v[0],v[1],0])}projectRay(s){i.eW(s,s,this.constants),i.aw(s,s),i.eX(s,s,this.constants);const h=i.c4([],s,this.radius);if(h[2]>0){const v=i.c4([],[0,0,1],i.bI(h,[0,0,1])),w=i.c4([],i.aw([],[h[0],h[1],0]),this.radius),P=i.d7([],h,i.c4([],i.av([],i.d7([],w,v),h),2));h[0]=P[0],h[1]=P[1]}return h}}function oc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class D_{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new O_(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new M_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),i.aX(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,P,O]of this._listeners){const D=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(P,D,O)}}destroy(){for(const[s,h,v]of this._listeners){const w=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,w,v)}}_addDefaultHandlers(s){const h=this._map,v=h.getCanvasContainer();this._add("mapEvent",new Xw(h,s));const w=h.boxZoom=new Yw(h,s);this._add("boxZoom",w);const P=new Qw,O=new JA;h.doubleClickZoom=new ea(O,P),this._add("tapZoom",P),this._add("clickZoom",O);const D=new pj;this._add("tapDragZoom",D);const z=h.touchPitch=new HA(h);this._add("touchPitch",z);const W=new R_(s),H=new t1(s);h.dragRotate=new gj(s,W,H),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Q=new e1(s),K=new qA(h,s);h.dragPan=new mj(v,Q,K),this._add("mousePan",Q),this._add("touchPan",K,["touchZoom","touchRotate"]);const re=new GA,le=new WA;h.touchZoomRotate=new Xg(v,le,re,D),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qh(h));const ue=h.scrollZoom=new fj(h,this);this._add("scrollZoom",ue,["mousePan"]);const xe=h.keyboard=new ZA;this._add("keyboard",xe);for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[me]&&h[me].enable(s[me])}_add(s,h,v){this._handlers.push({handlerName:s,handler:h,allowed:v}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,v){for(const w in s)if(w!==v&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const v of s)this._el.contains(v.target)&&h.push(v);return h}handleEvent(s,h){this._updatingCamera=!0;const v=s.type==="renderFrame",w=v?void 0:s,P={needsRenderFrame:!1},O={},D={},z=s.touches?this._getMapTouches(s.touches):void 0,W=z?se(this._el,z):v?void 0:te(this._el,s);for(const{handlerName:K,handler:re,allowed:le}of this._handlers){if(!re.isEnabled())continue;let ue;this._blockedByActive(D,le,K)?re.reset():re[h||s.type]&&(ue=re[h||s.type](s,W,z),this.mergeHandlerResult(P,O,ue,K,w),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||re.isActive())&&(D[K]=re)}const H={};for(const K in this._previousActiveHandlers)D[K]||(H[K]=w);this._previousActiveHandlers=D,(Object.keys(H).length||oc(P))&&(this._changes.push([P,O,H]),this._triggerRenderFrame()),(Object.keys(D).length||oc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=P;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))}mergeHandlerResult(s,h,v,w,P){if(!v)return;Object.assign(s,v);const O={handlerName:w,originalEvent:v.originalEvent||P};v.zoomDelta!==void 0&&(h.zoom=O),v.panDelta!==void 0&&(h.drag=O),v.pitchDelta!==void 0&&(h.pitch=O),v.bearingDelta!==void 0&&(h.rotate=O)}_applyChanges(){const s={},h={},v={};for(const[w,P,O]of this._changes)w.panDelta&&(s.panDelta=(s.panDelta||new i.P(0,0))._add(w.panDelta)),w.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(s.around=w.around),w.aroundCoord!==void 0&&(s.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(s.pinchAround=w.pinchAround),w.noInertia&&(s.noInertia=w.noInertia),Object.assign(h,P),Object.assign(v,O);this._updateMapTransform(s,h,v),this._changes=[]}_updateMapTransform(s,h,v){const w=this._map,P=w.transform,O=Ee=>[Ee.x,Ee.y,Ee.z];if((Ee=>{const Ie=this._eventsInProgress.drag;return Ie&&!this._handlersById[Ie.handlerName].isActive()})()&&!oc(s)){const Ee=P.zoom;P.cameraElevationReference="sea",this._originalZoom!=null&&P._orthographicProjectionAtLowPitch&&P.projection.name!=="globe"&&P.pitch===0?(P.cameraElevationReference="ground",P.zoom=this._originalZoom):(P.recenterOnTerrain(),P.cameraElevationReference="ground"),Ee!==P.zoom&&this._map._update(!0)}if(P._isCameraConstrained&&w._stop(!0),!oc(s))return void this._fireEvents(h,v,!0);let{panDelta:D,zoomDelta:z,bearingDelta:W,pitchDelta:H,around:Q,aroundCoord:K,pinchAround:re}=s;P._isCameraConstrained&&(z>0&&(z=0),P._isCameraConstrained=!1),re!==void 0&&(Q=re),(z||(Ee=>h[Ee]&&!this._eventsInProgress[Ee])("drag"))&&Q&&(this._dragOrigin=O(P.pointCoordinate3D(Q)),this._originalZoom=P.zoom,this._trackingEllipsoid.setup(P._camera.position,this._dragOrigin)),P.cameraElevationReference="sea",w._stop(!0),Q=Q||w.transform.centerPoint,W&&(P.bearing+=W),H&&(P.pitch+=H),P._updateCameraState();const le=[0,0,0];if(D)if(P.projection.name==="mercator"){const Ee=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Q).dir),Ie=this._trackingEllipsoid.projectRay(P.screenPointToMercatorRay(Q.sub(D)).dir);le[0]=Ie[0]-Ee[0],le[1]=Ie[1]-Ee[1]}else{const Ee=P.pointCoordinate(Q);if(P.projection.name==="globe"){D=D.rotate(-P.angle);const Ie=P._pixelsPerMercatorPixel/P.worldSize;le[0]=-D.x*i.eV(i.a_(Ee.y))*Ie,le[1]=-D.y*i.eV(P.center.lat)*Ie}else{const Ie=P.pointCoordinate(Q.sub(D));Ee&&Ie&&(le[0]=Ie.x-Ee.x,le[1]=Ie.y-Ee.y)}}const ue=P.zoom,xe=[0,0,0];if(z){const Ee=O(K||P.pointCoordinate3D(Q)),Ie={dir:i.aw([],i.av([],Ee,P._camera.position))};if(Ie.dir[2]<0){const Ae=P.zoomDeltaToMovement(Ee,z);i.c4(xe,Ie.dir,Ae)}}const me=i.d7(le,le,xe);P._translateCameraConstrained(me),z&&Math.abs(P.zoom-ue)>1e-4&&P.recenterOnTerrain(),P.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,v,!0)}_fireEvents(s,h,v){const w=Yg(this._eventsInProgress),P=Yg(s),O={};for(const H in s){const{originalEvent:Q}=s[H];this._eventsInProgress[H]||(O[`${H}start`]=Q),this._eventsInProgress[H]=s[H]}!w&&P&&this._fireEvent("movestart",P.originalEvent);for(const H in O)this._fireEvent(H,O[H]);P&&this._fireEvent("move",P.originalEvent);for(const H in s){const{originalEvent:Q}=s[H];this._fireEvent(H,Q)}const D={};let z;for(const H in this._eventsInProgress){const{handlerName:Q,originalEvent:K}=this._eventsInProgress[H];this._handlersById[Q].isActive()||(delete this._eventsInProgress[H],z=h[Q]||K,D[`${H}end`]=z)}for(const H in D)this._fireEvent(H,D[H]);const W=Yg(this._eventsInProgress);if(v&&(w||P)&&!W){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Q=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;H?(Q(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:z})):(this._map.fire(new i.z("moveend",{originalEvent:z})),Q(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new i.z(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new i1("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Ia="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class su extends i.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,i.aX(["_renderFrameCallback"],this)}getCenter(){return new i.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,v){return s=i.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},h),v)}panTo(s,h,v){return this.easeTo(Object.assign({center:s},h),v)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,v){return this.easeTo(Object.assign({zoom:s},h),v)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,v){return this.easeTo(Object.assign({bearing:s},h),v)}resetNorth(s,h){return this.rotateTo(0,Object.assign({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=i.aI.convert(s);const v=h&&h.bearing||0,w=h&&h.pitch||0,P=s.getNorthWest(),O=s.getSouthEast();return this._cameraForBounds(this.transform,P,O,v,w,h)}_extendPadding(s){const h={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},h,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){const v=h.max[0]-h.min[0],w=h.max[1]-h.min[1];return v/w>s.aspect?v/(2*Math.tan(.5*s.fovX)*s.aspect):w/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,v,w,P,O){const D=s.clone(),z=this._extendCameraOptions(O);D.bearing=w,D.pitch=P;const W=i.aS.convert(h),H=i.aS.convert(v),Q=.5*(W.lat+H.lat),K=.5*(W.lng+H.lng),re=i.eY(Q,K),le=i.aw([],re),ue=i.aw([],i.bH([],le,[0,1,0])),xe=i.bH([],ue,le),me=[ue[0],ue[1],ue[2],0,xe[0],xe[1],xe[2],0,le[0],le[1],le[2],0,0,0,0,1],Ee=[re,i.eY(W.lat,W.lng),i.eY(H.lat,W.lng),i.eY(H.lat,H.lng),i.eY(W.lat,H.lng),i.eY(Q,W.lng),i.eY(Q,H.lng),i.eY(W.lat,K),i.eY(H.lat,K)];let Ie=i.d8.fromPoints(Ee.map(mt=>[i.bI(ue,mt),i.bI(xe,mt),i.bI(le,mt)]));const Ae=i.af([],Ie.center,me);i.eZ(Ae)===0&&i.e_(Ae,0,0,1),i.aw(Ae,Ae),i.c4(Ae,Ae,i.aD),D.center=i.e$(Ae);const Be=D.getWorldToCameraMatrix(),Re=i.bk(new Float64Array(16),Be);Ie=i.d8.applyTransform(Ie,i.aB([],Be,me));const Ve=this._extendAABB(Ie,D,z,w);if(!Ve)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ie=Ve,i.af(Ae,Ae,Be);const Fe=.5*(Ie.max[2]-Ie.min[2]),Me=this._minimumAABBFrustumDistance(D,Ie),qe=i.c4([],[0,0,1],Fe),ot=i.d7(qe,Ae,qe),rt=Me+(D.pitch===0?0:i.bF(Ae,ot)),wt=D.globeCenterInViewSpace,pt=i.av([],Ae,[wt[0],wt[1],wt[2]]);i.aw(pt,pt),i.c4(pt,pt,rt);const Ot=i.d7([],Ae,pt);i.af(Ot,Ot,Re);const Kt=i.eL/i.aD,ht=i.ag(Ot),et=i.ce(Math.max(ht*Kt-i.eL,Number.EPSILON),0),It=Math.min(D.zoomFromMercatorZAdjusted(et),z.maxZoom);return It>.5*(i.cZ+i.cK)?(D.setProjection({name:"mercator"}),D.zoom=It,this._cameraForBounds(D,h,v,w,P,O)):{center:D.center,zoom:It,bearing:w,pitch:P}}_extendAABB(s,h,v,w){const P=.5*((v.padding.left||0)+(v.padding.right||0)),O=.5*((v.padding.top||0)+(v.padding.bottom||0)),D=O,z=P,W=P,H=O,Q=h.width-(z+W),K=h.height-(D+H),re=i.av([],s.max,s.min),le=Math.min(Q/re[0],K/re[1]),ue=Math.min(h.scaleZoom(h.scale*le),v.maxZoom);if(isNaN(ue))return null;const xe=h.scale/h.zoomScale(ue),me=new i.d8([s.min[0]-z*xe,s.min[1]-H*xe,s.min[2]],[s.max[0]+W*xe,s.max[1]+D*xe,s.max[2]]),Ee=(typeof v.offset.x=="number"&&typeof v.offset.y=="number"?new i.P(v.offset.x,v.offset.y):i.P.convert(v.offset)).rotate(-i.an(w));return me.center[0]-=Ee.x*xe,me.center[1]+=Ee.y*xe,me}queryTerrainElevation(s,h){const v=this.transform.elevation;return v?(h=Object.assign({},{exaggerated:!0},h),v.getAtPoint(i.ae.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,v,w,P,O){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,v,w,P,O);const D=s.clone(),z=this._extendCameraOptions(O);D.bearing=w,D.pitch=P;const W=i.aS.convert(h),H=i.aS.convert(v),Q=new i.aS(W.lng,H.lat),K=new i.aS(H.lng,W.lat),re=D.project(W),le=D.project(H),ue=this.queryTerrainElevation(W),xe=this.queryTerrainElevation(H),me=this.queryTerrainElevation(Q),Ee=this.queryTerrainElevation(K),Ie=[[re.x,re.y,Math.min(ue||0,xe||0,me||0,Ee||0)],[le.x,le.y,Math.max(ue||0,xe||0,me||0,Ee||0)]];let Ae=i.d8.fromPoints(Ie);const Be=D.getWorldToCameraMatrix(),Re=i.bk(new Float64Array(16),Be);Ae=i.d8.applyTransform(Ae,Be);const Ve=this._extendAABB(Ae,D,z,w);if(!Ve)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ae=Ve;const Fe=.5*i.av([],Ae.max,Ae.min)[2],Me=this._minimumAABBFrustumDistance(D,Ae),qe=[0,0,1,0];i.aC(qe,qe,Be),i.f0(qe,qe);const ot=i.c4([],qe,Me+Fe),rt=i.d7([],Ae.center,ot);i.af(Ae.center,Ae.center,Re),i.af(rt,rt,Re);const wt=D.unproject(new i.P(Ae.center[0],Ae.center[1])),pt=i.f1(D.projection,wt),Ot=Math.pow(2,pt),Kt=Math.min(D._zoomFromMercatorZ(rt[2]*D.pixelsPerMeter*Ot/D.worldSize),z.maxZoom);return D.mercatorFromTransition&&Kt<.5*(i.cZ+i.cK)?(D.setProjection({name:"globe"}),D.zoom=Kt,this._cameraForBounds(D,h,v,w,P,O)):{center:wt,zoom:Kt,bearing:w,pitch:P}}fitBounds(s,h,v){const w=this.cameraForBounds(s,h);return this._fitInternal(w,h,v)}fitScreenCoordinates(s,h,v,w,P){const O=i.P.convert(s),D=i.P.convert(h),z=new i.P(Math.min(O.x,D.x),Math.min(O.y,D.y)),W=new i.P(Math.max(O.x,D.x),Math.max(O.y,D.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(O,D))return this;const H=this.transform.pointLocation3D(z),Q=this.transform.pointLocation3D(W),K=this.transform.pointLocation3D(new i.P(z.x,W.y)),re=this.transform.pointLocation3D(new i.P(W.x,z.y)),le=[Math.min(H.lng,Q.lng,K.lng,re.lng),Math.min(H.lat,Q.lat,K.lat,re.lat)],ue=[Math.max(H.lng,Q.lng,K.lng,re.lng),Math.max(H.lat,Q.lat,K.lat,re.lat)],xe=w&&w.pitch?w.pitch:this.getPitch(),me=this._cameraForBounds(this.transform,le,ue,v,xe,w);return this._fitInternal(me,w,P)}_fitInternal(s,h,v){return s?(h=Object.assign(s,h)).linear?this.easeTo(h,v):this.flyTo(h,v):this}jumpTo(s,h){this.stop();const v=s.preloadOnly?this.transform.clone():this.transform;let w=!1,P=!1,O=!1;"zoom"in s&&v.zoom!==+s.zoom&&(w=!0,v.zoom=+s.zoom),s.center!==void 0&&(v.center=i.aS.convert(s.center)),"bearing"in s&&v.bearing!==+s.bearing&&(P=!0,v.bearing=+s.bearing),"pitch"in s&&v.pitch!==+s.pitch&&(O=!0,v.pitch=+s.pitch);const D=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!v.isPaddingEqual(D))if(s.retainPadding===!1){const z=v.clone();z.padding=D,v.setLocationAtPoint(v.center,z.centerPoint)}else v.padding=D;return s.preloadOnly?(this._preloadTiles(v),this):(this.fire(new i.z("movestart",h)).fire(new i.z("move",h)),w&&this.fire(new i.z("zoomstart",h)).fire(new i.z("zoom",h)).fire(new i.z("zoomend",h)),P&&this.fire(new i.z("rotatestart",h)).fire(new i.z("rotate",h)).fire(new i.z("rotateend",h)),O&&this.fire(new i.z("pitchstart",h)).fire(new i.z("pitch",h)).fire(new i.z("pitchend",h)),this.fire(new i.z("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Ia),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const v=this.transform;if(!v.projection.supportsFreeCamera)return i.w(Ia),this;this.stop();const w=v.zoom,P=v.pitch,O=v.bearing;v.setFreeCameraOptions(s);const D=w!==v.zoom,z=P!==v.pitch,W=O!==v.bearing;return this.fire(new i.z("movestart",h)).fire(new i.z("move",h)),D&&this.fire(new i.z("zoomstart",h)).fire(new i.z("zoom",h)).fire(new i.z("zoomend",h)),W&&this.fire(new i.z("rotatestart",h)).fire(new i.z("rotate",h)).fire(new i.z("rotateend",h)),z&&this.fire(new i.z("pitchstart",h)).fire(new i.z("pitch",h)).fire(new i.z("pitchend",h)),this.fire(new i.z("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:i.eU},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const v=this.transform,w=this.getZoom(),P=this.getBearing(),O=this.getPitch(),D=this.getPadding(),z="zoom"in s?+s.zoom:w,W="bearing"in s?this._normalizeBearing(s.bearing,P):P,H="pitch"in s?+s.pitch:O,Q=this._extendPadding(s.padding),K=i.P.convert(s.offset);let re,le,ue;if(v.projection.name==="globe"){const qe=i.ae.fromLngLat(v.center),ot=K.rotate(-v.angle);qe.x+=ot.x/v.worldSize,qe.y+=ot.y/v.worldSize;const rt=qe.toLngLat(),wt=i.aS.convert(s.center||rt);this._normalizeCenter(wt),re=v.centerPoint.add(ot),le=new i.P(qe.x,qe.y).mult(v.worldSize),ue=new i.P(i.aF(wt.lng),i.aJ(wt.lat)).mult(v.worldSize).sub(le)}else{re=v.centerPoint.add(K);const qe=v.pointLocation(re),ot=i.aS.convert(s.center||qe);this._normalizeCenter(ot),le=v.project(qe),ue=v.project(ot).sub(le)}const xe=v.zoomScale(z-w);let me,Ee;s.around&&(me=i.aS.convert(s.around),Ee=v.locationPoint(me));const Ie=this._zooming||z!==w,Ae=this._rotating||P!==W,Be=this._pitching||H!==O,Re=!v.isPaddingEqual(Q),Ve=s.retainPadding===!1?v.clone():v,Fe=qe=>ot=>{if(Ie&&(qe.zoom=i.ak(w,z,ot)),Ae&&(qe.bearing=i.ak(P,W,ot)),Be&&(qe.pitch=i.ak(O,H,ot)),Re&&(Ve.interpolatePadding(D,Q,ot),re=Ve.centerPoint.add(K)),me)qe.setLocationAtPoint(me,Ee);else{const rt=qe.zoomScale(qe.zoom-w),wt=z>w?Math.min(2,xe):Math.max(.5,xe),pt=Math.pow(wt,1-ot),Ot=qe.unproject(le.add(ue.mult(ot*pt)).mult(rt));qe.setLocationAtPoint(qe.renderWorldCopies?Ot.wrap():Ot,re)}return s.preloadOnly||this._fireMoveEvents(h),qe};if(s.preloadOnly){const qe=this._emulate(Fe,s.duration,v);return this._preloadTiles(qe),this}const Me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ie,this._rotating=Ae,this._pitching=Be,this._padding=Re,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,Me),this._ease(Fe(v),qe=>{v.cameraElevationReference==="sea"&&v.recenterOnTerrain(),this._afterEase(h,qe)},s),this}_prepareEase(s,h,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||v.moving||this.fire(new i.z("movestart",s)),this._zooming&&!v.zooming&&this.fire(new i.z("zoomstart",s)),this._rotating&&!v.rotating&&this.fire(new i.z("rotatestart",s)),this._pitching&&!v.pitching&&this.fire(new i.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new i.z("move",s)),this._zooming&&this.fire(new i.z("zoom",s)),this._rotating&&this.fire(new i.z("rotate",s)),this._pitching&&this.fire(new i.z("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new i.z("zoomend",s)),w&&this.fire(new i.z("rotateend",s)),P&&this.fire(new i.z("pitchend",s)),this.fire(new i.z("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){const mt=i.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(mt,h)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:i.eU},s);const v=this.transform,w=this.getZoom(),P=this.getBearing(),O=this.getPitch(),D=this.getPadding(),z="zoom"in s?i.aA(+s.zoom,v.minZoom,v.maxZoom):w,W="bearing"in s?this._normalizeBearing(s.bearing,P):P,H="pitch"in s?+s.pitch:O,Q=this._extendPadding(s.padding),K=v.zoomScale(z-w),re=i.P.convert(s.offset);let le=v.centerPoint.add(re);const ue=v.pointLocation(le),xe=i.aS.convert(s.center||ue);this._normalizeCenter(xe);const me=v.project(ue),Ee=v.project(xe).sub(me);let Ie=s.curve;const Ae=Math.max(v.width,v.height),Be=Ae/K,Re=Ee.mag();if("minZoom"in s){const mt=i.aA(Math.min(s.minZoom,w,z),v.minZoom,v.maxZoom),Lt=Ae/v.zoomScale(mt-w);Ie=Math.sqrt(Lt/Re*2)}const Ve=Ie*Ie;function Fe(mt){const Lt=(Be*Be-Ae*Ae+(mt?-1:1)*Ve*Ve*Re*Re)/(2*(mt?Be:Ae)*Ve*Re);return Math.log(Math.sqrt(Lt*Lt+1)-Lt)}function Me(mt){return(Math.exp(mt)-Math.exp(-mt))/2}function qe(mt){return(Math.exp(mt)+Math.exp(-mt))/2}const ot=Fe(0);let rt=function(mt){return qe(ot)/qe(ot+Ie*mt)},wt=function(mt){return Ae*((qe(ot)*(Me(Lt=ot+Ie*mt)/qe(Lt))-Me(ot))/Ve)/Re;var Lt},pt=(Fe(1)-ot)/Ie;if(Math.abs(Re)<1e-6||!isFinite(pt)){if(Math.abs(Ae-Be)<1e-6)return this.easeTo(s,h);const mt=Be<Ae?-1:1;pt=Math.abs(Math.log(Be/Ae))/Ie,wt=function(){return 0},rt=function(Lt){return Math.exp(mt*Ie*Lt)}}s.duration="duration"in s?+s.duration:1e3*pt/("screenSpeed"in s?+s.screenSpeed/Ie:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ot=P!==W,Kt=H!==O,ht=!v.isPaddingEqual(Q),et=s.retainPadding===!1?v.clone():v,It=mt=>Lt=>{const Jt=Lt*pt,yr=1/rt(Jt);mt.zoom=Lt===1?z:w+mt.scaleZoom(yr),Ot&&(mt.bearing=i.ak(P,W,Lt)),Kt&&(mt.pitch=i.ak(O,H,Lt)),ht&&(et.interpolatePadding(D,Q,Lt),le=et.centerPoint.add(re));const Wt=Lt===1?xe:mt.unproject(me.add(Ee.mult(wt(Jt))).mult(yr));return mt.setLocationAtPoint(mt.renderWorldCopies?Wt.wrap():Wt,le),mt._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),mt};if(s.preloadOnly){const mt=this._emulate(It,s.duration,v);return this._preloadTiles(mt),this}return this._zooming=!0,this._rotating=Ot,this._pitching=Kt,this._padding=ht,this._prepareEase(h,!1),this._ease(It(v),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,h)}if(!s){const v=this.handlers;v&&v.stop(!1)}return this}_ease(s,h,v){v.animate===!1||v.duration===0?(s(1),h()):(this._easeStart=i.o.now(),this._easeOptions=v,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((i.o.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=i.bS(s,-180,180);const v=Math.abs(s-h);return Math.abs(s-360-h)<v&&(s-=360),Math.abs(s+360-h)<v&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const v=s.lng-h.center.lng;s.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&i.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,v){const w=Math.ceil(15*h/1e3),P=[],O=s(v.clone());for(let D=0;D<=w;D++){const z=O(D/w);P.push(z.clone())}return P}_preloadTiles(s,h){}}class Cp{constructor(s={}){this.options=s,i.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact,v=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=k("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",v);const w=k("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",v),this._innerContainer=k("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(s){const v=h.reduce((w,P,O)=>(P.value&&(w+=`${P.key}=${P.value}${O<h.length-1?"&":""}`),w),"?");s.href=`${i.e.FEEDBACK_URL}/${v}#${C_(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style._mergedSourceCaches;for(const w in h){const P=h[w];if(P.used){const O=P.getSource();O.attribution&&s.indexOf(O.attribution)<0&&s.push(O.attribution)}}s.sort((w,P)=>w.length-P.length),s=s.filter((w,P)=>{for(let O=P+1;O<s.length;O++)if(s[O].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const v=s.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,s.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Jg{constructor(){i.aX(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=k("div","mapboxgl-ctrl");const h=k("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const v=s[h].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class a1{constructor(){i.aX(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",h=>this._onIndoorUpdate(h)),this._container}_createButton(s,h){const v=k("button",s,this._container);return v.type="button",v.addEventListener("click",h),v}_createSeparator(){return k("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,h){this._map&&(s.setAttribute("aria-label",h),s.textContent=h)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return this._model=s,void(this._container.style.display="none");const h=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px",h&&Array.from(this._container.children).forEach(v=>v.remove()),s.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(s.floors,s.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const s=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const h=this._map;this._model&&h&&h._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});k("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&s.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(s),this._createSeparator()}_updateBuildingsButtonState(){const s=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");s&&this._model&&(this._model.activeFloorsVisible?s.classList.remove("mapboxgl-ctrl-level-button-selected"):s.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(s,h){for(let v=0;v<s.length;v++){const w=s[v],P=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(w.id)});this._setButtonTitle(P,w.zIndex.toString()),this._model&&w.id===this._model.selectedFloorId&&h&&P.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(P),v<s.length-1&&this._createSeparator()}}}class QA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,v=h?this._queue.concat(h):this._queue;for(const w of v)if(w.id===s)return void(w.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const v of h)if(!v.cancelled&&(v.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Qg{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=i.dC((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,v){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+v}}const yj={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class e2 extends i.z{constructor(s,h,v,w){const{point:P,lngLat:O,originalEvent:D,target:z}=s;super(s.type,{point:P,lngLat:O,originalEvent:D,target:z}),this.preventDefault=()=>{s.preventDefault()},this.id=h,this.interaction=v,this.feature=w}}class o1{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,h){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const v=h.filter;let w=h.type;v&&this.filters.set(s,i.b5(v)),w==="mouseover"&&(w="mouseenter"),w==="mouseout"&&(w="mouseleave");const P=this.interactionsByType.get(w)||new Map;w==="mouseenter"||w==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,h)):P.size===0&&this.map.on(w,this.handleType),P.size===0&&this.interactionsByType.set(w,P),P.set(s,h),this.typeById.set(s,w)}get(s){const h=this.typeById.get(s);if(!h)return;const v=this.interactionsByType.get(h);return v?v.get(s):void 0}remove(s){const h=this.typeById.get(s);if(!h)return;this.typeById.delete(s),this.filters.delete(s);const v=this.interactionsByType.get(h);v&&(v.delete(s),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):v.size===0&&this.map.off(h,this.handleType))}queryTargets(s,h){const v=[];for(const[w,P]of h)P.target&&v.push({targetId:w,target:P.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(s,v,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());h.length&&(s.type="mouseenter",this.handleType(s,h));const v=new Map;for(const[w,{feature:P}]of this.prevHoveredFeatures)this.hoveredFeatures.has(w)||v.set(P.id,P);v.size&&(s.type="mouseleave",this.handleType(s,Array.from(v.values())))}handleOut(s){const h=Array.from(this.hoveredFeatures.values()).map(({feature:v})=>v);h.length&&(s.type="mouseleave",this.handleType(s,h)),this.hoveredFeatures.clear()}handleType(s,h){const v=s.type==="mouseenter";if(v&&!this.interactionsByType.has(s.type))return void i.w("mouseenter interaction required for mouseleave to work.");const w=Array.from(this.interactionsByType.get(s.type)).reverse(),P=!!h;h=h||this.queryTargets(s.point,w);let O=!1;const D=new Set;for(const z of h){for(const[W,H]of w){if(!H.target)continue;const Q=z.variants?z.variants[W]:null;if(Q){for(const K of Q){if(Zs(K,z,D,W))continue;const re=new i.dw(z,K),le=Pc(K,z,W);P&&re.id!==void 0&&(re.state=this.map.getFeatureState(re));const ue=v?this.prevHoveredFeatures.get(le):null,xe=new e2(s,W,H,re),me=ue?ue.stop:H.handler(xe);if(v&&this.hoveredFeatures.set(le,{feature:z,stop:me}),me!==!1){O=!0;break}}if(O)break}}if(O)break}if(!O)for(const[z,W]of w){const{handler:H,target:Q}=W;if(!Q&&H(new e2(s,z,W,null))!==!1)break}}}function s1(y,s){if(Array.isArray(y)&&Array.isArray(s)){const h=new Set(y),v=new Set(s);return h.size===v.size&&y.every(w=>v.has(w))}return i.bx(y,s)}const L_={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},F_={showCompass:!0,showZoom:!0,visualizePitch:!1};class ey{constructor(s,h,v=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new R_({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,v&&(this.mousePitch=new t1({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),i.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),B()}move(s,h){const v=this.map,w=this.mouseRotate.mousemoveWindow(s,h),P=w&&w.bearingDelta;if(P&&v.setBearing(v.getBearing()+P),this.mousePitch){const O=this.mousePitch.mousemoveWindow(s,h),D=O&&O.pitchDelta;D&&v.setPitch(v.getPitch()+D)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){U(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),te(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,te(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=se(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=se(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zu(y,s,h){if(y=new i.aS(y.lng,y.lat),s){const v=new i.aS(y.lng-360,y.lat),w=new i.aS(y.lng+360,y.lat),P=360*Math.ceil(Math.abs(y.lng-h.center.lng)/360),O=h.locationPoint3D(y).distSqr(s),D=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint3D(v).distSqr(s)<O&&(D||Math.abs(v.lng-h.center.lng)<P)?y=v:h.locationPoint3D(w).distSqr(s)<O&&(D||Math.abs(w.lng-h.center.lng)<P)&&(y=w)}for(;Math.abs(y.lng-h.center.lng)>180;){const v=h.locationPoint3D(y);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y}const Oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Vo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Xu extends i.E{constructor(s,h){super(),(s instanceof HTMLElement||h)&&(s=Object.assign({element:s},h)),i.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:v="center",color:w="#3FB1CE",scale:P=1,draggable:O=!1,clickTolerance:D=0,rotation:z=Vo.rotation,rotationAlignment:W=Vo.rotationAlignment,pitchAlignment:H=Vo.pitchAlignment,occludedOpacity:Q=Vo.occludedOpacity,altitude:K=Vo.altitude}=s||{};this._anchor=v,this._color=w,this._scale=P,this._draggable=O,this._clickTolerance=D,this._rotation=z,this._rotationAlignment=W,this._pitchAlignment=H,this._occludedOpacity=Q,this._altitude=K,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=i.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ue=>{ue.preventDefault()}),this._element.addEventListener("mousedown",ue=>{ue.preventDefault()});const re=this._element.classList;for(const ue in Oc)re.remove(`mapboxgl-marker-anchor-${ue}`);re.add(`mapboxgl-marker-anchor-${this._anchor}`);const le=s&&s.className?s.className.trim().split(/\s+/):[];re.add(...le),this._popup=null}_createDefaultMarker(){const s=k("div"),h=R("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const v=R("radialGradient",{id:"shadowGradient"},R("defs",{},h));R("stop",{offset:"10%","stop-opacity":.4},v),R("stop",{offset:"100%","stop-opacity":.05},v),R("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return R("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),R("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),R("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=i.aS.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||Vo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,v=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,v=this._element;this._popup&&(h===v||v.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const v=s.unproject(h,this._altitude),w=s.getFreeCameraOptions();if(!w.position)return!1;const P=w.position.toLngLat();return P.distanceTo(v)<.9*P.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const v=s.unproject(h,this._altitude);let w;s._showingGlobe()&&i.f4(s.transform,this._lngLat)?w=0:(w=1-s._queryFogOpacity(v),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Oc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const s=this._pos,h=this._map,v=this.getPitchAlignment();if(!h||!s||v!=="map")return"";if(!h._showingGlobe()){const z=h.getPitch();return z?`rotateX(${z}deg)`:""}const w=i.cW(i.f5(h.transform,this._lngLat)),P=s.sub(i.f6(h.transform)),O=Math.abs(P.x)+Math.abs(P.y);if(O===0)return"";const D=w/O;return`rotateX(${-P.y*D}deg) rotateY(${P.x*D}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let v=0;const w=this.getRotationAlignment();if(w==="map")if(h._showingGlobe()){const P=h.project(new i.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),O=h.project(new i.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(P);v=i.cW(Math.atan2(O.y,O.x))-90}else v=-h.getBearing();else if(w==="horizon"){const P=i.ah(4,6,h.getZoom()),O=i.f6(h.transform);O.y+=P*h.transform.height;const D=s.sub(O),z=i.cW(Math.atan2(D.y,D.x));v=(z>90?z-270:z+90)*(1-P)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Zu(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=i.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const h=this._map;if(!h)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const P=this._clickTolerance||h._clickTolerance;if(s.point.dist(v)<P)return;this._isDragging=!0}this._pos=s.point.sub(w),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.z("dragstart"))),this.fire(new i.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.z("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,v=this._pos;h&&v&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(v),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||Vo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||Vo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||Vo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||Vo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},vj={maxWidth:100,unit:"metric"},_j={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},xj={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},bj=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function l1(y=new i.P(0,0),s="bottom"){if(typeof y=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(y,2)));switch(s){case"top":return new i.P(0,y);case"top-left":return new i.P(h,h);case"top-right":return new i.P(-h,h);case"bottom":return new i.P(0,-y);case"bottom-left":return new i.P(h,-h);case"bottom-right":return new i.P(-h,-h);case"left":return new i.P(y,0);case"right":return new i.P(-y,0)}return new i.P(0,0)}return y instanceof i.P||Array.isArray(y)?i.P.convert(y):i.P.convert(y[s]||[0,0])}return{version:g,supported:N.supported,setRTLTextPlugin:i.fa,getRTLTextPluginStatus:i.f9,Map:class extends su{constructor(y){S.mark(x.create);const s=y;if((y=Object.assign({},L_,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(y.antialias&&i.f2(window)&&(y.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tp(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies,null,null),y),this._repaint=!!y.repaint,this._interactive=y.interactive,this._minTileCacheSize=y.minTileCacheSize,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=y.crossSourceCollisions,this._collectResourceTiming=y.collectResourceTiming,this._language=this._parseLanguage(y.language),this._worldview=y.worldview,this._renderTaskQueue=new QA,this._domRenderTaskQueue=new QA,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.b1(),this._locale=Object.assign({},yj,y.locale),this._clickTolerance=y.clickTolerance,this._cooperativeGestures=y.cooperativeGestures,this._performanceMetricsCollection=y.performanceMetricsCollection,this._tessellationStep=y.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=y.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Qg(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=y.scaleFactor,this._requestManager=new he(y.transformRequest,y.accessToken,y.testMode),this._silenceAuthErrors=!!y.testMode,this._contextCreateOptions=y.contextCreateOptions?Object.assign({},y.contextCreateOptions):{},typeof y.container=="string"){const h=document.getElementById(y.container);if(!h)throw new Error(`Container '${y.container.toString()}' not found.`);this._container=h}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),y.maxBounds&&this.setMaxBounds(y.maxBounds),this._spriteFormat=y.spriteFormat,i.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new uj),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new D_(this,y),this._localFontFamily=y.localFontFamily,this._localIdeographFontFamily=y.localIdeographFontFamily,(y.style||!y.testMode)&&this.setStyle(y.style||i.e.DEFAULT_STYLE,{config:y.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),y.projection&&this.setProjection(y.projection),y.hash&&(this._hash=new P_(typeof y.hash=="string"&&y.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch});const h=y.bounds;h&&(this.resize(),this.fitBounds(h,Object.assign({},y.fitBoundsOptions,{duration:0})))}this.resize(),y.attributionControl&&this.addControl(new Cp({customAttribution:y.customAttribution})),this._logoControl=new Jg,this.addControl(this._logoControl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new i.z(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new i.z(`${h.dataType}dataloading`,h))}),this._interactions=new o1(this)}_getMapId(){return this._mapId}addControl(y,s){if(s===void 0&&(s=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new i.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const v=this._controlPositions[s];return s.indexOf("bottom")!==-1?v.insertBefore(h,v.firstChild):v.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new i.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(y);return s>-1&&this._controls.splice(s,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(y){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new i.z("movestart",y)).fire(new i.z("move",y)),this.fire(new i.z("resize",y)),s&&this.fire(new i.z("moveend",y)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(y){return this.transform.setMaxBounds(i.aI.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y?this.setZoom(y):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y?this.setZoom(y):this.fire(new i.z("zoomstart")).fire(new i.z("zoom")).fire(new i.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y?this.setPitch(y):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y?this.setPitch(y):this.fire(new i.z("pitchstart")).fire(new i.z("pitch")).fire(new i.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(y){return this._scaleFactor=y,this.painter.scaleFactor=y,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(y){return y==="auto"?navigator.language:Array.isArray(y)?y.length===0?void 0:y.map(s=>s==="auto"?navigator.language:s):y}setLanguage(y){const s=this._parseLanguage(y);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(y){return this.style&&y!==this._worldview?(this._worldview=y,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(y){return this._lazyInitEmptyStyle(),y?typeof y=="string"&&(y={name:y}):y=null,this._useExplicitProjection=!!y,this._prioritizeAndUpdateProjection(y,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const y=this.transform,s=y.projection.name;let h;s==="globe"&&y.zoom>=i.cK?(y.setMercatorFromTransition(),h=!0):s==="mercator"&&y.zoom<i.cK&&(y.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(y,s){return this._updateProjection(y||s||{name:"mercator"})}_updateProjection(y){let s;const h=this.transform.mercatorFromTransition;s=y.name==="globe"&&this.transform.zoom>=i.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(y),this.style.applyProjectionUpdate();const v=this.transform.getProjection().name==="mercator"&&h!==this.transform.mercatorFromTransition;return(s||v)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(y,s){return this.transform.locationPoint3D(i.aS.convert(y),s)}unproject(y,s){return this.transform.pointLocation3D(i.P.convert(y),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(y,s,h){const v=w=>{let P=[];if(Array.isArray(s)){const O=s.filter(D=>this.getLayer(D));P=O.length?this.queryRenderedFeatures(w,{layers:O}):[]}else P=this.queryRenderedFeatures(w,{target:s});return P};if(y==="mouseenter"||y==="mouseover"){let w=!1;return{listener:h,targets:s,delegates:{mousemove:O=>{const D=v(O.point);D.length?w||(w=!0,h.call(this,new Gi(y,this,O.originalEvent,{features:D}))):w=!1},mouseout:()=>{w=!1}}}}if(y==="mouseleave"||y==="mouseout"){let w=!1;return{listener:h,targets:s,delegates:{mousemove:D=>{v(D.point).length?w=!0:w&&(w=!1,h.call(this,new Gi(y,this,D.originalEvent)))},mouseout:D=>{w&&(w=!1,h.call(this,new Gi(y,this,D.originalEvent)))}}}}{const w=P=>{const O=v(P.point);O.length&&(P.features=O,h.call(this,P),delete P.features)};return{listener:h,targets:s,delegates:{[y]:w}}}}on(y,s,h){if(typeof s=="function"||h===void 0)return super.on(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._createDelegatedListener(y,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(y,s,h){if(typeof s=="function"||h===void 0)return super.once(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._createDelegatedListener(y,s,h);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(y,s,h){if(typeof s=="function"||h===void 0)return super.off(y,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const v=this._delegatedListeners?this._delegatedListeners[y]:void 0;return v&&(w=>{for(let P=0;P<w.length;P++){const O=w[P];if(O.listener===h&&s1(O.targets,s)){for(const D in O.delegates)this.off(D,O.delegates[D]);return w.splice(P,1),this}}})(v),this}queryRenderedFeatures(y,s){if(!this.style)return[];if(y===void 0||y instanceof i.P||Array.isArray(y)||s!==void 0||(s=y,y=void 0),y=y||[[0,0],[this.transform.width,this.transform.height]],!s){const P=this.style.queryRenderedFeatures(y,void 0,this.transform),O=this.style.queryRenderedFeatureset(y,void 0,this.transform);return P.concat(O)}let h=!0;if(s.target&&(h=this._isTargetValid(s.target),h&&!s.layers))return this.style.queryRenderedFeatureset(y,s,this.transform);let v=!0;if(s.layers&&Array.isArray(s.layers)){for(const P of s.layers)if(!this._isValidId(P)){v=!1;break}if(v&&!s.target)return this.style.queryRenderedFeatures(y,s,this.transform)}let w=[];return v&&(w=w.concat(this.style.queryRenderedFeatures(y,s,this.transform))),h&&(w=w.concat(this.style.queryRenderedFeatureset(y,s,this.transform))),w}querySourceFeatures(y,s){return!y||typeof y=="string"&&!this._isValidId(y)?[]:this.style.querySourceFeatures(y,s)}queryRasterValue(y,s,h){return this._isValidId(y)?this.style.queryRasterValue(y,s,h):Promise.resolve(null)}isPointOnSurface(y){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&i.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(y))}addInteraction(y,s){return this._interactions.add(y,s),this}removeInteraction(y){return this._interactions.remove(y),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(y){return this._cooperativeGestures=y,this}setStyle(y,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&y&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(y,(h,v)=>{if(h){const w=typeof h=="string"?h:h instanceof Error?h.message:h.error;i.w(`Unable to perform style diff: ${w}. Rebuilding the style from scratch.`),this._updateStyle(y,s)}else v&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(y,s))}_getUIString(y){const s=this._locale[y];if(s==null)throw new Error(`Missing UI string '${y}'`);return s}_updateStyle(y,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),y){const h=Object.assign({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new rc(this,h).load(y),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new rc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(y){return y==null?(this.fire(new i.y(new Error("IDs can't be empty."))),!1):!i.dq(y)||(this.fire(new i.y(new Error(`IDs can't contain special symbols: "${y}".`))),!1)}_isTargetValid(y){return"featuresetId"in y?this._isValidId("importId"in y?y.importId:y.featuresetId):"layerId"in y&&this._isValidId(y.layerId)}_areTargetsValid(y){if(Array.isArray(y)){for(const s of y)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(y)}addSource(y,s){return this._isValidId(y)?(this._lazyInitEmptyStyle(),this.style.addSource(y,s),this._update(!0)):this}isSourceLoaded(y){return!!this._isValidId(y)&&!!this.style&&this.style._isSourceCacheLoaded(y)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(y,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(y,s,h)}removeSource(y){return this._isValidId(y)?(this.style.removeSource(y),this._updateTerrain(),this._update(!0)):this}getSource(y){return this._isValidId(y)?this.style.getOwnSource(y):null}addImage(y,s,{pixelRatio:h=1,sdf:v=!1,stretchX:w,stretchY:P,content:O}={}){this._lazyInitEmptyStyle();const D=i.I.from(y);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:z,height:W,data:H}=i.o.getImageData(s);this.style.addImage(D,{data:new i.q({width:z,height:W},H),pixelRatio:h,stretchX:w,stretchY:P,content:O,sdf:v,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new i.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:z,height:W}=s,H=s;this.style.addImage(D,{data:new i.q({width:z,height:W},new Uint8Array(H.data)),pixelRatio:h,stretchX:w,stretchY:P,content:O,sdf:v,usvg:!1,version:0,userImage:H}),H.onAdd&&H.onAdd(this,y)}}updateImage(y,s){this._lazyInitEmptyStyle();const h=i.I.from(y),v=this.style.getImage(h);if(!v)return void this.fire(new i.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const w=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?i.o.getImageData(s):s,{width:P,height:O,data:D}=w;if(P===void 0||O===void 0)return void this.fire(new i.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(P!==(v.usvg?v.icon.usvg_tree.width:v.data.width)||O!==(v.usvg?v.icon.usvg_tree.height:v.data.height))return void this.fire(new i.y(new Error(`The width and height of the updated image (${P}, ${O})
                must be that same as the previous version of the image
                (${v.data.width}, ${v.data.height})`)));const z=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let W=!1;v.usvg?(v.data=new i.q({width:P,height:O},new Uint8Array(D)),v.usvg=!1,v.icon=void 0,W=!0):v.data.replace(D,z),this.style.updateImage(h,v,W)}hasImage(y){return y?!!this.style&&!!this.style.getImage(i.I.from(y)):(this.fire(new i.y(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(i.I.from(y))}loadImage(y,s){i.n(this._requestManager.transformRequest(y,i.R.Image),(h,v)=>{s(h,v instanceof HTMLImageElement?i.o.getImageData(v):v)})}listImages(){return this.style.listImages().map(y=>y.name)}addModel(y,s){this._lazyInitEmptyStyle(),this.style.addModel(y,s)}hasModel(y){return y?this.style.hasModel(y):(this.fire(new i.y(new Error("Missing required model id"))),!1)}removeModel(y){this.style.removeModel(y)}listModels(){return this.style.listModels()}addLayer(y,s){return this._isValidId(y.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(y,s),this._update(!0)):this}getSlot(y){const s=this.getLayer(y);return s&&s.slot||null}setSlot(y,s){return this.style.setSlot(y,s),this.style.mergeLayers(),this._update(!0)}addImport(y,s){return this.style.addImport(y,s).catch(h=>this.fire(new i.y(new Error("Failed to add import",h)))),this}updateImport(y,s){return typeof s!="string"&&s.id!==y?(this.removeImport(y),this.addImport(s)):(this.style.updateImport(y,s),this._update(!0))}removeImport(y){return this.style.removeImport(y),this}moveImport(y,s){return this.style.moveImport(y,s),this._update(!0)}moveLayer(y,s){return this._isValidId(y)?(this.style.moveLayer(y,s),this._update(!0)):this}removeLayer(y){return this._isValidId(y)?(this.style.removeLayer(y),this._update(!0)):this}getLayer(y){if(!this._isValidId(y))return null;const s=this.style.getOwnLayer(y);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(y,s,h){return this._isValidId(y)?(this.style.setLayerZoomRange(y,s,h),this._update(!0)):this}setFilter(y,s,h={}){return this._isValidId(y)?(this.style.setFilter(y,s,h),this._update(!0)):this}getFilter(y){return this._isValidId(y)?this.style.getFilter(y):null}setPaintProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setPaintProperty(y,s,h,v),this._update(!0)):this}getPaintProperty(y,s){return this._isValidId(y)?this.style.getPaintProperty(y,s):null}setLayoutProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setLayoutProperty(y,s,h,v),this._update(!0)):this}getLayoutProperty(y,s){return this._isValidId(y)?this.style.getLayoutProperty(y,s):null}setLayerProperty(y,s,h,v={}){return this._isValidId(y)?(this.style.setLayerProperty(y,s,h,v),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(y){return this.style.setGlyphsUrl(y),this._update(!0)}getSchema(y){return this.style.getSchema(y)}setSchema(y,s){return this.style.setSchema(y,s),this._update(!0)}getConfig(y){return this.style.getConfig(y)}setConfig(y,s){return this.style.setConfig(y,s),this._update(!0)}getConfigProperty(y,s){return this.style.getConfigProperty(y,s)}setConfigProperty(y,s,h){return this.style.setConfigProperty(y,s,h),this._update(!0)}getFeaturesetDescriptors(y){return this.style.getFeaturesetDescriptors(y)}setLights(y){if(this._lazyInitEmptyStyle(),y&&y.length===1&&y[0].type==="flat"){const s=y[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(y),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const y=this.style.getLights()||[];return y.length===0&&y.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),y}setLight(y,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:y}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(y){return this._lazyInitEmptyStyle(),!y&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(y),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(y){return this._lazyInitEmptyStyle(),this.style.setFog(y),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(y){return this._lazyInitEmptyStyle(),this.style.setSnow(y),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(y){return this._lazyInitEmptyStyle(),this.style.setRain(y),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(y){return this._lazyInitEmptyStyle(),this.style.setColorTheme(y),this._update(!0)}setImportColorTheme(y,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(y,s),this._update(!0)}setCamera(y){return this.style.setCamera(y),this._triggerCameraUpdate(y)}_triggerCameraUpdate(y){return this._update(this.transform.setOrthographicProjectionAtLowPitch(y["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(y){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.aS.convert(y),this.transform):0}setFeatureState(y,s){return y.source&&!this._isValidId(y.source)?this:(this.style.setFeatureState(y,s),this._update())}removeFeatureState(y,s){return y.source&&!this._isValidId(y.source)?this:(this.style.removeFeatureState(y,s),this._update())}getFeatureState(y){return y.source&&!this._isValidId(y.source)?null:this.style.getFeatureState(y)}_selectIndoorFloor(y){this.indoor.selectFloor(y)}_setIndoorActiveFloorsVisibility(y){this.indoor.setActiveFloorsVisibility(y)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new a1),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const y=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,v,w,P=this._container;for(;P&&(!v||!w);){const O=window.getComputedStyle(P).transform;O&&O!=="none"&&(h=O.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(v=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(w=h[3])),P=P.parentElement}this._containerWidth=v?Math.abs(y/v):y,this._containerHeight=w?Math.abs(s/w):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Vh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=k("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=k("div","mapboxgl-canvas-container",y);this._canvas=k("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=k("div","mapboxgl-control-container",y),v=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{v[w]=k("div",`mapboxgl-ctrl-${w}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,s){const h=i.o.devicePixelRatio||1;this._canvas.width=h*Math.ceil(y),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${s}px`}_addMarker(y){this._markers.push(y)}_removeMarker(y){const s=this._markers.indexOf(y);s!==-1&&this._markers.splice(s,1)}_addPopup(y){this._popups.push(y)}_removePopup(y){const s=this._popups.indexOf(y);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const y=Object.assign({},N.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",y);s?(Vt(s,!0),this.painter=new Hd(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.k.testSupport(s)):this.fire(new i.y(new Error("Failed to initialize WebGL")))}_contextLost(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.z("webglcontextlost",{originalEvent:y}))}_contextRestored(y){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new i.z("webglcontextrestored",{originalEvent:y}))}_onMapScroll(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_requestDomTask(y){!this.loaded()||this.loaded()&&!this.isMoving()?y():this._domRenderTaskQueue.add(y)}_render(y){let s;this.fire(new i.z("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,v=i.o.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=w.createQuery(),w.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(y),this._domRenderTaskQueue.run(y),this._removed)return;this._updateProjectionTransition();const P=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const W=this.transform.zoom,H=this.transform.pitch,Q=i.o.now(),K=new i.ac(W,{now:Q,fadeDuration:P,pitch:H,transition:this.style.transition,worldview:this._worldview});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let O=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),O=this._updateAverageElevation(v),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):O=this._updateAverageElevation(v);const D=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,P,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),D&&(this._placementDirty=D.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:P,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,S.mark(x.load),this.fire(new i.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const W=i.o.now()-v;w.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const H=w.getQueryParameter(s,w.QUERY_RESULT)/1e6;w.deleteQuery(s),this.fire(new i.z("gpu-timing-frame",{cpuTime:W,gpuTime:H}))},50)}if(this.listens("gpu-timing-layer")){const W=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(W);this.fire(new i.z("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const W=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(W);this.fire(new i.z("gpu-timing-deferred-render",{gpuTime:H}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||O;if(z||this._repaint)this.triggerRepaint();else{const W=this.idle();if(W&&(O=this._updateAverageElevation(v,!0)),O)this.triggerRepaint();else if(this._triggerFrame(!1),W&&(this.fire(new i.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new i.z("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,S.mark(x.fullLoad),this._performanceMetricsCollection&&ut(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(y){for(const s of this._markers)y&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!y||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(y,s=!1){const h=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(s||y-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(y)){const w=this.transform.averageElevation;let P=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(P)?P=0:this._averageElevationLastSampledAt=y;const O=Math.abs(w-P);if(O>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(P),h(P);this._averageElevation.easeTo(P,y,300)}else if(O>1e-4)return this._averageElevation.jumpTo(P),h(P)}return!!this._averageElevation.isEasing(y)&&h(this._averageElevation.getValue(y))}_authenticate(){xt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,y=>{if(y&&(y.message===ie||y.status===401)){const s=this.painter.context.gl;Vt(s,!1),this._logoControl instanceof Jg&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new i.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Qe(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&$e(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&ft(this._requestManager._customAccessToken)}_updateTerrain(){const y=this._isDragging();this.painter.updateTerrain(this.style,y)}_calculateSpeedIndex(){const y=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,v=h.createFramebuffer();function w(P){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,P,0);const O=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,O),O}return h.bindFramebuffer(h.FRAMEBUFFER,v),this._canvasPixelComparison(w(y),s.canvasCopies.map(w),s.timeStamps)}_canvasPixelComparison(y,s,h){let v=h[1]-h[0];const w=y.length/4;for(let P=0;P<s.length;P++){const O=s[P];let D=0;for(let z=0;z<O.length;z+=4)O[z]===y[z]&&O[z+1]===y[z+1]&&O[z+2]===y[z+2]&&O[z+3]===y[z+3]&&(D+=1);v+=(h[P+2]-h[P+1])*(1-D/w)}return v}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const y=this.painter.context.gl.getExtension("WEBGL_lose_context");y&&y.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nr.delete(this.painter.context.gl),At.remove(),ke.remove(),this._removed=!0,this.fire(new i.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(y){this._renderNextFrame=this._renderNextFrame||y,this.style&&!this._frame&&(this._frame=i.o.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(y){const s=this.style?this.style.getSourceCaches():[];return i.bv(s,(h,v)=>h._preloadTiles(y,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(y){this._trackResize&&this.resize({originalEvent:y})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(y){this._showParseStatus!==y&&(this._showParseStatus=y,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(y){this._showTerrainWireframe!==y&&(this._showTerrainWireframe=y,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(y){this._showLayers2DWireframe!==y&&(this._showLayers2DWireframe=y,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(y){this._showLayers3DWireframe!==y&&(this._showLayers3DWireframe=y,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(y){this._speedIndexTiming!==y&&(this._speedIndexTiming=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,this._tp.refreshUI(),y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(y){this._showTileAABBs!==y&&(this._showTileAABBs=y,this._tp.refreshUI(),y&&this._update())}_setCacheLimits(y,s){i.f3(y,s)}get version(){return g}},NavigationControl:class{constructor(y={}){this.options=Object.assign({},F_,y),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(i.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),k("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),k("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=k("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const y=this._map;if(!y)return;const s=y.getZoom(),h=s===y.getMaxZoom(),v=s===y.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const y=this._map;if(!y)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(y.transform.pitch*(Math.PI/180)),.5)}) rotateX(${y.transform.pitch}deg) rotateZ(${y.transform.angle*(180/Math.PI)}deg)`:`rotate(${y.transform.angle*(180/Math.PI)}deg)`;y._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),y.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&y.on("pitch",this._rotateCompassArrow),y.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ey(y,this._compass,this.options.visualizePitch)),this._container}onRemove(){const y=this._map;y&&(this._container.remove(),this.options.showZoom&&y.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&y.off("pitch",this._rotateCompassArrow),y.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(y,s){const h=k("button",y,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(y,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);y.setAttribute("aria-label",h),y.firstElementChild&&y.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends i.E{constructor(y={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},Ic,y),i.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Jh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(y){return this._map=y,this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(y){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,y(h)};this._supportsGeolocation!==void 0?y(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(y){const s=this._map.getMaxBounds(),h=y.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(y){if(this._map){if(this._isOutOfMapMaxBounds(y))return this._setErrorState(),this.fire(new i.z("outofmaxbounds",y)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=y,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(y),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(y),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("geolocate",Object.assign({coords:y.coords,timestamp:y.timestamp},y.toJSON?{toJSON:y.toJSON.bind(y)}:{}))),this._finish()}}_updateCamera(y){const s=new i.aS(y.coords.longitude,y.coords.latitude),h=y.coords.accuracy,v=this._map.getBearing(),w=Object.assign({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),w,{geolocateSource:!0})}_updateMarker(y){if(y){const s=new i.aS(y.coords.longitude,y.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=y.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const y=this._map.transform,s=i.ce(1,y._center.lat)*y.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(y){if(this._map){if(this.options.trackUserLocation)if(y.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(y.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.z("error",y)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(y){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=k("button","mapboxgl-ctrl-geolocate",this._container),k("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",y===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k("div","mapboxgl-user-location"),this._dotElement.appendChild(k("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(k("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Xu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=k("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.z("trackuserlocationend")))})}}_onDeviceOrientation(y){this._userLocationDotMarker&&(y.webkitCompassHeading?this._heading=y.webkitCompassHeading:y.absolute===!0&&(this._heading=-1*y.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(y={maximumAge:6e5,timeout:0},this._noTimeout=!0):(y=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,y),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const y=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&y()}).catch(console.error):y()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Cp,ScaleControl:class{constructor(y={}){this.options=Object.assign({},vj,y),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const y=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,v=s._containerWidth/2-y/2,w=s.unproject([v,h]),P=s.unproject([v+y,h]),O=w.distanceTo(P);if(this.options.unit==="imperial"){const D=3.2808*O;D>5280?this._setScale(y,D/5280,"mile"):this._setScale(y,D,"foot")}else this.options.unit==="nautical"?this._setScale(y,O/1852,"nautical-mile"):O>=1e3?this._setScale(y,O/1e3,"kilometer"):this._setScale(y,O,"meter")}_setScale(y,s,h){this._map._requestDomTask(()=>{const v=function(P){const O=Math.pow(10,`${Math.floor(P)}`.length-1);let D=P/O;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(z){const W=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*W)/W}(D),O*D}(s),w=v/s;this._container.innerHTML=this._isNumberFormatSupported&&h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(v):`${v}&nbsp;${_j[h]}`,this._container.style.width=y*w+"px"})}onAdd(y){return this._map=y,this._language=y.getLanguage(),this._container=k("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(y){this._language=y,this._update()}setUnit(y){this.options.unit=y,this._update()}},FullscreenControl:class{constructor(y={}){this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:i.w("Full screen control 'container' must be a DOM element.")),i.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const y=this._fullscreenButton=k("button","mapboxgl-ctrl-fullscreen",this._controlContainer);k("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",y)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:a1,Popup:class extends i.E{constructor(y){super(),this.options=Object.assign(Object.create(xj),y),this._altitude=this.options.altitude,i.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(y&&y.className?y.className.trim().split(/\s+/):[])}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&y.on("preclick",this._onClose),this.options.closeOnMove&&y.on("move",this._onClose),y.on("remove",this.remove),this._update(),y._addPopup(this),this._focusFirstElement(),this._trackPointer?(y.on("mousemove",this._onMouseEvent),y.on("mouseup",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")):y.on("move",this._update),this.fire(new i.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const y=this._map;return y&&(y.off("move",this._update),y.off("move",this._onClose),y.off("preclick",this._onClose),y.off("click",this._onClose),y.off("remove",this.remove),y.off("mousemove",this._onMouseEvent),y.off("mouseup",this._onMouseEvent),y.off("drag",this._onMouseEvent),y._canvasContainer&&y._canvasContainer.classList.remove("mapboxgl-track-pointer"),y._removePopup(this),this._map=void 0),this.fire(new i.z("close")),this}getLngLat(){return this._lngLat}setLngLat(y){this._lngLat=i.aS.convert(y),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(y){return this._altitude=y,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const y=this._map;return y&&(y.off("move",this._update),y.on("mousemove",this._onMouseEvent),y.on("drag",this._onMouseEvent),y._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const s=document.createDocumentFragment(),h=document.createElement("body");let v;for(h.innerHTML=y;v=h.firstChild,v;)s.appendChild(v);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=k("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(y),this.options.closeButton){const h=this._closeButton=k("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(y){return this._classList.add(y),this._updateClassList(),this}removeClassName(y){return this._classList.delete(y),this._updateClassList(),this}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){let s;return this._classList.delete(y)?s=!1:(this._classList.add(y),s=!0),this._updateClassList(),s}_onMouseEvent(y){this._update(y.point)}_getAnchor(y){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,v=this._pos;if(!s||!h||!v)return"bottom";const w=h.offsetWidth,P=h.offsetHeight,O=v.x<w/2,D=v.x>s.transform.width-w/2;if(v.y+y<P)return O?"top-left":D?"top-right":"top";if(v.y>s.transform.height-P){if(O)return"bottom-left";if(D)return"bottom-right"}return O?"left":D?"right":"bottom"}_updateClassList(){const y=this._container;if(!y)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),y.className=s.join(" ")}_update(y){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let v=this._container;if(v||(v=this._container=k("div","mapboxgl-popup",s.getContainer()),this._tip=k("div","mapboxgl-popup-tip",v),v.appendChild(h)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zu(this._lngLat,this._pos,s.transform)),!this._trackPointer||y){const w=this._pos=this._trackPointer&&y instanceof i.P?y:s.project(this._lngLat,this._altitude),P=l1(this.options.offset),O=this._anchor=this._getAnchor(P.y),D=l1(this.options.offset,O),z=w.add(D).round();s._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Oc[O]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&s._showingGlobe()){const w=i.f4(s.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(bj);y&&y.focus()}_onClose(){this.remove()}_setOpacity(y){this._container&&(this._container.style.opacity=`${y}`),this._content&&(this._content.style.pointerEvents=y?"auto":"none")}},Marker:Xu,Style:rc,LngLat:i.aS,LngLatBounds:i.aI,Point:i.P,MercatorCoordinate:i.ae,FreeCameraOptions:iu,Evented:i.E,config:i.e,prewarm:i.f8,clearPrewarmedResources:i.f7,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(y){i.e.ACCESS_TOKEN=y},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(y){i.e.API_URL=y},get workerCount(){return i.fh.workerCount},set workerCount(y){i.fh.workerCount=y},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){i.e.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage(y){i.fg(y)},get workerUrl(){return i.ff.workerUrl},set workerUrl(y){i.ff.workerUrl=y},get workerClass(){return i.ff.workerClass},set workerClass(y){i.ff.workerClass=y},get workerParams(){return i.ff.workerParams},set workerParams(y){i.ff.workerParams=y},get dracoUrl(){return i.fe()},set dracoUrl(y){i.fd(y)},get meshoptUrl(){return i.fc()},set meshoptUrl(y){i.fb(y)},setNow:i.o.setNow,restoreNow:i.o.restoreNow}});var d=o;return d})})(qre);var w2e=qre.exports;const Yo=va(w2e),Gre=({restaurants:e,onRestaurantClick:t,userLocation:r,radiusFilter:n,onMapInit:o,onMarkerClick:l,showViewDetailsButton:d=!1})=>{const{i18n:i,t:g}=Ki(),x=G.useRef(null),S=G.useRef(null),E=G.useRef([]),[A,C]=G.useState(!1),N=G.useRef(null);return G.useEffect(()=>{if(!x.current||S.current)return;const k="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Yo.accessToken=k;const R=r?[r.lng,r.lat]:[-9.1393,38.7223];return S.current=new Yo.Map({container:x.current,style:"mapbox://styles/mapbox/light-v11",center:R,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1}),S.current.addControl(new Yo.NavigationControl({visualizePitch:!0}),"top-right"),S.current.on("load",()=>{C(!0),o&&S.current&&o(S.current)}),()=>{var L;E.current.forEach(j=>j.remove()),E.current=[],N.current&&(N.current.remove(),N.current=null),(L=S.current)==null||L.remove(),S.current=null,C(!1)}},[]),G.useEffect(()=>{S.current&&r&&A&&S.current.flyTo({center:[r.lng,r.lat],zoom:14,duration:1500})},[r,A]),G.useEffect(()=>{if(!S.current||!A)return;E.current.forEach(R=>R.remove()),E.current=[],N.current&&(N.current.remove(),N.current=null);let k=e;if(r&&n&&(k=e.filter(R=>$T(r.lat,r.lng,R.lat,R.lng)<=n)),k.forEach(R=>{const L=document.createElement("div");L.className="p-3 min-w-[200px]",L.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${R.name}</h3>
          ${R.type&&R.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${R.type.slice(0,2).map(Z=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${Z}</span>`).join("")}
            </div>
          `:""}
          ${R.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;"></span>
              <span class="font-semibold text-sm">${R.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${R.address}</p>
          ${d?`
            <button 
              id="view-details-${R.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${g("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const j=new Yo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([R.lng,R.lat]).setDOMContent(L),F=new Yo.Marker({color:"#016450",draggable:!1}).setLngLat([R.lng,R.lat]).addTo(S.current),B=F.getElement();B.style.cursor="pointer";const U=Z=>{Z.stopPropagation(),Z.preventDefault(),console.log("Marker clicked:",R.name),N.current&&N.current!==j&&N.current.remove(),j.addTo(S.current),N.current=j,console.log("Zooming to:",[R.lng,R.lat]),S.current.easeTo({center:[R.lng,R.lat],zoom:17,duration:800}),l&&(console.log("Calling onMarkerClick callback"),l(R))};console.log("Adding click handler for restaurant:",R.name),B.addEventListener("click",U,!0),d&&j.on("open",()=>{const Z=document.getElementById(`view-details-${R.id}`);Z&&Z.addEventListener("click",X=>{X.stopPropagation(),t(R)})}),j.on("close",()=>{N.current===j&&(N.current=null)}),E.current.push(F)}),k.length>0){const R=new Yo.LngLatBounds;k.forEach(L=>{R.extend([L.lng,L.lat])}),r&&R.extend([r.lng,r.lat]),S.current.fitBounds(R,{padding:50,maxZoom:15})}},[e,n,r,A,t,i.language,d,g,l]),G.useEffect(()=>{if(!S.current||!r||!A)return;const k=document.createElement("div");k.className="user-location-marker",k.style.backgroundColor="#3b82f6",k.style.width="20px",k.style.height="20px",k.style.borderRadius="50%",k.style.border="3px solid white",k.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const R=new Yo.Marker(k).setLngLat([r.lng,r.lat]).addTo(S.current);return()=>{R.remove()}},[r,A]),m.jsx("div",{ref:x,className:"w-full h-full rounded-lg overflow-hidden"})},kd=()=>{const{i18n:e}=Ki(),t=e.language,r=(l,d)=>{let i;if(t==="zh"){const g=`${d}_zh`;i=l[g]||l[d]}else if(t==="pt"){const g=`${d}_pt`;i=l[g]||l[`${d}_en`]||l[d]}else{const g=`${d}_en`;i=l[g]||l[d]}return(d==="name"||d==="title"||d.startsWith("title_"))&&Array.isArray(i)?i.join(", "):i||""};return{getLocalizedField:r,localizeRestaurant:l=>({...l,name:r(l,"name"),type:r(l,"type"),description:r(l,"description")}),localizeActivity:l=>({...l,title:r(l,"title"),content:r(l,"content")}),currentLang:t}},Hre=e=>{if(typeof e=="string")return e;const r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date().getDay()],n=e[r];return n?n.closed?"Closed today":n.splitShift?`${n.open} - ${n.close}, ${n.open2} - ${n.close2}`:`${n.open} - ${n.close}`:"Hours not available"},Kre=e=>(Ki(),Wi({queryKey:["batch-restaurant-activities",e.join(",")],queryFn:async()=>{if(e.length===0)return{};const{data:t,error:r}=await Ut.from("activity_restaurants").select(`
          restaurant_id,
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            start_date,
            end_date
          )
        `).in("restaurant_id",e);if(r)throw r;const n=new Date,o={};return t.forEach(l=>{const d=l.activities;if(!d)return;const i=new Date(d.start_date),g=d.end_date?new Date(d.end_date):null;i<=n&&(!g||g>=n)&&(o[l.restaurant_id]||(o[l.restaurant_id]=[]),o[l.restaurant_id].push({activity_id:l.activity_id,title_zh:d.title_zh,title_en:d.title_en,title_pt:d.title_pt}))}),o},enabled:e.length>0})),v3=(e,t)=>t==="zh"?e.title_zh:t==="pt"?e.title_pt:e.title_en,S2e=()=>{const e=Vf(),{t,i18n:r}=Ki(),{toast:n}=wa(),{localizeRestaurant:o}=kd(),[l,d]=G.useState(""),[i,g]=G.useState([]),[x,S]=G.useState("list"),[E,A]=G.useState(null),[C,N]=G.useState(null),[k,R]=G.useState(!1),{user:L}=Di(),{data:j,isLoading:F}=p4(l,i.length>0?i.join(","):void 0),{data:B=[]}=Bre(),{data:U=[]}=Ure(),Z=$re(),X=(fe,_e)=>{_e.preventDefault(),_e.stopPropagation(),L&&Z.mutate(fe)},te=fe=>{g(_e=>_e.includes(fe)?_e.filter(be=>be!==fe):[..._e,fe])},se=async()=>{try{const fe=await Ik();N({lat:fe.coords.latitude,lng:fe.coords.longitude}),R(!0),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{console.log("Location access denied or unavailable")}},oe=fe=>{A(fe),fe&&!C&&se()},ne=(j==null?void 0:j.map(fe=>{const _e=o(fe);if(C){const be=$T(C.lat,C.lng,fe.lat,fe.lng);return{..._e,distance:be}}return _e}))||[],ee=E&&C?ne.filter(fe=>fe.distance&&fe.distance<=E):ne,ie=k&&C?[...ee].sort((fe,_e)=>(fe.distance||0)-(_e.distance||0)):ee,he=(ie==null?void 0:ie.map(fe=>fe.id))||[],{data:Se={}}=Kre(he),Ce=fe=>{e(`/restaurant/${fe.id}`)};return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsxs("div",{className:"container mx-auto max-w-7xl pb-[5px]",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-4xl font-bold mb-4 text-foreground",children:t("restaurants.title")}),m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsx(an,{placeholder:t("restaurants.search"),value:l,onChange:fe=>d(fe.target.value),className:"w-full md:max-w-md"}),m.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[m.jsx(lr,{variant:x==="list"?"default":"outline",size:"icon",onClick:()=>S("list"),title:t("restaurants.listView"),className:"flex-shrink-0",children:m.jsx(HY,{className:"w-4 h-4"})}),m.jsx(lr,{variant:x==="map"?"default":"outline",size:"icon",onClick:()=>S("map"),title:t("restaurants.mapView"),className:"flex-shrink-0",children:m.jsx(ZY,{className:"w-4 h-4"})}),C?m.jsx(lr,{variant:k?"default":"outline",onClick:()=>R(!k),className:"flex-1 md:flex-initial",children:t("restaurants.sortByDistance")}):m.jsxs(lr,{variant:"outline",onClick:se,className:"flex-1 md:flex-initial",children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),m.jsx("span",{className:"hidden sm:inline",children:t("restaurants.getLocation")}),m.jsx("span",{className:"sm:hidden",children:t("restaurants.getLocation")})]})]})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[U.slice(0,6).map(fe=>m.jsx(Qn,{variant:i.includes(fe)?"default":"secondary",className:"cursor-pointer",onClick:()=>te(fe),children:fe},fe)),i.length>0&&m.jsx(Qn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground",onClick:()=>g([]),children:""})]}),C&&m.jsxs("div",{className:"flex gap-2 flex-wrap items-center",children:[m.jsxs("span",{className:"text-sm font-medium",children:[t("restaurants.radius"),":"]}),m.jsx(Qn,{variant:E===null?"default":"secondary",className:"cursor-pointer",onClick:()=>oe(null),children:t("restaurants.allRestaurants")}),m.jsx(Qn,{variant:E===5?"default":"secondary",className:"cursor-pointer",onClick:()=>oe(5),children:t("restaurants.radius5km")}),m.jsx(Qn,{variant:E===10?"default":"secondary",className:"cursor-pointer",onClick:()=>oe(10),children:t("restaurants.radius10km")}),m.jsx(Qn,{variant:E===20?"default":"secondary",className:"cursor-pointer",onClick:()=>oe(20),children:t("restaurants.radius20km")})]})]})]}),F&&m.jsx("div",{className:"flex justify-center items-center py-20",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin text-primary"})}),!F&&ie&&ie.length===0&&m.jsxs("div",{className:"text-center py-20",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:t("restaurants.noResults")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:t("restaurants.noResultsDesc")})]}),!F&&x==="map"&&ie&&ie.length>0&&m.jsx("div",{className:"h-[400px] md:h-[500px] lg:h-[600px] xl:h-[700px] rounded-lg overflow-hidden shadow-lg",children:m.jsx(Gre,{restaurants:ie,onRestaurantClick:Ce,userLocation:C,radiusFilter:E,showViewDetailsButton:!0})}),!F&&x==="list"&&ie&&ie.length>0&&m.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:ie.map(fe=>{var _e,be;return m.jsxs(Qr,{className:"overflow-hidden hover:shadow-large transition-shadow flex flex-col h-full",children:[m.jsxs("div",{className:"relative h-48 overflow-hidden",children:[m.jsx("img",{src:fe.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",alt:fe.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),m.jsx(lr,{size:"icon",variant:"secondary",className:"absolute top-3 right-3",onClick:Pe=>X(fe.id,Pe),disabled:!L,children:m.jsx(uB,{className:`w-5 h-5 ${L&&B.includes(fe.id)?"fill-destructive text-destructive":""}`})})]}),m.jsx(Mi,{className:"mb-px pb-[15px]",children:m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsx("h3",{className:"text-xl font-semibold text-card-foreground",children:fe.name}),m.jsxs("div",{className:"flex items-center gap-2",children:[fe.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(ch,{className:"w-4 h-4 text-primary"}),m.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[fe.distance.toFixed(1)," km"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(wc,{className:"w-5 h-5 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold text-card-foreground",children:((_e=fe.rating)==null?void 0:_e.toFixed(1))||"0.0"})]})]})]})}),m.jsxs(dn,{className:"space-y-2 flex-grow",children:[m.jsxs("div",{className:"flex flex-wrap gap-2 -mt-1",children:[fe.type.slice(0,3).map((Pe,ye)=>m.jsx(Qn,{variant:"secondary",className:"text-xs",children:Pe},`type-${ye}`)),(be=Se[fe.id])==null?void 0:be.map((Pe,ye)=>m.jsx(Qn,{variant:"default",className:"text-xs bg-primary/90 hover:bg-primary",children:v3(Pe,r.language)},`activity-${ye}`))]}),m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(Cs,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-1",children:fe.address})]}),fe.phone&&m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(PT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:fe.phone})]}),fe.opening_hours&&m.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-sm",children:[m.jsx(AT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:Hre(fe.opening_hours)})]})]}),m.jsxs(Ok,{className:"gap-2 mt-auto",children:[m.jsx(lr,{asChild:!0,className:"flex-1",children:m.jsx(Vi,{to:`/restaurant/${fe.id}`,children:t("restaurants.viewDetails")})}),C&&m.jsx(lr,{variant:"outline",size:"icon",onClick:()=>Vre(fe.lat,fe.lng,fe.name),title:t("restaurants.directions"),children:m.jsx(ch,{className:"w-4 h-4"})})]})]},fe.id)})})]})})};var E2e="Separator",YW="horizontal",T2e=["horizontal","vertical"],Zre=G.forwardRef((e,t)=>{const{decorative:r,orientation:n=YW,...o}=e,l=A2e(n)?n:YW,i=r?{role:"none"}:{"aria-orientation":l==="vertical"?l:void 0,role:"separator"};return m.jsx(bn.div,{"data-orientation":l,...i,...o,ref:t})});Zre.displayName=E2e;function A2e(e){return T2e.includes(e)}var Xre=Zre;const vu=G.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...n},o)=>m.jsx(Xre,{ref:o,decorative:r,orientation:t,className:_r("shrink-0 bg-border",t==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...n}));vu.displayName=Xre.displayName;var kk="Collapsible",[P2e,ket]=Ks(kk),[C2e,m4]=P2e(kk),Yre=G.forwardRef((e,t)=>{const{__scopeCollapsible:r,open:n,defaultOpen:o,disabled:l,onOpenChange:d,...i}=e,[g,x]=Ru({prop:n,defaultProp:o??!1,onChange:d,caller:kk});return m.jsx(C2e,{scope:r,disabled:l,contentId:Hc(),open:g,onOpenToggle:G.useCallback(()=>x(S=>!S),[x]),children:m.jsx(bn.div,{"data-state":y4(g),"data-disabled":l?"":void 0,...i,ref:t})})});Yre.displayName=kk;var Jre="CollapsibleTrigger",Qre=G.forwardRef((e,t)=>{const{__scopeCollapsible:r,...n}=e,o=m4(Jre,r);return m.jsx(bn.button,{type:"button","aria-controls":o.contentId,"aria-expanded":o.open||!1,"data-state":y4(o.open),"data-disabled":o.disabled?"":void 0,disabled:o.disabled,...n,ref:t,onClick:Rr(e.onClick,o.onOpenToggle)})});Qre.displayName=Jre;var g4="CollapsibleContent",ene=G.forwardRef((e,t)=>{const{forceMount:r,...n}=e,o=m4(g4,e.__scopeCollapsible);return m.jsx(ys,{present:r||o.open,children:({present:l})=>m.jsx(O2e,{...n,ref:t,present:l})})});ene.displayName=g4;var O2e=G.forwardRef((e,t)=>{const{__scopeCollapsible:r,present:n,children:o,...l}=e,d=m4(g4,r),[i,g]=G.useState(n),x=G.useRef(null),S=hi(t,x),E=G.useRef(0),A=E.current,C=G.useRef(0),N=C.current,k=d.open||i,R=G.useRef(k),L=G.useRef(void 0);return G.useEffect(()=>{const j=requestAnimationFrame(()=>R.current=!1);return()=>cancelAnimationFrame(j)},[]),ko(()=>{const j=x.current;if(j){L.current=L.current||{transitionDuration:j.style.transitionDuration,animationName:j.style.animationName},j.style.transitionDuration="0s",j.style.animationName="none";const F=j.getBoundingClientRect();E.current=F.height,C.current=F.width,R.current||(j.style.transitionDuration=L.current.transitionDuration,j.style.animationName=L.current.animationName),g(n)}},[d.open,n]),m.jsx(bn.div,{"data-state":y4(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!k,...l,ref:S,style:{"--radix-collapsible-content-height":A?`${A}px`:void 0,"--radix-collapsible-content-width":N?`${N}px`:void 0,...e.style},children:k&&o})});function y4(e){return e?"open":"closed"}var I2e=Yre;const vC=I2e,_C=Qre,xC=ene,v4=(e,t="restaurant")=>Wi({queryKey:["comments",e,t],queryFn:async()=>{const{data:r,error:n}=await Ut.from("comments").select("*").eq("target_id",e).eq("target_type",t).is("parent_id",null).order("created_at",{ascending:!1});if(n)throw n;return await Promise.all((r||[]).map(async l=>{const{data:d}=await Ut.from("profiles").select("display_name, avatar_url").eq("id",l.user_id).single(),{data:i}=await Ut.from("comments").select("*").eq("parent_id",l.id).order("created_at",{ascending:!0}),g=await Promise.all((i||[]).map(async x=>{const{data:S}=await Ut.from("profiles").select("display_name, avatar_url").eq("id",x.user_id).single();return{...x,profiles:S}}));return{...l,profiles:d,replies:g}}))},enabled:!!e}),k2e=()=>{const{user:e}=Di(),{toast:t}=wa(),r=Na();return Xa({mutationFn:async({targetId:n,targetType:o,content:l,ratingValue:d,priceRange:i,imageUrl:g,parentId:x})=>{if(!e)throw new Error("User not authenticated");const S={user_id:e.id,target_id:n,target_type:o,content:l,parent_id:x};x||(d&&(S.rating_value=d),i&&(S.price_range=i)),g&&(S.image_url=g);const{data:E,error:A}=await Ut.from("comments").insert(S).select().single();if(A)throw A;return E},onSuccess:(n,o)=>{r.invalidateQueries({queryKey:["comments",o.targetId,o.targetType]}),r.invalidateQueries({queryKey:["restaurants"]}),r.invalidateQueries({queryKey:["restaurant",o.targetId]}),t({title:"Success",description:"Comment added successfully"})},onError:()=>{t({title:"Error",description:"Failed to add comment",variant:"destructive"})}})},R2e=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{const{error:n}=await Ut.from("comments").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["comments"]}),e({title:"Success",description:"Comment deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete comment",variant:"destructive"})}})},j2e=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],N2e=({restaurantId:e})=>{var g;const{t}=Ki(),{data:r}=v4(e,"restaurant"),n=(r==null?void 0:r.filter(x=>x.rating_value))||[],o=n.length?n.reduce((x,S)=>x+(S.rating_value||0),0)/n.length:0,l=[5,4,3,2,1].map(x=>({star:x,count:n.filter(S=>S.rating_value===x).length,percentage:n.length?(n.filter(S=>S.rating_value===x).length/n.length*100).toFixed(0):0})),d=n.reduce((x,S)=>(S.price_range&&(x[S.price_range]=(x[S.price_range]||0)+1),x),{}),i=d&&Object.keys(d).length>0?Object.entries(d).sort((x,S)=>S[1]-x[1])[0]:null;return m.jsxs(Qr,{children:[m.jsx(Mi,{children:m.jsx(Ji,{children:t("restaurant.rating")})}),m.jsxs(dn,{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-6",children:[m.jsxs("div",{className:"text-center",children:[m.jsx("div",{className:"text-5xl font-bold",children:o.toFixed(1)}),m.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(x=>m.jsx(wc,{className:_r("w-5 h-5",x<=Math.round(o)?"fill-accent text-accent":"text-muted-foreground")},x))}),m.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[n.length," ",t("restaurant.ratingsCount")]}),i&&m.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[m.jsx(wL,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-semibold text-foreground",children:(g=j2e.find(x=>x.value===i[0]))==null?void 0:g.label})]})]}),m.jsx("div",{className:"flex-1 space-y-2",children:l.map(({star:x,count:S,percentage:E})=>m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsxs("span",{className:"w-8",children:[x," "]}),m.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${E}%`}})}),m.jsx("span",{className:"w-12 text-right text-muted-foreground",children:S})]},x))})]}),m.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:t("restaurant.signInToRate")})]})]})},Mm=G.forwardRef(({className:e,...t},r)=>m.jsx("textarea",{className:_r("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));Mm.displayName="Textarea";function _4(e){const t=G.useRef({value:e,previous:e});return G.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var M2e=[" ","Enter","ArrowUp","ArrowDown"],D2e=[" ","Enter"],hv="Select",[Rk,jk,L2e]=YI(hv),[kb,Ret]=Ks(hv,[L2e,eg]),Nk=eg(),[F2e,ig]=kb(hv),[z2e,B2e]=kb(hv),tne=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:o,onOpenChange:l,value:d,defaultValue:i,onValueChange:g,dir:x,name:S,autoComplete:E,disabled:A,required:C,form:N}=e,k=Nk(t),[R,L]=G.useState(null),[j,F]=G.useState(null),[B,U]=G.useState(!1),Z=LT(x),[X,te]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:hv}),[se,oe]=Ru({prop:d,defaultProp:i,onChange:g,caller:hv}),ne=G.useRef(null),ee=R?N||!!R.closest("form"):!0,[ie,he]=G.useState(new Set),Se=Array.from(ie).map(Ce=>Ce.props.value).join(";");return m.jsx(ak,{...k,children:m.jsxs(F2e,{required:C,scope:t,trigger:R,onTriggerChange:L,valueNode:j,onValueNodeChange:F,valueNodeHasChildren:B,onValueNodeHasChildrenChange:U,contentId:Hc(),value:se,onValueChange:oe,open:X,onOpenChange:te,dir:Z,triggerPointerDownPosRef:ne,disabled:A,children:[m.jsx(Rk.Provider,{scope:t,children:m.jsx(z2e,{scope:e.__scopeSelect,onNativeOptionAdd:G.useCallback(Ce=>{he(fe=>new Set(fe).add(Ce))},[]),onNativeOptionRemove:G.useCallback(Ce=>{he(fe=>{const _e=new Set(fe);return _e.delete(Ce),_e})},[]),children:r})}),ee?m.jsxs(Tne,{"aria-hidden":!0,required:C,tabIndex:-1,name:S,autoComplete:E,value:se,onChange:Ce=>oe(Ce.target.value),disabled:A,form:N,children:[se===void 0?m.jsx("option",{value:""}):null,Array.from(ie)]},Se):null]})})};tne.displayName=hv;var rne="SelectTrigger",nne=G.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...o}=e,l=Nk(r),d=ig(rne,r),i=d.disabled||n,g=hi(t,d.onTriggerChange),x=jk(r),S=G.useRef("touch"),[E,A,C]=Pne(k=>{const R=x().filter(F=>!F.disabled),L=R.find(F=>F.value===d.value),j=Cne(R,k,L);j!==void 0&&d.onValueChange(j.value)}),N=k=>{i||(d.onOpenChange(!0),C()),k&&(d.triggerPointerDownPosRef.current={x:Math.round(k.pageX),y:Math.round(k.pageY)})};return m.jsx(OT,{asChild:!0,...l,children:m.jsx(bn.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:i,"data-disabled":i?"":void 0,"data-placeholder":Ane(d.value)?"":void 0,...o,ref:g,onClick:Rr(o.onClick,k=>{k.currentTarget.focus(),S.current!=="mouse"&&N(k)}),onPointerDown:Rr(o.onPointerDown,k=>{S.current=k.pointerType;const R=k.target;R.hasPointerCapture(k.pointerId)&&R.releasePointerCapture(k.pointerId),k.button===0&&k.ctrlKey===!1&&k.pointerType==="mouse"&&(N(k),k.preventDefault())}),onKeyDown:Rr(o.onKeyDown,k=>{const R=E.current!=="";!(k.ctrlKey||k.altKey||k.metaKey)&&k.key.length===1&&A(k.key),!(R&&k.key===" ")&&M2e.includes(k.key)&&(N(),k.preventDefault())})})})});nne.displayName=rne;var ine="SelectValue",ane=G.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:o,children:l,placeholder:d="",...i}=e,g=ig(ine,r),{onValueNodeHasChildrenChange:x}=g,S=l!==void 0,E=hi(t,g.onValueNodeChange);return ko(()=>{x(S)},[x,S]),m.jsx(bn.span,{...i,ref:E,style:{pointerEvents:"none"},children:Ane(g.value)?m.jsx(m.Fragment,{children:d}):l})});ane.displayName=ine;var $2e="SelectIcon",one=G.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...o}=e;return m.jsx(bn.span,{"aria-hidden":!0,...o,ref:t,children:n||""})});one.displayName=$2e;var U2e="SelectPortal",sne=e=>m.jsx(_b,{asChild:!0,...e});sne.displayName=U2e;var fv="SelectContent",lne=G.forwardRef((e,t)=>{const r=ig(fv,e.__scopeSelect),[n,o]=G.useState();if(ko(()=>{o(new DocumentFragment)},[]),!r.open){const l=n;return l?Qm.createPortal(m.jsx(cne,{scope:e.__scopeSelect,children:m.jsx(Rk.Slot,{scope:e.__scopeSelect,children:m.jsx("div",{children:e.children})})}),l):null}return m.jsx(une,{...e,ref:t})});lne.displayName=fv;var sd=10,[cne,ag]=kb(fv),V2e="SelectContentImpl",q2e=$m("SelectContent.RemoveScroll"),une=G.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:o,onEscapeKeyDown:l,onPointerDownOutside:d,side:i,sideOffset:g,align:x,alignOffset:S,arrowPadding:E,collisionBoundary:A,collisionPadding:C,sticky:N,hideWhenDetached:k,avoidCollisions:R,...L}=e,j=ig(fv,r),[F,B]=G.useState(null),[U,Z]=G.useState(null),X=hi(t,Xe=>B(Xe)),[te,se]=G.useState(null),[oe,ne]=G.useState(null),ee=jk(r),[ie,he]=G.useState(!1),Se=G.useRef(!1);G.useEffect(()=>{if(F)return vk(F)},[F]),gk();const Ce=G.useCallback(Xe=>{const[ft,...ze]=ee().map(xt=>xt.ref.current),[ut]=ze.slice(-1),At=document.activeElement;for(const xt of Xe)if(xt===At||(xt==null||xt.scrollIntoView({block:"nearest"}),xt===ft&&U&&(U.scrollTop=0),xt===ut&&U&&(U.scrollTop=U.scrollHeight),xt==null||xt.focus(),document.activeElement!==At))return},[ee,U]),fe=G.useCallback(()=>Ce([te,F]),[Ce,te,F]);G.useEffect(()=>{ie&&fe()},[ie,fe]);const{onOpenChange:_e,triggerPointerDownPosRef:be}=j;G.useEffect(()=>{if(F){let Xe={x:0,y:0};const ft=ut=>{var At,xt;Xe={x:Math.abs(Math.round(ut.pageX)-(((At=be.current)==null?void 0:At.x)??0)),y:Math.abs(Math.round(ut.pageY)-(((xt=be.current)==null?void 0:xt.y)??0))}},ze=ut=>{Xe.x<=10&&Xe.y<=10?ut.preventDefault():F.contains(ut.target)||_e(!1),document.removeEventListener("pointermove",ft),be.current=null};return be.current!==null&&(document.addEventListener("pointermove",ft),document.addEventListener("pointerup",ze,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ft),document.removeEventListener("pointerup",ze,{capture:!0})}}},[F,_e,be]),G.useEffect(()=>{const Xe=()=>_e(!1);return window.addEventListener("blur",Xe),window.addEventListener("resize",Xe),()=>{window.removeEventListener("blur",Xe),window.removeEventListener("resize",Xe)}},[_e]);const[Pe,ye]=Pne(Xe=>{const ft=ee().filter(At=>!At.disabled),ze=ft.find(At=>At.ref.current===document.activeElement),ut=Cne(ft,Xe,ze);ut&&setTimeout(()=>ut.ref.current.focus())}),ge=G.useCallback((Xe,ft,ze)=>{const ut=!Se.current&&!ze;(j.value!==void 0&&j.value===ft||ut)&&(se(Xe),ut&&(Se.current=!0))},[j.value]),ke=G.useCallback(()=>F==null?void 0:F.focus(),[F]),Qe=G.useCallback((Xe,ft,ze)=>{const ut=!Se.current&&!ze;(j.value!==void 0&&j.value===ft||ut)&&ne(Xe)},[j.value]),He=n==="popper"?_3:dne,$e=He===_3?{side:i,sideOffset:g,align:x,alignOffset:S,arrowPadding:E,collisionBoundary:A,collisionPadding:C,sticky:N,hideWhenDetached:k,avoidCollisions:R}:{};return m.jsx(cne,{scope:r,content:F,viewport:U,onViewportChange:Z,itemRefCallback:ge,selectedItem:te,onItemLeave:ke,itemTextRefCallback:Qe,focusSelectedItem:fe,selectedItemText:oe,position:n,isPositioned:ie,searchRef:Pe,children:m.jsx(RT,{as:q2e,allowPinchZoom:!0,children:m.jsx(kT,{asChild:!0,trapped:j.open,onMountAutoFocus:Xe=>{Xe.preventDefault()},onUnmountAutoFocus:Rr(o,Xe=>{var ft;(ft=j.trigger)==null||ft.focus({preventScroll:!0}),Xe.preventDefault()}),children:m.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:Xe=>Xe.preventDefault(),onDismiss:()=>j.onOpenChange(!1),children:m.jsx(He,{role:"listbox",id:j.contentId,"data-state":j.open?"open":"closed",dir:j.dir,onContextMenu:Xe=>Xe.preventDefault(),...L,...$e,onPlaced:()=>he(!0),ref:X,style:{display:"flex",flexDirection:"column",outline:"none",...L.style},onKeyDown:Rr(L.onKeyDown,Xe=>{const ft=Xe.ctrlKey||Xe.altKey||Xe.metaKey;if(Xe.key==="Tab"&&Xe.preventDefault(),!ft&&Xe.key.length===1&&ye(Xe.key),["ArrowUp","ArrowDown","Home","End"].includes(Xe.key)){let ut=ee().filter(At=>!At.disabled).map(At=>At.ref.current);if(["ArrowUp","End"].includes(Xe.key)&&(ut=ut.slice().reverse()),["ArrowUp","ArrowDown"].includes(Xe.key)){const At=Xe.target,xt=ut.indexOf(At);ut=ut.slice(xt+1)}setTimeout(()=>Ce(ut)),Xe.preventDefault()}})})})})})})});une.displayName=V2e;var W2e="SelectItemAlignedPosition",dne=G.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...o}=e,l=ig(fv,r),d=ag(fv,r),[i,g]=G.useState(null),[x,S]=G.useState(null),E=hi(t,X=>S(X)),A=jk(r),C=G.useRef(!1),N=G.useRef(!0),{viewport:k,selectedItem:R,selectedItemText:L,focusSelectedItem:j}=d,F=G.useCallback(()=>{if(l.trigger&&l.valueNode&&i&&x&&k&&R&&L){const X=l.trigger.getBoundingClientRect(),te=x.getBoundingClientRect(),se=l.valueNode.getBoundingClientRect(),oe=L.getBoundingClientRect();if(l.dir!=="rtl"){const At=oe.left-te.left,xt=se.left-At,nr=X.left-xt,Vt=X.width+nr,dr=Math.max(Vt,te.width),Br=window.innerWidth-sd,Yr=m3(xt,[sd,Math.max(sd,Br-dr)]);i.style.minWidth=Vt+"px",i.style.left=Yr+"px"}else{const At=te.right-oe.right,xt=window.innerWidth-se.right-At,nr=window.innerWidth-X.right-xt,Vt=X.width+nr,dr=Math.max(Vt,te.width),Br=window.innerWidth-sd,Yr=m3(xt,[sd,Math.max(sd,Br-dr)]);i.style.minWidth=Vt+"px",i.style.right=Yr+"px"}const ne=A(),ee=window.innerHeight-sd*2,ie=k.scrollHeight,he=window.getComputedStyle(x),Se=parseInt(he.borderTopWidth,10),Ce=parseInt(he.paddingTop,10),fe=parseInt(he.borderBottomWidth,10),_e=parseInt(he.paddingBottom,10),be=Se+Ce+ie+_e+fe,Pe=Math.min(R.offsetHeight*5,be),ye=window.getComputedStyle(k),ge=parseInt(ye.paddingTop,10),ke=parseInt(ye.paddingBottom,10),Qe=X.top+X.height/2-sd,He=ee-Qe,$e=R.offsetHeight/2,Xe=R.offsetTop+$e,ft=Se+Ce+Xe,ze=be-ft;if(ft<=Qe){const At=ne.length>0&&R===ne[ne.length-1].ref.current;i.style.bottom="0px";const xt=x.clientHeight-k.offsetTop-k.offsetHeight,nr=Math.max(He,$e+(At?ke:0)+xt+fe),Vt=ft+nr;i.style.height=Vt+"px"}else{const At=ne.length>0&&R===ne[0].ref.current;i.style.top="0px";const nr=Math.max(Qe,Se+k.offsetTop+(At?ge:0)+$e)+ze;i.style.height=nr+"px",k.scrollTop=ft-Qe+k.offsetTop}i.style.margin=`${sd}px 0`,i.style.minHeight=Pe+"px",i.style.maxHeight=ee+"px",n==null||n(),requestAnimationFrame(()=>C.current=!0)}},[A,l.trigger,l.valueNode,i,x,k,R,L,l.dir,n]);ko(()=>F(),[F]);const[B,U]=G.useState();ko(()=>{x&&U(window.getComputedStyle(x).zIndex)},[x]);const Z=G.useCallback(X=>{X&&N.current===!0&&(F(),j==null||j(),N.current=!1)},[F,j]);return m.jsx(H2e,{scope:r,contentWrapper:i,shouldExpandOnScrollRef:C,onScrollButtonChange:Z,children:m.jsx("div",{ref:g,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:B},children:m.jsx(bn.div,{...o,ref:E,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});dne.displayName=W2e;var G2e="SelectPopperPosition",_3=G.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:o=sd,...l}=e,d=Nk(r);return m.jsx(ok,{...d,...l,ref:t,align:n,collisionPadding:o,style:{boxSizing:"border-box",...l.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});_3.displayName=G2e;var[H2e,x4]=kb(fv,{}),x3="SelectViewport",hne=G.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...o}=e,l=ag(x3,r),d=x4(x3,r),i=hi(t,l.onViewportChange),g=G.useRef(0);return m.jsxs(m.Fragment,{children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),m.jsx(Rk.Slot,{scope:r,children:m.jsx(bn.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:i,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:Rr(o.onScroll,x=>{const S=x.currentTarget,{contentWrapper:E,shouldExpandOnScrollRef:A}=d;if(A!=null&&A.current&&E){const C=Math.abs(g.current-S.scrollTop);if(C>0){const N=window.innerHeight-sd*2,k=parseFloat(E.style.minHeight),R=parseFloat(E.style.height),L=Math.max(k,R);if(L<N){const j=L+C,F=Math.min(N,j),B=j-F;E.style.height=F+"px",E.style.bottom==="0px"&&(S.scrollTop=B>0?B:0,E.style.justifyContent="flex-end")}}}g.current=S.scrollTop})})})]})});hne.displayName=x3;var fne="SelectGroup",[K2e,Z2e]=kb(fne),X2e=G.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=Hc();return m.jsx(K2e,{scope:r,id:o,children:m.jsx(bn.div,{role:"group","aria-labelledby":o,...n,ref:t})})});X2e.displayName=fne;var pne="SelectLabel",mne=G.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=Z2e(pne,r);return m.jsx(bn.div,{id:o.id,...n,ref:t})});mne.displayName=pne;var xO="SelectItem",[Y2e,gne]=kb(xO),yne=G.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:o=!1,textValue:l,...d}=e,i=ig(xO,r),g=ag(xO,r),x=i.value===n,[S,E]=G.useState(l??""),[A,C]=G.useState(!1),N=hi(t,j=>{var F;return(F=g.itemRefCallback)==null?void 0:F.call(g,j,n,o)}),k=Hc(),R=G.useRef("touch"),L=()=>{o||(i.onValueChange(n),i.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return m.jsx(Y2e,{scope:r,value:n,disabled:o,textId:k,isSelected:x,onItemTextChange:G.useCallback(j=>{E(F=>F||((j==null?void 0:j.textContent)??"").trim())},[]),children:m.jsx(Rk.ItemSlot,{scope:r,value:n,disabled:o,textValue:S,children:m.jsx(bn.div,{role:"option","aria-labelledby":k,"data-highlighted":A?"":void 0,"aria-selected":x&&A,"data-state":x?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...d,ref:N,onFocus:Rr(d.onFocus,()=>C(!0)),onBlur:Rr(d.onBlur,()=>C(!1)),onClick:Rr(d.onClick,()=>{R.current!=="mouse"&&L()}),onPointerUp:Rr(d.onPointerUp,()=>{R.current==="mouse"&&L()}),onPointerDown:Rr(d.onPointerDown,j=>{R.current=j.pointerType}),onPointerMove:Rr(d.onPointerMove,j=>{var F;R.current=j.pointerType,o?(F=g.onItemLeave)==null||F.call(g):R.current==="mouse"&&j.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Rr(d.onPointerLeave,j=>{var F;j.currentTarget===document.activeElement&&((F=g.onItemLeave)==null||F.call(g))}),onKeyDown:Rr(d.onKeyDown,j=>{var B;((B=g.searchRef)==null?void 0:B.current)!==""&&j.key===" "||(D2e.includes(j.key)&&L(),j.key===" "&&j.preventDefault())})})})})});yne.displayName=xO;var kS="SelectItemText",vne=G.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:o,...l}=e,d=ig(kS,r),i=ag(kS,r),g=gne(kS,r),x=B2e(kS,r),[S,E]=G.useState(null),A=hi(t,L=>E(L),g.onItemTextChange,L=>{var j;return(j=i.itemTextRefCallback)==null?void 0:j.call(i,L,g.value,g.disabled)}),C=S==null?void 0:S.textContent,N=G.useMemo(()=>m.jsx("option",{value:g.value,disabled:g.disabled,children:C},g.value),[g.disabled,g.value,C]),{onNativeOptionAdd:k,onNativeOptionRemove:R}=x;return ko(()=>(k(N),()=>R(N)),[k,R,N]),m.jsxs(m.Fragment,{children:[m.jsx(bn.span,{id:g.textId,...l,ref:A}),g.isSelected&&d.valueNode&&!d.valueNodeHasChildren?Qm.createPortal(l.children,d.valueNode):null]})});vne.displayName=kS;var _ne="SelectItemIndicator",xne=G.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return gne(_ne,r).isSelected?m.jsx(bn.span,{"aria-hidden":!0,...n,ref:t}):null});xne.displayName=_ne;var b3="SelectScrollUpButton",bne=G.forwardRef((e,t)=>{const r=ag(b3,e.__scopeSelect),n=x4(b3,e.__scopeSelect),[o,l]=G.useState(!1),d=hi(t,n.onScrollButtonChange);return ko(()=>{if(r.viewport&&r.isPositioned){let i=function(){const x=g.scrollTop>0;l(x)};const g=r.viewport;return i(),g.addEventListener("scroll",i),()=>g.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),o?m.jsx(Sne,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:g}=r;i&&g&&(i.scrollTop=i.scrollTop-g.offsetHeight)}}):null});bne.displayName=b3;var w3="SelectScrollDownButton",wne=G.forwardRef((e,t)=>{const r=ag(w3,e.__scopeSelect),n=x4(w3,e.__scopeSelect),[o,l]=G.useState(!1),d=hi(t,n.onScrollButtonChange);return ko(()=>{if(r.viewport&&r.isPositioned){let i=function(){const x=g.scrollHeight-g.clientHeight,S=Math.ceil(g.scrollTop)<x;l(S)};const g=r.viewport;return i(),g.addEventListener("scroll",i),()=>g.removeEventListener("scroll",i)}},[r.viewport,r.isPositioned]),o?m.jsx(Sne,{...e,ref:d,onAutoScroll:()=>{const{viewport:i,selectedItem:g}=r;i&&g&&(i.scrollTop=i.scrollTop+g.offsetHeight)}}):null});wne.displayName=w3;var Sne=G.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...o}=e,l=ag("SelectScrollButton",r),d=G.useRef(null),i=jk(r),g=G.useCallback(()=>{d.current!==null&&(window.clearInterval(d.current),d.current=null)},[]);return G.useEffect(()=>()=>g(),[g]),ko(()=>{var S;const x=i().find(E=>E.ref.current===document.activeElement);(S=x==null?void 0:x.ref.current)==null||S.scrollIntoView({block:"nearest"})},[i]),m.jsx(bn.div,{"aria-hidden":!0,...o,ref:t,style:{flexShrink:0,...o.style},onPointerDown:Rr(o.onPointerDown,()=>{d.current===null&&(d.current=window.setInterval(n,50))}),onPointerMove:Rr(o.onPointerMove,()=>{var x;(x=l.onItemLeave)==null||x.call(l),d.current===null&&(d.current=window.setInterval(n,50))}),onPointerLeave:Rr(o.onPointerLeave,()=>{g()})})}),J2e="SelectSeparator",Ene=G.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return m.jsx(bn.div,{"aria-hidden":!0,...n,ref:t})});Ene.displayName=J2e;var S3="SelectArrow",Q2e=G.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,o=Nk(r),l=ig(S3,r),d=ag(S3,r);return l.open&&d.position==="popper"?m.jsx(sk,{...o,...n,ref:t}):null});Q2e.displayName=S3;var ePe="SelectBubbleInput",Tne=G.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const o=G.useRef(null),l=hi(n,o),d=_4(t);return G.useEffect(()=>{const i=o.current;if(!i)return;const g=window.HTMLSelectElement.prototype,S=Object.getOwnPropertyDescriptor(g,"value").set;if(d!==t&&S){const E=new Event("change",{bubbles:!0});S.call(i,t),i.dispatchEvent(E)}},[d,t]),m.jsx(bn.select,{...r,style:{...wY,...r.style},ref:l,defaultValue:t})});Tne.displayName=ePe;function Ane(e){return e===""||e===void 0}function Pne(e){const t=Io(e),r=G.useRef(""),n=G.useRef(0),o=G.useCallback(d=>{const i=r.current+d;t(i),function g(x){r.current=x,window.clearTimeout(n.current),x!==""&&(n.current=window.setTimeout(()=>g(""),1e3))}(i)},[t]),l=G.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return G.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,o,l]}function Cne(e,t,r){const o=t.length>1&&Array.from(t).every(x=>x===t[0])?t[0]:t,l=r?e.indexOf(r):-1;let d=tPe(e,Math.max(l,0));o.length===1&&(d=d.filter(x=>x!==r));const g=d.find(x=>x.textValue.toLowerCase().startsWith(o.toLowerCase()));return g!==r?g:void 0}function tPe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var rPe=tne,One=nne,nPe=ane,iPe=one,aPe=sne,Ine=lne,oPe=hne,kne=mne,Rne=yne,sPe=vne,lPe=xne,jne=bne,Nne=wne,Mne=Ene;const wd=rPe,Sd=nPe,Au=G.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(One,{ref:n,className:_r("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,m.jsx(iPe,{asChild:!0,children:m.jsx(Yy,{className:"h-4 w-4 opacity-50"})})]}));Au.displayName=One.displayName;const Dne=G.forwardRef(({className:e,...t},r)=>m.jsx(jne,{ref:r,className:_r("flex cursor-default items-center justify-center py-1",e),...t,children:m.jsx(Xge,{className:"h-4 w-4"})}));Dne.displayName=jne.displayName;const Lne=G.forwardRef(({className:e,...t},r)=>m.jsx(Nne,{ref:r,className:_r("flex cursor-default items-center justify-center py-1",e),...t,children:m.jsx(Yy,{className:"h-4 w-4"})}));Lne.displayName=Nne.displayName;const Pu=G.forwardRef(({className:e,children:t,position:r="popper",...n},o)=>m.jsx(aPe,{children:m.jsxs(Ine,{ref:o,className:_r("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[m.jsx(Dne,{}),m.jsx(oPe,{className:_r("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),m.jsx(Lne,{})]})}));Pu.displayName=Ine.displayName;const cPe=G.forwardRef(({className:e,...t},r)=>m.jsx(kne,{ref:r,className:_r("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));cPe.displayName=kne.displayName;const La=G.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(Rne,{ref:n,className:_r("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[m.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:m.jsx(lPe,{children:m.jsx(Tf,{className:"h-4 w-4"})})}),m.jsx(sPe,{children:t})]}));La.displayName=Rne.displayName;const uPe=G.forwardRef(({className:e,...t},r)=>m.jsx(Mne,{ref:r,className:_r("-mx-1 my-1 h-px bg-muted",e),...t}));uPe.displayName=Mne.displayName;var dPe="Label",Fne=G.forwardRef((e,t)=>m.jsx(bn.label,{...e,ref:t,onMouseDown:r=>{var o;r.target.closest("button, input, select, textarea")||((o=e.onMouseDown)==null||o.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));Fne.displayName=dPe;var zne=Fne;const hPe=xb("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Zr=G.forwardRef(({className:e,...t},r)=>m.jsx(zne,{ref:r,className:_r(hPe(),e),...t}));Zr.displayName=zne.displayName;const Rh=WB,Iv=GB,fPe=HB,Bne=G.forwardRef(({className:e,...t},r)=>m.jsx(jT,{ref:r,className:_r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Bne.displayName=jT.displayName;const Rd=G.forwardRef(({className:e,children:t,...r},n)=>m.jsxs(fPe,{children:[m.jsx(Bne,{}),m.jsxs(NT,{ref:n,className:_r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,m.jsxs(xk,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[m.jsx(ju,{className:"h-4 w-4"}),m.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Rd.displayName=NT.displayName;const jd=({className:e,...t})=>m.jsx("div",{className:_r("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});jd.displayName="DialogHeader";const b4=({className:e,...t})=>m.jsx("div",{className:_r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});b4.displayName="DialogFooter";const Nd=G.forwardRef(({className:e,...t},r)=>m.jsx(MT,{ref:r,className:_r("text-lg font-semibold leading-none tracking-tight",e),...t}));Nd.displayName=MT.displayName;const Md=G.forwardRef(({className:e,...t},r)=>m.jsx(DT,{ref:r,className:_r("text-sm text-muted-foreground",e),...t}));Md.displayName=DT.displayName;var $ne="AlertDialog",[pPe,jet]=Ks($ne,[Dee]),Wf=Dee(),Une=e=>{const{__scopeAlertDialog:t,...r}=e,n=Wf(t);return m.jsx(WB,{...n,...r,modal:!0})};Une.displayName=$ne;var mPe="AlertDialogTrigger",Vne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Wf(r);return m.jsx(GB,{...o,...n,ref:t})});Vne.displayName=mPe;var gPe="AlertDialogPortal",qne=e=>{const{__scopeAlertDialog:t,...r}=e,n=Wf(t);return m.jsx(HB,{...n,...r})};qne.displayName=gPe;var yPe="AlertDialogOverlay",Wne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Wf(r);return m.jsx(jT,{...o,...n,ref:t})});Wne.displayName=yPe;var a0="AlertDialogContent",[vPe,_Pe]=pPe(a0),xPe=vY("AlertDialogContent"),Gne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...o}=e,l=Wf(r),d=G.useRef(null),i=hi(t,d),g=G.useRef(null);return m.jsx(rSe,{contentName:a0,titleName:Hne,docsSlug:"alert-dialog",children:m.jsx(vPe,{scope:r,cancelRef:g,children:m.jsxs(NT,{role:"alertdialog",...l,...o,ref:i,onOpenAutoFocus:Rr(o.onOpenAutoFocus,x=>{var S;x.preventDefault(),(S=g.current)==null||S.focus({preventScroll:!0})}),onPointerDownOutside:x=>x.preventDefault(),onInteractOutside:x=>x.preventDefault(),children:[m.jsx(xPe,{children:n}),m.jsx(wPe,{contentRef:d})]})})})});Gne.displayName=a0;var Hne="AlertDialogTitle",Kne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Wf(r);return m.jsx(MT,{...o,...n,ref:t})});Kne.displayName=Hne;var Zne="AlertDialogDescription",Xne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Wf(r);return m.jsx(DT,{...o,...n,ref:t})});Xne.displayName=Zne;var bPe="AlertDialogAction",Yne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,o=Wf(r);return m.jsx(xk,{...o,...n,ref:t})});Yne.displayName=bPe;var Jne="AlertDialogCancel",Qne=G.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:o}=_Pe(Jne,r),l=Wf(r),d=hi(t,o);return m.jsx(xk,{...l,...n,ref:d})});Qne.displayName=Jne;var wPe=({contentRef:e})=>{const t=`\`${a0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${a0}\` by passing a \`${Zne}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${a0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return G.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},SPe=Une,EPe=Vne,TPe=qne,eie=Wne,tie=Gne,rie=Yne,nie=Qne,iie=Kne,aie=Xne;const zl=SPe,IE=EPe,APe=TPe,oie=G.forwardRef(({className:e,...t},r)=>m.jsx(eie,{className:_r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));oie.displayName=eie.displayName;const ol=G.forwardRef(({className:e,...t},r)=>m.jsxs(APe,{children:[m.jsx(oie,{}),m.jsx(tie,{ref:r,className:_r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));ol.displayName=tie.displayName;const sl=({className:e,...t})=>m.jsx("div",{className:_r("flex flex-col space-y-2 text-center sm:text-left",e),...t});sl.displayName="AlertDialogHeader";const ll=({className:e,...t})=>m.jsx("div",{className:_r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});ll.displayName="AlertDialogFooter";const cl=G.forwardRef(({className:e,...t},r)=>m.jsx(iie,{ref:r,className:_r("text-lg font-semibold",e),...t}));cl.displayName=iie.displayName;const ul=G.forwardRef(({className:e,...t},r)=>m.jsx(aie,{ref:r,className:_r("text-sm text-muted-foreground",e),...t}));ul.displayName=aie.displayName;const Us=G.forwardRef(({className:e,...t},r)=>m.jsx(rie,{ref:r,className:_r(AE(),e),...t}));Us.displayName=rie.displayName;const dl=G.forwardRef(({className:e,...t},r)=>m.jsx(nie,{ref:r,className:_r(AE({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));dl.displayName=nie.displayName;var PPe=Object.defineProperty,CPe=Object.defineProperties,OPe=Object.getOwnPropertyDescriptors,bO=Object.getOwnPropertySymbols,sie=Object.prototype.hasOwnProperty,lie=Object.prototype.propertyIsEnumerable,JW=(e,t,r)=>t in e?PPe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,IPe=(e,t)=>{for(var r in t||(t={}))sie.call(t,r)&&JW(e,r,t[r]);if(bO)for(var r of bO(t))lie.call(t,r)&&JW(e,r,t[r]);return e},kPe=(e,t)=>CPe(e,OPe(t)),RPe=(e,t)=>{var r={};for(var n in e)sie.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&bO)for(var n of bO(e))t.indexOf(n)<0&&lie.call(e,n)&&(r[n]=e[n]);return r};function jPe(e){let t=setTimeout(e,0),r=setTimeout(e,10),n=setTimeout(e,50);return[t,r,n]}function NPe(e){let t=G.useRef();return G.useEffect(()=>{t.current=e}),t.current}var MPe=18,cie=40,DPe=`${cie}px`,LPe=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function FPe({containerRef:e,inputRef:t,pushPasswordManagerStrategy:r,isFocused:n}){let[o,l]=G.useState(!1),[d,i]=G.useState(!1),[g,x]=G.useState(!1),S=G.useMemo(()=>r==="none"?!1:(r==="increase-width"||r==="experimental-no-flickering")&&o&&d,[o,d,r]),E=G.useCallback(()=>{let A=e.current,C=t.current;if(!A||!C||g||r==="none")return;let N=A,k=N.getBoundingClientRect().left+N.offsetWidth,R=N.getBoundingClientRect().top+N.offsetHeight/2,L=k-MPe,j=R;document.querySelectorAll(LPe).length===0&&document.elementFromPoint(L,j)===A||(l(!0),x(!0))},[e,t,g,r]);return G.useEffect(()=>{let A=e.current;if(!A||r==="none")return;function C(){let k=window.innerWidth-A.getBoundingClientRect().right;i(k>=cie)}C();let N=setInterval(C,1e3);return()=>{clearInterval(N)}},[e,r]),G.useEffect(()=>{let A=n||document.activeElement===t.current;if(r==="none"||!A)return;let C=setTimeout(E,0),N=setTimeout(E,2e3),k=setTimeout(E,5e3),R=setTimeout(()=>{x(!0)},6e3);return()=>{clearTimeout(C),clearTimeout(N),clearTimeout(k),clearTimeout(R)}},[t,n,r,E]),{hasPWMBadge:o,willPushPWMBadge:S,PWM_BADGE_SPACE_WIDTH:DPe}}var uie=G.createContext({}),die=G.forwardRef((e,t)=>{var r=e,{value:n,onChange:o,maxLength:l,textAlign:d="left",pattern:i,placeholder:g,inputMode:x="numeric",onComplete:S,pushPasswordManagerStrategy:E="increase-width",pasteTransformer:A,containerClassName:C,noScriptCSSFallback:N=zPe,render:k,children:R}=r,L=RPe(r,["value","onChange","maxLength","textAlign","pattern","placeholder","inputMode","onComplete","pushPasswordManagerStrategy","pasteTransformer","containerClassName","noScriptCSSFallback","render","children"]),j,F,B,U,Z;let[X,te]=G.useState(typeof L.defaultValue=="string"?L.defaultValue:""),se=n??X,oe=NPe(se),ne=G.useCallback(Vt=>{o==null||o(Vt),te(Vt)},[o]),ee=G.useMemo(()=>i?typeof i=="string"?new RegExp(i):i:null,[i]),ie=G.useRef(null),he=G.useRef(null),Se=G.useRef({value:se,onChange:ne,isIOS:typeof window<"u"&&((F=(j=window==null?void 0:window.CSS)==null?void 0:j.supports)==null?void 0:F.call(j,"-webkit-touch-callout","none"))}),Ce=G.useRef({prev:[(B=ie.current)==null?void 0:B.selectionStart,(U=ie.current)==null?void 0:U.selectionEnd,(Z=ie.current)==null?void 0:Z.selectionDirection]});G.useImperativeHandle(t,()=>ie.current,[]),G.useEffect(()=>{let Vt=ie.current,dr=he.current;if(!Vt||!dr)return;Se.current.value!==Vt.value&&Se.current.onChange(Vt.value),Ce.current.prev=[Vt.selectionStart,Vt.selectionEnd,Vt.selectionDirection];function Br(){if(document.activeElement!==Vt){ge(null),Qe(null);return}let Mt=Vt.selectionStart,Ke=Vt.selectionEnd,at=Vt.selectionDirection,dt=Vt.maxLength,tr=Vt.value,Qt=Ce.current.prev,er=-1,Pr=-1,sn;if(tr.length!==0&&Mt!==null&&Ke!==null){let Zi=Mt===Ke,Rs=Mt===tr.length&&tr.length<dt;if(Zi&&!Rs){let Ua=Mt;if(Ua===0)er=0,Pr=1,sn="forward";else if(Ua===dt)er=Ua-1,Pr=Ua,sn="backward";else if(dt>1&&tr.length>1){let wi=0;if(Qt[0]!==null&&Qt[1]!==null){sn=Ua<Qt[1]?"backward":"forward";let _s=Qt[0]===Qt[1]&&Qt[0]<dt;sn==="backward"&&!_s&&(wi=-1)}er=wi+Ua,Pr=wi+Ua+1}}er!==-1&&Pr!==-1&&er!==Pr&&ie.current.setSelectionRange(er,Pr,sn)}let fn=er!==-1?er:Mt,Ai=Pr!==-1?Pr:Ke,mi=sn??at;ge(fn),Qe(Ai),Ce.current.prev=[fn,Ai,mi]}if(document.addEventListener("selectionchange",Br,{capture:!0}),Br(),document.activeElement===Vt&&Pe(!0),!document.getElementById("input-otp-style")){let Mt=document.createElement("style");if(Mt.id="input-otp-style",document.head.appendChild(Mt),Mt.sheet){let Ke="background: transparent !important; color: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";lS(Mt.sheet,"[data-input-otp]::selection { background: transparent !important; color: transparent !important; }"),lS(Mt.sheet,`[data-input-otp]:autofill { ${Ke} }`),lS(Mt.sheet,`[data-input-otp]:-webkit-autofill { ${Ke} }`),lS(Mt.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),lS(Mt.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let Yr=()=>{dr&&dr.style.setProperty("--root-height",`${Vt.clientHeight}px`)};Yr();let _t=new ResizeObserver(Yr);return _t.observe(Vt),()=>{document.removeEventListener("selectionchange",Br,{capture:!0}),_t.disconnect()}},[]);let[fe,_e]=G.useState(!1),[be,Pe]=G.useState(!1),[ye,ge]=G.useState(null),[ke,Qe]=G.useState(null);G.useEffect(()=>{jPe(()=>{var Vt,dr,Br,Yr;(Vt=ie.current)==null||Vt.dispatchEvent(new Event("input"));let _t=(dr=ie.current)==null?void 0:dr.selectionStart,Mt=(Br=ie.current)==null?void 0:Br.selectionEnd,Ke=(Yr=ie.current)==null?void 0:Yr.selectionDirection;_t!==null&&Mt!==null&&(ge(_t),Qe(Mt),Ce.current.prev=[_t,Mt,Ke])})},[se,be]),G.useEffect(()=>{oe!==void 0&&se!==oe&&oe.length<l&&se.length===l&&(S==null||S(se))},[l,S,oe,se]);let He=FPe({containerRef:he,inputRef:ie,pushPasswordManagerStrategy:E,isFocused:be}),$e=G.useCallback(Vt=>{let dr=Vt.currentTarget.value.slice(0,l);if(dr.length>0&&ee&&!ee.test(dr)){Vt.preventDefault();return}typeof oe=="string"&&dr.length<oe.length&&document.dispatchEvent(new Event("selectionchange")),ne(dr)},[l,ne,oe,ee]),Xe=G.useCallback(()=>{var Vt;if(ie.current){let dr=Math.min(ie.current.value.length,l-1),Br=ie.current.value.length;(Vt=ie.current)==null||Vt.setSelectionRange(dr,Br),ge(dr),Qe(Br)}Pe(!0)},[l]),ft=G.useCallback(Vt=>{var dr,Br;let Yr=ie.current;if(!A&&(!Se.current.isIOS||!Vt.clipboardData||!Yr))return;let _t=Vt.clipboardData.getData("text/plain"),Mt=A?A(_t):_t;Vt.preventDefault();let Ke=(dr=ie.current)==null?void 0:dr.selectionStart,at=(Br=ie.current)==null?void 0:Br.selectionEnd,dt=(Ke!==at?se.slice(0,Ke)+Mt+se.slice(at):se.slice(0,Ke)+Mt+se.slice(Ke)).slice(0,l);if(dt.length>0&&ee&&!ee.test(dt))return;Yr.value=dt,ne(dt);let tr=Math.min(dt.length,l-1),Qt=dt.length;Yr.setSelectionRange(tr,Qt),ge(tr),Qe(Qt)},[l,ne,ee,se]),ze=G.useMemo(()=>({position:"relative",cursor:L.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[L.disabled]),ut=G.useMemo(()=>({position:"absolute",inset:0,width:He.willPushPWMBadge?`calc(100% + ${He.PWM_BADGE_SPACE_WIDTH})`:"100%",clipPath:He.willPushPWMBadge?`inset(0 ${He.PWM_BADGE_SPACE_WIDTH} 0 0)`:void 0,height:"100%",display:"flex",textAlign:d,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[He.PWM_BADGE_SPACE_WIDTH,He.willPushPWMBadge,d]),At=G.useMemo(()=>G.createElement("input",kPe(IPe({autoComplete:L.autoComplete||"one-time-code"},L),{"data-input-otp":!0,"data-input-otp-placeholder-shown":se.length===0||void 0,"data-input-otp-mss":ye,"data-input-otp-mse":ke,inputMode:x,pattern:ee==null?void 0:ee.source,"aria-placeholder":g,style:ut,maxLength:l,value:se,ref:ie,onPaste:Vt=>{var dr;ft(Vt),(dr=L.onPaste)==null||dr.call(L,Vt)},onChange:$e,onMouseOver:Vt=>{var dr;_e(!0),(dr=L.onMouseOver)==null||dr.call(L,Vt)},onMouseLeave:Vt=>{var dr;_e(!1),(dr=L.onMouseLeave)==null||dr.call(L,Vt)},onFocus:Vt=>{var dr;Xe(),(dr=L.onFocus)==null||dr.call(L,Vt)},onBlur:Vt=>{var dr;Pe(!1),(dr=L.onBlur)==null||dr.call(L,Vt)}})),[$e,Xe,ft,x,ut,l,ke,ye,L,ee==null?void 0:ee.source,se]),xt=G.useMemo(()=>({slots:Array.from({length:l}).map((Vt,dr)=>{var Br;let Yr=be&&ye!==null&&ke!==null&&(ye===ke&&dr===ye||dr>=ye&&dr<ke),_t=se[dr]!==void 0?se[dr]:null,Mt=se[0]!==void 0?null:(Br=g==null?void 0:g[dr])!=null?Br:null;return{char:_t,placeholderChar:Mt,isActive:Yr,hasFakeCaret:Yr&&_t===null}}),isFocused:be,isHovering:!L.disabled&&fe}),[be,fe,l,ke,ye,L.disabled,se]),nr=G.useMemo(()=>k?k(xt):G.createElement(uie.Provider,{value:xt},R),[R,xt,k]);return G.createElement(G.Fragment,null,N!==null&&G.createElement("noscript",null,G.createElement("style",null,N)),G.createElement("div",{ref:he,"data-input-otp-container":!0,style:ze,className:C},nr,G.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},At)))});die.displayName="Input";function lS(e,t){try{e.insertRule(t)}catch{console.error("input-otp could not insert CSS rule:",t)}}var zPe=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const w4=G.forwardRef(({className:e,containerClassName:t,...r},n)=>m.jsx(die,{ref:n,containerClassName:_r("flex items-center gap-2 has-[:disabled]:opacity-50",t),className:_r("disabled:cursor-not-allowed",e),...r}));w4.displayName="InputOTP";const S4=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,className:_r("flex items-center",e),...t}));S4.displayName="InputOTPGroup";const xf=G.forwardRef(({index:e,className:t,...r},n)=>{const o=G.useContext(uie),{char:l,hasFakeCaret:d,isActive:i}=o.slots[e];return m.jsxs("div",{ref:n,className:_r("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",i&&"z-10 ring-2 ring-ring ring-offset-background",t),...r,children:[l,d&&m.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:m.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]})});xf.displayName="InputOTPSlot";const BPe=G.forwardRef(({...e},t)=>m.jsx("div",{ref:t,role:"separator",...e,children:m.jsx(rye,{})}));BPe.displayName="InputOTPSeparator";const E4=({targetType:e,targetId:t,trigger:r})=>{const{t:n}=Ki(),{user:o}=Di(),[l,d]=G.useState(!1),[i,g]=G.useState(!1),[x,S]=G.useState(!1),[E,A]=G.useState(""),[C,N]=G.useState(""),[k,R]=G.useState((o==null?void 0:o.email)||""),[L,j]=G.useState([""]),[F,B]=G.useState([]),[U,Z]=G.useState(!1),[X,te]=G.useState("form"),[se,oe]=G.useState(""),[ne,ee]=G.useState(0),[ie,he]=G.useState(!1),Se=ze=>{d(ze),ze&&(o!=null&&o.email)&&R(o.email),ze||(te("form"),oe(""),ee(0))};G.useEffect(()=>{let ze;return ne>0&&(ze=setTimeout(()=>ee(ne-1),1e3)),()=>clearTimeout(ze)},[ne]);const Ce=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"],fe=()=>{j([...L,""])},_e=ze=>{j(L.filter((ut,At)=>At!==ze))},be=(ze,ut)=>{const At=[...L];At[ze]=ut,j(At)},Pe=ze=>{const ut=Array.from(ze.target.files||[]);if(ut.filter(Vt=>Vt.size>5*1024*1024).length>0){Vr.error(n("report.imageTooLarge"));return}const xt=["image/jpeg","image/png","image/webp","image/gif"];if(ut.filter(Vt=>!xt.includes(Vt.type)).length>0){Vr.error(n("report.invalidImageType"));return}B(Vt=>[...Vt,...ut])},ye=ze=>{B(ut=>ut.filter((At,xt)=>xt!==ze))},ge=async()=>{if(F.length===0)return[];Z(!0);const ze=[];try{for(const ut of F){const At=ut.name.split(".").pop(),nr=`${`${Date.now()}-${Math.random().toString(36).substring(7)}.${At}`}`,{error:Vt}=await Ut.storage.from("report-evidence").upload(nr,ut);if(Vt)throw Vt;const{data:dr}=Ut.storage.from("report-evidence").getPublicUrl(nr);ze.push(dr.publicUrl)}return ze}catch(ut){throw console.error("Error uploading images:",ut),ut}finally{Z(!1)}},ke=async()=>{if(!k.trim()){Vr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)){Vr.error(n("report.invalidEmail"));return}he(!0);try{const{error:ze}=await Ut.functions.invoke("send-verification-code",{body:{email:k}});if(ze){Vr.error(n("auth.verificationCodeFailed")),console.error(ze);return}te("verify"),Vr.success(n("auth.verificationCodeSent")),ee(30)}catch(ze){Vr.error(ze.message||n("error.general"))}finally{he(!1)}},Qe=async()=>{ne>0||await ke()},He=async()=>{if(se.length!==4){Vr.error(n("auth.invalidVerificationCode"));return}S(!0);try{const{data:ze,error:ut}=await Ut.functions.invoke("verify-email-code",{body:{email:k,code:se}});if(ut||!(ze!=null&&ze.success)){(ze==null?void 0:ze.error)==="This verification code has already been used"?Vr.error(n("auth.verificationCodeUsed")):Vr.error((ze==null?void 0:ze.error)||n("auth.invalidVerificationCode")),S(!1);return}te("submitting"),await Xe()}catch(ze){Vr.error(ze.message||n("error.general")),S(!1)}},$e=async()=>{if(!E){Vr.error(n("report.reasonPlaceholder"));return}if(!C||C.length<20){Vr.error(n("report.detailsMin"));return}if(!k.trim()){Vr.error(n("report.contactRequired"));return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(k)){Vr.error(n("report.invalidEmail"));return}if(L.filter(ut=>ut.trim()!=="").length===0&&F.length===0){Vr.error(n("report.evidenceRequired"));return}o?g(!0):await ke()},Xe=async()=>{S(!0);try{let ze=[];try{ze=await ge()}catch{Vr.error(n("report.imageUploadFailed")),S(!1);return}const At=[...L.filter(_t=>_t.trim()!==""),...ze],xt={reporter_id:(o==null?void 0:o.id)||null,target_type:e,target_id:t,reason:E,description:C,evidence_urls:At,reporter_contact:k};console.log("Attempting to insert report:",xt);const{data:nr,error:Vt}=await Ut.from("reports").insert(xt).select().single();if(console.log("Insert result:",{report:nr,error:Vt}),Vt)throw Vt;let dr="Anonymous",Br=k;if(o){const{data:_t}=await Ut.from("profiles").select("display_name").eq("id",o.id).single();dr=(_t==null?void 0:_t.display_name)||"Unknown",Br=o.email||k}await Ut.functions.invoke("send-report-email",{body:{reportId:nr.id,reporterName:dr,reporterEmail:Br,targetType:e,targetId:t,reason:E,description:C,evidenceUrls:At.length>0?At:void 0,reporterContact:k||void 0}});const Yr=nr.id.substring(0,8).toUpperCase();Vr.success(n("report.successDetailed",{reference:Yr}),{description:n("report.successDescription"),duration:8e3}),d(!1),g(!1),A(""),N(""),o||R(""),j([""]),B([]),te("form"),oe("")}catch(ze){console.error("Error submitting report:",ze),Vr.error(n("report.failed"))}finally{S(!1)}},ft=()=>{switch(e){case"comment":return n("report.reportComment");case"restaurant":return n("report.reportRestaurant");case"activity":return n("report.reportActivity");case"user":return n("report.reportUser");default:return n("report.title")}};return m.jsxs(m.Fragment,{children:[m.jsxs(Rh,{open:l,onOpenChange:Se,children:[m.jsx(Iv,{asChild:!0,children:r||m.jsxs(lr,{variant:"ghost",size:"sm",children:[m.jsx(tk,{className:"w-4 h-4 mr-2"}),n("report.title")]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:ft()}),m.jsx(Md,{children:n(X==="verify"?"auth.verificationCodeSent":"report.description")})]}),X==="form"?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"reason",children:n("report.reason")}),m.jsxs(wd,{value:E,onValueChange:A,children:[m.jsx(Au,{children:m.jsx(Sd,{placeholder:n("report.reasonPlaceholder")})}),m.jsx(Pu,{children:Ce.map(ze=>m.jsx(La,{value:ze,children:n(`report.reasons.${ze}`)},ze))})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"description",children:n("report.detailsLabel")}),m.jsx(Mm,{id:"description",value:C,onChange:ze=>N(ze.target.value),placeholder:n("report.detailsPlaceholder"),rows:5,className:"resize-none"}),m.jsxs("p",{className:"text-xs text-muted-foreground",children:[C.length,"/20 ",n("common.characters")]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{htmlFor:"contact",children:[n("report.contactLabel"),m.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),m.jsx(an,{id:"contact",type:"email",value:k,onChange:ze=>R(ze.target.value),placeholder:n("report.contactPlaceholder"),required:!0})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{children:[n("report.evidenceLabel"),m.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),m.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:n("report.evidenceRequiredNote")}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"image-upload",className:"text-sm font-medium",children:n("report.uploadImages")}),m.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:F.map((ze,ut)=>m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:URL.createObjectURL(ze),alt:`Evidence ${ut+1}`,className:"w-20 h-20 object-cover rounded border"}),m.jsx(lr,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>ye(ut),children:m.jsx(ju,{className:"w-3 h-3"})})]},ut))}),m.jsx(an,{id:"image-upload",type:"file",accept:"image/jpeg,image/png,image/webp,image/gif",multiple:!0,onChange:Pe,className:"cursor-pointer"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:n("report.imageUploadHint")})]}),m.jsxs("div",{className:"space-y-2 pt-2",children:[m.jsx(Zr,{className:"text-sm font-medium",children:n("report.evidenceUrls")}),L.map((ze,ut)=>m.jsxs("div",{className:"flex gap-2",children:[m.jsx(an,{value:ze,onChange:At=>be(ut,At.target.value),placeholder:n("report.evidencePlaceholder")}),L.length>1&&m.jsx(lr,{variant:"ghost",size:"icon",onClick:()=>_e(ut),children:m.jsx(ju,{className:"w-4 h-4"})})]},ut)),m.jsxs(lr,{variant:"outline",size:"sm",onClick:fe,className:"w-full",children:[m.jsx(hB,{className:"w-4 h-4 mr-2"}),n("report.addEvidence")]})]})]})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(lr,{variant:"outline",onClick:()=>d(!1),children:n("report.cancel")}),m.jsx(lr,{onClick:$e,disabled:!E||C.length<20||!k.trim()||L.filter(ze=>ze.trim()!=="").length===0&&F.length===0||U||ie,children:n(U?"common.uploading":ie?"auth.sendingCode":"report.submit")})]})]}):X==="submitting"?m.jsx("div",{className:"space-y-4 py-8",children:m.jsxs("div",{className:"flex flex-col items-center justify-center space-y-4",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"}),m.jsx("p",{className:"text-center text-muted-foreground",children:n("report.submitting")})]})}):m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:n("auth.verificationCode")}),m.jsx("div",{className:"flex justify-center",children:m.jsx(w4,{maxLength:4,value:se,onChange:ze=>oe(ze),children:m.jsxs(S4,{children:[m.jsx(xf,{index:0}),m.jsx(xf,{index:1}),m.jsx(xf,{index:2}),m.jsx(xf,{index:3})]})})}),m.jsx("p",{className:"text-xs text-muted-foreground text-center",children:n("auth.verificationCodeHint",{email:k})})]}),m.jsx("div",{className:"flex justify-center",children:m.jsx(lr,{variant:"link",size:"sm",onClick:Qe,disabled:ne>0||x,children:ne>0?`${n("auth.resendCode")} (${ne}s)`:n("auth.resendCode")})}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(lr,{variant:"outline",className:"w-full",onClick:()=>{te("form"),oe("")},disabled:x,children:n("common.back")}),m.jsx(lr,{className:"w-full",onClick:He,disabled:se.length!==4||x,children:n(x?"auth.verifying":"auth.verify")})]})]})]})]}),m.jsx(zl,{open:i,onOpenChange:g,children:m.jsxs(ol,{children:[m.jsxs(sl,{children:[m.jsx(cl,{children:n("report.confirmTitle")}),m.jsx(ul,{children:n("report.confirmMessage")})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:n("report.cancel")}),m.jsx(Us,{onClick:Xe,disabled:x,children:n(x?"report.submitting":"report.submit")})]})]})})]})},QW=[{value:"0-5",label:"0-5"},{value:"5-10",label:"5-10"},{value:"10-15",label:"10-15"},{value:"15-20",label:"15-20"},{value:"20-25",label:"20-25"},{value:"25-30",label:"25-30"},{value:"30-40",label:"30-40"},{value:"40-50",label:"40-50"},{value:"50+",label:"50+"}],hie=({restaurantId:e,targetType:t="restaurant"})=>{var ke,Qe;const{t:r}=Ki(),{user:n}=Di(),{data:o}=i4(),{toast:l}=wa(),[d,i]=G.useState(""),[g,x]=G.useState(0),[S,E]=G.useState(0),[A,C]=G.useState(""),[N,k]=G.useState(null),[R,L]=G.useState(""),[j,F]=G.useState(null),[B,U]=G.useState(null),[Z,X]=G.useState(null),[te,se]=G.useState(null),[oe,ne]=G.useState(!1),{data:ee,isLoading:ie}=v4(e,t),he=k2e(),Se=R2e(),Ce=async He=>{try{const $e=He.name.split(".").pop(),ft=`${`${n==null?void 0:n.id}-${Date.now()}.${$e}`}`,{error:ze,data:ut}=await Ut.storage.from("comment-images").upload(ft,He);if(ze)throw ze;const{data:{publicUrl:At}}=Ut.storage.from("comment-images").getPublicUrl(ft);return At}catch($e){return console.error("Error uploading image:",$e),l({title:r("common.error"),description:r("restaurant.imageUploadFailed"),variant:"destructive"}),null}},fe=(He,$e=!1)=>{var ft;const Xe=(ft=He.target.files)==null?void 0:ft[0];if(Xe){if(Xe.size>5*1024*1024){l({title:r("common.error"),description:r("restaurant.imageTooLarge"),variant:"destructive"});return}$e?(X(Xe),se(URL.createObjectURL(Xe))):(F(Xe),U(URL.createObjectURL(Xe)))}},_e=(He=!1)=>{He?(X(null),se(null)):(F(null),U(null))},be=async()=>{if(!d.trim()||!n)return;if(t==="restaurant"&&!g){l({title:r("common.error"),description:"",variant:"destructive"});return}ne(!0);let He;if(j){const $e=await Ce(j);$e&&(He=$e)}await he.mutateAsync({targetId:e,targetType:t,content:d,ratingValue:t==="restaurant"?g:void 0,priceRange:t==="restaurant"&&A?A:void 0,imageUrl:He}),i(""),x(0),C(""),F(null),U(null),ne(!1)},Pe=async He=>{if(!R.trim()||!n)return;ne(!0);let $e;if(Z){const Xe=await Ce(Z);Xe&&($e=Xe)}await he.mutateAsync({targetId:e,targetType:t,content:R,parentId:He,imageUrl:$e}),L(""),k(null),X(null),se(null),ne(!1)},ye=async He=>{window.confirm(r("restaurant.confirmDelete"))&&await Se.mutateAsync(He)},ge=({comment:He,isReply:$e=!1})=>{var Xe,ft,ze,ut,At;return m.jsxs("div",{className:`flex gap-2 sm:gap-3 ${$e?"ml-8 sm:ml-12 mt-3":""}`,children:[m.jsxs(qm,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[m.jsx(Wm,{src:(Xe=He.profiles)==null?void 0:Xe.avatar_url}),m.jsx(Gm,{className:"text-xs sm:text-sm",children:((ze=(ft=He.profiles)==null?void 0:ft.display_name)==null?void 0:ze.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx("span",{className:"font-semibold text-xs sm:text-sm truncate",children:(ut=He.profiles)==null?void 0:ut.display_name}),m.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:_f(new Date(He.created_at),{addSuffix:!0})}),He.edited&&m.jsxs("span",{className:"text-xs text-muted-foreground italic",children:["(",r("restaurant.edited"),")"]})]}),!$e&&He.rating_value&&m.jsxs("div",{className:"flex items-center gap-3 mt-1 mb-2",children:[m.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(xt=>m.jsx(wc,{className:_r("w-4 h-4",xt<=He.rating_value?"fill-accent text-accent":"text-muted-foreground")},xt))}),He.price_range&&m.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[m.jsx(wL,{className:"w-3 h-3"}),m.jsx("span",{children:(At=QW.find(xt=>xt.value===He.price_range))==null?void 0:At.label})]})]}),m.jsx("p",{className:"text-xs sm:text-sm mt-1 text-foreground break-words",children:He.content}),He.image_url&&m.jsx("img",{src:He.image_url,alt:"Comment attachment",className:"mt-2 rounded-lg max-w-full sm:max-w-sm w-full"}),m.jsxs("div",{className:"flex gap-2 sm:gap-3 mt-2",children:[!$e&&n&&m.jsxs(lr,{variant:"ghost",size:"sm",onClick:()=>k(He.id),className:"h-7 text-xs px-2 sm:px-3",children:[m.jsx(uye,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("restaurant.reply")})]}),(n==null?void 0:n.id)===He.user_id&&m.jsxs(lr,{variant:"ghost",size:"sm",onClick:()=>ye(He.id),className:"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3",children:[m.jsx(bb,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("common.delete")})]}),n&&n.id!==He.user_id&&m.jsx(E4,{targetType:"comment",targetId:He.id,trigger:m.jsxs(lr,{variant:"ghost",size:"sm",className:"h-7 text-xs px-2 sm:px-3",children:[m.jsx(tk,{className:"w-3 h-3 mr-1"}),m.jsx("span",{className:"hidden xs:inline",children:r("report.title")})]})})]}),N===He.id&&m.jsx("div",{className:"mt-3 space-y-2",children:m.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsx(Mm,{value:R,onChange:xt=>L(xt.target.value),placeholder:r("restaurant.writeReply"),className:"min-h-[80px] text-sm"}),te&&m.jsxs("div",{className:"relative inline-block max-w-full",children:[m.jsx("img",{src:te,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),m.jsx(lr,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>_e(!0),children:m.jsx(ju,{className:"h-4 w-4"})})]})]}),m.jsxs("div",{className:"flex sm:flex-col gap-2",children:[m.jsx(lr,{size:"sm",onClick:()=>Pe(He.id),disabled:!R.trim()||oe,className:"text-xs",children:r(oe?"common.loading":"restaurant.reply")}),m.jsx(an,{type:"file",accept:"image/*",onChange:xt=>fe(xt,!0),className:"hidden",id:`reply-image-${He.id}`,disabled:oe}),m.jsxs(lr,{size:"sm",variant:"outline",onClick:()=>{var xt;return(xt=document.getElementById(`reply-image-${He.id}`))==null?void 0:xt.click()},disabled:oe,className:"text-xs sm:px-3",children:[m.jsx(gq,{className:"h-4 w-4 sm:mr-1"}),m.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),m.jsx(lr,{size:"sm",variant:"outline",onClick:()=>{k(null),L(""),_e(!0)},className:"text-xs",children:r("common.cancel")})]})]})}),He.replies&&He.replies.length>0&&m.jsx("div",{className:"mt-3 space-y-3",children:He.replies.map(xt=>m.jsx(ge,{comment:xt,isReply:!0},xt.id))})]})]})};return ie?m.jsx("div",{className:"text-center py-8",children:r("common.loading")}):m.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(dB,{className:"w-4 sm:w-5 h-4 sm:h-5"}),m.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:[r("restaurant.reviews")," (",(ee==null?void 0:ee.length)||0,")"]})]}),n?m.jsx(Qr,{children:m.jsx(dn,{className:"pt-4 sm:pt-6 px-3 sm:px-6",children:m.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[m.jsxs(qm,{className:"w-8 h-8 sm:w-10 sm:h-10 shrink-0",children:[m.jsx(Wm,{src:(o==null?void 0:o.avatar_url)||void 0}),m.jsx(Gm,{className:"text-xs sm:text-sm",children:((ke=o==null?void 0:o.display_name)==null?void 0:ke.charAt(0).toUpperCase())||((Qe=n==null?void 0:n.email)==null?void 0:Qe.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 space-y-2 sm:space-y-3 min-w-0",children:[t==="restaurant"&&m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(wc,{className:"w-4 h-4 text-accent"})," ",m.jsx("span",{className:"text-destructive",children:"*"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[[1,2,3,4,5].map(He=>m.jsx("button",{type:"button",onMouseEnter:()=>E(He),onMouseLeave:()=>E(0),onClick:()=>x(He),className:"transition-transform hover:scale-110",children:m.jsx(wc,{className:_r("w-7 h-7 cursor-pointer transition-colors",He<=(S||g)?"fill-accent text-accent":"text-muted-foreground hover:text-accent")})},He)),g>0&&m.jsxs("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",g,"/5)"]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(wL,{className:"w-4 h-4"}),r("restaurant.priceRange")]}),m.jsxs(wd,{value:A,onValueChange:C,children:[m.jsx(Au,{className:"w-full",children:m.jsx(Sd,{placeholder:r("restaurant.selectPriceRange")})}),m.jsx(Pu,{className:"bg-background",children:QW.map(He=>m.jsx(La,{value:He.value,children:He.label},He.value))})]})]})]}),m.jsx(Mm,{value:d,onChange:He=>i(He.target.value),placeholder:r("restaurant.writeComment"),className:"min-h-[80px] sm:min-h-[100px] text-sm"}),B&&m.jsxs("div",{className:"relative inline-block max-w-full",children:[m.jsx("img",{src:B,alt:"Preview",className:"max-w-full sm:max-w-xs rounded-lg"}),m.jsx(lr,{size:"icon",variant:"destructive",className:"absolute -top-2 -right-2 h-6 w-6 rounded-full",onClick:()=>_e(!1),children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs("div",{className:"flex flex-wrap gap-2",children:[m.jsx(an,{type:"file",accept:"image/*",onChange:He=>fe(He,!1),className:"hidden",id:"comment-image",disabled:oe}),m.jsxs(lr,{variant:"outline",size:"sm",onClick:()=>{var He;return(He=document.getElementById("comment-image"))==null?void 0:He.click()},disabled:oe,className:"text-xs",children:[m.jsx(gq,{className:"h-4 w-4 sm:mr-2"}),m.jsx("span",{className:"hidden sm:inline",children:r("restaurant.addImage")})]}),m.jsx(lr,{onClick:be,disabled:!d.trim()||he.isPending||oe,size:"sm",className:"text-xs",children:oe||he.isPending?r("common.loading"):r("restaurant.postComment")})]})]})]})})}):m.jsx(Qr,{children:m.jsx(dn,{className:"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.signInToComment")})}),m.jsx("div",{className:"space-y-4 sm:space-y-6",children:ee==null?void 0:ee.map(He=>m.jsx(Qr,{children:m.jsx(Mi,{className:"p-3 sm:p-6",children:m.jsx(ge,{comment:He})})},He.id))}),(ee==null?void 0:ee.length)===0&&m.jsx(Qr,{children:m.jsx(dn,{className:"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm",children:r("restaurant.noComments")})})]})},UT=()=>{const{user:e}=Di();return Wi({queryKey:["merchantRestaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("merchant_restaurants").select(`
          restaurant_id,
          restaurants:restaurant_id (
            id,
            name,
            name_en,
            name_pt,
            address,
            image_url,
            lat,
            lng,
            rating,
            type,
            type_en,
            type_pt,
            phone,
            website_url,
            description,
            description_en,
            description_pt,
            opening_hours,
            show_website_button,
            created_at,
            updated_at
          )
        `).eq("user_id",e.id);if(r)throw r;return(t==null?void 0:t.map(n=>n.restaurants).filter(Boolean))||[]},enabled:!!e})},$Pe=e=>{const{user:t}=Di(),{data:r=[]}=UT();return Wi({queryKey:["myParticipatingRestaurants",e,t==null?void 0:t.id],queryFn:async()=>{if(!t||r.length===0)return[];const n=r.map(d=>d.id),{data:o,error:l}=await Ut.from("activity_restaurants").select("restaurant_id").eq("activity_id",e).in("restaurant_id",n);if(l)throw l;return(o==null?void 0:o.map(d=>d.restaurant_id))||[]},enabled:!!t&&!!e&&r.length>0})},UPe=()=>{const{user:e}=Di(),{toast:t}=wa(),r=Na();return Xa({mutationFn:async({activityId:n,restaurantId:o})=>{if(!e)throw new Error("User not authenticated");const{data:l}=await Ut.from("activity_restaurants").select("id").eq("activity_id",n).eq("restaurant_id",o).maybeSingle();if(l){const{error:d}=await Ut.from("activity_restaurants").delete().eq("id",l.id);if(d)throw d;return{action:"removed"}}else{const{error:d}=await Ut.from("activity_restaurants").insert({activity_id:n,restaurant_id:o});if(d)throw d;return{action:"added"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["activityRestaurants"]}),r.invalidateQueries({queryKey:["myParticipatingRestaurants"]}),t({title:n.action==="added"?"":"",description:n.action==="added"?"":""})},onError:()=>{t({title:"",description:"",variant:"destructive"})}})};var VT=e=>e.type==="checkbox",Ny=e=>e instanceof Date,Fl=e=>e==null;const fie=e=>typeof e=="object";var Fo=e=>!Fl(e)&&!Array.isArray(e)&&fie(e)&&!Ny(e),pie=e=>Fo(e)&&e.target?VT(e.target)?e.target.checked:e.target.value:e,VPe=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,mie=(e,t)=>e.has(VPe(t)),qPe=e=>{const t=e.constructor&&e.constructor.prototype;return Fo(t)&&t.hasOwnProperty("isPrototypeOf")},T4=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ds(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(T4&&(e instanceof Blob||n))&&(r||Fo(e)))if(t=r?[]:{},!r&&!qPe(e))t=e;else for(const o in e)e.hasOwnProperty(o)&&(t[o]=ds(e[o]));else return e;return t}var Mk=e=>/^\w*$/.test(e),No=e=>e===void 0,A4=e=>Array.isArray(e)?e.filter(Boolean):[],P4=e=>A4(e.replace(/["|']|\]/g,"").split(/\.|\[/)),en=(e,t,r)=>{if(!t||!Fo(e))return r;const n=(Mk(t)?[t]:P4(t)).reduce((o,l)=>Fl(o)?o:o[l],e);return No(n)||n===e?No(e[t])?r:e[t]:n},zc=e=>typeof e=="boolean",ka=(e,t,r)=>{let n=-1;const o=Mk(t)?[t]:P4(t),l=o.length,d=l-1;for(;++n<l;){const i=o[n];let g=r;if(n!==d){const x=e[i];g=Fo(x)||Array.isArray(x)?x:isNaN(+o[n+1])?{}:[]}if(i==="__proto__"||i==="constructor"||i==="prototype")return;e[i]=g,e=e[i]}};const wO={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},yd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},sf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},C4=We.createContext(null);C4.displayName="HookFormContext";const Dk=()=>We.useContext(C4),WPe=e=>{const{children:t,...r}=e;return We.createElement(C4.Provider,{value:r},t)};var gie=(e,t,r,n=!0)=>{const o={defaultValues:t._defaultValues};for(const l in e)Object.defineProperty(o,l,{get:()=>{const d=l;return t._proxyFormState[d]!==yd.all&&(t._proxyFormState[d]=!n||yd.all),r&&(r[d]=!0),e[d]}});return o};const O4=typeof window<"u"?We.useLayoutEffect:We.useEffect;function GPe(e){const t=Dk(),{control:r=t.control,disabled:n,name:o,exact:l}=e||{},[d,i]=We.useState(r._formState),g=We.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return O4(()=>r._subscribe({name:o,formState:g.current,exact:l,callback:x=>{!n&&i({...r._formState,...x})}}),[o,n,l]),We.useEffect(()=>{g.current.isValid&&r._setValid(!0)},[r]),We.useMemo(()=>gie(d,r,g.current,!1),[d,r])}var fh=e=>typeof e=="string",yie=(e,t,r,n,o)=>fh(e)?(n&&t.watch.add(e),en(r,e,o)):Array.isArray(e)?e.map(l=>(n&&t.watch.add(l),en(r,l))):(n&&(t.watchAll=!0),r),E3=e=>Fl(e)||!fie(e);function gf(e,t,r=new WeakSet){if(E3(e)||E3(t))return e===t;if(Ny(e)&&Ny(t))return e.getTime()===t.getTime();const n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const l of n){const d=e[l];if(!o.includes(l))return!1;if(l!=="ref"){const i=t[l];if(Ny(d)&&Ny(i)||Fo(d)&&Fo(i)||Array.isArray(d)&&Array.isArray(i)?!gf(d,i,r):d!==i)return!1}}return!0}function HPe(e){const t=Dk(),{control:r=t.control,name:n,defaultValue:o,disabled:l,exact:d,compute:i}=e||{},g=We.useRef(o),x=We.useRef(i),S=We.useRef(void 0);x.current=i;const E=We.useMemo(()=>r._getWatch(n,g.current),[r,n]),[A,C]=We.useState(x.current?x.current(E):E);return O4(()=>r._subscribe({name:n,formState:{values:!0},exact:d,callback:N=>{if(!l){const k=yie(n,r._names,N.values||r._formValues,!1,g.current);if(x.current){const R=x.current(k);gf(R,S.current)||(C(R),S.current=R)}else C(k)}}}),[r,l,n,d]),We.useEffect(()=>r._removeUnmounted()),A}function KPe(e){const t=Dk(),{name:r,disabled:n,control:o=t.control,shouldUnregister:l,defaultValue:d}=e,i=mie(o._names.array,r),g=We.useMemo(()=>en(o._formValues,r,en(o._defaultValues,r,d)),[o,r,d]),x=HPe({control:o,name:r,defaultValue:g,exact:!0}),S=GPe({control:o,name:r,exact:!0}),E=We.useRef(e),A=We.useRef(o.register(r,{...e.rules,value:x,...zc(e.disabled)?{disabled:e.disabled}:{}}));E.current=e;const C=We.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!en(S.errors,r)},isDirty:{enumerable:!0,get:()=>!!en(S.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!en(S.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!en(S.validatingFields,r)},error:{enumerable:!0,get:()=>en(S.errors,r)}}),[S,r]),N=We.useCallback(j=>A.current.onChange({target:{value:pie(j),name:r},type:wO.CHANGE}),[r]),k=We.useCallback(()=>A.current.onBlur({target:{value:en(o._formValues,r),name:r},type:wO.BLUR}),[r,o._formValues]),R=We.useCallback(j=>{const F=en(o._fields,r);F&&j&&(F._f.ref={focus:()=>j.focus&&j.focus(),select:()=>j.select&&j.select(),setCustomValidity:B=>j.setCustomValidity(B),reportValidity:()=>j.reportValidity()})},[o._fields,r]),L=We.useMemo(()=>({name:r,value:x,...zc(n)||S.disabled?{disabled:S.disabled||n}:{},onChange:N,onBlur:k,ref:R}),[r,n,S.disabled,N,k,R,x]);return We.useEffect(()=>{const j=o._options.shouldUnregister||l;o.register(r,{...E.current.rules,...zc(E.current.disabled)?{disabled:E.current.disabled}:{}});const F=(B,U)=>{const Z=en(o._fields,B);Z&&Z._f&&(Z._f.mount=U)};if(F(r,!0),j){const B=ds(en(o._options.defaultValues,r));ka(o._defaultValues,r,B),No(en(o._formValues,r))&&ka(o._formValues,r,B)}return!i&&o.register(r),()=>{(i?j&&!o._state.action:j)?o.unregister(r):F(r,!1)}},[r,o,i,l]),We.useEffect(()=>{o._setDisabledField({disabled:n,name:r})},[n,r,o]),We.useMemo(()=>({field:L,formState:S,fieldState:C}),[L,S,C])}const bC=e=>e.render(KPe(e));var vie=(e,t,r,n,o)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:o||!0}}:{},HS=e=>Array.isArray(e)?e:[e],e9=()=>{let e=[];return{get observers(){return e},next:o=>{for(const l of e)l.next&&l.next(o)},subscribe:o=>(e.push(o),{unsubscribe:()=>{e=e.filter(l=>l!==o)}}),unsubscribe:()=>{e=[]}}},dc=e=>Fo(e)&&!Object.keys(e).length,I4=e=>e.type==="file",vd=e=>typeof e=="function",SO=e=>{if(!T4)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},_ie=e=>e.type==="select-multiple",k4=e=>e.type==="radio",ZPe=e=>k4(e)||VT(e),qM=e=>SO(e)&&e.isConnected;function XPe(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=No(e)?n++:e[t[n++]];return e}function YPe(e){for(const t in e)if(e.hasOwnProperty(t)&&!No(e[t]))return!1;return!0}function Ko(e,t){const r=Array.isArray(t)?t:Mk(t)?[t]:P4(t),n=r.length===1?e:XPe(e,r),o=r.length-1,l=r[o];return n&&delete n[l],o!==0&&(Fo(n)&&dc(n)||Array.isArray(n)&&YPe(n))&&Ko(e,r.slice(0,-1)),e}var xie=e=>{for(const t in e)if(vd(e[t]))return!0;return!1};function EO(e,t={}){const r=Array.isArray(e);if(Fo(e)||r)for(const n in e)Array.isArray(e[n])||Fo(e[n])&&!xie(e[n])?(t[n]=Array.isArray(e[n])?[]:{},EO(e[n],t[n])):Fl(e[n])||(t[n]=!0);return t}function bie(e,t,r){const n=Array.isArray(e);if(Fo(e)||n)for(const o in e)Array.isArray(e[o])||Fo(e[o])&&!xie(e[o])?No(t)||E3(r[o])?r[o]=Array.isArray(e[o])?EO(e[o],[]):{...EO(e[o])}:bie(e[o],Fl(t)?{}:t[o],r[o]):r[o]=!gf(e[o],t[o]);return r}var cS=(e,t)=>bie(e,t,EO(t));const t9={value:!1,isValid:!1},r9={value:!0,isValid:!0};var wie=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!No(e[0].attributes.value)?No(e[0].value)||e[0].value===""?r9:{value:e[0].value,isValid:!0}:r9:t9}return t9},Sie=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>No(e)?e:t?e===""?NaN:e&&+e:r&&fh(e)?new Date(e):n?n(e):e;const n9={isValid:!1,value:null};var Eie=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,n9):n9;function i9(e){const t=e.ref;return I4(t)?t.files:k4(t)?Eie(e.refs).value:_ie(t)?[...t.selectedOptions].map(({value:r})=>r):VT(t)?wie(e.refs).value:Sie(No(t.value)?e.ref.value:t.value,e)}var JPe=(e,t,r,n)=>{const o={};for(const l of e){const d=en(t,l);d&&ka(o,l,d._f)}return{criteriaMode:r,names:[...e],fields:o,shouldUseNativeValidation:n}},TO=e=>e instanceof RegExp,uS=e=>No(e)?e:TO(e)?e.source:Fo(e)?TO(e.value)?e.value.source:e.value:e,a9=e=>({isOnSubmit:!e||e===yd.onSubmit,isOnBlur:e===yd.onBlur,isOnChange:e===yd.onChange,isOnAll:e===yd.all,isOnTouch:e===yd.onTouched});const o9="AsyncFunction";var QPe=e=>!!e&&!!e.validate&&!!(vd(e.validate)&&e.validate.constructor.name===o9||Fo(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===o9)),eCe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),s9=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const KS=(e,t,r,n)=>{for(const o of r||Object.keys(e)){const l=en(e,o);if(l){const{_f:d,...i}=l;if(d){if(d.refs&&d.refs[0]&&t(d.refs[0],o)&&!n)return!0;if(d.ref&&t(d.ref,d.name)&&!n)return!0;if(KS(i,t))break}else if(Fo(i)&&KS(i,t))break}}};function l9(e,t,r){const n=en(e,r);if(n||Mk(r))return{error:n,name:r};const o=r.split(".");for(;o.length;){const l=o.join("."),d=en(t,l),i=en(e,l);if(d&&!Array.isArray(d)&&r!==l)return{name:r};if(i&&i.type)return{name:l,error:i};if(i&&i.root&&i.root.type)return{name:`${l}.root`,error:i.root};o.pop()}return{name:r}}var tCe=(e,t,r,n)=>{r(e);const{name:o,...l}=e;return dc(l)||Object.keys(l).length>=Object.keys(t).length||Object.keys(l).find(d=>t[d]===(!n||yd.all))},rCe=(e,t,r)=>!e||!t||e===t||HS(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),nCe=(e,t,r,n,o)=>o.isOnAll?!1:!r&&o.isOnTouch?!(t||e):(r?n.isOnBlur:o.isOnBlur)?!e:(r?n.isOnChange:o.isOnChange)?e:!0,iCe=(e,t)=>!A4(en(e,t)).length&&Ko(e,t),aCe=(e,t,r)=>{const n=HS(en(e,r));return ka(n,"root",t[r]),ka(e,r,n),e},wC=e=>fh(e);function c9(e,t,r="validate"){if(wC(e)||Array.isArray(e)&&e.every(wC)||zc(e)&&!e)return{type:r,message:wC(e)?e:"",ref:t}}var yx=e=>Fo(e)&&!TO(e)?e:{value:e,message:""},u9=async(e,t,r,n,o,l)=>{const{ref:d,refs:i,required:g,maxLength:x,minLength:S,min:E,max:A,pattern:C,validate:N,name:k,valueAsNumber:R,mount:L}=e._f,j=en(r,k);if(!L||t.has(k))return{};const F=i?i[0]:d,B=ee=>{o&&F.reportValidity&&(F.setCustomValidity(zc(ee)?"":ee||""),F.reportValidity())},U={},Z=k4(d),X=VT(d),te=Z||X,se=(R||I4(d))&&No(d.value)&&No(j)||SO(d)&&d.value===""||j===""||Array.isArray(j)&&!j.length,oe=vie.bind(null,k,n,U),ne=(ee,ie,he,Se=sf.maxLength,Ce=sf.minLength)=>{const fe=ee?ie:he;U[k]={type:ee?Se:Ce,message:fe,ref:d,...oe(ee?Se:Ce,fe)}};if(l?!Array.isArray(j)||!j.length:g&&(!te&&(se||Fl(j))||zc(j)&&!j||X&&!wie(i).isValid||Z&&!Eie(i).isValid)){const{value:ee,message:ie}=wC(g)?{value:!!g,message:g}:yx(g);if(ee&&(U[k]={type:sf.required,message:ie,ref:F,...oe(sf.required,ie)},!n))return B(ie),U}if(!se&&(!Fl(E)||!Fl(A))){let ee,ie;const he=yx(A),Se=yx(E);if(!Fl(j)&&!isNaN(j)){const Ce=d.valueAsNumber||j&&+j;Fl(he.value)||(ee=Ce>he.value),Fl(Se.value)||(ie=Ce<Se.value)}else{const Ce=d.valueAsDate||new Date(j),fe=Pe=>new Date(new Date().toDateString()+" "+Pe),_e=d.type=="time",be=d.type=="week";fh(he.value)&&j&&(ee=_e?fe(j)>fe(he.value):be?j>he.value:Ce>new Date(he.value)),fh(Se.value)&&j&&(ie=_e?fe(j)<fe(Se.value):be?j<Se.value:Ce<new Date(Se.value))}if((ee||ie)&&(ne(!!ee,he.message,Se.message,sf.max,sf.min),!n))return B(U[k].message),U}if((x||S)&&!se&&(fh(j)||l&&Array.isArray(j))){const ee=yx(x),ie=yx(S),he=!Fl(ee.value)&&j.length>+ee.value,Se=!Fl(ie.value)&&j.length<+ie.value;if((he||Se)&&(ne(he,ee.message,ie.message),!n))return B(U[k].message),U}if(C&&!se&&fh(j)){const{value:ee,message:ie}=yx(C);if(TO(ee)&&!j.match(ee)&&(U[k]={type:sf.pattern,message:ie,ref:d,...oe(sf.pattern,ie)},!n))return B(ie),U}if(N){if(vd(N)){const ee=await N(j,r),ie=c9(ee,F);if(ie&&(U[k]={...ie,...oe(sf.validate,ie.message)},!n))return B(ie.message),U}else if(Fo(N)){let ee={};for(const ie in N){if(!dc(ee)&&!n)break;const he=c9(await N[ie](j,r),F,ie);he&&(ee={...he,...oe(ie,he.message)},B(he.message),n&&(U[k]=ee))}if(!dc(ee)&&(U[k]={ref:F,...ee},!n))return U}}return B(!0),U};const oCe={mode:yd.onSubmit,reValidateMode:yd.onChange,shouldFocusError:!0};function sCe(e={}){let t={...oCe,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:vd(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},o=Fo(t.defaultValues)||Fo(t.values)?ds(t.defaultValues||t.values)||{}:{},l=t.shouldUnregister?{}:ds(o),d={action:!1,mount:!1,watch:!1},i={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},g,x=0;const S={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let E={...S};const A={array:e9(),state:e9()},C=t.criteriaMode===yd.all,N=Ke=>at=>{clearTimeout(x),x=setTimeout(Ke,at)},k=async Ke=>{if(!t.disabled&&(S.isValid||E.isValid||Ke)){const at=t.resolver?dc((await X()).errors):await se(n,!0);at!==r.isValid&&A.state.next({isValid:at})}},R=(Ke,at)=>{!t.disabled&&(S.isValidating||S.validatingFields||E.isValidating||E.validatingFields)&&((Ke||Array.from(i.mount)).forEach(dt=>{dt&&(at?ka(r.validatingFields,dt,at):Ko(r.validatingFields,dt))}),A.state.next({validatingFields:r.validatingFields,isValidating:!dc(r.validatingFields)}))},L=(Ke,at=[],dt,tr,Qt=!0,er=!0)=>{if(tr&&dt&&!t.disabled){if(d.action=!0,er&&Array.isArray(en(n,Ke))){const Pr=dt(en(n,Ke),tr.argA,tr.argB);Qt&&ka(n,Ke,Pr)}if(er&&Array.isArray(en(r.errors,Ke))){const Pr=dt(en(r.errors,Ke),tr.argA,tr.argB);Qt&&ka(r.errors,Ke,Pr),iCe(r.errors,Ke)}if((S.touchedFields||E.touchedFields)&&er&&Array.isArray(en(r.touchedFields,Ke))){const Pr=dt(en(r.touchedFields,Ke),tr.argA,tr.argB);Qt&&ka(r.touchedFields,Ke,Pr)}(S.dirtyFields||E.dirtyFields)&&(r.dirtyFields=cS(o,l)),A.state.next({name:Ke,isDirty:ne(Ke,at),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else ka(l,Ke,at)},j=(Ke,at)=>{ka(r.errors,Ke,at),A.state.next({errors:r.errors})},F=Ke=>{r.errors=Ke,A.state.next({errors:r.errors,isValid:!1})},B=(Ke,at,dt,tr)=>{const Qt=en(n,Ke);if(Qt){const er=en(l,Ke,No(dt)?en(o,Ke):dt);No(er)||tr&&tr.defaultChecked||at?ka(l,Ke,at?er:i9(Qt._f)):he(Ke,er),d.mount&&k()}},U=(Ke,at,dt,tr,Qt)=>{let er=!1,Pr=!1;const sn={name:Ke};if(!t.disabled){if(!dt||tr){(S.isDirty||E.isDirty)&&(Pr=r.isDirty,r.isDirty=sn.isDirty=ne(),er=Pr!==sn.isDirty);const fn=gf(en(o,Ke),at);Pr=!!en(r.dirtyFields,Ke),fn?Ko(r.dirtyFields,Ke):ka(r.dirtyFields,Ke,!0),sn.dirtyFields=r.dirtyFields,er=er||(S.dirtyFields||E.dirtyFields)&&Pr!==!fn}if(dt){const fn=en(r.touchedFields,Ke);fn||(ka(r.touchedFields,Ke,dt),sn.touchedFields=r.touchedFields,er=er||(S.touchedFields||E.touchedFields)&&fn!==dt)}er&&Qt&&A.state.next(sn)}return er?sn:{}},Z=(Ke,at,dt,tr)=>{const Qt=en(r.errors,Ke),er=(S.isValid||E.isValid)&&zc(at)&&r.isValid!==at;if(t.delayError&&dt?(g=N(()=>j(Ke,dt)),g(t.delayError)):(clearTimeout(x),g=null,dt?ka(r.errors,Ke,dt):Ko(r.errors,Ke)),(dt?!gf(Qt,dt):Qt)||!dc(tr)||er){const Pr={...tr,...er&&zc(at)?{isValid:at}:{},errors:r.errors,name:Ke};r={...r,...Pr},A.state.next(Pr)}},X=async Ke=>{R(Ke,!0);const at=await t.resolver(l,t.context,JPe(Ke||i.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return R(Ke),at},te=async Ke=>{const{errors:at}=await X(Ke);if(Ke)for(const dt of Ke){const tr=en(at,dt);tr?ka(r.errors,dt,tr):Ko(r.errors,dt)}else r.errors=at;return at},se=async(Ke,at,dt={valid:!0})=>{for(const tr in Ke){const Qt=Ke[tr];if(Qt){const{_f:er,...Pr}=Qt;if(er){const sn=i.array.has(er.name),fn=Qt._f&&QPe(Qt._f);fn&&S.validatingFields&&R([tr],!0);const Ai=await u9(Qt,i.disabled,l,C,t.shouldUseNativeValidation&&!at,sn);if(fn&&S.validatingFields&&R([tr]),Ai[er.name]&&(dt.valid=!1,at))break;!at&&(en(Ai,er.name)?sn?aCe(r.errors,Ai,er.name):ka(r.errors,er.name,Ai[er.name]):Ko(r.errors,er.name))}!dc(Pr)&&await se(Pr,at,dt)}}return dt.valid},oe=()=>{for(const Ke of i.unMount){const at=en(n,Ke);at&&(at._f.refs?at._f.refs.every(dt=>!qM(dt)):!qM(at._f.ref))&&Xe(Ke)}i.unMount=new Set},ne=(Ke,at)=>!t.disabled&&(Ke&&at&&ka(l,Ke,at),!gf(Pe(),o)),ee=(Ke,at,dt)=>yie(Ke,i,{...d.mount?l:No(at)?o:fh(Ke)?{[Ke]:at}:at},dt,at),ie=Ke=>A4(en(d.mount?l:o,Ke,t.shouldUnregister?en(o,Ke,[]):[])),he=(Ke,at,dt={})=>{const tr=en(n,Ke);let Qt=at;if(tr){const er=tr._f;er&&(!er.disabled&&ka(l,Ke,Sie(at,er)),Qt=SO(er.ref)&&Fl(at)?"":at,_ie(er.ref)?[...er.ref.options].forEach(Pr=>Pr.selected=Qt.includes(Pr.value)):er.refs?VT(er.ref)?er.refs.forEach(Pr=>{(!Pr.defaultChecked||!Pr.disabled)&&(Array.isArray(Qt)?Pr.checked=!!Qt.find(sn=>sn===Pr.value):Pr.checked=Qt===Pr.value||!!Qt)}):er.refs.forEach(Pr=>Pr.checked=Pr.value===Qt):I4(er.ref)?er.ref.value="":(er.ref.value=Qt,er.ref.type||A.state.next({name:Ke,values:ds(l)})))}(dt.shouldDirty||dt.shouldTouch)&&U(Ke,Qt,dt.shouldTouch,dt.shouldDirty,!0),dt.shouldValidate&&be(Ke)},Se=(Ke,at,dt)=>{for(const tr in at){if(!at.hasOwnProperty(tr))return;const Qt=at[tr],er=Ke+"."+tr,Pr=en(n,er);(i.array.has(Ke)||Fo(Qt)||Pr&&!Pr._f)&&!Ny(Qt)?Se(er,Qt,dt):he(er,Qt,dt)}},Ce=(Ke,at,dt={})=>{const tr=en(n,Ke),Qt=i.array.has(Ke),er=ds(at);ka(l,Ke,er),Qt?(A.array.next({name:Ke,values:ds(l)}),(S.isDirty||S.dirtyFields||E.isDirty||E.dirtyFields)&&dt.shouldDirty&&A.state.next({name:Ke,dirtyFields:cS(o,l),isDirty:ne(Ke,er)})):tr&&!tr._f&&!Fl(er)?Se(Ke,er,dt):he(Ke,er,dt),s9(Ke,i)&&A.state.next({...r,name:Ke}),A.state.next({name:d.mount?Ke:void 0,values:ds(l)})},fe=async Ke=>{d.mount=!0;const at=Ke.target;let dt=at.name,tr=!0;const Qt=en(n,dt),er=fn=>{tr=Number.isNaN(fn)||Ny(fn)&&isNaN(fn.getTime())||gf(fn,en(l,dt,fn))},Pr=a9(t.mode),sn=a9(t.reValidateMode);if(Qt){let fn,Ai;const mi=at.type?i9(Qt._f):pie(Ke),Zi=Ke.type===wO.BLUR||Ke.type===wO.FOCUS_OUT,Rs=!eCe(Qt._f)&&!t.resolver&&!en(r.errors,dt)&&!Qt._f.deps||nCe(Zi,en(r.touchedFields,dt),r.isSubmitted,sn,Pr),Ua=s9(dt,i,Zi);ka(l,dt,mi),Zi?(Qt._f.onBlur&&Qt._f.onBlur(Ke),g&&g(0)):Qt._f.onChange&&Qt._f.onChange(Ke);const wi=U(dt,mi,Zi),_s=!dc(wi)||Ua;if(!Zi&&A.state.next({name:dt,type:Ke.type,values:ds(l)}),Rs)return(S.isValid||E.isValid)&&(t.mode==="onBlur"?Zi&&k():Zi||k()),_s&&A.state.next({name:dt,...Ua?{}:wi});if(!Zi&&Ua&&A.state.next({...r}),t.resolver){const{errors:zo}=await X([dt]);if(er(mi),tr){const js=l9(r.errors,n,dt),Bo=l9(zo,n,js.name||dt);fn=Bo.error,dt=Bo.name,Ai=dc(zo)}}else R([dt],!0),fn=(await u9(Qt,i.disabled,l,C,t.shouldUseNativeValidation))[dt],R([dt]),er(mi),tr&&(fn?Ai=!1:(S.isValid||E.isValid)&&(Ai=await se(n,!0)));tr&&(Qt._f.deps&&be(Qt._f.deps),Z(dt,Ai,fn,wi))}},_e=(Ke,at)=>{if(en(r.errors,at)&&Ke.focus)return Ke.focus(),1},be=async(Ke,at={})=>{let dt,tr;const Qt=HS(Ke);if(t.resolver){const er=await te(No(Ke)?Ke:Qt);dt=dc(er),tr=Ke?!Qt.some(Pr=>en(er,Pr)):dt}else Ke?(tr=(await Promise.all(Qt.map(async er=>{const Pr=en(n,er);return await se(Pr&&Pr._f?{[er]:Pr}:Pr)}))).every(Boolean),!(!tr&&!r.isValid)&&k()):tr=dt=await se(n);return A.state.next({...!fh(Ke)||(S.isValid||E.isValid)&&dt!==r.isValid?{}:{name:Ke},...t.resolver||!Ke?{isValid:dt}:{},errors:r.errors}),at.shouldFocus&&!tr&&KS(n,_e,Ke?Qt:i.mount),tr},Pe=Ke=>{const at={...d.mount?l:o};return No(Ke)?at:fh(Ke)?en(at,Ke):Ke.map(dt=>en(at,dt))},ye=(Ke,at)=>({invalid:!!en((at||r).errors,Ke),isDirty:!!en((at||r).dirtyFields,Ke),error:en((at||r).errors,Ke),isValidating:!!en(r.validatingFields,Ke),isTouched:!!en((at||r).touchedFields,Ke)}),ge=Ke=>{Ke&&HS(Ke).forEach(at=>Ko(r.errors,at)),A.state.next({errors:Ke?r.errors:{}})},ke=(Ke,at,dt)=>{const tr=(en(n,Ke,{_f:{}})._f||{}).ref,Qt=en(r.errors,Ke)||{},{ref:er,message:Pr,type:sn,...fn}=Qt;ka(r.errors,Ke,{...fn,...at,ref:tr}),A.state.next({name:Ke,errors:r.errors,isValid:!1}),dt&&dt.shouldFocus&&tr&&tr.focus&&tr.focus()},Qe=(Ke,at)=>vd(Ke)?A.state.subscribe({next:dt=>"values"in dt&&Ke(ee(void 0,at),dt)}):ee(Ke,at,!0),He=Ke=>A.state.subscribe({next:at=>{rCe(Ke.name,at.name,Ke.exact)&&tCe(at,Ke.formState||S,Yr,Ke.reRenderRoot)&&Ke.callback({values:{...l},...r,...at,defaultValues:o})}}).unsubscribe,$e=Ke=>(d.mount=!0,E={...E,...Ke.formState},He({...Ke,formState:E})),Xe=(Ke,at={})=>{for(const dt of Ke?HS(Ke):i.mount)i.mount.delete(dt),i.array.delete(dt),at.keepValue||(Ko(n,dt),Ko(l,dt)),!at.keepError&&Ko(r.errors,dt),!at.keepDirty&&Ko(r.dirtyFields,dt),!at.keepTouched&&Ko(r.touchedFields,dt),!at.keepIsValidating&&Ko(r.validatingFields,dt),!t.shouldUnregister&&!at.keepDefaultValue&&Ko(o,dt);A.state.next({values:ds(l)}),A.state.next({...r,...at.keepDirty?{isDirty:ne()}:{}}),!at.keepIsValid&&k()},ft=({disabled:Ke,name:at})=>{(zc(Ke)&&d.mount||Ke||i.disabled.has(at))&&(Ke?i.disabled.add(at):i.disabled.delete(at))},ze=(Ke,at={})=>{let dt=en(n,Ke);const tr=zc(at.disabled)||zc(t.disabled);return ka(n,Ke,{...dt||{},_f:{...dt&&dt._f?dt._f:{ref:{name:Ke}},name:Ke,mount:!0,...at}}),i.mount.add(Ke),dt?ft({disabled:zc(at.disabled)?at.disabled:t.disabled,name:Ke}):B(Ke,!0,at.value),{...tr?{disabled:at.disabled||t.disabled}:{},...t.progressive?{required:!!at.required,min:uS(at.min),max:uS(at.max),minLength:uS(at.minLength),maxLength:uS(at.maxLength),pattern:uS(at.pattern)}:{},name:Ke,onChange:fe,onBlur:fe,ref:Qt=>{if(Qt){ze(Ke,at),dt=en(n,Ke);const er=No(Qt.value)&&Qt.querySelectorAll&&Qt.querySelectorAll("input,select,textarea")[0]||Qt,Pr=ZPe(er),sn=dt._f.refs||[];if(Pr?sn.find(fn=>fn===er):er===dt._f.ref)return;ka(n,Ke,{_f:{...dt._f,...Pr?{refs:[...sn.filter(qM),er,...Array.isArray(en(o,Ke))?[{}]:[]],ref:{type:er.type,name:Ke}}:{ref:er}}}),B(Ke,!1,void 0,er)}else dt=en(n,Ke,{}),dt._f&&(dt._f.mount=!1),(t.shouldUnregister||at.shouldUnregister)&&!(mie(i.array,Ke)&&d.action)&&i.unMount.add(Ke)}}},ut=()=>t.shouldFocusError&&KS(n,_e,i.mount),At=Ke=>{zc(Ke)&&(A.state.next({disabled:Ke}),KS(n,(at,dt)=>{const tr=en(n,dt);tr&&(at.disabled=tr._f.disabled||Ke,Array.isArray(tr._f.refs)&&tr._f.refs.forEach(Qt=>{Qt.disabled=tr._f.disabled||Ke}))},0,!1))},xt=(Ke,at)=>async dt=>{let tr;dt&&(dt.preventDefault&&dt.preventDefault(),dt.persist&&dt.persist());let Qt=ds(l);if(A.state.next({isSubmitting:!0}),t.resolver){const{errors:er,values:Pr}=await X();r.errors=er,Qt=ds(Pr)}else await se(n);if(i.disabled.size)for(const er of i.disabled)Ko(Qt,er);if(Ko(r.errors,"root"),dc(r.errors)){A.state.next({errors:{}});try{await Ke(Qt,dt)}catch(er){tr=er}}else at&&await at({...r.errors},dt),ut(),setTimeout(ut);if(A.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:dc(r.errors)&&!tr,submitCount:r.submitCount+1,errors:r.errors}),tr)throw tr},nr=(Ke,at={})=>{en(n,Ke)&&(No(at.defaultValue)?Ce(Ke,ds(en(o,Ke))):(Ce(Ke,at.defaultValue),ka(o,Ke,ds(at.defaultValue))),at.keepTouched||Ko(r.touchedFields,Ke),at.keepDirty||(Ko(r.dirtyFields,Ke),r.isDirty=at.defaultValue?ne(Ke,ds(en(o,Ke))):ne()),at.keepError||(Ko(r.errors,Ke),S.isValid&&k()),A.state.next({...r}))},Vt=(Ke,at={})=>{const dt=Ke?ds(Ke):o,tr=ds(dt),Qt=dc(Ke),er=Qt?o:tr;if(at.keepDefaultValues||(o=dt),!at.keepValues){if(at.keepDirtyValues){const Pr=new Set([...i.mount,...Object.keys(cS(o,l))]);for(const sn of Array.from(Pr))en(r.dirtyFields,sn)?ka(er,sn,en(l,sn)):Ce(sn,en(er,sn))}else{if(T4&&No(Ke))for(const Pr of i.mount){const sn=en(n,Pr);if(sn&&sn._f){const fn=Array.isArray(sn._f.refs)?sn._f.refs[0]:sn._f.ref;if(SO(fn)){const Ai=fn.closest("form");if(Ai){Ai.reset();break}}}}if(at.keepFieldsRef)for(const Pr of i.mount)Ce(Pr,en(er,Pr));else n={}}l=t.shouldUnregister?at.keepDefaultValues?ds(o):{}:ds(er),A.array.next({values:{...er}}),A.state.next({values:{...er}})}i={mount:at.keepDirtyValues?i.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},d.mount=!S.isValid||!!at.keepIsValid||!!at.keepDirtyValues,d.watch=!!t.shouldUnregister,A.state.next({submitCount:at.keepSubmitCount?r.submitCount:0,isDirty:Qt?!1:at.keepDirty?r.isDirty:!!(at.keepDefaultValues&&!gf(Ke,o)),isSubmitted:at.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:Qt?{}:at.keepDirtyValues?at.keepDefaultValues&&l?cS(o,l):r.dirtyFields:at.keepDefaultValues&&Ke?cS(o,Ke):at.keepDirty?r.dirtyFields:{},touchedFields:at.keepTouched?r.touchedFields:{},errors:at.keepErrors?r.errors:{},isSubmitSuccessful:at.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},dr=(Ke,at)=>Vt(vd(Ke)?Ke(l):Ke,at),Br=(Ke,at={})=>{const dt=en(n,Ke),tr=dt&&dt._f;if(tr){const Qt=tr.refs?tr.refs[0]:tr.ref;Qt.focus&&(Qt.focus(),at.shouldSelect&&vd(Qt.select)&&Qt.select())}},Yr=Ke=>{r={...r,...Ke}},Mt={control:{register:ze,unregister:Xe,getFieldState:ye,handleSubmit:xt,setError:ke,_subscribe:He,_runSchema:X,_focusError:ut,_getWatch:ee,_getDirty:ne,_setValid:k,_setFieldArray:L,_setDisabledField:ft,_setErrors:F,_getFieldArray:ie,_reset:Vt,_resetDefaultValues:()=>vd(t.defaultValues)&&t.defaultValues().then(Ke=>{dr(Ke,t.resetOptions),A.state.next({isLoading:!1})}),_removeUnmounted:oe,_disableForm:At,_subjects:A,_proxyFormState:S,get _fields(){return n},get _formValues(){return l},get _state(){return d},set _state(Ke){d=Ke},get _defaultValues(){return o},get _names(){return i},set _names(Ke){i=Ke},get _formState(){return r},get _options(){return t},set _options(Ke){t={...t,...Ke}}},subscribe:$e,trigger:be,register:ze,handleSubmit:xt,watch:Qe,setValue:Ce,getValues:Pe,reset:dr,resetField:nr,clearErrors:ge,unregister:Xe,setError:ke,setFocus:Br,getFieldState:ye};return{...Mt,formControl:Mt}}function am(e={}){const t=We.useRef(void 0),r=We.useRef(void 0),[n,o]=We.useState({isDirty:!1,isValidating:!1,isLoading:vd(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:vd(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!vd(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:d,...i}=sCe(e);t.current={...i,formState:n}}const l=t.current.control;return l._options=e,O4(()=>{const d=l._subscribe({formState:l._proxyFormState,callback:()=>o({...l._formState}),reRenderRoot:!0});return o(i=>({...i,isReady:!0})),l._formState.isReady=!0,d},[l]),We.useEffect(()=>l._disableForm(e.disabled),[l,e.disabled]),We.useEffect(()=>{e.mode&&(l._options.mode=e.mode),e.reValidateMode&&(l._options.reValidateMode=e.reValidateMode)},[l,e.mode,e.reValidateMode]),We.useEffect(()=>{e.errors&&(l._setErrors(e.errors),l._focusError())},[l,e.errors]),We.useEffect(()=>{e.shouldUnregister&&l._subjects.state.next({values:l._getWatch()})},[l,e.shouldUnregister]),We.useEffect(()=>{if(l._proxyFormState.isDirty){const d=l._getDirty();d!==n.isDirty&&l._subjects.state.next({isDirty:d})}},[l,n.isDirty]),We.useEffect(()=>{e.values&&!gf(e.values,r.current)?(l._reset(e.values,{keepFieldsRef:!0,...l._options.resetOptions}),r.current=e.values,o(d=>({...d}))):l._resetDefaultValues()},[l,e.values]),We.useEffect(()=>{l._state.mount||(l._setValid(),l._state.mount=!0),l._state.watch&&(l._state.watch=!1,l._subjects.state.next({...l._formState})),l._removeUnmounted()}),t.current.formState=gie(n,l),t.current}const d9=(e,t,r)=>{if(e&&"reportValidity"in e){const n=en(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},Tie=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?d9(n.ref,r,e):n.refs&&n.refs.forEach(o=>d9(o,r,e))}},lCe=(e,t)=>{t.shouldUseNativeValidation&&Tie(e,t);const r={};for(const n in e){const o=en(t.fields,n),l=Object.assign(e[n]||{},{ref:o&&o.ref});if(cCe(t.names||Object.keys(e),n)){const d=Object.assign({},en(r,n));ka(d,"root",l),ka(r,n,d)}else ka(r,n,l)}return r},cCe=(e,t)=>e.some(r=>r.startsWith(t+"."));var uCe=function(e,t){for(var r={};e.length;){var n=e[0],o=n.code,l=n.message,d=n.path.join(".");if(!r[d])if("unionErrors"in n){var i=n.unionErrors[0].errors[0];r[d]={message:i.message,type:i.code}}else r[d]={message:l,type:o};if("unionErrors"in n&&n.unionErrors.forEach(function(S){return S.errors.forEach(function(E){return e.push(E)})}),t){var g=r[d].types,x=g&&g[n.code];r[d]=vie(d,t,r,o,x?[].concat(x,n.message):n.message)}e.shift()}return r},om=function(e,t,r){return r===void 0&&(r={}),function(n,o,l){try{return Promise.resolve(function(d,i){try{var g=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(x){return l.shouldUseNativeValidation&&Tie({},l),{errors:{},values:r.raw?n:x}})}catch(x){return i(x)}return g&&g.then?g.then(void 0,i):g}(0,function(d){if(function(i){return Array.isArray(i==null?void 0:i.errors)}(d))return{values:{},errors:lCe(uCe(d.errors,!l.shouldUseNativeValidation&&l.criteriaMode==="all"),l)};throw d}))}catch(d){return Promise.reject(d)}}},ma;(function(e){e.assertEqual=o=>{};function t(o){}e.assertIs=t;function r(o){throw new Error}e.assertNever=r,e.arrayToEnum=o=>{const l={};for(const d of o)l[d]=d;return l},e.getValidEnumValues=o=>{const l=e.objectKeys(o).filter(i=>typeof o[o[i]]!="number"),d={};for(const i of l)d[i]=o[i];return e.objectValues(d)},e.objectValues=o=>e.objectKeys(o).map(function(l){return o[l]}),e.objectKeys=typeof Object.keys=="function"?o=>Object.keys(o):o=>{const l=[];for(const d in o)Object.prototype.hasOwnProperty.call(o,d)&&l.push(d);return l},e.find=(o,l)=>{for(const d of o)if(l(d))return d},e.isInteger=typeof Number.isInteger=="function"?o=>Number.isInteger(o):o=>typeof o=="number"&&Number.isFinite(o)&&Math.floor(o)===o;function n(o,l=" | "){return o.map(d=>typeof d=="string"?`'${d}'`:d).join(l)}e.joinValues=n,e.jsonStringifyReplacer=(o,l)=>typeof l=="bigint"?l.toString():l})(ma||(ma={}));var h9;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(h9||(h9={}));const An=ma.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Qp=e=>{switch(typeof e){case"undefined":return An.undefined;case"string":return An.string;case"number":return Number.isNaN(e)?An.nan:An.number;case"boolean":return An.boolean;case"function":return An.function;case"bigint":return An.bigint;case"symbol":return An.symbol;case"object":return Array.isArray(e)?An.array:e===null?An.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?An.promise:typeof Map<"u"&&e instanceof Map?An.map:typeof Set<"u"&&e instanceof Set?An.set:typeof Date<"u"&&e instanceof Date?An.date:An.object;default:return An.unknown}},Mr=ma.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Df extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(l){return l.message},n={_errors:[]},o=l=>{for(const d of l.issues)if(d.code==="invalid_union")d.unionErrors.map(o);else if(d.code==="invalid_return_type")o(d.returnTypeError);else if(d.code==="invalid_arguments")o(d.argumentsError);else if(d.path.length===0)n._errors.push(r(d));else{let i=n,g=0;for(;g<d.path.length;){const x=d.path[g];g===d.path.length-1?(i[x]=i[x]||{_errors:[]},i[x]._errors.push(r(d))):i[x]=i[x]||{_errors:[]},i=i[x],g++}}};return o(this),n}static assert(t){if(!(t instanceof Df))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ma.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const o of this.issues)if(o.path.length>0){const l=o.path[0];r[l]=r[l]||[],r[l].push(t(o))}else n.push(t(o));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Df.create=e=>new Df(e);const T3=(e,t)=>{let r;switch(e.code){case Mr.invalid_type:e.received===An.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case Mr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,ma.jsonStringifyReplacer)}`;break;case Mr.unrecognized_keys:r=`Unrecognized key(s) in object: ${ma.joinValues(e.keys,", ")}`;break;case Mr.invalid_union:r="Invalid input";break;case Mr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ma.joinValues(e.options)}`;break;case Mr.invalid_enum_value:r=`Invalid enum value. Expected ${ma.joinValues(e.options)}, received '${e.received}'`;break;case Mr.invalid_arguments:r="Invalid function arguments";break;case Mr.invalid_return_type:r="Invalid function return type";break;case Mr.invalid_date:r="Invalid date";break;case Mr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:ma.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case Mr.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case Mr.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case Mr.custom:r="Invalid input";break;case Mr.invalid_intersection_types:r="Intersection results could not be merged";break;case Mr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case Mr.not_finite:r="Number must be finite";break;default:r=t.defaultError,ma.assertNever(e)}return{message:r}};let dCe=T3;function hCe(){return dCe}const fCe=e=>{const{data:t,path:r,errorMaps:n,issueData:o}=e,l=[...r,...o.path||[]],d={...o,path:l};if(o.message!==void 0)return{...o,path:l,message:o.message};let i="";const g=n.filter(x=>!!x).slice().reverse();for(const x of g)i=x(d,{data:t,defaultError:i}).message;return{...o,path:l,message:i}};function un(e,t){const r=hCe(),n=fCe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===T3?void 0:T3].filter(o=>!!o)});e.common.issues.push(n)}class Jc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const o of r){if(o.status==="aborted")return _i;o.status==="dirty"&&t.dirty(),n.push(o.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const o of r){const l=await o.key,d=await o.value;n.push({key:l,value:d})}return Jc.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const o of r){const{key:l,value:d}=o;if(l.status==="aborted"||d.status==="aborted")return _i;l.status==="dirty"&&t.dirty(),d.status==="dirty"&&t.dirty(),l.value!=="__proto__"&&(typeof d.value<"u"||o.alwaysSet)&&(n[l.value]=d.value)}return{status:t.value,value:n}}}const _i=Object.freeze({status:"aborted"}),RS=e=>({status:"dirty",value:e}),Du=e=>({status:"valid",value:e}),f9=e=>e.status==="aborted",p9=e=>e.status==="dirty",z0=e=>e.status==="valid",AO=e=>typeof Promise<"u"&&e instanceof Promise;var Pn;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Pn||(Pn={}));class Km{constructor(t,r,n,o){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=o}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const m9=(e,t)=>{if(z0(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Df(e.common.issues);return this._error=r,this._error}}};function qi(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:o}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:o}:{errorMap:(d,i)=>{const{message:g}=e;return d.code==="invalid_enum_value"?{message:g??i.defaultError}:typeof i.data>"u"?{message:g??n??i.defaultError}:d.code!=="invalid_type"?{message:i.defaultError}:{message:g??r??i.defaultError}},description:o}}class da{get description(){return this._def.description}_getType(t){return Qp(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Qp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Jc,ctx:{common:t.parent.common,data:t.data,parsedType:Qp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(AO(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Qp(t)},o=this._parseSync({data:t,path:n.path,parent:n});return m9(n,o)}"~validate"(t){var n,o;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Qp(t)};if(!this["~standard"].async)try{const l=this._parseSync({data:t,path:[],parent:r});return z0(l)?{value:l.value}:{issues:r.common.issues}}catch(l){(o=(n=l==null?void 0:l.message)==null?void 0:n.toLowerCase())!=null&&o.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(l=>z0(l)?{value:l.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Qp(t)},o=this._parse({data:t,path:n.path,parent:n}),l=await(AO(o)?o:Promise.resolve(o));return m9(n,l)}refine(t,r){const n=o=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(o):r;return this._refinement((o,l)=>{const d=t(o),i=()=>l.addIssue({code:Mr.custom,...n(o)});return typeof Promise<"u"&&d instanceof Promise?d.then(g=>g?!0:(i(),!1)):d?!0:(i(),!1)})}refinement(t,r){return this._refinement((n,o)=>t(n)?!0:(o.addIssue(typeof r=="function"?r(n,o):r),!1))}_refinement(t){return new U0({schema:this,typeName:xi.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Dm.create(this,this._def)}nullable(){return V0.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return bh.create(this)}promise(){return OO.create(this,this._def)}or(t){return PO.create([this,t],this._def)}and(t){return CO.create(this,t,this._def)}transform(t){return new U0({...qi(this._def),schema:this,typeName:xi.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new C3({...qi(this._def),innerType:this,defaultValue:r,typeName:xi.ZodDefault})}brand(){return new DCe({typeName:xi.ZodBranded,type:this,...qi(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new O3({...qi(this._def),innerType:this,catchValue:r,typeName:xi.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return R4.create(this,t)}readonly(){return I3.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pCe=/^c[^\s-]{8,}$/i,mCe=/^[0-9a-z]+$/,gCe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yCe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vCe=/^[a-z0-9_-]{21}$/i,_Ce=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,xCe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bCe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wCe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let WM;const SCe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ECe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,TCe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ACe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,PCe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,CCe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Aie="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",OCe=new RegExp(`^${Aie}$`);function Pie(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function ICe(e){return new RegExp(`^${Pie(e)}$`)}function kCe(e){let t=`${Aie}T${Pie(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function RCe(e,t){return!!((t==="v4"||!t)&&SCe.test(e)||(t==="v6"||!t)&&TCe.test(e))}function jCe(e,t){if(!_Ce.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),o=JSON.parse(atob(n));return!(typeof o!="object"||o===null||"typ"in o&&(o==null?void 0:o.typ)!=="JWT"||!o.alg||t&&o.alg!==t)}catch{return!1}}function NCe(e,t){return!!((t==="v4"||!t)&&ECe.test(e)||(t==="v6"||!t)&&ACe.test(e))}class wm extends da{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==An.string){const l=this._getOrReturnCtx(t);return un(l,{code:Mr.invalid_type,expected:An.string,received:l.parsedType}),_i}const n=new Jc;let o;for(const l of this._def.checks)if(l.kind==="min")t.data.length<l.value&&(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),n.dirty());else if(l.kind==="max")t.data.length>l.value&&(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),n.dirty());else if(l.kind==="length"){const d=t.data.length>l.value,i=t.data.length<l.value;(d||i)&&(o=this._getOrReturnCtx(t,o),d?un(o,{code:Mr.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):i&&un(o,{code:Mr.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),n.dirty())}else if(l.kind==="email")bCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"email",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="emoji")WM||(WM=new RegExp(wCe,"u")),WM.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"emoji",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="uuid")yCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"uuid",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="nanoid")vCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"nanoid",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="cuid")pCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"cuid",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="cuid2")mCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"cuid2",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="ulid")gCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"ulid",code:Mr.invalid_string,message:l.message}),n.dirty());else if(l.kind==="url")try{new URL(t.data)}catch{o=this._getOrReturnCtx(t,o),un(o,{validation:"url",code:Mr.invalid_string,message:l.message}),n.dirty()}else l.kind==="regex"?(l.regex.lastIndex=0,l.regex.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"regex",code:Mr.invalid_string,message:l.message}),n.dirty())):l.kind==="trim"?t.data=t.data.trim():l.kind==="includes"?t.data.includes(l.value,l.position)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),n.dirty()):l.kind==="toLowerCase"?t.data=t.data.toLowerCase():l.kind==="toUpperCase"?t.data=t.data.toUpperCase():l.kind==="startsWith"?t.data.startsWith(l.value)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:{startsWith:l.value},message:l.message}),n.dirty()):l.kind==="endsWith"?t.data.endsWith(l.value)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:{endsWith:l.value},message:l.message}),n.dirty()):l.kind==="datetime"?kCe(l).test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:"datetime",message:l.message}),n.dirty()):l.kind==="date"?OCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:"date",message:l.message}),n.dirty()):l.kind==="time"?ICe(l).test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.invalid_string,validation:"time",message:l.message}),n.dirty()):l.kind==="duration"?xCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"duration",code:Mr.invalid_string,message:l.message}),n.dirty()):l.kind==="ip"?RCe(t.data,l.version)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"ip",code:Mr.invalid_string,message:l.message}),n.dirty()):l.kind==="jwt"?jCe(t.data,l.alg)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"jwt",code:Mr.invalid_string,message:l.message}),n.dirty()):l.kind==="cidr"?NCe(t.data,l.version)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"cidr",code:Mr.invalid_string,message:l.message}),n.dirty()):l.kind==="base64"?PCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"base64",code:Mr.invalid_string,message:l.message}),n.dirty()):l.kind==="base64url"?CCe.test(t.data)||(o=this._getOrReturnCtx(t,o),un(o,{validation:"base64url",code:Mr.invalid_string,message:l.message}),n.dirty()):ma.assertNever(l);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(o=>t.test(o),{validation:r,code:Mr.invalid_string,...Pn.errToObj(n)})}_addCheck(t){return new wm({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Pn.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Pn.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Pn.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Pn.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Pn.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Pn.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Pn.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Pn.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Pn.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Pn.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Pn.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Pn.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Pn.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Pn.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Pn.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Pn.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...Pn.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...Pn.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...Pn.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...Pn.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...Pn.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...Pn.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...Pn.errToObj(r)})}nonempty(t){return this.min(1,Pn.errToObj(t))}trim(){return new wm({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new wm({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new wm({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}wm.create=e=>new wm({checks:[],typeName:xi.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...qi(e)});function MCe(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,o=r>n?r:n,l=Number.parseInt(e.toFixed(o).replace(".","")),d=Number.parseInt(t.toFixed(o).replace(".",""));return l%d/10**o}class B0 extends da{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==An.number){const l=this._getOrReturnCtx(t);return un(l,{code:Mr.invalid_type,expected:An.number,received:l.parsedType}),_i}let n;const o=new Jc;for(const l of this._def.checks)l.kind==="int"?ma.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.invalid_type,expected:"integer",received:"float",message:l.message}),o.dirty()):l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.too_small,minimum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.too_big,maximum:l.value,type:"number",inclusive:l.inclusive,exact:!1,message:l.message}),o.dirty()):l.kind==="multipleOf"?MCe(t.data,l.value)!==0&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):l.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.not_finite,message:l.message}),o.dirty()):ma.assertNever(l);return{status:o.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,Pn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Pn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Pn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Pn.toString(r))}setLimit(t,r,n,o){return new B0({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Pn.toString(o)}]})}_addCheck(t){return new B0({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Pn.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Pn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Pn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Pn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Pn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Pn.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:Pn.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Pn.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Pn.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ma.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}B0.create=e=>new B0({checks:[],typeName:xi.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...qi(e)});class kE extends da{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==An.bigint)return this._getInvalidInput(t);let n;const o=new Jc;for(const l of this._def.checks)l.kind==="min"?(l.inclusive?t.data<l.value:t.data<=l.value)&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.too_small,type:"bigint",minimum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="max"?(l.inclusive?t.data>l.value:t.data>=l.value)&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.too_big,type:"bigint",maximum:l.value,inclusive:l.inclusive,message:l.message}),o.dirty()):l.kind==="multipleOf"?t.data%l.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),un(n,{code:Mr.not_multiple_of,multipleOf:l.value,message:l.message}),o.dirty()):ma.assertNever(l);return{status:o.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return un(r,{code:Mr.invalid_type,expected:An.bigint,received:r.parsedType}),_i}gte(t,r){return this.setLimit("min",t,!0,Pn.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Pn.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Pn.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Pn.toString(r))}setLimit(t,r,n,o){return new kE({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Pn.toString(o)}]})}_addCheck(t){return new kE({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Pn.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Pn.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Pn.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Pn.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Pn.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}kE.create=e=>new kE({checks:[],typeName:xi.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...qi(e)});class A3 extends da{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==An.boolean){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.boolean,received:n.parsedType}),_i}return Du(t.data)}}A3.create=e=>new A3({typeName:xi.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...qi(e)});class RE extends da{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==An.date){const l=this._getOrReturnCtx(t);return un(l,{code:Mr.invalid_type,expected:An.date,received:l.parsedType}),_i}if(Number.isNaN(t.data.getTime())){const l=this._getOrReturnCtx(t);return un(l,{code:Mr.invalid_date}),_i}const n=new Jc;let o;for(const l of this._def.checks)l.kind==="min"?t.data.getTime()<l.value&&(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.too_small,message:l.message,inclusive:!0,exact:!1,minimum:l.value,type:"date"}),n.dirty()):l.kind==="max"?t.data.getTime()>l.value&&(o=this._getOrReturnCtx(t,o),un(o,{code:Mr.too_big,message:l.message,inclusive:!0,exact:!1,maximum:l.value,type:"date"}),n.dirty()):ma.assertNever(l);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new RE({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:Pn.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:Pn.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}RE.create=e=>new RE({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:xi.ZodDate,...qi(e)});class g9 extends da{_parse(t){if(this._getType(t)!==An.symbol){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.symbol,received:n.parsedType}),_i}return Du(t.data)}}g9.create=e=>new g9({typeName:xi.ZodSymbol,...qi(e)});class y9 extends da{_parse(t){if(this._getType(t)!==An.undefined){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.undefined,received:n.parsedType}),_i}return Du(t.data)}}y9.create=e=>new y9({typeName:xi.ZodUndefined,...qi(e)});class v9 extends da{_parse(t){if(this._getType(t)!==An.null){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.null,received:n.parsedType}),_i}return Du(t.data)}}v9.create=e=>new v9({typeName:xi.ZodNull,...qi(e)});class _9 extends da{constructor(){super(...arguments),this._any=!0}_parse(t){return Du(t.data)}}_9.create=e=>new _9({typeName:xi.ZodAny,...qi(e)});class x9 extends da{constructor(){super(...arguments),this._unknown=!0}_parse(t){return Du(t.data)}}x9.create=e=>new x9({typeName:xi.ZodUnknown,...qi(e)});class Zm extends da{_parse(t){const r=this._getOrReturnCtx(t);return un(r,{code:Mr.invalid_type,expected:An.never,received:r.parsedType}),_i}}Zm.create=e=>new Zm({typeName:xi.ZodNever,...qi(e)});class b9 extends da{_parse(t){if(this._getType(t)!==An.undefined){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.void,received:n.parsedType}),_i}return Du(t.data)}}b9.create=e=>new b9({typeName:xi.ZodVoid,...qi(e)});class bh extends da{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),o=this._def;if(r.parsedType!==An.array)return un(r,{code:Mr.invalid_type,expected:An.array,received:r.parsedType}),_i;if(o.exactLength!==null){const d=r.data.length>o.exactLength.value,i=r.data.length<o.exactLength.value;(d||i)&&(un(r,{code:d?Mr.too_big:Mr.too_small,minimum:i?o.exactLength.value:void 0,maximum:d?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),n.dirty())}if(o.minLength!==null&&r.data.length<o.minLength.value&&(un(r,{code:Mr.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),n.dirty()),o.maxLength!==null&&r.data.length>o.maxLength.value&&(un(r,{code:Mr.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((d,i)=>o.type._parseAsync(new Km(r,d,r.path,i)))).then(d=>Jc.mergeArray(n,d));const l=[...r.data].map((d,i)=>o.type._parseSync(new Km(r,d,r.path,i)));return Jc.mergeArray(n,l)}get element(){return this._def.type}min(t,r){return new bh({...this._def,minLength:{value:t,message:Pn.toString(r)}})}max(t,r){return new bh({...this._def,maxLength:{value:t,message:Pn.toString(r)}})}length(t,r){return new bh({...this._def,exactLength:{value:t,message:Pn.toString(r)}})}nonempty(t){return this.min(1,t)}}bh.create=(e,t)=>new bh({type:e,minLength:null,maxLength:null,exactLength:null,typeName:xi.ZodArray,...qi(t)});function Ax(e){if(e instanceof Po){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Dm.create(Ax(n))}return new Po({...e._def,shape:()=>t})}else return e instanceof bh?new bh({...e._def,type:Ax(e.element)}):e instanceof Dm?Dm.create(Ax(e.unwrap())):e instanceof V0?V0.create(Ax(e.unwrap())):e instanceof pv?pv.create(e.items.map(t=>Ax(t))):e}class Po extends da{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=ma.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==An.object){const x=this._getOrReturnCtx(t);return un(x,{code:Mr.invalid_type,expected:An.object,received:x.parsedType}),_i}const{status:n,ctx:o}=this._processInputParams(t),{shape:l,keys:d}=this._getCached(),i=[];if(!(this._def.catchall instanceof Zm&&this._def.unknownKeys==="strip"))for(const x in o.data)d.includes(x)||i.push(x);const g=[];for(const x of d){const S=l[x],E=o.data[x];g.push({key:{status:"valid",value:x},value:S._parse(new Km(o,E,o.path,x)),alwaysSet:x in o.data})}if(this._def.catchall instanceof Zm){const x=this._def.unknownKeys;if(x==="passthrough")for(const S of i)g.push({key:{status:"valid",value:S},value:{status:"valid",value:o.data[S]}});else if(x==="strict")i.length>0&&(un(o,{code:Mr.unrecognized_keys,keys:i}),n.dirty());else if(x!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const x=this._def.catchall;for(const S of i){const E=o.data[S];g.push({key:{status:"valid",value:S},value:x._parse(new Km(o,E,o.path,S)),alwaysSet:S in o.data})}}return o.common.async?Promise.resolve().then(async()=>{const x=[];for(const S of g){const E=await S.key,A=await S.value;x.push({key:E,value:A,alwaysSet:S.alwaysSet})}return x}).then(x=>Jc.mergeObjectSync(n,x)):Jc.mergeObjectSync(n,g)}get shape(){return this._def.shape()}strict(t){return Pn.errToObj,new Po({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var l,d;const o=((d=(l=this._def).errorMap)==null?void 0:d.call(l,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:Pn.errToObj(t).message??o}:{message:o}}}:{}})}strip(){return new Po({...this._def,unknownKeys:"strip"})}passthrough(){return new Po({...this._def,unknownKeys:"passthrough"})}extend(t){return new Po({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Po({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:xi.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Po({...this._def,catchall:t})}pick(t){const r={};for(const n of ma.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new Po({...this._def,shape:()=>r})}omit(t){const r={};for(const n of ma.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new Po({...this._def,shape:()=>r})}deepPartial(){return Ax(this)}partial(t){const r={};for(const n of ma.objectKeys(this.shape)){const o=this.shape[n];t&&!t[n]?r[n]=o:r[n]=o.optional()}return new Po({...this._def,shape:()=>r})}required(t){const r={};for(const n of ma.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let l=this.shape[n];for(;l instanceof Dm;)l=l._def.innerType;r[n]=l}return new Po({...this._def,shape:()=>r})}keyof(){return Cie(ma.objectKeys(this.shape))}}Po.create=(e,t)=>new Po({shape:()=>e,unknownKeys:"strip",catchall:Zm.create(),typeName:xi.ZodObject,...qi(t)});Po.strictCreate=(e,t)=>new Po({shape:()=>e,unknownKeys:"strict",catchall:Zm.create(),typeName:xi.ZodObject,...qi(t)});Po.lazycreate=(e,t)=>new Po({shape:e,unknownKeys:"strip",catchall:Zm.create(),typeName:xi.ZodObject,...qi(t)});class PO extends da{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function o(l){for(const i of l)if(i.result.status==="valid")return i.result;for(const i of l)if(i.result.status==="dirty")return r.common.issues.push(...i.ctx.common.issues),i.result;const d=l.map(i=>new Df(i.ctx.common.issues));return un(r,{code:Mr.invalid_union,unionErrors:d}),_i}if(r.common.async)return Promise.all(n.map(async l=>{const d={...r,common:{...r.common,issues:[]},parent:null};return{result:await l._parseAsync({data:r.data,path:r.path,parent:d}),ctx:d}})).then(o);{let l;const d=[];for(const g of n){const x={...r,common:{...r.common,issues:[]},parent:null},S=g._parseSync({data:r.data,path:r.path,parent:x});if(S.status==="valid")return S;S.status==="dirty"&&!l&&(l={result:S,ctx:x}),x.common.issues.length&&d.push(x.common.issues)}if(l)return r.common.issues.push(...l.ctx.common.issues),l.result;const i=d.map(g=>new Df(g));return un(r,{code:Mr.invalid_union,unionErrors:i}),_i}}get options(){return this._def.options}}PO.create=(e,t)=>new PO({options:e,typeName:xi.ZodUnion,...qi(t)});function P3(e,t){const r=Qp(e),n=Qp(t);if(e===t)return{valid:!0,data:e};if(r===An.object&&n===An.object){const o=ma.objectKeys(t),l=ma.objectKeys(e).filter(i=>o.indexOf(i)!==-1),d={...e,...t};for(const i of l){const g=P3(e[i],t[i]);if(!g.valid)return{valid:!1};d[i]=g.data}return{valid:!0,data:d}}else if(r===An.array&&n===An.array){if(e.length!==t.length)return{valid:!1};const o=[];for(let l=0;l<e.length;l++){const d=e[l],i=t[l],g=P3(d,i);if(!g.valid)return{valid:!1};o.push(g.data)}return{valid:!0,data:o}}else return r===An.date&&n===An.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class CO extends da{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),o=(l,d)=>{if(f9(l)||f9(d))return _i;const i=P3(l.value,d.value);return i.valid?((p9(l)||p9(d))&&r.dirty(),{status:r.value,value:i.data}):(un(n,{code:Mr.invalid_intersection_types}),_i)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([l,d])=>o(l,d)):o(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}CO.create=(e,t,r)=>new CO({left:e,right:t,typeName:xi.ZodIntersection,...qi(r)});class pv extends da{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==An.array)return un(n,{code:Mr.invalid_type,expected:An.array,received:n.parsedType}),_i;if(n.data.length<this._def.items.length)return un(n,{code:Mr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),_i;!this._def.rest&&n.data.length>this._def.items.length&&(un(n,{code:Mr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const l=[...n.data].map((d,i)=>{const g=this._def.items[i]||this._def.rest;return g?g._parse(new Km(n,d,n.path,i)):null}).filter(d=>!!d);return n.common.async?Promise.all(l).then(d=>Jc.mergeArray(r,d)):Jc.mergeArray(r,l)}get items(){return this._def.items}rest(t){return new pv({...this._def,rest:t})}}pv.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new pv({items:e,typeName:xi.ZodTuple,rest:null,...qi(t)})};class w9 extends da{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==An.map)return un(n,{code:Mr.invalid_type,expected:An.map,received:n.parsedType}),_i;const o=this._def.keyType,l=this._def.valueType,d=[...n.data.entries()].map(([i,g],x)=>({key:o._parse(new Km(n,i,n.path,[x,"key"])),value:l._parse(new Km(n,g,n.path,[x,"value"]))}));if(n.common.async){const i=new Map;return Promise.resolve().then(async()=>{for(const g of d){const x=await g.key,S=await g.value;if(x.status==="aborted"||S.status==="aborted")return _i;(x.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(x.value,S.value)}return{status:r.value,value:i}})}else{const i=new Map;for(const g of d){const x=g.key,S=g.value;if(x.status==="aborted"||S.status==="aborted")return _i;(x.status==="dirty"||S.status==="dirty")&&r.dirty(),i.set(x.value,S.value)}return{status:r.value,value:i}}}}w9.create=(e,t,r)=>new w9({valueType:t,keyType:e,typeName:xi.ZodMap,...qi(r)});class jE extends da{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==An.set)return un(n,{code:Mr.invalid_type,expected:An.set,received:n.parsedType}),_i;const o=this._def;o.minSize!==null&&n.data.size<o.minSize.value&&(un(n,{code:Mr.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),r.dirty()),o.maxSize!==null&&n.data.size>o.maxSize.value&&(un(n,{code:Mr.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),r.dirty());const l=this._def.valueType;function d(g){const x=new Set;for(const S of g){if(S.status==="aborted")return _i;S.status==="dirty"&&r.dirty(),x.add(S.value)}return{status:r.value,value:x}}const i=[...n.data.values()].map((g,x)=>l._parse(new Km(n,g,n.path,x)));return n.common.async?Promise.all(i).then(g=>d(g)):d(i)}min(t,r){return new jE({...this._def,minSize:{value:t,message:Pn.toString(r)}})}max(t,r){return new jE({...this._def,maxSize:{value:t,message:Pn.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}jE.create=(e,t)=>new jE({valueType:e,minSize:null,maxSize:null,typeName:xi.ZodSet,...qi(t)});class S9 extends da{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}S9.create=(e,t)=>new S9({getter:e,typeName:xi.ZodLazy,...qi(t)});class E9 extends da{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return un(r,{received:r.data,code:Mr.invalid_literal,expected:this._def.value}),_i}return{status:"valid",value:t.data}}get value(){return this._def.value}}E9.create=(e,t)=>new E9({value:e,typeName:xi.ZodLiteral,...qi(t)});function Cie(e,t){return new $0({values:e,typeName:xi.ZodEnum,...qi(t)})}class $0 extends da{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return un(r,{expected:ma.joinValues(n),received:r.parsedType,code:Mr.invalid_type}),_i}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return un(r,{received:r.data,code:Mr.invalid_enum_value,options:n}),_i}return Du(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return $0.create(t,{...this._def,...r})}exclude(t,r=this._def){return $0.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}$0.create=Cie;class T9 extends da{_parse(t){const r=ma.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==An.string&&n.parsedType!==An.number){const o=ma.objectValues(r);return un(n,{expected:ma.joinValues(o),received:n.parsedType,code:Mr.invalid_type}),_i}if(this._cache||(this._cache=new Set(ma.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const o=ma.objectValues(r);return un(n,{received:n.data,code:Mr.invalid_enum_value,options:o}),_i}return Du(t.data)}get enum(){return this._def.values}}T9.create=(e,t)=>new T9({values:e,typeName:xi.ZodNativeEnum,...qi(t)});class OO extends da{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==An.promise&&r.common.async===!1)return un(r,{code:Mr.invalid_type,expected:An.promise,received:r.parsedType}),_i;const n=r.parsedType===An.promise?r.data:Promise.resolve(r.data);return Du(n.then(o=>this._def.type.parseAsync(o,{path:r.path,errorMap:r.common.contextualErrorMap})))}}OO.create=(e,t)=>new OO({type:e,typeName:xi.ZodPromise,...qi(t)});class U0 extends da{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===xi.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),o=this._def.effect||null,l={addIssue:d=>{un(n,d),d.fatal?r.abort():r.dirty()},get path(){return n.path}};if(l.addIssue=l.addIssue.bind(l),o.type==="preprocess"){const d=o.transform(n.data,l);if(n.common.async)return Promise.resolve(d).then(async i=>{if(r.value==="aborted")return _i;const g=await this._def.schema._parseAsync({data:i,path:n.path,parent:n});return g.status==="aborted"?_i:g.status==="dirty"||r.value==="dirty"?RS(g.value):g});{if(r.value==="aborted")return _i;const i=this._def.schema._parseSync({data:d,path:n.path,parent:n});return i.status==="aborted"?_i:i.status==="dirty"||r.value==="dirty"?RS(i.value):i}}if(o.type==="refinement"){const d=i=>{const g=o.refinement(i,l);if(n.common.async)return Promise.resolve(g);if(g instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?_i:(i.status==="dirty"&&r.dirty(),d(i.value),{status:r.value,value:i.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>i.status==="aborted"?_i:(i.status==="dirty"&&r.dirty(),d(i.value).then(()=>({status:r.value,value:i.value}))))}if(o.type==="transform")if(n.common.async===!1){const d=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!z0(d))return _i;const i=o.transform(d.value,l);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:i}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(d=>z0(d)?Promise.resolve(o.transform(d.value,l)).then(i=>({status:r.value,value:i})):_i);ma.assertNever(o)}}U0.create=(e,t,r)=>new U0({schema:e,typeName:xi.ZodEffects,effect:t,...qi(r)});U0.createWithPreprocess=(e,t,r)=>new U0({schema:t,effect:{type:"preprocess",transform:e},typeName:xi.ZodEffects,...qi(r)});class Dm extends da{_parse(t){return this._getType(t)===An.undefined?Du(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Dm.create=(e,t)=>new Dm({innerType:e,typeName:xi.ZodOptional,...qi(t)});class V0 extends da{_parse(t){return this._getType(t)===An.null?Du(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}V0.create=(e,t)=>new V0({innerType:e,typeName:xi.ZodNullable,...qi(t)});class C3 extends da{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===An.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}C3.create=(e,t)=>new C3({innerType:e,typeName:xi.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...qi(t)});class O3 extends da{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},o=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return AO(o)?o.then(l=>({status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Df(n.common.issues)},input:n.data})})):{status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new Df(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}O3.create=(e,t)=>new O3({innerType:e,typeName:xi.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...qi(t)});class A9 extends da{_parse(t){if(this._getType(t)!==An.nan){const n=this._getOrReturnCtx(t);return un(n,{code:Mr.invalid_type,expected:An.nan,received:n.parsedType}),_i}return{status:"valid",value:t.data}}}A9.create=e=>new A9({typeName:xi.ZodNaN,...qi(e)});class DCe extends da{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class R4 extends da{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const l=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?_i:l.status==="dirty"?(r.dirty(),RS(l.value)):this._def.out._parseAsync({data:l.value,path:n.path,parent:n})})();{const o=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?_i:o.status==="dirty"?(r.dirty(),{status:"dirty",value:o.value}):this._def.out._parseSync({data:o.value,path:n.path,parent:n})}}static create(t,r){return new R4({in:t,out:r,typeName:xi.ZodPipeline})}}class I3 extends da{_parse(t){const r=this._def.innerType._parse(t),n=o=>(z0(o)&&(o.value=Object.freeze(o.value)),o);return AO(r)?r.then(o=>n(o)):n(r)}unwrap(){return this._def.innerType}}I3.create=(e,t)=>new I3({innerType:e,typeName:xi.ZodReadonly,...qi(t)});Po.lazycreate;var xi;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(xi||(xi={}));const pa=wm.create,k3=B0.create,Oie=A3.create,P9=RE.create;Zm.create;const SC=bh.create,sm=Po.create;Po.strictCreate;PO.create;CO.create;pv.create;const Iie=$0.create;OO.create;Dm.create;V0.create;var Lk="Checkbox",[LCe,Net]=Ks(Lk),[FCe,j4]=LCe(Lk);function zCe(e){const{__scopeCheckbox:t,checked:r,children:n,defaultChecked:o,disabled:l,form:d,name:i,onCheckedChange:g,required:x,value:S="on",internal_do_not_use_render:E}=e,[A,C]=Ru({prop:r,defaultProp:o??!1,onChange:g,caller:Lk}),[N,k]=G.useState(null),[R,L]=G.useState(null),j=G.useRef(!1),F=N?!!d||!!N.closest("form"):!0,B={checked:A,disabled:l,setChecked:C,control:N,setControl:k,name:i,form:d,value:S,hasConsumerStoppedPropagationRef:j,required:x,defaultChecked:Lm(o)?!1:o,isFormControl:F,bubbleInput:R,setBubbleInput:L};return m.jsx(FCe,{scope:t,...B,children:BCe(E)?E(B):n})}var kie="CheckboxTrigger",Rie=G.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},o)=>{const{control:l,value:d,disabled:i,checked:g,required:x,setControl:S,setChecked:E,hasConsumerStoppedPropagationRef:A,isFormControl:C,bubbleInput:N}=j4(kie,e),k=hi(o,S),R=G.useRef(g);return G.useEffect(()=>{const L=l==null?void 0:l.form;if(L){const j=()=>E(R.current);return L.addEventListener("reset",j),()=>L.removeEventListener("reset",j)}},[l,E]),m.jsx(bn.button,{type:"button",role:"checkbox","aria-checked":Lm(g)?"mixed":g,"aria-required":x,"data-state":Lie(g),"data-disabled":i?"":void 0,disabled:i,value:d,...n,ref:k,onKeyDown:Rr(t,L=>{L.key==="Enter"&&L.preventDefault()}),onClick:Rr(r,L=>{E(j=>Lm(j)?!0:!j),N&&C&&(A.current=L.isPropagationStopped(),A.current||L.stopPropagation())})})});Rie.displayName=kie;var N4=G.forwardRef((e,t)=>{const{__scopeCheckbox:r,name:n,checked:o,defaultChecked:l,required:d,disabled:i,value:g,onCheckedChange:x,form:S,...E}=e;return m.jsx(zCe,{__scopeCheckbox:r,checked:o,defaultChecked:l,disabled:i,required:d,onCheckedChange:x,name:n,form:S,value:g,internal_do_not_use_render:({isFormControl:A})=>m.jsxs(m.Fragment,{children:[m.jsx(Rie,{...E,ref:t,__scopeCheckbox:r}),A&&m.jsx(Die,{__scopeCheckbox:r})]})})});N4.displayName=Lk;var jie="CheckboxIndicator",Nie=G.forwardRef((e,t)=>{const{__scopeCheckbox:r,forceMount:n,...o}=e,l=j4(jie,r);return m.jsx(ys,{present:n||Lm(l.checked)||l.checked===!0,children:m.jsx(bn.span,{"data-state":Lie(l.checked),"data-disabled":l.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...e.style}})})});Nie.displayName=jie;var Mie="CheckboxBubbleInput",Die=G.forwardRef(({__scopeCheckbox:e,...t},r)=>{const{control:n,hasConsumerStoppedPropagationRef:o,checked:l,defaultChecked:d,required:i,disabled:g,name:x,value:S,form:E,bubbleInput:A,setBubbleInput:C}=j4(Mie,e),N=hi(r,C),k=_4(l),R=wB(n);G.useEffect(()=>{const j=A;if(!j)return;const F=window.HTMLInputElement.prototype,U=Object.getOwnPropertyDescriptor(F,"checked").set,Z=!o.current;if(k!==l&&U){const X=new Event("click",{bubbles:Z});j.indeterminate=Lm(l),U.call(j,Lm(l)?!1:l),j.dispatchEvent(X)}},[A,k,l,o]);const L=G.useRef(Lm(l)?!1:l);return m.jsx(bn.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??L.current,required:i,disabled:g,name:x,value:S,form:E,...t,tabIndex:-1,ref:N,style:{...t.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Die.displayName=Mie;function BCe(e){return typeof e=="function"}function Lm(e){return e==="indeterminate"}function Lie(e){return Lm(e)?"indeterminate":e?"checked":"unchecked"}const Gs=G.forwardRef(({className:e,...t},r)=>m.jsx(N4,{ref:r,className:_r("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:m.jsx(Nie,{className:_r("flex items-center justify-center text-current"),children:m.jsx(Tf,{className:"h-4 w-4"})})}));Gs.displayName=N4.displayName;var Fk="Tabs",[$Ce,Met]=Ks(Fk,[wk]),Fie=wk(),[UCe,M4]=$Ce(Fk),zie=G.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:o,defaultValue:l,orientation:d="horizontal",dir:i,activationMode:g="automatic",...x}=e,S=LT(i),[E,A]=Ru({prop:n,onChange:o,defaultProp:l??"",caller:Fk});return m.jsx(UCe,{scope:r,baseId:Hc(),value:E,onValueChange:A,orientation:d,dir:S,activationMode:g,children:m.jsx(bn.div,{dir:S,"data-orientation":d,...x,ref:t})})});zie.displayName=Fk;var Bie="TabsList",$ie=G.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...o}=e,l=M4(Bie,r),d=Fie(r);return m.jsx(Ste,{asChild:!0,...d,orientation:l.orientation,dir:l.dir,loop:n,children:m.jsx(bn.div,{role:"tablist","aria-orientation":l.orientation,...o,ref:t})})});$ie.displayName=Bie;var Uie="TabsTrigger",Vie=G.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:o=!1,...l}=e,d=M4(Uie,r),i=Fie(r),g=Gie(d.baseId,n),x=Hie(d.baseId,n),S=n===d.value;return m.jsx(Ete,{asChild:!0,...i,focusable:!o,active:S,children:m.jsx(bn.button,{type:"button",role:"tab","aria-selected":S,"aria-controls":x,"data-state":S?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:g,...l,ref:t,onMouseDown:Rr(e.onMouseDown,E=>{!o&&E.button===0&&E.ctrlKey===!1?d.onValueChange(n):E.preventDefault()}),onKeyDown:Rr(e.onKeyDown,E=>{[" ","Enter"].includes(E.key)&&d.onValueChange(n)}),onFocus:Rr(e.onFocus,()=>{const E=d.activationMode!=="manual";!S&&!o&&E&&d.onValueChange(n)})})})});Vie.displayName=Uie;var qie="TabsContent",Wie=G.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:o,children:l,...d}=e,i=M4(qie,r),g=Gie(i.baseId,n),x=Hie(i.baseId,n),S=n===i.value,E=G.useRef(S);return G.useEffect(()=>{const A=requestAnimationFrame(()=>E.current=!1);return()=>cancelAnimationFrame(A)},[]),m.jsx(ys,{present:o||S,children:({present:A})=>m.jsx(bn.div,{"data-state":S?"active":"inactive","data-orientation":i.orientation,role:"tabpanel","aria-labelledby":g,hidden:!A,id:x,tabIndex:0,...d,ref:t,style:{...e.style,animationDuration:E.current?"0s":void 0},children:A&&l})})});Wie.displayName=qie;function Gie(e,t){return`${e}-trigger-${t}`}function Hie(e,t){return`${e}-content-${t}`}var VCe=zie,Kie=$ie,Zie=Vie,Xie=Wie;const zk=VCe,qT=G.forwardRef(({className:e,...t},r)=>m.jsx(Kie,{ref:r,className:_r("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));qT.displayName=Kie.displayName;const Cu=G.forwardRef(({className:e,...t},r)=>m.jsx(Zie,{ref:r,className:_r("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));Cu.displayName=Zie.displayName;const Ou=G.forwardRef(({className:e,...t},r)=>m.jsx(Xie,{ref:r,className:_r("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Ou.displayName=Xie.displayName;const qCe=sm({name:pa().min(1,"Chinese name is required"),name_en:pa().min(1,"English name is required"),name_pt:pa().min(1,"Portuguese name is required"),type:SC(pa()).min(1,"At least 1 type is required").max(3,"Maximum 3 types allowed"),type_en:SC(pa()).min(1,"At least 1 type is required").max(3,"Maximum 3 types allowed"),type_pt:SC(pa()).min(1,"At least 1 type is required").max(3,"Maximum 3 types allowed"),description:pa().optional(),description_en:pa().optional(),description_pt:pa().optional(),address:pa().min(1,"Address is required"),lat:k3(),lng:k3(),phone:pa().optional(),website_url:pa().optional(),show_website_button:Oie().default(!0)}),C9=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function IO({restaurant:e,trigger:t}){const{t:r}=Ki(),{toast:n}=wa(),o=Na(),[l,d]=G.useState(!1),[i,g]=G.useState(null),[x,S]=G.useState((e==null?void 0:e.image_url)||null),[E,A]=G.useState(!1),C=G.useRef(null),N=G.useRef(null),k=G.useRef(null),[R,L]=G.useState(()=>{const _e={};return C9.forEach(be=>{_e[be]={open:"12:00",close:"23:00",closed:!1,splitShift:!1,open2:"19:00",close2:"23:00"}}),e!=null&&e.opening_hours?{..._e,...e.opening_hours}:_e}),[j,F]=G.useState(()=>e!=null&&e.type&&Array.isArray(e.type)?e.type.map((_e,be)=>{var Pe,ye;return{zh:_e,en:((Pe=e.type_en)==null?void 0:Pe[be])||"",pt:((ye=e.type_pt)==null?void 0:ye[be])||""}}):[{zh:"",en:"",pt:""}]),{register:B,handleSubmit:U,formState:{errors:Z},setValue:X,watch:te}=am({resolver:om(qCe),defaultValues:e?{name:e.name,name_en:e.name_en||"",name_pt:e.name_pt||"",type:Array.isArray(e.type)?e.type:[e.type],type_en:Array.isArray(e.type_en)?e.type_en:e.type_en?[e.type_en]:[""],type_pt:Array.isArray(e.type_pt)?e.type_pt:e.type_pt?[e.type_pt]:[""],description:e.description||"",description_en:e.description_en||"",description_pt:e.description_pt||"",address:e.address,lat:e.lat,lng:e.lng,phone:e.phone||"",website_url:e.website_url||"",show_website_button:e.show_website_button??!0}:{name:"",name_en:"",name_pt:"",type:[""],type_en:[""],type_pt:[""],description:"",description_en:"",description_pt:"",address:"",lat:38.7223,lng:-9.1393,phone:"",website_url:"",show_website_button:!0}}),se=()=>{j.length<3&&F([...j,{zh:"",en:"",pt:""}])},oe=_e=>{j.length>1&&F(j.filter((be,Pe)=>Pe!==_e))},ne=(_e,be,Pe)=>{const ye=[...j];ye[_e][be]=Pe,F(ye),X("type",ye.map(ge=>ge.zh).filter(Boolean)),X("type_en",ye.map(ge=>ge.en).filter(Boolean)),X("type_pt",ye.map(ge=>ge.pt).filter(Boolean))},ee=te("lat"),ie=te("lng"),he=te("show_website_button");G.useEffect(()=>{if(!l){N.current&&(N.current.remove(),N.current=null,k.current=null);return}if(N.current)return;const _e="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",Pe=setTimeout(()=>{if(!C.current){console.error("Map container not found");return}try{console.log("Initializing map...",{lat:ee,lng:ie}),Yo.accessToken=_e,N.current=new Yo.Map({container:C.current,style:"mapbox://styles/mapbox/light-v11",center:[ie,ee],zoom:15}),N.current.scrollZoom.disable(),N.current.on("load",()=>{console.log("Map loaded"),N.current&&(k.current=new Yo.Marker({draggable:!0}).setLngLat([ie,ee]).addTo(N.current),k.current.on("dragend",()=>{const ge=k.current.getLngLat();X("lng",ge.lng),X("lat",ge.lat)}),setTimeout(()=>{var ge;(ge=N.current)==null||ge.resize()},100))});const ye=ge=>{var ke,Qe;ge.ctrlKey||ge.metaKey?(ke=N.current)==null||ke.scrollZoom.enable():(Qe=N.current)==null||Qe.scrollZoom.disable()};C.current.addEventListener("wheel",ye),N.current.on("click",ge=>{var He;const{lng:ke,lat:Qe}=ge.lngLat;X("lng",ke),X("lat",Qe),(He=k.current)==null||He.setLngLat([ke,Qe])}),N.current.on("error",ge=>{console.error("Map error:",ge)})}catch(ye){console.error("Failed to initialize map:",ye)}},500);return()=>{clearTimeout(Pe)}},[l,ee,ie]),G.useEffect(()=>{k.current&&N.current&&(k.current.setLngLat([ie,ee]),N.current.setCenter([ie,ee]))},[ee,ie]);const Se=_e=>{var Pe;const be=(Pe=_e.target.files)==null?void 0:Pe[0];if(be){g(be);const ye=new FileReader;ye.onloadend=()=>{S(ye.result)},ye.readAsDataURL(be)}},Ce=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const _e=i.name.split(".").pop(),Pe=`${`${Math.random()}.${_e}`}`,{error:ye}=await Ut.storage.from("restaurant-images").upload(Pe,i);if(ye)throw ye;const{data:{publicUrl:ge}}=Ut.storage.from("restaurant-images").getPublicUrl(Pe);return ge},fe=async _e=>{A(!0);try{const{data:{user:be}}=await Ut.auth.getUser();if(!be)throw new Error("Not authenticated");const Pe=await Ce(),ye={name:_e.name,name_en:_e.name_en,name_pt:_e.name_pt,type:_e.type,type_en:_e.type_en,type_pt:_e.type_pt,description:_e.description||null,description_en:_e.description_en||null,description_pt:_e.description_pt||null,address:_e.address,lat:_e.lat,lng:_e.lng,phone:_e.phone||null,website_url:_e.website_url||null,show_website_button:_e.show_website_button,image_url:Pe,opening_hours:R};if(e){const{error:ge}=await Ut.from("restaurants").update({...ye,updated_by:be.id}).eq("id",e.id);if(ge)throw ge;n({title:r("common.success"),description:r("admin.restaurantUpdated")})}else{const{error:ge}=await Ut.from("restaurants").insert([{...ye,created_by:be.id}]);if(ge)throw ge;n({title:r("common.success"),description:r("admin.restaurantCreated")})}o.invalidateQueries({queryKey:["restaurants"]}),d(!1)}catch(be){n({title:r("common.error"),description:be.message,variant:"destructive"})}finally{A(!1)}};return m.jsxs(Rh,{open:l,onOpenChange:d,children:[m.jsx(Iv,{asChild:!0,children:t}),m.jsxs(Rd,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[m.jsxs(jd,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[m.jsxs(Nd,{className:"text-2xl flex items-center gap-2",children:[m.jsx(Qo,{className:"w-6 h-6 text-primary"}),r(e?"admin.editRestaurant":"admin.addRestaurant")]}),m.jsx(Md,{className:"text-base",children:r(e?"admin.editRestaurantDetails":"admin.createRestaurantWithInfo")})]}),m.jsx(uv,{className:"px-6 h-[calc(95vh-220px)]",children:m.jsxs("form",{onSubmit:U(fe),className:"space-y-6 py-6",children:[m.jsx(Qr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:m.jsxs(dn,{className:"p-6",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(O0,{className:"w-5 h-5 text-primary"}),r("admin.restaurantImage")]}),m.jsxs("div",{className:"flex items-center gap-6",children:[x&&m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:x,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),m.jsx(lr,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{g(null),S(null)},children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs(Zr,{htmlFor:"image-upload",className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[m.jsx(O0,{className:"h-8 w-8 text-primary"}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),m.jsx(an,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Se})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(C0,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),m.jsxs(zk,{defaultValue:"zh",className:"w-full",children:[m.jsxs(qT,{className:"grid w-full grid-cols-3 mb-6",children:[m.jsxs(Cu,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),m.jsxs(Cu,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),m.jsxs(Cu,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),m.jsxs(Ou,{value:"zh",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"name",className:"text-sm font-medium",children:r("admin.restaurantName")}),m.jsx(an,{id:"name",...B("name"),placeholder:r("admin.enterRestaurantName"),className:"text-base"}),Z.name&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx(Zr,{className:"text-sm font-medium",children:r("admin.restaurantType")}),j.length<3&&m.jsx(lr,{type:"button",variant:"outline",size:"sm",onClick:se,children:r("admin.addType")})]}),j.map((_e,be)=>m.jsxs("div",{className:"flex gap-2 items-center",children:[m.jsx(an,{placeholder:r("admin.typeExample"),value:_e.zh,onChange:Pe=>ne(be,"zh",Pe.target.value)}),m.jsx(lr,{type:"button",variant:"ghost",size:"icon",onClick:()=>oe(be),disabled:j.length===1,children:m.jsx(ju,{className:"h-4 w-4"})})]},be)),Z.type&&m.jsx("p",{className:"text-sm text-destructive",children:Z.type.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"description",className:"text-sm font-medium",children:r("admin.description")}),m.jsx(Mm,{id:"description",...B("description"),rows:3,placeholder:"..."})]})]}),m.jsxs(Ou,{value:"en",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"name_en",className:"text-sm font-medium",children:"Restaurant Name"}),m.jsx(an,{id:"name_en",...B("name_en"),placeholder:"Enter restaurant name...",className:"text-base"}),Z.name_en&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name_en.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(Zr,{className:"text-sm font-medium",children:"Restaurant Types (1-3 tags)"}),j.map((_e,be)=>m.jsx("div",{className:"flex gap-2 items-center",children:m.jsx(an,{placeholder:"e.g. Cantonese",value:_e.en,onChange:Pe=>ne(be,"en",Pe.target.value)})},be))]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"description_en",className:"text-sm font-medium",children:"Description"}),m.jsx(Mm,{id:"description_en",...B("description_en"),rows:3,placeholder:"Enter restaurant description..."})]})]}),m.jsxs(Ou,{value:"pt",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"name_pt",className:"text-sm font-medium",children:"Nome do Restaurante"}),m.jsx(an,{id:"name_pt",...B("name_pt"),placeholder:"Digite o nome do restaurante...",className:"text-base"}),Z.name_pt&&m.jsx("p",{className:"text-sm text-destructive",children:Z.name_pt.message})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsx(Zr,{className:"text-sm font-medium",children:"Tipos de Restaurante (1-3 tags)"}),j.map((_e,be)=>m.jsx("div",{className:"flex gap-2 items-center",children:m.jsx(an,{placeholder:"ex: Cantonesa",value:_e.pt,onChange:Pe=>ne(be,"pt",Pe.target.value)})},be))]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"description_pt",className:"text-sm font-medium",children:"Descrio"}),m.jsx(Mm,{id:"description_pt",...B("description_pt"),rows:3,placeholder:"Digite a descrio do restaurante..."})]})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6 space-y-4",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(Cs,{className:"w-5 h-5 text-primary"}),""]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{htmlFor:"address",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(Cs,{className:"w-4 h-4"}),r("admin.address")]}),m.jsx(an,{id:"address",...B("address"),placeholder:"..."}),Z.address&&m.jsx("p",{className:"text-sm text-destructive",children:Z.address.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{htmlFor:"phone",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(PT,{className:"w-4 h-4"}),r("admin.phone")]}),m.jsx(an,{id:"phone",...B("phone"),placeholder:"+351..."})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{htmlFor:"website_url",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(C0,{className:"w-4 h-4"}),r("admin.website")]}),m.jsx(an,{id:"website_url",...B("website_url"),placeholder:"https://"})]}),m.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[m.jsx(Gs,{id:"show_website_button",checked:he,onCheckedChange:_e=>X("show_website_button",_e)}),m.jsx(Zr,{htmlFor:"show_website_button",className:"cursor-pointer text-sm",children:r("admin.showWebsiteButton")})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6 space-y-4",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(Cs,{className:"w-5 h-5 text-primary"}),r("admin.location")]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"lat",className:"text-sm font-medium",children:r("admin.latitude")}),m.jsx(an,{id:"lat",type:"number",step:"any",...B("lat",{valueAsNumber:!0})})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"lng",className:"text-sm font-medium",children:r("admin.longitude")}),m.jsx(an,{id:"lng",type:"number",step:"any",...B("lng",{valueAsNumber:!0})})]})]}),m.jsx("div",{ref:C,className:"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm",style:{minHeight:"384px"}}),m.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[m.jsx(Cs,{className:"w-4 h-4"}),r("admin.clickOrDragToSetLocation")]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6 space-y-4",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2",children:[m.jsx(AT,{className:"w-5 h-5 text-primary"}),r("admin.openingHours")]}),m.jsx("div",{className:"space-y-3",children:C9.map(_e=>m.jsxs("div",{className:"space-y-2 p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[m.jsxs("div",{className:"grid grid-cols-[120px_1fr_auto] gap-4 items-center",children:[m.jsx(Zr,{className:"capitalize font-semibold",children:r(`admin.day.${_e}`)}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Gs,{id:`split-${_e}`,checked:R[_e].splitShift,onCheckedChange:be=>L({...R,[_e]:{...R[_e],splitShift:be}}),disabled:R[_e].closed}),m.jsx(Zr,{htmlFor:`split-${_e}`,className:"cursor-pointer text-sm",children:""})]}),m.jsxs("div",{className:"flex items-center space-x-2",children:[m.jsx(Gs,{id:`closed-${_e}`,checked:R[_e].closed,onCheckedChange:be=>L({...R,[_e]:{...R[_e],closed:be}})}),m.jsx(Zr,{htmlFor:`closed-${_e}`,className:"cursor-pointer",children:r("admin.closed")})]})]}),!R[_e].closed&&m.jsx("div",{className:"ml-[120px] space-y-2",children:R[_e].splitShift?m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),m.jsx(an,{type:"time",value:R[_e].open,onChange:be=>L({...R,[_e]:{...R[_e],open:be.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(an,{type:"time",value:R[_e].close,onChange:be=>L({...R,[_e]:{...R[_e],close:be.target.value}}),className:"w-32"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),m.jsx(an,{type:"time",value:R[_e].open2||"19:00",onChange:be=>L({...R,[_e]:{...R[_e],open2:be.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(an,{type:"time",value:R[_e].close2||"23:00",onChange:be=>L({...R,[_e]:{...R[_e],close2:be.target.value}}),className:"w-32"})]})]}):m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(an,{type:"time",value:R[_e].open,onChange:be=>L({...R,[_e]:{...R[_e],open:be.target.value}}),className:"w-32"}),m.jsx("span",{className:"text-muted-foreground",children:"-"}),m.jsx(an,{type:"time",value:R[_e].close,onChange:be=>L({...R,[_e]:{...R[_e],close:be.target.value}}),className:"w-32"})]})})]},_e))})]})})]})}),m.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30",children:[m.jsx(lr,{type:"button",variant:"outline",onClick:()=>d(!1),children:r("common.cancel")}),m.jsxs(lr,{type:"submit",disabled:E,onClick:U(fe),className:"gap-2",children:[m.jsx(Qo,{className:"w-4 h-4"}),r(E?"common.saving":"common.save")]})]})]})]})}const WCe=()=>{var Pe,ye,ge,ke;const{id:e}=oQ(),t=Uf(),{t:r}=Ki(),{user:n}=Di(),{localizeRestaurant:o,getLocalizedField:l}=kd(),d=G.useRef(null),i=G.useRef(null),[g,x]=G.useState(null),[S,E]=G.useState(!1),[A,C]=G.useState(!0),[N,k]=G.useState(!1),R=(Pe=t.state)==null?void 0:Pe.fromActivity,j=((ye=t.state)==null?void 0:ye.from)==="admin"?"/admin/restaurants":R?`/activity/${R}`:"/restaurants",{data:F,isLoading:B}=b2e(e),{data:U=[]}=Bre(),{data:Z}=v4(e,"restaurant"),X=$re(),{role:te,isAdmin:se}=Tc(),{data:oe=[]}=UT(),ne=F&&oe.some(Qe=>Qe.id===F.id),ee=F?o(F):null,ie=F?U.includes(F.id):!1,he=Z==null?void 0:Z.reduce((Qe,He)=>(He.price_range&&(Qe[He.price_range]=(Qe[He.price_range]||0)+1),Qe),{}),Se=he?(ge=Object.entries(he).sort(([,Qe],[,He])=>He-Qe)[0])==null?void 0:ge[0]:null;G.useEffect(()=>{F&&Ik().then(Qe=>{const He=$T(Qe.coords.latitude,Qe.coords.longitude,F.lat,F.lng);x(He)}).catch(()=>{x(null)})},[F]);const Ce=()=>{!n||!F||X.mutate(F.id)},fe=()=>{const Qe=window.location.href;navigator.clipboard.writeText(Qe),Vr.success(r("common.linkCopied"))},_e=async()=>{if(!F||!ee)return;const Qe={title:ee.name,text:ee.description||ee.name,url:window.location.href};try{await navigator.share(Qe)}catch{}},be=Qe=>{if(!F||!ee)return;const He=encodeURIComponent(window.location.href),$e=encodeURIComponent(ee.name);let Xe="";switch(Qe){case"whatsapp":Xe=`https://wa.me/?text=${$e}%20${He}`;break;case"facebook":Xe=`https://www.facebook.com/sharer/sharer.php?u=${He}`;break;case"twitter":Xe=`https://twitter.com/intent/tweet?text=${$e}&url=${He}`;break;case"telegram":Xe=`https://t.me/share/url?url=${He}&text=${$e}`;break;case"wechat":fe(),Vr.info(r("share.wechatTip"));return;default:return}window.open(Xe,"_blank","width=600,height=400")};return G.useEffect(()=>{if(!d.current||i.current||!F)return;const Qe="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";return Yo.accessToken=Qe,i.current=new Yo.Map({container:d.current,style:"mapbox://styles/mapbox/light-v11",center:[F.lng,F.lat],zoom:15,cooperativeGestures:!0}),new Yo.Marker({color:"#016450"}).setLngLat([F.lng,F.lat]).addTo(i.current),i.current.addControl(new Yo.NavigationControl),()=>{var He;(He=i.current)==null||He.remove(),i.current=null}},[F]),B?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin text-primary"})}):!F||!ee?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:r("error.notFound")}),m.jsx(lr,{asChild:!0,className:"mt-4",children:m.jsx(Vi,{to:j,children:r("common.back")})})]})}):m.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[m.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[m.jsx("img",{src:F.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:ee.name,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),m.jsx(lr,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:m.jsx(Vi,{to:j,children:m.jsx(lB,{className:"w-5 h-5"})})}),n&&m.jsx(lr,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:Ce,children:m.jsx(uB,{className:`w-5 h-5 ${ie?"fill-destructive text-destructive":""}`})}),m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsx(lr,{variant:"secondary",size:"icon",className:"absolute top-4 right-16",children:m.jsx(zx,{className:"w-5 h-5"})})}),m.jsxs(ng,{align:"end",children:[m.jsxs(Ca,{onClick:fe,children:[m.jsx(GY,{className:"w-4 h-4 mr-2"}),r("share.copyLink")]}),"share"in navigator&&m.jsxs(Ca,{onClick:_e,children:[m.jsx(zx,{className:"w-4 h-4 mr-2"}),r("share.more")]}),m.jsxs(Ca,{onClick:()=>be("whatsapp"),children:[m.jsx(Yx,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),m.jsxs(Ca,{onClick:()=>be("facebook"),children:[m.jsx("span",{className:"w-4 h-4 mr-2",children:""}),"Facebook"]}),m.jsxs(Ca,{onClick:()=>be("twitter"),children:[m.jsx("span",{className:"w-4 h-4 mr-2",children:""}),"Twitter/X"]}),m.jsxs(Ca,{onClick:()=>be("telegram"),children:[m.jsx("span",{className:"w-4 h-4 mr-2",children:""}),"Telegram"]}),m.jsxs(Ca,{onClick:()=>be("wechat"),children:[m.jsx("span",{className:"w-4 h-4 mr-2",children:""}),r("share.wechat")]})]})]}),(ne||se)&&F&&m.jsx(IO,{restaurant:F,trigger:m.jsx(lr,{variant:"secondary",size:"icon",className:"absolute top-4 right-28",children:m.jsx(fB,{className:"w-5 h-5"})})}),F&&m.jsx(E4,{targetType:"restaurant",targetId:F.id,trigger:m.jsx(lr,{variant:"secondary",size:"icon",className:`absolute top-4 ${ne||se?"right-40":"right-28"}`,children:m.jsx(tk,{className:"w-5 h-5"})})})]}),m.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:m.jsxs(Qr,{className:"shadow-large",children:[m.jsx(Mi,{children:m.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:m.jsxs("div",{children:[m.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:ee.type.slice(0,3).map((Qe,He)=>m.jsx(Qn,{className:"bg-primary",children:Qe},He))}),m.jsx(Ji,{className:"text-3xl mb-2",children:ee.name}),m.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[g!==null&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(ch,{className:"w-4 h-4 text-primary"}),m.jsxs("span",{className:"font-semibold text-base",children:[g.toFixed(1)," km"]})]}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(wc,{className:"w-5 h-5 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold text-base",children:((ke=F.rating)==null?void 0:ke.toFixed(1))||"0.0"})]}),Se&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(fye,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"font-semibold text-base",children:Se})]})]}),ee.description&&m.jsx("p",{className:"text-muted-foreground",children:ee.description})]})})}),m.jsxs(dn,{className:"space-y-6",children:[m.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(Cs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.address")}),m.jsx("p",{className:"text-muted-foreground",children:F.address})]})]}),F.phone&&m.jsxs("a",{href:`tel:${F.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[m.jsx(PT,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.phone")}),m.jsx("p",{className:"text-primary underline",children:F.phone})]})]}),F.opening_hours&&m.jsxs(vC,{open:S,onOpenChange:E,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(AT,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx(_C,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex flex-col items-start",children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.hours")}),!S&&m.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[r("restaurant.today")," ",Hre(F.opening_hours)]})]}),m.jsx(Yy,{className:`w-5 h-5 text-muted-foreground transition-transform ${S?"rotate-180":""}`})]})}),m.jsx(xC,{className:"mt-3",children:m.jsx("div",{className:"space-y-2",children:(()=>{const Qe=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],He={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},$e=Qe[new Date().getDay()===0?6:new Date().getDay()-1];return Qe.map(Xe=>{const ft=F.opening_hours[Xe],ze=Xe===$e,ut=r(`restaurant.${He[Xe]}`);let At="N/A";return ft&&(ft.closed?At=r("restaurant.closed"):ft.splitShift?At=`${ft.open} - ${ft.close}, ${ft.open2} - ${ft.close2}`:At=`${ft.open} - ${ft.close}`),m.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${ze?"bg-primary/10 border border-primary/20":""}`,children:[m.jsxs("span",{className:`text-sm font-medium ${ze?"text-primary":"text-foreground"}`,children:[ut,ze&&m.jsxs("span",{className:"ml-2 text-xs",children:["(",r("restaurant.today"),")"]})]}),m.jsx("span",{className:`text-sm ${ze?"text-primary font-semibold":"text-muted-foreground"} ${ft!=null&&ft.closed?"italic":""}`,children:At})]},Xe)})})()})})]})]}),F&&(l(F,"announcement")||F.announcement_zh)&&m.jsxs(vC,{open:N,onOpenChange:k,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[m.jsx(Yx,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx(_C,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("p",{className:"font-medium text-card-foreground",children:r("restaurant.announcement")}),m.jsx(Yy,{className:`w-5 h-5 text-muted-foreground transition-transform ${N?"rotate-180":""}`})]})}),m.jsx(xC,{className:"mt-3",children:m.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:m.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:l(F,"announcement")||F.announcement_zh})})})]})]})]}),m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs(lr,{variant:"secondary",className:"w-full",onClick:()=>Vre(F.lat,F.lng,ee.name),children:[m.jsx(ch,{className:"w-4 h-4 mr-2"}),r("restaurant.getDirections")]}),F.show_website_button&&F.website_url&&m.jsxs(lr,{className:"w-full",onClick:()=>window.open(F.website_url,"_blank"),children:[m.jsx(Yx,{className:"w-4 h-4 mr-2"}),r("restaurant.joinPrivate")]})]}),m.jsxs(vC,{open:A,onOpenChange:C,className:"p-4 rounded-lg bg-muted/50",children:[m.jsx(_C,{className:"w-full",children:m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h2",{className:"text-2xl font-bold",children:r("restaurant.address")}),m.jsx(Yy,{className:`w-5 h-5 text-muted-foreground transition-transform ${A?"rotate-180":""}`})]})}),m.jsx(xC,{children:m.jsx("div",{ref:d,className:"h-[350px] rounded-lg overflow-hidden"})})]}),m.jsx(vu,{}),m.jsx(N2e,{restaurantId:F.id}),m.jsx(vu,{}),m.jsx(hie,{restaurantId:F.id})]})]})})]})},GCe=()=>{const e=Vf(),{t,i18n:r}=Ki(),{toast:n}=wa(),{localizeRestaurant:o}=kd(),[l,d]=G.useState(""),[i,g]=G.useState([]),[x,S]=G.useState(null),[E,A]=G.useState(null),[C,N]=G.useState(!1),k=G.useRef(null),R=G.useRef(null),L=G.useRef({}),[j,F]=G.useState(null),{data:B,isLoading:U}=p4(l,i.length>0?i.join(","):void 0),{data:Z=[]}=Ure(),X=fe=>{g(_e=>_e.includes(fe)?_e.filter(be=>be!==fe):[..._e,fe])},te=async()=>{try{const fe=await Ik();A({lat:fe.coords.latitude,lng:fe.coords.longitude}),n({title:t("restaurants.locationEnabled"),description:t("restaurants.sortByDistance")})}catch{}},se=fe=>{S(fe),fe&&!E&&te()},oe=(B==null?void 0:B.map(fe=>{const _e=o(fe);if(E){const be=$T(E.lat,E.lng,fe.lat,fe.lng);return{..._e,distance:be}}return _e}))||[],ne=x&&E?oe.filter(fe=>fe.distance&&fe.distance<=x).sort((fe,_e)=>(fe.distance||0)-(_e.distance||0)):E?oe.sort((fe,_e)=>(fe.distance||0)-(_e.distance||0)):oe,ee=(ne==null?void 0:ne.map(fe=>fe.id))||[],{data:ie={}}=Kre(ee),he=fe=>{e(`/restaurant/${fe.id}`)},Se=fe=>{F(fe.id);const _e=L.current[fe.id];_e&&_e.scrollIntoView({behavior:"smooth",block:"center"})},Ce=()=>{const fe=document.getElementById("map-container");if(fe)if(C)document.exitFullscreen&&document.exitFullscreen();else{if(k.current){const _e=k.current.getCenter(),be=k.current.getZoom();R.current={center:[_e.lng,_e.lat],zoom:be}}fe.requestFullscreen&&fe.requestFullscreen()}};return G.useEffect(()=>{const fe=()=>{const _e=!!document.fullscreenElement;N(_e),!_e&&R.current&&k.current&&setTimeout(()=>{var be;(be=k.current)==null||be.jumpTo({center:R.current.center,zoom:R.current.zoom})},100)};return document.addEventListener("fullscreenchange",fe),()=>{document.removeEventListener("fullscreenchange",fe)}},[]),m.jsx("div",{className:"min-h-screen bg-gradient-to-br from-secondary/10 via-background to-secondary/20",children:m.jsxs("div",{className:"container mx-auto max-w-7xl px-4 py-8 lg:h-screen lg:flex lg:flex-col",children:[m.jsxs("div",{className:"mb-6 flex-shrink-0",children:[m.jsx("h1",{className:"text-4xl font-bold mb-2 bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:t("nav.mapView")}),m.jsx("p",{className:"text-muted-foreground",children:t("map.subtitle")})]}),m.jsxs("div",{className:"mb-6 space-y-4 flex-shrink-0",children:[m.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[m.jsx("div",{className:"flex-1 max-w-md",children:m.jsx(an,{placeholder:t("restaurants.search"),value:l,onChange:fe=>d(fe.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),m.jsxs(lr,{variant:E?"default":"outline",onClick:te,className:"gap-2 h-11 px-6",children:[m.jsx(ch,{className:`w-4 h-4 ${E?"animate-pulse":""}`}),t(E?"restaurants.locationEnabled":"restaurants.getLocation")]})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[Z.slice(0,6).map(fe=>m.jsx(Qn,{variant:i.includes(fe)?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform px-4 py-1.5 text-sm",onClick:()=>X(fe),children:fe},fe)),i.length>0&&m.jsx(Qn,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all px-4 py-1.5 text-sm",onClick:()=>g([]),children:""})]}),E&&m.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[m.jsxs("span",{className:"text-sm font-semibold text-primary",children:[t("restaurants.radius"),":"]}),m.jsx(Qn,{variant:x===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>se(null),children:t("restaurants.allRestaurants")}),m.jsx(Qn,{variant:x===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>se(5),children:t("restaurants.radius5km")}),m.jsx(Qn,{variant:x===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>se(10),children:t("restaurants.radius10km")}),m.jsx(Qn,{variant:x===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>se(20),children:t("restaurants.radius20km")})]})]}),!U&&ne&&ne.length>0&&m.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 lg:flex-1 lg:min-h-0 lg:overflow-hidden",children:[m.jsx("div",{className:"w-full lg:flex-1 h-[500px] lg:h-full",children:m.jsxs("div",{id:"map-container",className:`${C?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[m.jsx(lr,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:Ce,children:C?m.jsx(sye,{className:"w-5 h-5"}):m.jsx(oye,{className:"w-5 h-5"})}),m.jsx("div",{className:"h-full",children:m.jsx(Gre,{restaurants:ne,onRestaurantClick:he,userLocation:E,radiusFilter:x,onMarkerClick:Se,showViewDetailsButton:!0,onMapInit:fe=>{k.current=fe}})})]})}),m.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col lg:min-h-0 lg:h-full",children:[m.jsxs("div",{className:"mb-4 pb-4 border-b border-border flex-shrink-0",children:[m.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[m.jsx(Cs,{className:"w-6 h-6 text-primary"}),t("restaurants.title"),m.jsx(Qn,{variant:"secondary",className:"ml-2",children:ne.length})]}),E&&m.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[m.jsx(ch,{className:"w-4 h-4"}),t("restaurants.sortedByDistance")]})]}),m.jsx("div",{className:"lg:hidden space-y-3 pb-4",children:ne.map(fe=>{var _e;return m.jsx(Qr,{ref:be=>L.current[fe.id]=be,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${j===fe.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>he(fe),children:m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-2",children:[m.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:fe.name}),fe.rating>0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[m.jsx(wc,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),m.jsx("span",{className:"font-bold text-sm text-primary",children:fe.rating})]})]}),fe.type&&fe.type.length>0&&m.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[fe.type.slice(0,3).map((be,Pe)=>m.jsx(Qn,{variant:"secondary",className:"text-xs font-medium",children:be},`type-${Pe}`)),(_e=ie[fe.id])==null?void 0:_e.map((be,Pe)=>m.jsx(Qn,{variant:"default",className:"text-xs font-medium bg-primary/90 hover:bg-primary",children:v3(be,r.language)},`activity-${Pe}`))]}),m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(Cs,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),m.jsx("span",{className:"line-clamp-2",children:fe.address})]}),fe.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-bold text-primary bg-primary/5 px-3 py-1.5 rounded-lg w-fit",children:[m.jsx(ch,{className:"w-4 h-4"}),fe.distance<1?`${(fe.distance*1e3).toFixed(0)} m`:`${fe.distance.toFixed(1)} km`]})]})},fe.id)})}),m.jsx(uv,{className:"hidden lg:block lg:flex-1 pr-4",children:m.jsx("div",{className:"space-y-3 pb-4",children:ne.map(fe=>{var _e;return m.jsx(Qr,{ref:be=>L.current[fe.id]=be,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${j===fe.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>he(fe),children:m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex items-start justify-between gap-2",children:[m.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:fe.name}),fe.rating>0&&m.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[m.jsx(wc,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),m.jsx("span",{className:"font-bold text-sm text-primary",children:fe.rating})]})]}),fe.type&&fe.type.length>0&&m.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[fe.type.slice(0,3).map((be,Pe)=>m.jsx(Qn,{variant:"secondary",className:"text-xs font-medium",children:be},`type-${Pe}`)),(_e=ie[fe.id])==null?void 0:_e.map((be,Pe)=>m.jsx(Qn,{variant:"default",className:"text-xs font-medium bg-primary/90 hover:bg-primary",children:v3(be,r.language)},`activity-${Pe}`))]}),m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(Cs,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),m.jsx("span",{className:"line-clamp-2",children:fe.address})]}),fe.distance!==void 0&&m.jsxs("div",{className:"flex items-center gap-1.5 text-sm font-bold text-primary bg-primary/5 px-3 py-1.5 rounded-lg w-fit",children:[m.jsx(ch,{className:"w-4 h-4"}),fe.distance<1?`${(fe.distance*1e3).toFixed(0)} m`:`${fe.distance.toFixed(1)} km`]})]})},fe.id)})})})]})]})]})})},Yie=()=>Wi({queryKey:["activities"],queryFn:async()=>{const{data:e,error:t}=await Ut.from("activities").select("*").order("pinned",{ascending:!1}).order("sort_order",{ascending:!0}).order("start_date",{ascending:!1});if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{count:o}=await Ut.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id);return{...n,subscriber_count:o||0}}))}}),HCe=e=>Wi({queryKey:["activity",e],queryFn:async()=>{const{data:t,error:r}=await Ut.from("activities").select("*").eq("id",e).single();if(r)throw r;return t},enabled:!!e}),KCe=e=>Wi({queryKey:["activityRestaurants",e],queryFn:async()=>{const{data:t,error:r}=await Ut.from("activity_restaurants").select("*").eq("activity_id",e);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:o,error:l}=await Ut.from("restaurants").select("id, name, name_en, name_pt, type, type_en, type_pt, address, image_url, rating, lat, lng").in("id",n);if(l)throw l;return t.map(d=>({...d,restaurants:(o==null?void 0:o.find(i=>i.id===d.restaurant_id))||{id:d.restaurant_id,name:"",name_en:null,name_pt:null,type:[],type_en:null,type_pt:null,address:"",image_url:null,rating:null,lat:null,lng:null}}))},enabled:!!e}),D4=()=>{const{user:e}=Di();return Wi({queryKey:["subscriptions",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("subscriptions").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return await Promise.all((t||[]).map(async o=>{const{data:l}=await Ut.from("activities").select("*").eq("id",o.activity_id).single();return{...o,activity:l}}))},enabled:!!e})},Jie=()=>{const{user:e}=Di(),{toast:t}=wa(),r=Na();return Xa({mutationFn:async n=>{if(!e)throw new Error("User not authenticated");const{data:o}=await Ut.from("subscriptions").select("id").eq("activity_id",n).eq("user_id",e.id).maybeSingle();if(o){const{error:l}=await Ut.from("subscriptions").delete().eq("id",o.id);if(l)throw l;return{action:"unsubscribed"}}else{const{error:l}=await Ut.from("subscriptions").insert({activity_id:n,user_id:e.id});if(l)throw l;return{action:"subscribed"}}},onSuccess:n=>{r.invalidateQueries({queryKey:["subscriptions"]}),t({title:n.action==="subscribed"?"Subscribed!":"Unsubscribed",description:n.action==="subscribed"?"You've joined this activity":"You've left this activity"})},onError:()=>{t({title:"Error",description:"Failed to update subscription",variant:"destructive"})}})},ZCe=e=>Wi({queryKey:["subscriberCount",e],queryFn:async()=>{const{count:t,error:r}=await Ut.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",e);if(r)throw r;return t||0},enabled:!!e}),XCe=()=>{const{t:e}=Ki(),{user:t}=Di();Tc();const{localizeActivity:r}=kd(),{data:n,isLoading:o}=Yie(),{data:l=[]}=D4(),d=l.map(x=>x.activity_id),i=Jie(),g=(x,S)=>{if(S.preventDefault(),S.stopPropagation(),!t){Lc({title:e("activities.signInToSubscribe")||"",description:e("activities.signInToSubscribeDesc")||"",variant:"destructive"});return}i.mutate(x)};return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsxs("div",{className:"container mx-auto max-w-6xl",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-4xl font-bold mb-2 text-foreground",children:e("activities.title")}),m.jsx("p",{className:"text-muted-foreground text-lg",children:e("activities.description")})]}),o&&m.jsx("div",{className:"flex justify-center items-center py-20",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin text-primary"})}),!o&&(!n||n.length===0)&&m.jsx("div",{className:"text-center py-20",children:m.jsx("p",{className:"text-xl text-muted-foreground",children:e("activities.noActivities")||"No activities available"})}),!o&&n&&n.length>0&&m.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:n.map(x=>{const S=r(x);return m.jsx(Qr,{className:"overflow-hidden hover:shadow-large transition-shadow",children:m.jsxs(Vi,{to:`/activity/${x.id}`,children:[m.jsxs("div",{className:"relative h-48 overflow-hidden",children:[m.jsx("img",{src:x.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=600&q=80",alt:S.title,className:"w-full h-full object-cover transition-transform hover:scale-105"}),x.pinned&&m.jsx(Qn,{className:"absolute top-3 left-3 bg-accent",children:e("activities.pinned")}),x.end_date&&new Date(x.end_date)<new Date?m.jsx(Qn,{className:"absolute top-3 right-3 bg-secondary",children:e("activities.ended")}):x.subscriber_count!==void 0&&m.jsxs(Qn,{variant:"secondary",className:"absolute top-3 right-3 flex items-center gap-1.5",children:[m.jsx(yu,{className:"w-3.5 h-3.5"}),m.jsx("span",{children:x.subscriber_count})]})]}),m.jsx(Mi,{children:m.jsx("h3",{className:"text-xl font-semibold text-card-foreground line-clamp-2",children:S.title})}),m.jsxs(dn,{className:"space-y-3",children:[m.jsx("div",{className:`text-muted-foreground text-sm line-clamp-3\r
                          [&_h1]:text-base [&_h1]:font-bold [&_h1]:text-foreground\r
                          [&_h2]:text-sm [&_h2]:font-semibold [&_h2]:text-foreground\r
                          [&_h3]:text-sm [&_h3]:font-medium [&_h3]:text-foreground\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_p]:my-1\r
                          [&_ul]:list-disc [&_ul]:ml-4\r
                          [&_ol]:list-decimal [&_ol]:ml-4`,dangerouslySetInnerHTML:{__html:S.content}}),m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx($l,{className:"w-4 h-4"}),m.jsx("span",{children:Is(new Date(x.start_date),"PPP")})]}),x.end_date&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(AT,{className:"w-4 h-4"}),m.jsxs("span",{children:[e("activities.until")," ",Is(new Date(x.end_date),"PPP")]})]})]}),m.jsxs(Ok,{className:"gap-2",children:[m.jsx(lr,{asChild:!0,className:"flex-1",children:m.jsx("span",{children:e("activities.viewDetails")})}),m.jsx(lr,{variant:d.includes(x.id)?"outline":"default",onClick:E=>g(x.id,E),disabled:i.isPending,title:d.includes(x.id)?e("activities.subscribed"):e("activities.subscribe"),children:d.includes(x.id)?m.jsx(Wge,{className:"w-4 h-4"}):m.jsx(qY,{className:"w-4 h-4"})})]})]})},x.id)})})]})})},Qie=G.memo(({restaurants:e,onMarkerClick:t})=>{const r=G.useRef(null),n=G.useRef(null),o=G.useRef([]),l=G.useRef(!1),d=G.useRef(null);return G.useEffect(()=>{if(!r.current||e.length===0||l.current)return;const i="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";Yo.accessToken=i;const g=e.reduce((E,A)=>E+Number(A.restaurants.lat||0),0)/e.length,x=e.reduce((E,A)=>E+Number(A.restaurants.lng||0),0)/e.length;return n.current=new Yo.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[x,g],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),n.current.addControl(new Yo.NavigationControl,"top-right"),(()=>{var E;if(o.current.forEach(A=>A.remove()),o.current=[],d.current&&(d.current.remove(),d.current=null),e.forEach(A=>{const C=Number(A.restaurants.lat),N=Number(A.restaurants.lng);if(isNaN(C)||isNaN(N))return;const k=document.createElement("div");k.className="p-3 min-w-[200px]",k.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${A.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${A.restaurants.address}</p>
          </div>
        `;const R=new Yo.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([N,C]).setDOMContent(k),L=new Yo.Marker({color:"#016450",draggable:!1}).setLngLat([N,C]).addTo(n.current),j=L.getElement();j.style.cursor="pointer";const F=B=>{B.stopPropagation(),B.preventDefault(),d.current&&d.current!==R&&d.current.remove(),R.addTo(n.current),d.current=R,n.current.easeTo({center:[N,C],zoom:17,duration:800}),t&&t(A.restaurant_id)};j.addEventListener("click",F),R.on("close",()=>{d.current===R&&(d.current=null)}),o.current.push(L)}),e.length>1){const A=new Yo.LngLatBounds;e.forEach(C=>{const N=Number(C.restaurants.lat),k=Number(C.restaurants.lng);!isNaN(N)&&!isNaN(k)&&A.extend([k,N])}),(E=n.current)==null||E.fitBounds(A,{padding:50,maxZoom:14})}})(),l.current=!0,()=>{var E;o.current.forEach(A=>A.remove()),o.current=[],d.current&&(d.current.remove(),d.current=null),(E=n.current)==null||E.remove(),l.current=!1}},[e]),e.length===0?null:m.jsx("div",{ref:r,className:"w-full h-[350px] rounded-lg"})});Qie.displayName="ActivityParticipationMap";const YCe=({open:e,onOpenChange:t,restaurants:r,participatingRestaurantIds:n,onConfirm:o,isPending:l,isParticipating:d})=>{const{t:i}=Ki(),{localizeRestaurant:g}=kd(),[x,S]=G.useState(d?n:[]),E=N=>{S(k=>k.includes(N)?k.filter(R=>R!==N):[...k,N])},A=()=>{x.length===r.length?S([]):S(r.map(N=>N.id))},C=()=>{o(x)};return m.jsx(Rh,{open:e,onOpenChange:t,children:m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(Qo,{className:"w-5 h-5"}),d?"":""]}),m.jsx(Md,{children:d?"":""})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[m.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[m.jsx(Gs,{id:"select-all",checked:x.length===r.length,onCheckedChange:A}),m.jsxs(Zr,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["/ (",x.length,"/",r.length,")"]})]}),m.jsx("div",{className:"space-y-3",children:r.map(N=>{const k=g(N),R=x.includes(N.id),L=n.includes(N.id);return m.jsx(Qr,{className:`transition-all ${R?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:m.jsx(dn,{className:"p-4",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Gs,{id:N.id,checked:R,onCheckedChange:()=>E(N.id)}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs(Zr,{htmlFor:N.id,className:"cursor-pointer flex items-center gap-2",children:[m.jsx("span",{className:"font-semibold truncate",children:k.name}),L&&m.jsxs(Qn,{variant:"secondary",className:"text-xs",children:[m.jsx(Tf,{className:"w-3 h-3 mr-1"}),""]})]}),m.jsx("p",{className:"text-sm text-muted-foreground truncate",children:N.address}),k.type&&k.type.length>0&&m.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:k.type.slice(0,2).map((j,F)=>m.jsx(Qn,{variant:"outline",className:"text-xs",children:j},F))})]})]})})},N.id)})})]}),m.jsxs(b4,{children:[m.jsx(lr,{variant:"outline",onClick:()=>t(!1),disabled:l,children:i("common.cancel")}),m.jsx(lr,{onClick:C,disabled:l,children:l?m.jsxs(m.Fragment,{children:[m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}),i("common.loading")]}):m.jsxs(m.Fragment,{children:[m.jsx(Tf,{className:"w-4 h-4 mr-2"})," (",x.length,")"]})})]})]})})},JCe=()=>{var Yr;const{id:e}=oQ(),t=Uf(),r=Vf(),{t:n}=Ki(),{user:o}=Di(),{isMerchant:l,isSupervisor:d}=Tc(),{localizeActivity:i,localizeRestaurant:g}=kd(),[x,S]=We.useState(!1),[E,A]=We.useState(!1),[C,N]=We.useState(null),[k,R]=We.useState(!1),[L,j]=We.useState(!1),[F,B]=We.useState(!1),U=We.useCallback(_t=>{r(`/restaurant/${_t}`,{state:{fromActivity:e}})},[r,e]),Z=((Yr=t.state)==null?void 0:Yr.from)==="admin"?"/admin/activities":"/activities",{data:X,isLoading:te}=HCe(e),{data:se,isLoading:oe}=KCe(e),{data:ne=[]}=D4(),ee=ne.map(_t=>_t.activity_id),{data:ie=0}=ZCe(e),he=Jie(),{data:Se=[]}=UT(),{data:Ce=[]}=$Pe(e),fe=UPe(),_e=X?i(X):null,be=X?ee.includes(X.id):!1,Pe=l||d,ye=()=>{!o||!X||he.mutate(X.id)},ge=Se.filter(_t=>Ce.includes(_t.id)).length,ke=ge>0,Qe=ge===Se.length,He=ge>0&&ge<Se.length,$e=()=>{if(!(!X||!Pe||Se.length===0))if(d)B(!0);else if(ke)for(const _t of Se)Ce.includes(_t.id)&&fe.mutate({activityId:X.id,restaurantId:_t.id});else for(const _t of Se)fe.mutate({activityId:X.id,restaurantId:_t.id})},Xe=_t=>{if(!X)return;const Mt=_t.filter(at=>!Ce.includes(at)),Ke=Ce.filter(at=>!_t.includes(at));Mt.forEach(at=>{fe.mutate({activityId:X.id,restaurantId:at})}),Ke.forEach(at=>{fe.mutate({activityId:X.id,restaurantId:at})}),B(!1)},ft=async()=>{j(!0);try{const _t=await Ik();N({lat:_t.coords.latitude,lng:_t.coords.longitude}),R(!0),Vr.success(n("map.locationEnabled"))}catch{Vr.error(n("map.locationError")),R(!1)}finally{j(!1)}},ze=()=>{N(null),R(!1)},ut=async()=>{try{await navigator.clipboard.writeText(window.location.href),Vr.success(n("activities.linkCopied"))}catch(_t){console.error("Error copying link:",_t),Vr.error(n("activities.shareError"))}},At=async()=>{const _t={title:(_e==null?void 0:_e.title)||X.title_zh,text:`${(_e==null?void 0:_e.title)||X.title_zh} - Xiaoxiong Market`,url:window.location.href};try{navigator.share?(await navigator.share(_t),Vr.success(n("activities.shareSuccess"))):ut()}catch(Mt){Mt.name!=="AbortError"&&(console.error("Error sharing:",Mt),Vr.error(n("activities.shareError")))}},xt=_t=>{const Mt=encodeURIComponent(window.location.href);encodeURIComponent((_e==null?void 0:_e.title)||X.title_zh);const Ke=encodeURIComponent(`${(_e==null?void 0:_e.title)||X.title_zh} - Xiaoxiong Market`);let at="";switch(_t){case"whatsapp":at=`https://wa.me/?text=${Ke}%20${Mt}`;break;case"facebook":at=`https://www.facebook.com/sharer/sharer.php?u=${Mt}`;break;case"twitter":at=`https://twitter.com/intent/tweet?text=${Ke}&url=${Mt}`;break;case"telegram":at=`https://t.me/share/url?url=${Mt}&text=${Ke}`;break;case"wechat":ut(),Vr.info("");return;default:return}window.open(at,"_blank","noopener,noreferrer")},nr=We.useMemo(()=>se?!k||!C?se:se.filter(_t=>$T(C.lat,C.lng,Number(_t.restaurants.lat),Number(_t.restaurants.lng))<=15):[],[se,k,C]);if(te)return m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin text-primary"})});if(!X||!_e)return m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"text-xl text-muted-foreground",children:n("error.notFound")}),m.jsx(lr,{asChild:!0,className:"mt-4",children:m.jsx(Vi,{to:Z,children:n("common.back")})})]})});const Vt=new Date(X.start_date),dr=X.end_date?new Date(X.end_date):null,Br=dr?new Date<=dr:new Date>=Vt;return m.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[m.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[m.jsx("img",{src:X.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:_e.title,className:"w-full h-full object-cover"}),m.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),m.jsx(lr,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:m.jsx(Vi,{to:Z,children:m.jsx(lB,{className:"w-5 h-5"})})}),m.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[X.pinned&&m.jsx(Qn,{className:"bg-accent",children:n("activities.pinned")}),m.jsx(E4,{targetType:"activity",targetId:X.id,trigger:m.jsx(lr,{variant:"secondary",size:"icon",className:"shadow-lg",children:m.jsx(tk,{className:"w-5 h-5"})})}),m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsx(lr,{variant:"secondary",size:"icon",className:"shadow-lg",children:m.jsx(zx,{className:"w-5 h-5"})})}),m.jsxs(ng,{align:"end",className:"w-48",children:[m.jsxs(Ca,{onClick:()=>xt("wechat"),children:[m.jsx(Yx,{className:"w-4 h-4 mr-2"}),""]}),m.jsxs(Ca,{onClick:()=>xt("whatsapp"),children:[m.jsx(Yx,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),m.jsxs(Ca,{onClick:()=>xt("facebook"),children:[m.jsx(zx,{className:"w-4 h-4 mr-2"}),"Facebook"]}),m.jsxs(Ca,{onClick:()=>xt("twitter"),children:[m.jsx(zx,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),m.jsxs(Ca,{onClick:()=>xt("telegram"),children:[m.jsx(Yx,{className:"w-4 h-4 mr-2"}),"Telegram"]}),m.jsx(i0,{}),m.jsxs(Ca,{onClick:ut,children:[m.jsx(GY,{className:"w-4 h-4 mr-2"}),""]}),navigator.share&&m.jsxs(Ca,{onClick:At,children:[m.jsx(zx,{className:"w-4 h-4 mr-2"}),""]})]})]})]})]}),m.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:m.jsxs(Qr,{className:"shadow-large",children:[m.jsx(Mi,{children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx(Qn,{variant:Br?"default":"secondary",children:n(Br?"activities.ongoing":"activities.ended")}),X.repeat_mode&&X.repeat_mode!=="none"&&m.jsx(Qn,{variant:"outline",children:n(`activities.repeat.${X.repeat_mode}`)})]}),m.jsx(Ji,{className:"text-3xl",children:_e.title}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 text-sm text-muted-foreground",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx($l,{className:"w-4 h-4"}),m.jsxs("span",{children:[Is(Vt,"PPP"),dr&&` - ${Is(dr,"PPP")}`]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(yu,{className:"w-4 h-4"}),m.jsxs("span",{children:[ie," ",n("activities.subscribersCount")]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Qo,{className:"w-4 h-4"}),m.jsxs("span",{children:[(se==null?void 0:se.length)||0," ",n("activities.restaurantsParticipating")]})]})]}),o&&m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[Pe&&Se.length>0&&m.jsx(lr,{onClick:$e,disabled:fe.isPending,size:"lg",variant:ke?"outline":"default",className:"w-full sm:w-auto",children:d?He?m.jsxs(m.Fragment,{children:[m.jsx(Qo,{className:"w-4 h-4 mr-2"}),"/"]}):Qe?m.jsxs(m.Fragment,{children:[m.jsx(Tf,{className:"w-4 h-4 mr-2"}),""]}):m.jsxs(m.Fragment,{children:[m.jsx(Qo,{className:"w-4 h-4 mr-2"}),""]}):ke?m.jsxs(m.Fragment,{children:[m.jsx(Tf,{className:"w-4 h-4 mr-2"}),""]}):m.jsxs(m.Fragment,{children:[m.jsx(Qo,{className:"w-4 h-4 mr-2"}),""]})}),m.jsx(lr,{onClick:ye,disabled:he.isPending,size:"lg",variant:be?"outline":"secondary",className:"w-full sm:w-auto",children:be?m.jsxs(m.Fragment,{children:[m.jsx(Tf,{className:"w-4 h-4 mr-2"}),n("activities.subscribed")||""]}):m.jsxs(m.Fragment,{children:[m.jsx(yu,{className:"w-4 h-4 mr-2"}),n("activities.subscribe")||""]})})]}),!o&&m.jsx("p",{className:"text-sm text-muted-foreground",children:n("activities.signInToJoin")})]})}),m.jsxs(dn,{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-2xl font-bold mb-4",children:n("activities.about")}),m.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:_e.content}})]}),m.jsx(vu,{}),oe?m.jsx("div",{className:"flex justify-center py-8",children:m.jsx(Ws,{className:"w-6 h-6 animate-spin text-primary"})}):se&&se.length>0?m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[m.jsx(Cs,{className:"w-6 h-6"}),n("activities.participatingRestaurants")," (",nr.length,k&&se.length!==nr.length&&` / ${se.length}`,")"]}),m.jsxs(lr,{variant:k?"default":"outline",size:"sm",onClick:k?ze:ft,disabled:L,children:[L?m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}):m.jsx(ch,{className:"w-4 h-4 mr-2"}),k?"":"15"]})]}),m.jsx("div",{className:"mb-6",children:m.jsx(Qie,{restaurants:nr,onMarkerClick:U})})]}),m.jsx(vC,{open:x,onOpenChange:S,children:m.jsxs(Qr,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[m.jsx(Mi,{className:"pb-3",children:m.jsx(_C,{asChild:!0,children:m.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[m.jsxs(Ji,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[m.jsx(Qo,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),""]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Qn,{variant:"secondary",className:"transition-opacity duration-200",children:x?"":""}),m.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:x?"rotate(180deg)":"rotate(0deg)"},children:m.jsx(Yy,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),m.jsx(xC,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:m.jsxs(dn,{className:"pt-0 pb-6 space-y-4",children:[m.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(E?nr:nr.slice(0,6)).map((_t,Mt)=>{const Ke=g(_t.restaurants);return m.jsx(Qr,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in",style:{animationDelay:`${Mt*50}ms`,animationFillMode:"forwards"},children:m.jsxs(Vi,{to:`/restaurant/${_t.restaurant_id}`,state:{fromActivity:X.id},children:[m.jsxs("div",{className:"relative h-40 overflow-hidden",children:[m.jsx("img",{src:_t.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:Ke.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),Ke.type&&Ke.type.length>0&&m.jsx(Qn,{className:"absolute top-2 left-2 bg-primary",children:Ke.type[0]})]}),m.jsxs(dn,{className:"pt-4",children:[m.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:Ke.name}),m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[m.jsx(Cs,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-1",children:_t.restaurants.address})]}),_t.restaurants.rating&&m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(wc,{className:"w-4 h-4 fill-accent text-accent"}),m.jsx("span",{className:"font-semibold",children:_t.restaurants.rating.toFixed(1)})]})]})]})},_t.id)})}),nr.length>6&&!E&&m.jsxs(lr,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>A(!0),children:[m.jsx(Yy,{className:"w-4 h-4 mr-2"})," (",nr.length-6," )"]})]})})]})})]}):null,m.jsx(vu,{}),m.jsx(hie,{restaurantId:X.id,targetType:"activity"})]})]})}),d&&m.jsx(YCe,{open:F,onOpenChange:B,restaurants:Se,participatingRestaurantIds:Ce,onConfirm:Xe,isPending:fe.isPending,isParticipating:ke})]})},QCe="/assets/final-logo-B_8qCuvU.png",eOe=()=>{const{signIn:e,signUp:t,signInWithGoogle:r,signInWithPhone:n,verifyOTP:o,user:l}=Di(),d=Vf(),[i,g]=G.useState(!1),[x,S]=G.useState("login"),[E,A]=G.useState("phone");G.useState(""),G.useState("+351");const[C,N]=G.useState("info"),[k,R]=G.useState(""),[L,j]=G.useState(null),[F,B]=G.useState(0),[U,Z]=G.useState(null),{t:X}=Ki(),te=sm({email:pa().email(X("auth.invalidEmail")),password:pa().min(6,X("auth.passwordMin"))}),se=sm({displayName:pa().min(2,X("auth.displayNameMin")),email:pa().email(X("auth.invalidEmail")),password:pa().min(6,X("auth.passwordMin")),confirmPassword:pa()}).refine(ye=>ye.password===ye.confirmPassword,{message:X("auth.passwordsDontMatch"),path:["confirmPassword"]}),oe=sm({phone:pa().min(6,X("auth.phoneMin"))}),ne=sm({otp:pa().length(6,X("auth.otpLength"))}),ee=sm({code:pa().length(4,"Verification code must be 4 digits")}),ie=am({resolver:om(te)}),he=am({resolver:om(se)});am({resolver:om(oe)}),am({resolver:om(ne)});const Se=am({resolver:om(ee)});G.useEffect(()=>{l&&d("/")},[l,d]),G.useEffect(()=>{let ye;return F>0&&(ye=setTimeout(()=>B(F-1),1e3)),()=>clearTimeout(ye)},[F]);const Ce=ye=>{let ge=0;return ye.length>=6&&ge++,ye.length>=8&&ge++,/[a-z]/.test(ye)&&ge++,/[A-Z]/.test(ye)&&ge++,/[0-9]/.test(ye)&&ge++,/[^a-zA-Z0-9]/.test(ye)&&ge++,ge<=2?"weak":ge<=4?"medium":"strong"},fe=async ye=>{g(!0);try{const{error:ge}=await e(ye.email,ye.password);if(ge){ge.message.includes("Invalid login credentials")?Vr.error(X("auth.invalidCredentials")):Vr.error(ge.message);return}Vr.success(X("auth.signInSuccess"))}catch(ge){Vr.error(ge.message||X("error.general"))}finally{g(!1)}},_e=async ye=>{g(!0);try{j(ye),R(ye.email);const{error:ge}=await Ut.functions.invoke("send-verification-code",{body:{email:ye.email}});if(ge){Vr.error(X("auth.verificationCodeFailed")),console.error(ge);return}N("verify"),Vr.success(X("auth.verificationCodeSent")),B(30)}catch(ge){Vr.error(ge.message||X("error.general"))}finally{g(!1)}},be=async ye=>{if(L){g(!0);try{const{data:ge,error:ke}=await Ut.functions.invoke("verify-email-code",{body:{email:k,code:ye.code}});if(ke||!(ge!=null&&ge.success)){Vr.error((ge==null?void 0:ge.error)||X("auth.invalidVerificationCode"));return}const{error:Qe}=await t(L.email,L.password,L.displayName);if(Qe){Qe.message.includes("already registered")?Vr.error(X("auth.emailExists")):Vr.error(Qe.message);return}Vr.success(X("auth.signUpSuccess")),S("login"),N("info"),he.reset(),Se.reset(),j(null)}catch(ge){Vr.error(ge.message||X("error.general"))}finally{g(!1)}}},Pe=async()=>{if(!(F>0)){g(!0);try{const{error:ye}=await Ut.functions.invoke("send-verification-code",{body:{email:k}});if(ye){Vr.error("Failed to resend verification code");return}Vr.success("Verification code resent"),B(30)}catch(ye){Vr.error(ye.message||"Failed to resend code")}finally{g(!1)}}};return m.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:m.jsxs(Qr,{className:"w-full max-w-md shadow-large",children:[m.jsxs(Mi,{className:"text-center",children:[m.jsx("div",{className:"flex justify-center mb-4",children:m.jsx("img",{src:QCe,alt:"Logo",style:{width:"35px",height:"35px"},className:"object-contain drop-shadow-md"})}),m.jsx(Ji,{className:"text-2xl",children:X("auth.welcome")}),m.jsx(Do,{children:X("auth.subtitle")})]}),m.jsx(dn,{children:m.jsxs(zk,{value:x,onValueChange:ye=>{S(ye),A("phone"),N("info")},className:"w-full",children:[m.jsxs(qT,{className:"grid w-full grid-cols-2",children:[m.jsx(Cu,{value:"login",children:X("auth.login")}),m.jsx(Cu,{value:"register",children:X("auth.register")})]}),m.jsx(Ou,{value:"login",children:m.jsxs("form",{onSubmit:ie.handleSubmit(fe),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"email",children:X("auth.email")}),m.jsx(an,{id:"email",type:"email",placeholder:"you@example.com",...ie.register("email")}),ie.formState.errors.email&&m.jsx("p",{className:"text-sm text-destructive",children:ie.formState.errors.email.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"password",children:X("auth.password")}),m.jsx(an,{id:"password",type:"password",placeholder:"",...ie.register("password")}),ie.formState.errors.password&&m.jsx("p",{className:"text-sm text-destructive",children:ie.formState.errors.password.message})]}),m.jsx(lr,{type:"submit",className:"w-full",disabled:i,children:X(i?"auth.signingIn":"auth.signIn")})]})}),m.jsx(Ou,{value:"register",children:C==="info"?m.jsxs("form",{onSubmit:he.handleSubmit(_e),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"display-name",children:X("auth.displayName")}),m.jsx(an,{id:"display-name",placeholder:"John Doe",...he.register("displayName")}),he.formState.errors.displayName&&m.jsx("p",{className:"text-sm text-destructive",children:he.formState.errors.displayName.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"register-email",children:X("auth.email")}),m.jsx(an,{id:"register-email",type:"email",placeholder:"you@example.com",...he.register("email")}),he.formState.errors.email&&m.jsx("p",{className:"text-sm text-destructive",children:he.formState.errors.email.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"register-password",children:X("auth.password")}),m.jsx(an,{id:"register-password",type:"password",placeholder:X("auth.passwordPlaceholder"),...he.register("password"),onChange:ye=>{he.setValue("password",ye.target.value),ye.target.value?Z(Ce(ye.target.value)):Z(null)}}),he.formState.errors.password&&m.jsx("p",{className:"text-sm text-destructive",children:he.formState.errors.password.message}),U&&m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex gap-1",children:[m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="weak"?"bg-destructive":U==="medium"?"bg-warning":"bg-success"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="medium"||U==="strong"?U==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${U==="strong"?"bg-success":"bg-muted"}`})]}),m.jsx("p",{className:`text-xs ${U==="weak"?"text-destructive":U==="medium"?"text-warning":"text-success"}`,children:X(`auth.passwordStrength.${U}`)})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"confirm-password",children:X("auth.confirmPassword")}),m.jsx(an,{id:"confirm-password",type:"password",placeholder:X("auth.passwordPlaceholder"),...he.register("confirmPassword")}),he.formState.errors.confirmPassword&&m.jsx("p",{className:"text-sm text-destructive",children:he.formState.errors.confirmPassword.message})]}),m.jsx(lr,{type:"submit",className:"w-full",disabled:i,children:i?"Sending code...":"Send Verification Code"})]}):m.jsxs("form",{onSubmit:Se.handleSubmit(be),className:"space-y-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"verification-code",children:"Verification Code"}),m.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",k]}),m.jsx("div",{className:"flex justify-center",children:m.jsx(w4,{maxLength:4,...Se.register("code"),onChange:ye=>Se.setValue("code",ye),children:m.jsxs(S4,{children:[m.jsx(xf,{index:0}),m.jsx(xf,{index:1}),m.jsx(xf,{index:2}),m.jsx(xf,{index:3})]})})}),Se.formState.errors.code&&m.jsx("p",{className:"text-sm text-destructive text-center",children:Se.formState.errors.code.message})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(lr,{type:"button",variant:"outline",className:"w-full",onClick:()=>{N("info"),Se.reset()},children:X("common.back")}),m.jsx(lr,{type:"submit",className:"w-full",disabled:i,children:i?X("auth.verifying"):"Verify & Register"})]}),m.jsx(lr,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:Pe,disabled:i||F>0,children:F>0?`Resend Code (${F}s)`:"Resend Code"})]})})]})}),m.jsx(Ok,{children:m.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:m.jsx(Vi,{to:"/",className:"text-primary hover:underline",children:X("auth.backToHome")})})})]})})},tOe=()=>{const{user:e}=Di();return Wi({queryKey:["favorites",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("favorites").select("restaurant_id").eq("user_id",e.id);if(r)throw r;if(!t||t.length===0)return[];const n=t.map(d=>d.restaurant_id),{data:o,error:l}=await Ut.from("restaurants").select("*").in("id",n);if(l)throw l;return o||[]},enabled:!!e})},rOe=()=>{const{user:e}=Di();return Wi({queryKey:["user-comments",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("comments").select("*").eq("user_id",e.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;return await Promise.all((t||[]).map(async o=>{if(o.target_type==="restaurant"){const{data:l}=await Ut.from("restaurants").select("name, name_en, name_pt").eq("id",o.target_id).single();return{...o,target_name:(l==null?void 0:l.name)||"Unknown Restaurant",target_name_en:l==null?void 0:l.name_en,target_name_pt:l==null?void 0:l.name_pt}}else if(o.target_type==="activity"){const{data:l}=await Ut.from("activities").select("title_zh, title_en, title_pt").eq("id",o.target_id).single();return{...o,target_name:(l==null?void 0:l.title_zh)||"Unknown Activity",target_name_en:l==null?void 0:l.title_en,target_name_pt:l==null?void 0:l.title_pt}}return o}))},enabled:!!e})},nOe=()=>{const{user:e}=Di(),{data:t=[]}=UT();return Wi({queryKey:["merchantActivities",e==null?void 0:e.id],queryFn:async()=>{if(!e||t.length===0)return[];const r=t.map(x=>x.id),{data:n,error:o}=await Ut.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(o)throw o;if(!n||n.length===0)return[];const{data:l}=await Ut.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),d=[...new Set(n.map(x=>x.activity_id))],{data:i}=await Ut.from("activities").select("*").in("id",d);return n.map(x=>{const S=l==null?void 0:l.find(A=>A.id===x.restaurant_id),E=i==null?void 0:i.find(A=>A.id===x.activity_id);return{activity_id:x.activity_id,restaurant_id:x.restaurant_id,restaurant_name:(S==null?void 0:S.name)||"",restaurant_name_en:(S==null?void 0:S.name_en)||null,restaurant_name_pt:(S==null?void 0:S.name_pt)||null,restaurant_address:(S==null?void 0:S.address)||"",activity:E||null,created_at:x.created_at}})},enabled:!!e&&t.length>0})},iOe="modulepreload",aOe=function(e){return"/"+e},O9={},oOe=function(t,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=(d==null?void 0:d.nonce)||(d==null?void 0:d.getAttribute("nonce"));o=Promise.allSettled(r.map(g=>{if(g=aOe(g),g in O9)return;O9[g]=!0;const x=g.endsWith(".css"),S=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${S}`))return;const E=document.createElement("link");if(E.rel=x?"stylesheet":iOe,x||(E.as="script"),E.crossOrigin="",E.href=g,i&&E.setAttribute("nonce",i),document.head.appendChild(E),x)return new Promise((A,C)=>{E.addEventListener("load",A),E.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${g}`)))})}))}function l(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return o.then(d=>{for(const i of d||[])i.status==="rejected"&&l(i.reason);return t().catch(l)})},sOe=({profile:e})=>{const{t}=Ki(),r=Vf(),{user:n}=Di(),{isAdmin:o}=Tc(),[l,d]=G.useState(!1),[i,g]=G.useState(e.display_name),[x,S]=G.useState(e.phone||""),[E,A]=G.useState(null),[C,N]=G.useState(e.avatar_url||""),[k,R]=G.useState(!1),[L,j]=G.useState(!1),[F,B]=G.useState(""),[U,Z]=G.useState(!1),[X,te]=G.useState(!1),[se,oe]=G.useState(!1),[ne,ee]=G.useState(!1),[ie,he]=G.useState(""),[Se,Ce]=G.useState(""),[fe,_e]=G.useState(""),[be,Pe]=G.useState(!1),[ye,ge]=G.useState(!1),[ke,Qe]=G.useState(!1),[He,$e]=G.useState(!1),[Xe,ft]=G.useState(!1),[ze,ut]=G.useState(""),[At,xt]=G.useState(""),[nr,Vt]=G.useState(""),[dr,Br]=G.useState(!1),[Yr,_t]=G.useState(""),[Mt,Ke]=G.useState(!1),[at,dt]=G.useState(!1),[tr,Qt]=G.useState(null),er=G.useRef(null),Pr=G.useRef(null),sn=G.useRef(null),fn=RTe(),Ai=NTe();G.useEffect(()=>{be&&er.current&&er.current.focus()},[be]),G.useEffect(()=>{ye&&Pr.current&&Pr.current.focus()},[ye]),G.useEffect(()=>{Mt&&sn.current&&sn.current.focus()},[Mt]);const mi=xr=>{var On;const wn=(On=xr.target.files)==null?void 0:On[0];if(wn){if(wn.size>2*1024*1024)return;A(wn),N(URL.createObjectURL(wn))}},Zi=async()=>{let xr=e.avatar_url;if(E){const wn=await Ai.mutateAsync(E);wn&&(xr=wn)}await fn.mutateAsync({display_name:i,phone:x||void 0,avatar_url:xr||void 0}),d(!1)},Rs=async()=>{if(!(!n||F.toLowerCase()!=="delete")){Z(!0);try{const{error:xr}=await Ut.functions.invoke("delete-account",{body:{userId:n.id}});if(xr){Vr.error(t("profile.deleteAccountFailed")),console.error(xr),Z(!1);return}Vr.success(t("profile.deleteAccountSuccess")),j(!1),R(!1),B(""),await new Promise(wn=>setTimeout(wn,1500)),await Ut.auth.signOut(),r("/auth")}catch(xr){Vr.error(xr.message||t("profile.deleteAccountFailed")),Z(!1)}finally{Z(!1)}}},Ua=async()=>{if(n!=null&&n.email)try{const{error:xr}=await Ut.functions.invoke("send-verification-code",{body:{email:n.email}});if(xr)throw xr;Pe(!0),Vr.success(t("profile.codeSentToOldEmail"))}catch(xr){Vr.error(t("profile.sendCodeFailed")),console.error(xr)}},wi=async()=>{if(!Se){Vr.error(t("profile.enterCodePlaceholder"));return}try{const{data:xr,error:wn}=await Ut.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:Se}});if(wn||!(xr!=null&&xr.success)){Vr.error(t("profile.codeIncorrect"));return}Vr.success(t("profile.oldEmailVerified")),te(!1),oe(!0)}catch(xr){Vr.error(t("profile.verificationFailed")),console.error(xr)}},_s=async()=>{if(!ie||!ie.includes("@")){Vr.error(t("profile.enterValidEmail"));return}try{const{error:xr}=await Ut.functions.invoke("send-verification-code",{body:{email:ie}});if(xr)throw xr;Vr.success(t("profile.codeSentToNewEmail")),ge(!0)}catch(xr){Vr.error(t("profile.sendCodeFailed")),console.error(xr)}},zo=async()=>{if(!fe){Vr.error(t("profile.enterCodePlaceholder"));return}try{const{data:xr,error:wn}=await Ut.functions.invoke("verify-email-code",{body:{email:ie,code:fe}});if(wn||!(xr!=null&&xr.success)){Vr.error(t("profile.codeIncorrect"));return}Vr.success(t("profile.newEmailVerified")),oe(!1),setTimeout(()=>{ee(!0)},100)}catch(xr){Vr.error(""),console.error(xr)}},js=async()=>{Qe(!0);try{const{data:{session:xr}}=await Ut.auth.getSession();if(!xr||!n){Vr.error(""),Qe(!1);return}const{data:wn,error:On}=await Ut.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:Se,newEmail:ie,newEmailCode:fe},headers:{Authorization:`Bearer ${xr.access_token}`}});if(On||!(wn!=null&&wn.success))throw new Error((wn==null?void 0:wn.error)||"Failed to update email");Vr.success(""),ee(!1),d(!1),Ce(""),he(""),_e(""),Pe(!1),ge(!1),await new Promise(Ii=>setTimeout(Ii,1500)),await Ut.auth.signOut(),r("/auth")}catch(xr){Vr.error(xr.message||""),console.error(xr)}finally{Qe(!1)}},Bo=xr=>{let wn=0;return xr.length>=6&&wn++,xr.length>=8&&wn++,/[a-z]/.test(xr)&&wn++,/[A-Z]/.test(xr)&&wn++,/[0-9]/.test(xr)&&wn++,/[^a-zA-Z0-9]/.test(xr)&&wn++,wn<=2?"weak":wn<=4?"medium":"strong"},ts=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!ze){Vr.error(t("profile.enterCurrentPassword"));return}try{const{createClient:wn}=await oOe(async()=>{const{createClient:ha}=await Promise.resolve().then(()=>e1e);return{createClient:ha}},void 0),On=wn("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:Ii}=await On.auth.signInWithPassword({email:(n==null?void 0:n.email)||"",password:ze});if(Ii){Vr.error(t("profile.oldPasswordIncorrect"));return}Vr.success(t("profile.oldPasswordVerified")),$e(!1),ft(!0)}catch(wn){Vr.error(t("profile.verificationFailed")),console.error(wn)}},ji=async()=>{if(n!=null&&n.email)try{const{error:xr}=await Ut.functions.invoke("send-verification-code",{body:{email:n.email}});if(xr)throw xr;Ke(!0),Vr.success(t("profile.codeSentToOldEmail"))}catch(xr){Vr.error(t("profile.sendCodeFailed")),console.error(xr)}},oo=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!Yr){Vr.error(t("profile.enterCodePlaceholder"));return}try{const{data:wn,error:On}=await Ut.functions.invoke("verify-email-code",{body:{email:n==null?void 0:n.email,code:Yr}});if(On||!(wn!=null&&wn.success)){Vr.error(t("profile.codeIncorrect"));return}Vr.success(t("profile.oldEmailVerified")),$e(!1),ft(!0)}catch(wn){Vr.error(t("profile.verificationFailed")),console.error(wn)}},ml=async xr=>{if(xr==null||xr.preventDefault(),xr==null||xr.stopPropagation(),!At||!nr){Vr.error(t("profile.enterNewPassword"));return}if(At.length<6){Vr.error(t("profile.passwordTooShort"));return}if(At!==nr){Vr.error(t("profile.passwordsDontMatch"));return}dt(!0);try{const{error:wn}=await Ut.auth.updateUser({password:At});if(wn)throw wn;Vr.success(t("profile.passwordUpdated")),ft(!1),d(!1),ut(""),xt(""),Vt(""),Br(!1),_t(""),Ke(!1)}catch(wn){Vr.error(wn.message||t("profile.passwordUpdateFailed")),console.error(wn)}finally{dt(!1)}};return m.jsxs(Rh,{open:l,onOpenChange:d,children:[m.jsx(Iv,{asChild:!0,children:m.jsxs(lr,{variant:"outline",children:[m.jsx(dye,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:t("profile.editProfile")}),m.jsx(Md,{children:t("profile.editProfileDescription")})]}),m.jsxs("div",{className:"space-y-3 py-3",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3",children:[m.jsxs(qm,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[m.jsx(Wm,{src:C}),m.jsx(Gm,{children:i==null?void 0:i.charAt(0).toUpperCase()})]}),m.jsxs("div",{children:[m.jsx(an,{type:"file",accept:"image/*",onChange:mi,className:"hidden",id:"avatar-upload"}),m.jsxs(lr,{variant:"outline",size:"sm",onClick:()=>{var xr;return(xr=document.getElementById("avatar-upload"))==null?void 0:xr.click()},className:"text-xs sm:text-sm",children:[m.jsx(O0,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Zr,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),m.jsx(an,{id:"displayName",value:i,onChange:xr=>g(xr.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Zr,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),m.jsx(an,{id:"phone",value:x,onChange:xr=>S(xr.target.value),placeholder:t("profile.phone"),className:"h-9"})]}),!o&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[m.jsx(Zr,{className:"text-sm",children:""}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(an,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"h-9 flex-1"}),m.jsxs(lr,{variant:"outline",size:"sm",onClick:()=>te(!0),className:"text-xs",children:[m.jsx(KY,{className:"w-3 h-3 mr-1"}),""]})]})]}),m.jsxs("div",{className:"space-y-1.5",children:[m.jsx(Zr,{className:"text-sm",children:t("profile.changePassword")}),m.jsxs(lr,{variant:"outline",size:"sm",onClick:()=>$e(!0),className:"w-full justify-start h-9",children:[m.jsx(aye,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!o&&m.jsxs(lr,{variant:"destructive",size:"sm",onClick:()=>R(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[m.jsx(bb,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),m.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${o?"sm:ml-auto":""}`,children:[m.jsx(lr,{variant:"outline",size:"sm",onClick:()=>d(!1),className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),m.jsx(lr,{size:"sm",onClick:Zi,disabled:fn.isPending||Ai.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:fn.isPending||Ai.isPending?t("common.loading"):t("common.save")})]})]})]}),m.jsx(zl,{open:k,onOpenChange:R,children:m.jsxs(ol,{children:[m.jsxs(sl,{children:[m.jsx(cl,{children:t("profile.deleteAccountWarning")}),m.jsx(ul,{children:t("profile.deleteAccountDescription")})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:t("common.cancel")}),m.jsx(Us,{onClick:()=>{R(!1),j(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),m.jsx(zl,{open:L,onOpenChange:j,children:m.jsxs(ol,{children:[m.jsxs(sl,{children:[m.jsx(cl,{children:t("profile.confirmDeleteAccount")}),m.jsxs(ul,{className:"space-y-4",children:[m.jsx("p",{children:t("profile.confirmDeleteDescription")}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),m.jsx(an,{id:"confirm-delete",value:F,onChange:xr=>B(xr.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),m.jsxs(ll,{children:[m.jsx(dl,{onClick:()=>B(""),children:t("common.cancel")}),m.jsx(Us,{onClick:Rs,disabled:F.toLowerCase()!=="delete"||U,className:"bg-destructive hover:bg-destructive/90",children:t(U?"common.loading":"profile.deleteAccount")})]})]})}),m.jsx(zl,{open:X,onOpenChange:te,children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:t("profile.verifyOldEmail")}),m.jsx(ul,{children:t("profile.oldEmailStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.currentEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(an,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),m.jsx(lr,{variant:"outline",size:"sm",onClick:Ua,disabled:be,children:t(be?"profile.codeSent":"profile.sendCode")})]})]}),be&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.verificationCode")}),m.jsx(an,{ref:er,value:Se,onChange:xr=>Ce(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),m.jsxs(ll,{children:[m.jsx(dl,{onClick:()=>{te(!1),setTimeout(()=>{Ce(""),Pe(!1)},300)},children:t("common.cancel")}),be&&m.jsx(Us,{onClick:wi,children:t("profile.verify")})]})]})}),m.jsx(zl,{open:se,onOpenChange:oe,children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(sl,{className:"text-center space-y-3",children:[m.jsx(cl,{className:"text-xl",children:t("profile.verifyNewEmail")}),m.jsx(ul,{className:"text-center",children:t("profile.newEmailStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{className:"text-sm font-normal",children:t("profile.newEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(an,{type:"email",value:ie,onChange:xr=>he(xr.target.value),placeholder:t("profile.enterNewEmail"),disabled:ye,className:"border-2 focus:border-primary flex-1"}),m.jsx(lr,{variant:"outline",size:"sm",onClick:_s,disabled:!ie||ye,className:"text-xs whitespace-nowrap px-3",children:t(ye?"profile.codeSent":"profile.sendCode")})]})]}),ye&&m.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[m.jsx(Zr,{className:"text-sm font-normal",children:t("profile.verificationCode")}),m.jsx(an,{ref:Pr,value:fe,onChange:xr=>_e(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),m.jsxs(ll,{className:"flex-col sm:flex-col gap-2",children:[ye&&m.jsx(Us,{onClick:zo,disabled:!fe||fe.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:""}),m.jsx(dl,{onClick:()=>{oe(!1),setTimeout(()=>{he(""),_e(""),ge(!1)},300)},className:"w-full mt-0",children:""})]})]})}),m.jsx(zl,{open:ne,onOpenChange:ee,children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:""}),m.jsx(ul,{children:" 3/3: "})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[m.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:""}),m.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'""'})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"text-muted-foreground",children:":"}),m.jsx("span",{className:"font-medium",children:n==null?void 0:n.email})]}),m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"text-muted-foreground",children:":"}),m.jsx("span",{className:"font-medium",children:ie})]})]})]}),m.jsxs(ll,{children:[m.jsx(dl,{onClick:()=>{ee(!1),setTimeout(()=>{Ce(""),he(""),_e(""),Pe(!1),ge(!1)},300)},children:""}),m.jsx(Us,{onClick:js,disabled:ke,children:ke?"...":""})]})]})}),m.jsx(zl,{open:He,onOpenChange:$e,children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:t("profile.verifyOldPassword")}),m.jsx(ul,{children:t("profile.oldPasswordStep")})]}),m.jsx("div",{className:"space-y-4 py-4",children:dr?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.currentEmail")}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(an,{value:(n==null?void 0:n.email)||"",disabled:!0,className:"flex-1"}),m.jsx(lr,{variant:"outline",size:"sm",onClick:ji,disabled:Mt,children:t(Mt?"profile.codeSent":"profile.sendCode")})]})]}),Mt&&m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.verificationCode")}),m.jsx(an,{ref:sn,value:Yr,onChange:xr=>_t(xr.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.currentPassword")}),m.jsx(an,{type:"password",value:ze,onChange:xr=>ut(xr.target.value),placeholder:t("profile.enterCurrentPassword")})]}),m.jsxs(lr,{variant:"link",size:"sm",onClick:()=>Br(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),m.jsxs(ll,{children:[m.jsx(dl,{onClick:()=>{$e(!1),setTimeout(()=>{ut(""),Br(!1),_t(""),Ke(!1)},300)},children:t("common.cancel")}),dr?Mt&&m.jsx(Us,{onClick:oo,children:t("profile.verify")}):m.jsx(Us,{onClick:ts,children:t("profile.verify")})]})]})}),m.jsx(zl,{open:Xe,onOpenChange:ft,children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-md",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:t("profile.setNewPassword")}),m.jsx(ul,{children:t("profile.newPasswordStep")})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.newPassword")}),m.jsx(an,{type:"password",value:At,onChange:xr=>{xt(xr.target.value),xr.target.value?Qt(Bo(xr.target.value)):Qt(null)},placeholder:t("profile.enterNewPassword")}),tr&&m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex gap-1",children:[m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${tr==="weak"?"bg-destructive":tr==="medium"?"bg-warning":"bg-success"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${tr==="medium"||tr==="strong"?tr==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),m.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${tr==="strong"?"bg-success":"bg-muted"}`})]}),m.jsx("p",{className:`text-xs ${tr==="weak"?"text-destructive":tr==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${tr}`)})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{children:t("profile.confirmNewPassword")}),m.jsx(an,{type:"password",value:nr,onChange:xr=>Vt(xr.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),At&&nr&&At!==nr&&m.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),m.jsxs(ll,{children:[m.jsx(dl,{onClick:()=>{ft(!1),setTimeout(()=>{xt(""),Vt(""),Qt(null)},300)},children:t("common.cancel")}),m.jsx(Us,{onClick:ml,disabled:!At||!nr||At!==nr||at,children:t(at?"common.loading":"profile.updatePassword")})]})]})})]})},lOe=()=>{var j;const{t:e}=Ki(),{user:t}=Di(),{data:r,isLoading:n}=i4(),{data:o,isLoading:l}=tOe(),{data:d,isLoading:i}=rOe(),{data:g,isLoading:x}=D4(),{data:S,isLoading:E}=nOe(),{role:A,isMerchant:C,isSupervisor:N}=Tc(),{getLocalizedField:k}=kd(),R=C||N;if(!t||n)return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsx("div",{className:"container mx-auto max-w-6xl",children:m.jsx("div",{className:"text-center",children:e("common.loading")})})});const L=e(A?`profile.role.${A}`:"profile.role.user");return m.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:m.jsxs("div",{className:"container mx-auto max-w-6xl",children:[m.jsx(Qr,{className:"mb-8",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-6",children:[m.jsxs(qm,{className:"w-24 h-24",children:[m.jsx(Wm,{src:(r==null?void 0:r.avatar_url)||""}),m.jsx(Gm,{children:((j=r==null?void 0:r.display_name)==null?void 0:j.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 text-center md:text-left",children:[m.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:r==null?void 0:r.display_name}),m.jsx("p",{className:"text-muted-foreground mb-3",children:t.email}),(r==null?void 0:r.phone)&&m.jsx("p",{className:"text-muted-foreground mb-3",children:r.phone}),A&&A!=="user"&&m.jsx(Qn,{className:"bg-primary capitalize",children:L})]}),r&&m.jsx(sOe,{profile:r})]})})}),m.jsxs(zk,{defaultValue:"favorites",className:"space-y-6",children:[m.jsxs(qT,{className:"grid w-full grid-cols-3",children:[m.jsxs(Cu,{value:"favorites",children:[m.jsx(uB,{className:"w-4 h-4 mr-2"}),e("profile.favorites")]}),m.jsxs(Cu,{value:"comments",children:[m.jsx(dB,{className:"w-4 h-4 mr-2"}),e("profile.comments")]}),m.jsxs(Cu,{value:"activities",children:[m.jsx($l,{className:"w-4 h-4 mr-2"}),e("profile.activities")]})]}),m.jsx(Ou,{value:"favorites",className:"space-y-4",children:m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:e("profile.favoriteRestaurants")}),m.jsx(Do,{children:e("profile.favoritesDesc")})]}),m.jsx(dn,{children:l?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):o&&o.length>0?m.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:o.map(F=>m.jsxs(Vi,{to:`/restaurant/${F.id}`,className:"flex gap-4 p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[m.jsx("div",{className:"w-24 h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:m.jsx("img",{src:F.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(k(F,"name")),className:"w-full h-full object-cover",onError:B=>{B.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-lg text-card-foreground line-clamp-1",children:k(F,"name")}),m.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:k(F,"type")}),m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(wc,{className:"w-4 h-4 fill-accent text-accent"}),m.jsx("span",{className:"font-medium",children:F.rating||0})]})]})]},F.id))}):m.jsx("p",{className:"text-muted-foreground text-center py-8",children:e("profile.noFavorites")})})]})}),m.jsx(Ou,{value:"comments",children:m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:e("profile.myComments")}),m.jsx(Do,{children:e("profile.commentsDesc")})]}),m.jsx(dn,{className:"space-y-4",children:i?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):d&&d.length>0?d.map(F=>m.jsxs(Vi,{to:`/${F.target_type}/${F.target_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[m.jsxs("div",{className:"flex items-center justify-between mb-2",children:[m.jsx("h3",{className:"font-semibold text-card-foreground",children:k(F,"target_name")}),m.jsx("span",{className:"text-sm text-muted-foreground",children:_f(new Date(F.created_at),{addSuffix:!0})})]}),m.jsx("p",{className:"text-muted-foreground line-clamp-2",children:F.content}),F.image_url&&m.jsx("img",{src:F.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-xs"})]},F.id)):m.jsx("p",{className:"text-muted-foreground text-center py-8",children:e("profile.noComments")})})]})}),m.jsx(Ou,{value:"activities",children:m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:R?"":e("profile.joinedActivities")}),m.jsx(Do,{children:R?"":e("profile.activitiesDesc")})]}),m.jsx(dn,{children:R?m.jsxs("div",{className:"space-y-6",children:[x?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):g&&g.length>0?m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(yu,{className:"w-5 h-5"}),""]}),m.jsx("div",{className:"space-y-4",children:g.map(F=>{var B;return m.jsx(Vi,{to:`/activity/${F.activity_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:m.jsxs("div",{className:"flex items-start gap-4",children:[((B=F.activity)==null?void 0:B.image_url)&&m.jsx("img",{src:F.activity.image_url,alt:String(k(F.activity,"title")),className:"w-24 h-24 rounded-lg object-cover flex-shrink-0"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-card-foreground mb-1",children:k(F.activity,"title")}),m.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:k(F.activity,"content")}}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[e("profile.joinedOn"),":"," ",_f(new Date(F.created_at),{addSuffix:!0})]})]}),m.jsx($l,{className:"w-5 h-5 text-primary flex-shrink-0"})]})},F.activity_id)})})]}):null,E?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):S&&S.length>0?m.jsxs("div",{children:[m.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[m.jsx(Qo,{className:"w-5 h-5"}),""]}),m.jsx("div",{className:"space-y-4",children:S.map(F=>{var B;return m.jsx(Vi,{to:`/activity/${F.activity_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:m.jsxs("div",{className:"flex items-start gap-4",children:[((B=F.activity)==null?void 0:B.image_url)&&m.jsx("img",{src:F.activity.image_url,alt:String(k(F.activity,"title")),className:"w-24 h-24 rounded-lg object-cover flex-shrink-0"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-semibold text-card-foreground mb-1",children:k(F.activity,"title")}),m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx(Qo,{className:"w-4 h-4 text-primary"}),m.jsx("span",{className:"text-sm font-medium text-primary",children:k(F,"restaurant_name")})]}),m.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:k(F.activity,"content")}}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[""," ",_f(new Date(F.created_at),{addSuffix:!0})]})]}),m.jsx($l,{className:"w-5 h-5 text-primary flex-shrink-0"})]})},`${F.activity_id}-${F.restaurant_id}`)})})]}):null,(!g||g.length===0)&&(!S||S.length===0)&&m.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[""," ",m.jsx(Vi,{to:"/activities",className:"text-primary hover:underline",children:""})]})]}):x?m.jsx("div",{className:"text-center py-8",children:e("common.loading")}):g&&g.length>0?m.jsx("div",{className:"space-y-4",children:g.map(F=>{var B;return m.jsx(Vi,{to:`/activity/${F.activity_id}`,className:"block p-4 rounded-lg border hover:shadow-medium transition-shadow",children:m.jsxs("div",{className:"flex items-start justify-between gap-4",children:[((B=F.activity)==null?void 0:B.image_url)&&m.jsx("img",{src:F.activity.image_url,alt:String(k(F.activity,"title")),className:"w-24 h-24 rounded-lg object-cover"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"font-semibold text-card-foreground mb-1",children:k(F.activity,"title")}),m.jsx("div",{className:"text-sm text-muted-foreground line-clamp-2 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:k(F.activity,"content")}}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[e("profile.joinedOn"),":"," ",_f(new Date(F.created_at),{addSuffix:!0})]})]}),m.jsx($l,{className:"w-5 h-5 text-primary"})]})},F.activity_id)})}):m.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[e("profile.noActivities")," ",m.jsx(Vi,{to:"/activities",className:"text-primary hover:underline",children:e("profile.upcomingEvents")})]})})]})})]})]})})},cOe=WPe,eae=G.createContext({}),hy=({...e})=>m.jsx(eae.Provider,{value:{name:e.name},children:m.jsx(bC,{...e})}),Bk=()=>{const e=G.useContext(eae),t=G.useContext(tae),{getFieldState:r,formState:n}=Dk(),o=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:l}=t;return{id:l,name:e.name,formItemId:`${l}-form-item`,formDescriptionId:`${l}-form-item-description`,formMessageId:`${l}-form-item-message`,...o}},tae=G.createContext({}),Hp=G.forwardRef(({className:e,...t},r)=>{const n=G.useId();return m.jsx(tae.Provider,{value:{id:n},children:m.jsx("div",{ref:r,className:_r("space-y-2",e),...t})})});Hp.displayName="FormItem";const Kp=G.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:o}=Bk();return m.jsx(Zr,{ref:r,className:_r(n&&"text-destructive",e),htmlFor:o,...t})});Kp.displayName="FormLabel";const wy=G.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:o,formMessageId:l}=Bk();return m.jsx(Sv,{ref:t,id:n,"aria-describedby":r?`${o} ${l}`:`${o}`,"aria-invalid":!!r,...e})});wy.displayName="FormControl";const rae=G.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=Bk();return m.jsx("p",{ref:r,id:n,className:_r("text-sm text-muted-foreground",e),...t})});rae.displayName="FormDescription";const Sy=G.forwardRef(({className:e,children:t,...r},n)=>{const{error:o,formMessageId:l}=Bk(),d=o?String(o==null?void 0:o.message):t;return d?m.jsx("p",{ref:n,id:l,className:_r("text-sm font-medium text-destructive",e),...r,children:d}):null});Sy.displayName="FormMessage";const nae=["booking","delivery","qrcode"],uOe=sm({name:pa().min(2,"Name must be at least 2 characters"),email:pa().email("Invalid email address"),phone:pa().min(6,"Phone must be at least 6 characters"),restaurant_name:pa().min(2,"Restaurant name must be at least 2 characters"),restaurant_address:pa().min(2,"Restaurant address must be at least 2 characters"),features_selected:SC(Iie(nae)).min(1,"Please select at least one feature")}),dOe=()=>{const{t:e}=Ki(),[t,r]=G.useState(!1),[n,o]=G.useState(!1),l=am({resolver:om(uOe),defaultValues:{name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[]}}),d=async i=>{r(!0);try{const{error:g}=await Ut.functions.invoke("send-join-request-email",{body:i});if(g){if(g.message.includes("rate_limit_exceeded"))Lc({title:e("joinUs.rateLimitError"),description:e("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw g;return}o(!0),l.reset(),Lc({title:e("joinUs.successTitle"),description:e("joinUs.successDescription")})}catch(g){console.error("Error submitting join request:",g),Lc({title:e("common.error"),description:e("joinUs.submitError"),variant:"destructive"})}finally{r(!1)}};return n?m.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4",children:m.jsx("div",{className:"container mx-auto max-w-2xl",children:m.jsx(Qr,{className:"border-primary",children:m.jsxs(dn,{className:"pt-12 pb-12 text-center",children:[m.jsx(Qge,{className:"w-16 h-16 text-primary mx-auto mb-4"}),m.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:e("joinUs.successTitle")}),m.jsx("p",{className:"text-lg font-semibold text-foreground mb-2",children:e("joinUs.successDescription")}),m.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:e("joinUs.successMessage")}),m.jsx(lr,{onClick:()=>o(!1),children:e("joinUs.submitAnother")})]})})})}):m.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-gradient-subtle",children:m.jsx("div",{className:"container mx-auto max-w-3xl",children:m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"text-center space-y-2",children:[m.jsx("div",{className:"flex justify-center mb-4",children:m.jsx(Qo,{className:"w-12 h-12 text-primary"})}),m.jsx(Ji,{className:"text-3xl font-bold",children:e("joinUs.title")}),m.jsx(Do,{className:"text-base",children:e("joinUs.description")})]}),m.jsx(dn,{children:m.jsx(cOe,{...l,children:m.jsxs("form",{onSubmit:l.handleSubmit(d),className:"space-y-6",children:[m.jsx(hy,{control:l.control,name:"name",render:({field:i})=>m.jsxs(Hp,{children:[m.jsx(Kp,{children:e("joinUs.name")}),m.jsx(wy,{children:m.jsx(an,{placeholder:e("joinUs.namePlaceholder"),...i})}),m.jsx(Sy,{})]})}),m.jsx(hy,{control:l.control,name:"email",render:({field:i})=>m.jsxs(Hp,{children:[m.jsx(Kp,{children:e("joinUs.email")}),m.jsx(wy,{children:m.jsx(an,{type:"email",placeholder:e("joinUs.emailPlaceholder"),...i})}),m.jsx(Sy,{})]})}),m.jsx(hy,{control:l.control,name:"phone",render:({field:i})=>m.jsxs(Hp,{children:[m.jsx(Kp,{children:e("joinUs.phone")}),m.jsx(wy,{children:m.jsx(an,{type:"tel",placeholder:e("joinUs.phonePlaceholder"),...i})}),m.jsx(Sy,{})]})}),m.jsx(hy,{control:l.control,name:"restaurant_name",render:({field:i})=>m.jsxs(Hp,{children:[m.jsx(Kp,{children:e("joinUs.restaurantName")}),m.jsx(wy,{children:m.jsx(an,{placeholder:e("joinUs.restaurantNamePlaceholder"),...i})}),m.jsx(Sy,{})]})}),m.jsx(hy,{control:l.control,name:"restaurant_address",render:({field:i})=>m.jsxs(Hp,{children:[m.jsx(Kp,{children:e("joinUs.restaurantAddress")}),m.jsx(wy,{children:m.jsx(an,{placeholder:e("joinUs.restaurantAddressPlaceholder"),...i})}),m.jsx(Sy,{})]})}),m.jsx(hy,{control:l.control,name:"features_selected",render:()=>m.jsxs(Hp,{children:[m.jsxs("div",{className:"mb-4",children:[m.jsx(Kp,{children:e("joinUs.featuresNeeded")}),m.jsx(rae,{children:e("joinUs.featuresDescription")})]}),nae.map(i=>m.jsx(hy,{control:l.control,name:"features_selected",render:({field:g})=>{var x;return m.jsxs(Hp,{className:"flex flex-row items-start space-x-3 space-y-0",children:[m.jsx(wy,{children:m.jsx(Gs,{checked:(x=g.value)==null?void 0:x.includes(i),onCheckedChange:S=>{var E;return S?g.onChange([...g.value,i]):g.onChange((E=g.value)==null?void 0:E.filter(A=>A!==i))}})}),m.jsx(Kp,{className:"font-normal cursor-pointer",children:e(`joinUs.feature.${i}`)})]},i)}},i)),m.jsx(Sy,{})]})}),m.jsx("div",{className:"text-xs text-muted-foreground text-center pb-4",children:e("joinUs.consentText")}),m.jsxs(lr,{type:"submit",className:"w-full",size:"lg",disabled:t,children:[t&&m.jsx(Ws,{className:"mr-2 h-4 w-4 animate-spin"}),e("joinUs.submit")]})]})})})]})})})},hOe=()=>{const e=Uf();return G.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),m.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:m.jsxs("div",{className:"text-center",children:[m.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),m.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),m.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},WT=async e=>{const{data:t}=await Ut.from("user_roles").select("role").eq("user_id",e).single();return t==null?void 0:t.role},fOe=()=>{const{user:e}=Di();return Wi({queryKey:["admin-users",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await Ut.from("profiles").select("*").order("created_at",{ascending:!1});if(r)throw r;const n=await Promise.all((t||[]).map(async l=>{const{data:d}=await Ut.from("user_roles").select("role").eq("user_id",l.id).single();return{...l,role:(d==null?void 0:d.role)||"user"}})),{data:o}=await Ut.from("user_roles").select("role").eq("user_id",e.id).single();if((o==null?void 0:o.role)==="supervisor"){const{data:l,error:d}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(d)throw d;if(!l||l.length===0)return[];const i=l.map(N=>N.restaurant_id),{data:g,error:x}=await Ut.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",i);if(x)throw x;if(!g||g.length===0)return[];const S=[...new Set(g.map(N=>N.user_id).filter(N=>N!==e.id))];if(S.length===0)return[];const{data:E,error:A}=await Ut.from("user_roles").select("user_id").in("user_id",S).eq("role","merchant");if(A)throw A;const C=(E==null?void 0:E.map(N=>N.user_id))||[];return n.filter(N=>C.includes(N.id))}return n}})},pOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async({userId:r,role:n})=>{const{error:o}=await Ut.from("user_roles").upsert({user_id:r,role:n},{onConflict:"user_id"});if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),t.invalidateQueries({queryKey:["user-roles"]}),e({title:"Success",description:"Role changed successfully"})},onError:r=>{console.error("Role change error:",r),e({title:"Error",description:r.message||"Failed to change role",variant:"destructive"})}})},mOe=()=>{const{user:e}=Di();return Wi({queryKey:["admin-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];if(await WT(e.id)==="supervisor"){const{data:n,error:o}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);if(o)throw o;const l=(n==null?void 0:n.map(g=>g.restaurant_id))||[];if(l.length===0)return[];const{data:d,error:i}=await Ut.from("restaurants").select("*").in("id",l).order("rating",{ascending:!1});if(i)throw i;return d||[]}else{const{data:n,error:o}=await Ut.from("restaurants").select("*").order("rating",{ascending:!1});if(o)throw o;return n||[]}},enabled:!!e})},gOe=()=>Wi({queryKey:["operation-logs"],queryFn:async()=>{const{data:e,error:t}=await Ut.from("operation_logs").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const{data:o}=await Ut.from("profiles").select("display_name").eq("id",n.user_id).single();return{...n,user_name:(o==null?void 0:o.display_name)||"Unknown User"}}))}}),yOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async({userId:r,display_name:n,phone:o,avatar_url:l})=>{const{data:d,error:i}=await Ut.from("profiles").update({display_name:n,phone:o,avatar_url:l}).eq("id",r).select().single();if(i)throw i;return d},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:"Success",description:""})},onError:()=>{e({title:"Error",description:"",variant:"destructive"})}})},vOe=()=>{const{toast:e}=wa();return Xa({mutationFn:async({file:t,userId:r})=>{const n=t.name.split(".").pop(),o=`${Date.now()}.${n}`,l=`${r}/${o}`,{error:d}=await Ut.storage.from("avatars").upload(l,t,{upsert:!0});if(d)throw d;const{data:{publicUrl:i}}=Ut.storage.from("avatars").getPublicUrl(l);return i},onError:()=>{e({title:"Error",description:"",variant:"destructive"})}})},_Oe=()=>{const{user:e}=Di();return Wi({queryKey:["admin-stats",e==null?void 0:e.id],queryFn:async()=>{if(!e)return{totalUsers:0,totalRestaurants:0,totalActivities:0,totalComments:0};if(await WT(e.id)==="supervisor"){const{data:i}=await Ut.from("merchant_restaurants").select("restaurant_id, user_id").eq("user_id",e.id),g=(i==null?void 0:i.map(C=>C.restaurant_id))||[],S=(Array.from(new Set(i==null?void 0:i.map(C=>C.user_id)))||[]).length,E=g.length;let A=0;if(g.length>0){const{count:C}=await Ut.from("comments").select("*",{count:"exact",head:!0}).eq("target_type","restaurant").in("target_id",g);A=C||0}return{totalUsers:S,totalRestaurants:E,totalActivities:0,totalComments:A}}const[n,o,l,d]=await Promise.all([Ut.from("profiles").select("*",{count:"exact",head:!0}),Ut.from("restaurants").select("*",{count:"exact",head:!0}),Ut.from("activities").select("*",{count:"exact",head:!0}),Ut.from("comments").select("*",{count:"exact",head:!0})]);return{totalUsers:n.count||0,totalRestaurants:o.count||0,totalActivities:l.count||0,totalComments:d.count||0}}})},xOe=()=>{const{user:e}=Di();return Wi({queryKey:["top-restaurants",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await WT(e.id)==="supervisor";let n=Ut.from("restaurants").select("id, name, rating").order("rating",{ascending:!1,nullsFirst:!1}).limit(10);if(r){const{data:i}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id),g=(i==null?void 0:i.map(x=>x.restaurant_id))||[];if(g.length===0)return[];n=Ut.from("restaurants").select("id, name, rating").in("id",g).order("rating",{ascending:!1,nullsFirst:!1}).limit(10)}const{data:o,error:l}=await n;if(l)throw l;return await Promise.all((o||[]).map(async i=>{const{count:g}=await Ut.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",i.id).eq("target_type","restaurant");return{name:i.name,rating:i.rating||0,comments:g||0}}))}})},bOe=()=>{const{user:e}=Di();return Wi({queryKey:["restaurant-rating-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await WT(e.id)==="supervisor";let n=[],o={};if(r){const{data:x}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(x==null?void 0:x.map(S=>S.restaurant_id))||[]}else{const{data:x}=await Ut.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(x==null?void 0:x.map(S=>S.id))||[],x==null||x.forEach(S=>{o[S.id]=S.name})}if(n.length===0)return[];const{data:l}=await Ut.from("comments").select("target_id, rating_value, created_at").eq("target_type","restaurant").in("target_id",n).not("rating_value","is",null).order("created_at",{ascending:!0});if(!l||l.length===0)return[];if(Object.keys(o).length===0){const{data:x}=await Ut.from("restaurants").select("id, name").in("id",n);x==null||x.forEach(S=>{o[S.id]=S.name})}const d={};l.forEach(x=>{const S=new Date(x.created_at),E=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[x.target_id]||(d[x.target_id]={}),d[x.target_id][E]||(d[x.target_id][E]={sum:0,count:0}),d[x.target_id][E].sum+=x.rating_value,d[x.target_id][E].count+=1});const i=new Set;return Object.values(d).forEach(x=>{Object.keys(x).forEach(S=>i.add(S))}),Array.from(i).sort().map(x=>{const S={month:x};return Object.keys(d).forEach(E=>{const A=d[E][x],C=A?(A.sum/A.count).toFixed(1):null;S[o[E]||E]=C}),S})}})},wOe=()=>{const{user:e}=Di();return Wi({queryKey:["restaurant-comment-trends",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const r=await WT(e.id)==="supervisor";let n=[],o={};if(r){const{data:x}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e.id);n=(x==null?void 0:x.map(S=>S.restaurant_id))||[]}else{const{data:x}=await Ut.from("restaurants").select("id, name").order("rating",{ascending:!1,nullsFirst:!1}).limit(5);n=(x==null?void 0:x.map(S=>S.id))||[],x==null||x.forEach(S=>{o[S.id]=S.name})}if(n.length===0)return[];const{data:l}=await Ut.from("comments").select("target_id, created_at").eq("target_type","restaurant").in("target_id",n).order("created_at",{ascending:!0});if(!l||l.length===0)return[];if(Object.keys(o).length===0){const{data:x}=await Ut.from("restaurants").select("id, name").in("id",n);x==null||x.forEach(S=>{o[S.id]=S.name})}const d={};l.forEach(x=>{const S=new Date(x.created_at),E=`${S.getFullYear()}-${String(S.getMonth()+1).padStart(2,"0")}`;d[x.target_id]||(d[x.target_id]={}),d[x.target_id][E]=(d[x.target_id][E]||0)+1});const i=new Set;return Object.values(d).forEach(x=>{Object.keys(x).forEach(S=>i.add(S))}),Array.from(i).sort().map(x=>{const S={month:x};return Object.keys(d).forEach(E=>{const A=d[E][x]||0;S[o[E]||E]=A}),S})}})},SOe=()=>Wi({queryKey:["activity-engagement"],queryFn:async()=>{const{data:e,error:t}=await Ut.from("activities").select("id, title_en").order("created_at",{ascending:!1}).limit(10);if(t)throw t;return await Promise.all((e||[]).map(async n=>{const[o,l]=await Promise.all([Ut.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",n.id),Ut.from("comments").select("*",{count:"exact",head:!0}).eq("target_id",n.id).eq("target_type","activity")]);return{name:n.title_en,subscribers:o.count||0,comments:l.count||0}}))}}),EOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{await Ut.from("activity_restaurants").delete().eq("activity_id",r);const{error:n}=await Ut.from("activities").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:"Success",description:"Activity deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete activity",variant:"destructive"})}})},TOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{const{error:n}=await Ut.from("restaurants").delete().eq("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:"Success",description:"Restaurant deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete restaurant",variant:"destructive"})}})},AOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{const n=r.map(async o=>{const{error:l}=await Ut.functions.invoke("delete-account",{body:{userId:o}});if(l)throw l});await Promise.all(n)},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:"Success",description:"Users deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete users",variant:"destructive"})}})},POe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{const{error:n}=await Ut.from("restaurants").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurants"]}),e({title:"Success",description:"Restaurants deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete restaurants",variant:"destructive"})}})},COe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async r=>{await Ut.from("activity_restaurants").delete().in("activity_id",r);const{error:n}=await Ut.from("activities").delete().in("id",r);if(n)throw n},onSuccess:()=>{t.invalidateQueries({queryKey:["activities"]}),e({title:"Success",description:"Activities deleted successfully"})},onError:()=>{e({title:"Error",description:"Failed to delete activities",variant:"destructive"})}})},OOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async({userIds:r,role:n})=>{const o=r.map(d=>({user_id:d,role:n})),{error:l}=await Ut.from("user_roles").upsert(o,{onConflict:"user_id"});if(l)throw l},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-users"]}),e({title:"Success",description:"Roles changed successfully"})},onError:r=>{console.error("Batch role change error:",r),e({title:"Error",description:r.message||"Failed to change roles",variant:"destructive"})}})},IOe=()=>{const{toast:e}=wa(),t=Na();return Xa({mutationFn:async({restaurantId:r,visible:n})=>{const{error:o}=await Ut.from("restaurants").update({visible:n}).eq("id",r);if(o)throw o},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-restaurants"]}),t.invalidateQueries({queryKey:["restaurants"]}),e({title:"",description:""})},onError:()=>{e({title:"",description:"",variant:"destructive"})}})},GM=768;function kOe(){const[e,t]=G.useState(void 0);return G.useEffect(()=>{const r=window.matchMedia(`(max-width: ${GM-1}px)`),n=()=>{t(window.innerWidth<GM)};return r.addEventListener("change",n),t(window.innerWidth<GM),()=>r.removeEventListener("change",n)},[]),!!e}function I9({className:e,...t}){return m.jsx("div",{className:_r("animate-pulse rounded-md bg-muted",e),...t})}const ROe="sidebar:state",jOe=60*60*24*7,NOe="16rem",MOe="18rem",DOe="3rem",LOe="b",iae=G.createContext(null);function GT(){const e=G.useContext(iae);if(!e)throw new Error("useSidebar must be used within a SidebarProvider.");return e}const aae=G.forwardRef(({defaultOpen:e=!0,open:t,onOpenChange:r,className:n,style:o,children:l,...d},i)=>{const g=kOe(),[x,S]=G.useState(!1),[E,A]=G.useState(e),C=t??E,N=G.useCallback(j=>{const F=typeof j=="function"?j(C):j;r?r(F):A(F),document.cookie=`${ROe}=${F}; path=/; max-age=${jOe}`},[r,C]),k=G.useCallback(()=>g?S(j=>!j):N(j=>!j),[g,N,S]);G.useEffect(()=>{const j=F=>{F.key===LOe&&(F.metaKey||F.ctrlKey)&&(F.preventDefault(),k())};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[k]);const R=C?"expanded":"collapsed",L=G.useMemo(()=>({state:R,open:C,setOpen:N,isMobile:g,openMobile:x,setOpenMobile:S,toggleSidebar:k}),[R,C,N,g,x,S,k]);return m.jsx(iae.Provider,{value:L,children:m.jsx(zJ,{delayDuration:0,children:m.jsx("div",{style:{"--sidebar-width":NOe,"--sidebar-width-icon":DOe,...o},className:_r("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar",n),ref:i,...d,children:l})})})});aae.displayName="SidebarProvider";const oae=G.forwardRef(({side:e="left",variant:t="sidebar",collapsible:r="offcanvas",className:n,children:o,...l},d)=>{const{isMobile:i,state:g,openMobile:x,setOpenMobile:S}=GT();return r==="none"?m.jsx("div",{className:_r("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground",n),ref:d,...l,children:o}):i?m.jsx(Jee,{open:x,onOpenChange:S,...l,children:m.jsx(KB,{"data-sidebar":"sidebar","data-mobile":"true",className:"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden",style:{"--sidebar-width":MOe},side:e,children:m.jsx("div",{className:"flex h-full w-full flex-col",children:o})})}):m.jsxs("div",{ref:d,className:"group peer hidden text-sidebar-foreground md:block","data-state":g,"data-collapsible":g==="collapsed"?r:"","data-variant":t,"data-side":e,children:[m.jsx("div",{className:_r("relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear","group-data-[collapsible=offcanvas]:w-0","group-data-[side=right]:rotate-180",t==="floating"||t==="inset"?"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon]")}),m.jsx("div",{className:_r("fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",e==="left"?"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]":"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",t==="floating"||t==="inset"?"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]":"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",n),...l,children:m.jsx("div",{"data-sidebar":"sidebar",className:"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow",children:o})})]})});oae.displayName="Sidebar";const sae=G.forwardRef(({className:e,onClick:t,...r},n)=>{const{toggleSidebar:o}=GT();return m.jsxs(lr,{ref:n,"data-sidebar":"trigger",variant:"ghost",size:"icon",className:_r("h-7 w-7",e),onClick:l=>{t==null||t(l),o()},...r,children:[m.jsx(lye,{}),m.jsx("span",{className:"sr-only",children:"Toggle Sidebar"})]})});sae.displayName="SidebarTrigger";const FOe=G.forwardRef(({className:e,...t},r)=>{const{toggleSidebar:n}=GT();return m.jsx("button",{ref:r,"data-sidebar":"rail","aria-label":"Toggle Sidebar",tabIndex:-1,onClick:n,title:"Toggle Sidebar",className:_r("absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex","[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize","[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize","group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar","[[data-side=left][data-collapsible=offcanvas]_&]:-right-2","[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",e),...t})});FOe.displayName="SidebarRail";const zOe=G.forwardRef(({className:e,...t},r)=>m.jsx("main",{ref:r,className:_r("relative flex min-h-svh flex-1 flex-col bg-background","peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",e),...t}));zOe.displayName="SidebarInset";const BOe=G.forwardRef(({className:e,...t},r)=>m.jsx(an,{ref:r,"data-sidebar":"input",className:_r("h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",e),...t}));BOe.displayName="SidebarInput";const $Oe=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"header",className:_r("flex flex-col gap-2 p-2",e),...t}));$Oe.displayName="SidebarHeader";const UOe=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"footer",className:_r("flex flex-col gap-2 p-2",e),...t}));UOe.displayName="SidebarFooter";const VOe=G.forwardRef(({className:e,...t},r)=>m.jsx(vu,{ref:r,"data-sidebar":"separator",className:_r("mx-2 w-auto bg-sidebar-border",e),...t}));VOe.displayName="SidebarSeparator";const lae=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"content",className:_r("flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",e),...t}));lae.displayName="SidebarContent";const cae=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"group",className:_r("relative flex w-full min-w-0 flex-col p-2",e),...t}));cae.displayName="SidebarGroup";const uae=G.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const o=t?Sv:"div";return m.jsx(o,{ref:n,"data-sidebar":"group-label",className:_r("flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",e),...r})});uae.displayName="SidebarGroupLabel";const qOe=G.forwardRef(({className:e,asChild:t=!1,...r},n)=>{const o=t?Sv:"button";return m.jsx(o,{ref:n,"data-sidebar":"group-action",className:_r("absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","group-data-[collapsible=icon]:hidden",e),...r})});qOe.displayName="SidebarGroupAction";const dae=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"group-content",className:_r("w-full text-sm",e),...t}));dae.displayName="SidebarGroupContent";const hae=G.forwardRef(({className:e,...t},r)=>m.jsx("ul",{ref:r,"data-sidebar":"menu",className:_r("flex w-full min-w-0 flex-col gap-1",e),...t}));hae.displayName="SidebarMenu";const fae=G.forwardRef(({className:e,...t},r)=>m.jsx("li",{ref:r,"data-sidebar":"menu-item",className:_r("group/menu-item relative",e),...t}));fae.displayName="SidebarMenuItem";const WOe=xb("peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",{variants:{variant:{default:"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",outline:"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]"},size:{default:"h-8 text-sm",sm:"h-7 text-xs",lg:"h-12 text-sm group-data-[collapsible=icon]:!p-0"}},defaultVariants:{variant:"default",size:"default"}}),pae=G.forwardRef(({asChild:e=!1,isActive:t=!1,variant:r="default",size:n="default",tooltip:o,className:l,...d},i)=>{const g=e?Sv:"button",{isMobile:x,state:S}=GT(),E=m.jsx(g,{ref:i,"data-sidebar":"menu-button","data-size":n,"data-active":t,className:_r(WOe({variant:r,size:n}),l),...d});return o?(typeof o=="string"&&(o={children:o}),m.jsxs(fxe,{children:[m.jsx(pxe,{asChild:!0,children:E}),m.jsx(BJ,{side:"right",align:"center",hidden:S!=="collapsed"||x,...o})]})):E});pae.displayName="SidebarMenuButton";const GOe=G.forwardRef(({className:e,asChild:t=!1,showOnHover:r=!1,...n},o)=>{const l=t?Sv:"button";return m.jsx(l,{ref:o,"data-sidebar":"menu-action",className:_r("absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0","after:absolute after:-inset-2 after:md:hidden","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",r&&"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",e),...n})});GOe.displayName="SidebarMenuAction";const HOe=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{ref:r,"data-sidebar":"menu-badge",className:_r("pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground","peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground","peer-data-[size=sm]/menu-button:top-1","peer-data-[size=default]/menu-button:top-1.5","peer-data-[size=lg]/menu-button:top-2.5","group-data-[collapsible=icon]:hidden",e),...t}));HOe.displayName="SidebarMenuBadge";const KOe=G.forwardRef(({className:e,showIcon:t=!1,...r},n)=>{const o=G.useMemo(()=>`${Math.floor(Math.random()*40)+50}%`,[]);return m.jsxs("div",{ref:n,"data-sidebar":"menu-skeleton",className:_r("flex h-8 items-center gap-2 rounded-md px-2",e),...r,children:[t&&m.jsx(I9,{className:"size-4 rounded-md","data-sidebar":"menu-skeleton-icon"}),m.jsx(I9,{className:"h-4 max-w-[--skeleton-width] flex-1","data-sidebar":"menu-skeleton-text",style:{"--skeleton-width":o}})]})});KOe.displayName="SidebarMenuSkeleton";const ZOe=G.forwardRef(({className:e,...t},r)=>m.jsx("ul",{ref:r,"data-sidebar":"menu-sub",className:_r("mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5","group-data-[collapsible=icon]:hidden",e),...t}));ZOe.displayName="SidebarMenuSub";const XOe=G.forwardRef(({...e},t)=>m.jsx("li",{ref:t,...e}));XOe.displayName="SidebarMenuSubItem";const YOe=G.forwardRef(({asChild:e=!1,size:t="md",isActive:r,className:n,...o},l)=>{const d=e?Sv:"a";return m.jsx(d,{ref:l,"data-sidebar":"menu-sub-button","data-size":t,"data-active":r,className:_r("flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground","data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",t==="sm"&&"text-xs",t==="md"&&"text-sm","group-data-[collapsible=icon]:hidden",n),...o})});YOe.displayName="SidebarMenuSubButton";const JOe=()=>{const{t:e}=Ki(),{state:t}=GT(),{isAdmin:r}=Tc(),o=Uf().pathname,d=[{title:e("admin.dashboard"),url:"/admin",icon:iye,allowedRoles:["admin","supervisor"]},{title:e("admin.users"),url:"/admin/users",icon:yu,allowedRoles:["admin","supervisor"]},{title:e("admin.restaurants"),url:"/admin/restaurants",icon:QY,allowedRoles:["admin","supervisor"]},{title:e("admin.activities"),url:"/admin/activities",icon:$l,allowedRoles:["admin"]},{title:e("admin.reports"),url:"/admin/reports",icon:cC,allowedRoles:["admin"]},{title:e("joinUs.adminTitle"),url:"/admin/join-requests",icon:Qo,allowedRoles:["admin"]},{title:e("admin.logs"),url:"/admin/logs",icon:nye,allowedRoles:["admin"]}].filter(g=>r||g.allowedRoles.includes("supervisor")),i=g=>g==="/admin"?o===g:o.startsWith(g);return m.jsx(oae,{className:t==="collapsed"?"w-14":"w-60",children:m.jsx(lae,{children:m.jsxs(cae,{children:[m.jsx(uae,{className:t==="collapsed"?"text-center":"",children:t==="collapsed"?m.jsx(XY,{className:"h-4 w-4"}):e("admin.management")}),m.jsx(dae,{children:m.jsx(hae,{className:"mt-[30px]",children:d.map(g=>m.jsx(fae,{children:m.jsx(pae,{asChild:!0,isActive:i(g.url),children:m.jsxs(Vi,{to:g.url,children:[m.jsx(g.icon,{className:"h-4 w-4"}),t!=="collapsed"&&m.jsx("span",{children:g.title})]})})},g.url))})})]})})})},Qc=({children:e})=>{const{t}=Ki(),{user:r}=Di(),{isAdmin:n,isSupervisor:o,isLoading:l}=Tc();return l?m.jsx("div",{className:"min-h-screen flex items-center justify-center",children:m.jsx("div",{className:"text-center",children:t("common.loading")})}):!r||!n&&!o?m.jsx(N0e,{to:"/",replace:!0}):m.jsx(aae,{children:m.jsxs("div",{className:"min-h-screen flex flex-col w-full",children:[m.jsx("header",{className:"h-14 flex items-center border-b bg-background px-4 sticky top-0 z-10",children:m.jsx(sae,{})}),m.jsxs("div",{className:"flex flex-1 w-full",children:[m.jsx(JOe,{}),m.jsx("main",{className:"flex-1 p-3 md:p-6 bg-secondary/20 overflow-x-hidden",children:m.jsx("div",{className:"max-w-full overflow-x-hidden",children:e})})]})]})})};var QOe=Array.isArray,Ac=QOe,eIe=typeof mc=="object"&&mc&&mc.Object===Object&&mc,mae=eIe,tIe=mae,rIe=typeof self=="object"&&self&&self.Object===Object&&self,nIe=tIe||rIe||Function("return this")(),jh=nIe,iIe=jh,aIe=iIe.Symbol,HT=aIe,k9=HT,gae=Object.prototype,oIe=gae.hasOwnProperty,sIe=gae.toString,dS=k9?k9.toStringTag:void 0;function lIe(e){var t=oIe.call(e,dS),r=e[dS];try{e[dS]=void 0;var n=!0}catch{}var o=sIe.call(e);return n&&(t?e[dS]=r:delete e[dS]),o}var cIe=lIe,uIe=Object.prototype,dIe=uIe.toString;function hIe(e){return dIe.call(e)}var fIe=hIe,R9=HT,pIe=cIe,mIe=fIe,gIe="[object Null]",yIe="[object Undefined]",j9=R9?R9.toStringTag:void 0;function vIe(e){return e==null?e===void 0?yIe:gIe:j9&&j9 in Object(e)?pIe(e):mIe(e)}var Gf=vIe;function _Ie(e){return e!=null&&typeof e=="object"}var Hf=_Ie,xIe=Gf,bIe=Hf,wIe="[object Symbol]";function SIe(e){return typeof e=="symbol"||bIe(e)&&xIe(e)==wIe}var Rb=SIe,EIe=Ac,TIe=Rb,AIe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,PIe=/^\w*$/;function CIe(e,t){if(EIe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||TIe(e)?!0:PIe.test(e)||!AIe.test(e)||t!=null&&e in Object(t)}var L4=CIe;function OIe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var og=OIe;const jb=va(og);var IIe=Gf,kIe=og,RIe="[object AsyncFunction]",jIe="[object Function]",NIe="[object GeneratorFunction]",MIe="[object Proxy]";function DIe(e){if(!kIe(e))return!1;var t=IIe(e);return t==jIe||t==NIe||t==RIe||t==MIe}var F4=DIe;const si=va(F4);var LIe=jh,FIe=LIe["__core-js_shared__"],zIe=FIe,HM=zIe,N9=function(){var e=/[^.]+$/.exec(HM&&HM.keys&&HM.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function BIe(e){return!!N9&&N9 in e}var $Ie=BIe,UIe=Function.prototype,VIe=UIe.toString;function qIe(e){if(e!=null){try{return VIe.call(e)}catch{}try{return e+""}catch{}}return""}var yae=qIe,WIe=F4,GIe=$Ie,HIe=og,KIe=yae,ZIe=/[\\^$.*+?()[\]{}|]/g,XIe=/^\[object .+?Constructor\]$/,YIe=Function.prototype,JIe=Object.prototype,QIe=YIe.toString,eke=JIe.hasOwnProperty,tke=RegExp("^"+QIe.call(eke).replace(ZIe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rke(e){if(!HIe(e)||GIe(e))return!1;var t=WIe(e)?tke:XIe;return t.test(KIe(e))}var nke=rke;function ike(e,t){return e==null?void 0:e[t]}var ake=ike,oke=nke,ske=ake;function lke(e,t){var r=ske(e,t);return oke(r)?r:void 0}var kv=lke,cke=kv,uke=cke(Object,"create"),$k=uke,M9=$k;function dke(){this.__data__=M9?M9(null):{},this.size=0}var hke=dke;function fke(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var pke=fke,mke=$k,gke="__lodash_hash_undefined__",yke=Object.prototype,vke=yke.hasOwnProperty;function _ke(e){var t=this.__data__;if(mke){var r=t[e];return r===gke?void 0:r}return vke.call(t,e)?t[e]:void 0}var xke=_ke,bke=$k,wke=Object.prototype,Ske=wke.hasOwnProperty;function Eke(e){var t=this.__data__;return bke?t[e]!==void 0:Ske.call(t,e)}var Tke=Eke,Ake=$k,Pke="__lodash_hash_undefined__";function Cke(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Ake&&t===void 0?Pke:t,this}var Oke=Cke,Ike=hke,kke=pke,Rke=xke,jke=Tke,Nke=Oke;function Nb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Nb.prototype.clear=Ike;Nb.prototype.delete=kke;Nb.prototype.get=Rke;Nb.prototype.has=jke;Nb.prototype.set=Nke;var Mke=Nb;function Dke(){this.__data__=[],this.size=0}var Lke=Dke;function Fke(e,t){return e===t||e!==e&&t!==t}var z4=Fke,zke=z4;function Bke(e,t){for(var r=e.length;r--;)if(zke(e[r][0],t))return r;return-1}var Uk=Bke,$ke=Uk,Uke=Array.prototype,Vke=Uke.splice;function qke(e){var t=this.__data__,r=$ke(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():Vke.call(t,r,1),--this.size,!0}var Wke=qke,Gke=Uk;function Hke(e){var t=this.__data__,r=Gke(t,e);return r<0?void 0:t[r][1]}var Kke=Hke,Zke=Uk;function Xke(e){return Zke(this.__data__,e)>-1}var Yke=Xke,Jke=Uk;function Qke(e,t){var r=this.__data__,n=Jke(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var eRe=Qke,tRe=Lke,rRe=Wke,nRe=Kke,iRe=Yke,aRe=eRe;function Mb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Mb.prototype.clear=tRe;Mb.prototype.delete=rRe;Mb.prototype.get=nRe;Mb.prototype.has=iRe;Mb.prototype.set=aRe;var Vk=Mb,oRe=kv,sRe=jh,lRe=oRe(sRe,"Map"),B4=lRe,D9=Mke,cRe=Vk,uRe=B4;function dRe(){this.size=0,this.__data__={hash:new D9,map:new(uRe||cRe),string:new D9}}var hRe=dRe;function fRe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var pRe=fRe,mRe=pRe;function gRe(e,t){var r=e.__data__;return mRe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var qk=gRe,yRe=qk;function vRe(e){var t=yRe(this,e).delete(e);return this.size-=t?1:0,t}var _Re=vRe,xRe=qk;function bRe(e){return xRe(this,e).get(e)}var wRe=bRe,SRe=qk;function ERe(e){return SRe(this,e).has(e)}var TRe=ERe,ARe=qk;function PRe(e,t){var r=ARe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var CRe=PRe,ORe=hRe,IRe=_Re,kRe=wRe,RRe=TRe,jRe=CRe;function Db(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Db.prototype.clear=ORe;Db.prototype.delete=IRe;Db.prototype.get=kRe;Db.prototype.has=RRe;Db.prototype.set=jRe;var $4=Db,vae=$4,NRe="Expected a function";function U4(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(NRe);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],l=r.cache;if(l.has(o))return l.get(o);var d=e.apply(this,n);return r.cache=l.set(o,d)||l,d};return r.cache=new(U4.Cache||vae),r}U4.Cache=vae;var _ae=U4;const MRe=va(_ae);var DRe=_ae,LRe=500;function FRe(e){var t=DRe(e,function(n){return r.size===LRe&&r.clear(),n}),r=t.cache;return t}var zRe=FRe,BRe=zRe,$Re=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,URe=/\\(\\)?/g,VRe=BRe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace($Re,function(r,n,o,l){t.push(o?l.replace(URe,"$1"):n||r)}),t}),qRe=VRe;function WRe(e,t){for(var r=-1,n=e==null?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}var V4=WRe,L9=HT,GRe=V4,HRe=Ac,KRe=Rb,ZRe=1/0,F9=L9?L9.prototype:void 0,z9=F9?F9.toString:void 0;function xae(e){if(typeof e=="string")return e;if(HRe(e))return GRe(e,xae)+"";if(KRe(e))return z9?z9.call(e):"";var t=e+"";return t=="0"&&1/e==-ZRe?"-0":t}var XRe=xae,YRe=XRe;function JRe(e){return e==null?"":YRe(e)}var bae=JRe,QRe=Ac,eje=L4,tje=qRe,rje=bae;function nje(e,t){return QRe(e)?e:eje(e,t)?[e]:tje(rje(e))}var wae=nje,ije=Rb,aje=1/0;function oje(e){if(typeof e=="string"||ije(e))return e;var t=e+"";return t=="0"&&1/e==-aje?"-0":t}var Wk=oje,sje=wae,lje=Wk;function cje(e,t){t=sje(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[lje(t[r++])];return r&&r==n?e:void 0}var q4=cje,uje=q4;function dje(e,t,r){var n=e==null?void 0:uje(e,t);return n===void 0?r:n}var Sae=dje;const Zc=va(Sae);function hje(e){return e==null}var fje=hje;const bi=va(fje);var pje=Gf,mje=Ac,gje=Hf,yje="[object String]";function vje(e){return typeof e=="string"||!mje(e)&&gje(e)&&pje(e)==yje}var _je=vje;const mv=va(_je);var Eae={exports:{}},Ma={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W4=Symbol.for("react.element"),G4=Symbol.for("react.portal"),Gk=Symbol.for("react.fragment"),Hk=Symbol.for("react.strict_mode"),Kk=Symbol.for("react.profiler"),Zk=Symbol.for("react.provider"),Xk=Symbol.for("react.context"),xje=Symbol.for("react.server_context"),Yk=Symbol.for("react.forward_ref"),Jk=Symbol.for("react.suspense"),Qk=Symbol.for("react.suspense_list"),eR=Symbol.for("react.memo"),tR=Symbol.for("react.lazy"),bje=Symbol.for("react.offscreen"),Tae;Tae=Symbol.for("react.module.reference");function Lu(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case W4:switch(e=e.type,e){case Gk:case Kk:case Hk:case Jk:case Qk:return e;default:switch(e=e&&e.$$typeof,e){case xje:case Xk:case Yk:case tR:case eR:case Zk:return e;default:return t}}case G4:return t}}}Ma.ContextConsumer=Xk;Ma.ContextProvider=Zk;Ma.Element=W4;Ma.ForwardRef=Yk;Ma.Fragment=Gk;Ma.Lazy=tR;Ma.Memo=eR;Ma.Portal=G4;Ma.Profiler=Kk;Ma.StrictMode=Hk;Ma.Suspense=Jk;Ma.SuspenseList=Qk;Ma.isAsyncMode=function(){return!1};Ma.isConcurrentMode=function(){return!1};Ma.isContextConsumer=function(e){return Lu(e)===Xk};Ma.isContextProvider=function(e){return Lu(e)===Zk};Ma.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===W4};Ma.isForwardRef=function(e){return Lu(e)===Yk};Ma.isFragment=function(e){return Lu(e)===Gk};Ma.isLazy=function(e){return Lu(e)===tR};Ma.isMemo=function(e){return Lu(e)===eR};Ma.isPortal=function(e){return Lu(e)===G4};Ma.isProfiler=function(e){return Lu(e)===Kk};Ma.isStrictMode=function(e){return Lu(e)===Hk};Ma.isSuspense=function(e){return Lu(e)===Jk};Ma.isSuspenseList=function(e){return Lu(e)===Qk};Ma.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Gk||e===Kk||e===Hk||e===Jk||e===Qk||e===bje||typeof e=="object"&&e!==null&&(e.$$typeof===tR||e.$$typeof===eR||e.$$typeof===Zk||e.$$typeof===Xk||e.$$typeof===Yk||e.$$typeof===Tae||e.getModuleId!==void 0)};Ma.typeOf=Lu;Eae.exports=Ma;var wje=Eae.exports,Sje=Gf,Eje=Hf,Tje="[object Number]";function Aje(e){return typeof e=="number"||Eje(e)&&Sje(e)==Tje}var Aae=Aje;const Pje=va(Aae);var Cje=Aae;function Oje(e){return Cje(e)&&e!=+e}var Ije=Oje;const KT=va(Ije);var Ul=function(t){return t===0?0:t>0?1:-1},My=function(t){return mv(t)&&t.indexOf("%")===t.length-1},Fr=function(t){return Pje(t)&&!KT(t)},kje=function(t){return bi(t)},gs=function(t){return Fr(t)||mv(t)},Rje=0,Lb=function(t){var r=++Rje;return"".concat(t||"").concat(r)},Vl=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Fr(t)&&!mv(t))return n;var l;if(My(t)){var d=t.indexOf("%");l=r*parseFloat(t.slice(0,d))/100}else l=+t;return KT(l)&&(l=n),o&&l>r&&(l=r),l},lm=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},jje=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},o=0;o<r;o++)if(!n[t[o]])n[t[o]]=!0;else return!0;return!1},$c=function(t,r){return Fr(t)&&Fr(r)?function(n){return t+n*(r-t)}:function(){return r}};function kO(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):Zc(n,t))===r})}var Nje=function(t,r){return Fr(t)&&Fr(r)?t-r:mv(t)&&mv(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function o0(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function R3(e){"@babel/helpers - typeof";return R3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},R3(e)}var Mje=["viewBox","children"],Dje=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],B9=["points","pathLength"],KM={svg:Mje,polygon:B9,polyline:B9},H4=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],RO=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(G.isValidElement(t)&&(n=t.props),!jb(n))return null;var o={};return Object.keys(n).forEach(function(l){H4.includes(l)&&(o[l]=r||function(d){return n[l](n,d)})}),o},Lje=function(t,r,n){return function(o){return t(r,n,o),null}},gv=function(t,r,n){if(!jb(t)||R3(t)!=="object")return null;var o=null;return Object.keys(t).forEach(function(l){var d=t[l];H4.includes(l)&&typeof d=="function"&&(o||(o={}),o[l]=Lje(d,r,n))}),o},Fje=["children"],zje=["children"];function $9(e,t){if(e==null)return{};var r=Bje(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Bje(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function j3(e){"@babel/helpers - typeof";return j3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},j3(e)}var U9={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Af=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},V9=null,ZM=null,K4=function e(t){if(t===V9&&Array.isArray(ZM))return ZM;var r=[];return G.Children.forEach(t,function(n){bi(n)||(wje.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),ZM=r,V9=t,r};function Xc(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(o){return Af(o)}):n=[Af(t)],K4(e).forEach(function(o){var l=Zc(o,"type.displayName")||Zc(o,"type.name");n.indexOf(l)!==-1&&r.push(o)}),r}function Fc(e,t){var r=Xc(e,t);return r&&r[0]}var q9=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,o=r.height;return!(!Fr(n)||n<=0||!Fr(o)||o<=0)},$je=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],Uje=function(t){return t&&t.type&&mv(t.type)&&$je.indexOf(t.type)>=0},Vje=function(t){return t&&j3(t)==="object"&&"clipDot"in t},qje=function(t,r,n,o){var l,d=(l=KM==null?void 0:KM[o])!==null&&l!==void 0?l:[];return r.startsWith("data-")||!si(t)&&(o&&d.includes(r)||Dje.includes(r))||n&&H4.includes(r)},qn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var o=t;if(G.isValidElement(t)&&(o=t.props),!jb(o))return null;var l={};return Object.keys(o).forEach(function(d){var i;qje((i=o)===null||i===void 0?void 0:i[d],d,r,n)&&(l[d]=o[d])}),l},N3=function e(t,r){if(t===r)return!0;var n=G.Children.count(t);if(n!==G.Children.count(r))return!1;if(n===0)return!0;if(n===1)return W9(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var o=0;o<n;o++){var l=t[o],d=r[o];if(Array.isArray(l)||Array.isArray(d)){if(!e(l,d))return!1}else if(!W9(l,d))return!1}return!0},W9=function(t,r){if(bi(t)&&bi(r))return!0;if(!bi(t)&&!bi(r)){var n=t.props||{},o=n.children,l=$9(n,Fje),d=r.props||{},i=d.children,g=$9(d,zje);return o&&i?o0(l,g)&&N3(o,i):!o&&!i?o0(l,g):!1}return!1},G9=function(t,r){var n=[],o={};return K4(t).forEach(function(l,d){if(Uje(l))n.push(l);else if(l){var i=Af(l.type),g=r[i]||{},x=g.handler,S=g.once;if(x&&(!S||!o[i])){var E=x(l,i,d);n.push(E),o[i]=!0}}}),n},Wje=function(t){var r=t&&t.type;return r&&U9[r]?U9[r]:null},Gje=function(t,r){return K4(r).indexOf(t)},Hje=["children","width","height","viewBox","className","style","title","desc"];function M3(){return M3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},M3.apply(this,arguments)}function Kje(e,t){if(e==null)return{};var r=Zje(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Zje(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function D3(e){var t=e.children,r=e.width,n=e.height,o=e.viewBox,l=e.className,d=e.style,i=e.title,g=e.desc,x=Kje(e,Hje),S=o||{width:r,height:n,x:0,y:0},E=Ei("recharts-surface",l);return We.createElement("svg",M3({},qn(x,!0,"svg"),{className:E,width:r,height:n,style:d,viewBox:"".concat(S.x," ").concat(S.y," ").concat(S.width," ").concat(S.height)}),We.createElement("title",null,i),We.createElement("desc",null,g),t)}var Xje=["children","className"];function L3(){return L3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},L3.apply(this,arguments)}function Yje(e,t){if(e==null)return{};var r=Jje(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Jje(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var ga=We.forwardRef(function(e,t){var r=e.children,n=e.className,o=Yje(e,Xje),l=Ei("recharts-layer",n);return We.createElement("g",L3({className:l},qn(o,!0),{ref:t}),r)}),Ed=function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),l=2;l<n;l++)o[l-2]=arguments[l]};function Qje(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),r=r>o?o:r,r<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var l=Array(o);++n<o;)l[n]=e[n+t];return l}var eNe=Qje,tNe=eNe;function rNe(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:tNe(e,t,r)}var nNe=rNe,iNe="\\ud800-\\udfff",aNe="\\u0300-\\u036f",oNe="\\ufe20-\\ufe2f",sNe="\\u20d0-\\u20ff",lNe=aNe+oNe+sNe,cNe="\\ufe0e\\ufe0f",uNe="\\u200d",dNe=RegExp("["+uNe+iNe+lNe+cNe+"]");function hNe(e){return dNe.test(e)}var Pae=hNe;function fNe(e){return e.split("")}var pNe=fNe,Cae="\\ud800-\\udfff",mNe="\\u0300-\\u036f",gNe="\\ufe20-\\ufe2f",yNe="\\u20d0-\\u20ff",vNe=mNe+gNe+yNe,_Ne="\\ufe0e\\ufe0f",xNe="["+Cae+"]",F3="["+vNe+"]",z3="\\ud83c[\\udffb-\\udfff]",bNe="(?:"+F3+"|"+z3+")",Oae="[^"+Cae+"]",Iae="(?:\\ud83c[\\udde6-\\uddff]){2}",kae="[\\ud800-\\udbff][\\udc00-\\udfff]",wNe="\\u200d",Rae=bNe+"?",jae="["+_Ne+"]?",SNe="(?:"+wNe+"(?:"+[Oae,Iae,kae].join("|")+")"+jae+Rae+")*",ENe=jae+Rae+SNe,TNe="(?:"+[Oae+F3+"?",F3,Iae,kae,xNe].join("|")+")",ANe=RegExp(z3+"(?="+z3+")|"+TNe+ENe,"g");function PNe(e){return e.match(ANe)||[]}var CNe=PNe,ONe=pNe,INe=Pae,kNe=CNe;function RNe(e){return INe(e)?kNe(e):ONe(e)}var jNe=RNe,NNe=nNe,MNe=Pae,DNe=jNe,LNe=bae;function FNe(e){return function(t){t=LNe(t);var r=MNe(t)?DNe(t):void 0,n=r?r[0]:t.charAt(0),o=r?NNe(r,1).join(""):t.slice(1);return n[e]()+o}}var zNe=FNe,BNe=zNe,$Ne=BNe("toUpperCase"),UNe=$Ne;const rR=va(UNe);function Ha(e){return function(){return e}}const Nae=Math.cos,jO=Math.sin,Dd=Math.sqrt,NO=Math.PI,nR=2*NO,B3=Math.PI,$3=2*B3,Ey=1e-6,VNe=$3-Ey;function Mae(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function qNe(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Mae;const r=10**t;return function(n){this._+=n[0];for(let o=1,l=n.length;o<l;++o)this._+=Math.round(arguments[o]*r)/r+n[o]}}class WNe{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Mae:qNe(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,o){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+o}`}bezierCurveTo(t,r,n,o,l,d){this._append`C${+t},${+r},${+n},${+o},${this._x1=+l},${this._y1=+d}`}arcTo(t,r,n,o,l){if(t=+t,r=+r,n=+n,o=+o,l=+l,l<0)throw new Error(`negative radius: ${l}`);let d=this._x1,i=this._y1,g=n-t,x=o-r,S=d-t,E=i-r,A=S*S+E*E;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(A>Ey)if(!(Math.abs(E*g-x*S)>Ey)||!l)this._append`L${this._x1=t},${this._y1=r}`;else{let C=n-d,N=o-i,k=g*g+x*x,R=C*C+N*N,L=Math.sqrt(k),j=Math.sqrt(A),F=l*Math.tan((B3-Math.acos((k+A-R)/(2*L*j)))/2),B=F/j,U=F/L;Math.abs(B-1)>Ey&&this._append`L${t+B*S},${r+B*E}`,this._append`A${l},${l},0,0,${+(E*C>S*N)},${this._x1=t+U*g},${this._y1=r+U*x}`}}arc(t,r,n,o,l,d){if(t=+t,r=+r,n=+n,d=!!d,n<0)throw new Error(`negative radius: ${n}`);let i=n*Math.cos(o),g=n*Math.sin(o),x=t+i,S=r+g,E=1^d,A=d?o-l:l-o;this._x1===null?this._append`M${x},${S}`:(Math.abs(this._x1-x)>Ey||Math.abs(this._y1-S)>Ey)&&this._append`L${x},${S}`,n&&(A<0&&(A=A%$3+$3),A>VNe?this._append`A${n},${n},0,1,${E},${t-i},${r-g}A${n},${n},0,1,${E},${this._x1=x},${this._y1=S}`:A>Ey&&this._append`A${n},${n},0,${+(A>=B3)},${E},${this._x1=t+n*Math.cos(l)},${this._y1=r+n*Math.sin(l)}`)}rect(t,r,n,o){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+o}h${-n}Z`}toString(){return this._}}function Z4(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new WNe(t)}function X4(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Dae(e){this._context=e}Dae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function iR(e){return new Dae(e)}function Lae(e){return e[0]}function Fae(e){return e[1]}function zae(e,t){var r=Ha(!0),n=null,o=iR,l=null,d=Z4(i);e=typeof e=="function"?e:e===void 0?Lae:Ha(e),t=typeof t=="function"?t:t===void 0?Fae:Ha(t);function i(g){var x,S=(g=X4(g)).length,E,A=!1,C;for(n==null&&(l=o(C=d())),x=0;x<=S;++x)!(x<S&&r(E=g[x],x,g))===A&&((A=!A)?l.lineStart():l.lineEnd()),A&&l.point(+e(E,x,g),+t(E,x,g));if(C)return l=null,C+""||null}return i.x=function(g){return arguments.length?(e=typeof g=="function"?g:Ha(+g),i):e},i.y=function(g){return arguments.length?(t=typeof g=="function"?g:Ha(+g),i):t},i.defined=function(g){return arguments.length?(r=typeof g=="function"?g:Ha(!!g),i):r},i.curve=function(g){return arguments.length?(o=g,n!=null&&(l=o(n)),i):o},i.context=function(g){return arguments.length?(g==null?n=l=null:l=o(n=g),i):n},i}function MP(e,t,r){var n=null,o=Ha(!0),l=null,d=iR,i=null,g=Z4(x);e=typeof e=="function"?e:e===void 0?Lae:Ha(+e),t=typeof t=="function"?t:Ha(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?Fae:Ha(+r);function x(E){var A,C,N,k=(E=X4(E)).length,R,L=!1,j,F=new Array(k),B=new Array(k);for(l==null&&(i=d(j=g())),A=0;A<=k;++A){if(!(A<k&&o(R=E[A],A,E))===L)if(L=!L)C=A,i.areaStart(),i.lineStart();else{for(i.lineEnd(),i.lineStart(),N=A-1;N>=C;--N)i.point(F[N],B[N]);i.lineEnd(),i.areaEnd()}L&&(F[A]=+e(R,A,E),B[A]=+t(R,A,E),i.point(n?+n(R,A,E):F[A],r?+r(R,A,E):B[A]))}if(j)return i=null,j+""||null}function S(){return zae().defined(o).curve(d).context(l)}return x.x=function(E){return arguments.length?(e=typeof E=="function"?E:Ha(+E),n=null,x):e},x.x0=function(E){return arguments.length?(e=typeof E=="function"?E:Ha(+E),x):e},x.x1=function(E){return arguments.length?(n=E==null?null:typeof E=="function"?E:Ha(+E),x):n},x.y=function(E){return arguments.length?(t=typeof E=="function"?E:Ha(+E),r=null,x):t},x.y0=function(E){return arguments.length?(t=typeof E=="function"?E:Ha(+E),x):t},x.y1=function(E){return arguments.length?(r=E==null?null:typeof E=="function"?E:Ha(+E),x):r},x.lineX0=x.lineY0=function(){return S().x(e).y(t)},x.lineY1=function(){return S().x(e).y(r)},x.lineX1=function(){return S().x(n).y(t)},x.defined=function(E){return arguments.length?(o=typeof E=="function"?E:Ha(!!E),x):o},x.curve=function(E){return arguments.length?(d=E,l!=null&&(i=d(l)),x):d},x.context=function(E){return arguments.length?(E==null?l=i=null:i=d(l=E),x):l},x}class Bae{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function GNe(e){return new Bae(e,!0)}function HNe(e){return new Bae(e,!1)}const Y4={draw(e,t){const r=Dd(t/NO);e.moveTo(r,0),e.arc(0,0,r,0,nR)}},KNe={draw(e,t){const r=Dd(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},$ae=Dd(1/3),ZNe=$ae*2,XNe={draw(e,t){const r=Dd(t/ZNe),n=r*$ae;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},YNe={draw(e,t){const r=Dd(t),n=-r/2;e.rect(n,n,r,r)}},JNe=.8908130915292852,Uae=jO(NO/10)/jO(7*NO/10),QNe=jO(nR/10)*Uae,eMe=-Nae(nR/10)*Uae,tMe={draw(e,t){const r=Dd(t*JNe),n=QNe*r,o=eMe*r;e.moveTo(0,-r),e.lineTo(n,o);for(let l=1;l<5;++l){const d=nR*l/5,i=Nae(d),g=jO(d);e.lineTo(g*r,-i*r),e.lineTo(i*n-g*o,g*n+i*o)}e.closePath()}},XM=Dd(3),rMe={draw(e,t){const r=-Dd(t/(XM*3));e.moveTo(0,r*2),e.lineTo(-XM*r,-r),e.lineTo(XM*r,-r),e.closePath()}},uu=-.5,du=Dd(3)/2,U3=1/Dd(12),nMe=(U3/2+1)*3,iMe={draw(e,t){const r=Dd(t/nMe),n=r/2,o=r*U3,l=n,d=r*U3+r,i=-l,g=d;e.moveTo(n,o),e.lineTo(l,d),e.lineTo(i,g),e.lineTo(uu*n-du*o,du*n+uu*o),e.lineTo(uu*l-du*d,du*l+uu*d),e.lineTo(uu*i-du*g,du*i+uu*g),e.lineTo(uu*n+du*o,uu*o-du*n),e.lineTo(uu*l+du*d,uu*d-du*l),e.lineTo(uu*i+du*g,uu*g-du*i),e.closePath()}};function aMe(e,t){let r=null,n=Z4(o);e=typeof e=="function"?e:Ha(e||Y4),t=typeof t=="function"?t:Ha(t===void 0?64:+t);function o(){let l;if(r||(r=l=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),l)return r=null,l+""||null}return o.type=function(l){return arguments.length?(e=typeof l=="function"?l:Ha(l),o):e},o.size=function(l){return arguments.length?(t=typeof l=="function"?l:Ha(+l),o):t},o.context=function(l){return arguments.length?(r=l??null,o):r},o}function MO(){}function DO(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Vae(e){this._context=e}Vae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:DO(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function oMe(e){return new Vae(e)}function qae(e){this._context=e}qae.prototype={areaStart:MO,areaEnd:MO,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function sMe(e){return new qae(e)}function Wae(e){this._context=e}Wae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:DO(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function lMe(e){return new Wae(e)}function Gae(e){this._context=e}Gae.prototype={areaStart:MO,areaEnd:MO,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function cMe(e){return new Gae(e)}function H9(e){return e<0?-1:1}function K9(e,t,r){var n=e._x1-e._x0,o=t-e._x1,l=(e._y1-e._y0)/(n||o<0&&-0),d=(r-e._y1)/(o||n<0&&-0),i=(l*o+d*n)/(n+o);return(H9(l)+H9(d))*Math.min(Math.abs(l),Math.abs(d),.5*Math.abs(i))||0}function Z9(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function YM(e,t,r){var n=e._x0,o=e._y0,l=e._x1,d=e._y1,i=(l-n)/3;e._context.bezierCurveTo(n+i,o+i*t,l-i,d-i*r,l,d)}function LO(e){this._context=e}LO.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:YM(this,this._t0,Z9(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,YM(this,Z9(this,r=K9(this,e,t)),r);break;default:YM(this,this._t0,r=K9(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Hae(e){this._context=new Kae(e)}(Hae.prototype=Object.create(LO.prototype)).point=function(e,t){LO.prototype.point.call(this,t,e)};function Kae(e){this._context=e}Kae.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,o,l){this._context.bezierCurveTo(t,e,n,r,l,o)}};function uMe(e){return new LO(e)}function dMe(e){return new Hae(e)}function Zae(e){this._context=e}Zae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=X9(e),o=X9(t),l=0,d=1;d<r;++l,++d)this._context.bezierCurveTo(n[0][l],o[0][l],n[1][l],o[1][l],e[d],t[d]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function X9(e){var t,r=e.length-1,n,o=new Array(r),l=new Array(r),d=new Array(r);for(o[0]=0,l[0]=2,d[0]=e[0]+2*e[1],t=1;t<r-1;++t)o[t]=1,l[t]=4,d[t]=4*e[t]+2*e[t+1];for(o[r-1]=2,l[r-1]=7,d[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=o[t]/l[t-1],l[t]-=n,d[t]-=n*d[t-1];for(o[r-1]=d[r-1]/l[r-1],t=r-2;t>=0;--t)o[t]=(d[t]-o[t+1])/l[t];for(l[r-1]=(e[r]+o[r-1])/2,t=0;t<r-1;++t)l[t]=2*e[t+1]-o[t+1];return[o,l]}function hMe(e){return new Zae(e)}function aR(e,t){this._context=e,this._t=t}aR.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function fMe(e){return new aR(e,.5)}function pMe(e){return new aR(e,0)}function mMe(e){return new aR(e,1)}function q0(e,t){if((d=e.length)>1)for(var r=1,n,o,l=e[t[0]],d,i=l.length;r<d;++r)for(o=l,l=e[t[r]],n=0;n<i;++n)l[n][1]+=l[n][0]=isNaN(o[n][1])?o[n][0]:o[n][1]}function V3(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function gMe(e,t){return e[t]}function yMe(e){const t=[];return t.key=e,t}function vMe(){var e=Ha([]),t=V3,r=q0,n=gMe;function o(l){var d=Array.from(e.apply(this,arguments),yMe),i,g=d.length,x=-1,S;for(const E of l)for(i=0,++x;i<g;++i)(d[i][x]=[0,+n(E,d[i].key,x,l)]).data=E;for(i=0,S=X4(t(d));i<g;++i)d[S[i]].index=i;return r(d,S),d}return o.keys=function(l){return arguments.length?(e=typeof l=="function"?l:Ha(Array.from(l)),o):e},o.value=function(l){return arguments.length?(n=typeof l=="function"?l:Ha(+l),o):n},o.order=function(l){return arguments.length?(t=l==null?V3:typeof l=="function"?l:Ha(Array.from(l)),o):t},o.offset=function(l){return arguments.length?(r=l??q0,o):r},o}function _Me(e,t){if((n=e.length)>0){for(var r,n,o=0,l=e[0].length,d;o<l;++o){for(d=r=0;r<n;++r)d+=e[r][o][1]||0;if(d)for(r=0;r<n;++r)e[r][o][1]/=d}q0(e,t)}}function xMe(e,t){if((o=e.length)>0){for(var r=0,n=e[t[0]],o,l=n.length;r<l;++r){for(var d=0,i=0;d<o;++d)i+=e[d][r][1]||0;n[r][1]+=n[r][0]=-i/2}q0(e,t)}}function bMe(e,t){if(!(!((d=e.length)>0)||!((l=(o=e[t[0]]).length)>0))){for(var r=0,n=1,o,l,d;n<l;++n){for(var i=0,g=0,x=0;i<d;++i){for(var S=e[t[i]],E=S[n][1]||0,A=S[n-1][1]||0,C=(E-A)/2,N=0;N<i;++N){var k=e[t[N]],R=k[n][1]||0,L=k[n-1][1]||0;C+=R-L}g+=E,x+=C*E}o[n-1][1]+=o[n-1][0]=r,g&&(r-=x/g)}o[n-1][1]+=o[n-1][0]=r,q0(e,t)}}function NE(e){"@babel/helpers - typeof";return NE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},NE(e)}var wMe=["type","size","sizeType"];function q3(){return q3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},q3.apply(this,arguments)}function Y9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function J9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Y9(Object(r),!0).forEach(function(n){SMe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Y9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SMe(e,t,r){return t=EMe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EMe(e){var t=TMe(e,"string");return NE(t)=="symbol"?t:t+""}function TMe(e,t){if(NE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(NE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AMe(e,t){if(e==null)return{};var r=PMe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function PMe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Xae={symbolCircle:Y4,symbolCross:KNe,symbolDiamond:XNe,symbolSquare:YNe,symbolStar:tMe,symbolTriangle:rMe,symbolWye:iMe},CMe=Math.PI/180,OMe=function(t){var r="symbol".concat(rR(t));return Xae[r]||Y4},IMe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var o=18*CMe;return 1.25*t*t*(Math.tan(o)-Math.tan(o*2)*Math.pow(Math.tan(o),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},kMe=function(t,r){Xae["symbol".concat(rR(t))]=r},J4=function(t){var r=t.type,n=r===void 0?"circle":r,o=t.size,l=o===void 0?64:o,d=t.sizeType,i=d===void 0?"area":d,g=AMe(t,wMe),x=J9(J9({},g),{},{type:n,size:l,sizeType:i}),S=function(){var R=OMe(n),L=aMe().type(R).size(IMe(l,i,n));return L()},E=x.className,A=x.cx,C=x.cy,N=qn(x,!0);return A===+A&&C===+C&&l===+l?We.createElement("path",q3({},N,{className:Ei("recharts-symbols",E),transform:"translate(".concat(A,", ").concat(C,")"),d:S()})):null};J4.registerSymbol=kMe;function W0(e){"@babel/helpers - typeof";return W0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W0(e)}function W3(){return W3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},W3.apply(this,arguments)}function Q9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function RMe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q9(Object(r),!0).forEach(function(n){ME(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jMe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function NMe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Jae(n.key),n)}}function MMe(e,t,r){return t&&NMe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function DMe(e,t,r){return t=FO(t),LMe(e,Yae()?Reflect.construct(t,r||[],FO(e).constructor):t.apply(e,r))}function LMe(e,t){if(t&&(W0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return FMe(e)}function FMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yae=function(){return!!e})()}function FO(e){return FO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FO(e)}function zMe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G3(e,t)}function G3(e,t){return G3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},G3(e,t)}function ME(e,t,r){return t=Jae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jae(e){var t=BMe(e,"string");return W0(t)=="symbol"?t:t+""}function BMe(e,t){if(W0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(W0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hu=32,Q4=function(e){function t(){return jMe(this,t),DMe(this,t,arguments)}return zMe(t,e),MMe(t,[{key:"renderIcon",value:function(n){var o=this.props.inactiveColor,l=hu/2,d=hu/6,i=hu/3,g=n.inactive?o:n.color;if(n.type==="plainline")return We.createElement("line",{strokeWidth:4,fill:"none",stroke:g,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:l,x2:hu,y2:l,className:"recharts-legend-icon"});if(n.type==="line")return We.createElement("path",{strokeWidth:4,fill:"none",stroke:g,d:"M0,".concat(l,"h").concat(i,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(2*i,",").concat(l,`
            H`).concat(hu,"M").concat(2*i,",").concat(l,`
            A`).concat(d,",").concat(d,",0,1,1,").concat(i,",").concat(l),className:"recharts-legend-icon"});if(n.type==="rect")return We.createElement("path",{stroke:"none",fill:g,d:"M0,".concat(hu/8,"h").concat(hu,"v").concat(hu*3/4,"h").concat(-hu,"z"),className:"recharts-legend-icon"});if(We.isValidElement(n.legendIcon)){var x=RMe({},n);return delete x.legendIcon,We.cloneElement(n.legendIcon,x)}return We.createElement(J4,{fill:g,cx:l,cy:l,size:hu,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,o=this.props,l=o.payload,d=o.iconSize,i=o.layout,g=o.formatter,x=o.inactiveColor,S={x:0,y:0,width:hu,height:hu},E={display:i==="horizontal"?"inline-block":"block",marginRight:10},A={display:"inline-block",verticalAlign:"middle",marginRight:4};return l.map(function(C,N){var k=C.formatter||g,R=Ei(ME(ME({"recharts-legend-item":!0},"legend-item-".concat(N),!0),"inactive",C.inactive));if(C.type==="none")return null;var L=si(C.value)?null:C.value;Ed(!si(C.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var j=C.inactive?x:C.color;return We.createElement("li",W3({className:R,style:E,key:"legend-item-".concat(N)},gv(n.props,C,N)),We.createElement(D3,{width:d,height:d,viewBox:S,style:A},n.renderIcon(C)),We.createElement("span",{className:"recharts-legend-item-text",style:{color:j}},k?k(L,C,N):L))})}},{key:"render",value:function(){var n=this.props,o=n.payload,l=n.layout,d=n.align;if(!o||!o.length)return null;var i={padding:0,margin:0,textAlign:l==="horizontal"?d:"left"};return We.createElement("ul",{className:"recharts-default-legend",style:i},this.renderItems())}}])}(G.PureComponent);ME(Q4,"displayName","Legend");ME(Q4,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var $Me=Vk;function UMe(){this.__data__=new $Me,this.size=0}var VMe=UMe;function qMe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var WMe=qMe;function GMe(e){return this.__data__.get(e)}var HMe=GMe;function KMe(e){return this.__data__.has(e)}var ZMe=KMe,XMe=Vk,YMe=B4,JMe=$4,QMe=200;function eDe(e,t){var r=this.__data__;if(r instanceof XMe){var n=r.__data__;if(!YMe||n.length<QMe-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new JMe(n)}return r.set(e,t),this.size=r.size,this}var tDe=eDe,rDe=Vk,nDe=VMe,iDe=WMe,aDe=HMe,oDe=ZMe,sDe=tDe;function Fb(e){var t=this.__data__=new rDe(e);this.size=t.size}Fb.prototype.clear=nDe;Fb.prototype.delete=iDe;Fb.prototype.get=aDe;Fb.prototype.has=oDe;Fb.prototype.set=sDe;var Qae=Fb,lDe="__lodash_hash_undefined__";function cDe(e){return this.__data__.set(e,lDe),this}var uDe=cDe;function dDe(e){return this.__data__.has(e)}var hDe=dDe,fDe=$4,pDe=uDe,mDe=hDe;function zO(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new fDe;++t<r;)this.add(e[t])}zO.prototype.add=zO.prototype.push=pDe;zO.prototype.has=mDe;var eoe=zO;function gDe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var toe=gDe;function yDe(e,t){return e.has(t)}var roe=yDe,vDe=eoe,_De=toe,xDe=roe,bDe=1,wDe=2;function SDe(e,t,r,n,o,l){var d=r&bDe,i=e.length,g=t.length;if(i!=g&&!(d&&g>i))return!1;var x=l.get(e),S=l.get(t);if(x&&S)return x==t&&S==e;var E=-1,A=!0,C=r&wDe?new vDe:void 0;for(l.set(e,t),l.set(t,e);++E<i;){var N=e[E],k=t[E];if(n)var R=d?n(k,N,E,t,e,l):n(N,k,E,e,t,l);if(R!==void 0){if(R)continue;A=!1;break}if(C){if(!_De(t,function(L,j){if(!xDe(C,j)&&(N===L||o(N,L,r,n,l)))return C.push(j)})){A=!1;break}}else if(!(N===k||o(N,k,r,n,l))){A=!1;break}}return l.delete(e),l.delete(t),A}var noe=SDe,EDe=jh,TDe=EDe.Uint8Array,ADe=TDe;function PDe(e){var t=-1,r=Array(e.size);return e.forEach(function(n,o){r[++t]=[o,n]}),r}var CDe=PDe;function ODe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var e5=ODe,eG=HT,tG=ADe,IDe=z4,kDe=noe,RDe=CDe,jDe=e5,NDe=1,MDe=2,DDe="[object Boolean]",LDe="[object Date]",FDe="[object Error]",zDe="[object Map]",BDe="[object Number]",$De="[object RegExp]",UDe="[object Set]",VDe="[object String]",qDe="[object Symbol]",WDe="[object ArrayBuffer]",GDe="[object DataView]",rG=eG?eG.prototype:void 0,JM=rG?rG.valueOf:void 0;function HDe(e,t,r,n,o,l,d){switch(r){case GDe:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case WDe:return!(e.byteLength!=t.byteLength||!l(new tG(e),new tG(t)));case DDe:case LDe:case BDe:return IDe(+e,+t);case FDe:return e.name==t.name&&e.message==t.message;case $De:case VDe:return e==t+"";case zDe:var i=RDe;case UDe:var g=n&NDe;if(i||(i=jDe),e.size!=t.size&&!g)return!1;var x=d.get(e);if(x)return x==t;n|=MDe,d.set(e,t);var S=kDe(i(e),i(t),n,o,l,d);return d.delete(e),S;case qDe:if(JM)return JM.call(e)==JM.call(t)}return!1}var KDe=HDe;function ZDe(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var ioe=ZDe,XDe=ioe,YDe=Ac;function JDe(e,t,r){var n=t(e);return YDe(e)?n:XDe(n,r(e))}var QDe=JDe;function eLe(e,t){for(var r=-1,n=e==null?0:e.length,o=0,l=[];++r<n;){var d=e[r];t(d,r,e)&&(l[o++]=d)}return l}var tLe=eLe;function rLe(){return[]}var nLe=rLe,iLe=tLe,aLe=nLe,oLe=Object.prototype,sLe=oLe.propertyIsEnumerable,nG=Object.getOwnPropertySymbols,lLe=nG?function(e){return e==null?[]:(e=Object(e),iLe(nG(e),function(t){return sLe.call(e,t)}))}:aLe,cLe=lLe;function uLe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var dLe=uLe,hLe=Gf,fLe=Hf,pLe="[object Arguments]";function mLe(e){return fLe(e)&&hLe(e)==pLe}var gLe=mLe,iG=gLe,yLe=Hf,aoe=Object.prototype,vLe=aoe.hasOwnProperty,_Le=aoe.propertyIsEnumerable,xLe=iG(function(){return arguments}())?iG:function(e){return yLe(e)&&vLe.call(e,"callee")&&!_Le.call(e,"callee")},t5=xLe,BO={exports:{}};function bLe(){return!1}var wLe=bLe;BO.exports;(function(e,t){var r=jh,n=wLe,o=t&&!t.nodeType&&t,l=o&&!0&&e&&!e.nodeType&&e,d=l&&l.exports===o,i=d?r.Buffer:void 0,g=i?i.isBuffer:void 0,x=g||n;e.exports=x})(BO,BO.exports);var ooe=BO.exports,SLe=9007199254740991,ELe=/^(?:0|[1-9]\d*)$/;function TLe(e,t){var r=typeof e;return t=t??SLe,!!t&&(r=="number"||r!="symbol"&&ELe.test(e))&&e>-1&&e%1==0&&e<t}var r5=TLe,ALe=9007199254740991;function PLe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=ALe}var n5=PLe,CLe=Gf,OLe=n5,ILe=Hf,kLe="[object Arguments]",RLe="[object Array]",jLe="[object Boolean]",NLe="[object Date]",MLe="[object Error]",DLe="[object Function]",LLe="[object Map]",FLe="[object Number]",zLe="[object Object]",BLe="[object RegExp]",$Le="[object Set]",ULe="[object String]",VLe="[object WeakMap]",qLe="[object ArrayBuffer]",WLe="[object DataView]",GLe="[object Float32Array]",HLe="[object Float64Array]",KLe="[object Int8Array]",ZLe="[object Int16Array]",XLe="[object Int32Array]",YLe="[object Uint8Array]",JLe="[object Uint8ClampedArray]",QLe="[object Uint16Array]",e3e="[object Uint32Array]",no={};no[GLe]=no[HLe]=no[KLe]=no[ZLe]=no[XLe]=no[YLe]=no[JLe]=no[QLe]=no[e3e]=!0;no[kLe]=no[RLe]=no[qLe]=no[jLe]=no[WLe]=no[NLe]=no[MLe]=no[DLe]=no[LLe]=no[FLe]=no[zLe]=no[BLe]=no[$Le]=no[ULe]=no[VLe]=!1;function t3e(e){return ILe(e)&&OLe(e.length)&&!!no[CLe(e)]}var r3e=t3e;function n3e(e){return function(t){return e(t)}}var soe=n3e,$O={exports:{}};$O.exports;(function(e,t){var r=mae,n=t&&!t.nodeType&&t,o=n&&!0&&e&&!e.nodeType&&e,l=o&&o.exports===n,d=l&&r.process,i=function(){try{var g=o&&o.require&&o.require("util").types;return g||d&&d.binding&&d.binding("util")}catch{}}();e.exports=i})($O,$O.exports);var i3e=$O.exports,a3e=r3e,o3e=soe,aG=i3e,oG=aG&&aG.isTypedArray,s3e=oG?o3e(oG):a3e,loe=s3e,l3e=dLe,c3e=t5,u3e=Ac,d3e=ooe,h3e=r5,f3e=loe,p3e=Object.prototype,m3e=p3e.hasOwnProperty;function g3e(e,t){var r=u3e(e),n=!r&&c3e(e),o=!r&&!n&&d3e(e),l=!r&&!n&&!o&&f3e(e),d=r||n||o||l,i=d?l3e(e.length,String):[],g=i.length;for(var x in e)(t||m3e.call(e,x))&&!(d&&(x=="length"||o&&(x=="offset"||x=="parent")||l&&(x=="buffer"||x=="byteLength"||x=="byteOffset")||h3e(x,g)))&&i.push(x);return i}var y3e=g3e,v3e=Object.prototype;function _3e(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||v3e;return e===r}var x3e=_3e;function b3e(e,t){return function(r){return e(t(r))}}var coe=b3e,w3e=coe,S3e=w3e(Object.keys,Object),E3e=S3e,T3e=x3e,A3e=E3e,P3e=Object.prototype,C3e=P3e.hasOwnProperty;function O3e(e){if(!T3e(e))return A3e(e);var t=[];for(var r in Object(e))C3e.call(e,r)&&r!="constructor"&&t.push(r);return t}var I3e=O3e,k3e=F4,R3e=n5;function j3e(e){return e!=null&&R3e(e.length)&&!k3e(e)}var ZT=j3e,N3e=y3e,M3e=I3e,D3e=ZT;function L3e(e){return D3e(e)?N3e(e):M3e(e)}var oR=L3e,F3e=QDe,z3e=cLe,B3e=oR;function $3e(e){return F3e(e,B3e,z3e)}var U3e=$3e,sG=U3e,V3e=1,q3e=Object.prototype,W3e=q3e.hasOwnProperty;function G3e(e,t,r,n,o,l){var d=r&V3e,i=sG(e),g=i.length,x=sG(t),S=x.length;if(g!=S&&!d)return!1;for(var E=g;E--;){var A=i[E];if(!(d?A in t:W3e.call(t,A)))return!1}var C=l.get(e),N=l.get(t);if(C&&N)return C==t&&N==e;var k=!0;l.set(e,t),l.set(t,e);for(var R=d;++E<g;){A=i[E];var L=e[A],j=t[A];if(n)var F=d?n(j,L,A,t,e,l):n(L,j,A,e,t,l);if(!(F===void 0?L===j||o(L,j,r,n,l):F)){k=!1;break}R||(R=A=="constructor")}if(k&&!R){var B=e.constructor,U=t.constructor;B!=U&&"constructor"in e&&"constructor"in t&&!(typeof B=="function"&&B instanceof B&&typeof U=="function"&&U instanceof U)&&(k=!1)}return l.delete(e),l.delete(t),k}var H3e=G3e,K3e=kv,Z3e=jh,X3e=K3e(Z3e,"DataView"),Y3e=X3e,J3e=kv,Q3e=jh,eFe=J3e(Q3e,"Promise"),tFe=eFe,rFe=kv,nFe=jh,iFe=rFe(nFe,"Set"),uoe=iFe,aFe=kv,oFe=jh,sFe=aFe(oFe,"WeakMap"),lFe=sFe,H3=Y3e,K3=B4,Z3=tFe,X3=uoe,Y3=lFe,doe=Gf,zb=yae,lG="[object Map]",cFe="[object Object]",cG="[object Promise]",uG="[object Set]",dG="[object WeakMap]",hG="[object DataView]",uFe=zb(H3),dFe=zb(K3),hFe=zb(Z3),fFe=zb(X3),pFe=zb(Y3),Ty=doe;(H3&&Ty(new H3(new ArrayBuffer(1)))!=hG||K3&&Ty(new K3)!=lG||Z3&&Ty(Z3.resolve())!=cG||X3&&Ty(new X3)!=uG||Y3&&Ty(new Y3)!=dG)&&(Ty=function(e){var t=doe(e),r=t==cFe?e.constructor:void 0,n=r?zb(r):"";if(n)switch(n){case uFe:return hG;case dFe:return lG;case hFe:return cG;case fFe:return uG;case pFe:return dG}return t});var mFe=Ty,QM=Qae,gFe=noe,yFe=KDe,vFe=H3e,fG=mFe,pG=Ac,mG=ooe,_Fe=loe,xFe=1,gG="[object Arguments]",yG="[object Array]",DP="[object Object]",bFe=Object.prototype,vG=bFe.hasOwnProperty;function wFe(e,t,r,n,o,l){var d=pG(e),i=pG(t),g=d?yG:fG(e),x=i?yG:fG(t);g=g==gG?DP:g,x=x==gG?DP:x;var S=g==DP,E=x==DP,A=g==x;if(A&&mG(e)){if(!mG(t))return!1;d=!0,S=!1}if(A&&!S)return l||(l=new QM),d||_Fe(e)?gFe(e,t,r,n,o,l):yFe(e,t,g,r,n,o,l);if(!(r&xFe)){var C=S&&vG.call(e,"__wrapped__"),N=E&&vG.call(t,"__wrapped__");if(C||N){var k=C?e.value():e,R=N?t.value():t;return l||(l=new QM),o(k,R,r,n,l)}}return A?(l||(l=new QM),vFe(e,t,r,n,o,l)):!1}var SFe=wFe,EFe=SFe,_G=Hf;function hoe(e,t,r,n,o){return e===t?!0:e==null||t==null||!_G(e)&&!_G(t)?e!==e&&t!==t:EFe(e,t,r,n,hoe,o)}var i5=hoe,TFe=Qae,AFe=i5,PFe=1,CFe=2;function OFe(e,t,r,n){var o=r.length,l=o,d=!n;if(e==null)return!l;for(e=Object(e);o--;){var i=r[o];if(d&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++o<l;){i=r[o];var g=i[0],x=e[g],S=i[1];if(d&&i[2]){if(x===void 0&&!(g in e))return!1}else{var E=new TFe;if(n)var A=n(x,S,g,e,t,E);if(!(A===void 0?AFe(S,x,PFe|CFe,n,E):A))return!1}}return!0}var IFe=OFe,kFe=og;function RFe(e){return e===e&&!kFe(e)}var foe=RFe,jFe=foe,NFe=oR;function MFe(e){for(var t=NFe(e),r=t.length;r--;){var n=t[r],o=e[n];t[r]=[n,o,jFe(o)]}return t}var DFe=MFe;function LFe(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var poe=LFe,FFe=IFe,zFe=DFe,BFe=poe;function $Fe(e){var t=zFe(e);return t.length==1&&t[0][2]?BFe(t[0][0],t[0][1]):function(r){return r===e||FFe(r,e,t)}}var UFe=$Fe;function VFe(e,t){return e!=null&&t in Object(e)}var qFe=VFe,WFe=wae,GFe=t5,HFe=Ac,KFe=r5,ZFe=n5,XFe=Wk;function YFe(e,t,r){t=WFe(t,e);for(var n=-1,o=t.length,l=!1;++n<o;){var d=XFe(t[n]);if(!(l=e!=null&&r(e,d)))break;e=e[d]}return l||++n!=o?l:(o=e==null?0:e.length,!!o&&ZFe(o)&&KFe(d,o)&&(HFe(e)||GFe(e)))}var JFe=YFe,QFe=qFe,eze=JFe;function tze(e,t){return e!=null&&eze(e,t,QFe)}var rze=tze,nze=i5,ize=Sae,aze=rze,oze=L4,sze=foe,lze=poe,cze=Wk,uze=1,dze=2;function hze(e,t){return oze(e)&&sze(t)?lze(cze(e),t):function(r){var n=ize(r,e);return n===void 0&&n===t?aze(r,e):nze(t,n,uze|dze)}}var fze=hze;function pze(e){return e}var Bb=pze;function mze(e){return function(t){return t==null?void 0:t[e]}}var gze=mze,yze=q4;function vze(e){return function(t){return yze(t,e)}}var _ze=vze,xze=gze,bze=_ze,wze=L4,Sze=Wk;function Eze(e){return wze(e)?xze(Sze(e)):bze(e)}var Tze=Eze,Aze=UFe,Pze=fze,Cze=Bb,Oze=Ac,Ize=Tze;function kze(e){return typeof e=="function"?e:e==null?Cze:typeof e=="object"?Oze(e)?Pze(e[0],e[1]):Aze(e):Ize(e)}var Nh=kze;function Rze(e,t,r,n){for(var o=e.length,l=r+(n?1:-1);n?l--:++l<o;)if(t(e[l],l,e))return l;return-1}var moe=Rze;function jze(e){return e!==e}var Nze=jze;function Mze(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}var Dze=Mze,Lze=moe,Fze=Nze,zze=Dze;function Bze(e,t,r){return t===t?zze(e,t,r):Lze(e,Fze,r)}var $ze=Bze,Uze=$ze;function Vze(e,t){var r=e==null?0:e.length;return!!r&&Uze(e,t,0)>-1}var qze=Vze;function Wze(e,t,r){for(var n=-1,o=e==null?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}var Gze=Wze;function Hze(){}var Kze=Hze,eD=uoe,Zze=Kze,Xze=e5,Yze=1/0,Jze=eD&&1/Xze(new eD([,-0]))[1]==Yze?function(e){return new eD(e)}:Zze,Qze=Jze,eBe=eoe,tBe=qze,rBe=Gze,nBe=roe,iBe=Qze,aBe=e5,oBe=200;function sBe(e,t,r){var n=-1,o=tBe,l=e.length,d=!0,i=[],g=i;if(r)d=!1,o=rBe;else if(l>=oBe){var x=t?null:iBe(e);if(x)return aBe(x);d=!1,o=nBe,g=new eBe}else g=t?[]:i;e:for(;++n<l;){var S=e[n],E=t?t(S):S;if(S=r||S!==0?S:0,d&&E===E){for(var A=g.length;A--;)if(g[A]===E)continue e;t&&g.push(E),i.push(S)}else o(g,E,r)||(g!==i&&g.push(E),i.push(S))}return i}var lBe=sBe,cBe=Nh,uBe=lBe;function dBe(e,t){return e&&e.length?uBe(e,cBe(t)):[]}var hBe=dBe;const xG=va(hBe);function goe(e,t,r){return t===!0?xG(e,r):si(t)?xG(e,t):e}function G0(e){"@babel/helpers - typeof";return G0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G0(e)}var fBe=["ref"];function bG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function lf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?bG(Object(r),!0).forEach(function(n){sR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pBe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function wG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,voe(n.key),n)}}function mBe(e,t,r){return t&&wG(e.prototype,t),r&&wG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function gBe(e,t,r){return t=UO(t),yBe(e,yoe()?Reflect.construct(t,r||[],UO(e).constructor):t.apply(e,r))}function yBe(e,t){if(t&&(G0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vBe(e)}function vBe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yoe=function(){return!!e})()}function UO(e){return UO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},UO(e)}function _Be(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&J3(e,t)}function J3(e,t){return J3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},J3(e,t)}function sR(e,t,r){return t=voe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function voe(e){var t=xBe(e,"string");return G0(t)=="symbol"?t:t+""}function xBe(e,t){if(G0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(G0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bBe(e,t){if(e==null)return{};var r=wBe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function wBe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function SBe(e){return e.value}function EBe(e,t){if(We.isValidElement(e))return We.cloneElement(e,t);if(typeof e=="function")return We.createElement(e,t);t.ref;var r=bBe(t,fBe);return We.createElement(Q4,r)}var SG=1,ph=function(e){function t(){var r;pBe(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=gBe(this,t,[].concat(o)),sR(r,"lastBoundingBox",{width:-1,height:-1}),r}return _Be(t,e),mBe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,o=this.getBBox();o?(Math.abs(o.width-this.lastBoundingBox.width)>SG||Math.abs(o.height-this.lastBoundingBox.height)>SG)&&(this.lastBoundingBox.width=o.width,this.lastBoundingBox.height=o.height,n&&n(o)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?lf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var o=this.props,l=o.layout,d=o.align,i=o.verticalAlign,g=o.margin,x=o.chartWidth,S=o.chartHeight,E,A;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(d==="center"&&l==="vertical"){var C=this.getBBoxSnapshot();E={left:((x||0)-C.width)/2}}else E=d==="right"?{right:g&&g.right||0}:{left:g&&g.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(i==="middle"){var N=this.getBBoxSnapshot();A={top:((S||0)-N.height)/2}}else A=i==="bottom"?{bottom:g&&g.bottom||0}:{top:g&&g.top||0};return lf(lf({},E),A)}},{key:"render",value:function(){var n=this,o=this.props,l=o.content,d=o.width,i=o.height,g=o.wrapperStyle,x=o.payloadUniqBy,S=o.payload,E=lf(lf({position:"absolute",width:d||"auto",height:i||"auto"},this.getDefaultPosition(g)),g);return We.createElement("div",{className:"recharts-legend-wrapper",style:E,ref:function(C){n.wrapperNode=C}},EBe(l,lf(lf({},this.props),{},{payload:goe(S,x,SBe)})))}}],[{key:"getWithHeight",value:function(n,o){var l=lf(lf({},this.defaultProps),n.props),d=l.layout;return d==="vertical"&&Fr(n.props.height)?{height:n.props.height}:d==="horizontal"?{width:n.props.width||o}:null}}])}(G.PureComponent);sR(ph,"displayName","Legend");sR(ph,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var EG=HT,TBe=t5,ABe=Ac,TG=EG?EG.isConcatSpreadable:void 0;function PBe(e){return ABe(e)||TBe(e)||!!(TG&&e&&e[TG])}var CBe=PBe,OBe=ioe,IBe=CBe;function _oe(e,t,r,n,o){var l=-1,d=e.length;for(r||(r=IBe),o||(o=[]);++l<d;){var i=e[l];t>0&&r(i)?t>1?_oe(i,t-1,r,n,o):OBe(o,i):n||(o[o.length]=i)}return o}var xoe=_oe;function kBe(e){return function(t,r,n){for(var o=-1,l=Object(t),d=n(t),i=d.length;i--;){var g=d[e?i:++o];if(r(l[g],g,l)===!1)break}return t}}var RBe=kBe,jBe=RBe,NBe=jBe(),MBe=NBe,DBe=MBe,LBe=oR;function FBe(e,t){return e&&DBe(e,t,LBe)}var boe=FBe,zBe=ZT;function BBe(e,t){return function(r,n){if(r==null)return r;if(!zBe(r))return e(r,n);for(var o=r.length,l=t?o:-1,d=Object(r);(t?l--:++l<o)&&n(d[l],l,d)!==!1;);return r}}var $Be=BBe,UBe=boe,VBe=$Be,qBe=VBe(UBe),a5=qBe,WBe=a5,GBe=ZT;function HBe(e,t){var r=-1,n=GBe(e)?Array(e.length):[];return WBe(e,function(o,l,d){n[++r]=t(o,l,d)}),n}var woe=HBe;function KBe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var ZBe=KBe,AG=Rb;function XBe(e,t){if(e!==t){var r=e!==void 0,n=e===null,o=e===e,l=AG(e),d=t!==void 0,i=t===null,g=t===t,x=AG(t);if(!i&&!x&&!l&&e>t||l&&d&&g&&!i&&!x||n&&d&&g||!r&&g||!o)return 1;if(!n&&!l&&!x&&e<t||x&&r&&o&&!n&&!l||i&&r&&o||!d&&o||!g)return-1}return 0}var YBe=XBe,JBe=YBe;function QBe(e,t,r){for(var n=-1,o=e.criteria,l=t.criteria,d=o.length,i=r.length;++n<d;){var g=JBe(o[n],l[n]);if(g){if(n>=i)return g;var x=r[n];return g*(x=="desc"?-1:1)}}return e.index-t.index}var e4e=QBe,tD=V4,t4e=q4,r4e=Nh,n4e=woe,i4e=ZBe,a4e=soe,o4e=e4e,s4e=Bb,l4e=Ac;function c4e(e,t,r){t.length?t=tD(t,function(l){return l4e(l)?function(d){return t4e(d,l.length===1?l[0]:l)}:l}):t=[s4e];var n=-1;t=tD(t,a4e(r4e));var o=n4e(e,function(l,d,i){var g=tD(t,function(x){return x(l)});return{criteria:g,index:++n,value:l}});return i4e(o,function(l,d){return o4e(l,d,r)})}var u4e=c4e;function d4e(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var h4e=d4e,f4e=h4e,PG=Math.max;function p4e(e,t,r){return t=PG(t===void 0?e.length-1:t,0),function(){for(var n=arguments,o=-1,l=PG(n.length-t,0),d=Array(l);++o<l;)d[o]=n[t+o];o=-1;for(var i=Array(t+1);++o<t;)i[o]=n[o];return i[t]=r(d),f4e(e,this,i)}}var m4e=p4e;function g4e(e){return function(){return e}}var y4e=g4e,v4e=kv,_4e=function(){try{var e=v4e(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Soe=_4e,x4e=y4e,CG=Soe,b4e=Bb,w4e=CG?function(e,t){return CG(e,"toString",{configurable:!0,enumerable:!1,value:x4e(t),writable:!0})}:b4e,S4e=w4e,E4e=800,T4e=16,A4e=Date.now;function P4e(e){var t=0,r=0;return function(){var n=A4e(),o=T4e-(n-r);if(r=n,o>0){if(++t>=E4e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var C4e=P4e,O4e=S4e,I4e=C4e,k4e=I4e(O4e),R4e=k4e,j4e=Bb,N4e=m4e,M4e=R4e;function D4e(e,t){return M4e(N4e(e,t,j4e),e+"")}var L4e=D4e,F4e=z4,z4e=ZT,B4e=r5,$4e=og;function U4e(e,t,r){if(!$4e(r))return!1;var n=typeof t;return(n=="number"?z4e(r)&&B4e(t,r.length):n=="string"&&t in r)?F4e(r[t],e):!1}var lR=U4e,V4e=xoe,q4e=u4e,W4e=L4e,OG=lR,G4e=W4e(function(e,t){if(e==null)return[];var r=t.length;return r>1&&OG(e,t[0],t[1])?t=[]:r>2&&OG(t[0],t[1],t[2])&&(t=[t[0]]),q4e(e,V4e(t,1),[])}),H4e=G4e;const o5=va(H4e);function DE(e){"@babel/helpers - typeof";return DE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},DE(e)}function Q3(){return Q3=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Q3.apply(this,arguments)}function K4e(e,t){return J4e(e)||Y4e(e,t)||X4e(e,t)||Z4e()}function Z4e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function X4e(e,t){if(e){if(typeof e=="string")return IG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return IG(e,t)}}function IG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Y4e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function J4e(e){if(Array.isArray(e))return e}function kG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function rD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?kG(Object(r),!0).forEach(function(n){Q4e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Q4e(e,t,r){return t=e5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function e5e(e){var t=t5e(e,"string");return DE(t)=="symbol"?t:t+""}function t5e(e,t){if(DE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(DE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function r5e(e){return Array.isArray(e)&&gs(e[0])&&gs(e[1])?e.join(" ~ "):e}var n5e=function(t){var r=t.separator,n=r===void 0?" : ":r,o=t.contentStyle,l=o===void 0?{}:o,d=t.itemStyle,i=d===void 0?{}:d,g=t.labelStyle,x=g===void 0?{}:g,S=t.payload,E=t.formatter,A=t.itemSorter,C=t.wrapperClassName,N=t.labelClassName,k=t.label,R=t.labelFormatter,L=t.accessibilityLayer,j=L===void 0?!1:L,F=function(){if(S&&S.length){var ee={padding:0,margin:0},ie=(A?o5(S,A):S).map(function(he,Se){if(he.type==="none")return null;var Ce=rD({display:"block",paddingTop:4,paddingBottom:4,color:he.color||"#000"},i),fe=he.formatter||E||r5e,_e=he.value,be=he.name,Pe=_e,ye=be;if(fe&&Pe!=null&&ye!=null){var ge=fe(_e,be,he,Se,S);if(Array.isArray(ge)){var ke=K4e(ge,2);Pe=ke[0],ye=ke[1]}else Pe=ge}return We.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(Se),style:Ce},gs(ye)?We.createElement("span",{className:"recharts-tooltip-item-name"},ye):null,gs(ye)?We.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,We.createElement("span",{className:"recharts-tooltip-item-value"},Pe),We.createElement("span",{className:"recharts-tooltip-item-unit"},he.unit||""))});return We.createElement("ul",{className:"recharts-tooltip-item-list",style:ee},ie)}return null},B=rD({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},l),U=rD({margin:0},x),Z=!bi(k),X=Z?k:"",te=Ei("recharts-default-tooltip",C),se=Ei("recharts-tooltip-label",N);Z&&R&&S!==void 0&&S!==null&&(X=R(k,S));var oe=j?{role:"status","aria-live":"assertive"}:{};return We.createElement("div",Q3({className:te,style:B},oe),We.createElement("p",{className:se,style:U},We.isValidElement(X)?X:"".concat(X)),F())};function LE(e){"@babel/helpers - typeof";return LE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},LE(e)}function LP(e,t,r){return t=i5e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i5e(e){var t=a5e(e,"string");return LE(t)=="symbol"?t:t+""}function a5e(e,t){if(LE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(LE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hS="recharts-tooltip-wrapper",o5e={visibility:"hidden"};function s5e(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Ei(hS,LP(LP(LP(LP({},"".concat(hS,"-right"),Fr(r)&&t&&Fr(t.x)&&r>=t.x),"".concat(hS,"-left"),Fr(r)&&t&&Fr(t.x)&&r<t.x),"".concat(hS,"-bottom"),Fr(n)&&t&&Fr(t.y)&&n>=t.y),"".concat(hS,"-top"),Fr(n)&&t&&Fr(t.y)&&n<t.y))}function RG(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,o=e.offsetTopLeft,l=e.position,d=e.reverseDirection,i=e.tooltipDimension,g=e.viewBox,x=e.viewBoxDimension;if(l&&Fr(l[n]))return l[n];var S=r[n]-i-o,E=r[n]+o;if(t[n])return d[n]?S:E;if(d[n]){var A=S,C=g[n];return A<C?Math.max(E,g[n]):Math.max(S,g[n])}var N=E+i,k=g[n]+x;return N>k?Math.max(S,g[n]):Math.max(E,g[n])}function l5e(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function c5e(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,o=e.position,l=e.reverseDirection,d=e.tooltipBox,i=e.useTranslate3d,g=e.viewBox,x,S,E;return d.height>0&&d.width>0&&r?(S=RG({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:o,reverseDirection:l,tooltipDimension:d.width,viewBox:g,viewBoxDimension:g.width}),E=RG({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:o,reverseDirection:l,tooltipDimension:d.height,viewBox:g,viewBoxDimension:g.height}),x=l5e({translateX:S,translateY:E,useTranslate3d:i})):x=o5e,{cssProperties:x,cssClasses:s5e({translateX:S,translateY:E,coordinate:r})}}function H0(e){"@babel/helpers - typeof";return H0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H0(e)}function jG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function NG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jG(Object(r),!0).forEach(function(n){tF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d5e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Toe(n.key),n)}}function h5e(e,t,r){return t&&d5e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function f5e(e,t,r){return t=VO(t),p5e(e,Eoe()?Reflect.construct(t,r||[],VO(e).constructor):t.apply(e,r))}function p5e(e,t){if(t&&(H0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return m5e(e)}function m5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Eoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Eoe=function(){return!!e})()}function VO(e){return VO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VO(e)}function g5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&eF(e,t)}function eF(e,t){return eF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},eF(e,t)}function tF(e,t,r){return t=Toe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Toe(e){var t=y5e(e,"string");return H0(t)=="symbol"?t:t+""}function y5e(e,t){if(H0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(H0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var MG=1,v5e=function(e){function t(){var r;u5e(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=f5e(this,t,[].concat(o)),tF(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),tF(r,"handleKeyDown",function(d){if(d.key==="Escape"){var i,g,x,S;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(i=(g=r.props.coordinate)===null||g===void 0?void 0:g.x)!==null&&i!==void 0?i:0,y:(x=(S=r.props.coordinate)===null||S===void 0?void 0:S.y)!==null&&x!==void 0?x:0}})}}),r}return g5e(t,e),h5e(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>MG||Math.abs(n.height-this.state.lastBoundingBox.height)>MG)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,o;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((o=this.props.coordinate)===null||o===void 0?void 0:o.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,o=this.props,l=o.active,d=o.allowEscapeViewBox,i=o.animationDuration,g=o.animationEasing,x=o.children,S=o.coordinate,E=o.hasPayload,A=o.isAnimationActive,C=o.offset,N=o.position,k=o.reverseDirection,R=o.useTranslate3d,L=o.viewBox,j=o.wrapperStyle,F=c5e({allowEscapeViewBox:d,coordinate:S,offsetTopLeft:C,position:N,reverseDirection:k,tooltipBox:this.state.lastBoundingBox,useTranslate3d:R,viewBox:L}),B=F.cssClasses,U=F.cssProperties,Z=NG(NG({transition:A&&l?"transform ".concat(i,"ms ").concat(g):void 0},U),{},{pointerEvents:"none",visibility:!this.state.dismissed&&l&&E?"visible":"hidden",position:"absolute",top:0,left:0},j);return We.createElement("div",{tabIndex:-1,className:B,style:Z,ref:function(te){n.wrapperNode=te}},x)}}])}(G.PureComponent),_5e=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},wh={isSsr:_5e(),get:function(t){return wh[t]},set:function(t,r){if(typeof t=="string")wh[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(o){wh[o]=t[o]})}}};function K0(e){"@babel/helpers - typeof";return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K0(e)}function DG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function LG(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DG(Object(r),!0).forEach(function(n){s5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x5e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b5e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Poe(n.key),n)}}function w5e(e,t,r){return t&&b5e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function S5e(e,t,r){return t=qO(t),E5e(e,Aoe()?Reflect.construct(t,r||[],qO(e).constructor):t.apply(e,r))}function E5e(e,t){if(t&&(K0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return T5e(e)}function T5e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Aoe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Aoe=function(){return!!e})()}function qO(e){return qO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qO(e)}function A5e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rF(e,t)}function rF(e,t){return rF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},rF(e,t)}function s5(e,t,r){return t=Poe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Poe(e){var t=P5e(e,"string");return K0(t)=="symbol"?t:t+""}function P5e(e,t){if(K0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(K0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function C5e(e){return e.dataKey}function O5e(e,t){return We.isValidElement(e)?We.cloneElement(e,t):typeof e=="function"?We.createElement(e,t):We.createElement(n5e,t)}var Vs=function(e){function t(){return x5e(this,t),S5e(this,t,arguments)}return A5e(t,e),w5e(t,[{key:"render",value:function(){var n=this,o=this.props,l=o.active,d=o.allowEscapeViewBox,i=o.animationDuration,g=o.animationEasing,x=o.content,S=o.coordinate,E=o.filterNull,A=o.isAnimationActive,C=o.offset,N=o.payload,k=o.payloadUniqBy,R=o.position,L=o.reverseDirection,j=o.useTranslate3d,F=o.viewBox,B=o.wrapperStyle,U=N??[];E&&U.length&&(U=goe(N.filter(function(X){return X.value!=null&&(X.hide!==!0||n.props.includeHidden)}),k,C5e));var Z=U.length>0;return We.createElement(v5e,{allowEscapeViewBox:d,animationDuration:i,animationEasing:g,isAnimationActive:A,active:l,coordinate:S,hasPayload:Z,offset:C,position:R,reverseDirection:L,useTranslate3d:j,viewBox:F,wrapperStyle:B},O5e(x,LG(LG({},this.props),{},{payload:U})))}}])}(G.PureComponent);s5(Vs,"displayName","Tooltip");s5(Vs,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!wh.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var I5e=jh,k5e=function(){return I5e.Date.now()},R5e=k5e,j5e=/\s/;function N5e(e){for(var t=e.length;t--&&j5e.test(e.charAt(t)););return t}var M5e=N5e,D5e=M5e,L5e=/^\s+/;function F5e(e){return e&&e.slice(0,D5e(e)+1).replace(L5e,"")}var z5e=F5e,B5e=z5e,FG=og,$5e=Rb,zG=NaN,U5e=/^[-+]0x[0-9a-f]+$/i,V5e=/^0b[01]+$/i,q5e=/^0o[0-7]+$/i,W5e=parseInt;function G5e(e){if(typeof e=="number")return e;if($5e(e))return zG;if(FG(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=FG(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=B5e(e);var r=V5e.test(e);return r||q5e.test(e)?W5e(e.slice(2),r?2:8):U5e.test(e)?zG:+e}var Coe=G5e,H5e=og,nD=R5e,BG=Coe,K5e="Expected a function",Z5e=Math.max,X5e=Math.min;function Y5e(e,t,r){var n,o,l,d,i,g,x=0,S=!1,E=!1,A=!0;if(typeof e!="function")throw new TypeError(K5e);t=BG(t)||0,H5e(r)&&(S=!!r.leading,E="maxWait"in r,l=E?Z5e(BG(r.maxWait)||0,t):l,A="trailing"in r?!!r.trailing:A);function C(Z){var X=n,te=o;return n=o=void 0,x=Z,d=e.apply(te,X),d}function N(Z){return x=Z,i=setTimeout(L,t),S?C(Z):d}function k(Z){var X=Z-g,te=Z-x,se=t-X;return E?X5e(se,l-te):se}function R(Z){var X=Z-g,te=Z-x;return g===void 0||X>=t||X<0||E&&te>=l}function L(){var Z=nD();if(R(Z))return j(Z);i=setTimeout(L,k(Z))}function j(Z){return i=void 0,A&&n?C(Z):(n=o=void 0,d)}function F(){i!==void 0&&clearTimeout(i),x=0,n=g=o=i=void 0}function B(){return i===void 0?d:j(nD())}function U(){var Z=nD(),X=R(Z);if(n=arguments,o=this,g=Z,X){if(i===void 0)return N(g);if(E)return clearTimeout(i),i=setTimeout(L,t),C(g)}return i===void 0&&(i=setTimeout(L,t)),d}return U.cancel=F,U.flush=B,U}var J5e=Y5e,Q5e=J5e,e$e=og,t$e="Expected a function";function r$e(e,t,r){var n=!0,o=!0;if(typeof e!="function")throw new TypeError(t$e);return e$e(r)&&(n="leading"in r?!!r.leading:n,o="trailing"in r?!!r.trailing:o),Q5e(e,t,{leading:n,maxWait:t,trailing:o})}var n$e=r$e;const Ooe=va(n$e);function FE(e){"@babel/helpers - typeof";return FE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},FE(e)}function $G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function FP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$G(Object(r),!0).forEach(function(n){i$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$G(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i$e(e,t,r){return t=a$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a$e(e){var t=o$e(e,"string");return FE(t)=="symbol"?t:t+""}function o$e(e,t){if(FE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(FE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function s$e(e,t){return d$e(e)||u$e(e,t)||c$e(e,t)||l$e()}function l$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c$e(e,t){if(e){if(typeof e=="string")return UG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UG(e,t)}}function UG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function d$e(e){if(Array.isArray(e))return e}var Sm=G.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,o=n===void 0?{width:-1,height:-1}:n,l=e.width,d=l===void 0?"100%":l,i=e.height,g=i===void 0?"100%":i,x=e.minWidth,S=x===void 0?0:x,E=e.minHeight,A=e.maxHeight,C=e.children,N=e.debounce,k=N===void 0?0:N,R=e.id,L=e.className,j=e.onResize,F=e.style,B=F===void 0?{}:F,U=G.useRef(null),Z=G.useRef();Z.current=j,G.useImperativeHandle(t,function(){return Object.defineProperty(U.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),U.current},configurable:!0})});var X=G.useState({containerWidth:o.width,containerHeight:o.height}),te=s$e(X,2),se=te[0],oe=te[1],ne=G.useCallback(function(ie,he){oe(function(Se){var Ce=Math.round(ie),fe=Math.round(he);return Se.containerWidth===Ce&&Se.containerHeight===fe?Se:{containerWidth:Ce,containerHeight:fe}})},[]);G.useEffect(function(){var ie=function(be){var Pe,ye=be[0].contentRect,ge=ye.width,ke=ye.height;ne(ge,ke),(Pe=Z.current)===null||Pe===void 0||Pe.call(Z,ge,ke)};k>0&&(ie=Ooe(ie,k,{trailing:!0,leading:!1}));var he=new ResizeObserver(ie),Se=U.current.getBoundingClientRect(),Ce=Se.width,fe=Se.height;return ne(Ce,fe),he.observe(U.current),function(){he.disconnect()}},[ne,k]);var ee=G.useMemo(function(){var ie=se.containerWidth,he=se.containerHeight;if(ie<0||he<0)return null;Ed(My(d)||My(g),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,d,g),Ed(!r||r>0,"The aspect(%s) must be greater than zero.",r);var Se=My(d)?ie:d,Ce=My(g)?he:g;r&&r>0&&(Se?Ce=Se/r:Ce&&(Se=Ce*r),A&&Ce>A&&(Ce=A)),Ed(Se>0||Ce>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,Se,Ce,d,g,S,E,r);var fe=!Array.isArray(C)&&Af(C.type).endsWith("Chart");return We.Children.map(C,function(_e){return We.isValidElement(_e)?G.cloneElement(_e,FP({width:Se,height:Ce},fe?{style:FP({height:"100%",width:"100%",maxHeight:Ce,maxWidth:Se},_e.props.style)}:{})):_e})},[r,C,g,A,E,S,se,d]);return We.createElement("div",{id:R?"".concat(R):void 0,className:Ei("recharts-responsive-container",L),style:FP(FP({},B),{},{width:d,height:g,minWidth:S,minHeight:E,maxHeight:A}),ref:U},ee)}),zE=function(t){return null};zE.displayName="Cell";function BE(e){"@babel/helpers - typeof";return BE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},BE(e)}function VG(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function nF(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VG(Object(r),!0).forEach(function(n){h$e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VG(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h$e(e,t,r){return t=f$e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f$e(e){var t=p$e(e,"string");return BE(t)=="symbol"?t:t+""}function p$e(e,t){if(BE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(BE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var vx={widthCache:{},cacheCount:0},m$e=2e3,g$e={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},qG="recharts_measurement_span";function y$e(e){var t=nF({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var ZS=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||wh.isSsr)return{width:0,height:0};var n=y$e(r),o=JSON.stringify({text:t,copyStyle:n});if(vx.widthCache[o])return vx.widthCache[o];try{var l=document.getElementById(qG);l||(l=document.createElement("span"),l.setAttribute("id",qG),l.setAttribute("aria-hidden","true"),document.body.appendChild(l));var d=nF(nF({},g$e),n);Object.assign(l.style,d),l.textContent="".concat(t);var i=l.getBoundingClientRect(),g={width:i.width,height:i.height};return vx.widthCache[o]=g,++vx.cacheCount>m$e&&(vx.cacheCount=0,vx.widthCache={}),g}catch{return{width:0,height:0}}},v$e=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function $E(e){"@babel/helpers - typeof";return $E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$E(e)}function WO(e,t){return w$e(e)||b$e(e,t)||x$e(e,t)||_$e()}function _$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x$e(e,t){if(e){if(typeof e=="string")return WG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WG(e,t)}}function WG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function w$e(e){if(Array.isArray(e))return e}function S$e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function GG(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,T$e(n.key),n)}}function E$e(e,t,r){return t&&GG(e.prototype,t),r&&GG(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function T$e(e){var t=A$e(e,"string");return $E(t)=="symbol"?t:t+""}function A$e(e,t){if($E(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if($E(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var HG=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,KG=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,P$e=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,C$e=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,Ioe={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},O$e=Object.keys(Ioe),Bx="NaN";function I$e(e,t){return e*Ioe[t]}var zP=function(){function e(t,r){S$e(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!P$e.test(r)&&(this.num=NaN,this.unit=""),O$e.includes(r)&&(this.num=I$e(t,r),this.unit="px")}return E$e(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,o=(n=C$e.exec(r))!==null&&n!==void 0?n:[],l=WO(o,3),d=l[1],i=l[2];return new e(parseFloat(d),i??"")}}])}();function koe(e){if(e.includes(Bx))return Bx;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=HG.exec(t))!==null&&r!==void 0?r:[],o=WO(n,4),l=o[1],d=o[2],i=o[3],g=zP.parse(l??""),x=zP.parse(i??""),S=d==="*"?g.multiply(x):g.divide(x);if(S.isNaN())return Bx;t=t.replace(HG,S.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var E,A=(E=KG.exec(t))!==null&&E!==void 0?E:[],C=WO(A,4),N=C[1],k=C[2],R=C[3],L=zP.parse(N??""),j=zP.parse(R??""),F=k==="+"?L.add(j):L.subtract(j);if(F.isNaN())return Bx;t=t.replace(KG,F.toString())}return t}var ZG=/\(([^()]*)\)/;function k$e(e){for(var t=e;t.includes("(");){var r=ZG.exec(t),n=WO(r,2),o=n[1];t=t.replace(ZG,koe(o))}return t}function R$e(e){var t=e.replace(/\s+/g,"");return t=k$e(t),t=koe(t),t}function j$e(e){try{return R$e(e)}catch{return Bx}}function iD(e){var t=j$e(e.slice(5,-1));return t===Bx?"":t}var N$e=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],M$e=["dx","dy","angle","className","breakAll"];function iF(){return iF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},iF.apply(this,arguments)}function XG(e,t){if(e==null)return{};var r=D$e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function D$e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function YG(e,t){return B$e(e)||z$e(e,t)||F$e(e,t)||L$e()}function L$e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F$e(e,t){if(e){if(typeof e=="string")return JG(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return JG(e,t)}}function JG(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function z$e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;g=!1}else for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function B$e(e){if(Array.isArray(e))return e}var Roe=/[ \f\n\r\t\v\u2028\u2029]+/,joe=function(t){var r=t.children,n=t.breakAll,o=t.style;try{var l=[];bi(r)||(n?l=r.toString().split(""):l=r.toString().split(Roe));var d=l.map(function(g){return{word:g,width:ZS(g,o).width}}),i=n?0:ZS("",o).width;return{wordsWithComputedWidth:d,spaceWidth:i}}catch{return null}},$$e=function(t,r,n,o,l){var d=t.maxLines,i=t.children,g=t.style,x=t.breakAll,S=Fr(d),E=i,A=function(){var Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return Se.reduce(function(Ce,fe){var _e=fe.word,be=fe.width,Pe=Ce[Ce.length-1];if(Pe&&(o==null||l||Pe.width+be+n<Number(o)))Pe.words.push(_e),Pe.width+=be+n;else{var ye={words:[_e],width:be};Ce.push(ye)}return Ce},[])},C=A(r),N=function(Se){return Se.reduce(function(Ce,fe){return Ce.width>fe.width?Ce:fe})};if(!S)return C;for(var k="",R=function(Se){var Ce=E.slice(0,Se),fe=joe({breakAll:x,style:g,children:Ce+k}).wordsWithComputedWidth,_e=A(fe),be=_e.length>d||N(_e).width>Number(o);return[be,_e]},L=0,j=E.length-1,F=0,B;L<=j&&F<=E.length-1;){var U=Math.floor((L+j)/2),Z=U-1,X=R(Z),te=YG(X,2),se=te[0],oe=te[1],ne=R(U),ee=YG(ne,1),ie=ee[0];if(!se&&!ie&&(L=U+1),se&&ie&&(j=U-1),!se&&ie){B=oe;break}F++}return B||C},QG=function(t){var r=bi(t)?[]:t.toString().split(Roe);return[{words:r}]},U$e=function(t){var r=t.width,n=t.scaleToFit,o=t.children,l=t.style,d=t.breakAll,i=t.maxLines;if((r||n)&&!wh.isSsr){var g,x,S=joe({breakAll:d,children:o,style:l});if(S){var E=S.wordsWithComputedWidth,A=S.spaceWidth;g=E,x=A}else return QG(o);return $$e({breakAll:d,children:o,maxLines:i,style:l},g,x,r,n)}return QG(o)},eH="#808080",yv=function(t){var r=t.x,n=r===void 0?0:r,o=t.y,l=o===void 0?0:o,d=t.lineHeight,i=d===void 0?"1em":d,g=t.capHeight,x=g===void 0?"0.71em":g,S=t.scaleToFit,E=S===void 0?!1:S,A=t.textAnchor,C=A===void 0?"start":A,N=t.verticalAnchor,k=N===void 0?"end":N,R=t.fill,L=R===void 0?eH:R,j=XG(t,N$e),F=G.useMemo(function(){return U$e({breakAll:j.breakAll,children:j.children,maxLines:j.maxLines,scaleToFit:E,style:j.style,width:j.width})},[j.breakAll,j.children,j.maxLines,E,j.style,j.width]),B=j.dx,U=j.dy,Z=j.angle,X=j.className,te=j.breakAll,se=XG(j,M$e);if(!gs(n)||!gs(l))return null;var oe=n+(Fr(B)?B:0),ne=l+(Fr(U)?U:0),ee;switch(k){case"start":ee=iD("calc(".concat(x,")"));break;case"middle":ee=iD("calc(".concat((F.length-1)/2," * -").concat(i," + (").concat(x," / 2))"));break;default:ee=iD("calc(".concat(F.length-1," * -").concat(i,")"));break}var ie=[];if(E){var he=F[0].width,Se=j.width;ie.push("scale(".concat((Fr(Se)?Se/he:1)/he,")"))}return Z&&ie.push("rotate(".concat(Z,", ").concat(oe,", ").concat(ne,")")),ie.length&&(se.transform=ie.join(" ")),We.createElement("text",iF({},qn(se,!0),{x:oe,y:ne,className:Ei("recharts-text",X),textAnchor:C,fill:L.includes("url")?eH:L}),F.map(function(Ce,fe){var _e=Ce.words.join(te?"":" ");return We.createElement("tspan",{x:oe,dy:fe===0?ee:i,key:"".concat(_e,"-").concat(fe)},_e)}))};function Fm(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function V$e(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function l5(e){let t,r,n;e.length!==2?(t=Fm,r=(i,g)=>Fm(e(i),g),n=(i,g)=>e(i)-g):(t=e===Fm||e===V$e?e:q$e,r=e,n=e);function o(i,g,x=0,S=i.length){if(x<S){if(t(g,g)!==0)return S;do{const E=x+S>>>1;r(i[E],g)<0?x=E+1:S=E}while(x<S)}return x}function l(i,g,x=0,S=i.length){if(x<S){if(t(g,g)!==0)return S;do{const E=x+S>>>1;r(i[E],g)<=0?x=E+1:S=E}while(x<S)}return x}function d(i,g,x=0,S=i.length){const E=o(i,g,x,S-1);return E>x&&n(i[E-1],g)>-n(i[E],g)?E-1:E}return{left:o,center:d,right:l}}function q$e(){return 0}function Noe(e){return e===null?NaN:+e}function*W$e(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const G$e=l5(Fm),XT=G$e.right;l5(Noe).center;class tH extends Map{constructor(t,r=Z$e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,o]of t)this.set(n,o)}get(t){return super.get(rH(this,t))}has(t){return super.has(rH(this,t))}set(t,r){return super.set(H$e(this,t),r)}delete(t){return super.delete(K$e(this,t))}}function rH({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function H$e({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function K$e({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function Z$e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function X$e(e=Fm){if(e===Fm)return Moe;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function Moe(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const Y$e=Math.sqrt(50),J$e=Math.sqrt(10),Q$e=Math.sqrt(2);function GO(e,t,r){const n=(t-e)/Math.max(0,r),o=Math.floor(Math.log10(n)),l=n/Math.pow(10,o),d=l>=Y$e?10:l>=J$e?5:l>=Q$e?2:1;let i,g,x;return o<0?(x=Math.pow(10,-o)/d,i=Math.round(e*x),g=Math.round(t*x),i/x<e&&++i,g/x>t&&--g,x=-x):(x=Math.pow(10,o)*d,i=Math.round(e/x),g=Math.round(t/x),i*x<e&&++i,g*x>t&&--g),g<i&&.5<=r&&r<2?GO(e,t,r*2):[i,g,x]}function aF(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[o,l,d]=n?GO(t,e,r):GO(e,t,r);if(!(l>=o))return[];const i=l-o+1,g=new Array(i);if(n)if(d<0)for(let x=0;x<i;++x)g[x]=(l-x)/-d;else for(let x=0;x<i;++x)g[x]=(l-x)*d;else if(d<0)for(let x=0;x<i;++x)g[x]=(o+x)/-d;else for(let x=0;x<i;++x)g[x]=(o+x)*d;return g}function oF(e,t,r){return t=+t,e=+e,r=+r,GO(e,t,r)[2]}function sF(e,t,r){t=+t,e=+e,r=+r;const n=t<e,o=n?oF(t,e,r):oF(e,t,r);return(n?-1:1)*(o<0?1/-o:o)}function nH(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function iH(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function Doe(e,t,r=0,n=1/0,o){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(o=o===void 0?Moe:X$e(o);n>r;){if(n-r>600){const g=n-r+1,x=t-r+1,S=Math.log(g),E=.5*Math.exp(2*S/3),A=.5*Math.sqrt(S*E*(g-E)/g)*(x-g/2<0?-1:1),C=Math.max(r,Math.floor(t-x*E/g+A)),N=Math.min(n,Math.floor(t+(g-x)*E/g+A));Doe(e,t,C,N,o)}const l=e[t];let d=r,i=n;for(fS(e,r,t),o(e[n],l)>0&&fS(e,r,n);d<i;){for(fS(e,d,i),++d,--i;o(e[d],l)<0;)++d;for(;o(e[i],l)>0;)--i}o(e[r],l)===0?fS(e,r,i):(++i,fS(e,i,n)),i<=t&&(r=i+1),t<=i&&(n=i-1)}return e}function fS(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function eUe(e,t,r){if(e=Float64Array.from(W$e(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return iH(e);if(t>=1)return nH(e);var n,o=(n-1)*t,l=Math.floor(o),d=nH(Doe(e,l).subarray(0,l+1)),i=iH(e.subarray(l+1));return d+(i-d)*(o-l)}}function tUe(e,t,r=Noe){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*t,l=Math.floor(o),d=+r(e[l],l,e),i=+r(e[l+1],l+1,e);return d+(i-d)*(o-l)}}function rUe(e,t,r){e=+e,t=+t,r=(o=arguments.length)<2?(t=e,e=0,1):o<3?1:+r;for(var n=-1,o=Math.max(0,Math.ceil((t-e)/r))|0,l=new Array(o);++n<o;)l[n]=e+n*r;return l}function Fu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Kf(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const lF=Symbol("implicit");function c5(){var e=new tH,t=[],r=[],n=lF;function o(l){let d=e.get(l);if(d===void 0){if(n!==lF)return n;e.set(l,d=t.push(l)-1)}return r[d%r.length]}return o.domain=function(l){if(!arguments.length)return t.slice();t=[],e=new tH;for(const d of l)e.has(d)||e.set(d,t.push(d)-1);return o},o.range=function(l){return arguments.length?(r=Array.from(l),o):r.slice()},o.unknown=function(l){return arguments.length?(n=l,o):n},o.copy=function(){return c5(t,r).unknown(n)},Fu.apply(o,arguments),o}function UE(){var e=c5().unknown(void 0),t=e.domain,r=e.range,n=0,o=1,l,d,i=!1,g=0,x=0,S=.5;delete e.unknown;function E(){var A=t().length,C=o<n,N=C?o:n,k=C?n:o;l=(k-N)/Math.max(1,A-g+x*2),i&&(l=Math.floor(l)),N+=(k-N-l*(A-g))*S,d=l*(1-g),i&&(N=Math.round(N),d=Math.round(d));var R=rUe(A).map(function(L){return N+l*L});return r(C?R.reverse():R)}return e.domain=function(A){return arguments.length?(t(A),E()):t()},e.range=function(A){return arguments.length?([n,o]=A,n=+n,o=+o,E()):[n,o]},e.rangeRound=function(A){return[n,o]=A,n=+n,o=+o,i=!0,E()},e.bandwidth=function(){return d},e.step=function(){return l},e.round=function(A){return arguments.length?(i=!!A,E()):i},e.padding=function(A){return arguments.length?(g=Math.min(1,x=+A),E()):g},e.paddingInner=function(A){return arguments.length?(g=Math.min(1,A),E()):g},e.paddingOuter=function(A){return arguments.length?(x=+A,E()):x},e.align=function(A){return arguments.length?(S=Math.max(0,Math.min(1,A)),E()):S},e.copy=function(){return UE(t(),[n,o]).round(i).paddingInner(g).paddingOuter(x).align(S)},Fu.apply(E(),arguments)}function Loe(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Loe(t())},e}function XS(){return Loe(UE.apply(null,arguments).paddingInner(1))}function u5(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Foe(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function YT(){}var VE=.7,HO=1/VE,s0="\\s*([+-]?\\d+)\\s*",qE="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Sh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nUe=/^#([0-9a-f]{3,8})$/,iUe=new RegExp(`^rgb\\(${s0},${s0},${s0}\\)$`),aUe=new RegExp(`^rgb\\(${Sh},${Sh},${Sh}\\)$`),oUe=new RegExp(`^rgba\\(${s0},${s0},${s0},${qE}\\)$`),sUe=new RegExp(`^rgba\\(${Sh},${Sh},${Sh},${qE}\\)$`),lUe=new RegExp(`^hsl\\(${qE},${Sh},${Sh}\\)$`),cUe=new RegExp(`^hsla\\(${qE},${Sh},${Sh},${qE}\\)$`),aH={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};u5(YT,WE,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:oH,formatHex:oH,formatHex8:uUe,formatHsl:dUe,formatRgb:sH,toString:sH});function oH(){return this.rgb().formatHex()}function uUe(){return this.rgb().formatHex8()}function dUe(){return zoe(this).formatHsl()}function sH(){return this.rgb().formatRgb()}function WE(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=nUe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?lH(t):r===3?new vc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?BP(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?BP(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=iUe.exec(e))?new vc(t[1],t[2],t[3],1):(t=aUe.exec(e))?new vc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=oUe.exec(e))?BP(t[1],t[2],t[3],t[4]):(t=sUe.exec(e))?BP(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=lUe.exec(e))?dH(t[1],t[2]/100,t[3]/100,1):(t=cUe.exec(e))?dH(t[1],t[2]/100,t[3]/100,t[4]):aH.hasOwnProperty(e)?lH(aH[e]):e==="transparent"?new vc(NaN,NaN,NaN,0):null}function lH(e){return new vc(e>>16&255,e>>8&255,e&255,1)}function BP(e,t,r,n){return n<=0&&(e=t=r=NaN),new vc(e,t,r,n)}function hUe(e){return e instanceof YT||(e=WE(e)),e?(e=e.rgb(),new vc(e.r,e.g,e.b,e.opacity)):new vc}function cF(e,t,r,n){return arguments.length===1?hUe(e):new vc(e,t,r,n??1)}function vc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}u5(vc,cF,Foe(YT,{brighter(e){return e=e==null?HO:Math.pow(HO,e),new vc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?VE:Math.pow(VE,e),new vc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new vc(Jy(this.r),Jy(this.g),Jy(this.b),KO(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:cH,formatHex:cH,formatHex8:fUe,formatRgb:uH,toString:uH}));function cH(){return`#${Dy(this.r)}${Dy(this.g)}${Dy(this.b)}`}function fUe(){return`#${Dy(this.r)}${Dy(this.g)}${Dy(this.b)}${Dy((isNaN(this.opacity)?1:this.opacity)*255)}`}function uH(){const e=KO(this.opacity);return`${e===1?"rgb(":"rgba("}${Jy(this.r)}, ${Jy(this.g)}, ${Jy(this.b)}${e===1?")":`, ${e})`}`}function KO(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Jy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Dy(e){return e=Jy(e),(e<16?"0":"")+e.toString(16)}function dH(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new _d(e,t,r,n)}function zoe(e){if(e instanceof _d)return new _d(e.h,e.s,e.l,e.opacity);if(e instanceof YT||(e=WE(e)),!e)return new _d;if(e instanceof _d)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,o=Math.min(t,r,n),l=Math.max(t,r,n),d=NaN,i=l-o,g=(l+o)/2;return i?(t===l?d=(r-n)/i+(r<n)*6:r===l?d=(n-t)/i+2:d=(t-r)/i+4,i/=g<.5?l+o:2-l-o,d*=60):i=g>0&&g<1?0:d,new _d(d,i,g,e.opacity)}function pUe(e,t,r,n){return arguments.length===1?zoe(e):new _d(e,t,r,n??1)}function _d(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}u5(_d,pUe,Foe(YT,{brighter(e){return e=e==null?HO:Math.pow(HO,e),new _d(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?VE:Math.pow(VE,e),new _d(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,o=2*r-n;return new vc(aD(e>=240?e-240:e+120,o,n),aD(e,o,n),aD(e<120?e+240:e-120,o,n),this.opacity)},clamp(){return new _d(hH(this.h),$P(this.s),$P(this.l),KO(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=KO(this.opacity);return`${e===1?"hsl(":"hsla("}${hH(this.h)}, ${$P(this.s)*100}%, ${$P(this.l)*100}%${e===1?")":`, ${e})`}`}}));function hH(e){return e=(e||0)%360,e<0?e+360:e}function $P(e){return Math.max(0,Math.min(1,e||0))}function aD(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const d5=e=>()=>e;function mUe(e,t){return function(r){return e+r*t}}function gUe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function yUe(e){return(e=+e)==1?Boe:function(t,r){return r-t?gUe(t,r,e):d5(isNaN(t)?r:t)}}function Boe(e,t){var r=t-e;return r?mUe(e,r):d5(isNaN(e)?t:e)}const fH=function e(t){var r=yUe(t);function n(o,l){var d=r((o=cF(o)).r,(l=cF(l)).r),i=r(o.g,l.g),g=r(o.b,l.b),x=Boe(o.opacity,l.opacity);return function(S){return o.r=d(S),o.g=i(S),o.b=g(S),o.opacity=x(S),o+""}}return n.gamma=e,n}(1);function vUe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),o;return function(l){for(o=0;o<r;++o)n[o]=e[o]*(1-l)+t[o]*l;return n}}function _Ue(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function xUe(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,o=new Array(n),l=new Array(r),d;for(d=0;d<n;++d)o[d]=$b(e[d],t[d]);for(;d<r;++d)l[d]=t[d];return function(i){for(d=0;d<n;++d)l[d]=o[d](i);return l}}function bUe(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function ZO(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function wUe(e,t){var r={},n={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?r[o]=$b(e[o],t[o]):n[o]=t[o];return function(l){for(o in r)n[o]=r[o](l);return n}}var uF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oD=new RegExp(uF.source,"g");function SUe(e){return function(){return e}}function EUe(e){return function(t){return e(t)+""}}function TUe(e,t){var r=uF.lastIndex=oD.lastIndex=0,n,o,l,d=-1,i=[],g=[];for(e=e+"",t=t+"";(n=uF.exec(e))&&(o=oD.exec(t));)(l=o.index)>r&&(l=t.slice(r,l),i[d]?i[d]+=l:i[++d]=l),(n=n[0])===(o=o[0])?i[d]?i[d]+=o:i[++d]=o:(i[++d]=null,g.push({i:d,x:ZO(n,o)})),r=oD.lastIndex;return r<t.length&&(l=t.slice(r),i[d]?i[d]+=l:i[++d]=l),i.length<2?g[0]?EUe(g[0].x):SUe(t):(t=g.length,function(x){for(var S=0,E;S<t;++S)i[(E=g[S]).i]=E.x(x);return i.join("")})}function $b(e,t){var r=typeof t,n;return t==null||r==="boolean"?d5(t):(r==="number"?ZO:r==="string"?(n=WE(t))?(t=n,fH):TUe:t instanceof WE?fH:t instanceof Date?bUe:_Ue(t)?vUe:Array.isArray(t)?xUe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?wUe:ZO)(e,t)}function h5(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function AUe(e,t){t===void 0&&(t=e,e=$b);for(var r=0,n=t.length-1,o=t[0],l=new Array(n<0?0:n);r<n;)l[r]=e(o,o=t[++r]);return function(d){var i=Math.max(0,Math.min(n-1,Math.floor(d*=n)));return l[i](d-i)}}function PUe(e){return function(){return e}}function XO(e){return+e}var pH=[0,1];function ql(e){return e}function dF(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:PUe(isNaN(t)?NaN:.5)}function CUe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function OUe(e,t,r){var n=e[0],o=e[1],l=t[0],d=t[1];return o<n?(n=dF(o,n),l=r(d,l)):(n=dF(n,o),l=r(l,d)),function(i){return l(n(i))}}function IUe(e,t,r){var n=Math.min(e.length,t.length)-1,o=new Array(n),l=new Array(n),d=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++d<n;)o[d]=dF(e[d],e[d+1]),l[d]=r(t[d],t[d+1]);return function(i){var g=XT(e,i,1,n)-1;return l[g](o[g](i))}}function JT(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function cR(){var e=pH,t=pH,r=$b,n,o,l,d=ql,i,g,x;function S(){var A=Math.min(e.length,t.length);return d!==ql&&(d=CUe(e[0],e[A-1])),i=A>2?IUe:OUe,g=x=null,E}function E(A){return A==null||isNaN(A=+A)?l:(g||(g=i(e.map(n),t,r)))(n(d(A)))}return E.invert=function(A){return d(o((x||(x=i(t,e.map(n),ZO)))(A)))},E.domain=function(A){return arguments.length?(e=Array.from(A,XO),S()):e.slice()},E.range=function(A){return arguments.length?(t=Array.from(A),S()):t.slice()},E.rangeRound=function(A){return t=Array.from(A),r=h5,S()},E.clamp=function(A){return arguments.length?(d=A?!0:ql,S()):d!==ql},E.interpolate=function(A){return arguments.length?(r=A,S()):r},E.unknown=function(A){return arguments.length?(l=A,E):l},function(A,C){return n=A,o=C,S()}}function f5(){return cR()(ql,ql)}function kUe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function YO(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Z0(e){return e=YO(Math.abs(e)),e?e[1]:NaN}function RUe(e,t){return function(r,n){for(var o=r.length,l=[],d=0,i=e[0],g=0;o>0&&i>0&&(g+i+1>n&&(i=Math.max(1,n-g)),l.push(r.substring(o-=i,o+i)),!((g+=i+1)>n));)i=e[d=(d+1)%e.length];return l.reverse().join(t)}}function jUe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var NUe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function GE(e){if(!(t=NUe.exec(e)))throw new Error("invalid format: "+e);var t;return new p5({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}GE.prototype=p5.prototype;function p5(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}p5.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function MUe(e){e:for(var t=e.length,r=1,n=-1,o;r<t;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var $oe;function DUe(e,t){var r=YO(e,t);if(!r)return e+"";var n=r[0],o=r[1],l=o-($oe=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=n.length;return l===d?n:l>d?n+new Array(l-d+1).join("0"):l>0?n.slice(0,l)+"."+n.slice(l):"0."+new Array(1-l).join("0")+YO(e,Math.max(0,t+l-1))[0]}function mH(e,t){var r=YO(e,t);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}const gH={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:kUe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>mH(e*100,t),r:mH,s:DUe,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function yH(e){return e}var vH=Array.prototype.map,_H=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function LUe(e){var t=e.grouping===void 0||e.thousands===void 0?yH:RUe(vH.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",l=e.numerals===void 0?yH:jUe(vH.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",i=e.minus===void 0?"":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(E){E=GE(E);var A=E.fill,C=E.align,N=E.sign,k=E.symbol,R=E.zero,L=E.width,j=E.comma,F=E.precision,B=E.trim,U=E.type;U==="n"?(j=!0,U="g"):gH[U]||(F===void 0&&(F=12),B=!0,U="g"),(R||A==="0"&&C==="=")&&(R=!0,A="0",C="=");var Z=k==="$"?r:k==="#"&&/[boxX]/.test(U)?"0"+U.toLowerCase():"",X=k==="$"?n:/[%p]/.test(U)?d:"",te=gH[U],se=/[defgprs%]/.test(U);F=F===void 0?6:/[gprs]/.test(U)?Math.max(1,Math.min(21,F)):Math.max(0,Math.min(20,F));function oe(ne){var ee=Z,ie=X,he,Se,Ce;if(U==="c")ie=te(ne)+ie,ne="";else{ne=+ne;var fe=ne<0||1/ne<0;if(ne=isNaN(ne)?g:te(Math.abs(ne),F),B&&(ne=MUe(ne)),fe&&+ne==0&&N!=="+"&&(fe=!1),ee=(fe?N==="("?N:i:N==="-"||N==="("?"":N)+ee,ie=(U==="s"?_H[8+$oe/3]:"")+ie+(fe&&N==="("?")":""),se){for(he=-1,Se=ne.length;++he<Se;)if(Ce=ne.charCodeAt(he),48>Ce||Ce>57){ie=(Ce===46?o+ne.slice(he+1):ne.slice(he))+ie,ne=ne.slice(0,he);break}}}j&&!R&&(ne=t(ne,1/0));var _e=ee.length+ne.length+ie.length,be=_e<L?new Array(L-_e+1).join(A):"";switch(j&&R&&(ne=t(be+ne,be.length?L-ie.length:1/0),be=""),C){case"<":ne=ee+ne+ie+be;break;case"=":ne=ee+be+ne+ie;break;case"^":ne=be.slice(0,_e=be.length>>1)+ee+ne+ie+be.slice(_e);break;default:ne=be+ee+ne+ie;break}return l(ne)}return oe.toString=function(){return E+""},oe}function S(E,A){var C=x((E=GE(E),E.type="f",E)),N=Math.max(-8,Math.min(8,Math.floor(Z0(A)/3)))*3,k=Math.pow(10,-N),R=_H[8+N/3];return function(L){return C(k*L)+R}}return{format:x,formatPrefix:S}}var UP,m5,Uoe;FUe({thousands:",",grouping:[3],currency:["$",""]});function FUe(e){return UP=LUe(e),m5=UP.format,Uoe=UP.formatPrefix,UP}function zUe(e){return Math.max(0,-Z0(Math.abs(e)))}function BUe(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Z0(t)/3)))*3-Z0(Math.abs(e)))}function $Ue(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Z0(t)-Z0(e))+1}function Voe(e,t,r,n){var o=sF(e,t,r),l;switch(n=GE(n??",f"),n.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(l=BUe(o,d))&&(n.precision=l),Uoe(n,d)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(l=$Ue(o,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=l-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(l=zUe(o))&&(n.precision=l-(n.type==="%")*2);break}}return m5(n)}function sg(e){var t=e.domain;return e.ticks=function(r){var n=t();return aF(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var o=t();return Voe(o[0],o[o.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),o=0,l=n.length-1,d=n[o],i=n[l],g,x,S=10;for(i<d&&(x=d,d=i,i=x,x=o,o=l,l=x);S-- >0;){if(x=oF(d,i,r),x===g)return n[o]=d,n[l]=i,t(n);if(x>0)d=Math.floor(d/x)*x,i=Math.ceil(i/x)*x;else if(x<0)d=Math.ceil(d*x)/x,i=Math.floor(i*x)/x;else break;g=x}return e},e}function JO(){var e=f5();return e.copy=function(){return JT(e,JO())},Fu.apply(e,arguments),sg(e)}function qoe(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,XO),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return qoe(e).unknown(t)},e=arguments.length?Array.from(e,XO):[0,1],sg(r)}function Woe(e,t){e=e.slice();var r=0,n=e.length-1,o=e[r],l=e[n],d;return l<o&&(d=r,r=n,n=d,d=o,o=l,l=d),e[r]=t.floor(o),e[n]=t.ceil(l),e}function xH(e){return Math.log(e)}function bH(e){return Math.exp(e)}function UUe(e){return-Math.log(-e)}function VUe(e){return-Math.exp(-e)}function qUe(e){return isFinite(e)?+("1e"+e):e<0?0:e}function WUe(e){return e===10?qUe:e===Math.E?Math.exp:t=>Math.pow(e,t)}function GUe(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function wH(e){return(t,r)=>-e(-t,r)}function g5(e){const t=e(xH,bH),r=t.domain;let n=10,o,l;function d(){return o=GUe(n),l=WUe(n),r()[0]<0?(o=wH(o),l=wH(l),e(UUe,VUe)):e(xH,bH),t}return t.base=function(i){return arguments.length?(n=+i,d()):n},t.domain=function(i){return arguments.length?(r(i),d()):r()},t.ticks=i=>{const g=r();let x=g[0],S=g[g.length-1];const E=S<x;E&&([x,S]=[S,x]);let A=o(x),C=o(S),N,k;const R=i==null?10:+i;let L=[];if(!(n%1)&&C-A<R){if(A=Math.floor(A),C=Math.ceil(C),x>0){for(;A<=C;++A)for(N=1;N<n;++N)if(k=A<0?N/l(-A):N*l(A),!(k<x)){if(k>S)break;L.push(k)}}else for(;A<=C;++A)for(N=n-1;N>=1;--N)if(k=A>0?N/l(-A):N*l(A),!(k<x)){if(k>S)break;L.push(k)}L.length*2<R&&(L=aF(x,S,R))}else L=aF(A,C,Math.min(C-A,R)).map(l);return E?L.reverse():L},t.tickFormat=(i,g)=>{if(i==null&&(i=10),g==null&&(g=n===10?"s":","),typeof g!="function"&&(!(n%1)&&(g=GE(g)).precision==null&&(g.trim=!0),g=m5(g)),i===1/0)return g;const x=Math.max(1,n*i/t.ticks().length);return S=>{let E=S/l(Math.round(o(S)));return E*n<n-.5&&(E*=n),E<=x?g(S):""}},t.nice=()=>r(Woe(r(),{floor:i=>l(Math.floor(o(i))),ceil:i=>l(Math.ceil(o(i)))})),t}function Goe(){const e=g5(cR()).domain([1,10]);return e.copy=()=>JT(e,Goe()).base(e.base()),Fu.apply(e,arguments),e}function SH(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function EH(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function y5(e){var t=1,r=e(SH(t),EH(t));return r.constant=function(n){return arguments.length?e(SH(t=+n),EH(t)):t},sg(r)}function Hoe(){var e=y5(cR());return e.copy=function(){return JT(e,Hoe()).constant(e.constant())},Fu.apply(e,arguments)}function TH(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function HUe(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function KUe(e){return e<0?-e*e:e*e}function v5(e){var t=e(ql,ql),r=1;function n(){return r===1?e(ql,ql):r===.5?e(HUe,KUe):e(TH(r),TH(1/r))}return t.exponent=function(o){return arguments.length?(r=+o,n()):r},sg(t)}function _5(){var e=v5(cR());return e.copy=function(){return JT(e,_5()).exponent(e.exponent())},Fu.apply(e,arguments),e}function ZUe(){return _5.apply(null,arguments).exponent(.5)}function AH(e){return Math.sign(e)*e*e}function XUe(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function Koe(){var e=f5(),t=[0,1],r=!1,n;function o(l){var d=XUe(e(l));return isNaN(d)?n:r?Math.round(d):d}return o.invert=function(l){return e.invert(AH(l))},o.domain=function(l){return arguments.length?(e.domain(l),o):e.domain()},o.range=function(l){return arguments.length?(e.range((t=Array.from(l,XO)).map(AH)),o):t.slice()},o.rangeRound=function(l){return o.range(l).round(!0)},o.round=function(l){return arguments.length?(r=!!l,o):r},o.clamp=function(l){return arguments.length?(e.clamp(l),o):e.clamp()},o.unknown=function(l){return arguments.length?(n=l,o):n},o.copy=function(){return Koe(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},Fu.apply(o,arguments),sg(o)}function Zoe(){var e=[],t=[],r=[],n;function o(){var d=0,i=Math.max(1,t.length);for(r=new Array(i-1);++d<i;)r[d-1]=tUe(e,d/i);return l}function l(d){return d==null||isNaN(d=+d)?n:t[XT(r,d)]}return l.invertExtent=function(d){var i=t.indexOf(d);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},l.domain=function(d){if(!arguments.length)return e.slice();e=[];for(let i of d)i!=null&&!isNaN(i=+i)&&e.push(i);return e.sort(Fm),o()},l.range=function(d){return arguments.length?(t=Array.from(d),o()):t.slice()},l.unknown=function(d){return arguments.length?(n=d,l):n},l.quantiles=function(){return r.slice()},l.copy=function(){return Zoe().domain(e).range(t).unknown(n)},Fu.apply(l,arguments)}function Xoe(){var e=0,t=1,r=1,n=[.5],o=[0,1],l;function d(g){return g!=null&&g<=g?o[XT(n,g,0,r)]:l}function i(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*t-(g-r)*e)/(r+1);return d}return d.domain=function(g){return arguments.length?([e,t]=g,e=+e,t=+t,i()):[e,t]},d.range=function(g){return arguments.length?(r=(o=Array.from(g)).length-1,i()):o.slice()},d.invertExtent=function(g){var x=o.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],t]:[n[x-1],n[x]]},d.unknown=function(g){return arguments.length&&(l=g),d},d.thresholds=function(){return n.slice()},d.copy=function(){return Xoe().domain([e,t]).range(o).unknown(l)},Fu.apply(sg(d),arguments)}function Yoe(){var e=[.5],t=[0,1],r,n=1;function o(l){return l!=null&&l<=l?t[XT(e,l,0,n)]:r}return o.domain=function(l){return arguments.length?(e=Array.from(l),n=Math.min(e.length,t.length-1),o):e.slice()},o.range=function(l){return arguments.length?(t=Array.from(l),n=Math.min(e.length,t.length-1),o):t.slice()},o.invertExtent=function(l){var d=t.indexOf(l);return[e[d-1],e[d]]},o.unknown=function(l){return arguments.length?(r=l,o):r},o.copy=function(){return Yoe().domain(e).range(t).unknown(r)},Fu.apply(o,arguments)}const sD=new Date,lD=new Date;function vs(e,t,r,n){function o(l){return e(l=arguments.length===0?new Date:new Date(+l)),l}return o.floor=l=>(e(l=new Date(+l)),l),o.ceil=l=>(e(l=new Date(l-1)),t(l,1),e(l),l),o.round=l=>{const d=o(l),i=o.ceil(l);return l-d<i-l?d:i},o.offset=(l,d)=>(t(l=new Date(+l),d==null?1:Math.floor(d)),l),o.range=(l,d,i)=>{const g=[];if(l=o.ceil(l),i=i==null?1:Math.floor(i),!(l<d)||!(i>0))return g;let x;do g.push(x=new Date(+l)),t(l,i),e(l);while(x<l&&l<d);return g},o.filter=l=>vs(d=>{if(d>=d)for(;e(d),!l(d);)d.setTime(d-1)},(d,i)=>{if(d>=d)if(i<0)for(;++i<=0;)for(;t(d,-1),!l(d););else for(;--i>=0;)for(;t(d,1),!l(d););}),r&&(o.count=(l,d)=>(sD.setTime(+l),lD.setTime(+d),e(sD),e(lD),Math.floor(r(sD,lD))),o.every=l=>(l=Math.floor(l),!isFinite(l)||!(l>0)?null:l>1?o.filter(n?d=>n(d)%l===0:d=>o.count(0,d)%l===0):o)),o}const QO=vs(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);QO.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?vs(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):QO);QO.range;const bf=1e3,Su=bf*60,wf=Su*60,Lf=wf*24,x5=Lf*7,PH=Lf*30,cD=Lf*365,Ly=vs(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*bf)},(e,t)=>(t-e)/bf,e=>e.getUTCSeconds());Ly.range;const b5=vs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bf)},(e,t)=>{e.setTime(+e+t*Su)},(e,t)=>(t-e)/Su,e=>e.getMinutes());b5.range;const w5=vs(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Su)},(e,t)=>(t-e)/Su,e=>e.getUTCMinutes());w5.range;const S5=vs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*bf-e.getMinutes()*Su)},(e,t)=>{e.setTime(+e+t*wf)},(e,t)=>(t-e)/wf,e=>e.getHours());S5.range;const E5=vs(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*wf)},(e,t)=>(t-e)/wf,e=>e.getUTCHours());E5.range;const QT=vs(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Su)/Lf,e=>e.getDate()-1);QT.range;const uR=vs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Lf,e=>e.getUTCDate()-1);uR.range;const Joe=vs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Lf,e=>Math.floor(e/Lf));Joe.range;function Rv(e){return vs(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Su)/x5)}const dR=Rv(0),eI=Rv(1),YUe=Rv(2),JUe=Rv(3),X0=Rv(4),QUe=Rv(5),eVe=Rv(6);dR.range;eI.range;YUe.range;JUe.range;X0.range;QUe.range;eVe.range;function jv(e){return vs(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/x5)}const hR=jv(0),tI=jv(1),tVe=jv(2),rVe=jv(3),Y0=jv(4),nVe=jv(5),iVe=jv(6);hR.range;tI.range;tVe.range;rVe.range;Y0.range;nVe.range;iVe.range;const T5=vs(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());T5.range;const A5=vs(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());A5.range;const Ff=vs(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Ff.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:vs(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Ff.range;const zf=vs(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());zf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:vs(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});zf.range;function Qoe(e,t,r,n,o,l){const d=[[Ly,1,bf],[Ly,5,5*bf],[Ly,15,15*bf],[Ly,30,30*bf],[l,1,Su],[l,5,5*Su],[l,15,15*Su],[l,30,30*Su],[o,1,wf],[o,3,3*wf],[o,6,6*wf],[o,12,12*wf],[n,1,Lf],[n,2,2*Lf],[r,1,x5],[t,1,PH],[t,3,3*PH],[e,1,cD]];function i(x,S,E){const A=S<x;A&&([x,S]=[S,x]);const C=E&&typeof E.range=="function"?E:g(x,S,E),N=C?C.range(x,+S+1):[];return A?N.reverse():N}function g(x,S,E){const A=Math.abs(S-x)/E,C=l5(([,,R])=>R).right(d,A);if(C===d.length)return e.every(sF(x/cD,S/cD,E));if(C===0)return QO.every(Math.max(sF(x,S,E),1));const[N,k]=d[A/d[C-1][2]<d[C][2]/A?C-1:C];return N.every(k)}return[i,g]}const[aVe,oVe]=Qoe(zf,A5,hR,Joe,E5,w5),[sVe,lVe]=Qoe(Ff,T5,dR,QT,S5,b5);function uD(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function dD(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function pS(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function cVe(e){var t=e.dateTime,r=e.date,n=e.time,o=e.periods,l=e.days,d=e.shortDays,i=e.months,g=e.shortMonths,x=mS(o),S=gS(o),E=mS(l),A=gS(l),C=mS(d),N=gS(d),k=mS(i),R=gS(i),L=mS(g),j=gS(g),F={a:fe,A:_e,b:be,B:Pe,c:null,d:jH,e:jH,f:RVe,g:UVe,G:qVe,H:OVe,I:IVe,j:kVe,L:ese,m:jVe,M:NVe,p:ye,q:ge,Q:DH,s:LH,S:MVe,u:DVe,U:LVe,V:FVe,w:zVe,W:BVe,x:null,X:null,y:$Ve,Y:VVe,Z:WVe,"%":MH},B={a:ke,A:Qe,b:He,B:$e,c:null,d:NH,e:NH,f:ZVe,g:a6e,G:s6e,H:GVe,I:HVe,j:KVe,L:rse,m:XVe,M:YVe,p:Xe,q:ft,Q:DH,s:LH,S:JVe,u:QVe,U:e6e,V:t6e,w:r6e,W:n6e,x:null,X:null,y:i6e,Y:o6e,Z:l6e,"%":MH},U={a:oe,A:ne,b:ee,B:ie,c:he,d:kH,e:kH,f:TVe,g:IH,G:OH,H:RH,I:RH,j:bVe,L:EVe,m:xVe,M:wVe,p:se,q:_Ve,Q:PVe,s:CVe,S:SVe,u:pVe,U:mVe,V:gVe,w:fVe,W:yVe,x:Se,X:Ce,y:IH,Y:OH,Z:vVe,"%":AVe};F.x=Z(r,F),F.X=Z(n,F),F.c=Z(t,F),B.x=Z(r,B),B.X=Z(n,B),B.c=Z(t,B);function Z(ze,ut){return function(At){var xt=[],nr=-1,Vt=0,dr=ze.length,Br,Yr,_t;for(At instanceof Date||(At=new Date(+At));++nr<dr;)ze.charCodeAt(nr)===37&&(xt.push(ze.slice(Vt,nr)),(Yr=CH[Br=ze.charAt(++nr)])!=null?Br=ze.charAt(++nr):Yr=Br==="e"?" ":"0",(_t=ut[Br])&&(Br=_t(At,Yr)),xt.push(Br),Vt=nr+1);return xt.push(ze.slice(Vt,nr)),xt.join("")}}function X(ze,ut){return function(At){var xt=pS(1900,void 0,1),nr=te(xt,ze,At+="",0),Vt,dr;if(nr!=At.length)return null;if("Q"in xt)return new Date(xt.Q);if("s"in xt)return new Date(xt.s*1e3+("L"in xt?xt.L:0));if(ut&&!("Z"in xt)&&(xt.Z=0),"p"in xt&&(xt.H=xt.H%12+xt.p*12),xt.m===void 0&&(xt.m="q"in xt?xt.q:0),"V"in xt){if(xt.V<1||xt.V>53)return null;"w"in xt||(xt.w=1),"Z"in xt?(Vt=dD(pS(xt.y,0,1)),dr=Vt.getUTCDay(),Vt=dr>4||dr===0?tI.ceil(Vt):tI(Vt),Vt=uR.offset(Vt,(xt.V-1)*7),xt.y=Vt.getUTCFullYear(),xt.m=Vt.getUTCMonth(),xt.d=Vt.getUTCDate()+(xt.w+6)%7):(Vt=uD(pS(xt.y,0,1)),dr=Vt.getDay(),Vt=dr>4||dr===0?eI.ceil(Vt):eI(Vt),Vt=QT.offset(Vt,(xt.V-1)*7),xt.y=Vt.getFullYear(),xt.m=Vt.getMonth(),xt.d=Vt.getDate()+(xt.w+6)%7)}else("W"in xt||"U"in xt)&&("w"in xt||(xt.w="u"in xt?xt.u%7:"W"in xt?1:0),dr="Z"in xt?dD(pS(xt.y,0,1)).getUTCDay():uD(pS(xt.y,0,1)).getDay(),xt.m=0,xt.d="W"in xt?(xt.w+6)%7+xt.W*7-(dr+5)%7:xt.w+xt.U*7-(dr+6)%7);return"Z"in xt?(xt.H+=xt.Z/100|0,xt.M+=xt.Z%100,dD(xt)):uD(xt)}}function te(ze,ut,At,xt){for(var nr=0,Vt=ut.length,dr=At.length,Br,Yr;nr<Vt;){if(xt>=dr)return-1;if(Br=ut.charCodeAt(nr++),Br===37){if(Br=ut.charAt(nr++),Yr=U[Br in CH?ut.charAt(nr++):Br],!Yr||(xt=Yr(ze,At,xt))<0)return-1}else if(Br!=At.charCodeAt(xt++))return-1}return xt}function se(ze,ut,At){var xt=x.exec(ut.slice(At));return xt?(ze.p=S.get(xt[0].toLowerCase()),At+xt[0].length):-1}function oe(ze,ut,At){var xt=C.exec(ut.slice(At));return xt?(ze.w=N.get(xt[0].toLowerCase()),At+xt[0].length):-1}function ne(ze,ut,At){var xt=E.exec(ut.slice(At));return xt?(ze.w=A.get(xt[0].toLowerCase()),At+xt[0].length):-1}function ee(ze,ut,At){var xt=L.exec(ut.slice(At));return xt?(ze.m=j.get(xt[0].toLowerCase()),At+xt[0].length):-1}function ie(ze,ut,At){var xt=k.exec(ut.slice(At));return xt?(ze.m=R.get(xt[0].toLowerCase()),At+xt[0].length):-1}function he(ze,ut,At){return te(ze,t,ut,At)}function Se(ze,ut,At){return te(ze,r,ut,At)}function Ce(ze,ut,At){return te(ze,n,ut,At)}function fe(ze){return d[ze.getDay()]}function _e(ze){return l[ze.getDay()]}function be(ze){return g[ze.getMonth()]}function Pe(ze){return i[ze.getMonth()]}function ye(ze){return o[+(ze.getHours()>=12)]}function ge(ze){return 1+~~(ze.getMonth()/3)}function ke(ze){return d[ze.getUTCDay()]}function Qe(ze){return l[ze.getUTCDay()]}function He(ze){return g[ze.getUTCMonth()]}function $e(ze){return i[ze.getUTCMonth()]}function Xe(ze){return o[+(ze.getUTCHours()>=12)]}function ft(ze){return 1+~~(ze.getUTCMonth()/3)}return{format:function(ze){var ut=Z(ze+="",F);return ut.toString=function(){return ze},ut},parse:function(ze){var ut=X(ze+="",!1);return ut.toString=function(){return ze},ut},utcFormat:function(ze){var ut=Z(ze+="",B);return ut.toString=function(){return ze},ut},utcParse:function(ze){var ut=X(ze+="",!0);return ut.toString=function(){return ze},ut}}}var CH={"-":"",_:" ",0:"0"},ks=/^\s*\d+/,uVe=/^%/,dVe=/[\\^$*+?|[\]().{}]/g;function ya(e,t,r){var n=e<0?"-":"",o=(n?-e:e)+"",l=o.length;return n+(l<r?new Array(r-l+1).join(t)+o:o)}function hVe(e){return e.replace(dVe,"\\$&")}function mS(e){return new RegExp("^(?:"+e.map(hVe).join("|")+")","i")}function gS(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function fVe(e,t,r){var n=ks.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function pVe(e,t,r){var n=ks.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function mVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function gVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function yVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function OH(e,t,r){var n=ks.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function IH(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function vVe(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function _Ve(e,t,r){var n=ks.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function xVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function kH(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function bVe(e,t,r){var n=ks.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function RH(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function wVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function SVe(e,t,r){var n=ks.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function EVe(e,t,r){var n=ks.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function TVe(e,t,r){var n=ks.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function AVe(e,t,r){var n=uVe.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function PVe(e,t,r){var n=ks.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function CVe(e,t,r){var n=ks.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function jH(e,t){return ya(e.getDate(),t,2)}function OVe(e,t){return ya(e.getHours(),t,2)}function IVe(e,t){return ya(e.getHours()%12||12,t,2)}function kVe(e,t){return ya(1+QT.count(Ff(e),e),t,3)}function ese(e,t){return ya(e.getMilliseconds(),t,3)}function RVe(e,t){return ese(e,t)+"000"}function jVe(e,t){return ya(e.getMonth()+1,t,2)}function NVe(e,t){return ya(e.getMinutes(),t,2)}function MVe(e,t){return ya(e.getSeconds(),t,2)}function DVe(e){var t=e.getDay();return t===0?7:t}function LVe(e,t){return ya(dR.count(Ff(e)-1,e),t,2)}function tse(e){var t=e.getDay();return t>=4||t===0?X0(e):X0.ceil(e)}function FVe(e,t){return e=tse(e),ya(X0.count(Ff(e),e)+(Ff(e).getDay()===4),t,2)}function zVe(e){return e.getDay()}function BVe(e,t){return ya(eI.count(Ff(e)-1,e),t,2)}function $Ve(e,t){return ya(e.getFullYear()%100,t,2)}function UVe(e,t){return e=tse(e),ya(e.getFullYear()%100,t,2)}function VVe(e,t){return ya(e.getFullYear()%1e4,t,4)}function qVe(e,t){var r=e.getDay();return e=r>=4||r===0?X0(e):X0.ceil(e),ya(e.getFullYear()%1e4,t,4)}function WVe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ya(t/60|0,"0",2)+ya(t%60,"0",2)}function NH(e,t){return ya(e.getUTCDate(),t,2)}function GVe(e,t){return ya(e.getUTCHours(),t,2)}function HVe(e,t){return ya(e.getUTCHours()%12||12,t,2)}function KVe(e,t){return ya(1+uR.count(zf(e),e),t,3)}function rse(e,t){return ya(e.getUTCMilliseconds(),t,3)}function ZVe(e,t){return rse(e,t)+"000"}function XVe(e,t){return ya(e.getUTCMonth()+1,t,2)}function YVe(e,t){return ya(e.getUTCMinutes(),t,2)}function JVe(e,t){return ya(e.getUTCSeconds(),t,2)}function QVe(e){var t=e.getUTCDay();return t===0?7:t}function e6e(e,t){return ya(hR.count(zf(e)-1,e),t,2)}function nse(e){var t=e.getUTCDay();return t>=4||t===0?Y0(e):Y0.ceil(e)}function t6e(e,t){return e=nse(e),ya(Y0.count(zf(e),e)+(zf(e).getUTCDay()===4),t,2)}function r6e(e){return e.getUTCDay()}function n6e(e,t){return ya(tI.count(zf(e)-1,e),t,2)}function i6e(e,t){return ya(e.getUTCFullYear()%100,t,2)}function a6e(e,t){return e=nse(e),ya(e.getUTCFullYear()%100,t,2)}function o6e(e,t){return ya(e.getUTCFullYear()%1e4,t,4)}function s6e(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Y0(e):Y0.ceil(e),ya(e.getUTCFullYear()%1e4,t,4)}function l6e(){return"+0000"}function MH(){return"%"}function DH(e){return+e}function LH(e){return Math.floor(+e/1e3)}var _x,ise,ase;c6e({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function c6e(e){return _x=cVe(e),ise=_x.format,_x.parse,ase=_x.utcFormat,_x.utcParse,_x}function u6e(e){return new Date(e)}function d6e(e){return e instanceof Date?+e:+new Date(+e)}function P5(e,t,r,n,o,l,d,i,g,x){var S=f5(),E=S.invert,A=S.domain,C=x(".%L"),N=x(":%S"),k=x("%I:%M"),R=x("%I %p"),L=x("%a %d"),j=x("%b %d"),F=x("%B"),B=x("%Y");function U(Z){return(g(Z)<Z?C:i(Z)<Z?N:d(Z)<Z?k:l(Z)<Z?R:n(Z)<Z?o(Z)<Z?L:j:r(Z)<Z?F:B)(Z)}return S.invert=function(Z){return new Date(E(Z))},S.domain=function(Z){return arguments.length?A(Array.from(Z,d6e)):A().map(u6e)},S.ticks=function(Z){var X=A();return e(X[0],X[X.length-1],Z??10)},S.tickFormat=function(Z,X){return X==null?U:x(X)},S.nice=function(Z){var X=A();return(!Z||typeof Z.range!="function")&&(Z=t(X[0],X[X.length-1],Z??10)),Z?A(Woe(X,Z)):S},S.copy=function(){return JT(S,P5(e,t,r,n,o,l,d,i,g,x))},S}function h6e(){return Fu.apply(P5(sVe,lVe,Ff,T5,dR,QT,S5,b5,Ly,ise).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function f6e(){return Fu.apply(P5(aVe,oVe,zf,A5,hR,uR,E5,w5,Ly,ase).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function fR(){var e=0,t=1,r,n,o,l,d=ql,i=!1,g;function x(E){return E==null||isNaN(E=+E)?g:d(o===0?.5:(E=(l(E)-r)*o,i?Math.max(0,Math.min(1,E)):E))}x.domain=function(E){return arguments.length?([e,t]=E,r=l(e=+e),n=l(t=+t),o=r===n?0:1/(n-r),x):[e,t]},x.clamp=function(E){return arguments.length?(i=!!E,x):i},x.interpolator=function(E){return arguments.length?(d=E,x):d};function S(E){return function(A){var C,N;return arguments.length?([C,N]=A,d=E(C,N),x):[d(0),d(1)]}}return x.range=S($b),x.rangeRound=S(h5),x.unknown=function(E){return arguments.length?(g=E,x):g},function(E){return l=E,r=E(e),n=E(t),o=r===n?0:1/(n-r),x}}function lg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function ose(){var e=sg(fR()(ql));return e.copy=function(){return lg(e,ose())},Kf.apply(e,arguments)}function sse(){var e=g5(fR()).domain([1,10]);return e.copy=function(){return lg(e,sse()).base(e.base())},Kf.apply(e,arguments)}function lse(){var e=y5(fR());return e.copy=function(){return lg(e,lse()).constant(e.constant())},Kf.apply(e,arguments)}function C5(){var e=v5(fR());return e.copy=function(){return lg(e,C5()).exponent(e.exponent())},Kf.apply(e,arguments)}function p6e(){return C5.apply(null,arguments).exponent(.5)}function cse(){var e=[],t=ql;function r(n){if(n!=null&&!isNaN(n=+n))return t((XT(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let o of n)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Fm),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,o)=>t(o/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(o,l)=>eUe(e,l/n))},r.copy=function(){return cse(t).domain(e)},Kf.apply(r,arguments)}function pR(){var e=0,t=.5,r=1,n=1,o,l,d,i,g,x=ql,S,E=!1,A;function C(k){return isNaN(k=+k)?A:(k=.5+((k=+S(k))-l)*(n*k<n*l?i:g),x(E?Math.max(0,Math.min(1,k)):k))}C.domain=function(k){return arguments.length?([e,t,r]=k,o=S(e=+e),l=S(t=+t),d=S(r=+r),i=o===l?0:.5/(l-o),g=l===d?0:.5/(d-l),n=l<o?-1:1,C):[e,t,r]},C.clamp=function(k){return arguments.length?(E=!!k,C):E},C.interpolator=function(k){return arguments.length?(x=k,C):x};function N(k){return function(R){var L,j,F;return arguments.length?([L,j,F]=R,x=AUe(k,[L,j,F]),C):[x(0),x(.5),x(1)]}}return C.range=N($b),C.rangeRound=N(h5),C.unknown=function(k){return arguments.length?(A=k,C):A},function(k){return S=k,o=k(e),l=k(t),d=k(r),i=o===l?0:.5/(l-o),g=l===d?0:.5/(d-l),n=l<o?-1:1,C}}function use(){var e=sg(pR()(ql));return e.copy=function(){return lg(e,use())},Kf.apply(e,arguments)}function dse(){var e=g5(pR()).domain([.1,1,10]);return e.copy=function(){return lg(e,dse()).base(e.base())},Kf.apply(e,arguments)}function hse(){var e=y5(pR());return e.copy=function(){return lg(e,hse()).constant(e.constant())},Kf.apply(e,arguments)}function O5(){var e=v5(pR());return e.copy=function(){return lg(e,O5()).exponent(e.exponent())},Kf.apply(e,arguments)}function m6e(){return O5.apply(null,arguments).exponent(.5)}const FH=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:UE,scaleDiverging:use,scaleDivergingLog:dse,scaleDivergingPow:O5,scaleDivergingSqrt:m6e,scaleDivergingSymlog:hse,scaleIdentity:qoe,scaleImplicit:lF,scaleLinear:JO,scaleLog:Goe,scaleOrdinal:c5,scalePoint:XS,scalePow:_5,scaleQuantile:Zoe,scaleQuantize:Xoe,scaleRadial:Koe,scaleSequential:ose,scaleSequentialLog:sse,scaleSequentialPow:C5,scaleSequentialQuantile:cse,scaleSequentialSqrt:p6e,scaleSequentialSymlog:lse,scaleSqrt:ZUe,scaleSymlog:Hoe,scaleThreshold:Yoe,scaleTime:h6e,scaleUtc:f6e,tickFormat:Voe},Symbol.toStringTag,{value:"Module"}));var g6e=Rb;function y6e(e,t,r){for(var n=-1,o=e.length;++n<o;){var l=e[n],d=t(l);if(d!=null&&(i===void 0?d===d&&!g6e(d):r(d,i)))var i=d,g=l}return g}var mR=y6e;function v6e(e,t){return e>t}var fse=v6e,_6e=mR,x6e=fse,b6e=Bb;function w6e(e){return e&&e.length?_6e(e,b6e,x6e):void 0}var S6e=w6e;const gR=va(S6e);function E6e(e,t){return e<t}var pse=E6e,T6e=mR,A6e=pse,P6e=Bb;function C6e(e){return e&&e.length?T6e(e,P6e,A6e):void 0}var O6e=C6e;const yR=va(O6e);var I6e=V4,k6e=Nh,R6e=woe,j6e=Ac;function N6e(e,t){var r=j6e(e)?I6e:R6e;return r(e,k6e(t))}var M6e=N6e,D6e=xoe,L6e=M6e;function F6e(e,t){return D6e(L6e(e,t),1)}var z6e=F6e;const B6e=va(z6e);var $6e=i5;function U6e(e,t){return $6e(e,t)}var mse=U6e;const eA=va(mse);var Ub=1e9,V6e={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},k5,ho=!0,Nu="[DecimalError] ",Qy=Nu+"Invalid argument: ",I5=Nu+"Exponent out of range: ",Vb=Math.floor,Ay=Math.pow,q6e=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,qc,Ts=1e7,io=7,gse=9007199254740991,rI=Vb(gse/io),_n={};_n.absoluteValue=_n.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};_n.comparedTo=_n.cmp=function(e){var t,r,n,o,l=this;if(e=new l.constructor(e),l.s!==e.s)return l.s||-e.s;if(l.e!==e.e)return l.e>e.e^l.s<0?1:-1;for(n=l.d.length,o=e.d.length,t=0,r=n<o?n:o;t<r;++t)if(l.d[t]!==e.d[t])return l.d[t]>e.d[t]^l.s<0?1:-1;return n===o?0:n>o^l.s<0?1:-1};_n.decimalPlaces=_n.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*io;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};_n.dividedBy=_n.div=function(e){return Pf(this,new this.constructor(e))};_n.dividedToIntegerBy=_n.idiv=function(e){var t=this,r=t.constructor;return $a(Pf(t,new r(e),0,1),r.precision)};_n.equals=_n.eq=function(e){return!this.cmp(e)};_n.exponent=function(){return es(this)};_n.greaterThan=_n.gt=function(e){return this.cmp(e)>0};_n.greaterThanOrEqualTo=_n.gte=function(e){return this.cmp(e)>=0};_n.isInteger=_n.isint=function(){return this.e>this.d.length-2};_n.isNegative=_n.isneg=function(){return this.s<0};_n.isPositive=_n.ispos=function(){return this.s>0};_n.isZero=function(){return this.s===0};_n.lessThan=_n.lt=function(e){return this.cmp(e)<0};_n.lessThanOrEqualTo=_n.lte=function(e){return this.cmp(e)<1};_n.logarithm=_n.log=function(e){var t,r=this,n=r.constructor,o=n.precision,l=o+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(qc))throw Error(Nu+"NaN");if(r.s<1)throw Error(Nu+(r.s?"NaN":"-Infinity"));return r.eq(qc)?new n(0):(ho=!1,t=Pf(HE(r,l),HE(e,l),l),ho=!0,$a(t,o))};_n.minus=_n.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?_se(t,e):yse(t,(e.s=-e.s,e))};_n.modulo=_n.mod=function(e){var t,r=this,n=r.constructor,o=n.precision;if(e=new n(e),!e.s)throw Error(Nu+"NaN");return r.s?(ho=!1,t=Pf(r,e,0,1).times(e),ho=!0,r.minus(t)):$a(new n(r),o)};_n.naturalExponential=_n.exp=function(){return vse(this)};_n.naturalLogarithm=_n.ln=function(){return HE(this)};_n.negated=_n.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};_n.plus=_n.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?yse(t,e):_se(t,(e.s=-e.s,e))};_n.precision=_n.sd=function(e){var t,r,n,o=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Qy+e);if(t=es(o)+1,n=o.d.length-1,r=n*io+1,n=o.d[n],n){for(;n%10==0;n/=10)r--;for(n=o.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};_n.squareRoot=_n.sqrt=function(){var e,t,r,n,o,l,d,i=this,g=i.constructor;if(i.s<1){if(!i.s)return new g(0);throw Error(Nu+"NaN")}for(e=es(i),ho=!1,o=Math.sqrt(+i),o==0||o==1/0?(t=mh(i.d),(t.length+e)%2==0&&(t+="0"),o=Math.sqrt(t),e=Vb((e+1)/2)-(e<0||e%2),o==1/0?t="5e"+e:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new g(t)):n=new g(o.toString()),r=g.precision,o=d=r+3;;)if(l=n,n=l.plus(Pf(i,l,d+2)).times(.5),mh(l.d).slice(0,d)===(t=mh(n.d)).slice(0,d)){if(t=t.slice(d-3,d+1),o==d&&t=="4999"){if($a(l,r+1,0),l.times(l).eq(i)){n=l;break}}else if(t!="9999")break;d+=4}return ho=!0,$a(n,r)};_n.times=_n.mul=function(e){var t,r,n,o,l,d,i,g,x,S=this,E=S.constructor,A=S.d,C=(e=new E(e)).d;if(!S.s||!e.s)return new E(0);for(e.s*=S.s,r=S.e+e.e,g=A.length,x=C.length,g<x&&(l=A,A=C,C=l,d=g,g=x,x=d),l=[],d=g+x,n=d;n--;)l.push(0);for(n=x;--n>=0;){for(t=0,o=g+n;o>n;)i=l[o]+C[n]*A[o-n-1]+t,l[o--]=i%Ts|0,t=i/Ts|0;l[o]=(l[o]+t)%Ts|0}for(;!l[--d];)l.pop();return t?++r:l.shift(),e.d=l,e.e=r,ho?$a(e,E.precision):e};_n.toDecimalPlaces=_n.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Ph(e,0,Ub),t===void 0?t=n.rounding:Ph(t,0,8),$a(r,e+es(r)+1,t))};_n.toExponential=function(e,t){var r,n=this,o=n.constructor;return e===void 0?r=vv(n,!0):(Ph(e,0,Ub),t===void 0?t=o.rounding:Ph(t,0,8),n=$a(new o(n),e+1,t),r=vv(n,!0,e+1)),r};_n.toFixed=function(e,t){var r,n,o=this,l=o.constructor;return e===void 0?vv(o):(Ph(e,0,Ub),t===void 0?t=l.rounding:Ph(t,0,8),n=$a(new l(o),e+es(o)+1,t),r=vv(n.abs(),!1,e+es(n)+1),o.isneg()&&!o.isZero()?"-"+r:r)};_n.toInteger=_n.toint=function(){var e=this,t=e.constructor;return $a(new t(e),es(e)+1,t.rounding)};_n.toNumber=function(){return+this};_n.toPower=_n.pow=function(e){var t,r,n,o,l,d,i=this,g=i.constructor,x=12,S=+(e=new g(e));if(!e.s)return new g(qc);if(i=new g(i),!i.s){if(e.s<1)throw Error(Nu+"Infinity");return i}if(i.eq(qc))return i;if(n=g.precision,e.eq(qc))return $a(i,n);if(t=e.e,r=e.d.length-1,d=t>=r,l=i.s,d){if((r=S<0?-S:S)<=gse){for(o=new g(qc),t=Math.ceil(n/io+4),ho=!1;r%2&&(o=o.times(i),BH(o.d,t)),r=Vb(r/2),r!==0;)i=i.times(i),BH(i.d,t);return ho=!0,e.s<0?new g(qc).div(o):$a(o,n)}}else if(l<0)throw Error(Nu+"NaN");return l=l<0&&e.d[Math.max(t,r)]&1?-1:1,i.s=1,ho=!1,o=e.times(HE(i,n+x)),ho=!0,o=vse(o),o.s=l,o};_n.toPrecision=function(e,t){var r,n,o=this,l=o.constructor;return e===void 0?(r=es(o),n=vv(o,r<=l.toExpNeg||r>=l.toExpPos)):(Ph(e,1,Ub),t===void 0?t=l.rounding:Ph(t,0,8),o=$a(new l(o),e,t),r=es(o),n=vv(o,e<=r||r<=l.toExpNeg,e)),n};_n.toSignificantDigits=_n.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Ph(e,1,Ub),t===void 0?t=n.rounding:Ph(t,0,8)),$a(new n(r),e,t)};_n.toString=_n.valueOf=_n.val=_n.toJSON=_n[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=es(e),r=e.constructor;return vv(e,t<=r.toExpNeg||t>=r.toExpPos)};function yse(e,t){var r,n,o,l,d,i,g,x,S=e.constructor,E=S.precision;if(!e.s||!t.s)return t.s||(t=new S(e)),ho?$a(t,E):t;if(g=e.d,x=t.d,d=e.e,o=t.e,g=g.slice(),l=d-o,l){for(l<0?(n=g,l=-l,i=x.length):(n=x,o=d,i=g.length),d=Math.ceil(E/io),i=d>i?d+1:i+1,l>i&&(l=i,n.length=1),n.reverse();l--;)n.push(0);n.reverse()}for(i=g.length,l=x.length,i-l<0&&(l=i,n=x,x=g,g=n),r=0;l;)r=(g[--l]=g[l]+x[l]+r)/Ts|0,g[l]%=Ts;for(r&&(g.unshift(r),++o),i=g.length;g[--i]==0;)g.pop();return t.d=g,t.e=o,ho?$a(t,E):t}function Ph(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Qy+e)}function mh(e){var t,r,n,o=e.length-1,l="",d=e[0];if(o>0){for(l+=d,t=1;t<o;t++)n=e[t]+"",r=io-n.length,r&&(l+=em(r)),l+=n;d=e[t],n=d+"",r=io-n.length,r&&(l+=em(r))}else if(d===0)return"0";for(;d%10===0;)d/=10;return l+d}var Pf=function(){function e(n,o){var l,d=0,i=n.length;for(n=n.slice();i--;)l=n[i]*o+d,n[i]=l%Ts|0,d=l/Ts|0;return d&&n.unshift(d),n}function t(n,o,l,d){var i,g;if(l!=d)g=l>d?1:-1;else for(i=g=0;i<l;i++)if(n[i]!=o[i]){g=n[i]>o[i]?1:-1;break}return g}function r(n,o,l){for(var d=0;l--;)n[l]-=d,d=n[l]<o[l]?1:0,n[l]=d*Ts+n[l]-o[l];for(;!n[0]&&n.length>1;)n.shift()}return function(n,o,l,d){var i,g,x,S,E,A,C,N,k,R,L,j,F,B,U,Z,X,te,se=n.constructor,oe=n.s==o.s?1:-1,ne=n.d,ee=o.d;if(!n.s)return new se(n);if(!o.s)throw Error(Nu+"Division by zero");for(g=n.e-o.e,X=ee.length,U=ne.length,C=new se(oe),N=C.d=[],x=0;ee[x]==(ne[x]||0);)++x;if(ee[x]>(ne[x]||0)&&--g,l==null?j=l=se.precision:d?j=l+(es(n)-es(o))+1:j=l,j<0)return new se(0);if(j=j/io+2|0,x=0,X==1)for(S=0,ee=ee[0],j++;(x<U||S)&&j--;x++)F=S*Ts+(ne[x]||0),N[x]=F/ee|0,S=F%ee|0;else{for(S=Ts/(ee[0]+1)|0,S>1&&(ee=e(ee,S),ne=e(ne,S),X=ee.length,U=ne.length),B=X,k=ne.slice(0,X),R=k.length;R<X;)k[R++]=0;te=ee.slice(),te.unshift(0),Z=ee[0],ee[1]>=Ts/2&&++Z;do S=0,i=t(ee,k,X,R),i<0?(L=k[0],X!=R&&(L=L*Ts+(k[1]||0)),S=L/Z|0,S>1?(S>=Ts&&(S=Ts-1),E=e(ee,S),A=E.length,R=k.length,i=t(E,k,A,R),i==1&&(S--,r(E,X<A?te:ee,A))):(S==0&&(i=S=1),E=ee.slice()),A=E.length,A<R&&E.unshift(0),r(k,E,R),i==-1&&(R=k.length,i=t(ee,k,X,R),i<1&&(S++,r(k,X<R?te:ee,R))),R=k.length):i===0&&(S++,k=[0]),N[x++]=S,i&&k[0]?k[R++]=ne[B]||0:(k=[ne[B]],R=1);while((B++<U||k[0]!==void 0)&&j--)}return N[0]||N.shift(),C.e=g,$a(C,d?l+es(C)+1:l)}}();function vse(e,t){var r,n,o,l,d,i,g=0,x=0,S=e.constructor,E=S.precision;if(es(e)>16)throw Error(I5+es(e));if(!e.s)return new S(qc);for(t==null?(ho=!1,i=E):i=t,d=new S(.03125);e.abs().gte(.1);)e=e.times(d),x+=5;for(n=Math.log(Ay(2,x))/Math.LN10*2+5|0,i+=n,r=o=l=new S(qc),S.precision=i;;){if(o=$a(o.times(e),i),r=r.times(++g),d=l.plus(Pf(o,r,i)),mh(d.d).slice(0,i)===mh(l.d).slice(0,i)){for(;x--;)l=$a(l.times(l),i);return S.precision=E,t==null?(ho=!0,$a(l,E)):l}l=d}}function es(e){for(var t=e.e*io,r=e.d[0];r>=10;r/=10)t++;return t}function hD(e,t,r){if(t>e.LN10.sd())throw ho=!0,r&&(e.precision=r),Error(Nu+"LN10 precision limit exceeded");return $a(new e(e.LN10),t)}function em(e){for(var t="";e--;)t+="0";return t}function HE(e,t){var r,n,o,l,d,i,g,x,S,E=1,A=10,C=e,N=C.d,k=C.constructor,R=k.precision;if(C.s<1)throw Error(Nu+(C.s?"NaN":"-Infinity"));if(C.eq(qc))return new k(0);if(t==null?(ho=!1,x=R):x=t,C.eq(10))return t==null&&(ho=!0),hD(k,x);if(x+=A,k.precision=x,r=mh(N),n=r.charAt(0),l=es(C),Math.abs(l)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)C=C.times(e),r=mh(C.d),n=r.charAt(0),E++;l=es(C),n>1?(C=new k("0."+r),l++):C=new k(n+"."+r.slice(1))}else return g=hD(k,x+2,R).times(l+""),C=HE(new k(n+"."+r.slice(1)),x-A).plus(g),k.precision=R,t==null?(ho=!0,$a(C,R)):C;for(i=d=C=Pf(C.minus(qc),C.plus(qc),x),S=$a(C.times(C),x),o=3;;){if(d=$a(d.times(S),x),g=i.plus(Pf(d,new k(o),x)),mh(g.d).slice(0,x)===mh(i.d).slice(0,x))return i=i.times(2),l!==0&&(i=i.plus(hD(k,x+2,R).times(l+""))),i=Pf(i,new k(E),x),k.precision=R,t==null?(ho=!0,$a(i,R)):i;i=g,o+=2}}function zH(e,t){var r,n,o;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(o=t.length;t.charCodeAt(o-1)===48;)--o;if(t=t.slice(n,o),t){if(o-=n,r=r-n-1,e.e=Vb(r/io),e.d=[],n=(r+1)%io,r<0&&(n+=io),n<o){for(n&&e.d.push(+t.slice(0,n)),o-=io;n<o;)e.d.push(+t.slice(n,n+=io));t=t.slice(n),n=io-t.length}else n-=o;for(;n--;)t+="0";if(e.d.push(+t),ho&&(e.e>rI||e.e<-rI))throw Error(I5+r)}else e.s=0,e.e=0,e.d=[0];return e}function $a(e,t,r){var n,o,l,d,i,g,x,S,E=e.d;for(d=1,l=E[0];l>=10;l/=10)d++;if(n=t-d,n<0)n+=io,o=t,x=E[S=0];else{if(S=Math.ceil((n+1)/io),l=E.length,S>=l)return e;for(x=l=E[S],d=1;l>=10;l/=10)d++;n%=io,o=n-io+d}if(r!==void 0&&(l=Ay(10,d-o-1),i=x/l%10|0,g=t<0||E[S+1]!==void 0||x%l,g=r<4?(i||g)&&(r==0||r==(e.s<0?3:2)):i>5||i==5&&(r==4||g||r==6&&(n>0?o>0?x/Ay(10,d-o):0:E[S-1])%10&1||r==(e.s<0?8:7))),t<1||!E[0])return g?(l=es(e),E.length=1,t=t-l-1,E[0]=Ay(10,(io-t%io)%io),e.e=Vb(-t/io)||0):(E.length=1,E[0]=e.e=e.s=0),e;if(n==0?(E.length=S,l=1,S--):(E.length=S+1,l=Ay(10,io-n),E[S]=o>0?(x/Ay(10,d-o)%Ay(10,o)|0)*l:0),g)for(;;)if(S==0){(E[0]+=l)==Ts&&(E[0]=1,++e.e);break}else{if(E[S]+=l,E[S]!=Ts)break;E[S--]=0,l=1}for(n=E.length;E[--n]===0;)E.pop();if(ho&&(e.e>rI||e.e<-rI))throw Error(I5+es(e));return e}function _se(e,t){var r,n,o,l,d,i,g,x,S,E,A=e.constructor,C=A.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new A(e),ho?$a(t,C):t;if(g=e.d,E=t.d,n=t.e,x=e.e,g=g.slice(),d=x-n,d){for(S=d<0,S?(r=g,d=-d,i=E.length):(r=E,n=x,i=g.length),o=Math.max(Math.ceil(C/io),i)+2,d>o&&(d=o,r.length=1),r.reverse(),o=d;o--;)r.push(0);r.reverse()}else{for(o=g.length,i=E.length,S=o<i,S&&(i=o),o=0;o<i;o++)if(g[o]!=E[o]){S=g[o]<E[o];break}d=0}for(S&&(r=g,g=E,E=r,t.s=-t.s),i=g.length,o=E.length-i;o>0;--o)g[i++]=0;for(o=E.length;o>d;){if(g[--o]<E[o]){for(l=o;l&&g[--l]===0;)g[l]=Ts-1;--g[l],g[o]+=Ts}g[o]-=E[o]}for(;g[--i]===0;)g.pop();for(;g[0]===0;g.shift())--n;return g[0]?(t.d=g,t.e=n,ho?$a(t,C):t):new A(0)}function vv(e,t,r){var n,o=es(e),l=mh(e.d),d=l.length;return t?(r&&(n=r-d)>0?l=l.charAt(0)+"."+l.slice(1)+em(n):d>1&&(l=l.charAt(0)+"."+l.slice(1)),l=l+(o<0?"e":"e+")+o):o<0?(l="0."+em(-o-1)+l,r&&(n=r-d)>0&&(l+=em(n))):o>=d?(l+=em(o+1-d),r&&(n=r-o-1)>0&&(l=l+"."+em(n))):((n=o+1)<d&&(l=l.slice(0,n)+"."+l.slice(n)),r&&(n=r-d)>0&&(o+1===d&&(l+="."),l+=em(n))),e.s<0?"-"+l:l}function BH(e,t){if(e.length>t)return e.length=t,!0}function xse(e){var t,r,n;function o(l){var d=this;if(!(d instanceof o))return new o(l);if(d.constructor=o,l instanceof o){d.s=l.s,d.e=l.e,d.d=(l=l.d)?l.slice():l;return}if(typeof l=="number"){if(l*0!==0)throw Error(Qy+l);if(l>0)d.s=1;else if(l<0)l=-l,d.s=-1;else{d.s=0,d.e=0,d.d=[0];return}if(l===~~l&&l<1e7){d.e=0,d.d=[l];return}return zH(d,l.toString())}else if(typeof l!="string")throw Error(Qy+l);if(l.charCodeAt(0)===45?(l=l.slice(1),d.s=-1):d.s=1,q6e.test(l))zH(d,l);else throw Error(Qy+l)}if(o.prototype=_n,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.clone=xse,o.config=o.set=W6e,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return o.config(e),o}function W6e(e){if(!e||typeof e!="object")throw Error(Nu+"Object expected");var t,r,n,o=["precision",1,Ub,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<o.length;t+=3)if((n=e[r=o[t]])!==void 0)if(Vb(n)===n&&n>=o[t+1]&&n<=o[t+2])this[r]=n;else throw Error(Qy+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Qy+r+": "+n);return this}var k5=xse(V6e);qc=new k5(1);const Da=k5;function G6e(e){return X6e(e)||Z6e(e)||K6e(e)||H6e()}function H6e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function K6e(e,t){if(e){if(typeof e=="string")return hF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hF(e,t)}}function Z6e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function X6e(e){if(Array.isArray(e))return hF(e)}function hF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Y6e=function(t){return t},bse={"@@functional/placeholder":!0},wse=function(t){return t===bse},$H=function(t){return function r(){return arguments.length===0||arguments.length===1&&wse(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},J6e=function e(t,r){return t===1?r:$H(function(){for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];var d=o.filter(function(i){return i!==bse}).length;return d>=t?r.apply(void 0,o):e(t-d,$H(function(){for(var i=arguments.length,g=new Array(i),x=0;x<i;x++)g[x]=arguments[x];var S=o.map(function(E){return wse(E)?g.shift():E});return r.apply(void 0,G6e(S).concat(g))}))})},vR=function(t){return J6e(t.length,t)},fF=function(t,r){for(var n=[],o=t;o<r;++o)n[o-t]=o;return n},Q6e=vR(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),e8e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return Y6e;var o=r.reverse(),l=o[0],d=o.slice(1);return function(){return d.reduce(function(i,g){return g(i)},l.apply(void 0,arguments))}},pF=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},Sse=function(t){var r=null,n=null;return function(){for(var o=arguments.length,l=new Array(o),d=0;d<o;d++)l[d]=arguments[d];return r&&l.every(function(i,g){return i===r[g]})||(r=l,n=t.apply(void 0,l)),n}};function t8e(e){var t;return e===0?t=1:t=Math.floor(new Da(e).abs().log(10).toNumber())+1,t}function r8e(e,t,r){for(var n=new Da(e),o=0,l=[];n.lt(t)&&o<1e5;)l.push(n.toNumber()),n=n.add(r),o++;return l}var n8e=vR(function(e,t,r){var n=+e,o=+t;return n+r*(o-n)}),i8e=vR(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),a8e=vR(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const _R={rangeStep:r8e,getDigitCount:t8e,interpolateNumber:n8e,uninterpolateNumber:i8e,uninterpolateTruncation:a8e};function mF(e){return l8e(e)||s8e(e)||Ese(e)||o8e()}function o8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s8e(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function l8e(e){if(Array.isArray(e))return gF(e)}function KE(e,t){return d8e(e)||u8e(e,t)||Ese(e,t)||c8e()}function c8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ese(e,t){if(e){if(typeof e=="string")return gF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gF(e,t)}}function gF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u8e(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,o=!1,l=void 0;try{for(var d=e[Symbol.iterator](),i;!(n=(i=d.next()).done)&&(r.push(i.value),!(t&&r.length===t));n=!0);}catch(g){o=!0,l=g}finally{try{!n&&d.return!=null&&d.return()}finally{if(o)throw l}}return r}}function d8e(e){if(Array.isArray(e))return e}function Tse(e){var t=KE(e,2),r=t[0],n=t[1],o=r,l=n;return r>n&&(o=n,l=r),[o,l]}function Ase(e,t,r){if(e.lte(0))return new Da(0);var n=_R.getDigitCount(e.toNumber()),o=new Da(10).pow(n),l=e.div(o),d=n!==1?.05:.1,i=new Da(Math.ceil(l.div(d).toNumber())).add(r).mul(d),g=i.mul(o);return t?g:new Da(Math.ceil(g))}function h8e(e,t,r){var n=1,o=new Da(e);if(!o.isint()&&r){var l=Math.abs(e);l<1?(n=new Da(10).pow(_R.getDigitCount(e)-1),o=new Da(Math.floor(o.div(n).toNumber())).mul(n)):l>1&&(o=new Da(Math.floor(e)))}else e===0?o=new Da(Math.floor((t-1)/2)):r||(o=new Da(Math.floor(e)));var d=Math.floor((t-1)/2),i=e8e(Q6e(function(g){return o.add(new Da(g-d).mul(n)).toNumber()}),fF);return i(0,t)}function Pse(e,t,r,n){var o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Da(0),tickMin:new Da(0),tickMax:new Da(0)};var l=Ase(new Da(t).sub(e).div(r-1),n,o),d;e<=0&&t>=0?d=new Da(0):(d=new Da(e).add(t).div(2),d=d.sub(new Da(d).mod(l)));var i=Math.ceil(d.sub(e).div(l).toNumber()),g=Math.ceil(new Da(t).sub(d).div(l).toNumber()),x=i+g+1;return x>r?Pse(e,t,r,n,o+1):(x<r&&(g=t>0?g+(r-x):g,i=t>0?i:i+(r-x)),{step:l,tickMin:d.sub(new Da(i).mul(l)),tickMax:d.add(new Da(g).mul(l))})}function f8e(e){var t=KE(e,2),r=t[0],n=t[1],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=Math.max(o,2),i=Tse([r,n]),g=KE(i,2),x=g[0],S=g[1];if(x===-1/0||S===1/0){var E=S===1/0?[x].concat(mF(fF(0,o-1).map(function(){return 1/0}))):[].concat(mF(fF(0,o-1).map(function(){return-1/0})),[S]);return r>n?pF(E):E}if(x===S)return h8e(x,o,l);var A=Pse(x,S,d,l),C=A.step,N=A.tickMin,k=A.tickMax,R=_R.rangeStep(N,k.add(new Da(.1).mul(C)),C);return r>n?pF(R):R}function p8e(e,t){var r=KE(e,2),n=r[0],o=r[1],l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,d=Tse([n,o]),i=KE(d,2),g=i[0],x=i[1];if(g===-1/0||x===1/0)return[n,o];if(g===x)return[g];var S=Math.max(t,2),E=Ase(new Da(x).sub(g).div(S-1),l,0),A=[].concat(mF(_R.rangeStep(new Da(g),new Da(x).sub(new Da(.99).mul(E)),E)),[x]);return n>o?pF(A):A}var m8e=Sse(f8e),g8e=Sse(p8e),y8e="Invariant failed";function _v(e,t){throw new Error(y8e)}var v8e=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function J0(e){"@babel/helpers - typeof";return J0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J0(e)}function nI(){return nI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nI.apply(this,arguments)}function _8e(e,t){return S8e(e)||w8e(e,t)||b8e(e,t)||x8e()}function x8e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b8e(e,t){if(e){if(typeof e=="string")return UH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UH(e,t)}}function UH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function w8e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function S8e(e){if(Array.isArray(e))return e}function E8e(e,t){if(e==null)return{};var r=T8e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function T8e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function A8e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P8e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ise(n.key),n)}}function C8e(e,t,r){return t&&P8e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function O8e(e,t,r){return t=iI(t),I8e(e,Cse()?Reflect.construct(t,r||[],iI(e).constructor):t.apply(e,r))}function I8e(e,t){if(t&&(J0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return k8e(e)}function k8e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cse(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cse=function(){return!!e})()}function iI(e){return iI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iI(e)}function R8e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yF(e,t)}function yF(e,t){return yF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},yF(e,t)}function Ose(e,t,r){return t=Ise(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ise(e){var t=j8e(e,"string");return J0(t)=="symbol"?t:t+""}function j8e(e,t){if(J0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(J0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var tA=function(e){function t(){return A8e(this,t),O8e(this,t,arguments)}return R8e(t,e),C8e(t,[{key:"render",value:function(){var n=this.props,o=n.offset,l=n.layout,d=n.width,i=n.dataKey,g=n.data,x=n.dataPointFormatter,S=n.xAxis,E=n.yAxis,A=E8e(n,v8e),C=qn(A,!1);this.props.direction==="x"&&S.type!=="number"&&_v();var N=g.map(function(k){var R=x(k,i),L=R.x,j=R.y,F=R.value,B=R.errorVal;if(!B)return null;var U=[],Z,X;if(Array.isArray(B)){var te=_8e(B,2);Z=te[0],X=te[1]}else Z=X=B;if(l==="vertical"){var se=S.scale,oe=j+o,ne=oe+d,ee=oe-d,ie=se(F-Z),he=se(F+X);U.push({x1:he,y1:ne,x2:he,y2:ee}),U.push({x1:ie,y1:oe,x2:he,y2:oe}),U.push({x1:ie,y1:ne,x2:ie,y2:ee})}else if(l==="horizontal"){var Se=E.scale,Ce=L+o,fe=Ce-d,_e=Ce+d,be=Se(F-Z),Pe=Se(F+X);U.push({x1:fe,y1:Pe,x2:_e,y2:Pe}),U.push({x1:Ce,y1:be,x2:Ce,y2:Pe}),U.push({x1:fe,y1:be,x2:_e,y2:be})}return We.createElement(ga,nI({className:"recharts-errorBar",key:"bar-".concat(U.map(function(ye){return"".concat(ye.x1,"-").concat(ye.x2,"-").concat(ye.y1,"-").concat(ye.y2)}))},C),U.map(function(ye){return We.createElement("line",nI({},ye,{key:"line-".concat(ye.x1,"-").concat(ye.x2,"-").concat(ye.y1,"-").concat(ye.y2)}))}))});return We.createElement(ga,{className:"recharts-errorBars"},N)}}])}(We.Component);Ose(tA,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});Ose(tA,"displayName","ErrorBar");function ZE(e){"@babel/helpers - typeof";return ZE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZE(e)}function VH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fy(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VH(Object(r),!0).forEach(function(n){N8e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function N8e(e,t,r){return t=M8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M8e(e){var t=D8e(e,"string");return ZE(t)=="symbol"?t:t+""}function D8e(e,t){if(ZE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ZE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var kse=function(t){var r=t.children,n=t.formattedGraphicalItems,o=t.legendWidth,l=t.legendContent,d=Fc(r,ph);if(!d)return null;var i=ph.defaultProps,g=i!==void 0?fy(fy({},i),d.props):{},x;return d.props&&d.props.payload?x=d.props&&d.props.payload:l==="children"?x=(n||[]).reduce(function(S,E){var A=E.item,C=E.props,N=C.sectors||C.data||[];return S.concat(N.map(function(k){return{type:d.props.iconType||A.props.legendType,value:k.name,color:k.fill,payload:k}}))},[]):x=(n||[]).map(function(S){var E=S.item,A=E.type.defaultProps,C=A!==void 0?fy(fy({},A),E.props):{},N=C.dataKey,k=C.name,R=C.legendType,L=C.hide;return{inactive:L,dataKey:N,type:g.iconType||R||"square",color:R5(E),value:k||N,payload:C}}),fy(fy(fy({},g),ph.getWithHeight(d,o)),{},{payload:x,item:d})};function XE(e){"@babel/helpers - typeof";return XE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XE(e)}function qH(e){return B8e(e)||z8e(e)||F8e(e)||L8e()}function L8e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function F8e(e,t){if(e){if(typeof e=="string")return vF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vF(e,t)}}function z8e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function B8e(e){if(Array.isArray(e))return vF(e)}function vF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function WH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Oo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WH(Object(r),!0).forEach(function(n){l0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l0(e,t,r){return t=$8e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $8e(e){var t=U8e(e,"string");return XE(t)=="symbol"?t:t+""}function U8e(e,t){if(XE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(XE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ps(e,t,r){return bi(e)||bi(t)?r:gs(t)?Zc(e,t,r):si(t)?t(e):r}function YS(e,t,r,n){var o=B6e(e,function(i){return ps(i,t)});if(r==="number"){var l=o.filter(function(i){return Fr(i)||parseFloat(i)});return l.length?[yR(l),gR(l)]:[1/0,-1/0]}var d=n?o.filter(function(i){return!bi(i)}):o;return d.map(function(i){return gs(i)||i instanceof Date?i:""})}var V8e=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],o=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,d=-1,i=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(i<=1)return 0;if(l&&l.axisType==="angleAxis"&&Math.abs(Math.abs(l.range[1]-l.range[0])-360)<=1e-6)for(var g=l.range,x=0;x<i;x++){var S=x>0?o[x-1].coordinate:o[i-1].coordinate,E=o[x].coordinate,A=x>=i-1?o[0].coordinate:o[x+1].coordinate,C=void 0;if(Ul(E-S)!==Ul(A-E)){var N=[];if(Ul(A-E)===Ul(g[1]-g[0])){C=A;var k=E+g[1]-g[0];N[0]=Math.min(k,(k+S)/2),N[1]=Math.max(k,(k+S)/2)}else{C=S;var R=A+g[1]-g[0];N[0]=Math.min(E,(R+E)/2),N[1]=Math.max(E,(R+E)/2)}var L=[Math.min(E,(C+E)/2),Math.max(E,(C+E)/2)];if(t>L[0]&&t<=L[1]||t>=N[0]&&t<=N[1]){d=o[x].index;break}}else{var j=Math.min(S,A),F=Math.max(S,A);if(t>(j+E)/2&&t<=(F+E)/2){d=o[x].index;break}}}else for(var B=0;B<i;B++)if(B===0&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B>0&&B<i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2&&t<=(n[B].coordinate+n[B+1].coordinate)/2||B===i-1&&t>(n[B].coordinate+n[B-1].coordinate)/2){d=n[B].index;break}return d},R5=function(t){var r,n=t,o=n.type.displayName,l=(r=t.type)!==null&&r!==void 0&&r.defaultProps?Oo(Oo({},t.type.defaultProps),t.props):t.props,d=l.stroke,i=l.fill,g;switch(o){case"Line":g=d;break;case"Area":case"Radar":g=d&&d!=="none"?d:i;break;default:g=i;break}return g},q8e=function(t){var r=t.barSize,n=t.totalSize,o=t.stackGroups,l=o===void 0?{}:o;if(!l)return{};for(var d={},i=Object.keys(l),g=0,x=i.length;g<x;g++)for(var S=l[i[g]].stackGroups,E=Object.keys(S),A=0,C=E.length;A<C;A++){var N=S[E[A]],k=N.items,R=N.cateAxisId,L=k.filter(function(X){return Af(X.type).indexOf("Bar")>=0});if(L&&L.length){var j=L[0].type.defaultProps,F=j!==void 0?Oo(Oo({},j),L[0].props):L[0].props,B=F.barSize,U=F[R];d[U]||(d[U]=[]);var Z=bi(B)?r:B;d[U].push({item:L[0],stackList:L.slice(1),barSize:bi(Z)?void 0:Vl(Z,n,0)})}}return d},W8e=function(t){var r=t.barGap,n=t.barCategoryGap,o=t.bandSize,l=t.sizeList,d=l===void 0?[]:l,i=t.maxBarSize,g=d.length;if(g<1)return null;var x=Vl(r,o,0,!0),S,E=[];if(d[0].barSize===+d[0].barSize){var A=!1,C=o/g,N=d.reduce(function(B,U){return B+U.barSize||0},0);N+=(g-1)*x,N>=o&&(N-=(g-1)*x,x=0),N>=o&&C>0&&(A=!0,C*=.9,N=g*C);var k=(o-N)/2>>0,R={offset:k-x,size:0};S=d.reduce(function(B,U){var Z={item:U.item,position:{offset:R.offset+R.size+x,size:A?C:U.barSize}},X=[].concat(qH(B),[Z]);return R=X[X.length-1].position,U.stackList&&U.stackList.length&&U.stackList.forEach(function(te){X.push({item:te,position:R})}),X},E)}else{var L=Vl(n,o,0,!0);o-2*L-(g-1)*x<=0&&(x=0);var j=(o-2*L-(g-1)*x)/g;j>1&&(j>>=0);var F=i===+i?Math.min(j,i):j;S=d.reduce(function(B,U,Z){var X=[].concat(qH(B),[{item:U.item,position:{offset:L+(j+x)*Z+(j-F)/2,size:F}}]);return U.stackList&&U.stackList.length&&U.stackList.forEach(function(te){X.push({item:te,position:X[X.length-1].position})}),X},E)}return S},G8e=function(t,r,n,o){var l=n.children,d=n.width,i=n.margin,g=d-(i.left||0)-(i.right||0),x=kse({children:l,legendWidth:g});if(x){var S=o||{},E=S.width,A=S.height,C=x.align,N=x.verticalAlign,k=x.layout;if((k==="vertical"||k==="horizontal"&&N==="middle")&&C!=="center"&&Fr(t[C]))return Oo(Oo({},t),{},l0({},C,t[C]+(E||0)));if((k==="horizontal"||k==="vertical"&&C==="center")&&N!=="middle"&&Fr(t[N]))return Oo(Oo({},t),{},l0({},N,t[N]+(A||0)))}return t},H8e=function(t,r,n){return bi(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},Rse=function(t,r,n,o,l){var d=r.props.children,i=Xc(d,tA).filter(function(x){return H8e(o,l,x.props.direction)});if(i&&i.length){var g=i.map(function(x){return x.props.dataKey});return t.reduce(function(x,S){var E=ps(S,n);if(bi(E))return x;var A=Array.isArray(E)?[yR(E),gR(E)]:[E,E],C=g.reduce(function(N,k){var R=ps(S,k,0),L=A[0]-Math.abs(Array.isArray(R)?R[0]:R),j=A[1]+Math.abs(Array.isArray(R)?R[1]:R);return[Math.min(L,N[0]),Math.max(j,N[1])]},[1/0,-1/0]);return[Math.min(C[0],x[0]),Math.max(C[1],x[1])]},[1/0,-1/0])}return null},K8e=function(t,r,n,o,l){var d=r.map(function(i){return Rse(t,i,n,l,o)}).filter(function(i){return!bi(i)});return d&&d.length?d.reduce(function(i,g){return[Math.min(i[0],g[0]),Math.max(i[1],g[1])]},[1/0,-1/0]):null},jse=function(t,r,n,o,l){var d=r.map(function(g){var x=g.props.dataKey;return n==="number"&&x&&Rse(t,g,x,o)||YS(t,x,n,l)});if(n==="number")return d.reduce(function(g,x){return[Math.min(g[0],x[0]),Math.max(g[1],x[1])]},[1/0,-1/0]);var i={};return d.reduce(function(g,x){for(var S=0,E=x.length;S<E;S++)i[x[S]]||(i[x[S]]=!0,g.push(x[S]));return g},[])},Nse=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},Mse=function(t,r,n,o){if(o)return t.map(function(g){return g.coordinate});var l,d,i=t.map(function(g){return g.coordinate===r&&(l=!0),g.coordinate===n&&(d=!0),g.coordinate});return l||i.push(r),d||i.push(n),i},Sf=function(t,r,n){if(!t)return null;var o=t.scale,l=t.duplicateDomain,d=t.type,i=t.range,g=t.realScaleType==="scaleBand"?o.bandwidth()/2:2,x=(r||n)&&d==="category"&&o.bandwidth?o.bandwidth()/g:0;if(x=t.axisType==="angleAxis"&&(i==null?void 0:i.length)>=2?Ul(i[0]-i[1])*2*x:x,r&&(t.ticks||t.niceTicks)){var S=(t.ticks||t.niceTicks).map(function(E){var A=l?l.indexOf(E):E;return{coordinate:o(A)+x,value:E,offset:x}});return S.filter(function(E){return!KT(E.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(E,A){return{coordinate:o(E)+x,value:E,index:A,offset:x}}):o.ticks&&!n?o.ticks(t.tickCount).map(function(E){return{coordinate:o(E)+x,value:E,offset:x}}):o.domain().map(function(E,A){return{coordinate:o(E)+x,value:l?l[E]:E,index:A,offset:x}})},fD=new WeakMap,VP=function(t,r){if(typeof r!="function")return t;fD.has(t)||fD.set(t,new WeakMap);var n=fD.get(t);if(n.has(r))return n.get(r);var o=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,o),o},Dse=function(t,r,n){var o=t.scale,l=t.type,d=t.layout,i=t.axisType;if(o==="auto")return d==="radial"&&i==="radiusAxis"?{scale:UE(),realScaleType:"band"}:d==="radial"&&i==="angleAxis"?{scale:JO(),realScaleType:"linear"}:l==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:XS(),realScaleType:"point"}:l==="category"?{scale:UE(),realScaleType:"band"}:{scale:JO(),realScaleType:"linear"};if(mv(o)){var g="scale".concat(rR(o));return{scale:(FH[g]||XS)(),realScaleType:FH[g]?g:"point"}}return si(o)?{scale:o}:{scale:XS(),realScaleType:"point"}},GH=1e-4,Lse=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,o=t.range(),l=Math.min(o[0],o[1])-GH,d=Math.max(o[0],o[1])+GH,i=t(r[0]),g=t(r[n-1]);(i<l||i>d||g<l||g>d)&&t.domain([r[0],r[n-1]])}},Z8e=function(t,r){if(!t)return null;for(var n=0,o=t.length;n<o;n++)if(t[n].item===r)return t[n].position;return null},X8e=function(t,r){if(!r||r.length!==2||!Fr(r[0])||!Fr(r[1]))return t;var n=Math.min(r[0],r[1]),o=Math.max(r[0],r[1]),l=[t[0],t[1]];return(!Fr(t[0])||t[0]<n)&&(l[0]=n),(!Fr(t[1])||t[1]>o)&&(l[1]=o),l[0]>o&&(l[0]=o),l[1]<n&&(l[1]=n),l},Y8e=function(t){var r=t.length;if(!(r<=0))for(var n=0,o=t[0].length;n<o;++n)for(var l=0,d=0,i=0;i<r;++i){var g=KT(t[i][n][1])?t[i][n][0]:t[i][n][1];g>=0?(t[i][n][0]=l,t[i][n][1]=l+g,l=t[i][n][1]):(t[i][n][0]=d,t[i][n][1]=d+g,d=t[i][n][1])}},J8e=function(t){var r=t.length;if(!(r<=0))for(var n=0,o=t[0].length;n<o;++n)for(var l=0,d=0;d<r;++d){var i=KT(t[d][n][1])?t[d][n][0]:t[d][n][1];i>=0?(t[d][n][0]=l,t[d][n][1]=l+i,l=t[d][n][1]):(t[d][n][0]=0,t[d][n][1]=0)}},Q8e={sign:Y8e,expand:_Me,none:q0,silhouette:xMe,wiggle:bMe,positive:J8e},eqe=function(t,r,n){var o=r.map(function(i){return i.props.dataKey}),l=Q8e[n],d=vMe().keys(o).value(function(i,g){return+ps(i,g,0)}).order(V3).offset(l);return d(t)},tqe=function(t,r,n,o,l,d){if(!t)return null;var i=d?r.reverse():r,g={},x=i.reduce(function(E,A){var C,N=(C=A.type)!==null&&C!==void 0&&C.defaultProps?Oo(Oo({},A.type.defaultProps),A.props):A.props,k=N.stackId,R=N.hide;if(R)return E;var L=N[n],j=E[L]||{hasStack:!1,stackGroups:{}};if(gs(k)){var F=j.stackGroups[k]||{numericAxisId:n,cateAxisId:o,items:[]};F.items.push(A),j.hasStack=!0,j.stackGroups[k]=F}else j.stackGroups[Lb("_stackId_")]={numericAxisId:n,cateAxisId:o,items:[A]};return Oo(Oo({},E),{},l0({},L,j))},g),S={};return Object.keys(x).reduce(function(E,A){var C=x[A];if(C.hasStack){var N={};C.stackGroups=Object.keys(C.stackGroups).reduce(function(k,R){var L=C.stackGroups[R];return Oo(Oo({},k),{},l0({},R,{numericAxisId:n,cateAxisId:o,items:L.items,stackedData:eqe(t,L.items,l)}))},N)}return Oo(Oo({},E),{},l0({},A,C))},S)},Fse=function(t,r){var n=r.realScaleType,o=r.type,l=r.tickCount,d=r.originalDomain,i=r.allowDecimals,g=n||r.scale;if(g!=="auto"&&g!=="linear")return null;if(l&&o==="number"&&d&&(d[0]==="auto"||d[1]==="auto")){var x=t.domain();if(!x.length)return null;var S=m8e(x,l,i);return t.domain([yR(S),gR(S)]),{niceTicks:S}}if(l&&o==="number"){var E=t.domain(),A=g8e(E,l,i);return{niceTicks:A}}return null};function HH(e){var t=e.axis,r=e.ticks,n=e.bandSize,o=e.entry,l=e.index,d=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!bi(o[t.dataKey])){var i=kO(r,"value",o[t.dataKey]);if(i)return i.coordinate+n/2}return r[l]?r[l].coordinate+n/2:null}var g=ps(o,bi(d)?t.dataKey:d);return bi(g)?null:t.scale(g)}var KH=function(t){var r=t.axis,n=t.ticks,o=t.offset,l=t.bandSize,d=t.entry,i=t.index;if(r.type==="category")return n[i]?n[i].coordinate+o:null;var g=ps(d,r.dataKey,r.domain[i]);return bi(g)?null:r.scale(g)-l/2+o},rqe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var o=Math.min(n[0],n[1]),l=Math.max(n[0],n[1]);return o<=0&&l>=0?0:l<0?l:o}return n[0]},nqe=function(t,r){var n,o=(n=t.type)!==null&&n!==void 0&&n.defaultProps?Oo(Oo({},t.type.defaultProps),t.props):t.props,l=o.stackId;if(gs(l)){var d=r[l];if(d){var i=d.items.indexOf(t);return i>=0?d.stackedData[i]:null}}return null},iqe=function(t){return t.reduce(function(r,n){return[yR(n.concat([r[0]]).filter(Fr)),gR(n.concat([r[1]]).filter(Fr))]},[1/0,-1/0])},zse=function(t,r,n){return Object.keys(t).reduce(function(o,l){var d=t[l],i=d.stackedData,g=i.reduce(function(x,S){var E=iqe(S.slice(r,n+1));return[Math.min(x[0],E[0]),Math.max(x[1],E[1])]},[1/0,-1/0]);return[Math.min(g[0],o[0]),Math.max(g[1],o[1])]},[1/0,-1/0]).map(function(o){return o===1/0||o===-1/0?0:o})},ZH=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,XH=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,_F=function(t,r,n){if(si(t))return t(r,n);if(!Array.isArray(t))return r;var o=[];if(Fr(t[0]))o[0]=n?t[0]:Math.min(t[0],r[0]);else if(ZH.test(t[0])){var l=+ZH.exec(t[0])[1];o[0]=r[0]-l}else si(t[0])?o[0]=t[0](r[0]):o[0]=r[0];if(Fr(t[1]))o[1]=n?t[1]:Math.max(t[1],r[1]);else if(XH.test(t[1])){var d=+XH.exec(t[1])[1];o[1]=r[1]+d}else si(t[1])?o[1]=t[1](r[1]):o[1]=r[1];return o},aI=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var o=t.scale.bandwidth();if(!n||o>0)return o}if(t&&r&&r.length>=2){for(var l=o5(r,function(E){return E.coordinate}),d=1/0,i=1,g=l.length;i<g;i++){var x=l[i],S=l[i-1];d=Math.min((x.coordinate||0)-(S.coordinate||0),d)}return d===1/0?0:d}return n?void 0:0},YH=function(t,r,n){return!t||!t.length||eA(t,Zc(n,"type.defaultProps.domain"))?r:t},Bse=function(t,r){var n=t.type.defaultProps?Oo(Oo({},t.type.defaultProps),t.props):t.props,o=n.dataKey,l=n.name,d=n.unit,i=n.formatter,g=n.tooltipType,x=n.chartType,S=n.hide;return Oo(Oo({},qn(t,!1)),{},{dataKey:o,unit:d,formatter:i,name:l||o,color:R5(t),value:ps(r,o),type:g,payload:r,chartType:x,hide:S})};function YE(e){"@babel/helpers - typeof";return YE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},YE(e)}function JH(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function hf(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JH(Object(r),!0).forEach(function(n){$se(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JH(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $se(e,t,r){return t=aqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aqe(e){var t=oqe(e,"string");return YE(t)=="symbol"?t:t+""}function oqe(e,t){if(YE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(YE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function sqe(e,t){return dqe(e)||uqe(e,t)||cqe(e,t)||lqe()}function lqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cqe(e,t){if(e){if(typeof e=="string")return QH(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return QH(e,t)}}function QH(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function uqe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function dqe(e){if(Array.isArray(e))return e}var oI=Math.PI/180,hqe=function(t){return t*180/Math.PI},Za=function(t,r,n,o){return{x:t+Math.cos(-oI*o)*n,y:r+Math.sin(-oI*o)*n}},Use=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},fqe=function(t,r,n,o,l){var d=t.width,i=t.height,g=t.startAngle,x=t.endAngle,S=Vl(t.cx,d,d/2),E=Vl(t.cy,i,i/2),A=Use(d,i,n),C=Vl(t.innerRadius,A,0),N=Vl(t.outerRadius,A,A*.8),k=Object.keys(r);return k.reduce(function(R,L){var j=r[L],F=j.domain,B=j.reversed,U;if(bi(j.range))o==="angleAxis"?U=[g,x]:o==="radiusAxis"&&(U=[C,N]),B&&(U=[U[1],U[0]]);else{U=j.range;var Z=U,X=sqe(Z,2);g=X[0],x=X[1]}var te=Dse(j,l),se=te.realScaleType,oe=te.scale;oe.domain(F).range(U),Lse(oe);var ne=Fse(oe,hf(hf({},j),{},{realScaleType:se})),ee=hf(hf(hf({},j),ne),{},{range:U,radius:N,realScaleType:se,scale:oe,cx:S,cy:E,innerRadius:C,outerRadius:N,startAngle:g,endAngle:x});return hf(hf({},R),{},$se({},L,ee))},{})},pqe=function(t,r){var n=t.x,o=t.y,l=r.x,d=r.y;return Math.sqrt(Math.pow(n-l,2)+Math.pow(o-d,2))},mqe=function(t,r){var n=t.x,o=t.y,l=r.cx,d=r.cy,i=pqe({x:n,y:o},{x:l,y:d});if(i<=0)return{radius:i};var g=(n-l)/i,x=Math.acos(g);return o>d&&(x=2*Math.PI-x),{radius:i,angle:hqe(x),angleInRadian:x}},gqe=function(t){var r=t.startAngle,n=t.endAngle,o=Math.floor(r/360),l=Math.floor(n/360),d=Math.min(o,l);return{startAngle:r-d*360,endAngle:n-d*360}},yqe=function(t,r){var n=r.startAngle,o=r.endAngle,l=Math.floor(n/360),d=Math.floor(o/360),i=Math.min(l,d);return t+i*360},e7=function(t,r){var n=t.x,o=t.y,l=mqe({x:n,y:o},r),d=l.radius,i=l.angle,g=r.innerRadius,x=r.outerRadius;if(d<g||d>x)return!1;if(d===0)return!0;var S=gqe(r),E=S.startAngle,A=S.endAngle,C=i,N;if(E<=A){for(;C>A;)C-=360;for(;C<E;)C+=360;N=C>=E&&C<=A}else{for(;C>E;)C-=360;for(;C<A;)C+=360;N=C>=A&&C<=E}return N?hf(hf({},r),{},{radius:d,angle:yqe(C,r)}):null},Vse=function(t){return!G.isValidElement(t)&&!si(t)&&typeof t!="boolean"?t.className:""};function JE(e){"@babel/helpers - typeof";return JE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},JE(e)}var vqe=["offset"];function _qe(e){return Sqe(e)||wqe(e)||bqe(e)||xqe()}function xqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bqe(e,t){if(e){if(typeof e=="string")return xF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xF(e,t)}}function wqe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Sqe(e){if(Array.isArray(e))return xF(e)}function xF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Eqe(e,t){if(e==null)return{};var r=Tqe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Tqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function t7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?t7(Object(r),!0).forEach(function(n){Aqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Aqe(e,t,r){return t=Pqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pqe(e){var t=Cqe(e,"string");return JE(t)=="symbol"?t:t+""}function Cqe(e,t){if(JE(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(JE(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function QE(){return QE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},QE.apply(this,arguments)}var Oqe=function(t){var r=t.value,n=t.formatter,o=bi(t.children)?r:t.children;return si(n)?n(o):o},Iqe=function(t,r){var n=Ul(r-t),o=Math.min(Math.abs(r-t),360);return n*o},kqe=function(t,r,n){var o=t.position,l=t.viewBox,d=t.offset,i=t.className,g=l,x=g.cx,S=g.cy,E=g.innerRadius,A=g.outerRadius,C=g.startAngle,N=g.endAngle,k=g.clockWise,R=(E+A)/2,L=Iqe(C,N),j=L>=0?1:-1,F,B;o==="insideStart"?(F=C+j*d,B=k):o==="insideEnd"?(F=N-j*d,B=!k):o==="end"&&(F=N+j*d,B=k),B=L<=0?B:!B;var U=Za(x,S,R,F),Z=Za(x,S,R,F+(B?1:-1)*359),X="M".concat(U.x,",").concat(U.y,`
    A`).concat(R,",").concat(R,",0,1,").concat(B?0:1,`,
    `).concat(Z.x,",").concat(Z.y),te=bi(t.id)?Lb("recharts-radial-line-"):t.id;return We.createElement("text",QE({},n,{dominantBaseline:"central",className:Ei("recharts-radial-bar-label",i)}),We.createElement("defs",null,We.createElement("path",{id:te,d:X})),We.createElement("textPath",{xlinkHref:"#".concat(te)},r))},Rqe=function(t){var r=t.viewBox,n=t.offset,o=t.position,l=r,d=l.cx,i=l.cy,g=l.innerRadius,x=l.outerRadius,S=l.startAngle,E=l.endAngle,A=(S+E)/2;if(o==="outside"){var C=Za(d,i,x+n,A),N=C.x,k=C.y;return{x:N,y:k,textAnchor:N>=d?"start":"end",verticalAnchor:"middle"}}if(o==="center")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"middle"};if(o==="centerTop")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"start"};if(o==="centerBottom")return{x:d,y:i,textAnchor:"middle",verticalAnchor:"end"};var R=(g+x)/2,L=Za(d,i,R,A),j=L.x,F=L.y;return{x:j,y:F,textAnchor:"middle",verticalAnchor:"middle"}},jqe=function(t){var r=t.viewBox,n=t.parentViewBox,o=t.offset,l=t.position,d=r,i=d.x,g=d.y,x=d.width,S=d.height,E=S>=0?1:-1,A=E*o,C=E>0?"end":"start",N=E>0?"start":"end",k=x>=0?1:-1,R=k*o,L=k>0?"end":"start",j=k>0?"start":"end";if(l==="top"){var F={x:i+x/2,y:g-E*o,textAnchor:"middle",verticalAnchor:C};return cs(cs({},F),n?{height:Math.max(g-n.y,0),width:x}:{})}if(l==="bottom"){var B={x:i+x/2,y:g+S+A,textAnchor:"middle",verticalAnchor:N};return cs(cs({},B),n?{height:Math.max(n.y+n.height-(g+S),0),width:x}:{})}if(l==="left"){var U={x:i-R,y:g+S/2,textAnchor:L,verticalAnchor:"middle"};return cs(cs({},U),n?{width:Math.max(U.x-n.x,0),height:S}:{})}if(l==="right"){var Z={x:i+x+R,y:g+S/2,textAnchor:j,verticalAnchor:"middle"};return cs(cs({},Z),n?{width:Math.max(n.x+n.width-Z.x,0),height:S}:{})}var X=n?{width:x,height:S}:{};return l==="insideLeft"?cs({x:i+R,y:g+S/2,textAnchor:j,verticalAnchor:"middle"},X):l==="insideRight"?cs({x:i+x-R,y:g+S/2,textAnchor:L,verticalAnchor:"middle"},X):l==="insideTop"?cs({x:i+x/2,y:g+A,textAnchor:"middle",verticalAnchor:N},X):l==="insideBottom"?cs({x:i+x/2,y:g+S-A,textAnchor:"middle",verticalAnchor:C},X):l==="insideTopLeft"?cs({x:i+R,y:g+A,textAnchor:j,verticalAnchor:N},X):l==="insideTopRight"?cs({x:i+x-R,y:g+A,textAnchor:L,verticalAnchor:N},X):l==="insideBottomLeft"?cs({x:i+R,y:g+S-A,textAnchor:j,verticalAnchor:C},X):l==="insideBottomRight"?cs({x:i+x-R,y:g+S-A,textAnchor:L,verticalAnchor:C},X):jb(l)&&(Fr(l.x)||My(l.x))&&(Fr(l.y)||My(l.y))?cs({x:i+Vl(l.x,x),y:g+Vl(l.y,S),textAnchor:"end",verticalAnchor:"end"},X):cs({x:i+x/2,y:g+S/2,textAnchor:"middle",verticalAnchor:"middle"},X)},Nqe=function(t){return"cx"in t&&Fr(t.cx)};function Ps(e){var t=e.offset,r=t===void 0?5:t,n=Eqe(e,vqe),o=cs({offset:r},n),l=o.viewBox,d=o.position,i=o.value,g=o.children,x=o.content,S=o.className,E=S===void 0?"":S,A=o.textBreakAll;if(!l||bi(i)&&bi(g)&&!G.isValidElement(x)&&!si(x))return null;if(G.isValidElement(x))return G.cloneElement(x,o);var C;if(si(x)){if(C=G.createElement(x,o),G.isValidElement(C))return C}else C=Oqe(o);var N=Nqe(l),k=qn(o,!0);if(N&&(d==="insideStart"||d==="insideEnd"||d==="end"))return kqe(o,C,k);var R=N?Rqe(o):jqe(o);return We.createElement(yv,QE({className:Ei("recharts-label",E)},k,R,{breakAll:A}),C)}Ps.displayName="Label";var qse=function(t){var r=t.cx,n=t.cy,o=t.angle,l=t.startAngle,d=t.endAngle,i=t.r,g=t.radius,x=t.innerRadius,S=t.outerRadius,E=t.x,A=t.y,C=t.top,N=t.left,k=t.width,R=t.height,L=t.clockWise,j=t.labelViewBox;if(j)return j;if(Fr(k)&&Fr(R)){if(Fr(E)&&Fr(A))return{x:E,y:A,width:k,height:R};if(Fr(C)&&Fr(N))return{x:C,y:N,width:k,height:R}}return Fr(E)&&Fr(A)?{x:E,y:A,width:0,height:0}:Fr(r)&&Fr(n)?{cx:r,cy:n,startAngle:l||o||0,endAngle:d||o||0,innerRadius:x||0,outerRadius:S||g||i||0,clockWise:L}:t.viewBox?t.viewBox:{}},Mqe=function(t,r){return t?t===!0?We.createElement(Ps,{key:"label-implicit",viewBox:r}):gs(t)?We.createElement(Ps,{key:"label-implicit",viewBox:r,value:t}):G.isValidElement(t)?t.type===Ps?G.cloneElement(t,{key:"label-implicit",viewBox:r}):We.createElement(Ps,{key:"label-implicit",content:t,viewBox:r}):si(t)?We.createElement(Ps,{key:"label-implicit",content:t,viewBox:r}):jb(t)?We.createElement(Ps,QE({viewBox:r},t,{key:"label-implicit"})):null:null},Dqe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var o=t.children,l=qse(t),d=Xc(o,Ps).map(function(g,x){return G.cloneElement(g,{viewBox:r||l,key:"label-".concat(x)})});if(!n)return d;var i=Mqe(t.label,r||l);return[i].concat(_qe(d))};Ps.parseViewBox=qse;Ps.renderCallByParent=Dqe;function Lqe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Fqe=Lqe;const zqe=va(Fqe);function eT(e){"@babel/helpers - typeof";return eT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eT(e)}var Bqe=["valueAccessor"],$qe=["data","dataKey","clockWise","id","textBreakAll"];function Uqe(e){return Gqe(e)||Wqe(e)||qqe(e)||Vqe()}function Vqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qqe(e,t){if(e){if(typeof e=="string")return bF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bF(e,t)}}function Wqe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Gqe(e){if(Array.isArray(e))return bF(e)}function bF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function sI(){return sI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sI.apply(this,arguments)}function r7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function n7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?r7(Object(r),!0).forEach(function(n){Hqe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hqe(e,t,r){return t=Kqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kqe(e){var t=Zqe(e,"string");return eT(t)=="symbol"?t:t+""}function Zqe(e,t){if(eT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(eT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function i7(e,t){if(e==null)return{};var r=Xqe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Xqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Yqe=function(t){return Array.isArray(t.value)?zqe(t.value):t.value};function Cf(e){var t=e.valueAccessor,r=t===void 0?Yqe:t,n=i7(e,Bqe),o=n.data,l=n.dataKey,d=n.clockWise,i=n.id,g=n.textBreakAll,x=i7(n,$qe);return!o||!o.length?null:We.createElement(ga,{className:"recharts-label-list"},o.map(function(S,E){var A=bi(l)?r(S,E):ps(S&&S.payload,l),C=bi(i)?{}:{id:"".concat(i,"-").concat(E)};return We.createElement(Ps,sI({},qn(S,!0),x,C,{parentViewBox:S.parentViewBox,value:A,textBreakAll:g,viewBox:Ps.parseViewBox(bi(d)?S:n7(n7({},S),{},{clockWise:d})),key:"label-".concat(E),index:E}))}))}Cf.displayName="LabelList";function Jqe(e,t){return e?e===!0?We.createElement(Cf,{key:"labelList-implicit",data:t}):We.isValidElement(e)||si(e)?We.createElement(Cf,{key:"labelList-implicit",data:t,content:e}):jb(e)?We.createElement(Cf,sI({data:t},e,{key:"labelList-implicit"})):null:null}function Qqe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,o=Xc(n,Cf).map(function(d,i){return G.cloneElement(d,{data:t,key:"labelList-".concat(i)})});if(!r)return o;var l=Jqe(e.label,t);return[l].concat(Uqe(o))}Cf.renderCallByParent=Qqe;function tT(e){"@babel/helpers - typeof";return tT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tT(e)}function wF(){return wF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wF.apply(this,arguments)}function a7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function o7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a7(Object(r),!0).forEach(function(n){eWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eWe(e,t,r){return t=tWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tWe(e){var t=rWe(e,"string");return tT(t)=="symbol"?t:t+""}function rWe(e,t){if(tT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nWe=function(t,r){var n=Ul(r-t),o=Math.min(Math.abs(r-t),359.999);return n*o},qP=function(t){var r=t.cx,n=t.cy,o=t.radius,l=t.angle,d=t.sign,i=t.isExternal,g=t.cornerRadius,x=t.cornerIsExternal,S=g*(i?1:-1)+o,E=Math.asin(g/S)/oI,A=x?l:l+d*E,C=Za(r,n,S,A),N=Za(r,n,o,A),k=x?l-d*E:l,R=Za(r,n,S*Math.cos(E*oI),k);return{center:C,circleTangency:N,lineTangency:R,theta:E}},Wse=function(t){var r=t.cx,n=t.cy,o=t.innerRadius,l=t.outerRadius,d=t.startAngle,i=t.endAngle,g=nWe(d,i),x=d+g,S=Za(r,n,l,d),E=Za(r,n,l,x),A="M ".concat(S.x,",").concat(S.y,`
    A `).concat(l,",").concat(l,`,0,
    `).concat(+(Math.abs(g)>180),",").concat(+(d>x),`,
    `).concat(E.x,",").concat(E.y,`
  `);if(o>0){var C=Za(r,n,o,d),N=Za(r,n,o,x);A+="L ".concat(N.x,",").concat(N.y,`
            A `).concat(o,",").concat(o,`,0,
            `).concat(+(Math.abs(g)>180),",").concat(+(d<=x),`,
            `).concat(C.x,",").concat(C.y," Z")}else A+="L ".concat(r,",").concat(n," Z");return A},iWe=function(t){var r=t.cx,n=t.cy,o=t.innerRadius,l=t.outerRadius,d=t.cornerRadius,i=t.forceCornerRadius,g=t.cornerIsExternal,x=t.startAngle,S=t.endAngle,E=Ul(S-x),A=qP({cx:r,cy:n,radius:l,angle:x,sign:E,cornerRadius:d,cornerIsExternal:g}),C=A.circleTangency,N=A.lineTangency,k=A.theta,R=qP({cx:r,cy:n,radius:l,angle:S,sign:-E,cornerRadius:d,cornerIsExternal:g}),L=R.circleTangency,j=R.lineTangency,F=R.theta,B=g?Math.abs(x-S):Math.abs(x-S)-k-F;if(B<0)return i?"M ".concat(N.x,",").concat(N.y,`
        a`).concat(d,",").concat(d,",0,0,1,").concat(d*2,`,0
        a`).concat(d,",").concat(d,",0,0,1,").concat(-d*2,`,0
      `):Wse({cx:r,cy:n,innerRadius:o,outerRadius:l,startAngle:x,endAngle:S});var U="M ".concat(N.x,",").concat(N.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(C.x,",").concat(C.y,`
    A`).concat(l,",").concat(l,",0,").concat(+(B>180),",").concat(+(E<0),",").concat(L.x,",").concat(L.y,`
    A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(j.x,",").concat(j.y,`
  `);if(o>0){var Z=qP({cx:r,cy:n,radius:o,angle:x,sign:E,isExternal:!0,cornerRadius:d,cornerIsExternal:g}),X=Z.circleTangency,te=Z.lineTangency,se=Z.theta,oe=qP({cx:r,cy:n,radius:o,angle:S,sign:-E,isExternal:!0,cornerRadius:d,cornerIsExternal:g}),ne=oe.circleTangency,ee=oe.lineTangency,ie=oe.theta,he=g?Math.abs(x-S):Math.abs(x-S)-se-ie;if(he<0&&d===0)return"".concat(U,"L").concat(r,",").concat(n,"Z");U+="L".concat(ee.x,",").concat(ee.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(ne.x,",").concat(ne.y,`
      A`).concat(o,",").concat(o,",0,").concat(+(he>180),",").concat(+(E>0),",").concat(X.x,",").concat(X.y,`
      A`).concat(d,",").concat(d,",0,0,").concat(+(E<0),",").concat(te.x,",").concat(te.y,"Z")}else U+="L".concat(r,",").concat(n,"Z");return U},aWe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Gse=function(t){var r=o7(o7({},aWe),t),n=r.cx,o=r.cy,l=r.innerRadius,d=r.outerRadius,i=r.cornerRadius,g=r.forceCornerRadius,x=r.cornerIsExternal,S=r.startAngle,E=r.endAngle,A=r.className;if(d<l||S===E)return null;var C=Ei("recharts-sector",A),N=d-l,k=Vl(i,N,0,!0),R;return k>0&&Math.abs(S-E)<360?R=iWe({cx:n,cy:o,innerRadius:l,outerRadius:d,cornerRadius:Math.min(k,N/2),forceCornerRadius:g,cornerIsExternal:x,startAngle:S,endAngle:E}):R=Wse({cx:n,cy:o,innerRadius:l,outerRadius:d,startAngle:S,endAngle:E}),We.createElement("path",wF({},qn(r,!0),{className:C,d:R,role:"img"}))};function rT(e){"@babel/helpers - typeof";return rT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rT(e)}function SF(){return SF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SF.apply(this,arguments)}function s7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function l7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?s7(Object(r),!0).forEach(function(n){oWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oWe(e,t,r){return t=sWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sWe(e){var t=lWe(e,"string");return rT(t)=="symbol"?t:t+""}function lWe(e,t){if(rT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var c7={curveBasisClosed:sMe,curveBasisOpen:lMe,curveBasis:oMe,curveBumpX:GNe,curveBumpY:HNe,curveLinearClosed:cMe,curveLinear:iR,curveMonotoneX:uMe,curveMonotoneY:dMe,curveNatural:hMe,curveStep:fMe,curveStepAfter:mMe,curveStepBefore:pMe},WP=function(t){return t.x===+t.x&&t.y===+t.y},yS=function(t){return t.x},vS=function(t){return t.y},cWe=function(t,r){if(si(t))return t;var n="curve".concat(rR(t));return(n==="curveMonotone"||n==="curveBump")&&r?c7["".concat(n).concat(r==="vertical"?"Y":"X")]:c7[n]||iR},uWe=function(t){var r=t.type,n=r===void 0?"linear":r,o=t.points,l=o===void 0?[]:o,d=t.baseLine,i=t.layout,g=t.connectNulls,x=g===void 0?!1:g,S=cWe(n,i),E=x?l.filter(function(k){return WP(k)}):l,A;if(Array.isArray(d)){var C=x?d.filter(function(k){return WP(k)}):d,N=E.map(function(k,R){return l7(l7({},k),{},{base:C[R]})});return i==="vertical"?A=MP().y(vS).x1(yS).x0(function(k){return k.base.x}):A=MP().x(yS).y1(vS).y0(function(k){return k.base.y}),A.defined(WP).curve(S),A(N)}return i==="vertical"&&Fr(d)?A=MP().y(vS).x1(yS).x0(d):Fr(d)?A=MP().x(yS).y1(vS).y0(d):A=zae().x(yS).y(vS),A.defined(WP).curve(S),A(E)},lI=function(t){var r=t.className,n=t.points,o=t.path,l=t.pathRef;if((!n||!n.length)&&!o)return null;var d=n&&n.length?uWe(t):o;return G.createElement("path",SF({},qn(t,!1),RO(t),{className:Ei("recharts-curve",r),d,ref:l}))},Hse={exports:{}},dWe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",hWe=dWe,fWe=hWe;function Kse(){}function Zse(){}Zse.resetWarningCache=Kse;var pWe=function(){function e(n,o,l,d,i,g){if(g!==fWe){var x=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw x.name="Invariant Violation",x}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Zse,resetWarningCache:Kse};return r.PropTypes=r,r};Hse.exports=pWe();var mWe=Hse.exports;const Pa=va(mWe);var gWe=Object.getOwnPropertyNames,yWe=Object.getOwnPropertySymbols,vWe=Object.prototype.hasOwnProperty;function u7(e,t){return function(n,o,l){return e(n,o,l)&&t(n,o,l)}}function GP(e){return function(r,n,o){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,o);var l=o.cache,d=l.get(r),i=l.get(n);if(d&&i)return d===n&&i===r;l.set(r,n),l.set(n,r);var g=e(r,n,o);return l.delete(r),l.delete(n),g}}function d7(e){return gWe(e).concat(yWe(e))}var _We=Object.hasOwn||function(e,t){return vWe.call(e,t)};function Nv(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var xWe="__v",bWe="__o",wWe="_owner",h7=Object.getOwnPropertyDescriptor,f7=Object.keys;function SWe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function EWe(e,t){return Nv(e.getTime(),t.getTime())}function TWe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function AWe(e,t){return e===t}function p7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var o=new Array(n),l=e.entries(),d,i,g=0;(d=l.next())&&!d.done;){for(var x=t.entries(),S=!1,E=0;(i=x.next())&&!i.done;){if(o[E]){E++;continue}var A=d.value,C=i.value;if(r.equals(A[0],C[0],g,E,e,t,r)&&r.equals(A[1],C[1],A[0],C[0],e,t,r)){S=o[E]=!0;break}E++}if(!S)return!1;g++}return!0}var PWe=Nv;function CWe(e,t,r){var n=f7(e),o=n.length;if(f7(t).length!==o)return!1;for(;o-- >0;)if(!Xse(e,t,r,n[o]))return!1;return!0}function _S(e,t,r){var n=d7(e),o=n.length;if(d7(t).length!==o)return!1;for(var l,d,i;o-- >0;)if(l=n[o],!Xse(e,t,r,l)||(d=h7(e,l),i=h7(t,l),(d||i)&&(!d||!i||d.configurable!==i.configurable||d.enumerable!==i.enumerable||d.writable!==i.writable)))return!1;return!0}function OWe(e,t){return Nv(e.valueOf(),t.valueOf())}function IWe(e,t){return e.source===t.source&&e.flags===t.flags}function m7(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var o=new Array(n),l=e.values(),d,i;(d=l.next())&&!d.done;){for(var g=t.values(),x=!1,S=0;(i=g.next())&&!i.done;){if(!o[S]&&r.equals(d.value,i.value,d.value,i.value,e,t,r)){x=o[S]=!0;break}S++}if(!x)return!1}return!0}function kWe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function RWe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function Xse(e,t,r,n){return(n===wWe||n===bWe||n===xWe)&&(e.$$typeof||t.$$typeof)?!0:_We(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var jWe="[object Arguments]",NWe="[object Boolean]",MWe="[object Date]",DWe="[object Error]",LWe="[object Map]",FWe="[object Number]",zWe="[object Object]",BWe="[object RegExp]",$We="[object Set]",UWe="[object String]",VWe="[object URL]",qWe=Array.isArray,g7=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,y7=Object.assign,WWe=Object.prototype.toString.call.bind(Object.prototype.toString);function GWe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,o=e.areFunctionsEqual,l=e.areMapsEqual,d=e.areNumbersEqual,i=e.areObjectsEqual,g=e.arePrimitiveWrappersEqual,x=e.areRegExpsEqual,S=e.areSetsEqual,E=e.areTypedArraysEqual,A=e.areUrlsEqual;return function(N,k,R){if(N===k)return!0;if(N==null||k==null)return!1;var L=typeof N;if(L!==typeof k)return!1;if(L!=="object")return L==="number"?d(N,k,R):L==="function"?o(N,k,R):!1;var j=N.constructor;if(j!==k.constructor)return!1;if(j===Object)return i(N,k,R);if(qWe(N))return t(N,k,R);if(g7!=null&&g7(N))return E(N,k,R);if(j===Date)return r(N,k,R);if(j===RegExp)return x(N,k,R);if(j===Map)return l(N,k,R);if(j===Set)return S(N,k,R);var F=WWe(N);return F===MWe?r(N,k,R):F===BWe?x(N,k,R):F===LWe?l(N,k,R):F===$We?S(N,k,R):F===zWe?typeof N.then!="function"&&typeof k.then!="function"&&i(N,k,R):F===VWe?A(N,k,R):F===DWe?n(N,k,R):F===jWe?i(N,k,R):F===NWe||F===FWe||F===UWe?g(N,k,R):!1}}function HWe(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,o={areArraysEqual:n?_S:SWe,areDatesEqual:EWe,areErrorsEqual:TWe,areFunctionsEqual:AWe,areMapsEqual:n?u7(p7,_S):p7,areNumbersEqual:PWe,areObjectsEqual:n?_S:CWe,arePrimitiveWrappersEqual:OWe,areRegExpsEqual:IWe,areSetsEqual:n?u7(m7,_S):m7,areTypedArraysEqual:n?_S:kWe,areUrlsEqual:RWe};if(r&&(o=y7({},o,r(o))),t){var l=GP(o.areArraysEqual),d=GP(o.areMapsEqual),i=GP(o.areObjectsEqual),g=GP(o.areSetsEqual);o=y7({},o,{areArraysEqual:l,areMapsEqual:d,areObjectsEqual:i,areSetsEqual:g})}return o}function KWe(e){return function(t,r,n,o,l,d,i){return e(t,r,i)}}function ZWe(e){var t=e.circular,r=e.comparator,n=e.createState,o=e.equals,l=e.strict;if(n)return function(g,x){var S=n(),E=S.cache,A=E===void 0?t?new WeakMap:void 0:E,C=S.meta;return r(g,x,{cache:A,equals:o,meta:C,strict:l})};if(t)return function(g,x){return r(g,x,{cache:new WeakMap,equals:o,meta:void 0,strict:l})};var d={cache:void 0,equals:o,meta:void 0,strict:l};return function(g,x){return r(g,x,d)}}var XWe=cg();cg({strict:!0});cg({circular:!0});cg({circular:!0,strict:!0});cg({createInternalComparator:function(){return Nv}});cg({strict:!0,createInternalComparator:function(){return Nv}});cg({circular:!0,createInternalComparator:function(){return Nv}});cg({circular:!0,createInternalComparator:function(){return Nv},strict:!0});function cg(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,o=e.createState,l=e.strict,d=l===void 0?!1:l,i=HWe(e),g=GWe(i),x=n?n(g):KWe(g);return ZWe({circular:r,comparator:g,createState:o,equals:x,strict:d})}function YWe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function v7(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function o(l){r<0&&(r=l),l-r>t?(e(l),r=-1):YWe(o)};requestAnimationFrame(n)}function EF(e){"@babel/helpers - typeof";return EF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},EF(e)}function JWe(e){return r9e(e)||t9e(e)||e9e(e)||QWe()}function QWe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e9e(e,t){if(e){if(typeof e=="string")return _7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _7(e,t)}}function _7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function r9e(e){if(Array.isArray(e))return e}function n9e(){var e={},t=function(){return null},r=!1,n=function o(l){if(!r){if(Array.isArray(l)){if(!l.length)return;var d=l,i=JWe(d),g=i[0],x=i.slice(1);if(typeof g=="number"){v7(o.bind(null,x),g);return}o(g),v7(o.bind(null,x));return}EF(l)==="object"&&(e=l,t(e)),typeof l=="function"&&l()}};return{stop:function(){r=!0},start:function(l){r=!1,n(l)},subscribe:function(l){return t=l,function(){t=function(){return null}}}}}function nT(e){"@babel/helpers - typeof";return nT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nT(e)}function x7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function b7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x7(Object(r),!0).forEach(function(n){Yse(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yse(e,t,r){return t=i9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i9e(e){var t=a9e(e,"string");return nT(t)==="symbol"?t:String(t)}function a9e(e,t){if(nT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(nT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var o9e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,o){return n.filter(function(l){return o.includes(l)})})},s9e=function(t){return t},l9e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},JS=function(t,r){return Object.keys(r).reduce(function(n,o){return b7(b7({},n),{},Yse({},o,t(o,r[o])))},{})},w7=function(t,r,n){return t.map(function(o){return"".concat(l9e(o)," ").concat(r,"ms ").concat(n)}).join(",")};function c9e(e,t){return h9e(e)||d9e(e,t)||Jse(e,t)||u9e()}function u9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function h9e(e){if(Array.isArray(e))return e}function f9e(e){return g9e(e)||m9e(e)||Jse(e)||p9e()}function p9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jse(e,t){if(e){if(typeof e=="string")return TF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return TF(e,t)}}function m9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function g9e(e){if(Array.isArray(e))return TF(e)}function TF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var cI=1e-4,Qse=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},ele=function(t,r){return t.map(function(n,o){return n*Math.pow(r,o)}).reduce(function(n,o){return n+o})},S7=function(t,r){return function(n){var o=Qse(t,r);return ele(o,n)}},y9e=function(t,r){return function(n){var o=Qse(t,r),l=[].concat(f9e(o.map(function(d,i){return d*i}).slice(1)),[0]);return ele(l,n)}},E7=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r[0],l=r[1],d=r[2],i=r[3];if(r.length===1)switch(r[0]){case"linear":o=0,l=0,d=1,i=1;break;case"ease":o=.25,l=.1,d=.25,i=1;break;case"ease-in":o=.42,l=0,d=1,i=1;break;case"ease-out":o=.42,l=0,d=.58,i=1;break;case"ease-in-out":o=0,l=0,d=.58,i=1;break;default:{var g=r[0].split("(");if(g[0]==="cubic-bezier"&&g[1].split(")")[0].split(",").length===4){var x=g[1].split(")")[0].split(",").map(function(R){return parseFloat(R)}),S=c9e(x,4);o=S[0],l=S[1],d=S[2],i=S[3]}}}var E=S7(o,d),A=S7(l,i),C=y9e(o,d),N=function(L){return L>1?1:L<0?0:L},k=function(L){for(var j=L>1?1:L,F=j,B=0;B<8;++B){var U=E(F)-j,Z=C(F);if(Math.abs(U-j)<cI||Z<cI)return A(F);F=N(F-U/Z)}return A(F)};return k.isStepper=!1,k},v9e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,o=t.damping,l=o===void 0?8:o,d=t.dt,i=d===void 0?17:d,g=function(S,E,A){var C=-(S-E)*n,N=A*l,k=A+(C-N)*i/1e3,R=A*i/1e3+S;return Math.abs(R-E)<cI&&Math.abs(k)<cI?[E,0]:[R,k]};return g.isStepper=!0,g.dt=i,g},_9e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r[0];if(typeof o=="string")switch(o){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return E7(o);case"spring":return v9e();default:if(o.split("(")[0]==="cubic-bezier")return E7(o)}return typeof o=="function"?o:null};function iT(e){"@babel/helpers - typeof";return iT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iT(e)}function T7(e){return w9e(e)||b9e(e)||tle(e)||x9e()}function x9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function w9e(e){if(Array.isArray(e))return PF(e)}function A7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Bs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A7(Object(r),!0).forEach(function(n){AF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AF(e,t,r){return t=S9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function S9e(e){var t=E9e(e,"string");return iT(t)==="symbol"?t:String(t)}function E9e(e,t){if(iT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(iT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function T9e(e,t){return C9e(e)||P9e(e,t)||tle(e,t)||A9e()}function A9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tle(e,t){if(e){if(typeof e=="string")return PF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return PF(e,t)}}function PF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function C9e(e){if(Array.isArray(e))return e}var uI=function(t,r,n){return t+(r-t)*n},CF=function(t){var r=t.from,n=t.to;return r!==n},O9e=function e(t,r,n){var o=JS(function(l,d){if(CF(d)){var i=t(d.from,d.to,d.velocity),g=T9e(i,2),x=g[0],S=g[1];return Bs(Bs({},d),{},{from:x,velocity:S})}return d},r);return n<1?JS(function(l,d){return CF(d)?Bs(Bs({},d),{},{velocity:uI(d.velocity,o[l].velocity,n),from:uI(d.from,o[l].from,n)}):d},r):e(t,o,n-1)};const I9e=function(e,t,r,n,o){var l=o9e(e,t),d=l.reduce(function(R,L){return Bs(Bs({},R),{},AF({},L,[e[L],t[L]]))},{}),i=l.reduce(function(R,L){return Bs(Bs({},R),{},AF({},L,{from:e[L],velocity:0,to:t[L]}))},{}),g=-1,x,S,E=function(){return null},A=function(){return JS(function(L,j){return j.from},i)},C=function(){return!Object.values(i).filter(CF).length},N=function(L){x||(x=L);var j=L-x,F=j/r.dt;i=O9e(r,i,F),o(Bs(Bs(Bs({},e),t),A())),x=L,C()||(g=requestAnimationFrame(E))},k=function(L){S||(S=L);var j=(L-S)/n,F=JS(function(U,Z){return uI.apply(void 0,T7(Z).concat([r(j)]))},d);if(o(Bs(Bs(Bs({},e),t),F)),j<1)g=requestAnimationFrame(E);else{var B=JS(function(U,Z){return uI.apply(void 0,T7(Z).concat([r(1)]))},d);o(Bs(Bs(Bs({},e),t),B))}};return E=r.isStepper?N:k,function(){return requestAnimationFrame(E),function(){cancelAnimationFrame(g)}}};function Q0(e){"@babel/helpers - typeof";return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q0(e)}var k9e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function R9e(e,t){if(e==null)return{};var r=j9e(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function j9e(e,t){if(e==null)return{};var r={},n=Object.keys(e),o,l;for(l=0;l<n.length;l++)o=n[l],!(t.indexOf(o)>=0)&&(r[o]=e[o]);return r}function pD(e){return L9e(e)||D9e(e)||M9e(e)||N9e()}function N9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M9e(e,t){if(e){if(typeof e=="string")return OF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return OF(e,t)}}function D9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function L9e(e){if(Array.isArray(e))return OF(e)}function OF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function P7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ad(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P7(Object(r),!0).forEach(function(n){jS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jS(e,t,r){return t=rle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z9e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rle(n.key),n)}}function B9e(e,t,r){return t&&z9e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rle(e){var t=$9e(e,"string");return Q0(t)==="symbol"?t:String(t)}function $9e(e,t){if(Q0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Q0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function U9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IF(e,t)}function IF(e,t){return IF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},IF(e,t)}function V9e(e){var t=q9e();return function(){var n=dI(e),o;if(t){var l=dI(this).constructor;o=Reflect.construct(n,arguments,l)}else o=n.apply(this,arguments);return kF(this,o)}}function kF(e,t){if(t&&(Q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RF(e)}function RF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q9e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dI(e){return dI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dI(e)}var Ch=function(e){U9e(r,e);var t=V9e(r);function r(n,o){var l;F9e(this,r),l=t.call(this,n,o);var d=l.props,i=d.isActive,g=d.attributeName,x=d.from,S=d.to,E=d.steps,A=d.children,C=d.duration;if(l.handleStyleChange=l.handleStyleChange.bind(RF(l)),l.changeStyle=l.changeStyle.bind(RF(l)),!i||C<=0)return l.state={style:{}},typeof A=="function"&&(l.state={style:S}),kF(l);if(E&&E.length)l.state={style:E[0].style};else if(x){if(typeof A=="function")return l.state={style:x},kF(l);l.state={style:g?jS({},g,x):x}}else l.state={style:{}};return l}return B9e(r,[{key:"componentDidMount",value:function(){var o=this.props,l=o.isActive,d=o.canBegin;this.mounted=!0,!(!l||!d)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(o){var l=this.props,d=l.isActive,i=l.canBegin,g=l.attributeName,x=l.shouldReAnimate,S=l.to,E=l.from,A=this.state.style;if(i){if(!d){var C={style:g?jS({},g,S):S};this.state&&A&&(g&&A[g]!==S||!g&&A!==S)&&this.setState(C);return}if(!(XWe(o.to,S)&&o.canBegin&&o.isActive)){var N=!o.canBegin||!o.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var k=N||x?E:o.to;if(this.state&&A){var R={style:g?jS({},g,k):k};(g&&A[g]!==k||!g&&A!==k)&&this.setState(R)}this.runAnimation(ad(ad({},this.props),{},{from:k,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var o=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),o&&o()}},{key:"handleStyleChange",value:function(o){this.changeStyle(o)}},{key:"changeStyle",value:function(o){this.mounted&&this.setState({style:o})}},{key:"runJSAnimation",value:function(o){var l=this,d=o.from,i=o.to,g=o.duration,x=o.easing,S=o.begin,E=o.onAnimationEnd,A=o.onAnimationStart,C=I9e(d,i,_9e(x),g,this.changeStyle),N=function(){l.stopJSAnimation=C()};this.manager.start([A,S,N,g,E])}},{key:"runStepAnimation",value:function(o){var l=this,d=o.steps,i=o.begin,g=o.onAnimationStart,x=d[0],S=x.style,E=x.duration,A=E===void 0?0:E,C=function(k,R,L){if(L===0)return k;var j=R.duration,F=R.easing,B=F===void 0?"ease":F,U=R.style,Z=R.properties,X=R.onAnimationEnd,te=L>0?d[L-1]:R,se=Z||Object.keys(U);if(typeof B=="function"||B==="spring")return[].concat(pD(k),[l.runJSAnimation.bind(l,{from:te.style,to:U,duration:j,easing:B}),j]);var oe=w7(se,j,B),ne=ad(ad(ad({},te.style),U),{},{transition:oe});return[].concat(pD(k),[ne,j,X]).filter(s9e)};return this.manager.start([g].concat(pD(d.reduce(C,[S,Math.max(A,i)])),[o.onAnimationEnd]))}},{key:"runAnimation",value:function(o){this.manager||(this.manager=n9e());var l=o.begin,d=o.duration,i=o.attributeName,g=o.to,x=o.easing,S=o.onAnimationStart,E=o.onAnimationEnd,A=o.steps,C=o.children,N=this.manager;if(this.unSubscribe=N.subscribe(this.handleStyleChange),typeof x=="function"||typeof C=="function"||x==="spring"){this.runJSAnimation(o);return}if(A.length>1){this.runStepAnimation(o);return}var k=i?jS({},i,g):g,R=w7(Object.keys(k),d,x);N.start([S,l,ad(ad({},k),{},{transition:R}),d,E])}},{key:"render",value:function(){var o=this.props,l=o.children;o.begin;var d=o.duration;o.attributeName,o.easing;var i=o.isActive;o.steps,o.from,o.to,o.canBegin,o.onAnimationEnd,o.shouldReAnimate,o.onAnimationReStart;var g=R9e(o,k9e),x=G.Children.count(l),S=this.state.style;if(typeof l=="function")return l(S);if(!i||x===0||d<=0)return l;var E=function(C){var N=C.props,k=N.style,R=k===void 0?{}:k,L=N.className,j=G.cloneElement(C,ad(ad({},g),{},{style:ad(ad({},R),S),className:L}));return j};return x===1?E(G.Children.only(l)):We.createElement("div",null,G.Children.map(l,function(A){return E(A)}))}}]),r}(G.PureComponent);Ch.displayName="Animate";Ch.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Ch.propTypes={from:Pa.oneOfType([Pa.object,Pa.string]),to:Pa.oneOfType([Pa.object,Pa.string]),attributeName:Pa.string,duration:Pa.number,begin:Pa.number,easing:Pa.oneOfType([Pa.string,Pa.func]),steps:Pa.arrayOf(Pa.shape({duration:Pa.number.isRequired,style:Pa.object.isRequired,easing:Pa.oneOfType([Pa.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Pa.func]),properties:Pa.arrayOf("string"),onAnimationEnd:Pa.func})),children:Pa.oneOfType([Pa.node,Pa.func]),isActive:Pa.bool,canBegin:Pa.bool,onAnimationEnd:Pa.func,shouldReAnimate:Pa.bool,onAnimationStart:Pa.func,onAnimationReStart:Pa.func};function aT(e){"@babel/helpers - typeof";return aT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aT(e)}function hI(){return hI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hI.apply(this,arguments)}function W9e(e,t){return Z9e(e)||K9e(e,t)||H9e(e,t)||G9e()}function G9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H9e(e,t){if(e){if(typeof e=="string")return C7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C7(e,t)}}function C7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function K9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function Z9e(e){if(Array.isArray(e))return e}function O7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function I7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O7(Object(r),!0).forEach(function(n){X9e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function X9e(e,t,r){return t=Y9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Y9e(e){var t=J9e(e,"string");return aT(t)=="symbol"?t:t+""}function J9e(e,t){if(aT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(aT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var k7=function(t,r,n,o,l){var d=Math.min(Math.abs(n)/2,Math.abs(o)/2),i=o>=0?1:-1,g=n>=0?1:-1,x=o>=0&&n>=0||o<0&&n<0?1:0,S;if(d>0&&l instanceof Array){for(var E=[0,0,0,0],A=0,C=4;A<C;A++)E[A]=l[A]>d?d:l[A];S="M".concat(t,",").concat(r+i*E[0]),E[0]>0&&(S+="A ".concat(E[0],",").concat(E[0],",0,0,").concat(x,",").concat(t+g*E[0],",").concat(r)),S+="L ".concat(t+n-g*E[1],",").concat(r),E[1]>0&&(S+="A ".concat(E[1],",").concat(E[1],",0,0,").concat(x,`,
        `).concat(t+n,",").concat(r+i*E[1])),S+="L ".concat(t+n,",").concat(r+o-i*E[2]),E[2]>0&&(S+="A ".concat(E[2],",").concat(E[2],",0,0,").concat(x,`,
        `).concat(t+n-g*E[2],",").concat(r+o)),S+="L ".concat(t+g*E[3],",").concat(r+o),E[3]>0&&(S+="A ".concat(E[3],",").concat(E[3],",0,0,").concat(x,`,
        `).concat(t,",").concat(r+o-i*E[3])),S+="Z"}else if(d>0&&l===+l&&l>0){var N=Math.min(d,l);S="M ".concat(t,",").concat(r+i*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(x,",").concat(t+g*N,",").concat(r,`
            L `).concat(t+n-g*N,",").concat(r,`
            A `).concat(N,",").concat(N,",0,0,").concat(x,",").concat(t+n,",").concat(r+i*N,`
            L `).concat(t+n,",").concat(r+o-i*N,`
            A `).concat(N,",").concat(N,",0,0,").concat(x,",").concat(t+n-g*N,",").concat(r+o,`
            L `).concat(t+g*N,",").concat(r+o,`
            A `).concat(N,",").concat(N,",0,0,").concat(x,",").concat(t,",").concat(r+o-i*N," Z")}else S="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(o," h ").concat(-n," Z");return S},Q9e=function(t,r){if(!t||!r)return!1;var n=t.x,o=t.y,l=r.x,d=r.y,i=r.width,g=r.height;if(Math.abs(i)>0&&Math.abs(g)>0){var x=Math.min(l,l+i),S=Math.max(l,l+i),E=Math.min(d,d+g),A=Math.max(d,d+g);return n>=x&&n<=S&&o>=E&&o<=A}return!1},eGe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},j5=function(t){var r=I7(I7({},eGe),t),n=G.useRef(),o=G.useState(-1),l=W9e(o,2),d=l[0],i=l[1];G.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var B=n.current.getTotalLength();B&&i(B)}catch{}},[]);var g=r.x,x=r.y,S=r.width,E=r.height,A=r.radius,C=r.className,N=r.animationEasing,k=r.animationDuration,R=r.animationBegin,L=r.isAnimationActive,j=r.isUpdateAnimationActive;if(g!==+g||x!==+x||S!==+S||E!==+E||S===0||E===0)return null;var F=Ei("recharts-rectangle",C);return j?We.createElement(Ch,{canBegin:d>0,from:{width:S,height:E,x:g,y:x},to:{width:S,height:E,x:g,y:x},duration:k,animationEasing:N,isActive:j},function(B){var U=B.width,Z=B.height,X=B.x,te=B.y;return We.createElement(Ch,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:R,duration:k,isActive:L,easing:N},We.createElement("path",hI({},qn(r,!0),{className:F,d:k7(X,te,U,Z,A),ref:n})))}):We.createElement("path",hI({},qn(r,!0),{className:F,d:k7(g,x,S,E,A)}))},tGe=["points","className","baseLinePoints","connectNulls"];function $x(){return $x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$x.apply(this,arguments)}function rGe(e,t){if(e==null)return{};var r=nGe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function R7(e){return sGe(e)||oGe(e)||aGe(e)||iGe()}function iGe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aGe(e,t){if(e){if(typeof e=="string")return jF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jF(e,t)}}function oGe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function sGe(e){if(Array.isArray(e))return jF(e)}function jF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var j7=function(t){return t&&t.x===+t.x&&t.y===+t.y},lGe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){j7(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),j7(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},QS=function(t,r){var n=lGe(t);r&&(n=[n.reduce(function(l,d){return[].concat(R7(l),R7(d))},[])]);var o=n.map(function(l){return l.reduce(function(d,i,g){return"".concat(d).concat(g===0?"M":"L").concat(i.x,",").concat(i.y)},"")}).join("");return n.length===1?"".concat(o,"Z"):o},cGe=function(t,r,n){var o=QS(t,n);return"".concat(o.slice(-1)==="Z"?o.slice(0,-1):o,"L").concat(QS(r.reverse(),n).slice(1))},uGe=function(t){var r=t.points,n=t.className,o=t.baseLinePoints,l=t.connectNulls,d=rGe(t,tGe);if(!r||!r.length)return null;var i=Ei("recharts-polygon",n);if(o&&o.length){var g=d.stroke&&d.stroke!=="none",x=cGe(r,o,l);return We.createElement("g",{className:i},We.createElement("path",$x({},qn(d,!0),{fill:x.slice(-1)==="Z"?d.fill:"none",stroke:"none",d:x})),g?We.createElement("path",$x({},qn(d,!0),{fill:"none",d:QS(r,l)})):null,g?We.createElement("path",$x({},qn(d,!0),{fill:"none",d:QS(o,l)})):null)}var S=QS(r,l);return We.createElement("path",$x({},qn(d,!0),{fill:S.slice(-1)==="Z"?d.fill:"none",className:i,d:S}))};function NF(){return NF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NF.apply(this,arguments)}var xR=function(t){var r=t.cx,n=t.cy,o=t.r,l=t.className,d=Ei("recharts-dot",l);return r===+r&&n===+n&&o===+o?G.createElement("circle",NF({},qn(t,!1),RO(t),{className:d,cx:r,cy:n,r:o})):null};function oT(e){"@babel/helpers - typeof";return oT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oT(e)}var dGe=["x","y","top","left","width","height","className"];function MF(){return MF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MF.apply(this,arguments)}function N7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function hGe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N7(Object(r),!0).forEach(function(n){fGe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fGe(e,t,r){return t=pGe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pGe(e){var t=mGe(e,"string");return oT(t)=="symbol"?t:t+""}function mGe(e,t){if(oT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(oT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gGe(e,t){if(e==null)return{};var r=yGe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function yGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var vGe=function(t,r,n,o,l,d){return"M".concat(t,",").concat(l,"v").concat(o,"M").concat(d,",").concat(r,"h").concat(n)},_Ge=function(t){var r=t.x,n=r===void 0?0:r,o=t.y,l=o===void 0?0:o,d=t.top,i=d===void 0?0:d,g=t.left,x=g===void 0?0:g,S=t.width,E=S===void 0?0:S,A=t.height,C=A===void 0?0:A,N=t.className,k=gGe(t,dGe),R=hGe({x:n,y:l,top:i,left:x,width:E,height:C},k);return!Fr(n)||!Fr(l)||!Fr(E)||!Fr(C)||!Fr(i)||!Fr(x)?null:We.createElement("path",MF({},qn(R,!0),{className:Ei("recharts-cross",N),d:vGe(n,l,E,C,i,x)}))},xGe=mR,bGe=fse,wGe=Nh;function SGe(e,t){return e&&e.length?xGe(e,wGe(t),bGe):void 0}var EGe=SGe;const TGe=va(EGe);var AGe=mR,PGe=Nh,CGe=pse;function OGe(e,t){return e&&e.length?AGe(e,PGe(t),CGe):void 0}var IGe=OGe;const kGe=va(IGe);var RGe=["cx","cy","angle","ticks","axisLine"],jGe=["ticks","tick","angle","tickFormatter","stroke"];function eb(e){"@babel/helpers - typeof";return eb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eb(e)}function eE(){return eE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},eE.apply(this,arguments)}function M7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function py(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M7(Object(r),!0).forEach(function(n){bR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function D7(e,t){if(e==null)return{};var r=NGe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function NGe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function MGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function L7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ile(n.key),n)}}function DGe(e,t,r){return t&&L7(e.prototype,t),r&&L7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function LGe(e,t,r){return t=fI(t),FGe(e,nle()?Reflect.construct(t,r||[],fI(e).constructor):t.apply(e,r))}function FGe(e,t){if(t&&(eb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zGe(e)}function zGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nle=function(){return!!e})()}function fI(e){return fI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},fI(e)}function BGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DF(e,t)}function DF(e,t){return DF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},DF(e,t)}function bR(e,t,r){return t=ile(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ile(e){var t=$Ge(e,"string");return eb(t)=="symbol"?t:t+""}function $Ge(e,t){if(eb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(eb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var wR=function(e){function t(){return MGe(this,t),LGe(this,t,arguments)}return BGe(t,e),DGe(t,[{key:"getTickValueCoord",value:function(n){var o=n.coordinate,l=this.props,d=l.angle,i=l.cx,g=l.cy;return Za(i,g,o,d)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,o;switch(n){case"left":o="end";break;case"right":o="start";break;default:o="middle";break}return o}},{key:"getViewBox",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.angle,i=n.ticks,g=TGe(i,function(S){return S.coordinate||0}),x=kGe(i,function(S){return S.coordinate||0});return{cx:o,cy:l,startAngle:d,endAngle:d,innerRadius:x.coordinate||0,outerRadius:g.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.angle,i=n.ticks,g=n.axisLine,x=D7(n,RGe),S=i.reduce(function(N,k){return[Math.min(N[0],k.coordinate),Math.max(N[1],k.coordinate)]},[1/0,-1/0]),E=Za(o,l,S[0],d),A=Za(o,l,S[1],d),C=py(py(py({},qn(x,!1)),{},{fill:"none"},qn(g,!1)),{},{x1:E.x,y1:E.y,x2:A.x,y2:A.y});return We.createElement("line",eE({className:"recharts-polar-radius-axis-line"},C))}},{key:"renderTicks",value:function(){var n=this,o=this.props,l=o.ticks,d=o.tick,i=o.angle,g=o.tickFormatter,x=o.stroke,S=D7(o,jGe),E=this.getTickTextAnchor(),A=qn(S,!1),C=qn(d,!1),N=l.map(function(k,R){var L=n.getTickValueCoord(k),j=py(py(py(py({textAnchor:E,transform:"rotate(".concat(90-i,", ").concat(L.x,", ").concat(L.y,")")},A),{},{stroke:"none",fill:x},C),{},{index:R},L),{},{payload:k});return We.createElement(ga,eE({className:Ei("recharts-polar-radius-axis-tick",Vse(d)),key:"tick-".concat(k.coordinate)},gv(n.props,k,R)),t.renderTickItem(d,j,g?g(k.value,R):k.value))});return We.createElement(ga,{className:"recharts-polar-radius-axis-ticks"},N)}},{key:"render",value:function(){var n=this.props,o=n.ticks,l=n.axisLine,d=n.tick;return!o||!o.length?null:We.createElement(ga,{className:Ei("recharts-polar-radius-axis",this.props.className)},l&&this.renderAxisLine(),d&&this.renderTicks(),Ps.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,o,l){var d;return We.isValidElement(n)?d=We.cloneElement(n,o):si(n)?d=n(o):d=We.createElement(yv,eE({},o,{className:"recharts-polar-radius-axis-tick-value"}),l),d}}])}(G.PureComponent);bR(wR,"displayName","PolarRadiusAxis");bR(wR,"axisType","radiusAxis");bR(wR,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function tb(e){"@babel/helpers - typeof";return tb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tb(e)}function Oy(){return Oy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oy.apply(this,arguments)}function F7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function my(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F7(Object(r),!0).forEach(function(n){SR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UGe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ole(n.key),n)}}function VGe(e,t,r){return t&&z7(e.prototype,t),r&&z7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qGe(e,t,r){return t=pI(t),WGe(e,ale()?Reflect.construct(t,r||[],pI(e).constructor):t.apply(e,r))}function WGe(e,t){if(t&&(tb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GGe(e)}function GGe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ale(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ale=function(){return!!e})()}function pI(e){return pI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pI(e)}function HGe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&LF(e,t)}function LF(e,t){return LF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},LF(e,t)}function SR(e,t,r){return t=ole(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ole(e){var t=KGe(e,"string");return tb(t)=="symbol"?t:t+""}function KGe(e,t){if(tb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ZGe=Math.PI/180,B7=1e-5,ER=function(e){function t(){return UGe(this,t),qGe(this,t,arguments)}return HGe(t,e),VGe(t,[{key:"getTickLineCoord",value:function(n){var o=this.props,l=o.cx,d=o.cy,i=o.radius,g=o.orientation,x=o.tickSize,S=x||8,E=Za(l,d,i,n.coordinate),A=Za(l,d,i+(g==="inner"?-1:1)*S,n.coordinate);return{x1:E.x,y1:E.y,x2:A.x,y2:A.y}}},{key:"getTickTextAnchor",value:function(n){var o=this.props.orientation,l=Math.cos(-n.coordinate*ZGe),d;return l>B7?d=o==="outer"?"start":"end":l<-B7?d=o==="outer"?"end":"start":d="middle",d}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.cx,l=n.cy,d=n.radius,i=n.axisLine,g=n.axisLineType,x=my(my({},qn(this.props,!1)),{},{fill:"none"},qn(i,!1));if(g==="circle")return We.createElement(xR,Oy({className:"recharts-polar-angle-axis-line"},x,{cx:o,cy:l,r:d}));var S=this.props.ticks,E=S.map(function(A){return Za(o,l,d,A.coordinate)});return We.createElement(uGe,Oy({className:"recharts-polar-angle-axis-line"},x,{points:E}))}},{key:"renderTicks",value:function(){var n=this,o=this.props,l=o.ticks,d=o.tick,i=o.tickLine,g=o.tickFormatter,x=o.stroke,S=qn(this.props,!1),E=qn(d,!1),A=my(my({},S),{},{fill:"none"},qn(i,!1)),C=l.map(function(N,k){var R=n.getTickLineCoord(N),L=n.getTickTextAnchor(N),j=my(my(my({textAnchor:L},S),{},{stroke:"none",fill:x},E),{},{index:k,payload:N,x:R.x2,y:R.y2});return We.createElement(ga,Oy({className:Ei("recharts-polar-angle-axis-tick",Vse(d)),key:"tick-".concat(N.coordinate)},gv(n.props,N,k)),i&&We.createElement("line",Oy({className:"recharts-polar-angle-axis-tick-line"},A,R)),d&&t.renderTickItem(d,j,g?g(N.value,k):N.value))});return We.createElement(ga,{className:"recharts-polar-angle-axis-ticks"},C)}},{key:"render",value:function(){var n=this.props,o=n.ticks,l=n.radius,d=n.axisLine;return l<=0||!o||!o.length?null:We.createElement(ga,{className:Ei("recharts-polar-angle-axis",this.props.className)},d&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,o,l){var d;return We.isValidElement(n)?d=We.cloneElement(n,o):si(n)?d=n(o):d=We.createElement(yv,Oy({},o,{className:"recharts-polar-angle-axis-tick-value"}),l),d}}])}(G.PureComponent);SR(ER,"displayName","PolarAngleAxis");SR(ER,"axisType","angleAxis");SR(ER,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var XGe=coe,YGe=XGe(Object.getPrototypeOf,Object),JGe=YGe,QGe=Gf,eHe=JGe,tHe=Hf,rHe="[object Object]",nHe=Function.prototype,iHe=Object.prototype,sle=nHe.toString,aHe=iHe.hasOwnProperty,oHe=sle.call(Object);function sHe(e){if(!tHe(e)||QGe(e)!=rHe)return!1;var t=eHe(e);if(t===null)return!0;var r=aHe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&sle.call(r)==oHe}var lHe=sHe;const cHe=va(lHe);var uHe=Gf,dHe=Hf,hHe="[object Boolean]";function fHe(e){return e===!0||e===!1||dHe(e)&&uHe(e)==hHe}var pHe=fHe;const mHe=va(pHe);function sT(e){"@babel/helpers - typeof";return sT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sT(e)}function mI(){return mI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},mI.apply(this,arguments)}function gHe(e,t){return xHe(e)||_He(e,t)||vHe(e,t)||yHe()}function yHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vHe(e,t){if(e){if(typeof e=="string")return $7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $7(e,t)}}function $7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _He(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function xHe(e){if(Array.isArray(e))return e}function U7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function V7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U7(Object(r),!0).forEach(function(n){bHe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bHe(e,t,r){return t=wHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wHe(e){var t=SHe(e,"string");return sT(t)=="symbol"?t:t+""}function SHe(e,t){if(sT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var q7=function(t,r,n,o,l){var d=n-o,i;return i="M ".concat(t,",").concat(r),i+="L ".concat(t+n,",").concat(r),i+="L ".concat(t+n-d/2,",").concat(r+l),i+="L ".concat(t+n-d/2-o,",").concat(r+l),i+="L ".concat(t,",").concat(r," Z"),i},EHe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},THe=function(t){var r=V7(V7({},EHe),t),n=G.useRef(),o=G.useState(-1),l=gHe(o,2),d=l[0],i=l[1];G.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var F=n.current.getTotalLength();F&&i(F)}catch{}},[]);var g=r.x,x=r.y,S=r.upperWidth,E=r.lowerWidth,A=r.height,C=r.className,N=r.animationEasing,k=r.animationDuration,R=r.animationBegin,L=r.isUpdateAnimationActive;if(g!==+g||x!==+x||S!==+S||E!==+E||A!==+A||S===0&&E===0||A===0)return null;var j=Ei("recharts-trapezoid",C);return L?We.createElement(Ch,{canBegin:d>0,from:{upperWidth:0,lowerWidth:0,height:A,x:g,y:x},to:{upperWidth:S,lowerWidth:E,height:A,x:g,y:x},duration:k,animationEasing:N,isActive:L},function(F){var B=F.upperWidth,U=F.lowerWidth,Z=F.height,X=F.x,te=F.y;return We.createElement(Ch,{canBegin:d>0,from:"0px ".concat(d===-1?1:d,"px"),to:"".concat(d,"px 0px"),attributeName:"strokeDasharray",begin:R,duration:k,easing:N},We.createElement("path",mI({},qn(r,!0),{className:j,d:q7(X,te,B,U,Z),ref:n})))}):We.createElement("g",null,We.createElement("path",mI({},qn(r,!0),{className:j,d:q7(g,x,S,E,A)})))},AHe=["option","shapeType","propTransformer","activeClassName","isActive"];function lT(e){"@babel/helpers - typeof";return lT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lT(e)}function PHe(e,t){if(e==null)return{};var r=CHe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function CHe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function W7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function gI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W7(Object(r),!0).forEach(function(n){OHe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OHe(e,t,r){return t=IHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IHe(e){var t=kHe(e,"string");return lT(t)=="symbol"?t:t+""}function kHe(e,t){if(lT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(lT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RHe(e,t){return gI(gI({},t),e)}function jHe(e,t){return e==="symbols"}function G7(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return We.createElement(j5,r);case"trapezoid":return We.createElement(THe,r);case"sector":return We.createElement(Gse,r);case"symbols":if(jHe(t))return We.createElement(J4,r);break;default:return null}}function NHe(e){return G.isValidElement(e)?e.props:e}function lle(e){var t=e.option,r=e.shapeType,n=e.propTransformer,o=n===void 0?RHe:n,l=e.activeClassName,d=l===void 0?"recharts-active-shape":l,i=e.isActive,g=PHe(e,AHe),x;if(G.isValidElement(t))x=G.cloneElement(t,gI(gI({},g),NHe(t)));else if(si(t))x=t(g);else if(cHe(t)&&!mHe(t)){var S=o(t,g);x=We.createElement(G7,{shapeType:r,elementProps:S})}else{var E=g;x=We.createElement(G7,{shapeType:r,elementProps:E})}return i?We.createElement(ga,{className:d},x):x}function TR(e,t){return t!=null&&"trapezoids"in e.props}function AR(e,t){return t!=null&&"sectors"in e.props}function cT(e,t){return t!=null&&"points"in e.props}function MHe(e,t){var r,n,o=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,l=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return o&&l}function DHe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function LHe(e,t){var r=e.x===t.x,n=e.y===t.y,o=e.z===t.z;return r&&n&&o}function FHe(e,t){var r;return TR(e,t)?r=MHe:AR(e,t)?r=DHe:cT(e,t)&&(r=LHe),r}function zHe(e,t){var r;return TR(e,t)?r="trapezoids":AR(e,t)?r="sectors":cT(e,t)&&(r="points"),r}function BHe(e,t){if(TR(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(AR(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return cT(e,t)?t.payload:{}}function $He(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,o=zHe(r,t),l=BHe(r,t),d=n.filter(function(g,x){var S=eA(l,g),E=r.props[o].filter(function(N){var k=FHe(r,t);return k(N,t)}),A=r.props[o].indexOf(E[E.length-1]),C=x===A;return S&&C}),i=n.indexOf(d[d.length-1]);return i}var EC;function rb(e){"@babel/helpers - typeof";return rb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rb(e)}function Ux(){return Ux=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ux.apply(this,arguments)}function H7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ga(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H7(Object(r),!0).forEach(function(n){xu(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UHe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ule(n.key),n)}}function VHe(e,t,r){return t&&K7(e.prototype,t),r&&K7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qHe(e,t,r){return t=yI(t),WHe(e,cle()?Reflect.construct(t,r||[],yI(e).constructor):t.apply(e,r))}function WHe(e,t){if(t&&(rb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GHe(e)}function GHe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cle=function(){return!!e})()}function yI(e){return yI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},yI(e)}function HHe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FF(e,t)}function FF(e,t){return FF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},FF(e,t)}function xu(e,t,r){return t=ule(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ule(e){var t=KHe(e,"string");return rb(t)=="symbol"?t:t+""}function KHe(e,t){if(rb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Oh=function(e){function t(r){var n;return UHe(this,t),n=qHe(this,t,[r]),xu(n,"pieRef",null),xu(n,"sectorRefs",[]),xu(n,"id",Lb("recharts-pie-")),xu(n,"handleAnimationEnd",function(){var o=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),si(o)&&o()}),xu(n,"handleAnimationStart",function(){var o=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),si(o)&&o()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return HHe(t,e),VHe(t,[{key:"isActiveIndex",value:function(n){var o=this.props.activeIndex;return Array.isArray(o)?o.indexOf(n)!==-1:n===o}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.label,i=l.labelLine,g=l.dataKey,x=l.valueKey,S=qn(this.props,!1),E=qn(d,!1),A=qn(i,!1),C=d&&d.offsetRadius||20,N=n.map(function(k,R){var L=(k.startAngle+k.endAngle)/2,j=Za(k.cx,k.cy,k.outerRadius+C,L),F=Ga(Ga(Ga(Ga({},S),k),{},{stroke:"none"},E),{},{index:R,textAnchor:t.getTextAnchor(j.x,k.cx)},j),B=Ga(Ga(Ga(Ga({},S),k),{},{fill:"none",stroke:k.fill},A),{},{index:R,points:[Za(k.cx,k.cy,k.outerRadius,L),j]}),U=g;return bi(g)&&bi(x)?U="value":bi(g)&&(U=x),We.createElement(ga,{key:"label-".concat(k.startAngle,"-").concat(k.endAngle,"-").concat(k.midAngle,"-").concat(R)},i&&t.renderLabelLineItem(i,B,"line"),t.renderLabelItem(d,F,ps(k,U)))});return We.createElement(ga,{className:"recharts-pie-labels"},N)}},{key:"renderSectorsStatically",value:function(n){var o=this,l=this.props,d=l.activeShape,i=l.blendStroke,g=l.inactiveShape;return n.map(function(x,S){if((x==null?void 0:x.startAngle)===0&&(x==null?void 0:x.endAngle)===0&&n.length!==1)return null;var E=o.isActiveIndex(S),A=g&&o.hasActiveIndex()?g:null,C=E?d:A,N=Ga(Ga({},x),{},{stroke:i?x.fill:x.stroke,tabIndex:-1});return We.createElement(ga,Ux({ref:function(R){R&&!o.sectorRefs.includes(R)&&o.sectorRefs.push(R)},tabIndex:-1,className:"recharts-pie-sector"},gv(o.props,x,S),{key:"sector-".concat(x==null?void 0:x.startAngle,"-").concat(x==null?void 0:x.endAngle,"-").concat(x.midAngle,"-").concat(S)}),We.createElement(lle,Ux({option:C,isActive:E,shapeType:"sector"},N)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,o=this.props,l=o.sectors,d=o.isAnimationActive,i=o.animationBegin,g=o.animationDuration,x=o.animationEasing,S=o.animationId,E=this.state,A=E.prevSectors,C=E.prevIsAnimationActive;return We.createElement(Ch,{begin:i,duration:g,isActive:d,easing:x,from:{t:0},to:{t:1},key:"pie-".concat(S,"-").concat(C),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(N){var k=N.t,R=[],L=l&&l[0],j=L.startAngle;return l.forEach(function(F,B){var U=A&&A[B],Z=B>0?Zc(F,"paddingAngle",0):0;if(U){var X=$c(U.endAngle-U.startAngle,F.endAngle-F.startAngle),te=Ga(Ga({},F),{},{startAngle:j+Z,endAngle:j+X(k)+Z});R.push(te),j=te.endAngle}else{var se=F.endAngle,oe=F.startAngle,ne=$c(0,se-oe),ee=ne(k),ie=Ga(Ga({},F),{},{startAngle:j+Z,endAngle:j+ee+Z});R.push(ie),j=ie.endAngle}}),We.createElement(ga,null,n.renderSectorsStatically(R))})}},{key:"attachKeyboardHandlers",value:function(n){var o=this;n.onkeydown=function(l){if(!l.altKey)switch(l.key){case"ArrowLeft":{var d=++o.state.sectorToFocus%o.sectorRefs.length;o.sectorRefs[d].focus(),o.setState({sectorToFocus:d});break}case"ArrowRight":{var i=--o.state.sectorToFocus<0?o.sectorRefs.length-1:o.state.sectorToFocus%o.sectorRefs.length;o.sectorRefs[i].focus(),o.setState({sectorToFocus:i});break}case"Escape":{o.sectorRefs[o.state.sectorToFocus].blur(),o.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,o=n.sectors,l=n.isAnimationActive,d=this.state.prevSectors;return l&&o&&o.length&&(!d||!eA(d,o))?this.renderSectorsWithAnimation():this.renderSectorsStatically(o)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,o=this.props,l=o.hide,d=o.sectors,i=o.className,g=o.label,x=o.cx,S=o.cy,E=o.innerRadius,A=o.outerRadius,C=o.isAnimationActive,N=this.state.isAnimationFinished;if(l||!d||!d.length||!Fr(x)||!Fr(S)||!Fr(E)||!Fr(A))return null;var k=Ei("recharts-pie",i);return We.createElement(ga,{tabIndex:this.props.rootTabIndex,className:k,ref:function(L){n.pieRef=L}},this.renderSectors(),g&&this.renderLabels(d),Ps.renderCallByParent(this.props,null,!1),(!C||N)&&Cf.renderCallByParent(this.props,d,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return o.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:o.curSectors,isAnimationFinished:!0}:n.sectors!==o.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,o){return n>o?"start":n<o?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,o,l){if(We.isValidElement(n))return We.cloneElement(n,o);if(si(n))return n(o);var d=Ei("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return We.createElement(lI,Ux({},o,{key:l,type:"linear",className:d}))}},{key:"renderLabelItem",value:function(n,o,l){if(We.isValidElement(n))return We.cloneElement(n,o);var d=l;if(si(n)&&(d=n(o),We.isValidElement(d)))return d;var i=Ei("recharts-pie-label-text",typeof n!="boolean"&&!si(n)?n.className:"");return We.createElement(yv,Ux({},o,{alignmentBaseline:"middle",className:i}),d)}}])}(G.PureComponent);EC=Oh;xu(Oh,"displayName","Pie");xu(Oh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!wh.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});xu(Oh,"parseDeltaAngle",function(e,t){var r=Ul(t-e),n=Math.min(Math.abs(t-e),360);return r*n});xu(Oh,"getRealPieData",function(e){var t=e.data,r=e.children,n=qn(e,!1),o=Xc(r,zE);return t&&t.length?t.map(function(l,d){return Ga(Ga(Ga({payload:l},n),l),o&&o[d]&&o[d].props)}):o&&o.length?o.map(function(l){return Ga(Ga({},n),l.props)}):[]});xu(Oh,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,o=t.width,l=t.height,d=Use(o,l),i=n+Vl(e.cx,o,o/2),g=r+Vl(e.cy,l,l/2),x=Vl(e.innerRadius,d,0),S=Vl(e.outerRadius,d,d*.8),E=e.maxRadius||Math.sqrt(o*o+l*l)/2;return{cx:i,cy:g,innerRadius:x,outerRadius:S,maxRadius:E}});xu(Oh,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?Ga(Ga({},t.type.defaultProps),t.props):t.props,o=EC.getRealPieData(n);if(!o||!o.length)return null;var l=n.cornerRadius,d=n.startAngle,i=n.endAngle,g=n.paddingAngle,x=n.dataKey,S=n.nameKey,E=n.valueKey,A=n.tooltipType,C=Math.abs(n.minAngle),N=EC.parseCoordinateOfPie(n,r),k=EC.parseDeltaAngle(d,i),R=Math.abs(k),L=x;bi(x)&&bi(E)?(Ed(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),L="value"):bi(x)&&(Ed(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),L=E);var j=o.filter(function(te){return ps(te,L,0)!==0}).length,F=(R>=360?j:j-1)*g,B=R-j*C-F,U=o.reduce(function(te,se){var oe=ps(se,L,0);return te+(Fr(oe)?oe:0)},0),Z;if(U>0){var X;Z=o.map(function(te,se){var oe=ps(te,L,0),ne=ps(te,S,se),ee=(Fr(oe)?oe:0)/U,ie;se?ie=X.endAngle+Ul(k)*g*(oe!==0?1:0):ie=d;var he=ie+Ul(k)*((oe!==0?C:0)+ee*B),Se=(ie+he)/2,Ce=(N.innerRadius+N.outerRadius)/2,fe=[{name:ne,value:oe,payload:te,dataKey:L,type:A}],_e=Za(N.cx,N.cy,Ce,Se);return X=Ga(Ga(Ga({percent:ee,cornerRadius:l,name:ne,tooltipPayload:fe,midAngle:Se,middleRadius:Ce,tooltipPosition:_e},te),N),{},{value:ps(te,L),startAngle:ie,endAngle:he,payload:te,paddingAngle:Ul(k)*g}),X})}return Ga(Ga({},N),{},{sectors:Z,data:o})});var ZHe=Math.ceil,XHe=Math.max;function YHe(e,t,r,n){for(var o=-1,l=XHe(ZHe((t-e)/(r||1)),0),d=Array(l);l--;)d[n?l:++o]=e,e+=r;return d}var JHe=YHe,QHe=Coe,Z7=1/0,e7e=17976931348623157e292;function t7e(e){if(!e)return e===0?e:0;if(e=QHe(e),e===Z7||e===-Z7){var t=e<0?-1:1;return t*e7e}return e===e?e:0}var dle=t7e,r7e=JHe,n7e=lR,mD=dle;function i7e(e){return function(t,r,n){return n&&typeof n!="number"&&n7e(t,r,n)&&(r=n=void 0),t=mD(t),r===void 0?(r=t,t=0):r=mD(r),n=n===void 0?t<r?1:-1:mD(n),r7e(t,r,n,e)}}var a7e=i7e,o7e=a7e,s7e=o7e(),l7e=s7e;const vI=va(l7e);function uT(e){"@babel/helpers - typeof";return uT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uT(e)}function X7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Y7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X7(Object(r),!0).forEach(function(n){hle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hle(e,t,r){return t=c7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c7e(e){var t=u7e(e,"string");return uT(t)=="symbol"?t:t+""}function u7e(e,t){if(uT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(uT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var d7e=["Webkit","Moz","O","ms"],h7e=function(t,r){var n=t.replace(/(\w)/,function(l){return l.toUpperCase()}),o=d7e.reduce(function(l,d){return Y7(Y7({},l),{},hle({},d+n,r))},{});return o[t]=r,o};function nb(e){"@babel/helpers - typeof";return nb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nb(e)}function _I(){return _I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_I.apply(this,arguments)}function J7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function gD(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?J7(Object(r),!0).forEach(function(n){Mc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function f7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ple(n.key),n)}}function p7e(e,t,r){return t&&Q7(e.prototype,t),r&&Q7(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function m7e(e,t,r){return t=xI(t),g7e(e,fle()?Reflect.construct(t,r||[],xI(e).constructor):t.apply(e,r))}function g7e(e,t){if(t&&(nb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y7e(e)}function y7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fle=function(){return!!e})()}function xI(e){return xI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xI(e)}function v7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zF(e,t)}function zF(e,t){return zF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},zF(e,t)}function Mc(e,t,r){return t=ple(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ple(e){var t=_7e(e,"string");return nb(t)=="symbol"?t:t+""}function _7e(e,t){if(nb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(nb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var x7e=function(t){var r=t.data,n=t.startIndex,o=t.endIndex,l=t.x,d=t.width,i=t.travellerWidth;if(!r||!r.length)return{};var g=r.length,x=XS().domain(vI(0,g)).range([l,l+d-i]),S=x.domain().map(function(E){return x(E)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:x(n),endX:x(o),scale:x,scaleValues:S}},eK=function(t){return t.changedTouches&&!!t.changedTouches.length},ib=function(e){function t(r){var n;return f7e(this,t),n=m7e(this,t,[r]),Mc(n,"handleDrag",function(o){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(o):n.state.isSlideMoving&&n.handleSlideDrag(o)}),Mc(n,"handleTouchMove",function(o){o.changedTouches!=null&&o.changedTouches.length>0&&n.handleDrag(o.changedTouches[0])}),Mc(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var o=n.props,l=o.endIndex,d=o.onDragEnd,i=o.startIndex;d==null||d({endIndex:l,startIndex:i})}),n.detachDragEndListener()}),Mc(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Mc(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Mc(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Mc(n,"handleSlideDragStart",function(o){var l=eK(o)?o.changedTouches[0]:o;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:l.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return v7e(t,e),p7e(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var o=n.startX,l=n.endX,d=this.state.scaleValues,i=this.props,g=i.gap,x=i.data,S=x.length-1,E=Math.min(o,l),A=Math.max(o,l),C=t.getIndexInRange(d,E),N=t.getIndexInRange(d,A);return{startIndex:C-C%g,endIndex:N===S?S:N-N%g}}},{key:"getTextOfTick",value:function(n){var o=this.props,l=o.data,d=o.tickFormatter,i=o.dataKey,g=ps(l[n],i,n);return si(d)?d(g,n):g}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var o=this.state,l=o.slideMoveStartX,d=o.startX,i=o.endX,g=this.props,x=g.x,S=g.width,E=g.travellerWidth,A=g.startIndex,C=g.endIndex,N=g.onChange,k=n.pageX-l;k>0?k=Math.min(k,x+S-E-i,x+S-E-d):k<0&&(k=Math.max(k,x-d,x-i));var R=this.getIndex({startX:d+k,endX:i+k});(R.startIndex!==A||R.endIndex!==C)&&N&&N(R),this.setState({startX:d+k,endX:i+k,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,o){var l=eK(o)?o.changedTouches[0]:o;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:l.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var o=this.state,l=o.brushMoveStartX,d=o.movingTravellerId,i=o.endX,g=o.startX,x=this.state[d],S=this.props,E=S.x,A=S.width,C=S.travellerWidth,N=S.onChange,k=S.gap,R=S.data,L={startX:this.state.startX,endX:this.state.endX},j=n.pageX-l;j>0?j=Math.min(j,E+A-C-x):j<0&&(j=Math.max(j,E-x)),L[d]=x+j;var F=this.getIndex(L),B=F.startIndex,U=F.endIndex,Z=function(){var te=R.length-1;return d==="startX"&&(i>g?B%k===0:U%k===0)||i<g&&U===te||d==="endX"&&(i>g?U%k===0:B%k===0)||i>g&&U===te};this.setState(Mc(Mc({},d,x+j),"brushMoveStartX",n.pageX),function(){N&&Z()&&N(F)})}},{key:"handleTravellerMoveKeyboard",value:function(n,o){var l=this,d=this.state,i=d.scaleValues,g=d.startX,x=d.endX,S=this.state[o],E=i.indexOf(S);if(E!==-1){var A=E+n;if(!(A===-1||A>=i.length)){var C=i[A];o==="startX"&&C>=x||o==="endX"&&C<=g||this.setState(Mc({},o,C),function(){l.props.onChange(l.getIndex({startX:l.state.startX,endX:l.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.fill,x=n.stroke;return We.createElement("rect",{stroke:x,fill:g,x:o,y:l,width:d,height:i})}},{key:"renderPanorama",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.data,x=n.children,S=n.padding,E=G.Children.only(x);return E?We.cloneElement(E,{x:o,y:l,width:d,height:i,margin:S,compact:!0,data:g}):null}},{key:"renderTravellerLayer",value:function(n,o){var l,d,i=this,g=this.props,x=g.y,S=g.travellerWidth,E=g.height,A=g.traveller,C=g.ariaLabel,N=g.data,k=g.startIndex,R=g.endIndex,L=Math.max(n,this.props.x),j=gD(gD({},qn(this.props,!1)),{},{x:L,y:x,width:S,height:E}),F=C||"Min value: ".concat((l=N[k])===null||l===void 0?void 0:l.name,", Max value: ").concat((d=N[R])===null||d===void 0?void 0:d.name);return We.createElement(ga,{tabIndex:0,role:"slider","aria-label":F,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[o],onTouchStart:this.travellerDragStartHandlers[o],onKeyDown:function(U){["ArrowLeft","ArrowRight"].includes(U.key)&&(U.preventDefault(),U.stopPropagation(),i.handleTravellerMoveKeyboard(U.key==="ArrowRight"?1:-1,o))},onFocus:function(){i.setState({isTravellerFocused:!0})},onBlur:function(){i.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(A,j))}},{key:"renderSlide",value:function(n,o){var l=this.props,d=l.y,i=l.height,g=l.stroke,x=l.travellerWidth,S=Math.min(n,o)+x,E=Math.max(Math.abs(o-n)-x,0);return We.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:g,fillOpacity:.2,x:S,y:d,width:E,height:i})}},{key:"renderText",value:function(){var n=this.props,o=n.startIndex,l=n.endIndex,d=n.y,i=n.height,g=n.travellerWidth,x=n.stroke,S=this.state,E=S.startX,A=S.endX,C=5,N={pointerEvents:"none",fill:x};return We.createElement(ga,{className:"recharts-brush-texts"},We.createElement(yv,_I({textAnchor:"end",verticalAnchor:"middle",x:Math.min(E,A)-C,y:d+i/2},N),this.getTextOfTick(o)),We.createElement(yv,_I({textAnchor:"start",verticalAnchor:"middle",x:Math.max(E,A)+g+C,y:d+i/2},N),this.getTextOfTick(l)))}},{key:"render",value:function(){var n=this.props,o=n.data,l=n.className,d=n.children,i=n.x,g=n.y,x=n.width,S=n.height,E=n.alwaysShowText,A=this.state,C=A.startX,N=A.endX,k=A.isTextActive,R=A.isSlideMoving,L=A.isTravellerMoving,j=A.isTravellerFocused;if(!o||!o.length||!Fr(i)||!Fr(g)||!Fr(x)||!Fr(S)||x<=0||S<=0)return null;var F=Ei("recharts-brush",l),B=We.Children.count(d)===1,U=h7e("userSelect","none");return We.createElement(ga,{className:F,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:U},this.renderBackground(),B&&this.renderPanorama(),this.renderSlide(C,N),this.renderTravellerLayer(C,"startX"),this.renderTravellerLayer(N,"endX"),(k||R||L||j||E)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var o=n.x,l=n.y,d=n.width,i=n.height,g=n.stroke,x=Math.floor(l+i/2)-1;return We.createElement(We.Fragment,null,We.createElement("rect",{x:o,y:l,width:d,height:i,fill:g,stroke:"none"}),We.createElement("line",{x1:o+1,y1:x,x2:o+d-1,y2:x,fill:"none",stroke:"#fff"}),We.createElement("line",{x1:o+1,y1:x+2,x2:o+d-1,y2:x+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,o){var l;return We.isValidElement(n)?l=We.cloneElement(n,o):si(n)?l=n(o):l=t.renderDefaultTraveller(o),l}},{key:"getDerivedStateFromProps",value:function(n,o){var l=n.data,d=n.width,i=n.x,g=n.travellerWidth,x=n.updateId,S=n.startIndex,E=n.endIndex;if(l!==o.prevData||x!==o.prevUpdateId)return gD({prevData:l,prevTravellerWidth:g,prevUpdateId:x,prevX:i,prevWidth:d},l&&l.length?x7e({data:l,width:d,x:i,travellerWidth:g,startIndex:S,endIndex:E}):{scale:null,scaleValues:null});if(o.scale&&(d!==o.prevWidth||i!==o.prevX||g!==o.prevTravellerWidth)){o.scale.range([i,i+d-g]);var A=o.scale.domain().map(function(C){return o.scale(C)});return{prevData:l,prevTravellerWidth:g,prevUpdateId:x,prevX:i,prevWidth:d,startX:o.scale(n.startIndex),endX:o.scale(n.endIndex),scaleValues:A}}return null}},{key:"getIndexInRange",value:function(n,o){for(var l=n.length,d=0,i=l-1;i-d>1;){var g=Math.floor((d+i)/2);n[g]>o?i=g:d=g}return o>=n[i]?i:d}}])}(G.PureComponent);Mc(ib,"displayName","Brush");Mc(ib,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var b7e=a5;function w7e(e,t){var r;return b7e(e,function(n,o,l){return r=t(n,o,l),!r}),!!r}var S7e=w7e,E7e=toe,T7e=Nh,A7e=S7e,P7e=Ac,C7e=lR;function O7e(e,t,r){var n=P7e(e)?E7e:A7e;return r&&C7e(e,t,r)&&(t=void 0),n(e,T7e(t))}var I7e=O7e;const k7e=va(I7e);var Eh=function(t,r){var n=t.alwaysShow,o=t.ifOverflow;return n&&(o="extendDomain"),o===r},tK=Soe;function R7e(e,t,r){t=="__proto__"&&tK?tK(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var j7e=R7e,N7e=j7e,M7e=boe,D7e=Nh;function L7e(e,t){var r={};return t=D7e(t),M7e(e,function(n,o,l){N7e(r,o,t(n,o,l))}),r}var F7e=L7e;const z7e=va(F7e);function B7e(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var $7e=B7e,U7e=a5;function V7e(e,t){var r=!0;return U7e(e,function(n,o,l){return r=!!t(n,o,l),r}),r}var q7e=V7e,W7e=$7e,G7e=q7e,H7e=Nh,K7e=Ac,Z7e=lR;function X7e(e,t,r){var n=K7e(e)?W7e:G7e;return r&&Z7e(e,t,r)&&(t=void 0),n(e,H7e(t))}var Y7e=X7e;const mle=va(Y7e);var J7e=["x","y"];function dT(e){"@babel/helpers - typeof";return dT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dT(e)}function BF(){return BF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BF.apply(this,arguments)}function rK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function xS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rK(Object(r),!0).forEach(function(n){Q7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Q7e(e,t,r){return t=eKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eKe(e){var t=tKe(e,"string");return dT(t)=="symbol"?t:t+""}function tKe(e,t){if(dT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(dT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rKe(e,t){if(e==null)return{};var r=nKe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function iKe(e,t){var r=e.x,n=e.y,o=rKe(e,J7e),l="".concat(r),d=parseInt(l,10),i="".concat(n),g=parseInt(i,10),x="".concat(t.height||o.height),S=parseInt(x,10),E="".concat(t.width||o.width),A=parseInt(E,10);return xS(xS(xS(xS(xS({},t),o),d?{x:d}:{}),g?{y:g}:{}),{},{height:S,width:A,name:t.name,radius:t.radius})}function nK(e){return We.createElement(lle,BF({shapeType:"rectangle",propTransformer:iKe,activeClassName:"recharts-active-bar"},e))}var aKe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,o){if(typeof t=="number")return t;var l=Fr(n)||kje(n);return l?t(n,o):(l||_v(),r)}},oKe=["value","background"],gle;function ab(e){"@babel/helpers - typeof";return ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ab(e)}function sKe(e,t){if(e==null)return{};var r=lKe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function bI(){return bI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bI.apply(this,arguments)}function iK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Zo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iK(Object(r),!0).forEach(function(n){Em(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function aK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vle(n.key),n)}}function uKe(e,t,r){return t&&aK(e.prototype,t),r&&aK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dKe(e,t,r){return t=wI(t),hKe(e,yle()?Reflect.construct(t,r||[],wI(e).constructor):t.apply(e,r))}function hKe(e,t){if(t&&(ab(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fKe(e)}function fKe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yle=function(){return!!e})()}function wI(e){return wI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wI(e)}function pKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$F(e,t)}function $F(e,t){return $F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},$F(e,t)}function Em(e,t,r){return t=vle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vle(e){var t=mKe(e,"string");return ab(t)=="symbol"?t:t+""}function mKe(e,t){if(ab(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ab(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bu=function(e){function t(){var r;cKe(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=dKe(this,t,[].concat(o)),Em(r,"state",{isAnimationFinished:!1}),Em(r,"id",Lb("recharts-bar-")),Em(r,"handleAnimationEnd",function(){var d=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),d&&d()}),Em(r,"handleAnimationStart",function(){var d=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),d&&d()}),r}return pKe(t,e),uKe(t,[{key:"renderRectanglesStatically",value:function(n){var o=this,l=this.props,d=l.shape,i=l.dataKey,g=l.activeIndex,x=l.activeBar,S=qn(this.props,!1);return n&&n.map(function(E,A){var C=A===g,N=C?x:d,k=Zo(Zo(Zo({},S),E),{},{isActive:C,option:N,index:A,dataKey:i,onAnimationStart:o.handleAnimationStart,onAnimationEnd:o.handleAnimationEnd});return We.createElement(ga,bI({className:"recharts-bar-rectangle"},gv(o.props,E,A),{key:"rectangle-".concat(E==null?void 0:E.x,"-").concat(E==null?void 0:E.y,"-").concat(E==null?void 0:E.value,"-").concat(A)}),We.createElement(nK,k))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,o=this.props,l=o.data,d=o.layout,i=o.isAnimationActive,g=o.animationBegin,x=o.animationDuration,S=o.animationEasing,E=o.animationId,A=this.state.prevData;return We.createElement(Ch,{begin:g,duration:x,isActive:i,easing:S,from:{t:0},to:{t:1},key:"bar-".concat(E),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(C){var N=C.t,k=l.map(function(R,L){var j=A&&A[L];if(j){var F=$c(j.x,R.x),B=$c(j.y,R.y),U=$c(j.width,R.width),Z=$c(j.height,R.height);return Zo(Zo({},R),{},{x:F(N),y:B(N),width:U(N),height:Z(N)})}if(d==="horizontal"){var X=$c(0,R.height),te=X(N);return Zo(Zo({},R),{},{y:R.y+R.height-te,height:te})}var se=$c(0,R.width),oe=se(N);return Zo(Zo({},R),{},{width:oe})});return We.createElement(ga,null,n.renderRectanglesStatically(k))})}},{key:"renderRectangles",value:function(){var n=this.props,o=n.data,l=n.isAnimationActive,d=this.state.prevData;return l&&o&&o.length&&(!d||!eA(d,o))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(o)}},{key:"renderBackground",value:function(){var n=this,o=this.props,l=o.data,d=o.dataKey,i=o.activeIndex,g=qn(this.props.background,!1);return l.map(function(x,S){x.value;var E=x.background,A=sKe(x,oKe);if(!E)return null;var C=Zo(Zo(Zo(Zo(Zo({},A),{},{fill:"#eee"},E),g),gv(n.props,x,S)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:d,index:S,className:"recharts-bar-background-rectangle"});return We.createElement(nK,bI({key:"background-bar-".concat(S),option:n.props.background,isActive:S===i},C))})}},{key:"renderErrorBar",value:function(n,o){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.data,i=l.xAxis,g=l.yAxis,x=l.layout,S=l.children,E=Xc(S,tA);if(!E)return null;var A=x==="vertical"?d[0].height/2:d[0].width/2,C=function(R,L){var j=Array.isArray(R.value)?R.value[1]:R.value;return{x:R.x,y:R.y,value:j,errorVal:ps(R,L)}},N={clipPath:n?"url(#clipPath-".concat(o,")"):null};return We.createElement(ga,N,E.map(function(k){return We.cloneElement(k,{key:"error-bar-".concat(o,"-").concat(k.props.dataKey),data:d,xAxis:i,yAxis:g,layout:x,offset:A,dataPointFormatter:C})}))}},{key:"render",value:function(){var n=this.props,o=n.hide,l=n.data,d=n.className,i=n.xAxis,g=n.yAxis,x=n.left,S=n.top,E=n.width,A=n.height,C=n.isAnimationActive,N=n.background,k=n.id;if(o||!l||!l.length)return null;var R=this.state.isAnimationFinished,L=Ei("recharts-bar",d),j=i&&i.allowDataOverflow,F=g&&g.allowDataOverflow,B=j||F,U=bi(k)?this.id:k;return We.createElement(ga,{className:L},j||F?We.createElement("defs",null,We.createElement("clipPath",{id:"clipPath-".concat(U)},We.createElement("rect",{x:j?x:x-E/2,y:F?S:S-A/2,width:j?E:E*2,height:F?A:A*2}))):null,We.createElement(ga,{className:"recharts-bar-rectangles",clipPath:B?"url(#clipPath-".concat(U,")"):null},N?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(B,U),(!C||R)&&Cf.renderCallByParent(this.props,l))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:o.curData}:n.data!==o.curData?{curData:n.data}:null}}])}(G.PureComponent);gle=bu;Em(bu,"displayName","Bar");Em(bu,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!wh.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Em(bu,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,o=e.bandSize,l=e.xAxis,d=e.yAxis,i=e.xAxisTicks,g=e.yAxisTicks,x=e.stackedData,S=e.dataStartIndex,E=e.displayedData,A=e.offset,C=Z8e(n,r);if(!C)return null;var N=t.layout,k=r.type.defaultProps,R=k!==void 0?Zo(Zo({},k),r.props):r.props,L=R.dataKey,j=R.children,F=R.minPointSize,B=N==="horizontal"?d:l,U=x?B.scale.domain():null,Z=rqe({numericAxis:B}),X=Xc(j,zE),te=E.map(function(se,oe){var ne,ee,ie,he,Se,Ce;x?ne=X8e(x[S+oe],U):(ne=ps(se,L),Array.isArray(ne)||(ne=[Z,ne]));var fe=aKe(F,gle.defaultProps.minPointSize)(ne[1],oe);if(N==="horizontal"){var _e,be=[d.scale(ne[0]),d.scale(ne[1])],Pe=be[0],ye=be[1];ee=KH({axis:l,ticks:i,bandSize:o,offset:C.offset,entry:se,index:oe}),ie=(_e=ye??Pe)!==null&&_e!==void 0?_e:void 0,he=C.size;var ge=Pe-ye;if(Se=Number.isNaN(ge)?0:ge,Ce={x:ee,y:d.y,width:he,height:d.height},Math.abs(fe)>0&&Math.abs(Se)<Math.abs(fe)){var ke=Ul(Se||fe)*(Math.abs(fe)-Math.abs(Se));ie-=ke,Se+=ke}}else{var Qe=[l.scale(ne[0]),l.scale(ne[1])],He=Qe[0],$e=Qe[1];if(ee=He,ie=KH({axis:d,ticks:g,bandSize:o,offset:C.offset,entry:se,index:oe}),he=$e-He,Se=C.size,Ce={x:l.x,y:ie,width:l.width,height:Se},Math.abs(fe)>0&&Math.abs(he)<Math.abs(fe)){var Xe=Ul(he||fe)*(Math.abs(fe)-Math.abs(he));he+=Xe}}return Zo(Zo(Zo({},se),{},{x:ee,y:ie,width:he,height:Se,value:x?ne:ne[1],payload:se,background:Ce},X&&X[oe]&&X[oe].props),{},{tooltipPayload:[Bse(r,se)],tooltipPosition:{x:ee+he/2,y:ie+Se/2}})});return Zo({data:te,layout:N},A)});function hT(e){"@babel/helpers - typeof";return hT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hT(e)}function gKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_le(n.key),n)}}function yKe(e,t,r){return t&&oK(e.prototype,t),r&&oK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function sK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function pd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sK(Object(r),!0).forEach(function(n){PR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function PR(e,t,r){return t=_le(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _le(e){var t=vKe(e,"string");return hT(t)=="symbol"?t:t+""}function vKe(e,t){if(hT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xle=function(t,r,n,o,l){var d=t.width,i=t.height,g=t.layout,x=t.children,S=Object.keys(r),E={left:n.left,leftMirror:n.left,right:d-n.right,rightMirror:d-n.right,top:n.top,topMirror:n.top,bottom:i-n.bottom,bottomMirror:i-n.bottom},A=!!Fc(x,bu);return S.reduce(function(C,N){var k=r[N],R=k.orientation,L=k.domain,j=k.padding,F=j===void 0?{}:j,B=k.mirror,U=k.reversed,Z="".concat(R).concat(B?"Mirror":""),X,te,se,oe,ne;if(k.type==="number"&&(k.padding==="gap"||k.padding==="no-gap")){var ee=L[1]-L[0],ie=1/0,he=k.categoricalDomain.sort(Nje);if(he.forEach(function(Qe,He){He>0&&(ie=Math.min((Qe||0)-(he[He-1]||0),ie))}),Number.isFinite(ie)){var Se=ie/ee,Ce=k.layout==="vertical"?n.height:n.width;if(k.padding==="gap"&&(X=Se*Ce/2),k.padding==="no-gap"){var fe=Vl(t.barCategoryGap,Se*Ce),_e=Se*Ce/2;X=_e-fe-(_e-fe)/Ce*fe}}}o==="xAxis"?te=[n.left+(F.left||0)+(X||0),n.left+n.width-(F.right||0)-(X||0)]:o==="yAxis"?te=g==="horizontal"?[n.top+n.height-(F.bottom||0),n.top+(F.top||0)]:[n.top+(F.top||0)+(X||0),n.top+n.height-(F.bottom||0)-(X||0)]:te=k.range,U&&(te=[te[1],te[0]]);var be=Dse(k,l,A),Pe=be.scale,ye=be.realScaleType;Pe.domain(L).range(te),Lse(Pe);var ge=Fse(Pe,pd(pd({},k),{},{realScaleType:ye}));o==="xAxis"?(ne=R==="top"&&!B||R==="bottom"&&B,se=n.left,oe=E[Z]-ne*k.height):o==="yAxis"&&(ne=R==="left"&&!B||R==="right"&&B,se=E[Z]-ne*k.width,oe=n.top);var ke=pd(pd(pd({},k),ge),{},{realScaleType:ye,x:se,y:oe,scale:Pe,width:o==="xAxis"?n.width:k.width,height:o==="yAxis"?n.height:k.height});return ke.bandSize=aI(ke,ge),!k.hide&&o==="xAxis"?E[Z]+=(ne?-1:1)*ke.height:k.hide||(E[Z]+=(ne?-1:1)*ke.width),pd(pd({},C),{},PR({},N,ke))},{})},ble=function(t,r){var n=t.x,o=t.y,l=r.x,d=r.y;return{x:Math.min(n,l),y:Math.min(o,d),width:Math.abs(l-n),height:Math.abs(d-o)}},_Ke=function(t){var r=t.x1,n=t.y1,o=t.x2,l=t.y2;return ble({x:r,y:n},{x:o,y:l})},wle=function(){function e(t){gKe(this,e),this.scale=t}return yKe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.bandAware,l=n.position;if(r!==void 0){if(l)switch(l){case"start":return this.scale(r);case"middle":{var d=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+d}case"end":{var i=this.bandwidth?this.bandwidth():0;return this.scale(r)+i}default:return this.scale(r)}if(o){var g=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+g}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),o=n[0],l=n[n.length-1];return o<=l?r>=o&&r<=l:r>=l&&r<=o}}],[{key:"create",value:function(r){return new e(r)}}])}();PR(wle,"EPS",1e-4);var N5=function(t){var r=Object.keys(t).reduce(function(n,o){return pd(pd({},n),{},PR({},o,wle.create(t[o])))},{});return pd(pd({},r),{},{apply:function(o){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=l.bandAware,i=l.position;return z7e(o,function(g,x){return r[x].apply(g,{bandAware:d,position:i})})},isInRange:function(o){return mle(o,function(l,d){return r[d].isInRange(l)})}})};function xKe(e){return(e%180+180)%180}var bKe=function(t){var r=t.width,n=t.height,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=xKe(o),d=l*Math.PI/180,i=Math.atan(n/r),g=d>i&&d<Math.PI-i?n/Math.sin(d):r/Math.cos(d);return Math.abs(g)},wKe=Nh,SKe=ZT,EKe=oR;function TKe(e){return function(t,r,n){var o=Object(t);if(!SKe(t)){var l=wKe(r);t=EKe(t),r=function(i){return l(o[i],i,o)}}var d=e(t,r,n);return d>-1?o[l?t[d]:d]:void 0}}var AKe=TKe,PKe=dle;function CKe(e){var t=PKe(e),r=t%1;return t===t?r?t-r:t:0}var OKe=CKe,IKe=moe,kKe=Nh,RKe=OKe,jKe=Math.max;function NKe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var o=r==null?0:RKe(r);return o<0&&(o=jKe(n+o,0)),IKe(e,kKe(t),o)}var MKe=NKe,DKe=AKe,LKe=MKe,FKe=DKe(LKe),zKe=FKe;const BKe=va(zKe);var $Ke=MRe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),M5=G.createContext(void 0),D5=G.createContext(void 0),Sle=G.createContext(void 0),Ele=G.createContext({}),Tle=G.createContext(void 0),Ale=G.createContext(0),Ple=G.createContext(0),lK=function(t){var r=t.state,n=r.xAxisMap,o=r.yAxisMap,l=r.offset,d=t.clipPathId,i=t.children,g=t.width,x=t.height,S=$Ke(l);return We.createElement(M5.Provider,{value:n},We.createElement(D5.Provider,{value:o},We.createElement(Ele.Provider,{value:l},We.createElement(Sle.Provider,{value:S},We.createElement(Tle.Provider,{value:d},We.createElement(Ale.Provider,{value:x},We.createElement(Ple.Provider,{value:g},i)))))))},UKe=function(){return G.useContext(Tle)},Cle=function(t){var r=G.useContext(M5);r==null&&_v();var n=r[t];return n==null&&_v(),n},VKe=function(){var t=G.useContext(M5);return lm(t)},qKe=function(){var t=G.useContext(D5),r=BKe(t,function(n){return mle(n.domain,Number.isFinite)});return r||lm(t)},Ole=function(t){var r=G.useContext(D5);r==null&&_v();var n=r[t];return n==null&&_v(),n},WKe=function(){var t=G.useContext(Sle);return t},GKe=function(){return G.useContext(Ele)},L5=function(){return G.useContext(Ple)},F5=function(){return G.useContext(Ale)};function ob(e){"@babel/helpers - typeof";return ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ob(e)}function HKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KKe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kle(n.key),n)}}function ZKe(e,t,r){return t&&KKe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function XKe(e,t,r){return t=SI(t),YKe(e,Ile()?Reflect.construct(t,r||[],SI(e).constructor):t.apply(e,r))}function YKe(e,t){if(t&&(ob(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JKe(e)}function JKe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ile(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ile=function(){return!!e})()}function SI(e){return SI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},SI(e)}function QKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UF(e,t)}function UF(e,t){return UF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},UF(e,t)}function cK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cK(Object(r),!0).forEach(function(n){z5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e,t,r){return t=kle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kle(e){var t=eZe(e,"string");return ob(t)=="symbol"?t:t+""}function eZe(e,t){if(ob(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ob(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tZe(e,t){return aZe(e)||iZe(e,t)||nZe(e,t)||rZe()}function rZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nZe(e,t){if(e){if(typeof e=="string")return dK(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dK(e,t)}}function dK(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iZe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function aZe(e){if(Array.isArray(e))return e}function VF(){return VF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},VF.apply(this,arguments)}var oZe=function(t,r){var n;return We.isValidElement(t)?n=We.cloneElement(t,r):si(t)?n=t(r):n=We.createElement("line",VF({},r,{className:"recharts-reference-line-line"})),n},sZe=function(t,r,n,o,l,d,i,g,x){var S=l.x,E=l.y,A=l.width,C=l.height;if(n){var N=x.y,k=t.y.apply(N,{position:d});if(Eh(x,"discard")&&!t.y.isInRange(k))return null;var R=[{x:S+A,y:k},{x:S,y:k}];return g==="left"?R.reverse():R}if(r){var L=x.x,j=t.x.apply(L,{position:d});if(Eh(x,"discard")&&!t.x.isInRange(j))return null;var F=[{x:j,y:E+C},{x:j,y:E}];return i==="top"?F.reverse():F}if(o){var B=x.segment,U=B.map(function(Z){return t.apply(Z,{position:d})});return Eh(x,"discard")&&k7e(U,function(Z){return!t.isInRange(Z)})?null:U}return null};function lZe(e){var t=e.x,r=e.y,n=e.segment,o=e.xAxisId,l=e.yAxisId,d=e.shape,i=e.className,g=e.alwaysShow,x=UKe(),S=Cle(o),E=Ole(l),A=WKe();if(!x||!A)return null;Ed(g===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var C=N5({x:S.scale,y:E.scale}),N=gs(t),k=gs(r),R=n&&n.length===2,L=sZe(C,N,k,R,A,e.position,S.orientation,E.orientation,e);if(!L)return null;var j=tZe(L,2),F=j[0],B=F.x,U=F.y,Z=j[1],X=Z.x,te=Z.y,se=Eh(e,"hidden")?"url(#".concat(x,")"):void 0,oe=uK(uK({clipPath:se},qn(e,!0)),{},{x1:B,y1:U,x2:X,y2:te});return We.createElement(ga,{className:Ei("recharts-reference-line",i)},oZe(d,oe),Ps.renderCallByParent(e,_Ke({x1:B,y1:U,x2:X,y2:te})))}var B5=function(e){function t(){return HKe(this,t),XKe(this,t,arguments)}return QKe(t,e),ZKe(t,[{key:"render",value:function(){return We.createElement(lZe,this.props)}}])}(We.Component);z5(B5,"displayName","ReferenceLine");z5(B5,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function qF(){return qF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qF.apply(this,arguments)}function sb(e){"@babel/helpers - typeof";return sb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sb(e)}function hK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hK(Object(r),!0).forEach(function(n){CR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function uZe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jle(n.key),n)}}function dZe(e,t,r){return t&&uZe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function hZe(e,t,r){return t=EI(t),fZe(e,Rle()?Reflect.construct(t,r||[],EI(e).constructor):t.apply(e,r))}function fZe(e,t){if(t&&(sb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pZe(e)}function pZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Rle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Rle=function(){return!!e})()}function EI(e){return EI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},EI(e)}function mZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&WF(e,t)}function WF(e,t){return WF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},WF(e,t)}function CR(e,t,r){return t=jle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jle(e){var t=gZe(e,"string");return sb(t)=="symbol"?t:t+""}function gZe(e,t){if(sb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yZe=function(t){var r=t.x,n=t.y,o=t.xAxis,l=t.yAxis,d=N5({x:o.scale,y:l.scale}),i=d.apply({x:r,y:n},{bandAware:!0});return Eh(t,"discard")&&!d.isInRange(i)?null:i},OR=function(e){function t(){return cZe(this,t),hZe(this,t,arguments)}return mZe(t,e),dZe(t,[{key:"render",value:function(){var n=this.props,o=n.x,l=n.y,d=n.r,i=n.alwaysShow,g=n.clipPathId,x=gs(o),S=gs(l);if(Ed(i===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!x||!S)return null;var E=yZe(this.props);if(!E)return null;var A=E.x,C=E.y,N=this.props,k=N.shape,R=N.className,L=Eh(this.props,"hidden")?"url(#".concat(g,")"):void 0,j=fK(fK({clipPath:L},qn(this.props,!0)),{},{cx:A,cy:C});return We.createElement(ga,{className:Ei("recharts-reference-dot",R)},t.renderDot(k,j),Ps.renderCallByParent(this.props,{x:A-d,y:C-d,width:2*d,height:2*d}))}}])}(We.Component);CR(OR,"displayName","ReferenceDot");CR(OR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});CR(OR,"renderDot",function(e,t){var r;return We.isValidElement(e)?r=We.cloneElement(e,t):si(e)?r=e(t):r=We.createElement(xR,qF({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function GF(){return GF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},GF.apply(this,arguments)}function lb(e){"@babel/helpers - typeof";return lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lb(e)}function pK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mK(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pK(Object(r),!0).forEach(function(n){IR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _Ze(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Mle(n.key),n)}}function xZe(e,t,r){return t&&_Ze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bZe(e,t,r){return t=TI(t),wZe(e,Nle()?Reflect.construct(t,r||[],TI(e).constructor):t.apply(e,r))}function wZe(e,t){if(t&&(lb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SZe(e)}function SZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Nle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Nle=function(){return!!e})()}function TI(e){return TI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},TI(e)}function EZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&HF(e,t)}function HF(e,t){return HF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},HF(e,t)}function IR(e,t,r){return t=Mle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mle(e){var t=TZe(e,"string");return lb(t)=="symbol"?t:t+""}function TZe(e,t){if(lb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(lb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AZe=function(t,r,n,o,l){var d=l.x1,i=l.x2,g=l.y1,x=l.y2,S=l.xAxis,E=l.yAxis;if(!S||!E)return null;var A=N5({x:S.scale,y:E.scale}),C={x:t?A.x.apply(d,{position:"start"}):A.x.rangeMin,y:n?A.y.apply(g,{position:"start"}):A.y.rangeMin},N={x:r?A.x.apply(i,{position:"end"}):A.x.rangeMax,y:o?A.y.apply(x,{position:"end"}):A.y.rangeMax};return Eh(l,"discard")&&(!A.isInRange(C)||!A.isInRange(N))?null:ble(C,N)},kR=function(e){function t(){return vZe(this,t),bZe(this,t,arguments)}return EZe(t,e),xZe(t,[{key:"render",value:function(){var n=this.props,o=n.x1,l=n.x2,d=n.y1,i=n.y2,g=n.className,x=n.alwaysShow,S=n.clipPathId;Ed(x===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var E=gs(o),A=gs(l),C=gs(d),N=gs(i),k=this.props.shape;if(!E&&!A&&!C&&!N&&!k)return null;var R=AZe(E,A,C,N,this.props);if(!R&&!k)return null;var L=Eh(this.props,"hidden")?"url(#".concat(S,")"):void 0;return We.createElement(ga,{className:Ei("recharts-reference-area",g)},t.renderRect(k,mK(mK({clipPath:L},qn(this.props,!0)),R)),Ps.renderCallByParent(this.props,R))}}])}(We.Component);IR(kR,"displayName","ReferenceArea");IR(kR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});IR(kR,"renderRect",function(e,t){var r;return We.isValidElement(e)?r=We.cloneElement(e,t):si(e)?r=e(t):r=We.createElement(j5,GF({},t,{className:"recharts-reference-area-rect"})),r});function Dle(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],o=0;o<e.length;o+=t)n.push(e[o]);return n}function PZe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return bKe(n,r)}function CZe(e,t,r){var n=r==="width",o=e.x,l=e.y,d=e.width,i=e.height;return t===1?{start:n?o:l,end:n?o+d:l+i}:{start:n?o+d:l+i,end:n?o:l}}function AI(e,t,r,n,o){if(e*t<e*n||e*t>e*o)return!1;var l=r();return e*(t-e*l/2-n)>=0&&e*(t+e*l/2-o)<=0}function OZe(e,t){return Dle(e,t+1)}function IZe(e,t,r,n,o){for(var l=(n||[]).slice(),d=t.start,i=t.end,g=0,x=1,S=d,E=function(){var N=n==null?void 0:n[g];if(N===void 0)return{v:Dle(n,x)};var k=g,R,L=function(){return R===void 0&&(R=r(N,k)),R},j=N.coordinate,F=g===0||AI(e,j,L,S,i);F||(g=0,S=d,x+=1),F&&(S=j+e*(L()/2+o),g+=x)},A;x<=l.length;)if(A=E(),A)return A.v;return[]}function fT(e){"@babel/helpers - typeof";return fT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fT(e)}function gK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function al(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gK(Object(r),!0).forEach(function(n){kZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kZe(e,t,r){return t=RZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RZe(e){var t=jZe(e,"string");return fT(t)=="symbol"?t:t+""}function jZe(e,t){if(fT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NZe(e,t,r,n,o){for(var l=(n||[]).slice(),d=l.length,i=t.start,g=t.end,x=function(A){var C=l[A],N,k=function(){return N===void 0&&(N=r(C,A)),N};if(A===d-1){var R=e*(C.coordinate+e*k()/2-g);l[A]=C=al(al({},C),{},{tickCoord:R>0?C.coordinate-R*e:C.coordinate})}else l[A]=C=al(al({},C),{},{tickCoord:C.coordinate});var L=AI(e,C.tickCoord,k,i,g);L&&(g=C.tickCoord-e*(k()/2+o),l[A]=al(al({},C),{},{isShow:!0}))},S=d-1;S>=0;S--)x(S);return l}function MZe(e,t,r,n,o,l){var d=(n||[]).slice(),i=d.length,g=t.start,x=t.end;if(l){var S=n[i-1],E=r(S,i-1),A=e*(S.coordinate+e*E/2-x);d[i-1]=S=al(al({},S),{},{tickCoord:A>0?S.coordinate-A*e:S.coordinate});var C=AI(e,S.tickCoord,function(){return E},g,x);C&&(x=S.tickCoord-e*(E/2+o),d[i-1]=al(al({},S),{},{isShow:!0}))}for(var N=l?i-1:i,k=function(j){var F=d[j],B,U=function(){return B===void 0&&(B=r(F,j)),B};if(j===0){var Z=e*(F.coordinate-e*U()/2-g);d[j]=F=al(al({},F),{},{tickCoord:Z<0?F.coordinate-Z*e:F.coordinate})}else d[j]=F=al(al({},F),{},{tickCoord:F.coordinate});var X=AI(e,F.tickCoord,U,g,x);X&&(g=F.tickCoord+e*(U()/2+o),d[j]=al(al({},F),{},{isShow:!0}))},R=0;R<N;R++)k(R);return d}function $5(e,t,r){var n=e.tick,o=e.ticks,l=e.viewBox,d=e.minTickGap,i=e.orientation,g=e.interval,x=e.tickFormatter,S=e.unit,E=e.angle;if(!o||!o.length||!n)return[];if(Fr(g)||wh.isSsr)return OZe(o,typeof g=="number"&&Fr(g)?g:0);var A=[],C=i==="top"||i==="bottom"?"width":"height",N=S&&C==="width"?ZS(S,{fontSize:t,letterSpacing:r}):{width:0,height:0},k=function(F,B){var U=si(x)?x(F.value,B):F.value;return C==="width"?PZe(ZS(U,{fontSize:t,letterSpacing:r}),N,E):ZS(U,{fontSize:t,letterSpacing:r})[C]},R=o.length>=2?Ul(o[1].coordinate-o[0].coordinate):1,L=CZe(l,R,C);return g==="equidistantPreserveStart"?IZe(R,L,k,o,d):(g==="preserveStart"||g==="preserveStartEnd"?A=MZe(R,L,k,o,d,g==="preserveStartEnd"):A=NZe(R,L,k,o,d),A.filter(function(j){return j.isShow}))}var DZe=["viewBox"],LZe=["viewBox"],FZe=["ticks"];function cb(e){"@babel/helpers - typeof";return cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cb(e)}function Vx(){return Vx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Vx.apply(this,arguments)}function yK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ss(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yK(Object(r),!0).forEach(function(n){U5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yD(e,t){if(e==null)return{};var r=zZe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function BZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Fle(n.key),n)}}function $Ze(e,t,r){return t&&vK(e.prototype,t),r&&vK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function UZe(e,t,r){return t=PI(t),VZe(e,Lle()?Reflect.construct(t,r||[],PI(e).constructor):t.apply(e,r))}function VZe(e,t){if(t&&(cb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qZe(e)}function qZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lle=function(){return!!e})()}function PI(e){return PI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},PI(e)}function WZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&KF(e,t)}function KF(e,t){return KF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},KF(e,t)}function U5(e,t,r){return t=Fle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Fle(e){var t=GZe(e,"string");return cb(t)=="symbol"?t:t+""}function GZe(e,t){if(cb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var qb=function(e){function t(r){var n;return BZe(this,t),n=UZe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return WZe(t,e),$Ze(t,[{key:"shouldComponentUpdate",value:function(n,o){var l=n.viewBox,d=yD(n,DZe),i=this.props,g=i.viewBox,x=yD(i,LZe);return!o0(l,g)||!o0(d,x)||!o0(o,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var o=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];o&&this.setState({fontSize:window.getComputedStyle(o).fontSize,letterSpacing:window.getComputedStyle(o).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var o=this.props,l=o.x,d=o.y,i=o.width,g=o.height,x=o.orientation,S=o.tickSize,E=o.mirror,A=o.tickMargin,C,N,k,R,L,j,F=E?-1:1,B=n.tickSize||S,U=Fr(n.tickCoord)?n.tickCoord:n.coordinate;switch(x){case"top":C=N=n.coordinate,R=d+ +!E*g,k=R-F*B,j=k-F*A,L=U;break;case"left":k=R=n.coordinate,N=l+ +!E*i,C=N-F*B,L=C-F*A,j=U;break;case"right":k=R=n.coordinate,N=l+ +E*i,C=N+F*B,L=C+F*A,j=U;break;default:C=N=n.coordinate,R=d+ +E*g,k=R+F*B,j=k+F*A,L=U;break}return{line:{x1:C,y1:k,x2:N,y2:R},tick:{x:L,y:j}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,o=n.orientation,l=n.mirror,d;switch(o){case"left":d=l?"start":"end";break;case"right":d=l?"end":"start";break;default:d="middle";break}return d}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,o=n.orientation,l=n.mirror,d="end";switch(o){case"left":case"right":d="middle";break;case"top":d=l?"start":"end";break;default:d=l?"end":"start";break}return d}},{key:"renderAxisLine",value:function(){var n=this.props,o=n.x,l=n.y,d=n.width,i=n.height,g=n.orientation,x=n.mirror,S=n.axisLine,E=ss(ss(ss({},qn(this.props,!1)),qn(S,!1)),{},{fill:"none"});if(g==="top"||g==="bottom"){var A=+(g==="top"&&!x||g==="bottom"&&x);E=ss(ss({},E),{},{x1:o,y1:l+A*i,x2:o+d,y2:l+A*i})}else{var C=+(g==="left"&&!x||g==="right"&&x);E=ss(ss({},E),{},{x1:o+C*d,y1:l,x2:o+C*d,y2:l+i})}return We.createElement("line",Vx({},E,{className:Ei("recharts-cartesian-axis-line",Zc(S,"className"))}))}},{key:"renderTicks",value:function(n,o,l){var d=this,i=this.props,g=i.tickLine,x=i.stroke,S=i.tick,E=i.tickFormatter,A=i.unit,C=$5(ss(ss({},this.props),{},{ticks:n}),o,l),N=this.getTickTextAnchor(),k=this.getTickVerticalAnchor(),R=qn(this.props,!1),L=qn(S,!1),j=ss(ss({},R),{},{fill:"none"},qn(g,!1)),F=C.map(function(B,U){var Z=d.getTickLineCoord(B),X=Z.line,te=Z.tick,se=ss(ss(ss(ss({textAnchor:N,verticalAnchor:k},R),{},{stroke:"none",fill:x},L),te),{},{index:U,payload:B,visibleTicksCount:C.length,tickFormatter:E});return We.createElement(ga,Vx({className:"recharts-cartesian-axis-tick",key:"tick-".concat(B.value,"-").concat(B.coordinate,"-").concat(B.tickCoord)},gv(d.props,B,U)),g&&We.createElement("line",Vx({},j,X,{className:Ei("recharts-cartesian-axis-tick-line",Zc(g,"className"))})),S&&t.renderTickItem(S,se,"".concat(si(E)?E(B.value,U):B.value).concat(A||"")))});return We.createElement("g",{className:"recharts-cartesian-axis-ticks"},F)}},{key:"render",value:function(){var n=this,o=this.props,l=o.axisLine,d=o.width,i=o.height,g=o.ticksGenerator,x=o.className,S=o.hide;if(S)return null;var E=this.props,A=E.ticks,C=yD(E,FZe),N=A;return si(g)&&(N=A&&A.length>0?g(this.props):g(C)),d<=0||i<=0||!N||!N.length?null:We.createElement(ga,{className:Ei("recharts-cartesian-axis",x),ref:function(R){n.layerReference=R}},l&&this.renderAxisLine(),this.renderTicks(N,this.state.fontSize,this.state.letterSpacing),Ps.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,o,l){var d,i=Ei(o.className,"recharts-cartesian-axis-tick-value");return We.isValidElement(n)?d=We.cloneElement(n,ss(ss({},o),{},{className:i})):si(n)?d=n(ss(ss({},o),{},{className:i})):d=We.createElement(yv,Vx({},o,{className:"recharts-cartesian-axis-tick-value"}),l),d}}])}(G.Component);U5(qb,"displayName","CartesianAxis");U5(qb,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var HZe=["x1","y1","x2","y2","key"],KZe=["offset"];function xv(e){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xv(e)}function _K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function fl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_K(Object(r),!0).forEach(function(n){ZZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_K(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZZe(e,t,r){return t=XZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XZe(e){var t=YZe(e,"string");return xv(t)=="symbol"?t:t+""}function YZe(e,t){if(xv(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(xv(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Fy(){return Fy=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fy.apply(this,arguments)}function xK(e,t){if(e==null)return{};var r=JZe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function JZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var QZe=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,o=t.x,l=t.y,d=t.width,i=t.height,g=t.ry;return We.createElement("rect",{x:o,y:l,ry:g,width:d,height:i,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function zle(e,t){var r;if(We.isValidElement(e))r=We.cloneElement(e,t);else if(si(e))r=e(t);else{var n=t.x1,o=t.y1,l=t.x2,d=t.y2,i=t.key,g=xK(t,HZe),x=qn(g,!1);x.offset;var S=xK(x,KZe);r=We.createElement("line",Fy({},S,{x1:n,y1:o,x2:l,y2:d,fill:"none",key:i}))}return r}function eXe(e){var t=e.x,r=e.width,n=e.horizontal,o=n===void 0?!0:n,l=e.horizontalPoints;if(!o||!l||!l.length)return null;var d=l.map(function(i,g){var x=fl(fl({},e),{},{x1:t,y1:i,x2:t+r,y2:i,key:"line-".concat(g),index:g});return zle(o,x)});return We.createElement("g",{className:"recharts-cartesian-grid-horizontal"},d)}function tXe(e){var t=e.y,r=e.height,n=e.vertical,o=n===void 0?!0:n,l=e.verticalPoints;if(!o||!l||!l.length)return null;var d=l.map(function(i,g){var x=fl(fl({},e),{},{x1:i,y1:t,x2:i,y2:t+r,key:"line-".concat(g),index:g});return zle(o,x)});return We.createElement("g",{className:"recharts-cartesian-grid-vertical"},d)}function rXe(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,o=e.y,l=e.width,d=e.height,i=e.horizontalPoints,g=e.horizontal,x=g===void 0?!0:g;if(!x||!t||!t.length)return null;var S=i.map(function(A){return Math.round(A+o-o)}).sort(function(A,C){return A-C});o!==S[0]&&S.unshift(0);var E=S.map(function(A,C){var N=!S[C+1],k=N?o+d-A:S[C+1]-A;if(k<=0)return null;var R=C%t.length;return We.createElement("rect",{key:"react-".concat(C),y:A,x:n,height:k,width:l,stroke:"none",fill:t[R],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return We.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},E)}function nXe(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,o=e.fillOpacity,l=e.x,d=e.y,i=e.width,g=e.height,x=e.verticalPoints;if(!r||!n||!n.length)return null;var S=x.map(function(A){return Math.round(A+l-l)}).sort(function(A,C){return A-C});l!==S[0]&&S.unshift(0);var E=S.map(function(A,C){var N=!S[C+1],k=N?l+i-A:S[C+1]-A;if(k<=0)return null;var R=C%n.length;return We.createElement("rect",{key:"react-".concat(C),x:A,y:d,width:k,height:g,stroke:"none",fill:n[R],fillOpacity:o,className:"recharts-cartesian-grid-bg"})});return We.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},E)}var iXe=function(t,r){var n=t.xAxis,o=t.width,l=t.height,d=t.offset;return Mse($5(fl(fl(fl({},qb.defaultProps),n),{},{ticks:Sf(n,!0),viewBox:{x:0,y:0,width:o,height:l}})),d.left,d.left+d.width,r)},aXe=function(t,r){var n=t.yAxis,o=t.width,l=t.height,d=t.offset;return Mse($5(fl(fl(fl({},qb.defaultProps),n),{},{ticks:Sf(n,!0),viewBox:{x:0,y:0,width:o,height:l}})),d.top,d.top+d.height,r)},xx={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function zy(e){var t,r,n,o,l,d,i=L5(),g=F5(),x=GKe(),S=fl(fl({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:xx.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:xx.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:xx.horizontal,horizontalFill:(o=e.horizontalFill)!==null&&o!==void 0?o:xx.horizontalFill,vertical:(l=e.vertical)!==null&&l!==void 0?l:xx.vertical,verticalFill:(d=e.verticalFill)!==null&&d!==void 0?d:xx.verticalFill,x:Fr(e.x)?e.x:x.left,y:Fr(e.y)?e.y:x.top,width:Fr(e.width)?e.width:x.width,height:Fr(e.height)?e.height:x.height}),E=S.x,A=S.y,C=S.width,N=S.height,k=S.syncWithTicks,R=S.horizontalValues,L=S.verticalValues,j=VKe(),F=qKe();if(!Fr(C)||C<=0||!Fr(N)||N<=0||!Fr(E)||E!==+E||!Fr(A)||A!==+A)return null;var B=S.verticalCoordinatesGenerator||iXe,U=S.horizontalCoordinatesGenerator||aXe,Z=S.horizontalPoints,X=S.verticalPoints;if((!Z||!Z.length)&&si(U)){var te=R&&R.length,se=U({yAxis:F?fl(fl({},F),{},{ticks:te?R:F.ticks}):void 0,width:i,height:g,offset:x},te?!0:k);Ed(Array.isArray(se),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(xv(se),"]")),Array.isArray(se)&&(Z=se)}if((!X||!X.length)&&si(B)){var oe=L&&L.length,ne=B({xAxis:j?fl(fl({},j),{},{ticks:oe?L:j.ticks}):void 0,width:i,height:g,offset:x},oe?!0:k);Ed(Array.isArray(ne),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(xv(ne),"]")),Array.isArray(ne)&&(X=ne)}return We.createElement("g",{className:"recharts-cartesian-grid"},We.createElement(QZe,{fill:S.fill,fillOpacity:S.fillOpacity,x:S.x,y:S.y,width:S.width,height:S.height,ry:S.ry}),We.createElement(eXe,Fy({},S,{offset:x,horizontalPoints:Z,xAxis:j,yAxis:F})),We.createElement(tXe,Fy({},S,{offset:x,verticalPoints:X,xAxis:j,yAxis:F})),We.createElement(rXe,Fy({},S,{horizontalPoints:Z})),We.createElement(nXe,Fy({},S,{verticalPoints:X})))}zy.displayName="CartesianGrid";var oXe=["type","layout","connectNulls","ref"],sXe=["key"];function ub(e){"@babel/helpers - typeof";return ub=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ub(e)}function bK(e,t){if(e==null)return{};var r=lXe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function lXe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function tE(){return tE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tE.apply(this,arguments)}function wK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Nc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wK(Object(r),!0).forEach(function(n){md(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bx(e){return hXe(e)||dXe(e)||uXe(e)||cXe()}function cXe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uXe(e,t){if(e){if(typeof e=="string")return ZF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ZF(e,t)}}function dXe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function hXe(e){if(Array.isArray(e))return ZF(e)}function ZF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function SK(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$le(n.key),n)}}function pXe(e,t,r){return t&&SK(e.prototype,t),r&&SK(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function mXe(e,t,r){return t=CI(t),gXe(e,Ble()?Reflect.construct(t,r||[],CI(e).constructor):t.apply(e,r))}function gXe(e,t){if(t&&(ub(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yXe(e)}function yXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ble(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ble=function(){return!!e})()}function CI(e){return CI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},CI(e)}function vXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&XF(e,t)}function XF(e,t){return XF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},XF(e,t)}function md(e,t,r){return t=$le(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $le(e){var t=_Xe(e,"string");return ub(t)=="symbol"?t:t+""}function _Xe(e,t){if(ub(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ub(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Wb=function(e){function t(){var r;fXe(this,t);for(var n=arguments.length,o=new Array(n),l=0;l<n;l++)o[l]=arguments[l];return r=mXe(this,t,[].concat(o)),md(r,"state",{isAnimationFinished:!0,totalLength:0}),md(r,"generateSimpleStrokeDasharray",function(d,i){return"".concat(i,"px ").concat(d-i,"px")}),md(r,"getStrokeDasharray",function(d,i,g){var x=g.reduce(function(L,j){return L+j});if(!x)return r.generateSimpleStrokeDasharray(i,d);for(var S=Math.floor(d/x),E=d%x,A=i-d,C=[],N=0,k=0;N<g.length;k+=g[N],++N)if(k+g[N]>E){C=[].concat(bx(g.slice(0,N)),[E-k]);break}var R=C.length%2===0?[0,A]:[A];return[].concat(bx(t.repeat(g,S)),bx(C),R).map(function(L){return"".concat(L,"px")}).join(", ")}),md(r,"id",Lb("recharts-line-")),md(r,"pathRef",function(d){r.mainCurve=d}),md(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),md(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return vXe(t,e),pXe(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,o){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var l=this.props,d=l.points,i=l.xAxis,g=l.yAxis,x=l.layout,S=l.children,E=Xc(S,tA);if(!E)return null;var A=function(k,R){return{x:k.x,y:k.y,value:k.value,errorVal:ps(k.payload,R)}},C={clipPath:n?"url(#clipPath-".concat(o,")"):null};return We.createElement(ga,C,E.map(function(N){return We.cloneElement(N,{key:"bar-".concat(N.props.dataKey),data:d,xAxis:i,yAxis:g,layout:x,dataPointFormatter:A})}))}},{key:"renderDots",value:function(n,o,l){var d=this.props.isAnimationActive;if(d&&!this.state.isAnimationFinished)return null;var i=this.props,g=i.dot,x=i.points,S=i.dataKey,E=qn(this.props,!1),A=qn(g,!0),C=x.map(function(k,R){var L=Nc(Nc(Nc({key:"dot-".concat(R),r:3},E),A),{},{index:R,cx:k.x,cy:k.y,value:k.value,dataKey:S,payload:k.payload,points:x});return t.renderDotItem(g,L)}),N={clipPath:n?"url(#clipPath-".concat(o?"":"dots-").concat(l,")"):null};return We.createElement(ga,tE({className:"recharts-line-dots",key:"dots"},N),C)}},{key:"renderCurveStatically",value:function(n,o,l,d){var i=this.props,g=i.type,x=i.layout,S=i.connectNulls;i.ref;var E=bK(i,oXe),A=Nc(Nc(Nc({},qn(E,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:o?"url(#clipPath-".concat(l,")"):null,points:n},d),{},{type:g,layout:x,connectNulls:S});return We.createElement(lI,tE({},A,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,o){var l=this,d=this.props,i=d.points,g=d.strokeDasharray,x=d.isAnimationActive,S=d.animationBegin,E=d.animationDuration,A=d.animationEasing,C=d.animationId,N=d.animateNewValues,k=d.width,R=d.height,L=this.state,j=L.prevPoints,F=L.totalLength;return We.createElement(Ch,{begin:S,duration:E,isActive:x,easing:A,from:{t:0},to:{t:1},key:"line-".concat(C),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(B){var U=B.t;if(j){var Z=j.length/i.length,X=i.map(function(ee,ie){var he=Math.floor(ie*Z);if(j[he]){var Se=j[he],Ce=$c(Se.x,ee.x),fe=$c(Se.y,ee.y);return Nc(Nc({},ee),{},{x:Ce(U),y:fe(U)})}if(N){var _e=$c(k*2,ee.x),be=$c(R/2,ee.y);return Nc(Nc({},ee),{},{x:_e(U),y:be(U)})}return Nc(Nc({},ee),{},{x:ee.x,y:ee.y})});return l.renderCurveStatically(X,n,o)}var te=$c(0,F),se=te(U),oe;if(g){var ne="".concat(g).split(/[,\s]+/gim).map(function(ee){return parseFloat(ee)});oe=l.getStrokeDasharray(se,F,ne)}else oe=l.generateSimpleStrokeDasharray(F,se);return l.renderCurveStatically(i,n,o,{strokeDasharray:oe})})}},{key:"renderCurve",value:function(n,o){var l=this.props,d=l.points,i=l.isAnimationActive,g=this.state,x=g.prevPoints,S=g.totalLength;return i&&d&&d.length&&(!x&&S>0||!eA(x,d))?this.renderCurveWithAnimation(n,o):this.renderCurveStatically(d,n,o)}},{key:"render",value:function(){var n,o=this.props,l=o.hide,d=o.dot,i=o.points,g=o.className,x=o.xAxis,S=o.yAxis,E=o.top,A=o.left,C=o.width,N=o.height,k=o.isAnimationActive,R=o.id;if(l||!i||!i.length)return null;var L=this.state.isAnimationFinished,j=i.length===1,F=Ei("recharts-line",g),B=x&&x.allowDataOverflow,U=S&&S.allowDataOverflow,Z=B||U,X=bi(R)?this.id:R,te=(n=qn(d,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},se=te.r,oe=se===void 0?3:se,ne=te.strokeWidth,ee=ne===void 0?2:ne,ie=Vje(d)?d:{},he=ie.clipDot,Se=he===void 0?!0:he,Ce=oe*2+ee;return We.createElement(ga,{className:F},B||U?We.createElement("defs",null,We.createElement("clipPath",{id:"clipPath-".concat(X)},We.createElement("rect",{x:B?A:A-C/2,y:U?E:E-N/2,width:B?C:C*2,height:U?N:N*2})),!Se&&We.createElement("clipPath",{id:"clipPath-dots-".concat(X)},We.createElement("rect",{x:A-Ce/2,y:E-Ce/2,width:C+Ce,height:N+Ce}))):null,!j&&this.renderCurve(Z,X),this.renderErrorBar(Z,X),(j||d)&&this.renderDots(Z,Se,X),(!k||L)&&Cf.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,o){return n.animationId!==o.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:o.curPoints}:n.points!==o.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,o){for(var l=n.length%2!==0?[].concat(bx(n),[0]):n,d=[],i=0;i<o;++i)d=[].concat(bx(d),bx(l));return d}},{key:"renderDotItem",value:function(n,o){var l;if(We.isValidElement(n))l=We.cloneElement(n,o);else if(si(n))l=n(o);else{var d=o.key,i=bK(o,sXe),g=Ei("recharts-line-dot",typeof n!="boolean"?n.className:"");l=We.createElement(xR,tE({key:d},i,{className:g}))}return l}}])}(G.PureComponent);md(Wb,"displayName","Line");md(Wb,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!wh.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});md(Wb,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,o=e.xAxisTicks,l=e.yAxisTicks,d=e.dataKey,i=e.bandSize,g=e.displayedData,x=e.offset,S=t.layout,E=g.map(function(A,C){var N=ps(A,d);return S==="horizontal"?{x:HH({axis:r,ticks:o,bandSize:i,entry:A,index:C}),y:bi(N)?null:n.scale(N),value:N,payload:A}:{x:bi(N)?null:r.scale(N),y:HH({axis:n,ticks:l,bandSize:i,entry:A,index:C}),value:N,payload:A}});return Nc({points:E,layout:S},x)});function db(e){"@babel/helpers - typeof";return db=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},db(e)}function xXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bXe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qle(n.key),n)}}function wXe(e,t,r){return t&&bXe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function SXe(e,t,r){return t=OI(t),EXe(e,Ule()?Reflect.construct(t,r||[],OI(e).constructor):t.apply(e,r))}function EXe(e,t){if(t&&(db(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TXe(e)}function TXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ule(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ule=function(){return!!e})()}function OI(e){return OI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},OI(e)}function AXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&YF(e,t)}function YF(e,t){return YF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},YF(e,t)}function Vle(e,t,r){return t=qle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qle(e){var t=PXe(e,"string");return db(t)=="symbol"?t:t+""}function PXe(e,t){if(db(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(db(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JF(){return JF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JF.apply(this,arguments)}function CXe(e){var t=e.xAxisId,r=L5(),n=F5(),o=Cle(t);return o==null?null:G.createElement(qb,JF({},o,{className:Ei("recharts-".concat(o.axisType," ").concat(o.axisType),o.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(d){return Sf(d,!0)}}))}var gh=function(e){function t(){return xXe(this,t),SXe(this,t,arguments)}return AXe(t,e),wXe(t,[{key:"render",value:function(){return G.createElement(CXe,this.props)}}])}(G.Component);Vle(gh,"displayName","XAxis");Vle(gh,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function hb(e){"@babel/helpers - typeof";return hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hb(e)}function OXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function IXe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Hle(n.key),n)}}function kXe(e,t,r){return t&&IXe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function RXe(e,t,r){return t=II(t),jXe(e,Wle()?Reflect.construct(t,r||[],II(e).constructor):t.apply(e,r))}function jXe(e,t){if(t&&(hb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NXe(e)}function NXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Wle=function(){return!!e})()}function II(e){return II=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},II(e)}function MXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&QF(e,t)}function QF(e,t){return QF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},QF(e,t)}function Gle(e,t,r){return t=Hle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Hle(e){var t=DXe(e,"string");return hb(t)=="symbol"?t:t+""}function DXe(e,t){if(hb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ez(){return ez=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ez.apply(this,arguments)}var LXe=function(t){var r=t.yAxisId,n=L5(),o=F5(),l=Ole(r);return l==null?null:G.createElement(qb,ez({},l,{className:Ei("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:n,height:o},ticksGenerator:function(i){return Sf(i,!0)}}))},yh=function(e){function t(){return OXe(this,t),RXe(this,t,arguments)}return MXe(t,e),kXe(t,[{key:"render",value:function(){return G.createElement(LXe,this.props)}}])}(G.Component);Gle(yh,"displayName","YAxis");Gle(yh,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function EK(e){return $Xe(e)||BXe(e)||zXe(e)||FXe()}function FXe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zXe(e,t){if(e){if(typeof e=="string")return tz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tz(e,t)}}function BXe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $Xe(e){if(Array.isArray(e))return tz(e)}function tz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var rz=function(t,r,n,o,l){var d=Xc(t,B5),i=Xc(t,OR),g=[].concat(EK(d),EK(i)),x=Xc(t,kR),S="".concat(o,"Id"),E=o[0],A=r;if(g.length&&(A=g.reduce(function(k,R){if(R.props[S]===n&&Eh(R.props,"extendDomain")&&Fr(R.props[E])){var L=R.props[E];return[Math.min(k[0],L),Math.max(k[1],L)]}return k},A)),x.length){var C="".concat(E,"1"),N="".concat(E,"2");A=x.reduce(function(k,R){if(R.props[S]===n&&Eh(R.props,"extendDomain")&&Fr(R.props[C])&&Fr(R.props[N])){var L=R.props[C],j=R.props[N];return[Math.min(k[0],L,j),Math.max(k[1],L,j)]}return k},A)}return l&&l.length&&(A=l.reduce(function(k,R){return Fr(R)?[Math.min(k[0],R),Math.max(k[1],R)]:k},A)),A},Kle={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function o(g,x,S){this.fn=g,this.context=x,this.once=S||!1}function l(g,x,S,E,A){if(typeof S!="function")throw new TypeError("The listener must be a function");var C=new o(S,E||g,A),N=r?r+x:x;return g._events[N]?g._events[N].fn?g._events[N]=[g._events[N],C]:g._events[N].push(C):(g._events[N]=C,g._eventsCount++),g}function d(g,x){--g._eventsCount===0?g._events=new n:delete g._events[x]}function i(){this._events=new n,this._eventsCount=0}i.prototype.eventNames=function(){var x=[],S,E;if(this._eventsCount===0)return x;for(E in S=this._events)t.call(S,E)&&x.push(r?E.slice(1):E);return Object.getOwnPropertySymbols?x.concat(Object.getOwnPropertySymbols(S)):x},i.prototype.listeners=function(x){var S=r?r+x:x,E=this._events[S];if(!E)return[];if(E.fn)return[E.fn];for(var A=0,C=E.length,N=new Array(C);A<C;A++)N[A]=E[A].fn;return N},i.prototype.listenerCount=function(x){var S=r?r+x:x,E=this._events[S];return E?E.fn?1:E.length:0},i.prototype.emit=function(x,S,E,A,C,N){var k=r?r+x:x;if(!this._events[k])return!1;var R=this._events[k],L=arguments.length,j,F;if(R.fn){switch(R.once&&this.removeListener(x,R.fn,void 0,!0),L){case 1:return R.fn.call(R.context),!0;case 2:return R.fn.call(R.context,S),!0;case 3:return R.fn.call(R.context,S,E),!0;case 4:return R.fn.call(R.context,S,E,A),!0;case 5:return R.fn.call(R.context,S,E,A,C),!0;case 6:return R.fn.call(R.context,S,E,A,C,N),!0}for(F=1,j=new Array(L-1);F<L;F++)j[F-1]=arguments[F];R.fn.apply(R.context,j)}else{var B=R.length,U;for(F=0;F<B;F++)switch(R[F].once&&this.removeListener(x,R[F].fn,void 0,!0),L){case 1:R[F].fn.call(R[F].context);break;case 2:R[F].fn.call(R[F].context,S);break;case 3:R[F].fn.call(R[F].context,S,E);break;case 4:R[F].fn.call(R[F].context,S,E,A);break;default:if(!j)for(U=1,j=new Array(L-1);U<L;U++)j[U-1]=arguments[U];R[F].fn.apply(R[F].context,j)}}return!0},i.prototype.on=function(x,S,E){return l(this,x,S,E,!1)},i.prototype.once=function(x,S,E){return l(this,x,S,E,!0)},i.prototype.removeListener=function(x,S,E,A){var C=r?r+x:x;if(!this._events[C])return this;if(!S)return d(this,C),this;var N=this._events[C];if(N.fn)N.fn===S&&(!A||N.once)&&(!E||N.context===E)&&d(this,C);else{for(var k=0,R=[],L=N.length;k<L;k++)(N[k].fn!==S||A&&!N[k].once||E&&N[k].context!==E)&&R.push(N[k]);R.length?this._events[C]=R.length===1?R[0]:R:d(this,C)}return this},i.prototype.removeAllListeners=function(x){var S;return x?(S=r?r+x:x,this._events[S]&&d(this,S)):(this._events=new n,this._eventsCount=0),this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prefixed=r,i.EventEmitter=i,e.exports=i})(Kle);var UXe=Kle.exports;const VXe=va(UXe);var vD=new VXe,_D="recharts.syncMouseEvents";function pT(e){"@babel/helpers - typeof";return pT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pT(e)}function qXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function WXe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Zle(n.key),n)}}function GXe(e,t,r){return t&&WXe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function xD(e,t,r){return t=Zle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zle(e){var t=HXe(e,"string");return pT(t)=="symbol"?t:t+""}function HXe(e,t){if(pT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var KXe=function(){function e(){qXe(this,e),xD(this,"activeIndex",0),xD(this,"coordinateList",[]),xD(this,"layout","horizontal")}return GXe(e,[{key:"setDetails",value:function(r){var n,o=r.coordinateList,l=o===void 0?null:o,d=r.container,i=d===void 0?null:d,g=r.layout,x=g===void 0?null:g,S=r.offset,E=S===void 0?null:S,A=r.mouseHandlerCallback,C=A===void 0?null:A;this.coordinateList=(n=l??this.coordinateList)!==null&&n!==void 0?n:[],this.container=i??this.container,this.layout=x??this.layout,this.offset=E??this.offset,this.mouseHandlerCallback=C??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var o=this.container.getBoundingClientRect(),l=o.x,d=o.y,i=o.height,g=this.coordinateList[this.activeIndex].coordinate,x=((r=window)===null||r===void 0?void 0:r.scrollX)||0,S=((n=window)===null||n===void 0?void 0:n.scrollY)||0,E=l+g+x,A=d+this.offset.top+i/2+S;this.mouseHandlerCallback({pageX:E,pageY:A})}}}])}();function ZXe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],o=e==null?void 0:e[1];if(n&&o&&Fr(n)&&Fr(o))return!0}return!1}function XXe(e,t,r,n){var o=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-o:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-o,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Xle(e){var t=e.cx,r=e.cy,n=e.radius,o=e.startAngle,l=e.endAngle,d=Za(t,r,n,o),i=Za(t,r,n,l);return{points:[d,i],cx:t,cy:r,radius:n,startAngle:o,endAngle:l}}function YXe(e,t,r){var n,o,l,d;if(e==="horizontal")n=t.x,l=n,o=r.top,d=r.top+r.height;else if(e==="vertical")o=t.y,d=o,n=r.left,l=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var i=t.cx,g=t.cy,x=t.innerRadius,S=t.outerRadius,E=t.angle,A=Za(i,g,x,E),C=Za(i,g,S,E);n=A.x,o=A.y,l=C.x,d=C.y}else return Xle(t);return[{x:n,y:o},{x:l,y:d}]}function mT(e){"@babel/helpers - typeof";return mT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mT(e)}function TK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function HP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TK(Object(r),!0).forEach(function(n){JXe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function JXe(e,t,r){return t=QXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QXe(e){var t=eYe(e,"string");return mT(t)=="symbol"?t:t+""}function eYe(e,t){if(mT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(mT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function tYe(e){var t,r,n=e.element,o=e.tooltipEventType,l=e.isActive,d=e.activeCoordinate,i=e.activePayload,g=e.offset,x=e.activeTooltipIndex,S=e.tooltipAxisBandSize,E=e.layout,A=e.chartName,C=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!C||!l||!d||A!=="ScatterChart"&&o!=="axis")return null;var N,k=lI;if(A==="ScatterChart")N=d,k=_Ge;else if(A==="BarChart")N=XXe(E,d,g,S),k=j5;else if(E==="radial"){var R=Xle(d),L=R.cx,j=R.cy,F=R.radius,B=R.startAngle,U=R.endAngle;N={cx:L,cy:j,startAngle:B,endAngle:U,innerRadius:F,outerRadius:F},k=Gse}else N={points:YXe(E,d,g)},k=lI;var Z=HP(HP(HP(HP({stroke:"#ccc",pointerEvents:"none"},g),N),qn(C,!1)),{},{payload:i,payloadIndex:x,className:Ei("recharts-tooltip-cursor",C.className)});return G.isValidElement(C)?G.cloneElement(C,Z):G.createElement(k,Z)}var rYe=["item"],nYe=["children","className","width","height","style","compact","title","desc"];function fb(e){"@babel/helpers - typeof";return fb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fb(e)}function qx(){return qx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qx.apply(this,arguments)}function AK(e,t){return oYe(e)||aYe(e,t)||Jle(e,t)||iYe()}function iYe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aYe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,o,l,d,i=[],g=!0,x=!1;try{if(l=(r=r.call(e)).next,t!==0)for(;!(g=(n=l.call(r)).done)&&(i.push(n.value),i.length!==t);g=!0);}catch(S){x=!0,o=S}finally{try{if(!g&&r.return!=null&&(d=r.return(),Object(d)!==d))return}finally{if(x)throw o}}return i}}function oYe(e){if(Array.isArray(e))return e}function PK(e,t){if(e==null)return{};var r=sYe(e,t),n,o;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)n=l[o],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function sYe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function lYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Qle(n.key),n)}}function uYe(e,t,r){return t&&cYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function dYe(e,t,r){return t=kI(t),hYe(e,Yle()?Reflect.construct(t,r||[],kI(e).constructor):t.apply(e,r))}function hYe(e,t){if(t&&(fb(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fYe(e)}function fYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Yle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yle=function(){return!!e})()}function kI(e){return kI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},kI(e)}function pYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&nz(e,t)}function nz(e,t){return nz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},nz(e,t)}function pb(e){return yYe(e)||gYe(e)||Jle(e)||mYe()}function mYe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jle(e,t){if(e){if(typeof e=="string")return iz(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iz(e,t)}}function gYe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function yYe(e){if(Array.isArray(e))return iz(e)}function iz(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CK(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CK(Object(r),!0).forEach(function(n){Yn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CK(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yn(e,t,r){return t=Qle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qle(e){var t=vYe(e,"string");return fb(t)=="symbol"?t:t+""}function vYe(e,t){if(fb(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fb(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _Ye={xAxis:["bottom","top"],yAxis:["left","right"]},xYe={width:"100%",height:"100%"},ece={x:0,y:0};function KP(e){return e}var bYe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},wYe=function(t,r,n,o){var l=r.find(function(S){return S&&S.index===n});if(l){if(t==="horizontal")return{x:l.coordinate,y:o.y};if(t==="vertical")return{x:o.x,y:l.coordinate};if(t==="centric"){var d=l.coordinate,i=o.radius;return mr(mr(mr({},o),Za(o.cx,o.cy,i,d)),{},{angle:d,radius:i})}var g=l.coordinate,x=o.angle;return mr(mr(mr({},o),Za(o.cx,o.cy,g,x)),{},{angle:x,radius:g})}return ece},RR=function(t,r){var n=r.graphicalItems,o=r.dataStartIndex,l=r.dataEndIndex,d=(n??[]).reduce(function(i,g){var x=g.props.data;return x&&x.length?[].concat(pb(i),pb(x)):i},[]);return d.length>0?d:t&&t.length&&Fr(o)&&Fr(l)?t.slice(o,l+1):[]};function tce(e){return e==="number"?[0,"auto"]:void 0}var az=function(t,r,n,o){var l=t.graphicalItems,d=t.tooltipAxis,i=RR(r,t);return n<0||!l||!l.length||n>=i.length?null:l.reduce(function(g,x){var S,E=(S=x.props.data)!==null&&S!==void 0?S:r;E&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(E=E.slice(t.dataStartIndex,t.dataEndIndex+1));var A;if(d.dataKey&&!d.allowDuplicatedCategory){var C=E===void 0?i:E;A=kO(C,d.dataKey,o)}else A=E&&E[n]||i[n];return A?[].concat(pb(g),[Bse(x,A)]):g},[])},OK=function(t,r,n,o){var l=o||{x:t.chartX,y:t.chartY},d=bYe(l,n),i=t.orderedTooltipTicks,g=t.tooltipAxis,x=t.tooltipTicks,S=V8e(d,i,x,g);if(S>=0&&x){var E=x[S]&&x[S].value,A=az(t,r,S,E),C=wYe(n,i,S,l);return{activeTooltipIndex:S,activeLabel:E,activePayload:A,activeCoordinate:C}}return null},SYe=function(t,r){var n=r.axes,o=r.graphicalItems,l=r.axisType,d=r.axisIdKey,i=r.stackGroups,g=r.dataStartIndex,x=r.dataEndIndex,S=t.layout,E=t.children,A=t.stackOffset,C=Nse(S,l);return n.reduce(function(N,k){var R,L=k.type.defaultProps!==void 0?mr(mr({},k.type.defaultProps),k.props):k.props,j=L.type,F=L.dataKey,B=L.allowDataOverflow,U=L.allowDuplicatedCategory,Z=L.scale,X=L.ticks,te=L.includeHidden,se=L[d];if(N[se])return N;var oe=RR(t.data,{graphicalItems:o.filter(function(ge){var ke,Qe=d in ge.props?ge.props[d]:(ke=ge.type.defaultProps)===null||ke===void 0?void 0:ke[d];return Qe===se}),dataStartIndex:g,dataEndIndex:x}),ne=oe.length,ee,ie,he;ZXe(L.domain,B,j)&&(ee=_F(L.domain,null,B),C&&(j==="number"||Z!=="auto")&&(he=YS(oe,F,"category")));var Se=tce(j);if(!ee||ee.length===0){var Ce,fe=(Ce=L.domain)!==null&&Ce!==void 0?Ce:Se;if(F){if(ee=YS(oe,F,j),j==="category"&&C){var _e=jje(ee);U&&_e?(ie=ee,ee=vI(0,ne)):U||(ee=YH(fe,ee,k).reduce(function(ge,ke){return ge.indexOf(ke)>=0?ge:[].concat(pb(ge),[ke])},[]))}else if(j==="category")U?ee=ee.filter(function(ge){return ge!==""&&!bi(ge)}):ee=YH(fe,ee,k).reduce(function(ge,ke){return ge.indexOf(ke)>=0||ke===""||bi(ke)?ge:[].concat(pb(ge),[ke])},[]);else if(j==="number"){var be=K8e(oe,o.filter(function(ge){var ke,Qe,He=d in ge.props?ge.props[d]:(ke=ge.type.defaultProps)===null||ke===void 0?void 0:ke[d],$e="hide"in ge.props?ge.props.hide:(Qe=ge.type.defaultProps)===null||Qe===void 0?void 0:Qe.hide;return He===se&&(te||!$e)}),F,l,S);be&&(ee=be)}C&&(j==="number"||Z!=="auto")&&(he=YS(oe,F,"category"))}else C?ee=vI(0,ne):i&&i[se]&&i[se].hasStack&&j==="number"?ee=A==="expand"?[0,1]:zse(i[se].stackGroups,g,x):ee=jse(oe,o.filter(function(ge){var ke=d in ge.props?ge.props[d]:ge.type.defaultProps[d],Qe="hide"in ge.props?ge.props.hide:ge.type.defaultProps.hide;return ke===se&&(te||!Qe)}),j,S,!0);if(j==="number")ee=rz(E,ee,se,l,X),fe&&(ee=_F(fe,ee,B));else if(j==="category"&&fe){var Pe=fe,ye=ee.every(function(ge){return Pe.indexOf(ge)>=0});ye&&(ee=Pe)}}return mr(mr({},N),{},Yn({},se,mr(mr({},L),{},{axisType:l,domain:ee,categoricalDomain:he,duplicateDomain:ie,originalDomain:(R=L.domain)!==null&&R!==void 0?R:Se,isCategorical:C,layout:S})))},{})},EYe=function(t,r){var n=r.graphicalItems,o=r.Axis,l=r.axisType,d=r.axisIdKey,i=r.stackGroups,g=r.dataStartIndex,x=r.dataEndIndex,S=t.layout,E=t.children,A=RR(t.data,{graphicalItems:n,dataStartIndex:g,dataEndIndex:x}),C=A.length,N=Nse(S,l),k=-1;return n.reduce(function(R,L){var j=L.type.defaultProps!==void 0?mr(mr({},L.type.defaultProps),L.props):L.props,F=j[d],B=tce("number");if(!R[F]){k++;var U;return N?U=vI(0,C):i&&i[F]&&i[F].hasStack?(U=zse(i[F].stackGroups,g,x),U=rz(E,U,F,l)):(U=_F(B,jse(A,n.filter(function(Z){var X,te,se=d in Z.props?Z.props[d]:(X=Z.type.defaultProps)===null||X===void 0?void 0:X[d],oe="hide"in Z.props?Z.props.hide:(te=Z.type.defaultProps)===null||te===void 0?void 0:te.hide;return se===F&&!oe}),"number",S),o.defaultProps.allowDataOverflow),U=rz(E,U,F,l)),mr(mr({},R),{},Yn({},F,mr(mr({axisType:l},o.defaultProps),{},{hide:!0,orientation:Zc(_Ye,"".concat(l,".").concat(k%2),null),domain:U,originalDomain:B,isCategorical:N,layout:S})))}return R},{})},TYe=function(t,r){var n=r.axisType,o=n===void 0?"xAxis":n,l=r.AxisComp,d=r.graphicalItems,i=r.stackGroups,g=r.dataStartIndex,x=r.dataEndIndex,S=t.children,E="".concat(o,"Id"),A=Xc(S,l),C={};return A&&A.length?C=SYe(t,{axes:A,graphicalItems:d,axisType:o,axisIdKey:E,stackGroups:i,dataStartIndex:g,dataEndIndex:x}):d&&d.length&&(C=EYe(t,{Axis:l,graphicalItems:d,axisType:o,axisIdKey:E,stackGroups:i,dataStartIndex:g,dataEndIndex:x})),C},AYe=function(t){var r=lm(t),n=Sf(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:o5(n,function(o){return o.coordinate}),tooltipAxis:r,tooltipAxisBandSize:aI(r,n)}},IK=function(t){var r=t.children,n=t.defaultShowTooltip,o=Fc(r,ib),l=0,d=0;return t.data&&t.data.length!==0&&(d=t.data.length-1),o&&o.props&&(o.props.startIndex>=0&&(l=o.props.startIndex),o.props.endIndex>=0&&(d=o.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:l,dataEndIndex:d,activeTooltipIndex:-1,isTooltipActive:!!n}},PYe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Af(r&&r.type);return n&&n.indexOf("Bar")>=0})},kK=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},CYe=function(t,r){var n=t.props,o=t.graphicalItems,l=t.xAxisMap,d=l===void 0?{}:l,i=t.yAxisMap,g=i===void 0?{}:i,x=n.width,S=n.height,E=n.children,A=n.margin||{},C=Fc(E,ib),N=Fc(E,ph),k=Object.keys(g).reduce(function(U,Z){var X=g[Z],te=X.orientation;return!X.mirror&&!X.hide?mr(mr({},U),{},Yn({},te,U[te]+X.width)):U},{left:A.left||0,right:A.right||0}),R=Object.keys(d).reduce(function(U,Z){var X=d[Z],te=X.orientation;return!X.mirror&&!X.hide?mr(mr({},U),{},Yn({},te,Zc(U,"".concat(te))+X.height)):U},{top:A.top||0,bottom:A.bottom||0}),L=mr(mr({},R),k),j=L.bottom;C&&(L.bottom+=C.props.height||ib.defaultProps.height),N&&r&&(L=G8e(L,o,n,r));var F=x-L.left-L.right,B=S-L.top-L.bottom;return mr(mr({brushBottom:j},L),{},{width:Math.max(F,0),height:Math.max(B,0)})},OYe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},V5=function(t){var r=t.chartName,n=t.GraphicalChild,o=t.defaultTooltipEventType,l=o===void 0?"axis":o,d=t.validateTooltipEventTypes,i=d===void 0?["axis"]:d,g=t.axisComponents,x=t.legendContent,S=t.formatAxisMap,E=t.defaultProps,A=function(L,j){var F=j.graphicalItems,B=j.stackGroups,U=j.offset,Z=j.updateId,X=j.dataStartIndex,te=j.dataEndIndex,se=L.barSize,oe=L.layout,ne=L.barGap,ee=L.barCategoryGap,ie=L.maxBarSize,he=kK(oe),Se=he.numericAxisName,Ce=he.cateAxisName,fe=PYe(F),_e=[];return F.forEach(function(be,Pe){var ye=RR(L.data,{graphicalItems:[be],dataStartIndex:X,dataEndIndex:te}),ge=be.type.defaultProps!==void 0?mr(mr({},be.type.defaultProps),be.props):be.props,ke=ge.dataKey,Qe=ge.maxBarSize,He=ge["".concat(Se,"Id")],$e=ge["".concat(Ce,"Id")],Xe={},ft=g.reduce(function(at,dt){var tr=j["".concat(dt.axisType,"Map")],Qt=ge["".concat(dt.axisType,"Id")];tr&&tr[Qt]||dt.axisType==="zAxis"||_v();var er=tr[Qt];return mr(mr({},at),{},Yn(Yn({},dt.axisType,er),"".concat(dt.axisType,"Ticks"),Sf(er)))},Xe),ze=ft[Ce],ut=ft["".concat(Ce,"Ticks")],At=B&&B[He]&&B[He].hasStack&&nqe(be,B[He].stackGroups),xt=Af(be.type).indexOf("Bar")>=0,nr=aI(ze,ut),Vt=[],dr=fe&&q8e({barSize:se,stackGroups:B,totalSize:OYe(ft,Ce)});if(xt){var Br,Yr,_t=bi(Qe)?ie:Qe,Mt=(Br=(Yr=aI(ze,ut,!0))!==null&&Yr!==void 0?Yr:_t)!==null&&Br!==void 0?Br:0;Vt=W8e({barGap:ne,barCategoryGap:ee,bandSize:Mt!==nr?Mt:nr,sizeList:dr[$e],maxBarSize:_t}),Mt!==nr&&(Vt=Vt.map(function(at){return mr(mr({},at),{},{position:mr(mr({},at.position),{},{offset:at.position.offset-Mt/2})})}))}var Ke=be&&be.type&&be.type.getComposedData;Ke&&_e.push({props:mr(mr({},Ke(mr(mr({},ft),{},{displayedData:ye,props:L,dataKey:ke,item:be,bandSize:nr,barPosition:Vt,offset:U,stackedData:At,layout:oe,dataStartIndex:X,dataEndIndex:te}))),{},Yn(Yn(Yn({key:be.key||"item-".concat(Pe)},Se,ft[Se]),Ce,ft[Ce]),"animationId",Z)),childIndex:Gje(be,L.children),item:be})}),_e},C=function(L,j){var F=L.props,B=L.dataStartIndex,U=L.dataEndIndex,Z=L.updateId;if(!q9({props:F}))return null;var X=F.children,te=F.layout,se=F.stackOffset,oe=F.data,ne=F.reverseStackOrder,ee=kK(te),ie=ee.numericAxisName,he=ee.cateAxisName,Se=Xc(X,n),Ce=tqe(oe,Se,"".concat(ie,"Id"),"".concat(he,"Id"),se,ne),fe=g.reduce(function(ge,ke){var Qe="".concat(ke.axisType,"Map");return mr(mr({},ge),{},Yn({},Qe,TYe(F,mr(mr({},ke),{},{graphicalItems:Se,stackGroups:ke.axisType===ie&&Ce,dataStartIndex:B,dataEndIndex:U}))))},{}),_e=CYe(mr(mr({},fe),{},{props:F,graphicalItems:Se}),j==null?void 0:j.legendBBox);Object.keys(fe).forEach(function(ge){fe[ge]=S(F,fe[ge],_e,ge.replace("Map",""),r)});var be=fe["".concat(he,"Map")],Pe=AYe(be),ye=A(F,mr(mr({},fe),{},{dataStartIndex:B,dataEndIndex:U,updateId:Z,graphicalItems:Se,stackGroups:Ce,offset:_e}));return mr(mr({formattedGraphicalItems:ye,graphicalItems:Se,offset:_e,stackGroups:Ce},Pe),fe)},N=function(R){function L(j){var F,B,U;return lYe(this,L),U=dYe(this,L,[j]),Yn(U,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Yn(U,"accessibilityManager",new KXe),Yn(U,"handleLegendBBoxUpdate",function(Z){if(Z){var X=U.state,te=X.dataStartIndex,se=X.dataEndIndex,oe=X.updateId;U.setState(mr({legendBBox:Z},C({props:U.props,dataStartIndex:te,dataEndIndex:se,updateId:oe},mr(mr({},U.state),{},{legendBBox:Z}))))}}),Yn(U,"handleReceiveSyncEvent",function(Z,X,te){if(U.props.syncId===Z){if(te===U.eventEmitterSymbol&&typeof U.props.syncMethod!="function")return;U.applySyncEvent(X)}}),Yn(U,"handleBrushChange",function(Z){var X=Z.startIndex,te=Z.endIndex;if(X!==U.state.dataStartIndex||te!==U.state.dataEndIndex){var se=U.state.updateId;U.setState(function(){return mr({dataStartIndex:X,dataEndIndex:te},C({props:U.props,dataStartIndex:X,dataEndIndex:te,updateId:se},U.state))}),U.triggerSyncEvent({dataStartIndex:X,dataEndIndex:te})}}),Yn(U,"handleMouseEnter",function(Z){var X=U.getMouseInfo(Z);if(X){var te=mr(mr({},X),{},{isTooltipActive:!0});U.setState(te),U.triggerSyncEvent(te);var se=U.props.onMouseEnter;si(se)&&se(te,Z)}}),Yn(U,"triggeredAfterMouseMove",function(Z){var X=U.getMouseInfo(Z),te=X?mr(mr({},X),{},{isTooltipActive:!0}):{isTooltipActive:!1};U.setState(te),U.triggerSyncEvent(te);var se=U.props.onMouseMove;si(se)&&se(te,Z)}),Yn(U,"handleItemMouseEnter",function(Z){U.setState(function(){return{isTooltipActive:!0,activeItem:Z,activePayload:Z.tooltipPayload,activeCoordinate:Z.tooltipPosition||{x:Z.cx,y:Z.cy}}})}),Yn(U,"handleItemMouseLeave",function(){U.setState(function(){return{isTooltipActive:!1}})}),Yn(U,"handleMouseMove",function(Z){Z.persist(),U.throttleTriggeredAfterMouseMove(Z)}),Yn(U,"handleMouseLeave",function(Z){U.throttleTriggeredAfterMouseMove.cancel();var X={isTooltipActive:!1};U.setState(X),U.triggerSyncEvent(X);var te=U.props.onMouseLeave;si(te)&&te(X,Z)}),Yn(U,"handleOuterEvent",function(Z){var X=Wje(Z),te=Zc(U.props,"".concat(X));if(X&&si(te)){var se,oe;/.*touch.*/i.test(X)?oe=U.getMouseInfo(Z.changedTouches[0]):oe=U.getMouseInfo(Z),te((se=oe)!==null&&se!==void 0?se:{},Z)}}),Yn(U,"handleClick",function(Z){var X=U.getMouseInfo(Z);if(X){var te=mr(mr({},X),{},{isTooltipActive:!0});U.setState(te),U.triggerSyncEvent(te);var se=U.props.onClick;si(se)&&se(te,Z)}}),Yn(U,"handleMouseDown",function(Z){var X=U.props.onMouseDown;if(si(X)){var te=U.getMouseInfo(Z);X(te,Z)}}),Yn(U,"handleMouseUp",function(Z){var X=U.props.onMouseUp;if(si(X)){var te=U.getMouseInfo(Z);X(te,Z)}}),Yn(U,"handleTouchMove",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.throttleTriggeredAfterMouseMove(Z.changedTouches[0])}),Yn(U,"handleTouchStart",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.handleMouseDown(Z.changedTouches[0])}),Yn(U,"handleTouchEnd",function(Z){Z.changedTouches!=null&&Z.changedTouches.length>0&&U.handleMouseUp(Z.changedTouches[0])}),Yn(U,"handleDoubleClick",function(Z){var X=U.props.onDoubleClick;if(si(X)){var te=U.getMouseInfo(Z);X(te,Z)}}),Yn(U,"handleContextMenu",function(Z){var X=U.props.onContextMenu;if(si(X)){var te=U.getMouseInfo(Z);X(te,Z)}}),Yn(U,"triggerSyncEvent",function(Z){U.props.syncId!==void 0&&vD.emit(_D,U.props.syncId,Z,U.eventEmitterSymbol)}),Yn(U,"applySyncEvent",function(Z){var X=U.props,te=X.layout,se=X.syncMethod,oe=U.state.updateId,ne=Z.dataStartIndex,ee=Z.dataEndIndex;if(Z.dataStartIndex!==void 0||Z.dataEndIndex!==void 0)U.setState(mr({dataStartIndex:ne,dataEndIndex:ee},C({props:U.props,dataStartIndex:ne,dataEndIndex:ee,updateId:oe},U.state)));else if(Z.activeTooltipIndex!==void 0){var ie=Z.chartX,he=Z.chartY,Se=Z.activeTooltipIndex,Ce=U.state,fe=Ce.offset,_e=Ce.tooltipTicks;if(!fe)return;if(typeof se=="function")Se=se(_e,Z);else if(se==="value"){Se=-1;for(var be=0;be<_e.length;be++)if(_e[be].value===Z.activeLabel){Se=be;break}}var Pe=mr(mr({},fe),{},{x:fe.left,y:fe.top}),ye=Math.min(ie,Pe.x+Pe.width),ge=Math.min(he,Pe.y+Pe.height),ke=_e[Se]&&_e[Se].value,Qe=az(U.state,U.props.data,Se),He=_e[Se]?{x:te==="horizontal"?_e[Se].coordinate:ye,y:te==="horizontal"?ge:_e[Se].coordinate}:ece;U.setState(mr(mr({},Z),{},{activeLabel:ke,activeCoordinate:He,activePayload:Qe,activeTooltipIndex:Se}))}else U.setState(Z)}),Yn(U,"renderCursor",function(Z){var X,te=U.state,se=te.isTooltipActive,oe=te.activeCoordinate,ne=te.activePayload,ee=te.offset,ie=te.activeTooltipIndex,he=te.tooltipAxisBandSize,Se=U.getTooltipEventType(),Ce=(X=Z.props.active)!==null&&X!==void 0?X:se,fe=U.props.layout,_e=Z.key||"_recharts-cursor";return We.createElement(tYe,{key:_e,activeCoordinate:oe,activePayload:ne,activeTooltipIndex:ie,chartName:r,element:Z,isActive:Ce,layout:fe,offset:ee,tooltipAxisBandSize:he,tooltipEventType:Se})}),Yn(U,"renderPolarAxis",function(Z,X,te){var se=Zc(Z,"type.axisType"),oe=Zc(U.state,"".concat(se,"Map")),ne=Z.type.defaultProps,ee=ne!==void 0?mr(mr({},ne),Z.props):Z.props,ie=oe&&oe[ee["".concat(se,"Id")]];return G.cloneElement(Z,mr(mr({},ie),{},{className:Ei(se,ie.className),key:Z.key||"".concat(X,"-").concat(te),ticks:Sf(ie,!0)}))}),Yn(U,"renderPolarGrid",function(Z){var X=Z.props,te=X.radialLines,se=X.polarAngles,oe=X.polarRadius,ne=U.state,ee=ne.radiusAxisMap,ie=ne.angleAxisMap,he=lm(ee),Se=lm(ie),Ce=Se.cx,fe=Se.cy,_e=Se.innerRadius,be=Se.outerRadius;return G.cloneElement(Z,{polarAngles:Array.isArray(se)?se:Sf(Se,!0).map(function(Pe){return Pe.coordinate}),polarRadius:Array.isArray(oe)?oe:Sf(he,!0).map(function(Pe){return Pe.coordinate}),cx:Ce,cy:fe,innerRadius:_e,outerRadius:be,key:Z.key||"polar-grid",radialLines:te})}),Yn(U,"renderLegend",function(){var Z=U.state.formattedGraphicalItems,X=U.props,te=X.children,se=X.width,oe=X.height,ne=U.props.margin||{},ee=se-(ne.left||0)-(ne.right||0),ie=kse({children:te,formattedGraphicalItems:Z,legendWidth:ee,legendContent:x});if(!ie)return null;var he=ie.item,Se=PK(ie,rYe);return G.cloneElement(he,mr(mr({},Se),{},{chartWidth:se,chartHeight:oe,margin:ne,onBBoxUpdate:U.handleLegendBBoxUpdate}))}),Yn(U,"renderTooltip",function(){var Z,X=U.props,te=X.children,se=X.accessibilityLayer,oe=Fc(te,Vs);if(!oe)return null;var ne=U.state,ee=ne.isTooltipActive,ie=ne.activeCoordinate,he=ne.activePayload,Se=ne.activeLabel,Ce=ne.offset,fe=(Z=oe.props.active)!==null&&Z!==void 0?Z:ee;return G.cloneElement(oe,{viewBox:mr(mr({},Ce),{},{x:Ce.left,y:Ce.top}),active:fe,label:Se,payload:fe?he:[],coordinate:ie,accessibilityLayer:se})}),Yn(U,"renderBrush",function(Z){var X=U.props,te=X.margin,se=X.data,oe=U.state,ne=oe.offset,ee=oe.dataStartIndex,ie=oe.dataEndIndex,he=oe.updateId;return G.cloneElement(Z,{key:Z.key||"_recharts-brush",onChange:VP(U.handleBrushChange,Z.props.onChange),data:se,x:Fr(Z.props.x)?Z.props.x:ne.left,y:Fr(Z.props.y)?Z.props.y:ne.top+ne.height+ne.brushBottom-(te.bottom||0),width:Fr(Z.props.width)?Z.props.width:ne.width,startIndex:ee,endIndex:ie,updateId:"brush-".concat(he)})}),Yn(U,"renderReferenceElement",function(Z,X,te){if(!Z)return null;var se=U,oe=se.clipPathId,ne=U.state,ee=ne.xAxisMap,ie=ne.yAxisMap,he=ne.offset,Se=Z.type.defaultProps||{},Ce=Z.props,fe=Ce.xAxisId,_e=fe===void 0?Se.xAxisId:fe,be=Ce.yAxisId,Pe=be===void 0?Se.yAxisId:be;return G.cloneElement(Z,{key:Z.key||"".concat(X,"-").concat(te),xAxis:ee[_e],yAxis:ie[Pe],viewBox:{x:he.left,y:he.top,width:he.width,height:he.height},clipPathId:oe})}),Yn(U,"renderActivePoints",function(Z){var X=Z.item,te=Z.activePoint,se=Z.basePoint,oe=Z.childIndex,ne=Z.isRange,ee=[],ie=X.props.key,he=X.item.type.defaultProps!==void 0?mr(mr({},X.item.type.defaultProps),X.item.props):X.item.props,Se=he.activeDot,Ce=he.dataKey,fe=mr(mr({index:oe,dataKey:Ce,cx:te.x,cy:te.y,r:4,fill:R5(X.item),strokeWidth:2,stroke:"#fff",payload:te.payload,value:te.value},qn(Se,!1)),RO(Se));return ee.push(L.renderActiveDot(Se,fe,"".concat(ie,"-activePoint-").concat(oe))),se?ee.push(L.renderActiveDot(Se,mr(mr({},fe),{},{cx:se.x,cy:se.y}),"".concat(ie,"-basePoint-").concat(oe))):ne&&ee.push(null),ee}),Yn(U,"renderGraphicChild",function(Z,X,te){var se=U.filterFormatItem(Z,X,te);if(!se)return null;var oe=U.getTooltipEventType(),ne=U.state,ee=ne.isTooltipActive,ie=ne.tooltipAxis,he=ne.activeTooltipIndex,Se=ne.activeLabel,Ce=U.props.children,fe=Fc(Ce,Vs),_e=se.props,be=_e.points,Pe=_e.isRange,ye=_e.baseLine,ge=se.item.type.defaultProps!==void 0?mr(mr({},se.item.type.defaultProps),se.item.props):se.item.props,ke=ge.activeDot,Qe=ge.hide,He=ge.activeBar,$e=ge.activeShape,Xe=!!(!Qe&&ee&&fe&&(ke||He||$e)),ft={};oe!=="axis"&&fe&&fe.props.trigger==="click"?ft={onClick:VP(U.handleItemMouseEnter,Z.props.onClick)}:oe!=="axis"&&(ft={onMouseLeave:VP(U.handleItemMouseLeave,Z.props.onMouseLeave),onMouseEnter:VP(U.handleItemMouseEnter,Z.props.onMouseEnter)});var ze=G.cloneElement(Z,mr(mr({},se.props),ft));function ut(dt){return typeof ie.dataKey=="function"?ie.dataKey(dt.payload):null}if(Xe)if(he>=0){var At,xt;if(ie.dataKey&&!ie.allowDuplicatedCategory){var nr=typeof ie.dataKey=="function"?ut:"payload.".concat(ie.dataKey.toString());At=kO(be,nr,Se),xt=Pe&&ye&&kO(ye,nr,Se)}else At=be==null?void 0:be[he],xt=Pe&&ye&&ye[he];if($e||He){var Vt=Z.props.activeIndex!==void 0?Z.props.activeIndex:he;return[G.cloneElement(Z,mr(mr(mr({},se.props),ft),{},{activeIndex:Vt})),null,null]}if(!bi(At))return[ze].concat(pb(U.renderActivePoints({item:se,activePoint:At,basePoint:xt,childIndex:he,isRange:Pe})))}else{var dr,Br=(dr=U.getItemByXY(U.state.activeCoordinate))!==null&&dr!==void 0?dr:{graphicalItem:ze},Yr=Br.graphicalItem,_t=Yr.item,Mt=_t===void 0?Z:_t,Ke=Yr.childIndex,at=mr(mr(mr({},se.props),ft),{},{activeIndex:Ke});return[G.cloneElement(Mt,at),null,null]}return Pe?[ze,null,null]:[ze,null]}),Yn(U,"renderCustomized",function(Z,X,te){return G.cloneElement(Z,mr(mr({key:"recharts-customized-".concat(te)},U.props),U.state))}),Yn(U,"renderMap",{CartesianGrid:{handler:KP,once:!0},ReferenceArea:{handler:U.renderReferenceElement},ReferenceLine:{handler:KP},ReferenceDot:{handler:U.renderReferenceElement},XAxis:{handler:KP},YAxis:{handler:KP},Brush:{handler:U.renderBrush,once:!0},Bar:{handler:U.renderGraphicChild},Line:{handler:U.renderGraphicChild},Area:{handler:U.renderGraphicChild},Radar:{handler:U.renderGraphicChild},RadialBar:{handler:U.renderGraphicChild},Scatter:{handler:U.renderGraphicChild},Pie:{handler:U.renderGraphicChild},Funnel:{handler:U.renderGraphicChild},Tooltip:{handler:U.renderCursor,once:!0},PolarGrid:{handler:U.renderPolarGrid,once:!0},PolarAngleAxis:{handler:U.renderPolarAxis},PolarRadiusAxis:{handler:U.renderPolarAxis},Customized:{handler:U.renderCustomized}}),U.clipPathId="".concat((F=j.id)!==null&&F!==void 0?F:Lb("recharts"),"-clip"),U.throttleTriggeredAfterMouseMove=Ooe(U.triggeredAfterMouseMove,(B=j.throttleDelay)!==null&&B!==void 0?B:1e3/60),U.state={},U}return pYe(L,R),uYe(L,[{key:"componentDidMount",value:function(){var F,B;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(F=this.props.margin.left)!==null&&F!==void 0?F:0,top:(B=this.props.margin.top)!==null&&B!==void 0?B:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var F=this.props,B=F.children,U=F.data,Z=F.height,X=F.layout,te=Fc(B,Vs);if(te){var se=te.props.defaultIndex;if(!(typeof se!="number"||se<0||se>this.state.tooltipTicks.length-1)){var oe=this.state.tooltipTicks[se]&&this.state.tooltipTicks[se].value,ne=az(this.state,U,se,oe),ee=this.state.tooltipTicks[se].coordinate,ie=(this.state.offset.top+Z)/2,he=X==="horizontal",Se=he?{x:ee,y:ie}:{y:ee,x:ie},Ce=this.state.formattedGraphicalItems.find(function(_e){var be=_e.item;return be.type.name==="Scatter"});Ce&&(Se=mr(mr({},Se),Ce.props.points[se].tooltipPosition),ne=Ce.props.points[se].tooltipPayload);var fe={activeTooltipIndex:se,isTooltipActive:!0,activeLabel:oe,activePayload:ne,activeCoordinate:Se};this.setState(fe),this.renderCursor(te),this.accessibilityManager.setIndex(se)}}}},{key:"getSnapshotBeforeUpdate",value:function(F,B){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==B.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==F.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==F.margin){var U,Z;this.accessibilityManager.setDetails({offset:{left:(U=this.props.margin.left)!==null&&U!==void 0?U:0,top:(Z=this.props.margin.top)!==null&&Z!==void 0?Z:0}})}return null}},{key:"componentDidUpdate",value:function(F){N3([Fc(F.children,Vs)],[Fc(this.props.children,Vs)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var F=Fc(this.props.children,Vs);if(F&&typeof F.props.shared=="boolean"){var B=F.props.shared?"axis":"item";return i.indexOf(B)>=0?B:l}return l}},{key:"getMouseInfo",value:function(F){if(!this.container)return null;var B=this.container,U=B.getBoundingClientRect(),Z=v$e(U),X={chartX:Math.round(F.pageX-Z.left),chartY:Math.round(F.pageY-Z.top)},te=U.width/B.offsetWidth||1,se=this.inRange(X.chartX,X.chartY,te);if(!se)return null;var oe=this.state,ne=oe.xAxisMap,ee=oe.yAxisMap,ie=this.getTooltipEventType(),he=OK(this.state,this.props.data,this.props.layout,se);if(ie!=="axis"&&ne&&ee){var Se=lm(ne).scale,Ce=lm(ee).scale,fe=Se&&Se.invert?Se.invert(X.chartX):null,_e=Ce&&Ce.invert?Ce.invert(X.chartY):null;return mr(mr({},X),{},{xValue:fe,yValue:_e},he)}return he?mr(mr({},X),he):null}},{key:"inRange",value:function(F,B){var U=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,Z=this.props.layout,X=F/U,te=B/U;if(Z==="horizontal"||Z==="vertical"){var se=this.state.offset,oe=X>=se.left&&X<=se.left+se.width&&te>=se.top&&te<=se.top+se.height;return oe?{x:X,y:te}:null}var ne=this.state,ee=ne.angleAxisMap,ie=ne.radiusAxisMap;if(ee&&ie){var he=lm(ee);return e7({x:X,y:te},he)}return null}},{key:"parseEventsOfWrapper",value:function(){var F=this.props.children,B=this.getTooltipEventType(),U=Fc(F,Vs),Z={};U&&B==="axis"&&(U.props.trigger==="click"?Z={onClick:this.handleClick}:Z={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var X=RO(this.props,this.handleOuterEvent);return mr(mr({},X),Z)}},{key:"addListener",value:function(){vD.on(_D,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){vD.removeListener(_D,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(F,B,U){for(var Z=this.state.formattedGraphicalItems,X=0,te=Z.length;X<te;X++){var se=Z[X];if(se.item===F||se.props.key===F.key||B===Af(se.item.type)&&U===se.childIndex)return se}return null}},{key:"renderClipPath",value:function(){var F=this.clipPathId,B=this.state.offset,U=B.left,Z=B.top,X=B.height,te=B.width;return We.createElement("defs",null,We.createElement("clipPath",{id:F},We.createElement("rect",{x:U,y:Z,height:X,width:te})))}},{key:"getXScales",value:function(){var F=this.state.xAxisMap;return F?Object.entries(F).reduce(function(B,U){var Z=AK(U,2),X=Z[0],te=Z[1];return mr(mr({},B),{},Yn({},X,te.scale))},{}):null}},{key:"getYScales",value:function(){var F=this.state.yAxisMap;return F?Object.entries(F).reduce(function(B,U){var Z=AK(U,2),X=Z[0],te=Z[1];return mr(mr({},B),{},Yn({},X,te.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(F){var B;return(B=this.state.xAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getYScaleByAxisId",value:function(F){var B;return(B=this.state.yAxisMap)===null||B===void 0||(B=B[F])===null||B===void 0?void 0:B.scale}},{key:"getItemByXY",value:function(F){var B=this.state,U=B.formattedGraphicalItems,Z=B.activeItem;if(U&&U.length)for(var X=0,te=U.length;X<te;X++){var se=U[X],oe=se.props,ne=se.item,ee=ne.type.defaultProps!==void 0?mr(mr({},ne.type.defaultProps),ne.props):ne.props,ie=Af(ne.type);if(ie==="Bar"){var he=(oe.data||[]).find(function(_e){return Q9e(F,_e)});if(he)return{graphicalItem:se,payload:he}}else if(ie==="RadialBar"){var Se=(oe.data||[]).find(function(_e){return e7(F,_e)});if(Se)return{graphicalItem:se,payload:Se}}else if(TR(se,Z)||AR(se,Z)||cT(se,Z)){var Ce=$He({graphicalItem:se,activeTooltipItem:Z,itemData:ee.data}),fe=ee.activeIndex===void 0?Ce:ee.activeIndex;return{graphicalItem:mr(mr({},se),{},{childIndex:fe}),payload:cT(se,Z)?ee.data[Ce]:se.props.data[Ce]}}}return null}},{key:"render",value:function(){var F=this;if(!q9(this))return null;var B=this.props,U=B.children,Z=B.className,X=B.width,te=B.height,se=B.style,oe=B.compact,ne=B.title,ee=B.desc,ie=PK(B,nYe),he=qn(ie,!1);if(oe)return We.createElement(lK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},We.createElement(D3,qx({},he,{width:X,height:te,title:ne,desc:ee}),this.renderClipPath(),G9(U,this.renderMap)));if(this.props.accessibilityLayer){var Se,Ce;he.tabIndex=(Se=this.props.tabIndex)!==null&&Se!==void 0?Se:0,he.role=(Ce=this.props.role)!==null&&Ce!==void 0?Ce:"application",he.onKeyDown=function(_e){F.accessibilityManager.keyboardEvent(_e)},he.onFocus=function(){F.accessibilityManager.focus()}}var fe=this.parseEventsOfWrapper();return We.createElement(lK,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},We.createElement("div",qx({className:Ei("recharts-wrapper",Z),style:mr({position:"relative",cursor:"default",width:X,height:te},se)},fe,{ref:function(be){F.container=be}}),We.createElement(D3,qx({},he,{width:X,height:te,title:ne,desc:ee,style:xYe}),this.renderClipPath(),G9(U,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(G.Component);Yn(N,"displayName",r),Yn(N,"defaultProps",mr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},E)),Yn(N,"getDerivedStateFromProps",function(R,L){var j=R.dataKey,F=R.data,B=R.children,U=R.width,Z=R.height,X=R.layout,te=R.stackOffset,se=R.margin,oe=L.dataStartIndex,ne=L.dataEndIndex;if(L.updateId===void 0){var ee=IK(R);return mr(mr(mr({},ee),{},{updateId:0},C(mr(mr({props:R},ee),{},{updateId:0}),L)),{},{prevDataKey:j,prevData:F,prevWidth:U,prevHeight:Z,prevLayout:X,prevStackOffset:te,prevMargin:se,prevChildren:B})}if(j!==L.prevDataKey||F!==L.prevData||U!==L.prevWidth||Z!==L.prevHeight||X!==L.prevLayout||te!==L.prevStackOffset||!o0(se,L.prevMargin)){var ie=IK(R),he={chartX:L.chartX,chartY:L.chartY,isTooltipActive:L.isTooltipActive},Se=mr(mr({},OK(L,F,X)),{},{updateId:L.updateId+1}),Ce=mr(mr(mr({},ie),he),Se);return mr(mr(mr({},Ce),C(mr({props:R},Ce),L)),{},{prevDataKey:j,prevData:F,prevWidth:U,prevHeight:Z,prevLayout:X,prevStackOffset:te,prevMargin:se,prevChildren:B})}if(!N3(B,L.prevChildren)){var fe,_e,be,Pe,ye=Fc(B,ib),ge=ye&&(fe=(_e=ye.props)===null||_e===void 0?void 0:_e.startIndex)!==null&&fe!==void 0?fe:oe,ke=ye&&(be=(Pe=ye.props)===null||Pe===void 0?void 0:Pe.endIndex)!==null&&be!==void 0?be:ne,Qe=ge!==oe||ke!==ne,He=!bi(F),$e=He&&!Qe?L.updateId:L.updateId+1;return mr(mr({updateId:$e},C(mr(mr({props:R},L),{},{updateId:$e,dataStartIndex:ge,dataEndIndex:ke}),L)),{},{prevChildren:B,dataStartIndex:ge,dataEndIndex:ke})}return null}),Yn(N,"renderActiveDot",function(R,L,j){var F;return G.isValidElement(R)?F=G.cloneElement(R,L):si(R)?F=R(L):F=We.createElement(xR,L),We.createElement(ga,{className:"recharts-active-dot",key:j},F)});var k=G.forwardRef(function(L,j){return We.createElement(N,qx({},L,{ref:j}))});return k.displayName=N.displayName,k},rce=V5({chartName:"LineChart",GraphicalChild:Wb,axisComponents:[{axisType:"xAxis",AxisComp:gh},{axisType:"yAxis",AxisComp:yh}],formatAxisMap:xle}),TC=V5({chartName:"BarChart",GraphicalChild:bu,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:gh},{axisType:"yAxis",AxisComp:yh}],formatAxisMap:xle}),RK=V5({chartName:"PieChart",GraphicalChild:Oh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:ER},{axisType:"radiusAxis",AxisComp:wR}],formatAxisMap:fqe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const IYe=()=>{const{t:e}=Ki(),{isSupervisor:t}=Tc(),{data:r,isLoading:n}=_Oe(),{data:o}=xOe(),{data:l}=SOe(),{data:d}=bOe(),{data:i}=wOe();return n?m.jsx(Qc,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(Qc,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.dashboard")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.dashboardDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:t?"":e("admin.totalUsers")}),m.jsx(yu,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalUsers)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.registeredUsers")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:t?"":e("admin.totalRestaurants")}),m.jsx(Qo,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalRestaurants)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.listedRestaurants")})]})]}),!t&&m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.totalActivities")}),m.jsx($l,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalActivities)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:e("admin.activeEvents")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:t?"":e("admin.totalComments")}),m.jsx(dB,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:(r==null?void 0:r.totalComments)||0}),m.jsx("p",{className:"text-xs text-muted-foreground",children:t?"":e("admin.userReviews")})]})]})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs(Ji,{className:"flex items-center gap-2",children:[m.jsx(YY,{className:"h-5 w-5"}),""]}),m.jsx(Do,{children:t?"":"Top 5 "})]}),m.jsx(dn,{children:d&&d.length>0?m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(rce,{data:d,children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{dataKey:"month"}),m.jsx(yh,{domain:[0,5]}),m.jsx(Vs,{}),m.jsx(ph,{}),Object.keys(d[0]).filter(g=>g!=="month").map((g,x)=>m.jsx(Wb,{type:"monotone",dataKey:g,stroke:`hsl(${x*360/5}, 70%, 50%)`,strokeWidth:2},g))]})}):m.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs(Ji,{className:"flex items-center gap-2",children:[m.jsx(Hge,{className:"h-5 w-5"}),""]}),m.jsx(Do,{children:t?"":"Top 5 "})]}),m.jsx(dn,{children:i&&i.length>0?m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(TC,{data:i,children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{dataKey:"month"}),m.jsx(yh,{}),m.jsx(Vs,{}),m.jsx(ph,{}),Object.keys(i[0]).filter(g=>g!=="month").map((g,x)=>m.jsx(bu,{dataKey:g,fill:`hsl(${x*360/5}, 70%, 50%)`},g))]})}):m.jsx("div",{className:"h-[300px] flex items-center justify-center text-muted-foreground",children:""})})]}),!t&&l&&l.length>0&&m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs(Ji,{className:"flex items-center gap-2",children:[m.jsx(qS,{className:"h-5 w-5"}),e("admin.activityEngagement")]}),m.jsx(Do,{children:e("admin.activityEngagementDescription")})]}),m.jsx(dn,{children:m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(TC,{data:l,children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{dataKey:"name",angle:-45,textAnchor:"end",height:100}),m.jsx(yh,{}),m.jsx(Vs,{}),m.jsx(ph,{}),m.jsx(bu,{dataKey:"subscribers",name:e("admin.subscribers"),fill:"hsl(var(--primary))"}),m.jsx(bu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})})})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs(Ji,{className:"flex items-center gap-2",children:[m.jsx(wc,{className:"h-5 w-5"}),t?"":e("admin.topRestaurants")]}),m.jsx(Do,{children:t?"":e("admin.topRestaurantsDescription")})]}),m.jsx(dn,{children:o&&o.length>0?m.jsx(Sm,{width:"100%",height:400,children:m.jsxs(TC,{data:o,layout:"horizontal",children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{type:"number"}),m.jsx(yh,{dataKey:"name",type:"category",width:150}),m.jsx(Vs,{}),m.jsx(ph,{}),m.jsx(bu,{dataKey:"rating",name:e("admin.rating"),fill:"hsl(var(--primary))"}),m.jsx(bu,{dataKey:"comments",name:e("admin.comments"),fill:"hsl(var(--accent))"})]})}):m.jsx("div",{className:"h-[400px] flex items-center justify-center text-muted-foreground",children:t?"":e("admin.noData")})})]})]})})},kYe=({trigger:e})=>{const{t}=Ki(),{toast:r}=wa(),n=Na(),{isSupervisor:o}=Tc(),[l,d]=G.useState(!1),[i,g]=G.useState(!1),[x,S]=G.useState({email:"",password:"",displayName:"",phone:"",role:"merchant"}),E=async A=>{A.preventDefault(),g(!0);try{const{data:{session:C}}=await Ut.auth.getSession(),N=await fetch("https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/admin-create-user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C==null?void 0:C.access_token}`},body:JSON.stringify({email:x.email,password:x.password,displayName:x.displayName,phone:x.phone,role:x.role})}),k=await N.json();if(!N.ok)throw new Error(k.error||"Failed to create user");r({title:t("common.success"),description:t("admin.userCreated")}),d(!1),S({email:"",password:"",displayName:"",phone:"",role:"merchant"}),n.invalidateQueries({queryKey:["admin-users"]})}catch(C){console.error("Error creating user:",C),r({title:t("common.error"),description:C.message||t("admin.createUserError"),variant:"destructive"})}finally{g(!1)}};return m.jsxs(Rh,{open:l,onOpenChange:d,children:[m.jsx(Iv,{asChild:!0,children:e||m.jsxs(lr,{children:[m.jsx(qS,{className:"mr-2 h-4 w-4"}),t("admin.createUser")]})}),m.jsx(Rd,{className:"max-w-[90vw] sm:max-w-[500px]",children:m.jsxs("form",{onSubmit:E,children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:t("admin.createNewUser")}),m.jsx(Md,{children:t("admin.createUserDescription")})]}),m.jsxs("div",{className:"grid gap-4 py-4",children:[m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Zr,{htmlFor:"email",children:t("auth.email")}),m.jsx(an,{id:"email",type:"email",required:!0,value:x.email,onChange:A=>S({...x,email:A.target.value}),placeholder:"user@example.com"})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Zr,{htmlFor:"password",children:t("auth.password")}),m.jsx(an,{id:"password",type:"password",required:!0,value:x.password,onChange:A=>S({...x,password:A.target.value}),placeholder:"",minLength:6})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Zr,{htmlFor:"displayName",children:t("profile.displayName")}),m.jsx(an,{id:"displayName",required:!0,value:x.displayName,onChange:A=>S({...x,displayName:A.target.value}),placeholder:t("profile.displayName")})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Zr,{htmlFor:"phone",children:t("profile.phone")}),m.jsx(an,{id:"phone",type:"tel",value:x.phone,onChange:A=>S({...x,phone:A.target.value}),placeholder:"+351 XXX XXX XXX"})]}),m.jsxs("div",{className:"grid gap-2",children:[m.jsx(Zr,{htmlFor:"role",children:t("admin.role")}),o?m.jsx(an,{id:"role",value:t("admin.merchant"),disabled:!0,className:"bg-muted"}):m.jsxs(wd,{value:x.role,onValueChange:A=>S({...x,role:A}),children:[m.jsx(Au,{children:m.jsx(Sd,{})}),m.jsxs(Pu,{children:[m.jsx(La,{value:"merchant",children:t("admin.merchant")}),m.jsx(La,{value:"supervisor",children:t("admin.supervisor")})]})]})]})]}),m.jsxs(b4,{children:[m.jsx(lr,{type:"button",variant:"outline",onClick:()=>d(!1),disabled:i,children:t("common.cancel")}),m.jsxs(lr,{type:"submit",disabled:i,children:[i&&m.jsx(Ws,{className:"mr-2 h-4 w-4 animate-spin"}),t("admin.create")]})]})]})})]})},RYe=({open:e,onOpenChange:t,merchantId:r,merchantName:n,userRole:o})=>{Ki();const{toast:l}=wa(),d=Na(),{localizeRestaurant:i}=kd(),{user:g}=Di(),{isSupervisor:x}=Tc(),[S,E]=G.useState([]),[A,C]=G.useState(""),{data:N}=Wi({queryKey:["supervisorRestaurants",g==null?void 0:g.id],queryFn:async()=>{if(!g||!x)return null;const{data:te,error:se}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",g.id);if(se)throw se;return(te==null?void 0:te.map(oe=>oe.restaurant_id))||[]},enabled:e&&x&&!!g}),{data:k,isLoading:R}=Wi({queryKey:["allRestaurants",N],queryFn:async()=>{let te=Ut.from("restaurants").select("*").order("name");x&&N&&N.length>0&&(te=te.in("id",N));const{data:se,error:oe}=await te;if(oe)throw oe;return se},enabled:!x||x&&N!==void 0}),{data:L,isLoading:j}=Wi({queryKey:["merchantRestaurants",r],queryFn:async()=>{const{data:te,error:se}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",r);if(se)throw se;return(te==null?void 0:te.map(oe=>oe.restaurant_id))||[]},enabled:e});G.useEffect(()=>{L&&E(L)},[L]);const F=Xa({mutationFn:async()=>{const{error:te}=await Ut.from("merchant_restaurants").delete().eq("user_id",r);if(te)throw te;if(S.length>0){const{error:se}=await Ut.from("merchant_restaurants").insert(S.map(oe=>({user_id:r,restaurant_id:oe})));if(se)throw se}},onSuccess:()=>{l({title:"",description:""}),d.invalidateQueries({queryKey:["merchantRestaurants"]}),d.invalidateQueries({queryKey:["adminUsers"]}),t(!1)},onError:te=>{console.error("Error saving merchant restaurants:",te),l({title:"",description:"",variant:"destructive"})}}),B=te=>{E(o==="merchant"?[te]:se=>se.includes(te)?se.filter(oe=>oe!==te):[...se,te])},U=()=>{F.mutate()},Z=R||j,X=k==null?void 0:k.filter(te=>A.trim()?i(te).name.toLowerCase().includes(A.toLowerCase())||te.address.toLowerCase().includes(A.toLowerCase()):!0);return m.jsx(Rh,{open:e,onOpenChange:t,children:m.jsxs(Rd,{className:"max-w-2xl max-h-[80vh]",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(Qo,{className:"w-5 h-5"}),o==="merchant"?"":""]}),m.jsxs(Md,{children:[" ",n," ",o==="merchant"&&m.jsx("span",{className:"block mt-1 text-amber-600 dark:text-amber-500 font-medium",children:" "}),m.jsx("span",{className:"block mt-1 text-muted-foreground text-xs",children:' ""'})]})]}),Z?m.jsx("div",{className:"flex justify-center py-8",children:m.jsx(Ws,{className:"w-6 h-6 animate-spin text-primary"})}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"relative mb-4",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(an,{placeholder:"...",value:A,onChange:te=>C(te.target.value),className:"pl-9"})]}),m.jsx(uv,{className:"h-[400px] pr-4",children:m.jsx("div",{className:"space-y-3",children:X==null?void 0:X.map(te=>{const se=S.includes(te.id),oe=i(te);return m.jsxs("div",{className:"flex items-start space-x-3 p-4 rounded-lg border hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>B(te.id),children:[o==="supervisor"?m.jsx(Gs,{checked:se,className:"mt-1"}):m.jsx("input",{type:"radio",checked:se,onChange:()=>{},className:"mt-1 h-4 w-4 text-primary focus:ring-primary"}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[m.jsx("p",{className:"text-sm font-medium leading-none",children:oe.name}),se&&m.jsx(Qn,{variant:"secondary",className:"text-xs",children:""})]}),m.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[m.jsx(Cs,{className:"w-3 h-3"}),m.jsx("span",{className:"line-clamp-1",children:te.address})]}),te.type&&te.type.length>0&&m.jsx("div",{className:"flex gap-1 mt-2",children:te.type.slice(0,2).map((ne,ee)=>m.jsx(Qn,{variant:"outline",className:"text-xs",children:ne},ee))})]})]},te.id)})})}),m.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[m.jsx("div",{className:"text-sm text-muted-foreground",children:o==="merchant"?` ${S.length}/1 `:` ${S.length} `}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(lr,{variant:"outline",onClick:()=>t(!1),disabled:F.isPending,children:""}),m.jsxs(lr,{onClick:U,disabled:F.isPending,children:[F.isPending&&m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}),""]})]})]})]})]})})},jYe=({merchantId:e,merchantName:t,trigger:r})=>{Ki();const{toast:n}=wa(),o=Na(),[l,d]=G.useState(!1),[i,g]=G.useState(""),{data:x=[],isLoading:S}=Wi({queryKey:["supervisors"],queryFn:async()=>{const{data:L,error:j}=await Ut.from("user_roles").select("user_id").eq("role","supervisor");if(j)throw j;const F=L.map(Z=>Z.user_id);if(F.length===0)return[];const{data:B,error:U}=await Ut.from("profiles").select("id, display_name").in("id",F);if(U)throw U;return B},enabled:l}),{data:E=[]}=Wi({queryKey:["merchant-restaurants",e],queryFn:async()=>{const{data:L,error:j}=await Ut.from("merchant_restaurants").select("restaurant_id").eq("user_id",e);if(j)throw j;return L.map(F=>F.restaurant_id)},enabled:l}),{data:A=[]}=Wi({queryKey:["merchant-supervisors",e],queryFn:async()=>{if(E.length===0)return[];const{data:L,error:j}=await Ut.from("merchant_restaurants").select("user_id, restaurant_id").in("restaurant_id",E).neq("user_id",e);if(j)throw j;const F=[...new Set(L.map(se=>se.user_id))];if(F.length===0)return[];const{data:B,error:U}=await Ut.from("user_roles").select("user_id").in("user_id",F).eq("role","supervisor");if(U)throw U;const Z=B.map(se=>se.user_id);if(Z.length===0)return[];const{data:X,error:te}=await Ut.from("profiles").select("id, display_name").in("id",Z);if(te)throw te;return X},enabled:l&&E.length>0}),C=Xa({mutationFn:async L=>{if(E.length===0)throw new Error("");const j=E.map(B=>({user_id:L,restaurant_id:B})),{error:F}=await Ut.from("merchant_restaurants").upsert(j,{onConflict:"user_id,restaurant_id"});if(F)throw F},onSuccess:()=>{n({title:"",description:""}),o.invalidateQueries({queryKey:["merchant-supervisors"]}),g(""),d(!1)},onError:L=>{n({title:"",description:L.message,variant:"destructive"})}}),N=Xa({mutationFn:async L=>{const{error:j}=await Ut.from("merchant_restaurants").delete().eq("user_id",L).in("restaurant_id",E);if(j)throw j},onSuccess:()=>{n({title:"",description:""}),o.invalidateQueries({queryKey:["merchant-supervisors"]})},onError:L=>{n({title:"",description:L.message,variant:"destructive"})}}),k=()=>{i&&C.mutate(i)},R=L=>{N.mutate(L)};return m.jsxs(Rh,{open:l,onOpenChange:d,children:[m.jsx(Iv,{asChild:!0,children:r||m.jsxs(lr,{variant:"outline",size:"sm",children:[m.jsx(JY,{className:"w-4 h-4 mr-2"}),""]})}),m.jsxs(Rd,{className:"max-w-md",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"w-5 h-5"}),""]}),m.jsxs(Md,{children:[" ",m.jsx("strong",{children:t})," "]})]}),m.jsxs("div",{className:"space-y-4",children:[A.length>0&&m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:""}),m.jsx("div",{className:"space-y-2",children:A.map(L=>m.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"w-4 h-4 text-blue-500"}),m.jsx("span",{className:"text-sm",children:L.display_name})]}),m.jsx(lr,{variant:"ghost",size:"sm",onClick:()=>R(L.id),disabled:N.isPending,children:""})]},L.id))})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:""}),m.jsxs(wd,{value:i,onValueChange:g,children:[m.jsx(Au,{children:m.jsx(Sd,{placeholder:""})}),m.jsx(Pu,{children:S?m.jsx("div",{className:"p-2 text-center",children:m.jsx(Ws,{className:"w-4 h-4 animate-spin mx-auto"})}):x.length===0?m.jsx("div",{className:"p-2 text-center text-sm text-muted-foreground",children:""}):x.filter(L=>!A.find(j=>j.id===L.id)).map(L=>m.jsx(La,{value:L.id,children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"w-4 h-4 text-blue-500"}),L.display_name]})},L.id))})]})]}),E.length===0&&m.jsx(Qn,{variant:"secondary",className:"w-full justify-center",children:""}),m.jsxs("div",{className:"flex gap-2 justify-end",children:[m.jsx(lr,{variant:"outline",onClick:()=>d(!1),children:""}),m.jsx(lr,{onClick:k,disabled:!i||C.isPending||E.length===0,children:C.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}),"..."]}):""})]})]})]})]})},NYe=({merchant:e,trigger:t})=>{const{t:r}=Ki(),[n,o]=G.useState(!1),[l,d]=G.useState(e.display_name),[i,g]=G.useState(e.phone||""),[x,S]=G.useState(null),[E,A]=G.useState(e.avatar_url||""),C=yOe(),N=vOe(),k=L=>{var F;const j=(F=L.target.files)==null?void 0:F[0];if(j){if(j.size>2*1024*1024)return;S(j),A(URL.createObjectURL(j))}},R=async()=>{let L=e.avatar_url;if(x){const j=await N.mutateAsync({file:x,userId:e.id});j&&(L=j)}await C.mutateAsync({userId:e.id,display_name:l,phone:i||void 0,avatar_url:L||void 0}),o(!1)};return m.jsxs(Rh,{open:n,onOpenChange:o,children:[m.jsx(Iv,{asChild:!0,children:t||m.jsxs(lr,{variant:"outline",size:"sm",children:[m.jsx(fB,{className:"w-4 h-4 mr-2"}),""]})}),m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(jd,{children:[m.jsx(Nd,{children:""}),m.jsx(Md,{children:""})]}),m.jsxs("div",{className:"space-y-4 py-4",children:[m.jsxs("div",{className:"flex flex-col items-center gap-4",children:[m.jsxs(qm,{className:"w-24 h-24",children:[m.jsx(Wm,{src:E}),m.jsx(Gm,{children:l==null?void 0:l.charAt(0).toUpperCase()})]}),m.jsxs("div",{children:[m.jsx(an,{type:"file",accept:"image/*",onChange:k,className:"hidden",id:"avatar-upload"}),m.jsxs(lr,{variant:"outline",size:"sm",onClick:()=>{var L;return(L=document.getElementById("avatar-upload"))==null?void 0:L.click()},children:[m.jsx(O0,{className:"w-4 h-4 mr-2"}),r("profile.uploadAvatar")]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"displayName",children:r("profile.displayName")}),m.jsx(an,{id:"displayName",value:l,onChange:L=>d(L.target.value),placeholder:r("profile.displayName")})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"phone",children:r("profile.phone")}),m.jsx(an,{id:"phone",value:i,onChange:L=>g(L.target.value),placeholder:r("profile.phone")})]})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(lr,{variant:"outline",onClick:()=>o(!1),children:r("common.cancel")}),m.jsx(lr,{onClick:R,disabled:C.isPending||N.isPending,children:C.isPending||N.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}),r("common.loading")]}):r("common.save")})]})]})]})};function q5(e,t){if(!e||e.length===0)return t.join(",");const r=[];r.push(t.join(","));for(const n of e){const o=t.map(l=>{const d=n[l];if(d==null)return"";if(Array.isArray(d))return`"${d.join(", ")}"`;if(typeof d=="object")return`"${JSON.stringify(d)}"`;const i=String(d);return i.includes(",")||i.includes('"')||i.includes(`
`)?`"${i.replace(/"/g,'""')}"`:i});r.push(o.join(","))}return r.join(`
`)}function W5(e,t){const r="\uFEFF",n=new Blob([r+e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const l=URL.createObjectURL(n);o.setAttribute("href",l),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}}function MYe(e){const t=["id","display_name","phone","created_at","roles"],r=e.map(l=>{var d;return{id:l.id,display_name:l.display_name,phone:l.phone||"",created_at:new Date(l.created_at).toLocaleDateString(),roles:((d=l.roles)==null?void 0:d.join(", "))||"user"}}),n=q5(r,t),o=`users_export_${new Date().toISOString().split("T")[0]}.csv`;W5(n,o)}function DYe(e){const t=["id","name","name_en","name_pt","type","type_en","type_pt","address","phone","website_url","rating","lat","lng","created_at"],r=e.map(l=>({id:l.id,name:l.name,name_en:l.name_en||"",name_pt:l.name_pt||"",type:l.type,type_en:l.type_en||"",type_pt:l.type_pt||"",address:l.address,phone:l.phone||"",website_url:l.website_url||"",rating:l.rating||0,lat:l.lat,lng:l.lng,created_at:new Date(l.created_at).toLocaleDateString()})),n=q5(r,t),o=`restaurants_export_${new Date().toISOString().split("T")[0]}.csv`;W5(n,o)}function LYe(e){const t=["id","title_en","title_zh","title_pt","start_date","end_date","repeat_mode","pinned","sort_order","created_at"],r=e.map(l=>({id:l.id,title_en:l.title_en,title_zh:l.title_zh,title_pt:l.title_pt,start_date:new Date(l.start_date).toLocaleDateString(),end_date:l.end_date?new Date(l.end_date).toLocaleDateString():"",repeat_mode:l.repeat_mode||"none",pinned:l.pinned?"Yes":"No",sort_order:l.sort_order||0,created_at:new Date(l.created_at).toLocaleDateString()})),n=q5(r,t),o=`activities_export_${new Date().toISOString().split("T")[0]}.csv`;W5(n,o)}const FYe=()=>{const{t:e}=Ki(),{toast:t}=wa(),{isSupervisor:r,isAdmin:n}=Tc(),{data:o,isLoading:l}=fOe(),d=pOe(),i=AOe(),g=OOe(),[x,S]=G.useState(null),[E,A]=G.useState(""),[C,N]=G.useState([]),[k,R]=G.useState("user"),[L,j]=G.useState(""),[F,B]=G.useState("all"),[U,Z]=G.useState({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),[X,te]=G.useState({open:!1,merchantId:"",merchantName:"",userRole:"merchant"}),se=["user","merchant","supervisor","admin"],oe=r?se.filter(ge=>ge==="user"||ge==="merchant"):se,ne=G.useMemo(()=>o?{total:o.length,admins:o.filter(ge=>ge.role==="admin").length,supervisors:o.filter(ge=>ge.role==="supervisor").length,merchants:o.filter(ge=>ge.role==="merchant").length,regularUsers:o.filter(ge=>ge.role==="user").length}:{total:0,admins:0,supervisors:0,merchants:0,regularUsers:0},[o]),ee=G.useMemo(()=>o?o.filter(ge=>{var He;const ke=L===""||ge.display_name.toLowerCase().includes(L.toLowerCase())||((He=ge.phone)==null?void 0:He.toLowerCase().includes(L.toLowerCase())),Qe=F==="all"||ge.role===F;return ke&&Qe}):[],[o,L,F]),ie=()=>{if(!o||o.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}MYe(o),t({title:e("common.success"),description:e("admin.exportSuccess")})},he=ge=>{N(ke=>ke.includes(ge)?ke.filter(Qe=>Qe!==ge):[...ke,ge])},Se=()=>{C.length===(ee==null?void 0:ee.length)?N([]):N((ee==null?void 0:ee.map(ge=>ge.id))||[])},Ce=()=>{C.length!==0&&(i.mutate(C),N([]))},fe=()=>{C.length!==0&&(g.mutate({userIds:C,role:k}),N([]))},_e=()=>{U.userId&&U.newRole&&d.mutate({userId:U.userId,role:U.newRole},{onSuccess:()=>{Z({open:!1,userId:"",userName:"",currentRole:"",newRole:""}),S(null),A("")}})},be=(ge,ke,Qe,He)=>{Z({open:!0,userId:ge,userName:ke,currentRole:Qe,newRole:He})},Pe=ge=>{switch(ge){case"admin":return"bg-primary text-primary-foreground hover:bg-primary/90";case"supervisor":return"bg-blue-500 text-white hover:bg-blue-600";case"merchant":return"bg-emerald-500 text-white hover:bg-emerald-600";default:return"bg-muted text-muted-foreground hover:bg-muted/80"}},ye=ge=>{switch(ge){case"admin":return m.jsx(hc,{className:"h-3.5 w-3.5"});case"supervisor":return m.jsx(hc,{className:"h-3.5 w-3.5"});case"merchant":return m.jsx(yP,{className:"h-3.5 w-3.5"});default:return m.jsx(yu,{className:"h-3.5 w-3.5"})}};return l?m.jsx(Qc,{children:m.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:m.jsxs("div",{className:"text-center space-y-3",children:[m.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),m.jsx("p",{className:"text-muted-foreground",children:e("common.loading")})]})})}):m.jsx(Qc,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsx("div",{children:m.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[m.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:m.jsx(JY,{className:"h-6 w-6 text-primary"})}),m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:e("admin.userManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageUserRoles")})]})]})}),r?m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.jsx(Qr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.merchants})]}),m.jsx(yP,{className:"h-8 w-8 text-emerald-500"})]})})})}):m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[m.jsx(Qr,{className:"bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.total})]}),m.jsx(yu,{className:"h-8 w-8 text-primary/60"})]})})}),m.jsx(Qr,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 dark:from-red-950/20 dark:to-red-900/20 dark:border-red-900/30",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.admins})]}),m.jsx(hc,{className:"h-8 w-8 text-red-500"})]})})}),m.jsx(Qr,{className:"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200 dark:from-blue-950/20 dark:to-blue-900/20 dark:border-blue-900/30",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.supervisors})]}),m.jsx(hc,{className:"h-8 w-8 text-blue-500"})]})})}),m.jsx(Qr,{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 border-emerald-200 dark:from-emerald-950/20 dark:to-emerald-900/20 dark:border-emerald-900/30",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.merchants})]}),m.jsx(yP,{className:"h-8 w-8 text-emerald-500"})]})})}),m.jsx(Qr,{className:"bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 dark:from-gray-950/20 dark:to-gray-900/20 dark:border-gray-900/30",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("p",{className:"text-2xl font-bold",children:ne.regularUsers})]}),m.jsx(yu,{className:"h-8 w-8 text-gray-500"})]})})})]}),m.jsx(Qr,{children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"relative",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(an,{placeholder:"...",value:L,onChange:ge=>j(ge.target.value),className:"pl-10 pr-10"}),L&&m.jsx(lr,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-7 w-7 p-0",onClick:()=>j(""),children:m.jsx(ju,{className:"h-4 w-4"})})]})}),!r&&m.jsxs(wd,{value:F,onValueChange:B,children:[m.jsxs(Au,{className:"w-full md:w-[200px]",children:[m.jsx(cB,{className:"h-4 w-4 mr-2"}),m.jsx(Sd,{placeholder:""})]}),m.jsxs(Pu,{children:[m.jsx(La,{value:"all",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(yu,{className:"h-4 w-4"}),""]})}),m.jsx(La,{value:"admin",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"h-4 w-4 text-red-500"}),""]})}),m.jsx(La,{value:"supervisor",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"h-4 w-4 text-blue-500"}),""]})}),m.jsx(La,{value:"merchant",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(yP,{className:"h-4 w-4 text-emerald-500"}),""]})}),m.jsx(La,{value:"user",children:m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(yu,{className:"h-4 w-4 text-gray-500"}),""]})})]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(kYe,{trigger:m.jsxs(lr,{variant:"default",size:"default",children:[m.jsx(qS,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.createUser")}),m.jsx("span",{className:"sm:hidden",children:e("admin.create")})]})}),m.jsxs(lr,{variant:"outline",onClick:ie,children:[m.jsx(ek,{className:"h-4 w-4 md:mr-2"}),m.jsx("span",{className:"hidden md:inline",children:""})]})]})]})})}),C.length>0&&m.jsx(Qr,{className:"border-primary/50 bg-primary/5",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Gs,{checked:!0,onCheckedChange:()=>N([])}),m.jsxs("span",{className:"font-semibold",children:[" ",C.length," "]})]}),m.jsxs(lr,{variant:"ghost",size:"sm",onClick:()=>N([]),children:[m.jsx(ju,{className:"h-4 w-4 mr-1"}),""]})]}),m.jsx(vu,{}),m.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[m.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:""}),m.jsxs(wd,{value:k,onValueChange:ge=>R(ge),children:[m.jsx(Au,{className:"w-full sm:w-[160px]",children:m.jsx(Sd,{})}),m.jsx(Pu,{children:oe.map(ge=>m.jsx(La,{value:ge,children:m.jsxs("div",{className:"flex items-center gap-2",children:[ye(ge),m.jsx("span",{className:"capitalize",children:ge})]})},ge))})]}),m.jsxs(lr,{onClick:fe,size:"default",children:[m.jsx(qS,{className:"mr-2 h-4 w-4"}),""]})]}),m.jsxs(zl,{children:[m.jsx(IE,{asChild:!0,children:m.jsxs(lr,{variant:"destructive",size:"default",children:[m.jsx(bb,{className:"mr-2 h-4 w-4"}),""]})}),m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:""}),m.jsxs(ul,{children:[" ",C.length," "]})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:""}),m.jsx(Us,{onClick:Ce,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:""})]})]})]})]})]})})}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx(Gs,{checked:C.length===(ee==null?void 0:ee.length)&&ee.length>0,onCheckedChange:Se}),m.jsx("span",{className:"font-semibold",children:""})]}),m.jsxs(Qn,{variant:"secondary",className:"text-sm font-normal",children:[" ",ee==null?void 0:ee.length," / ",(o==null?void 0:o.length)||0," "]})]}),ee&&ee.length>0?m.jsx("div",{className:"grid gap-4",children:ee.map(ge=>{var ke;return m.jsx(Qr,{className:"hover:shadow-lg transition-all duration-200 border-l-4 border-l-transparent hover:border-l-primary",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col gap-4",children:[m.jsxs("div",{className:"flex items-start sm:items-center justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-0",children:[m.jsx(Gs,{checked:C.includes(ge.id),onCheckedChange:()=>he(ge.id)}),m.jsxs(qm,{className:"h-16 w-16 border-2 border-border",children:[m.jsx(Wm,{src:ge.avatar_url||""}),m.jsx(Gm,{className:"text-lg font-semibold bg-primary/10 text-primary",children:((ke=ge.display_name)==null?void 0:ke.charAt(0).toUpperCase())||"U"})]}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h3",{className:"font-bold text-lg truncate",children:ge.display_name}),m.jsx("p",{className:"text-sm text-muted-foreground truncate",children:ge.phone||""})]})]}),m.jsxs(Qn,{className:`${Pe(ge.role)} px-3 py-1.5 font-medium`,children:[ye(ge.role),m.jsx("span",{className:"ml-1.5 capitalize",children:ge.role})]})]}),m.jsx(vu,{}),m.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:""}),m.jsxs(wd,{value:x===ge.id?E:"",onValueChange:Qe=>{S(ge.id),A(Qe)},children:[m.jsx(Au,{className:"w-full",children:m.jsx(Sd,{placeholder:"..."})}),m.jsx(Pu,{children:oe.filter(Qe=>Qe!==ge.role).map(Qe=>m.jsx(La,{value:Qe,children:m.jsxs("div",{className:"flex items-center gap-2",children:[ye(Qe),m.jsx("span",{className:"capitalize",children:Qe})]})},Qe))})]})]}),m.jsx("div",{className:"flex items-end",children:m.jsxs(lr,{onClick:()=>{x===ge.id&&E&&be(ge.id,ge.display_name,ge.role,E)},disabled:x!==ge.id||!E,className:"w-full sm:w-auto",size:"default",children:[m.jsx(qS,{className:"mr-2 h-4 w-4"}),""]})})]}),r&&ge.role==="merchant"&&m.jsxs(m.Fragment,{children:[m.jsx(vu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),m.jsx(NYe,{merchant:{id:ge.id,display_name:ge.display_name,phone:ge.phone,avatar_url:ge.avatar_url}})]})]}),(ge.role==="merchant"||ge.role==="supervisor")&&m.jsxs(m.Fragment,{children:[m.jsx(vu,{}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:ge.role==="merchant"?"1":""})]}),m.jsxs(lr,{variant:"outline",size:"default",onClick:()=>te({open:!0,merchantId:ge.id,merchantName:ge.display_name,userRole:ge.role}),children:[m.jsx(Qo,{className:"mr-2 h-4 w-4"}),""]})]}),n&&ge.role==="merchant"&&m.jsxs(m.Fragment,{children:[m.jsx(vu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-sm font-medium text-muted-foreground block",children:""}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:""})]}),m.jsx(jYe,{merchantId:ge.id,merchantName:ge.display_name})]})]})]})]})]})})},ge.id)})}):m.jsx(Qr,{children:m.jsx(dn,{className:"pt-12 pb-12",children:m.jsxs("div",{className:"text-center space-y-3",children:[m.jsx(yu,{className:"h-16 w-16 text-muted-foreground/50 mx-auto"}),m.jsx("h3",{className:"text-lg font-semibold",children:""}),m.jsx("p",{className:"text-muted-foreground",children:L||F!=="all"?"":""})]})})})]}),m.jsx(zl,{open:U.open,onOpenChange:ge=>{ge||Z({open:!1,userId:"",userName:"",currentRole:"",newRole:""})},children:m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[500px]",children:[m.jsxs(sl,{children:[m.jsxs(cl,{className:"flex items-center gap-2",children:[m.jsx(hc,{className:"h-5 w-5 text-primary"}),""]}),m.jsxs(ul,{className:"space-y-4 pt-4",children:[m.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg space-y-3",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsx("span",{className:"font-semibold text-foreground",children:U.userName})]}),m.jsx(vu,{}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsxs(Qn,{className:Pe(U.currentRole),children:[ye(U.currentRole),m.jsx("span",{className:"ml-1.5 capitalize",children:U.currentRole})]})]}),m.jsx("div",{className:"flex items-center justify-center",children:m.jsx("div",{className:"text-2xl text-primary",children:""})}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:""}),m.jsxs(Qn,{className:Pe(U.newRole),children:[ye(U.newRole),m.jsx("span",{className:"ml-1.5 capitalize",children:U.newRole})]})]})]}),U.newRole==="admin"&&m.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[m.jsx(hc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),m.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),U.currentRole==="admin"&&m.jsxs("div",{className:"bg-destructive/10 border border-destructive/20 p-4 rounded-lg flex gap-3",children:[m.jsx(hc,{className:"h-5 w-5 text-destructive flex-shrink-0 mt-0.5"}),m.jsxs("div",{className:"space-y-1",children:[m.jsx("p",{className:"font-semibold text-destructive text-sm",children:" "}),m.jsx("p",{className:"text-sm text-muted-foreground",children:""})]})]}),m.jsx("p",{className:"text-sm text-center text-muted-foreground",children:""})]})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:""}),m.jsx(Us,{onClick:_e,className:"bg-primary",children:""})]})]})}),m.jsx(RYe,{open:X.open,onOpenChange:ge=>te({...X,open:ge}),merchantId:X.merchantId,merchantName:X.merchantName,userRole:X.userRole})]})})};var jR="Switch",[zYe,Det]=Ks(jR),[BYe,$Ye]=zYe(jR),nce=G.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:o,defaultChecked:l,required:d,disabled:i,value:g="on",onCheckedChange:x,form:S,...E}=e,[A,C]=G.useState(null),N=hi(t,F=>C(F)),k=G.useRef(!1),R=A?S||!!A.closest("form"):!0,[L,j]=Ru({prop:o,defaultProp:l??!1,onChange:x,caller:jR});return m.jsxs(BYe,{scope:r,checked:L,disabled:i,children:[m.jsx(bn.button,{type:"button",role:"switch","aria-checked":L,"aria-required":d,"data-state":sce(L),"data-disabled":i?"":void 0,disabled:i,value:g,...E,ref:N,onClick:Rr(e.onClick,F=>{j(B=>!B),R&&(k.current=F.isPropagationStopped(),k.current||F.stopPropagation())})}),R&&m.jsx(oce,{control:A,bubbles:!k.current,name:n,value:g,checked:L,required:d,disabled:i,form:S,style:{transform:"translateX(-100%)"}})]})});nce.displayName=jR;var ice="SwitchThumb",ace=G.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,o=$Ye(ice,r);return m.jsx(bn.span,{"data-state":sce(o.checked),"data-disabled":o.disabled?"":void 0,...n,ref:t})});ace.displayName=ice;var UYe="SwitchBubbleInput",oce=G.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...o},l)=>{const d=G.useRef(null),i=hi(d,l),g=_4(r),x=wB(t);return G.useEffect(()=>{const S=d.current;if(!S)return;const E=window.HTMLInputElement.prototype,C=Object.getOwnPropertyDescriptor(E,"checked").set;if(g!==r&&C){const N=new Event("click",{bubbles:n});C.call(S,r),S.dispatchEvent(N)}},[g,r,n]),m.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:i,style:{...o.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});oce.displayName=UYe;function sce(e){return e?"checked":"unchecked"}var lce=nce,VYe=ace;const cce=G.forwardRef(({className:e,...t},r)=>m.jsx(lce,{className:_r("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:m.jsx(VYe,{className:_r("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));cce.displayName=lce.displayName;const qYe=()=>{const{t:e}=Ki(),{toast:t}=wa(),{isSupervisor:r}=Tc(),{data:n,isLoading:o}=mOe(),{getLocalizedField:l}=kd(),d=TOe(),i=POe(),g=IOe(),[x,S]=G.useState([]),[E,A]=G.useState(""),[C,N]=G.useState("all"),k=G.useMemo(()=>{if(!n)return[];const U=new Set;return n.forEach(Z=>{const X=l(Z,"type");Array.isArray(X)?X.forEach(te=>U.add(te)):X&&U.add(X)}),Array.from(U)},[n,l]),R=G.useMemo(()=>n?n.filter(U=>{const Z=E===""||l(U,"name").toString().toLowerCase().includes(E.toLowerCase())||U.address.toLowerCase().includes(E.toLowerCase()),X=l(U,"type"),te=C==="all"||(Array.isArray(X)?X.includes(C):X===C);return Z&&te}):[],[n,E,C,l]),L=()=>{if(!n||n.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}DYe(n),t({title:e("common.success"),description:e("admin.exportSuccess")})},j=U=>{S(Z=>Z.includes(U)?Z.filter(X=>X!==U):[...Z,U])},F=()=>{x.length===(R==null?void 0:R.length)?S([]):S((R==null?void 0:R.map(U=>U.id))||[])},B=()=>{x.length!==0&&(i.mutate(x),S([]))};return o?m.jsx(Qc,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(Qc,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.restaurantManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageRestaurants")})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsxs(lr,{variant:"outline",onClick:L,className:"flex-1 sm:flex-initial",children:[m.jsx(ek,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),m.jsx(IO,{trigger:m.jsxs(lr,{className:"flex-1 sm:flex-initial",children:[m.jsx(hB,{className:"mr-2 h-4 w-4"}),e("admin.addRestaurant")]})})]})]}),m.jsx(Qr,{children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex gap-4 flex-wrap",children:[m.jsx("div",{className:"flex-1 min-w-[200px]",children:m.jsxs("div",{className:"relative",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(an,{placeholder:e("admin.searchRestaurants"),value:E,onChange:U=>A(U.target.value),className:"pl-9"})]})}),m.jsxs(wd,{value:C,onValueChange:N,children:[m.jsx(Au,{className:"w-[180px]",children:m.jsx(Sd,{placeholder:e("admin.filterByType")})}),m.jsxs(Pu,{children:[m.jsx(La,{value:"all",children:e("admin.allTypes")}),k.map(U=>m.jsx(La,{value:U,children:U},U))]})]})]})})}),!r&&x.length>0&&m.jsx(Qr,{className:"bg-muted/50",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[m.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:x.length})}),m.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[m.jsxs(zl,{children:[m.jsx(IE,{asChild:!0,children:m.jsxs(lr,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[m.jsx(bb,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:e("admin.confirmBatchDelete")}),m.jsx(ul,{children:e("admin.batchDeleteWarning",{count:x.length})})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:e("common.cancel")}),m.jsx(Us,{onClick:B,children:e("common.delete")})]})]})]}),m.jsx(lr,{variant:"outline",size:"sm",onClick:()=>S([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),!r&&m.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[m.jsx(Gs,{checked:x.length===(R==null?void 0:R.length)&&R.length>0,onCheckedChange:F}),m.jsx("span",{className:"font-medium",children:e("admin.selectAll")}),m.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",R==null?void 0:R.length," ",e("admin.results"),")"]})]}),m.jsx("div",{className:"grid gap-4",children:R==null?void 0:R.map(U=>m.jsx(Qr,{children:m.jsxs("div",{className:"flex flex-col md:flex-row",children:[m.jsx("div",{className:"p-4 flex items-start",children:!r&&m.jsx(Gs,{checked:x.includes(U.id),onCheckedChange:()=>j(U.id),className:"mt-1"})}),U.image_url&&m.jsx("div",{className:"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden",children:m.jsx("img",{src:U.image_url,alt:String(l(U,"name")),className:"object-cover object-center w-full h-full"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs(Mi,{children:[m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[m.jsx(Ji,{className:"text-lg md:text-xl",children:l(U,"name")}),m.jsx("div",{className:"flex items-center gap-2",children:m.jsxs("div",{className:"flex items-center gap-1",children:[m.jsx(wc,{className:"h-4 w-4 fill-accent text-accent"}),m.jsx("span",{className:"font-medium",children:U.rating||0})]})})]}),m.jsx(Do,{children:m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Cs,{className:"h-3 w-3 flex-shrink-0"}),m.jsx("span",{className:"text-xs sm:text-sm",children:U.address})]}),l(U,"description")&&m.jsx("div",{className:`prose prose-sm max-w-none line-clamp-2\r
                              [&_p]:inline [&_p]:m-0\r
                              [&_strong]:font-semibold [&_strong]:text-foreground\r
                              [&_em]:italic\r
                              [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                              [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:l(U,"description")}})]})})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:(Array.isArray(l(U,"type"))?l(U,"type"):[l(U,"type")]).map((Z,X)=>m.jsx(Qn,{children:Z},X))}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[m.jsxs("div",{className:"space-y-0.5",children:[m.jsx(Zr,{htmlFor:`visible-${U.id}`,className:"text-sm font-medium",children:""}),m.jsx("div",{className:"text-xs text-muted-foreground",children:U.visible?"":""})]}),m.jsx(cce,{id:`visible-${U.id}`,checked:U.visible??!0,onCheckedChange:Z=>g.mutate({restaurantId:U.id,visible:Z})})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsx(lr,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:m.jsx(Vi,{to:`/restaurant/${U.id}`,state:{from:"admin"},children:e("admin.view")})}),m.jsx(IO,{restaurant:U,trigger:m.jsx(lr,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),!r&&m.jsxs(zl,{children:[m.jsx(IE,{asChild:!0,children:m.jsx(lr,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:e("admin.confirmDelete")}),m.jsx(ul,{children:e("admin.deleteRestaurantWarning")})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:e("common.cancel")}),m.jsx(Us,{onClick:()=>d.mutate(U.id),children:e("common.delete")})]})]})]})]})]})]})]})]})},U.id))})]})})};var ii=function(){return ii=Object.assign||function(t){for(var r,n=1,o=arguments.length;n<o;n++){r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},ii.apply(this,arguments)};function WYe(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r}function uce(e,t,r){for(var n=0,o=t.length,l;n<o;n++)(l||!(n in t))&&(l||(l=Array.prototype.slice.call(t,0,n)),l[n]=t[n]);return e.concat(l||Array.prototype.slice.call(t))}function rA(e){return e.mode==="multiple"}function nA(e){return e.mode==="range"}function NR(e){return e.mode==="single"}var GYe={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function HYe(e,t){return Is(e,"LLLL y",t)}function KYe(e,t){return Is(e,"d",t)}function ZYe(e,t){return Is(e,"LLLL",t)}function XYe(e){return"".concat(e)}function YYe(e,t){return Is(e,"cccccc",t)}function JYe(e,t){return Is(e,"yyyy",t)}var QYe=Object.freeze({__proto__:null,formatCaption:HYe,formatDay:KYe,formatMonthCaption:ZYe,formatWeekNumber:XYe,formatWeekdayName:YYe,formatYearCaption:JYe}),eJe=function(e,t,r){return Is(e,"do MMMM (EEEE)",r)},tJe=function(){return"Month: "},rJe=function(){return"Go to next month"},nJe=function(){return"Go to previous month"},iJe=function(e,t){return Is(e,"cccc",t)},aJe=function(e){return"Week n. ".concat(e)},oJe=function(){return"Year: "},sJe=Object.freeze({__proto__:null,labelDay:eJe,labelMonthDropdown:tJe,labelNext:rJe,labelPrevious:nJe,labelWeekNumber:aJe,labelWeekday:iJe,labelYearDropdown:oJe});function lJe(){var e="buttons",t=GYe,r=h4,n={},o={},l=1,d={},i=new Date;return{captionLayout:e,classNames:t,formatters:QYe,labels:sJe,locale:r,modifiersClassNames:n,modifiers:o,numberOfMonths:l,styles:d,today:i,mode:"default"}}function cJe(e){var t=e.fromYear,r=e.toYear,n=e.fromMonth,o=e.toMonth,l=e.fromDate,d=e.toDate;return n?l=Sc(n):t&&(l=new Date(t,0,1)),o?d=Ck(o):r&&(d=new Date(r,11,31)),{fromDate:l?Hm(l):void 0,toDate:d?Hm(d):void 0}}var dce=G.createContext(void 0);function uJe(e){var t,r=e.initialProps,n=lJe(),o=cJe(r),l=o.fromDate,d=o.toDate,i=(t=r.captionLayout)!==null&&t!==void 0?t:n.captionLayout;i!=="buttons"&&(!l||!d)&&(i="buttons");var g;(NR(r)||rA(r)||nA(r))&&(g=r.onSelect);var x=ii(ii(ii({},n),r),{captionLayout:i,classNames:ii(ii({},n.classNames),r.classNames),components:ii({},r.components),formatters:ii(ii({},n.formatters),r.formatters),fromDate:l,labels:ii(ii({},n.labels),r.labels),mode:r.mode||n.mode,modifiers:ii(ii({},n.modifiers),r.modifiers),modifiersClassNames:ii(ii({},n.modifiersClassNames),r.modifiersClassNames),onSelect:g,styles:ii(ii({},n.styles),r.styles),toDate:d});return m.jsx(dce.Provider,{value:x,children:e.children})}function Ya(){var e=G.useContext(dce);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function hce(e){var t=Ya(),r=t.locale,n=t.classNames,o=t.styles,l=t.formatters.formatCaption;return m.jsx("div",{className:n.caption_label,style:o.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:l(e.displayMonth,{locale:r})})}function dJe(e){return m.jsx("svg",ii({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:m.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function fce(e){var t,r,n=e.onChange,o=e.value,l=e.children,d=e.caption,i=e.className,g=e.style,x=Ya(),S=(r=(t=x.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&r!==void 0?r:dJe;return m.jsxs("div",{className:i,style:g,children:[m.jsx("span",{className:x.classNames.vhidden,children:e["aria-label"]}),m.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:x.classNames.dropdown,style:x.styles.dropdown,value:o,onChange:n,children:l}),m.jsxs("div",{className:x.classNames.caption_label,style:x.styles.caption_label,"aria-hidden":"true",children:[d,m.jsx(S,{className:x.classNames.dropdown_icon,style:x.styles.dropdown_icon})]})]})}function hJe(e){var t,r=Ya(),n=r.fromDate,o=r.toDate,l=r.styles,d=r.locale,i=r.formatters.formatMonthCaption,g=r.classNames,x=r.components,S=r.labels.labelMonthDropdown;if(!n)return m.jsx(m.Fragment,{});if(!o)return m.jsx(m.Fragment,{});var E=[];if(m2e(n,o))for(var A=Sc(n),C=n.getMonth();C<=o.getMonth();C++)E.push(VM(A,C));else for(var A=Sc(new Date),C=0;C<=11;C++)E.push(VM(A,C));var N=function(R){var L=Number(R.target.value),j=VM(Sc(e.displayMonth),L);e.onChange(j)},k=(t=x==null?void 0:x.Dropdown)!==null&&t!==void 0?t:fce;return m.jsx(k,{name:"months","aria-label":S(),className:g.dropdown_month,style:l.dropdown_month,onChange:N,value:e.displayMonth.getMonth(),caption:i(e.displayMonth,{locale:d}),children:E.map(function(R){return m.jsx("option",{value:R.getMonth(),children:i(R,{locale:d})},R.getMonth())})})}function fJe(e){var t,r=e.displayMonth,n=Ya(),o=n.fromDate,l=n.toDate,d=n.locale,i=n.styles,g=n.classNames,x=n.components,S=n.formatters.formatYearCaption,E=n.labels.labelYearDropdown,A=[];if(!o)return m.jsx(m.Fragment,{});if(!l)return m.jsx(m.Fragment,{});for(var C=o.getFullYear(),N=l.getFullYear(),k=C;k<=N;k++)A.push(XW(jre(new Date),k));var R=function(j){var F=XW(Sc(r),Number(j.target.value));e.onChange(F)},L=(t=x==null?void 0:x.Dropdown)!==null&&t!==void 0?t:fce;return m.jsx(L,{name:"years","aria-label":E(),className:g.dropdown_year,style:i.dropdown_year,onChange:R,value:r.getFullYear(),caption:S(r,{locale:d}),children:A.map(function(j){return m.jsx("option",{value:j.getFullYear(),children:S(j,{locale:d})},j.getFullYear())})})}function pJe(e,t){var r=G.useState(e),n=r[0],o=r[1],l=t===void 0?n:t;return[l,o]}function mJe(e){var t=e.month,r=e.defaultMonth,n=e.today,o=t||r||n||new Date,l=e.toDate,d=e.fromDate,i=e.numberOfMonths,g=i===void 0?1:i;if(l&&F0(l,o)<0){var x=-1*(g-1);o=Cd(l,x)}return d&&F0(o,d)<0&&(o=d),Sc(o)}function gJe(){var e=Ya(),t=mJe(e),r=pJe(t,e.month),n=r[0],o=r[1],l=function(d){var i;if(!e.disableNavigation){var g=Sc(d);o(g),(i=e.onMonthChange)===null||i===void 0||i.call(e,g)}};return[n,l]}function yJe(e,t){for(var r=t.reverseMonths,n=t.numberOfMonths,o=Sc(e),l=Sc(Cd(o,n)),d=F0(l,o),i=[],g=0;g<d;g++){var x=Cd(o,g);i.push(x)}return r&&(i=i.reverse()),i}function vJe(e,t){if(!t.disableNavigation){var r=t.toDate,n=t.pagedNavigation,o=t.numberOfMonths,l=o===void 0?1:o,d=n?l:1,i=Sc(e);if(!r)return Cd(i,d);var g=F0(r,e);if(!(g<l))return Cd(i,d)}}function _Je(e,t){if(!t.disableNavigation){var r=t.fromDate,n=t.pagedNavigation,o=t.numberOfMonths,l=o===void 0?1:o,d=n?l:1,i=Sc(e);if(!r)return Cd(i,-d);var g=F0(i,r);if(!(g<=0))return Cd(i,-d)}}var pce=G.createContext(void 0);function xJe(e){var t=Ya(),r=gJe(),n=r[0],o=r[1],l=yJe(n,t),d=vJe(n,t),i=_Je(n,t),g=function(E){return l.some(function(A){return f4(E,A)})},x=function(E,A){g(E)||(A&&zre(E,A)?o(Cd(E,1+t.numberOfMonths*-1)):o(E))},S={currentMonth:n,displayMonths:l,goToMonth:o,goToDate:x,previousMonth:i,nextMonth:d,isDateDisplayed:g};return m.jsx(pce.Provider,{value:S,children:e.children})}function iA(){var e=G.useContext(pce);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function jK(e){var t,r=Ya(),n=r.classNames,o=r.styles,l=r.components,d=iA().goToMonth,i=function(S){d(Cd(S,e.displayIndex?-e.displayIndex:0))},g=(t=l==null?void 0:l.CaptionLabel)!==null&&t!==void 0?t:hce,x=m.jsx(g,{id:e.id,displayMonth:e.displayMonth});return m.jsxs("div",{className:n.caption_dropdowns,style:o.caption_dropdowns,children:[m.jsx("div",{className:n.vhidden,children:x}),m.jsx(hJe,{onChange:i,displayMonth:e.displayMonth}),m.jsx(fJe,{onChange:i,displayMonth:e.displayMonth})]})}function bJe(e){return m.jsx("svg",ii({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:m.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function wJe(e){return m.jsx("svg",ii({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:m.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var RI=G.forwardRef(function(e,t){var r=Ya(),n=r.classNames,o=r.styles,l=[n.button_reset,n.button];e.className&&l.push(e.className);var d=l.join(" "),i=ii(ii({},o.button_reset),o.button);return e.style&&Object.assign(i,e.style),m.jsx("button",ii({},e,{ref:t,type:"button",className:d,style:i}))});function SJe(e){var t,r,n=Ya(),o=n.dir,l=n.locale,d=n.classNames,i=n.styles,g=n.labels,x=g.labelPrevious,S=g.labelNext,E=n.components;if(!e.nextMonth&&!e.previousMonth)return m.jsx(m.Fragment,{});var A=x(e.previousMonth,{locale:l}),C=[d.nav_button,d.nav_button_previous].join(" "),N=S(e.nextMonth,{locale:l}),k=[d.nav_button,d.nav_button_next].join(" "),R=(t=E==null?void 0:E.IconRight)!==null&&t!==void 0?t:wJe,L=(r=E==null?void 0:E.IconLeft)!==null&&r!==void 0?r:bJe;return m.jsxs("div",{className:d.nav,style:i.nav,children:[!e.hidePrevious&&m.jsx(RI,{name:"previous-month","aria-label":A,className:C,style:i.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:o==="rtl"?m.jsx(R,{className:d.nav_icon,style:i.nav_icon}):m.jsx(L,{className:d.nav_icon,style:i.nav_icon})}),!e.hideNext&&m.jsx(RI,{name:"next-month","aria-label":N,className:k,style:i.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:o==="rtl"?m.jsx(L,{className:d.nav_icon,style:i.nav_icon}):m.jsx(R,{className:d.nav_icon,style:i.nav_icon})})]})}function NK(e){var t=Ya().numberOfMonths,r=iA(),n=r.previousMonth,o=r.nextMonth,l=r.goToMonth,d=r.displayMonths,i=d.findIndex(function(N){return f4(e.displayMonth,N)}),g=i===0,x=i===d.length-1,S=t>1&&(g||!x),E=t>1&&(x||!g),A=function(){n&&l(n)},C=function(){o&&l(o)};return m.jsx(SJe,{displayMonth:e.displayMonth,hideNext:S,hidePrevious:E,nextMonth:o,previousMonth:n,onPreviousClick:A,onNextClick:C})}function EJe(e){var t,r=Ya(),n=r.classNames,o=r.disableNavigation,l=r.styles,d=r.captionLayout,i=r.components,g=(t=i==null?void 0:i.CaptionLabel)!==null&&t!==void 0?t:hce,x;return o?x=m.jsx(g,{id:e.id,displayMonth:e.displayMonth}):d==="dropdown"?x=m.jsx(jK,{displayMonth:e.displayMonth,id:e.id}):d==="dropdown-buttons"?x=m.jsxs(m.Fragment,{children:[m.jsx(jK,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),m.jsx(NK,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):x=m.jsxs(m.Fragment,{children:[m.jsx(g,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),m.jsx(NK,{displayMonth:e.displayMonth,id:e.id})]}),m.jsx("div",{className:n.caption,style:l.caption,children:x})}function TJe(e){var t=Ya(),r=t.footer,n=t.styles,o=t.classNames.tfoot;return r?m.jsx("tfoot",{className:o,style:n.tfoot,children:m.jsx("tr",{children:m.jsx("td",{colSpan:8,children:r})})}):m.jsx(m.Fragment,{})}function AJe(e,t,r){for(var n=r?dv(new Date):Ah(new Date,{locale:e,weekStartsOn:t}),o=[],l=0;l<7;l++){var d=Ll(n,l);o.push(d)}return o}function PJe(){var e=Ya(),t=e.classNames,r=e.styles,n=e.showWeekNumber,o=e.locale,l=e.weekStartsOn,d=e.ISOWeek,i=e.formatters.formatWeekdayName,g=e.labels.labelWeekday,x=AJe(o,l,d);return m.jsxs("tr",{style:r.head_row,className:t.head_row,children:[n&&m.jsx("td",{style:r.head_cell,className:t.head_cell}),x.map(function(S,E){return m.jsx("th",{scope:"col",className:t.head_cell,style:r.head_cell,"aria-label":g(S,{locale:o}),children:i(S,{locale:o})},E)})]})}function CJe(){var e,t=Ya(),r=t.classNames,n=t.styles,o=t.components,l=(e=o==null?void 0:o.HeadRow)!==null&&e!==void 0?e:PJe;return m.jsx("thead",{style:n.head,className:r.head,children:m.jsx(l,{})})}function OJe(e){var t=Ya(),r=t.locale,n=t.formatters.formatDay;return m.jsx(m.Fragment,{children:n(e.date,{locale:r})})}var G5=G.createContext(void 0);function IJe(e){if(!rA(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return m.jsx(G5.Provider,{value:t,children:e.children})}return m.jsx(kJe,{initialProps:e.initialProps,children:e.children})}function kJe(e){var t=e.initialProps,r=e.children,n=t.selected,o=t.min,l=t.max,d=function(x,S,E){var A,C;(A=t.onDayClick)===null||A===void 0||A.call(t,x,S,E);var N=!!(S.selected&&o&&(n==null?void 0:n.length)===o);if(!N){var k=!!(!S.selected&&l&&(n==null?void 0:n.length)===l);if(!k){var R=n?uce([],n):[];if(S.selected){var L=R.findIndex(function(j){return yc(x,j)});R.splice(L,1)}else R.push(x);(C=t.onSelect)===null||C===void 0||C.call(t,R,x,S,E)}}},i={disabled:[]};n&&i.disabled.push(function(x){var S=l&&n.length>l-1,E=n.some(function(A){return yc(A,x)});return!!(S&&!E)});var g={selected:n,onDayClick:d,modifiers:i};return m.jsx(G5.Provider,{value:g,children:r})}function H5(){var e=G.useContext(G5);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function RJe(e,t){var r=t||{},n=r.from,o=r.to;return n&&o?yc(o,e)&&yc(n,e)?void 0:yc(o,e)?{from:o,to:void 0}:yc(n,e)?void 0:y3(n,e)?{from:e,to:o}:{from:n,to:e}:o?y3(e,o)?{from:o,to:e}:{from:e,to:o}:n?zre(e,n)?{from:e,to:n}:{from:n,to:e}:{from:e,to:void 0}}var K5=G.createContext(void 0);function jJe(e){if(!nA(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return m.jsx(K5.Provider,{value:t,children:e.children})}return m.jsx(NJe,{initialProps:e.initialProps,children:e.children})}function NJe(e){var t=e.initialProps,r=e.children,n=t.selected,o=n||{},l=o.from,d=o.to,i=t.min,g=t.max,x=function(C,N,k){var R,L;(R=t.onDayClick)===null||R===void 0||R.call(t,C,N,k);var j=RJe(C,n);(L=t.onSelect)===null||L===void 0||L.call(t,j,C,N,k)},S={range_start:[],range_end:[],range_middle:[],disabled:[]};if(l?(S.range_start=[l],d?(S.range_end=[d],yc(l,d)||(S.range_middle=[{after:l,before:d}])):S.range_end=[l]):d&&(S.range_start=[d],S.range_end=[d]),i&&(l&&!d&&S.disabled.push({after:yC(l,i-1),before:Ll(l,i-1)}),l&&d&&S.disabled.push({after:l,before:Ll(l,i-1)}),!l&&d&&S.disabled.push({after:yC(d,i-1),before:Ll(d,i-1)})),g){if(l&&!d&&(S.disabled.push({before:Ll(l,-g+1)}),S.disabled.push({after:Ll(l,g-1)})),l&&d){var E=hh(d,l)+1,A=g-E;S.disabled.push({before:yC(l,A)}),S.disabled.push({after:Ll(d,A)})}!l&&d&&(S.disabled.push({before:Ll(d,-g+1)}),S.disabled.push({after:Ll(d,g-1)}))}return m.jsx(K5.Provider,{value:{selected:n,onDayClick:x,modifiers:S},children:r})}function Z5(){var e=G.useContext(K5);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function AC(e){return Array.isArray(e)?uce([],e):e!==void 0?[e]:[]}function MJe(e){var t={};return Object.entries(e).forEach(function(r){var n=r[0],o=r[1];t[n]=AC(o)}),t}var Od;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Od||(Od={}));var DJe=Od.Selected,cf=Od.Disabled,LJe=Od.Hidden,FJe=Od.Today,bD=Od.RangeEnd,wD=Od.RangeMiddle,SD=Od.RangeStart,zJe=Od.Outside;function BJe(e,t,r){var n,o=(n={},n[DJe]=AC(e.selected),n[cf]=AC(e.disabled),n[LJe]=AC(e.hidden),n[FJe]=[e.today],n[bD]=[],n[wD]=[],n[SD]=[],n[zJe]=[],n);return e.fromDate&&o[cf].push({before:e.fromDate}),e.toDate&&o[cf].push({after:e.toDate}),rA(e)?o[cf]=o[cf].concat(t.modifiers[cf]):nA(e)&&(o[cf]=o[cf].concat(r.modifiers[cf]),o[SD]=r.modifiers[SD],o[wD]=r.modifiers[wD],o[bD]=r.modifiers[bD]),o}var mce=G.createContext(void 0);function $Je(e){var t=Ya(),r=H5(),n=Z5(),o=BJe(t,r,n),l=MJe(t.modifiers),d=ii(ii({},o),l);return m.jsx(mce.Provider,{value:d,children:e.children})}function gce(){var e=G.useContext(mce);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function UJe(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function VJe(e){return!!(e&&typeof e=="object"&&"from"in e)}function qJe(e){return!!(e&&typeof e=="object"&&"after"in e)}function WJe(e){return!!(e&&typeof e=="object"&&"before"in e)}function GJe(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function HJe(e,t){var r,n=t.from,o=t.to;if(n&&o){var l=hh(o,n)<0;l&&(r=[o,n],n=r[0],o=r[1]);var d=hh(e,n)>=0&&hh(o,e)>=0;return d}return o?yc(o,e):n?yc(n,e):!1}function KJe(e){return u4(e)}function ZJe(e){return Array.isArray(e)&&e.every(u4)}function XJe(e,t){return t.some(function(r){if(typeof r=="boolean")return r;if(KJe(r))return yc(e,r);if(ZJe(r))return r.includes(e);if(VJe(r))return HJe(e,r);if(GJe(r))return r.dayOfWeek.includes(e.getDay());if(UJe(r)){var n=hh(r.before,e),o=hh(r.after,e),l=n>0,d=o<0,i=y3(r.before,r.after);return i?d&&l:l||d}return qJe(r)?hh(e,r.after)>0:WJe(r)?hh(r.before,e)>0:typeof r=="function"?r(e):!1})}function X5(e,t,r){var n=Object.keys(t).reduce(function(l,d){var i=t[d];return XJe(e,i)&&l.push(d),l},[]),o={};return n.forEach(function(l){return o[l]=!0}),r&&!f4(e,r)&&(o.outside=!0),o}function YJe(e,t){for(var r=Sc(e[0]),n=Ck(e[e.length-1]),o,l,d=r;d<=n;){var i=X5(d,t),g=!i.disabled&&!i.hidden;if(!g){d=Ll(d,1);continue}if(i.selected)return d;i.today&&!l&&(l=d),o||(o=d),d=Ll(d,1)}return l||o}var JJe=365;function yce(e,t){var r=t.moveBy,n=t.direction,o=t.context,l=t.modifiers,d=t.retry,i=d===void 0?{count:0,lastFocused:e}:d,g=o.weekStartsOn,x=o.fromDate,S=o.toDate,E=o.locale,A={day:Ll,week:g3,month:Cd,year:nAe,startOfWeek:function(R){return o.ISOWeek?dv(R):Ah(R,{locale:E,weekStartsOn:g})},endOfWeek:function(R){return o.ISOWeek?Nre(R):d4(R,{locale:E,weekStartsOn:g})}},C=A[r](e,n==="after"?1:-1);n==="before"&&x?C=iAe([x,C]):n==="after"&&S&&(C=aAe([S,C]));var N=!0;if(l){var k=X5(C,l);N=!k.disabled&&!k.hidden}return N?C:i.count>JJe?i.lastFocused:yce(C,{moveBy:r,direction:n,context:o,modifiers:l,retry:ii(ii({},i),{count:i.count+1})})}var vce=G.createContext(void 0);function QJe(e){var t=iA(),r=gce(),n=G.useState(),o=n[0],l=n[1],d=G.useState(),i=d[0],g=d[1],x=YJe(t.displayMonths,r),S=o??(i&&t.isDateDisplayed(i))?i:x,E=function(){g(o),l(void 0)},A=function(R){l(R)},C=Ya(),N=function(R,L){if(o){var j=yce(o,{moveBy:R,direction:L,context:C,modifiers:r});yc(o,j)||(t.goToDate(j,o),A(j))}},k={focusedDay:o,focusTarget:S,blur:E,focus:A,focusDayAfter:function(){return N("day","after")},focusDayBefore:function(){return N("day","before")},focusWeekAfter:function(){return N("week","after")},focusWeekBefore:function(){return N("week","before")},focusMonthBefore:function(){return N("month","before")},focusMonthAfter:function(){return N("month","after")},focusYearBefore:function(){return N("year","before")},focusYearAfter:function(){return N("year","after")},focusStartOfWeek:function(){return N("startOfWeek","before")},focusEndOfWeek:function(){return N("endOfWeek","after")}};return m.jsx(vce.Provider,{value:k,children:e.children})}function Y5(){var e=G.useContext(vce);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function eQe(e,t){var r=gce(),n=X5(e,r,t);return n}var J5=G.createContext(void 0);function tQe(e){if(!NR(e.initialProps)){var t={selected:void 0};return m.jsx(J5.Provider,{value:t,children:e.children})}return m.jsx(rQe,{initialProps:e.initialProps,children:e.children})}function rQe(e){var t=e.initialProps,r=e.children,n=function(l,d,i){var g,x,S;if((g=t.onDayClick)===null||g===void 0||g.call(t,l,d,i),d.selected&&!t.required){(x=t.onSelect)===null||x===void 0||x.call(t,void 0,l,d,i);return}(S=t.onSelect)===null||S===void 0||S.call(t,l,l,d,i)},o={selected:t.selected,onDayClick:n};return m.jsx(J5.Provider,{value:o,children:r})}function _ce(){var e=G.useContext(J5);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function nQe(e,t){var r=Ya(),n=_ce(),o=H5(),l=Z5(),d=Y5(),i=d.focusDayAfter,g=d.focusDayBefore,x=d.focusWeekAfter,S=d.focusWeekBefore,E=d.blur,A=d.focus,C=d.focusMonthBefore,N=d.focusMonthAfter,k=d.focusYearBefore,R=d.focusYearAfter,L=d.focusStartOfWeek,j=d.focusEndOfWeek,F=function(fe){var _e,be,Pe,ye;NR(r)?(_e=n.onDayClick)===null||_e===void 0||_e.call(n,e,t,fe):rA(r)?(be=o.onDayClick)===null||be===void 0||be.call(o,e,t,fe):nA(r)?(Pe=l.onDayClick)===null||Pe===void 0||Pe.call(l,e,t,fe):(ye=r.onDayClick)===null||ye===void 0||ye.call(r,e,t,fe)},B=function(fe){var _e;A(e),(_e=r.onDayFocus)===null||_e===void 0||_e.call(r,e,t,fe)},U=function(fe){var _e;E(),(_e=r.onDayBlur)===null||_e===void 0||_e.call(r,e,t,fe)},Z=function(fe){var _e;(_e=r.onDayMouseEnter)===null||_e===void 0||_e.call(r,e,t,fe)},X=function(fe){var _e;(_e=r.onDayMouseLeave)===null||_e===void 0||_e.call(r,e,t,fe)},te=function(fe){var _e;(_e=r.onDayPointerEnter)===null||_e===void 0||_e.call(r,e,t,fe)},se=function(fe){var _e;(_e=r.onDayPointerLeave)===null||_e===void 0||_e.call(r,e,t,fe)},oe=function(fe){var _e;(_e=r.onDayTouchCancel)===null||_e===void 0||_e.call(r,e,t,fe)},ne=function(fe){var _e;(_e=r.onDayTouchEnd)===null||_e===void 0||_e.call(r,e,t,fe)},ee=function(fe){var _e;(_e=r.onDayTouchMove)===null||_e===void 0||_e.call(r,e,t,fe)},ie=function(fe){var _e;(_e=r.onDayTouchStart)===null||_e===void 0||_e.call(r,e,t,fe)},he=function(fe){var _e;(_e=r.onDayKeyUp)===null||_e===void 0||_e.call(r,e,t,fe)},Se=function(fe){var _e;switch(fe.key){case"ArrowLeft":fe.preventDefault(),fe.stopPropagation(),r.dir==="rtl"?i():g();break;case"ArrowRight":fe.preventDefault(),fe.stopPropagation(),r.dir==="rtl"?g():i();break;case"ArrowDown":fe.preventDefault(),fe.stopPropagation(),x();break;case"ArrowUp":fe.preventDefault(),fe.stopPropagation(),S();break;case"PageUp":fe.preventDefault(),fe.stopPropagation(),fe.shiftKey?k():C();break;case"PageDown":fe.preventDefault(),fe.stopPropagation(),fe.shiftKey?R():N();break;case"Home":fe.preventDefault(),fe.stopPropagation(),L();break;case"End":fe.preventDefault(),fe.stopPropagation(),j();break}(_e=r.onDayKeyDown)===null||_e===void 0||_e.call(r,e,t,fe)},Ce={onClick:F,onFocus:B,onBlur:U,onKeyDown:Se,onKeyUp:he,onMouseEnter:Z,onMouseLeave:X,onPointerEnter:te,onPointerLeave:se,onTouchCancel:oe,onTouchEnd:ne,onTouchMove:ee,onTouchStart:ie};return Ce}function iQe(){var e=Ya(),t=_ce(),r=H5(),n=Z5(),o=NR(e)?t.selected:rA(e)?r.selected:nA(e)?n.selected:void 0;return o}function aQe(e){return Object.values(Od).includes(e)}function oQe(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(n){var o=e.modifiersClassNames[n];if(o)r.push(o);else if(aQe(n)){var l=e.classNames["day_".concat(n)];l&&r.push(l)}}),r}function sQe(e,t){var r=ii({},e.styles.day);return Object.keys(t).forEach(function(n){var o;r=ii(ii({},r),(o=e.modifiersStyles)===null||o===void 0?void 0:o[n])}),r}function lQe(e,t,r){var n,o,l,d=Ya(),i=Y5(),g=eQe(e,t),x=nQe(e,g),S=iQe(),E=!!(d.onDayClick||d.mode!=="default");G.useEffect(function(){var Z;g.outside||i.focusedDay&&E&&yc(i.focusedDay,e)&&((Z=r.current)===null||Z===void 0||Z.focus())},[i.focusedDay,e,r,E,g.outside]);var A=oQe(d,g).join(" "),C=sQe(d,g),N=!!(g.outside&&!d.showOutsideDays||g.hidden),k=(l=(o=d.components)===null||o===void 0?void 0:o.DayContent)!==null&&l!==void 0?l:OJe,R=m.jsx(k,{date:e,displayMonth:t,activeModifiers:g}),L={style:C,className:A,children:R,role:"gridcell"},j=i.focusTarget&&yc(i.focusTarget,e)&&!g.outside,F=i.focusedDay&&yc(i.focusedDay,e),B=ii(ii(ii({},L),(n={disabled:g.disabled,role:"gridcell"},n["aria-selected"]=g.selected,n.tabIndex=F||j?0:-1,n)),x),U={isButton:E,isHidden:N,activeModifiers:g,selectedDays:S,buttonProps:B,divProps:L};return U}function cQe(e){var t=G.useRef(null),r=lQe(e.date,e.displayMonth,t);return r.isHidden?m.jsx("div",{role:"gridcell"}):r.isButton?m.jsx(RI,ii({name:"day",ref:t},r.buttonProps)):m.jsx("div",ii({},r.divProps))}function uQe(e){var t=e.number,r=e.dates,n=Ya(),o=n.onWeekNumberClick,l=n.styles,d=n.classNames,i=n.locale,g=n.labels.labelWeekNumber,x=n.formatters.formatWeekNumber,S=x(Number(t),{locale:i});if(!o)return m.jsx("span",{className:d.weeknumber,style:l.weeknumber,children:S});var E=g(Number(t),{locale:i}),A=function(C){o(t,r,C)};return m.jsx(RI,{name:"week-number","aria-label":E,className:d.weeknumber,style:l.weeknumber,onClick:A,children:S})}function dQe(e){var t,r,n=Ya(),o=n.styles,l=n.classNames,d=n.showWeekNumber,i=n.components,g=(t=i==null?void 0:i.Day)!==null&&t!==void 0?t:cQe,x=(r=i==null?void 0:i.WeekNumber)!==null&&r!==void 0?r:uQe,S;return d&&(S=m.jsx("td",{className:l.cell,style:o.cell,children:m.jsx(x,{number:e.weekNumber,dates:e.dates})})),m.jsxs("tr",{className:l.row,style:o.row,children:[S,e.dates.map(function(E){return m.jsx("td",{className:l.cell,style:o.cell,role:"presentation",children:m.jsx(g,{displayMonth:e.displayMonth,date:E})},h2e(E))})]})}function MK(e,t,r){for(var n=r!=null&&r.ISOWeek?Nre(t):d4(t,r),o=r!=null&&r.ISOWeek?dv(e):Ah(e,r),l=hh(n,o),d=[],i=0;i<=l;i++)d.push(Ll(o,i));var g=d.reduce(function(x,S){var E=r!=null&&r.ISOWeek?Mre(S):Lre(S,r),A=x.find(function(C){return C.weekNumber===E});return A?(A.dates.push(S),x):(x.push({weekNumber:E,dates:[S]}),x)},[]);return g}function hQe(e,t){var r=MK(Sc(e),Ck(e),t);if(t!=null&&t.useFixedWeeks){var n=p2e(e,t);if(n<6){var o=r[r.length-1],l=o.dates[o.dates.length-1],d=g3(l,6-n),i=MK(g3(l,1),d,t);r.push.apply(r,i)}}return r}function fQe(e){var t,r,n,o=Ya(),l=o.locale,d=o.classNames,i=o.styles,g=o.hideHead,x=o.fixedWeeks,S=o.components,E=o.weekStartsOn,A=o.firstWeekContainsDate,C=o.ISOWeek,N=hQe(e.displayMonth,{useFixedWeeks:!!x,ISOWeek:C,locale:l,weekStartsOn:E,firstWeekContainsDate:A}),k=(t=S==null?void 0:S.Head)!==null&&t!==void 0?t:CJe,R=(r=S==null?void 0:S.Row)!==null&&r!==void 0?r:dQe,L=(n=S==null?void 0:S.Footer)!==null&&n!==void 0?n:TJe;return m.jsxs("table",{id:e.id,className:d.table,style:i.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!g&&m.jsx(k,{}),m.jsx("tbody",{className:d.tbody,style:i.tbody,children:N.map(function(j){return m.jsx(R,{displayMonth:e.displayMonth,dates:j.dates,weekNumber:j.weekNumber},j.weekNumber)})}),m.jsx(L,{displayMonth:e.displayMonth})]})}function pQe(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var mQe=pQe()?G.useLayoutEffect:G.useEffect,ED=!1,gQe=0;function DK(){return"react-day-picker-".concat(++gQe)}function yQe(e){var t,r=e??(ED?DK():null),n=G.useState(r),o=n[0],l=n[1];return mQe(function(){o===null&&l(DK())},[]),G.useEffect(function(){ED===!1&&(ED=!0)},[]),(t=e??o)!==null&&t!==void 0?t:void 0}function vQe(e){var t,r,n=Ya(),o=n.dir,l=n.classNames,d=n.styles,i=n.components,g=iA().displayMonths,x=yQe(n.id?"".concat(n.id,"-").concat(e.displayIndex):void 0),S=n.id?"".concat(n.id,"-grid-").concat(e.displayIndex):void 0,E=[l.month],A=d.month,C=e.displayIndex===0,N=e.displayIndex===g.length-1,k=!C&&!N;o==="rtl"&&(t=[C,N],N=t[0],C=t[1]),C&&(E.push(l.caption_start),A=ii(ii({},A),d.caption_start)),N&&(E.push(l.caption_end),A=ii(ii({},A),d.caption_end)),k&&(E.push(l.caption_between),A=ii(ii({},A),d.caption_between));var R=(r=i==null?void 0:i.Caption)!==null&&r!==void 0?r:EJe;return m.jsxs("div",{className:E.join(" "),style:A,children:[m.jsx(R,{id:x,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),m.jsx(fQe,{id:S,"aria-labelledby":x,displayMonth:e.displayMonth})]},e.displayIndex)}function _Qe(e){var t=Ya(),r=t.classNames,n=t.styles;return m.jsx("div",{className:r.months,style:n.months,children:e.children})}function xQe(e){var t,r,n=e.initialProps,o=Ya(),l=Y5(),d=iA(),i=G.useState(!1),g=i[0],x=i[1];G.useEffect(function(){o.initialFocus&&l.focusTarget&&(g||(l.focus(l.focusTarget),x(!0)))},[o.initialFocus,g,l.focus,l.focusTarget,l]);var S=[o.classNames.root,o.className];o.numberOfMonths>1&&S.push(o.classNames.multiple_months),o.showWeekNumber&&S.push(o.classNames.with_weeknumber);var E=ii(ii({},o.styles.root),o.style),A=Object.keys(n).filter(function(N){return N.startsWith("data-")}).reduce(function(N,k){var R;return ii(ii({},N),(R={},R[k]=n[k],R))},{}),C=(r=(t=n.components)===null||t===void 0?void 0:t.Months)!==null&&r!==void 0?r:_Qe;return m.jsx("div",ii({className:S.join(" "),style:E,dir:o.dir,id:o.id,nonce:n.nonce,title:n.title,lang:n.lang},A,{children:m.jsx(C,{children:d.displayMonths.map(function(N,k){return m.jsx(vQe,{displayIndex:k,displayMonth:N},k)})})}))}function bQe(e){var t=e.children,r=WYe(e,["children"]);return m.jsx(uJe,{initialProps:r,children:m.jsx(xJe,{children:m.jsx(tQe,{initialProps:r,children:m.jsx(IJe,{initialProps:r,children:m.jsx(jJe,{initialProps:r,children:m.jsx($Je,{children:m.jsx(QJe,{children:t})})})})})})})}function wQe(e){return m.jsx(bQe,ii({},e,{children:m.jsx(xQe,{initialProps:e})}))}function oz({className:e,classNames:t,showOutsideDays:r=!0,...n}){return m.jsx(wQe,{showOutsideDays:r,className:_r("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:_r(AE({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:_r(AE({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...o})=>m.jsx(lB,{className:"h-4 w-4"}),IconRight:({...o})=>m.jsx(WY,{className:"h-4 w-4"})},...n})}oz.displayName="Calendar";var MR="Popover",[xce,Let]=Ks(MR,[eg]),aA=eg(),[SQe,ug]=xce(MR),bce=e=>{const{__scopePopover:t,children:r,open:n,defaultOpen:o,onOpenChange:l,modal:d=!1}=e,i=aA(t),g=G.useRef(null),[x,S]=G.useState(!1),[E,A]=Ru({prop:n,defaultProp:o??!1,onChange:l,caller:MR});return m.jsx(ak,{...i,children:m.jsx(SQe,{scope:t,contentId:Hc(),triggerRef:g,open:E,onOpenChange:A,onOpenToggle:G.useCallback(()=>A(C=>!C),[A]),hasCustomAnchor:x,onCustomAnchorAdd:G.useCallback(()=>S(!0),[]),onCustomAnchorRemove:G.useCallback(()=>S(!1),[]),modal:d,children:r})})};bce.displayName=MR;var wce="PopoverAnchor",EQe=G.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=ug(wce,r),l=aA(r),{onCustomAnchorAdd:d,onCustomAnchorRemove:i}=o;return G.useEffect(()=>(d(),()=>i()),[d,i]),m.jsx(OT,{...l,...n,ref:t})});EQe.displayName=wce;var Sce="PopoverTrigger",Ece=G.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=ug(Sce,r),l=aA(r),d=hi(t,o.triggerRef),i=m.jsx(bn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Oce(o.open),...n,ref:d,onClick:Rr(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?i:m.jsx(OT,{asChild:!0,...l,children:i})});Ece.displayName=Sce;var Q5="PopoverPortal",[TQe,AQe]=xce(Q5,{forceMount:void 0}),Tce=e=>{const{__scopePopover:t,forceMount:r,children:n,container:o}=e,l=ug(Q5,t);return m.jsx(TQe,{scope:t,forceMount:r,children:m.jsx(ys,{present:r||l.open,children:m.jsx(_b,{asChild:!0,container:o,children:n})})})};Tce.displayName=Q5;var mb="PopoverContent",Ace=G.forwardRef((e,t)=>{const r=AQe(mb,e.__scopePopover),{forceMount:n=r.forceMount,...o}=e,l=ug(mb,e.__scopePopover);return m.jsx(ys,{present:n||l.open,children:l.modal?m.jsx(CQe,{...o,ref:t}):m.jsx(OQe,{...o,ref:t})})});Ace.displayName=mb;var PQe=$m("PopoverContent.RemoveScroll"),CQe=G.forwardRef((e,t)=>{const r=ug(mb,e.__scopePopover),n=G.useRef(null),o=hi(t,n),l=G.useRef(!1);return G.useEffect(()=>{const d=n.current;if(d)return vk(d)},[]),m.jsx(RT,{as:PQe,allowPinchZoom:!0,children:m.jsx(Pce,{...e,ref:o,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Rr(e.onCloseAutoFocus,d=>{var i;d.preventDefault(),l.current||(i=r.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Rr(e.onPointerDownOutside,d=>{const i=d.detail.originalEvent,g=i.button===0&&i.ctrlKey===!0,x=i.button===2||g;l.current=x},{checkForDefaultPrevented:!1}),onFocusOutside:Rr(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1})})})}),OQe=G.forwardRef((e,t)=>{const r=ug(mb,e.__scopePopover),n=G.useRef(!1),o=G.useRef(!1);return m.jsx(Pce,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:l=>{var d,i;(d=e.onCloseAutoFocus)==null||d.call(e,l),l.defaultPrevented||(n.current||(i=r.triggerRef.current)==null||i.focus(),l.preventDefault()),n.current=!1,o.current=!1},onInteractOutside:l=>{var g,x;(g=e.onInteractOutside)==null||g.call(e,l),l.defaultPrevented||(n.current=!0,l.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const d=l.target;((x=r.triggerRef.current)==null?void 0:x.contains(d))&&l.preventDefault(),l.detail.originalEvent.type==="focusin"&&o.current&&l.preventDefault()}})}),Pce=G.forwardRef((e,t)=>{const{__scopePopover:r,trapFocus:n,onOpenAutoFocus:o,onCloseAutoFocus:l,disableOutsidePointerEvents:d,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:x,onInteractOutside:S,...E}=e,A=ug(mb,r),C=aA(r);return gk(),m.jsx(kT,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:o,onUnmountAutoFocus:l,children:m.jsx(Ev,{asChild:!0,disableOutsidePointerEvents:d,onInteractOutside:S,onEscapeKeyDown:i,onPointerDownOutside:g,onFocusOutside:x,onDismiss:()=>A.onOpenChange(!1),children:m.jsx(ok,{"data-state":Oce(A.open),role:"dialog",id:A.contentId,...C,...E,ref:t,style:{...E.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Cce="PopoverClose",IQe=G.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=ug(Cce,r);return m.jsx(bn.button,{type:"button",...n,ref:t,onClick:Rr(e.onClick,()=>o.onOpenChange(!1))})});IQe.displayName=Cce;var kQe="PopoverArrow",RQe=G.forwardRef((e,t)=>{const{__scopePopover:r,...n}=e,o=aA(r);return m.jsx(sk,{...o,...n,ref:t})});RQe.displayName=kQe;function Oce(e){return e?"open":"closed"}var jQe=bce,NQe=Ece,MQe=Tce,Ice=Ace;const LK=jQe,FK=NQe,sz=G.forwardRef(({className:e,align:t="center",sideOffset:r=4,...n},o)=>m.jsx(MQe,{children:m.jsx(Ice,{ref:o,align:t,sideOffset:r,className:_r("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n})}));sz.displayName=Ice.displayName;var kce={exports:{}};/*!
 * Quill Editor v1.3.7
 * https://quilljs.com/
 * Copyright (c) 2014, Jason Chen
 * Copyright (c) 2013, salesforce.com
 */(function(e,t){(function(n,o){e.exports=o()})(typeof self<"u"?self:mc,function(){return function(r){var n={};function o(l){if(n[l])return n[l].exports;var d=n[l]={i:l,l:!1,exports:{}};return r[l].call(d.exports,d,d.exports,o),d.l=!0,d.exports}return o.m=r,o.c=n,o.d=function(l,d,i){o.o(l,d)||Object.defineProperty(l,d,{configurable:!1,enumerable:!0,get:i})},o.n=function(l){var d=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(d,"a",d),d},o.o=function(l,d){return Object.prototype.hasOwnProperty.call(l,d)},o.p="",o(o.s=109)}([function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(17),d=o(18),i=o(19),g=o(45),x=o(46),S=o(47),E=o(48),A=o(49),C=o(12),N=o(32),k=o(33),R=o(31),L=o(1),j={Scope:L.Scope,create:L.create,find:L.find,query:L.query,register:L.register,Container:l.default,Format:d.default,Leaf:i.default,Embed:E.default,Scroll:g.default,Block:S.default,Inline:x.default,Text:A.default,Attributor:{Attribute:C.default,Class:N.default,Style:k.default,Store:R.default}};n.default=j},function(r,n,o){var l=this&&this.__extends||function(){var R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,j){L.__proto__=j}||function(L,j){for(var F in j)j.hasOwnProperty(F)&&(L[F]=j[F])};return function(L,j){R(L,j);function F(){this.constructor=L}L.prototype=j===null?Object.create(j):(F.prototype=j.prototype,new F)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=function(R){l(L,R);function L(j){var F=this;return j="[Parchment] "+j,F=R.call(this,j)||this,F.message=j,F.name=F.constructor.name,F}return L}(Error);n.ParchmentError=d;var i={},g={},x={},S={};n.DATA_KEY="__blot";var E;(function(R){R[R.TYPE=3]="TYPE",R[R.LEVEL=12]="LEVEL",R[R.ATTRIBUTE=13]="ATTRIBUTE",R[R.BLOT=14]="BLOT",R[R.INLINE=7]="INLINE",R[R.BLOCK=11]="BLOCK",R[R.BLOCK_BLOT=10]="BLOCK_BLOT",R[R.INLINE_BLOT=6]="INLINE_BLOT",R[R.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",R[R.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",R[R.ANY=15]="ANY"})(E=n.Scope||(n.Scope={}));function A(R,L){var j=N(R);if(j==null)throw new d("Unable to create "+R+" blot");var F=j,B=R instanceof Node||R.nodeType===Node.TEXT_NODE?R:F.create(L);return new F(B,L)}n.create=A;function C(R,L){return L===void 0&&(L=!1),R==null?null:R[n.DATA_KEY]!=null?R[n.DATA_KEY].blot:L?C(R.parentNode,L):null}n.find=C;function N(R,L){L===void 0&&(L=E.ANY);var j;if(typeof R=="string")j=S[R]||i[R];else if(R instanceof Text||R.nodeType===Node.TEXT_NODE)j=S.text;else if(typeof R=="number")R&E.LEVEL&E.BLOCK?j=S.block:R&E.LEVEL&E.INLINE&&(j=S.inline);else if(R instanceof HTMLElement){var F=(R.getAttribute("class")||"").split(/\s+/);for(var B in F)if(j=g[F[B]],j)break;j=j||x[R.tagName]}return j==null?null:L&E.LEVEL&j.scope&&L&E.TYPE&j.scope?j:null}n.query=N;function k(){for(var R=[],L=0;L<arguments.length;L++)R[L]=arguments[L];if(R.length>1)return R.map(function(B){return k(B)});var j=R[0];if(typeof j.blotName!="string"&&typeof j.attrName!="string")throw new d("Invalid definition");if(j.blotName==="abstract")throw new d("Cannot register abstract class");if(S[j.blotName||j.attrName]=j,typeof j.keyName=="string")i[j.keyName]=j;else if(j.className!=null&&(g[j.className]=j),j.tagName!=null){Array.isArray(j.tagName)?j.tagName=j.tagName.map(function(B){return B.toUpperCase()}):j.tagName=j.tagName.toUpperCase();var F=Array.isArray(j.tagName)?j.tagName:[j.tagName];F.forEach(function(B){(x[B]==null||j.className==null)&&(x[B]=j)})}return j}n.register=k},function(r,n,o){var l=o(51),d=o(11),i=o(3),g=o(20),x="\0",S=function(E){Array.isArray(E)?this.ops=E:E!=null&&Array.isArray(E.ops)?this.ops=E.ops:this.ops=[]};S.prototype.insert=function(E,A){var C={};return E.length===0?this:(C.insert=E,A!=null&&typeof A=="object"&&Object.keys(A).length>0&&(C.attributes=A),this.push(C))},S.prototype.delete=function(E){return E<=0?this:this.push({delete:E})},S.prototype.retain=function(E,A){if(E<=0)return this;var C={retain:E};return A!=null&&typeof A=="object"&&Object.keys(A).length>0&&(C.attributes=A),this.push(C)},S.prototype.push=function(E){var A=this.ops.length,C=this.ops[A-1];if(E=i(!0,{},E),typeof C=="object"){if(typeof E.delete=="number"&&typeof C.delete=="number")return this.ops[A-1]={delete:C.delete+E.delete},this;if(typeof C.delete=="number"&&E.insert!=null&&(A-=1,C=this.ops[A-1],typeof C!="object"))return this.ops.unshift(E),this;if(d(E.attributes,C.attributes)){if(typeof E.insert=="string"&&typeof C.insert=="string")return this.ops[A-1]={insert:C.insert+E.insert},typeof E.attributes=="object"&&(this.ops[A-1].attributes=E.attributes),this;if(typeof E.retain=="number"&&typeof C.retain=="number")return this.ops[A-1]={retain:C.retain+E.retain},typeof E.attributes=="object"&&(this.ops[A-1].attributes=E.attributes),this}}return A===this.ops.length?this.ops.push(E):this.ops.splice(A,0,E),this},S.prototype.chop=function(){var E=this.ops[this.ops.length-1];return E&&E.retain&&!E.attributes&&this.ops.pop(),this},S.prototype.filter=function(E){return this.ops.filter(E)},S.prototype.forEach=function(E){this.ops.forEach(E)},S.prototype.map=function(E){return this.ops.map(E)},S.prototype.partition=function(E){var A=[],C=[];return this.forEach(function(N){var k=E(N)?A:C;k.push(N)}),[A,C]},S.prototype.reduce=function(E,A){return this.ops.reduce(E,A)},S.prototype.changeLength=function(){return this.reduce(function(E,A){return A.insert?E+g.length(A):A.delete?E-A.delete:E},0)},S.prototype.length=function(){return this.reduce(function(E,A){return E+g.length(A)},0)},S.prototype.slice=function(E,A){E=E||0,typeof A!="number"&&(A=1/0);for(var C=[],N=g.iterator(this.ops),k=0;k<A&&N.hasNext();){var R;k<E?R=N.next(E-k):(R=N.next(A-k),C.push(R)),k+=g.length(R)}return new S(C)},S.prototype.compose=function(E){var A=g.iterator(this.ops),C=g.iterator(E.ops),N=[],k=C.peek();if(k!=null&&typeof k.retain=="number"&&k.attributes==null){for(var R=k.retain;A.peekType()==="insert"&&A.peekLength()<=R;)R-=A.peekLength(),N.push(A.next());k.retain-R>0&&C.next(k.retain-R)}for(var L=new S(N);A.hasNext()||C.hasNext();)if(C.peekType()==="insert")L.push(C.next());else if(A.peekType()==="delete")L.push(A.next());else{var j=Math.min(A.peekLength(),C.peekLength()),F=A.next(j),B=C.next(j);if(typeof B.retain=="number"){var U={};typeof F.retain=="number"?U.retain=j:U.insert=F.insert;var Z=g.attributes.compose(F.attributes,B.attributes,typeof F.retain=="number");if(Z&&(U.attributes=Z),L.push(U),!C.hasNext()&&d(L.ops[L.ops.length-1],U)){var X=new S(A.rest());return L.concat(X).chop()}}else typeof B.delete=="number"&&typeof F.retain=="number"&&L.push(B)}return L.chop()},S.prototype.concat=function(E){var A=new S(this.ops.slice());return E.ops.length>0&&(A.push(E.ops[0]),A.ops=A.ops.concat(E.ops.slice(1))),A},S.prototype.diff=function(E,A){if(this.ops===E.ops)return new S;var C=[this,E].map(function(j){return j.map(function(F){if(F.insert!=null)return typeof F.insert=="string"?F.insert:x;var B=j===E?"on":"with";throw new Error("diff() called "+B+" non-document")}).join("")}),N=new S,k=l(C[0],C[1],A),R=g.iterator(this.ops),L=g.iterator(E.ops);return k.forEach(function(j){for(var F=j[1].length;F>0;){var B=0;switch(j[0]){case l.INSERT:B=Math.min(L.peekLength(),F),N.push(L.next(B));break;case l.DELETE:B=Math.min(F,R.peekLength()),R.next(B),N.delete(B);break;case l.EQUAL:B=Math.min(R.peekLength(),L.peekLength(),F);var U=R.next(B),Z=L.next(B);d(U.insert,Z.insert)?N.retain(B,g.attributes.diff(U.attributes,Z.attributes)):N.push(Z).delete(B);break}F-=B}}),N.chop()},S.prototype.eachLine=function(E,A){A=A||`
`;for(var C=g.iterator(this.ops),N=new S,k=0;C.hasNext();){if(C.peekType()!=="insert")return;var R=C.peek(),L=g.length(R)-C.peekLength(),j=typeof R.insert=="string"?R.insert.indexOf(A,L)-L:-1;if(j<0)N.push(C.next());else if(j>0)N.push(C.next(j));else{if(E(N,C.next(1).attributes||{},k)===!1)return;k+=1,N=new S}}N.length()>0&&E(N,{},k)},S.prototype.transform=function(E,A){if(A=!!A,typeof E=="number")return this.transformPosition(E,A);for(var C=g.iterator(this.ops),N=g.iterator(E.ops),k=new S;C.hasNext()||N.hasNext();)if(C.peekType()==="insert"&&(A||N.peekType()!=="insert"))k.retain(g.length(C.next()));else if(N.peekType()==="insert")k.push(N.next());else{var R=Math.min(C.peekLength(),N.peekLength()),L=C.next(R),j=N.next(R);if(L.delete)continue;j.delete?k.push(j):k.retain(R,g.attributes.transform(L.attributes,j.attributes,A))}return k.chop()},S.prototype.transformPosition=function(E,A){A=!!A;for(var C=g.iterator(this.ops),N=0;C.hasNext()&&N<=E;){var k=C.peekLength(),R=C.peekType();if(C.next(),R==="delete"){E-=Math.min(k,E-N);continue}else R==="insert"&&(N<E||!A)&&(E+=k);N+=k}return E},r.exports=S},function(r,n){var o=Object.prototype.hasOwnProperty,l=Object.prototype.toString,d=Object.defineProperty,i=Object.getOwnPropertyDescriptor,g=function(C){return typeof Array.isArray=="function"?Array.isArray(C):l.call(C)==="[object Array]"},x=function(C){if(!C||l.call(C)!=="[object Object]")return!1;var N=o.call(C,"constructor"),k=C.constructor&&C.constructor.prototype&&o.call(C.constructor.prototype,"isPrototypeOf");if(C.constructor&&!N&&!k)return!1;var R;for(R in C);return typeof R>"u"||o.call(C,R)},S=function(C,N){d&&N.name==="__proto__"?d(C,N.name,{enumerable:!0,configurable:!0,value:N.newValue,writable:!0}):C[N.name]=N.newValue},E=function(C,N){if(N==="__proto__")if(o.call(C,N)){if(i)return i(C,N).value}else return;return C[N]};r.exports=function A(){var C,N,k,R,L,j,F=arguments[0],B=1,U=arguments.length,Z=!1;for(typeof F=="boolean"&&(Z=F,F=arguments[1]||{},B=2),(F==null||typeof F!="object"&&typeof F!="function")&&(F={});B<U;++B)if(C=arguments[B],C!=null)for(N in C)k=E(F,N),R=E(C,N),F!==R&&(Z&&R&&(x(R)||(L=g(R)))?(L?(L=!1,j=k&&g(k)?k:[]):j=k&&x(k)?k:{},S(F,{name:N,newValue:A(Z,j,R)})):typeof R<"u"&&S(F,{name:N,newValue:R}));return F}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BlockEmbed=n.bubbleFormats=void 0;var l=function(){function ne(ee,ie){for(var he=0;he<ie.length;he++){var Se=ie[he];Se.enumerable=Se.enumerable||!1,Se.configurable=!0,"value"in Se&&(Se.writable=!0),Object.defineProperty(ee,Se.key,Se)}}return function(ee,ie,he){return ie&&ne(ee.prototype,ie),he&&ne(ee,he),ee}}(),d=function ne(ee,ie,he){ee===null&&(ee=Function.prototype);var Se=Object.getOwnPropertyDescriptor(ee,ie);if(Se===void 0){var Ce=Object.getPrototypeOf(ee);return Ce===null?void 0:ne(Ce,ie,he)}else{if("value"in Se)return Se.value;var fe=Se.get;return fe===void 0?void 0:fe.call(he)}},i=o(3),g=F(i),x=o(2),S=F(x),E=o(0),A=F(E),C=o(16),N=F(C),k=o(6),R=F(k),L=o(7),j=F(L);function F(ne){return ne&&ne.__esModule?ne:{default:ne}}function B(ne,ee){if(!(ne instanceof ee))throw new TypeError("Cannot call a class as a function")}function U(ne,ee){if(!ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:ne}function Z(ne,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);ne.prototype=Object.create(ee&&ee.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(ne,ee):ne.__proto__=ee)}var X=1,te=function(ne){Z(ee,ne);function ee(){return B(this,ee),U(this,(ee.__proto__||Object.getPrototypeOf(ee)).apply(this,arguments))}return l(ee,[{key:"attach",value:function(){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"attach",this).call(this),this.attributes=new A.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return new S.default().insert(this.value(),(0,g.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(he,Se){var Ce=A.default.query(he,A.default.Scope.BLOCK_ATTRIBUTE);Ce!=null&&this.attributes.attribute(Ce,Se)}},{key:"formatAt",value:function(he,Se,Ce,fe){this.format(Ce,fe)}},{key:"insertAt",value:function(he,Se,Ce){if(typeof Se=="string"&&Se.endsWith(`
`)){var fe=A.default.create(se.blotName);this.parent.insertBefore(fe,he===0?this:this.next),fe.insertAt(0,Se.slice(0,-1))}else d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,he,Se,Ce)}}]),ee}(A.default.Embed);te.scope=A.default.Scope.BLOCK_BLOT;var se=function(ne){Z(ee,ne);function ee(ie){B(this,ee);var he=U(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ie));return he.cache={},he}return l(ee,[{key:"delta",value:function(){return this.cache.delta==null&&(this.cache.delta=this.descendants(A.default.Leaf).reduce(function(he,Se){return Se.length()===0?he:he.insert(Se.value(),oe(Se))},new S.default).insert(`
`,oe(this))),this.cache.delta}},{key:"deleteAt",value:function(he,Se){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"deleteAt",this).call(this,he,Se),this.cache={}}},{key:"formatAt",value:function(he,Se,Ce,fe){Se<=0||(A.default.query(Ce,A.default.Scope.BLOCK)?he+Se===this.length()&&this.format(Ce,fe):d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"formatAt",this).call(this,he,Math.min(Se,this.length()-he-1),Ce,fe),this.cache={})}},{key:"insertAt",value:function(he,Se,Ce){if(Ce!=null)return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,he,Se,Ce);if(Se.length!==0){var fe=Se.split(`
`),_e=fe.shift();_e.length>0&&(he<this.length()-1||this.children.tail==null?d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertAt",this).call(this,Math.min(he,this.length()-1),_e):this.children.tail.insertAt(this.children.tail.length(),_e),this.cache={});var be=this;fe.reduce(function(Pe,ye){return be=be.split(Pe,!0),be.insertAt(0,ye),ye.length},he+_e.length)}}},{key:"insertBefore",value:function(he,Se){var Ce=this.children.head;d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"insertBefore",this).call(this,he,Se),Ce instanceof N.default&&Ce.remove(),this.cache={}}},{key:"length",value:function(){return this.cache.length==null&&(this.cache.length=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"length",this).call(this)+X),this.cache.length}},{key:"moveChildren",value:function(he,Se){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"moveChildren",this).call(this,he,Se),this.cache={}}},{key:"optimize",value:function(he){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"optimize",this).call(this,he),this.cache={}}},{key:"path",value:function(he){return d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"path",this).call(this,he,!0)}},{key:"removeChild",value:function(he){d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"removeChild",this).call(this,he),this.cache={}}},{key:"split",value:function(he){var Se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Se&&(he===0||he>=this.length()-X)){var Ce=this.clone();return he===0?(this.parent.insertBefore(Ce,this),this):(this.parent.insertBefore(Ce,this.next),Ce)}else{var fe=d(ee.prototype.__proto__||Object.getPrototypeOf(ee.prototype),"split",this).call(this,he,Se);return this.cache={},fe}}}]),ee}(A.default.Block);se.blotName="block",se.tagName="P",se.defaultChild="break",se.allowedChildren=[R.default,A.default.Embed,j.default];function oe(ne){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ne==null||(typeof ne.formats=="function"&&(ee=(0,g.default)(ee,ne.formats())),ne.parent==null||ne.parent.blotName=="scroll"||ne.parent.statics.scope!==ne.statics.scope)?ee:oe(ne.parent,ee)}n.bubbleFormats=oe,n.BlockEmbed=te,n.default=se},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.overload=n.expandConfig=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(be){return typeof be}:function(be){return be&&typeof Symbol=="function"&&be.constructor===Symbol&&be!==Symbol.prototype?"symbol":typeof be},d=function(){function be(Pe,ye){var ge=[],ke=!0,Qe=!1,He=void 0;try{for(var $e=Pe[Symbol.iterator](),Xe;!(ke=(Xe=$e.next()).done)&&(ge.push(Xe.value),!(ye&&ge.length===ye));ke=!0);}catch(ft){Qe=!0,He=ft}finally{try{!ke&&$e.return&&$e.return()}finally{if(Qe)throw He}}return ge}return function(Pe,ye){if(Array.isArray(Pe))return Pe;if(Symbol.iterator in Object(Pe))return be(Pe,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function be(Pe,ye){for(var ge=0;ge<ye.length;ge++){var ke=ye[ge];ke.enumerable=ke.enumerable||!1,ke.configurable=!0,"value"in ke&&(ke.writable=!0),Object.defineProperty(Pe,ke.key,ke)}}return function(Pe,ye,ge){return ye&&be(Pe.prototype,ye),ge&&be(Pe,ge),Pe}}();o(50);var g=o(2),x=oe(g),S=o(14),E=oe(S),A=o(8),C=oe(A),N=o(9),k=oe(N),R=o(0),L=oe(R),j=o(15),F=oe(j),B=o(3),U=oe(B),Z=o(10),X=oe(Z),te=o(34),se=oe(te);function oe(be){return be&&be.__esModule?be:{default:be}}function ne(be,Pe,ye){return Pe in be?Object.defineProperty(be,Pe,{value:ye,enumerable:!0,configurable:!0,writable:!0}):be[Pe]=ye,be}function ee(be,Pe){if(!(be instanceof Pe))throw new TypeError("Cannot call a class as a function")}var ie=(0,X.default)("quill"),he=function(){i(be,null,[{key:"debug",value:function(ye){ye===!0&&(ye="log"),X.default.level(ye)}},{key:"find",value:function(ye){return ye.__quill||L.default.find(ye)}},{key:"import",value:function(ye){return this.imports[ye]==null&&ie.error("Cannot import "+ye+". Are you sure it was registered?"),this.imports[ye]}},{key:"register",value:function(ye,ge){var ke=this,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(typeof ye!="string"){var He=ye.attrName||ye.blotName;typeof He=="string"?this.register("formats/"+He,ye,ge):Object.keys(ye).forEach(function($e){ke.register($e,ye[$e],ge)})}else this.imports[ye]!=null&&!Qe&&ie.warn("Overwriting "+ye+" with",ge),this.imports[ye]=ge,(ye.startsWith("blots/")||ye.startsWith("formats/"))&&ge.blotName!=="abstract"?L.default.register(ge):ye.startsWith("modules")&&typeof ge.register=="function"&&ge.register()}}]);function be(Pe){var ye=this,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ee(this,be),this.options=Se(Pe,ge),this.container=this.options.container,this.container==null)return ie.error("Invalid Quill container",Pe);this.options.debug&&be.debug(this.options.debug);var ke=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new C.default,this.scroll=L.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new E.default(this.scroll),this.selection=new F.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(C.default.events.EDITOR_CHANGE,function(He){He===C.default.events.TEXT_CHANGE&&ye.root.classList.toggle("ql-blank",ye.editor.isBlank())}),this.emitter.on(C.default.events.SCROLL_UPDATE,function(He,$e){var Xe=ye.selection.lastRange,ft=Xe&&Xe.length===0?Xe.index:void 0;Ce.call(ye,function(){return ye.editor.update(null,$e,ft)},He)});var Qe=this.clipboard.convert(`<div class='ql-editor' style="white-space: normal;">`+ke+"<p><br></p></div>");this.setContents(Qe),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return i(be,[{key:"addContainer",value:function(ye){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof ye=="string"){var ke=ye;ye=document.createElement("div"),ye.classList.add(ke)}return this.container.insertBefore(ye,ge),ye}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(ye,ge,ke){var Qe=this,He=fe(ye,ge,ke),$e=d(He,4);return ye=$e[0],ge=$e[1],ke=$e[3],Ce.call(this,function(){return Qe.editor.deleteText(ye,ge)},ke,ye,-1*ge)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(ye),this.container.classList.toggle("ql-disabled",!ye)}},{key:"focus",value:function(){var ye=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=ye,this.scrollIntoView()}},{key:"format",value:function(ye,ge){var ke=this,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:C.default.sources.API;return Ce.call(this,function(){var He=ke.getSelection(!0),$e=new x.default;if(He==null)return $e;if(L.default.query(ye,L.default.Scope.BLOCK))$e=ke.editor.formatLine(He.index,He.length,ne({},ye,ge));else{if(He.length===0)return ke.selection.format(ye,ge),$e;$e=ke.editor.formatText(He.index,He.length,ne({},ye,ge))}return ke.setSelection(He,C.default.sources.SILENT),$e},Qe)}},{key:"formatLine",value:function(ye,ge,ke,Qe,He){var $e=this,Xe=void 0,ft=fe(ye,ge,ke,Qe,He),ze=d(ft,4);return ye=ze[0],ge=ze[1],Xe=ze[2],He=ze[3],Ce.call(this,function(){return $e.editor.formatLine(ye,ge,Xe)},He,ye,0)}},{key:"formatText",value:function(ye,ge,ke,Qe,He){var $e=this,Xe=void 0,ft=fe(ye,ge,ke,Qe,He),ze=d(ft,4);return ye=ze[0],ge=ze[1],Xe=ze[2],He=ze[3],Ce.call(this,function(){return $e.editor.formatText(ye,ge,Xe)},He,ye,0)}},{key:"getBounds",value:function(ye){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ke=void 0;typeof ye=="number"?ke=this.selection.getBounds(ye,ge):ke=this.selection.getBounds(ye.index,ye.length);var Qe=this.container.getBoundingClientRect();return{bottom:ke.bottom-Qe.top,height:ke.height,left:ke.left-Qe.left,right:ke.right-Qe.left,top:ke.top-Qe.top,width:ke.width}}},{key:"getContents",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ye,ke=fe(ye,ge),Qe=d(ke,2);return ye=Qe[0],ge=Qe[1],this.editor.getContents(ye,ge)}},{key:"getFormat",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof ye=="number"?this.editor.getFormat(ye,ge):this.editor.getFormat(ye.index,ye.length)}},{key:"getIndex",value:function(ye){return ye.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(ye){return this.scroll.leaf(ye)}},{key:"getLine",value:function(ye){return this.scroll.line(ye)}},{key:"getLines",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof ye!="number"?this.scroll.lines(ye.index,ye.length):this.scroll.lines(ye,ge)}},{key:"getModule",value:function(ye){return this.theme.modules[ye]}},{key:"getSelection",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return ye&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-ye,ke=fe(ye,ge),Qe=d(ke,2);return ye=Qe[0],ge=Qe[1],this.editor.getText(ye,ge)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(ye,ge,ke){var Qe=this,He=arguments.length>3&&arguments[3]!==void 0?arguments[3]:be.sources.API;return Ce.call(this,function(){return Qe.editor.insertEmbed(ye,ge,ke)},He,ye)}},{key:"insertText",value:function(ye,ge,ke,Qe,He){var $e=this,Xe=void 0,ft=fe(ye,0,ke,Qe,He),ze=d(ft,4);return ye=ze[0],Xe=ze[2],He=ze[3],Ce.call(this,function(){return $e.editor.insertText(ye,ge,Xe)},He,ye,ge.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(ye,ge,ke){this.clipboard.dangerouslyPasteHTML(ye,ge,ke)}},{key:"removeFormat",value:function(ye,ge,ke){var Qe=this,He=fe(ye,ge,ke),$e=d(He,4);return ye=$e[0],ge=$e[1],ke=$e[3],Ce.call(this,function(){return Qe.editor.removeFormat(ye,ge)},ke,ye)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(ye){var ge=this,ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API;return Ce.call(this,function(){ye=new x.default(ye);var Qe=ge.getLength(),He=ge.editor.deleteText(0,Qe),$e=ge.editor.applyDelta(ye),Xe=$e.ops[$e.ops.length-1];Xe!=null&&typeof Xe.insert=="string"&&Xe.insert[Xe.insert.length-1]===`
`&&(ge.editor.deleteText(ge.getLength()-1,1),$e.delete(1));var ft=He.compose($e);return ft},ke)}},{key:"setSelection",value:function(ye,ge,ke){if(ye==null)this.selection.setRange(null,ge||be.sources.API);else{var Qe=fe(ye,ge,ke),He=d(Qe,4);ye=He[0],ge=He[1],ke=He[3],this.selection.setRange(new j.Range(ye,ge),ke),ke!==C.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(ye){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API,ke=new x.default().insert(ye);return this.setContents(ke,ge)}},{key:"update",value:function(){var ye=arguments.length>0&&arguments[0]!==void 0?arguments[0]:C.default.sources.USER,ge=this.scroll.update(ye);return this.selection.update(ye),ge}},{key:"updateContents",value:function(ye){var ge=this,ke=arguments.length>1&&arguments[1]!==void 0?arguments[1]:C.default.sources.API;return Ce.call(this,function(){return ye=new x.default(ye),ge.editor.applyDelta(ye,ke)},ke,!0)}}]),be}();he.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},he.events=C.default.events,he.sources=C.default.sources,he.version="1.3.7",he.imports={delta:x.default,parchment:L.default,"core/module":k.default,"core/theme":se.default};function Se(be,Pe){if(Pe=(0,U.default)(!0,{container:be,modules:{clipboard:!0,keyboard:!0,history:!0}},Pe),!Pe.theme||Pe.theme===he.DEFAULTS.theme)Pe.theme=se.default;else if(Pe.theme=he.import("themes/"+Pe.theme),Pe.theme==null)throw new Error("Invalid theme "+Pe.theme+". Did you register it?");var ye=(0,U.default)(!0,{},Pe.theme.DEFAULTS);[ye,Pe].forEach(function(Qe){Qe.modules=Qe.modules||{},Object.keys(Qe.modules).forEach(function(He){Qe.modules[He]===!0&&(Qe.modules[He]={})})});var ge=Object.keys(ye.modules).concat(Object.keys(Pe.modules)),ke=ge.reduce(function(Qe,He){var $e=he.import("modules/"+He);return $e==null?ie.error("Cannot load "+He+" module. Are you sure you registered it?"):Qe[He]=$e.DEFAULTS||{},Qe},{});return Pe.modules!=null&&Pe.modules.toolbar&&Pe.modules.toolbar.constructor!==Object&&(Pe.modules.toolbar={container:Pe.modules.toolbar}),Pe=(0,U.default)(!0,{},he.DEFAULTS,{modules:ke},ye,Pe),["bounds","container","scrollingContainer"].forEach(function(Qe){typeof Pe[Qe]=="string"&&(Pe[Qe]=document.querySelector(Pe[Qe]))}),Pe.modules=Object.keys(Pe.modules).reduce(function(Qe,He){return Pe.modules[He]&&(Qe[He]=Pe.modules[He]),Qe},{}),Pe}function Ce(be,Pe,ye,ge){if(this.options.strict&&!this.isEnabled()&&Pe===C.default.sources.USER)return new x.default;var ke=ye==null?null:this.getSelection(),Qe=this.editor.delta,He=be();if(ke!=null&&(ye===!0&&(ye=ke.index),ge==null?ke=_e(ke,He,Pe):ge!==0&&(ke=_e(ke,ye,ge,Pe)),this.setSelection(ke,C.default.sources.SILENT)),He.length()>0){var $e,Xe=[C.default.events.TEXT_CHANGE,He,Qe,Pe];if(($e=this.emitter).emit.apply($e,[C.default.events.EDITOR_CHANGE].concat(Xe)),Pe!==C.default.sources.SILENT){var ft;(ft=this.emitter).emit.apply(ft,Xe)}}return He}function fe(be,Pe,ye,ge,ke){var Qe={};return typeof be.index=="number"&&typeof be.length=="number"?typeof Pe!="number"?(ke=ge,ge=ye,ye=Pe,Pe=be.length,be=be.index):(Pe=be.length,be=be.index):typeof Pe!="number"&&(ke=ge,ge=ye,ye=Pe,Pe=0),(typeof ye>"u"?"undefined":l(ye))==="object"?(Qe=ye,ke=ge):typeof ye=="string"&&(ge!=null?Qe[ye]=ge:ke=ye),ke=ke||C.default.sources.API,[be,Pe,Qe,ke]}function _e(be,Pe,ye,ge){if(be==null)return null;var ke=void 0,Qe=void 0;if(Pe instanceof x.default){var He=[be.index,be.index+be.length].map(function(ze){return Pe.transformPosition(ze,ge!==C.default.sources.USER)}),$e=d(He,2);ke=$e[0],Qe=$e[1]}else{var Xe=[be.index,be.index+be.length].map(function(ze){return ze<Pe||ze===Pe&&ge===C.default.sources.USER?ze:ye>=0?ze+ye:Math.max(Pe,ze+ye)}),ft=d(Xe,2);ke=ft[0],Qe=ft[1]}return new j.Range(ke,Qe-ke)}n.expandConfig=Se,n.overload=fe,n.default=he},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function R(L,j){for(var F=0;F<j.length;F++){var B=j[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,j,F){return j&&R(L.prototype,j),F&&R(L,F),L}}(),d=function R(L,j,F){L===null&&(L=Function.prototype);var B=Object.getOwnPropertyDescriptor(L,j);if(B===void 0){var U=Object.getPrototypeOf(L);return U===null?void 0:R(U,j,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(7),g=E(i),x=o(0),S=E(x);function E(R){return R&&R.__esModule?R:{default:R}}function A(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}function C(R,L){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L&&(typeof L=="object"||typeof L=="function")?L:R}function N(R,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);R.prototype=Object.create(L&&L.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(R,L):R.__proto__=L)}var k=function(R){N(L,R);function L(){return A(this,L),C(this,(L.__proto__||Object.getPrototypeOf(L)).apply(this,arguments))}return l(L,[{key:"formatAt",value:function(F,B,U,Z){if(L.compare(this.statics.blotName,U)<0&&S.default.query(U,S.default.Scope.BLOT)){var X=this.isolate(F,B);Z&&X.wrap(U,Z)}else d(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"formatAt",this).call(this,F,B,U,Z)}},{key:"optimize",value:function(F){if(d(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"optimize",this).call(this,F),this.parent instanceof L&&L.compare(this.statics.blotName,this.parent.statics.blotName)>0){var B=this.parent.isolate(this.offset(),this.length());this.moveChildren(B),B.wrap(this)}}}],[{key:"compare",value:function(F,B){var U=L.order.indexOf(F),Z=L.order.indexOf(B);return U>=0||Z>=0?U-Z:F===B?0:F<B?-1:1}}]),L}(S.default.Inline);k.allowedChildren=[k,S.default.Embed,g.default],k.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],n.default=k},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}function g(A,C){if(!(A instanceof C))throw new TypeError("Cannot call a class as a function")}function x(A,C){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:A}function S(A,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);A.prototype=Object.create(C&&C.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(A,C):A.__proto__=C)}var E=function(A){S(C,A);function C(){return g(this,C),x(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default.Text);n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function j(F,B){for(var U=0;U<B.length;U++){var Z=B[U];Z.enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&(Z.writable=!0),Object.defineProperty(F,Z.key,Z)}}return function(F,B,U){return B&&j(F.prototype,B),U&&j(F,U),F}}(),d=function j(F,B,U){F===null&&(F=Function.prototype);var Z=Object.getOwnPropertyDescriptor(F,B);if(Z===void 0){var X=Object.getPrototypeOf(F);return X===null?void 0:j(X,B,U)}else{if("value"in Z)return Z.value;var te=Z.get;return te===void 0?void 0:te.call(U)}},i=o(54),g=E(i),x=o(10),S=E(x);function E(j){return j&&j.__esModule?j:{default:j}}function A(j,F){if(!(j instanceof F))throw new TypeError("Cannot call a class as a function")}function C(j,F){if(!j)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return F&&(typeof F=="object"||typeof F=="function")?F:j}function N(j,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof F);j.prototype=Object.create(F&&F.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}),F&&(Object.setPrototypeOf?Object.setPrototypeOf(j,F):j.__proto__=F)}var k=(0,S.default)("quill:events"),R=["selectionchange","mousedown","mouseup","click"];R.forEach(function(j){document.addEventListener(j,function(){for(var F=arguments.length,B=Array(F),U=0;U<F;U++)B[U]=arguments[U];[].slice.call(document.querySelectorAll(".ql-container")).forEach(function(Z){if(Z.__quill&&Z.__quill.emitter){var X;(X=Z.__quill.emitter).handleDOM.apply(X,B)}})})});var L=function(j){N(F,j);function F(){A(this,F);var B=C(this,(F.__proto__||Object.getPrototypeOf(F)).call(this));return B.listeners={},B.on("error",k.error),B}return l(F,[{key:"emit",value:function(){k.log.apply(k,arguments),d(F.prototype.__proto__||Object.getPrototypeOf(F.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(U){for(var Z=arguments.length,X=Array(Z>1?Z-1:0),te=1;te<Z;te++)X[te-1]=arguments[te];(this.listeners[U.type]||[]).forEach(function(se){var oe=se.node,ne=se.handler;(U.target===oe||oe.contains(U.target))&&ne.apply(void 0,[U].concat(X))})}},{key:"listenDOM",value:function(U,Z,X){this.listeners[U]||(this.listeners[U]=[]),this.listeners[U].push({node:Z,handler:X})}}]),F}(g.default);L.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},L.sources={API:"api",SILENT:"silent",USER:"user"},n.default=L},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});function l(i,g){if(!(i instanceof g))throw new TypeError("Cannot call a class as a function")}var d=function i(g){var x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};l(this,i),this.quill=g,this.options=x};d.DEFAULTS={},n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=["error","warn","log","info"],d="warn";function i(x){if(l.indexOf(x)<=l.indexOf(d)){for(var S,E=arguments.length,A=Array(E>1?E-1:0),C=1;C<E;C++)A[C-1]=arguments[C];(S=console)[x].apply(S,A)}}function g(x){return l.reduce(function(S,E){return S[E]=i.bind(console,E,x),S},{})}i.level=g.level=function(x){d=x},n.default=g},function(r,n,o){var l=Array.prototype.slice,d=o(52),i=o(53),g=r.exports=function(A,C,N){return N||(N={}),A===C?!0:A instanceof Date&&C instanceof Date?A.getTime()===C.getTime():!A||!C||typeof A!="object"&&typeof C!="object"?N.strict?A===C:A==C:E(A,C,N)};function x(A){return A==null}function S(A){return!(!A||typeof A!="object"||typeof A.length!="number"||typeof A.copy!="function"||typeof A.slice!="function"||A.length>0&&typeof A[0]!="number")}function E(A,C,N){var k,R;if(x(A)||x(C)||A.prototype!==C.prototype)return!1;if(i(A))return i(C)?(A=l.call(A),C=l.call(C),g(A,C,N)):!1;if(S(A)){if(!S(C)||A.length!==C.length)return!1;for(k=0;k<A.length;k++)if(A[k]!==C[k])return!1;return!0}try{var L=d(A),j=d(C)}catch{return!1}if(L.length!=j.length)return!1;for(L.sort(),j.sort(),k=L.length-1;k>=0;k--)if(L[k]!=j[k])return!1;for(k=L.length-1;k>=0;k--)if(R=L[k],!g(A[R],C[R],N))return!1;return typeof A==typeof C}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(1),d=function(){function i(g,x,S){S===void 0&&(S={}),this.attrName=g,this.keyName=x;var E=l.Scope.TYPE&l.Scope.ATTRIBUTE;S.scope!=null?this.scope=S.scope&l.Scope.LEVEL|E:this.scope=l.Scope.ATTRIBUTE,S.whitelist!=null&&(this.whitelist=S.whitelist)}return i.keys=function(g){return[].map.call(g.attributes,function(x){return x.name})},i.prototype.add=function(g,x){return this.canAdd(g,x)?(g.setAttribute(this.keyName,x),!0):!1},i.prototype.canAdd=function(g,x){var S=l.query(g,l.Scope.BLOT&(this.scope|l.Scope.TYPE));return S==null?!1:this.whitelist==null?!0:typeof x=="string"?this.whitelist.indexOf(x.replace(/["']/g,""))>-1:this.whitelist.indexOf(x)>-1},i.prototype.remove=function(g){g.removeAttribute(this.keyName)},i.prototype.value=function(g){var x=g.getAttribute(this.keyName);return this.canAdd(g,x)&&x?x:""},i}();n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Code=void 0;var l=function(){function te(se,oe){var ne=[],ee=!0,ie=!1,he=void 0;try{for(var Se=se[Symbol.iterator](),Ce;!(ee=(Ce=Se.next()).done)&&(ne.push(Ce.value),!(oe&&ne.length===oe));ee=!0);}catch(fe){ie=!0,he=fe}finally{try{!ee&&Se.return&&Se.return()}finally{if(ie)throw he}}return ne}return function(se,oe){if(Array.isArray(se))return se;if(Symbol.iterator in Object(se))return te(se,oe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(se,oe){for(var ne=0;ne<oe.length;ne++){var ee=oe[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(se,ee.key,ee)}}return function(se,oe,ne){return oe&&te(se.prototype,oe),ne&&te(se,ne),se}}(),i=function te(se,oe,ne){se===null&&(se=Function.prototype);var ee=Object.getOwnPropertyDescriptor(se,oe);if(ee===void 0){var ie=Object.getPrototypeOf(se);return ie===null?void 0:te(ie,oe,ne)}else{if("value"in ee)return ee.value;var he=ee.get;return he===void 0?void 0:he.call(ne)}},g=o(2),x=j(g),S=o(0),E=j(S),A=o(4),C=j(A),N=o(6),k=j(N),R=o(7),L=j(R);function j(te){return te&&te.__esModule?te:{default:te}}function F(te,se){if(!(te instanceof se))throw new TypeError("Cannot call a class as a function")}function B(te,se){if(!te)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return se&&(typeof se=="object"||typeof se=="function")?se:te}function U(te,se){if(typeof se!="function"&&se!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof se);te.prototype=Object.create(se&&se.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),se&&(Object.setPrototypeOf?Object.setPrototypeOf(te,se):te.__proto__=se)}var Z=function(te){U(se,te);function se(){return F(this,se),B(this,(se.__proto__||Object.getPrototypeOf(se)).apply(this,arguments))}return se}(k.default);Z.blotName="code",Z.tagName="CODE";var X=function(te){U(se,te);function se(){return F(this,se),B(this,(se.__proto__||Object.getPrototypeOf(se)).apply(this,arguments))}return d(se,[{key:"delta",value:function(){var ne=this,ee=this.domNode.textContent;return ee.endsWith(`
`)&&(ee=ee.slice(0,-1)),ee.split(`
`).reduce(function(ie,he){return ie.insert(he).insert(`
`,ne.formats())},new x.default)}},{key:"format",value:function(ne,ee){if(!(ne===this.statics.blotName&&ee)){var ie=this.descendant(L.default,this.length()-1),he=l(ie,1),Se=he[0];Se!=null&&Se.deleteAt(Se.length()-1,1),i(se.prototype.__proto__||Object.getPrototypeOf(se.prototype),"format",this).call(this,ne,ee)}}},{key:"formatAt",value:function(ne,ee,ie,he){if(ee!==0&&!(E.default.query(ie,E.default.Scope.BLOCK)==null||ie===this.statics.blotName&&he===this.statics.formats(this.domNode))){var Se=this.newlineIndex(ne);if(!(Se<0||Se>=ne+ee)){var Ce=this.newlineIndex(ne,!0)+1,fe=Se-Ce+1,_e=this.isolate(Ce,fe),be=_e.next;_e.format(ie,he),be instanceof se&&be.formatAt(0,ne-Ce+ee-fe,ie,he)}}}},{key:"insertAt",value:function(ne,ee,ie){if(ie==null){var he=this.descendant(L.default,ne),Se=l(he,2),Ce=Se[0],fe=Se[1];Ce.insertAt(fe,ee)}}},{key:"length",value:function(){var ne=this.domNode.textContent.length;return this.domNode.textContent.endsWith(`
`)?ne:ne+1}},{key:"newlineIndex",value:function(ne){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(ee)return this.domNode.textContent.slice(0,ne).lastIndexOf(`
`);var ie=this.domNode.textContent.slice(ne).indexOf(`
`);return ie>-1?ne+ie:-1}},{key:"optimize",value:function(ne){this.domNode.textContent.endsWith(`
`)||this.appendChild(E.default.create("text",`
`)),i(se.prototype.__proto__||Object.getPrototypeOf(se.prototype),"optimize",this).call(this,ne);var ee=this.next;ee!=null&&ee.prev===this&&ee.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===ee.statics.formats(ee.domNode)&&(ee.optimize(ne),ee.moveChildren(this),ee.remove())}},{key:"replace",value:function(ne){i(se.prototype.__proto__||Object.getPrototypeOf(se.prototype),"replace",this).call(this,ne),[].slice.call(this.domNode.querySelectorAll("*")).forEach(function(ee){var ie=E.default.find(ee);ie==null?ee.parentNode.removeChild(ee):ie instanceof E.default.Embed?ie.remove():ie.unwrap()})}}],[{key:"create",value:function(ne){var ee=i(se.__proto__||Object.getPrototypeOf(se),"create",this).call(this,ne);return ee.setAttribute("spellcheck",!1),ee}},{key:"formats",value:function(){return!0}}]),se}(C.default);X.blotName="code-block",X.tagName="PRE",X.TAB="  ",n.Code=Z,n.default=X},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(be){return typeof be}:function(be){return be&&typeof Symbol=="function"&&be.constructor===Symbol&&be!==Symbol.prototype?"symbol":typeof be},d=function(){function be(Pe,ye){var ge=[],ke=!0,Qe=!1,He=void 0;try{for(var $e=Pe[Symbol.iterator](),Xe;!(ke=(Xe=$e.next()).done)&&(ge.push(Xe.value),!(ye&&ge.length===ye));ke=!0);}catch(ft){Qe=!0,He=ft}finally{try{!ke&&$e.return&&$e.return()}finally{if(Qe)throw He}}return ge}return function(Pe,ye){if(Array.isArray(Pe))return Pe;if(Symbol.iterator in Object(Pe))return be(Pe,ye);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function be(Pe,ye){for(var ge=0;ge<ye.length;ge++){var ke=ye[ge];ke.enumerable=ke.enumerable||!1,ke.configurable=!0,"value"in ke&&(ke.writable=!0),Object.defineProperty(Pe,ke.key,ke)}}return function(Pe,ye,ge){return ye&&be(Pe.prototype,ye),ge&&be(Pe,ge),Pe}}(),g=o(2),x=ee(g),S=o(20),E=ee(S),A=o(0),C=ee(A),N=o(13),k=ee(N),R=o(24),L=ee(R),j=o(4),F=ee(j),B=o(16),U=ee(B),Z=o(21),X=ee(Z),te=o(11),se=ee(te),oe=o(3),ne=ee(oe);function ee(be){return be&&be.__esModule?be:{default:be}}function ie(be,Pe,ye){return Pe in be?Object.defineProperty(be,Pe,{value:ye,enumerable:!0,configurable:!0,writable:!0}):be[Pe]=ye,be}function he(be,Pe){if(!(be instanceof Pe))throw new TypeError("Cannot call a class as a function")}var Se=/^[ -~]*$/,Ce=function(){function be(Pe){he(this,be),this.scroll=Pe,this.delta=this.getDelta()}return i(be,[{key:"applyDelta",value:function(ye){var ge=this,ke=!1;this.scroll.update();var Qe=this.scroll.length();return this.scroll.batchStart(),ye=_e(ye),ye.reduce(function(He,$e){var Xe=$e.retain||$e.delete||$e.insert.length||1,ft=$e.attributes||{};if($e.insert!=null){if(typeof $e.insert=="string"){var ze=$e.insert;ze.endsWith(`
`)&&ke&&(ke=!1,ze=ze.slice(0,-1)),He>=Qe&&!ze.endsWith(`
`)&&(ke=!0),ge.scroll.insertAt(He,ze);var ut=ge.scroll.line(He),At=d(ut,2),xt=At[0],nr=At[1],Vt=(0,ne.default)({},(0,j.bubbleFormats)(xt));if(xt instanceof F.default){var dr=xt.descendant(C.default.Leaf,nr),Br=d(dr,1),Yr=Br[0];Vt=(0,ne.default)(Vt,(0,j.bubbleFormats)(Yr))}ft=E.default.attributes.diff(Vt,ft)||{}}else if(l($e.insert)==="object"){var _t=Object.keys($e.insert)[0];if(_t==null)return He;ge.scroll.insertAt(He,_t,$e.insert[_t])}Qe+=Xe}return Object.keys(ft).forEach(function(Mt){ge.scroll.formatAt(He,Xe,Mt,ft[Mt])}),He+Xe},0),ye.reduce(function(He,$e){return typeof $e.delete=="number"?(ge.scroll.deleteAt(He,$e.delete),He):He+($e.retain||$e.insert.length||1)},0),this.scroll.batchEnd(),this.update(ye)}},{key:"deleteText",value:function(ye,ge){return this.scroll.deleteAt(ye,ge),this.update(new x.default().retain(ye).delete(ge))}},{key:"formatLine",value:function(ye,ge){var ke=this,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.scroll.update(),Object.keys(Qe).forEach(function(He){if(!(ke.scroll.whitelist!=null&&!ke.scroll.whitelist[He])){var $e=ke.scroll.lines(ye,Math.max(ge,1)),Xe=ge;$e.forEach(function(ft){var ze=ft.length();if(!(ft instanceof k.default))ft.format(He,Qe[He]);else{var ut=ye-ft.offset(ke.scroll),At=ft.newlineIndex(ut+Xe)-ut+1;ft.formatAt(ut,At,He,Qe[He])}Xe-=ze})}}),this.scroll.optimize(),this.update(new x.default().retain(ye).retain(ge,(0,X.default)(Qe)))}},{key:"formatText",value:function(ye,ge){var ke=this,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return Object.keys(Qe).forEach(function(He){ke.scroll.formatAt(ye,ge,He,Qe[He])}),this.update(new x.default().retain(ye).retain(ge,(0,X.default)(Qe)))}},{key:"getContents",value:function(ye,ge){return this.delta.slice(ye,ye+ge)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce(function(ye,ge){return ye.concat(ge.delta())},new x.default)}},{key:"getFormat",value:function(ye){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ke=[],Qe=[];ge===0?this.scroll.path(ye).forEach(function($e){var Xe=d($e,1),ft=Xe[0];ft instanceof F.default?ke.push(ft):ft instanceof C.default.Leaf&&Qe.push(ft)}):(ke=this.scroll.lines(ye,ge),Qe=this.scroll.descendants(C.default.Leaf,ye,ge));var He=[ke,Qe].map(function($e){if($e.length===0)return{};for(var Xe=(0,j.bubbleFormats)($e.shift());Object.keys(Xe).length>0;){var ft=$e.shift();if(ft==null)return Xe;Xe=fe((0,j.bubbleFormats)(ft),Xe)}return Xe});return ne.default.apply(ne.default,He)}},{key:"getText",value:function(ye,ge){return this.getContents(ye,ge).filter(function(ke){return typeof ke.insert=="string"}).map(function(ke){return ke.insert}).join("")}},{key:"insertEmbed",value:function(ye,ge,ke){return this.scroll.insertAt(ye,ge,ke),this.update(new x.default().retain(ye).insert(ie({},ge,ke)))}},{key:"insertText",value:function(ye,ge){var ke=this,Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return ge=ge.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(ye,ge),Object.keys(Qe).forEach(function(He){ke.scroll.formatAt(ye,ge.length,He,Qe[He])}),this.update(new x.default().retain(ye).insert(ge,(0,X.default)(Qe)))}},{key:"isBlank",value:function(){if(this.scroll.children.length==0)return!0;if(this.scroll.children.length>1)return!1;var ye=this.scroll.children.head;return ye.statics.blotName!==F.default.blotName||ye.children.length>1?!1:ye.children.head instanceof U.default}},{key:"removeFormat",value:function(ye,ge){var ke=this.getText(ye,ge),Qe=this.scroll.line(ye+ge),He=d(Qe,2),$e=He[0],Xe=He[1],ft=0,ze=new x.default;$e!=null&&($e instanceof k.default?ft=$e.newlineIndex(Xe)-Xe+1:ft=$e.length()-Xe,ze=$e.delta().slice(Xe,Xe+ft-1).insert(`
`));var ut=this.getContents(ye,ge+ft),At=ut.diff(new x.default().insert(ke).concat(ze)),xt=new x.default().retain(ye).concat(At);return this.applyDelta(xt)}},{key:"update",value:function(ye){var ge=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],ke=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,Qe=this.delta;if(ge.length===1&&ge[0].type==="characterData"&&ge[0].target.data.match(Se)&&C.default.find(ge[0].target)){var He=C.default.find(ge[0].target),$e=(0,j.bubbleFormats)(He),Xe=He.offset(this.scroll),ft=ge[0].oldValue.replace(L.default.CONTENTS,""),ze=new x.default().insert(ft),ut=new x.default().insert(He.value()),At=new x.default().retain(Xe).concat(ze.diff(ut,ke));ye=At.reduce(function(xt,nr){return nr.insert?xt.insert(nr.insert,$e):xt.push(nr)},new x.default),this.delta=Qe.compose(ye)}else this.delta=this.getDelta(),(!ye||!(0,se.default)(Qe.compose(ye),this.delta))&&(ye=Qe.diff(this.delta,ke));return ye}}]),be}();function fe(be,Pe){return Object.keys(Pe).reduce(function(ye,ge){return be[ge]==null||(Pe[ge]===be[ge]?ye[ge]=Pe[ge]:Array.isArray(Pe[ge])?Pe[ge].indexOf(be[ge])<0&&(ye[ge]=Pe[ge].concat([be[ge]])):ye[ge]=[Pe[ge],be[ge]]),ye},{})}function _e(be){return be.reduce(function(Pe,ye){if(ye.insert===1){var ge=(0,X.default)(ye.attributes);return delete ge.image,Pe.insert({image:ye.attributes.image},ge)}if(ye.attributes!=null&&(ye.attributes.list===!0||ye.attributes.bullet===!0)&&(ye=(0,X.default)(ye),ye.attributes.list?ye.attributes.list="ordered":(ye.attributes.list="bullet",delete ye.attributes.bullet)),typeof ye.insert=="string"){var ke=ye.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return Pe.insert(ke,ye.attributes)}return Pe.push(ye)},new x.default)}n.default=Ce},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.Range=void 0;var l=function(){function te(se,oe){var ne=[],ee=!0,ie=!1,he=void 0;try{for(var Se=se[Symbol.iterator](),Ce;!(ee=(Ce=Se.next()).done)&&(ne.push(Ce.value),!(oe&&ne.length===oe));ee=!0);}catch(fe){ie=!0,he=fe}finally{try{!ee&&Se.return&&Se.return()}finally{if(ie)throw he}}return ne}return function(se,oe){if(Array.isArray(se))return se;if(Symbol.iterator in Object(se))return te(se,oe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function te(se,oe){for(var ne=0;ne<oe.length;ne++){var ee=oe[ne];ee.enumerable=ee.enumerable||!1,ee.configurable=!0,"value"in ee&&(ee.writable=!0),Object.defineProperty(se,ee.key,ee)}}return function(se,oe,ne){return oe&&te(se.prototype,oe),ne&&te(se,ne),se}}(),i=o(0),g=L(i),x=o(21),S=L(x),E=o(11),A=L(E),C=o(8),N=L(C),k=o(10),R=L(k);function L(te){return te&&te.__esModule?te:{default:te}}function j(te){if(Array.isArray(te)){for(var se=0,oe=Array(te.length);se<te.length;se++)oe[se]=te[se];return oe}else return Array.from(te)}function F(te,se){if(!(te instanceof se))throw new TypeError("Cannot call a class as a function")}var B=(0,R.default)("quill:selection"),U=function te(se){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;F(this,te),this.index=se,this.length=oe},Z=function(){function te(se,oe){var ne=this;F(this,te),this.emitter=oe,this.scroll=se,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=g.default.create("cursor",this),this.lastRange=this.savedRange=new U(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,function(){ne.mouseDown||setTimeout(ne.update.bind(ne,N.default.sources.USER),1)}),this.emitter.on(N.default.events.EDITOR_CHANGE,function(ee,ie){ee===N.default.events.TEXT_CHANGE&&ie.length()>0&&ne.update(N.default.sources.SILENT)}),this.emitter.on(N.default.events.SCROLL_BEFORE_UPDATE,function(){if(ne.hasFocus()){var ee=ne.getNativeRange();ee!=null&&ee.start.node!==ne.cursor.textNode&&ne.emitter.once(N.default.events.SCROLL_UPDATE,function(){try{ne.setNativeRange(ee.start.node,ee.start.offset,ee.end.node,ee.end.offset)}catch{}})}}),this.emitter.on(N.default.events.SCROLL_OPTIMIZE,function(ee,ie){if(ie.range){var he=ie.range,Se=he.startNode,Ce=he.startOffset,fe=he.endNode,_e=he.endOffset;ne.setNativeRange(Se,Ce,fe,_e)}}),this.update(N.default.sources.SILENT)}return d(te,[{key:"handleComposition",value:function(){var oe=this;this.root.addEventListener("compositionstart",function(){oe.composing=!0}),this.root.addEventListener("compositionend",function(){if(oe.composing=!1,oe.cursor.parent){var ne=oe.cursor.restore();if(!ne)return;setTimeout(function(){oe.setNativeRange(ne.startNode,ne.startOffset,ne.endNode,ne.endOffset)},1)}})}},{key:"handleDragging",value:function(){var oe=this;this.emitter.listenDOM("mousedown",document.body,function(){oe.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,function(){oe.mouseDown=!1,oe.update(N.default.sources.USER)})}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(oe,ne){if(!(this.scroll.whitelist!=null&&!this.scroll.whitelist[oe])){this.scroll.update();var ee=this.getNativeRange();if(!(ee==null||!ee.native.collapsed||g.default.query(oe,g.default.Scope.BLOCK))){if(ee.start.node!==this.cursor.textNode){var ie=g.default.find(ee.start.node,!1);if(ie==null)return;if(ie instanceof g.default.Leaf){var he=ie.split(ee.start.offset);ie.parent.insertBefore(this.cursor,he)}else ie.insertBefore(this.cursor,ee.start.node);this.cursor.attach()}this.cursor.format(oe,ne),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(oe){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,ee=this.scroll.length();oe=Math.min(oe,ee-1),ne=Math.min(oe+ne,ee-1)-oe;var ie=void 0,he=this.scroll.leaf(oe),Se=l(he,2),Ce=Se[0],fe=Se[1];if(Ce==null)return null;var _e=Ce.position(fe,!0),be=l(_e,2);ie=be[0],fe=be[1];var Pe=document.createRange();if(ne>0){Pe.setStart(ie,fe);var ye=this.scroll.leaf(oe+ne),ge=l(ye,2);if(Ce=ge[0],fe=ge[1],Ce==null)return null;var ke=Ce.position(fe,!0),Qe=l(ke,2);return ie=Qe[0],fe=Qe[1],Pe.setEnd(ie,fe),Pe.getBoundingClientRect()}else{var He="left",$e=void 0;return ie instanceof Text?(fe<ie.data.length?(Pe.setStart(ie,fe),Pe.setEnd(ie,fe+1)):(Pe.setStart(ie,fe-1),Pe.setEnd(ie,fe),He="right"),$e=Pe.getBoundingClientRect()):($e=Ce.domNode.getBoundingClientRect(),fe>0&&(He="right")),{bottom:$e.top+$e.height,height:$e.height,left:$e[He],right:$e[He],top:$e.top,width:0}}}},{key:"getNativeRange",value:function(){var oe=document.getSelection();if(oe==null||oe.rangeCount<=0)return null;var ne=oe.getRangeAt(0);if(ne==null)return null;var ee=this.normalizeNative(ne);return B.info("getNativeRange",ee),ee}},{key:"getRange",value:function(){var oe=this.getNativeRange();if(oe==null)return[null,null];var ne=this.normalizedToRange(oe);return[ne,oe]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(oe){var ne=this,ee=[[oe.start.node,oe.start.offset]];oe.native.collapsed||ee.push([oe.end.node,oe.end.offset]);var ie=ee.map(function(Ce){var fe=l(Ce,2),_e=fe[0],be=fe[1],Pe=g.default.find(_e,!0),ye=Pe.offset(ne.scroll);return be===0?ye:Pe instanceof g.default.Container?ye+Pe.length():ye+Pe.index(_e,be)}),he=Math.min(Math.max.apply(Math,j(ie)),this.scroll.length()-1),Se=Math.min.apply(Math,[he].concat(j(ie)));return new U(Se,he-Se)}},{key:"normalizeNative",value:function(oe){if(!X(this.root,oe.startContainer)||!oe.collapsed&&!X(this.root,oe.endContainer))return null;var ne={start:{node:oe.startContainer,offset:oe.startOffset},end:{node:oe.endContainer,offset:oe.endOffset},native:oe};return[ne.start,ne.end].forEach(function(ee){for(var ie=ee.node,he=ee.offset;!(ie instanceof Text)&&ie.childNodes.length>0;)if(ie.childNodes.length>he)ie=ie.childNodes[he],he=0;else if(ie.childNodes.length===he)ie=ie.lastChild,he=ie instanceof Text?ie.data.length:ie.childNodes.length+1;else break;ee.node=ie,ee.offset=he}),ne}},{key:"rangeToNative",value:function(oe){var ne=this,ee=oe.collapsed?[oe.index]:[oe.index,oe.index+oe.length],ie=[],he=this.scroll.length();return ee.forEach(function(Se,Ce){Se=Math.min(he-1,Se);var fe=void 0,_e=ne.scroll.leaf(Se),be=l(_e,2),Pe=be[0],ye=be[1],ge=Pe.position(ye,Ce!==0),ke=l(ge,2);fe=ke[0],ye=ke[1],ie.push(fe,ye)}),ie.length<2&&(ie=ie.concat(ie)),ie}},{key:"scrollIntoView",value:function(oe){var ne=this.lastRange;if(ne!=null){var ee=this.getBounds(ne.index,ne.length);if(ee!=null){var ie=this.scroll.length()-1,he=this.scroll.line(Math.min(ne.index,ie)),Se=l(he,1),Ce=Se[0],fe=Ce;if(ne.length>0){var _e=this.scroll.line(Math.min(ne.index+ne.length,ie)),be=l(_e,1);fe=be[0]}if(!(Ce==null||fe==null)){var Pe=oe.getBoundingClientRect();ee.top<Pe.top?oe.scrollTop-=Pe.top-ee.top:ee.bottom>Pe.bottom&&(oe.scrollTop+=ee.bottom-Pe.bottom)}}}}},{key:"setNativeRange",value:function(oe,ne){var ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:oe,ie=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ne,he=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(B.info("setNativeRange",oe,ne,ee,ie),!(oe!=null&&(this.root.parentNode==null||oe.parentNode==null||ee.parentNode==null))){var Se=document.getSelection();if(Se!=null)if(oe!=null){this.hasFocus()||this.root.focus();var Ce=(this.getNativeRange()||{}).native;if(Ce==null||he||oe!==Ce.startContainer||ne!==Ce.startOffset||ee!==Ce.endContainer||ie!==Ce.endOffset){oe.tagName=="BR"&&(ne=[].indexOf.call(oe.parentNode.childNodes,oe),oe=oe.parentNode),ee.tagName=="BR"&&(ie=[].indexOf.call(ee.parentNode.childNodes,ee),ee=ee.parentNode);var fe=document.createRange();fe.setStart(oe,ne),fe.setEnd(ee,ie),Se.removeAllRanges(),Se.addRange(fe)}}else Se.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(oe){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,ee=arguments.length>2&&arguments[2]!==void 0?arguments[2]:N.default.sources.API;if(typeof ne=="string"&&(ee=ne,ne=!1),B.info("setRange",oe),oe!=null){var ie=this.rangeToNative(oe);this.setNativeRange.apply(this,j(ie).concat([ne]))}else this.setNativeRange(null);this.update(ee)}},{key:"update",value:function(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:N.default.sources.USER,ne=this.lastRange,ee=this.getRange(),ie=l(ee,2),he=ie[0],Se=ie[1];if(this.lastRange=he,this.lastRange!=null&&(this.savedRange=this.lastRange),!(0,A.default)(ne,this.lastRange)){var Ce;!this.composing&&Se!=null&&Se.native.collapsed&&Se.start.node!==this.cursor.textNode&&this.cursor.restore();var fe=[N.default.events.SELECTION_CHANGE,(0,S.default)(this.lastRange),(0,S.default)(ne),oe];if((Ce=this.emitter).emit.apply(Ce,[N.default.events.EDITOR_CHANGE].concat(fe)),oe!==N.default.sources.SILENT){var _e;(_e=this.emitter).emit.apply(_e,fe)}}}}]),te}();function X(te,se){try{se.parentNode}catch{return!1}return se instanceof Text&&(se=se.parentNode),te.contains(se)}n.Range=U,n.default=Z},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(k,R){for(var L=0;L<R.length;L++){var j=R[L];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,j.key,j)}}return function(k,R,L){return R&&N(k.prototype,R),L&&N(k,L),k}}(),d=function N(k,R,L){k===null&&(k=Function.prototype);var j=Object.getOwnPropertyDescriptor(k,R);if(j===void 0){var F=Object.getPrototypeOf(k);return F===null?void 0:N(F,R,L)}else{if("value"in j)return j.value;var B=j.get;return B===void 0?void 0:B.call(L)}},i=o(0),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(){return S(this,k),E(this,(k.__proto__||Object.getPrototypeOf(k)).apply(this,arguments))}return l(k,[{key:"insertInto",value:function(L,j){L.children.length===0?d(k.prototype.__proto__||Object.getPrototypeOf(k.prototype),"insertInto",this).call(this,L,j):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),k}(g.default.Embed);C.blotName="break",C.tagName="BR",n.default=C},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,C){A.__proto__=C}||function(A,C){for(var N in C)C.hasOwnProperty(N)&&(A[N]=C[N])};return function(A,C){E(A,C);function N(){this.constructor=A}A.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(44),i=o(30),g=o(1),x=function(E){l(A,E);function A(C){var N=E.call(this,C)||this;return N.build(),N}return A.prototype.appendChild=function(C){this.insertBefore(C)},A.prototype.attach=function(){E.prototype.attach.call(this),this.children.forEach(function(C){C.attach()})},A.prototype.build=function(){var C=this;this.children=new d.default,[].slice.call(this.domNode.childNodes).reverse().forEach(function(N){try{var k=S(N);C.insertBefore(k,C.children.head||void 0)}catch(R){if(R instanceof g.ParchmentError)return;throw R}})},A.prototype.deleteAt=function(C,N){if(C===0&&N===this.length())return this.remove();this.children.forEachAt(C,N,function(k,R,L){k.deleteAt(R,L)})},A.prototype.descendant=function(C,N){var k=this.children.find(N),R=k[0],L=k[1];return C.blotName==null&&C(R)||C.blotName!=null&&R instanceof C?[R,L]:R instanceof A?R.descendant(C,L):[null,-1]},A.prototype.descendants=function(C,N,k){N===void 0&&(N=0),k===void 0&&(k=Number.MAX_VALUE);var R=[],L=k;return this.children.forEachAt(N,k,function(j,F,B){(C.blotName==null&&C(j)||C.blotName!=null&&j instanceof C)&&R.push(j),j instanceof A&&(R=R.concat(j.descendants(C,F,L))),L-=B}),R},A.prototype.detach=function(){this.children.forEach(function(C){C.detach()}),E.prototype.detach.call(this)},A.prototype.formatAt=function(C,N,k,R){this.children.forEachAt(C,N,function(L,j,F){L.formatAt(j,F,k,R)})},A.prototype.insertAt=function(C,N,k){var R=this.children.find(C),L=R[0],j=R[1];if(L)L.insertAt(j,N,k);else{var F=k==null?g.create("text",N):g.create(N,k);this.appendChild(F)}},A.prototype.insertBefore=function(C,N){if(this.statics.allowedChildren!=null&&!this.statics.allowedChildren.some(function(k){return C instanceof k}))throw new g.ParchmentError("Cannot insert "+C.statics.blotName+" into "+this.statics.blotName);C.insertInto(this,N)},A.prototype.length=function(){return this.children.reduce(function(C,N){return C+N.length()},0)},A.prototype.moveChildren=function(C,N){this.children.forEach(function(k){C.insertBefore(k,N)})},A.prototype.optimize=function(C){if(E.prototype.optimize.call(this,C),this.children.length===0)if(this.statics.defaultChild!=null){var N=g.create(this.statics.defaultChild);this.appendChild(N),N.optimize(C)}else this.remove()},A.prototype.path=function(C,N){N===void 0&&(N=!1);var k=this.children.find(C,N),R=k[0],L=k[1],j=[[this,C]];return R instanceof A?j.concat(R.path(L,N)):(R!=null&&j.push([R,L]),j)},A.prototype.removeChild=function(C){this.children.remove(C)},A.prototype.replace=function(C){C instanceof A&&C.moveChildren(this),E.prototype.replace.call(this,C)},A.prototype.split=function(C,N){if(N===void 0&&(N=!1),!N){if(C===0)return this;if(C===this.length())return this.next}var k=this.clone();return this.parent.insertBefore(k,this.next),this.children.forEachAt(C,this.length(),function(R,L,j){R=R.split(L,N),k.appendChild(R)}),k},A.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},A.prototype.update=function(C,N){var k=this,R=[],L=[];C.forEach(function(j){j.target===k.domNode&&j.type==="childList"&&(R.push.apply(R,j.addedNodes),L.push.apply(L,j.removedNodes))}),L.forEach(function(j){if(!(j.parentNode!=null&&j.tagName!=="IFRAME"&&document.body.compareDocumentPosition(j)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var F=g.find(j);F!=null&&(F.domNode.parentNode==null||F.domNode.parentNode===k.domNode)&&F.detach()}}),R.filter(function(j){return j.parentNode==k.domNode}).sort(function(j,F){return j===F?0:j.compareDocumentPosition(F)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1}).forEach(function(j){var F=null;j.nextSibling!=null&&(F=g.find(j.nextSibling));var B=S(j);(B.next!=F||B.next==null)&&(B.parent!=null&&B.parent.removeChild(k),k.insertBefore(B,F||void 0))})},A}(i.default);function S(E){var A=g.find(E);if(A==null)try{A=g.create(E)}catch{A=g.create(g.Scope.INLINE),[].slice.call(E.childNodes).forEach(function(N){A.domNode.appendChild(N)}),E.parentNode&&E.parentNode.replaceChild(A.domNode,E),A.attach()}return A}n.default=x},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,C){A.__proto__=C}||function(A,C){for(var N in C)C.hasOwnProperty(N)&&(A[N]=C[N])};return function(A,C){E(A,C);function N(){this.constructor=A}A.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12),i=o(31),g=o(17),x=o(1),S=function(E){l(A,E);function A(C){var N=E.call(this,C)||this;return N.attributes=new i.default(N.domNode),N}return A.formats=function(C){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return C.tagName.toLowerCase()},A.prototype.format=function(C,N){var k=x.query(C);k instanceof d.default?this.attributes.attribute(k,N):N&&k!=null&&(C!==this.statics.blotName||this.formats()[C]!==N)&&this.replaceWith(C,N)},A.prototype.formats=function(){var C=this.attributes.values(),N=this.statics.formats(this.domNode);return N!=null&&(C[this.statics.blotName]=N),C},A.prototype.replaceWith=function(C,N){var k=E.prototype.replaceWith.call(this,C,N);return this.attributes.copy(k),k},A.prototype.update=function(C,N){var k=this;E.prototype.update.call(this,C,N),C.some(function(R){return R.target===k.domNode&&R.type==="attributes"})&&this.attributes.build()},A.prototype.wrap=function(C,N){var k=E.prototype.wrap.call(this,C,N);return k instanceof A&&k.statics.scope===this.statics.scope&&this.attributes.move(k),k},A}(g.default);n.default=S},function(r,n,o){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var A in E)E.hasOwnProperty(A)&&(S[A]=E[A])};return function(S,E){x(S,E);function A(){this.constructor=S}S.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(30),i=o(1),g=function(x){l(S,x);function S(){return x!==null&&x.apply(this,arguments)||this}return S.value=function(E){return!0},S.prototype.index=function(E,A){return this.domNode===E||this.domNode.compareDocumentPosition(E)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(A,1):-1},S.prototype.position=function(E,A){var C=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return E>0&&(C+=1),[this.parent.domNode,C]},S.prototype.value=function(){var E;return E={},E[this.statics.blotName]=this.statics.value(this.domNode)||!0,E},S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=g},function(r,n,o){var l=o(11),d=o(3),i={attributes:{compose:function(x,S,E){typeof x!="object"&&(x={}),typeof S!="object"&&(S={});var A=d(!0,{},S);E||(A=Object.keys(A).reduce(function(N,k){return A[k]!=null&&(N[k]=A[k]),N},{}));for(var C in x)x[C]!==void 0&&S[C]===void 0&&(A[C]=x[C]);return Object.keys(A).length>0?A:void 0},diff:function(x,S){typeof x!="object"&&(x={}),typeof S!="object"&&(S={});var E=Object.keys(x).concat(Object.keys(S)).reduce(function(A,C){return l(x[C],S[C])||(A[C]=S[C]===void 0?null:S[C]),A},{});return Object.keys(E).length>0?E:void 0},transform:function(x,S,E){if(typeof x!="object")return S;if(typeof S=="object"){if(!E)return S;var A=Object.keys(S).reduce(function(C,N){return x[N]===void 0&&(C[N]=S[N]),C},{});return Object.keys(A).length>0?A:void 0}}},iterator:function(x){return new g(x)},length:function(x){return typeof x.delete=="number"?x.delete:typeof x.retain=="number"?x.retain:typeof x.insert=="string"?x.insert.length:1}};function g(x){this.ops=x,this.index=0,this.offset=0}g.prototype.hasNext=function(){return this.peekLength()<1/0},g.prototype.next=function(x){x||(x=1/0);var S=this.ops[this.index];if(S){var E=this.offset,A=i.length(S);if(x>=A-E?(x=A-E,this.index+=1,this.offset=0):this.offset+=x,typeof S.delete=="number")return{delete:x};var C={};return S.attributes&&(C.attributes=S.attributes),typeof S.retain=="number"?C.retain=x:typeof S.insert=="string"?C.insert=S.insert.substr(E,x):C.insert=S.insert,C}else return{retain:1/0}},g.prototype.peek=function(){return this.ops[this.index]},g.prototype.peekLength=function(){return this.ops[this.index]?i.length(this.ops[this.index])-this.offset:1/0},g.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},g.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var x=this.offset,S=this.index,E=this.next(),A=this.ops.slice(this.index);return this.offset=x,this.index=S,[E].concat(A)}else return[]},r.exports=i},function(r,n){var o=function(){function l(k,R){return R!=null&&k instanceof R}var d;try{d=Map}catch{d=function(){}}var i;try{i=Set}catch{i=function(){}}var g;try{g=Promise}catch{g=function(){}}function x(k,R,L,j,F){typeof R=="object"&&(L=R.depth,j=R.prototype,F=R.includeNonEnumerable,R=R.circular);var B=[],U=[],Z=typeof Buffer<"u";typeof R>"u"&&(R=!0),typeof L>"u"&&(L=1/0);function X(te,se){if(te===null)return null;if(se===0)return te;var oe,ne;if(typeof te!="object")return te;if(l(te,d))oe=new d;else if(l(te,i))oe=new i;else if(l(te,g))oe=new g(function(Pe,ye){te.then(function(ge){Pe(X(ge,se-1))},function(ge){ye(X(ge,se-1))})});else if(x.__isArray(te))oe=[];else if(x.__isRegExp(te))oe=new RegExp(te.source,N(te)),te.lastIndex&&(oe.lastIndex=te.lastIndex);else if(x.__isDate(te))oe=new Date(te.getTime());else{if(Z&&Buffer.isBuffer(te))return Buffer.allocUnsafe?oe=Buffer.allocUnsafe(te.length):oe=new Buffer(te.length),te.copy(oe),oe;l(te,Error)?oe=Object.create(te):typeof j>"u"?(ne=Object.getPrototypeOf(te),oe=Object.create(ne)):(oe=Object.create(j),ne=j)}if(R){var ee=B.indexOf(te);if(ee!=-1)return U[ee];B.push(te),U.push(oe)}l(te,d)&&te.forEach(function(Pe,ye){var ge=X(ye,se-1),ke=X(Pe,se-1);oe.set(ge,ke)}),l(te,i)&&te.forEach(function(Pe){var ye=X(Pe,se-1);oe.add(ye)});for(var ie in te){var he;ne&&(he=Object.getOwnPropertyDescriptor(ne,ie)),!(he&&he.set==null)&&(oe[ie]=X(te[ie],se-1))}if(Object.getOwnPropertySymbols)for(var Se=Object.getOwnPropertySymbols(te),ie=0;ie<Se.length;ie++){var Ce=Se[ie],fe=Object.getOwnPropertyDescriptor(te,Ce);fe&&!fe.enumerable&&!F||(oe[Ce]=X(te[Ce],se-1),fe.enumerable||Object.defineProperty(oe,Ce,{enumerable:!1}))}if(F)for(var _e=Object.getOwnPropertyNames(te),ie=0;ie<_e.length;ie++){var be=_e[ie],fe=Object.getOwnPropertyDescriptor(te,be);fe&&fe.enumerable||(oe[be]=X(te[be],se-1),Object.defineProperty(oe,be,{enumerable:!1}))}return oe}return X(k,L)}x.clonePrototype=function(R){if(R===null)return null;var L=function(){};return L.prototype=R,new L};function S(k){return Object.prototype.toString.call(k)}x.__objToStr=S;function E(k){return typeof k=="object"&&S(k)==="[object Date]"}x.__isDate=E;function A(k){return typeof k=="object"&&S(k)==="[object Array]"}x.__isArray=A;function C(k){return typeof k=="object"&&S(k)==="[object RegExp]"}x.__isRegExp=C;function N(k){var R="";return k.global&&(R+="g"),k.ignoreCase&&(R+="i"),k.multiline&&(R+="m"),R}return x.__getRegExpFlags=N,x}();typeof r=="object"&&r.exports&&(r.exports=o)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function oe(ne,ee){var ie=[],he=!0,Se=!1,Ce=void 0;try{for(var fe=ne[Symbol.iterator](),_e;!(he=(_e=fe.next()).done)&&(ie.push(_e.value),!(ee&&ie.length===ee));he=!0);}catch(be){Se=!0,Ce=be}finally{try{!he&&fe.return&&fe.return()}finally{if(Se)throw Ce}}return ie}return function(ne,ee){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return oe(ne,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function oe(ne,ee){for(var ie=0;ie<ee.length;ie++){var he=ee[ie];he.enumerable=he.enumerable||!1,he.configurable=!0,"value"in he&&(he.writable=!0),Object.defineProperty(ne,he.key,he)}}return function(ne,ee,ie){return ee&&oe(ne.prototype,ee),ie&&oe(ne,ie),ne}}(),i=function oe(ne,ee,ie){ne===null&&(ne=Function.prototype);var he=Object.getOwnPropertyDescriptor(ne,ee);if(he===void 0){var Se=Object.getPrototypeOf(ne);return Se===null?void 0:oe(Se,ee,ie)}else{if("value"in he)return he.value;var Ce=he.get;return Ce===void 0?void 0:Ce.call(ie)}},g=o(0),x=B(g),S=o(8),E=B(S),A=o(4),C=B(A),N=o(16),k=B(N),R=o(13),L=B(R),j=o(25),F=B(j);function B(oe){return oe&&oe.__esModule?oe:{default:oe}}function U(oe,ne){if(!(oe instanceof ne))throw new TypeError("Cannot call a class as a function")}function Z(oe,ne){if(!oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne&&(typeof ne=="object"||typeof ne=="function")?ne:oe}function X(oe,ne){if(typeof ne!="function"&&ne!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ne);oe.prototype=Object.create(ne&&ne.prototype,{constructor:{value:oe,enumerable:!1,writable:!0,configurable:!0}}),ne&&(Object.setPrototypeOf?Object.setPrototypeOf(oe,ne):oe.__proto__=ne)}function te(oe){return oe instanceof C.default||oe instanceof A.BlockEmbed}var se=function(oe){X(ne,oe);function ne(ee,ie){U(this,ne);var he=Z(this,(ne.__proto__||Object.getPrototypeOf(ne)).call(this,ee));return he.emitter=ie.emitter,Array.isArray(ie.whitelist)&&(he.whitelist=ie.whitelist.reduce(function(Se,Ce){return Se[Ce]=!0,Se},{})),he.domNode.addEventListener("DOMNodeInserted",function(){}),he.optimize(),he.enable(),he}return d(ne,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(ie,he){var Se=this.line(ie),Ce=l(Se,2),fe=Ce[0],_e=Ce[1],be=this.line(ie+he),Pe=l(be,1),ye=Pe[0];if(i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"deleteAt",this).call(this,ie,he),ye!=null&&fe!==ye&&_e>0){if(fe instanceof A.BlockEmbed||ye instanceof A.BlockEmbed){this.optimize();return}if(fe instanceof L.default){var ge=fe.newlineIndex(fe.length(),!0);if(ge>-1&&(fe=fe.split(ge+1),fe===ye)){this.optimize();return}}else if(ye instanceof L.default){var ke=ye.newlineIndex(0);ke>-1&&ye.split(ke+1)}var Qe=ye.children.head instanceof k.default?null:ye.children.head;fe.moveChildren(ye,Qe),fe.remove()}this.optimize()}},{key:"enable",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",ie)}},{key:"formatAt",value:function(ie,he,Se,Ce){this.whitelist!=null&&!this.whitelist[Se]||(i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"formatAt",this).call(this,ie,he,Se,Ce),this.optimize())}},{key:"insertAt",value:function(ie,he,Se){if(!(Se!=null&&this.whitelist!=null&&!this.whitelist[he])){if(ie>=this.length())if(Se==null||x.default.query(he,x.default.Scope.BLOCK)==null){var Ce=x.default.create(this.statics.defaultChild);this.appendChild(Ce),Se==null&&he.endsWith(`
`)&&(he=he.slice(0,-1)),Ce.insertAt(0,he,Se)}else{var fe=x.default.create(he,Se);this.appendChild(fe)}else i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"insertAt",this).call(this,ie,he,Se);this.optimize()}}},{key:"insertBefore",value:function(ie,he){if(ie.statics.scope===x.default.Scope.INLINE_BLOT){var Se=x.default.create(this.statics.defaultChild);Se.appendChild(ie),ie=Se}i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"insertBefore",this).call(this,ie,he)}},{key:"leaf",value:function(ie){return this.path(ie).pop()||[null,-1]}},{key:"line",value:function(ie){return ie===this.length()?this.line(ie-1):this.descendant(te,ie)}},{key:"lines",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE,Se=function Ce(fe,_e,be){var Pe=[],ye=be;return fe.children.forEachAt(_e,be,function(ge,ke,Qe){te(ge)?Pe.push(ge):ge instanceof x.default.Container&&(Pe=Pe.concat(Ce(ge,ke,ye))),ye-=Qe}),Pe};return Se(this,ie,he)}},{key:"optimize",value:function(){var ie=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],he=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch!==!0&&(i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"optimize",this).call(this,ie,he),ie.length>0&&this.emitter.emit(E.default.events.SCROLL_OPTIMIZE,ie,he))}},{key:"path",value:function(ie){return i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"path",this).call(this,ie).slice(1)}},{key:"update",value:function(ie){if(this.batch!==!0){var he=E.default.sources.USER;typeof ie=="string"&&(he=ie),Array.isArray(ie)||(ie=this.observer.takeRecords()),ie.length>0&&this.emitter.emit(E.default.events.SCROLL_BEFORE_UPDATE,he,ie),i(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"update",this).call(this,ie.concat([])),ie.length>0&&this.emitter.emit(E.default.events.SCROLL_UPDATE,he,ie)}}}]),ne}(x.default.Scroll);se.blotName="scroll",se.className="ql-editor",se.tagName="DIV",se.defaultChild="block",se.allowedChildren=[C.default,A.BlockEmbed,F.default],n.default=se},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SHORTKEY=n.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function($e){return typeof $e}:function($e){return $e&&typeof Symbol=="function"&&$e.constructor===Symbol&&$e!==Symbol.prototype?"symbol":typeof $e},d=function(){function $e(Xe,ft){var ze=[],ut=!0,At=!1,xt=void 0;try{for(var nr=Xe[Symbol.iterator](),Vt;!(ut=(Vt=nr.next()).done)&&(ze.push(Vt.value),!(ft&&ze.length===ft));ut=!0);}catch(dr){At=!0,xt=dr}finally{try{!ut&&nr.return&&nr.return()}finally{if(At)throw xt}}return ze}return function(Xe,ft){if(Array.isArray(Xe))return Xe;if(Symbol.iterator in Object(Xe))return $e(Xe,ft);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function $e(Xe,ft){for(var ze=0;ze<ft.length;ze++){var ut=ft[ze];ut.enumerable=ut.enumerable||!1,ut.configurable=!0,"value"in ut&&(ut.writable=!0),Object.defineProperty(Xe,ut.key,ut)}}return function(Xe,ft,ze){return ft&&$e(Xe.prototype,ft),ze&&$e(Xe,ze),Xe}}(),g=o(21),x=oe(g),S=o(11),E=oe(S),A=o(3),C=oe(A),N=o(2),k=oe(N),R=o(20),L=oe(R),j=o(0),F=oe(j),B=o(5),U=oe(B),Z=o(10),X=oe(Z),te=o(9),se=oe(te);function oe($e){return $e&&$e.__esModule?$e:{default:$e}}function ne($e,Xe,ft){return Xe in $e?Object.defineProperty($e,Xe,{value:ft,enumerable:!0,configurable:!0,writable:!0}):$e[Xe]=ft,$e}function ee($e,Xe){if(!($e instanceof Xe))throw new TypeError("Cannot call a class as a function")}function ie($e,Xe){if(!$e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Xe&&(typeof Xe=="object"||typeof Xe=="function")?Xe:$e}function he($e,Xe){if(typeof Xe!="function"&&Xe!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Xe);$e.prototype=Object.create(Xe&&Xe.prototype,{constructor:{value:$e,enumerable:!1,writable:!0,configurable:!0}}),Xe&&(Object.setPrototypeOf?Object.setPrototypeOf($e,Xe):$e.__proto__=Xe)}var Se=(0,X.default)("quill:keyboard"),Ce=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",fe=function($e){he(Xe,$e),i(Xe,null,[{key:"match",value:function(ze,ut){return ut=He(ut),["altKey","ctrlKey","metaKey","shiftKey"].some(function(At){return!!ut[At]!==ze[At]&&ut[At]!==null})?!1:ut.key===(ze.which||ze.keyCode)}}]);function Xe(ft,ze){ee(this,Xe);var ut=ie(this,(Xe.__proto__||Object.getPrototypeOf(Xe)).call(this,ft,ze));return ut.bindings={},Object.keys(ut.options.bindings).forEach(function(At){At==="list autofill"&&ft.scroll.whitelist!=null&&!ft.scroll.whitelist.list||ut.options.bindings[At]&&ut.addBinding(ut.options.bindings[At])}),ut.addBinding({key:Xe.keys.ENTER,shiftKey:null},ge),ut.addBinding({key:Xe.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},function(){}),/Firefox/i.test(navigator.userAgent)?(ut.addBinding({key:Xe.keys.BACKSPACE},{collapsed:!0},be),ut.addBinding({key:Xe.keys.DELETE},{collapsed:!0},Pe)):(ut.addBinding({key:Xe.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},be),ut.addBinding({key:Xe.keys.DELETE},{collapsed:!0,suffix:/^.?$/},Pe)),ut.addBinding({key:Xe.keys.BACKSPACE},{collapsed:!1},ye),ut.addBinding({key:Xe.keys.DELETE},{collapsed:!1},ye),ut.addBinding({key:Xe.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},be),ut.listen(),ut}return i(Xe,[{key:"addBinding",value:function(ze){var ut=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},At=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},xt=He(ze);if(xt==null||xt.key==null)return Se.warn("Attempted to add invalid keyboard binding",xt);typeof ut=="function"&&(ut={handler:ut}),typeof At=="function"&&(At={handler:At}),xt=(0,C.default)(xt,ut,At),this.bindings[xt.key]=this.bindings[xt.key]||[],this.bindings[xt.key].push(xt)}},{key:"listen",value:function(){var ze=this;this.quill.root.addEventListener("keydown",function(ut){if(!ut.defaultPrevented){var At=ut.which||ut.keyCode,xt=(ze.bindings[At]||[]).filter(function(mi){return Xe.match(ut,mi)});if(xt.length!==0){var nr=ze.quill.getSelection();if(!(nr==null||!ze.quill.hasFocus())){var Vt=ze.quill.getLine(nr.index),dr=d(Vt,2),Br=dr[0],Yr=dr[1],_t=ze.quill.getLeaf(nr.index),Mt=d(_t,2),Ke=Mt[0],at=Mt[1],dt=nr.length===0?[Ke,at]:ze.quill.getLeaf(nr.index+nr.length),tr=d(dt,2),Qt=tr[0],er=tr[1],Pr=Ke instanceof F.default.Text?Ke.value().slice(0,at):"",sn=Qt instanceof F.default.Text?Qt.value().slice(er):"",fn={collapsed:nr.length===0,empty:nr.length===0&&Br.length()<=1,format:ze.quill.getFormat(nr),offset:Yr,prefix:Pr,suffix:sn},Ai=xt.some(function(mi){if(mi.collapsed!=null&&mi.collapsed!==fn.collapsed||mi.empty!=null&&mi.empty!==fn.empty||mi.offset!=null&&mi.offset!==fn.offset)return!1;if(Array.isArray(mi.format)){if(mi.format.every(function(Zi){return fn.format[Zi]==null}))return!1}else if(l(mi.format)==="object"&&!Object.keys(mi.format).every(function(Zi){return mi.format[Zi]===!0?fn.format[Zi]!=null:mi.format[Zi]===!1?fn.format[Zi]==null:(0,E.default)(mi.format[Zi],fn.format[Zi])}))return!1;return mi.prefix!=null&&!mi.prefix.test(fn.prefix)||mi.suffix!=null&&!mi.suffix.test(fn.suffix)?!1:mi.handler.call(ze,nr,fn)!==!0});Ai&&ut.preventDefault()}}}})}}]),Xe}(se.default);fe.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},fe.DEFAULTS={bindings:{bold:Qe("bold"),italic:Qe("italic"),underline:Qe("underline"),indent:{key:fe.keys.TAB,format:["blockquote","indent","list"],handler:function(Xe,ft){if(ft.collapsed&&ft.offset!==0)return!0;this.quill.format("indent","+1",U.default.sources.USER)}},outdent:{key:fe.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(Xe,ft){if(ft.collapsed&&ft.offset!==0)return!0;this.quill.format("indent","-1",U.default.sources.USER)}},"outdent backspace":{key:fe.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(Xe,ft){ft.format.indent!=null?this.quill.format("indent","-1",U.default.sources.USER):ft.format.list!=null&&this.quill.format("list",!1,U.default.sources.USER)}},"indent code-block":ke(!0),"outdent code-block":ke(!1),"remove tab":{key:fe.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(Xe){this.quill.deleteText(Xe.index-1,1,U.default.sources.USER)}},tab:{key:fe.keys.TAB,handler:function(Xe){this.quill.history.cutoff();var ft=new k.default().retain(Xe.index).delete(Xe.length).insert("	");this.quill.updateContents(ft,U.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Xe.index+1,U.default.sources.SILENT)}},"list empty enter":{key:fe.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(Xe,ft){this.quill.format("list",!1,U.default.sources.USER),ft.format.indent&&this.quill.format("indent",!1,U.default.sources.USER)}},"checklist enter":{key:fe.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(Xe){var ft=this.quill.getLine(Xe.index),ze=d(ft,2),ut=ze[0],At=ze[1],xt=(0,C.default)({},ut.formats(),{list:"checked"}),nr=new k.default().retain(Xe.index).insert(`
`,xt).retain(ut.length()-At-1).retain(1,{list:"unchecked"});this.quill.updateContents(nr,U.default.sources.USER),this.quill.setSelection(Xe.index+1,U.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:fe.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(Xe,ft){var ze=this.quill.getLine(Xe.index),ut=d(ze,2),At=ut[0],xt=ut[1],nr=new k.default().retain(Xe.index).insert(`
`,ft.format).retain(At.length()-xt-1).retain(1,{header:null});this.quill.updateContents(nr,U.default.sources.USER),this.quill.setSelection(Xe.index+1,U.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(Xe,ft){var ze=ft.prefix.length,ut=this.quill.getLine(Xe.index),At=d(ut,2),xt=At[0],nr=At[1];if(nr>ze)return!0;var Vt=void 0;switch(ft.prefix.trim()){case"[]":case"[ ]":Vt="unchecked";break;case"[x]":Vt="checked";break;case"-":case"*":Vt="bullet";break;default:Vt="ordered"}this.quill.insertText(Xe.index," ",U.default.sources.USER),this.quill.history.cutoff();var dr=new k.default().retain(Xe.index-nr).delete(ze+1).retain(xt.length()-2-nr).retain(1,{list:Vt});this.quill.updateContents(dr,U.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(Xe.index-ze,U.default.sources.SILENT)}},"code exit":{key:fe.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(Xe){var ft=this.quill.getLine(Xe.index),ze=d(ft,2),ut=ze[0],At=ze[1],xt=new k.default().retain(Xe.index+ut.length()-At-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(xt,U.default.sources.USER)}},"embed left":_e(fe.keys.LEFT,!1),"embed left shift":_e(fe.keys.LEFT,!0),"embed right":_e(fe.keys.RIGHT,!1),"embed right shift":_e(fe.keys.RIGHT,!0)}};function _e($e,Xe){var ft,ze=$e===fe.keys.LEFT?"prefix":"suffix";return ft={key:$e,shiftKey:Xe,altKey:null},ne(ft,ze,/^$/),ne(ft,"handler",function(At){var xt=At.index;$e===fe.keys.RIGHT&&(xt+=At.length+1);var nr=this.quill.getLeaf(xt),Vt=d(nr,1),dr=Vt[0];return dr instanceof F.default.Embed?($e===fe.keys.LEFT?Xe?this.quill.setSelection(At.index-1,At.length+1,U.default.sources.USER):this.quill.setSelection(At.index-1,U.default.sources.USER):Xe?this.quill.setSelection(At.index,At.length+1,U.default.sources.USER):this.quill.setSelection(At.index+At.length+1,U.default.sources.USER),!1):!0}),ft}function be($e,Xe){if(!($e.index===0||this.quill.getLength()<=1)){var ft=this.quill.getLine($e.index),ze=d(ft,1),ut=ze[0],At={};if(Xe.offset===0){var xt=this.quill.getLine($e.index-1),nr=d(xt,1),Vt=nr[0];if(Vt!=null&&Vt.length()>1){var dr=ut.formats(),Br=this.quill.getFormat($e.index-1,1);At=L.default.attributes.diff(dr,Br)||{}}}var Yr=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(Xe.prefix)?2:1;this.quill.deleteText($e.index-Yr,Yr,U.default.sources.USER),Object.keys(At).length>0&&this.quill.formatLine($e.index-Yr,Yr,At,U.default.sources.USER),this.quill.focus()}}function Pe($e,Xe){var ft=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(Xe.suffix)?2:1;if(!($e.index>=this.quill.getLength()-ft)){var ze={},ut=0,At=this.quill.getLine($e.index),xt=d(At,1),nr=xt[0];if(Xe.offset>=nr.length()-1){var Vt=this.quill.getLine($e.index+1),dr=d(Vt,1),Br=dr[0];if(Br){var Yr=nr.formats(),_t=this.quill.getFormat($e.index,1);ze=L.default.attributes.diff(Yr,_t)||{},ut=Br.length()}}this.quill.deleteText($e.index,ft,U.default.sources.USER),Object.keys(ze).length>0&&this.quill.formatLine($e.index+ut-1,ft,ze,U.default.sources.USER)}}function ye($e){var Xe=this.quill.getLines($e),ft={};if(Xe.length>1){var ze=Xe[0].formats(),ut=Xe[Xe.length-1].formats();ft=L.default.attributes.diff(ut,ze)||{}}this.quill.deleteText($e,U.default.sources.USER),Object.keys(ft).length>0&&this.quill.formatLine($e.index,1,ft,U.default.sources.USER),this.quill.setSelection($e.index,U.default.sources.SILENT),this.quill.focus()}function ge($e,Xe){var ft=this;$e.length>0&&this.quill.scroll.deleteAt($e.index,$e.length);var ze=Object.keys(Xe.format).reduce(function(ut,At){return F.default.query(At,F.default.Scope.BLOCK)&&!Array.isArray(Xe.format[At])&&(ut[At]=Xe.format[At]),ut},{});this.quill.insertText($e.index,`
`,ze,U.default.sources.USER),this.quill.setSelection($e.index+1,U.default.sources.SILENT),this.quill.focus(),Object.keys(Xe.format).forEach(function(ut){ze[ut]==null&&(Array.isArray(Xe.format[ut])||ut!=="link"&&ft.quill.format(ut,Xe.format[ut],U.default.sources.USER))})}function ke($e){return{key:fe.keys.TAB,shiftKey:!$e,format:{"code-block":!0},handler:function(ft){var ze=F.default.query("code-block"),ut=ft.index,At=ft.length,xt=this.quill.scroll.descendant(ze,ut),nr=d(xt,2),Vt=nr[0],dr=nr[1];if(Vt!=null){var Br=this.quill.getIndex(Vt),Yr=Vt.newlineIndex(dr,!0)+1,_t=Vt.newlineIndex(Br+dr+At),Mt=Vt.domNode.textContent.slice(Yr,_t).split(`
`);dr=0,Mt.forEach(function(Ke,at){$e?(Vt.insertAt(Yr+dr,ze.TAB),dr+=ze.TAB.length,at===0?ut+=ze.TAB.length:At+=ze.TAB.length):Ke.startsWith(ze.TAB)&&(Vt.deleteAt(Yr+dr,ze.TAB.length),dr-=ze.TAB.length,at===0?ut-=ze.TAB.length:At-=ze.TAB.length),dr+=Ke.length+1}),this.quill.update(U.default.sources.USER),this.quill.setSelection(ut,At,U.default.sources.SILENT)}}}}function Qe($e){return{key:$e[0].toUpperCase(),shortKey:!0,handler:function(ft,ze){this.quill.format($e,!ze.format[$e],U.default.sources.USER)}}}function He($e){if(typeof $e=="string"||typeof $e=="number")return He({key:$e});if((typeof $e>"u"?"undefined":l($e))==="object"&&($e=(0,x.default)($e,!1)),typeof $e.key=="string")if(fe.keys[$e.key.toUpperCase()]!=null)$e.key=fe.keys[$e.key.toUpperCase()];else if($e.key.length===1)$e.key=$e.key.toUpperCase().charCodeAt(0);else return null;return $e.shortKey&&($e[Ce]=$e.shortKey,delete $e.shortKey),$e}n.default=fe,n.SHORTKEY=Ce},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function L(j,F){var B=[],U=!0,Z=!1,X=void 0;try{for(var te=j[Symbol.iterator](),se;!(U=(se=te.next()).done)&&(B.push(se.value),!(F&&B.length===F));U=!0);}catch(oe){Z=!0,X=oe}finally{try{!U&&te.return&&te.return()}finally{if(Z)throw X}}return B}return function(j,F){if(Array.isArray(j))return j;if(Symbol.iterator in Object(j))return L(j,F);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function L(j,F,B){j===null&&(j=Function.prototype);var U=Object.getOwnPropertyDescriptor(j,F);if(U===void 0){var Z=Object.getPrototypeOf(j);return Z===null?void 0:L(Z,F,B)}else{if("value"in U)return U.value;var X=U.get;return X===void 0?void 0:X.call(B)}},i=function(){function L(j,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(j,U.key,U)}}return function(j,F,B){return F&&L(j.prototype,F),B&&L(j,B),j}}(),g=o(0),x=A(g),S=o(7),E=A(S);function A(L){return L&&L.__esModule?L:{default:L}}function C(L,j){if(!(L instanceof j))throw new TypeError("Cannot call a class as a function")}function N(L,j){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:L}function k(L,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);L.prototype=Object.create(j&&j.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(L,j):L.__proto__=j)}var R=function(L){k(j,L),i(j,null,[{key:"value",value:function(){}}]);function j(F,B){C(this,j);var U=N(this,(j.__proto__||Object.getPrototypeOf(j)).call(this,F));return U.selection=B,U.textNode=document.createTextNode(j.CONTENTS),U.domNode.appendChild(U.textNode),U._length=0,U}return i(j,[{key:"detach",value:function(){this.parent!=null&&this.parent.removeChild(this)}},{key:"format",value:function(B,U){if(this._length!==0)return d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"format",this).call(this,B,U);for(var Z=this,X=0;Z!=null&&Z.statics.scope!==x.default.Scope.BLOCK_BLOT;)X+=Z.offset(Z.parent),Z=Z.parent;Z!=null&&(this._length=j.CONTENTS.length,Z.optimize(),Z.formatAt(X,j.CONTENTS.length,B,U),this._length=0)}},{key:"index",value:function(B,U){return B===this.textNode?0:d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"index",this).call(this,B,U)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!(this.selection.composing||this.parent==null)){var B=this.textNode,U=this.selection.getNativeRange(),Z=void 0,X=void 0,te=void 0;if(U!=null&&U.start.node===B&&U.end.node===B){var se=[B,U.start.offset,U.end.offset];Z=se[0],X=se[1],te=se[2]}for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==j.CONTENTS){var oe=this.textNode.data.split(j.CONTENTS).join("");this.next instanceof E.default?(Z=this.next.domNode,this.next.insertAt(0,oe),this.textNode.data=j.CONTENTS):(this.textNode.data=oe,this.parent.insertBefore(x.default.create(this.textNode),this),this.textNode=document.createTextNode(j.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),X!=null){var ne=[X,te].map(function(ie){return Math.max(0,Math.min(Z.data.length,ie-1))}),ee=l(ne,2);return X=ee[0],te=ee[1],{startNode:Z,startOffset:X,endNode:Z,endOffset:te}}}}},{key:"update",value:function(B,U){var Z=this;if(B.some(function(te){return te.type==="characterData"&&te.target===Z.textNode})){var X=this.restore();X&&(U.range=X)}}},{key:"value",value:function(){return""}}]),j}(x.default.Embed);R.blotName="cursor",R.className="ql-cursor",R.tagName="span",R.CONTENTS="\uFEFF",n.default=R},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=x(l),i=o(4),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(){return S(this,k),E(this,(k.__proto__||Object.getPrototypeOf(k)).apply(this,arguments))}return k}(d.default.Container);C.allowedChildren=[g.default,i.BlockEmbed,C],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.ColorStyle=n.ColorClass=n.ColorAttributor=void 0;var l=function(){function R(L,j){for(var F=0;F<j.length;F++){var B=j[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,j,F){return j&&R(L.prototype,j),F&&R(L,F),L}}(),d=function R(L,j,F){L===null&&(L=Function.prototype);var B=Object.getOwnPropertyDescriptor(L,j);if(B===void 0){var U=Object.getPrototypeOf(L);return U===null?void 0:R(U,j,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(0),g=x(i);function x(R){return R&&R.__esModule?R:{default:R}}function S(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}function E(R,L){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L&&(typeof L=="object"||typeof L=="function")?L:R}function A(R,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);R.prototype=Object.create(L&&L.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(R,L):R.__proto__=L)}var C=function(R){A(L,R);function L(){return S(this,L),E(this,(L.__proto__||Object.getPrototypeOf(L)).apply(this,arguments))}return l(L,[{key:"value",value:function(F){var B=d(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"value",this).call(this,F);return B.startsWith("rgb(")?(B=B.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),"#"+B.split(",").map(function(U){return("00"+parseInt(U).toString(16)).slice(-2)}).join("")):B}}]),L}(g.default.Attributor.Style),N=new g.default.Attributor.Class("color","ql-color",{scope:g.default.Scope.INLINE}),k=new C("color","color",{scope:g.default.Scope.INLINE});n.ColorAttributor=C,n.ColorClass=N,n.ColorStyle=k},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitize=n.default=void 0;var l=function(){function k(R,L){for(var j=0;j<L.length;j++){var F=L[j];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(R,F.key,F)}}return function(R,L,j){return L&&k(R.prototype,L),j&&k(R,j),R}}(),d=function k(R,L,j){R===null&&(R=Function.prototype);var F=Object.getOwnPropertyDescriptor(R,L);if(F===void 0){var B=Object.getPrototypeOf(R);return B===null?void 0:k(B,L,j)}else{if("value"in F)return F.value;var U=F.get;return U===void 0?void 0:U.call(j)}},i=o(6),g=x(i);function x(k){return k&&k.__esModule?k:{default:k}}function S(k,R){if(!(k instanceof R))throw new TypeError("Cannot call a class as a function")}function E(k,R){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:k}function A(k,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);k.prototype=Object.create(R&&R.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(k,R):k.__proto__=R)}var C=function(k){A(R,k);function R(){return S(this,R),E(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return l(R,[{key:"format",value:function(j,F){if(j!==this.statics.blotName||!F)return d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"format",this).call(this,j,F);F=this.constructor.sanitize(F),this.domNode.setAttribute("href",F)}}],[{key:"create",value:function(j){var F=d(R.__proto__||Object.getPrototypeOf(R),"create",this).call(this,j);return j=this.sanitize(j),F.setAttribute("href",j),F.setAttribute("rel","noopener noreferrer"),F.setAttribute("target","_blank"),F}},{key:"formats",value:function(j){return j.getAttribute("href")}},{key:"sanitize",value:function(j){return N(j,this.PROTOCOL_WHITELIST)?j:this.SANITIZED_URL}}]),R}(g.default);C.blotName="link",C.tagName="A",C.SANITIZED_URL="about:blank",C.PROTOCOL_WHITELIST=["http","https","mailto","tel"];function N(k,R){var L=document.createElement("a");L.href=k;var j=L.href.slice(0,L.href.indexOf(":"));return R.indexOf(j)>-1}n.default=C,n.sanitize=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},d=function(){function R(L,j){for(var F=0;F<j.length;F++){var B=j[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,j,F){return j&&R(L.prototype,j),F&&R(L,F),L}}(),i=o(23),g=E(i),x=o(107),S=E(x);function E(R){return R&&R.__esModule?R:{default:R}}function A(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}var C=0;function N(R,L){R.setAttribute(L,R.getAttribute(L)!=="true")}var k=function(){function R(L){var j=this;A(this,R),this.select=L,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",function(){j.togglePicker()}),this.label.addEventListener("keydown",function(F){switch(F.keyCode){case g.default.keys.ENTER:j.togglePicker();break;case g.default.keys.ESCAPE:j.escape(),F.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}return d(R,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),N(this.label,"aria-expanded"),N(this.options,"aria-hidden")}},{key:"buildItem",value:function(j){var F=this,B=document.createElement("span");return B.tabIndex="0",B.setAttribute("role","button"),B.classList.add("ql-picker-item"),j.hasAttribute("value")&&B.setAttribute("data-value",j.getAttribute("value")),j.textContent&&B.setAttribute("data-label",j.textContent),B.addEventListener("click",function(){F.selectItem(B,!0)}),B.addEventListener("keydown",function(U){switch(U.keyCode){case g.default.keys.ENTER:F.selectItem(B,!0),U.preventDefault();break;case g.default.keys.ESCAPE:F.escape(),U.preventDefault();break}}),B}},{key:"buildLabel",value:function(){var j=document.createElement("span");return j.classList.add("ql-picker-label"),j.innerHTML=S.default,j.tabIndex="0",j.setAttribute("role","button"),j.setAttribute("aria-expanded","false"),this.container.appendChild(j),j}},{key:"buildOptions",value:function(){var j=this,F=document.createElement("span");F.classList.add("ql-picker-options"),F.setAttribute("aria-hidden","true"),F.tabIndex="-1",F.id="ql-picker-options-"+C,C+=1,this.label.setAttribute("aria-controls",F.id),this.options=F,[].slice.call(this.select.options).forEach(function(B){var U=j.buildItem(B);F.appendChild(U),B.selected===!0&&j.selectItem(U)}),this.container.appendChild(F)}},{key:"buildPicker",value:function(){var j=this;[].slice.call(this.select.attributes).forEach(function(F){j.container.setAttribute(F.name,F.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var j=this;this.close(),setTimeout(function(){return j.label.focus()},1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(j){var F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,B=this.container.querySelector(".ql-selected");if(j!==B&&(B!=null&&B.classList.remove("ql-selected"),j!=null&&(j.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(j.parentNode.children,j),j.hasAttribute("data-value")?this.label.setAttribute("data-value",j.getAttribute("data-value")):this.label.removeAttribute("data-value"),j.hasAttribute("data-label")?this.label.setAttribute("data-label",j.getAttribute("data-label")):this.label.removeAttribute("data-label"),F))){if(typeof Event=="function")this.select.dispatchEvent(new Event("change"));else if((typeof Event>"u"?"undefined":l(Event))==="object"){var U=document.createEvent("Event");U.initEvent("change",!0,!0),this.select.dispatchEvent(U)}this.close()}}},{key:"update",value:function(){var j=void 0;if(this.select.selectedIndex>-1){var F=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];j=this.select.options[this.select.selectedIndex],this.selectItem(F)}else this.selectItem(null);var B=j!=null&&j!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",B)}}]),R}();n.default=k},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(0),d=Se(l),i=o(5),g=Se(i),x=o(4),S=Se(x),E=o(16),A=Se(E),C=o(25),N=Se(C),k=o(24),R=Se(k),L=o(35),j=Se(L),F=o(6),B=Se(F),U=o(22),Z=Se(U),X=o(7),te=Se(X),se=o(55),oe=Se(se),ne=o(42),ee=Se(ne),ie=o(23),he=Se(ie);function Se(Ce){return Ce&&Ce.__esModule?Ce:{default:Ce}}g.default.register({"blots/block":S.default,"blots/block/embed":x.BlockEmbed,"blots/break":A.default,"blots/container":N.default,"blots/cursor":R.default,"blots/embed":j.default,"blots/inline":B.default,"blots/scroll":Z.default,"blots/text":te.default,"modules/clipboard":oe.default,"modules/history":ee.default,"modules/keyboard":he.default}),d.default.register(S.default,A.default,R.default,B.default,Z.default,te.default),n.default=g.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(1),d=function(){function i(g){this.domNode=g,this.domNode[l.DATA_KEY]={blot:this}}return Object.defineProperty(i.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),i.create=function(g){if(this.tagName==null)throw new l.ParchmentError("Blot definition missing tagName");var x;return Array.isArray(this.tagName)?(typeof g=="string"&&(g=g.toUpperCase(),parseInt(g).toString()===g&&(g=parseInt(g))),typeof g=="number"?x=document.createElement(this.tagName[g-1]):this.tagName.indexOf(g)>-1?x=document.createElement(g):x=document.createElement(this.tagName[0])):x=document.createElement(this.tagName),this.className&&x.classList.add(this.className),x},i.prototype.attach=function(){this.parent!=null&&(this.scroll=this.parent.scroll)},i.prototype.clone=function(){var g=this.domNode.cloneNode(!1);return l.create(g)},i.prototype.detach=function(){this.parent!=null&&this.parent.removeChild(this),delete this.domNode[l.DATA_KEY]},i.prototype.deleteAt=function(g,x){var S=this.isolate(g,x);S.remove()},i.prototype.formatAt=function(g,x,S,E){var A=this.isolate(g,x);if(l.query(S,l.Scope.BLOT)!=null&&E)A.wrap(S,E);else if(l.query(S,l.Scope.ATTRIBUTE)!=null){var C=l.create(this.statics.scope);A.wrap(C),C.format(S,E)}},i.prototype.insertAt=function(g,x,S){var E=S==null?l.create("text",x):l.create(x,S),A=this.split(g);this.parent.insertBefore(E,A)},i.prototype.insertInto=function(g,x){x===void 0&&(x=null),this.parent!=null&&this.parent.children.remove(this);var S=null;g.children.insertBefore(this,x),x!=null&&(S=x.domNode),(this.domNode.parentNode!=g.domNode||this.domNode.nextSibling!=S)&&g.domNode.insertBefore(this.domNode,S),this.parent=g,this.attach()},i.prototype.isolate=function(g,x){var S=this.split(g);return S.split(x),S},i.prototype.length=function(){return 1},i.prototype.offset=function(g){return g===void 0&&(g=this.parent),this.parent==null||this==g?0:this.parent.children.offset(this)+this.parent.offset(g)},i.prototype.optimize=function(g){this.domNode[l.DATA_KEY]!=null&&delete this.domNode[l.DATA_KEY].mutations},i.prototype.remove=function(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},i.prototype.replace=function(g){g.parent!=null&&(g.parent.insertBefore(this,g.next),g.remove())},i.prototype.replaceWith=function(g,x){var S=typeof g=="string"?l.create(g,x):g;return S.replace(this),S},i.prototype.split=function(g,x){return g===0?this:this.next},i.prototype.update=function(g,x){},i.prototype.wrap=function(g,x){var S=typeof g=="string"?l.create(g,x):g;return this.parent!=null&&this.parent.insertBefore(S,this.next),S.appendChild(this),S},i.blotName="abstract",i}();n.default=d},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(12),d=o(32),i=o(33),g=o(1),x=function(){function S(E){this.attributes={},this.domNode=E,this.build()}return S.prototype.attribute=function(E,A){A?E.add(this.domNode,A)&&(E.value(this.domNode)!=null?this.attributes[E.attrName]=E:delete this.attributes[E.attrName]):(E.remove(this.domNode),delete this.attributes[E.attrName])},S.prototype.build=function(){var E=this;this.attributes={};var A=l.default.keys(this.domNode),C=d.default.keys(this.domNode),N=i.default.keys(this.domNode);A.concat(C).concat(N).forEach(function(k){var R=g.query(k,g.Scope.ATTRIBUTE);R instanceof l.default&&(E.attributes[R.attrName]=R)})},S.prototype.copy=function(E){var A=this;Object.keys(this.attributes).forEach(function(C){var N=A.attributes[C].value(A.domNode);E.format(C,N)})},S.prototype.move=function(E){var A=this;this.copy(E),Object.keys(this.attributes).forEach(function(C){A.attributes[C].remove(A.domNode)}),this.attributes={}},S.prototype.values=function(){var E=this;return Object.keys(this.attributes).reduce(function(A,C){return A[C]=E.attributes[C].value(E.domNode),A},{})},S}();n.default=x},function(r,n,o){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var A in E)E.hasOwnProperty(A)&&(S[A]=E[A])};return function(S,E){x(S,E);function A(){this.constructor=S}S.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12);function i(x,S){var E=x.getAttribute("class")||"";return E.split(/\s+/).filter(function(A){return A.indexOf(S+"-")===0})}var g=function(x){l(S,x);function S(){return x!==null&&x.apply(this,arguments)||this}return S.keys=function(E){return(E.getAttribute("class")||"").split(/\s+/).map(function(A){return A.split("-").slice(0,-1).join("-")})},S.prototype.add=function(E,A){return this.canAdd(E,A)?(this.remove(E),E.classList.add(this.keyName+"-"+A),!0):!1},S.prototype.remove=function(E){var A=i(E,this.keyName);A.forEach(function(C){E.classList.remove(C)}),E.classList.length===0&&E.removeAttribute("class")},S.prototype.value=function(E){var A=i(E,this.keyName)[0]||"",C=A.slice(this.keyName.length+1);return this.canAdd(E,C)?C:""},S}(d.default);n.default=g},function(r,n,o){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var A in E)E.hasOwnProperty(A)&&(S[A]=E[A])};return function(S,E){x(S,E);function A(){this.constructor=S}S.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(12);function i(x){var S=x.split("-"),E=S.slice(1).map(function(A){return A[0].toUpperCase()+A.slice(1)}).join("");return S[0]+E}var g=function(x){l(S,x);function S(){return x!==null&&x.apply(this,arguments)||this}return S.keys=function(E){return(E.getAttribute("style")||"").split(";").map(function(A){var C=A.split(":");return C[0].trim()})},S.prototype.add=function(E,A){return this.canAdd(E,A)?(E.style[i(this.keyName)]=A,!0):!1},S.prototype.remove=function(E){E.style[i(this.keyName)]="",E.getAttribute("style")||E.removeAttribute("style")},S.prototype.value=function(E){var A=E.style[i(this.keyName)];return this.canAdd(E,A)?A:""},S}(d.default);n.default=g},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function g(x,S){for(var E=0;E<S.length;E++){var A=S[E];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(x,A.key,A)}}return function(x,S,E){return S&&g(x.prototype,S),E&&g(x,E),x}}();function d(g,x){if(!(g instanceof x))throw new TypeError("Cannot call a class as a function")}var i=function(){function g(x,S){d(this,g),this.quill=x,this.options=S,this.modules={}}return l(g,[{key:"init",value:function(){var S=this;Object.keys(this.options.modules).forEach(function(E){S.modules[E]==null&&S.addModule(E)})}},{key:"addModule",value:function(S){var E=this.quill.constructor.import("modules/"+S);return this.modules[S]=new E(this.quill,this.options.modules[S]||{}),this.modules[S]}}]),g}();i.DEFAULTS={modules:{}},i.themes={default:i},n.default=i},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function L(j,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(j,U.key,U)}}return function(j,F,B){return F&&L(j.prototype,F),B&&L(j,B),j}}(),d=function L(j,F,B){j===null&&(j=Function.prototype);var U=Object.getOwnPropertyDescriptor(j,F);if(U===void 0){var Z=Object.getPrototypeOf(j);return Z===null?void 0:L(Z,F,B)}else{if("value"in U)return U.value;var X=U.get;return X===void 0?void 0:X.call(B)}},i=o(0),g=E(i),x=o(7),S=E(x);function E(L){return L&&L.__esModule?L:{default:L}}function A(L,j){if(!(L instanceof j))throw new TypeError("Cannot call a class as a function")}function C(L,j){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:L}function N(L,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);L.prototype=Object.create(j&&j.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(L,j):L.__proto__=j)}var k="\uFEFF",R=function(L){N(j,L);function j(F){A(this,j);var B=C(this,(j.__proto__||Object.getPrototypeOf(j)).call(this,F));return B.contentNode=document.createElement("span"),B.contentNode.setAttribute("contenteditable",!1),[].slice.call(B.domNode.childNodes).forEach(function(U){B.contentNode.appendChild(U)}),B.leftGuard=document.createTextNode(k),B.rightGuard=document.createTextNode(k),B.domNode.appendChild(B.leftGuard),B.domNode.appendChild(B.contentNode),B.domNode.appendChild(B.rightGuard),B}return l(j,[{key:"index",value:function(B,U){return B===this.leftGuard?0:B===this.rightGuard?1:d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"index",this).call(this,B,U)}},{key:"restore",value:function(B){var U=void 0,Z=void 0,X=B.data.split(k).join("");if(B===this.leftGuard)if(this.prev instanceof S.default){var te=this.prev.length();this.prev.insertAt(te,X),U={startNode:this.prev.domNode,startOffset:te+X.length}}else Z=document.createTextNode(X),this.parent.insertBefore(g.default.create(Z),this),U={startNode:Z,startOffset:X.length};else B===this.rightGuard&&(this.next instanceof S.default?(this.next.insertAt(0,X),U={startNode:this.next.domNode,startOffset:X.length}):(Z=document.createTextNode(X),this.parent.insertBefore(g.default.create(Z),this.next),U={startNode:Z,startOffset:X.length}));return B.data=k,U}},{key:"update",value:function(B,U){var Z=this;B.forEach(function(X){if(X.type==="characterData"&&(X.target===Z.leftGuard||X.target===Z.rightGuard)){var te=Z.restore(X.target);te&&(U.range=te)}})}}]),j}(g.default.Embed);n.default=R},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.AlignStyle=n.AlignClass=n.AlignAttribute=void 0;var l=o(0),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}var g={scope:d.default.Scope.BLOCK,whitelist:["right","center","justify"]},x=new d.default.Attributor.Attribute("align","align",g),S=new d.default.Attributor.Class("align","ql-align",g),E=new d.default.Attributor.Style("align","text-align",g);n.AlignAttribute=x,n.AlignClass=S,n.AlignStyle=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.BackgroundStyle=n.BackgroundClass=void 0;var l=o(0),d=g(l),i=o(26);function g(E){return E&&E.__esModule?E:{default:E}}var x=new d.default.Attributor.Class("background","ql-bg",{scope:d.default.Scope.INLINE}),S=new i.ColorAttributor("background","background-color",{scope:d.default.Scope.INLINE});n.BackgroundClass=x,n.BackgroundStyle=S},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.DirectionStyle=n.DirectionClass=n.DirectionAttribute=void 0;var l=o(0),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}var g={scope:d.default.Scope.BLOCK,whitelist:["rtl"]},x=new d.default.Attributor.Attribute("direction","dir",g),S=new d.default.Attributor.Class("direction","ql-direction",g),E=new d.default.Attributor.Style("direction","direction",g);n.DirectionAttribute=x,n.DirectionClass=S,n.DirectionStyle=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.FontClass=n.FontStyle=void 0;var l=function(){function L(j,F){for(var B=0;B<F.length;B++){var U=F[B];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(j,U.key,U)}}return function(j,F,B){return F&&L(j.prototype,F),B&&L(j,B),j}}(),d=function L(j,F,B){j===null&&(j=Function.prototype);var U=Object.getOwnPropertyDescriptor(j,F);if(U===void 0){var Z=Object.getPrototypeOf(j);return Z===null?void 0:L(Z,F,B)}else{if("value"in U)return U.value;var X=U.get;return X===void 0?void 0:X.call(B)}},i=o(0),g=x(i);function x(L){return L&&L.__esModule?L:{default:L}}function S(L,j){if(!(L instanceof j))throw new TypeError("Cannot call a class as a function")}function E(L,j){if(!L)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return j&&(typeof j=="object"||typeof j=="function")?j:L}function A(L,j){if(typeof j!="function"&&j!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof j);L.prototype=Object.create(j&&j.prototype,{constructor:{value:L,enumerable:!1,writable:!0,configurable:!0}}),j&&(Object.setPrototypeOf?Object.setPrototypeOf(L,j):L.__proto__=j)}var C={scope:g.default.Scope.INLINE,whitelist:["serif","monospace"]},N=new g.default.Attributor.Class("font","ql-font",C),k=function(L){A(j,L);function j(){return S(this,j),E(this,(j.__proto__||Object.getPrototypeOf(j)).apply(this,arguments))}return l(j,[{key:"value",value:function(B){return d(j.prototype.__proto__||Object.getPrototypeOf(j.prototype),"value",this).call(this,B).replace(/["']/g,"")}}]),j}(g.default.Attributor.Style),R=new k("font","font-family",C);n.FontStyle=R,n.FontClass=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.SizeStyle=n.SizeClass=void 0;var l=o(0),d=i(l);function i(S){return S&&S.__esModule?S:{default:S}}var g=new d.default.Attributor.Class("size","ql-size",{scope:d.default.Scope.INLINE,whitelist:["small","large","huge"]}),x=new d.default.Attributor.Style("size","font-size",{scope:d.default.Scope.INLINE,whitelist:["10px","18px","32px"]});n.SizeClass=g,n.SizeStyle=x},function(r,n,o){r.exports={align:{"":o(76),center:o(77),right:o(78),justify:o(79)},background:o(80),blockquote:o(81),bold:o(82),clean:o(83),code:o(58),"code-block":o(58),color:o(84),direction:{"":o(85),rtl:o(86)},float:{center:o(87),full:o(88),left:o(89),right:o(90)},formula:o(91),header:{1:o(92),2:o(93)},italic:o(94),image:o(95),indent:{"+1":o(96),"-1":o(97)},link:o(98),list:{ordered:o(99),bullet:o(100),check:o(101)},script:{sub:o(102),super:o(103)},strike:o(104),underline:o(105),video:o(106)}},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.getLastChangeIndex=n.default=void 0;var l=function(){function F(B,U){for(var Z=0;Z<U.length;Z++){var X=U[Z];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(B,X.key,X)}}return function(B,U,Z){return U&&F(B.prototype,U),Z&&F(B,Z),B}}(),d=o(0),i=A(d),g=o(5),x=A(g),S=o(9),E=A(S);function A(F){return F&&F.__esModule?F:{default:F}}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function N(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function k(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var R=function(F){k(B,F);function B(U,Z){C(this,B);var X=N(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,U,Z));return X.lastRecorded=0,X.ignoreChange=!1,X.clear(),X.quill.on(x.default.events.EDITOR_CHANGE,function(te,se,oe,ne){te!==x.default.events.TEXT_CHANGE||X.ignoreChange||(!X.options.userOnly||ne===x.default.sources.USER?X.record(se,oe):X.transform(se))}),X.quill.keyboard.addBinding({key:"Z",shortKey:!0},X.undo.bind(X)),X.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},X.redo.bind(X)),/Win/i.test(navigator.platform)&&X.quill.keyboard.addBinding({key:"Y",shortKey:!0},X.redo.bind(X)),X}return l(B,[{key:"change",value:function(Z,X){if(this.stack[Z].length!==0){var te=this.stack[Z].pop();this.stack[X].push(te),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(te[Z],x.default.sources.USER),this.ignoreChange=!1;var se=j(te[Z]);this.quill.setSelection(se)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(Z,X){if(Z.ops.length!==0){this.stack.redo=[];var te=this.quill.getContents().diff(X),se=Date.now();if(this.lastRecorded+this.options.delay>se&&this.stack.undo.length>0){var oe=this.stack.undo.pop();te=te.compose(oe.undo),Z=oe.redo.compose(Z)}else this.lastRecorded=se;this.stack.undo.push({redo:Z,undo:te}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(Z){this.stack.undo.forEach(function(X){X.undo=Z.transform(X.undo,!0),X.redo=Z.transform(X.redo,!0)}),this.stack.redo.forEach(function(X){X.undo=Z.transform(X.undo,!0),X.redo=Z.transform(X.redo,!0)})}},{key:"undo",value:function(){this.change("undo","redo")}}]),B}(E.default);R.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};function L(F){var B=F.ops[F.ops.length-1];return B==null?!1:B.insert!=null?typeof B.insert=="string"&&B.insert.endsWith(`
`):B.attributes!=null?Object.keys(B.attributes).some(function(U){return i.default.query(U,i.default.Scope.BLOCK)!=null}):!1}function j(F){var B=F.reduce(function(Z,X){return Z+=X.delete||0,Z},0),U=F.length()-B;return L(F)&&(U-=1),U}n.default=R,n.getLastChangeIndex=j},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BaseTooltip=void 0;var l=function(){function ge(ke,Qe){for(var He=0;He<Qe.length;He++){var $e=Qe[He];$e.enumerable=$e.enumerable||!1,$e.configurable=!0,"value"in $e&&($e.writable=!0),Object.defineProperty(ke,$e.key,$e)}}return function(ke,Qe,He){return Qe&&ge(ke.prototype,Qe),He&&ge(ke,He),ke}}(),d=function ge(ke,Qe,He){ke===null&&(ke=Function.prototype);var $e=Object.getOwnPropertyDescriptor(ke,Qe);if($e===void 0){var Xe=Object.getPrototypeOf(ke);return Xe===null?void 0:ge(Xe,Qe,He)}else{if("value"in $e)return $e.value;var ft=$e.get;return ft===void 0?void 0:ft.call(He)}},i=o(3),g=se(i),x=o(2),S=se(x),E=o(8),A=se(E),C=o(23),N=se(C),k=o(34),R=se(k),L=o(59),j=se(L),F=o(60),B=se(F),U=o(28),Z=se(U),X=o(61),te=se(X);function se(ge){return ge&&ge.__esModule?ge:{default:ge}}function oe(ge,ke){if(!(ge instanceof ke))throw new TypeError("Cannot call a class as a function")}function ne(ge,ke){if(!ge)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ke&&(typeof ke=="object"||typeof ke=="function")?ke:ge}function ee(ge,ke){if(typeof ke!="function"&&ke!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ke);ge.prototype=Object.create(ke&&ke.prototype,{constructor:{value:ge,enumerable:!1,writable:!0,configurable:!0}}),ke&&(Object.setPrototypeOf?Object.setPrototypeOf(ge,ke):ge.__proto__=ke)}var ie=[!1,"center","right","justify"],he=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],Se=[!1,"serif","monospace"],Ce=["1","2","3",!1],fe=["small",!1,"large","huge"],_e=function(ge){ee(ke,ge);function ke(Qe,He){oe(this,ke);var $e=ne(this,(ke.__proto__||Object.getPrototypeOf(ke)).call(this,Qe,He)),Xe=function ft(ze){if(!document.body.contains(Qe.root))return document.body.removeEventListener("click",ft);$e.tooltip!=null&&!$e.tooltip.root.contains(ze.target)&&document.activeElement!==$e.tooltip.textbox&&!$e.quill.hasFocus()&&$e.tooltip.hide(),$e.pickers!=null&&$e.pickers.forEach(function(ut){ut.container.contains(ze.target)||ut.close()})};return Qe.emitter.listenDOM("click",document.body,Xe),$e}return l(ke,[{key:"addModule",value:function(He){var $e=d(ke.prototype.__proto__||Object.getPrototypeOf(ke.prototype),"addModule",this).call(this,He);return He==="toolbar"&&this.extendToolbar($e),$e}},{key:"buildButtons",value:function(He,$e){He.forEach(function(Xe){var ft=Xe.getAttribute("class")||"";ft.split(/\s+/).forEach(function(ze){if(ze.startsWith("ql-")&&(ze=ze.slice(3),$e[ze]!=null))if(ze==="direction")Xe.innerHTML=$e[ze][""]+$e[ze].rtl;else if(typeof $e[ze]=="string")Xe.innerHTML=$e[ze];else{var ut=Xe.value||"";ut!=null&&$e[ze][ut]&&(Xe.innerHTML=$e[ze][ut])}})})}},{key:"buildPickers",value:function(He,$e){var Xe=this;this.pickers=He.map(function(ze){if(ze.classList.contains("ql-align"))return ze.querySelector("option")==null&&ye(ze,ie),new B.default(ze,$e.align);if(ze.classList.contains("ql-background")||ze.classList.contains("ql-color")){var ut=ze.classList.contains("ql-background")?"background":"color";return ze.querySelector("option")==null&&ye(ze,he,ut==="background"?"#ffffff":"#000000"),new j.default(ze,$e[ut])}else return ze.querySelector("option")==null&&(ze.classList.contains("ql-font")?ye(ze,Se):ze.classList.contains("ql-header")?ye(ze,Ce):ze.classList.contains("ql-size")&&ye(ze,fe)),new Z.default(ze)});var ft=function(){Xe.pickers.forEach(function(ut){ut.update()})};this.quill.on(A.default.events.EDITOR_CHANGE,ft)}}]),ke}(R.default);_e.DEFAULTS=(0,g.default)(!0,{},R.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var ke=this,Qe=this.container.querySelector("input.ql-image[type=file]");Qe==null&&(Qe=document.createElement("input"),Qe.setAttribute("type","file"),Qe.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),Qe.classList.add("ql-image"),Qe.addEventListener("change",function(){if(Qe.files!=null&&Qe.files[0]!=null){var He=new FileReader;He.onload=function($e){var Xe=ke.quill.getSelection(!0);ke.quill.updateContents(new S.default().retain(Xe.index).delete(Xe.length).insert({image:$e.target.result}),A.default.sources.USER),ke.quill.setSelection(Xe.index+1,A.default.sources.SILENT),Qe.value=""},He.readAsDataURL(Qe.files[0])}}),this.container.appendChild(Qe)),Qe.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var be=function(ge){ee(ke,ge);function ke(Qe,He){oe(this,ke);var $e=ne(this,(ke.__proto__||Object.getPrototypeOf(ke)).call(this,Qe,He));return $e.textbox=$e.root.querySelector('input[type="text"]'),$e.listen(),$e}return l(ke,[{key:"listen",value:function(){var He=this;this.textbox.addEventListener("keydown",function($e){N.default.match($e,"enter")?(He.save(),$e.preventDefault()):N.default.match($e,"escape")&&(He.cancel(),$e.preventDefault())})}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var He=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",$e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),$e!=null?this.textbox.value=$e:He!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+He)||""),this.root.setAttribute("data-mode",He)}},{key:"restoreFocus",value:function(){var He=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=He}},{key:"save",value:function(){var He=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{var $e=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",He,A.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",He,A.default.sources.USER)),this.quill.root.scrollTop=$e;break}case"video":He=Pe(He);case"formula":{if(!He)break;var Xe=this.quill.getSelection(!0);if(Xe!=null){var ft=Xe.index+Xe.length;this.quill.insertEmbed(ft,this.root.getAttribute("data-mode"),He,A.default.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(ft+1," ",A.default.sources.USER),this.quill.setSelection(ft+2,A.default.sources.USER)}break}}this.textbox.value="",this.hide()}}]),ke}(te.default);function Pe(ge){var ke=ge.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||ge.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return ke?(ke[1]||"https")+"://www.youtube.com/embed/"+ke[2]+"?showinfo=0":(ke=ge.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(ke[1]||"https")+"://player.vimeo.com/video/"+ke[2]+"/":ge}function ye(ge,ke){var Qe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;ke.forEach(function(He){var $e=document.createElement("option");He===Qe?$e.setAttribute("selected","selected"):$e.setAttribute("value",He),ge.appendChild($e)})}n.BaseTooltip=be,n.default=_e},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function d(){this.head=this.tail=null,this.length=0}return d.prototype.append=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];this.insertBefore(i[0],null),i.length>1&&this.append.apply(this,i.slice(1))},d.prototype.contains=function(i){for(var g,x=this.iterator();g=x();)if(g===i)return!0;return!1},d.prototype.insertBefore=function(i,g){i&&(i.next=g,g!=null?(i.prev=g.prev,g.prev!=null&&(g.prev.next=i),g.prev=i,g===this.head&&(this.head=i)):this.tail!=null?(this.tail.next=i,i.prev=this.tail,this.tail=i):(i.prev=null,this.head=this.tail=i),this.length+=1)},d.prototype.offset=function(i){for(var g=0,x=this.head;x!=null;){if(x===i)return g;g+=x.length(),x=x.next}return-1},d.prototype.remove=function(i){this.contains(i)&&(i.prev!=null&&(i.prev.next=i.next),i.next!=null&&(i.next.prev=i.prev),i===this.head&&(this.head=i.next),i===this.tail&&(this.tail=i.prev),this.length-=1)},d.prototype.iterator=function(i){return i===void 0&&(i=this.head),function(){var g=i;return i!=null&&(i=i.next),g}},d.prototype.find=function(i,g){g===void 0&&(g=!1);for(var x,S=this.iterator();x=S();){var E=x.length();if(i<E||g&&i===E&&(x.next==null||x.next.length()!==0))return[x,i];i-=E}return[null,0]},d.prototype.forEach=function(i){for(var g,x=this.iterator();g=x();)i(g)},d.prototype.forEachAt=function(i,g,x){if(!(g<=0))for(var S=this.find(i),E=S[0],A=S[1],C,N=i-A,k=this.iterator(E);(C=k())&&N<i+g;){var R=C.length();i>N?x(C,i-N,Math.min(g,N+R-i)):x(C,0,Math.min(R,i+g-N)),N+=R}},d.prototype.map=function(i){return this.reduce(function(g,x){return g.push(i(x)),g},[])},d.prototype.reduce=function(i,g){for(var x,S=this.iterator();x=S();)g=i(g,x);return g},d}();n.default=l},function(r,n,o){var l=this&&this.__extends||function(){var E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,C){A.__proto__=C}||function(A,C){for(var N in C)C.hasOwnProperty(N)&&(A[N]=C[N])};return function(A,C){E(A,C);function N(){this.constructor=A}A.prototype=C===null?Object.create(C):(N.prototype=C.prototype,new N)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(17),i=o(1),g={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},x=100,S=function(E){l(A,E);function A(C){var N=E.call(this,C)||this;return N.scroll=N,N.observer=new MutationObserver(function(k){N.update(k)}),N.observer.observe(N.domNode,g),N.attach(),N}return A.prototype.detach=function(){E.prototype.detach.call(this),this.observer.disconnect()},A.prototype.deleteAt=function(C,N){this.update(),C===0&&N===this.length()?this.children.forEach(function(k){k.remove()}):E.prototype.deleteAt.call(this,C,N)},A.prototype.formatAt=function(C,N,k,R){this.update(),E.prototype.formatAt.call(this,C,N,k,R)},A.prototype.insertAt=function(C,N,k){this.update(),E.prototype.insertAt.call(this,C,N,k)},A.prototype.optimize=function(C,N){var k=this;C===void 0&&(C=[]),N===void 0&&(N={}),E.prototype.optimize.call(this,N);for(var R=[].slice.call(this.observer.takeRecords());R.length>0;)C.push(R.pop());for(var L=function(U,Z){Z===void 0&&(Z=!0),!(U==null||U===k)&&U.domNode.parentNode!=null&&(U.domNode[i.DATA_KEY].mutations==null&&(U.domNode[i.DATA_KEY].mutations=[]),Z&&L(U.parent))},j=function(U){U.domNode[i.DATA_KEY]==null||U.domNode[i.DATA_KEY].mutations==null||(U instanceof d.default&&U.children.forEach(j),U.optimize(N))},F=C,B=0;F.length>0;B+=1){if(B>=x)throw new Error("[Parchment] Maximum optimize iterations reached");for(F.forEach(function(U){var Z=i.find(U.target,!0);Z!=null&&(Z.domNode===U.target&&(U.type==="childList"?(L(i.find(U.previousSibling,!1)),[].forEach.call(U.addedNodes,function(X){var te=i.find(X,!1);L(te,!1),te instanceof d.default&&te.children.forEach(function(se){L(se,!1)})})):U.type==="attributes"&&L(Z.prev)),L(Z))}),this.children.forEach(j),F=[].slice.call(this.observer.takeRecords()),R=F.slice();R.length>0;)C.push(R.pop())}},A.prototype.update=function(C,N){var k=this;N===void 0&&(N={}),C=C||this.observer.takeRecords(),C.map(function(R){var L=i.find(R.target,!0);return L==null?null:L.domNode[i.DATA_KEY].mutations==null?(L.domNode[i.DATA_KEY].mutations=[R],L):(L.domNode[i.DATA_KEY].mutations.push(R),null)}).forEach(function(R){R==null||R===k||R.domNode[i.DATA_KEY]==null||R.update(R.domNode[i.DATA_KEY].mutations||[],N)}),this.domNode[i.DATA_KEY].mutations!=null&&E.prototype.update.call(this,this.domNode[i.DATA_KEY].mutations,N),this.optimize(C,N)},A.blotName="scroll",A.defaultChild="block",A.scope=i.Scope.BLOCK_BLOT,A.tagName="DIV",A}(d.default);n.default=S},function(r,n,o){var l=this&&this.__extends||function(){var S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,A){E.__proto__=A}||function(E,A){for(var C in A)A.hasOwnProperty(C)&&(E[C]=A[C])};return function(E,A){S(E,A);function C(){this.constructor=E}E.prototype=A===null?Object.create(A):(C.prototype=A.prototype,new C)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(18),i=o(1);function g(S,E){if(Object.keys(S).length!==Object.keys(E).length)return!1;for(var A in S)if(S[A]!==E[A])return!1;return!0}var x=function(S){l(E,S);function E(){return S!==null&&S.apply(this,arguments)||this}return E.formats=function(A){if(A.tagName!==E.tagName)return S.formats.call(this,A)},E.prototype.format=function(A,C){var N=this;A===this.statics.blotName&&!C?(this.children.forEach(function(k){k instanceof d.default||(k=k.wrap(E.blotName,!0)),N.attributes.copy(k)}),this.unwrap()):S.prototype.format.call(this,A,C)},E.prototype.formatAt=function(A,C,N,k){if(this.formats()[N]!=null||i.query(N,i.Scope.ATTRIBUTE)){var R=this.isolate(A,C);R.format(N,k)}else S.prototype.formatAt.call(this,A,C,N,k)},E.prototype.optimize=function(A){S.prototype.optimize.call(this,A);var C=this.formats();if(Object.keys(C).length===0)return this.unwrap();var N=this.next;N instanceof E&&N.prev===this&&g(C,N.formats())&&(N.moveChildren(this),N.remove())},E.blotName="inline",E.scope=i.Scope.INLINE_BLOT,E.tagName="SPAN",E}(d.default);n.default=x},function(r,n,o){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var A in E)E.hasOwnProperty(A)&&(S[A]=E[A])};return function(S,E){x(S,E);function A(){this.constructor=S}S.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(18),i=o(1),g=function(x){l(S,x);function S(){return x!==null&&x.apply(this,arguments)||this}return S.formats=function(E){var A=i.query(S.blotName).tagName;if(E.tagName!==A)return x.formats.call(this,E)},S.prototype.format=function(E,A){i.query(E,i.Scope.BLOCK)!=null&&(E===this.statics.blotName&&!A?this.replaceWith(S.blotName):x.prototype.format.call(this,E,A))},S.prototype.formatAt=function(E,A,C,N){i.query(C,i.Scope.BLOCK)!=null?this.format(C,N):x.prototype.formatAt.call(this,E,A,C,N)},S.prototype.insertAt=function(E,A,C){if(C==null||i.query(A,i.Scope.INLINE)!=null)x.prototype.insertAt.call(this,E,A,C);else{var N=this.split(E),k=i.create(A,C);N.parent.insertBefore(k,N)}},S.prototype.update=function(E,A){navigator.userAgent.match(/Trident/)?this.build():x.prototype.update.call(this,E,A)},S.blotName="block",S.scope=i.Scope.BLOCK_BLOT,S.tagName="P",S}(d.default);n.default=g},function(r,n,o){var l=this&&this.__extends||function(){var g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,S){x.__proto__=S}||function(x,S){for(var E in S)S.hasOwnProperty(E)&&(x[E]=S[E])};return function(x,S){g(x,S);function E(){this.constructor=x}x.prototype=S===null?Object.create(S):(E.prototype=S.prototype,new E)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(19),i=function(g){l(x,g);function x(){return g!==null&&g.apply(this,arguments)||this}return x.formats=function(S){},x.prototype.format=function(S,E){g.prototype.formatAt.call(this,0,this.length(),S,E)},x.prototype.formatAt=function(S,E,A,C){S===0&&E===this.length()?this.format(A,C):g.prototype.formatAt.call(this,S,E,A,C)},x.prototype.formats=function(){return this.statics.formats(this.domNode)},x}(d.default);n.default=i},function(r,n,o){var l=this&&this.__extends||function(){var x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,E){S.__proto__=E}||function(S,E){for(var A in E)E.hasOwnProperty(A)&&(S[A]=E[A])};return function(S,E){x(S,E);function A(){this.constructor=S}S.prototype=E===null?Object.create(E):(A.prototype=E.prototype,new A)}}();Object.defineProperty(n,"__esModule",{value:!0});var d=o(19),i=o(1),g=function(x){l(S,x);function S(E){var A=x.call(this,E)||this;return A.text=A.statics.value(A.domNode),A}return S.create=function(E){return document.createTextNode(E)},S.value=function(E){var A=E.data;return A.normalize&&(A=A.normalize()),A},S.prototype.deleteAt=function(E,A){this.domNode.data=this.text=this.text.slice(0,E)+this.text.slice(E+A)},S.prototype.index=function(E,A){return this.domNode===E?A:-1},S.prototype.insertAt=function(E,A,C){C==null?(this.text=this.text.slice(0,E)+A+this.text.slice(E),this.domNode.data=this.text):x.prototype.insertAt.call(this,E,A,C)},S.prototype.length=function(){return this.text.length},S.prototype.optimize=function(E){x.prototype.optimize.call(this,E),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof S&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},S.prototype.position=function(E,A){return[this.domNode,E]},S.prototype.split=function(E,A){if(A===void 0&&(A=!1),!A){if(E===0)return this;if(E===this.length())return this.next}var C=i.create(this.domNode.splitText(E));return this.parent.insertBefore(C,this.next),this.text=this.statics.value(this.domNode),C},S.prototype.update=function(E,A){var C=this;E.some(function(N){return N.type==="characterData"&&N.target===C.domNode})&&(this.text=this.statics.value(this.domNode))},S.prototype.value=function(){return this.text},S.blotName="text",S.scope=i.Scope.INLINE_BLOT,S}(d.default);n.default=g},function(r,n,o){var l=document.createElement("div");if(l.classList.toggle("test-class",!1),l.classList.contains("test-class")){var d=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(i,g){return arguments.length>1&&!this.contains(i)==!g?g:d.call(this,i)}}String.prototype.startsWith||(String.prototype.startsWith=function(i,g){return g=g||0,this.substr(g,i.length)===i}),String.prototype.endsWith||(String.prototype.endsWith=function(i,g){var x=this.toString();(typeof g!="number"||!isFinite(g)||Math.floor(g)!==g||g>x.length)&&(g=x.length),g-=i.length;var S=x.indexOf(i,g);return S!==-1&&S===g}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(g){if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof g!="function")throw new TypeError("predicate must be a function");for(var x=Object(this),S=x.length>>>0,E=arguments[1],A,C=0;C<S;C++)if(A=x[C],g.call(E,A,C,x))return A}}),document.addEventListener("DOMContentLoaded",function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)})},function(r,n){var o=-1,l=1,d=0;function i(B,U,Z){if(B==U)return B?[[d,B]]:[];(Z<0||B.length<Z)&&(Z=null);var X=E(B,U),te=B.substring(0,X);B=B.substring(X),U=U.substring(X),X=A(B,U);var se=B.substring(B.length-X);B=B.substring(0,B.length-X),U=U.substring(0,U.length-X);var oe=g(B,U);return te&&oe.unshift([d,te]),se&&oe.push([d,se]),N(oe),Z!=null&&(oe=L(oe,Z)),oe=j(oe),oe}function g(B,U){var Z;if(!B)return[[l,U]];if(!U)return[[o,B]];var X=B.length>U.length?B:U,te=B.length>U.length?U:B,se=X.indexOf(te);if(se!=-1)return Z=[[l,X.substring(0,se)],[d,te],[l,X.substring(se+te.length)]],B.length>U.length&&(Z[0][0]=Z[2][0]=o),Z;if(te.length==1)return[[o,B],[l,U]];var oe=C(B,U);if(oe){var ne=oe[0],ee=oe[1],ie=oe[2],he=oe[3],Se=oe[4],Ce=i(ne,ie),fe=i(ee,he);return Ce.concat([[d,Se]],fe)}return x(B,U)}function x(B,U){for(var Z=B.length,X=U.length,te=Math.ceil((Z+X)/2),se=te,oe=2*te,ne=new Array(oe),ee=new Array(oe),ie=0;ie<oe;ie++)ne[ie]=-1,ee[ie]=-1;ne[se+1]=0,ee[se+1]=0;for(var he=Z-X,Se=he%2!=0,Ce=0,fe=0,_e=0,be=0,Pe=0;Pe<te;Pe++){for(var ye=-Pe+Ce;ye<=Pe-fe;ye+=2){var ge=se+ye,ke;ye==-Pe||ye!=Pe&&ne[ge-1]<ne[ge+1]?ke=ne[ge+1]:ke=ne[ge-1]+1;for(var Qe=ke-ye;ke<Z&&Qe<X&&B.charAt(ke)==U.charAt(Qe);)ke++,Qe++;if(ne[ge]=ke,ke>Z)fe+=2;else if(Qe>X)Ce+=2;else if(Se){var He=se+he-ye;if(He>=0&&He<oe&&ee[He]!=-1){var $e=Z-ee[He];if(ke>=$e)return S(B,U,ke,Qe)}}}for(var Xe=-Pe+_e;Xe<=Pe-be;Xe+=2){var He=se+Xe,$e;Xe==-Pe||Xe!=Pe&&ee[He-1]<ee[He+1]?$e=ee[He+1]:$e=ee[He-1]+1;for(var ft=$e-Xe;$e<Z&&ft<X&&B.charAt(Z-$e-1)==U.charAt(X-ft-1);)$e++,ft++;if(ee[He]=$e,$e>Z)be+=2;else if(ft>X)_e+=2;else if(!Se){var ge=se+he-Xe;if(ge>=0&&ge<oe&&ne[ge]!=-1){var ke=ne[ge],Qe=se+ke-ge;if($e=Z-$e,ke>=$e)return S(B,U,ke,Qe)}}}}return[[o,B],[l,U]]}function S(B,U,Z,X){var te=B.substring(0,Z),se=U.substring(0,X),oe=B.substring(Z),ne=U.substring(X),ee=i(te,se),ie=i(oe,ne);return ee.concat(ie)}function E(B,U){if(!B||!U||B.charAt(0)!=U.charAt(0))return 0;for(var Z=0,X=Math.min(B.length,U.length),te=X,se=0;Z<te;)B.substring(se,te)==U.substring(se,te)?(Z=te,se=Z):X=te,te=Math.floor((X-Z)/2+Z);return te}function A(B,U){if(!B||!U||B.charAt(B.length-1)!=U.charAt(U.length-1))return 0;for(var Z=0,X=Math.min(B.length,U.length),te=X,se=0;Z<te;)B.substring(B.length-te,B.length-se)==U.substring(U.length-te,U.length-se)?(Z=te,se=Z):X=te,te=Math.floor((X-Z)/2+Z);return te}function C(B,U){var Z=B.length>U.length?B:U,X=B.length>U.length?U:B;if(Z.length<4||X.length*2<Z.length)return null;function te(fe,_e,be){for(var Pe=fe.substring(be,be+Math.floor(fe.length/4)),ye=-1,ge="",ke,Qe,He,$e;(ye=_e.indexOf(Pe,ye+1))!=-1;){var Xe=E(fe.substring(be),_e.substring(ye)),ft=A(fe.substring(0,be),_e.substring(0,ye));ge.length<ft+Xe&&(ge=_e.substring(ye-ft,ye)+_e.substring(ye,ye+Xe),ke=fe.substring(0,be-ft),Qe=fe.substring(be+Xe),He=_e.substring(0,ye-ft),$e=_e.substring(ye+Xe))}return ge.length*2>=fe.length?[ke,Qe,He,$e,ge]:null}var se=te(Z,X,Math.ceil(Z.length/4)),oe=te(Z,X,Math.ceil(Z.length/2)),ne;if(!se&&!oe)return null;oe?se?ne=se[4].length>oe[4].length?se:oe:ne=oe:ne=se;var ee,ie,he,Se;B.length>U.length?(ee=ne[0],ie=ne[1],he=ne[2],Se=ne[3]):(he=ne[0],Se=ne[1],ee=ne[2],ie=ne[3]);var Ce=ne[4];return[ee,ie,he,Se,Ce]}function N(B){B.push([d,""]);for(var U=0,Z=0,X=0,te="",se="",oe;U<B.length;)switch(B[U][0]){case l:X++,se+=B[U][1],U++;break;case o:Z++,te+=B[U][1],U++;break;case d:Z+X>1?(Z!==0&&X!==0&&(oe=E(se,te),oe!==0&&(U-Z-X>0&&B[U-Z-X-1][0]==d?B[U-Z-X-1][1]+=se.substring(0,oe):(B.splice(0,0,[d,se.substring(0,oe)]),U++),se=se.substring(oe),te=te.substring(oe)),oe=A(se,te),oe!==0&&(B[U][1]=se.substring(se.length-oe)+B[U][1],se=se.substring(0,se.length-oe),te=te.substring(0,te.length-oe))),Z===0?B.splice(U-X,Z+X,[l,se]):X===0?B.splice(U-Z,Z+X,[o,te]):B.splice(U-Z-X,Z+X,[o,te],[l,se]),U=U-Z-X+(Z?1:0)+(X?1:0)+1):U!==0&&B[U-1][0]==d?(B[U-1][1]+=B[U][1],B.splice(U,1)):U++,X=0,Z=0,te="",se="";break}B[B.length-1][1]===""&&B.pop();var ne=!1;for(U=1;U<B.length-1;)B[U-1][0]==d&&B[U+1][0]==d&&(B[U][1].substring(B[U][1].length-B[U-1][1].length)==B[U-1][1]?(B[U][1]=B[U-1][1]+B[U][1].substring(0,B[U][1].length-B[U-1][1].length),B[U+1][1]=B[U-1][1]+B[U+1][1],B.splice(U-1,1),ne=!0):B[U][1].substring(0,B[U+1][1].length)==B[U+1][1]&&(B[U-1][1]+=B[U+1][1],B[U][1]=B[U][1].substring(B[U+1][1].length)+B[U+1][1],B.splice(U+1,1),ne=!0)),U++;ne&&N(B)}var k=i;k.INSERT=l,k.DELETE=o,k.EQUAL=d,r.exports=k;function R(B,U){if(U===0)return[d,B];for(var Z=0,X=0;X<B.length;X++){var te=B[X];if(te[0]===o||te[0]===d){var se=Z+te[1].length;if(U===se)return[X+1,B];if(U<se){B=B.slice();var oe=U-Z,ne=[te[0],te[1].slice(0,oe)],ee=[te[0],te[1].slice(oe)];return B.splice(X,1,ne,ee),[X+1,B]}else Z=se}}throw new Error("cursor_pos is out of bounds!")}function L(B,U){var Z=R(B,U),X=Z[1],te=Z[0],se=X[te],oe=X[te+1];if(se==null)return B;if(se[0]!==d)return B;if(oe!=null&&se[1]+oe[1]===oe[1]+se[1])return X.splice(te,2,oe,se),F(X,te,2);if(oe!=null&&oe[1].indexOf(se[1])===0){X.splice(te,2,[oe[0],se[1]],[0,se[1]]);var ne=oe[1].slice(se[1].length);return ne.length>0&&X.splice(te+2,0,[oe[0],ne]),F(X,te,3)}else return B}function j(B){for(var U=!1,Z=function(oe){return oe.charCodeAt(0)>=56320&&oe.charCodeAt(0)<=57343},X=function(oe){return oe.charCodeAt(oe.length-1)>=55296&&oe.charCodeAt(oe.length-1)<=56319},te=2;te<B.length;te+=1)B[te-2][0]===d&&X(B[te-2][1])&&B[te-1][0]===o&&Z(B[te-1][1])&&B[te][0]===l&&Z(B[te][1])&&(U=!0,B[te-1][1]=B[te-2][1].slice(-1)+B[te-1][1],B[te][1]=B[te-2][1].slice(-1)+B[te][1],B[te-2][1]=B[te-2][1].slice(0,-1));if(!U)return B;for(var se=[],te=0;te<B.length;te+=1)B[te][1].length>0&&se.push(B[te]);return se}function F(B,U,Z){for(var X=U+Z-1;X>=0&&X>=U-1;X--)if(X+1<B.length){var te=B[X],se=B[X+1];te[0]===se[1]&&B.splice(X,2,[te[0],te[1]+se[1]])}return B}},function(r,n){n=r.exports=typeof Object.keys=="function"?Object.keys:o,n.shim=o;function o(l){var d=[];for(var i in l)d.push(i);return d}},function(r,n){var o=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";n=r.exports=o?l:d,n.supported=l;function l(i){return Object.prototype.toString.call(i)=="[object Arguments]"}n.unsupported=d;function d(i){return i&&typeof i=="object"&&typeof i.length=="number"&&Object.prototype.hasOwnProperty.call(i,"callee")&&!Object.prototype.propertyIsEnumerable.call(i,"callee")||!1}},function(r,n){var o=Object.prototype.hasOwnProperty,l="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(l=!1));function i(x,S,E){this.fn=x,this.context=S,this.once=E||!1}function g(){this._events=new d,this._eventsCount=0}g.prototype.eventNames=function(){var S=[],E,A;if(this._eventsCount===0)return S;for(A in E=this._events)o.call(E,A)&&S.push(l?A.slice(1):A);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(E)):S},g.prototype.listeners=function(S,E){var A=l?l+S:S,C=this._events[A];if(E)return!!C;if(!C)return[];if(C.fn)return[C.fn];for(var N=0,k=C.length,R=new Array(k);N<k;N++)R[N]=C[N].fn;return R},g.prototype.emit=function(S,E,A,C,N,k){var R=l?l+S:S;if(!this._events[R])return!1;var L=this._events[R],j=arguments.length,F,B;if(L.fn){switch(L.once&&this.removeListener(S,L.fn,void 0,!0),j){case 1:return L.fn.call(L.context),!0;case 2:return L.fn.call(L.context,E),!0;case 3:return L.fn.call(L.context,E,A),!0;case 4:return L.fn.call(L.context,E,A,C),!0;case 5:return L.fn.call(L.context,E,A,C,N),!0;case 6:return L.fn.call(L.context,E,A,C,N,k),!0}for(B=1,F=new Array(j-1);B<j;B++)F[B-1]=arguments[B];L.fn.apply(L.context,F)}else{var U=L.length,Z;for(B=0;B<U;B++)switch(L[B].once&&this.removeListener(S,L[B].fn,void 0,!0),j){case 1:L[B].fn.call(L[B].context);break;case 2:L[B].fn.call(L[B].context,E);break;case 3:L[B].fn.call(L[B].context,E,A);break;case 4:L[B].fn.call(L[B].context,E,A,C);break;default:if(!F)for(Z=1,F=new Array(j-1);Z<j;Z++)F[Z-1]=arguments[Z];L[B].fn.apply(L[B].context,F)}}return!0},g.prototype.on=function(S,E,A){var C=new i(E,A||this),N=l?l+S:S;return this._events[N]?this._events[N].fn?this._events[N]=[this._events[N],C]:this._events[N].push(C):(this._events[N]=C,this._eventsCount++),this},g.prototype.once=function(S,E,A){var C=new i(E,A||this,!0),N=l?l+S:S;return this._events[N]?this._events[N].fn?this._events[N]=[this._events[N],C]:this._events[N].push(C):(this._events[N]=C,this._eventsCount++),this},g.prototype.removeListener=function(S,E,A,C){var N=l?l+S:S;if(!this._events[N])return this;if(!E)return--this._eventsCount===0?this._events=new d:delete this._events[N],this;var k=this._events[N];if(k.fn)k.fn===E&&(!C||k.once)&&(!A||k.context===A)&&(--this._eventsCount===0?this._events=new d:delete this._events[N]);else{for(var R=0,L=[],j=k.length;R<j;R++)(k[R].fn!==E||C&&!k[R].once||A&&k[R].context!==A)&&L.push(k[R]);L.length?this._events[N]=L.length===1?L[0]:L:--this._eventsCount===0?this._events=new d:delete this._events[N]}return this},g.prototype.removeAllListeners=function(S){var E;return S?(E=l?l+S:S,this._events[E]&&(--this._eventsCount===0?this._events=new d:delete this._events[E])):(this._events=new d,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prototype.setMaxListeners=function(){return this},g.prefixed=l,g.EventEmitter=g,typeof r<"u"&&(r.exports=g)},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.matchText=n.matchSpacing=n.matchNewline=n.matchBlot=n.matchAttributor=n.default=void 0;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_t){return typeof _t}:function(_t){return _t&&typeof Symbol=="function"&&_t.constructor===Symbol&&_t!==Symbol.prototype?"symbol":typeof _t},d=function(){function _t(Mt,Ke){var at=[],dt=!0,tr=!1,Qt=void 0;try{for(var er=Mt[Symbol.iterator](),Pr;!(dt=(Pr=er.next()).done)&&(at.push(Pr.value),!(Ke&&at.length===Ke));dt=!0);}catch(sn){tr=!0,Qt=sn}finally{try{!dt&&er.return&&er.return()}finally{if(tr)throw Qt}}return at}return function(Mt,Ke){if(Array.isArray(Mt))return Mt;if(Symbol.iterator in Object(Mt))return _t(Mt,Ke);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=function(){function _t(Mt,Ke){for(var at=0;at<Ke.length;at++){var dt=Ke[at];dt.enumerable=dt.enumerable||!1,dt.configurable=!0,"value"in dt&&(dt.writable=!0),Object.defineProperty(Mt,dt.key,dt)}}return function(Mt,Ke,at){return Ke&&_t(Mt.prototype,Ke),at&&_t(Mt,at),Mt}}(),g=o(3),x=ee(g),S=o(2),E=ee(S),A=o(0),C=ee(A),N=o(5),k=ee(N),R=o(10),L=ee(R),j=o(9),F=ee(j),B=o(36),U=o(37),Z=o(13),X=ee(Z),te=o(26),se=o(38),oe=o(39),ne=o(40);function ee(_t){return _t&&_t.__esModule?_t:{default:_t}}function ie(_t,Mt,Ke){return Mt in _t?Object.defineProperty(_t,Mt,{value:Ke,enumerable:!0,configurable:!0,writable:!0}):_t[Mt]=Ke,_t}function he(_t,Mt){if(!(_t instanceof Mt))throw new TypeError("Cannot call a class as a function")}function Se(_t,Mt){if(!_t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Mt&&(typeof Mt=="object"||typeof Mt=="function")?Mt:_t}function Ce(_t,Mt){if(typeof Mt!="function"&&Mt!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof Mt);_t.prototype=Object.create(Mt&&Mt.prototype,{constructor:{value:_t,enumerable:!1,writable:!0,configurable:!0}}),Mt&&(Object.setPrototypeOf?Object.setPrototypeOf(_t,Mt):_t.__proto__=Mt)}var fe=(0,L.default)("quill:clipboard"),_e="__ql-matcher",be=[[Node.TEXT_NODE,Yr],[Node.TEXT_NODE,Vt],["br",At],[Node.ELEMENT_NODE,Vt],[Node.ELEMENT_NODE,ut],[Node.ELEMENT_NODE,dr],[Node.ELEMENT_NODE,ze],[Node.ELEMENT_NODE,Br],["li",nr],["b",ft.bind(ft,"bold")],["i",ft.bind(ft,"italic")],["style",xt]],Pe=[B.AlignAttribute,se.DirectionAttribute].reduce(function(_t,Mt){return _t[Mt.keyName]=Mt,_t},{}),ye=[B.AlignStyle,U.BackgroundStyle,te.ColorStyle,se.DirectionStyle,oe.FontStyle,ne.SizeStyle].reduce(function(_t,Mt){return _t[Mt.keyName]=Mt,_t},{}),ge=function(_t){Ce(Mt,_t);function Mt(Ke,at){he(this,Mt);var dt=Se(this,(Mt.__proto__||Object.getPrototypeOf(Mt)).call(this,Ke,at));return dt.quill.root.addEventListener("paste",dt.onPaste.bind(dt)),dt.container=dt.quill.addContainer("ql-clipboard"),dt.container.setAttribute("contenteditable",!0),dt.container.setAttribute("tabindex",-1),dt.matchers=[],be.concat(dt.options.matchers).forEach(function(tr){var Qt=d(tr,2),er=Qt[0],Pr=Qt[1];!at.matchVisual&&Pr===dr||dt.addMatcher(er,Pr)}),dt}return i(Mt,[{key:"addMatcher",value:function(at,dt){this.matchers.push([at,dt])}},{key:"convert",value:function(at){if(typeof at=="string")return this.container.innerHTML=at.replace(/\>\r?\n +\</g,"><"),this.convert();var dt=this.quill.getFormat(this.quill.selection.savedRange.index);if(dt[X.default.blotName]){var tr=this.container.innerText;return this.container.innerHTML="",new E.default().insert(tr,ie({},X.default.blotName,dt[X.default.blotName]))}var Qt=this.prepareMatching(),er=d(Qt,2),Pr=er[0],sn=er[1],fn=Xe(this.container,Pr,sn);return He(fn,`
`)&&fn.ops[fn.ops.length-1].attributes==null&&(fn=fn.compose(new E.default().retain(fn.length()-1).delete(1))),fe.log("convert",this.container.innerHTML,fn),this.container.innerHTML="",fn}},{key:"dangerouslyPasteHTML",value:function(at,dt){var tr=arguments.length>2&&arguments[2]!==void 0?arguments[2]:k.default.sources.API;if(typeof at=="string")this.quill.setContents(this.convert(at),dt),this.quill.setSelection(0,k.default.sources.SILENT);else{var Qt=this.convert(dt);this.quill.updateContents(new E.default().retain(at).concat(Qt),tr),this.quill.setSelection(at+Qt.length(),k.default.sources.SILENT)}}},{key:"onPaste",value:function(at){var dt=this;if(!(at.defaultPrevented||!this.quill.isEnabled())){var tr=this.quill.getSelection(),Qt=new E.default().retain(tr.index),er=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(k.default.sources.SILENT),setTimeout(function(){Qt=Qt.concat(dt.convert()).delete(tr.length),dt.quill.updateContents(Qt,k.default.sources.USER),dt.quill.setSelection(Qt.length()-tr.length,k.default.sources.SILENT),dt.quill.scrollingContainer.scrollTop=er,dt.quill.focus()},1)}}},{key:"prepareMatching",value:function(){var at=this,dt=[],tr=[];return this.matchers.forEach(function(Qt){var er=d(Qt,2),Pr=er[0],sn=er[1];switch(Pr){case Node.TEXT_NODE:tr.push(sn);break;case Node.ELEMENT_NODE:dt.push(sn);break;default:[].forEach.call(at.container.querySelectorAll(Pr),function(fn){fn[_e]=fn[_e]||[],fn[_e].push(sn)});break}}),[dt,tr]}}]),Mt}(F.default);ge.DEFAULTS={matchers:[],matchVisual:!0};function ke(_t,Mt,Ke){return(typeof Mt>"u"?"undefined":l(Mt))==="object"?Object.keys(Mt).reduce(function(at,dt){return ke(at,dt,Mt[dt])},_t):_t.reduce(function(at,dt){return dt.attributes&&dt.attributes[Mt]?at.push(dt):at.insert(dt.insert,(0,x.default)({},ie({},Mt,Ke),dt.attributes))},new E.default)}function Qe(_t){if(_t.nodeType!==Node.ELEMENT_NODE)return{};var Mt="__ql-computed-style";return _t[Mt]||(_t[Mt]=window.getComputedStyle(_t))}function He(_t,Mt){for(var Ke="",at=_t.ops.length-1;at>=0&&Ke.length<Mt.length;--at){var dt=_t.ops[at];if(typeof dt.insert!="string")break;Ke=dt.insert+Ke}return Ke.slice(-1*Mt.length)===Mt}function $e(_t){if(_t.childNodes.length===0)return!1;var Mt=Qe(_t);return["block","list-item"].indexOf(Mt.display)>-1}function Xe(_t,Mt,Ke){return _t.nodeType===_t.TEXT_NODE?Ke.reduce(function(at,dt){return dt(_t,at)},new E.default):_t.nodeType===_t.ELEMENT_NODE?[].reduce.call(_t.childNodes||[],function(at,dt){var tr=Xe(dt,Mt,Ke);return dt.nodeType===_t.ELEMENT_NODE&&(tr=Mt.reduce(function(Qt,er){return er(dt,Qt)},tr),tr=(dt[_e]||[]).reduce(function(Qt,er){return er(dt,Qt)},tr)),at.concat(tr)},new E.default):new E.default}function ft(_t,Mt,Ke){return ke(Ke,_t,!0)}function ze(_t,Mt){var Ke=C.default.Attributor.Attribute.keys(_t),at=C.default.Attributor.Class.keys(_t),dt=C.default.Attributor.Style.keys(_t),tr={};return Ke.concat(at).concat(dt).forEach(function(Qt){var er=C.default.query(Qt,C.default.Scope.ATTRIBUTE);er!=null&&(tr[er.attrName]=er.value(_t),tr[er.attrName])||(er=Pe[Qt],er!=null&&(er.attrName===Qt||er.keyName===Qt)&&(tr[er.attrName]=er.value(_t)||void 0),er=ye[Qt],er!=null&&(er.attrName===Qt||er.keyName===Qt)&&(er=ye[Qt],tr[er.attrName]=er.value(_t)||void 0))}),Object.keys(tr).length>0&&(Mt=ke(Mt,tr)),Mt}function ut(_t,Mt){var Ke=C.default.query(_t);if(Ke==null)return Mt;if(Ke.prototype instanceof C.default.Embed){var at={},dt=Ke.value(_t);dt!=null&&(at[Ke.blotName]=dt,Mt=new E.default().insert(at,Ke.formats(_t)))}else typeof Ke.formats=="function"&&(Mt=ke(Mt,Ke.blotName,Ke.formats(_t)));return Mt}function At(_t,Mt){return He(Mt,`
`)||Mt.insert(`
`),Mt}function xt(){return new E.default}function nr(_t,Mt){var Ke=C.default.query(_t);if(Ke==null||Ke.blotName!=="list-item"||!He(Mt,`
`))return Mt;for(var at=-1,dt=_t.parentNode;!dt.classList.contains("ql-clipboard");)(C.default.query(dt)||{}).blotName==="list"&&(at+=1),dt=dt.parentNode;return at<=0?Mt:Mt.compose(new E.default().retain(Mt.length()-1).retain(1,{indent:at}))}function Vt(_t,Mt){return He(Mt,`
`)||($e(_t)||Mt.length()>0&&_t.nextSibling&&$e(_t.nextSibling))&&Mt.insert(`
`),Mt}function dr(_t,Mt){if($e(_t)&&_t.nextElementSibling!=null&&!He(Mt,`

`)){var Ke=_t.offsetHeight+parseFloat(Qe(_t).marginTop)+parseFloat(Qe(_t).marginBottom);_t.nextElementSibling.offsetTop>_t.offsetTop+Ke*1.5&&Mt.insert(`
`)}return Mt}function Br(_t,Mt){var Ke={},at=_t.style||{};return at.fontStyle&&Qe(_t).fontStyle==="italic"&&(Ke.italic=!0),at.fontWeight&&(Qe(_t).fontWeight.startsWith("bold")||parseInt(Qe(_t).fontWeight)>=700)&&(Ke.bold=!0),Object.keys(Ke).length>0&&(Mt=ke(Mt,Ke)),parseFloat(at.textIndent||0)>0&&(Mt=new E.default().insert("	").concat(Mt)),Mt}function Yr(_t,Mt){var Ke=_t.data;if(_t.parentNode.tagName==="O:P")return Mt.insert(Ke.trim());if(Ke.trim().length===0&&_t.parentNode.classList.contains("ql-clipboard"))return Mt;if(!Qe(_t.parentNode).whiteSpace.startsWith("pre")){var at=function(tr,Qt){return Qt=Qt.replace(/[^\u00a0]/g,""),Qt.length<1&&tr?" ":Qt};Ke=Ke.replace(/\r\n/g," ").replace(/\n/g," "),Ke=Ke.replace(/\s\s+/g,at.bind(at,!0)),(_t.previousSibling==null&&$e(_t.parentNode)||_t.previousSibling!=null&&$e(_t.previousSibling))&&(Ke=Ke.replace(/^\s+/,at.bind(at,!1))),(_t.nextSibling==null&&$e(_t.parentNode)||_t.nextSibling!=null&&$e(_t.nextSibling))&&(Ke=Ke.replace(/\s+$/,at.bind(at,!1)))}return Mt.insert(Ke)}n.default=ge,n.matchAttributor=ze,n.matchBlot=ut,n.matchNewline=Vt,n.matchSpacing=dr,n.matchText=Yr},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(k,R){for(var L=0;L<R.length;L++){var j=R[L];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,j.key,j)}}return function(k,R,L){return R&&N(k.prototype,R),L&&N(k,L),k}}(),d=function N(k,R,L){k===null&&(k=Function.prototype);var j=Object.getOwnPropertyDescriptor(k,R);if(j===void 0){var F=Object.getPrototypeOf(k);return F===null?void 0:N(F,R,L)}else{if("value"in j)return j.value;var B=j.get;return B===void 0?void 0:B.call(L)}},i=o(6),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(){return S(this,k),E(this,(k.__proto__||Object.getPrototypeOf(k)).apply(this,arguments))}return l(k,[{key:"optimize",value:function(L){d(k.prototype.__proto__||Object.getPrototypeOf(k.prototype),"optimize",this).call(this,L),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return d(k.__proto__||Object.getPrototypeOf(k),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),k}(g.default);C.blotName="bold",C.tagName=["STRONG","B"],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.addControls=n.default=void 0;var l=function(){function ne(ee,ie){var he=[],Se=!0,Ce=!1,fe=void 0;try{for(var _e=ee[Symbol.iterator](),be;!(Se=(be=_e.next()).done)&&(he.push(be.value),!(ie&&he.length===ie));Se=!0);}catch(Pe){Ce=!0,fe=Pe}finally{try{!Se&&_e.return&&_e.return()}finally{if(Ce)throw fe}}return he}return function(ee,ie){if(Array.isArray(ee))return ee;if(Symbol.iterator in Object(ee))return ne(ee,ie);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function ne(ee,ie){for(var he=0;he<ie.length;he++){var Se=ie[he];Se.enumerable=Se.enumerable||!1,Se.configurable=!0,"value"in Se&&(Se.writable=!0),Object.defineProperty(ee,Se.key,Se)}}return function(ee,ie,he){return ie&&ne(ee.prototype,ie),he&&ne(ee,he),ee}}(),i=o(2),g=L(i),x=o(0),S=L(x),E=o(5),A=L(E),C=o(10),N=L(C),k=o(9),R=L(k);function L(ne){return ne&&ne.__esModule?ne:{default:ne}}function j(ne,ee,ie){return ee in ne?Object.defineProperty(ne,ee,{value:ie,enumerable:!0,configurable:!0,writable:!0}):ne[ee]=ie,ne}function F(ne,ee){if(!(ne instanceof ee))throw new TypeError("Cannot call a class as a function")}function B(ne,ee){if(!ne)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ee&&(typeof ee=="object"||typeof ee=="function")?ee:ne}function U(ne,ee){if(typeof ee!="function"&&ee!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ee);ne.prototype=Object.create(ee&&ee.prototype,{constructor:{value:ne,enumerable:!1,writable:!0,configurable:!0}}),ee&&(Object.setPrototypeOf?Object.setPrototypeOf(ne,ee):ne.__proto__=ee)}var Z=(0,N.default)("quill:toolbar"),X=function(ne){U(ee,ne);function ee(ie,he){F(this,ee);var Se=B(this,(ee.__proto__||Object.getPrototypeOf(ee)).call(this,ie,he));if(Array.isArray(Se.options.container)){var Ce=document.createElement("div");se(Ce,Se.options.container),ie.container.parentNode.insertBefore(Ce,ie.container),Se.container=Ce}else typeof Se.options.container=="string"?Se.container=document.querySelector(Se.options.container):Se.container=Se.options.container;if(!(Se.container instanceof HTMLElement)){var fe;return fe=Z.error("Container required for toolbar",Se.options),B(Se,fe)}return Se.container.classList.add("ql-toolbar"),Se.controls=[],Se.handlers={},Object.keys(Se.options.handlers).forEach(function(_e){Se.addHandler(_e,Se.options.handlers[_e])}),[].forEach.call(Se.container.querySelectorAll("button, select"),function(_e){Se.attach(_e)}),Se.quill.on(A.default.events.EDITOR_CHANGE,function(_e,be){_e===A.default.events.SELECTION_CHANGE&&Se.update(be)}),Se.quill.on(A.default.events.SCROLL_OPTIMIZE,function(){var _e=Se.quill.selection.getRange(),be=l(_e,1),Pe=be[0];Se.update(Pe)}),Se}return d(ee,[{key:"addHandler",value:function(he,Se){this.handlers[he]=Se}},{key:"attach",value:function(he){var Se=this,Ce=[].find.call(he.classList,function(_e){return _e.indexOf("ql-")===0});if(Ce){if(Ce=Ce.slice(3),he.tagName==="BUTTON"&&he.setAttribute("type","button"),this.handlers[Ce]==null){if(this.quill.scroll.whitelist!=null&&this.quill.scroll.whitelist[Ce]==null){Z.warn("ignoring attaching to disabled format",Ce,he);return}if(S.default.query(Ce)==null){Z.warn("ignoring attaching to nonexistent format",Ce,he);return}}var fe=he.tagName==="SELECT"?"change":"click";he.addEventListener(fe,function(_e){var be=void 0;if(he.tagName==="SELECT"){if(he.selectedIndex<0)return;var Pe=he.options[he.selectedIndex];Pe.hasAttribute("selected")?be=!1:be=Pe.value||!1}else he.classList.contains("ql-active")?be=!1:be=he.value||!he.hasAttribute("value"),_e.preventDefault();Se.quill.focus();var ye=Se.quill.selection.getRange(),ge=l(ye,1),ke=ge[0];if(Se.handlers[Ce]!=null)Se.handlers[Ce].call(Se,be);else if(S.default.query(Ce).prototype instanceof S.default.Embed){if(be=prompt("Enter "+Ce),!be)return;Se.quill.updateContents(new g.default().retain(ke.index).delete(ke.length).insert(j({},Ce,be)),A.default.sources.USER)}else Se.quill.format(Ce,be,A.default.sources.USER);Se.update(ke)}),this.controls.push([Ce,he])}}},{key:"update",value:function(he){var Se=he==null?{}:this.quill.getFormat(he);this.controls.forEach(function(Ce){var fe=l(Ce,2),_e=fe[0],be=fe[1];if(be.tagName==="SELECT"){var Pe=void 0;if(he==null)Pe=null;else if(Se[_e]==null)Pe=be.querySelector("option[selected]");else if(!Array.isArray(Se[_e])){var ye=Se[_e];typeof ye=="string"&&(ye=ye.replace(/\"/g,'\\"')),Pe=be.querySelector('option[value="'+ye+'"]')}Pe==null?(be.value="",be.selectedIndex=-1):Pe.selected=!0}else if(he==null)be.classList.remove("ql-active");else if(be.hasAttribute("value")){var ge=Se[_e]===be.getAttribute("value")||Se[_e]!=null&&Se[_e].toString()===be.getAttribute("value")||Se[_e]==null&&!be.getAttribute("value");be.classList.toggle("ql-active",ge)}else be.classList.toggle("ql-active",Se[_e]!=null)})}}]),ee}(R.default);X.DEFAULTS={};function te(ne,ee,ie){var he=document.createElement("button");he.setAttribute("type","button"),he.classList.add("ql-"+ee),ie!=null&&(he.value=ie),ne.appendChild(he)}function se(ne,ee){Array.isArray(ee[0])||(ee=[ee]),ee.forEach(function(ie){var he=document.createElement("span");he.classList.add("ql-formats"),ie.forEach(function(Se){if(typeof Se=="string")te(he,Se);else{var Ce=Object.keys(Se)[0],fe=Se[Ce];Array.isArray(fe)?oe(he,Ce,fe):te(he,Ce,fe)}}),ne.appendChild(he)})}function oe(ne,ee,ie){var he=document.createElement("select");he.classList.add("ql-"+ee),ie.forEach(function(Se){var Ce=document.createElement("option");Se!==!1?Ce.setAttribute("value",Se):Ce.setAttribute("selected","selected"),he.appendChild(Ce)}),ne.appendChild(he)}X.DEFAULTS={container:null,handlers:{clean:function(){var ee=this,ie=this.quill.getSelection();if(ie!=null)if(ie.length==0){var he=this.quill.getFormat();Object.keys(he).forEach(function(Se){S.default.query(Se,S.default.Scope.INLINE)!=null&&ee.quill.format(Se,!1)})}else this.quill.removeFormat(ie,A.default.sources.USER)},direction:function(ee){var ie=this.quill.getFormat().align;ee==="rtl"&&ie==null?this.quill.format("align","right",A.default.sources.USER):!ee&&ie==="right"&&this.quill.format("align",!1,A.default.sources.USER),this.quill.format("direction",ee,A.default.sources.USER)},indent:function(ee){var ie=this.quill.getSelection(),he=this.quill.getFormat(ie),Se=parseInt(he.indent||0);if(ee==="+1"||ee==="-1"){var Ce=ee==="+1"?1:-1;he.direction==="rtl"&&(Ce*=-1),this.quill.format("indent",Se+Ce,A.default.sources.USER)}},link:function(ee){ee===!0&&(ee=prompt("Enter link URL:")),this.quill.format("link",ee,A.default.sources.USER)},list:function(ee){var ie=this.quill.getSelection(),he=this.quill.getFormat(ie);ee==="check"?he.list==="checked"||he.list==="unchecked"?this.quill.format("list",!1,A.default.sources.USER):this.quill.format("list","unchecked",A.default.sources.USER):this.quill.format("list",ee,A.default.sources.USER)}}},n.default=X,n.addControls=se},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(k,R){for(var L=0;L<R.length;L++){var j=R[L];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,j.key,j)}}return function(k,R,L){return R&&N(k.prototype,R),L&&N(k,L),k}}(),d=function N(k,R,L){k===null&&(k=Function.prototype);var j=Object.getOwnPropertyDescriptor(k,R);if(j===void 0){var F=Object.getPrototypeOf(k);return F===null?void 0:N(F,R,L)}else{if("value"in j)return j.value;var B=j.get;return B===void 0?void 0:B.call(L)}},i=o(28),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(R,L){S(this,k);var j=E(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,R));return j.label.innerHTML=L,j.container.classList.add("ql-color-picker"),[].slice.call(j.container.querySelectorAll(".ql-picker-item"),0,7).forEach(function(F){F.classList.add("ql-primary")}),j}return l(k,[{key:"buildItem",value:function(L){var j=d(k.prototype.__proto__||Object.getPrototypeOf(k.prototype),"buildItem",this).call(this,L);return j.style.backgroundColor=L.getAttribute("value")||"",j}},{key:"selectItem",value:function(L,j){d(k.prototype.__proto__||Object.getPrototypeOf(k.prototype),"selectItem",this).call(this,L,j);var F=this.label.querySelector(".ql-color-label"),B=L&&L.getAttribute("data-value")||"";F&&(F.tagName==="line"?F.style.stroke=B:F.style.fill=B)}}]),k}(g.default);n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(k,R){for(var L=0;L<R.length;L++){var j=R[L];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,j.key,j)}}return function(k,R,L){return R&&N(k.prototype,R),L&&N(k,L),k}}(),d=function N(k,R,L){k===null&&(k=Function.prototype);var j=Object.getOwnPropertyDescriptor(k,R);if(j===void 0){var F=Object.getPrototypeOf(k);return F===null?void 0:N(F,R,L)}else{if("value"in j)return j.value;var B=j.get;return B===void 0?void 0:B.call(L)}},i=o(28),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(R,L){S(this,k);var j=E(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,R));return j.container.classList.add("ql-icon-picker"),[].forEach.call(j.container.querySelectorAll(".ql-picker-item"),function(F){F.innerHTML=L[F.getAttribute("data-value")||""]}),j.defaultItem=j.container.querySelector(".ql-selected"),j.selectItem(j.defaultItem),j}return l(k,[{key:"selectItem",value:function(L,j){d(k.prototype.__proto__||Object.getPrototypeOf(k.prototype),"selectItem",this).call(this,L,j),L=L||this.defaultItem,this.label.innerHTML=L.innerHTML}}]),k}(g.default);n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function g(x,S){for(var E=0;E<S.length;E++){var A=S[E];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(x,A.key,A)}}return function(x,S,E){return S&&g(x.prototype,S),E&&g(x,E),x}}();function d(g,x){if(!(g instanceof x))throw new TypeError("Cannot call a class as a function")}var i=function(){function g(x,S){var E=this;d(this,g),this.quill=x,this.boundsContainer=S||document.body,this.root=x.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",function(){E.root.style.marginTop=-1*E.quill.root.scrollTop+"px"}),this.hide()}return l(g,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(S){var E=S.left+S.width/2-this.root.offsetWidth/2,A=S.bottom+this.quill.root.scrollTop;this.root.style.left=E+"px",this.root.style.top=A+"px",this.root.classList.remove("ql-flip");var C=this.boundsContainer.getBoundingClientRect(),N=this.root.getBoundingClientRect(),k=0;if(N.right>C.right&&(k=C.right-N.right,this.root.style.left=E+k+"px"),N.left<C.left&&(k=C.left-N.left,this.root.style.left=E+k+"px"),N.bottom>C.bottom){var R=N.bottom-N.top,L=S.bottom-S.top+R;this.root.style.top=A-L+"px",this.root.classList.add("ql-flip")}return k}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),g}();n.default=i},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function oe(ne,ee){var ie=[],he=!0,Se=!1,Ce=void 0;try{for(var fe=ne[Symbol.iterator](),_e;!(he=(_e=fe.next()).done)&&(ie.push(_e.value),!(ee&&ie.length===ee));he=!0);}catch(be){Se=!0,Ce=be}finally{try{!he&&fe.return&&fe.return()}finally{if(Se)throw Ce}}return ie}return function(ne,ee){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return oe(ne,ee);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function oe(ne,ee,ie){ne===null&&(ne=Function.prototype);var he=Object.getOwnPropertyDescriptor(ne,ee);if(he===void 0){var Se=Object.getPrototypeOf(ne);return Se===null?void 0:oe(Se,ee,ie)}else{if("value"in he)return he.value;var Ce=he.get;return Ce===void 0?void 0:Ce.call(ie)}},i=function(){function oe(ne,ee){for(var ie=0;ie<ee.length;ie++){var he=ee[ie];he.enumerable=he.enumerable||!1,he.configurable=!0,"value"in he&&(he.writable=!0),Object.defineProperty(ne,he.key,he)}}return function(ne,ee,ie){return ee&&oe(ne.prototype,ee),ie&&oe(ne,ie),ne}}(),g=o(3),x=F(g),S=o(8),E=F(S),A=o(43),C=F(A),N=o(27),k=F(N),R=o(15),L=o(41),j=F(L);function F(oe){return oe&&oe.__esModule?oe:{default:oe}}function B(oe,ne){if(!(oe instanceof ne))throw new TypeError("Cannot call a class as a function")}function U(oe,ne){if(!oe)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return ne&&(typeof ne=="object"||typeof ne=="function")?ne:oe}function Z(oe,ne){if(typeof ne!="function"&&ne!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof ne);oe.prototype=Object.create(ne&&ne.prototype,{constructor:{value:oe,enumerable:!1,writable:!0,configurable:!0}}),ne&&(Object.setPrototypeOf?Object.setPrototypeOf(oe,ne):oe.__proto__=ne)}var X=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],te=function(oe){Z(ne,oe);function ne(ee,ie){B(this,ne),ie.modules.toolbar!=null&&ie.modules.toolbar.container==null&&(ie.modules.toolbar.container=X);var he=U(this,(ne.__proto__||Object.getPrototypeOf(ne)).call(this,ee,ie));return he.quill.container.classList.add("ql-snow"),he}return i(ne,[{key:"extendToolbar",value:function(ie){ie.container.classList.add("ql-snow"),this.buildButtons([].slice.call(ie.container.querySelectorAll("button")),j.default),this.buildPickers([].slice.call(ie.container.querySelectorAll("select")),j.default),this.tooltip=new se(this.quill,this.options.bounds),ie.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},function(he,Se){ie.handlers.link.call(ie,!Se.format.link)})}}]),ne}(C.default);te.DEFAULTS=(0,x.default)(!0,{},C.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(ne){if(ne){var ee=this.quill.getSelection();if(ee==null||ee.length==0)return;var ie=this.quill.getText(ee);/^\S+@\S+\.\S+$/.test(ie)&&ie.indexOf("mailto:")!==0&&(ie="mailto:"+ie);var he=this.quill.theme.tooltip;he.edit("link",ie)}else this.quill.format("link",!1)}}}}});var se=function(oe){Z(ne,oe);function ne(ee,ie){B(this,ne);var he=U(this,(ne.__proto__||Object.getPrototypeOf(ne)).call(this,ee,ie));return he.preview=he.root.querySelector("a.ql-preview"),he}return i(ne,[{key:"listen",value:function(){var ie=this;d(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",function(he){ie.root.classList.contains("ql-editing")?ie.save():ie.edit("link",ie.preview.textContent),he.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",function(he){if(ie.linkRange!=null){var Se=ie.linkRange;ie.restoreFocus(),ie.quill.formatText(Se,"link",!1,E.default.sources.USER),delete ie.linkRange}he.preventDefault(),ie.hide()}),this.quill.on(E.default.events.SELECTION_CHANGE,function(he,Se,Ce){if(he!=null){if(he.length===0&&Ce===E.default.sources.USER){var fe=ie.quill.scroll.descendant(k.default,he.index),_e=l(fe,2),be=_e[0],Pe=_e[1];if(be!=null){ie.linkRange=new R.Range(he.index-Pe,be.length());var ye=k.default.formats(be.domNode);ie.preview.textContent=ye,ie.preview.setAttribute("href",ye),ie.show(),ie.position(ie.quill.getBounds(ie.linkRange));return}}else delete ie.linkRange;ie.hide()}})}},{key:"show",value:function(){d(ne.prototype.__proto__||Object.getPrototypeOf(ne.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),ne}(A.BaseTooltip);se.TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),n.default=te},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(29),d=dt(l),i=o(36),g=o(38),x=o(64),S=o(65),E=dt(S),A=o(66),C=dt(A),N=o(67),k=dt(N),R=o(37),L=o(26),j=o(39),F=o(40),B=o(56),U=dt(B),Z=o(68),X=dt(Z),te=o(27),se=dt(te),oe=o(69),ne=dt(oe),ee=o(70),ie=dt(ee),he=o(71),Se=dt(he),Ce=o(72),fe=dt(Ce),_e=o(73),be=dt(_e),Pe=o(13),ye=dt(Pe),ge=o(74),ke=dt(ge),Qe=o(75),He=dt(Qe),$e=o(57),Xe=dt($e),ft=o(41),ze=dt(ft),ut=o(28),At=dt(ut),xt=o(59),nr=dt(xt),Vt=o(60),dr=dt(Vt),Br=o(61),Yr=dt(Br),_t=o(108),Mt=dt(_t),Ke=o(62),at=dt(Ke);function dt(tr){return tr&&tr.__esModule?tr:{default:tr}}d.default.register({"attributors/attribute/direction":g.DirectionAttribute,"attributors/class/align":i.AlignClass,"attributors/class/background":R.BackgroundClass,"attributors/class/color":L.ColorClass,"attributors/class/direction":g.DirectionClass,"attributors/class/font":j.FontClass,"attributors/class/size":F.SizeClass,"attributors/style/align":i.AlignStyle,"attributors/style/background":R.BackgroundStyle,"attributors/style/color":L.ColorStyle,"attributors/style/direction":g.DirectionStyle,"attributors/style/font":j.FontStyle,"attributors/style/size":F.SizeStyle},!0),d.default.register({"formats/align":i.AlignClass,"formats/direction":g.DirectionClass,"formats/indent":x.IndentClass,"formats/background":R.BackgroundStyle,"formats/color":L.ColorStyle,"formats/font":j.FontClass,"formats/size":F.SizeClass,"formats/blockquote":E.default,"formats/code-block":ye.default,"formats/header":C.default,"formats/list":k.default,"formats/bold":U.default,"formats/code":Pe.Code,"formats/italic":X.default,"formats/link":se.default,"formats/script":ne.default,"formats/strike":ie.default,"formats/underline":Se.default,"formats/image":fe.default,"formats/video":be.default,"formats/list/item":N.ListItem,"modules/formula":ke.default,"modules/syntax":He.default,"modules/toolbar":Xe.default,"themes/bubble":Mt.default,"themes/snow":at.default,"ui/icons":ze.default,"ui/picker":At.default,"ui/icon-picker":dr.default,"ui/color-picker":nr.default,"ui/tooltip":Yr.default},!0),n.default=d.default},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.IndentClass=void 0;var l=function(){function k(R,L){for(var j=0;j<L.length;j++){var F=L[j];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(R,F.key,F)}}return function(R,L,j){return L&&k(R.prototype,L),j&&k(R,j),R}}(),d=function k(R,L,j){R===null&&(R=Function.prototype);var F=Object.getOwnPropertyDescriptor(R,L);if(F===void 0){var B=Object.getPrototypeOf(R);return B===null?void 0:k(B,L,j)}else{if("value"in F)return F.value;var U=F.get;return U===void 0?void 0:U.call(j)}},i=o(0),g=x(i);function x(k){return k&&k.__esModule?k:{default:k}}function S(k,R){if(!(k instanceof R))throw new TypeError("Cannot call a class as a function")}function E(k,R){if(!k)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R&&(typeof R=="object"||typeof R=="function")?R:k}function A(k,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof R);k.prototype=Object.create(R&&R.prototype,{constructor:{value:k,enumerable:!1,writable:!0,configurable:!0}}),R&&(Object.setPrototypeOf?Object.setPrototypeOf(k,R):k.__proto__=R)}var C=function(k){A(R,k);function R(){return S(this,R),E(this,(R.__proto__||Object.getPrototypeOf(R)).apply(this,arguments))}return l(R,[{key:"add",value:function(j,F){if(F==="+1"||F==="-1"){var B=this.value(j)||0;F=F==="+1"?B+1:B-1}return F===0?(this.remove(j),!0):d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"add",this).call(this,j,F)}},{key:"canAdd",value:function(j,F){return d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"canAdd",this).call(this,j,F)||d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"canAdd",this).call(this,j,parseInt(F))}},{key:"value",value:function(j){return parseInt(d(R.prototype.__proto__||Object.getPrototypeOf(R.prototype),"value",this).call(this,j))||void 0}}]),R}(g.default.Attributor.Class),N=new C("indent","ql-indent",{scope:g.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});n.IndentClass=N},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(4),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}function g(A,C){if(!(A instanceof C))throw new TypeError("Cannot call a class as a function")}function x(A,C){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:A}function S(A,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);A.prototype=Object.create(C&&C.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(A,C):A.__proto__=C)}var E=function(A){S(C,A);function C(){return g(this,C),x(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="blockquote",E.tagName="blockquote",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function C(N,k){for(var R=0;R<k.length;R++){var L=k[R];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(N,L.key,L)}}return function(N,k,R){return k&&C(N.prototype,k),R&&C(N,R),N}}(),d=o(4),i=g(d);function g(C){return C&&C.__esModule?C:{default:C}}function x(C,N){if(!(C instanceof N))throw new TypeError("Cannot call a class as a function")}function S(C,N){if(!C)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return N&&(typeof N=="object"||typeof N=="function")?N:C}function E(C,N){if(typeof N!="function"&&N!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof N);C.prototype=Object.create(N&&N.prototype,{constructor:{value:C,enumerable:!1,writable:!0,configurable:!0}}),N&&(Object.setPrototypeOf?Object.setPrototypeOf(C,N):C.__proto__=N)}var A=function(C){E(N,C);function N(){return x(this,N),S(this,(N.__proto__||Object.getPrototypeOf(N)).apply(this,arguments))}return l(N,null,[{key:"formats",value:function(R){return this.tagName.indexOf(R.tagName)+1}}]),N}(i.default);A.blotName="header",A.tagName=["H1","H2","H3","H4","H5","H6"],n.default=A},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ListItem=void 0;var l=function(){function B(U,Z){for(var X=0;X<Z.length;X++){var te=Z[X];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(U,te.key,te)}}return function(U,Z,X){return Z&&B(U.prototype,Z),X&&B(U,X),U}}(),d=function B(U,Z,X){U===null&&(U=Function.prototype);var te=Object.getOwnPropertyDescriptor(U,Z);if(te===void 0){var se=Object.getPrototypeOf(U);return se===null?void 0:B(se,Z,X)}else{if("value"in te)return te.value;var oe=te.get;return oe===void 0?void 0:oe.call(X)}},i=o(0),g=C(i),x=o(4),S=C(x),E=o(25),A=C(E);function C(B){return B&&B.__esModule?B:{default:B}}function N(B,U,Z){return U in B?Object.defineProperty(B,U,{value:Z,enumerable:!0,configurable:!0,writable:!0}):B[U]=Z,B}function k(B,U){if(!(B instanceof U))throw new TypeError("Cannot call a class as a function")}function R(B,U){if(!B)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return U&&(typeof U=="object"||typeof U=="function")?U:B}function L(B,U){if(typeof U!="function"&&U!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof U);B.prototype=Object.create(U&&U.prototype,{constructor:{value:B,enumerable:!1,writable:!0,configurable:!0}}),U&&(Object.setPrototypeOf?Object.setPrototypeOf(B,U):B.__proto__=U)}var j=function(B){L(U,B);function U(){return k(this,U),R(this,(U.__proto__||Object.getPrototypeOf(U)).apply(this,arguments))}return l(U,[{key:"format",value:function(X,te){X===F.blotName&&!te?this.replaceWith(g.default.create(this.statics.scope)):d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"format",this).call(this,X,te)}},{key:"remove",value:function(){this.prev==null&&this.next==null?this.parent.remove():d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(X,te){return this.parent.isolate(this.offset(this.parent),this.length()),X===this.parent.statics.blotName?(this.parent.replaceWith(X,te),this):(this.parent.unwrap(),d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"replaceWith",this).call(this,X,te))}}],[{key:"formats",value:function(X){return X.tagName===this.tagName?void 0:d(U.__proto__||Object.getPrototypeOf(U),"formats",this).call(this,X)}}]),U}(S.default);j.blotName="list-item",j.tagName="LI";var F=function(B){L(U,B),l(U,null,[{key:"create",value:function(X){var te=X==="ordered"?"OL":"UL",se=d(U.__proto__||Object.getPrototypeOf(U),"create",this).call(this,te);return(X==="checked"||X==="unchecked")&&se.setAttribute("data-checked",X==="checked"),se}},{key:"formats",value:function(X){if(X.tagName==="OL")return"ordered";if(X.tagName==="UL")return X.hasAttribute("data-checked")?X.getAttribute("data-checked")==="true"?"checked":"unchecked":"bullet"}}]);function U(Z){k(this,U);var X=R(this,(U.__proto__||Object.getPrototypeOf(U)).call(this,Z)),te=function(oe){if(oe.target.parentNode===Z){var ne=X.statics.formats(Z),ee=g.default.find(oe.target);ne==="checked"?ee.format("list","unchecked"):ne==="unchecked"&&ee.format("list","checked")}};return Z.addEventListener("touchstart",te),Z.addEventListener("mousedown",te),X}return l(U,[{key:"format",value:function(X,te){this.children.length>0&&this.children.tail.format(X,te)}},{key:"formats",value:function(){return N({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(X,te){if(X instanceof j)d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"insertBefore",this).call(this,X,te);else{var se=te==null?this.length():te.offset(this),oe=this.split(se);oe.parent.insertBefore(X,oe)}}},{key:"optimize",value:function(X){d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"optimize",this).call(this,X);var te=this.next;te!=null&&te.prev===this&&te.statics.blotName===this.statics.blotName&&te.domNode.tagName===this.domNode.tagName&&te.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(te.moveChildren(this),te.remove())}},{key:"replace",value:function(X){if(X.statics.blotName!==this.statics.blotName){var te=g.default.create(this.statics.defaultChild);X.moveChildren(te),this.appendChild(te)}d(U.prototype.__proto__||Object.getPrototypeOf(U.prototype),"replace",this).call(this,X)}}]),U}(A.default);F.blotName="list",F.scope=g.default.Scope.BLOCK_BLOT,F.tagName=["OL","UL"],F.defaultChild="list-item",F.allowedChildren=[j],n.ListItem=j,n.default=F},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(56),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}function g(A,C){if(!(A instanceof C))throw new TypeError("Cannot call a class as a function")}function x(A,C){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:A}function S(A,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);A.prototype=Object.create(C&&C.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(A,C):A.__proto__=C)}var E=function(A){S(C,A);function C(){return g(this,C),x(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="italic",E.tagName=["EM","I"],n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function N(k,R){for(var L=0;L<R.length;L++){var j=R[L];j.enumerable=j.enumerable||!1,j.configurable=!0,"value"in j&&(j.writable=!0),Object.defineProperty(k,j.key,j)}}return function(k,R,L){return R&&N(k.prototype,R),L&&N(k,L),k}}(),d=function N(k,R,L){k===null&&(k=Function.prototype);var j=Object.getOwnPropertyDescriptor(k,R);if(j===void 0){var F=Object.getPrototypeOf(k);return F===null?void 0:N(F,R,L)}else{if("value"in j)return j.value;var B=j.get;return B===void 0?void 0:B.call(L)}},i=o(6),g=x(i);function x(N){return N&&N.__esModule?N:{default:N}}function S(N,k){if(!(N instanceof k))throw new TypeError("Cannot call a class as a function")}function E(N,k){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return k&&(typeof k=="object"||typeof k=="function")?k:N}function A(N,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof k);N.prototype=Object.create(k&&k.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),k&&(Object.setPrototypeOf?Object.setPrototypeOf(N,k):N.__proto__=k)}var C=function(N){A(k,N);function k(){return S(this,k),E(this,(k.__proto__||Object.getPrototypeOf(k)).apply(this,arguments))}return l(k,null,[{key:"create",value:function(L){return L==="super"?document.createElement("sup"):L==="sub"?document.createElement("sub"):d(k.__proto__||Object.getPrototypeOf(k),"create",this).call(this,L)}},{key:"formats",value:function(L){if(L.tagName==="SUB")return"sub";if(L.tagName==="SUP")return"super"}}]),k}(g.default);C.blotName="script",C.tagName=["SUB","SUP"],n.default=C},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(6),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}function g(A,C){if(!(A instanceof C))throw new TypeError("Cannot call a class as a function")}function x(A,C){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:A}function S(A,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);A.prototype=Object.create(C&&C.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(A,C):A.__proto__=C)}var E=function(A){S(C,A);function C(){return g(this,C),x(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="strike",E.tagName="S",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=o(6),d=i(l);function i(A){return A&&A.__esModule?A:{default:A}}function g(A,C){if(!(A instanceof C))throw new TypeError("Cannot call a class as a function")}function x(A,C){if(!A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C&&(typeof C=="object"||typeof C=="function")?C:A}function S(A,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof C);A.prototype=Object.create(C&&C.prototype,{constructor:{value:A,enumerable:!1,writable:!0,configurable:!0}}),C&&(Object.setPrototypeOf?Object.setPrototypeOf(A,C):A.__proto__=C)}var E=function(A){S(C,A);function C(){return g(this,C),x(this,(C.__proto__||Object.getPrototypeOf(C)).apply(this,arguments))}return C}(d.default);E.blotName="underline",E.tagName="U",n.default=E},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function R(L,j){for(var F=0;F<j.length;F++){var B=j[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,j,F){return j&&R(L.prototype,j),F&&R(L,F),L}}(),d=function R(L,j,F){L===null&&(L=Function.prototype);var B=Object.getOwnPropertyDescriptor(L,j);if(B===void 0){var U=Object.getPrototypeOf(L);return U===null?void 0:R(U,j,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(0),g=S(i),x=o(27);function S(R){return R&&R.__esModule?R:{default:R}}function E(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}function A(R,L){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L&&(typeof L=="object"||typeof L=="function")?L:R}function C(R,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);R.prototype=Object.create(L&&L.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(R,L):R.__proto__=L)}var N=["alt","height","width"],k=function(R){C(L,R);function L(){return E(this,L),A(this,(L.__proto__||Object.getPrototypeOf(L)).apply(this,arguments))}return l(L,[{key:"format",value:function(F,B){N.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(L.__proto__||Object.getPrototypeOf(L),"create",this).call(this,F);return typeof F=="string"&&B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return N.reduce(function(B,U){return F.hasAttribute(U)&&(B[U]=F.getAttribute(U)),B},{})}},{key:"match",value:function(F){return/\.(jpe?g|gif|png)$/.test(F)||/^data:image\/.+;base64/.test(F)}},{key:"sanitize",value:function(F){return(0,x.sanitize)(F,["http","https","data"])?F:"//:0"}},{key:"value",value:function(F){return F.getAttribute("src")}}]),L}(g.default.Embed);k.blotName="image",k.tagName="IMG",n.default=k},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function R(L,j){for(var F=0;F<j.length;F++){var B=j[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(L,B.key,B)}}return function(L,j,F){return j&&R(L.prototype,j),F&&R(L,F),L}}(),d=function R(L,j,F){L===null&&(L=Function.prototype);var B=Object.getOwnPropertyDescriptor(L,j);if(B===void 0){var U=Object.getPrototypeOf(L);return U===null?void 0:R(U,j,F)}else{if("value"in B)return B.value;var Z=B.get;return Z===void 0?void 0:Z.call(F)}},i=o(4),g=o(27),x=S(g);function S(R){return R&&R.__esModule?R:{default:R}}function E(R,L){if(!(R instanceof L))throw new TypeError("Cannot call a class as a function")}function A(R,L){if(!R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return L&&(typeof L=="object"||typeof L=="function")?L:R}function C(R,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof L);R.prototype=Object.create(L&&L.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),L&&(Object.setPrototypeOf?Object.setPrototypeOf(R,L):R.__proto__=L)}var N=["height","width"],k=function(R){C(L,R);function L(){return E(this,L),A(this,(L.__proto__||Object.getPrototypeOf(L)).apply(this,arguments))}return l(L,[{key:"format",value:function(F,B){N.indexOf(F)>-1?B?this.domNode.setAttribute(F,B):this.domNode.removeAttribute(F):d(L.prototype.__proto__||Object.getPrototypeOf(L.prototype),"format",this).call(this,F,B)}}],[{key:"create",value:function(F){var B=d(L.__proto__||Object.getPrototypeOf(L),"create",this).call(this,F);return B.setAttribute("frameborder","0"),B.setAttribute("allowfullscreen",!0),B.setAttribute("src",this.sanitize(F)),B}},{key:"formats",value:function(F){return N.reduce(function(B,U){return F.hasAttribute(U)&&(B[U]=F.getAttribute(U)),B},{})}},{key:"sanitize",value:function(F){return x.default.sanitize(F)}},{key:"value",value:function(F){return F.getAttribute("src")}}]),L}(i.BlockEmbed);k.blotName="video",k.className="ql-video",k.tagName="IFRAME",n.default=k},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.FormulaBlot=void 0;var l=function(){function F(B,U){for(var Z=0;Z<U.length;Z++){var X=U[Z];X.enumerable=X.enumerable||!1,X.configurable=!0,"value"in X&&(X.writable=!0),Object.defineProperty(B,X.key,X)}}return function(B,U,Z){return U&&F(B.prototype,U),Z&&F(B,Z),B}}(),d=function F(B,U,Z){B===null&&(B=Function.prototype);var X=Object.getOwnPropertyDescriptor(B,U);if(X===void 0){var te=Object.getPrototypeOf(B);return te===null?void 0:F(te,U,Z)}else{if("value"in X)return X.value;var se=X.get;return se===void 0?void 0:se.call(Z)}},i=o(35),g=C(i),x=o(5),S=C(x),E=o(9),A=C(E);function C(F){return F&&F.__esModule?F:{default:F}}function N(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function k(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function R(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var L=function(F){R(B,F);function B(){return N(this,B),k(this,(B.__proto__||Object.getPrototypeOf(B)).apply(this,arguments))}return l(B,null,[{key:"create",value:function(Z){var X=d(B.__proto__||Object.getPrototypeOf(B),"create",this).call(this,Z);return typeof Z=="string"&&(window.katex.render(Z,X,{throwOnError:!1,errorColor:"#f00"}),X.setAttribute("data-value",Z)),X}},{key:"value",value:function(Z){return Z.getAttribute("data-value")}}]),B}(g.default);L.blotName="formula",L.className="ql-formula",L.tagName="SPAN";var j=function(F){R(B,F),l(B,null,[{key:"register",value:function(){S.default.register(L,!0)}}]);function B(){N(this,B);var U=k(this,(B.__proto__||Object.getPrototypeOf(B)).call(this));if(window.katex==null)throw new Error("Formula module requires KaTeX.");return U}return B}(A.default);n.FormulaBlot=L,n.default=j},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.CodeToken=n.CodeBlock=void 0;var l=function(){function Z(X,te){for(var se=0;se<te.length;se++){var oe=te[se];oe.enumerable=oe.enumerable||!1,oe.configurable=!0,"value"in oe&&(oe.writable=!0),Object.defineProperty(X,oe.key,oe)}}return function(X,te,se){return te&&Z(X.prototype,te),se&&Z(X,se),X}}(),d=function Z(X,te,se){X===null&&(X=Function.prototype);var oe=Object.getOwnPropertyDescriptor(X,te);if(oe===void 0){var ne=Object.getPrototypeOf(X);return ne===null?void 0:Z(ne,te,se)}else{if("value"in oe)return oe.value;var ee=oe.get;return ee===void 0?void 0:ee.call(se)}},i=o(0),g=k(i),x=o(5),S=k(x),E=o(9),A=k(E),C=o(13),N=k(C);function k(Z){return Z&&Z.__esModule?Z:{default:Z}}function R(Z,X){if(!(Z instanceof X))throw new TypeError("Cannot call a class as a function")}function L(Z,X){if(!Z)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return X&&(typeof X=="object"||typeof X=="function")?X:Z}function j(Z,X){if(typeof X!="function"&&X!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof X);Z.prototype=Object.create(X&&X.prototype,{constructor:{value:Z,enumerable:!1,writable:!0,configurable:!0}}),X&&(Object.setPrototypeOf?Object.setPrototypeOf(Z,X):Z.__proto__=X)}var F=function(Z){j(X,Z);function X(){return R(this,X),L(this,(X.__proto__||Object.getPrototypeOf(X)).apply(this,arguments))}return l(X,[{key:"replaceWith",value:function(se){this.domNode.textContent=this.domNode.textContent,this.attach(),d(X.prototype.__proto__||Object.getPrototypeOf(X.prototype),"replaceWith",this).call(this,se)}},{key:"highlight",value:function(se){var oe=this.domNode.textContent;this.cachedText!==oe&&((oe.trim().length>0||this.cachedText==null)&&(this.domNode.innerHTML=se(oe),this.domNode.normalize(),this.attach()),this.cachedText=oe)}}]),X}(N.default);F.className="ql-syntax";var B=new g.default.Attributor.Class("token","hljs",{scope:g.default.Scope.INLINE}),U=function(Z){j(X,Z),l(X,null,[{key:"register",value:function(){S.default.register(B,!0),S.default.register(F,!0)}}]);function X(te,se){R(this,X);var oe=L(this,(X.__proto__||Object.getPrototypeOf(X)).call(this,te,se));if(typeof oe.options.highlight!="function")throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var ne=null;return oe.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){clearTimeout(ne),ne=setTimeout(function(){oe.highlight(),ne=null},oe.options.interval)}),oe.highlight(),oe}return l(X,[{key:"highlight",value:function(){var se=this;if(!this.quill.selection.composing){this.quill.update(S.default.sources.USER);var oe=this.quill.getSelection();this.quill.scroll.descendants(F).forEach(function(ne){ne.highlight(se.options.highlight)}),this.quill.update(S.default.sources.SILENT),oe!=null&&this.quill.setSelection(oe,S.default.sources.SILENT)}}}]),X}(A.default);U.DEFAULTS={highlight:function(){return window.hljs==null?null:function(Z){var X=window.hljs.highlightAuto(Z);return X.value}}(),interval:1e3},n.CodeBlock=F,n.CodeToken=B,n.default=U},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(r,n){r.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(r,n){r.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(r,n){r.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(r,n,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.BubbleTooltip=void 0;var l=function X(te,se,oe){te===null&&(te=Function.prototype);var ne=Object.getOwnPropertyDescriptor(te,se);if(ne===void 0){var ee=Object.getPrototypeOf(te);return ee===null?void 0:X(ee,se,oe)}else{if("value"in ne)return ne.value;var ie=ne.get;return ie===void 0?void 0:ie.call(oe)}},d=function(){function X(te,se){for(var oe=0;oe<se.length;oe++){var ne=se[oe];ne.enumerable=ne.enumerable||!1,ne.configurable=!0,"value"in ne&&(ne.writable=!0),Object.defineProperty(te,ne.key,ne)}}return function(te,se,oe){return se&&X(te.prototype,se),oe&&X(te,oe),te}}(),i=o(3),g=R(i),x=o(8),S=R(x),E=o(43),A=R(E),C=o(15),N=o(41),k=R(N);function R(X){return X&&X.__esModule?X:{default:X}}function L(X,te){if(!(X instanceof te))throw new TypeError("Cannot call a class as a function")}function j(X,te){if(!X)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return te&&(typeof te=="object"||typeof te=="function")?te:X}function F(X,te){if(typeof te!="function"&&te!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof te);X.prototype=Object.create(te&&te.prototype,{constructor:{value:X,enumerable:!1,writable:!0,configurable:!0}}),te&&(Object.setPrototypeOf?Object.setPrototypeOf(X,te):X.__proto__=te)}var B=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],U=function(X){F(te,X);function te(se,oe){L(this,te),oe.modules.toolbar!=null&&oe.modules.toolbar.container==null&&(oe.modules.toolbar.container=B);var ne=j(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,se,oe));return ne.quill.container.classList.add("ql-bubble"),ne}return d(te,[{key:"extendToolbar",value:function(oe){this.tooltip=new Z(this.quill,this.options.bounds),this.tooltip.root.appendChild(oe.container),this.buildButtons([].slice.call(oe.container.querySelectorAll("button")),k.default),this.buildPickers([].slice.call(oe.container.querySelectorAll("select")),k.default)}}]),te}(A.default);U.DEFAULTS=(0,g.default)(!0,{},A.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(te){te?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var Z=function(X){F(te,X);function te(se,oe){L(this,te);var ne=j(this,(te.__proto__||Object.getPrototypeOf(te)).call(this,se,oe));return ne.quill.on(S.default.events.EDITOR_CHANGE,function(ee,ie,he,Se){if(ee===S.default.events.SELECTION_CHANGE)if(ie!=null&&ie.length>0&&Se===S.default.sources.USER){ne.show(),ne.root.style.left="0px",ne.root.style.width="",ne.root.style.width=ne.root.offsetWidth+"px";var Ce=ne.quill.getLines(ie.index,ie.length);if(Ce.length===1)ne.position(ne.quill.getBounds(ie));else{var fe=Ce[Ce.length-1],_e=ne.quill.getIndex(fe),be=Math.min(fe.length()-1,ie.index+ie.length-_e),Pe=ne.quill.getBounds(new C.Range(_e,be));ne.position(Pe)}}else document.activeElement!==ne.textbox&&ne.quill.hasFocus()&&ne.hide()}),ne}return d(te,[{key:"listen",value:function(){var oe=this;l(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",function(){oe.root.classList.remove("ql-editing")}),this.quill.on(S.default.events.SCROLL_OPTIMIZE,function(){setTimeout(function(){if(!oe.root.classList.contains("ql-hidden")){var ne=oe.quill.getSelection();ne!=null&&oe.position(oe.quill.getBounds(ne))}},1)})}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(oe){var ne=l(te.prototype.__proto__||Object.getPrototypeOf(te.prototype),"position",this).call(this,oe),ee=this.root.querySelector(".ql-tooltip-arrow");if(ee.style.marginLeft="",ne===0)return ne;ee.style.marginLeft=-1*ne-ee.offsetWidth/2+"px"}}]),te}(E.BaseTooltip);Z.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),n.BubbleTooltip=Z,n.default=U},function(r,n,o){r.exports=o(63)}]).default})})(kce);var DQe=kce.exports,LQe=mc&&mc.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var l in o)o.hasOwnProperty(l)&&(n[l]=o[l])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),jI=mc&&mc.__assign||function(){return jI=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},jI.apply(this,arguments)},FQe=mc&&mc.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),o=0,t=0;t<r;t++)for(var l=arguments[t],d=0,i=l.length;d<i;d++,o++)n[o]=l[d];return n},DR=mc&&mc.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},rh=DR(G),zQe=DR(Qm),bS=DR(mse),zK=DR(DQe),BQe=function(e){LQe(t,e);function t(r){var n=e.call(this,r)||this;n.dirtyProps=["modules","formats","bounds","theme","children"],n.cleanProps=["id","className","style","placeholder","tabIndex","onChange","onChangeSelection","onFocus","onBlur","onKeyPress","onKeyDown","onKeyUp"],n.state={generation:0},n.selection=null,n.onEditorChange=function(l,d,i,g){var x,S,E,A;l==="text-change"?(S=(x=n).onEditorChangeText)===null||S===void 0||S.call(x,n.editor.root.innerHTML,d,g,n.unprivilegedEditor):l==="selection-change"&&((A=(E=n).onEditorChangeSelection)===null||A===void 0||A.call(E,d,g,n.unprivilegedEditor))};var o=n.isControlled()?r.value:r.defaultValue;return n.value=o??"",n}return t.prototype.validateProps=function(r){var n;if(rh.default.Children.count(r.children)>1)throw new Error("The Quill editing area can only be composed of a single React element.");if(rh.default.Children.count(r.children)){var o=rh.default.Children.only(r.children);if(((n=o)===null||n===void 0?void 0:n.type)==="textarea")throw new Error("Quill does not support editing on a <textarea>. Use a <div> instead.")}if(this.lastDeltaChangeSet&&r.value===this.lastDeltaChangeSet)throw new Error("You are passing the `delta` object from the `onChange` event back as `value`. You most probably want `editor.getContents()` instead. See: https://github.com/zenoamaro/react-quill#using-deltas")},t.prototype.shouldComponentUpdate=function(r,n){var o=this,l;if(this.validateProps(r),!this.editor||this.state.generation!==n.generation)return!0;if("value"in r){var d=this.getEditorContents(),i=(l=r.value,l??"");this.isEqualValue(i,d)||this.setEditorContents(this.editor,i)}return r.readOnly!==this.props.readOnly&&this.setEditorReadOnly(this.editor,r.readOnly),FQe(this.cleanProps,this.dirtyProps).some(function(g){return!bS.default(r[g],o.props[g])})},t.prototype.shouldComponentRegenerate=function(r){var n=this;return this.dirtyProps.some(function(o){return!bS.default(r[o],n.props[o])})},t.prototype.componentDidMount=function(){this.instantiateEditor(),this.setEditorContents(this.editor,this.getEditorContents())},t.prototype.componentWillUnmount=function(){this.destroyEditor()},t.prototype.componentDidUpdate=function(r,n){var o=this;if(this.editor&&this.shouldComponentRegenerate(r)){var l=this.editor.getContents(),d=this.editor.getSelection();this.regenerationSnapshot={delta:l,selection:d},this.setState({generation:this.state.generation+1}),this.destroyEditor()}if(this.state.generation!==n.generation){var i=this.regenerationSnapshot,l=i.delta,g=i.selection;delete this.regenerationSnapshot,this.instantiateEditor();var x=this.editor;x.setContents(l),BK(function(){return o.setEditorSelection(x,g)})}},t.prototype.instantiateEditor=function(){this.editor?this.hookEditor(this.editor):this.editor=this.createEditor(this.getEditingArea(),this.getEditorConfig())},t.prototype.destroyEditor=function(){this.editor&&this.unhookEditor(this.editor)},t.prototype.isControlled=function(){return"value"in this.props},t.prototype.getEditorConfig=function(){return{bounds:this.props.bounds,formats:this.props.formats,modules:this.props.modules,placeholder:this.props.placeholder,readOnly:this.props.readOnly,scrollingContainer:this.props.scrollingContainer,tabIndex:this.props.tabIndex,theme:this.props.theme}},t.prototype.getEditor=function(){if(!this.editor)throw new Error("Accessing non-instantiated editor");return this.editor},t.prototype.createEditor=function(r,n){var o=new zK.default(r,n);return n.tabIndex!=null&&this.setEditorTabIndex(o,n.tabIndex),this.hookEditor(o),o},t.prototype.hookEditor=function(r){this.unprivilegedEditor=this.makeUnprivilegedEditor(r),r.on("editor-change",this.onEditorChange)},t.prototype.unhookEditor=function(r){r.off("editor-change",this.onEditorChange)},t.prototype.getEditorContents=function(){return this.value},t.prototype.getEditorSelection=function(){return this.selection},t.prototype.isDelta=function(r){return r&&r.ops},t.prototype.isEqualValue=function(r,n){return this.isDelta(r)&&this.isDelta(n)?bS.default(r.ops,n.ops):bS.default(r,n)},t.prototype.setEditorContents=function(r,n){var o=this;this.value=n;var l=this.getEditorSelection();typeof n=="string"?r.setContents(r.clipboard.convert(n)):r.setContents(n),BK(function(){return o.setEditorSelection(r,l)})},t.prototype.setEditorSelection=function(r,n){if(this.selection=n,n){var o=r.getLength();n.index=Math.max(0,Math.min(n.index,o-1)),n.length=Math.max(0,Math.min(n.length,o-1-n.index)),r.setSelection(n)}},t.prototype.setEditorTabIndex=function(r,n){var o,l;!((l=(o=r)===null||o===void 0?void 0:o.scroll)===null||l===void 0)&&l.domNode&&(r.scroll.domNode.tabIndex=n)},t.prototype.setEditorReadOnly=function(r,n){n?r.disable():r.enable()},t.prototype.makeUnprivilegedEditor=function(r){var n=r;return{getHTML:function(){return n.root.innerHTML},getLength:n.getLength.bind(n),getText:n.getText.bind(n),getContents:n.getContents.bind(n),getSelection:n.getSelection.bind(n),getBounds:n.getBounds.bind(n)}},t.prototype.getEditingArea=function(){if(!this.editingArea)throw new Error("Instantiating on missing editing area");var r=zQe.default.findDOMNode(this.editingArea);if(!r)throw new Error("Cannot find element for editing area");if(r.nodeType===3)throw new Error("Editing area cannot be a text node");return r},t.prototype.renderEditingArea=function(){var r=this,n=this.props,o=n.children,l=n.preserveWhitespace,d=this.state.generation,i={key:d,ref:function(g){r.editingArea=g}};return rh.default.Children.count(o)?rh.default.cloneElement(rh.default.Children.only(o),i):l?rh.default.createElement("pre",jI({},i)):rh.default.createElement("div",jI({},i))},t.prototype.render=function(){var r;return rh.default.createElement("div",{id:this.props.id,style:this.props.style,key:this.state.generation,className:"quill "+(r=this.props.className,r??""),onKeyPress:this.props.onKeyPress,onKeyDown:this.props.onKeyDown,onKeyUp:this.props.onKeyUp},this.renderEditingArea())},t.prototype.onEditorChangeText=function(r,n,o,l){var d,i;if(this.editor){var g=this.isDelta(this.value)?l.getContents():l.getHTML();g!==this.getEditorContents()&&(this.lastDeltaChangeSet=n,this.value=g,(i=(d=this.props).onChange)===null||i===void 0||i.call(d,r,n,o,l))}},t.prototype.onEditorChangeSelection=function(r,n,o){var l,d,i,g,x,S;if(this.editor){var E=this.getEditorSelection(),A=!E&&r,C=E&&!r;bS.default(r,E)||(this.selection=r,(d=(l=this.props).onChangeSelection)===null||d===void 0||d.call(l,r,n,o),A?(g=(i=this.props).onFocus)===null||g===void 0||g.call(i,r,n,o):C&&((S=(x=this.props).onBlur)===null||S===void 0||S.call(x,E,n,o)))}},t.prototype.focus=function(){this.editor&&this.editor.focus()},t.prototype.blur=function(){this.editor&&(this.selection=null,this.editor.blur())},t.displayName="React Quill",t.Quill=zK.default,t.defaultProps={theme:"snow",modules:{},readOnly:!1},t}(rh.default.Component);function BK(e){Promise.resolve().then(e)}var $Qe=BQe;const UQe=va($Qe);function TD({value:e,onChange:t,placeholder:r,className:n}){const o=G.useMemo(()=>({toolbar:[[{header:[1,2,3,!1]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{align:[]}],["link"],["clean"]]}),[]),l=["header","size","bold","italic","underline","strike","color","background","list","bullet","align","link"];return m.jsxs("div",{className:_r("rich-text-editor",n),children:[m.jsx("style",{dangerouslySetInnerHTML:{__html:`
          .rich-text-editor .ql-container {
            min-height: 200px;
            font-family: inherit;
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
          }
          
          .rich-text-editor .ql-toolbar {
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            background: hsl(var(--muted));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-container {
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-editor {
            min-height: 200px;
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-editor.ql-blank::before {
            color: hsl(var(--muted-foreground));
            font-style: normal;
          }
          
          .rich-text-editor .ql-stroke {
            stroke: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-fill {
            fill: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-picker-label {
            color: hsl(var(--foreground));
          }
          
          .rich-text-editor .ql-toolbar button:hover,
          .rich-text-editor .ql-toolbar button:focus,
          .rich-text-editor .ql-toolbar button.ql-active {
            color: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-stroke,
          .rich-text-editor .ql-toolbar button:focus .ql-stroke,
          .rich-text-editor .ql-toolbar button.ql-active .ql-stroke {
            stroke: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-toolbar button:hover .ql-fill,
          .rich-text-editor .ql-toolbar button:focus .ql-fill,
          .rich-text-editor .ql-toolbar button.ql-active .ql-fill {
            fill: hsl(var(--primary));
          }
          
          .rich-text-editor .ql-picker-options {
            background: hsl(var(--background));
            border-color: hsl(var(--border));
          }
          
          .rich-text-editor .ql-picker-item:hover {
            color: hsl(var(--primary));
          }
        `}}),m.jsx(UQe,{theme:"snow",value:e,onChange:t,modules:o,formats:l,placeholder:r,className:"bg-background"})]})}const VQe=sm({title_en:pa().min(1,"English title is required"),title_zh:pa().min(1,"Chinese title is required"),title_pt:pa().min(1,"Portuguese title is required"),content_en:pa().min(1,"English content is required"),content_zh:pa().min(1,"Chinese content is required"),content_pt:pa().min(1,"Portuguese content is required"),start_date:P9(),end_date:P9().optional(),repeat_mode:Iie(["none","daily","weekly","monthly","yearly"]),pinned:Oie().default(!1),sort_order:k3().default(0)});function $K({activity:e,trigger:t}){const{t:r}=Ki(),{toast:n}=wa(),o=Na(),[l,d]=G.useState(!1),[i,g]=G.useState(null),[x,S]=G.useState((e==null?void 0:e.image_url)||null),[E,A]=G.useState([]),[C,N]=G.useState(!1),{data:k}=p4(),{register:R,handleSubmit:L,formState:{errors:j},setValue:F,watch:B,control:U}=am({resolver:om(VQe),defaultValues:e?{title_en:e.title_en,title_zh:e.title_zh,title_pt:e.title_pt,content_en:e.content_en,content_zh:e.content_zh,content_pt:e.content_pt,start_date:new Date(e.start_date),end_date:e.end_date?new Date(e.end_date):void 0,repeat_mode:e.repeat_mode||"none",pinned:e.pinned||!1,sort_order:e.sort_order||0}:{repeat_mode:"none",pinned:!1,sort_order:0}}),Z=B("start_date"),X=B("end_date"),te=B("pinned");G.useEffect(()=>{(async()=>{if(e!=null&&e.id){const{data:ie}=await Ut.from("activity_restaurants").select("restaurant_id").eq("activity_id",e.id);ie&&A(ie.map(he=>he.restaurant_id))}})()},[e==null?void 0:e.id]);const se=ee=>{var he;const ie=(he=ee.target.files)==null?void 0:he[0];if(ie){g(ie);const Se=new FileReader;Se.onloadend=()=>{S(Se.result)},Se.readAsDataURL(ie)}},oe=async()=>{if(!i)return(e==null?void 0:e.image_url)||null;const ee=i.name.split(".").pop(),he=`${`${Math.random()}.${ee}`}`,{error:Se}=await Ut.storage.from("activity-images").upload(he,i);if(Se)throw Se;const{data:{publicUrl:Ce}}=Ut.storage.from("activity-images").getPublicUrl(he);return Ce},ne=async ee=>{var ie;N(!0);try{const{data:{user:he}}=await Ut.auth.getUser();if(!he)throw new Error("Not authenticated");const Se=await oe(),Ce={title_en:ee.title_en,title_zh:ee.title_zh,title_pt:ee.title_pt,content_en:ee.content_en,content_zh:ee.content_zh,content_pt:ee.content_pt,repeat_mode:ee.repeat_mode,pinned:ee.pinned,sort_order:ee.sort_order,image_url:Se,creator_id:he.id,start_date:ee.start_date.toISOString(),end_date:((ie=ee.end_date)==null?void 0:ie.toISOString())||null};if(e){const{error:fe}=await Ut.from("activities").update(Ce).eq("id",e.id);if(fe)throw fe;if(await Ut.from("activity_restaurants").delete().eq("activity_id",e.id),E.length>0){const _e=E.map(Pe=>({activity_id:e.id,restaurant_id:Pe})),{error:be}=await Ut.from("activity_restaurants").insert(_e);if(be)throw be}n({title:r("common.success"),description:r("admin.activityUpdated")})}else{const{data:fe,error:_e}=await Ut.from("activities").insert([Ce]).select().single();if(_e)throw _e;if(E.length>0){const be=E.map(ye=>({activity_id:fe.id,restaurant_id:ye})),{error:Pe}=await Ut.from("activity_restaurants").insert(be);if(Pe)throw Pe}n({title:r("common.success"),description:r("admin.activityCreated")})}o.invalidateQueries({queryKey:["activities"]}),d(!1)}catch(he){n({title:r("common.error"),description:he.message,variant:"destructive"})}finally{N(!1)}};return m.jsxs(Rh,{open:l,onOpenChange:d,children:[m.jsx(Iv,{asChild:!0,children:t}),m.jsxs(Rd,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[m.jsxs(jd,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[m.jsxs(Nd,{className:"text-2xl flex items-center gap-2",children:[m.jsx(C0,{className:"w-6 h-6 text-primary"}),r(e?"admin.editActivity":"admin.addActivity")]}),m.jsx(Md,{className:"text-base",children:r(e?"admin.editActivityDetails":"admin.createActivityWithContent")})]}),m.jsx(uv,{className:"px-6 h-[calc(95vh-220px)]",children:m.jsxs("form",{onSubmit:L(ne),className:"space-y-6 py-6",children:[m.jsx(Qr,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:m.jsxs(dn,{className:"p-6",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(O0,{className:"w-5 h-5 text-primary"}),r("admin.activityImage")]}),m.jsxs("div",{className:"flex items-center gap-6",children:[x&&m.jsxs("div",{className:"relative group",children:[m.jsx("img",{src:x,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),m.jsx(lr,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{g(null),S(null)},children:m.jsx(ju,{className:"h-4 w-4"})})]}),m.jsxs(Zr,{htmlFor:"image-upload",className:"cursor-pointer",children:[m.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[m.jsx(O0,{className:"h-8 w-8 text-primary"}),m.jsxs("div",{className:"text-center",children:[m.jsx("p",{className:"font-medium text-sm",children:r("admin.uploadImage")}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:r("admin.imageMaxSize")})]})]}),m.jsx(an,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:se})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(C0,{className:"w-5 h-5 text-primary"}),r("admin.multilingualContent")]}),m.jsxs(zk,{defaultValue:"zh",className:"w-full",children:[m.jsxs(qT,{className:"grid w-full grid-cols-3 mb-6",children:[m.jsxs(Cu,{value:"zh",className:"gap-2",children:[" ",r("admin.chinese")]}),m.jsxs(Cu,{value:"en",className:"gap-2",children:[" ",r("admin.english")]}),m.jsxs(Cu,{value:"pt",className:"gap-2",children:[" ",r("admin.portuguese")]})]}),m.jsxs(Ou,{value:"zh",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"title_zh",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(an,{id:"title_zh",...R("title_zh"),placeholder:r("admin.enterTitle"),className:"text-base"}),j.title_zh&&m.jsx("p",{className:"text-sm text-destructive",children:j.title_zh.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"content_zh",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(bC,{name:"content_zh",control:U,render:({field:ee})=>m.jsx(TD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),j.content_zh&&m.jsx("p",{className:"text-sm text-destructive",children:j.content_zh.message})]})]}),m.jsxs(Ou,{value:"en",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"title_en",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(an,{id:"title_en",...R("title_en"),placeholder:r("admin.enterTitle"),className:"text-base"}),j.title_en&&m.jsx("p",{className:"text-sm text-destructive",children:j.title_en.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"content_en",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(bC,{name:"content_en",control:U,render:({field:ee})=>m.jsx(TD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),j.content_en&&m.jsx("p",{className:"text-sm text-destructive",children:j.content_en.message})]})]}),m.jsxs(Ou,{value:"pt",className:"space-y-4 mt-0",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"title_pt",className:"text-sm font-medium",children:r("admin.title")}),m.jsx(an,{id:"title_pt",...R("title_pt"),placeholder:r("admin.enterTitle"),className:"text-base"}),j.title_pt&&m.jsx("p",{className:"text-sm text-destructive",children:j.title_pt.message})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"content_pt",className:"text-sm font-medium",children:r("admin.content")}),m.jsx(bC,{name:"content_pt",control:U,render:({field:ee})=>m.jsx(TD,{value:ee.value,onChange:ee.onChange,placeholder:r("admin.enterContent")})}),j.content_pt&&m.jsx("p",{className:"text-sm text-destructive",children:j.content_pt.message})]})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6 space-y-6",children:[m.jsxs("div",{children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx($l,{className:"w-5 h-5 text-primary"}),r("admin.dateSettings")]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{className:"text-sm font-medium",children:r("admin.startDate")}),m.jsxs(LK,{children:[m.jsx(FK,{asChild:!0,children:m.jsxs(lr,{variant:"outline",className:_r("w-full justify-start text-left font-normal h-11",!Z&&"text-muted-foreground"),children:[m.jsx($l,{className:"mr-2 h-4 w-4"}),Z?Is(Z,"PPP"):m.jsx("span",{children:r("admin.selectDate")})]})}),m.jsx(sz,{className:"w-auto p-0 z-[100]",align:"start",children:m.jsx(oz,{mode:"single",selected:Z,onSelect:ee=>F("start_date",ee),initialFocus:!0,className:"pointer-events-auto"})})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{className:"text-sm font-medium",children:r("admin.endDate")}),m.jsxs(LK,{children:[m.jsx(FK,{asChild:!0,children:m.jsxs(lr,{variant:"outline",className:_r("w-full justify-start text-left font-normal h-11",!X&&"text-muted-foreground"),children:[m.jsx($l,{className:"mr-2 h-4 w-4"}),X?Is(X,"PPP"):m.jsxs("span",{children:[r("admin.selectDate")," (",r("admin.optional"),")"]})]})}),m.jsx(sz,{className:"w-auto p-0 z-[100]",align:"start",children:m.jsx(oz,{mode:"single",selected:X,onSelect:ee=>F("end_date",ee),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx(Zr,{htmlFor:"repeat_mode",className:"text-sm font-medium",children:r("admin.repeatMode")}),m.jsxs(wd,{onValueChange:ee=>F("repeat_mode",ee),defaultValue:B("repeat_mode"),children:[m.jsx(Au,{className:"h-11",children:m.jsx(Sd,{placeholder:r("admin.selectRepeatMode")})}),m.jsxs(Pu,{children:[m.jsx(La,{value:"none",children:r("admin.repeatNone")}),m.jsx(La,{value:"daily",children:r("admin.repeatDaily")}),m.jsx(La,{value:"weekly",children:r("admin.repeatWeekly")}),m.jsx(La,{value:"monthly",children:r("admin.repeatMonthly")}),m.jsx(La,{value:"yearly",children:r("admin.repeatYearly")})]})]})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[m.jsx(Gs,{id:"pinned",checked:te,onCheckedChange:ee=>F("pinned",ee),className:"data-[state=checked]:bg-primary"}),m.jsxs(Zr,{htmlFor:"pinned",className:"cursor-pointer flex items-center gap-2 text-sm font-medium",children:[m.jsx(cye,{className:"w-4 h-4 text-primary"}),r("admin.pinToTop")]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs(Zr,{htmlFor:"sort_order",className:"text-sm font-medium flex items-center gap-2",children:[m.jsx(qge,{className:"w-4 h-4 text-primary"}),r("admin.sortOrder")]}),m.jsx(an,{id:"sort_order",type:"number",...R("sort_order",{valueAsNumber:!0}),className:"h-11",placeholder:"0"})]})]})]})}),m.jsx(Qr,{className:"border-primary/20",children:m.jsxs(dn,{className:"p-6",children:[m.jsxs(Zr,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[m.jsx(Qo,{className:"w-5 h-5 text-primary"}),r("admin.associatedRestaurants")]}),m.jsx(uv,{className:"h-64 border rounded-lg p-4 bg-muted/20",children:m.jsx("div",{className:"space-y-2",children:k==null?void 0:k.map(ee=>m.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30",children:[m.jsx(Gs,{id:ee.id,checked:E.includes(ee.id),onCheckedChange:ie=>{A(ie?[...E,ee.id]:E.filter(he=>he!==ee.id))},className:"data-[state=checked]:bg-primary"}),m.jsx(Zr,{htmlFor:ee.id,className:"cursor-pointer flex-1 font-normal",children:ee.name}),E.includes(ee.id)&&m.jsx(Qn,{variant:"secondary",className:"text-xs",children:""})]},ee.id))})}),m.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[" ",E.length," "]})]})}),m.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-6",children:[m.jsx(lr,{type:"button",variant:"outline",onClick:()=>d(!1),className:"min-w-[100px]",children:r("common.cancel")}),m.jsx(lr,{type:"submit",disabled:C,className:"min-w-[100px] bg-primary hover:bg-primary/90",children:C?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"..."]}):r("common.save")})]})]})})]})]})}const qQe=()=>{const{t:e}=Ki(),{toast:t}=wa(),{data:r,isLoading:n}=Yie(),{getLocalizedField:o}=kd(),l=EOe(),d=COe(),[i,g]=G.useState([]),[x,S]=G.useState(""),[E,A]=G.useState("all"),C=G.useMemo(()=>r?r.filter(j=>{const F=String(o(j,"title")||""),B=String(o(j,"content")||""),U=x===""||F.toLowerCase().includes(x.toLowerCase())||B.toLowerCase().includes(x.toLowerCase()),Z=new Date,X=new Date(j.start_date),te=j.end_date?new Date(j.end_date):null,se=te?te<Z:!1,oe=!se&&X<=Z,ne=E==="all"||E==="active"&&oe||E==="ended"&&se||E==="pinned"&&j.pinned;return U&&ne}):[],[r,x,E,o]),N=()=>{if(!r||r.length===0){t({title:e("common.error"),description:e("admin.noDataToExport"),variant:"destructive"});return}LYe(r),t({title:e("common.success"),description:e("admin.exportSuccess")})},k=j=>{g(F=>F.includes(j)?F.filter(B=>B!==j):[...F,j])},R=()=>{i.length===(C==null?void 0:C.length)?g([]):g((C==null?void 0:C.map(j=>j.id))||[])},L=()=>{i.length!==0&&(d.mutate(i),g([]))};return n?m.jsx(Qc,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})}):m.jsx(Qc,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:e("admin.activityManagement")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.manageActivities")})]}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsxs(lr,{variant:"outline",onClick:N,className:"flex-1 sm:flex-initial",children:[m.jsx(ek,{className:"mr-2 h-4 w-4"}),m.jsx("span",{className:"hidden sm:inline",children:e("admin.exportCSV")})]}),m.jsx($K,{trigger:m.jsxs(lr,{className:"flex-1 sm:flex-initial",children:[m.jsx(hB,{className:"mr-2 h-4 w-4"}),e("admin.addActivity")]})})]})]}),m.jsx(Qr,{children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex gap-4 flex-wrap",children:[m.jsx("div",{className:"flex-1 min-w-[200px]",children:m.jsxs("div",{className:"relative",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),m.jsx(an,{placeholder:e("admin.searchActivities"),value:x,onChange:j=>S(j.target.value),className:"pl-9"})]})}),m.jsxs(wd,{value:E,onValueChange:A,children:[m.jsx(Au,{className:"w-[180px]",children:m.jsx(Sd,{placeholder:e("admin.filterByStatus")})}),m.jsxs(Pu,{children:[m.jsx(La,{value:"all",children:e("admin.allStatus")}),m.jsx(La,{value:"active",children:e("admin.statusActive")}),m.jsx(La,{value:"ended",children:e("admin.statusEnded")}),m.jsx(La,{value:"pinned",children:e("admin.statusPinned")})]})]})]})})}),i.length>0&&m.jsx(Qr,{className:"bg-muted/50",children:m.jsx(dn,{className:"pt-6",children:m.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[m.jsx("span",{className:"font-medium",children:e("admin.selectedCount",{count:i.length})}),m.jsxs("div",{className:"flex gap-2 flex-wrap w-full sm:w-auto",children:[m.jsxs(zl,{children:[m.jsx(IE,{asChild:!0,children:m.jsxs(lr,{variant:"destructive",size:"sm",className:"flex-1 sm:flex-initial",children:[m.jsx(bb,{className:"mr-2 h-4 w-4"}),e("admin.batchDelete")]})}),m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:e("admin.confirmBatchDelete")}),m.jsx(ul,{children:e("admin.batchDeleteWarning",{count:i.length})})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:e("common.cancel")}),m.jsx(Us,{onClick:L,children:e("common.delete")})]})]})]}),m.jsx(lr,{variant:"outline",size:"sm",onClick:()=>g([]),className:"flex-1 sm:flex-initial",children:e("admin.clearSelection")})]})]})})}),m.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[m.jsx(Gs,{checked:i.length===(C==null?void 0:C.length)&&C.length>0,onCheckedChange:R}),m.jsx("span",{className:"font-medium",children:e("admin.selectAll")}),m.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",C==null?void 0:C.length," ",e("admin.results"),")"]})]}),m.jsx("div",{className:"grid gap-4",children:C==null?void 0:C.map(j=>m.jsx(Qr,{children:m.jsxs("div",{className:"flex flex-col md:flex-row",children:[m.jsx("div",{className:"p-4 flex items-start",children:m.jsx(Gs,{checked:i.includes(j.id),onCheckedChange:()=>k(j.id),className:"mt-1"})}),j.image_url&&m.jsx("div",{className:"w-full md:w-48 h-48",children:m.jsx("img",{src:j.image_url,alt:String(o(j,"title")),className:"object-cover w-full h-full"})}),m.jsxs("div",{className:"flex-1",children:[m.jsxs(Mi,{children:[m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[m.jsx(Ji,{className:"text-lg md:text-xl",children:o(j,"title")}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[j.pinned&&m.jsx(Qn,{children:e("activities.pinned")}),(()=>{const F=new Date,B=new Date(j.start_date),U=j.end_date?new Date(j.end_date):null,Z=U?U<F:!1,X=!Z&&B<=F;return Z?m.jsx(Qn,{variant:"secondary",children:e("activities.ended")}):X?m.jsx(Qn,{children:e("activities.ongoing")}):null})()]})]}),m.jsx(Do,{className:"line-clamp-2",children:m.jsx("div",{className:`prose prose-sm max-w-none\r
                          [&_p]:inline [&_p]:m-0\r
                          [&_strong]:font-semibold [&_strong]:text-foreground\r
                          [&_em]:italic\r
                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r
                          [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:o(j,"content")}})})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto",children:m.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[m.jsx($l,{className:"h-4 w-4 flex-shrink-0"}),m.jsxs("span",{className:"text-xs sm:text-sm",children:[Is(new Date(j.start_date),"PPP"),j.end_date&&` - ${Is(new Date(j.end_date),"PPP")}`]})]})}),m.jsxs("div",{className:"flex gap-2 flex-wrap",children:[m.jsx(lr,{variant:"outline",size:"sm",asChild:!0,className:"flex-1 sm:flex-initial",children:m.jsx(Vi,{to:`/activity/${j.id}`,state:{from:"admin"},children:e("admin.view")})}),m.jsx($K,{activity:j,trigger:m.jsx(lr,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.edit")})}),m.jsxs(zl,{children:[m.jsx(IE,{asChild:!0,children:m.jsx(lr,{variant:"outline",size:"sm",className:"flex-1 sm:flex-initial",children:e("common.delete")})}),m.jsxs(ol,{className:"max-w-[90vw] sm:max-w-[425px]",children:[m.jsxs(sl,{children:[m.jsx(cl,{children:e("admin.confirmDelete")}),m.jsx(ul,{children:e("admin.deleteActivityWarning")})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:e("common.cancel")}),m.jsx(Us,{onClick:()=>l.mutate(j.id),children:e("common.delete")})]})]})]})]})]})]})]})},j.id))})]})})},WQe=()=>{const{t:e}=Ki(),{data:t,isLoading:r}=gOe();if(r)return m.jsx(Qc,{children:m.jsx("div",{className:"text-center",children:e("common.loading")})});const n=o=>({INSERT:"default",UPDATE:"secondary",DELETE:"destructive"})[o]||"secondary";return m.jsx(Qc,{children:m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:e("admin.operationLogs")}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.viewSystemLogs")})]}),t&&t.length>0?m.jsx("div",{className:"space-y-4",children:t.map(o=>m.jsxs(Qr,{children:[m.jsx(Mi,{children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs(Ji,{className:"text-base",children:[o.user_name," - ",o.table_name]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Qn,{variant:n(o.action),children:o.action}),m.jsx("span",{className:"text-xs text-muted-foreground",children:_f(new Date(o.created_at),{addSuffix:!0})})]})]})}),(o.old_data||o.new_data)&&m.jsx(dn,{children:m.jsxs("div",{className:"grid gap-2 text-sm",children:[o.old_data&&m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[e("admin.oldData"),":"]}),m.jsx("pre",{className:"mt-1 p-2 bg-secondary rounded text-xs overflow-auto",children:JSON.stringify(o.old_data,null,2)})]}),o.new_data&&m.jsxs("div",{children:[m.jsxs("span",{className:"font-semibold",children:[e("admin.newData"),":"]}),m.jsx("pre",{className:"mt-1 p-2 bg-secondary rounded text-xs overflow-auto",children:JSON.stringify(o.new_data,null,2)})]})]})})]},o.id))}):m.jsx(Qr,{children:m.jsx(dn,{className:"py-12 text-center text-muted-foreground",children:e("admin.noLogs")})})]})})},Rce=G.forwardRef(({className:e,...t},r)=>m.jsx("div",{className:"relative w-full overflow-auto",children:m.jsx("table",{ref:r,className:_r("w-full caption-bottom text-sm",e),...t})}));Rce.displayName="Table";const jce=G.forwardRef(({className:e,...t},r)=>m.jsx("thead",{ref:r,className:_r("[&_tr]:border-b",e),...t}));jce.displayName="TableHeader";const Nce=G.forwardRef(({className:e,...t},r)=>m.jsx("tbody",{ref:r,className:_r("[&_tr:last-child]:border-0",e),...t}));Nce.displayName="TableBody";const GQe=G.forwardRef(({className:e,...t},r)=>m.jsx("tfoot",{ref:r,className:_r("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...t}));GQe.displayName="TableFooter";const lz=G.forwardRef(({className:e,...t},r)=>m.jsx("tr",{ref:r,className:_r("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",e),...t}));lz.displayName="TableRow";const Zp=G.forwardRef(({className:e,...t},r)=>m.jsx("th",{ref:r,className:_r("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...t}));Zp.displayName="TableHead";const Xp=G.forwardRef(({className:e,...t},r)=>m.jsx("td",{ref:r,className:_r("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...t}));Xp.displayName="TableCell";const HQe=G.forwardRef(({className:e,...t},r)=>m.jsx("caption",{ref:r,className:_r("mt-4 text-sm text-muted-foreground",e),...t}));HQe.displayName="TableCaption";const KQe=()=>{const{t:e}=Ki(),[t,r]=G.useState(""),[n,o]=G.useState("all"),[l,d]=G.useState(null),i=Na(),{data:g,isLoading:x}=Wi({queryKey:["joinRequests"],queryFn:async()=>{const{data:L,error:j}=await Ut.from("join_requests").select("*").order("created_at",{ascending:!1});if(j)throw j;return L}}),{data:S}=Wi({queryKey:["emailConfig","join_request"],queryFn:async()=>{const{data:L,error:j}=await Ut.from("email_config").select("*").eq("type","join_request").single();if(j)throw j;return L}}),E=g==null?void 0:g.filter(L=>{const j=t.toLowerCase(),F=L.name.toLowerCase().includes(j)||L.email.toLowerCase().includes(j)||L.restaurant_name.toLowerCase().includes(j)||L.phone.toLowerCase().includes(j),B=n==="all"||L.status===n;return F&&B}),A=async()=>{const L=prompt(e("joinUs.enterNewEmail"),S==null?void 0:S.recipient_email);if(L)try{const{error:j}=await Ut.from("email_config").update({recipient_email:L}).eq("id",S==null?void 0:S.id);if(j)throw j;Lc({title:e("common.success"),description:e("joinUs.emailUpdated")})}catch(j){console.error("Error updating email:",j),Lc({title:e("common.error"),description:e("joinUs.emailUpdateError"),variant:"destructive"})}},C=Xa({mutationFn:async({id:L,status:j})=>{const{error:F}=await Ut.from("join_requests").update({status:j}).eq("id",L);if(F)throw F},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Lc({title:e("common.success"),description:e("joinUs.statusUpdated")})},onError:L=>{console.error("Error updating status:",L),Lc({title:e("common.error"),description:e("joinUs.statusUpdateError"),variant:"destructive"})}}),N=Xa({mutationFn:async L=>{const{error:j}=await Ut.from("join_requests").delete().eq("id",L);if(j)throw j},onSuccess:()=>{i.invalidateQueries({queryKey:["joinRequests"]}),Lc({title:e("common.success"),description:e("joinUs.requestDeleted")}),d(null)},onError:L=>{console.error("Error deleting request:",L),Lc({title:e("common.error"),description:e("joinUs.deleteError"),variant:"destructive"})}}),k=()=>{if(!E||E.length===0){Lc({title:e("admin.noDataToExport"),variant:"destructive"});return}const L=[["Name","Email","Phone","Restaurant Name","Restaurant Address","Features","Status","Submitted Date"],...E.map(U=>[U.name,U.email,U.phone,U.restaurant_name,U.restaurant_address||"",Array.isArray(U.features_selected)?U.features_selected.join(", "):"",U.status||"pending",new Date(U.created_at).toLocaleString()])].map(U=>U.map(Z=>`"${Z}"`).join(",")).join(`
`),j=new Blob([L],{type:"text/csv;charset=utf-8;"}),F=document.createElement("a"),B=URL.createObjectURL(j);F.setAttribute("href",B),F.setAttribute("download",`join_requests_${new Date().toISOString()}.csv`),F.click(),URL.revokeObjectURL(B),Lc({title:e("admin.exportSuccess")})},R=L=>{switch(L){case"completed":return"default";case"rejected":return"destructive";default:return"secondary"}};return m.jsxs(Qc,{children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-3xl font-bold",children:e("joinUs.adminTitle")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:e("joinUs.adminDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:e("joinUs.recipientEmail")}),m.jsx(Do,{children:e("joinUs.recipientEmailDesc")})]}),m.jsx(dn,{children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(an,{value:(S==null?void 0:S.recipient_email)||"",readOnly:!0}),m.jsx(lr,{onClick:A,children:e("common.edit")})]})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:e("joinUs.totalRequests")}),m.jsx(Do,{children:e("joinUs.totalRequestsDesc")})]}),m.jsx(dn,{children:m.jsx("div",{className:"text-3xl font-bold",children:(g==null?void 0:g.length)||0})})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx(Ji,{children:e("joinUs.allRequests")}),m.jsx(Do,{children:e("joinUs.allRequestsDesc")})]}),m.jsxs(lr,{onClick:k,variant:"outline",children:[m.jsx(ek,{className:"w-4 h-4 mr-2"}),e("admin.exportCSV")]})]}),m.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(an,{placeholder:e("joinUs.searchPlaceholder"),value:t,onChange:L=>r(L.target.value),className:"pl-10"})]}),m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsxs(lr,{variant:"outline",className:"gap-2",children:[m.jsx(cB,{className:"w-4 h-4"}),e(n==="all"?"admin.allStatus":`joinUs.status.${n}`)]})}),m.jsxs(ng,{align:"end",className:"bg-background",children:[m.jsx(Ca,{onClick:()=>o("all"),children:e("admin.allStatus")}),m.jsx(Ca,{onClick:()=>o("pending"),children:e("joinUs.status.pending")}),m.jsx(Ca,{onClick:()=>o("completed"),children:e("joinUs.status.completed")}),m.jsx(Ca,{onClick:()=>o("rejected"),children:e("joinUs.status.rejected")})]})]})]})]}),m.jsx(dn,{children:x?m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("common.loading")}):E&&E.length>0?m.jsx("div",{className:"overflow-x-auto",children:m.jsxs(Rce,{children:[m.jsx(jce,{children:m.jsxs(lz,{children:[m.jsx(Zp,{children:e("joinUs.name")}),m.jsx(Zp,{children:e("joinUs.contact")}),m.jsx(Zp,{children:e("joinUs.restaurant")}),m.jsx(Zp,{children:e("joinUs.featuresNeeded")}),m.jsx(Zp,{children:e("joinUs.status")}),m.jsx(Zp,{children:e("joinUs.submittedAt")}),m.jsx(Zp,{className:"text-right",children:e("common.actions")})]})}),m.jsx(Nce,{children:E.map(L=>m.jsxs(lz,{children:[m.jsx(Xp,{className:"font-medium",children:L.name}),m.jsx(Xp,{children:m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsx(KY,{className:"w-3 h-3 text-muted-foreground"}),m.jsx("a",{href:`mailto:${L.email}`,className:"hover:underline",children:L.email})]}),m.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[m.jsx(PT,{className:"w-3 h-3 text-muted-foreground"}),m.jsx("a",{href:`tel:${L.phone}`,className:"hover:underline",children:L.phone})]})]})}),m.jsx(Xp,{children:m.jsxs("div",{className:"space-y-1",children:[m.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[m.jsx(Qo,{className:"w-3 h-3 text-muted-foreground"}),L.restaurant_name]}),L.restaurant_address&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(Cs,{className:"w-3 h-3"}),L.restaurant_address]})]})}),m.jsx(Xp,{children:m.jsx("div",{className:"flex flex-wrap gap-1",children:Array.isArray(L.features_selected)&&L.features_selected.map((j,F)=>m.jsx(Qn,{variant:"secondary",children:e(`joinUs.feature.${j}`)},F))})}),m.jsx(Xp,{children:m.jsx(Qn,{variant:R(L.status||"pending"),children:e(`joinUs.status.${L.status||"pending"}`)})}),m.jsx(Xp,{className:"text-sm text-muted-foreground",children:_f(new Date(L.created_at),{addSuffix:!0})}),m.jsx(Xp,{children:m.jsxs("div",{className:"flex items-center justify-end gap-2",children:[L.status!=="completed"&&m.jsx(lr,{size:"sm",variant:"outline",onClick:()=>C.mutate({id:L.id,status:"completed"}),disabled:C.isPending,children:m.jsx(Tf,{className:"w-4 h-4"})}),m.jsx(lr,{size:"sm",variant:"destructive",onClick:()=>d(L.id),disabled:N.isPending,children:m.jsx(bb,{className:"w-4 h-4"})})]})})]},L.id))})]})}):m.jsx("div",{className:"text-center py-8 text-muted-foreground",children:e("joinUs.noRequests")})})]})]}),m.jsx(zl,{open:l!==null,onOpenChange:L=>!L&&d(null),children:m.jsxs(ol,{children:[m.jsxs(sl,{children:[m.jsx(cl,{children:e("joinUs.confirmDelete")}),m.jsx(ul,{children:e("joinUs.confirmDeleteDescription")})]}),m.jsxs(ll,{children:[m.jsx(dl,{children:e("common.cancel")}),m.jsx(Us,{onClick:()=>l&&N.mutate(l),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:e("common.delete")})]})]})})]})},ZQe=()=>{var ne;const{t:e}=Ki(),t=Na(),[r,n]=G.useState(null),[o,l]=G.useState(""),[d,i]=G.useState(""),[g,x]=G.useState(""),[S,E]=G.useState("all"),{data:A,isLoading:C}=Wi({queryKey:["admin-reports"],queryFn:async()=>{const{data:ee,error:ie}=await Ut.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(ie)throw ie;return ee}}),{data:N}=Wi({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:ee,error:ie}=await Ut.from("email_config").select("*").eq("type","report").single();if(ie)throw ie;return ee}}),k=A==null?void 0:A.filter(ee=>{var Ce,fe;const ie=g.toLowerCase(),he=ee.description.toLowerCase().includes(ie)||((fe=(Ce=ee.reporter)==null?void 0:Ce.display_name)==null?void 0:fe.toLowerCase().includes(ie))||ee.reason.toLowerCase().includes(ie),Se=S==="all"||ee.status===S;return he&&Se}),R={total:(A==null?void 0:A.length)||0,pending:(A==null?void 0:A.filter(ee=>ee.status==="pending").length)||0,reviewing:(A==null?void 0:A.filter(ee=>ee.status==="reviewing").length)||0,resolved:(A==null?void 0:A.filter(ee=>ee.status==="resolved").length)||0,dismissed:(A==null?void 0:A.filter(ee=>ee.status==="dismissed").length)||0},L=Array.from({length:7},(ee,ie)=>{const he=Hm(yC(new Date,6-ie)),Se=Is(he,"yyyy-MM-dd"),Ce=(A==null?void 0:A.filter(fe=>Is(Hm(new Date(fe.created_at)),"yyyy-MM-dd")===Se).length)||0;return{date:Is(he,"MM/dd"),count:Ce}}),j=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(ee=>({name:e(`report.reasons.${ee}`),value:(A==null?void 0:A.filter(ie=>ie.reason===ee).length)||0})).filter(ee=>ee.value>0),F=["comment","restaurant","activity","user"].map(ee=>({name:e(`admin.reportType.${ee}`),value:(A==null?void 0:A.filter(ie=>ie.target_type===ee).length)||0})).filter(ee=>ee.value>0),B=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],U=async()=>{const ee=prompt(e("joinUs.enterNewEmail"),N==null?void 0:N.recipient_email);if(ee)try{const{error:ie}=await Ut.from("email_config").update({recipient_email:ee}).eq("id",N==null?void 0:N.id);if(ie)throw ie;t.invalidateQueries({queryKey:["emailConfig"]}),Vr.success(e("joinUs.emailUpdated"))}catch(ie){console.error("Error updating email:",ie),Vr.error(e("joinUs.emailUpdateError"))}},Z=Xa({mutationFn:async({id:ee,status:ie,notes:he})=>{const Se={updated_at:new Date().toISOString()};ie&&(Se.status=ie),he!==void 0&&(Se.admin_notes=he);const{error:Ce}=await Ut.from("reports").update(Se).eq("id",ee);if(Ce)throw Ce},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-reports"]}),Vr.success("Report updated successfully"),n(null)},onError:ee=>{Vr.error(ee.message||"Failed to update report")}}),X=ee=>{const ie={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return m.jsx(Qn,{variant:ie[ee]||"default",children:e(`admin.reportStatus.${ee}`)})},te=(ee,ie)=>{switch(ee){case"restaurant":return`/restaurant/${ie}`;case"activity":return`/activity/${ie}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},se=ee=>{n(ee),l(ee.admin_notes||""),i(ee.status)},oe=()=>{r&&Z.mutate({id:r.id,status:d,notes:o})};return C?m.jsx(Qc,{children:m.jsx("div",{className:"flex items-center justify-center h-64",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin"})})}):m.jsxs(Qc,{children:[m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{children:[m.jsx("h2",{className:"text-3xl font-bold",children:e("admin.reports")}),m.jsx("p",{className:"text-muted-foreground mt-2",children:e("admin.reportsDescription")})]}),m.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:e("joinUs.recipientEmail")}),m.jsx(Do,{children:e("joinUs.recipientEmailDesc")})]}),m.jsx(dn,{children:m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx(an,{value:(N==null?void 0:N.recipient_email)||"",readOnly:!0}),m.jsx(lr,{onClick:U,children:e("common.edit")})]})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.totalReports")}),m.jsx(cC,{className:"h-4 w-4 text-muted-foreground"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:R.total}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.allReportsCount")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.reportStatus.pending")}),m.jsx(AT,{className:"h-4 w-4 text-yellow-500"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:R.pending}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.awaitingReview")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.reportStatus.reviewing")}),m.jsx(Yge,{className:"h-4 w-4 text-blue-500"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:R.reviewing}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.underReview")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.reportStatus.resolved")}),m.jsx(Jge,{className:"h-4 w-4 text-green-500"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:R.resolved}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.resolvedReports")})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[m.jsx(Ji,{className:"text-sm font-medium",children:e("admin.reportStatus.dismissed")}),m.jsx(eye,{className:"h-4 w-4 text-red-500"})]}),m.jsxs(dn,{children:[m.jsx("div",{className:"text-2xl font-bold",children:R.dismissed}),m.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e("admin.dismissedReports")})]})]})]}),m.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(YY,{className:"w-5 h-5 text-primary"}),m.jsx(Ji,{children:""})]}),m.jsx(Do,{children:"7"})]}),m.jsx(dn,{children:m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(rce,{data:L,children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{dataKey:"date"}),m.jsx(yh,{}),m.jsx(Vs,{}),m.jsx(Wb,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:""})]})})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx(Kge,{className:"w-5 h-5 text-primary"}),m.jsx(Ji,{children:""})]}),m.jsx(Do,{children:""})]}),m.jsx(dn,{children:m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(RK,{children:[m.jsx(Oh,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:ie})=>`${ee}: ${(ie*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((ee,ie)=>m.jsx(zE,{fill:B[ie%B.length]},`cell-${ie}`))}),m.jsx(Vs,{})]})})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:""}),m.jsx(Do,{children:""})]}),m.jsx(dn,{children:m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(TC,{data:F,children:[m.jsx(zy,{strokeDasharray:"3 3"}),m.jsx(gh,{dataKey:"name"}),m.jsx(yh,{}),m.jsx(Vs,{}),m.jsx(bu,{dataKey:"value",fill:"hsl(var(--primary))",name:""})]})})})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx(Ji,{children:""}),m.jsx(Do,{children:""})]}),m.jsx(dn,{children:m.jsx(Sm,{width:"100%",height:300,children:m.jsxs(RK,{children:[m.jsx(Oh,{data:[{name:e("admin.reportStatus.pending"),value:R.pending},{name:e("admin.reportStatus.reviewing"),value:R.reviewing},{name:e("admin.reportStatus.resolved"),value:R.resolved},{name:e("admin.reportStatus.dismissed"),value:R.dismissed}].filter(ee=>ee.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:ee,percent:ie})=>`${ee}: ${(ie*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((ee,ie)=>m.jsx(zE,{fill:ee.color},`cell-${ie}`))}),m.jsx(Vs,{})]})})})]})]}),m.jsxs(Qr,{children:[m.jsxs(Mi,{children:[m.jsx("div",{className:"flex items-center justify-between",children:m.jsxs("div",{children:[m.jsx(Ji,{children:e("admin.allReports")}),m.jsx(Do,{children:e("admin.manageReportsDesc")})]})}),m.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[m.jsxs("div",{className:"relative flex-1",children:[m.jsx(Tv,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),m.jsx(an,{placeholder:e("admin.searchReports"),value:g,onChange:ee=>x(ee.target.value),className:"pl-10"})]}),m.jsxs(Cv,{children:[m.jsx(Ov,{asChild:!0,children:m.jsxs(lr,{variant:"outline",className:"gap-2",children:[m.jsx(cB,{className:"w-4 h-4"}),e(S==="all"?"admin.allStatus":`admin.reportStatus.${S}`)]})}),m.jsxs(ng,{align:"end",className:"bg-background",children:[m.jsx(Ca,{onClick:()=>E("all"),children:e("admin.allStatus")}),m.jsx(Ca,{onClick:()=>E("pending"),children:e("admin.reportStatus.pending")}),m.jsx(Ca,{onClick:()=>E("reviewing"),children:e("admin.reportStatus.reviewing")}),m.jsx(Ca,{onClick:()=>E("resolved"),children:e("admin.reportStatus.resolved")}),m.jsx(Ca,{onClick:()=>E("dismissed"),children:e("admin.reportStatus.dismissed")})]})]})]})]}),m.jsx(dn,{children:m.jsxs("div",{className:"grid gap-4",children:[k==null?void 0:k.map(ee=>{var ie;return m.jsx(Qr,{className:"p-4",children:m.jsxs("div",{className:"flex items-start justify-between gap-4",children:[m.jsxs("div",{className:"flex-1 space-y-2",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[m.jsx(cC,{className:"w-4 h-4"}),m.jsx("span",{className:"font-medium",children:e(`admin.reportType.${ee.target_type}`)}),X(ee.status),m.jsx(Qn,{variant:"outline",children:e(`report.reasons.${ee.reason}`)})]}),m.jsxs("p",{className:"text-sm text-muted-foreground",children:[ee.description.substring(0,150),ee.description.length>150&&"..."]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[m.jsxs("span",{children:[e("admin.reportedBy"),": ",(ie=ee.reporter)==null?void 0:ie.display_name]}),m.jsxs("span",{children:[e("admin.reportedAt"),":"," ",_f(new Date(ee.created_at),{addSuffix:!0})]})]})]}),m.jsxs("div",{className:"flex gap-2",children:[m.jsx(lr,{variant:"outline",size:"sm",onClick:()=>se(ee),children:e("admin.viewReport")}),m.jsx(lr,{variant:"ghost",size:"sm",onClick:()=>window.open(te(ee.target_type,ee.target_id),"_blank"),children:m.jsx(mq,{className:"w-4 h-4"})})]})]})},ee.id)}),(k==null?void 0:k.length)===0&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(cC,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),m.jsx("p",{className:"text-muted-foreground",children:e("admin.noReports")})]})]})})]})]}),m.jsx(Rh,{open:!!r,onOpenChange:()=>n(null),children:m.jsxs(Rd,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[m.jsxs(jd,{children:[m.jsxs(Nd,{children:[e("admin.viewReport")," - ",r==null?void 0:r.id]}),m.jsx(Md,{children:e(`admin.reportType.${r==null?void 0:r.target_type}`)})]}),r&&m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("admin.reportedBy"),":"]})," ",(ne=r.reporter)==null?void 0:ne.display_name]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),m.jsxs("div",{children:[m.jsxs("span",{className:"font-medium",children:[e("report.reason"),":"]})," ",e(`report.reasons.${r.reason}`)]}),m.jsxs("div",{children:[m.jsx("span",{className:"font-medium",children:"Status:"})," ",X(r.status)]})]}),m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.detailsLabel")}),m.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.contactLabel")}),m.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&m.jsxs("div",{children:[m.jsx("h4",{className:"font-medium mb-2",children:e("report.evidenceLabel")}),m.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((ee,ie)=>m.jsx("li",{children:m.jsxs("a",{href:ee,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[m.jsx(mq,{className:"w-3 h-3"}),ee]})},ie))})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:e("admin.updateStatus")}),m.jsxs(wd,{value:d,onValueChange:i,children:[m.jsx(Au,{children:m.jsx(Sd,{})}),m.jsxs(Pu,{children:[m.jsx(La,{value:"pending",children:e("admin.reportStatus.pending")}),m.jsx(La,{value:"reviewing",children:e("admin.reportStatus.reviewing")}),m.jsx(La,{value:"resolved",children:e("admin.reportStatus.resolved")}),m.jsx(La,{value:"dismissed",children:e("admin.reportStatus.dismissed")})]})]})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{className:"text-sm font-medium",children:e("admin.adminNotes")}),m.jsx(Mm,{value:o,onChange:ee=>l(ee.target.value),placeholder:"Add internal notes...",rows:4})]}),m.jsxs("div",{className:"flex justify-end gap-2",children:[m.jsx(lr,{variant:"outline",onClick:()=>n(null),children:e("common.cancel")}),m.jsx(lr,{onClick:oe,disabled:Z.isPending,children:Z.isPending?m.jsxs(m.Fragment,{children:[m.jsx(Ws,{className:"w-4 h-4 mr-2 animate-spin"}),e("common.loading")]}):e("admin.saveNotes")})]})]})]})})]})},XQe=()=>{Di();const e=Vf(),{t}=Ki(),{isMerchant:r,isSupervisor:n,isLoading:o}=Tc(),{data:l=[],isLoading:d}=UT(),{localizeRestaurant:i}=kd();return!o&&!r&&!n?(e("/"),null):d||o?m.jsx("div",{className:"container mx-auto px-4 py-8 flex justify-center items-center min-h-[50vh]",children:m.jsx(Ws,{className:"w-8 h-8 animate-spin text-primary"})}):m.jsxs("div",{className:"container mx-auto px-4 py-8",children:[m.jsxs("div",{className:"mb-8",children:[m.jsx("h1",{className:"text-3xl font-bold mb-2",children:t("merchant.myRestaurants")}),m.jsx("p",{className:"text-muted-foreground",children:t(n?"merchant.supervisorDescription":"merchant.merchantDescription")})]}),l.length===0?m.jsx(Qr,{children:m.jsx(dn,{className:"py-12 text-center",children:m.jsx("p",{className:"text-muted-foreground mb-4",children:t("merchant.noRestaurants")})})}):m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(g=>{const x=i(g);return m.jsxs(Qr,{className:"overflow-hidden hover:shadow-lg transition-shadow",children:[m.jsx("div",{className:"relative h-48 overflow-hidden",children:m.jsx("img",{src:g.image_url||"/placeholder.svg",alt:x.name,className:"w-full h-full object-cover"})}),m.jsx(Mi,{children:m.jsxs(Ji,{className:"flex items-start justify-between gap-2",children:[m.jsx("span",{className:"line-clamp-1",children:x.name}),g.rating&&m.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[m.jsx(wc,{className:"w-4 h-4 fill-primary text-primary"}),m.jsx("span",{children:g.rating})]})]})}),m.jsxs(dn,{className:"space-y-3",children:[g.type&&g.type.length>0&&m.jsx("div",{className:"flex flex-wrap gap-1",children:x.type.slice(0,3).map((S,E)=>m.jsx("span",{className:"text-xs px-2 py-1 bg-secondary text-secondary-foreground rounded",children:S},E))}),g.address&&m.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[m.jsx(Cs,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),m.jsx("span",{className:"line-clamp-2",children:g.address})]}),g.phone&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(PT,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("span",{children:g.phone})]}),g.website_url&&m.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[m.jsx(C0,{className:"w-4 h-4 flex-shrink-0"}),m.jsx("a",{href:g.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline line-clamp-1",children:t("restaurant.visitWebsite")})]}),m.jsxs("div",{className:"flex gap-2 pt-2",children:[m.jsx(lr,{asChild:!0,variant:"outline",size:"sm",className:"flex-1",children:m.jsx(Vi,{to:`/restaurant/${g.id}`,children:t("restaurants.viewDetails")})}),m.jsx(IO,{restaurant:g,trigger:m.jsxs(lr,{variant:"default",size:"sm",className:"flex-1",children:[m.jsx(fB,{className:"w-4 h-4 mr-1"}),t("common.edit")]})})]})]})]},g.id)})})]})},YQe=new Ixe,JQe=()=>m.jsx(Mxe,{client:YQe,children:m.jsxs(zJ,{children:[m.jsx(Zye,{}),m.jsx(Pve,{}),m.jsx(V0e,{children:m.jsxs(n1e,{children:[m.jsx(y2e,{}),m.jsx("div",{className:"pt-14 sm:pt-16",children:m.jsxs(D0e,{children:[m.jsx(ls,{path:"/",element:m.jsx(x2e,{})}),m.jsx(ls,{path:"/restaurants",element:m.jsx(S2e,{})}),m.jsx(ls,{path:"/restaurant/:id",element:m.jsx(WCe,{})}),m.jsx(ls,{path:"/map",element:m.jsx(GCe,{})}),m.jsx(ls,{path:"/activities",element:m.jsx(XCe,{})}),m.jsx(ls,{path:"/activity/:id",element:m.jsx(JCe,{})}),m.jsx(ls,{path:"/auth",element:m.jsx(eOe,{})}),m.jsx(ls,{path:"/profile",element:m.jsx(lOe,{})}),m.jsx(ls,{path:"/join-us",element:m.jsx(dOe,{})}),m.jsx(ls,{path:"/merchant-restaurants",element:m.jsx(XQe,{})}),m.jsx(ls,{path:"/admin",element:m.jsx(IYe,{})}),m.jsx(ls,{path:"/admin/users",element:m.jsx(FYe,{})}),m.jsx(ls,{path:"/admin/restaurants",element:m.jsx(qYe,{})}),m.jsx(ls,{path:"/admin/activities",element:m.jsx(qQe,{})}),m.jsx(ls,{path:"/admin/logs",element:m.jsx(WQe,{})}),m.jsx(ls,{path:"/admin/join-requests",element:m.jsx(KQe,{})}),m.jsx(ls,{path:"/admin/reports",element:m.jsx(ZQe,{})}),m.jsx(ls,{path:"*",element:m.jsx(hOe,{})})]})})]})})]})}),{slice:QQe,forEach:eet}=[];function tet(e){return eet.call(QQe.call(arguments,1),t=>{if(t)for(const r in t)e[r]===void 0&&(e[r]=t[r])}),e}function ret(e){return typeof e!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(r=>r.test(e))}const UK=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,net=function(e,t){const n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},o=encodeURIComponent(t);let l=`${e}=${o}`;if(n.maxAge>0){const d=n.maxAge-0;if(Number.isNaN(d))throw new Error("maxAge should be a Number");l+=`; Max-Age=${Math.floor(d)}`}if(n.domain){if(!UK.test(n.domain))throw new TypeError("option domain is invalid");l+=`; Domain=${n.domain}`}if(n.path){if(!UK.test(n.path))throw new TypeError("option path is invalid");l+=`; Path=${n.path}`}if(n.expires){if(typeof n.expires.toUTCString!="function")throw new TypeError("option expires is invalid");l+=`; Expires=${n.expires.toUTCString()}`}if(n.httpOnly&&(l+="; HttpOnly"),n.secure&&(l+="; Secure"),n.sameSite)switch(typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;case"none":l+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return n.partitioned&&(l+="; Partitioned"),l},VK={create(e,t,r,n){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};r&&(o.expires=new Date,o.expires.setTime(o.expires.getTime()+r*60*1e3)),n&&(o.domain=n),document.cookie=net(e,t,o)},read(e){const t=`${e}=`,r=document.cookie.split(";");for(let n=0;n<r.length;n++){let o=r[n];for(;o.charAt(0)===" ";)o=o.substring(1,o.length);if(o.indexOf(t)===0)return o.substring(t.length,o.length)}return null},remove(e,t){this.create(e,"",-1,t)}};var iet={name:"cookie",lookup(e){let{lookupCookie:t}=e;if(t&&typeof document<"u")return VK.read(t)||void 0},cacheUserLanguage(e,t){let{lookupCookie:r,cookieMinutes:n,cookieDomain:o,cookieOptions:l}=t;r&&typeof document<"u"&&VK.create(r,e,n,o,l)}},aet={name:"querystring",lookup(e){var n;let{lookupQuerystring:t}=e,r;if(typeof window<"u"){let{search:o}=window.location;!window.location.search&&((n=window.location.hash)==null?void 0:n.indexOf("?"))>-1&&(o=window.location.hash.substring(window.location.hash.indexOf("?")));const d=o.substring(1).split("&");for(let i=0;i<d.length;i++){const g=d[i].indexOf("=");g>0&&d[i].substring(0,g)===t&&(r=d[i].substring(g+1))}}return r}},oet={name:"hash",lookup(e){var o;let{lookupHash:t,lookupFromHashIndex:r}=e,n;if(typeof window<"u"){const{hash:l}=window.location;if(l&&l.length>2){const d=l.substring(1);if(t){const i=d.split("&");for(let g=0;g<i.length;g++){const x=i[g].indexOf("=");x>0&&i[g].substring(0,x)===t&&(n=i[g].substring(x+1))}}if(n)return n;if(!n&&r>-1){const i=l.match(/\/([a-zA-Z-]*)/g);return Array.isArray(i)?(o=i[typeof r=="number"?r:0])==null?void 0:o.replace("/",""):void 0}}}return n}};let wx=null;const qK=()=>{if(wx!==null)return wx;try{if(wx=typeof window<"u"&&window.localStorage!==null,!wx)return!1;const e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{wx=!1}return wx};var set={name:"localStorage",lookup(e){let{lookupLocalStorage:t}=e;if(t&&qK())return window.localStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupLocalStorage:r}=t;r&&qK()&&window.localStorage.setItem(r,e)}};let Sx=null;const WK=()=>{if(Sx!==null)return Sx;try{if(Sx=typeof window<"u"&&window.sessionStorage!==null,!Sx)return!1;const e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{Sx=!1}return Sx};var cet={name:"sessionStorage",lookup(e){let{lookupSessionStorage:t}=e;if(t&&WK())return window.sessionStorage.getItem(t)||void 0},cacheUserLanguage(e,t){let{lookupSessionStorage:r}=t;r&&WK()&&window.sessionStorage.setItem(r,e)}},uet={name:"navigator",lookup(e){const t=[];if(typeof navigator<"u"){const{languages:r,userLanguage:n,language:o}=navigator;if(r)for(let l=0;l<r.length;l++)t.push(r[l]);n&&t.push(n),o&&t.push(o)}return t.length>0?t:void 0}},det={name:"htmlTag",lookup(e){let{htmlTag:t}=e,r;const n=t||(typeof document<"u"?document.documentElement:null);return n&&typeof n.getAttribute=="function"&&(r=n.getAttribute("lang")),r}},het={name:"path",lookup(e){var o;let{lookupFromPathIndex:t}=e;if(typeof window>"u")return;const r=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(r)?(o=r[typeof t=="number"?t:0])==null?void 0:o.replace("/",""):void 0}},fet={name:"subdomain",lookup(e){var o,l;let{lookupFromSubdomainIndex:t}=e;const r=typeof t=="number"?t+1:1,n=typeof window<"u"&&((l=(o=window.location)==null?void 0:o.hostname)==null?void 0:l.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i));if(n)return n[r]}};let Mce=!1;try{document.cookie,Mce=!0}catch{}const Dce=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Mce||Dce.splice(1,1);const pet=()=>({order:Dce,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:e=>e});class Lce{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(t,r)}init(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=t,this.options=tet(r,this.options||{},pet()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=o=>o.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=n,this.addDetector(iet),this.addDetector(aet),this.addDetector(set),this.addDetector(cet),this.addDetector(uet),this.addDetector(det),this.addDetector(het),this.addDetector(fet),this.addDetector(oet)}addDetector(t){return this.detectors[t.name]=t,this}detect(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,r=[];return t.forEach(n=>{if(this.detectors[n]){let o=this.detectors[n].lookup(this.options);o&&typeof o=="string"&&(o=[o]),o&&(r=r.concat(o))}}),r=r.filter(n=>n!=null&&!ret(n)).map(n=>this.options.convertDetectedLanguage(n)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}cacheUserLanguage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;r&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(t)>-1||r.forEach(n=>{this.detectors[n]&&this.detectors[n].cacheUserLanguage(t,this.options)}))}}Lce.type="languageDetector";const met={en:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Home","nav.mapView":"Private Map","nav.restaurants":"Restaurants","nav.activities":"Activities","nav.profile":"Profile","nav.signIn":"Sign In","nav.signOut":"Sign Out","nav.myAccount":"My Account","nav.admin":"Admin Panel","nav.manageRestaurants":"Manage Restaurants","nav.joinUs":"Restaurant Join","map.subtitle":"Explore nearby featured restaurants","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Discover Nearby Cuisine","home.hero.subtitle":"Your Culinary Journey Starts Here","home.hero.description":"Explore curated restaurants across cities, join exciting food events, and connect with fellow food lovers;","home.hero.exploreBtn":"Explore Restaurants","home.hero.activitiesBtn":"View Activities","home.features.title":"Why Choose Us?","home.features.description":"Discover Cuisine; Share Experiences; Join Activities;","home.features.map.title":"Smart Map","home.features.map.desc":"Find nearby restaurants with our intelligent location-based search and interactive map view;","home.features.reviews.title":"Trusted Reviews","home.features.reviews.desc":"Read authentic reviews and ratings from verified diners to make informed decisions;","home.features.events.title":"Exclusive Events","home.features.events.desc":"Join special dining events, food festivals, and connect with the culinary community;","home.cta.title":"Ready to Start?","home.cta.description":"Join Xiaoxiong Market and reach thousands of food lovers. Grow your business with us;","home.cta.button":"Restaurant Join","home.stats.delivery":"Take Away","home.stats.reservation":"Reservation","restaurants.title":"Restaurants","restaurants.search":"Search restaurants, cuisines...","restaurants.noResults":"No restaurants found","restaurants.noResultsDesc":"Try adjusting your search or filters","restaurants.viewDetails":"View Details","restaurants.addToFavorite":"Add to favorites","restaurants.removeFromFavorite":"Remove from favorites","restaurants.mustSignIn":"Please sign in to favorite restaurants","restaurants.listView":"List View","restaurants.mapView":"Map View","restaurants.sortByDistance":"Sort by Distance","restaurants.sortedByDistance":"Sorted by distance","restaurants.radius":"Radius","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"All Restaurants","restaurants.getLocation":"Get My Location","restaurants.locationEnabled":"Location Enabled","restaurants.directions":"Get Directions","restaurants.distanceAway":"{{distance}} km away","restaurant.address":"Address","restaurant.phone":"Phone","restaurant.hours":"Hours","restaurant.today":"Today","restaurant.closed":"Closed","restaurant.dayMon":"Mon","restaurant.dayTue":"Tue","restaurant.dayWed":"Wed","restaurant.dayThu":"Thu","restaurant.dayFri":"Fri","restaurant.daySat":"Sat","restaurant.daySun":"Sun","restaurant.website":"Website","restaurant.visitWebsite":"Visit Website","restaurant.getDirections":"Get Directions","restaurant.callNow":"Call Now","restaurant.joinPrivate":"Join Private Domain","restaurant.reviews":"Reviews","restaurant.addReview":"Add Review","restaurant.rating":"Rating","restaurant.edited":"Edited","restaurant.reply":"Reply","restaurant.writeComment":"Write a comment...","restaurant.writeReply":"Write a reply...","restaurant.postComment":"Post Comment","restaurant.signInToComment":"Please sign in to comment","restaurant.signInToRate":"Please sign in to rate this restaurant","restaurant.noComments":"No comments yet. Be the first to share your experience!","restaurant.confirmDelete":"Are you sure you want to delete this comment?","restaurant.ratingsCount":"ratings","restaurant.yourRating":"Your rating","restaurant.rateThisRestaurant":"Rate this restaurant","restaurant.photoGallery":"Photo Gallery","restaurant.addImage":"Add Image","restaurant.imageUploadFailed":"Failed to upload image","restaurant.imageTooLarge":"Image size must be less than 5MB","restaurant.priceRange":"Price Range (Optional)","restaurant.selectPriceRange":"Select price range...","activities.title":"Activities","activities.description":"Join exclusive dining experiences and culinary events","activities.viewDetails":"View Details","activities.joinEvent":"Join Event","activities.joined":"Joined","activities.subscribe":"Subscribe","activities.subscribed":"Subscribed","activities.subscribers":"subscribers","activities.subscribersCount":"subscribers","activities.participants":"participants","activities.restaurantsParticipating":"restaurants participating","activities.until":"Until","activities.shareSuccess":"Activity shared successfully","activities.linkCopied":"Link copied to clipboard","activities.shareError":"Failed to share activity","activities.pinned":"Pinned","activities.ended":"Ended","activities.ongoing":"Ongoing","activities.signInToJoin":"Please sign in to join this activity","activities.signInToSubscribe":"Please sign in","activities.signInToSubscribeDesc":"You need to sign in to subscribe to activities","activities.about":"About This Activity","activities.participatingRestaurants":"Participating Restaurants","activities.repeat.none":"One-time","activities.repeat.daily":"Daily","activities.repeat.weekly":"Weekly","activities.repeat.monthly":"Monthly","activities.repeat.yearly":"Yearly","profile.title":"My Profile","profile.settings":"Settings","profile.favorites":"Favorites","profile.reviews":"Reviews","profile.comments":"Comments","profile.activities":"Activities","profile.favoriteRestaurants":"My Favorite Restaurants","profile.favoritesDesc":"Restaurants you've bookmarked for future visits","profile.myReviews":"My Reviews","profile.myComments":"My Comments","profile.reviewsDesc":"Your ratings and reviews for restaurants","profile.commentsDesc":"Comments you've posted on restaurants and activities","profile.joinedActivities":"Joined Activities","profile.activitiesDesc":"Events and activities you're participating in","profile.noActivities":"No activities joined yet. Check out our","profile.noFavorites":"No favorite restaurants yet","profile.noComments":"No comments yet","profile.upcomingEvents":"upcoming events","profile.editProfile":"Edit Profile","profile.editProfileDescription":"Update your profile information","profile.displayName":"Display Name","profile.phone":"Phone","profile.uploadAvatar":"Upload Avatar","profile.joinedOn":"Joined on","profile.deleteAccount":"Delete Account","profile.deleteAccountWarning":"Warning: This action is permanent","profile.deleteAccountDescription":"Deleting your account will permanently remove all your data, including your profile, favorites, comments, and activity subscriptions. This action cannot be undone.","profile.confirmDeleteAccount":"Final Confirmation Required","profile.confirmDeleteDescription":"This is your last chance. All your data will be permanently deleted and cannot be recovered.","profile.typeDeleteToConfirm":"Type DELETE to confirm","profile.deleteAccountSuccess":"Account deleted successfully","profile.deleteAccountFailed":"Failed to delete account","profile.changeEmail":"Change Email","profile.verifyOldEmail":"Verify Current Email","profile.verifyNewEmail":"Enter New Email","profile.confirmEmailUpdate":"Confirm Email Update","profile.oldEmailStep":"Step 1/3: We need to verify your current email","profile.newEmailStep":"Step 2/3: Enter your new email address","profile.confirmEmailStep":"Step 3/3: Confirm your email update","profile.currentEmail":"Current Email","profile.newEmail":"New Email","profile.verificationCode":"Verification Code","profile.sendCode":"Send Code","profile.codeSent":"Sent","profile.enterCode":"Enter 4-digit code","profile.verify":"Verify","profile.updateEmail":"Update Email","profile.codeSentToOldEmail":"Verification code sent to your old email","profile.codeSentToNewEmail":"Verification code sent to your new email","profile.sendCodeFailed":"Failed to send verification code","profile.enterCodePlaceholder":"Please enter verification code","profile.codeIncorrect":"Verification code is incorrect or expired","profile.verificationFailed":"Verification failed","profile.oldEmailVerified":"Old email verified successfully","profile.newEmailVerified":"New email verified successfully","profile.enterValidEmail":"Please enter a valid email address","profile.pleaseSignIn":"Please sign in first","profile.emailUpdated":"Email updated successfully, please sign in with your new email","profile.emailUpdateFailed":"Failed to update email","profile.enterNewEmail":"Enter your new email address","profile.role.user":"User","profile.role.merchant":"Merchant","profile.role.supervisor":"Supervisor","profile.role.admin":"Admin","profile.changePassword":"Change Password","profile.changePasswordDescription":"Update your account password","profile.verifyOldPassword":"Verify Current Password","profile.oldPasswordStep":"Step 1/2: Verify your identity","profile.currentPassword":"Current Password","profile.enterCurrentPassword":"Enter current password","profile.forgotPassword":"Forgot password?","profile.useEmailVerification":"Use email verification instead","profile.oldPasswordVerified":"Password verified successfully","profile.oldPasswordIncorrect":"Current password is incorrect","profile.setNewPassword":"Set New Password","profile.newPasswordStep":"Step 2/2: Enter your new password","profile.newPassword":"New Password","profile.confirmNewPassword":"Confirm New Password","profile.enterNewPassword":"Enter new password (min 6 characters)","profile.confirmNewPasswordPlaceholder":"Enter new password again","profile.passwordsDontMatch":"Passwords don't match","profile.passwordTooShort":"Password must be at least 6 characters","profile.passwordUpdated":"Password updated successfully","profile.passwordUpdateFailed":"Failed to update password","profile.updatePassword":"Update Password","report.title":"Report","report.reportComment":"Report Comment","report.reportRestaurant":"Report Restaurant","report.reportActivity":"Report Activity","report.reportUser":"Report User","report.description":"Help us maintain a safe community","report.reason":"Reason for Report","report.reasonPlaceholder":"Select a reason","report.reasons":{spam:"Spam or Advertising",harassment:"Harassment or Bullying",inappropriate_content:"Inappropriate Content",misinformation:"Misinformation",copyright:"Copyright Violation",fraud:"Fraud or Scam",hate_speech:"Hate Speech",violence:"Violence or Threats",other:"Other"},"report.detailsLabel":"Details","report.detailsPlaceholder":"Please provide detailed information about this report (required, minimum 20 characters)","report.detailsMin":"Details must be at least 20 characters","report.contactLabel":"Contact Email","report.contactPlaceholder":"Your email for follow-up","report.contactRequired":"Contact email is required","report.invalidEmail":"Please enter a valid email address","report.evidenceLabel":"Evidence URLs","report.evidenceRequired":"At least one evidence (image or URL) is required","report.evidenceRequiredNote":"Please upload at least one image or provide a link","report.uploadImages":"Upload Images","report.evidenceUrls":"Or Provide URLs","report.imageUploadHint":"Supported formats: JPG, PNG, WEBP, GIF. Max 5MB per image","report.imageTooLarge":"Image size must be less than 5MB","report.invalidImageType":"Only JPG, PNG, WEBP, and GIF formats are supported","report.imageUploadFailed":"Failed to upload images. Please try again","report.evidencePlaceholder":"Add screenshot or evidence URL","report.addEvidence":"Add Evidence","report.removeEvidence":"Remove","report.submit":"Submit Report","report.submitting":"Submitting...","report.success":"Report submitted successfully. We will review it soon.","report.successDetailed":"Report submitted successfully! Reference: {{reference}}","report.successDescription":"We will review your report within 24-48 hours. You will receive an email notification at the contact address you provided once the review is complete. Thank you for helping us maintain a safe community!","report.failed":"Failed to submit report","report.cancel":"Cancel","report.confirmTitle":"Confirm Report Submission","report.confirmMessage":"Are you sure you want to submit this report? False reports may result in account restrictions.","admin.reports":"Reports","admin.reportsDescription":"Manage user reports","admin.totalReports":"Total Reports","admin.allReportsCount":"All submitted reports","admin.awaitingReview":"Awaiting review","admin.underReview":"Under review","admin.resolvedReports":"Resolved reports","admin.dismissedReports":"Dismissed reports","admin.allReports":"All Reports","admin.manageReportsDesc":"View and manage all user reports","admin.searchReports":"Search reports by description, reporter, or reason...","admin.noReports":"No reports yet","admin.reportStatus":{pending:"Pending",reviewing:"Reviewing",resolved:"Resolved",dismissed:"Dismissed"},"admin.reportType":{comment:"Comment",restaurant:"Restaurant",activity:"Activity",user:"User"},"admin.reportedBy":"Reported By","admin.reportedAt":"Reported At","admin.viewReport":"View Report","admin.updateStatus":"Update Status","admin.adminNotes":"Admin Notes","admin.saveNotes":"Save Notes","auth.welcome":"Welcome to Xiaoxiong Market","auth.subtitle":"Discover amazing restaurants and join exciting dining events","auth.login":"Login","auth.register":"Email Register","auth.phone":"Phone","auth.email":"Email","auth.password":"Password","auth.displayName":"Display Name","auth.phoneOptional":"Phone (Optional)","auth.phoneNumber":"Phone Number","auth.phoneMin":"Please enter a valid phone number","auth.phoneHint":"Enter your phone number with country code (e.g., +351 912 345 678)","auth.confirmPassword":"Confirm Password","auth.signIn":"Sign In","auth.signingIn":"Signing in...","auth.sendCode":"Send Code","auth.sendingCode":"Sending...","auth.verificationCode":"Verification Code","auth.verify":"Verify","auth.verifying":"Verifying...","auth.otpLength":"Code must be 6 digits","auth.otpSent":"Verification code sent to your phone","auth.otpHint":"Enter the 6-digit code sent to {{phone}}","auth.createAccount":"Create Account","auth.creatingAccount":"Creating account...","auth.orContinueWith":"Or continue with","auth.google":"Google","auth.backToHome":"Back to home","auth.invalidEmail":"Invalid email address","auth.passwordMin":"Password must be at least 6 characters","auth.passwordPlaceholder":"Minimum 6 characters","auth.passwordStrength":{weak:"Weak password - Add uppercase, numbers, or symbols",medium:"Medium password - Consider adding more variety",strong:"Strong password"},"auth.displayNameMin":"Display name must be at least 2 characters","auth.passwordsDontMatch":"Passwords don't match","auth.invalidCredentials":"Invalid email or password","auth.emailExists":"This email is already registered","auth.signInSuccess":"Successfully signed in!","auth.signUpSuccess":"Account created successfully! You can now sign in.","auth.verificationCodeSent":"Verification code sent to your email","auth.verificationCodeFailed":"Failed to send verification code","auth.invalidVerificationCode":"Invalid verification code","auth.verificationCodeUsed":"This verification code has already been used. Please request a new one.","auth.verificationCodeHint":"Please enter the 4-digit verification code sent to {{email}}","auth.resendCode":"Resend Code","auth.resendIn":"Resend in {{seconds}}s","common.loading":"Loading...","common.error":"Error","common.success":"Success","common.cancel":"Cancel","common.continue":"Continue","common.save":"Save","common.delete":"Delete","common.edit":"Edit","common.submit":"Submit","common.back":"Back","common.next":"Next","common.previous":"Previous","common.search":"Search","common.filter":"Filter","common.sort":"Sort","common.actions":"Actions","common.km":"km","common.uploading":"Uploading...","common.enterPlaceholder":"Enter...","common.selectPlaceholder":"Select...","notifications.title":"Notifications","notifications.markAllRead":"Mark all read","notifications.noNotifications":"No notifications yet","admin.management":"Management","admin.dashboard":"Dashboard","admin.users":"Users","admin.restaurants":"Restaurants","admin.activities":"Activities","admin.logs":"Operation Logs","admin.userManagement":"User Management","admin.restaurantManagement":"Restaurant Management","admin.activityManagement":"Activity Management","admin.operationLogs":"Operation Logs","admin.manageUserRoles":"Manage user roles and permissions","admin.manageRestaurants":"View and manage all restaurants","admin.manageActivities":"View and manage all activities","admin.viewSystemLogs":"View all system operation logs","admin.dashboardDescription":"Overview of system statistics","admin.totalUsers":"Total Users","admin.totalRestaurants":"Total Restaurants","admin.totalActivities":"Total Activities","admin.totalComments":"Total Comments","admin.registeredUsers":"Registered users","admin.listedRestaurants":"Listed restaurants","admin.activeEvents":"Active events","admin.userReviews":"User reviews and comments","admin.recentActivity":"Recent Activity","admin.recentActivityDescription":"Latest system activities","admin.viewLogsForDetails":"View operation logs for detailed activity","admin.selectRole":"Select a role","admin.assignRole":"Assign Role","admin.confirmRemoveRole":"Are you sure you want to remove this role?","admin.noPhone":"No phone number","admin.addRestaurant":"Add Restaurant","admin.addActivity":"Add Activity","admin.editActivity":"Edit Activity","admin.activityCreated":"Activity created successfully","admin.activityUpdated":"Activity updated successfully","admin.confirmDelete":"Confirm Deletion","admin.deleteActivityWarning":"This will permanently delete the activity and all associated data. This action cannot be undone.","admin.activityImage":"Activity Image","admin.uploadImage":"Upload Image","admin.titleEnglish":"Title (English)","admin.titleChinese":"Title (Chinese)","admin.titlePortuguese":"Title (Portuguese)","admin.contentEnglish":"Content (English)","admin.contentChinese":"Content (Chinese)","admin.contentPortuguese":"Content (Portuguese)","admin.startDate":"Start Date","admin.endDate":"End Date","admin.pickDate":"Pick a date","admin.repeatMode":"Repeat Mode","admin.selectRepeatMode":"Select repeat mode","admin.repeatNone":"No Repeat","admin.repeatDaily":"Daily","admin.repeatWeekly":"Weekly","admin.repeatMonthly":"Monthly","admin.repeatYearly":"Yearly","admin.associatedRestaurants":"Associated Restaurants","admin.pinned":"Pinned","admin.sortOrder":"Sort Order","admin.editRestaurant":"Edit Restaurant","admin.restaurantCreated":"Restaurant created successfully","admin.restaurantUpdated":"Restaurant updated successfully","admin.deleteRestaurantWarning":"This will permanently delete the restaurant and all associated data. This action cannot be undone.","admin.restaurantImage":"Restaurant Image","admin.nameChinese":"Name (Chinese)","admin.nameEnglish":"Name (English)","admin.namePortuguese":"Name (Portuguese)","admin.typeChinese":"Type (Chinese)","admin.typeEnglish":"Type (English)","admin.typePortuguese":"Type (Portuguese)","admin.restaurantTypes":"Restaurant Types","admin.tags":"tags","admin.addType":"Add Type","admin.descriptionChinese":"Description (Chinese)","admin.descriptionEnglish":"Description (English)","admin.descriptionPortuguese":"Description (Portuguese)","admin.address":"Address","admin.phone":"Phone","admin.website":"Website","admin.showWebsiteButton":"Show Website Button","admin.location":"Location","admin.locationOnMap":"Location on Map","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Click on the map or drag the marker to set the location","admin.mapInstructions":"Click on the map or drag the marker to set the location","admin.openingHours":"Opening Hours","admin.closed":"Closed","admin.day.monday":"Monday","admin.day.tuesday":"Tuesday","admin.day.wednesday":"Wednesday","admin.day.thursday":"Thursday","admin.day.friday":"Friday","admin.day.saturday":"Saturday","admin.day.sunday":"Sunday","admin.userGrowth":"User Growth Trend","admin.userGrowthDescription":"Cumulative user registration over time","admin.activityEngagement":"Activity Engagement","admin.activityEngagementDescription":"Subscribers and comments per activity","admin.topRestaurants":"Top Restaurants","admin.topRestaurantsDescription":"Restaurants ranked by rating and engagement","admin.subscribers":"Subscribers","admin.comments":"Comments","admin.rating":"Rating","admin.noData":"No data available","admin.exportCSV":"Export CSV","admin.exportSuccess":"Data exported successfully","admin.noDataToExport":"No data available to export","admin.batchDelete":"Batch Delete","admin.batchAssignRole":"Batch Assign Role","admin.selectedCount":"{{count}} selected","admin.confirmBatchDelete":"Confirm Batch Delete","admin.batchDeleteWarning":"This will permanently delete {{count}} items. This action cannot be undone.","admin.clearSelection":"Clear Selection","admin.selectAll":"Select All","admin.searchUsers":"Search by name or phone...","admin.searchRestaurants":"Search by name or address...","admin.searchActivities":"Search by title or content...","admin.filterByRole":"Filter by role","admin.filterByType":"Filter by type","admin.filterByStatus":"Filter by status","admin.allRoles":"All Roles","admin.allTypes":"All Types","admin.allStatus":"All Status","admin.statusActive":"Active","admin.statusEnded":"Ended","admin.statusPinned":"Pinned","admin.results":"results","admin.view":"View","admin.createMerchant":"Create Merchant","admin.createSupervisor":"Create Supervisor","admin.createUser":"Create User","admin.createNewUser":"Create New User","admin.createUserDescription":"Create a new merchant or supervisor account","admin.userCreated":"User created successfully","admin.createUserError":"Failed to create user","admin.role":"Role","admin.create":"Create","admin.oldData":"Old Data","admin.newData":"New Data","admin.noLogs":"No operation logs yet","admin.merchant":"Merchant","admin.supervisor":"Supervisor","admin.editActivityDetails":"Edit activity details, dates and settings","admin.createActivityWithContent":"Create new activity with multilingual content and rich formatting","admin.imageMaxSize":"PNG, JPG Max 5MB","admin.multilingualContent":"Multilingual Content","admin.chinese":"Chinese","admin.english":"English","admin.portuguese":"Portuguese","admin.title":"Title","admin.content":"Content","admin.enterTitle":"Enter activity title...","admin.enterContent":"Enter detailed activity content with rich text formatting...","admin.dateSettings":"Date Settings","admin.selectDate":"Select date","admin.displaySettings":"Display Settings","admin.pinToTop":"Pin to Top","admin.showAtTop":"Show this activity at the top of the list","admin.lowerFirst":"Lower numbers appear first","admin.selectParticipatingRestaurants":"Select participating restaurants","admin.editRestaurantDetails":"Edit restaurant details, location, hours and settings","admin.createRestaurantWithInfo":"Create new restaurant with multilingual content and complete information","admin.restaurantName":"Restaurant Name","admin.enterRestaurantName":"Enter restaurant name...","admin.restaurantType":"Restaurant Type (1-3 tags)","admin.typeExample":"e.g. Cantonese","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Enter restaurant description...","admin.contactAndWebsite":"Contact & Website","admin.enterAddress":"Enter address...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Click on the map or drag the marker to set the location","admin.weekdays":"Weekdays","admin.weekend":"Weekend","admin.copyToAll":"Copy to All Days","admin.splitShift":"Split Shift","admin.open":"Open","admin.close":"Close","admin.afternoon":"Afternoon","admin.evening":"Evening","admin.visible":"Visible","admin.showInFrontend":"Show this restaurant in the frontend","common.saving":"Saving...","merchant.myRestaurants":"My Restaurants","merchant.merchantDescription":"Manage your restaurant information and settings","merchant.supervisorDescription":"Manage all restaurants under your supervision","merchant.noRestaurants":"No restaurants assigned yet","joinUs.title":"Join Xiaoxiong Market","joinUs.description":"Partner with us to grow your restaurant business. Fill out the form below and our team will contact you soon.","joinUs.name":"Name","joinUs.namePlaceholder":"Your full name","joinUs.email":"Email","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"Phone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Restaurant Name","joinUs.restaurantNamePlaceholder":"Your restaurant name","joinUs.restaurantAddress":"Restaurant Address (Optional)","joinUs.restaurantAddressPlaceholder":"Street address, city","joinUs.optional":"Optional","joinUs.featuresNeeded":"Features Needed","joinUs.featuresDescription":"Select at least one feature you're interested in","joinUs.feature.booking":"Table Booking","joinUs.feature.delivery":"Delivery Service","joinUs.feature.qrcode":"QR Code Menu","joinUs.submit":"Submit Request","joinUs.consentText":"By registering, you agree to receive marketing emails and promotional offers. For details, please review our Privacy Policy and Terms of Service.","joinUs.successTitle":"Request Submitted!","joinUs.successDescription":"Thank you for your trust!","joinUs.successMessage":"Your information has been successfully submitted! Thank you for your trust! Our dedicated consultant will contact you by phone within 24 business hours.","joinUs.submitAnother":"Submit Another Request","joinUs.submitError":"Failed to submit request. Please try again.","joinUs.rateLimitError":"Too Many Requests","joinUs.rateLimitErrorDesc":"You have already submitted a request in the last 24 hours. Please try again later.","joinUs.adminTitle":"Join Requests Management","joinUs.adminDescription":"View and manage all merchant join requests","joinUs.recipientEmail":"Recipient Email","joinUs.recipientEmailDesc":"Email address where join requests will be sent","joinUs.totalRequests":"Total Requests","joinUs.totalRequestsDesc":"All time join requests received","joinUs.allRequests":"All Join Requests","joinUs.allRequestsDesc":"View and manage all submitted join requests","joinUs.searchPlaceholder":"Search by name, email, restaurant...","joinUs.contact":"Contact","joinUs.restaurant":"Restaurant","joinUs.submittedAt":"Submitted","joinUs.noRequests":"No join requests yet","joinUs.enterNewEmail":"Enter new recipient email:","joinUs.emailUpdated":"Recipient email updated successfully","joinUs.emailUpdateError":"Failed to update recipient email","joinUs.status":"Status","joinUs.status.pending":"Pending","joinUs.status.completed":"Completed","joinUs.status.rejected":"Rejected","joinUs.statusUpdated":"Status updated successfully","joinUs.statusUpdateError":"Failed to update status","joinUs.requestDeleted":"Request deleted successfully","joinUs.deleteError":"Failed to delete request","joinUs.confirmDelete":"Delete Request","joinUs.confirmDeleteDescription":"Are you sure you want to delete this request? This action cannot be undone.","error.general":"An error occurred","error.networkError":"Network error. Please try again.","error.notFound":"Not found","error.unauthorized":"Unauthorized access"}},zh:{translation:{"nav.brandName":"","nav.map":"","nav.mapView":"","nav.restaurants":"","nav.activities":"","nav.profile":"","nav.signIn":"","nav.signOut":"","nav.myAccount":"","nav.admin":"","nav.manageRestaurants":"","nav.joinUs":"","map.subtitle":"","home.hero.brandName":"","home.hero.title":"","home.hero.subtitle":"","home.hero.description":"","home.hero.exploreBtn":"","home.hero.activitiesBtn":"","home.features.title":"","home.features.description":"","home.features.map.title":"","home.features.map.desc":"","home.features.reviews.title":"","home.features.reviews.desc":"","home.features.events.title":"","home.features.events.desc":"","home.cta.title":"","home.cta.description":"","home.cta.button":"","home.stats.delivery":"","home.stats.reservation":"","restaurants.title":"","restaurants.search":"...","restaurants.noResults":"","restaurants.noResultsDesc":"","restaurants.viewDetails":"","restaurants.addToFavorite":"","restaurants.removeFromFavorite":"","restaurants.mustSignIn":"","restaurants.listView":"","restaurants.mapView":"","restaurants.sortByDistance":"","restaurants.sortedByDistance":"","restaurants.radius":"","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"","restaurants.getLocation":"","restaurants.locationEnabled":"","restaurants.directions":"","restaurants.distanceAway":"{{distance}} km","restaurant.address":"","restaurant.phone":"","restaurant.hours":"","restaurant.today":"","restaurant.closed":"","restaurant.dayMon":"","restaurant.dayTue":"","restaurant.dayWed":"","restaurant.dayThu":"","restaurant.dayFri":"","restaurant.daySat":"","restaurant.daySun":"","restaurant.website":"","restaurant.visitWebsite":"","restaurant.getDirections":"","restaurant.callNow":"","restaurant.joinPrivate":"","restaurant.reviews":"","restaurant.addReview":"","restaurant.rating":"","restaurant.edited":"","restaurant.reply":"","restaurant.writeComment":"...","restaurant.writeReply":"...","restaurant.postComment":"","restaurant.signInToComment":"","restaurant.signInToRate":"","restaurant.noComments":"","restaurant.confirmDelete":"","restaurant.ratingsCount":"","restaurant.yourRating":"","restaurant.rateThisRestaurant":"","restaurant.photoGallery":"","restaurant.addImage":"","restaurant.imageUploadFailed":"","restaurant.imageTooLarge":"5MB","restaurant.priceRange":"","restaurant.selectPriceRange":"...","activities.title":"","activities.description":"","activities.viewDetails":"","activities.joinEvent":"","activities.joined":"","activities.subscribe":"","activities.subscribed":"","activities.subscribers":"","activities.subscribersCount":"","activities.participants":"","activities.restaurantsParticipating":"","activities.until":"","activities.shareSuccess":"","activities.linkCopied":"","activities.shareError":"","activities.pinned":"","activities.ended":"","activities.ongoing":"","activities.signInToJoin":"","activities.signInToSubscribe":"","activities.signInToSubscribeDesc":"","activities.about":"","activities.participatingRestaurants":"","activities.repeat.none":"","activities.repeat.daily":"","activities.repeat.weekly":"","activities.repeat.monthly":"","activities.repeat.yearly":"","profile.title":"","profile.settings":"","profile.favorites":"","profile.reviews":"","profile.comments":"","profile.activities":"","profile.favoriteRestaurants":"","profile.favoritesDesc":"","profile.myReviews":"","profile.myComments":"","profile.reviewsDesc":"","profile.commentsDesc":"","profile.joinedActivities":"","profile.activitiesDesc":"","profile.noActivities":"","profile.noFavorites":"","profile.noComments":"","profile.upcomingEvents":"","profile.editProfile":"","profile.editProfileDescription":"","profile.displayName":"","profile.phone":"","profile.uploadAvatar":"","profile.joinedOn":"","profile.deleteAccount":"","profile.deleteAccountWarning":"","profile.deleteAccountDescription":"","profile.confirmDeleteAccount":"","profile.confirmDeleteDescription":"","profile.typeDeleteToConfirm":" DELETE ","profile.deleteAccountSuccess":"","profile.deleteAccountFailed":"","profile.changeEmail":"","profile.verifyOldEmail":"","profile.verifyNewEmail":"","profile.confirmEmailUpdate":"","profile.oldEmailStep":" 1/3: ","profile.newEmailStep":" 2/3: ","profile.confirmEmailStep":" 3/3: ","profile.currentEmail":"","profile.newEmail":"","profile.verificationCode":"","profile.sendCode":"","profile.codeSent":"","profile.enterCode":"4","profile.verify":"","profile.updateEmail":"","profile.codeSentToOldEmail":"","profile.codeSentToNewEmail":"","profile.sendCodeFailed":"","profile.enterCodePlaceholder":"","profile.codeIncorrect":"","profile.verificationFailed":"","profile.oldEmailVerified":"","profile.newEmailVerified":"","profile.enterValidEmail":"","profile.pleaseSignIn":"","profile.emailUpdated":"","profile.emailUpdateFailed":"","profile.enterNewEmail":"","profile.role.user":"","profile.role.merchant":"","profile.role.supervisor":"","profile.role.admin":"","profile.changePassword":"","profile.changePasswordDescription":"","profile.verifyOldPassword":"","profile.oldPasswordStep":" 1/2: ","profile.currentPassword":"","profile.enterCurrentPassword":"","profile.forgotPassword":"","profile.useEmailVerification":"","profile.oldPasswordVerified":"","profile.oldPasswordIncorrect":"","profile.setNewPassword":"","profile.newPasswordStep":" 2/2: ","profile.newPassword":"","profile.confirmNewPassword":"","profile.enterNewPassword":"6","profile.confirmNewPasswordPlaceholder":"","profile.passwordsDontMatch":"","profile.passwordTooShort":"6","profile.passwordUpdated":"","profile.passwordUpdateFailed":"","profile.updatePassword":"","report.title":"","report.reportComment":"","report.reportRestaurant":"","report.reportActivity":"","report.reportUser":"","report.description":"","report.reason":"","report.reasonPlaceholder":"","report.reasons":{spam:"",harassment:"",inappropriate_content:"",misinformation:"",copyright:"",fraud:"",hate_speech:"",violence:"",other:""},"report.detailsLabel":"","report.detailsPlaceholder":"20","report.detailsMin":"20","report.contactLabel":"","report.contactPlaceholder":"","report.contactRequired":"","report.invalidEmail":"","report.evidenceLabel":"","report.evidenceRequired":"","report.evidenceRequiredNote":"","report.uploadImages":"","report.evidenceUrls":"","report.imageUploadHint":"JPG, PNG, WEBP, GIF 5MB","report.imageTooLarge":" 5MB","report.invalidImageType":" JPGPNGWEBP  GIF ","report.imageUploadFailed":"","report.evidencePlaceholder":"","report.addEvidence":"","report.removeEvidence":"","report.submit":"","report.submitting":"...","report.success":"","report.successDetailed":"{{reference}}","report.successDescription":" 24-48 ","report.failed":"","report.cancel":"","report.confirmTitle":"","report.confirmMessage":"","admin.reports":"","admin.reportsDescription":"","admin.totalReports":"","admin.allReportsCount":"","admin.awaitingReview":"","admin.underReview":"","admin.resolvedReports":"","admin.dismissedReports":"","admin.allReports":"","admin.manageReportsDesc":"","admin.searchReports":"...","admin.noReports":"","admin.reportStatus":{pending:"",reviewing:"",resolved:"",dismissed:""},"admin.reportType":{comment:"",restaurant:"",activity:"",user:""},"admin.reportedBy":"","admin.reportedAt":"","admin.viewReport":"","admin.updateStatus":"","admin.adminNotes":"","admin.saveNotes":"","auth.welcome":"","auth.subtitle":"","auth.login":"","auth.register":"","auth.phone":"","auth.email":"","auth.password":"","auth.displayName":"","auth.phoneOptional":"","auth.phoneNumber":"","auth.phoneMin":"","auth.phoneHint":"+351 912 345 678","auth.confirmPassword":"","auth.signIn":"","auth.signingIn":"...","auth.sendCode":"","auth.sendingCode":"...","auth.verificationCode":"","auth.verify":"","auth.verifying":"...","auth.otpLength":"6","auth.otpSent":"","auth.otpHint":" {{phone}} 6","auth.createAccount":"","auth.creatingAccount":"...","auth.orContinueWith":"","auth.google":"Google","auth.backToHome":"","auth.invalidEmail":"","auth.passwordMin":"6","auth.passwordPlaceholder":"6","auth.passwordStrength":{weak:" - ",medium:" - ",strong:""},"auth.displayNameMin":"2","auth.passwordsDontMatch":"","auth.invalidCredentials":"","auth.emailExists":"","auth.signInSuccess":"","auth.signUpSuccess":"","auth.verificationCodeSent":"","auth.verificationCodeFailed":"","auth.invalidVerificationCode":"","auth.verificationCodeUsed":"","auth.verificationCodeHint":" {{email}} 4","auth.resendCode":"","auth.resendIn":"{{seconds}}","common.loading":"...","common.error":"","common.success":"","common.cancel":"","common.continue":"","common.save":"","common.delete":"","common.edit":"","common.submit":"","common.back":"","common.next":"","common.previous":"","common.search":"","common.filter":"","common.sort":"","common.actions":"","common.km":"","common.uploading":"...","notifications.title":"","notifications.markAllRead":"","notifications.noNotifications":"","admin.management":"","admin.dashboard":"","admin.users":"","admin.restaurants":"","admin.activities":"","admin.logs":"","admin.userManagement":"","admin.restaurantManagement":"","admin.activityManagement":"","admin.operationLogs":"","admin.manageUserRoles":"","admin.manageRestaurants":"","admin.manageActivities":"","admin.viewSystemLogs":"","admin.dashboardDescription":"","admin.totalUsers":"","admin.totalRestaurants":"","admin.totalActivities":"","admin.totalComments":"","admin.registeredUsers":"","admin.listedRestaurants":"","admin.activeEvents":"","admin.userReviews":"","admin.recentActivity":"","admin.recentActivityDescription":"","admin.viewLogsForDetails":"","admin.selectRole":"","admin.assignRole":"","admin.confirmRemoveRole":"","admin.noPhone":"","admin.addRestaurant":"","admin.addActivity":"","admin.editActivity":"","admin.activityCreated":"","admin.activityUpdated":"","admin.confirmDelete":"","admin.deleteActivityWarning":"","admin.activityImage":"","admin.uploadImage":"","admin.titleEnglish":"","admin.titleChinese":"","admin.titlePortuguese":"","admin.contentEnglish":"","admin.contentChinese":"","admin.contentPortuguese":"","admin.startDate":"","admin.endDate":"","admin.pickDate":"","admin.repeatMode":"","admin.selectRepeatMode":"","admin.repeatNone":"","admin.repeatDaily":"","admin.repeatWeekly":"","admin.repeatMonthly":"","admin.repeatYearly":"","admin.associatedRestaurants":"","admin.pinned":"","admin.sortOrder":"","admin.editRestaurant":"","admin.restaurantCreated":"","admin.restaurantUpdated":"","admin.deleteRestaurantWarning":"","admin.restaurantImage":"","admin.nameChinese":"","admin.nameEnglish":"","admin.namePortuguese":"","admin.typeChinese":"","admin.typeEnglish":"","admin.typePortuguese":"","admin.restaurantTypes":"","admin.tags":"","admin.addType":"","admin.descriptionChinese":"","admin.descriptionEnglish":"","admin.descriptionPortuguese":"","admin.address":"","admin.phone":"","admin.website":"","admin.showWebsiteButton":"","admin.location":"","admin.locationOnMap":"","admin.latitude":"","admin.longitude":"","admin.clickOrDragToSetLocation":"","admin.mapInstructions":"","admin.openingHours":"","admin.closed":"","admin.day.monday":"","admin.day.tuesday":"","admin.day.wednesday":"","admin.day.thursday":"","admin.day.friday":"","admin.day.saturday":"","admin.day.sunday":"","admin.userGrowth":"","admin.userGrowthDescription":"","admin.activityEngagement":"","admin.activityEngagementDescription":"","admin.topRestaurants":"","admin.topRestaurantsDescription":"","admin.subscribers":"","admin.comments":"","admin.rating":"","admin.noData":"","admin.exportCSV":"CSV","admin.exportSuccess":"","admin.noDataToExport":"","admin.batchDelete":"","admin.batchAssignRole":"","admin.selectedCount":" {{count}} ","admin.confirmBatchDelete":"","admin.batchDeleteWarning":" {{count}} ","admin.clearSelection":"","admin.selectAll":"","admin.searchUsers":"...","admin.searchRestaurants":"...","admin.searchActivities":"...","admin.filterByRole":"","admin.filterByType":"","admin.filterByStatus":"","admin.allRoles":"","admin.allTypes":"","admin.allStatus":"","admin.statusActive":"","admin.statusEnded":"","admin.statusPinned":"","admin.results":"","admin.view":"","admin.createMerchant":"","admin.createSupervisor":"Supervisor","admin.createUser":"","admin.createNewUser":"","admin.createUserDescription":"supervisor","admin.userCreated":"","admin.createUserError":"","admin.role":"","admin.create":"","admin.oldData":"","admin.newData":"","admin.noLogs":"","admin.merchant":"","admin.supervisor":"","admin.editActivityDetails":"","admin.createActivityWithContent":"","admin.imageMaxSize":"PNG, JPG  5MB","admin.multilingualContent":"","admin.chinese":"","admin.english":"","admin.portuguese":"","admin.title":"","admin.content":"","admin.enterTitle":"...","admin.enterContent":"...","admin.dateSettings":"","admin.selectDate":"","admin.displaySettings":"","admin.pinToTop":"","admin.showAtTop":"","admin.lowerFirst":"","admin.selectParticipatingRestaurants":"","admin.editRestaurantDetails":"","admin.createRestaurantWithInfo":"","admin.restaurantName":"","admin.enterRestaurantName":"...","admin.restaurantType":" (1-3 )","admin.typeExample":"","admin.typeExamplePt":"Cantons","admin.enterDescription":"...","admin.contactAndWebsite":"","admin.enterAddress":"...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"","admin.weekdays":"","admin.weekend":"","admin.copyToAll":"","admin.splitShift":"","admin.open":"","admin.close":"","admin.afternoon":"","admin.evening":"","admin.visible":"","admin.showInFrontend":"","common.saving":"...","merchant.myRestaurants":"","merchant.merchantDescription":"","merchant.supervisorDescription":"","merchant.noRestaurants":"","joinUs.title":"","joinUs.description":"","joinUs.name":"","joinUs.namePlaceholder":"","joinUs.email":"","joinUs.emailPlaceholder":"your@email.com","joinUs.phone":"","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"","joinUs.restaurantNamePlaceholder":"","joinUs.restaurantAddress":"","joinUs.restaurantAddressPlaceholder":"","joinUs.optional":"","joinUs.featuresNeeded":"","joinUs.featuresDescription":"","joinUs.feature.booking":"","joinUs.feature.delivery":"","joinUs.feature.qrcode":"","joinUs.submit":"","joinUs.consentText":"","joinUs.successTitle":"","joinUs.successDescription":"","joinUs.successMessage":"24","joinUs.submitAnother":"","joinUs.submitError":"","joinUs.rateLimitError":"","joinUs.rateLimitErrorDesc":"24","joinUs.adminTitle":"","joinUs.adminDescription":"","joinUs.recipientEmail":"","joinUs.recipientEmailDesc":"","joinUs.totalRequests":"","joinUs.totalRequestsDesc":"","joinUs.allRequests":"","joinUs.allRequestsDesc":"","joinUs.searchPlaceholder":"...","joinUs.contact":"","joinUs.restaurant":"","joinUs.submittedAt":"","joinUs.noRequests":"","joinUs.enterNewEmail":"","joinUs.emailUpdated":"","joinUs.emailUpdateError":"","joinUs.status":"","joinUs.status.pending":"","joinUs.status.completed":"","joinUs.status.rejected":"","joinUs.statusUpdated":"","joinUs.statusUpdateError":"","joinUs.requestDeleted":"","joinUs.deleteError":"","joinUs.confirmDelete":"","joinUs.confirmDeleteDescription":"","error.general":"","error.networkError":"","error.notFound":"","error.unauthorized":""}},pt:{translation:{"nav.brandName":"Xiaoxiong Market","nav.map":"Incio","nav.mapView":"Mapa Privado","nav.restaurants":"Restaurantes","nav.activities":"Atividades","nav.profile":"Perfil","nav.signIn":"Entrar","nav.signOut":"Sair","nav.myAccount":"Minha Conta","nav.admin":"Painel Admin","nav.manageRestaurants":"Gerir Restaurantes","nav.joinUs":"Juntar Restaurante","map.subtitle":"Explore restaurantes selecionados nas proximidades","home.hero.brandName":"Xiaoxiong Market","home.hero.title":"Descubra Gastronomia Prxima","home.hero.subtitle":"Sua Jornada Culinria Comea Aqui","home.hero.description":"Explore restaurantes selecionados em vrias cidades, participe de eventos gastronmicos e conecte-se com amantes da gastronomia;","home.hero.exploreBtn":"Explorar Restaurantes","home.hero.activitiesBtn":"Ver Atividades","home.features.title":"Por Que Nos Escolher?","home.features.description":"Descubra Gastronomia; Compartilhe Experincias; Participe de Atividades;","home.features.map.title":"Mapa Inteligente","home.features.map.desc":"Encontre restaurantes prximos com nossa busca inteligente baseada em localizao e visualizao interativa do mapa;","home.features.reviews.title":"Avaliaes Confiveis","home.features.reviews.desc":"Leia avaliaes e classificaes autnticas de clientes verificados para tomar decises informadas;","home.features.events.title":"Eventos Exclusivos","home.features.events.desc":"Participe de eventos gastronmicos especiais, festivais de comida e conecte-se com a comunidade culinria;","home.cta.title":"Pronto para Comear?","home.cta.description":"Junte-se ao Xiaoxiong Market e alcance milhares de amantes da gastronomia. Cresa seu negcio conosco;","home.cta.button":"Adeso de Restaurante","home.stats.delivery":"Take Away","home.stats.reservation":"Reserva","restaurants.title":"Restaurantes","restaurants.search":"Pesquisar restaurantes, cozinhas...","restaurants.noResults":"Nenhum restaurante encontrado","restaurants.noResultsDesc":"Tente ajustar sua pesquisa ou filtros","restaurants.viewDetails":"Ver Detalhes","restaurants.addToFavorite":"Adicionar aos favoritos","restaurants.removeFromFavorite":"Remover dos favoritos","restaurants.mustSignIn":"Por favor, faa login para favoritar restaurantes","restaurants.listView":"Vista de Lista","restaurants.mapView":"Vista de Mapa","restaurants.sortByDistance":"Ordenar por Distncia","restaurants.sortedByDistance":"Ordenado por distncia","restaurants.radius":"Raio","restaurants.radius1km":"1 km","restaurants.radius3km":"3 km","restaurants.radius5km":"5 km","restaurants.radius10km":"10 km","restaurants.radius20km":"20 km","restaurants.allRestaurants":"Todos os Restaurantes","restaurants.getLocation":"Obter Minha Localizao","restaurants.locationEnabled":"Localizao Ativada","restaurants.directions":"Obter Direes","restaurants.distanceAway":"{{distance}} km","restaurant.address":"Endereo","restaurant.phone":"Telefone","restaurant.hours":"Horrio","restaurant.today":"Hoje","restaurant.closed":"Fechado","restaurant.dayMon":"Seg","restaurant.dayTue":"Ter","restaurant.dayWed":"Qua","restaurant.dayThu":"Qui","restaurant.dayFri":"Sex","restaurant.daySat":"Sb","restaurant.daySun":"Dom","restaurant.website":"Site","restaurant.visitWebsite":"Visitar Site","restaurant.getDirections":"Obter Direes","restaurant.callNow":"Ligar Agora","restaurant.joinPrivate":"Entrar no Domnio Privado","restaurant.reviews":"Avaliaes","restaurant.addReview":"Adicionar Avaliao","restaurant.rating":"Classificao","restaurant.edited":"Editado","restaurant.reply":"Responder","restaurant.writeComment":"Escreva um comentrio...","restaurant.writeReply":"Escreva uma resposta...","restaurant.postComment":"Publicar Comentrio","restaurant.signInToComment":"Por favor, faa login para comentar","restaurant.signInToRate":"Por favor, faa login para avaliar este restaurante","restaurant.noComments":"Ainda no h comentrios. Seja o primeiro a compartilhar sua experincia!","restaurant.confirmDelete":"Tem certeza de que deseja excluir este comentrio?","restaurant.ratingsCount":"avaliaes","restaurant.yourRating":"Sua avaliao","restaurant.rateThisRestaurant":"Avalie este restaurante","restaurant.photoGallery":"Galeria de Fotos","restaurant.addImage":"Adicionar Imagem","restaurant.imageUploadFailed":"Falha ao enviar imagem","restaurant.imageTooLarge":"O tamanho da imagem deve ser menor que 5MB","restaurant.priceRange":"Faixa de Preo (Opcional)","restaurant.selectPriceRange":"Selecione a faixa de preo...","activities.title":"Atividades","activities.description":"Participe de experincias gastronmicas exclusivas e eventos culinrios","activities.viewDetails":"Ver Detalhes","activities.joinEvent":"Participar do Evento","activities.joined":"Participando","activities.subscribe":"Subscrever","activities.subscribed":"Subscrito","activities.subscribers":"inscritos","activities.subscribersCount":"assinantes","activities.participants":"participantes","activities.restaurantsParticipating":"restaurantes participando","activities.until":"At","activities.shareSuccess":"Atividade partilhada com sucesso","activities.linkCopied":"Link copiado para a rea de transferncia","activities.shareError":"Falha ao partilhar atividade","activities.pinned":"Fixado","activities.ended":"Encerrado","activities.ongoing":"Em Andamento","activities.signInToJoin":"Por favor, faa login para participar desta atividade","activities.signInToSubscribe":"Por favor, faa login","activities.signInToSubscribeDesc":"Voc precisa fazer login para subscrever atividades","activities.about":"Sobre Esta Atividade","activities.participatingRestaurants":"Restaurantes Participantes","activities.repeat.none":"nica vez","activities.repeat.daily":"Dirio","activities.repeat.weekly":"Semanal","activities.repeat.monthly":"Mensal","activities.repeat.yearly":"Anual","profile.title":"Meu Perfil","profile.settings":"Configuraes","profile.favorites":"Favoritos","profile.reviews":"Avaliaes","profile.comments":"Comentrios","profile.activities":"Atividades","profile.favoriteRestaurants":"Meus Restaurantes Favoritos","profile.favoritesDesc":"Restaurantes que voc marcou para visitas futuras","profile.myReviews":"Minhas Avaliaes","profile.myComments":"Meus Comentrios","profile.reviewsDesc":"Suas classificaes e avaliaes para restaurantes","profile.commentsDesc":"Comentrios que voc postou em restaurantes e atividades","profile.joinedActivities":"Atividades Participadas","profile.activitiesDesc":"Eventos e atividades em que voc est participando","profile.noActivities":"Nenhuma atividade participada ainda. Confira nossos","profile.noFavorites":"Nenhum restaurante favorito ainda","profile.noComments":"Nenhum comentrio ainda","profile.upcomingEvents":"prximos eventos","profile.editProfile":"Editar Perfil","profile.editProfileDescription":"Atualize suas informaes de perfil","profile.displayName":"Nome de Exibio","profile.phone":"Telefone","profile.uploadAvatar":"Enviar Avatar","profile.joinedOn":"Participou em","profile.deleteAccount":"Excluir Conta","profile.deleteAccountWarning":"Aviso: Esta ao  permanente","profile.deleteAccountDescription":"Excluir sua conta remover permanentemente todos os seus dados, incluindo seu perfil, favoritos, comentrios e inscries em atividades. Esta ao no pode ser desfeita.","profile.confirmDeleteAccount":"Confirmao Final Necessria","profile.confirmDeleteDescription":"Esta  sua ltima chance. Todos os seus dados sero permanentemente excludos e no podero ser recuperados.","profile.typeDeleteToConfirm":"Digite DELETE para confirmar","profile.deleteAccountSuccess":"Conta excluda com sucesso","profile.deleteAccountFailed":"Falha ao excluir conta","profile.changeEmail":"Alterar Email","profile.verifyOldEmail":"Verificar Email Atual","profile.verifyNewEmail":"Inserir Novo Email","profile.confirmEmailUpdate":"Confirmar Atualizao de Email","profile.oldEmailStep":"Passo 1/3: Precisamos verificar seu email atual","profile.newEmailStep":"Passo 2/3: Insira seu novo endereo de email","profile.confirmEmailStep":"Passo 3/3: Confirme sua atualizao de email","profile.currentEmail":"Email Atual","profile.newEmail":"Novo Email","profile.verificationCode":"Cdigo de Verificao","profile.sendCode":"Enviar Cdigo","profile.codeSent":"Enviado","profile.enterCode":"Digite o cdigo de 4 dgitos","profile.verify":"Verificar","profile.updateEmail":"Atualizar Email","profile.codeSentToOldEmail":"Cdigo de verificao enviado para seu email antigo","profile.codeSentToNewEmail":"Cdigo de verificao enviado para seu novo email","profile.sendCodeFailed":"Falha ao enviar cdigo de verificao","profile.enterCodePlaceholder":"Por favor, insira o cdigo de verificao","profile.codeIncorrect":"Cdigo de verificao incorreto ou expirado","profile.verificationFailed":"Falha na verificao","profile.oldEmailVerified":"Email antigo verificado com sucesso","profile.newEmailVerified":"Novo email verificado com sucesso","profile.enterValidEmail":"Por favor, insira um endereo de email vlido","profile.pleaseSignIn":"Por favor, faa login primeiro","profile.emailUpdated":"Email atualizado com sucesso, por favor faa login com seu novo email","profile.emailUpdateFailed":"Falha ao atualizar email","profile.enterNewEmail":"Insira seu novo endereo de email","profile.role.user":"Usurio","profile.role.merchant":"Comerciante","profile.role.supervisor":"Supervisor","profile.role.admin":"Administrador","profile.changePassword":"Alterar Senha","profile.changePasswordDescription":"Atualize a senha da sua conta","profile.verifyOldPassword":"Verificar Senha Atual","profile.oldPasswordStep":"Passo 1/2: Verifique sua identidade","profile.currentPassword":"Senha Atual","profile.enterCurrentPassword":"Digite a senha atual","profile.forgotPassword":"Esqueceu a senha?","profile.useEmailVerification":"Use verificao por e-mail","profile.oldPasswordVerified":"Senha verificada com sucesso","profile.oldPasswordIncorrect":"Senha atual incorreta","profile.setNewPassword":"Definir Nova Senha","profile.newPasswordStep":"Passo 2/2: Digite sua nova senha","profile.newPassword":"Nova Senha","profile.confirmNewPassword":"Confirmar Nova Senha","profile.enterNewPassword":"Digite nova senha (mn. 6 caracteres)","profile.confirmNewPasswordPlaceholder":"Digite a nova senha novamente","profile.passwordsDontMatch":"As senhas no coincidem","profile.passwordTooShort":"A senha deve ter pelo menos 6 caracteres","profile.passwordUpdated":"Senha atualizada com sucesso","profile.passwordUpdateFailed":"Falha ao atualizar senha","profile.updatePassword":"Atualizar Senha","report.title":"Denunciar","report.reportComment":"Denunciar Comentrio","report.reportRestaurant":"Denunciar Restaurante","report.reportActivity":"Denunciar Atividade","report.reportUser":"Denunciar Usurio","report.description":"Ajude-nos a manter uma comunidade segura","report.reason":"Motivo da Denncia","report.reasonPlaceholder":"Selecione um motivo","report.reasons":{spam:"Spam ou Publicidade",harassment:"Assdio ou Bullying",inappropriate_content:"Contedo Inadequado",misinformation:"Desinformao",copyright:"Violao de Direitos Autorais",fraud:"Fraude ou Golpe",hate_speech:"Discurso de dio",violence:"Violncia ou Ameaas",other:"Outro"},"report.detailsLabel":"Detalhes","report.detailsPlaceholder":"Fornea informaes detalhadas sobre esta denncia (obrigatrio, mnimo 20 caracteres)","report.detailsMin":"Detalhes devem ter pelo menos 20 caracteres","report.contactLabel":"Email de Contato","report.contactPlaceholder":"Seu email para acompanhamento","report.contactRequired":"Email de contato  obrigatrio","report.invalidEmail":"Por favor, insira um endereo de email vlido","report.evidenceLabel":"URLs de Evidncia","report.evidenceRequired":" necessrio fornecer pelo menos uma evidncia (imagem ou URL)","report.evidenceRequiredNote":"Por favor, carregue pelo menos uma imagem ou fornea um link","report.uploadImages":"Carregar Imagens","report.evidenceUrls":"Ou Fornecer URLs","report.imageUploadHint":"Formatos suportados: JPG, PNG, WEBP, GIF. Mx 5MB por imagem","report.imageTooLarge":"O tamanho da imagem deve ser inferior a 5MB","report.invalidImageType":"Apenas os formatos JPG, PNG, WEBP e GIF so suportados","report.imageUploadFailed":"Falha ao carregar imagens. Por favor, tente novamente","report.evidencePlaceholder":"Adicionar captura de tela ou URL de evidncia","report.addEvidence":"Adicionar Evidncia","report.removeEvidence":"Remover","report.submit":"Enviar Denncia","report.submitting":"Enviando...","report.success":"Denncia enviada com sucesso. Vamos analis-la em breve.","report.successDetailed":"Denncia enviada com sucesso! Referncia: {{reference}}","report.successDescription":"Vamos analisar sua denncia em 24-48 horas. Voc receber uma notificao por e-mail no endereo de contato fornecido assim que a anlise for concluda. Obrigado por nos ajudar a manter uma comunidade segura!","report.failed":"Falha ao enviar denncia","report.cancel":"Cancelar","report.confirmTitle":"Confirmar Envio de Denncia","report.confirmMessage":"Tem certeza que deseja enviar esta denncia? Denncias falsas podem resultar em restries de conta.","admin.reports":"Denncias","admin.reportsDescription":"Gerenciar denncias de usurios","admin.totalReports":"Total de Denncias","admin.allReportsCount":"Todas as denncias enviadas","admin.awaitingReview":"Aguardando reviso","admin.underReview":"Em reviso","admin.resolvedReports":"Denncias resolvidas","admin.dismissedReports":"Denncias rejeitadas","admin.allReports":"Todas as Denncias","admin.manageReportsDesc":"Ver e gerenciar todas as denncias de usurios","admin.searchReports":"Pesquisar denncias por descrio, denunciante ou motivo...","admin.noReports":"Nenhuma denncia ainda","admin.reportStatus":{pending:"Pendente",reviewing:"Em Anlise",resolved:"Resolvido",dismissed:"Rejeitado"},"admin.reportType":{comment:"Comentrio",restaurant:"Restaurante",activity:"Atividade",user:"Usurio"},"admin.reportedBy":"Denunciado Por","admin.reportedAt":"Denunciado Em","admin.viewReport":"Ver Denncia","admin.updateStatus":"Atualizar Status","admin.adminNotes":"Notas do Administrador","admin.saveNotes":"Salvar Notas","auth.welcome":"Bem-vindo ao Xiaoxiong Market","auth.subtitle":"Descubra restaurantes incrveis e participe de eventos gastronmicos emocionantes","auth.login":"Entrar","auth.register":"Registo por Email","auth.phone":"Telefone","auth.email":"Email","auth.password":"Senha","auth.displayName":"Nome de Exibio","auth.phoneOptional":"Telefone (Opcional)","auth.phoneNumber":"Nmero de Telefone","auth.phoneMin":"Por favor, insira um nmero de telefone vlido","auth.phoneHint":"Insira seu nmero de telefone com cdigo do pas (ex: +351 912 345 678)","auth.confirmPassword":"Confirmar Senha","auth.signIn":"Entrar","auth.signingIn":"Entrando...","auth.sendCode":"Enviar Cdigo","auth.sendingCode":"Enviando...","auth.verificationCode":"Cdigo de Verificao","auth.verify":"Verificar","auth.verifying":"Verificando...","auth.otpLength":"O cdigo deve ter 6 dgitos","auth.otpSent":"Cdigo de verificao enviado para seu telefone","auth.otpHint":"Insira o cdigo de 6 dgitos enviado para {{phone}}","auth.createAccount":"Criar Conta","auth.creatingAccount":"Criando conta...","auth.orContinueWith":"Ou continue com","auth.google":"Google","auth.backToHome":"Voltar ao incio","auth.invalidEmail":"Endereo de email invlido","auth.passwordMin":"A senha deve ter pelo menos 6 caracteres","auth.passwordPlaceholder":"Mnimo 6 caracteres","auth.passwordStrength":{weak:"Senha fraca - Adicione maisculas, nmeros ou smbolos",medium:"Senha mdia - Considere adicionar mais variedade",strong:"Senha forte"},"auth.displayNameMin":"O nome de exibio deve ter pelo menos 2 caracteres","auth.passwordsDontMatch":"As senhas no coincidem","auth.invalidCredentials":"Email ou senha invlidos","auth.emailExists":"Este email j est registrado","auth.signInSuccess":"Login bem-sucedido!","auth.signUpSuccess":"Conta criada com sucesso! Agora voc pode fazer login.","auth.verificationCodeSent":"Cdigo de verificao enviado para seu email","auth.verificationCodeFailed":"Falha ao enviar cdigo de verificao","auth.invalidVerificationCode":"Cdigo de verificao invlido","auth.verificationCodeUsed":"Este cdigo de verificao j foi usado. Por favor, solicite um novo.","auth.verificationCodeHint":"Por favor, insira o cdigo de verificao de 4 dgitos enviado para {{email}}","auth.resendCode":"Reenviar Cdigo","auth.resendIn":"Reenviar em {{seconds}}s","common.loading":"Carregando...","common.error":"Erro","common.success":"Sucesso","common.cancel":"Cancelar","common.continue":"Continuar","common.save":"Salvar","common.delete":"Excluir","common.edit":"Editar","common.submit":"Enviar","common.back":"Voltar","common.next":"Prximo","common.previous":"Anterior","common.search":"Pesquisar","common.filter":"Filtrar","common.sort":"Ordenar","common.actions":"Aes","common.km":"km","common.uploading":"Carregando...","common.enterPlaceholder":"Digite...","common.selectPlaceholder":"Selecione...","notifications.title":"Notificaes","notifications.markAllRead":"Marcar todas como lidas","notifications.noNotifications":"Nenhuma notificao ainda","admin.management":"Gerenciamento","admin.dashboard":"Painel","admin.users":"Usurios","admin.restaurants":"Restaurantes","admin.activities":"Atividades","admin.logs":"Logs de Operao","admin.userManagement":"Gerenciamento de Usurios","admin.restaurantManagement":"Gerenciamento de Restaurantes","admin.activityManagement":"Gerenciamento de Atividades","admin.operationLogs":"Logs de Operao","admin.manageUserRoles":"Gerenciar funes e permisses de usurios","admin.manageRestaurants":"Visualizar e gerenciar todos os restaurantes","admin.manageActivities":"Visualizar e gerenciar todas as atividades","admin.viewSystemLogs":"Visualizar todos os logs de operao do sistema","admin.dashboardDescription":"Viso geral das estatsticas do sistema","admin.totalUsers":"Total de Usurios","admin.totalRestaurants":"Total de Restaurantes","admin.totalActivities":"Total de Atividades","admin.totalComments":"Total de Comentrios","admin.registeredUsers":"Usurios registrados","admin.listedRestaurants":"Restaurantes listados","admin.activeEvents":"Eventos ativos","admin.userReviews":"Avaliaes e comentrios de usurios","admin.recentActivity":"Atividade Recente","admin.recentActivityDescription":"ltimas atividades do sistema","admin.viewLogsForDetails":"Visualize os logs de operao para atividades detalhadas","admin.selectRole":"Selecione uma funo","admin.assignRole":"Atribuir Funo","admin.confirmRemoveRole":"Tem certeza de que deseja remover esta funo?","admin.noPhone":"Sem nmero de telefone","admin.addRestaurant":"Adicionar Restaurante","admin.addActivity":"Adicionar Atividade","admin.editActivity":"Editar Atividade","admin.activityCreated":"Atividade criada com sucesso","admin.activityUpdated":"Atividade atualizada com sucesso","admin.confirmDelete":"Confirmar Excluso","admin.deleteActivityWarning":"Isso excluir permanentemente a atividade e todos os dados associados. Esta ao no pode ser desfeita.","admin.activityImage":"Imagem da Atividade","admin.uploadImage":"Carregar Imagem","admin.titleEnglish":"Ttulo (Ingls)","admin.titleChinese":"Ttulo (Chins)","admin.titlePortuguese":"Ttulo (Portugus)","admin.contentEnglish":"Contedo (Ingls)","admin.contentChinese":"Contedo (Chins)","admin.contentPortuguese":"Contedo (Portugus)","admin.startDate":"Data de Incio","admin.endDate":"Data de Trmino","admin.pickDate":"Escolher data","admin.repeatMode":"Modo de Repetio","admin.selectRepeatMode":"Selecione o modo de repetio","admin.repeatNone":"Sem Repetio","admin.repeatDaily":"Diariamente","admin.repeatWeekly":"Semanalmente","admin.repeatMonthly":"Mensalmente","admin.repeatYearly":"Anualmente","admin.associatedRestaurants":"Restaurantes Associados","admin.pinned":"Fixado","admin.sortOrder":"Ordem de Classificao","admin.editRestaurant":"Editar Restaurante","admin.restaurantCreated":"Restaurante criado com sucesso","admin.restaurantUpdated":"Restaurante atualizado com sucesso","admin.deleteRestaurantWarning":"Isso excluir permanentemente o restaurante e todos os dados associados. Esta ao no pode ser desfeita.","admin.restaurantImage":"Imagem do Restaurante","admin.nameChinese":"Nome (Chins)","admin.nameEnglish":"Nome (Ingls)","admin.namePortuguese":"Nome (Portugus)","admin.typeChinese":"Tipo (Chins)","admin.typeEnglish":"Tipo (Ingls)","admin.typePortuguese":"Tipo (Portugus)","admin.restaurantTypes":"Tipos de Restaurantes","admin.tags":"etiquetas","admin.addType":"Adicionar Tipo","admin.descriptionChinese":"Descrio (Chins)","admin.descriptionEnglish":"Descrio (Ingls)","admin.descriptionPortuguese":"Descrio (Portugus)","admin.address":"Endereo","admin.phone":"Telefone","admin.website":"Site","admin.showWebsiteButton":"Mostrar Boto do Site","admin.location":"Localizao","admin.locationOnMap":"Localizao no Mapa","admin.latitude":"Latitude","admin.longitude":"Longitude","admin.clickOrDragToSetLocation":"Clique no mapa ou arraste o marcador para definir a localizao","admin.mapInstructions":"Clique no mapa ou arraste o marcador para definir a localizao","admin.openingHours":"Horrio de Funcionamento","admin.closed":"Fechado","admin.day.monday":"Segunda-feira","admin.day.tuesday":"Tera-feira","admin.day.wednesday":"Quarta-feira","admin.day.thursday":"Quinta-feira","admin.day.friday":"Sexta-feira","admin.day.saturday":"Sbado","admin.day.sunday":"Domingo","admin.userGrowth":"Tendncia de Crescimento de Usurios","admin.userGrowthDescription":"Crescimento acumulado de registro de usurios","admin.activityEngagement":"Engajamento em Atividades","admin.activityEngagementDescription":"Inscritos e comentrios por atividade","admin.topRestaurants":"Restaurantes Mais Populares","admin.topRestaurantsDescription":"Restaurantes classificados por classificao e engajamento","admin.subscribers":"Inscritos","admin.comments":"Comentrios","admin.rating":"Classificao","admin.noData":"Nenhum dado disponvel","admin.exportCSV":"Exportar CSV","admin.exportSuccess":"Dados exportados com sucesso","admin.noDataToExport":"Nenhum dado disponvel para exportar","admin.batchDelete":"Excluso em Lote","admin.batchAssignRole":"Atribuir Funo em Lote","admin.selectedCount":"{{count}} selecionado(s)","admin.confirmBatchDelete":"Confirmar Excluso em Lote","admin.batchDeleteWarning":"Isso excluir permanentemente {{count}} itens. Esta ao no pode ser desfeita.","admin.clearSelection":"Limpar Seleo","admin.selectAll":"Selecionar Tudo","admin.searchUsers":"Pesquisar por nome ou telefone...","admin.searchRestaurants":"Pesquisar por nome ou endereo...","admin.searchActivities":"Pesquisar por ttulo ou contedo...","admin.filterByRole":"Filtrar por funo","admin.filterByType":"Filtrar por tipo","admin.filterByStatus":"Filtrar por status","admin.allRoles":"Todas as Funes","admin.allTypes":"Todos os Tipos","admin.allStatus":"Todos os Status","admin.statusActive":"Ativo","admin.statusEnded":"Encerrado","admin.statusPinned":"Fixado","admin.results":"resultados","admin.view":"Visualizar","admin.createMerchant":"Criar Comerciante","admin.createSupervisor":"Criar Supervisor","admin.createUser":"Criar Usurio","admin.createNewUser":"Criar Novo Usurio","admin.createUserDescription":"Criar uma nova conta de comerciante ou supervisor","admin.userCreated":"Usurio criado com sucesso","admin.createUserError":"Falha ao criar usurio","admin.role":"Funo","admin.create":"Criar","admin.oldData":"Dados Antigos","admin.newData":"Novos Dados","admin.noLogs":"Nenhum log de operao ainda","admin.merchant":"Comerciante","admin.supervisor":"Supervisor","admin.editActivityDetails":"Editar detalhes da atividade, datas e configuraes","admin.createActivityWithContent":"Criar nova atividade com contedo multilngue e formatao rica","admin.imageMaxSize":"PNG, JPG Mx 5MB","admin.multilingualContent":"Contedo Multilngue","admin.chinese":"Chins","admin.english":"Ingls","admin.portuguese":"Portugus","admin.title":"Ttulo","admin.content":"Contedo","admin.enterTitle":"Digite o ttulo da atividade...","admin.enterContent":"Digite o contedo detalhado da atividade com formatao rica...","admin.dateSettings":"Configuraes de Data","admin.selectDate":"Selecionar data","admin.displaySettings":"Configuraes de Exibio","admin.pinToTop":"Fixar no Topo","admin.showAtTop":"Mostrar esta atividade no topo da lista","admin.lowerFirst":"Nmeros menores aparecem primeiro","admin.selectParticipatingRestaurants":"Selecionar restaurantes participantes","admin.editRestaurantDetails":"Editar detalhes do restaurante, localizao, horrios e configuraes","admin.createRestaurantWithInfo":"Criar novo restaurante com contedo multilngue e informaes completas","admin.restaurantName":"Nome do Restaurante","admin.enterRestaurantName":"Digite o nome do restaurante...","admin.restaurantType":"Tipo de Restaurante (1-3 etiquetas)","admin.typeExample":"e.g. Cantons","admin.typeExamplePt":"e.g. Cantons","admin.enterDescription":"Digite a descrio do restaurante...","admin.contactAndWebsite":"Contato e Website","admin.enterAddress":"Digite o endereo...","admin.enterPhone":"+351 XXX XXX XXX","admin.enterWebsite":"https://...","admin.clickOrDragMarker":"Clique no mapa ou arraste o marcador para definir a localizao","admin.weekdays":"Dias de Semana","admin.weekend":"Fim de Semana","admin.copyToAll":"Copiar para Todos os Dias","admin.splitShift":"Turno Dividido","admin.open":"Abrir","admin.close":"Fechar","admin.afternoon":"Tarde","admin.evening":"Noite","admin.visible":"Visvel","admin.showInFrontend":"Mostrar este restaurante no frontend","common.saving":"Salvando...","merchant.myRestaurants":"Meus Restaurantes","merchant.merchantDescription":"Gerir informaes e configuraes do seu restaurante","merchant.supervisorDescription":"Gerir todos os restaurantes sob sua superviso","merchant.noRestaurants":"Nenhum restaurante atribudo ainda","joinUs.title":"Junte-se ao Xiaoxiong Market","joinUs.description":"Faa parceria connosco para desenvolver o seu negcio de restaurante. Preencha o formulrio abaixo e a nossa equipa entrar em contacto em breve.","joinUs.name":"Nome","joinUs.namePlaceholder":"Seu nome completo","joinUs.email":"Email","joinUs.emailPlaceholder":"seu@email.com","joinUs.phone":"Telefone","joinUs.phonePlaceholder":"+351 123 456 789","joinUs.restaurantName":"Nome do Restaurante","joinUs.restaurantNamePlaceholder":"Nome do seu restaurante","joinUs.restaurantAddress":"Morada do Restaurante (Opcional)","joinUs.restaurantAddressPlaceholder":"Morada completa, cidade","joinUs.optional":"Opcional","joinUs.featuresNeeded":"Funcionalidades Necessrias","joinUs.featuresDescription":"Selecione pelo menos uma funcionalidade do seu interesse","joinUs.feature.booking":"Reserva de Mesas","joinUs.feature.delivery":"Servio de Entrega","joinUs.feature.qrcode":"Menu QR Code","joinUs.submit":"Enviar Pedido","joinUs.consentText":"Ao se registrar, voc concorda em receber e-mails de marketing e ofertas promocionais. Para detalhes, consulte nossa Poltica de Privacidade e Termos de Servio.","joinUs.successTitle":"Informao Enviada com Sucesso!","joinUs.successDescription":"Obrigado pela sua confiana!","joinUs.successMessage":"Suas informaes foram enviadas com sucesso! Obrigado pela sua confiana! Nosso consultor dedicado entrar em contato por telefone dentro de 24 horas teis.","joinUs.submitAnother":"Enviar Outro Pedido","joinUs.submitError":"Falha ao enviar pedido. Por favor, tente novamente.","joinUs.rateLimitError":"Muitos Pedidos","joinUs.rateLimitErrorDesc":"J enviou um pedido nas ltimas 24 horas. Por favor, tente mais tarde.","joinUs.adminTitle":"Gesto de Pedidos de Adeso","joinUs.adminDescription":"Ver e gerir todos os pedidos de adeso de comerciantes","joinUs.recipientEmail":"Email de Receo","joinUs.recipientEmailDesc":"Endereo de email onde os pedidos de adeso sero enviados","joinUs.totalRequests":"Total de Pedidos","joinUs.totalRequestsDesc":"Todos os pedidos de adeso recebidos","joinUs.allRequests":"Todos os Pedidos de Adeso","joinUs.allRequestsDesc":"Ver e gerir todos os pedidos de adeso submetidos","joinUs.searchPlaceholder":"Pesquisar por nome, email, restaurante...","joinUs.contact":"Contacto","joinUs.restaurant":"Restaurante","joinUs.submittedAt":"Submetido","joinUs.noRequests":"Nenhum pedido de adeso ainda","joinUs.enterNewEmail":"Introduza novo email de receo:","joinUs.emailUpdated":"Email de receo atualizado com sucesso","joinUs.emailUpdateError":"Falha ao atualizar email de receo","joinUs.status":"Estado","joinUs.status.pending":"Pendente","joinUs.status.completed":"Concludo","joinUs.status.rejected":"Rejeitado","joinUs.statusUpdated":"Estado atualizado com sucesso","joinUs.statusUpdateError":"Falha ao atualizar o estado","joinUs.requestDeleted":"Pedido eliminado com sucesso","joinUs.deleteError":"Falha ao eliminar o pedido","joinUs.confirmDelete":"Eliminar Pedido","joinUs.confirmDeleteDescription":"Tem certeza de que deseja eliminar este pedido? Esta ao no pode ser desfeita.","error.general":"Ocorreu um erro","error.networkError":"Erro de rede. Por favor, tente novamente.","error.notFound":"No encontrado","error.unauthorized":"Acesso no autorizado"}}};Kl.use(Lce).use(rEe).init({resources:met,fallbackLng:"en",supportedLngs:["en","zh","pt"],interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});gY(document.getElementById("root")).render(m.jsx(JQe,{}));
