{"version":3,"file":"AdminCommunityModeration-Bmzhp1uF.js","sources":["../../src/pages/admin/AdminCommunityModeration.tsx"],"sourcesContent":["import { useState, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport {\r\n  Search,\r\n  Eye,\r\n  Trash2,\r\n  Check,\r\n  AlertTriangle,\r\n  Image,\r\n  Video,\r\n  Clock,\r\n  CheckCircle2,\r\n  XCircle,\r\n  AlertCircle,\r\n  RefreshCw,\r\n  ShieldAlert,\r\n  ShieldCheck,\r\n  BarChart3,\r\n} from \"lucide-react\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport {\r\n  Tooltip,\r\n  TooltipContent,\r\n  TooltipProvider,\r\n  TooltipTrigger,\r\n} from \"@/components/ui/tooltip\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport {\r\n  useAdminCommunityPosts,\r\n  useUpdatePost,\r\n  useDeletePost,\r\n  CommunityPost,\r\n} from \"@/hooks/useCommunityPosts\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport PostManagementDialog from \"@/components/admin/PostManagementDialog\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst AdminCommunityModeration = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [activeTab, setActiveTab] = useState(\"pending\");\r\n  const [selectedPost, setSelectedPost] = useState<CommunityPost | null>(null);\r\n  const [deletePost, setDeletePost] = useState<CommunityPost | null>(null);\r\n  const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\r\n  const [isReviewing, setIsReviewing] = useState<string | null>(null);\r\n\r\n  // Fetch posts based on tab\r\n  const getFilterOptions = (tab: string) => {\r\n    switch (tab) {\r\n      case \"pending\":\r\n        return { moderation_status: \"pending\" };\r\n      case \"flagged\":\r\n        return { moderation_status: \"flagged\" };\r\n      case \"approved\":\r\n        return { moderation_status: \"approved\", status: \"approved\" };\r\n      case \"rejected\":\r\n        return { status: \"rejected\" };\r\n      default:\r\n        return {};\r\n    }\r\n  };\r\n\r\n  const { data: posts, isLoading, refetch } = useAdminCommunityPosts({\r\n    ...getFilterOptions(activeTab),\r\n    search: search || undefined,\r\n  });\r\n\r\n  const updatePost = useUpdatePost();\r\n  const deletePostMutation = useDeletePost();\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const getRiskColor = (score: number | null) => {\r\n    if (score === null) return \"bg-gray-100 text-gray-600\";\r\n    if (score <= 30) return \"bg-emerald-100 text-emerald-700\";\r\n    if (score <= 60) return \"bg-amber-100 text-amber-700\";\r\n    return \"bg-red-100 text-red-700\";\r\n  };\r\n\r\n  const getRiskLabel = (score: number | null) => {\r\n    if (score === null) return t(\"admin.moderation.unknown\", \"未知\");\r\n    if (score <= 30) return t(\"admin.moderation.safe\", \"安全\");\r\n    if (score <= 60) return t(\"admin.moderation.suspicious\", \"可疑\");\r\n    return t(\"admin.moderation.highRisk\", \"高风险\");\r\n  };\r\n\r\n  const handleApprove = async (post: CommunityPost) => {\r\n    await updatePost.mutateAsync({\r\n      id: post.id,\r\n      status: \"approved\",\r\n      moderation_status: \"approved\",\r\n    });\r\n  };\r\n\r\n  const handleReject = async (post: CommunityPost) => {\r\n    await updatePost.mutateAsync({\r\n      id: post.id,\r\n      status: \"rejected\",\r\n      moderation_status: \"flagged\",\r\n    });\r\n  };\r\n\r\n  const handleReModerate = async (post: CommunityPost) => {\r\n    setIsReviewing(post.id);\r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"moderate-post\", {\r\n        body: {\r\n          post_id: post.id,\r\n          content: post.content,\r\n          user_id: post.author_id,\r\n          image_urls: post.image_urls,\r\n          video_url: post.video_url,\r\n        },\r\n      });\r\n      if (error) throw error;\r\n      toast.success(t(\"admin.moderation.reReviewSuccess\", \"重新审核完成\"));\r\n      refetch();\r\n    } catch (err) {\r\n      console.error(\"Re-moderation error:\", err);\r\n      toast.error(t(\"admin.moderation.reReviewError\", \"重新审核失败\"));\r\n    } finally {\r\n      setIsReviewing(null);\r\n    }\r\n  };\r\n\r\n  const handleBatchApprove = async () => {\r\n    const ids = Array.from(selectedIds);\r\n    for (const id of ids) {\r\n      await updatePost.mutateAsync({\r\n        id,\r\n        status: \"approved\",\r\n        moderation_status: \"approved\",\r\n      });\r\n    }\r\n    setSelectedIds(new Set());\r\n  };\r\n\r\n  const handleBatchReject = async () => {\r\n    const ids = Array.from(selectedIds);\r\n    for (const id of ids) {\r\n      await updatePost.mutateAsync({\r\n        id,\r\n        status: \"rejected\",\r\n        moderation_status: \"flagged\",\r\n      });\r\n    }\r\n    setSelectedIds(new Set());\r\n  };\r\n\r\n  const confirmDelete = () => {\r\n    if (deletePost) {\r\n      deletePostMutation.mutate(deletePost.id);\r\n      setDeletePost(null);\r\n    }\r\n  };\r\n\r\n  const toggleSelect = (id: string) => {\r\n    const newSet = new Set(selectedIds);\r\n    if (newSet.has(id)) {\r\n      newSet.delete(id);\r\n    } else {\r\n      newSet.add(id);\r\n    }\r\n    setSelectedIds(newSet);\r\n  };\r\n\r\n  const selectAll = () => {\r\n    if (!posts) return;\r\n    if (selectedIds.size === posts.length) {\r\n      setSelectedIds(new Set());\r\n    } else {\r\n      setSelectedIds(new Set(posts.map((p) => p.id)));\r\n    }\r\n  };\r\n\r\n  const stripHtml = (html: string) => {\r\n    const tmp = document.createElement(\"div\");\r\n    tmp.innerHTML = html;\r\n    return tmp.textContent || tmp.innerText || \"\";\r\n  };\r\n\r\n  // Statistics\r\n  const pendingCount = posts?.filter((p) => p.moderation_status === \"pending\").length || 0;\r\n  const flaggedCount = posts?.filter((p) => p.moderation_status === \"flagged\").length || 0;\r\n\r\n  const PostItem = ({ post }: { post: CommunityPost }) => {\r\n    const riskReasons = Array.isArray(post.risk_reasons) ? post.risk_reasons : [];\r\n\r\n    return (\r\n      <Card className=\"overflow-hidden\">\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex gap-4\">\r\n            {/* Checkbox */}\r\n            <div className=\"flex items-start pt-1\">\r\n              <Checkbox\r\n                checked={selectedIds.has(post.id)}\r\n                onCheckedChange={() => toggleSelect(post.id)}\r\n              />\r\n            </div>\r\n\r\n            {/* Author Avatar */}\r\n            <Avatar className=\"h-10 w-10 shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"bg-primary/10 text-primary\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n\r\n            {/* Content */}\r\n            <div className=\"flex-1 min-w-0 space-y-2\">\r\n              {/* Header */}\r\n              <div className=\"flex items-center justify-between gap-2\">\r\n                <div className=\"flex items-center gap-2 text-sm\">\r\n                  <span className=\"font-medium\">{post.author?.display_name}</span>\r\n                  <span className=\"text-muted-foreground\">·</span>\r\n                  <span className=\"text-muted-foreground\">\r\n                    {formatDistanceToNow(new Date(post.created_at), {\r\n                      addSuffix: true,\r\n                      locale: getDateLocale(),\r\n                    })}\r\n                  </span>\r\n                </div>\r\n\r\n                {/* Risk Score */}\r\n                <Badge className={cn(\"shrink-0\", getRiskColor(post.risk_score))}>\r\n                  {post.risk_score !== null ? `${post.risk_score}` : \"-\"} · {getRiskLabel(post.risk_score)}\r\n                </Badge>\r\n              </div>\r\n\r\n              {/* Post Content */}\r\n              <p className=\"text-sm line-clamp-2 whitespace-pre-line\">{stripHtml(post.content)}</p>\r\n\r\n              {/* Media & Risk Reasons */}\r\n              <div className=\"flex flex-wrap items-center gap-2\">\r\n                {post.image_urls && post.image_urls.length > 0 && (\r\n                  <Badge variant=\"outline\" className=\"text-xs\">\r\n                    <Image className=\"h-3 w-3 mr-1\" />\r\n                    {post.image_urls.length}\r\n                  </Badge>\r\n                )}\r\n                {post.video_url && (\r\n                  <Badge variant=\"outline\" className=\"text-xs\">\r\n                    <Video className=\"h-3 w-3 mr-1\" />\r\n                    {t(\"admin.communityPosts.hasVideo\", \"视频\")}\r\n                  </Badge>\r\n                )}\r\n                {riskReasons.length > 0 &&\r\n                  riskReasons.map((reason: string) => (\r\n                    <Badge key={reason} variant=\"secondary\" className=\"text-xs\">\r\n                      {reason}\r\n                    </Badge>\r\n                  ))}\r\n              </div>\r\n\r\n              {/* Actions */}\r\n              <div className=\"flex items-center gap-2 pt-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"h-8 text-blue-600 hover:bg-blue-50\"\r\n                  onClick={() => setSelectedPost(post)}\r\n                >\r\n                  <Eye className=\"h-4 w-4 mr-1\" />\r\n                  {t(\"common.details\", \"详情\")}\r\n                </Button>\r\n\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"h-8 text-emerald-600 hover:bg-emerald-50\"\r\n                  onClick={() => handleApprove(post)}\r\n                  disabled={updatePost.isPending}\r\n                >\r\n                  <CheckCircle2 className=\"h-4 w-4 mr-1\" />\r\n                  {t(\"admin.action.approve\", \"通过\")}\r\n                </Button>\r\n\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"h-8 text-red-600 hover:bg-red-50\"\r\n                  onClick={() => handleReject(post)}\r\n                  disabled={updatePost.isPending}\r\n                >\r\n                  <XCircle className=\"h-4 w-4 mr-1\" />\r\n                  {t(\"admin.action.reject\", \"拒绝\")}\r\n                </Button>\r\n\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"h-8 text-purple-600 hover:bg-purple-50\"\r\n                  onClick={() => handleReModerate(post)}\r\n                  disabled={isReviewing === post.id}\r\n                >\r\n                  <RefreshCw className={cn(\"h-4 w-4 mr-1\", isReviewing === post.id && \"animate-spin\")} />\r\n                  {t(\"admin.moderation.reReview\", \"重审\")}\r\n                </Button>\r\n\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"ghost\"\r\n                  className=\"h-8 text-destructive hover:bg-destructive/10\"\r\n                  onClick={() => setDeletePost(post)}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  const PostSkeleton = () => (\r\n    <Card>\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex gap-4\">\r\n          <Skeleton className=\"h-5 w-5\" />\r\n          <Skeleton className=\"h-10 w-10 rounded-full\" />\r\n          <div className=\"flex-1 space-y-2\">\r\n            <Skeleton className=\"h-4 w-1/3\" />\r\n            <Skeleton className=\"h-4 w-full\" />\r\n            <Skeleton className=\"h-4 w-2/3\" />\r\n          </div>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div>\r\n        <h1 className=\"text-2xl font-bold\">\r\n          {t(\"admin.communityModeration.title\", \"社区审核\")}\r\n        </h1>\r\n        <p className=\"text-muted-foreground text-sm mt-1\">\r\n          {t(\"admin.communityModeration.subtitle\", \"审核社区帖子，确保内容安全\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-3\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.moderation.pendingReview\", \"待审核\")}\r\n            </CardTitle>\r\n            <Clock className=\"h-4 w-4 text-amber-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{pendingCount}</div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.moderation.highRiskCount\", \"高风险\")}\r\n            </CardTitle>\r\n            <ShieldAlert className=\"h-4 w-4 text-red-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">{flaggedCount}</div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.moderation.todayReviewed\", \"今日审核\")}\r\n            </CardTitle>\r\n            <ShieldCheck className=\"h-4 w-4 text-emerald-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-2xl font-bold\">\r\n              {posts?.filter((p) => {\r\n                const today = new Date();\r\n                const postDate = new Date(p.ai_reviewed_at || p.created_at);\r\n                return postDate.toDateString() === today.toDateString();\r\n              }).length || 0}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div className=\"relative max-w-md\">\r\n        <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n        <Input\r\n          placeholder={t(\"admin.communityPosts.searchPlaceholder\", \"搜索内容...\")}\r\n          value={search}\r\n          onChange={(e) => setSearch(e.target.value)}\r\n          className=\"pl-10\"\r\n        />\r\n      </div>\r\n\r\n      {/* Tabs */}\r\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n        <TabsList>\r\n          <TabsTrigger value=\"pending\" className=\"gap-1.5\">\r\n            <Clock className=\"h-4 w-4\" />\r\n            {t(\"admin.moderation.pending\", \"待审核\")}\r\n            {pendingCount > 0 && (\r\n              <Badge variant=\"secondary\" className=\"ml-1 h-5 px-1.5\">\r\n                {pendingCount}\r\n              </Badge>\r\n            )}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"flagged\" className=\"gap-1.5\">\r\n            <AlertTriangle className=\"h-4 w-4\" />\r\n            {t(\"admin.moderation.flagged\", \"高风险\")}\r\n            {flaggedCount > 0 && (\r\n              <Badge variant=\"destructive\" className=\"ml-1 h-5 px-1.5\">\r\n                {flaggedCount}\r\n              </Badge>\r\n            )}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"approved\" className=\"gap-1.5\">\r\n            <CheckCircle2 className=\"h-4 w-4\" />\r\n            {t(\"admin.moderation.approved\", \"已通过\")}\r\n          </TabsTrigger>\r\n          <TabsTrigger value=\"rejected\" className=\"gap-1.5\">\r\n            <XCircle className=\"h-4 w-4\" />\r\n            {t(\"admin.moderation.rejected\", \"已拒绝\")}\r\n          </TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Batch Actions */}\r\n        {selectedIds.size > 0 && (\r\n          <div className=\"flex items-center gap-3 mt-4 p-3 bg-muted/50 rounded-lg\">\r\n            <span className=\"text-sm text-muted-foreground\">\r\n              {t(\"admin.selected\", \"已选择\")} {selectedIds.size} {t(\"admin.items\", \"项\")}\r\n            </span>\r\n            <Button size=\"sm\" variant=\"outline\" onClick={selectAll}>\r\n              {selectedIds.size === posts?.length\r\n                ? t(\"admin.deselectAll\", \"取消全选\")\r\n                : t(\"admin.selectAll\", \"全选\")}\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              className=\"bg-emerald-600 hover:bg-emerald-700\"\r\n              onClick={handleBatchApprove}\r\n              disabled={updatePost.isPending}\r\n            >\r\n              <Check className=\"h-4 w-4 mr-1\" />\r\n              {t(\"admin.batchApprove\", \"批量通过\")}\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"destructive\"\r\n              onClick={handleBatchReject}\r\n              disabled={updatePost.isPending}\r\n            >\r\n              <XCircle className=\"h-4 w-4 mr-1\" />\r\n              {t(\"admin.batchReject\", \"批量拒绝\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        <TabsContent value={activeTab} className=\"mt-4 space-y-3\">\r\n          {isLoading ? (\r\n            Array.from({ length: 3 }).map((_, i) => <PostSkeleton key={i} />)\r\n          ) : posts && posts.length > 0 ? (\r\n            posts.map((post) => <PostItem key={post.id} post={post} />)\r\n          ) : (\r\n            <Card>\r\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\r\n                <ShieldCheck className=\"h-12 w-12 text-muted-foreground/30 mb-4\" />\r\n                <p className=\"text-muted-foreground\">\r\n                  {t(\"admin.moderation.noItems\", \"暂无待审核内容\")}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          )}\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Post Management Dialog */}\r\n      <PostManagementDialog\r\n        post={selectedPost}\r\n        open={!!selectedPost}\r\n        onOpenChange={(open) => !open && setSelectedPost(null)}\r\n      />\r\n\r\n      {/* Delete Confirmation */}\r\n      <AlertDialog open={!!deletePost} onOpenChange={(open) => !open && setDeletePost(null)}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"admin.communityPosts.deleteWarning\", \"此操作不可撤销，确定要删除这条帖子吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmDelete} className=\"bg-destructive hover:bg-destructive/90\">\r\n              {t(\"common.delete\", \"删除\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminCommunityModeration;\r\n"],"names":["AdminCommunityModeration","t","i18n","useTranslation","useLocalizedContent","search","setSearch","useState","activeTab","setActiveTab","selectedPost","setSelectedPost","deletePost","setDeletePost","selectedIds","setSelectedIds","isReviewing","setIsReviewing","getFilterOptions","tab","posts","isLoading","refetch","useAdminCommunityPosts","updatePost","useUpdatePost","deletePostMutation","useDeletePost","getDateLocale","zhCN","pt","enUS","getRiskColor","score","getRiskLabel","handleApprove","post","handleReject","handleReModerate","error","supabase","toast","err","handleBatchApprove","ids","id","handleBatchReject","confirmDelete","toggleSelect","newSet","selectAll","p","stripHtml","html","tmp","pendingCount","flaggedCount","PostItem","riskReasons","jsx","Card","CardContent","jsxs","Checkbox","Avatar","AvatarImage","AvatarFallback","Badge","cn","Image","Video","reason","Button","Eye","CheckCircle2","XCircle","RefreshCw","Trash2","PostSkeleton","Skeleton","CardHeader","CardTitle","Clock","ShieldAlert","ShieldCheck","today","Search","Input","e","Tabs","TabsList","TabsTrigger","AlertTriangle","Check","TabsContent","_","i","PostManagementDialog","open","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction"],"mappings":"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"}