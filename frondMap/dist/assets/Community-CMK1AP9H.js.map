{"version":3,"file":"Community-CMK1AP9H.js","sources":["../../src/components/community/PostGridCard.tsx","../../src/components/community/PostPointsRulesDialog.tsx","../../src/components/ui/command.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Heart, Images, MapPin } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CommunityPost, useLikePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\ninterface PostGridCardProps {\r\n  post: CommunityPost;\r\n}\r\n\r\nconst PostGridCard = ({ post }: PostGridCardProps) => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const [imageError, setImageError] = useState(false);\r\n\r\n  const handleLike = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleCardClick = () => {\r\n    navigate(`/community/${post.id}`);\r\n  };\r\n\r\n  // Strip HTML tags for plain text preview\r\n  const getPlainTextContent = (html: string) => {\r\n    const doc = new DOMParser().parseFromString(html, \"text/html\");\r\n    return doc.body.textContent || \"\";\r\n  };\r\n\r\n  const content = getLocalizedField(post, \"content\");\r\n  const plainContent = getPlainTextContent(content);\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasVideo = !!post.video_url;\r\n  const hasMedia = hasImages || hasVideo;\r\n  const imageCount = post.image_urls?.length || 0;\r\n\r\n  return (\r\n    <div \r\n      className=\"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1\"\r\n      onClick={handleCardClick}\r\n    >\r\n      {/* Media Section - Only show first image, no swipe */}\r\n      {hasMedia && (\r\n        <div className=\"relative\">\r\n          {hasImages ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden\">\r\n              {!imageError ? (\r\n                <img\r\n                  src={post.image_urls![0]}\r\n                  alt=\"\"\r\n                  className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\r\n                  onError={() => setImageError(true)}\r\n                />\r\n              ) : (\r\n                <div className=\"w-full h-full bg-muted flex items-center justify-center\">\r\n                  <span className=\"text-xs text-muted-foreground\">\r\n                    {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                  </span>\r\n                </div>\r\n              )}\r\n              \r\n              {/* Multiple images indicator */}\r\n              {imageCount > 1 && (\r\n                <div className=\"absolute top-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1\">\r\n                  <Images className=\"h-3 w-3\" />\r\n                  <span>{imageCount}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : hasVideo ? (\r\n            <div className=\"relative aspect-[4/5] overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                className=\"w-full h-full object-cover\"\r\n                preload=\"metadata\"\r\n                muted\r\n                playsInline\r\n              />\r\n              <div className=\"absolute inset-0 flex items-center justify-center\">\r\n                <div className=\"w-12 h-12 rounded-full bg-white/30 backdrop-blur-sm flex items-center justify-center\">\r\n                  <div className=\"w-0 h-0 border-l-[16px] border-l-white border-y-[10px] border-y-transparent ml-1\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n\r\n      {/* Content Section */}\r\n      <div className=\"p-3\">\r\n        {/* Restaurant Badge */}\r\n        {post.restaurant && (\r\n          <Link \r\n            to={`/restaurant/${post.restaurant.id}`}\r\n            onClick={(e) => e.stopPropagation()}\r\n            className=\"inline-block mb-2\"\r\n          >\r\n            <Badge variant=\"outline\" className=\"text-xs gap-1 hover:bg-accent transition-colors\">\r\n              <MapPin className=\"h-3 w-3\" />\r\n              {getLocalizedField(post.restaurant, \"name\")}\r\n            </Badge>\r\n          </Link>\r\n        )}\r\n\r\n        {/* Text Content */}\r\n        <p className={`text-sm font-medium line-clamp-2 leading-relaxed ${hasMedia ? '' : 'min-h-[60px]'}`}>\r\n          {plainContent}\r\n        </p>\r\n\r\n        {/* Author Row */}\r\n        <div className=\"flex items-center justify-between mt-3\">\r\n          <div className=\"flex items-center gap-2 min-w-0 flex-1\">\r\n            <Avatar className=\"h-5 w-5 flex-shrink-0\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback className=\"text-[10px]\">\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <span className=\"text-xs text-muted-foreground truncate\">\r\n              {post.author?.display_name}\r\n            </span>\r\n          </div>\r\n\r\n          {/* Like Button */}\r\n          <button\r\n            className={`flex items-center gap-1 text-xs ${\r\n              post.user_liked ? \"text-red-500\" : \"text-muted-foreground\"\r\n            } hover:text-red-500 transition-colors`}\r\n            onClick={handleLike}\r\n            disabled={!user}\r\n          >\r\n            <Heart\r\n              className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n            />\r\n            <span>{post.likes_count || 0}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostGridCard;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Gift, CheckCircle, Clock, Shield } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { usePointsSettings } from \"@/hooks/usePoints\";\r\n\r\nconst PostPointsRulesDialog = () => {\r\n  const { t } = useTranslation();\r\n  const { data: settings } = usePointsSettings();\r\n\r\n  // 从设置中提取值\r\n  const postPoints = settings?.find(s => s.key === 'post_points')?.value || '5';\r\n  const minLength = settings?.find(s => s.key === 'min_post_length')?.value || '10';\r\n  const requireMedia = settings?.find(s => s.key === 'post_require_media')?.value === 'true';\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <button className=\"text-primary hover:underline text-sm whitespace-nowrap\">\r\n          {t(\"community.viewPointsRules\", \"查看详细规则\")}\r\n        </button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Gift className=\"h-5 w-5 text-primary\" />\r\n            {t(\"community.pointsRulesTitle\", \"发帖积分规则\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 pt-2\">\r\n          <p className=\"text-muted-foreground text-sm\">\r\n            {t(\"community.pointsRulesIntro\", \"通过发布社区帖子获得积分，具体规则如下：\")}\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            {/* 积分数量 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.rulePostPoints\", { points: postPoints })}</span>\r\n            </li>\r\n            {/* 最小长度 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleMinLength\", { length: minLength })}</span>\r\n            </li>\r\n            {/* 媒体要求 */}\r\n            {requireMedia && (\r\n              <li className=\"flex items-start gap-2 text-sm\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n                <span>{t(\"community.ruleRequireMedia\", \"帖子必须包含至少一张图片或一个视频\")}</span>\r\n              </li>\r\n            )}\r\n            {/* 每日限制 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Clock className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleDailyLimit\", \"每天仅可通过发帖获得一次积分奖励\")}</span>\r\n            </li>\r\n            {/* 审核要求 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Shield className=\"h-4 w-4 text-purple-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleModerationRequired\", \"帖子需通过审核后才能获得积分\")}</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PostPointsRulesDialog;\r\n","import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, Gift, Check, ChevronsUpDown, ArrowLeft, Smile } from \"lucide-react\";\r\nimport PostPointsRulesDialog from \"./PostPointsRulesDialog\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n  SheetTrigger,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n} from \"@/components/ui/command\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant, useHasPostedToday } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n  const { data: hasPostedToday, isLoading: checkingPost } = useHasPostedToday();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantId, setRestaurantId] = useState<string>(\"\");\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [restaurantSearch, setRestaurantSearch] = useState(\"\");\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // 普通用户 = 既不是商家、督导也不是管理员\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n\r\n  // 商家自动设置餐厅\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantId(merchantRestaurant.id);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // 重置表单\r\n  const resetForm = () => {\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantId(\"\");\r\n    setRestaurantSearch(\"\");\r\n    setRestaurantOpen(false);\r\n    setActivityOpen(false);\r\n  };\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  // Filter restaurants based on search\r\n  const filteredRestaurants = restaurants?.filter((r) => {\r\n    if (!restaurantSearch) return true;\r\n    const name = getLocalizedField(r, \"name\")?.toLowerCase() || \"\";\r\n    const address = r.address?.toLowerCase() || \"\";\r\n    const search = restaurantSearch.toLowerCase();\r\n    return name.includes(search) || address.includes(search);\r\n  }) || [];\r\n\r\n  // Get selected restaurant name\r\n  const getSelectedRestaurantName = () => {\r\n    if (!restaurantId) return \"\";\r\n    const selected = restaurants?.find((r) => r.id === restaurantId);\r\n    return selected ? getLocalizedField(selected, \"name\") : \"\";\r\n  };\r\n\r\n  // Get selected activity name\r\n  const getSelectedActivityName = () => {\r\n    if (!activityId) return \"\";\r\n    const selected = activities?.find((a) => a.id === activityId);\r\n    return selected ? getLocalizedField(selected, \"title\") : \"\";\r\n  };\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"最多上传9张图片\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"视频不能超过100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"正在提取视频封面...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"封面已自动生成\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"请输入内容\"));\r\n      return;\r\n    }\r\n\r\n    // 普通用户必须选择餐厅\r\n    if (isRegularUser && !restaurantId) {\r\n      toast.error(t(\"community.restaurantRequired\", \"请选择餐厅\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_id: restaurantId || undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  // 获取商家餐厅名称\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"未关联餐厅\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={handleOpenChange}>\r\n      <SheetTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"发布帖子\")}</Button>\r\n        )}\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.createPost\", \"发布帖子\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* 顶部导航栏 - 固定 */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setOpen(false)}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={createPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.publish\", \"发布\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* 可滚动内容区 */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-4 py-4 space-y-4\">\r\n            {/* Points Hint - Only show if user hasn't posted today */}\r\n            {!checkingPost && !hasPostedToday && (\r\n              <div className=\"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Gift className=\"h-4 w-4 shrink-0\" />\r\n                  <span>{t(\"community.dailyPointsHint\", \"每日发布首个帖子可获得5积分！\")}</span>\r\n                </div>\r\n                <PostPointsRulesDialog />\r\n              </div>\r\n            )}\r\n\r\n            {/* 内容输入区 */}\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"分享你的想法...\")}\r\n              className=\"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base\"\r\n            />\r\n\r\n            {/* 图片预览 */}\r\n            {imageUrls.length > 0 && (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {imageUrls.map((url, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden\">\r\n                    <img src={url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => removeImage(index)}\r\n                      className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* 视频预览 */}\r\n            {videoUrl && (\r\n              <div className=\"relative rounded-lg overflow-hidden\">\r\n                <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={removeVideo}\r\n                  className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* 关联信息区 */}\r\n        <div className=\"px-4 py-3 bg-background shrink-0 flex items-center gap-6\">\r\n          {/* 餐厅选择 */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <MapPin className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            {isMerchant ? (\r\n              <span className=\"text-sm text-muted-foreground\">\r\n                {getMerchantRestaurantName()}\r\n              </span>\r\n            ) : (\r\n              <Popover open={restaurantOpen} onOpenChange={setRestaurantOpen}>\r\n                <PopoverTrigger asChild>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n                  >\r\n                    {restaurantId ? (\r\n                      <span className=\"text-primary\">{getSelectedRestaurantName()}</span>\r\n                    ) : (\r\n                      <span className=\"text-muted-foreground\">\r\n                        {t(\"community.linkRestaurant\", \"关联餐厅\")}\r\n                        {isRegularUser && <span className=\"text-destructive ml-1\">*</span>}\r\n                      </span>\r\n                    )}\r\n                    <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n                  </button>\r\n                </PopoverTrigger>\r\n                <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n                  <Command shouldFilter={false}>\r\n                    <CommandInput\r\n                      placeholder={t(\"community.searchRestaurant\", \"搜索餐厅...\")}\r\n                      value={restaurantSearch}\r\n                      onValueChange={setRestaurantSearch}\r\n                    />\r\n                    <CommandList>\r\n                      <CommandEmpty>{t(\"community.noRestaurantFound\", \"未找到匹配的餐厅\")}</CommandEmpty>\r\n                      <CommandGroup>\r\n                        {/* 只有督导和管理员可以选择\"不关联\" */}\r\n                        {(isSupervisor || isAdmin) && (\r\n                          <CommandItem\r\n                            value=\"none\"\r\n                            onSelect={() => {\r\n                              setRestaurantId(\"\");\r\n                              setRestaurantOpen(false);\r\n                              setRestaurantSearch(\"\");\r\n                            }}\r\n                          >\r\n                            <Check\r\n                              className={cn(\r\n                                \"mr-2 h-4 w-4\",\r\n                                !restaurantId ? \"opacity-100\" : \"opacity-0\"\r\n                              )}\r\n                            />\r\n                            {t(\"community.noRestaurantLink\", \"不关联餐厅\")}\r\n                          </CommandItem>\r\n                        )}\r\n                        {filteredRestaurants.map((restaurant) => (\r\n                          <CommandItem\r\n                            key={restaurant.id}\r\n                            value={restaurant.id}\r\n                            onSelect={() => {\r\n                              setRestaurantId(restaurant.id);\r\n                              setRestaurantOpen(false);\r\n                              setRestaurantSearch(\"\");\r\n                            }}\r\n                          >\r\n                            <Check\r\n                              className={cn(\r\n                                \"mr-2 h-4 w-4\",\r\n                                restaurantId === restaurant.id ? \"opacity-100\" : \"opacity-0\"\r\n                              )}\r\n                            />\r\n                            {getLocalizedField(restaurant, \"name\")}\r\n                          </CommandItem>\r\n                        ))}\r\n                      </CommandGroup>\r\n                    </CommandList>\r\n                  </Command>\r\n                </PopoverContent>\r\n              </Popover>\r\n            )}\r\n          </div>\r\n\r\n          {/* 活动选择 */}\r\n          <div className=\"flex items-center gap-3\">\r\n            <Calendar className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n            <Popover open={activityOpen} onOpenChange={setActivityOpen}>\r\n              <PopoverTrigger asChild>\r\n                <button\r\n                  type=\"button\"\r\n                  className=\"flex items-center gap-1 text-sm hover:text-primary transition-colors\"\r\n                >\r\n                  {activityId ? (\r\n                    <span className=\"text-primary\">{getSelectedActivityName()}</span>\r\n                  ) : (\r\n                    <span className=\"text-muted-foreground\">\r\n                      {t(\"community.linkActivity\", \"关联活动\")}\r\n                    </span>\r\n                  )}\r\n                  <ChevronsUpDown className=\"h-4 w-4 opacity-50\" />\r\n                </button>\r\n              </PopoverTrigger>\r\n              <PopoverContent className=\"w-72 p-0\" align=\"start\">\r\n                <Command>\r\n                  <CommandList>\r\n                    <CommandGroup>\r\n                      <CommandItem\r\n                        value=\"none\"\r\n                        onSelect={() => {\r\n                          setActivityId(\"\");\r\n                          setActivityOpen(false);\r\n                        }}\r\n                      >\r\n                        <Check\r\n                          className={cn(\r\n                            \"mr-2 h-4 w-4\",\r\n                            !activityId ? \"opacity-100\" : \"opacity-0\"\r\n                          )}\r\n                        />\r\n                        {t(\"community.noActivity\", \"不关联活动\")}\r\n                      </CommandItem>\r\n                      {activeActivities.map((activity) => (\r\n                        <CommandItem\r\n                          key={activity.id}\r\n                          value={activity.id}\r\n                          onSelect={() => {\r\n                            setActivityId(activity.id);\r\n                            setActivityOpen(false);\r\n                          }}\r\n                        >\r\n                          <Check\r\n                            className={cn(\r\n                              \"mr-2 h-4 w-4\",\r\n                              activityId === activity.id ? \"opacity-100\" : \"opacity-0\"\r\n                            )}\r\n                          />\r\n                          {getLocalizedField(activity, \"title\")}\r\n                        </CommandItem>\r\n                      ))}\r\n                    </CommandGroup>\r\n                  </CommandList>\r\n                </Command>\r\n              </PopoverContent>\r\n            </Popover>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 底部媒体工具栏 - 固定 */}\r\n        <div className=\"flex items-center gap-6 px-4 py-3 bg-background shrink-0 safe-area-inset-bottom\">\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading || imageUrls.length >= 9}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Image className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.photo\", \"照片\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => videoInputRef.current?.click()}\r\n            disabled={uploading || !!videoUrl}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Video className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.video\", \"视频\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            disabled\r\n            className=\"flex items-center gap-1.5 text-muted-foreground opacity-50 cursor-not-allowed\"\r\n          >\r\n            <Smile className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.emoji\", \"表情\")}</span>\r\n          </button>\r\n\r\n          {uploading && <Loader2 className=\"h-5 w-5 animate-spin ml-auto\" />}\r\n        </div>\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>;\r\nconst Community = () => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const {\r\n    data: posts,\r\n    isLoading\r\n  } = useCommunityPosts({\r\n    status: \"approved\"\r\n  });\r\n  const {\r\n    data: canPost\r\n  } = useCanCreatePost();\r\n  const handleRefresh = useCallback(async () => {\r\n    await queryClient.invalidateQueries({\r\n      queryKey: ['community-posts']\r\n    });\r\n  }, [queryClient]);\r\n  return <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-4xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-6\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl mb-2 text-primary font-medium\">\r\n                {t(\"community.title\", \"社区\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"分享美食体验，发现更多精彩\")}\r\n              </p>\r\n            </div>\r\n            {canPost && <CreatePostDialog trigger={<Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n                  </Button>} />}\r\n          </div>\r\n\r\n        {/* Content */}\r\n        {isLoading ?\r\n        // Loading skeleton - masonry style\r\n        <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {Array.from({\r\n            length: 6\r\n          }).map((_, i) => <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridSkeleton />\r\n              </div>)}\r\n          </div> : posts && posts.length > 0 ?\r\n        // Xiaohongshu-style Masonry Grid\r\n        <div className=\"columns-2 sm:columns-3 lg:columns-4 xl:columns-5 gap-3 sm:gap-4\">\r\n            {posts.map(post => <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                <PostGridCard post={post} />\r\n              </div>)}\r\n          </div> :\r\n        // Empty state - separate container for proper centering\r\n        <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n            <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n              <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n            </div>\r\n            <p className=\"text-muted-foreground text-lg\">{t(\"community.noPosts\", \"暂无帖子\")}</p>\r\n            {canPost && <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                {t(\"community.beFirst\", \"成为第一个发帖的人吧！\")}\r\n              </p>}\r\n          </div>}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>;\r\n};\r\nexport default Community;"],"names":["PostGridCard","post","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","imageError","setImageError","useState","handleLike","e","handleCardClick","getPlainTextContent","html","content","plainContent","hasImages","hasVideo","hasMedia","imageCount","jsxs","jsx","Images","Link","Badge","MapPin","Avatar","AvatarImage","AvatarFallback","Heart","PostPointsRulesDialog","t","settings","usePointsSettings","postPoints","s","minLength","requireMedia","Dialog","DialogTrigger","DialogContent","DialogHeader","DialogTitle","Gift","CheckCircle","Clock","Shield","Command","React.forwardRef","className","props","ref","CommandPrimitive","cn","CommandInput","Search","CommandList","CommandEmpty","CommandGroup","CommandSeparator","CommandItem","CreatePostDialog","trigger","createPost","useCreatePost","activities","useActivities","restaurants","useRestaurants","role","isMerchant","isAdmin","isSupervisor","useUserRole","merchantRestaurant","useMerchantRestaurant","hasPostedToday","checkingPost","useHasPostedToday","open","setOpen","setContent","imageUrls","setImageUrls","videoUrl","setVideoUrl","activityId","setActivityId","restaurantId","setRestaurantId","uploading","setUploading","restaurantOpen","setRestaurantOpen","restaurantSearch","setRestaurantSearch","activityOpen","setActivityOpen","imageInputRef","useRef","videoInputRef","isRegularUser","useEffect","resetForm","handleOpenChange","newOpen","filteredRestaurants","r","name","address","search","getSelectedRestaurantName","selected","getSelectedActivityName","a","handleImageUpload","files","toast","supabase","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","prev","error","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","index","_","i","removeVideo","handleSubmit","activeActivities","getMerchantRestaurantName","Sheet","SheetTrigger","Button","SheetContent","VisuallyHidden.Root","SheetTitle","ArrowLeft","Loader2","Textarea","url","X","Popover","PopoverTrigger","ChevronsUpDown","PopoverContent","Check","restaurant","Calendar","activity","Image","Video","Smile","PostGridSkeleton","Skeleton","Community","queryClient","useQueryClient","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","handleRefresh","useCallback","PullToRefresh","Plus"],"mappings":"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"}