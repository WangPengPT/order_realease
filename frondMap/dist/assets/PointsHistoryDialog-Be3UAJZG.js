import{p as c,x as v,v as l,o as u,ac as m,af as p,u as _,r as x,j as e,D as N,aa as b,B as q,b as C,d as D,e as S,a6 as T,a1 as A,t as E,aw as F}from"./index-B9cY5t1p.js";import{T as H,a as U,b as f,c as Q}from"./tabs-CsfMJY62.js";import{u as K}from"./usePoints-BvHtPm3H.js";import{H as B}from"./history-BRe2ycz8.js";import{C as y}from"./coins-BChzlX-c.js";import{A as M,a as g}from"./arrow-up-BmKJg5qU.js";import{C as L}from"./clock-Cp6uC9E8.js";import{R as P}from"./refresh-cw-D6c4tE36.js";import{S as R}from"./shopping-bag-C2faTDDo.js";import{G as $}from"./gift-K999JfmY.js";import{f as G}from"./format-BewYtBYJ.js";const se=()=>{const{user:s}=c();return v({queryKey:["user-addresses",s==null?void 0:s.id],queryFn:async()=>{if(!s)return[];const{data:n,error:o}=await l.from("user_addresses").select("*").eq("user_id",s.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(o)throw o;return n},enabled:!!s})},te=()=>{const{user:s}=c(),{toast:n}=u(),o=m();return p({mutationFn:async a=>{if(!s)throw new Error("User not authenticated");const{data:r,error:i}=await l.from("user_addresses").insert({user_id:s.id,label:a.label,street:a.street,district:a.district||null,city:a.city,postal_code:a.postal_code||null,country:a.country,phone:a.phone||null,phone_code:a.phone_code||"+351",is_default:a.is_default||!1}).select().single();if(i)throw i;return r},onSuccess:()=>{o.invalidateQueries({queryKey:["user-addresses"]}),n({title:"Success",description:"Address added successfully"})},onError:()=>{n({title:"Error",description:"Failed to add address",variant:"destructive"})}})},re=()=>{const{user:s}=c(),{toast:n}=u(),o=m();return p({mutationFn:async({id:a,address:r})=>{if(!s)throw new Error("User not authenticated");const{data:i,error:d}=await l.from("user_addresses").update({label:r.label,street:r.street,district:r.district||null,city:r.city,postal_code:r.postal_code||null,country:r.country,phone:r.phone||null,phone_code:r.phone_code||"+351",is_default:r.is_default}).eq("id",a).eq("user_id",s.id).select().single();if(d)throw d;return i},onSuccess:()=>{o.invalidateQueries({queryKey:["user-addresses"]}),n({title:"Success",description:"Address updated successfully"})},onError:()=>{n({title:"Error",description:"Failed to update address",variant:"destructive"})}})},ae=()=>{const{user:s}=c(),{toast:n}=u(),o=m();return p({mutationFn:async a=>{if(!s)throw new Error("User not authenticated");const{error:r}=await l.from("user_addresses").delete().eq("id",a).eq("user_id",s.id);if(r)throw r},onSuccess:()=>{o.invalidateQueries({queryKey:["user-addresses"]}),n({title:"Success",description:"Address deleted successfully"})},onError:()=>{n({title:"Error",description:"Failed to delete address",variant:"destructive"})}})},ne=()=>{const{user:s}=c(),{toast:n}=u(),o=m();return p({mutationFn:async a=>{if(!s)throw new Error("User not authenticated");const{data:r,error:i}=await l.from("user_addresses").update({is_default:!0}).eq("id",a).eq("user_id",s.id).select().single();if(i)throw i;return r},onSuccess:()=>{o.invalidateQueries({queryKey:["user-addresses"]}),n({title:"Success",description:"Default address updated"})},onError:()=>{n({title:"Error",description:"Failed to set default address",variant:"destructive"})}})},ie=()=>{const{t:s}=_(),[n,o]=x.useState(!1),{data:a=[],isLoading:r}=K(),[i,d]=x.useState("all"),j=t=>{switch(t){case"comment":return e.jsx(F,{className:"w-4 h-4"});case"admin_grant":return e.jsx($,{className:"w-4 h-4"});case"admin_deduct":return e.jsx(g,{className:"w-4 h-4"});case"purchase":return e.jsx(R,{className:"w-4 h-4"});case"refund":return e.jsx(P,{className:"w-4 h-4"});case"expire":return e.jsx(L,{className:"w-4 h-4"});default:return e.jsx(y,{className:"w-4 h-4"})}},w=t=>s(`points.type.${t}`),h=a.filter(t=>i==="all"?!0:i==="earned"?t.amount>0:i==="spent"?t.amount<0:!0);return e.jsxs(N,{open:n,onOpenChange:o,children:[e.jsx(b,{asChild:!0,children:e.jsxs(q,{variant:"ghost",size:"sm",className:"h-6 px-2",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),s("profile.pointsHistory","æ˜ç»†")]})}),e.jsxs(C,{className:"sm:max-w-lg max-h-[80vh]",children:[e.jsxs(D,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-accent"}),s("points.history")]}),e.jsx(T,{children:s("points.historyDesc")})]}),e.jsxs(H,{value:i,onValueChange:t=>d(t),children:[e.jsxs(U,{className:"grid w-full grid-cols-3",children:[e.jsx(f,{value:"all",children:s("points.filter.all")}),e.jsx(f,{value:"earned",children:s("points.filter.earned")}),e.jsx(f,{value:"spent",children:s("points.filter.spent")})]}),e.jsx(Q,{value:i,className:"mt-4",children:e.jsx(A,{className:"h-[400px] pr-4",children:r?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")}):h.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("points.noTransactions")}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg border bg-card",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${t.amount>0?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"}`,children:j(t.type)}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium flex items-center gap-2",children:[w(t.type),t.reason&&e.jsx(E,{variant:"outline",className:"text-xs font-normal",children:t.reason})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:G(new Date(t.created_at),"yyyy-MM-dd HH:mm")}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[s("points.balanceAfter"),": ",t.balance_after]})]})]}),e.jsxs("div",{className:`font-bold flex items-center gap-1 ${t.amount>0?"text-green-500":"text-red-500"}`,children:[t.amount>0?e.jsx(M,{className:"w-4 h-4"}):e.jsx(g,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.amount>0?"+":"",t.amount]})]})]},t.id))})})})]})]})]})};export{ie as P,te as a,re as b,ae as c,ne as d,se as u};
