import{u as I,a as V,r as k,y as h,j as s,l as y,i as z,ah as A,ai as U,aj as B,ak as H,al as p,C as u,n as j,m as Q,x as $,B as G,w as g}from"./index-Ga7ov3Y-.js";import{u as J}from"./useLocalizedContent-_OgE7_A3.js";import{T as M}from"./trending-up-Bz2jt9cI.js";import{E as N}from"./eye-C8yAbzd-.js";import{U as w}from"./users-CvZFyElM.js";import{S as b}from"./share-2-BQ0cccwq.js";import{C as _}from"./chart-column-CnedvVy3.js";import{s as v}from"./startOfDay-DpMPS_Sq.js";import{s as S}from"./subDays-DrGV0hEz.js";const rs=()=>{const{t:r}=I(),q=V(),{getLocalizedField:C}=J(),[d,E]=k.useState("30days"),F=()=>{const e=new Date;switch(d){case"today":return v(e).toISOString();case"7days":return v(S(e,6)).toISOString();case"30days":return v(S(e,29)).toISOString();default:return null}},{data:f,isLoading:O}=h({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:e,error:a}=await g.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;return e}}),l=F(),{data:n}=h({queryKey:["admin-all-subscription-counts",d],queryFn:async()=>{let e=g.from("subscriptions").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:o}=h({queryKey:["admin-all-share-counts",d],queryFn:async()=>{let e=g.from("activity_shares").select("activity_id, created_at");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{t[c.activity_id]=(t[c.activity_id]||0)+1}),t}}),{data:m}=h({queryKey:["admin-all-activity-view-counts",d],queryFn:async()=>{let e=g.from("page_views").select("target_id, created_at").eq("page_type","activity");l&&(e=e.gte("created_at",l));const{data:a,error:i}=await e;if(i)throw i;const t={};return a.forEach(c=>{c.target_id&&(t[c.target_id]=(t[c.target_id]||0)+1)}),t}}),{data:x}=h({queryKey:["admin-all-activity-restaurant-counts"],queryFn:async()=>{const{data:e,error:a}=await g.from("activity_restaurants").select("activity_id");if(a)throw a;const i={};return e.forEach(t=>{i[t.activity_id]=(i[t.activity_id]||0)+1}),i}}),D=m?Object.values(m).reduce((e,a)=>e+a,0):0,T=n?Object.values(n).reduce((e,a)=>e+a,0):0,K=o?Object.values(o).reduce((e,a)=>e+a,0):0,L=x?Object.values(x).reduce((e,a)=>e+a,0):0;return O?s.jsxs("div",{className:"space-y-6",children:[s.jsx(y,{className:"h-8 w-48"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>s.jsx(y,{className:"h-24"},e))}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(e=>s.jsx(y,{className:"h-40"},e))})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(M,{className:"h-6 w-6 text-primary"}),s.jsx("h1",{className:"text-2xl font-bold",children:r("admin.activityStatistics")})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs(A,{value:d,onValueChange:e=>E(e),children:[s.jsx(U,{className:"w-[140px]",children:s.jsx(B,{})}),s.jsxs(H,{children:[s.jsx(p,{value:"today",children:r("analytics.today","今日")}),s.jsx(p,{value:"7days",children:r("analytics.last7Days","近7天")}),s.jsx(p,{value:"30days",children:r("analytics.last30Days","近30天")}),s.jsx(p,{value:"all",children:r("analytics.allTime","所有时间")})]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsx(u,{children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:s.jsx(N,{className:"h-5 w-5 text-primary"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalViews")}),s.jsx("p",{className:"text-2xl font-bold",children:D})]})]})})}),s.jsx(u,{children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:s.jsx(w,{className:"h-5 w-5 text-red-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalSubscribers")}),s.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),s.jsx(u,{children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:s.jsx(b,{className:"h-5 w-5 text-green-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.totalShares")}),s.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),s.jsx(u,{children:s.jsx(j,{className:"pt-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:s.jsx(_,{className:"h-5 w-5 text-amber-500"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.participatingRestaurants")}),s.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:r("admin.allActivities")}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:f==null?void 0:f.map(e=>{const a=C(e,"title"),i=(m==null?void 0:m[e.id])||0,t=(n==null?void 0:n[e.id])||0,c=(o==null?void 0:o[e.id])||0,R=(x==null?void 0:x[e.id])||0;return s.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>q(`/admin/activity-stats/${e.id}`),children:[s.jsx(Q,{className:"pb-2",children:s.jsx($,{className:"text-base line-clamp-2",children:a})}),s.jsxs(j,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[i," ",r("admin.views")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[t," ",r("admin.subscribers")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[c," ",r("admin.shares")]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),s.jsxs("span",{children:[R," ",r("admin.restaurants")]})]})]}),s.jsx(G,{variant:"outline",size:"sm",className:"w-full mt-4",children:r("admin.viewDetails")})]})]},e.id)})})]})]})};export{rs as default};
