{"version":3,"file":"AdminActivities-WYfayg-S.js","sources":["../../src/components/admin/ImageCropDialog.tsx","../../src/components/admin/ActivityFormDialog.tsx","../../src/components/admin/ActivityRulesEditorDialog.tsx","../../src/components/admin/GlobalHandbookEditorDialog.tsx","../../src/pages/admin/AdminActivities.tsx"],"sourcesContent":["import { useState, useRef, useCallback, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport ReactCrop, { Crop, PixelCrop, centerCrop, makeAspectCrop } from \"react-image-crop\";\r\nimport \"react-image-crop/dist/ReactCrop.css\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Crop as CropIcon, Info, Maximize2 } from \"lucide-react\";\r\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\r\n\r\ninterface ImageCropDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  imageFile: File;\r\n  onCropComplete: (croppedFile: File, preview: string) => void;\r\n}\r\n\r\n// Recommended dimensions for activity images\r\nconst RECOMMENDED_WIDTH = 1200;\r\nconst RECOMMENDED_HEIGHT = 630;\r\nconst ASPECT_RATIO = RECOMMENDED_WIDTH / RECOMMENDED_HEIGHT;\r\n\r\nfunction centerAspectCrop(\r\n  mediaWidth: number,\r\n  mediaHeight: number,\r\n  aspect: number,\r\n) {\r\n  return centerCrop(\r\n    makeAspectCrop(\r\n      {\r\n        unit: '%',\r\n        width: 90,\r\n      },\r\n      aspect,\r\n      mediaWidth,\r\n      mediaHeight,\r\n    ),\r\n    mediaWidth,\r\n    mediaHeight,\r\n  );\r\n}\r\n\r\nexport function ImageCropDialog({\r\n  open,\r\n  onOpenChange,\r\n  imageFile,\r\n  onCropComplete,\r\n}: ImageCropDialogProps) {\r\n  const { t } = useTranslation();\r\n  const [imgSrc, setImgSrc] = useState(\"\");\r\n  const [crop, setCrop] = useState<Crop>();\r\n  const [completedCrop, setCompletedCrop] = useState<PixelCrop>();\r\n  const imgRef = useRef<HTMLImageElement>(null);\r\n  const [isCropping, setIsCropping] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (open && imageFile) {\r\n      const reader = new FileReader();\r\n      reader.addEventListener(\"load\", () => {\r\n        setImgSrc(reader.result?.toString() || \"\");\r\n      });\r\n      reader.readAsDataURL(imageFile);\r\n    }\r\n  }, [open, imageFile]);\r\n\r\n  const onImageLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const { width, height } = e.currentTarget;\r\n    setCrop(centerAspectCrop(width, height, ASPECT_RATIO));\r\n  }, []);\r\n\r\n  const getCroppedImg = useCallback(\r\n    async (image: HTMLImageElement, crop: PixelCrop): Promise<Blob> => {\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      if (!ctx) {\r\n        throw new Error(\"No 2d context\");\r\n      }\r\n\r\n      const scaleX = image.naturalWidth / image.width;\r\n      const scaleY = image.naturalHeight / image.height;\r\n\r\n      // Set canvas size to match the crop area\r\n      canvas.width = crop.width * scaleX;\r\n      canvas.height = crop.height * scaleY;\r\n\r\n      ctx.imageSmoothingQuality = \"high\";\r\n\r\n      ctx.drawImage(\r\n        image,\r\n        crop.x * scaleX,\r\n        crop.y * scaleY,\r\n        crop.width * scaleX,\r\n        crop.height * scaleY,\r\n        0,\r\n        0,\r\n        canvas.width,\r\n        canvas.height\r\n      );\r\n\r\n      return new Promise((resolve, reject) => {\r\n        canvas.toBlob(\r\n          (blob) => {\r\n            if (!blob) {\r\n              reject(new Error(\"Canvas is empty\"));\r\n              return;\r\n            }\r\n            resolve(blob);\r\n          },\r\n          \"image/jpeg\",\r\n          0.95\r\n        );\r\n      });\r\n    },\r\n    []\r\n  );\r\n\r\n  const handleCropConfirm = useCallback(async () => {\r\n    if (!completedCrop || !imgRef.current) return;\r\n\r\n    setIsCropping(true);\r\n    try {\r\n      const croppedBlob = await getCroppedImg(imgRef.current, completedCrop);\r\n      const croppedFile = new File([croppedBlob], imageFile.name, {\r\n        type: \"image/jpeg\",\r\n      });\r\n\r\n      // Create preview URL\r\n      const previewUrl = URL.createObjectURL(croppedBlob);\r\n\r\n      onCropComplete(croppedFile, previewUrl);\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error(\"Error cropping image:\", error);\r\n    } finally {\r\n      setIsCropping(false);\r\n    }\r\n  }, [completedCrop, imageFile, onCropComplete, onOpenChange, getCroppedImg]);\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0\">\r\n        <DialogHeader className=\"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b\">\r\n          <DialogTitle className=\"text-lg sm:text-xl flex items-center gap-2\">\r\n            <CropIcon className=\"w-5 h-5 text-primary\" />\r\n            {t(\"admin.cropImage\")}\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-xs sm:text-sm\">\r\n            {t(\"admin.cropImageDescription\")}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto\">\r\n          <Alert className=\"border-primary/20 bg-primary/5\">\r\n            <Info className=\"h-4 w-4\" />\r\n            <AlertDescription className=\"text-xs sm:text-sm\">\r\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2\">\r\n                <span className=\"font-medium\">{t(\"admin.recommendedSize\")}:</span>\r\n                <Badge variant=\"secondary\" className=\"w-fit\">\r\n                  <Maximize2 className=\"w-3 h-3 mr-1\" />\r\n                  {RECOMMENDED_WIDTH} √ó {RECOMMENDED_HEIGHT} px\r\n                </Badge>\r\n              </div>\r\n              <p className=\"mt-2 text-muted-foreground text-xs\">\r\n                {t(\"admin.imageSizeHint\")}\r\n              </p>\r\n            </AlertDescription>\r\n          </Alert>\r\n\r\n          <div className=\"relative w-full overflow-hidden rounded-lg border\">\r\n            {imgSrc && (\r\n              <ReactCrop\r\n                crop={crop}\r\n                onChange={(c) => setCrop(c)}\r\n                onComplete={(c) => setCompletedCrop(c)}\r\n                aspect={ASPECT_RATIO}\r\n                className=\"max-h-[50vh] sm:max-h-[60vh]\"\r\n              >\r\n                <img\r\n                  ref={imgRef}\r\n                  src={imgSrc}\r\n                  alt=\"Crop preview\"\r\n                  onLoad={onImageLoad}\r\n                  className=\"max-w-full h-auto\"\r\n                />\r\n              </ReactCrop>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter className=\"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0\">\r\n          <Button\r\n            type=\"button\"\r\n            variant=\"outline\"\r\n            onClick={() => onOpenChange(false)}\r\n            disabled={isCropping}\r\n            className=\"w-full sm:w-auto\"\r\n          >\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button\r\n            type=\"button\"\r\n            onClick={handleCropConfirm}\r\n            disabled={!completedCrop || isCropping}\r\n            className=\"w-full sm:w-auto\"\r\n          >\r\n            {isCropping ? t(\"common.processing\") : t(\"admin.confirmCrop\")}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useState, useEffect } from \"react\";\r\nimport { useForm, Controller } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Calendar } from \"@/components/ui/calendar\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { CalendarIcon, Upload, X, Globe, Pin, ArrowUpDown, Store, FileEdit, Send, Image, Video } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { RichTextEditor } from \"./RichTextEditor\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { ImageCropDialog } from \"./ImageCropDialog\";\r\nimport i18n from \"@/i18n/config\";\r\n\r\n// Draft schema - no required fields except status\r\nconst draftSchema = z.object({\r\n  title_en: z.string().optional(),\r\n  title_zh: z.string().optional(),\r\n  title_pt: z.string().optional(),\r\n  intro_zh: z.string().optional(),\r\n  intro_en: z.string().optional(),\r\n  intro_pt: z.string().optional(),\r\n  content_en: z.string().optional(),\r\n  content_zh: z.string().optional(),\r\n  content_pt: z.string().optional(),\r\n  usage_instructions_zh: z.string().optional(),\r\n  usage_instructions_en: z.string().optional(),\r\n  usage_instructions_pt: z.string().optional(),\r\n  start_date: z.date().optional(),\r\n  end_date: z.date().optional(),\r\n  repeat_mode: z.enum([\"none\", \"daily\", \"weekly\", \"monthly\", \"yearly\", \"days_before\"]).optional(),\r\n  repeat_weekday: z.number().min(0).max(6).optional().nullable(),\r\n  repeat_days_before: z.number().min(0).max(30).optional().nullable(),\r\n  service_type: z.enum([\"dine_in\", \"takeaway\", \"both\"]).optional(),\r\n  status: z.enum([\"draft\", \"published\"]).default(\"draft\"),\r\n  pinned: z.boolean().default(false),\r\n  visible: z.boolean().default(false),\r\n  sort_order: z.number().default(0),\r\n  badge_text_zh: z.string().optional(),\r\n  badge_text_en: z.string().optional(),\r\n  badge_text_pt: z.string().optional(),\r\n  badge_color: z.string().optional(),\r\n  discount_type: z.enum([\"percentage\", \"fixed_amount\"]).optional().nullable(),\r\n  discount_value: z.number().optional().nullable(),\r\n  discount_key: z.string().optional().nullable()\r\n});\r\n\r\n// Published schema - with required fields\r\nconst publishedSchema = z.object({\r\n  title_en: z.string().min(1, i18n.t(\"validation.titleRequired\")),\r\n  title_zh: z.string().min(1, i18n.t(\"validation.titleRequired\")),\r\n  title_pt: z.string().min(1, i18n.t(\"validation.titleRequired\")),\r\n  intro_zh: z.string().optional(),\r\n  intro_en: z.string().optional(),\r\n  intro_pt: z.string().optional(),\r\n  content_en: z.string().min(1, i18n.t(\"validation.contentRequired\")),\r\n  content_zh: z.string().min(1, i18n.t(\"validation.contentRequired\")),\r\n  content_pt: z.string().min(1, i18n.t(\"validation.contentRequired\")),\r\n  usage_instructions_zh: z.string().optional(),\r\n  usage_instructions_en: z.string().optional(),\r\n  usage_instructions_pt: z.string().optional(),\r\n  start_date: z.date(),\r\n  end_date: z.date().optional(),\r\n  repeat_mode: z.enum([\"none\", \"daily\", \"weekly\", \"monthly\", \"yearly\", \"days_before\"]),\r\n  repeat_weekday: z.number().min(0).max(6).optional().nullable(),\r\n  repeat_days_before: z.number().min(0).max(30).optional().nullable(),\r\n  service_type: z.enum([\"dine_in\", \"takeaway\", \"both\"]),\r\n  status: z.enum([\"draft\", \"published\"]).default(\"published\"),\r\n  pinned: z.boolean().default(false),\r\n  visible: z.boolean().default(true),\r\n  sort_order: z.number().default(0),\r\n  badge_text_zh: z.string().optional(),\r\n  badge_text_en: z.string().optional(),\r\n  badge_text_pt: z.string().optional(),\r\n  badge_color: z.string().optional(),\r\n  discount_type: z.enum([\"percentage\", \"fixed_amount\"]).optional().nullable(),\r\n  discount_value: z.number().optional().nullable(),\r\n  discount_key: z.string().optional().nullable()\r\n});\r\n\r\n// Base schema for form (uses draft schema, validation happens on submit)\r\nconst activitySchema = draftSchema;\r\ntype ActivityFormData = z.infer<typeof activitySchema>;\r\ninterface ActivityFormDialogProps {\r\n  activity?: any;\r\n  trigger: React.ReactNode;\r\n}\r\nexport function ActivityFormDialog({\r\n  activity,\r\n  trigger\r\n}: ActivityFormDialogProps) {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const [open, setOpen] = useState(false);\r\n  const [imageFile, setImageFile] = useState<File | null>(null);\r\n  const [imagePreview, setImagePreview] = useState<string | null>(activity?.image_url || null);\r\n  const [selectedRestaurants, setSelectedRestaurants] = useState<string[]>([]);\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [showCropDialog, setShowCropDialog] = useState(false);\r\n  const [tempImageFile, setTempImageFile] = useState<File | null>(null);\r\n  const [mediaType, setMediaType] = useState<\"image\" | \"video\">(activity?.media_type === \"video\" ? \"video\" : \"image\");\r\n  const [videoFile, setVideoFile] = useState<File | null>(null);\r\n  const [videoPreview, setVideoPreview] = useState<string | null>(activity?.video_url || null);\r\n  const [isUploadingVideo, setIsUploadingVideo] = useState(false);\r\n  const [videoDeleted, setVideoDeleted] = useState(false);\r\n  const {\r\n    data: restaurants\r\n  } = useRestaurants();\r\n  const getDefaultValues = (): ActivityFormData => activity ? {\r\n    title_en: activity.title_en,\r\n    title_zh: activity.title_zh,\r\n    title_pt: activity.title_pt,\r\n    intro_zh: activity.intro_zh || \"\",\r\n    intro_en: activity.intro_en || \"\",\r\n    intro_pt: activity.intro_pt || \"\",\r\n    content_en: activity.content_en,\r\n    content_zh: activity.content_zh,\r\n    content_pt: activity.content_pt,\r\n    usage_instructions_zh: activity.usage_instructions_zh || \"\",\r\n    usage_instructions_en: activity.usage_instructions_en || \"\",\r\n    usage_instructions_pt: activity.usage_instructions_pt || \"\",\r\n    start_date: new Date(activity.start_date),\r\n    end_date: activity.end_date ? new Date(activity.end_date) : undefined,\r\n    repeat_mode: (activity.repeat_mode || \"none\") as \"none\" | \"daily\" | \"weekly\" | \"monthly\" | \"yearly\" | \"days_before\",\r\n    repeat_weekday: activity.repeat_weekday ?? null,\r\n    repeat_days_before: activity.repeat_days_before ?? null,\r\n    service_type: (activity.service_type || \"both\") as \"dine_in\" | \"takeaway\" | \"both\",\r\n    status: (activity.status || \"draft\") as \"draft\" | \"published\",\r\n    pinned: activity.pinned || false,\r\n    visible: activity.visible !== undefined ? activity.visible : true,\r\n    sort_order: activity.sort_order || 0,\r\n    badge_text_zh: activity.badge_text_zh || activity.title_zh,\r\n    badge_text_en: activity.badge_text_en || activity.title_en,\r\n    badge_text_pt: activity.badge_text_pt || activity.title_pt,\r\n    badge_color: activity.badge_color || \"#9b87f5\",\r\n    discount_type: activity.discount_type || null,\r\n    discount_value: activity.discount_value || null,\r\n    discount_key: activity.discount_key || null\r\n  } : {\r\n    repeat_mode: \"none\" as const,\r\n    repeat_weekday: null,\r\n    repeat_days_before: null,\r\n    service_type: \"both\" as const,\r\n    status: \"draft\" as const,\r\n    pinned: false,\r\n    visible: false,\r\n    sort_order: 0,\r\n    badge_color: \"#9b87f5\",\r\n    discount_type: null,\r\n    discount_value: null,\r\n    discount_key: null\r\n  };\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    formState: {\r\n      errors\r\n    },\r\n    setValue,\r\n    watch,\r\n    control,\r\n    reset\r\n  } = useForm<ActivityFormData>({\r\n    resolver: zodResolver(activitySchema),\r\n    defaultValues: getDefaultValues()\r\n  });\r\n\r\n  // Reset form when dialog closes\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    if (!newOpen) {\r\n      // Reset form to original values when closing\r\n      reset(getDefaultValues());\r\n      setImageFile(null);\r\n      setImagePreview(activity?.image_url || null);\r\n      setVideoFile(null);\r\n      setVideoPreview(activity?.video_url || null);\r\n      setVideoDeleted(false);\r\n      setMediaType(activity?.media_type === \"video\" ? \"video\" : \"image\");\r\n    }\r\n    setOpen(newOpen);\r\n  };\r\n  const startDate = watch(\"start_date\");\r\n  const endDate = watch(\"end_date\");\r\n  const pinned = watch(\"pinned\");\r\n  const visible = watch(\"visible\");\r\n  const status = watch(\"status\");\r\n\r\n  // Sync visible with status - draft always has visible=false\r\n  useEffect(() => {\r\n    if (status === \"draft\") {\r\n      setValue(\"visible\", false);\r\n      setValue(\"pinned\", false);\r\n    }\r\n  }, [status, setValue]);\r\n\r\n  // Load associated restaurants when editing\r\n  useEffect(() => {\r\n    const loadAssociatedRestaurants = async () => {\r\n      if (activity?.id) {\r\n        const {\r\n          data\r\n        } = await supabase.from(\"activity_restaurants\").select(\"restaurant_id\").eq(\"activity_id\", activity.id);\r\n        if (data) {\r\n          setSelectedRestaurants(data.map(ar => ar.restaurant_id));\r\n        }\r\n      }\r\n    };\r\n    loadAssociatedRestaurants();\r\n  }, [activity?.id]);\r\n  const handleImageChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      // Check file size (max 10MB)\r\n      if (file.size > 10 * 1024 * 1024) {\r\n        toast.error(t(\"admin.imageTooBig\"));\r\n        return;\r\n      }\r\n      setTempImageFile(file);\r\n      setShowCropDialog(true);\r\n    }\r\n    // Reset input\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  const handleCropComplete = (croppedFile: File, preview: string) => {\r\n    setImageFile(croppedFile);\r\n    setImagePreview(preview);\r\n  };\r\n\r\n  const handleVideoChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      // Check file size (max 100MB)\r\n      if (file.size > 100 * 1024 * 1024) {\r\n        toast.error(t(\"admin.videoTooBig\") || \"ËßÜÈ¢ëÊñá‰ª∂ËøáÂ§ßÔºàÊúÄÂ§ß100MBÔºâ\");\r\n        return;\r\n      }\r\n      // Check file type\r\n      if (!file.type.startsWith(\"video/\")) {\r\n        toast.error(t(\"admin.invalidVideoFormat\") || \"ËØ∑‰∏ä‰º†ËßÜÈ¢ëÊñá‰ª∂\");\r\n        return;\r\n      }\r\n      setVideoFile(file);\r\n      setVideoPreview(URL.createObjectURL(file));\r\n      setVideoDeleted(false); // Reset deleted flag when new video is uploaded\r\n    }\r\n    e.target.value = \"\";\r\n  };\r\n\r\n  const uploadImage = async (): Promise<string | null> => {\r\n    if (!imageFile) return activity?.image_url || null;\r\n    const fileExt = imageFile.name.split(\".\").pop();\r\n    const fileName = `${Math.random()}.${fileExt}`;\r\n    const filePath = `${fileName}`;\r\n    const {\r\n      error: uploadError\r\n    } = await supabase.storage.from(\"activity-images\").upload(filePath, imageFile);\r\n    if (uploadError) {\r\n      throw uploadError;\r\n    }\r\n    const {\r\n      data: {\r\n        publicUrl\r\n      }\r\n    } = supabase.storage.from(\"activity-images\").getPublicUrl(filePath);\r\n    return publicUrl;\r\n  };\r\n\r\n  const uploadVideo = async (): Promise<string | null> => {\r\n    // If user explicitly deleted video, return null\r\n    if (videoDeleted && !videoFile) return null;\r\n    if (!videoFile) return activity?.video_url || null;\r\n    setIsUploadingVideo(true);\r\n    try {\r\n      const fileExt = videoFile.name.split(\".\").pop();\r\n      const fileName = `video_${Date.now()}.${fileExt}`;\r\n      const { error: uploadError } = await supabase.storage\r\n        .from(\"activity-images\")\r\n        .upload(fileName, videoFile);\r\n      if (uploadError) throw uploadError;\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"activity-images\")\r\n        .getPublicUrl(fileName);\r\n      return publicUrl;\r\n    } finally {\r\n      setIsUploadingVideo(false);\r\n    }\r\n  };\r\n  const onSubmit = async (data: ActivityFormData) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      // If publishing, validate with publishedSchema\r\n      if (data.status === \"published\") {\r\n        const publishedResult = publishedSchema.safeParse(data);\r\n        if (!publishedResult.success) {\r\n          // Map field names to readable labels\r\n          const fieldLabels: Record<string, string> = {\r\n            title_zh: t(\"admin.titleChinese\"),\r\n            title_en: t(\"admin.titleEnglish\"),\r\n            title_pt: t(\"admin.titlePortuguese\"),\r\n            content_zh: t(\"admin.contentChinese\"),\r\n            content_en: t(\"admin.contentEnglish\"),\r\n            content_pt: t(\"admin.contentPortuguese\"),\r\n            start_date: t(\"admin.startDate\"),\r\n            end_date: t(\"admin.endDate\"),\r\n            repeat_mode: t(\"admin.repeatMode\"),\r\n            service_type: t(\"admin.serviceType\")\r\n          };\r\n          \r\n          // Collect all missing fields\r\n          const missingFields = publishedResult.error.errors.map(err => {\r\n            const fieldPath = err.path.join(\".\");\r\n            return fieldLabels[fieldPath] || fieldPath;\r\n          });\r\n          \r\n          // Show all missing fields in toast\r\n          toast.error(`${t(\"admin.publishRequiresComplete\")}: ${missingFields.join(\", \")}`);\r\n          setIsSubmitting(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      const {\r\n        data: {\r\n          user\r\n        }\r\n      } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n      // Upload image and video in parallel for better performance\r\n      const [imageUrl, videoUrl] = await Promise.all([\r\n        uploadImage(),\r\n        uploadVideo()\r\n      ]);\r\n\r\n      // Draft activities always have visible=false\r\n      const finalVisible = data.status === \"draft\" ? false : data.visible;\r\n\r\n      const activityData = {\r\n        title_en: data.title_en || \"\",\r\n        title_zh: data.title_zh || \"\",\r\n        title_pt: data.title_pt || \"\",\r\n        intro_zh: data.intro_zh || null,\r\n        intro_en: data.intro_en || null,\r\n        intro_pt: data.intro_pt || null,\r\n        content_en: data.content_en || \"\",\r\n        content_zh: data.content_zh || \"\",\r\n        content_pt: data.content_pt || \"\",\r\n        usage_instructions_zh: data.usage_instructions_zh || null,\r\n        usage_instructions_en: data.usage_instructions_en || null,\r\n        usage_instructions_pt: data.usage_instructions_pt || null,\r\n        repeat_mode: data.repeat_mode || \"none\",\r\n        repeat_weekday: data.repeat_mode === 'weekly' ? data.repeat_weekday : null,\r\n        repeat_days_before: data.repeat_mode === 'days_before' ? data.repeat_days_before : null,\r\n        service_type: data.service_type || \"both\",\r\n        status: data.status,\r\n        pinned: data.status === \"draft\" ? false : data.pinned,\r\n        visible: finalVisible,\r\n        sort_order: data.sort_order,\r\n        image_url: imageUrl,\r\n        media_type: mediaType,\r\n        video_url: videoUrl,\r\n        creator_id: user.id,\r\n        start_date: data.start_date?.toISOString() || new Date().toISOString(),\r\n        end_date: data.end_date?.toISOString() || null,\r\n        badge_text_zh: data.badge_text_zh || data.title_zh || \"\",\r\n        badge_text_en: data.badge_text_en || data.title_en || \"\",\r\n        badge_text_pt: data.badge_text_pt || data.title_pt || \"\",\r\n        badge_color: data.badge_color || \"#9b87f5\",\r\n        discount_type: data.discount_type || null,\r\n        discount_value: data.discount_value || null,\r\n        discount_key: data.discount_key || null\r\n      };\r\n      if (activity) {\r\n        // Update activity\r\n        const {\r\n          error\r\n        } = await supabase.from(\"activities\").update(activityData).eq(\"id\", activity.id);\r\n        if (error) throw error;\r\n\r\n        // Update restaurant associations\r\n        await supabase.from(\"activity_restaurants\").delete().eq(\"activity_id\", activity.id);\r\n        if (selectedRestaurants.length > 0) {\r\n          const associations = selectedRestaurants.map(restaurantId => ({\r\n            activity_id: activity.id,\r\n            restaurant_id: restaurantId\r\n          }));\r\n          const {\r\n            error: assocError\r\n          } = await supabase.from(\"activity_restaurants\").insert(associations);\r\n          if (assocError) throw assocError;\r\n        }\r\n        toast.success(t(\"admin.activityUpdated\"));\r\n        setOpen(false);\r\n      } else {\r\n        // Create activity\r\n        const {\r\n          data: newActivity,\r\n          error\r\n        } = await supabase.from(\"activities\").insert([activityData]).select().single();\r\n        if (error) throw error;\r\n\r\n        // Add restaurant associations\r\n        if (selectedRestaurants.length > 0) {\r\n          const associations = selectedRestaurants.map(restaurantId => ({\r\n            activity_id: newActivity.id,\r\n            restaurant_id: restaurantId\r\n          }));\r\n          const {\r\n            error: assocError\r\n          } = await supabase.from(\"activity_restaurants\").insert(associations);\r\n          if (assocError) throw assocError;\r\n        }\r\n\r\n        // Auto-link coupon templates with auto_link_activities enabled\r\n        const { data: autoLinkTemplates } = await supabase\r\n          .from(\"coupon_templates\")\r\n          .select(\"id\")\r\n          .eq(\"auto_link_activities\", true)\r\n          .eq(\"is_active\", true);\r\n\r\n        if (autoLinkTemplates && autoLinkTemplates.length > 0) {\r\n          const couponAssociations = autoLinkTemplates.map(template => ({\r\n            coupon_template_id: template.id,\r\n            activity_id: newActivity.id\r\n          }));\r\n          await supabase\r\n            .from(\"coupon_template_activities\")\r\n            .insert(couponAssociations);\r\n        }\r\n\r\n        toast.success(t(\"admin.activityCreated\"));\r\n        setOpen(false);\r\n      }\r\n      queryClient.invalidateQueries({\r\n        queryKey: [\"activities\"]\r\n      });\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"common.error\"));\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n  return <Dialog open={open} onOpenChange={handleOpenChange}>\r\n      <DialogTrigger asChild>{trigger}</DialogTrigger>\r\n      <DialogContent className=\"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0\">\r\n        <DialogHeader className=\"px-6 pt-6 pb-4 border-b bg-muted/30\">\r\n          <DialogTitle className=\"text-2xl flex items-center gap-2\">\r\n            <Globe className=\"w-6 h-6 text-primary\" />\r\n            {activity ? t(\"admin.editActivity\") : t(\"admin.addActivity\")}\r\n          </DialogTitle>\r\n          <DialogDescription className=\"text-base\">\r\n            {activity ? t(\"admin.editActivityDetails\") : t(\"admin.createActivityWithContent\")}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"px-6 h-[calc(95vh-220px)]\">\r\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6 py-6\">\r\n            {/* Media Upload */}\r\n            <Card className=\"border-primary/20 bg-gradient-to-br from-background to-muted/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Upload className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.activityMedia\") || \"Ê¥ªÂä®Â™í‰Ωì\"}\r\n                </Label>\r\n                \r\n                {/* Media Type Selector */}\r\n                <div className=\"flex gap-2 mb-4\">\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant={mediaType === \"image\" ? \"default\" : \"outline\"}\r\n                    size=\"sm\"\r\n                    onClick={() => setMediaType(\"image\")}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <Image className=\"w-4 h-4\" />\r\n                    {t(\"admin.image\") || \"ÂõæÁâá\"}\r\n                  </Button>\r\n                  <Button\r\n                    type=\"button\"\r\n                    variant={mediaType === \"video\" ? \"default\" : \"outline\"}\r\n                    size=\"sm\"\r\n                    onClick={() => setMediaType(\"video\")}\r\n                    className=\"flex items-center gap-2\"\r\n                  >\r\n                    <Video className=\"w-4 h-4\" />\r\n                    {t(\"admin.video\") || \"ËßÜÈ¢ë\"}\r\n                  </Button>\r\n                </div>\r\n\r\n                {/* Image Upload */}\r\n                {mediaType === \"image\" && (\r\n                  <div className=\"flex items-center gap-6\">\r\n                    {imagePreview && (\r\n                      <div className=\"relative group\">\r\n                        <img src={imagePreview} alt=\"Preview\" className=\"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105\" />\r\n                        <Button type=\"button\" variant=\"destructive\" size=\"icon\" className=\"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\" onClick={() => {\r\n                          setImageFile(null);\r\n                          setImagePreview(null);\r\n                        }}>\r\n                          <X className=\"h-4 w-4\" />\r\n                        </Button>\r\n                      </div>\r\n                    )}\r\n                    <Label htmlFor=\"image-upload\" className=\"cursor-pointer\">\r\n                      <div className=\"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                        <Upload className=\"h-8 w-8 text-primary\" />\r\n                        <div className=\"text-center\">\r\n                          <p className=\"font-medium text-sm\">{t(\"admin.uploadImage\")}</p>\r\n                          <p className=\"text-xs text-muted-foreground mt-1\">{t(\"admin.imageMaxSize\")}</p>\r\n                        </div>\r\n                      </div>\r\n                      <Input id=\"image-upload\" type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={handleImageChange} />\r\n                    </Label>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Video Upload */}\r\n                {mediaType === \"video\" && (\r\n                  <div className=\"space-y-4\">\r\n                    <div className=\"flex items-center gap-6\">\r\n                      {videoPreview && (\r\n                        <div className=\"relative group\">\r\n                          <video \r\n                            src={videoPreview} \r\n                            className=\"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20\"\r\n                            muted\r\n                            loop\r\n                            playsInline\r\n                            onMouseEnter={(e) => e.currentTarget.play()}\r\n                            onMouseLeave={(e) => {\r\n                              e.currentTarget.pause();\r\n                              e.currentTarget.currentTime = 0;\r\n                            }}\r\n                          />\r\n                          <Button type=\"button\" variant=\"destructive\" size=\"icon\" className=\"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\" onClick={() => {\r\n                            setVideoFile(null);\r\n                            setVideoPreview(null);\r\n                            setVideoDeleted(true);\r\n                          }}>\r\n                            <X className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                      <Label htmlFor=\"video-upload\" className=\"cursor-pointer\">\r\n                        <div className=\"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200\">\r\n                          <Video className=\"h-8 w-8 text-primary\" />\r\n                          <div className=\"text-center\">\r\n                            <p className=\"font-medium text-sm\">{t(\"admin.uploadVideo\") || \"‰∏ä‰º†ËßÜÈ¢ë\"}</p>\r\n                            <p className=\"text-xs text-muted-foreground mt-1\">{t(\"admin.videoMaxSize\") || \"ÊúÄÂ§ß 50MB\"}</p>\r\n                          </div>\r\n                        </div>\r\n                        <Input id=\"video-upload\" type=\"file\" accept=\"video/*\" className=\"hidden\" onChange={handleVideoChange} />\r\n                      </Label>\r\n                    </div>\r\n                    \r\n                    {/* Fallback Image for Video */}\r\n                    <div className=\"pt-4 border-t\">\r\n                      <Label className=\"text-sm font-medium mb-2 block\">{t(\"admin.fallbackImage\") || \"Â∞ÅÈù¢ÂõæÁâáÔºàÂèØÈÄâÔºâ\"}</Label>\r\n                      <p className=\"text-xs text-muted-foreground mb-3\">{t(\"admin.fallbackImageDesc\") || \"ËßÜÈ¢ëÂä†ËΩΩÂâçÊòæÁ§∫ÁöÑÂ∞ÅÈù¢Âõæ\"}</p>\r\n                      <div className=\"flex items-center gap-4\">\r\n                        {imagePreview && (\r\n                          <div className=\"relative group\">\r\n                            <img src={imagePreview} alt=\"Fallback\" className=\"w-20 h-20 object-cover rounded-lg shadow ring-2 ring-primary/20\" />\r\n                            <Button type=\"button\" variant=\"destructive\" size=\"icon\" className=\"absolute -top-1 -right-1 h-6 w-6 shadow opacity-0 group-hover:opacity-100 transition-opacity\" onClick={() => {\r\n                              setImageFile(null);\r\n                              setImagePreview(null);\r\n                            }}>\r\n                              <X className=\"h-3 w-3\" />\r\n                            </Button>\r\n                          </div>\r\n                        )}\r\n                        <Label htmlFor=\"fallback-image-upload\" className=\"cursor-pointer\">\r\n                          <div className=\"flex items-center gap-2 px-4 py-2 border border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all text-sm\">\r\n                            <Image className=\"h-4 w-4 text-primary\" />\r\n                            <span>{t(\"admin.uploadFallback\") || \"‰∏ä‰º†Â∞ÅÈù¢\"}</span>\r\n                          </div>\r\n                          <Input id=\"fallback-image-upload\" type=\"file\" accept=\"image/*\" className=\"hidden\" onChange={handleImageChange} />\r\n                        </Label>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Multi-language Content with Tabs */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Globe className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.multilingualContent\")}\r\n                </Label>\r\n                <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-3 mb-6\">\r\n                    <TabsTrigger value=\"zh\" className=\"gap-2\">\r\n                      üá®üá≥ {t(\"admin.chinese\")}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"en\" className=\"gap-2\">\r\n                      üá¨üáß {t(\"admin.english\")}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"pt\" className=\"gap-2\">\r\n                      üáµüáπ {t(\"admin.portuguese\")}\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"zh\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"title_zh\" className=\"text-sm font-medium\">{t(\"admin.title\")}</Label>\r\n                      <Input id=\"title_zh\" {...register(\"title_zh\")} placeholder={t(\"admin.enterTitle\")} className=\"text-base\" />\r\n                      {errors.title_zh && <p className=\"text-sm text-destructive\">{errors.title_zh.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"intro_zh\" className=\"text-sm font-medium\">Ê¥ªÂä®ÁÆÄ‰ªã</Label>\r\n                      <Input id=\"intro_zh\" {...register(\"intro_zh\")} placeholder=\"ÁÆÄÁü≠ÊèèËø∞Ê¥ªÂä®ÔºàÊòæÁ§∫Âú®È§êÂéÖËØ¶ÊÉÖÈ°µÔºâ\" className=\"text-base\" />\r\n                      <p className=\"text-xs text-muted-foreground\">Âú®È§êÂéÖËØ¶ÊÉÖÈ°µÊ¥ªÂä®Ê†áÁ≠æÂêéÊòæÁ§∫ÁöÑÁÆÄÁü≠ËØ¥Êòé</p>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"content_zh\" className=\"text-sm font-medium\">{t(\"admin.content\")}</Label>\r\n                      <Controller name=\"content_zh\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value} onChange={field.onChange} placeholder={t(\"admin.enterContent\")} />} />\r\n                      {errors.content_zh && <p className=\"text-sm text-destructive\">{errors.content_zh.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"usage_instructions_zh\" className=\"text-sm font-medium\">Ê¥ªÂä®‰ΩøÁî®ÊñπÊ≥ï</Label>\r\n                      <Controller name=\"usage_instructions_zh\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value || \"\"} onChange={field.onChange} placeholder=\"ÊèèËø∞Â¶Ç‰Ωï‰ΩøÁî®Ê≠§Ê¥ªÂä®ÔºàÂèØÈÄâÔºâ\" />} />\r\n                      <p className=\"text-xs text-muted-foreground\">ÂêëÁî®Êà∑ËØ¥ÊòéÂ¶Ç‰ΩïÂèÇ‰∏éÂíå‰ΩøÁî®Ê≠§Ê¥ªÂä®</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"en\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"title_en\" className=\"text-sm font-medium\">{t(\"admin.title\")}</Label>\r\n                      <Input id=\"title_en\" {...register(\"title_en\")} placeholder={t(\"admin.enterTitle\")} className=\"text-base\" />\r\n                      {errors.title_en && <p className=\"text-sm text-destructive\">{errors.title_en.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"intro_en\" className=\"text-sm font-medium\">Activity Brief</Label>\r\n                      <Input id=\"intro_en\" {...register(\"intro_en\")} placeholder=\"Short description (shown on restaurant details)\" className=\"text-base\" />\r\n                      <p className=\"text-xs text-muted-foreground\">Brief description shown after activity badge on restaurant page</p>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"content_en\" className=\"text-sm font-medium\">{t(\"admin.content\")}</Label>\r\n                      <Controller name=\"content_en\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value} onChange={field.onChange} placeholder={t(\"admin.enterContent\")} />} />\r\n                      {errors.content_en && <p className=\"text-sm text-destructive\">{errors.content_en.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"usage_instructions_en\" className=\"text-sm font-medium\">Usage Instructions</Label>\r\n                      <Controller name=\"usage_instructions_en\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value || \"\"} onChange={field.onChange} placeholder=\"Describe how to use this activity (optional)\" />} />\r\n                      <p className=\"text-xs text-muted-foreground\">Explain to users how to participate and use this activity</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"pt\" className=\"space-y-4 mt-0\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"title_pt\" className=\"text-sm font-medium\">{t(\"admin.title\")}</Label>\r\n                      <Input id=\"title_pt\" {...register(\"title_pt\")} placeholder={t(\"admin.enterTitle\")} className=\"text-base\" />\r\n                      {errors.title_pt && <p className=\"text-sm text-destructive\">{errors.title_pt.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"intro_pt\" className=\"text-sm font-medium\">Resumo da Atividade</Label>\r\n                      <Input id=\"intro_pt\" {...register(\"intro_pt\")} placeholder=\"Descri√ß√£o curta (exibida nos detalhes do restaurante)\" className=\"text-base\" />\r\n                      <p className=\"text-xs text-muted-foreground\">Breve descri√ß√£o exibida ap√≥s o distintivo da atividade na p√°gina do restaurante</p>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"content_pt\" className=\"text-sm font-medium\">{t(\"admin.content\")}</Label>\r\n                      <Controller name=\"content_pt\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value} onChange={field.onChange} placeholder={t(\"admin.enterContent\")} />} />\r\n                      {errors.content_pt && <p className=\"text-sm text-destructive\">{errors.content_pt.message}</p>}\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"usage_instructions_pt\" className=\"text-sm font-medium\">Instru√ß√µes de Uso</Label>\r\n                      <Controller name=\"usage_instructions_pt\" control={control} render={({\r\n                      field\r\n                    }) => <RichTextEditor value={field.value || \"\"} onChange={field.onChange} placeholder=\"Descreva como usar esta atividade (opcional)\" />} />\r\n                      <p className=\"text-xs text-muted-foreground\">Explique aos usu√°rios como participar e usar esta atividade</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                </Tabs>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Date Range and Settings */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6 space-y-6\">\r\n                <div>\r\n                  <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                    <CalendarIcon className=\"w-5 h-5 text-primary\" />\r\n                    {t(\"admin.dateSettings\")}\r\n                  </Label>\r\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">{t(\"admin.startDate\")}</Label>\r\n                      <Popover>\r\n                        <PopoverTrigger asChild>\r\n                          <Button variant=\"outline\" className={cn(\"w-full justify-start text-left font-normal h-11\", !startDate && \"text-muted-foreground\")}>\r\n                            <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                            {startDate ? format(startDate, \"PPP\") : <span>{t(\"admin.selectDate\")}</span>}\r\n                          </Button>\r\n                        </PopoverTrigger>\r\n                        <PopoverContent className=\"w-auto p-0 z-[100]\" align=\"start\">\r\n                          <Calendar mode=\"single\" selected={startDate} onSelect={date => setValue(\"start_date\", date as Date)} initialFocus className=\"pointer-events-auto\" />\r\n                        </PopoverContent>\r\n                      </Popover>\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">{t(\"admin.endDate\")}</Label>\r\n                      <Popover>\r\n                        <PopoverTrigger asChild>\r\n                          <Button variant=\"outline\" className={cn(\"w-full justify-start text-left font-normal h-11\", !endDate && \"text-muted-foreground\")}>\r\n                            <CalendarIcon className=\"mr-2 h-4 w-4\" />\r\n                            {endDate ? format(endDate, \"PPP\") : <span>{t(\"admin.selectDate\")} ({t(\"admin.optional\")})</span>}\r\n                          </Button>\r\n                        </PopoverTrigger>\r\n                        <PopoverContent className=\"w-auto p-0 z-[100]\" align=\"start\">\r\n                          <Calendar mode=\"single\" selected={endDate} onSelect={date => setValue(\"end_date\", date)} initialFocus className=\"pointer-events-auto\" />\r\n                        </PopoverContent>\r\n                      </Popover>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"repeat_mode\" className=\"text-sm font-medium\">{t(\"admin.repeatMode\")}</Label>\r\n                  <Select onValueChange={value => setValue(\"repeat_mode\", value as any)} defaultValue={watch(\"repeat_mode\")}>\r\n                    <SelectTrigger className=\"h-11\">\r\n                      <SelectValue placeholder={t(\"admin.selectRepeatMode\")} />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"none\">{t(\"admin.repeatNone\")}</SelectItem>\r\n                      <SelectItem value=\"daily\">{t(\"admin.repeatDaily\")}</SelectItem>\r\n                      <SelectItem value=\"weekly\">{t(\"admin.repeatWeekly\")}</SelectItem>\r\n                      <SelectItem value=\"monthly\">{t(\"admin.repeatMonthly\")}</SelectItem>\r\n                      <SelectItem value=\"yearly\">{t(\"admin.repeatYearly\")}</SelectItem>\r\n                      <SelectItem value=\"days_before\">{t(\"admin.repeatDaysBefore\")}</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n                \r\n                {/* Weekday selector for weekly repeat mode */}\r\n                {watch(\"repeat_mode\") === \"weekly\" && (\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"repeat_weekday\" className=\"text-sm font-medium\">\r\n                      ÊØèÂë®ÈáçÂ§çÊó• / Weekly on\r\n                    </Label>\r\n                    <Controller\r\n                      name=\"repeat_weekday\"\r\n                      control={control}\r\n                      render={({ field }) => (\r\n                        <Select \r\n                          value={field.value?.toString() || \"\"} \r\n                          onValueChange={(value) => field.onChange(value ? parseInt(value) : null)}\r\n                        >\r\n                          <SelectTrigger className=\"h-11\">\r\n                            <SelectValue placeholder=\"ÈÄâÊã©ÊòüÊúüÂá† / Select day\" />\r\n                          </SelectTrigger>\r\n                          <SelectContent>\r\n                            <SelectItem value=\"1\">Âë®‰∏Ä / Monday</SelectItem>\r\n                            <SelectItem value=\"2\">Âë®‰∫å / Tuesday</SelectItem>\r\n                            <SelectItem value=\"3\">Âë®‰∏â / Wednesday</SelectItem>\r\n                            <SelectItem value=\"4\">Âë®Âõõ / Thursday</SelectItem>\r\n                            <SelectItem value=\"5\">Âë®‰∫î / Friday</SelectItem>\r\n                            <SelectItem value=\"6\">Âë®ÂÖ≠ / Saturday</SelectItem>\r\n                            <SelectItem value=\"0\">Âë®Êó• / Sunday</SelectItem>\r\n                          </SelectContent>\r\n                        </Select>\r\n                      )}\r\n                    />\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      ÈÄâÊã©Ê¥ªÂä®ÊØèÂë®ÁîüÊïàÁöÑÊó•Êúü / Select which day this activity is valid each week\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Days before selector for days_before repeat mode */}\r\n                {watch(\"repeat_mode\") === \"days_before\" && (\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"repeat_days_before\" className=\"text-sm font-medium\">\r\n                      {t(\"admin.daysBeforeLabel\")}\r\n                    </Label>\r\n                    <Controller\r\n                      name=\"repeat_days_before\"\r\n                      control={control}\r\n                      render={({ field }) => (\r\n                        <Input\r\n                          type=\"number\"\r\n                          min={1}\r\n                          max={30}\r\n                          className=\"h-11\"\r\n                          placeholder={t(\"admin.daysBeforePlaceholder\")}\r\n                          value={field.value ?? \"\"}\r\n                          onChange={(e) => field.onChange(e.target.value ? parseInt(e.target.value) : null)}\r\n                        />\r\n                      )}\r\n                    />\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {t(\"admin.daysBeforeHint\")}\r\n                    </p>\r\n                  </div>\r\n                )}\r\n\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"service_type\" className=\"text-sm font-medium\">{t(\"admin.serviceType\")}</Label>\r\n                  <Select onValueChange={value => setValue(\"service_type\", value as any)} defaultValue={watch(\"service_type\")}>\r\n                    <SelectTrigger className=\"h-11\">\r\n                      <SelectValue placeholder={t(\"admin.selectServiceType\")} />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"dine_in\">{t(\"activities.serviceType.dine_in\")}</SelectItem>\r\n                      <SelectItem value=\"takeaway\">{t(\"activities.serviceType.takeaway\")}</SelectItem>\r\n                      <SelectItem value=\"both\">{t(\"activities.serviceType.both\")}</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n                  {/* Status Selector */}\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-sm font-medium flex items-center gap-2\">\r\n                      {watch(\"status\") === \"draft\" ? (\r\n                        <FileEdit className=\"w-4 h-4 text-yellow-500\" />\r\n                      ) : (\r\n                        <Send className=\"w-4 h-4 text-green-500\" />\r\n                      )}\r\n                      Ê¥ªÂä®Áä∂ÊÄÅ\r\n                    </Label>\r\n                    <Select onValueChange={value => setValue(\"status\", value as \"draft\" | \"published\")} value={status || \"draft\"}>\r\n                      <SelectTrigger className=\"h-11\">\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"draft\">\r\n                          <span className=\"flex items-center gap-2\">\r\n                            <FileEdit className=\"w-4 h-4 text-yellow-500\" />\r\n                            ËçâÁ®ø\r\n                          </span>\r\n                        </SelectItem>\r\n                        <SelectItem value=\"published\">\r\n                          <span className=\"flex items-center gap-2\">\r\n                            <Send className=\"w-4 h-4 text-green-500\" />\r\n                            Â∑≤ÂèëÂ∏É\r\n                          </span>\r\n                        </SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {status === \"draft\" \r\n                        ? \"ËçâÁ®øÁä∂ÊÄÅÔºöÊó†ÂøÖÂ°´È°πÔºå‰∏çÊòæÁ§∫Âú®ÂâçÁ´ØÔºåÈ§êÂéÖ‰∏ç‰ºöÊî∂Âà∞ÈÄöÁü•\" \r\n                        : \"ÂèëÂ∏ÉÊó∂Â∞ÜÈ™åËØÅÂøÖÂ°´È°π\"}\r\n                    </p>\r\n                  </div>\r\n\r\n                  <div className={cn(\r\n                    \"flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end\",\r\n                    status === \"draft\" ? \"opacity-50 cursor-not-allowed bg-muted/30\" : \"hover:bg-muted/50\"\r\n                  )}>\r\n                    <Checkbox \r\n                      id=\"pinned\" \r\n                      checked={pinned} \r\n                      onCheckedChange={(checked) => setValue(\"pinned\", checked === true)} \r\n                      className=\"data-[state=checked]:bg-primary\"\r\n                      disabled={status === \"draft\"}\r\n                    />\r\n                    <Label htmlFor=\"pinned\" className={cn(\r\n                      \"flex items-center gap-2 text-sm font-medium\",\r\n                      status === \"draft\" ? \"cursor-not-allowed\" : \"cursor-pointer\"\r\n                    )}>\r\n                      <Pin className=\"w-4 h-4 text-primary\" />\r\n                      {t(\"admin.pinToTop\")}\r\n                    </Label>\r\n                  </div>\r\n                  <div className={cn(\r\n                    \"flex items-center space-x-3 p-4 border rounded-lg transition-colors h-fit self-end\",\r\n                    status === \"draft\" ? \"opacity-50 cursor-not-allowed bg-muted/30\" : \"hover:bg-muted/50\"\r\n                  )}>\r\n                    <Checkbox \r\n                      id=\"visible\" \r\n                      checked={visible} \r\n                      onCheckedChange={(checked) => setValue(\"visible\", checked === true)} \r\n                      className=\"data-[state=checked]:bg-primary\"\r\n                      disabled={status === \"draft\"}\r\n                    />\r\n                    <Label htmlFor=\"visible\" className={cn(\r\n                      \"flex items-center gap-2 text-sm font-medium\",\r\n                      status === \"draft\" ? \"cursor-not-allowed\" : \"cursor-pointer\"\r\n                    )}>\r\n                      <Globe className=\"w-4 h-4 text-primary\" />\r\n                      ÊòæÁ§∫Ê¥ªÂä®\r\n                      {status === \"draft\" && <span className=\"text-xs text-muted-foreground\">(ËçâÁ®øÈªòËÆ§ÂÖ≥Èó≠)</span>}\r\n                    </Label>\r\n                  </div>\r\n                  <div className=\"space-y-2\">\r\n                    <Label htmlFor=\"sort_order\" className=\"text-sm font-medium flex items-center gap-2\">\r\n                      <ArrowUpDown className=\"w-4 h-4 text-primary\" />\r\n                      {t(\"admin.sortOrder\")}\r\n                    </Label>\r\n                    <Input id=\"sort_order\" type=\"number\" {...register(\"sort_order\", {\r\n                    valueAsNumber: true\r\n                  })} className=\"h-11\" placeholder=\"0\" />\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Badge Display Settings */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Badge className=\"w-5 h-5 text-primary\" />\r\n                  ÊòæÁ§∫ÂæΩÁ´†ËÆæÁΩÆ\r\n                </Label>\r\n                <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-3 mb-4\">\r\n                    <TabsTrigger value=\"zh\">üá®üá≥ ‰∏≠Êñá</TabsTrigger>\r\n                    <TabsTrigger value=\"en\">üá¨üáß English</TabsTrigger>\r\n                    <TabsTrigger value=\"pt\">üáµüáπ Portugu√™s</TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"zh\" className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"badge_text_zh\" className=\"text-sm\">ÂæΩÁ´†ÊñáÂ≠ó (‰∏≠Êñá) <span className=\"text-destructive\">*</span></Label>\r\n                      <Input id=\"badge_text_zh\" {...register(\"badge_text_zh\")} placeholder=\"‰æãÂ¶Ç: Á≤â‰∏ùËäÇ\" />\r\n                      {errors.badge_text_zh && <p className=\"text-sm text-destructive\">{errors.badge_text_zh.message}</p>}\r\n                      <p className=\"text-xs text-muted-foreground\">ÂæΩÁ´†ÊñáÂ≠óÊòæÁ§∫Âú®È§êÂéÖËØ¶ÊÉÖÂíåÊ¥ªÂä®ÂàóË°®‰∏≠ÔºåÂª∫ËÆÆÁÆÄÊ¥ÅÊòé‰∫Ü</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"en\" className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"badge_text_en\" className=\"text-sm\">Badge Text (English) <span className=\"text-destructive\">*</span></Label>\r\n                      <Input id=\"badge_text_en\" {...register(\"badge_text_en\")} placeholder=\"e.g. Fan Festival\" />\r\n                      {errors.badge_text_en && <p className=\"text-sm text-destructive\">{errors.badge_text_en.message}</p>}\r\n                      <p className=\"text-xs text-muted-foreground\">Badge text shown on restaurant details and activity list, keep it concise</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"pt\" className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"badge_text_pt\" className=\"text-sm\">Texto do Distintivo (Portugu√™s) <span className=\"text-destructive\">*</span></Label>\r\n                      <Input id=\"badge_text_pt\" {...register(\"badge_text_pt\")} placeholder=\"ex: Festival dos F√£s\" />\r\n                      {errors.badge_text_pt && <p className=\"text-sm text-destructive\">{errors.badge_text_pt.message}</p>}\r\n                      <p className=\"text-xs text-muted-foreground\">Texto do emblema exibido nos detalhes do restaurante e na lista de atividades, mantenha-o conciso</p>\r\n                    </div>\r\n                  </TabsContent>\r\n                </Tabs>\r\n                \r\n                <div className=\"space-y-2 mt-4\">\r\n                  <Label htmlFor=\"badge_color\" className=\"text-sm\">ÂæΩÁ´†È¢úËâ≤ / Badge Color</Label>\r\n                  <Controller name=\"badge_color\" control={control} render={({\r\n                  field\r\n                }) => <div className=\"flex items-center gap-3\">\r\n                        <Input id=\"badge_color\" type=\"color\" value={field.value || \"#9b87f5\"} onChange={e => field.onChange(e.target.value)} className=\"w-20 h-11 cursor-pointer\" />\r\n                        <Input value={field.value || \"#9b87f5\"} onChange={e => field.onChange(e.target.value)} placeholder=\"#9b87f5\" className=\"flex-1\" />\r\n                      </div>} />\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    <span className=\"text-xs text-muted-foreground\">È¢ÑËßà / Preview:</span>\r\n                    <Badge style={{\r\n                    backgroundColor: watch(\"badge_color\") || \"#9b87f5\"\r\n                  }} className=\"text-white\">\r\n                      {watch(\"badge_text_zh\") || watch(\"title_zh\") || \"Á§∫‰æã\"}\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Discount Settings */}\r\n                <div className=\"border-t pt-4 mt-4\">\r\n                  <Label className=\"text-sm font-medium flex items-center gap-2 mb-3\">\r\n                    üí∞ ‰ºòÊÉ†ËÆæÁΩÆ / Discount Settings\r\n                  </Label>\r\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"discount_type\" className=\"text-sm\">ÊäòÊâ£Á±ªÂûã / Discount Type</Label>\r\n                      <Controller \r\n                        name=\"discount_type\" \r\n                        control={control} \r\n                        render={({ field }) => (\r\n                          <Select \r\n                            value={field.value || \"none\"} \r\n                            onValueChange={(value) => field.onChange(value === \"none\" ? null : value)}\r\n                          >\r\n                            <SelectTrigger className=\"h-11\">\r\n                              <SelectValue placeholder=\"ÈÄâÊã©ÊäòÊâ£Á±ªÂûã\" />\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              <SelectItem value=\"none\">Êó†‰ºòÊÉ† / No Discount</SelectItem>\r\n                              <SelectItem value=\"percentage\">ÁôæÂàÜÊØîÊäòÊâ£ / Percentage</SelectItem>\r\n                              <SelectItem value=\"fixed_amount\">Âõ∫ÂÆöÈáëÈ¢ù / Fixed Amount</SelectItem>\r\n                            </SelectContent>\r\n                          </Select>\r\n                        )} \r\n                      />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"discount_value\" className=\"text-sm\">\r\n                        ÊäòÊâ£ÂÄº / Discount Value\r\n                        {watch(\"discount_type\") === \"percentage\" && \" (%)\"}\r\n                        {watch(\"discount_type\") === \"fixed_amount\" && \" (‚Ç¨)\"}\r\n                      </Label>\r\n                      <Input \r\n                        id=\"discount_value\" \r\n                        type=\"number\" \r\n                        step=\"0.01\"\r\n                        {...register(\"discount_value\", { valueAsNumber: true })} \r\n                        className=\"h-11\" \r\n                        placeholder={watch(\"discount_type\") === \"percentage\" ? \"‰æãÂ¶Ç: 20 (Ë°®Á§∫8Êäò)\" : \"‰æãÂ¶Ç: 5 (Ë°®Á§∫Âáè5‚Ç¨)\"}\r\n                        disabled={!watch(\"discount_type\")}\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        {watch(\"discount_type\") === \"percentage\" \r\n                          ? \"ËæìÂÖ•ÊäòÊâ£ÁôæÂàÜÊØîÔºåÂ¶Ç 20 Ë°®Á§∫Êâì8ÊäòÔºàÂáè20%Ôºâ\" \r\n                          : watch(\"discount_type\") === \"fixed_amount\"\r\n                          ? \"ËæìÂÖ•Âõ∫ÂÆöÂáèÂÖçÈáëÈ¢ùÔºàÊ¨ßÂÖÉÔºâ\"\r\n                          : \"ÂÖàÈÄâÊã©ÊäòÊâ£Á±ªÂûã\"}\r\n                      </p>\r\n                    </div>\r\n                    \r\n                    {/* Discount Key */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label htmlFor=\"discount_key\" className=\"text-sm\">ÊäòÊâ£Ê†áËØÜ / Discount Key</Label>\r\n                      <Input \r\n                        id=\"discount_key\"\r\n                        type=\"text\"\r\n                        {...register(\"discount_key\")} \r\n                        className=\"h-11\" \r\n                        placeholder=\"‰æãÂ¶Ç: SUMMER2025, VIP_DISCOUNT\"\r\n                        disabled={!watch(\"discount_type\")}\r\n                      />\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        Áî®‰∫éÂ§ñÈÉ®Á≥ªÁªüËØÜÂà´ÁöÑÊäòÊâ£Ê†áËØÜÁ¨¶\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Associated Restaurants */}\r\n            <Card className=\"border-primary/20\">\r\n              <CardContent className=\"p-6\">\r\n                <Label className=\"text-base font-semibold flex items-center gap-2 mb-4\">\r\n                  <Store className=\"w-5 h-5 text-primary\" />\r\n                  {t(\"admin.associatedRestaurants\")}\r\n                </Label>\r\n                <ScrollArea className=\"h-64 border rounded-lg p-4 bg-muted/20\">\r\n                  <div className=\"space-y-2\">\r\n                    {restaurants?.map(restaurant => <div key={restaurant.id} className=\"flex items-center space-x-3 p-3 rounded-md hover:bg-background transition-colors border border-transparent hover:border-primary/30\">\r\n                        <Checkbox id={restaurant.id} checked={selectedRestaurants.includes(restaurant.id)} onCheckedChange={checked => {\r\n                      if (checked) {\r\n                        setSelectedRestaurants([...selectedRestaurants, restaurant.id]);\r\n                      } else {\r\n                        setSelectedRestaurants(selectedRestaurants.filter(id => id !== restaurant.id));\r\n                      }\r\n                    }} className=\"data-[state=checked]:bg-primary\" />\r\n                        <Label htmlFor={restaurant.id} className=\"cursor-pointer flex-1 font-normal\">\r\n                          {restaurant.name}\r\n                        </Label>\r\n                        {selectedRestaurants.includes(restaurant.id) && <Badge variant=\"secondary\" className=\"text-xs\">Â∑≤ÈÄâ</Badge>}\r\n                      </div>)}\r\n                  </div>\r\n                </ScrollArea>\r\n                <p className=\"text-xs text-muted-foreground mt-2\">\r\n                  Â∑≤ÈÄâÊã© {selectedRestaurants.length} ‰∏™È§êÂéÖ\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Submit Buttons */}\r\n            <div className=\"flex justify-end gap-3 pt-4 border-t sticky bottom-0 bg-background pb-[16px]\">\r\n              <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)} className=\"min-w-[100px]\">\r\n                {t(\"common.cancel\")}\r\n              </Button>\r\n              <Button type=\"submit\" disabled={isSubmitting} className=\"min-w-[100px] bg-primary hover:bg-primary/90\">\r\n                {isSubmitting ? <>\r\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\" />\r\n                    {t(\"common.saving\")}\r\n                  </> : t(\"common.save\")}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </ScrollArea>\r\n\r\n        {/* Image Crop Dialog */}\r\n        {tempImageFile && (\r\n          <ImageCropDialog\r\n            open={showCropDialog}\r\n            onOpenChange={setShowCropDialog}\r\n            imageFile={tempImageFile}\r\n            onCropComplete={handleCropComplete}\r\n          />\r\n        )}\r\n      </DialogContent>\r\n    </Dialog>;\r\n}","import { useState, useEffect } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useActivityRules, useUpdateActivityRules } from \"@/hooks/useActivityRules\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Loader2, FileText, Save } from \"lucide-react\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { RichTextEditor } from \"./RichTextEditor\";\r\n\r\ninterface ActivityRulesEditorDialogProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst ActivityRulesEditorDialog = ({ children }: ActivityRulesEditorDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { data: rules, isLoading } = useActivityRules();\r\n  const updateRules = useUpdateActivityRules();\r\n  const [open, setOpen] = useState(false);\r\n  const [activeTab, setActiveTab] = useState(\"zh\");\r\n  \r\n  const [contentZh, setContentZh] = useState(\"\");\r\n  const [contentEn, setContentEn] = useState(\"\");\r\n  const [contentPt, setContentPt] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (rules) {\r\n      setContentZh(rules.content_zh);\r\n      setContentEn(rules.content_en);\r\n      setContentPt(rules.content_pt);\r\n    }\r\n  }, [rules]);\r\n\r\n  const handleSave = async () => {\r\n    if (!rules) return;\r\n    \r\n    try {\r\n      await updateRules.mutateAsync({\r\n        id: rules.id,\r\n        content_zh: contentZh,\r\n        content_en: contentEn,\r\n        content_pt: contentPt,\r\n      });\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: \"Ê¥ªÂä®Êù°‰æãÂ∑≤Êõ¥Êñ∞\",\r\n      });\r\n      setOpen(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: \"Êõ¥Êñ∞Â§±Ë¥•\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {children}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <FileText className=\"w-5 h-5\" />\r\n            ÁºñËæëÊ¥ªÂä®Êù°‰æã\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        {isLoading ? (\r\n          <div className=\"flex justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n              <TabsList className=\"grid w-full grid-cols-3\">\r\n                <TabsTrigger value=\"zh\">‰∏≠Êñá</TabsTrigger>\r\n                <TabsTrigger value=\"en\">English</TabsTrigger>\r\n                <TabsTrigger value=\"pt\">Portugu√™s</TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"zh\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentZh}\r\n                  onChange={setContentZh}\r\n                  placeholder=\"ËØ∑ËæìÂÖ•‰∏≠ÊñáÊ¥ªÂä®Êù°‰æãÂÜÖÂÆπ...\"\r\n                />\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"en\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentEn}\r\n                  onChange={setContentEn}\r\n                  placeholder=\"Enter English activity rules...\"\r\n                />\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"pt\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentPt}\r\n                  onChange={setContentPt}\r\n                  placeholder=\"Digite as regras da atividade em portugu√™s...\"\r\n                />\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        )}\r\n        \r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button onClick={handleSave} disabled={updateRules.isPending}>\r\n            {updateRules.isPending ? (\r\n              <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n            ) : (\r\n              <Save className=\"w-4 h-4 mr-2\" />\r\n            )}\r\n            {t(\"common.save\")}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ActivityRulesEditorDialog;\r\n","import { useState, useEffect } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { useGlobalHandbook, useUpdateGlobalHandbook } from \"@/hooks/useGlobalHandbook\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Loader2, BookOpen, Save } from \"lucide-react\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { RichTextEditor } from \"./RichTextEditor\";\r\n\r\ninterface GlobalHandbookEditorDialogProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst GlobalHandbookEditorDialog = ({ children }: GlobalHandbookEditorDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { data: handbook, isLoading } = useGlobalHandbook();\r\n  const updateHandbook = useUpdateGlobalHandbook();\r\n  const [open, setOpen] = useState(false);\r\n  const [activeTab, setActiveTab] = useState(\"zh\");\r\n  \r\n  const [contentZh, setContentZh] = useState(\"\");\r\n  const [contentEn, setContentEn] = useState(\"\");\r\n  const [contentPt, setContentPt] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    if (handbook) {\r\n      setContentZh(handbook.content_zh);\r\n      setContentEn(handbook.content_en);\r\n      setContentPt(handbook.content_pt);\r\n    }\r\n  }, [handbook]);\r\n\r\n  const handleSave = async () => {\r\n    if (!handbook) return;\r\n    \r\n    try {\r\n      await updateHandbook.mutateAsync({\r\n        id: handbook.id,\r\n        content_zh: contentZh,\r\n        content_en: contentEn,\r\n        content_pt: contentPt,\r\n      });\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"activities.handbook.updateSuccess\"),\r\n      });\r\n      setOpen(false);\r\n    } catch (error) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"activities.handbook.updateError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {children}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <BookOpen className=\"w-5 h-5\" />\r\n            {t(\"admin.editActivityHandbook\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        {isLoading ? (\r\n          <div className=\"flex justify-center py-8\">\r\n            <Loader2 className=\"w-6 h-6 animate-spin text-primary\" />\r\n          </div>\r\n        ) : (\r\n          <div className=\"space-y-4\">\r\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n              <TabsList className=\"grid w-full grid-cols-3\">\r\n                <TabsTrigger value=\"zh\">‰∏≠Êñá</TabsTrigger>\r\n                <TabsTrigger value=\"en\">English</TabsTrigger>\r\n                <TabsTrigger value=\"pt\">Portugu√™s</TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"zh\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentZh}\r\n                  onChange={setContentZh}\r\n                  placeholder=\"ËØ∑ËæìÂÖ•‰∏≠ÊñáÊ¥ªÂä®ÊâãÂÜåÂÜÖÂÆπ...\"\r\n                />\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"en\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentEn}\r\n                  onChange={setContentEn}\r\n                  placeholder=\"Enter English activity handbook content...\"\r\n                />\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"pt\" className=\"mt-4\">\r\n                <RichTextEditor\r\n                  value={contentPt}\r\n                  onChange={setContentPt}\r\n                  placeholder=\"Digite o conte√∫do do manual da atividade em portugu√™s...\"\r\n                />\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        )}\r\n        \r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={() => setOpen(false)}>\r\n            {t(\"common.cancel\")}\r\n          </Button>\r\n          <Button onClick={handleSave} disabled={updateHandbook.isPending}>\r\n            {updateHandbook.isPending ? (\r\n              <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\r\n            ) : (\r\n              <Save className=\"w-4 h-4 mr-2\" />\r\n            )}\r\n            {t(\"common.save\")}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default GlobalHandbookEditorDialog;\r\n","import { useState, useMemo } from \"react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n  AlertDialogTrigger,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useAdminActivities } from \"@/hooks/useActivities\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useDeleteActivity, useBatchDeleteActivities } from \"@/hooks/useAdmin\";\r\n\r\nimport { ActivityFormDialog } from \"@/components/admin/ActivityFormDialog\";\r\nimport ActivityRulesEditorDialog from \"@/components/admin/ActivityRulesEditorDialog\";\r\nimport GlobalHandbookEditorDialog from \"@/components/admin/GlobalHandbookEditorDialog\";\r\nimport { Calendar, Plus, Download, Trash2, Search, FileText, FileEdit, Send, BarChart3, BookOpen } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\nimport { exportActivitiesToCSV } from \"@/lib/exportUtils\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nconst AdminActivities = () => {\r\n  const { t } = useTranslation();\r\n  const { toast } = useToast();\r\n  const { data: activities, isLoading } = useAdminActivities();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const deleteActivity = useDeleteActivity();\r\n  const batchDeleteActivities = useBatchDeleteActivities();\r\n  const [selectedActivities, setSelectedActivities] = useState<string[]>([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n  const [deleteConfirmText, setDeleteConfirmText] = useState<{ [key: string]: string }>({});\r\n  const [batchDeleteConfirmText, setBatchDeleteConfirmText] = useState(\"\");\r\n\r\n  // Filter activities based on search query and status filter\r\n  const filteredActivities = useMemo(() => {\r\n    if (!activities) return [];\r\n    \r\n    return activities.filter((activity) => {\r\n      const title = String(getLocalizedField(activity, \"title\") || \"\");\r\n      const content = String(getLocalizedField(activity, \"content\") || \"\");\r\n      const matchesSearch = searchQuery === \"\" || \r\n        title.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        content.toLowerCase().includes(searchQuery.toLowerCase());\r\n      \r\n      const now = new Date();\r\n      const startDate = new Date(activity.start_date);\r\n      // If no end_date, activity is ongoing indefinitely\r\n      const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n      const isEnded = endDate ? endDate < now : false;\r\n      const isOngoing = !isEnded && startDate <= now;\r\n      \r\n      const activityStatus = (activity as any).status || \"published\";\r\n      const matchesStatus = \r\n        statusFilter === \"all\" ||\r\n        (statusFilter === \"active\" && isOngoing) ||\r\n        (statusFilter === \"ended\" && isEnded) ||\r\n        (statusFilter === \"pinned\" && activity.pinned) ||\r\n        (statusFilter === \"draft\" && activityStatus === \"draft\") ||\r\n        (statusFilter === \"published\" && activityStatus === \"published\");\r\n      \r\n      return matchesSearch && matchesStatus;\r\n    });\r\n  }, [activities, searchQuery, statusFilter, getLocalizedField]);\r\n\r\n  const handleExport = () => {\r\n    if (!activities || activities.length === 0) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"admin.noDataToExport\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    exportActivitiesToCSV(activities);\r\n    toast({\r\n      title: t(\"common.success\"),\r\n      description: t(\"admin.exportSuccess\"),\r\n    });\r\n  };\r\n\r\n  const toggleSelectActivity = (activityId: string) => {\r\n    setSelectedActivities(prev =>\r\n      prev.includes(activityId)\r\n        ? prev.filter(id => id !== activityId)\r\n        : [...prev, activityId]\r\n    );\r\n  };\r\n\r\n  const toggleSelectAll = () => {\r\n    if (selectedActivities.length === filteredActivities?.length) {\r\n      setSelectedActivities([]);\r\n    } else {\r\n      setSelectedActivities(filteredActivities?.map(a => a.id) || []);\r\n    }\r\n  };\r\n\r\n  const handleBatchDelete = () => {\r\n    if (selectedActivities.length === 0) return;\r\n    batchDeleteActivities.mutate(selectedActivities);\r\n    setSelectedActivities([]);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n        <div className=\"flex flex-col md:flex-row md:items-center justify-between gap-4\">\r\n          <div>\r\n            <h1 className=\"text-2xl md:text-3xl font-bold mb-2\">{t(\"admin.activityManagement\")}</h1>\r\n            <p className=\"text-muted-foreground\">{t(\"admin.manageActivities\")}</p>\r\n          </div>\r\n          <div className=\"flex gap-2 flex-wrap\">\r\n            <GlobalHandbookEditorDialog>\r\n              <Button variant=\"outline\" className=\"flex-1 sm:flex-initial\">\r\n                <BookOpen className=\"mr-2 h-4 w-4\" />\r\n                <span className=\"hidden sm:inline\">{t(\"admin.activityHandbook\")}</span>\r\n              </Button>\r\n            </GlobalHandbookEditorDialog>\r\n            <ActivityRulesEditorDialog>\r\n              <Button variant=\"outline\" className=\"flex-1 sm:flex-initial\">\r\n                <FileText className=\"mr-2 h-4 w-4\" />\r\n                <span className=\"hidden sm:inline\">{t(\"admin.activityRules\")}</span>\r\n              </Button>\r\n            </ActivityRulesEditorDialog>\r\n            <Button variant=\"outline\" onClick={handleExport} className=\"flex-1 sm:flex-initial\">\r\n              <Download className=\"mr-2 h-4 w-4\" />\r\n              <span className=\"hidden sm:inline\">{t(\"admin.exportCSV\")}</span>\r\n            </Button>\r\n            <ActivityFormDialog\r\n              trigger={\r\n                <Button className=\"flex-1 sm:flex-initial\">\r\n                  <Plus className=\"mr-2 h-4 w-4\" />\r\n                  {t(\"admin.addActivity\")}\r\n                </Button>\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Search and Filter */}\r\n        <Card>\r\n          <CardContent className=\"pt-6\">\r\n            <div className=\"flex gap-4 flex-wrap\">\r\n              <div className=\"flex-1 min-w-[200px]\">\r\n                <div className=\"relative\">\r\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                  <Input\r\n                    placeholder={t(\"admin.searchActivities\")}\r\n                    value={searchQuery}\r\n                    onChange={(e) => setSearchQuery(e.target.value)}\r\n                    className=\"pl-9\"\r\n                  />\r\n                </div>\r\n              </div>\r\n              <Select value={statusFilter} onValueChange={setStatusFilter}>\r\n                <SelectTrigger className=\"w-[180px]\">\r\n                  <SelectValue placeholder={t(\"admin.filterByStatus\")} />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">{t(\"admin.allStatus\")}</SelectItem>\r\n                  <SelectItem value=\"draft\">{t(\"admin.statusDraft\")}</SelectItem>\r\n                  <SelectItem value=\"published\">{t(\"admin.statusPublished\")}</SelectItem>\r\n                  <SelectItem value=\"active\">{t(\"admin.statusActive\")}</SelectItem>\r\n                  <SelectItem value=\"ended\">{t(\"admin.statusEnded\")}</SelectItem>\r\n                  <SelectItem value=\"pinned\">{t(\"admin.statusPinned\")}</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* Batch Operations */}\r\n        {selectedActivities.length > 0 && (\r\n          <Card className=\"bg-muted/50\">\r\n            <CardContent className=\"pt-6\">\r\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-4\">\r\n                <span className=\"font-medium\">\r\n                  {t(\"admin.selectedCount\", { count: selectedActivities.length })}\r\n                </span>\r\n\r\n                <div className=\"flex gap-2 flex-wrap w-full sm:w-auto\">\r\n                  <AlertDialog>\r\n                    <AlertDialogTrigger asChild>\r\n                      <Button variant=\"destructive\" size=\"sm\" className=\"flex-1 sm:flex-initial\">\r\n                        <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                        {t(\"admin.batchDelete\")}\r\n                      </Button>\r\n                    </AlertDialogTrigger>\r\n                    <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[425px]\">\r\n                      <AlertDialogHeader>\r\n                        <AlertDialogTitle>{t(\"admin.confirmBatchDelete\")}</AlertDialogTitle>\r\n                        <AlertDialogDescription className=\"space-y-3\">\r\n                          <p>{t(\"admin.batchDeleteWarning\", { count: selectedActivities.length })}</p>\r\n                          <p className=\"font-semibold text-destructive\">\r\n                            {t(\"admin.willDeleteActivities\", { count: selectedActivities.length })}\r\n                          </p>\r\n                          <div className=\"space-y-2\">\r\n                            <p className=\"text-sm\">{t(\"admin.typeDeleteToConfirmBatch\")}</p>\r\n                            <Input\r\n                              value={batchDeleteConfirmText}\r\n                              onChange={(e) => setBatchDeleteConfirmText(e.target.value)}\r\n                              placeholder=\"DELETE\"\r\n                              className=\"font-mono\"\r\n                            />\r\n                          </div>\r\n                        </AlertDialogDescription>\r\n                      </AlertDialogHeader>\r\n                      <AlertDialogFooter>\r\n                        <AlertDialogCancel onClick={() => setBatchDeleteConfirmText(\"\")}>\r\n                          {t(\"common.cancel\")}\r\n                        </AlertDialogCancel>\r\n                        <AlertDialogAction\r\n                          disabled={batchDeleteConfirmText !== \"DELETE\"}\r\n                          onClick={() => {\r\n                            handleBatchDelete();\r\n                            setBatchDeleteConfirmText(\"\");\r\n                          }}\r\n                          className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                        >\r\n                          {t(\"common.delete\")}\r\n                        </AlertDialogAction>\r\n                      </AlertDialogFooter>\r\n                    </AlertDialogContent>\r\n                  </AlertDialog>\r\n\r\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => setSelectedActivities([])} className=\"flex-1 sm:flex-initial\">\r\n                    {t(\"admin.clearSelection\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n\r\n        {/* Select All */}\r\n        <div className=\"flex items-center gap-2 pb-2 border-b\">\r\n          <Checkbox\r\n            checked={selectedActivities.length === filteredActivities?.length && filteredActivities.length > 0}\r\n            onCheckedChange={toggleSelectAll}\r\n          />\r\n          <span className=\"font-medium\">{t(\"admin.selectAll\")}</span>\r\n          <span className=\"text-sm text-muted-foreground ml-2\">\r\n            ({filteredActivities?.length} {t(\"admin.results\")})\r\n          </span>\r\n        </div>\r\n\r\n        <div className=\"grid gap-4\">\r\n          {filteredActivities?.map((activity) => (\r\n            <Card key={activity.id}>\r\n              <div className=\"flex flex-col md:flex-row md:items-center\">\r\n                <div className=\"p-4 flex items-start md:self-start\">\r\n                  <Checkbox\r\n                    checked={selectedActivities.includes(activity.id)}\r\n                    onCheckedChange={() => toggleSelectActivity(activity.id)}\r\n                    className=\"mt-1\"\r\n                  />\r\n                </div>\r\n                {activity.image_url && (\r\n                  <div className=\"w-full md:w-48 h-48 flex items-center justify-center overflow-hidden mx-auto md:mx-0 flex-shrink-0\">\r\n                    <img\r\n                      src={activity.image_url}\r\n                      alt={String(getLocalizedField(activity, \"title\"))}\r\n                      className=\"object-cover w-full h-full\"\r\n                    />\r\n                  </div>\r\n                )}\r\n                <div className=\"flex-1\">\r\n                  <CardHeader>\r\n                    <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-2\">\r\n                      <CardTitle className=\"text-lg md:text-xl\">{getLocalizedField(activity, \"title\")}</CardTitle>\r\n                      <div className=\"flex gap-2 flex-wrap\">\r\n                        {(activity as any).status === \"draft\" ? (\r\n                          <Badge variant=\"outline\" className=\"bg-yellow-500/10 text-yellow-600 border-yellow-500/30\">\r\n                            <FileEdit className=\"w-3 h-3 mr-1\" />\r\n                            ËçâÁ®ø\r\n                          </Badge>\r\n                        ) : (\r\n                          <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-600 border-green-500/30\">\r\n                            <Send className=\"w-3 h-3 mr-1\" />\r\n                            Â∑≤ÂèëÂ∏É\r\n                          </Badge>\r\n                        )}\r\n                        {!activity.visible && <Badge variant=\"secondary\">{t(\"admin.hidden\")}</Badge>}\r\n                        {activity.pinned && <Badge>{t(\"activities.pinned\")}</Badge>}\r\n                        {(() => {\r\n                          const now = new Date();\r\n                          const startDate = new Date(activity.start_date);\r\n                          const endDate = activity.end_date ? new Date(activity.end_date) : null;\r\n                          const isEnded = endDate ? endDate < now : false;\r\n                          const isOngoing = !isEnded && startDate <= now;\r\n                          \r\n                          if (isEnded) {\r\n                            return <Badge variant=\"secondary\">{t(\"activities.ended\")}</Badge>;\r\n                          } else if (isOngoing) {\r\n                            return <Badge>{t(\"activities.ongoing\")}</Badge>;\r\n                          }\r\n                          return null;\r\n                        })()}\r\n                      </div>\r\n                    </div>\r\n                    <CardDescription className=\"line-clamp-2\">\r\n                      <div \r\n                        className=\"prose prose-sm max-w-none\r\n                          [&_p]:inline [&_p]:m-0\r\n                          [&_strong]:font-semibold [&_strong]:text-foreground\r\n                          [&_em]:italic\r\n                          [&_h1]:text-base [&_h2]:text-base [&_h3]:text-base\r\n                          [&_*]:text-muted-foreground\"\r\n                        dangerouslySetInnerHTML={{ __html: getLocalizedField(activity, \"content\") }}\r\n                      />\r\n                    </CardDescription>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"flex items-center gap-4 text-sm text-muted-foreground mb-4 overflow-x-auto\">\r\n                      <div className=\"flex items-center gap-1 whitespace-nowrap\">\r\n                        <Calendar className=\"h-4 w-4 flex-shrink-0\" />\r\n                        <span className=\"text-xs sm:text-sm\">\r\n                          {format(new Date(activity.start_date), \"PPP\")}\r\n                          {activity.end_date &&\r\n                            ` - ${format(new Date(activity.end_date), \"PPP\")}`}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"flex gap-2 flex-wrap\">\r\n                      {(activity as any).status !== \"draft\" && (\r\n                        <Button variant=\"outline\" size=\"sm\" asChild className=\"flex-1 sm:flex-initial\">\r\n                          <Link to={`/admin/activity-stats/${activity.id}`}>\r\n                            <BarChart3 className=\"w-4 h-4 mr-1\" />\r\n                            {t(\"admin.stats\", \"ÁªüËÆ°\")}\r\n                          </Link>\r\n                        </Button>\r\n                      )}\r\n                      <Button variant=\"outline\" size=\"sm\" asChild className=\"flex-1 sm:flex-initial\">\r\n                        <Link to={`/activity/${activity.id}`} state={{ from: \"admin\" }}>{t(\"admin.view\")}</Link>\r\n                      </Button>\r\n                      <ActivityFormDialog\r\n                        activity={activity}\r\n                        trigger={\r\n                          <Button variant=\"outline\" size=\"sm\" className=\"flex-1 sm:flex-initial\">\r\n                            {t(\"common.edit\")}\r\n                          </Button>\r\n                        }\r\n                      />\r\n                      {(activity as any).status === \"draft\" ? (\r\n                        /* Draft activity: simple confirmation */\r\n                        <AlertDialog>\r\n                          <AlertDialogTrigger asChild>\r\n                            <Button variant=\"outline\" size=\"sm\" className=\"flex-1 sm:flex-initial\">\r\n                              {t(\"common.delete\")}\r\n                            </Button>\r\n                          </AlertDialogTrigger>\r\n                          <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[425px]\">\r\n                            <AlertDialogHeader>\r\n                              <AlertDialogTitle>{t(\"admin.confirmDelete\")}</AlertDialogTitle>\r\n                              <AlertDialogDescription>\r\n                                <p>{t(\"admin.deleteActivityWarning\")}</p>\r\n                                <p className=\"font-semibold text-foreground mt-2\">\r\n                                  {getLocalizedField(activity, \"title\")}\r\n                                </p>\r\n                              </AlertDialogDescription>\r\n                            </AlertDialogHeader>\r\n                            <AlertDialogFooter>\r\n                              <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n                              <AlertDialogAction\r\n                                onClick={() => deleteActivity.mutate(activity.id)}\r\n                                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                              >\r\n                                {t(\"common.delete\")}\r\n                              </AlertDialogAction>\r\n                            </AlertDialogFooter>\r\n                          </AlertDialogContent>\r\n                        </AlertDialog>\r\n                      ) : (\r\n                        /* Published activity: strict verification */\r\n                        <AlertDialog>\r\n                          <AlertDialogTrigger asChild>\r\n                            <Button variant=\"outline\" size=\"sm\" className=\"flex-1 sm:flex-initial\">\r\n                              {t(\"common.delete\")}\r\n                            </Button>\r\n                          </AlertDialogTrigger>\r\n                          <AlertDialogContent className=\"max-w-[90vw] sm:max-w-[425px]\">\r\n                            <AlertDialogHeader>\r\n                              <AlertDialogTitle>{t(\"admin.confirmDelete\")}</AlertDialogTitle>\r\n                              <AlertDialogDescription className=\"space-y-3\">\r\n                                <p>{t(\"admin.deleteActivityWarning\")}</p>\r\n                                <p className=\"font-semibold text-foreground\">\r\n                                  {getLocalizedField(activity, \"title\")}\r\n                                </p>\r\n                                <div className=\"space-y-2\">\r\n                                  <p className=\"text-sm\">{t(\"admin.typeDeleteToConfirmBatch\")}</p>\r\n                                  <Input\r\n                                    value={deleteConfirmText[activity.id] || \"\"}\r\n                                    onChange={(e) => setDeleteConfirmText({ ...deleteConfirmText, [activity.id]: e.target.value })}\r\n                                    placeholder=\"DELETE\"\r\n                                    className=\"font-mono\"\r\n                                  />\r\n                                </div>\r\n                              </AlertDialogDescription>\r\n                            </AlertDialogHeader>\r\n                            <AlertDialogFooter>\r\n                              <AlertDialogCancel onClick={() => setDeleteConfirmText({ ...deleteConfirmText, [activity.id]: \"\" })}>\r\n                                {t(\"common.cancel\")}\r\n                              </AlertDialogCancel>\r\n                              <AlertDialogAction\r\n                                disabled={deleteConfirmText[activity.id] !== \"DELETE\"}\r\n                                onClick={() => {\r\n                                  deleteActivity.mutate(activity.id);\r\n                                  setDeleteConfirmText({ ...deleteConfirmText, [activity.id]: \"\" });\r\n                                }}\r\n                                className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                              >\r\n                                {t(\"common.delete\")}\r\n                              </AlertDialogAction>\r\n                            </AlertDialogFooter>\r\n                          </AlertDialogContent>\r\n                        </AlertDialog>\r\n                      )}\r\n                    </div>\r\n                  </CardContent>\r\n                </div>\r\n              </div>\r\n            </Card>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  export default AdminActivities;\r\n"],"names":["RECOMMENDED_WIDTH","RECOMMENDED_HEIGHT","ASPECT_RATIO","centerAspectCrop","mediaWidth","mediaHeight","aspect","centerCrop","makeAspectCrop","ImageCropDialog","open","onOpenChange","imageFile","onCropComplete","t","useTranslation","imgSrc","setImgSrc","useState","crop","setCrop","completedCrop","setCompletedCrop","imgRef","useRef","isCropping","setIsCropping","useEffect","reader","onImageLoad","useCallback","e","width","height","getCroppedImg","image","canvas","ctx","scaleX","scaleY","resolve","reject","blob","handleCropConfirm","croppedBlob","croppedFile","previewUrl","error","Dialog","jsxs","DialogContent","DialogHeader","DialogTitle","jsx","CropIcon","DialogDescription","Alert","Info","AlertDescription","Badge","Maximize2","ReactCrop","DialogFooter","Button","draftSchema","z.object","z.string","z.date","z.enum","z.number","z.boolean","publishedSchema","i18n","activitySchema","ActivityFormDialog","activity","trigger","queryClient","useQueryClient","setOpen","setImageFile","imagePreview","setImagePreview","selectedRestaurants","setSelectedRestaurants","isSubmitting","setIsSubmitting","showCropDialog","setShowCropDialog","tempImageFile","setTempImageFile","mediaType","setMediaType","videoFile","setVideoFile","videoPreview","setVideoPreview","isUploadingVideo","setIsUploadingVideo","videoDeleted","setVideoDeleted","restaurants","useRestaurants","getDefaultValues","register","handleSubmit","errors","setValue","watch","control","reset","useForm","zodResolver","handleOpenChange","newOpen","startDate","endDate","pinned","visible","status","data","supabase","ar","handleImageChange","file","toast","handleCropComplete","preview","handleVideoChange","uploadImage","fileExt","filePath","uploadError","publicUrl","uploadVideo","fileName","onSubmit","publishedResult","fieldLabels","missingFields","err","fieldPath","user","imageUrl","videoUrl","finalVisible","activityData","associations","restaurantId","assocError","newActivity","autoLinkTemplates","couponAssociations","template","DialogTrigger","Globe","ScrollArea","Card","CardContent","Label","Upload","Image","Video","X","Input","Tabs","TabsList","TabsTrigger","TabsContent","Controller","field","RichTextEditor","CalendarIcon","Popover","PopoverTrigger","cn","format","PopoverContent","Calendar","date","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","FileEdit","Send","Checkbox","checked","Pin","ArrowUpDown","Store","restaurant","id","Fragment","ActivityRulesEditorDialog","children","rules","isLoading","useActivityRules","updateRules","useUpdateActivityRules","activeTab","setActiveTab","contentZh","setContentZh","contentEn","setContentEn","contentPt","setContentPt","handleSave","FileText","Loader2","Save","GlobalHandbookEditorDialog","handbook","useGlobalHandbook","updateHandbook","useUpdateGlobalHandbook","BookOpen","AdminActivities","useToast","activities","useAdminActivities","getLocalizedField","useLocalizedContent","deleteActivity","useDeleteActivity","batchDeleteActivities","useBatchDeleteActivities","selectedActivities","setSelectedActivities","searchQuery","setSearchQuery","statusFilter","setStatusFilter","deleteConfirmText","setDeleteConfirmText","batchDeleteConfirmText","setBatchDeleteConfirmText","filteredActivities","useMemo","title","content","matchesSearch","now","isEnded","isOngoing","activityStatus","matchesStatus","handleExport","exportActivitiesToCSV","toggleSelectActivity","activityId","prev","toggleSelectAll","a","handleBatchDelete","Download","Plus","Search","AlertDialog","AlertDialogTrigger","Trash2","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","CardHeader","CardTitle","CardDescription","Link","BarChart3"],"mappings":"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"}