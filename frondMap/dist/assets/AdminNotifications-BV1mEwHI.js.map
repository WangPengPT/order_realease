{"version":3,"file":"AdminNotifications-BV1mEwHI.js","sources":["../../src/pages/admin/AdminNotifications.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Plus, Edit, Trash2, Send, Bell, Image, Users, User, FileEdit, Check, Loader2, Megaphone, Gift, Star, Heart, AlertCircle, Info, PartyPopper, Sparkles, Trophy, LucideIcon, Eye, ExternalLink } from \"lucide-react\";\r\nimport { format } from \"date-fns\";\r\n\r\nconst ICON_OPTIONS = [\"Bell\", \"Megaphone\", \"Gift\", \"Star\", \"Heart\", \"AlertCircle\", \"Info\", \"PartyPopper\", \"Sparkles\", \"Trophy\"];\r\n\r\n// Icon component map for dynamic rendering\r\nconst ICON_MAP: Record<string, LucideIcon> = {\r\n  Bell,\r\n  Megaphone,\r\n  Gift,\r\n  Star,\r\n  Heart,\r\n  AlertCircle,\r\n  Info,\r\n  PartyPopper,\r\n  Sparkles,\r\n  Trophy\r\n};\r\n\r\nconst DynamicIcon = ({ name, className }: { name: string; className?: string }) => {\r\n  const IconComponent = ICON_MAP[name] || Bell;\r\n  return <IconComponent className={className} />;\r\n};\r\n\r\ninterface NotificationTemplate {\r\n  id: string;\r\n  title_zh: string;\r\n  title_en: string;\r\n  title_pt: string;\r\n  content_zh: string;\r\n  content_en: string;\r\n  content_pt: string;\r\n  icon: string;\r\n  image_url: string | null;\r\n  link: string | null;\r\n  status: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\ninterface SendRecord {\r\n  id: string;\r\n  template_id: string | null;\r\n  title: string;\r\n  content: string;\r\n  target_type: string;\r\n  target_role: string | null;\r\n  target_user_ids: string[] | null;\r\n  sent_count: number;\r\n  sent_at: string;\r\n}\r\n\r\nexport default function AdminNotifications() {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  const [isTemplateDialogOpen, setIsTemplateDialogOpen] = useState(false);\r\n  const [isSendDialogOpen, setIsSendDialogOpen] = useState(false);\r\n  const [isPreviewDialogOpen, setIsPreviewDialogOpen] = useState(false);\r\n  const [editingTemplate, setEditingTemplate] = useState<NotificationTemplate | null>(null);\r\n  const [selectedTemplate, setSelectedTemplate] = useState<NotificationTemplate | null>(null);\r\n  const [previewTemplate, setPreviewTemplate] = useState<NotificationTemplate | null>(null);\r\n  const [previewLanguage, setPreviewLanguage] = useState<\"zh\" | \"en\" | \"pt\">(\"zh\");\r\n  const [activeTab, setActiveTab] = useState(\"templates\");\r\n\r\n  // Form state\r\n  const [formData, setFormData] = useState({\r\n    title_zh: \"\",\r\n    title_en: \"\",\r\n    title_pt: \"\",\r\n    content_zh: \"\",\r\n    content_en: \"\",\r\n    content_pt: \"\",\r\n    icon: \"Bell\",\r\n    image_url: \"\",\r\n    link: \"\",\r\n    status: \"draft\"\r\n  });\r\n\r\n  // Send form state\r\n  const [sendData, setSendData] = useState({\r\n    targetType: \"all\" as \"all\" | \"role\" | \"specific\",\r\n    targetRole: \"\" as string,\r\n    targetUserIds: [] as string[],\r\n    userSearch: \"\"\r\n  });\r\n\r\n  // Fetch templates\r\n  const { data: templates = [], isLoading: templatesLoading } = useQuery({\r\n    queryKey: [\"notification-templates\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"notification_templates\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as NotificationTemplate[];\r\n    }\r\n  });\r\n\r\n  // Fetch send records\r\n  const { data: sendRecords = [], isLoading: recordsLoading } = useQuery({\r\n    queryKey: [\"notification-send-records\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"notification_send_records\")\r\n        .select(\"*\")\r\n        .order(\"sent_at\", { ascending: false });\r\n      if (error) throw error;\r\n      return data as SendRecord[];\r\n    }\r\n  });\r\n\r\n  // Fetch users for specific targeting\r\n  const { data: users = [] } = useQuery({\r\n    queryKey: [\"all-users-for-notification\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name\")\r\n        .order(\"display_name\");\r\n      if (error) throw error;\r\n      return data;\r\n    }\r\n  });\r\n\r\n  // Create/Update template mutation\r\n  const templateMutation = useMutation({\r\n    mutationFn: async (data: typeof formData & { id?: string }) => {\r\n      if (data.id) {\r\n        const { error } = await supabase\r\n          .from(\"notification_templates\")\r\n          .update({\r\n            title_zh: data.title_zh,\r\n            title_en: data.title_en,\r\n            title_pt: data.title_pt,\r\n            content_zh: data.content_zh,\r\n            content_en: data.content_en,\r\n            content_pt: data.content_pt,\r\n            icon: data.icon,\r\n            image_url: data.image_url || null,\r\n            link: data.link || null,\r\n            status: data.status\r\n          })\r\n          .eq(\"id\", data.id);\r\n        if (error) throw error;\r\n      } else {\r\n        const { error } = await supabase\r\n          .from(\"notification_templates\")\r\n          .insert({\r\n            title_zh: data.title_zh,\r\n            title_en: data.title_en,\r\n            title_pt: data.title_pt,\r\n            content_zh: data.content_zh,\r\n            content_en: data.content_en,\r\n            content_pt: data.content_pt,\r\n            icon: data.icon,\r\n            image_url: data.image_url || null,\r\n            link: data.link || null,\r\n            status: data.status,\r\n            created_by: user?.id\r\n          });\r\n        if (error) throw error;\r\n      }\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"notification-templates\"] });\r\n      setIsTemplateDialogOpen(false);\r\n      resetForm();\r\n      toast({ title: t(\"common.success\"), description: editingTemplate ? t(\"common.updated\") : t(\"common.created\") });\r\n    },\r\n    onError: (error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    }\r\n  });\r\n\r\n  // Delete template mutation\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"notification_templates\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"notification-templates\"] });\r\n      toast({ title: t(\"common.success\"), description: t(\"common.deleted\") });\r\n    }\r\n  });\r\n\r\n  // Send notification mutation\r\n  const sendMutation = useMutation({\r\n    mutationFn: async () => {\r\n      if (!selectedTemplate) throw new Error(\"No template selected\");\r\n\r\n      // Get target user IDs\r\n      let targetUserIds: string[] = [];\r\n      \r\n      if (sendData.targetType === \"all\") {\r\n        const { data } = await supabase.from(\"profiles\").select(\"id\");\r\n        targetUserIds = data?.map(u => u.id) || [];\r\n      } else if (sendData.targetType === \"role\") {\r\n        const roleValue = sendData.targetRole as \"user\" | \"merchant\" | \"supervisor\" | \"admin\";\r\n        const { data } = await supabase\r\n          .from(\"user_roles\")\r\n          .select(\"user_id\")\r\n          .eq(\"role\", roleValue);\r\n        targetUserIds = data?.map(u => u.user_id) || [];\r\n      } else {\r\n        targetUserIds = sendData.targetUserIds;\r\n      }\r\n\r\n      if (targetUserIds.length === 0) {\r\n        throw new Error(\"No users to send to\");\r\n      }\r\n\r\n      // Create notifications for each user\r\n      const notifications = targetUserIds.map(userId => ({\r\n        user_id: userId,\r\n        type: \"activity_update\" as const, // Using existing notification type\r\n        title: getLocalizedContent(selectedTemplate, \"title\"),\r\n        content: getLocalizedContent(selectedTemplate, \"content\"),\r\n        link: selectedTemplate.link\r\n      }));\r\n\r\n      const { error: notifError } = await supabase\r\n        .from(\"notifications\")\r\n        .insert(notifications);\r\n      if (notifError) throw notifError;\r\n\r\n      // Record the send\r\n      const targetRoleValue = sendData.targetType === \"role\" \r\n        ? sendData.targetRole as \"user\" | \"merchant\" | \"supervisor\" | \"admin\" \r\n        : null;\r\n      \r\n      const { error: recordError } = await supabase\r\n        .from(\"notification_send_records\")\r\n        .insert({\r\n          template_id: selectedTemplate.id,\r\n          title: getLocalizedContent(selectedTemplate, \"title\"),\r\n          content: getLocalizedContent(selectedTemplate, \"content\"),\r\n          target_type: sendData.targetType,\r\n          target_role: targetRoleValue,\r\n          target_user_ids: sendData.targetType === \"specific\" ? sendData.targetUserIds : null,\r\n          sent_count: targetUserIds.length,\r\n          sent_by: user?.id\r\n        });\r\n      if (recordError) throw recordError;\r\n\r\n      return targetUserIds.length;\r\n    },\r\n    onSuccess: (count) => {\r\n      queryClient.invalidateQueries({ queryKey: [\"notification-send-records\"] });\r\n      setIsSendDialogOpen(false);\r\n      setSelectedTemplate(null);\r\n      setSendData({ targetType: \"all\", targetRole: \"\", targetUserIds: [], userSearch: \"\" });\r\n      toast({ \r\n        title: t(\"common.success\"), \r\n        description: t(\"admin.notificationsSent\", { count }) || `已发送 ${count} 条通知`\r\n      });\r\n    },\r\n    onError: (error) => {\r\n      toast({ title: t(\"common.error\"), description: error.message, variant: \"destructive\" });\r\n    }\r\n  });\r\n\r\n  const getLocalizedContent = (template: NotificationTemplate, field: \"title\" | \"content\") => {\r\n    const lang = i18n.language;\r\n    if (field === \"title\") {\r\n      return lang === \"zh\" ? template.title_zh : lang === \"pt\" ? template.title_pt : template.title_en;\r\n    }\r\n    return lang === \"zh\" ? template.content_zh : lang === \"pt\" ? template.content_pt : template.content_en;\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setFormData({\r\n      title_zh: \"\",\r\n      title_en: \"\",\r\n      title_pt: \"\",\r\n      content_zh: \"\",\r\n      content_en: \"\",\r\n      content_pt: \"\",\r\n      icon: \"Bell\",\r\n      image_url: \"\",\r\n      link: \"\",\r\n      status: \"draft\"\r\n    });\r\n    setEditingTemplate(null);\r\n  };\r\n\r\n  const openEditDialog = (template: NotificationTemplate) => {\r\n    setEditingTemplate(template);\r\n    setFormData({\r\n      title_zh: template.title_zh,\r\n      title_en: template.title_en,\r\n      title_pt: template.title_pt,\r\n      content_zh: template.content_zh,\r\n      content_en: template.content_en,\r\n      content_pt: template.content_pt,\r\n      icon: template.icon || \"Bell\",\r\n      image_url: template.image_url || \"\",\r\n      link: template.link || \"\",\r\n      status: template.status\r\n    });\r\n    setIsTemplateDialogOpen(true);\r\n  };\r\n\r\n  const openSendDialog = (template: NotificationTemplate) => {\r\n    setSelectedTemplate(template);\r\n    setIsSendDialogOpen(true);\r\n  };\r\n\r\n  const openPreviewDialog = (template: NotificationTemplate) => {\r\n    setPreviewTemplate(template);\r\n    setPreviewLanguage(i18n.language as \"zh\" | \"en\" | \"pt\");\r\n    setIsPreviewDialogOpen(true);\r\n  };\r\n\r\n  const getPreviewContent = (template: NotificationTemplate, lang: \"zh\" | \"en\" | \"pt\") => {\r\n    return {\r\n      title: lang === \"zh\" ? template.title_zh : lang === \"pt\" ? template.title_pt : template.title_en,\r\n      content: lang === \"zh\" ? template.content_zh : lang === \"pt\" ? template.content_pt : template.content_en\r\n    };\r\n  };\r\n\r\n  const filteredUsers = users.filter(u => \r\n    u.display_name?.toLowerCase().includes(sendData.userSearch.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold flex items-center gap-2\">\r\n            <Bell className=\"h-6 w-6\" />\r\n            {t(\"admin.notifications\", \"发送通知\")}\r\n          </h1>\r\n          <p className=\"text-muted-foreground\">{t(\"admin.notificationsDesc\", \"管理通知模板和发送站内通知\")}</p>\r\n        </div>\r\n      </div>\r\n\r\n      <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n        <TabsList>\r\n          <TabsTrigger value=\"templates\">{t(\"admin.templates\", \"模板管理\")}</TabsTrigger>\r\n          <TabsTrigger value=\"records\">{t(\"admin.sendRecords\", \"发送记录\")}</TabsTrigger>\r\n        </TabsList>\r\n\r\n        <TabsContent value=\"templates\" className=\"space-y-4\">\r\n          <div className=\"flex justify-end\">\r\n            <Dialog open={isTemplateDialogOpen} onOpenChange={(open) => {\r\n              setIsTemplateDialogOpen(open);\r\n              if (!open) resetForm();\r\n            }}>\r\n              <DialogTrigger asChild>\r\n                <Button>\r\n                  <Plus className=\"h-4 w-4 mr-2\" />\r\n                  {t(\"admin.createTemplate\", \"创建模板\")}\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\r\n                <DialogHeader>\r\n                  <DialogTitle>\r\n                    {editingTemplate ? t(\"admin.editTemplate\", \"编辑模板\") : t(\"admin.createTemplate\", \"创建模板\")}\r\n                  </DialogTitle>\r\n                </DialogHeader>\r\n\r\n                <Tabs defaultValue=\"zh\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-3\">\r\n                    <TabsTrigger value=\"zh\">中文</TabsTrigger>\r\n                    <TabsTrigger value=\"en\">English</TabsTrigger>\r\n                    <TabsTrigger value=\"pt\">Português</TabsTrigger>\r\n                  </TabsList>\r\n\r\n                  <TabsContent value=\"zh\" className=\"space-y-4\">\r\n                    <div>\r\n                      <Label>{t(\"common.title\")}</Label>\r\n                      <Input\r\n                        value={formData.title_zh}\r\n                        onChange={(e) => setFormData({ ...formData, title_zh: e.target.value })}\r\n                        placeholder=\"通知标题\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label>{t(\"common.content\")}</Label>\r\n                      <Textarea\r\n                        value={formData.content_zh}\r\n                        onChange={(e) => setFormData({ ...formData, content_zh: e.target.value })}\r\n                        placeholder=\"通知内容\"\r\n                        rows={4}\r\n                      />\r\n                    </div>\r\n                  </TabsContent>\r\n\r\n                  <TabsContent value=\"en\" className=\"space-y-4\">\r\n                    <div>\r\n                      <Label>{t(\"common.title\")}</Label>\r\n                      <Input\r\n                        value={formData.title_en}\r\n                        onChange={(e) => setFormData({ ...formData, title_en: e.target.value })}\r\n                        placeholder=\"Notification Title\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label>{t(\"common.content\")}</Label>\r\n                      <Textarea\r\n                        value={formData.content_en}\r\n                        onChange={(e) => setFormData({ ...formData, content_en: e.target.value })}\r\n                        placeholder=\"Notification Content\"\r\n                        rows={4}\r\n                      />\r\n                    </div>\r\n                  </TabsContent>\r\n\r\n                  <TabsContent value=\"pt\" className=\"space-y-4\">\r\n                    <div>\r\n                      <Label>{t(\"common.title\")}</Label>\r\n                      <Input\r\n                        value={formData.title_pt}\r\n                        onChange={(e) => setFormData({ ...formData, title_pt: e.target.value })}\r\n                        placeholder=\"Título da Notificação\"\r\n                      />\r\n                    </div>\r\n                    <div>\r\n                      <Label>{t(\"common.content\")}</Label>\r\n                      <Textarea\r\n                        value={formData.content_pt}\r\n                        onChange={(e) => setFormData({ ...formData, content_pt: e.target.value })}\r\n                        placeholder=\"Conteúdo da Notificação\"\r\n                        rows={4}\r\n                      />\r\n                    </div>\r\n                  </TabsContent>\r\n                </Tabs>\r\n\r\n                <div className=\"grid grid-cols-2 gap-4 mt-4\">\r\n                  <div>\r\n                    <Label>{t(\"admin.icon\", \"图标\")}</Label>\r\n                    <Select value={formData.icon} onValueChange={(v) => setFormData({ ...formData, icon: v })}>\r\n                      <SelectTrigger>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <DynamicIcon name={formData.icon} className=\"h-4 w-4\" />\r\n                          <span>{formData.icon}</span>\r\n                        </div>\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        {ICON_OPTIONS.map((icon) => (\r\n                          <SelectItem key={icon} value={icon}>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <DynamicIcon name={icon} className=\"h-4 w-4\" />\r\n                              <span>{icon}</span>\r\n                            </div>\r\n                          </SelectItem>\r\n                        ))}\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                  <div>\r\n                    <Label>{t(\"common.status\")}</Label>\r\n                    <Select value={formData.status} onValueChange={(v) => setFormData({ ...formData, status: v })}>\r\n                      <SelectTrigger>\r\n                        <SelectValue />\r\n                      </SelectTrigger>\r\n                      <SelectContent>\r\n                        <SelectItem value=\"draft\">{t(\"common.draft\", \"草稿\")}</SelectItem>\r\n                        <SelectItem value=\"published\">{t(\"common.published\", \"已发布\")}</SelectItem>\r\n                      </SelectContent>\r\n                    </Select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>{t(\"admin.imageUrl\", \"图片URL（可选）\")}</Label>\r\n                  <Input\r\n                    value={formData.image_url}\r\n                    onChange={(e) => setFormData({ ...formData, image_url: e.target.value })}\r\n                    placeholder=\"https://...\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <Label>{t(\"admin.link\", \"链接（可选）\")}</Label>\r\n                  <Input\r\n                    value={formData.link}\r\n                    onChange={(e) => setFormData({ ...formData, link: e.target.value })}\r\n                    placeholder=\"/activity/xxx\"\r\n                  />\r\n                </div>\r\n\r\n                <DialogFooter>\r\n                  <Button variant=\"outline\" onClick={() => setIsTemplateDialogOpen(false)}>\r\n                    {t(\"common.cancel\")}\r\n                  </Button>\r\n                  <Button \r\n                    onClick={() => templateMutation.mutate({ ...formData, id: editingTemplate?.id })}\r\n                    disabled={templateMutation.isPending || !formData.title_zh || !formData.content_zh}\r\n                  >\r\n                    {templateMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n                    {editingTemplate ? t(\"common.save\") : t(\"common.create\")}\r\n                  </Button>\r\n                </DialogFooter>\r\n              </DialogContent>\r\n            </Dialog>\r\n          </div>\r\n\r\n          {templatesLoading ? (\r\n            <div className=\"flex justify-center py-8\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n            </div>\r\n          ) : (\r\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n              {templates.map((template) => (\r\n                <Card key={template.id}>\r\n                  <CardHeader className=\"pb-2\">\r\n                    <div className=\"flex items-start justify-between\">\r\n                      <CardTitle className=\"text-lg\">{getLocalizedContent(template, \"title\")}</CardTitle>\r\n                      <Badge variant={template.status === \"published\" ? \"default\" : \"secondary\"}>\r\n                        {template.status === \"published\" ? (\r\n                          <><Check className=\"h-3 w-3 mr-1\" />{t(\"common.published\", \"已发布\")}</>\r\n                        ) : (\r\n                          <><FileEdit className=\"h-3 w-3 mr-1\" />{t(\"common.draft\", \"草稿\")}</>\r\n                        )}\r\n                      </Badge>\r\n                    </div>\r\n                    <CardDescription className=\"line-clamp-2\">\r\n                      {getLocalizedContent(template, \"content\")}\r\n                    </CardDescription>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"flex items-center gap-2 text-sm text-muted-foreground mb-4\">\r\n                      <DynamicIcon name={template.icon || \"Bell\"} className=\"h-4 w-4\" />\r\n                      <span>{template.icon || \"Bell\"}</span>\r\n                      {template.image_url && <Image className=\"h-4 w-4 ml-2\" />}\r\n                    </div>\r\n                    <div className=\"flex gap-2 flex-wrap\">\r\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => openPreviewDialog(template)}>\r\n                        <Eye className=\"h-4 w-4 mr-1\" />\r\n                        {t(\"common.preview\", \"预览\")}\r\n                      </Button>\r\n                      <Button size=\"sm\" variant=\"outline\" onClick={() => openEditDialog(template)}>\r\n                        <Edit className=\"h-4 w-4 mr-1\" />\r\n                        {t(\"common.edit\")}\r\n                      </Button>\r\n                      <Button \r\n                        size=\"sm\" \r\n                        variant=\"outline\"\r\n                        onClick={() => deleteMutation.mutate(template.id)}\r\n                        disabled={deleteMutation.isPending}\r\n                      >\r\n                        <Trash2 className=\"h-4 w-4 mr-1\" />\r\n                        {t(\"common.delete\")}\r\n                      </Button>\r\n                      {template.status === \"published\" && (\r\n                        <Button size=\"sm\" onClick={() => openSendDialog(template)}>\r\n                          <Send className=\"h-4 w-4 mr-1\" />\r\n                          {t(\"common.send\", \"发送\")}\r\n                        </Button>\r\n                      )}\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </TabsContent>\r\n\r\n        <TabsContent value=\"records\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>{t(\"admin.sendRecords\", \"发送记录\")}</CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {recordsLoading ? (\r\n                <div className=\"flex justify-center py-8\">\r\n                  <Loader2 className=\"h-8 w-8 animate-spin\" />\r\n                </div>\r\n              ) : (\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>{t(\"common.title\")}</TableHead>\r\n                      <TableHead>{t(\"admin.targetType\", \"发送对象\")}</TableHead>\r\n                      <TableHead>{t(\"admin.sentCount\", \"发送数量\")}</TableHead>\r\n                      <TableHead>{t(\"admin.sentAt\", \"发送时间\")}</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {sendRecords.map((record) => (\r\n                      <TableRow key={record.id}>\r\n                        <TableCell className=\"font-medium\">{record.title}</TableCell>\r\n                        <TableCell>\r\n                          <Badge variant=\"outline\">\r\n                            {record.target_type === \"all\" ? (\r\n                              <><Users className=\"h-3 w-3 mr-1\" />{t(\"admin.allUsers\", \"全部用户\")}</>\r\n                            ) : record.target_type === \"role\" ? (\r\n                              <><User className=\"h-3 w-3 mr-1\" />{record.target_role}</>\r\n                            ) : (\r\n                              <><User className=\"h-3 w-3 mr-1\" />{t(\"admin.specificUsers\", \"指定用户\")}</>\r\n                            )}\r\n                          </Badge>\r\n                        </TableCell>\r\n                        <TableCell>{record.sent_count}</TableCell>\r\n                        <TableCell>{format(new Date(record.sent_at), \"yyyy-MM-dd HH:mm\")}</TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Send Dialog */}\r\n      <Dialog open={isSendDialogOpen} onOpenChange={setIsSendDialogOpen}>\r\n        <DialogContent className=\"max-w-md\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"admin.sendNotification\", \"发送通知\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {selectedTemplate && getLocalizedContent(selectedTemplate, \"title\")}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-4\">\r\n            <div>\r\n              <Label>{t(\"admin.targetType\", \"发送对象\")}</Label>\r\n              <Select \r\n                value={sendData.targetType} \r\n                onValueChange={(v: \"all\" | \"role\" | \"specific\") => setSendData({ ...sendData, targetType: v })}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">{t(\"admin.allUsers\", \"全部用户\")}</SelectItem>\r\n                  <SelectItem value=\"role\">{t(\"admin.byRole\", \"按身份\")}</SelectItem>\r\n                  <SelectItem value=\"specific\">{t(\"admin.specificUsers\", \"指定用户\")}</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {sendData.targetType === \"role\" && (\r\n              <div>\r\n                <Label>{t(\"admin.selectRole\", \"选择身份\")}</Label>\r\n                <Select value={sendData.targetRole} onValueChange={(v) => setSendData({ ...sendData, targetRole: v })}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder={t(\"admin.selectRole\")} />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"user\">{t(\"common.user\", \"用户\")}</SelectItem>\r\n                    <SelectItem value=\"merchant\">{t(\"common.merchant\", \"商家\")}</SelectItem>\r\n                    <SelectItem value=\"supervisor\">{t(\"common.supervisor\", \"主管\")}</SelectItem>\r\n                    <SelectItem value=\"admin\">{t(\"common.admin\", \"管理员\")}</SelectItem>\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            {sendData.targetType === \"specific\" && (\r\n              <div className=\"space-y-2\">\r\n                <Label>{t(\"admin.selectUsers\", \"选择用户\")}</Label>\r\n                <Input\r\n                  placeholder={t(\"admin.searchUsers\", \"搜索用户...\")}\r\n                  value={sendData.userSearch}\r\n                  onChange={(e) => setSendData({ ...sendData, userSearch: e.target.value })}\r\n                />\r\n                <div className=\"max-h-40 overflow-y-auto border rounded-md p-2 space-y-1\">\r\n                  {filteredUsers.slice(0, 20).map((u) => (\r\n                    <label key={u.id} className=\"flex items-center gap-2 p-1 hover:bg-muted rounded cursor-pointer\">\r\n                      <input\r\n                        type=\"checkbox\"\r\n                        checked={sendData.targetUserIds.includes(u.id)}\r\n                        onChange={(e) => {\r\n                          if (e.target.checked) {\r\n                            setSendData({ ...sendData, targetUserIds: [...sendData.targetUserIds, u.id] });\r\n                          } else {\r\n                            setSendData({ ...sendData, targetUserIds: sendData.targetUserIds.filter(id => id !== u.id) });\r\n                          }\r\n                        }}\r\n                      />\r\n                      <span className=\"text-sm\">{u.display_name}</span>\r\n                    </label>\r\n                  ))}\r\n                </div>\r\n                {sendData.targetUserIds.length > 0 && (\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {t(\"admin.selectedUsersCount\", { count: sendData.targetUserIds.length })}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsSendDialogOpen(false)}>\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button \r\n              onClick={() => sendMutation.mutate()}\r\n              disabled={sendMutation.isPending || (sendData.targetType === \"role\" && !sendData.targetRole) || (sendData.targetType === \"specific\" && sendData.targetUserIds.length === 0)}\r\n            >\r\n              {sendMutation.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n              <Send className=\"h-4 w-4 mr-2\" />\r\n              {t(\"common.send\", \"发送\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Preview Dialog */}\r\n      <Dialog open={isPreviewDialogOpen} onOpenChange={setIsPreviewDialogOpen}>\r\n        <DialogContent className=\"max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Eye className=\"h-5 w-5\" />\r\n              {t(\"admin.previewNotification\", \"预览通知\")}\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              {t(\"admin.previewNotificationDesc\", \"查看不同语言版本的通知内容\")}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          {previewTemplate && (\r\n            <div className=\"space-y-4\">\r\n              {/* Language Switcher */}\r\n              <Tabs value={previewLanguage} onValueChange={(v) => setPreviewLanguage(v as \"zh\" | \"en\" | \"pt\")}>\r\n                <TabsList className=\"grid w-full grid-cols-3\">\r\n                  <TabsTrigger value=\"zh\">中文</TabsTrigger>\r\n                  <TabsTrigger value=\"en\">English</TabsTrigger>\r\n                  <TabsTrigger value=\"pt\">Português</TabsTrigger>\r\n                </TabsList>\r\n              </Tabs>\r\n\r\n              {/* Preview Card */}\r\n              <Card className=\"border-2\">\r\n                <CardContent className=\"pt-4\">\r\n                  <div className=\"flex items-start gap-3\">\r\n                    {/* Icon */}\r\n                    <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\r\n                      <DynamicIcon name={previewTemplate.icon || \"Bell\"} className=\"h-5 w-5 text-primary\" />\r\n                    </div>\r\n                    \r\n                    {/* Content */}\r\n                    <div className=\"flex-1 space-y-2\">\r\n                      <h4 className=\"font-semibold text-base\">\r\n                        {getPreviewContent(previewTemplate, previewLanguage).title}\r\n                      </h4>\r\n                      <p className=\"text-sm text-muted-foreground whitespace-pre-wrap\">\r\n                        {getPreviewContent(previewTemplate, previewLanguage).content}\r\n                      </p>\r\n                      \r\n                      {/* Image Preview */}\r\n                      {previewTemplate.image_url && (\r\n                        <div className=\"mt-3\">\r\n                          <img \r\n                            src={previewTemplate.image_url} \r\n                            alt=\"Notification\" \r\n                            className=\"rounded-md max-h-40 object-cover\"\r\n                          />\r\n                        </div>\r\n                      )}\r\n                      \r\n                      {/* Link Preview */}\r\n                      {previewTemplate.link && (\r\n                        <div className=\"mt-2 flex items-center gap-1 text-sm text-primary\">\r\n                          <ExternalLink className=\"h-3 w-3\" />\r\n                          <span className=\"truncate\">{previewTemplate.link}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n\r\n              {/* Meta Info */}\r\n              <div className=\"text-xs text-muted-foreground space-y-1\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span>{t(\"common.status\")}:</span>\r\n                  <Badge variant={previewTemplate.status === \"published\" ? \"default\" : \"secondary\"} className=\"text-xs\">\r\n                    {previewTemplate.status === \"published\" ? t(\"common.published\", \"已发布\") : t(\"common.draft\", \"草稿\")}\r\n                  </Badge>\r\n                </div>\r\n                <div>\r\n                  {t(\"common.createdAt\")}: {format(new Date(previewTemplate.created_at), \"yyyy-MM-dd HH:mm\")}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsPreviewDialogOpen(false)}>\r\n              {t(\"common.close\", \"关闭\")}\r\n            </Button>\r\n            {previewTemplate?.status === \"published\" && (\r\n              <Button onClick={() => {\r\n                setIsPreviewDialogOpen(false);\r\n                openSendDialog(previewTemplate);\r\n              }}>\r\n                <Send className=\"h-4 w-4 mr-2\" />\r\n                {t(\"common.send\", \"发送\")}\r\n              </Button>\r\n            )}\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["ICON_OPTIONS","ICON_MAP","Bell","Megaphone","Gift","Star","Heart","AlertCircle","Info","PartyPopper","Sparkles","Trophy","DynamicIcon","name","className","IconComponent","jsx","AdminNotifications","i18n","useTranslation","user","useAuth","toast","useToast","queryClient","useQueryClient","isTemplateDialogOpen","setIsTemplateDialogOpen","useState","isSendDialogOpen","setIsSendDialogOpen","isPreviewDialogOpen","setIsPreviewDialogOpen","editingTemplate","setEditingTemplate","selectedTemplate","setSelectedTemplate","previewTemplate","setPreviewTemplate","previewLanguage","setPreviewLanguage","activeTab","setActiveTab","formData","setFormData","sendData","setSendData","templates","templatesLoading","useQuery","data","error","supabase","sendRecords","recordsLoading","users","templateMutation","useMutation","resetForm","deleteMutation","id","sendMutation","targetUserIds","u","roleValue","notifications","userId","getLocalizedContent","notifError","targetRoleValue","recordError","count","template","field","lang","openEditDialog","openSendDialog","openPreviewDialog","getPreviewContent","filteredUsers","jsxs","Tabs","TabsList","TabsTrigger","TabsContent","Dialog","open","DialogTrigger","Button","Plus","DialogContent","DialogHeader","DialogTitle","Label","Input","e","Textarea","Select","v","SelectTrigger","SelectContent","icon","SelectItem","SelectValue","DialogFooter","Loader2","Card","CardHeader","CardTitle","Badge","Fragment","Check","FileEdit","CardDescription","CardContent","Image","Eye","Edit","Trash2","Send","Table","TableHeader","TableRow","TableHead","TableBody","record","TableCell","Users","User","format","DialogDescription","ExternalLink"],"mappings":"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"}