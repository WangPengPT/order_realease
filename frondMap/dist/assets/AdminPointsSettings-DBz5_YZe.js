import{j as e}from"./vendor-ui-DmpovMYY.js";import{r}from"./vendor-react-iAJ0IrSD.js";import{B as v,aE as M,bK as $,n as N,G as C,V as w,aS as z,aM as A,J as _,az as b,I as k,b_ as E,r as V,U as G,a4 as i,s as g}from"./index-B44MF3Hr.js";import{c as J,d as K}from"./usePoints-C-nfQt4J.js";import{A as Z,a as Q}from"./alert-Dnm_ffZC.js";import{u as W}from"./vendor-i18n-DxKeo2S1.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-D82cqPtt.js";import"./vendor-supabase-6pZ9VDFn.js";const oe=()=>{const{t:s}=W(),{data:o,isLoading:T}=J(),x=K(),[l,f]=r.useState(""),[c,S]=r.useState(""),[H,P]=r.useState(!1),[p,U]=r.useState(""),[F,I]=r.useState(!1),[L,D]=r.useState(!1),[m,d]=r.useState(null);if(r.useState(()=>{if(o){const t=o.find(n=>n.key==="comment_points"),a=o.find(n=>n.key==="min_comment_length");t&&f(t.value),a&&S(a.value)}}),o&&!l&&!c){const t=o.find(n=>n.key==="comment_points"),a=o.find(n=>n.key==="min_comment_length");t&&!l&&f(t.value),a&&!c&&S(a.value)}const q=async()=>{try{await Promise.all([x.mutateAsync({key:"comment_points",value:l}),x.mutateAsync({key:"min_comment_length",value:c})]),i.success(s("admin.pointsSettings.saveSuccess")),P(!1)}catch{i.error(s("admin.pointsSettings.saveFailed"))}},R=(t,a)=>{t(a),P(!0)},O=async()=>{if(!p.trim()){i.error(s("admin.pointsSettings.enterEmailOrId"));return}D(!0),d(null);try{const t=p.trim();if(t.includes("@")){const{data:n,error:u}=await g.functions.invoke("get-user-emails");if(u)throw u;const j=n?.emails||{},h=Object.keys(j).find(y=>j[y]?.toLowerCase()===t.toLowerCase());if(h){const{data:y}=await g.from("profiles").select("display_name").eq("id",h).single();d({id:h,email:j[h],display_name:y?.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}else i.error(s("admin.pointsSettings.userNotFound"))}else{const{data:n,error:u}=await g.from("profiles").select("id, display_name").eq("id",t).single();if(u||!n){i.error(s("admin.pointsSettings.userNotFound"));return}d({id:n.id,email:s("admin.pointsSettings.foundById","(Found by ID)"),display_name:n.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}}catch(t){console.error("Search error:",t),i.error(s("admin.pointsSettings.searchFailed"))}finally{D(!1)}},B=async()=>{if(!m){i.error(s("admin.pointsSettings.searchUserFirst"));return}I(!0);try{const t=new Date().toISOString().split("T")[0],{error:a,count:n}=await g.from("points_transactions").delete().eq("user_id",m.id).eq("type","comment").gte("created_at",t).lt("created_at",`${t}T23:59:59.999Z`);if(a)throw a;n===0?i.info(s("admin.pointsSettings.noRecordFound")):i.success(s("admin.pointsSettings.resetSuccess")),U(""),d(null)}catch(t){console.error("Reset error:",t),i.error(s("admin.pointsSettings.resetFailed"))}finally{I(!1)}};return T?e.jsx("div",{className:"p-6",children:s("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("admin.pointsSettings.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.pointsSettings.description")})]}),e.jsxs(v,{onClick:q,disabled:!H||x.isPending,children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),s("common.save")]})]}),e.jsxs(Z,{children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(Q,{children:s("admin.pointsSettings.info")})]}),e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),s("admin.pointsSettings.commentSettings")]}),e.jsx(A,{children:s("admin.pointsSettings.commentSettingsDesc")})]}),e.jsx(_,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"commentPoints",children:s("admin.pointsSettings.commentPoints")}),e.jsx(k,{id:"commentPoints",type:"number",min:"0",value:l,onChange:t=>R(f,t.target.value),placeholder:"5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.commentPointsHelp")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"minCommentLength",children:s("admin.pointsSettings.minCommentLength")}),e.jsx(k,{id:"minCommentLength",type:"number",min:"0",value:c,onChange:t=>R(S,t.target.value),placeholder:"10"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.minCommentLengthHelp")})]})]})})]}),e.jsxs(N,{children:[e.jsx(C,{children:e.jsx(w,{children:s("admin.pointsSettings.rulesPreview")})}),e.jsx(_,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule1")," ",e.jsx("strong",{children:c||"10"})," ",s("admin.pointsSettings.characters")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule2")," ",e.jsx("strong",{children:l||"5"})," ",s("admin.pointsSettings.points")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule3")]})]})})]}),e.jsxs(N,{children:[e.jsxs(C,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),s("admin.pointsSettings.testTools")]}),e.jsx(A,{children:s("admin.pointsSettings.testToolsDesc")})]}),e.jsx(_,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{children:s("admin.pointsSettings.resetDailyComment")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{value:p,onChange:t=>{U(t.target.value),d(null)},placeholder:s("admin.pointsSettings.emailOrIdPlaceholder"),className:"flex-1"}),e.jsxs(v,{onClick:O,disabled:L||!p.trim(),variant:"outline",children:[e.jsx(V,{className:`h-4 w-4 mr-2 ${L?"animate-spin":""}`}),s("admin.pointsSettings.search")]})]}),m&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:m.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.email}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:m.id})]})]}),e.jsxs(v,{onClick:B,disabled:F,variant:"destructive",size:"sm",children:[e.jsx(E,{className:`h-4 w-4 mr-2 ${F?"animate-spin":""}`}),s("admin.pointsSettings.reset")]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.resetHelp")})]})})]})]})};export{oe as default};
//# sourceMappingURL=AdminPointsSettings-DBz5_YZe.js.map
