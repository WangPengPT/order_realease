import{u as Ke,r as o,p as qe,bJ as v,j as e,bK as Z,bL as K,bM as Qe,L as Xe,bN as N,w as a}from"./vendor-react-BSaoOtGi.js";import{u as Ye,a as es,l as ss,C as fe,v as ge,M as xe,$ as we,w as pe,W as m,I as y,B as f,x as je,s as u}from"./index-BRGVr5Zj.js";import{T as ts,a as rs,b as ye,c as ve}from"./tabs-CxEo76OU.js";import{I as Ne,a as be,b}from"./input-otp-D84TSOlh.js";import{C as as}from"./checkbox-CIbF54Ug.js";import{N as S,O as d}from"./vendor-utils-Z4kpnli5.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-AmDIt6e_.js";const ps=()=>{const{signIn:Se,signUp:Pe,signInWithGoogle:os,signInWithPhone:is,verifyOTP:ns,user:q,isBanned:Q,isCheckingBanStatus:X}=Ye(),{settings:B}=es(),Y=B?.logo_url||ss,ee=B?.logo_width||35,se=B?.logo_height||35,te=Ke(),[l,i]=o.useState(!1),[Ce,re]=o.useState("login"),[ls,ke]=o.useState("phone");o.useState(""),o.useState("+351");const[Fe,R]=o.useState("info"),[H,Le]=o.useState(""),[A,ae]=o.useState(null),[g,I]=o.useState(0),[x,oe]=o.useState(null),[W,Ee]=o.useState(!1);o.useState(!1),o.useState(!1);const[ie,Me]=o.useState(()=>{try{return localStorage.getItem("rememberMe")==="true"}catch{return!1}}),[ne,le]=o.useState(!1),[L,$]=o.useState("email"),[V,ce]=o.useState(""),[Te,de]=o.useState(""),[_,Re]=o.useState(!1),[z,Ae]=o.useState(!1),[w,G]=o.useState(null),[M,D]=o.useState(!1),[P,U]=o.useState(0),[O,J]=o.useState(null),{t:s}=qe(),Ie=S({email:d().email(s("auth.invalidEmail")),password:d().min(6,s("auth.passwordMin"))}),$e=S({displayName:d().min(2,s("auth.displayNameMin")),email:d().email(s("auth.invalidEmail")),password:d().min(6,s("auth.passwordMin")),confirmPassword:d()}).refine(t=>t.password===t.confirmPassword,{message:s("auth.passwordsDontMatch"),path:["confirmPassword"]}),Ve=S({phone:d().min(6,s("auth.phoneMin"))}),De=S({otp:d().length(6,s("auth.otpLength"))}),Ue=S({code:d().length(4,"Verification code must be 4 digits")}),Oe=S({email:d().email(s("auth.invalidEmail"))}),Be=S({code:d().length(4,"Verification code must be 4 digits")}),He=S({newPassword:d().min(6,s("auth.passwordMin")),confirmNewPassword:d()}).refine(t=>t.newPassword===t.confirmNewPassword,{message:s("auth.passwordsDontMatch"),path:["confirmNewPassword"]}),C=v({resolver:N(Ie)}),n=v({resolver:N($e)});v({resolver:N(Ve)}),v({resolver:N(De)});const k=v({resolver:N(Ue)}),T=v({resolver:N(Oe)}),E=v({resolver:N(Be)}),j=v({resolver:N(He)});o.useEffect(()=>{q&&!Q&&!X&&te("/")},[q,te,Q,X]),o.useEffect(()=>{let t;return g>0&&(t=setTimeout(()=>I(g-1),1e3)),()=>clearTimeout(t)},[g]),o.useEffect(()=>{let t;return P>0&&(t=setTimeout(()=>U(P-1),1e3),P<=1&&(D(!1),J(null))),()=>clearTimeout(t)},[P]),o.useEffect(()=>{(async()=>{try{const{data:r,error:c}=await u.functions.invoke("check-login-security",{body:{action:"check"}});!c&&r?.isLimited&&(D(!0),U(r.remainingSeconds))}catch(r){console.error("Failed to check login security:",r)}})()},[]);const me=t=>{let r=0;return t.length>=6&&r++,t.length>=8&&r++,/[a-z]/.test(t)&&r++,/[A-Z]/.test(t)&&r++,/[0-9]/.test(t)&&r++,/[^a-zA-Z0-9]/.test(t)&&r++,r<=2?"weak":r<=4?"medium":"strong"},We=async t=>{if(M){const r=Math.ceil(P/60);a.error(s("auth.tooManyAttempts",{minutes:r}));return}i(!0);try{const{data:r,error:c}=await u.functions.invoke("check-login-security",{body:{action:"check"}});if(!c&&r?.isLimited){D(!0),U(r.remainingSeconds);const h=Math.ceil(r.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:h})),i(!1);return}const{error:p}=await Se(t.email,t.password,ie);if(p){if(p.message==="ACCOUNT_BANNED")return;await u.functions.invoke("check-login-security",{body:{action:"record",email:t.email,success:!1}}).then(({data:h})=>{if(h?.isLimited){D(!0),U(h.remainingSeconds);const F=Math.ceil(h.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:F}))}else if(h?.attemptCount!==void 0){const F=5-h.attemptCount;J(F>0?F:0),a.error(s("auth.invalidCredentials")),F>0&&F<=3&&a.warning(s("auth.remainingAttempts",{count:F}))}});return}await u.functions.invoke("check-login-security",{body:{action:"record",email:t.email,success:!0}}),J(null),a.success(s("auth.signInSuccess"))}catch{a.error(s("auth.invalidCredentials"))}finally{i(!1)}},_e=async t=>{i(!0);try{const{data:r,error:c}=await u.functions.invoke("check-email-registered",{body:{email:t.email}});if(c){console.error("Check email error:",c),a.error(s("error.general"));return}if(r?.registered){a.error(s("auth.emailAlreadyRegisteredUseLogin"));return}ae(t),Le(t.email);const{error:p}=await u.functions.invoke("send-verification-code",{body:{email:t.email}});if(p){a.error(s("auth.verificationCodeFailed")),console.error(p);return}R("verify"),a.success(s("auth.verificationCodeSent")),I(30)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},ze=async t=>{if(A){i(!0);try{const{data:r,error:c}=await u.functions.invoke("verify-email-code",{body:{email:H,code:t.code}});if(c||!r?.success){a.error(r?.error||s("auth.invalidVerificationCode"));return}const{data:p,error:h}=await Pe(A.email,A.password,A.displayName);if(h){h.message.includes("already registered")?a.error(s("auth.emailAlreadyRegisteredUseLogin")):a.error(h.message);return}if(!p?.user?.identities||p.user.identities.length===0){a.error(s("auth.emailAlreadyRegisteredUseLogin"));return}a.success(s("auth.signUpSuccess")),re("login"),R("info"),n.reset(),k.reset(),ae(null)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}}},ue=async()=>{if(!(g>0)){i(!0);try{const t=ne?V:H,{error:r}=await u.functions.invoke("send-verification-code",{body:{email:t}});if(r){a.error(s("toast.resendCodeFailed"));return}a.success(s("toast.verificationCodeResent")),I(30)}catch(t){a.error(t.message||"Failed to resend code")}finally{i(!1)}}},Ge=async t=>{i(!0);try{const{data:r,error:c}=await u.functions.invoke("check-email-registered",{body:{email:t.email}});if(c){a.error(s("error.general"));return}if(!r?.registered){a.error(s("auth.emailNotRegistered"));return}const{error:p}=await u.functions.invoke("send-verification-code",{body:{email:t.email}});if(p){a.error(s("auth.verificationCodeFailed"));return}ce(t.email),$("verify"),a.success(s("auth.verificationCodeSent")),I(30)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},Je=async t=>{i(!0);try{const{data:r,error:c}=await u.functions.invoke("verify-email-code",{body:{email:V,code:t.code}});if(c||!r?.success){a.error(r?.error||s("auth.invalidVerificationCode"));return}de(t.code),$("newPassword"),a.success(s("auth.codeVerified"))}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},Ze=async t=>{i(!0);try{const{data:r,error:c}=await u.functions.invoke("reset-password",{body:{email:V,code:Te,newPassword:t.newPassword}});if(c||!r?.success){a.error(r?.error||s("auth.passwordResetFailed"));return}a.success(s("auth.passwordResetSuccess")),he()}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},he=()=>{le(!1),$("email"),ce(""),de(""),T.reset(),E.reset(),j.reset(),G(null)};return ne?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(fe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(ge,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:Y,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(xe,{className:"text-2xl",children:s("auth.forgotPassword")}),e.jsxs(we,{children:[L==="email"&&s("auth.forgotPasswordDescription"),L==="verify"&&s("auth.verifyCodeDescription"),L==="newPassword"&&s("auth.setNewPasswordDescription")]})]}),e.jsxs(pe,{children:[L==="email"&&e.jsxs("form",{onSubmit:T.handleSubmit(Ge),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"forgot-email",children:s("auth.email")}),e.jsx(y,{id:"forgot-email",type:"email",placeholder:"you@example.com",...T.register("email")}),T.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:T.formState.errors.email.message})]}),e.jsx(f,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.sendingCode":"auth.sendCode")})]}),L==="verify"&&e.jsxs("form",{onSubmit:E.handleSubmit(Je),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:s("auth.verificationCode")}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:s("auth.verificationCodeHint",{email:V})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...E.register("code"),onChange:t=>E.setValue("code",t),children:e.jsxs(be,{children:[e.jsx(b,{index:0}),e.jsx(b,{index:1}),e.jsx(b,{index:2}),e.jsx(b,{index:3})]})})}),E.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:E.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"button",variant:"outline",className:"w-full",onClick:()=>$("email"),children:s("common.back")}),e.jsx(f,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.verifying":"auth.verify")})]}),e.jsx(f,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:l||g>0,children:g>0?s("auth.resendIn",{seconds:g}):s("auth.resendCode")})]}),L==="newPassword"&&e.jsxs("form",{onSubmit:j.handleSubmit(Ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"new-password",children:s("auth.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"new-password",type:_?"text":"password",placeholder:s("auth.passwordPlaceholder"),...j.register("newPassword"),onChange:t=>{j.setValue("newPassword",t.target.value),t.target.value?G(me(t.target.value)):G(null)}}),e.jsx("button",{type:"button",onClick:()=>Re(!_),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:_?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),j.formState.errors.newPassword&&e.jsx("p",{className:"text-sm text-destructive",children:j.formState.errors.newPassword.message}),w&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="weak"?"bg-destructive":w==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="medium"||w==="strong"?w==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${w==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${w==="weak"?"text-destructive":w==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${w}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirm-new-password",children:s("auth.confirmNewPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"confirm-new-password",type:z?"text":"password",placeholder:s("auth.passwordPlaceholder"),...j.register("confirmNewPassword")}),e.jsx("button",{type:"button",onClick:()=>Ae(!z),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:z?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),j.formState.errors.confirmNewPassword&&e.jsx("p",{className:"text-sm text-destructive",children:j.formState.errors.confirmNewPassword.message})]}),e.jsx(f,{type:"submit",className:"w-full",disabled:l,children:s(l?"common.loading":"auth.resetPassword")})]})]}),e.jsx(je,{children:e.jsxs(f,{variant:"ghost",className:"w-full",onClick:he,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),s("auth.backToLogin")]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(fe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(ge,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:Y,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(xe,{className:"text-2xl",children:s("auth.welcome")}),e.jsx(we,{children:s("auth.subtitle")})]}),e.jsx(pe,{children:e.jsxs(ts,{value:Ce,onValueChange:t=>{re(t),ke("phone"),R("info")},className:"w-full",children:[e.jsxs(rs,{className:"grid w-full grid-cols-2",children:[e.jsx(ye,{value:"login",children:s("auth.login")}),e.jsx(ye,{value:"register",children:s("auth.register")})]}),e.jsx(ve,{value:"login",children:e.jsxs("form",{onSubmit:C.handleSubmit(We),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:s("auth.email")}),e.jsx(y,{id:"email",type:"email",placeholder:"you@example.com",...C.register("email")}),C.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:C.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"password",children:s("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"password",type:W?"text":"password",placeholder:"••••••••",...C.register("password")}),e.jsx("button",{type:"button",onClick:()=>Ee(!W),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:W?e.jsx(Z,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})})]}),C.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:C.formState.errors.password.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{id:"rememberMe",checked:ie,onCheckedChange:t=>{Me(t===!0),localStorage.setItem("rememberMe",String(t===!0))}}),e.jsx(m,{htmlFor:"rememberMe",className:"text-sm font-normal cursor-pointer",children:s("auth.rememberMe")})]}),e.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",onClick:()=>le(!0),children:s("auth.forgotPassword")})]}),M&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsx("p",{className:"text-sm text-destructive font-medium",children:s("auth.accountLocked")}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:s("auth.tooManyAttempts",{minutes:Math.ceil(P/60)})})]}),!M&&O!==null&&O<=3&&O>0&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:s("auth.remainingAttempts",{count:O})})}),e.jsx(f,{type:"submit",className:"w-full",disabled:l||M,children:l?s("auth.signingIn"):M?`${s("auth.signIn")} (${Math.ceil(P/60)}m)`:s("auth.signIn")})]})}),e.jsx(ve,{value:"register",children:Fe==="info"?e.jsxs("form",{onSubmit:n.handleSubmit(_e),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"display-name",children:s("auth.displayName")}),e.jsx(y,{id:"display-name",placeholder:"John Doe",...n.register("displayName")}),n.formState.errors.displayName&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.displayName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"register-email",children:s("auth.email")}),e.jsx(y,{id:"register-email",type:"email",placeholder:"you@example.com",...n.register("email")}),n.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"register-password",children:s("auth.password")}),e.jsx(y,{id:"register-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("password"),onChange:t=>{n.setValue("password",t.target.value),t.target.value?oe(me(t.target.value)):oe(null)}}),n.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.password.message}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="weak"?"bg-destructive":x==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="medium"||x==="strong"?x==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${x==="weak"?"text-destructive":x==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${x}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"confirm-password",children:s("auth.confirmPassword")}),e.jsx(y,{id:"confirm-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("confirmPassword")}),n.formState.errors.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.confirmPassword.message})]}),e.jsx(f,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.sendingCode":"auth.sendCode")})]}):e.jsxs("form",{onSubmit:k.handleSubmit(ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"verification-code",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",H]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...k.register("code"),onChange:t=>k.setValue("code",t),children:e.jsxs(be,{children:[e.jsx(b,{index:0}),e.jsx(b,{index:1}),e.jsx(b,{index:2}),e.jsx(b,{index:3})]})})}),k.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:k.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{type:"button",variant:"outline",className:"w-full",onClick:()=>{R("info"),k.reset()},children:s("common.back")}),e.jsx(f,{type:"submit",className:"w-full",disabled:l,children:l?s("auth.verifying"):"Verify & Register"})]}),e.jsx(f,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:l||g>0,children:g>0?`Resend Code (${g}s)`:"Resend Code"})]})})]})}),e.jsx(je,{children:e.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:e.jsx(Xe,{to:"/",className:"text-primary hover:underline",children:s("auth.backToHome")})})})]})})};export{ps as default};
//# sourceMappingURL=Auth-DkKVKFgL.js.map
