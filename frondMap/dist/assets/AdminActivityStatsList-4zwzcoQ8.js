import{j as e}from"./vendor-ui-DAmPMpEA.js";import{u as V,r as A}from"./vendor-react-iAJ0IrSD.js";import{a as o}from"./vendor-query-BlSVl3IQ.js";import{Q as m,s as N,bA as I,i as z,aM as E,aN as Q,aO as k,aP as B,aQ as h,g as u,v as x,aV as y,as as b,a5 as w,bm as S,t as U,T as H,B as M}from"./index-BxrvzYCx.js";import{u as $}from"./useLocalizedContent-DPVaEcf3.js";import{u as G}from"./vendor-i18n-DxKeo2S1.js";import{s as v}from"./startOfDay-CKWpycKh.js";import{s as q}from"./subDays-Djx8Vhdr.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";const ie=()=>{const{t:i}=G(),C=V(),{getLocalizedField:_}=$(),[d,O]=A.useState("30days"),F=()=>{const s=new Date;switch(d){case"today":return v(s).toISOString();case"7days":return v(q(s,6)).toISOString();case"30days":return v(q(s,29)).toISOString();default:return null}},{data:t,isLoading:D}=o({queryKey:["admin-activities-stats-list"],queryFn:async()=>{const{data:s,error:a}=await m.from("activities").select("*").neq("status","draft").order("created_at",{ascending:!1});if(a)throw a;return s}}),c=F(),{data:g}=o({queryKey:["admin-all-subscription-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:j}=o({queryKey:["admin-all-share-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("activity_shares").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:p}=o({queryKey:["admin-all-activity-view-counts",d,t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{let r=m.from("page_views").select("*",{count:"exact",head:!0}).eq("page_type","activity").eq("target_id",a.id);c&&(r=r.gte("created_at",c));const{count:n,error:l}=await r;!l&&n!==null&&(s[a.id]=n)})),s},enabled:!!t?.length}),{data:f}=o({queryKey:["admin-all-activity-restaurant-counts",t?.map(s=>s.id)],queryFn:async()=>{if(!t?.length)return{};const s={};return await Promise.all(t.map(async a=>{const{count:r,error:n}=await m.from("activity_restaurants").select("*",{count:"exact",head:!0}).eq("activity_id",a.id);!n&&r!==null&&(s[a.id]=r)})),s},enabled:!!t?.length}),T=p?Object.values(p).reduce((s,a)=>s+a,0):0,K=g?Object.values(g).reduce((s,a)=>s+a,0):0,L=j?Object.values(j).reduce((s,a)=>s+a,0):0,P=f?Object.values(f).reduce((s,a)=>s+a,0):0;return D?e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(N,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(N,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:i("admin.activityStatistics")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(E,{value:d,onValueChange:s=>O(s),children:[e.jsx(Q,{className:"w-[140px]",children:e.jsx(k,{})}),e.jsxs(B,{children:[e.jsx(h,{value:"today",children:i("analytics.today","今日")}),e.jsx(h,{value:"7days",children:i("analytics.last7Days","近7天")}),e.jsx(h,{value:"30days",children:i("analytics.last30Days","近30天")}),e.jsx(h,{value:"all",children:i("analytics.allTime","所有时间")})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(y,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalViews")}),e.jsx("p",{className:"text-2xl font-bold",children:T})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(b,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalSubscribers")}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-500/10 rounded-lg",children:e.jsx(w,{className:"h-5 w-5 text-green-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.totalShares")}),e.jsx("p",{className:"text-2xl font-bold",children:L})]})]})})}),e.jsx(u,{children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:i("admin.participatingRestaurants")}),e.jsx("p",{className:"text-2xl font-bold",children:P})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:i("admin.allActivities")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t?.map(s=>{const a=_(s,"title"),r=p?.[s.id]||0,n=g?.[s.id]||0,l=j?.[s.id]||0,R=f?.[s.id]||0;return e.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>C(`/admin/activity-stats/${s.id}`),children:[e.jsx(U,{className:"pb-2",children:e.jsx(H,{className:"text-base line-clamp-2",children:a})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[r," ",i("admin.views")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[n," ",i("admin.subscribers")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[l," ",i("admin.shares")]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:[R," ",i("admin.restaurants")]})]})]}),e.jsx(M,{variant:"outline",size:"sm",className:"w-full mt-4",children:i("admin.viewDetails")})]})]},s.id)})})]})]})};export{ie as default};
//# sourceMappingURL=AdminActivityStatsList-4zwzcoQ8.js.map
