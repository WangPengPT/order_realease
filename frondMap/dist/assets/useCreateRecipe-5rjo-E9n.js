import{q as y,p as h,v as b,w as g}from"./vendor-react-87iFmKFJ.js";import{s}from"./index-C3xfGQgV.js";const l=(t,n)=>t&&n?`[[NOTE]]${t}
[[INTRO]]${n}`:t?`[[NOTE]]${t}`:n,w=()=>{const t=y(),{t:n}=h();return b({mutationFn:async e=>{const{data:{user:o}}=await s.auth.getUser();if(!o)throw new Error("Not authenticated");const u=e.cooking_note?.trim()||"",c=l(u,e.introduction?.trim()||""),a=l(u,e.introduction_en?.trim()||""),p=l(u,e.introduction_pt?.trim()||""),r=[];e.cover_image&&r.push(e.cover_image),e.steps.forEach(i=>{i.image_urls&&i.image_urls.length>0?i.image_urls.forEach(f=>r.push(f)):i.image_url&&r.push(i.image_url)});const{data:_,error:d}=await s.from("community_posts").insert({author_id:o.id,post_type:"recipe",content:c,content_zh:c||null,content_en:a||null,content_pt:p||null,image_urls:r,recipe_name:e.recipe_name,recipe_name_en:e.recipe_name_en||null,recipe_name_pt:e.recipe_name_pt||null,subtitle:e.subtitle||null,subtitle_en:e.subtitle_en||null,subtitle_pt:e.subtitle_pt||null,cook_time:e.cook_time,difficulty:e.difficulty,servings:e.servings,ingredients:e.ingredients,steps:e.steps,nutrition:e.nutrition?e.nutrition:null,recipe_tags:e.recipe_tags||null,recipe_category:e.recipe_category||null,ai_recipe_source:e.ai_recipe_source?e.ai_recipe_source:null,status:"pending",moderation_status:"pending"}).select().single();if(d)throw d;try{await s.functions.invoke("moderate-post",{body:{post_id:_.id,content:c,user_id:o.id,image_urls:r}})}catch(i){console.error("Moderation call failed:",i)}return _},onSuccess:()=>{t.invalidateQueries({queryKey:["community-posts"]}),t.invalidateQueries({queryKey:["has-posted-today"]}),g.success(n("recipe.publishSuccess","食谱发布成功"))},onError:e=>{console.error("Create recipe error:",e),g.error(n("recipe.publishError","发布失败"))}})};export{w as u};
//# sourceMappingURL=useCreateRecipe-5rjo-E9n.js.map
