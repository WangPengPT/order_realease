{"version":3,"file":"PublishConfirmStep-CGHgxQDO.js","sources":["../../src/hooks/useAIRecipe.ts","../../src/components/ai-recipe/CameraCapture.tsx","../../src/components/ai-recipe/ResultPhotoStep.tsx","../../src/components/ai-recipe/PublishConfirmStep.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Ingredient, RecipeStep } from \"@/components/community/recipe/RecipeTypes\";\r\n\r\nexport interface IdentifiedIngredient {\r\n  name: string;\r\n  name_en?: string;\r\n  name_pt?: string;\r\n  estimated_amount?: string;\r\n  unit?: string;\r\n}\r\n\r\nexport interface AIRecipeSuggestion {\r\n  recipe_name: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  subtitle?: string;\r\n  subtitle_en?: string;\r\n  subtitle_pt?: string;\r\n  introduction?: string;\r\n  introduction_en?: string;\r\n  introduction_pt?: string;\r\n  cook_time: number;\r\n  difficulty: \"easy\" | \"medium\" | \"hard\";\r\n  servings: number;\r\n  ingredients: Ingredient[];\r\n  steps: RecipeStep[];\r\n  missing_ingredients?: string[];\r\n  image_url?: string;\r\n  image_source?: \"ai\" | \"web\";\r\n}\r\n\r\nexport interface VerifyPhotoResult {\r\n  is_genuine: boolean;\r\n  confidence: number;\r\n  reasons: string[];\r\n  explanation: string;\r\n}\r\n\r\nexport const useAIRecipe = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const [isIdentifying, setIsIdentifying] = useState(false);\r\n  const [isGenerating, setIsGenerating] = useState(false);\r\n  const [isVerifying, setIsVerifying] = useState(false);\r\n  const [isGeneratingImages, setIsGeneratingImages] = useState(false);\r\n\r\n  const identifyIngredients = async (imageUrl: string): Promise<IdentifiedIngredient[] | null> => {\r\n    setIsIdentifying(true);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"ai-recipe/identify\", {\r\n        body: { image_url: imageUrl },\r\n      });\r\n\r\n      if (error) throw error;\r\n      if (data?.error) throw new Error(data.error);\r\n\r\n      return data.ingredients || [];\r\n    } catch (err) {\r\n      console.error(\"Identify error:\", err);\r\n      toast.error(t(\"aiRecipe.identifyError\", \"食材识别失败，请重试\"));\r\n      return null;\r\n    } finally {\r\n      setIsIdentifying(false);\r\n    }\r\n  };\r\n\r\n  const generateRecipes = async (ingredients: IdentifiedIngredient[], difficulty?: string, servings?: number, dishCount?: number, notes?: string, excludeDishes?: string[]): Promise<AIRecipeSuggestion[] | null> => {\r\n    setIsGenerating(true);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"ai-recipe/generate\", {\r\n        body: { ingredients, difficulty, servings, recipe_count: dishCount || 3, dish_count_specified: !!dishCount, notes, exclude_dishes: excludeDishes },\r\n      });\r\n\r\n      if (error) {\r\n        const errBody = error?.context?.body ? await error.context.json?.().catch(() => null) : null;\r\n        const errMsg = errBody?.error || error.message;\r\n        if (errMsg?.includes(\"credits\")) {\r\n          toast.error(t(\"aiRecipe.creditsExhausted\", \"AI 额度不足，请充值后重试\"));\r\n          return null;\r\n        }\r\n        if (errMsg?.includes(\"rate limit\")) {\r\n          toast.error(t(\"aiRecipe.rateLimited\", \"请求过于频繁，请稍后重试\"));\r\n          return null;\r\n        }\r\n        throw new Error(errMsg);\r\n      }\r\n      if (data?.error) {\r\n        if (data.error.includes(\"credits\")) {\r\n          toast.error(t(\"aiRecipe.creditsExhausted\", \"AI 额度不足，请充值后重试\"));\r\n          return null;\r\n        }\r\n        throw new Error(data.error);\r\n      }\r\n\r\n      return data.recipes || [];\r\n    } catch (err) {\r\n      console.error(\"Generate error:\", err);\r\n      toast.error(t(\"aiRecipe.generateError\", \"菜谱生成失败，请重试\"));\r\n      return null;\r\n    } finally {\r\n      setIsGenerating(false);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Fetch images for an already-displayed list of recipes.\r\n   * Returns a map of recipe_name → { image_url, image_source }\r\n   */\r\n  const generateRecipeImages = async (\r\n    recipes: Pick<AIRecipeSuggestion, \"recipe_name\" | \"recipe_name_en\">[],\r\n    onImageReady: (recipeName: string, imageUrl: string, imageSource: string) => void\r\n  ): Promise<void> => {\r\n    if (!recipes.length) return;\r\n    setIsGeneratingImages(true);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"ai-recipe/generate-images\", {\r\n        body: { recipes },\r\n      });\r\n      if (error || !data?.images) return;\r\n      for (const img of data.images) {\r\n        if (img.image_url) {\r\n          onImageReady(img.recipe_name, img.image_url, img.image_source || \"ai\");\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Image generation error:\", err);\r\n    } finally {\r\n      setIsGeneratingImages(false);\r\n    }\r\n  };\r\n\r\n  const verifyResultPhoto = async (imageUrl: string, recipeName?: string, exifTime?: string, photoSource?: \"camera\" | \"upload\"): Promise<VerifyPhotoResult | null> => {\r\n    setIsVerifying(true);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"ai-recipe/verify-photo\", {\r\n        body: { image_url: imageUrl, recipe_name: recipeName, exif_time: exifTime, lang: i18n.language, photo_source: photoSource || \"camera\" },\r\n      });\r\n\r\n      if (error) throw error;\r\n      if (data?.error) throw new Error(data.error);\r\n\r\n      return data;\r\n    } catch (err) {\r\n      console.error(\"Verify error:\", err);\r\n      toast.error(t(\"aiRecipe.verifyError\", \"照片验证失败，请重试\"));\r\n      return null;\r\n    } finally {\r\n      setIsVerifying(false);\r\n    }\r\n  };\r\n\r\n  const uploadImage = async (file: File, folder: string): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${folder}/${Date.now()}-${Math.random().toString(36).slice(2)}.${fileExt}`;\r\n\r\n      const { data, error } = await supabase.storage\r\n        .from(\"community-images\")\r\n        .upload(fileName, file, { cacheControl: \"3600\", upsert: false });\r\n\r\n      if (error) throw error;\r\n\r\n      const { data: urlData } = supabase.storage\r\n        .from(\"community-images\")\r\n        .getPublicUrl(data.path);\r\n\r\n      return urlData.publicUrl;\r\n    } catch (err) {\r\n      console.error(\"Upload error:\", err);\r\n      toast.error(t(\"common.uploadFailed\", \"上传失败\"));\r\n      return null;\r\n    }\r\n  };\r\n\r\n  return {\r\n    identifyIngredients,\r\n    generateRecipes,\r\n    generateRecipeImages,\r\n    verifyResultPhoto,\r\n    uploadImage,\r\n    isIdentifying,\r\n    isGenerating,\r\n    isVerifying,\r\n    isGeneratingImages,\r\n  };\r\n};\r\n","import { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Camera, X, RotateCcw, Circle } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CameraCaptureProps {\r\n  onCapture: (file: File) => void;\r\n  onClose: () => void;\r\n}\r\n\r\nconst CameraCapture = ({ onCapture, onClose }: CameraCaptureProps) => {\r\n  const { t } = useTranslation();\r\n  const videoRef = useRef<HTMLVideoElement>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const streamRef = useRef<MediaStream | null>(null);\r\n  const [isReady, setIsReady] = useState(false);\r\n  const [facingMode, setFacingMode] = useState<\"environment\" | \"user\">(\"environment\");\r\n  const [capturing, setCapturing] = useState(false);\r\n\r\n  const startStream = useCallback(async (facing: \"environment\" | \"user\") => {\r\n    // Stop existing stream\r\n    if (streamRef.current) {\r\n      streamRef.current.getTracks().forEach(t => t.stop());\r\n      streamRef.current = null;\r\n    }\r\n    setIsReady(false);\r\n\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { facingMode: facing },\r\n        audio: false,\r\n      });\r\n      streamRef.current = stream;\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        videoRef.current.onloadedmetadata = () => {\r\n          videoRef.current?.play();\r\n          setIsReady(true);\r\n        };\r\n      }\r\n    } catch (err: any) {\r\n      console.error(\"Camera error:\", err);\r\n      if (err.name === \"NotAllowedError\" || err.name === \"PermissionDeniedError\") {\r\n        toast.error(t(\"aiRecipe.cameraPermissionDenied\", \"相机权限被拒绝，请在浏览器设置中允许访问相机\"));\r\n      } else if (err.name === \"NotFoundError\") {\r\n        toast.error(t(\"aiRecipe.cameraNotFound\", \"未找到相机设备\"));\r\n      } else {\r\n        toast.error(t(\"aiRecipe.cameraError\", \"无法访问相机，请检查权限设置\"));\r\n      }\r\n      onClose();\r\n    }\r\n  }, [onClose, t]);\r\n\r\n  useEffect(() => {\r\n    startStream(facingMode);\r\n    return () => {\r\n      streamRef.current?.getTracks().forEach(t => t.stop());\r\n    };\r\n  }, []);  // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const handleFlip = async () => {\r\n    const next = facingMode === \"environment\" ? \"user\" : \"environment\";\r\n    setFacingMode(next);\r\n    await startStream(next);\r\n  };\r\n\r\n  const handleCapture = () => {\r\n    if (!videoRef.current || !canvasRef.current || !isReady) return;\r\n    setCapturing(true);\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    canvas.width = video.videoWidth;\r\n    canvas.height = video.videoHeight;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) return;\r\n    ctx.drawImage(video, 0, 0);\r\n\r\n    canvas.toBlob((blob) => {\r\n      if (blob) {\r\n        const file = new File([blob], `photo-${Date.now()}.jpg`, { type: \"image/jpeg\" });\r\n        // Stop stream before calling onCapture\r\n        streamRef.current?.getTracks().forEach(t => t.stop());\r\n        onCapture(file);\r\n      }\r\n      setCapturing(false);\r\n    }, \"image/jpeg\", 0.92);\r\n  };\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-50 bg-black flex flex-col\">\r\n      {/* Video viewfinder */}\r\n      <div className=\"relative flex-1 overflow-hidden\">\r\n        <video\r\n          ref={videoRef}\r\n          playsInline\r\n          muted\r\n          className=\"w-full h-full object-cover\"\r\n        />\r\n        <canvas ref={canvasRef} className=\"hidden\" />\r\n\r\n        {/* Corner guides */}\r\n        {isReady && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\r\n            <div className=\"w-64 h-64 relative\">\r\n              <div className=\"absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-white/80 rounded-tl\" />\r\n              <div className=\"absolute top-0 right-0 w-8 h-8 border-t-2 border-r-2 border-white/80 rounded-tr\" />\r\n              <div className=\"absolute bottom-0 left-0 w-8 h-8 border-b-2 border-l-2 border-white/80 rounded-bl\" />\r\n              <div className=\"absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-white/80 rounded-br\" />\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {!isReady && (\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <div className=\"flex flex-col items-center gap-3 text-white/70\">\r\n              <Camera className=\"h-10 w-10 animate-pulse\" />\r\n              <span className=\"text-sm\">{t(\"aiRecipe.cameraLoading\", \"相机加载中...\")}</span>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Controls */}\r\n      <div className=\"bg-black/90 px-6 py-6 flex items-center justify-between safe-area-bottom\">\r\n        {/* Close */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          className=\"text-white hover:bg-white/10 rounded-full w-12 h-12\"\r\n          onClick={() => {\r\n            streamRef.current?.getTracks().forEach(t => t.stop());\r\n            onClose();\r\n          }}\r\n        >\r\n          <X className=\"h-6 w-6\" />\r\n        </Button>\r\n\r\n        {/* Shutter */}\r\n        <button\r\n          onClick={handleCapture}\r\n          disabled={!isReady || capturing}\r\n          className=\"w-20 h-20 rounded-full bg-white flex items-center justify-center disabled:opacity-50 active:scale-95 transition-transform\"\r\n        >\r\n          <Circle className=\"w-16 h-16 text-black fill-black/10\" />\r\n        </button>\r\n\r\n        {/* Flip camera */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          size=\"icon\"\r\n          className=\"text-white hover:bg-white/10 rounded-full w-12 h-12\"\r\n          onClick={handleFlip}\r\n          disabled={!isReady}\r\n        >\r\n          <RotateCcw className=\"h-6 w-6\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CameraCapture;\r\n","import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Camera, Loader2, CheckCircle, XCircle, ShieldCheck, ImageIcon, AlertTriangle, PenLine, ArrowRight, ChevronDown } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { VerifyPhotoResult } from \"@/hooks/useAIRecipe\";\r\nimport CameraCapture from \"./CameraCapture\";\r\n\r\ninterface ResultPhotoStepProps {\r\n  onPhotoVerified: (imageUrl: string, verified: boolean, note?: string) => void;\r\n  uploadImage: (file: File, folder: string) => Promise<string | null>;\r\n  verifyPhoto: (imageUrl: string, recipeName?: string, photoSource?: \"camera\" | \"upload\") => Promise<VerifyPhotoResult | null>;\r\n  recipeName?: string;\r\n  isVerifying: boolean;\r\n}\r\n\r\nconst ResultPhotoStep = ({ onPhotoVerified, uploadImage, verifyPhoto, recipeName, isVerifying }: ResultPhotoStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [uploading, setUploading] = useState(false);\r\n  const [preview, setPreview] = useState<string | null>(null);\r\n  const [verifyResult, setVerifyResult] = useState<VerifyPhotoResult | null>(null);\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const [photoSource, setPhotoSource] = useState<\"camera\" | \"upload\" | null>(null);\r\n  const [uploadedUrl, setUploadedUrl] = useState<string | null>(null);\r\n  const [note, setNote] = useState(\"\");\r\n  const [showNoteInput, setShowNoteInput] = useState(false);\r\n  const [showReason, setShowReason] = useState(false);\r\n  const fileRef = useRef<HTMLInputElement>(null);\r\n\r\n  const handleFile = async (file: File, source: \"camera\" | \"upload\") => {\r\n    // Reset only when a new file actually arrives\r\n    setUploading(true);\r\n    setVerifyResult(null);\r\n    setPhotoSource(source);\r\n    setPreview(URL.createObjectURL(file));\r\n    setNote(\"\");\r\n    setShowNoteInput(false);\r\n\r\n    const url = await uploadImage(file, \"ai-recipe-results\");\r\n    if (!url) {\r\n      setUploading(false);\r\n      return;\r\n    }\r\n    setUploadedUrl(url);\r\n    setUploading(false);\r\n\r\n    const result = await verifyPhoto(url, recipeName, source);\r\n    setVerifyResult(result);\r\n\r\n    if (result?.is_genuine) {\r\n      // Show note input after successful verification\r\n      setShowNoteInput(true);\r\n    }\r\n  };\r\n\r\n  const handleCameraCapture = (file: File) => {\r\n    setShowCamera(false);\r\n    handleFile(file, \"camera\");\r\n  };\r\n\r\n  const reset = () => {\r\n    setPreview(null);\r\n    setVerifyResult(null);\r\n    setPhotoSource(null);\r\n    setUploadedUrl(null);\r\n    setNote(\"\");\r\n    setShowNoteInput(false);\r\n    setShowReason(false);\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (uploadedUrl && verifyResult) {\r\n      onPhotoVerified(uploadedUrl, verifyResult.is_genuine, note.trim() || undefined);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {showCamera && (\r\n        <CameraCapture\r\n          onCapture={handleCameraCapture}\r\n          onClose={() => setShowCamera(false)}\r\n        />\r\n      )}\r\n\r\n      <input\r\n        ref={fileRef}\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        className=\"hidden\"\r\n        onChange={(e) => {\r\n          const file = e.target.files?.[0];\r\n          if (file) handleFile(file, \"upload\");\r\n          e.target.value = \"\";\r\n        }}\r\n      />\r\n\r\n      <div className=\"flex flex-col items-center gap-6 py-4\">\r\n        <div className=\"text-center space-y-2\">\r\n          <div className=\"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\r\n            <ShieldCheck className=\"h-10 w-10 text-primary\" />\r\n          </div>\r\n          <h3 className=\"text-lg font-semibold\">\r\n            {t(\"aiRecipe.resultPhotoTitle\", \"拍摄成品\")}\r\n          </h3>\r\n          <p className=\"text-sm text-muted-foreground max-w-xs\">\r\n            {t(\"aiRecipe.resultPhotoDesc\", \"拍摄或上传成品照片，系统将验证真实性\")}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Upload strictness notice */}\r\n        {!preview && (\r\n          <div className=\"flex items-start gap-2 p-3 rounded-lg w-full max-w-sm bg-amber-50 dark:bg-amber-950/30 text-amber-700 dark:text-amber-400\">\r\n            <AlertTriangle className=\"h-4 w-4 shrink-0 mt-0.5\" />\r\n            <p className=\"text-xs\">\r\n              {t(\"aiRecipe.uploadStricterNote\", \"相册上传将接受更严格的审核，建议直接拍摄\")}\r\n            </p>\r\n          </div>\r\n        )}\r\n\r\n        {preview && (\r\n          <div className=\"w-full max-w-sm rounded-xl overflow-hidden border relative\">\r\n            <img src={preview} alt=\"Result\" className=\"w-full h-48 object-cover\" />\r\n            {photoSource === \"upload\" && (\r\n              <div className=\"absolute top-2 right-2 bg-amber-500 text-primary-foreground text-xs px-2 py-0.5 rounded-full\">\r\n                {t(\"aiRecipe.fromGallery\", \"相册\")}\r\n              </div>\r\n            )}\r\n            {photoSource === \"camera\" && (\r\n              <div className=\"absolute top-2 right-2 bg-primary text-primary-foreground text-xs px-2 py-0.5 rounded-full\">\r\n                {t(\"aiRecipe.fromCamera\", \"拍摄\")}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {(uploading || isVerifying) && (\r\n          <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n            <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n            <span className=\"text-sm\">\r\n              {uploading ? t(\"common.uploading\", \"上传中...\") : t(\"aiRecipe.verifying\", \"验证中...\")}\r\n            </span>\r\n          </div>\r\n        )}\r\n\r\n        {verifyResult && (\r\n          <div className={`w-full max-w-sm rounded-lg overflow-hidden ${\r\n            verifyResult.is_genuine\r\n              ? \"bg-green-50 dark:bg-green-950/30 text-green-700 dark:text-green-400\"\r\n              : \"bg-destructive/10 text-destructive\"\r\n          }`}>\r\n            <div className=\"flex items-center gap-2 p-3\">\r\n              {verifyResult.is_genuine ? (\r\n                <CheckCircle className=\"h-5 w-5 shrink-0\" />\r\n              ) : (\r\n                <XCircle className=\"h-5 w-5 shrink-0\" />\r\n              )}\r\n              <p className=\"text-sm font-medium flex-1\">\r\n                {verifyResult.is_genuine\r\n                  ? t(\"aiRecipe.photoVerified\", \"照片验证通过\")\r\n                  : t(\"aiRecipe.photoNotVerified\", \"照片验证未通过\")}\r\n              </p>\r\n              {!verifyResult.is_genuine && verifyResult.explanation && (\r\n                <button\r\n                  onClick={() => setShowReason(r => !r)}\r\n                  className=\"flex items-center gap-0.5 text-xs opacity-70 hover:opacity-100 shrink-0\"\r\n                >\r\n                  {t(\"aiRecipe.viewReason\", \"原因\")}\r\n                  <ChevronDown className={`h-3.5 w-3.5 transition-transform ${showReason ? \"rotate-180\" : \"\"}`} />\r\n                </button>\r\n              )}\r\n            </div>\r\n            {!verifyResult.is_genuine && showReason && verifyResult.explanation && (\r\n              <div className=\"px-3 pb-3 text-xs opacity-80 border-t border-current/10 pt-2\">\r\n                {verifyResult.explanation}\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Note input — shown after successful verification */}\r\n        {showNoteInput && verifyResult?.is_genuine && (\r\n          <div className=\"w-full max-w-sm space-y-2\">\r\n            <div className=\"flex items-center gap-1.5 text-sm font-medium\">\r\n              <PenLine className=\"h-4 w-4 text-primary\" />\r\n              <span>{t(\"aiRecipe.cookingNote\", \"写下烹饪心得\")}</span>\r\n              <span className=\"text-xs text-muted-foreground font-normal ml-1\">\r\n                {t(\"common.optional\", \"（可选）\")}\r\n              </span>\r\n            </div>\r\n            <Textarea\r\n              placeholder={t(\"aiRecipe.cookingNotePlaceholder\", \"分享一下今天的烹饪体验、技巧或感受...\")}\r\n              value={note}\r\n              onChange={(e) => setNote(e.target.value)}\r\n              rows={3}\r\n              maxLength={500}\r\n              className=\"resize-none text-sm\"\r\n            />\r\n            {note.length > 0 && (\r\n              <p className=\"text-xs text-muted-foreground text-right\">{note.length}/500</p>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Action buttons */}\r\n        {verifyResult?.is_genuine ? (\r\n          <div className=\"flex flex-col gap-2 w-full max-w-sm\">\r\n            <Button\r\n              className=\"w-full gap-2 h-11\"\r\n              onClick={handleConfirm}\r\n            >\r\n              <ArrowRight className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.continueToShare\", \"继续\")}\r\n            </Button>\r\n            <div className=\"flex items-center gap-2 w-full\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                className=\"flex-1 gap-2 text-muted-foreground\"\r\n                onClick={() => setShowCamera(true)}\r\n              >\r\n                <Camera className=\"h-4 w-4\" />\r\n                {t(\"aiRecipe.retakePhoto\", \"重新拍摄\")}\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"h-9 w-9 shrink-0 text-muted-foreground\"\r\n                onClick={() => fileRef.current?.click()}\r\n                title={t(\"aiRecipe.uploadFromGallery\", \"上传相册\")}\r\n              >\r\n                <ImageIcon className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex items-center gap-3 w-full max-w-sm\">\r\n            <Button\r\n              className=\"flex-1 gap-2 h-11\"\r\n              onClick={() => setShowCamera(true)}\r\n              disabled={uploading || isVerifying}\r\n            >\r\n              <Camera className=\"h-4 w-4\" />\r\n              {preview ? t(\"aiRecipe.retakePhoto\", \"重新拍摄\") : t(\"aiRecipe.takeResultPhoto\", \"拍摄成品\")}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"icon\"\r\n              className=\"h-11 w-11 shrink-0\"\r\n              onClick={() => fileRef.current?.click()}\r\n              disabled={uploading || isVerifying}\r\n              title={t(\"aiRecipe.uploadFromGallery\", \"上传相册\")}\r\n            >\r\n              <ImageIcon className=\"h-4 w-4\" />\r\n            </Button>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ResultPhotoStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Globe, PenLine, Video, Loader2, Check, RefreshCw, Download } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport xiaoxiongLogo from \"@/assets/xiaoxiong-logo-clean.png\";\r\nimport { useWatermarkedVideo } from \"@/hooks/useWatermarkedVideo\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { VideoTask, RecipeVideoState } from \"@/hooks/useRecipeVideo\";\r\nimport { RecipeStep } from \"@/components/community/recipe/RecipeTypes\";\r\n\r\nconst MAX_VIDEO_ATTEMPTS = 2;\r\n\r\ninterface PublishConfirmStepProps {\r\n  resultImageUrl: string;\r\n  recipeName: string;\r\n  initialNote?: string;\r\n  onPublish: (notes: string) => void;\r\n  onSkip: () => void;\r\n  isPublishing: boolean;\r\n  recipeSteps?: RecipeStep[];\r\n  videoTask?: VideoTask;\r\n  videoState?: RecipeVideoState;\r\n  onGenerateVideo?: (prompt: string) => void;\r\n  onSelectVideo?: (index: number) => void;\r\n}\r\n\r\nconst PublishConfirmStep = ({ resultImageUrl, recipeName, initialNote = \"\", onPublish, onSkip, isPublishing, recipeSteps, videoTask, videoState, onGenerateVideo, onSelectVideo }: PublishConfirmStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [notes, setNotes] = useState(initialNote);\r\n  const [editingNote, setEditingNote] = useState(false);\r\n\r\n  const isVideoLoading = videoTask?.status === \"creating\" || videoTask?.status === \"processing\";\r\n  const succeededVideos = videoState?.tasks?.filter(t => t.status === \"succeeded\" && t.videoUrl) || [];\r\n  const hasVideo = succeededVideos.length > 0;\r\n  const selectedIndex = videoState?.selectedIndex ?? 0;\r\n  const selectedVideo = succeededVideos[selectedIndex];\r\n\r\n  const selectedVideoUrl = hasVideo ? selectedVideo?.videoUrl ?? null : null;\r\n  const { watermarkedUrl, isMp4 } = useWatermarkedVideo(selectedVideoUrl, xiaoxiongLogo);\r\n\r\n  const handleDownloadVideo = () => {\r\n    const url = watermarkedUrl || selectedVideoUrl;\r\n    if (!url) return;\r\n    const ext = watermarkedUrl ? (isMp4 ? \"mp4\" : \"webm\") : \"mp4\";\r\n    const a = document.createElement(\"a\");\r\n    a.href = url;\r\n    a.download = `${recipeName || \"recipe\"}-xiaoxiong.${ext}`;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    toast.success(t(\"aiRecipe.video.downloadComplete\", \"视频下载完成\"));\r\n  };\r\n  const totalAttempts = videoState?.tasks?.length ?? 0;\r\n  const failedTasks = videoState?.tasks?.filter(t => t.status === \"failed\") || [];\r\n  const canRegenerate = totalAttempts < MAX_VIDEO_ATTEMPTS && !isVideoLoading;\r\n  // Count only non-failed attempts for the limit display\r\n  const attemptsUsed = totalAttempts;\r\n\r\n  const handleGenerateVideo = () => {\r\n    if (!onGenerateVideo) return;\r\n    const notesPart = notes.trim() ? `Cooking notes: ${notes.trim()}. ` : \"\";\r\n    // Summarize recipe steps into the prompt for richer video context\r\n    const stepsSummary = (recipeSteps || [])\r\n      .slice(0, 6)\r\n      .map(s => s.description_en || s.description)\r\n      .filter(Boolean)\r\n      .join(\". \");\r\n    const stepsPart = stepsSummary ? `${stepsSummary}. ` : \"\";\r\n    const prompt = `Step-by-step cooking tutorial video showing the complete preparation process of ${recipeName}. Show hands chopping ingredients, mixing in a bowl, cooking in a pan with oil sizzling. ${stepsPart}${notesPart}Kitchen counter with fresh ingredients, cutting board, knife, pots and pans visible. Warm natural kitchen lighting, steam rising from the pan, close-up of each cooking step, smooth transitions between steps. --duration 5 --camerafixed true`;\r\n    onGenerateVideo(prompt);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center gap-6 py-4\">\r\n      <div className=\"text-center space-y-1\">\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.congratulations\", \"恭喜完成！\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.publishQuestion\", \"要发布到社区吗？\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Dish card: photo/video + note */}\r\n      {resultImageUrl && (\r\n        <div className=\"w-full max-w-sm rounded-xl overflow-hidden border\">\r\n          {/* Main preview: watermarked video or image */}\r\n          {selectedVideoUrl ? (\r\n            !watermarkedUrl ? (\r\n              <div className=\"w-full h-48 bg-muted/30 flex items-center justify-center\">\r\n                <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />\r\n              </div>\r\n            ) : (\r\n              <video\r\n                key={watermarkedUrl}\r\n                src={watermarkedUrl}\r\n                controls\r\n                autoPlay\r\n                muted\r\n                loop\r\n                playsInline\r\n                className=\"w-full h-48 object-cover\"\r\n              />\r\n            )\r\n          ) : (\r\n            <img src={resultImageUrl} alt={recipeName} className=\"w-full h-48 object-cover\" />\r\n          )}\r\n\r\n          {/* Download button */}\r\n          {selectedVideoUrl && (\r\n            <div className=\"px-3 pt-2\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"gap-1.5 h-7 text-xs w-full\"\r\n                onClick={handleDownloadVideo}\r\n              >\r\n                <Download className=\"h-3 w-3\" />\r\n                {t(\"aiRecipe.video.downloadWithWatermark\", \"下载视频\")}\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          {succeededVideos.length > 1 && (\r\n            <div className=\"flex gap-2 px-3 pt-2\">\r\n              {succeededVideos.map((v, idx) => (\r\n                <button\r\n                  key={v.taskId}\r\n                  onClick={() => onSelectVideo?.(idx)}\r\n                  className={`relative w-16 h-16 rounded-lg overflow-hidden border-2 transition-all shrink-0 ${\r\n                    idx === selectedIndex\r\n                      ? \"border-primary ring-1 ring-primary/30\"\r\n                      : \"border-muted opacity-70 hover:opacity-100\"\r\n                  }`}\r\n                >\r\n                  <video\r\n                    src={v.videoUrl!}\r\n                    muted\r\n                    playsInline\r\n                    className=\"w-full h-full object-cover\"\r\n                  />\r\n                  {idx === selectedIndex && (\r\n                    <div className=\"absolute inset-0 bg-primary/10 flex items-center justify-center\">\r\n                      <Check className=\"h-4 w-4 text-primary\" />\r\n                    </div>\r\n                  )}\r\n                  <span className=\"absolute bottom-0.5 right-0.5 text-[9px] bg-black/60 text-white px-1 rounded\">\r\n                    {idx + 1}\r\n                  </span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"p-3 space-y-2\">\r\n            <p className=\"font-medium text-sm\">{recipeName}</p>\r\n\r\n            {/* Cooking note — tap to edit */}\r\n            {editingNote ? (\r\n              <div className=\"space-y-1\">\r\n                <Textarea\r\n                  autoFocus\r\n                  placeholder={t(\"aiRecipe.cookingNotePlaceholder\", \"分享一下今天的烹饪体验、技巧或感受...\")}\r\n                  value={notes}\r\n                  onChange={(e) => setNotes(e.target.value)}\r\n                  rows={3}\r\n                  maxLength={500}\r\n                  className=\"resize-none text-sm\"\r\n                  disabled={isPublishing}\r\n                  onBlur={() => setEditingNote(false)}\r\n                />\r\n                {notes.length > 0 && (\r\n                  <p className=\"text-xs text-muted-foreground text-right\">{notes.length}/500</p>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <button\r\n                className=\"w-full text-left\"\r\n                onClick={() => setEditingNote(true)}\r\n                disabled={isPublishing}\r\n              >\r\n                {notes ? (\r\n                  <p className=\"text-sm text-foreground/80 flex items-start gap-1.5\">\r\n                    <PenLine className=\"h-3.5 w-3.5 mt-0.5 shrink-0 text-primary\" />\r\n                    {notes}\r\n                  </p>\r\n                ) : (\r\n                  <p className=\"text-sm text-muted-foreground flex items-center gap-1.5\">\r\n                    <PenLine className=\"h-3.5 w-3.5 shrink-0\" />\r\n                    {t(\"aiRecipe.addCookingNote\", \"点击添加烹饪心得...\")}\r\n                  </p>\r\n                )}\r\n              </button>\r\n            )}\r\n\r\n            {/* Video generation */}\r\n            {onGenerateVideo && (\r\n              <div className=\"pt-1 space-y-1.5\">\r\n                {isVideoLoading ? (\r\n                  <div className=\"flex items-center gap-2 px-2 py-2 bg-muted/50 rounded-lg\">\r\n                    <Loader2 className=\"h-3.5 w-3.5 animate-spin text-primary\" />\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {videoTask?.status === \"creating\"\r\n                        ? t(\"aiRecipe.video.creating\", \"正在创建视频任务...\")\r\n                        : t(\"aiRecipe.video.processing\", \"AI 视频生成中，请稍候...\")}\r\n                    </span>\r\n                  </div>\r\n                ) : failedTasks.length > 0 && !hasVideo ? (\r\n                  <div className=\"space-y-1.5\">\r\n                    <p className=\"text-xs text-destructive\">{failedTasks[failedTasks.length - 1].error || t(\"aiRecipe.video.failed\", \"视频生成失败\")}</p>\r\n                    {canRegenerate && (\r\n                      <Button\r\n                        variant=\"outline\"\r\n                        size=\"sm\"\r\n                        className=\"gap-1.5 text-xs w-full\"\r\n                        onClick={handleGenerateVideo}\r\n                      >\r\n                        <Video className=\"h-3.5 w-3.5\" />\r\n                        {t(\"aiRecipe.video.retry\", \"重新生成视频\")}\r\n                        <span className=\"text-muted-foreground ml-auto\">({attemptsUsed}/{MAX_VIDEO_ATTEMPTS})</span>\r\n                      </Button>\r\n                    )}\r\n                  </div>\r\n                ) : !hasVideo ? (\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"gap-1.5 text-xs w-full\"\r\n                    onClick={handleGenerateVideo}\r\n                  >\r\n                    <Video className=\"h-3.5 w-3.5\" />\r\n                    {t(\"aiRecipe.video.generateFromNote\", \"根据心得生成视频\")}\r\n                  </Button>\r\n                ) : canRegenerate ? (\r\n                  /* Has video but can regenerate one more */\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"gap-1.5 text-xs w-full\"\r\n                    onClick={handleGenerateVideo}\r\n                  >\r\n                    <RefreshCw className=\"h-3.5 w-3.5\" />\r\n                    {t(\"aiRecipe.video.regenerate\", \"不满意？再生成一个\")}\r\n                    <span className=\"text-muted-foreground ml-auto\">({attemptsUsed}/{MAX_VIDEO_ATTEMPTS})</span>\r\n                  </Button>\r\n                ) : succeededVideos.length > 1 ? (\r\n                  <p className=\"text-xs text-muted-foreground text-center\">\r\n                    {t(\"aiRecipe.video.selectHint\", \"点击上方缩略图切换视频\")}\r\n                  </p>\r\n                ) : null}\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"w-full max-w-sm\">\r\n        <Button\r\n          className=\"w-full gap-2\"\r\n          onClick={() => onPublish(notes)}\r\n          disabled={isPublishing}\r\n        >\r\n          <Globe className=\"h-4 w-4\" />\r\n          {isPublishing\r\n            ? t(\"common.publishing\", \"发布中…\")\r\n            : t(\"aiRecipe.publishToCommunity\", \"发布到社区\")}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PublishConfirmStep;\r\n"],"names":["useAIRecipe","t","i18n","useTranslation","isIdentifying","setIsIdentifying","useState","isGenerating","setIsGenerating","isVerifying","setIsVerifying","isGeneratingImages","setIsGeneratingImages","imageUrl","data","error","supabase","err","toast","ingredients","difficulty","servings","dishCount","notes","excludeDishes","errMsg","recipes","onImageReady","img","recipeName","exifTime","photoSource","file","folder","fileExt","fileName","urlData","CameraCapture","onCapture","onClose","videoRef","useRef","canvasRef","streamRef","isReady","setIsReady","facingMode","setFacingMode","capturing","setCapturing","startStream","useCallback","facing","stream","useEffect","handleFlip","next","handleCapture","video","canvas","ctx","blob","jsxs","jsx","Camera","Button","X","Circle","RotateCcw","ResultPhotoStep","onPhotoVerified","uploadImage","verifyPhoto","uploading","setUploading","preview","setPreview","verifyResult","setVerifyResult","showCamera","setShowCamera","setPhotoSource","uploadedUrl","setUploadedUrl","note","setNote","showNoteInput","setShowNoteInput","showReason","setShowReason","fileRef","handleFile","source","url","result","handleCameraCapture","handleConfirm","Fragment","e","ShieldCheck","AlertTriangle","Loader2","CheckCircle","XCircle","r","ChevronDown","PenLine","Textarea","ArrowRight","ImageIcon","MAX_VIDEO_ATTEMPTS","PublishConfirmStep","resultImageUrl","initialNote","onPublish","onSkip","isPublishing","recipeSteps","videoTask","videoState","onGenerateVideo","onSelectVideo","setNotes","editingNote","setEditingNote","isVideoLoading","succeededVideos","hasVideo","selectedIndex","selectedVideo","selectedVideoUrl","watermarkedUrl","isMp4","useWatermarkedVideo","xiaoxiongLogo","handleDownloadVideo","ext","a","totalAttempts","failedTasks","canRegenerate","attemptsUsed","handleGenerateVideo","notesPart","stepsSummary","s","stepsPart","prompt","Download","v","idx","Check","Video","RefreshCw","Globe"],"mappings":"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"}