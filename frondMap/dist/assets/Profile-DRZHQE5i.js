const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-BqgeOiaE.js","assets/vendor-react-BPYg_yml.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-Z4kpnli5.js","assets/vendor-react-CG6K1Se3.css"])))=>i.map(i=>d[i]);
import{p as H,j as e,bg as $e,s as Te,u as Sa,r as m,bP as ka,bQ as Aa,M as Pa,bR as Da,ak as ra,w as f,b0 as _e,bS as Hs,b1 as Cs,y as Fa,bs as Ea,bT as Ia,bU as $a,bV as Oa,am as Oe,bW as Ta,bX as Ra,bY as Le,bh as Se,b8 as ie,L as R,bw as Bs,bd as ne,bz as Rs,bZ as Ua,bK as za,bO as La,aL as qa,b_ as Ha,bE as _s,bF as Ba,b$ as Ss,c0 as Fe,c1 as Ce,c2 as Ms,a4 as Ma,c3 as Va,c4 as Ka,av as Qa,c5 as Ga,al as Vs,aJ as Ee,q as Wa,c6 as Ks,b4 as Qs}from"./vendor-react-BPYg_yml.js";import{D as ue,d as fe,f as je,g as ge,k as v,u as ve,s as _,N as ia,a0 as na,a1 as Ja,Y as la,B as g,V as Ze,A as ks,h as As,i as Ps,I as w,W as C,a2 as Ge,a3 as We,a4 as Je,a5 as Xe,a6 as Ye,y as Y,z as Z,E as ee,F as se,G as ae,J as te,K as re,L as J,_ as Xa,c as ca,C as k,v as I,M as $,w as A,$ as U,X as Ya,a7 as Za,S as et,a8 as st,n as Ns,Z as at,b as tt,p as rt,a as it}from"./index-GjIgEnMt.js";import{T as ys,a as ws,b as K,c as Q}from"./tabs-DykkKlfT.js";import{C as nt,a as lt,b as qe}from"./carousel-D38qrcMf.js";import{a as ct}from"./useActivities-BRue7UpS.js";import{u as ss}from"./useLocalizedContent-BA29-fLa.js";import{u as ot}from"./useActivityParticipation-BEA5LBU1.js";import{d as dt}from"./useCoupons-DjbYftem.js";import{u as mt,a as xt,b as pt,c as ht,d as ut,P as Gs}from"./PointsHistoryDialog-Cw5BMxaS.js";import{C as ft}from"./checkbox-DeAchLWK.js";import{A as Ws}from"./ActivityTermsAgreement-CJS2QIrN.js";import{S as Ds}from"./separator-DoD-DxY-.js";import{D as de,N as jt,O as He,H as es,p as gt,I as vt,J as Nt}from"./vendor-utils-Z4kpnli5.js";import{P as yt}from"./PullToRefresh-BUSSF-DC.js";import{C as wt,a as bt,b as Ct}from"./collapsible-DubWf8VE.js";import{u as _t,a as St,b as kt,c as At}from"./useInvitationCodes-DrcDVIBc.js";import{F as Pt,a as Be,b as Me,c as Ve,d as Ke,e as Qe}from"./form-C91ItUsi.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-BqgeOiaE.js";import"./usePoints-B4fnxcQs.js";import"./useActivityRules-C8HCsP42.js";function Dt({open:s,onOpenChange:a,activity:r}){const{t}=H();return e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(fe,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(je,{children:e.jsx(ge,{className:"text-lg font-semibold line-clamp-2",children:r.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx($e,{className:"w-3.5 h-3.5 fill-primary text-primary"}),t("profile.activityFavorited")]}),r.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:r.content}})]})]})})}const Ft=()=>{const{user:s}=ve();return Te({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:r}=await _.from("favorites").select("restaurant_id").eq("user_id",s.id);if(r)throw r;if(!a||a.length===0)return[];const t=a.map(o=>o.restaurant_id),{data:d,error:i}=await _.from("restaurants").select("*").in("id",t).eq("visible",!0);if(i)throw i;return d||[]},enabled:!!s})},Et=()=>{const{user:s}=ve();return Te({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:r}=await _.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;if(!a||a.length===0)return[];const t=a.filter(n=>n.target_type==="restaurant").map(n=>n.target_id),d=a.filter(n=>n.target_type==="activity").map(n=>n.target_id),i=new Map;if(t.length>0){const{data:n}=await _.from("restaurants").select("id, name, name_en, name_pt").in("id",t);n?.forEach(p=>{i.set(p.id,{name:p.name,name_en:p.name_en||void 0,name_pt:p.name_pt||void 0})})}const o=new Map;if(d.length>0){const{data:n}=await _.from("activities").select("id, title_zh, title_en, title_pt").in("id",d);n?.forEach(p=>{o.set(p.id,{title_zh:p.title_zh,title_en:p.title_en,title_pt:p.title_pt})})}return a.map(n=>{if(n.target_type==="restaurant"){const p=i.get(n.target_id);return{...n,target_name:p?.name||"Unknown Restaurant",target_name_en:p?.name_en,target_name_pt:p?.name_pt}}else if(n.target_type==="activity"){const p=o.get(n.target_id);return{...n,target_name:p?.title_zh||"Unknown Activity",target_name_en:p?.title_en,target_name_pt:p?.title_pt}}return n})},enabled:!!s,staleTime:3e4})},It=()=>{const{user:s}=ve(),{data:a=[]}=ot();return Te({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||a.length===0)return[];const r=a.map(l=>l.id),{data:t,error:d}=await _.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(d)throw d;if(!t||t.length===0)return[];const{data:i}=await _.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),o=[...new Set(t.map(l=>l.activity_id))],{data:n}=await _.from("activities").select("*").in("id",o).eq("status","published");return t.map(l=>{const u=i?.find(P=>P.id===l.restaurant_id),y=n?.find(P=>P.id===l.activity_id);return{activity_id:l.activity_id,restaurant_id:l.restaurant_id,restaurant_name:u?.name||"",restaurant_name_en:u?.name_en||null,restaurant_name_pt:u?.name_pt||null,restaurant_address:u?.address||"",activity:y||null,created_at:l.created_at}}).filter(l=>l.activity!==null)},enabled:!!s&&a.length>0})},oa=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Js=s=>{if(!s)return{code:"+351",number:""};for(const a of oa)if(s.startsWith(a.code))return{code:a.code,number:s.slice(a.code.length).trim()};return{code:"+351",number:s}},Xs=({profile:s})=>{const{t:a}=H(),r=Sa(),{user:t}=ve(),{isAdmin:d}=ia(),[i,o]=m.useState(!1),[n,p]=m.useState(s.display_name),l=Js(s.phone),[u,y]=m.useState(l.code),[P,F]=m.useState(l.number),[B,D]=m.useState(!1),[M,z]=m.useState(null),[b,E]=m.useState(s.avatar_url||""),[Ne,O]=m.useState(!1),[L,le]=m.useState(!1),[T,S]=m.useState(""),[ke,ye]=m.useState(!1),Ae=m.useRef(!1);m.useEffect(()=>{const c=Ae.current;if(Ae.current=i,i&&!c){p(s.display_name);const h=Js(s.phone);y(h.code),F(h.number),E(s.avatar_url||""),z(null),D(!1)}},[i,s.display_name,s.phone,s.avatar_url]);const[as,ce]=m.useState(!1),[Re,me]=m.useState(!1),[ts,V]=m.useState(!1),[G,xe]=m.useState(""),[x,j]=m.useState(""),[N,q]=m.useState(""),[we,Ue]=m.useState(!1),[pe,ze]=m.useState(!1),[Us,rs]=m.useState(!1),[da,Pe]=m.useState(!1),[ma,De]=m.useState(!1),[is,ns]=m.useState(""),[X,ls]=m.useState(""),[he,cs]=m.useState(""),[zs,os]=m.useState(!1),[ds,ms]=m.useState(""),[be,xs]=m.useState(!1),[Ls,qs]=m.useState(!1),[W,ps]=m.useState(null),hs=m.useRef(null),us=m.useRef(null),fs=m.useRef(null),js=na(),gs=Ja();m.useEffect(()=>{we&&hs.current&&hs.current.focus()},[we]),m.useEffect(()=>{pe&&us.current&&us.current.focus()},[pe]),m.useEffect(()=>{be&&fs.current&&fs.current.focus()},[be]);const xa=c=>{const h=c.target.files?.[0];if(h){if(h.size>2*1024*1024)return;z(h),E(URL.createObjectURL(h))}},pa=async()=>{let c=s.avatar_url;if(M){const oe=await gs.mutateAsync(M);oe&&(c=oe)}const h=P?`${u} ${P}`:void 0;await js.mutateAsync({display_name:n,phone:h,avatar_url:c||void 0}),D(!1),o(!1)},ha=async()=>{if(!(!t||T.toLowerCase()!=="delete")){ye(!0);try{const{error:c}=await _.functions.invoke("delete-account",{body:{userId:t.id}});if(c){f.error(a("profile.deleteAccountFailed")),console.error(c),ye(!1);return}f.success(a("profile.deleteAccountSuccess")),le(!1),O(!1),S(""),await new Promise(h=>setTimeout(h,1500)),await _.auth.signOut(),r("/auth")}catch(c){f.error(c.message||a("profile.deleteAccountFailed")),ye(!1)}finally{ye(!1)}}},ua=async()=>{if(t?.email)try{const{error:c}=await _.functions.invoke("send-verification-code",{body:{email:t.email}});if(c)throw c;Ue(!0),f.success(a("profile.codeSentToOldEmail"))}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},fa=async()=>{if(!x){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:c,error:h}=await _.functions.invoke("verify-email-code",{body:{email:t?.email,code:x}});if(h||!c?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.oldEmailVerified")),ce(!1),me(!0)}catch(c){f.error(a("profile.verificationFailed")),console.error(c)}},ja=async()=>{if(!G||!G.includes("@")){f.error(a("profile.enterValidEmail"));return}try{const{error:c}=await _.functions.invoke("send-verification-code",{body:{email:G}});if(c)throw c;f.success(a("profile.codeSentToNewEmail")),ze(!0)}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},ga=async()=>{if(!N){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:c,error:h}=await _.functions.invoke("verify-email-code",{body:{email:G,code:N}});if(h||!c?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.newEmailVerified")),me(!1),setTimeout(()=>{V(!0)},100)}catch(c){f.error(a("toast.verificationFailed")),console.error(c)}},va=async()=>{rs(!0);try{const{data:{session:c}}=await _.auth.getSession();if(!c||!t){f.error(a("toast.pleaseSignIn")),rs(!1);return}const{data:h,error:oe}=await _.functions.invoke("update-email",{body:{userId:t.id,oldEmail:t.email,oldEmailCode:x,newEmail:G,newEmailCode:N},headers:{Authorization:`Bearer ${c.access_token}`}});if(oe||!h?.success)throw new Error(h?.error||"Failed to update email");f.success(a("toast.emailUpdatedSuccess")),V(!1),o(!1),j(""),xe(""),q(""),Ue(!1),ze(!1),await new Promise(vs=>setTimeout(vs,1500)),await _.auth.signOut(),r("/auth")}catch(c){f.error(c.message||a("toast.emailUpdateError")),console.error(c)}finally{rs(!1)}},Na=c=>{let h=0;return c.length>=6&&h++,c.length>=8&&h++,/[a-z]/.test(c)&&h++,/[A-Z]/.test(c)&&h++,/[0-9]/.test(c)&&h++,/[^a-zA-Z0-9]/.test(c)&&h++,h<=2?"weak":h<=4?"medium":"strong"},ya=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!is){f.error(a("profile.enterCurrentPassword"));return}try{const{createClient:h}=await Xa(async()=>{const{createClient:_a}=await import("./vendor-supabase-BqgeOiaE.js");return{createClient:_a}},__vite__mapDeps([0,1,2,3,4,5])),oe=h("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:vs}=await oe.auth.signInWithPassword({email:t?.email||"",password:is});if(vs){f.error(a("profile.oldPasswordIncorrect"));return}f.success(a("profile.oldPasswordVerified")),Pe(!1),De(!0)}catch(h){f.error(a("profile.verificationFailed")),console.error(h)}},wa=async()=>{if(t?.email)try{const{error:c}=await _.functions.invoke("send-verification-code",{body:{email:t.email}});if(c)throw c;xs(!0),f.success(a("profile.codeSentToOldEmail"))}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},ba=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!ds){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:h,error:oe}=await _.functions.invoke("verify-email-code",{body:{email:t?.email,code:ds}});if(oe||!h?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.oldEmailVerified")),Pe(!1),De(!0)}catch(h){f.error(a("profile.verificationFailed")),console.error(h)}},Ca=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!X||!he){f.error(a("profile.enterNewPassword"));return}if(X.length<6){f.error(a("profile.passwordTooShort"));return}if(X!==he){f.error(a("profile.passwordsDontMatch"));return}qs(!0);try{const{error:h}=await _.auth.updateUser({password:X});if(h)throw h;f.success(a("profile.passwordUpdated")),De(!1),o(!1),ns(""),ls(""),cs(""),os(!1),ms(""),xs(!1)}catch(h){f.error(h.message||a("profile.passwordUpdateFailed")),console.error(h)}finally{qs(!1)}};return e.jsxs(ue,{open:i,onOpenChange:o,children:[e.jsx(la,{asChild:!0,children:e.jsxs(g,{variant:"outline",children:[e.jsx(ka,{className:"w-4 h-4 mr-2"}),a("profile.editProfile")]})}),e.jsxs(fe,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsx(ge,{children:a("profile.editProfile")}),e.jsx(Ze,{children:a("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(ks,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(As,{src:b}),e.jsx(Ps,{children:n?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(w,{type:"file",accept:"image/*",onChange:xa,className:"hidden",id:"avatar-upload"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(Aa,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{htmlFor:"displayName",className:"text-sm",children:a("profile.displayName")}),e.jsx(w,{id:"displayName",value:n,onChange:c=>p(c.target.value),placeholder:a("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(C,{htmlFor:"phone",className:"text-sm",children:a("profile.phone")}),!s.phone&&!B?e.jsx(g,{variant:"outline",size:"sm",onClick:()=>D(!0),className:"w-full justify-start h-9",children:a("profile.addPhoneNumber")}):B||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ge,{value:u,onValueChange:y,children:[e.jsx(We,{className:"w-[110px] h-9",children:e.jsx(Je,{placeholder:"+351"})}),e.jsx(Xe,{children:oa.map(c=>e.jsx(Ye,{value:c.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.flag}),e.jsx("span",{children:c.code})]})},c.code))})]}),e.jsx(w,{id:"phone",className:"flex-1 h-9",value:P,onChange:c=>F(c.target.value),placeholder:a("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{value:`${u} ${P}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>D(!0),className:"text-xs whitespace-nowrap",children:a("profile.modifyPhoneNumber")})]})]}),!d&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(C,{className:"text-sm",children:a("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{value:t?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>ce(!0),className:"text-xs",children:[e.jsx(Pa,{className:"w-3 h-3 mr-1"}),a("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${d?"pt-2 border-t":""}`,children:[e.jsx(C,{className:"text-sm",children:a("profile.changePassword")}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>Pe(!0),className:"w-full justify-start h-9",children:[e.jsx(Da,{className:"w-3 h-3 mr-2"}),a("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!d&&e.jsxs(g,{variant:"destructive",size:"sm",onClick:()=>O(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(ra,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${d?"sm:ml-auto":""}`,children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>{D(!1),o(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:a("common.cancel")}),e.jsx(g,{size:"sm",onClick:pa,disabled:js.isPending||gs.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:js.isPending||gs.isPending?a("common.loading"):a("common.save")})]})]})]}),e.jsx(Y,{open:Ne,onOpenChange:O,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.deleteAccountWarning")}),e.jsx(ae,{children:a("profile.deleteAccountDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{children:a("common.cancel")}),e.jsx(J,{onClick:()=>{O(!1),le(!0)},className:"bg-destructive hover:bg-destructive/90",children:a("common.continue")})]})]})}),e.jsx(Y,{open:L,onOpenChange:le,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.confirmDeleteAccount")}),e.jsxs(ae,{className:"space-y-4",children:[e.jsx("p",{children:a("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"confirm-delete",children:a("profile.typeDeleteToConfirm")}),e.jsx(w,{id:"confirm-delete",value:T,onChange:c=>S(c.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>S(""),children:a("common.cancel")}),e.jsx(J,{onClick:ha,disabled:T.toLowerCase()!=="delete"||ke,className:"bg-destructive hover:bg-destructive/90",children:a(ke?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(Y,{open:as,onOpenChange:ce,children:e.jsxs(Z,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.verifyOldEmail")}),e.jsx(ae,{children:a("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:ua,disabled:we,children:a(we?"profile.codeSent":"profile.sendCode")})]})]}),we&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.verificationCode")}),e.jsx(w,{ref:hs,value:x,onChange:c=>j(c.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{ce(!1),setTimeout(()=>{j(""),Ue(!1)},300)},children:a("common.cancel")}),we&&e.jsx(J,{onClick:fa,children:a("profile.verify")})]})]})}),e.jsx(Y,{open:Re,onOpenChange:me,children:e.jsxs(Z,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{className:"text-center space-y-3",children:[e.jsx(se,{className:"text-xl",children:a("profile.verifyNewEmail")}),e.jsx(ae,{className:"text-center",children:a("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{className:"text-sm font-normal",children:a("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{type:"email",value:G,onChange:c=>xe(c.target.value),placeholder:a("profile.enterNewEmail"),disabled:pe,className:"border-2 focus:border-primary flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:ja,disabled:!G||pe,className:"text-xs whitespace-nowrap px-3",children:a(pe?"profile.codeSent":"profile.sendCode")})]})]}),pe&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(C,{className:"text-sm font-normal",children:a("profile.verificationCode")}),e.jsx(w,{ref:us,value:N,onChange:c=>q(c.target.value),placeholder:a("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(te,{className:"flex-col sm:flex-col gap-2",children:[pe&&e.jsx(J,{onClick:ga,disabled:!N||N.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(re,{onClick:()=>{me(!1),setTimeout(()=>{xe(""),q(""),ze(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(Y,{open:ts,onOpenChange:V,children:e.jsxs(Z,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(ae,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:G})]})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{V(!1),setTimeout(()=>{j(""),xe(""),q(""),Ue(!1),ze(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(J,{onClick:va,disabled:Us,children:Us?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(Y,{open:da,onOpenChange:Pe,children:e.jsxs(Z,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.verifyOldPassword")}),e.jsx(ae,{children:a("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:zs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(g,{variant:"outline",size:"sm",onClick:wa,disabled:be,children:a(be?"profile.codeSent":"profile.sendCode")})]})]}),be&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.verificationCode")}),e.jsx(w,{ref:fs,value:ds,onChange:c=>ms(c.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.currentPassword")}),e.jsx(w,{type:"password",value:is,onChange:c=>ns(c.target.value),placeholder:a("profile.enterCurrentPassword")})]}),e.jsxs(g,{variant:"link",size:"sm",onClick:()=>os(!0),className:"text-xs p-0 h-auto",children:[a("profile.forgotPassword")," ",a("profile.useEmailVerification")]})]})}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{Pe(!1),setTimeout(()=>{ns(""),os(!1),ms(""),xs(!1)},300)},children:a("common.cancel")}),zs?be&&e.jsx(J,{onClick:ba,children:a("profile.verify")}):e.jsx(J,{onClick:ya,children:a("profile.verify")})]})]})}),e.jsx(Y,{open:ma,onOpenChange:De,children:e.jsxs(Z,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.setNewPassword")}),e.jsx(ae,{children:a("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.newPassword")}),e.jsx(w,{type:"password",value:X,onChange:c=>{ls(c.target.value),c.target.value?ps(Na(c.target.value)):ps(null)},placeholder:a("profile.enterNewPassword")}),W&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="weak"?"bg-destructive":W==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="medium"||W==="strong"?W==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${W==="weak"?"text-destructive":W==="medium"?"text-warning":"text-success"}`,children:a(`auth.passwordStrength.${W}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{children:a("profile.confirmNewPassword")}),e.jsx(w,{type:"password",value:he,onChange:c=>cs(c.target.value),placeholder:a("profile.confirmNewPasswordPlaceholder")})]}),X&&he&&X!==he&&e.jsx("p",{className:"text-sm text-destructive",children:a("profile.passwordsDontMatch")})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{De(!1),setTimeout(()=>{ls(""),cs(""),ps(null)},300)},children:a("common.cancel")}),e.jsx(J,{onClick:Ca,disabled:!X||!he||X!==he||Ls,children:a(Ls?"common.loading":"profile.updatePassword")})]})]})})]})},Fs=[{value:"Home",icon:Ia,labelKey:"address.labelHome"},{value:"Work",icon:$a,labelKey:"address.labelWork"},{value:"Office",icon:Oa,labelKey:"address.labelOffice"},{value:"Other",icon:_e,labelKey:"address.labelOther"}],$t=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Ot=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],Ys=({initialData:s,onSubmit:a,onCancel:r,isLoading:t,isEdit:d})=>{const{t:i}=H(),[o,n]=m.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),p=l=>{l.preventDefault(),a(o)};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"label",children:i("address.label")}),e.jsxs(Ge,{value:o.label,onValueChange:l=>n({...o,label:l}),children:[e.jsx(We,{children:e.jsx(Je,{placeholder:i("address.selectLabel")})}),e.jsx(Xe,{children:Fs.map(l=>e.jsx(Ye,{value:l.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l.icon,{className:"w-4 h-4"}),i(l.labelKey)]})},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"street",children:[i("address.street")," *"]}),e.jsx(w,{id:"street",value:o.street,onChange:l=>n({...o,street:l.target.value}),placeholder:i("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{htmlFor:"district",children:i("address.district")}),e.jsx(w,{id:"district",value:o.district,onChange:l=>n({...o,district:l.target.value}),placeholder:i("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"city",children:[i("address.city")," *"]}),e.jsx(w,{id:"city",value:o.city,onChange:l=>n({...o,city:l.target.value}),placeholder:i("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"postal_code",children:[i("address.postalCode")," *"]}),e.jsx(w,{id:"postal_code",value:o.postal_code,onChange:l=>n({...o,postal_code:l.target.value}),placeholder:i("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"country",children:[i("address.country")," *"]}),e.jsxs(Ge,{value:o.country,onValueChange:l=>n({...o,country:l}),children:[e.jsx(We,{children:e.jsx(Je,{placeholder:i("address.selectCountry")})}),e.jsx(Xe,{children:Ot.map(l=>e.jsx(Ye,{value:l,children:l},l))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{htmlFor:"phone",children:[i("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ge,{value:o.phone_code,onValueChange:l=>n({...o,phone_code:l}),children:[e.jsx(We,{className:"w-[130px]",children:e.jsx(Je,{placeholder:"+351"})}),e.jsx(Xe,{children:$t.map(l=>e.jsx(Ye,{value:l.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:l.flag}),e.jsx("span",{children:l.code})]})},l.code))})]}),e.jsx(w,{id:"phone",className:"flex-1",value:o.phone,onChange:l=>n({...o,phone:l.target.value}),placeholder:i("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ft,{id:"is_default",checked:o.is_default,onCheckedChange:l=>n({...o,is_default:l})}),e.jsx(C,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:i("address.setAsDefault")})]}),e.jsxs(Ya,{className:"gap-2 sm:gap-0",children:[e.jsx(g,{type:"button",variant:"outline",onClick:r,children:i("common.cancel")}),e.jsx(g,{type:"submit",disabled:t,children:i(t?"common.saving":d?"common.save":"address.add")})]})]})},Tt=({address:s,onEdit:a,onDelete:r,onSetDefault:t,isDeleting:d,isSettingDefault:i,canDelete:o=!0})=>{const{t:n}=H(),p=Fs.find(u=>u.value===s.label)||Fs[3],l=p.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(l,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:n(p.labelKey)}),s.is_default&&e.jsxs(v,{variant:"secondary",className:"text-xs",children:[e.jsx(Cs,{className:"w-3 h-3 mr-1 fill-current"}),n("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Fa,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>t(s.id),disabled:i,title:n("address.setAsDefault"),children:e.jsx(Cs,{className:"w-4 h-4"})}),e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>a(s),title:n("common.edit"),children:e.jsx(Ea,{className:"w-4 h-4"})}),o&&e.jsxs(Y,{children:[e.jsx(Za,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:n("common.delete"),children:e.jsx(ra,{className:"w-4 h-4"})})}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:n("address.deleteTitle")}),e.jsx(ae,{children:n("address.deleteDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{children:n("common.cancel")}),e.jsx(J,{onClick:()=>r(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:d,children:n(d?"common.deleting":"common.delete")})]})]})]})]})]})})},Zs=()=>{const{t:s}=H(),{data:a,isLoading:r}=mt(),{data:t}=ca(),d=xt(),i=pt(),o=na(),n=ht(),p=ut(),[l,u]=m.useState(!1),[y,P]=m.useState(null),[F,B]=m.useState(null),[D,M]=m.useState(!1),z=!t?.phone,b=S=>{if(z&&S.phone){B(S),M(!0);return}d.mutate(S,{onSuccess:()=>u(!1)})},E=()=>{if(!F)return;const S=`${F.phone_code||"+351"} ${F.phone}`;o.mutate({phone:S}),d.mutate(F,{onSuccess:()=>{u(!1),B(null),M(!1)}})},Ne=()=>{B(null),M(!1)},O=S=>{y&&i.mutate({id:y.id,address:S},{onSuccess:()=>P(null)})},L=S=>{n.mutate(S)},le=S=>{p.mutate(S)};if(r)return e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(A,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const T=a&&a.length>0;return e.jsxs(k,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(U,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),T&&e.jsxs(ue,{open:l,onOpenChange:u,children:[e.jsx(la,{asChild:!0,children:e.jsxs(g,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(fe,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsx(ge,{children:s("address.addNew")}),e.jsx(Ze,{children:s("address.addDescription")})]}),e.jsx(Ys,{onSubmit:b,onCancel:()=>u(!1),isLoading:d.isPending})]})]})]})}),e.jsx(A,{children:T?e.jsx("div",{className:"space-y-4",children:a.map(S=>e.jsx(Tt,{address:S,onEdit:P,onDelete:L,onSetDefault:le,isDeleting:n.isPending,isSettingDefault:p.isPending,canDelete:a.length>1},S.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(g,{onClick:()=>u(!0),children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(ue,{open:!!y,onOpenChange:()=>P(null),children:e.jsxs(fe,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsx(ge,{children:s("address.editAddress")}),e.jsx(Ze,{children:s("address.editDescription")})]}),y&&e.jsx(Ys,{initialData:y,onSubmit:O,onCancel:()=>P(null),isLoading:i.isPending,isEdit:!0})]})}),e.jsx(Y,{open:D,onOpenChange:M,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:s("address.phoneConfirmTitle")}),e.jsx(ae,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:Ne,children:s("common.cancel")}),e.jsx(J,{onClick:E,disabled:d.isPending||o.isPending,children:d.isPending||o.isPending?s("common.saving"):s("common.confirm")})]})]})})]})},Rt=({open:s,onOpenChange:a,coupon:r})=>{const{t}=H(),{getLocalizedField:d}=ss(),[i,o]=m.useState(!1),n=r.coupon_codes?.coupon_templates,p=r.coupon_codes?.code,l=!!r.used_at;return e.jsx(ue,{open:s,onOpenChange:u=>{a(u),u||o(!1)},children:e.jsxs(fe,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(je,{children:e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-primary"}),t("profile.coupons.details")]})}),e.jsx(et,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:d(n,"title")}),e.jsx(v,{variant:l?"secondary":"default",children:t(l?"profile.coupons.used":"profile.coupons.available")})]}),n?.description_zh||n?.description_en||n?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:d(n,"description")}):null]}),e.jsx(Ds,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>o(!i),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Ta,{value:p||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:p}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ra,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:t("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Le,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:n?.discount_type==="percentage"?`${n?.discount_value}% OFF`:`â‚¬${n?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:de(new Date(r.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),l&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:de(new Date(r.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.valid_until?`${de(new Date(n.valid_from),"yyyy-MM-dd")} - ${de(new Date(n.valid_until),"yyyy-MM-dd")}`:t("profile.coupons.noExpiry")})]})]}),n?.min_order_amount&&n.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Le,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.min_order_amount]})]})]}),n?.max_discount_amount&&n.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Le,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.max_discount_amount]})]})]}),e.jsx(Ds,{}),r.activity_id&&r.source==="share"&&e.jsxs(R,{to:`/activity/${r.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Le,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[t("profile.coupons.source"),": ",t("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t("profile.coupons.viewActivity"),")"]})]})]})})]})})},Ut=()=>{const{user:s}=ve();return Te({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:r}=await _.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(r)throw r;return a},enabled:!!s?.email})},zt=()=>{const{user:s}=ve();return Te({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:r}=await _.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(r)throw r;return a},enabled:!!s?.email})},ea=()=>{const{t:s}=H(),{data:a,isLoading:r}=Ut(),{getLocalizedField:t}=ss(),d=i=>{switch(i){case"confirmed":return e.jsx(v,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(v,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(v,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(v,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(v,{variant:"outline",children:i})}};return e.jsxs(k,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Bs,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(U,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(A,{className:"px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(i=>{const o=i.restaurants?t(i.restaurants,"name"):i.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:i.restaurant_id?e.jsxs(R,{to:`/restaurant/${i.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]})}),d(i.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Bs,{className:"w-3 h-3"}),de(new Date(i.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-3 h-3"}),i.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-3 h-3"}),i.party_size," ",s("booking.people")]})]}),i.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:i.notes})]},i.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},sa=()=>{const{t:s}=H(),{data:a,isLoading:r}=zt(),{getLocalizedField:t}=ss(),d=i=>{switch(i){case"completed":return e.jsx(v,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(v,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(v,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(v,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(v,{variant:"outline",children:i})}};return e.jsxs(k,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ua,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(U,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(A,{className:"px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(i=>{const o=i.restaurants?t(i.restaurants,"name"):i.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:i.restaurant_id?e.jsxs(R,{to:`/restaurant/${i.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]})}),d(i.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:de(new Date(i.order_date),"yyyy-MM-dd HH:mm")}),i.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",i.total_amount.toFixed(2)]})]}),i.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(_e,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:i.delivery_address})]}),i.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:i.notes})]},i.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},Lt=jt({full_name:He().min(2,"å§“åè‡³å°‘2ä¸ªå­—ç¬¦"),nif:He().min(9,"NIFè‡³å°‘9ä½").max(15,"NIFæœ€å¤š15ä½"),contact:He().min(5,"è”ç³»æ–¹å¼è‡³å°‘5ä¸ªå­—ç¬¦"),address:He().min(5,"åœ°å€è‡³å°‘5ä¸ªå­—ç¬¦")}),bs=({open:s,onOpenChange:a,mode:r,existingData:t})=>{const{t:d}=H(),i=_t(),o=St(),n=za({resolver:La(Lt),defaultValues:{full_name:t?.full_name||"",nif:t?.nif||"",contact:t?.contact||"",address:t?.address||""}});m.useEffect(()=>{s&&t?n.reset({full_name:t.full_name||"",nif:t.nif||"",contact:t.contact||"",address:t.address||""}):s&&!t&&n.reset({full_name:"",nif:"",contact:"",address:""})},[s,t,n]);const p=async u=>{try{const y={full_name:u.full_name,nif:u.nif,contact:u.contact,address:u.address};r==="reapply"&&t?.id?await o.mutateAsync({id:t.id,data:y}):await i.mutateAsync(y),a(!1),n.reset()}catch{}},l=i.isPending||o.isPending;return e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsxs(je,{children:[e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-primary"}),r==="apply"?d("profile.invitationCode.applyTitle","ç”³è¯·é‚€è¯·ç "):d("profile.invitationCode.reapplyTitle","é‡æ–°ç”³è¯·é‚€è¯·ç ")]}),e.jsx(Ze,{children:d("profile.invitationCode.applyDesc","è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ä»¥ç”³è¯·ä¸“å±žé‚€è¯·ç ")})]}),e.jsx(Pt,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(p),className:"space-y-4",children:[e.jsx(Be,{control:n.control,name:"full_name",render:({field:u})=>e.jsxs(Me,{children:[e.jsx(Ve,{children:d("profile.invitationCode.fullName","å…¨å")}),e.jsx(Ke,{children:e.jsx(w,{placeholder:d("profile.invitationCode.fullNamePlaceholder","è¯·è¾“å…¥æ‚¨çš„å…¨å"),...u})}),e.jsx(Qe,{})]})}),e.jsx(Be,{control:n.control,name:"nif",render:({field:u})=>e.jsxs(Me,{children:[e.jsx(Ve,{children:d("profile.invitationCode.nif","NIF (ç¨ŽåŠ¡è¯†åˆ«å·)")}),e.jsx(Ke,{children:e.jsx(w,{placeholder:d("profile.invitationCode.nifPlaceholder","è¯·è¾“å…¥æ‚¨çš„NIF"),...u})}),e.jsx(Qe,{})]})}),e.jsx(Be,{control:n.control,name:"contact",render:({field:u})=>e.jsxs(Me,{children:[e.jsx(Ve,{children:d("profile.invitationCode.contact","è”ç³»æ–¹å¼")}),e.jsx(Ke,{children:e.jsx(w,{placeholder:d("profile.invitationCode.contactPlaceholder","è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆç”µè¯/å¾®ä¿¡ç­‰ï¼‰"),...u})}),e.jsx(Qe,{})]})}),e.jsx(Be,{control:n.control,name:"address",render:({field:u})=>e.jsxs(Me,{children:[e.jsx(Ve,{children:d("profile.invitationCode.address","åœ°å€")}),e.jsx(Ke,{children:e.jsx(st,{placeholder:d("profile.invitationCode.addressPlaceholder","è¯·è¾“å…¥æ‚¨çš„åœ°å€"),className:"resize-none",rows:3,...u})}),e.jsx(Qe,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>a(!1),children:d("common.cancel","å–æ¶ˆ")}),e.jsxs(g,{type:"submit",disabled:l,children:[l&&e.jsx(qa,{className:"w-4 h-4 mr-2 animate-spin"}),r==="apply"?d("profile.invitationCode.submit","æäº¤ç”³è¯·"):d("profile.invitationCode.resubmit","é‡æ–°æäº¤")]})]})]})})]})})},Ie=({open:s,onOpenChange:a})=>{const{t:r}=H();return e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(fe,{className:"sm:max-w-md",children:[e.jsx(je,{children:e.jsx(ge,{className:"flex items-center gap-2",children:r("profile.invitationCode.helpTitle","é‚€è¯·ç ä½¿ç”¨è¯´æ˜Ž")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ha,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpRequirements","ç”³è¯·è¦æ±‚")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpRequirementsDesc","ç”³è¯·é‚€è¯·ç éœ€æä¾›ï¼šå…¨åã€NIFï¼ˆç¨ŽåŠ¡è¯†åˆ«å·ï¼‰ã€è”ç³»æ–¹å¼ã€åœ°å€")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpUsage","ä½¿ç”¨æ¡ä»¶")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpUsageDesc",'é‚€è¯·ç åªèƒ½åœ¨"åŠ å…¥æˆ‘ä»¬"ç”³è¯·ä¸­ä½¿ç”¨ï¼Œä¸”ä»…åœ¨å‹¾é€‰"æ‰«ç ç‚¹é¤"åŠŸèƒ½åŽæ‰èƒ½å¡«å†™')})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ba,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpBenefit","ç¦åˆ©è¯´æ˜Ž")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpBenefitDesc","æˆåŠŸé‚€è¯·å•†å®¶åŽï¼Œè¢«é‚€è¯·äººå¯èŽ·å¾—ä»·å€¼99æ¬§å…ƒçš„é¢å¤–å…è´¹æœˆã€‚é‚€è¯·åŒæ–¹å¯è‡ªç”±åå•†ç¦åˆ©åˆ†é…æ–¹å¼ã€‚")})]}),e.jsx(Ds,{}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:r("profile.invitationCode.copyright","Â© 2026 å°ç†Šå¸‚åœº. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚æœ€ç»ˆè§£é‡Šæƒå½’å°ç†Šå¸‚åœºæ‰€æœ‰ã€‚")})]})]})})},aa=s=>{switch(s){case"zh":return Nt;case"pt":return vt;default:return gt}},ta=({isMobile:s})=>{const{t:a,i18n:r}=H(),{data:t,isLoading:d}=kt(),{data:i=[]}=At(),[o,n]=m.useState(!1),[p,l]=m.useState(!1),[u,y]=m.useState(!1),[P,F]=m.useState(!1),B=async()=>{t?.code&&(await navigator.clipboard.writeText(t.code),y(!0),at({title:a("profile.invitationCode.copied","å·²å¤åˆ¶"),description:a("profile.invitationCode.copiedDesc","é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}),setTimeout(()=>y(!1),2e3))},D=i.filter(b=>!(t?.status==="approved"&&b.id===t.id||b.id===t?.id)),M=(b,E)=>{switch(b){case"pending":return e.jsxs(v,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]});case"approved":return e.jsxs(v,{variant:"outline",className:"text-primary border-primary",children:[e.jsx(_s,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.approved","å·²é€šè¿‡")]});case"rejected":return e.jsxs(v,{variant:"destructive",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]});case"revoked":return e.jsxs(v,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]});default:return null}},z=()=>D.length===0?null:e.jsxs(wt,{open:P,onOpenChange:F,className:"mt-4",children:[e.jsx(bt,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"w-full justify-between text-muted-foreground hover:text-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ka,{className:"w-4 h-4"}),a("profile.invitationCode.history","åŽ†å²è®°å½•")," (",D.length,")"]}),e.jsx(Qa,{className:`w-4 h-4 transition-transform ${P?"rotate-180":""}`})]})}),e.jsx(Ct,{className:"mt-2 space-y-2",children:D.map(b=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono font-medium",children:b.code}),M(b.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[a("profile.invitationCode.appliedAt","ç”³è¯·æ—¶é—´"),": ",es(new Date(b.created_at),{addSuffix:!0,locale:aa(r.language)})]}),b.reviewed_at&&e.jsxs("p",{children:[a("profile.invitationCode.reviewedAt","å®¡æ ¸æ—¶é—´"),": ",es(new Date(b.reviewed_at),{addSuffix:!0,locale:aa(r.language)})]}),b.rejection_reason&&e.jsxs("p",{className:"text-destructive",children:[a("profile.invitationCode.reason","åŽŸå› "),": ",b.rejection_reason]}),b.status==="approved"&&e.jsxs("p",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",b.usage_count," ",a("profile.invitationCode.people","äºº")]})]})]},b.id))})]});return d?e.jsxs(k,{children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsx(Ns,{className:"h-6 w-32"}),e.jsx(Ns,{className:"h-4 w-48 mt-2"})]}),e.jsx(A,{className:s?"px-4 pb-4":"",children:e.jsx(Ns,{className:"h-20 w-full"})})]}):t?t.status==="pending"?e.jsxs(k,{className:"border-yellow-500/30",children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-yellow-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(U,{children:a("profile.invitationCode.pendingDesc","æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­")})]}),e.jsxs(A,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(v,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("profile.invitationCode.pendingMessage","ç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å®¡æ ¸é€šè¿‡åŽæ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚")})]}),z()]}),e.jsx(Ie,{open:p,onOpenChange:l})]}):t.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:"border-destructive/30",children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-destructive"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(U,{children:a("profile.invitationCode.rejectedDesc","æ‚¨çš„ç”³è¯·æœªé€šè¿‡å®¡æ ¸")})]}),e.jsxs(A,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-destructive/10 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(v,{variant:"destructive",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]})]}),e.jsxs(g,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),z()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx(Ie,{open:p,onOpenChange:l})]}):t.status==="revoked"?e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:"border-orange-500/30",children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-orange-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(U,{children:a("profile.invitationCode.revokedDesc","æ‚¨çš„é‚€è¯·ç å·²è¢«æ”¶å›ž")})]}),e.jsxs(A,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(v,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ce,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a("profile.invitationCode.revokedMessage","æ‚¨çš„é‚€è¯·ç å·²è¢«ç®¡ç†å‘˜æ”¶å›žï¼Œå¦‚éœ€ç»§ç»­ä½¿ç”¨è¯·é‡æ–°ç”³è¯·ã€‚")})]}),e.jsxs(g,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),z()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx(Ie,{open:p,onOpenChange:l})]}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{className:"border-primary/30",children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(U,{children:a("profile.invitationCode.approvedDesc","åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™æ–°å•†å®¶")})]}),e.jsxs(A,{className:s?"px-4 pb-4":"",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:a("profile.invitationCode.yourCode","æ‚¨çš„é‚€è¯·ç ")}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary tracking-wider",children:t.code})]}),e.jsx(g,{variant:"outline",size:"icon",onClick:B,className:"flex-shrink-0",children:u?e.jsx(Ma,{className:"w-4 h-4 text-primary"}):e.jsx(Va,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsxs("span",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",t.usage_count," ",a("profile.invitationCode.people","äºº")]})]}),z()]})]}),e.jsx(Ie,{open:p,onOpenChange:l})]}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{children:[e.jsxs(I,{className:s?"p-4":"",children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(g,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(U,{children:a("profile.invitationCode.noCodeDesc","ç”³è¯·ä¸“å±žé‚€è¯·ç ï¼Œé‚€è¯·æ–°å•†å®¶åŠ å…¥å¹³å°")})]}),e.jsxs(A,{className:s?"px-4 pb-4":"",children:[e.jsxs(g,{onClick:()=>n(!0),className:"w-full",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.apply","ç”³è¯·é‚€è¯·ç ")]}),z()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"apply"}),e.jsx(Ie,{open:p,onOpenChange:l})]})},Es=m.memo(({comment:s,getLocalizedField:a,t:r})=>{const t=s.moderation_status==="flagged",d=s.moderation_status==="pending",i=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const o={spam:r("riskReason.spam"),offensive:r("riskReason.offensive"),harassment:r("riskReason.harassment"),fake_review:r("riskReason.fakeReview"),flooding:r("riskReason.flooding"),irrelevant:r("riskReason.irrelevant"),sensitive_word_detected:r("riskReason.sensitiveWord"),parse_error:r("riskReason.parseError")};return s.risk_reasons.map(n=>o[n]||n).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(R,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:a(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:es(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),d&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(v,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),r("restaurant.commentPending")]})}),t&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(v,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(Ga,{className:"w-3 h-3 mr-1"}),r("restaurant.commentFailed")]}),i()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[r("restaurant.failReason"),": ",i()]})]})]})});Es.displayName="CommentItem";const Is=m.memo(({restaurant:s,getLocalizedField:a,t:r})=>{if(!s||!s.id)return null;const t=a(s,"name")||s.name||"",d=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(R,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t),className:"w-full h-full object-cover",loading:"lazy",onError:i=>{i.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:d}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[r("restaurant.noRatingLine1"),e.jsx("br",{}),r("restaurant.noRatingLine2")]})]})]})]})});Is.displayName="FavoriteRestaurantItem";const $s=m.memo(({subscription:s,getLocalizedField:a,t:r,isMobile:t})=>{const[d,i]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>i(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${t?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(a(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[r("profile.joinedOn"),":"," ",es(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx($e,{className:`text-primary fill-primary flex-shrink-0 ${t?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(Dt,{open:d,onOpenChange:i,activity:{title:String(a(s.activity,"title")),image_url:s.activity?.image_url,content:String(a(s.activity,"content"))}})]})});$s.displayName="ActivitySubscriptionItem";const Os=m.memo(({activityGroup:s,getLocalizedField:a,t:r,isMobile:t})=>{const d=s.activity,i=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${t?"p-3":"p-4"}`,children:[e.jsx(R,{to:`/activity/${d.id}`,className:t?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[d.image_url&&e.jsx("img",{src:d.image_url,alt:String(a(d,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(d,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(d,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),new Date(d.start_date).toLocaleDateString()]}),d.end_date&&e.jsxs("span",{children:["- ",new Date(d.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${t?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${t?"mb-1.5":"mb-2"}`,children:[e.jsx(ne,{className:`text-primary ${t?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${t?"text-xs":"text-sm"}`,children:[r("profile.participatingRestaurants")," (",i.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${t?"gap-1.5":"gap-2"}`,children:i.map(o=>e.jsx(v,{variant:"secondary",className:t?"text-xs px-2 py-0.5":"text-xs",children:a(o,"name")},o.id))})]})]})});Os.displayName="MerchantActivityItem";const Ts=m.memo(({coupon:s,getLocalizedField:a,t:r,isMobile:t})=>{const[d,i]=m.useState(!1),o=s.coupon_codes?.coupon_templates,n=s.coupon_codes?.code,p=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${p?"bg-muted/30":"hover:shadow-medium"} ${t?"p-3":"p-4"}`,onClick:()=>i(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":"text-base"}`,children:a(o,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${t?"text-xs":"text-sm"}`,children:a(o,"description")})]}),e.jsx(v,{variant:p?"secondary":"default",className:t?"text-xs":"",children:r(p?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${t?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:n}),e.jsx("span",{className:"text-muted-foreground",children:o?.discount_type==="percentage"?`${o?.discount_value}%`:`â‚¬${o?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${t?"text-xs":"text-sm"}`,children:p?e.jsxs("span",{children:[r("profile.coupons.usedOn"),": ",de(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):o?.valid_until?e.jsxs("span",{children:[r("profile.coupons.validUntil"),": ",de(new Date(o.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:r("profile.coupons.noExpiry")})})]}),e.jsx(Rt,{open:d,onOpenChange:i,coupon:s})]})});Ts.displayName="UserCouponItem";const or=()=>{const{t:s}=H(),{user:a}=ve(),r=tt();rt();const{data:t,isLoading:d}=ca(),{data:i,isLoading:o}=Ft(),{data:n,isLoading:p}=Et(),{data:l,isLoading:u}=ct(),{data:y,isLoading:P}=It(),{data:F,isLoading:B}=dt(),{role:D,isMerchant:M,isSupervisor:z,isAdmin:b}=ia(),{getLocalizedField:E}=ss(),{settings:Ne}=it(),O=M||z,[L,le]=m.useState("profile"),[T,S]=m.useState(),[ke,ye]=m.useState({}),[Ae,as]=m.useState(new Set(["profile"])),ce=O?[{value:"profile",label:s("profile.profile"),icon:Vs},{value:"favorites",label:s("profile.favorites"),icon:$e},{value:"comments",label:s("profile.comments"),icon:Ee},{value:"activities",label:s("profile.participatedActivities"),icon:ie}]:[{value:"profile",label:s("profile.profile"),icon:Vs},{value:"favorites",label:s("profile.favorites"),icon:$e},{value:"comments",label:s("profile.comments"),icon:Ee}],Re=x=>{ye(j=>({...j,[x]:window.scrollY}))},me=x=>{if(Ae.has(x)){const j=ke[x]||0;requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:j,behavior:"instant"})})})}else requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"instant"})})}),as(j=>new Set([...j,x]))};m.useEffect(()=>{if(!T)return;const x=()=>{const j=T.selectedScrollSnap(),N=ce[j].value;N!==L&&(Re(L),me(N),le(N))};return T.on("select",x),()=>{T.off("select",x)}},[T,L,ke,Ae]);const ts=x=>{if(x===L)return;Re(L);const j=ce.findIndex(N=>N.value===x);j!==-1&&T&&T.scrollTo(j),me(x),le(x)},V=Wa(),G=m.useCallback(async()=>{await Promise.all([V.invalidateQueries({queryKey:["profile"]}),V.invalidateQueries({queryKey:["favorites"]}),V.invalidateQueries({queryKey:["user-comments"]}),V.invalidateQueries({queryKey:["subscriptions"]}),V.invalidateQueries({queryKey:["user-coupons"]})])},[V]);if(!a||d)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const xe=s(D?`profile.role.${D}`:"profile.role.user");return e.jsx(yt,{onRefresh:G,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${r?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${r?"px-3":""}`,children:[!r&&e.jsx(e.Fragment,{children:e.jsx(k,{className:"mb-6 md:mb-8",children:e.jsx(A,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(ks,{className:"w-24 h-24",children:[e.jsx(As,{src:t?.avatar_url||""}),e.jsx(Ps,{className:"text-3xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:a.email}),t?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.phone}),D&&D!=="user"&&e.jsx(v,{className:"bg-primary capitalize",children:xe}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Ks,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points")}),e.jsx(Gs,{}),(Ne?.shop_enabled!==!1||b)&&e.jsxs(R,{to:"/shop",className:"ml-2 inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(Qs,{className:"h-4 w-4"}),s("profile.pointsShop")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[t&&e.jsx(Xs,{profile:t}),O&&t&&e.jsx(Ws,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})})})}),r?e.jsx(e.Fragment,{children:e.jsx(nt,{setApi:S,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(lt,{className:"-ml-0",children:[e.jsx(qe,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(k,{children:e.jsx(A,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ks,{className:"w-20 h-20",children:[e.jsx(As,{src:t?.avatar_url||""}),e.jsx(Ps,{className:"text-2xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:a.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Ks,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points")}),e.jsx(Gs,{})]}),(Ne?.shop_enabled!==!1||b)&&e.jsxs(R,{to:"/shop",className:"inline-flex items-center justify-center gap-1 text-xs text-primary hover:underline mb-2",children:[e.jsx(Qs,{className:"h-3 w-3"}),s("profile.pointsShop")]}),t?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:t.phone}),D&&D!=="user"&&e.jsx(v,{className:"bg-primary capitalize text-xs mb-4",children:xe}),t&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Xs,{profile:t}),O&&e.jsx(Ws,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})]})})}),e.jsx(ta,{isMobile:!0}),e.jsxs(k,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(U,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(A,{className:"px-3",children:B?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):F&&F.length>0?e.jsx("div",{className:"space-y-3",children:F.map(x=>e.jsx(Ts,{coupon:x,getLocalizedField:E,t:s,isMobile:!0},x.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(Zs,{}),e.jsx(ea,{}),e.jsx(sa,{})]})}),e.jsx(qe,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(k,{children:e.jsx(A,{className:"pt-4",children:e.jsxs(ys,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(K,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),i&&i.length>0&&e.jsx(v,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:i.length})]}),e.jsxs(K,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(ie,{className:"w-4 h-4"}),s("profile.activityFavorites"),l&&l.length>0&&e.jsx(v,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:l.length})]})]}),e.jsx(Q,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):i&&i.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:i.map(x=>e.jsx(Is,{restaurant:x,getLocalizedField:E,t:s},x.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(Q,{value:"activities",children:u?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):l&&l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(x=>e.jsx($s,{subscription:x,getLocalizedField:E,t:s,isMobile:!0},x.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(qe,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(k,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ee,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(U,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx(A,{className:"space-y-3 px-3",children:p?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):n&&n.length>0?n.map(x=>e.jsx(Es,{comment:x,getLocalizedField:E,t:s},x.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),O&&e.jsx(qe,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(k,{children:[e.jsxs(I,{className:"pb-3",children:[e.jsxs($,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(U,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(A,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:P?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):y&&y.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const x=y.reduce((j,N)=>{const q=N.activity_id;return j[q]||(j[q]={activity:N.activity,restaurants:[],participationDate:N.created_at}),j[q].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),j},{});return Object.values(x).map(j=>e.jsx(Os,{activityGroup:j,getLocalizedField:E,t:s,isMobile:!0},j.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})})}):e.jsxs(ys,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(ws,{className:`grid w-full ${O?"grid-cols-7":"grid-cols-6"} bg-card border rounded-lg shadow-sm h-auto p-1`,children:[e.jsxs(K,{value:"favorites",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx($e,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(K,{value:"coupons",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(K,{value:"comments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),O&&e.jsxs(K,{value:"activities",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(K,{value:"invitation-code",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),s("profile.invitationCode.title")]}),e.jsxs(K,{value:"addresses",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(_e,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(K,{value:"orders",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(Q,{value:"favorites",children:e.jsx(k,{children:e.jsx(A,{className:"pt-6",children:e.jsxs(ys,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(ws,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(K,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),i&&i.length>0&&e.jsx(v,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:i.length})]}),e.jsxs(K,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),s("profile.activityFavorites"),l&&l.length>0&&e.jsx(v,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:l.length})]})]}),e.jsx(Q,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):i&&i.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.map(x=>e.jsx(Is,{restaurant:x,getLocalizedField:E,t:s},x.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(Q,{value:"activities",children:u?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):l&&l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(x=>e.jsx($s,{subscription:x,getLocalizedField:E,t:s,isMobile:r},x.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(Q,{value:"comments",children:e.jsxs(k,{children:[e.jsxs(I,{className:r?"pb-3":"",children:[e.jsxs($,{className:`flex items-center gap-2 ${r?"text-lg":""}`,children:[e.jsx(Ee,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(U,{className:r?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx(A,{className:`space-y-3 md:space-y-4 ${r?"px-3":""}`,children:p?e.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:s("common.loading")}):n&&n.length>0?n.map(x=>e.jsx(Es,{comment:x,getLocalizedField:E,t:s},x.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:s("profile.noComments")})})]})}),O&&e.jsx(Q,{value:"activities",children:e.jsxs(k,{children:[e.jsxs(I,{className:r?"pb-3":"",children:[e.jsxs($,{className:`flex items-center gap-2 ${r?"text-lg":""}`,children:[e.jsx(ie,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(U,{className:r?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(A,{className:r?"px-3":"",children:e.jsx("div",{className:r?"space-y-4":"space-y-6",children:P?e.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:s("common.loading")}):y&&y.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[e.jsx(ne,{className:r?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:r?"space-y-3":"space-y-4",children:(()=>{const x=y.reduce((j,N)=>{const q=N.activity_id;return j[q]||(j[q]={activity:N.activity,restaurants:[],participationDate:N.created_at}),j[q].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),j},{});return Object.values(x).map(j=>e.jsx(Os,{activityGroup:j,getLocalizedField:E,t:s,isMobile:r},j.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(Q,{value:"invitation-code",children:e.jsx(ta,{})}),e.jsx(Q,{value:"coupons",children:e.jsxs(k,{children:[e.jsxs(I,{className:r?"pb-3":"",children:[e.jsxs($,{className:`flex items-center gap-2 ${r?"text-lg":""}`,children:[e.jsx(Oe,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(U,{className:r?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(A,{className:r?"px-3":"",children:B?e.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:s("common.loading")}):F&&F.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${r?"grid-cols-1":"md:grid-cols-2"}`,children:F.map(x=>e.jsx(Ts,{coupon:x,getLocalizedField:E,t:s,isMobile:r},x.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(R,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(Q,{value:"addresses",children:e.jsx(Zs,{})}),e.jsx(Q,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(ea,{}),e.jsx(sa,{})]})})]}),r&&e.jsxs("div",{className:"fixed left-4 right-4 bottom-4 z-40 bg-white/20 dark:bg-black/25 backdrop-blur-sm border border-white/40 dark:border-white/30 shadow-[0_2px_20px_rgba(0,0,0,0.08)] rounded-[28px] overflow-hidden",style:{contain:"layout style paint",isolation:"isolate",backfaceVisibility:"hidden",transform:"translateZ(0)"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/10 via-transparent to-transparent pointer-events-none"}),e.jsx("div",{className:"relative flex justify-around items-center h-14 px-4",children:ce.map(x=>{const j=x.icon;return e.jsxs("button",{onClick:()=>ts(x.value),className:`relative flex flex-col items-center justify-center flex-1 h-10 py-1 px-2 mx-0.5 transition-all duration-200 rounded-2xl ${L===x.value?"text-primary dark:text-white bg-primary/15 dark:bg-white/15":"text-gray-700 dark:text-white/80 active:bg-black/5 dark:active:bg-white/5"}`,children:[e.jsx(j,{className:`h-5 w-5 mb-1 transition-all duration-200 ${L===x.value?"scale-110 drop-shadow-[0_0_6px_rgba(34,197,94,0.6)] dark:drop-shadow-[0_0_6px_rgba(255,255,255,0.6)]":""}`}),e.jsx("span",{className:`text-xs text-center line-clamp-1 ${L===x.value?"font-semibold":"font-normal"}`,children:x.label})]},x.value)})})]})]})})})};export{or as default};
//# sourceMappingURL=Profile-DRZHQE5i.js.map
