import{s as p,q as u,v as d}from"./vendor-react-BQzJ6E-_.js";import{u as _,s as n,f as l}from"./index-BNKbGXoa.js";import{i as o}from"./vendor-i18n-jtdHZIRR.js";const A=()=>{const{user:t}=_();return p({queryKey:["myActivityRequests",t?.id],queryFn:async()=>{if(!t)return[];const{data:r,error:s}=await n.from("activity_requests").select("*").eq("requester_id",t.id).order("created_at",{ascending:!1});if(s)throw s;return await Promise.all(r.map(async a=>{if(a.created_activity_id&&a.status==="approved"){const{data:c}=await n.from("activities").select("id").eq("id",a.created_activity_id).single();return{...a,activity_deleted:!c}}return{...a,activity_deleted:!1}}))},enabled:!!t})},R=()=>p({queryKey:["allActivityRequests"],queryFn:async()=>{const{data:t,error:r}=await n.from("activity_requests").select("*, profiles:requester_id(display_name, avatar_url)").order("created_at",{ascending:!1});if(r)throw r;return t}}),b=()=>{const{user:t}=_(),{toast:r}=l(),s=u();return d({mutationFn:async i=>{if(!t)throw new Error("User not authenticated");const{data:a,error:c}=await n.from("activity_requests").insert([{...i,requester_id:t.id}]).select().single();if(c)throw c;return a},onSuccess:()=>{s.invalidateQueries({queryKey:["myActivityRequests"]}),r({title:o.t("common.success"),description:"活动申请已提交，等待管理员审核"})},onError:i=>{r({title:o.t("common.error"),description:i.message||"提交失败",variant:"destructive"})}})},S=()=>{const{user:t}=_(),{toast:r}=l(),s=u();return d({mutationFn:async({requestId:i,status:a,adminNotes:c})=>{if(!t)throw new Error("User not authenticated");const{data:e,error:v}=await n.from("activity_requests").select("*").eq("id",i).single();if(v)throw v;let y=null;if(a==="approved"){const{data:f,error:q}=await n.from("activities").insert([{creator_id:e.requester_id,title_zh:e.title_zh,title_en:e.title_en,title_pt:e.title_pt,intro_zh:e.intro_zh,intro_en:e.intro_en,intro_pt:e.intro_pt,content_zh:e.content_zh,content_en:e.content_en,content_pt:e.content_pt,image_url:e.image_url,start_date:e.start_date,end_date:e.end_date,service_type:e.service_type,badge_text_zh:e.badge_text_zh,badge_text_en:e.badge_text_en,badge_text_pt:e.badge_text_pt,badge_color:e.badge_color,visible:!0}]).select().single();if(q)throw q;y=f.id}const{error:m}=await n.from("activity_requests").update({status:a,admin_notes:c||null,reviewed_by:t.id,reviewed_at:new Date().toISOString(),created_activity_id:y}).eq("id",i);if(m)throw m;return{status:a,createdActivityId:y}},onSuccess:i=>{s.invalidateQueries({queryKey:["allActivityRequests"]}),s.invalidateQueries({queryKey:["activities"]}),r({title:o.t("common.success"),description:i.status==="approved"?"活动已审核通过并创建":"活动申请已拒绝"})},onError:i=>{r({title:o.t("common.error"),description:i.message,variant:"destructive"})}})},E=()=>{const{toast:t}=l(),r=u();return d({mutationFn:async s=>{const{error:i}=await n.from("activity_requests").delete().eq("id",s);if(i)throw i},onSuccess:()=>{r.invalidateQueries({queryKey:["myActivityRequests"]}),r.invalidateQueries({queryKey:["allActivityRequests"]}),t({title:o.t("common.success"),description:"活动申请已删除"})},onError:s=>{t({title:o.t("common.error"),description:s.message,variant:"destructive"})}})},K=()=>{const{toast:t}=l(),r=u();return d({mutationFn:async s=>{const{error:i}=await n.from("activity_requests").update({status:"pending",created_activity_id:null,reviewed_by:null,reviewed_at:null,admin_notes:null,updated_at:new Date().toISOString()}).eq("id",s);if(i)throw i},onSuccess:()=>{r.invalidateQueries({queryKey:["myActivityRequests"]}),r.invalidateQueries({queryKey:["allActivityRequests"]}),t({title:o.t("common.success"),description:"活动申请已重新提交，等待管理员审核"})},onError:s=>{t({title:o.t("common.error"),description:s.message,variant:"destructive"})}})};export{R as a,S as b,E as c,A as d,K as e,b as u};
//# sourceMappingURL=useActivityRequests-BW3D7VOM.js.map
