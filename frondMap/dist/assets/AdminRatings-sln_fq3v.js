import{p as V,q as _,r as d,v as C,j as s,bD as P,b7 as $,a4 as H,b1 as J}from"./vendor-react-Hsdnn-sD.js";import{j as W,B as S,C as f,w as v,I as R,s as k}from"./index-Bhoi9VDh.js";import{n as X}from"./useAdmin-CkBSStOv.js";import{u as Y}from"./useLocalizedContent-D-CDxH29.js";import{u as Z,P as ee,a as se,b as l,c as te,d as ae,f as ne}from"./usePagination-CPtUhEn6.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-Z4kpnli5.js";import"./vendor-supabase-BVdpxhZP.js";const he=()=>{const{t:n}=V(),{toast:m}=W(),o=_(),{data:u,isLoading:q}=X(),{getLocalizedField:x}=Y(),[r,L]=d.useState(""),[i,h]=d.useState({}),[E,N]=d.useState(new Set),Q=d.useMemo(()=>u?u.filter(e=>r===""||x(e,"name").toString().toLowerCase().includes(r.toLowerCase())||e.address.toLowerCase().includes(r.toLowerCase())):[],[u,r,x]),{currentPage:c,totalPages:g,paginatedData:F,goToPage:K,nextPage:A,previousPage:I,canGoNext:T,canGoPrevious:z,startIndex:M,endIndex:O,totalItems:B}=Z({data:Q,itemsPerPage:20}),y=C({mutationFn:async({restaurantId:e,rating:t})=>{const{error:a}=await k.from("restaurants").update({rating:t}).eq("id",e);if(a)throw a;return e},onSuccess:e=>{o.invalidateQueries({queryKey:["admin-restaurants"]}),o.invalidateQueries({queryKey:["restaurants"]}),N(t=>new Set([...t,e])),h(t=>{const a={...t};return delete a[e],a}),setTimeout(()=>{N(t=>{const a=new Set(t);return a.delete(e),a})},2e3)},onError:e=>{m({title:n("common.error"),description:e.message,variant:"destructive"})}}),w=C({mutationFn:async()=>{const e=Object.entries(i).map(([t,a])=>({id:t,rating:parseFloat(a)||0}));for(const t of e){const{error:a}=await k.from("restaurants").update({rating:t.rating}).eq("id",t.id);if(a)throw a}return e.length},onSuccess:e=>{o.invalidateQueries({queryKey:["admin-restaurants"]}),o.invalidateQueries({queryKey:["restaurants"]}),h({}),m({title:n("common.success"),description:n("admin.ratings.updated",{count:e})})},onError:e=>{m({title:n("common.error"),description:e.message,variant:"destructive"})}}),D=(e,t)=>{if(t===""||/^\d*\.?\d*$/.test(t)){const a=parseFloat(t);(t===""||a>=0&&a<=5)&&h(p=>({...p,[e]:t}))}},b=e=>{const t=parseFloat(i[e]||"0");t>=0&&t<=5&&y.mutate({restaurantId:e,rating:t})},G=(e,t)=>{e.key==="Enter"&&b(t)},U=Object.keys(i).length>0;return q?s.jsx("div",{className:"text-center",children:n("common.loading")}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:n("admin.ratings.title")}),s.jsx("p",{className:"text-muted-foreground",children:n("admin.ratings.description")})]}),U&&s.jsxs(S,{onClick:()=>w.mutate(),disabled:w.isPending,children:[s.jsx(P,{className:"mr-2 h-4 w-4"}),n("admin.ratings.saveAll")," (",Object.keys(i).length,")"]})]}),s.jsx(f,{children:s.jsx(v,{className:"pt-6",children:s.jsxs("div",{className:"relative max-w-md",children:[s.jsx($,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),s.jsx(R,{placeholder:n("admin.ratings.searchPlaceholder"),value:r,onChange:e=>L(e.target.value),className:"pl-9"})]})})}),s.jsx(f,{className:"bg-muted/50",children:s.jsx(v,{className:"pt-6",children:s.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[s.jsxs("p",{children:["• ",n("admin.ratings.instruction1")]}),s.jsxs("p",{children:["• ",n("admin.ratings.instruction2")]}),s.jsxs("p",{children:["• ",n("admin.ratings.instruction3")]})]})})}),s.jsx("div",{className:"flex items-center justify-between pb-2 border-b",children:s.jsx("span",{className:"text-sm text-muted-foreground",children:n("admin.ratings.showing",{start:M,end:O,total:B})})}),s.jsx("div",{className:"grid gap-3",children:F?.map(e=>{const t=i[e.id]??(e.rating?.toString()||"0"),a=e.id in i,p=E.has(e.id);return s.jsx(f,{className:a?"border-primary/50":"",children:s.jsx(v,{className:"py-4",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h3",{className:"font-medium truncate",children:x(e,"name")}),p&&s.jsxs("span",{className:"flex items-center text-green-600 text-sm",children:[s.jsx(H,{className:"h-4 w-4 mr-1"}),n("admin.ratings.saved")]})]}),s.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.address})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[s.jsx(J,{className:"h-4 w-4 fill-accent text-accent"}),s.jsx("span",{className:"text-sm",children:n("admin.ratings.current")}),s.jsx("span",{className:"font-medium",children:e.rating||0})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(R,{type:"text",inputMode:"decimal",value:t,onChange:j=>D(e.id,j.target.value),onKeyPress:j=>G(j,e.id),className:"w-20 text-center",placeholder:"0-5"}),s.jsx(S,{size:"sm",variant:a?"default":"outline",onClick:()=>b(e.id),disabled:!a||y.isPending,children:s.jsx(P,{className:"h-4 w-4"})})]})]})]})})},e.id)})}),g>1&&s.jsx(ee,{className:"mt-6",children:s.jsxs(se,{children:[s.jsx(l,{children:s.jsx(te,{onClick:I,className:z?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:g},(e,t)=>t+1).map(e=>e===1||e===g||e>=c-1&&e<=c+1?s.jsx(l,{children:s.jsx(ae,{onClick:()=>K(e),isActive:c===e,className:"cursor-pointer",children:e})},e):e===c-2||e===c+2?s.jsx(l,{children:"..."},e):null),s.jsx(l,{children:s.jsx(ne,{onClick:A,className:T?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{he as default};
//# sourceMappingURL=AdminRatings-sln_fq3v.js.map
