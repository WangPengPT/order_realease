import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as x}from"./vendor-react-iAJ0IrSD.js";import{r as he,D as ye,a as fe,b as Ne,c as we,$ as Ce,q as Ae,L as oe,a2 as Re,B as p,C as ae,j as ie,J as Le,ah as Oe,ag as Be,K as Pe,N as Me,O as Ue,Q as He,R as Ve,T as We,V as Ge,X as qe,y as k,a0 as o,I as d,z as Je,A as Ye,v as Qe,E as Xe,F as le,G as Ke,a6 as Ze,a7 as es,a8 as ss,a9 as ts,aa as se,ab as ce,i as de,t as me}from"./index-BcrfGQEh.js";import{S as ve}from"./slider-BpSyeFlD.js";import{T as ke,a as Te,b as Q,c as re}from"./tabs-C_tzE0Ci.js";import{S as De,a as as,b as is,c as ls,d as rs,e as os,f as ns}from"./useHomepageTemplates-CF-EaV3W.js";import{C as Y,M as cs,S as ds,L as ms,B as ps,V as pe}from"./ReactCrop-BlnwZw7C.js";import{A as us,a as hs}from"./alert-BVG_b3XF.js";import{u as xe}from"./vendor-i18n-DxKeo2S1.js";import{P as xs}from"./plus-CN0JuuEq.js";import{G as gs}from"./grip-vertical-CMonN56R.js";import{C as vs}from"./clock-DGED8Oob.js";import{E as js}from"./eye-CrXJhp4G.js";import{E as _s}from"./eye-off-Jqv1rVF0.js";import{S as bs}from"./square-pen-B33wHQe-.js";import{S as ys}from"./save-NBF8cpPJ.js";import{I as ue}from"./image-C10sDEfq.js";import{R as fs}from"./refresh-cw-BI_CDHcK.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-BlSVl3IQ.js";import"./vendor-supabase-KNAP0qdW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=he("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=he("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=he("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]),Ns={desktop:{width:1920,height:1080,aspect:16/9,label:"桌面端 16:9",icon:ze},tablet:{width:1024,height:768,aspect:4/3,label:"平板端 4:3",icon:Ie},mobile:{width:750,height:1334,aspect:9/16,label:"移动端 9:16",icon:De}};function _e(t,w,f){return ms(ps({unit:"%",width:90},f,t,w),t,w)}function ws({open:t,onOpenChange:w,imageSource:f,deviceType:I,onCropComplete:C}){const{t:te}=xe(),[A,X]=x.useState(""),[T,E]=x.useState(),[O,g]=x.useState(),[a,b]=x.useState(I),R=x.useRef(null),[S,B]=x.useState(!1),[F,P]=x.useState(!1),h=Ns[a],W=h.icon;x.useEffect(()=>{if(t&&f)if(b(I),E(void 0),g(void 0),typeof f=="string")P(!0),X(f);else{P(!0);const n=new FileReader;n.addEventListener("load",()=>{X(n.result?.toString()||"")}),n.readAsDataURL(f)}},[t,f,I]);const M=x.useCallback(n=>{P(!1);const{width:v,height:j}=n.currentTarget;E(_e(v,j,h.aspect))},[h.aspect]);x.useEffect(()=>{if(R.current&&R.current.complete){const{width:n,height:v}=R.current;n&&v&&E(_e(n,v,h.aspect))}},[a,h.aspect]);const G=x.useCallback(async(n,v)=>{const j=document.createElement("canvas"),q=j.getContext("2d");if(!q)throw new Error("No 2d context");const K=n.naturalWidth/n.width,U=n.naturalHeight/n.height,J=v.width*K,H=v.height*U;let D=J,L=H;if(D>h.width||L>h.height){const V=Math.min(h.width/D,h.height/L);D=D*V,L=L*V}return j.width=D,j.height=L,q.imageSmoothingQuality="high",q.drawImage(n,v.x*K,v.y*U,J,H,0,0,j.width,j.height),new Promise((V,Z)=>{j.toBlob(z=>{if(!z){Z(new Error("Canvas is empty"));return}V(z)},"image/jpeg",.92)})},[h]),N=x.useCallback(async()=>{if(!(!O||!R.current)){B(!0);try{const n=await G(R.current,O),v=typeof f=="string"?`cropped-${a}-${Date.now()}.jpg`:f.name,j=new File([n],v,{type:"image/jpeg"});C(j,a),w(!1)}catch(n){console.error("Error cropping image:",n)}finally{B(!1)}}},[O,f,a,C,w,G]);return e.jsx(ye,{open:t,onOpenChange:w,children:e.jsxs(fe,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Ne,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(we,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary"}),"裁剪图片"]}),e.jsx(Ce,{className:"text-xs sm:text-sm",children:"拖动选择要保留的区域，裁剪后将用于主页轮播"})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsx(ke,{value:a,onValueChange:n=>b(n),children:e.jsxs(Te,{className:"grid w-full grid-cols-3",children:[e.jsxs(Q,{value:"desktop",className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"桌面端"})]}),e.jsxs(Q,{value:"tablet",className:"flex items-center gap-1",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"平板端"})]}),e.jsxs(Q,{value:"mobile",className:"flex items-center gap-1",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"移动端"})]})]})}),e.jsxs(us,{className:"border-primary/20 bg-primary/5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx(hs,{className:"text-xs sm:text-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"推荐尺寸:"}),e.jsxs(Ae,{variant:"secondary",className:"w-fit",children:[e.jsx(cs,{className:"w-3 h-3 mr-1"}),h.width," × ",h.height," px (",h.label,")"]})]})})]}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-lg border bg-muted/30 min-h-[200px]",children:[F&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(oe,{className:"w-8 h-8 animate-spin text-muted-foreground"})}),A&&e.jsx(ds,{crop:T,onChange:n=>E(n),onComplete:n=>g(n),aspect:h.aspect,className:"max-h-[50vh] sm:max-h-[55vh] flex items-center justify-center",children:e.jsx("img",{ref:R,src:A,alt:"Crop preview",onLoad:M,crossOrigin:"anonymous",className:"max-w-full max-h-[50vh] sm:max-h-[55vh] h-auto object-contain"})})]})]}),e.jsxs(Re,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>w(!1),disabled:S,className:"w-full sm:w-auto",children:te("common.cancel")}),e.jsx(p,{type:"button",onClick:N,disabled:!O||S||F,className:"w-full sm:w-auto",children:S?"处理中...":"确认裁剪"})]})]})})}const be="/images/sushi-ramen-hero.jpg",Cs="/images/sushi-ramen-mobile.jpg",ks=({template:t,onClose:w})=>{const{i18n:f}=xe(),I=f.language?.split("-")[0]||"zh",C=N=>t[`${N}${I==="zh"?"_zh":I==="pt"?"_pt":"_en"}`]||"",te=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",A=()=>{const N=te();return N==="mobile"&&t.mobile_overlay_opacity!==null?t.mobile_overlay_opacity:N==="tablet"&&t.tablet_overlay_opacity!==null?t.tablet_overlay_opacity:N==="desktop"&&t.desktop_overlay_opacity!==null?t.desktop_overlay_opacity:t.overlay_opacity??30},X=()=>{const N=A()||30,n=t.overlay_gradient_direction||"to-b",v=(z,ee)=>z==null?ee/100:z>1?z/100:z,j=N>1?N/100:N,q=v(t.overlay_gradient_from_opacity,30)*j,K=v(t.overlay_gradient_via_opacity,25)*j,U=v(t.overlay_gradient_to_opacity,40)*j,H={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[n]||"to bottom",D={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},L=D[t.overlay_gradient_from||"black"]||"0, 0, 0",V=D[t.overlay_gradient_via||"black"]||"0, 0, 0",Z=D[t.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${H}, rgba(${L}, ${q}), rgba(${V}, ${K}), rgba(${Z}, ${U}))`}},T=t.mobile_image_url||Cs,E=t.tablet_image_url||t.desktop_image_url||be,O=t.desktop_image_url||be,g=t.background_blur||0,a=t.desktop_media_type||t.media_type||"image",b=t.tablet_media_type||t.media_type||"image",S=(t.mobile_media_type||t.media_type||"image")==="video"?t.mobile_video_url:null,B=b==="video"?t.tablet_video_url||t.desktop_video_url:null,F=a==="video"?t.desktop_video_url:null,P=C("title"),h=C("subtitle"),W=C("description"),M=C("primary_button_text"),G=C("secondary_button_text");return e.jsxs("div",{className:"relative w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:S?e.jsx("video",{src:S,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:T||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:B?e.jsx("video",{src:B,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:E||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})}),e.jsx("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:F?e.jsx("video",{src:F,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}}):e.jsx("img",{src:O||"",alt:"Background",className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:g>0?`blur(${g}px)`:void 0}})})]}),e.jsx("div",{className:"absolute inset-0 z-10",style:X()}),e.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center text-center px-4",children:[h&&e.jsx("p",{className:"text-white/90 text-sm sm:text-base mb-2 drop-shadow-md",children:h}),P&&e.jsx("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-bold text-white mb-4 drop-shadow-lg",children:P}),W&&e.jsx("p",{className:"text-white/80 text-base sm:text-lg max-w-2xl mb-8 drop-shadow-md",children:W}),e.jsxs("div",{className:"flex flex-wrap gap-4 justify-center",children:[M&&e.jsx(p,{variant:t.primary_button_variant||"default",size:"lg",className:"pointer-events-none",children:M}),G&&e.jsx(p,{variant:t.secondary_button_variant||"outline",size:"lg",className:"pointer-events-none text-white border-white hover:bg-white/10",children:G})]})]}),e.jsx("div",{className:"absolute bottom-4 left-4 z-30 bg-black/50 text-white text-xs px-3 py-1 rounded-full",children:"预览模式 - 点击右上角关闭"})]})},Js=()=>{const{t}=xe(),{data:w,isLoading:f}=as(),I=is(),C=ls(),te=rs(),A=os(),X=ns(),[T,E]=x.useState(null),[O,g]=x.useState(!1),[a,b]=x.useState({}),[R,S]=x.useState("images"),[B,F]=x.useState(null),[P,h]=x.useState(!1),[W,M]=x.useState(null),[G,N]=x.useState("desktop"),n=()=>{b({sort_order:w?.length||0,is_active:!0,media_type:"image",desktop_media_type:"image",tablet_media_type:"image",mobile_media_type:"image",duration:5e3,overlay_opacity:40,overlay_gradient_direction:"to-b",overlay_gradient_from:"background",overlay_gradient_from_opacity:30,overlay_gradient_via:"background",overlay_gradient_via_opacity:25,overlay_gradient_to:"background",overlay_gradient_to_opacity:40,background_blur:0,title_zh:"发现您的亚洲美食之旅",title_en:"Discover Your Asian Food Journey",title_pt:"Descubra Sua Jornada Gastronômica Asiática",subtitle_zh:"您的美食之旅从这里开始",subtitle_en:"Your culinary journey starts here",subtitle_pt:"Sua jornada culinária começa aqui",description_zh:"探索里斯本地区最好的亚洲美食",description_en:"Explore the best Asian cuisine in the Lisbon area",description_pt:"Explore a melhor cozinha asiática na área de Lisboa",primary_button_text_zh:"探索餐厅",primary_button_text_en:"Explore Restaurants",primary_button_text_pt:"Explorar Restaurantes",primary_button_link:"/restaurants",primary_button_variant:"default",secondary_button_text_zh:"活动",secondary_button_text_en:"Activities",secondary_button_text_pt:"Atividades",secondary_button_link:"/activities",secondary_button_variant:"outline"}),g(!0),S("media")},v=s=>{b(s),E(s),S("media")},j=async()=>{try{T?(await C.mutateAsync({id:T.id,...a}),E(null)):(await I.mutateAsync(a),g(!1)),b({})}catch(s){console.error("Save failed:",s)}},q=async s=>{try{await te.mutateAsync(s)}catch(m){console.error("Delete failed:",m)}},K=async s=>{try{await C.mutateAsync({id:s.id,is_active:!s.is_active})}catch(m){console.error("Toggle failed:",m)}},U=async(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("image/")){k.error(t("admin.homepageTemplates.selectImageFile"));return}try{const i=T?.id||"new",c=await A.mutateAsync({file:r,type:m,templateId:i});b(_=>({..._,[`${m}_image_url`]:c.url}))}catch(i){console.error("Upload failed:",i)}}},J=(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("image/")){k.error(t("admin.homepageTemplates.selectImageFile"));return}M(r),N(m),h(!0),s.target.value=""}},H=(s,m)=>{M(s),N(m),h(!0)},D=async(s,m)=>{try{const r=T?.id||"new",i=await A.mutateAsync({file:s,type:m,templateId:r});b(c=>({...c,[`${m}_image_url`]:i.url})),k.success("图片裁剪并上传成功")}catch(r){console.error("Upload failed:",r),k.error("上传失败")}},L=s=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const $=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),URL.revokeObjectURL(i.src),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout($,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout($,100)},i.onerror=y=>{URL.revokeObjectURL(i.src),r(new Error("Failed to load video: "+y?.message||"Unknown error"))},setTimeout(()=>{u||(URL.revokeObjectURL(i.src),r(new Error("Timeout while extracting video frame")))},1e4),i.src=URL.createObjectURL(s),i.load()}),V=s=>new Promise((m,r)=>{const i=document.createElement("video"),c=document.createElement("canvas"),_=c.getContext("2d");i.preload="auto",i.muted=!0,i.playsInline=!0,i.crossOrigin="anonymous";let u=!1;const $=()=>{u||i.videoWidth===0||i.videoHeight===0||(c.width=i.videoWidth,c.height=i.videoHeight,_?(_.drawImage(i,0,0,c.width,c.height),c.toBlob(y=>{y&&y.size>0?(u=!0,i.pause(),m(y)):r(new Error("Failed to create blob from canvas"))},"image/jpeg",.95)):r(new Error("Failed to get canvas context")))};i.onloadedmetadata=()=>{c.width=i.videoWidth,c.height=i.videoHeight,i.currentTime=.1},i.onseeked=()=>{setTimeout($,100)},i.oncanplay=()=>{!u&&i.currentTime>=.1&&setTimeout($,100)},i.onerror=()=>{r(new Error("Failed to load video from URL"))},setTimeout(()=>{u||r(new Error("Timeout while extracting video frame from URL"))},15e3),i.src=s,i.load()}),[Z,z]=x.useState(!1),ee=async s=>{const m=s?[s]:["desktop","tablet","mobile"],r=T?.id||"new",i={desktop:"桌面端",tablet:"平板端",mobile:"移动端"};z(!0);let c=0,_=0;for(const u of m){const $=a[`${u}_video_url`];if($)try{k.info(`正在提取${i[u]}视频第一帧...`);const y=await V($),Se=new File([y],`${u}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),Fe=await A.mutateAsync({file:Se,type:u,templateId:r});b($e=>({...$e,[`${u}_image_url`]:Fe.url})),c++}catch(y){console.error(`Failed to regenerate ${u} poster:`,y),_++}}if(z(!1),c>0){const u=s?`成功重新生成${i[s]}备用图片`:`成功重新生成 ${c} 个备用图片`;k.success(u)}if(_>0&&k.warning(`${_} 个视频提取失败，可能是跨域限制`),c===0&&_===0){const u=s?`${i[s]}没有视频需要处理`:"没有找到需要处理的视频";k.info(u)}},ne=async(s,m)=>{const r=s.target.files?.[0];if(r){if(!r.type.startsWith("video/")){k.error("请选择视频文件");return}if(r.size>100*1024*1024){k.error("视频文件大小不能超过100MB");return}try{const i=T?.id||"new",c=await X.mutateAsync({file:r,type:m,templateId:i});try{k.info("正在提取视频第一帧作为备用图片...");const _=await L(r),u=new File([_],`${m}-poster-${Date.now()}.jpg`,{type:"image/jpeg"}),$=await A.mutateAsync({file:u,type:m,templateId:i});b(y=>({...y,[`${m}_video_url`]:c.url,[`${m}_image_url`]:$.url})),k.success("视频和备用图片已自动生成")}catch(_){console.error("Failed to extract first frame:",_),b(u=>({...u,[`${m}_video_url`]:c.url})),k.warning("视频已上传，但无法自动提取第一帧，请手动上传备用图片")}}catch(i){console.error("Upload failed:",i)}}},l=(s,m)=>{b(r=>({...r,[s]:m}))},ge=()=>{E(null),g(!1),b({})};if(f)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(oe,{className:"w-8 h-8 animate-spin"})});const Ee=()=>e.jsxs(ke,{value:R,onValueChange:S,className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-4",children:[e.jsx(Q,{value:"media",children:"媒体"}),e.jsx(Q,{value:"overlay",children:t("admin.homepageTemplates.tabs.overlay")}),e.jsx(Q,{value:"content",children:t("admin.homepageTemplates.tabs.content")}),e.jsx(Q,{value:"buttons",children:t("admin.homepageTemplates.tabs.buttons")})]}),e.jsxs(re,{value:"media",className:"space-y-6 mt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"每个端可以独立选择图片或视频，支持混合配置（如：桌面端视频 + 移动端图片）"}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{className:"text-base font-medium",children:"桌面端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(a.desktop_media_type||"image")==="image"?"default":"outline",onClick:()=>l("desktop_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(a.desktop_media_type||"image")==="video"?"default":"outline",onClick:()=>l("desktop_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"视频"]})]})]}),(a.desktop_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[a.desktop_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.desktop_image_url,alt:"Desktop",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(a.desktop_image_url,"desktop"),title:"编辑裁剪",children:e.jsx(Y,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"desktop"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>J(s,"desktop"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"desktop-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.desktop_video_url&&e.jsx("video",{src:a.desktop_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>ne(s,"desktop")})]}),a.desktop_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:a.desktop_image_url,alt:"Desktop poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{className:"text-base font-medium",children:"平板端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(a.tablet_media_type||"image")==="image"?"default":"outline",onClick:()=>l("tablet_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(a.tablet_media_type||"image")==="video"?"default":"outline",onClick:()=>l("tablet_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"视频"]})]})]}),(a.tablet_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[a.tablet_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.tablet_image_url,alt:"Tablet",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(a.tablet_image_url,"tablet"),title:"编辑裁剪",children:e.jsx(Y,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"tablet"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>J(s,"tablet"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"tablet-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.tablet_video_url&&e.jsx("video",{src:a.tablet_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>ne(s,"tablet")})]}),a.tablet_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:a.tablet_image_url,alt:"Tablet poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),e.jsxs("div",{className:"space-y-3 p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(o,{className:"text-base font-medium",children:"移动端"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{type:"button",size:"sm",variant:(a.mobile_media_type||"image")==="image"?"default":"outline",onClick:()=>l("mobile_media_type","image"),className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3"}),"图片"]}),e.jsxs(p,{type:"button",size:"sm",variant:(a.mobile_media_type||"image")==="video"?"default":"outline",onClick:()=>l("mobile_media_type","video"),className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),"视频"]})]})]}),(a.mobile_media_type||"image")==="image"?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[a.mobile_image_url&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a.mobile_image_url,alt:"Mobile",className:"w-32 h-20 object-cover rounded border"}),e.jsx(p,{type:"button",variant:"secondary",size:"icon",className:"absolute inset-0 w-full h-full opacity-0 group-hover:opacity-100 transition-opacity bg-black/50 rounded",onClick:()=>H(a.mobile_image_url,"mobile"),title:"编辑裁剪",children:e.jsx(Y,{className:"w-5 h-5 text-white"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>U(s,"mobile"),className:"flex-1"}),e.jsxs("div",{className:"relative",children:[e.jsx(d,{type:"file",accept:"image/*",onChange:s=>J(s,"mobile"),className:"absolute inset-0 opacity-0 cursor-pointer",id:"mobile-crop-input"}),e.jsx(p,{type:"button",variant:"outline",size:"icon",title:"裁剪上传新图片",children:e.jsx(Y,{className:"w-4 h-4"})})]})]})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.mobile_video_url&&e.jsx("video",{src:a.mobile_video_url,className:"w-32 h-20 object-cover rounded border",muted:!0}),e.jsx(d,{type:"file",accept:"video/mp4,video/webm",onChange:s=>ne(s,"mobile")})]}),a.mobile_image_url&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:"备用图片:"}),e.jsx("img",{src:a.mobile_image_url,alt:"Mobile poster",className:"w-16 h-10 object-cover rounded border"})]})]})]}),(a.desktop_video_url||a.tablet_video_url||a.mobile_video_url)&&e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:"备用图片管理"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"上传视频时会自动截取第一帧作为备用图片"})]}),e.jsxs(Je,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(p,{type:"button",variant:"outline",size:"sm",disabled:Z,children:[Z?e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(fs,{className:"w-4 h-4 mr-2"}),"重新生成第一帧",e.jsx(Qe,{className:"w-4 h-4 ml-2"})]})}),e.jsxs(Xe,{align:"end",children:[e.jsx(le,{onClick:()=>ee(),children:"全部重新生成"}),e.jsx(Ke,{}),e.jsx(le,{onClick:()=>ee("desktop"),disabled:!a.desktop_video_url,className:a.desktop_video_url?"":"opacity-50 cursor-not-allowed",children:"仅桌面端"}),e.jsx(le,{onClick:()=>ee("tablet"),disabled:!a.tablet_video_url,className:a.tablet_video_url?"":"opacity-50 cursor-not-allowed",children:"仅平板端"}),e.jsx(le,{onClick:()=>ee("mobile"),disabled:!a.mobile_video_url,className:a.mobile_video_url?"":"opacity-50 cursor-not-allowed",children:"仅移动端"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.duration")}),e.jsx(d,{type:"number",value:a.duration||5e3,onChange:s=>l("duration",parseInt(s.target.value)||5e3),min:1e3,max:3e4}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("admin.homepageTemplates.durationHint")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.sortOrder")}),e.jsx(d,{type:"number",value:a.sort_order||0,onChange:s=>l("sort_order",parseInt(s.target.value)||0)})]})]})]}),e.jsx(re,{value:"overlay",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:[t("admin.homepageTemplates.baseOverlayOpacity"),": ",a.overlay_opacity||40,"%"]}),e.jsx(ve,{value:[a.overlay_opacity||40],onValueChange:([s])=>l("overlay_opacity",s),max:100,step:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.gradientDirection")}),e.jsxs(Ze,{value:a.overlay_gradient_direction||"to-b",onValueChange:s=>l("overlay_gradient_direction",s),children:[e.jsx(es,{children:e.jsx(ss,{})}),e.jsxs(ts,{children:[e.jsx(se,{value:"to-b",children:t("admin.homepageTemplates.gradientDirection.toBottom")}),e.jsx(se,{value:"to-t",children:t("admin.homepageTemplates.gradientDirection.toTop")}),e.jsx(se,{value:"to-r",children:t("admin.homepageTemplates.gradientDirection.toRight")}),e.jsx(se,{value:"to-l",children:t("admin.homepageTemplates.gradientDirection.toLeft")}),e.jsx(se,{value:"to-br",children:t("admin.homepageTemplates.gradientDirection.toBottomRight")}),e.jsx(se,{value:"to-tr",children:t("admin.homepageTemplates.gradientDirection.toTopRight")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.startOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:a.overlay_gradient_from_opacity||30,onChange:s=>l("overlay_gradient_from_opacity",parseInt(s.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.middleOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:a.overlay_gradient_via_opacity||25,onChange:s=>l("overlay_gradient_via_opacity",parseInt(s.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.endOpacity")}),e.jsx(d,{type:"number",min:"0",max:"100",value:a.overlay_gradient_to_opacity||40,onChange:s=>l("overlay_gradient_to_opacity",parseInt(s.target.value)||0)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{children:[t("admin.homepageTemplates.backgroundBlur"),": ",a.background_blur||0,"px"]}),e.jsx(ve,{value:[a.background_blur||0],onValueChange:([s])=>l("background_blur",s),max:50,step:1})]})]})}),e.jsx(re,{value:"content",className:"space-y-4 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.titleChinese")}),e.jsx(d,{value:a.title_zh||"",onChange:s=>l("title_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.titleEnglish")}),e.jsx(d,{value:a.title_en||"",onChange:s=>l("title_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.titlePortuguese")}),e.jsx(d,{value:a.title_pt||"",onChange:s=>l("title_pt",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.descriptionChinese")}),e.jsx(ce,{value:a.description_zh||"",onChange:s=>l("description_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.descriptionEnglish")}),e.jsx(ce,{value:a.description_en||"",onChange:s=>l("description_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.descriptionPortuguese")}),e.jsx(ce,{value:a.description_pt||"",onChange:s=>l("description_pt",s.target.value)})]})]})}),e.jsxs(re,{value:"buttons",className:"space-y-4 mt-4",children:[e.jsxs(ae,{children:[e.jsx(de,{className:"py-3",children:e.jsx(me,{className:"text-lg",children:t("admin.homepageTemplates.primaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.chinese")}),e.jsx(d,{value:a.primary_button_text_zh||"",onChange:s=>l("primary_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.english")}),e.jsx(d,{value:a.primary_button_text_en||"",onChange:s=>l("primary_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:a.primary_button_text_pt||"",onChange:s=>l("primary_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.link")}),e.jsx(d,{value:a.primary_button_link||"",onChange:s=>l("primary_button_link",s.target.value)})]})]})]}),e.jsxs(ae,{children:[e.jsx(de,{className:"py-3",children:e.jsx(me,{className:"text-lg",children:t("admin.homepageTemplates.secondaryButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.chinese")}),e.jsx(d,{value:a.secondary_button_text_zh||"",onChange:s=>l("secondary_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.english")}),e.jsx(d,{value:a.secondary_button_text_en||"",onChange:s=>l("secondary_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:a.secondary_button_text_pt||"",onChange:s=>l("secondary_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.link")}),e.jsx(d,{value:a.secondary_button_link||"",onChange:s=>l("secondary_button_link",s.target.value)})]})]})]}),e.jsxs(ae,{children:[e.jsx(de,{className:"py-3",children:e.jsx(me,{className:"text-lg",children:t("admin.homepageTemplates.subtitleButton")})}),e.jsxs(ie,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.chinese")}),e.jsx(d,{value:a.subtitle_button_text_zh||"",onChange:s=>l("subtitle_button_text_zh",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.english")}),e.jsx(d,{value:a.subtitle_button_text_en||"",onChange:s=>l("subtitle_button_text_en",s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.portuguese")}),e.jsx(d,{value:a.subtitle_button_text_pt||"",onChange:s=>l("subtitle_button_text_pt",s.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:t("admin.homepageTemplates.link")}),e.jsx(d,{value:a.subtitle_button_link||"",onChange:s=>l("subtitle_button_link",s.target.value)})]})]})]})]})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:t("admin.homepageTemplates")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:t("admin.homepageTemplatesDescription")})]}),e.jsxs(p,{onClick:n,children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),t("admin.homepageTemplates.createTemplate")]})]}),e.jsxs("div",{className:"grid gap-4",children:[w?.map(s=>e.jsx(ae,{className:s.is_active?"":"opacity-60",children:e.jsx(ie,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(gs,{className:"w-5 h-5"}),e.jsxs("span",{className:"text-sm font-medium",children:["#",s.sort_order]})]}),s.desktop_image_url&&e.jsx("img",{src:s.desktop_image_url,alt:"Preview",className:"w-24 h-16 object-cover rounded border"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:s.title_zh}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.description_zh}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(vs,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.duration/1e3,t("admin.homepageTemplates.seconds")]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>F(s),title:t("admin.homepageTemplates.preview")||"预览",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>K(s),title:s.is_active?t("admin.homepageTemplates.hide"):t("admin.homepageTemplates.show"),children:s.is_active?e.jsx(js,{className:"w-4 h-4"}):e.jsx(_s,{className:"w-4 h-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>v(s),children:e.jsx(bs,{className:"w-4 h-4"})}),e.jsxs(Le,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:e.jsx(Be,{className:"w-4 h-4"})})}),e.jsxs(Pe,{children:[e.jsxs(Me,{children:[e.jsx(Ue,{children:t("admin.confirmDelete")}),e.jsx(He,{children:t("admin.homepageTemplates.deleteTemplateConfirm")})]}),e.jsxs(Ve,{children:[e.jsx(We,{children:t("common.cancel")}),e.jsx(Ge,{onClick:()=>q(s.id),children:t("common.delete")})]})]})]})]})]})})},s.id)),(!w||w.length===0)&&e.jsx(ae,{children:e.jsx(ie,{className:"p-8 text-center text-muted-foreground",children:t("admin.homepageTemplates.noTemplates")})})]}),e.jsx(ye,{open:!!T||O,onOpenChange:ge,children:e.jsxs(fe,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(we,{children:t(T?"admin.homepageTemplates.editTemplate":"admin.homepageTemplates.createTemplate")}),e.jsx(Ce,{children:t("admin.homepageTemplates.configureTemplate")})]}),Ee(),e.jsxs("div",{className:"flex justify-between gap-2 mt-4",children:[e.jsxs(p,{variant:"outline",onClick:()=>F(a),disabled:!a.desktop_image_url&&!a.mobile_image_url,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"预览"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",onClick:ge,children:t("common.cancel")}),e.jsxs(p,{onClick:j,disabled:I.isPending||C.isPending,children:[(I.isPending||C.isPending)&&e.jsx(oe,{className:"w-4 h-4 mr-2 animate-spin"}),e.jsx(ys,{className:"w-4 h-4 mr-2"}),t("common.save")]})]})]})]})}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 text-white hover:bg-white/20",onClick:()=>F(null),children:e.jsx(qe,{className:"w-6 h-6"})}),e.jsx(ks,{template:B,onClose:()=>F(null)})]}),W&&e.jsx(ws,{open:P,onOpenChange:s=>{h(s),s||M(null)},imageSource:W,deviceType:G,onCropComplete:D})]})};export{Js as default};
//# sourceMappingURL=AdminHomepageTemplates-BRg-agK0.js.map
