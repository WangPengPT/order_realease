import{r as n,p as B,u as G,j as e,bf as V,c$ as H,ak as U,cB as v,bn as Q,cw as W,be as X,bG as J,b5 as K,b0 as Y,bb as Z}from"./vendor-react-87iFmKFJ.js";import{u as ee,O as se,P as te,Q as ae,R as C,B as l,V as re,W as ie,X as le,A as ne,q as ce,r as oe,t as de,v as me,w as ue,x as xe,y as he}from"./index-CH4FpCej.js";import{a as ge,b as fe}from"./useCommunityPosts-Hwex2FMK.js";import{u as pe}from"./useLocalizedContent-CFh79NZC.js";import{u as je}from"./useLoginRequired-NoLR-dKx.js";import{E as ve,a as be}from"./EditRecipeDialog-BvttCogK.js";const ye=({post:s,showAssociations:D=!1})=>{const{t:a}=B(),{user:P}=ee(),c=G(),{getLocalizedField:u}=pe(),{requireLogin:_}=je(),A=ge(),E=fe(),[$,L]=n.useState(!1),[R,x]=n.useState(!1),[b,h]=n.useState(!1),r=s,i=r.post_type==="recipe",y=P?.id===s.author_id,I=t=>{t.preventDefault(),t.stopPropagation(),_()&&A.mutate({postId:s.id,liked:s.user_liked||!1})},S=()=>c(`/community/${s.id}`),T=(t,j)=>{t.preventDefault(),t.stopPropagation(),c(`/restaurant/${j}`)},M=t=>{t.preventDefault(),t.stopPropagation(),s.activity?.id&&c(`/activity/${s.activity.id}`)},z=()=>{E.mutate(s.id),x(!1)},F=t=>t.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"),N=u(s,"content"),o=n.useMemo(()=>F(N),[N]),w=s.image_urls&&s.image_urls.length>0,d=!!s.video_url,g=w||d,k=s.image_urls?.length||0,m=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(t=>t.id===s.restaurant?.id)?[s.restaurant]:[]],f=s.activity?u(s.activity,"title"):null,p=2,O=t=>{switch(t){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},q=t=>{switch(t){case"easy":return a("recipe.difficulty.easy","简单");case"medium":return a("recipe.difficulty.medium","中等");case"hard":return a("recipe.difficulty.hard","困难");default:return t}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 relative",onClick:S,children:[y&&e.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:t=>t.stopPropagation(),children:e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx(V,{className:"h-4 w-4 text-white"})})}),e.jsxs(ae,{align:"end",className:"min-w-[120px]",children:[e.jsxs(C,{onClick:()=>h(!0),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),a("common.edit","编辑")]}),e.jsxs(C,{className:"text-destructive focus:text-destructive",onClick:()=>x(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),a("common.delete","删除")]})]})]})}),g&&e.jsxs("div",{className:`relative ${i?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[w?$?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:a("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",loading:"lazy",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>L(!0)}):d?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,i&&e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),a("recipe.badge","食谱")]}),d&&!i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!d&&k>1&&!i&&e.jsxs("div",{className:`absolute top-2 ${y?"right-11":"right-2"} bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1`,children:[e.jsx(W,{className:"h-3 w-3"}),e.jsx("span",{children:k})]})]}),!g&&i&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(v,{className:"h-12 w-12 text-primary/40"}),e.jsxs(l,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),a("recipe.badge","食谱")]})]}),e.jsxs("div",{className:"p-3",children:[i&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[r.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.cook_time,a("recipe.min","分")]})]}),r.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.servings,a("recipe.servingsShort","人")]})]}),r.difficulty&&e.jsx(l,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${O(r.difficulty)}`,children:q(r.difficulty)})]}),D&&(m.length>0||f)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[m.slice(0,p).map(t=>e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:j=>T(j,t.id),children:[e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:u(t,"name")})]},t.id)),m.length>p&&e.jsxs(l,{variant:"secondary",className:"text-xs gap-1",children:["+",m.length-p]}),f&&e.jsxs(l,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:M,children:[e.jsx(Y,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:f})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${g?"":"min-h-[60px]"}`,children:i?r.recipe_name:o}),i&&o&&!o.includes("主要配料：")&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3 leading-relaxed mt-1",children:o}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1 cursor-pointer",onClick:t=>{t.preventDefault(),t.stopPropagation(),s.author?.id&&c(`/user/${s.author.id}`)},children:[e.jsxs(re,{className:"h-5 w-5 flex-shrink-0 hover:ring-2 hover:ring-primary/50 transition-all",children:[e.jsx(ie,{src:s.author?.avatar_url||void 0}),e.jsx(le,{className:"text-[10px]",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate hover:text-foreground transition-colors",children:s.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${s.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:I,children:[e.jsx(Z,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count||0})]})]})]})]}),e.jsx(ne,{open:R,onOpenChange:x,children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:a("community.deleteConfirmTitle","确认删除")}),e.jsx(me,{children:a("community.deleteConfirmDesc","删除后将无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:a("common.cancel","取消")}),e.jsx(he,{onClick:z,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete","删除")})]})]})}),i?e.jsx(ve,{post:s,open:b,onOpenChange:h}):e.jsx(be,{post:s,open:b,onOpenChange:h})]})},_e=n.memo(ye);export{_e as P};
//# sourceMappingURL=PostGridCard-Dhl0rt9F.js.map
