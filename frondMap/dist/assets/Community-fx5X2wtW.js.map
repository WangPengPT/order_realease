{"version":3,"file":"Community-fx5X2wtW.js","sources":["../../src/components/community/PostPointsRulesDialog.tsx","../../src/components/community/PostTypeSelector.tsx","../../src/hooks/useCreateRecipe.ts","../../src/components/community/recipe/CreateRecipeWizard.tsx","../../src/components/community/CreatePostDialog.tsx","../../src/pages/Community.tsx"],"sourcesContent":["import { useTranslation } from \"react-i18next\";\r\nimport { Gift, CheckCircle, Clock, Shield } from \"lucide-react\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport { usePointsSettings } from \"@/hooks/usePoints\";\r\n\r\nconst PostPointsRulesDialog = () => {\r\n  const { t } = useTranslation();\r\n  const { data: settings } = usePointsSettings();\r\n\r\n  // 从设置中提取值\r\n  const postPoints = settings?.find(s => s.key === 'post_points')?.value || '5';\r\n  const minLength = settings?.find(s => s.key === 'min_post_length')?.value || '10';\r\n  const requireMedia = settings?.find(s => s.key === 'post_require_media')?.value === 'true';\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogTrigger asChild>\r\n        <button className=\"text-primary hover:underline text-sm whitespace-nowrap\">\r\n          {t(\"community.viewPointsRules\", \"查看详细规则\")}\r\n        </button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Gift className=\"h-5 w-5 text-primary\" />\r\n            {t(\"community.pointsRulesTitle\", \"发帖积分规则\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4 pt-2\">\r\n          <p className=\"text-muted-foreground text-sm\">\r\n            {t(\"community.pointsRulesIntro\", \"通过发布社区帖子获得积分，具体规则如下：\")}\r\n          </p>\r\n          <ul className=\"space-y-3\">\r\n            {/* 积分数量 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.rulePostPoints\", { points: postPoints })}</span>\r\n            </li>\r\n            {/* 最小长度 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleMinLength\", { length: minLength })}</span>\r\n            </li>\r\n            {/* 媒体要求 */}\r\n            {requireMedia && (\r\n              <li className=\"flex items-start gap-2 text-sm\">\r\n                <CheckCircle className=\"h-4 w-4 text-green-500 mt-0.5 shrink-0\" />\r\n                <span>{t(\"community.ruleRequireMedia\", \"帖子必须包含至少一张图片或一个视频\")}</span>\r\n              </li>\r\n            )}\r\n            {/* 每日限制 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Clock className=\"h-4 w-4 text-blue-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleDailyLimit\", \"每天仅可通过发帖获得一次积分奖励\")}</span>\r\n            </li>\r\n            {/* 审核要求 */}\r\n            <li className=\"flex items-start gap-2 text-sm\">\r\n              <Shield className=\"h-4 w-4 text-purple-500 mt-0.5 shrink-0\" />\r\n              <span>{t(\"community.ruleModerationRequired\", \"帖子需通过审核后才能获得积分\")}</span>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default PostPointsRulesDialog;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { FileText, Utensils } from \"lucide-react\";\r\n\r\ninterface PostTypeSelectorProps {\r\n  onSelect: (type: 'post' | 'recipe') => void;\r\n}\r\n\r\nconst PostTypeSelector = ({ onSelect }: PostTypeSelectorProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col items-center justify-center p-6\">\r\n      <h2 className=\"text-xl font-semibold mb-2\">\r\n        {t(\"community.selectPostType\", \"选择发布类型\")}\r\n      </h2>\r\n      <p className=\"text-muted-foreground text-sm mb-8 text-center\">\r\n        {t(\"community.selectPostTypeDesc\", \"选择您想要发布的内容类型\")}\r\n      </p>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4 w-full max-w-sm\">\r\n        {/* Regular Post */}\r\n        <button\r\n          onClick={() => onSelect('post')}\r\n          className=\"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group\"\r\n        >\r\n          <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors\">\r\n            <FileText className=\"h-8 w-8 text-primary\" />\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <h3 className=\"font-medium\">\r\n              {t(\"community.postType.post\", \"发布帖子\")}\r\n            </h3>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              {t(\"community.postType.postDesc\", \"分享美食体验和想法\")}\r\n            </p>\r\n          </div>\r\n        </button>\r\n\r\n        {/* Recipe */}\r\n        <button\r\n          onClick={() => onSelect('recipe')}\r\n          className=\"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group\"\r\n        >\r\n          <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors\">\r\n            <Utensils className=\"h-8 w-8 text-primary\" />\r\n          </div>\r\n          <div className=\"text-center\">\r\n            <h3 className=\"font-medium\">\r\n              {t(\"community.postType.recipe\", \"发布食谱\")}\r\n            </h3>\r\n            <p className=\"text-xs text-muted-foreground mt-1\">\r\n              {t(\"community.postType.recipeDesc\", \"分享烹饪教程和菜谱\")}\r\n            </p>\r\n          </div>\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PostTypeSelector;\r\n","import { useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Ingredient, RecipeStep, RecipeDifficulty } from \"@/components/community/recipe/RecipeTypes\";\r\n\r\ninterface CreateRecipeParams {\r\n  recipe_name: string;\r\n  cook_time: number;\r\n  difficulty: RecipeDifficulty;\r\n  servings: number;\r\n  ingredients: Ingredient[];\r\n  steps: RecipeStep[];\r\n  cover_image?: string | null;\r\n  introduction?: string;\r\n  // Optional fields\r\n  nutrition?: {\r\n    calories?: number;\r\n    protein?: number;\r\n    carbs?: number;\r\n    fat?: number;\r\n  };\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\nexport const useCreateRecipe = () => {\r\n  const queryClient = useQueryClient();\r\n  const { t } = useTranslation();\r\n\r\n  return useMutation({\r\n    mutationFn: async (params: CreateRecipeParams) => {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // Use custom introduction if provided, otherwise leave content empty\r\n      // The recipe name is already displayed separately, no need to duplicate\r\n      let content: string;\r\n      if (params.introduction) {\r\n        content = params.introduction;\r\n      } else {\r\n        // Empty content - the recipe detail will show ingredients in the dedicated section\r\n        content = \"\";\r\n      }\r\n\r\n      // Prepare image_urls (cover image first if present)\r\n      const imageUrls: string[] = [];\r\n      if (params.cover_image) {\r\n        imageUrls.push(params.cover_image);\r\n      }\r\n      // Add step images (support both image_urls array and legacy image_url)\r\n      params.steps.forEach(step => {\r\n        if (step.image_urls && step.image_urls.length > 0) {\r\n          step.image_urls.forEach(url => imageUrls.push(url));\r\n        } else if (step.image_url) {\r\n          imageUrls.push(step.image_url);\r\n        }\r\n      });\r\n\r\n      // Insert the recipe post\r\n      const { data, error } = await supabase\r\n        .from(\"community_posts\")\r\n        .insert({\r\n          author_id: user.id,\r\n          post_type: \"recipe\",\r\n          content,\r\n          image_urls: imageUrls,\r\n          recipe_name: params.recipe_name,\r\n          cook_time: params.cook_time,\r\n          difficulty: params.difficulty,\r\n          servings: params.servings,\r\n          ingredients: params.ingredients as unknown as any,\r\n          steps: params.steps as unknown as any,\r\n          nutrition: params.nutrition ? (params.nutrition as unknown as any) : null,\r\n          recipe_tags: params.recipe_tags || null,\r\n          recipe_category: params.recipe_category || null,\r\n          status: \"pending\",\r\n          moderation_status: \"pending\",\r\n        } as any)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Call moderation function\r\n      try {\r\n        await supabase.functions.invoke(\"moderate-post\", {\r\n          body: {\r\n            post_id: data.id,\r\n            content,\r\n            user_id: user.id,\r\n            image_urls: imageUrls,\r\n          },\r\n        });\r\n      } catch (err) {\r\n        console.error(\"Moderation call failed:\", err);\r\n      }\r\n\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"community-posts\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"has-posted-today\"] });\r\n      toast.success(t(\"recipe.publishSuccess\", \"食谱发布成功\"));\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Create recipe error:\", error);\r\n      toast.error(t(\"recipe.publishError\", \"发布失败\"));\r\n    },\r\n  });\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ArrowLeft, ArrowRight, Loader2, Check } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport RecipeBasicStep from \"./RecipeBasicStep\";\r\nimport RecipeIngredientsStep from \"./RecipeIngredientsStep\";\r\nimport RecipeStepsStep from \"./RecipeStepsStep\";\r\nimport { RecipeData, Ingredient, RecipeStep, NutritionInfo } from \"./RecipeTypes\";\r\nimport { useCreateRecipe } from \"@/hooks/useCreateRecipe\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface CreateRecipeWizardProps {\r\n  onClose: () => void;\r\n  onSuccess: () => void;\r\n}\r\n\r\nconst CreateRecipeWizard = ({ onClose, onSuccess }: CreateRecipeWizardProps) => {\r\n  const { t } = useTranslation();\r\n  const createRecipe = useCreateRecipe();\r\n\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [coverImage, setCoverImage] = useState<string | null>(null);\r\n  const [recipeData, setRecipeData] = useState<Partial<RecipeData>>({\r\n    recipe_name: \"\",\r\n    cook_time: undefined,\r\n    difficulty: undefined,\r\n    servings: undefined,\r\n  });\r\n  const [ingredients, setIngredients] = useState<Ingredient[]>([\r\n    { name: \"\", amount: \"\", unit: \"\" }\r\n  ]);\r\n  const [steps, setSteps] = useState<RecipeStep[]>([\r\n    { order: 1, description: \"\" }\r\n  ]);\r\n  const [nutrition, setNutrition] = useState<NutritionInfo>({});\r\n  const [introduction, setIntroduction] = useState(\"\");\r\n\r\n  const STEPS = [\r\n    { key: \"basic\", title: t(\"recipe.step.basic\", \"基本信息\") },\r\n    { key: \"ingredients\", title: t(\"recipe.step.ingredients\", \"配料\") },\r\n    { key: \"steps\", title: t(\"recipe.step.steps\", \"步骤\") },\r\n  ];\r\n\r\n  const progress = ((currentStep + 1) / STEPS.length) * 100;\r\n\r\n  const validateBasicStep = () => {\r\n    if (!recipeData.recipe_name?.trim()) {\r\n      toast.error(t(\"recipe.nameRequired\", \"请输入食谱名称\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.cook_time || recipeData.cook_time < 1) {\r\n      toast.error(t(\"recipe.cookTimeRequired\", \"请输入烹饪时间\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.difficulty) {\r\n      toast.error(t(\"recipe.difficultyRequired\", \"请选择难度\"));\r\n      return false;\r\n    }\r\n    if (!recipeData.servings || recipeData.servings < 1) {\r\n      toast.error(t(\"recipe.servingsRequired\", \"请输入份量\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateIngredientsStep = () => {\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    if (validIngredients.length === 0) {\r\n      toast.error(t(\"recipe.ingredientsRequired\", \"请至少添加一种配料\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const validateStepsStep = () => {\r\n    const validSteps = steps.filter(s => s.description.trim());\r\n    if (validSteps.length === 0) {\r\n      toast.error(t(\"recipe.stepsRequired\", \"请至少添加一个步骤\"));\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleNext = () => {\r\n    if (currentStep === 0 && !validateBasicStep()) return;\r\n    if (currentStep === 1 && !validateIngredientsStep()) return;\r\n    setCurrentStep((prev) => Math.min(prev + 1, STEPS.length - 1));\r\n  };\r\n\r\n  const handleBack = () => {\r\n    setCurrentStep((prev) => Math.max(prev - 1, 0));\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!validateStepsStep()) return;\r\n\r\n    const validIngredients = ingredients.filter(i => i.name.trim());\r\n    const validSteps = steps\r\n      .filter(s => s.description.trim())\r\n      .map((s, i) => ({ ...s, order: i + 1 }));\r\n\r\n    // Only include nutrition if at least one field has a value\r\n    const hasNutrition = nutrition.calories || nutrition.protein || nutrition.carbs || nutrition.fat;\r\n\r\n    try {\r\n      await createRecipe.mutateAsync({\r\n        recipe_name: recipeData.recipe_name!,\r\n        cook_time: recipeData.cook_time!,\r\n        difficulty: recipeData.difficulty!,\r\n        servings: recipeData.servings!,\r\n        ingredients: validIngredients,\r\n        steps: validSteps,\r\n        cover_image: coverImage,\r\n        nutrition: hasNutrition ? nutrition : undefined,\r\n        introduction: introduction.trim() || undefined,\r\n      });\r\n      onSuccess();\r\n    } catch (error) {\r\n      // Error handled in hook\r\n    }\r\n  };\r\n\r\n  const renderStepContent = () => {\r\n    switch (currentStep) {\r\n      case 0:\r\n        return (\r\n          <RecipeBasicStep\r\n            data={recipeData}\r\n            coverImage={coverImage}\r\n            nutrition={nutrition}\r\n            introduction={introduction}\r\n            onDataChange={setRecipeData}\r\n            onCoverImageChange={setCoverImage}\r\n            onNutritionChange={setNutrition}\r\n            onIntroductionChange={setIntroduction}\r\n          />\r\n        );\r\n      case 1:\r\n        return (\r\n          <RecipeIngredientsStep\r\n            ingredients={ingredients}\r\n            onChange={setIngredients}\r\n          />\r\n        );\r\n      case 2:\r\n        return (\r\n          <RecipeStepsStep\r\n            steps={steps}\r\n            onChange={setSteps}\r\n          />\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-full flex flex-col\">\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b bg-background shrink-0\">\r\n        <div className=\"flex items-center justify-between mb-3\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={onClose}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <h2 className=\"font-medium\">{t(\"recipe.createTitle\", \"创建食谱\")}</h2>\r\n          <div className=\"w-6\" /> {/* Spacer */}\r\n        </div>\r\n\r\n        {/* Step Progress */}\r\n        <div className=\"space-y-2\">\r\n          <Progress value={progress} className=\"h-1\" />\r\n          <div className=\"flex justify-between text-xs text-muted-foreground\">\r\n            {STEPS.map((step, index) => (\r\n              <span\r\n                key={step.key}\r\n                className={index === currentStep ? \"text-primary font-medium\" : \"\"}\r\n              >\r\n                {step.title}\r\n              </span>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4\">\r\n        {renderStepContent()}\r\n      </div>\r\n\r\n      {/* Footer */}\r\n      <div className=\"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0\">\r\n        <div className=\"flex gap-3\">\r\n          {currentStep > 0 && (\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              onClick={handleBack}\r\n              className=\"flex-1\"\r\n            >\r\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\r\n              {t(\"common.back\", \"上一步\")}\r\n            </Button>\r\n          )}\r\n          \r\n          {currentStep < STEPS.length - 1 ? (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleNext}\r\n              className=\"flex-1\"\r\n            >\r\n              {t(\"common.next\", \"下一步\")}\r\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\r\n            </Button>\r\n          ) : (\r\n            <Button\r\n              type=\"button\"\r\n              onClick={handleSubmit}\r\n              disabled={createRecipe.isPending}\r\n              className=\"flex-1\"\r\n            >\r\n              {createRecipe.isPending ? (\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              ) : (\r\n                <Check className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              {t(\"recipe.publish\", \"发布食谱\")}\r\n            </Button>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreateRecipeWizard;\r\n","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Image, Video, X, Loader2, Calendar, MapPin, Gift, ArrowLeft } from \"lucide-react\";\r\nimport PostPointsRulesDialog from \"./PostPointsRulesDialog\";\r\nimport MultiRestaurantSelectDrawer from \"./MultiRestaurantSelectDrawer\";\r\nimport ActivitySelectDrawer from \"./ActivitySelectDrawer\";\r\nimport EmojiPicker from \"./EmojiPicker\";\r\nimport PostTypeSelector from \"./PostTypeSelector\";\r\nimport CreateRecipeWizard from \"./recipe/CreateRecipeWizard\";\r\nimport {\r\n  Sheet,\r\n  SheetContent,\r\n  SheetTitle,\r\n  SheetTrigger,\r\n} from \"@/components/ui/sheet\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useCreatePost, useMerchantRestaurant, useHasPostedToday } from \"@/hooks/useCommunityPosts\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { useRestaurants } from \"@/hooks/useRestaurants\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport * as VisuallyHidden from \"@radix-ui/react-visually-hidden\";\r\n\r\ninterface CreatePostDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nconst CreatePostDialog = ({ trigger }: CreatePostDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const createPost = useCreatePost();\r\n  const { data: activities } = useActivities();\r\n  const { data: restaurants } = useRestaurants();\r\n  const { role, isMerchant, isAdmin, isSupervisor } = useUserRole();\r\n  const { data: merchantRestaurant } = useMerchantRestaurant();\r\n  const { data: hasPostedToday, isLoading: checkingPost } = useHasPostedToday();\r\n\r\n  const [open, setOpen] = useState(false);\r\n  const [postType, setPostType] = useState<'selecting' | 'post' | 'recipe'>('selecting');\r\n  const [content, setContent] = useState(\"\");\r\n  const [imageUrls, setImageUrls] = useState<string[]>([]);\r\n  const [videoUrl, setVideoUrl] = useState<string | null>(null);\r\n  const [activityId, setActivityId] = useState<string>(\"\");\r\n  const [restaurantIds, setRestaurantIds] = useState<string[]>([]);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [restaurantOpen, setRestaurantOpen] = useState(false);\r\n  const [activityOpen, setActivityOpen] = useState(false);\r\n  const [showRestaurantError, setShowRestaurantError] = useState(false);\r\n\r\n  const imageInputRef = useRef<HTMLInputElement>(null);\r\n  const videoInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  // 普通用户 = 既不是商家、督导也不是管理员\r\n  const isRegularUser = !isMerchant && !isSupervisor && !isAdmin;\r\n  \r\n  // 是否可以创建食谱（只有管理员、督导、商家可以）\r\n  const canCreateRecipe = isAdmin || isSupervisor || isMerchant;\r\n\r\n  // 商家自动设置餐厅\r\n  useEffect(() => {\r\n    if (isMerchant && merchantRestaurant && open) {\r\n      setRestaurantIds([merchantRestaurant.id]);\r\n    }\r\n  }, [isMerchant, merchantRestaurant, open]);\r\n\r\n  // 重置表单\r\n  const resetForm = () => {\r\n    // 普通用户直接进入发帖模式，其他用户进入选择模式\r\n    setPostType(canCreateRecipe ? 'selecting' : 'post');\r\n    setContent(\"\");\r\n    setImageUrls([]);\r\n    setVideoUrl(null);\r\n    setActivityId(\"\");\r\n    setRestaurantIds([]);\r\n    setRestaurantOpen(false);\r\n    setActivityOpen(false);\r\n    setShowRestaurantError(false);\r\n  };\r\n\r\n  // 初始化时设置正确的 postType\r\n  useEffect(() => {\r\n    if (open) {\r\n      setPostType(canCreateRecipe ? 'selecting' : 'post');\r\n    }\r\n  }, [open, canCreateRecipe]);\r\n\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (!newOpen) {\r\n      resetForm();\r\n    }\r\n  };\r\n\r\n  // Get active activities\r\n  const activeActivities = activities?.filter((a) => a.status === \"published\") || [];\r\n\r\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const files = e.target.files;\r\n    if (!files || files.length === 0) return;\r\n\r\n    if (imageUrls.length + files.length > 9) {\r\n      toast.error(t(\"community.maxImages\", \"最多上传9张图片\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      const uploadedUrls: string[] = [];\r\n\r\n      for (const file of Array.from(files)) {\r\n        const fileExt = file.name.split(\".\").pop();\r\n        const fileName = `${user.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;\r\n\r\n        const { error: uploadError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(fileName, file);\r\n\r\n        if (uploadError) throw uploadError;\r\n\r\n        const { data: { publicUrl } } = supabase.storage\r\n          .from(\"community-posts\")\r\n          .getPublicUrl(fileName);\r\n\r\n        uploadedUrls.push(publicUrl);\r\n      }\r\n\r\n      setImageUrls((prev) => [...prev, ...uploadedUrls]);\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (imageInputRef.current) {\r\n        imageInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  // Extract first frame from video file\r\n  const extractVideoFirstFrame = (videoFile: File): Promise<Blob> => {\r\n    return new Promise((resolve, reject) => {\r\n      const video = document.createElement('video');\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      \r\n      video.preload = 'auto';\r\n      video.muted = true;\r\n      video.playsInline = true;\r\n      \r\n      let hasResolved = false;\r\n      \r\n      const captureFrame = () => {\r\n        if (hasResolved) return;\r\n        if (video.videoWidth === 0 || video.videoHeight === 0) return;\r\n        \r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        \r\n        if (ctx) {\r\n          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n          canvas.toBlob((blob) => {\r\n            if (blob && blob.size > 0) {\r\n              hasResolved = true;\r\n              video.pause();\r\n              URL.revokeObjectURL(video.src);\r\n              resolve(blob);\r\n            } else {\r\n              reject(new Error('Failed to create blob'));\r\n            }\r\n          }, 'image/jpeg', 0.85);\r\n        }\r\n      };\r\n      \r\n      video.onloadedmetadata = () => {\r\n        canvas.width = video.videoWidth;\r\n        canvas.height = video.videoHeight;\r\n        video.currentTime = 0.1; // Jump to 0.1s to ensure frame is available\r\n      };\r\n      \r\n      video.onseeked = () => {\r\n        setTimeout(captureFrame, 100);\r\n      };\r\n      \r\n      video.onerror = () => {\r\n        URL.revokeObjectURL(video.src);\r\n        reject(new Error('Failed to load video'));\r\n      };\r\n      \r\n      // Timeout handling\r\n      setTimeout(() => {\r\n        if (!hasResolved) {\r\n          URL.revokeObjectURL(video.src);\r\n          reject(new Error('Timeout'));\r\n        }\r\n      }, 10000);\r\n      \r\n      video.src = URL.createObjectURL(videoFile);\r\n      video.load();\r\n    });\r\n  };\r\n\r\n  const handleVideoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n\r\n    // Check file size (max 100MB)\r\n    if (file.size > 100 * 1024 * 1024) {\r\n      toast.error(t(\"community.videoTooLarge\", \"视频不能超过100MB\"));\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    try {\r\n      const { data: { user } } = await supabase.auth.getUser();\r\n      if (!user) throw new Error(\"Not authenticated\");\r\n\r\n      // 1. Upload video\r\n      const videoExt = file.name.split(\".\").pop();\r\n      const videoFileName = `${user.id}/${Date.now()}.${videoExt}`;\r\n\r\n      const { error: videoError } = await supabase.storage\r\n        .from(\"community-posts\")\r\n        .upload(videoFileName, file);\r\n\r\n      if (videoError) throw videoError;\r\n\r\n      const { data: { publicUrl: videoPublicUrl } } = supabase.storage\r\n        .from(\"community-posts\")\r\n        .getPublicUrl(videoFileName);\r\n\r\n      setVideoUrl(videoPublicUrl);\r\n\r\n      // 2. Extract and upload cover image\r\n      try {\r\n        toast.info(t(\"community.extractingCover\", \"正在提取视频封面...\"));\r\n        const coverBlob = await extractVideoFirstFrame(file);\r\n        const coverFileName = `${user.id}/${Date.now()}-cover.jpg`;\r\n        \r\n        const { error: coverError } = await supabase.storage\r\n          .from(\"community-posts\")\r\n          .upload(coverFileName, coverBlob);\r\n        \r\n        if (!coverError) {\r\n          const { data: { publicUrl: coverUrl } } = supabase.storage\r\n            .from(\"community-posts\")\r\n            .getPublicUrl(coverFileName);\r\n          \r\n          // Add cover image to the beginning of imageUrls\r\n          setImageUrls(prev => [coverUrl, ...prev]);\r\n          toast.success(t(\"community.coverExtracted\", \"封面已自动生成\"));\r\n        }\r\n      } catch (coverError) {\r\n        console.warn(\"Cover extraction failed:\", coverError);\r\n        // Cover extraction failure should not block video upload\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Upload error:\", error);\r\n      toast.error(t(\"common.uploadError\", \"上传失败\"));\r\n    } finally {\r\n      setUploading(false);\r\n      if (videoInputRef.current) {\r\n        videoInputRef.current.value = \"\";\r\n      }\r\n    }\r\n  };\r\n\r\n  const removeImage = (index: number) => {\r\n    setImageUrls((prev) => prev.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const removeVideo = () => {\r\n    setVideoUrl(null);\r\n    // Remove auto-generated cover image (URL contains -cover.jpg)\r\n    setImageUrls(prev => {\r\n      if (prev.length > 0 && prev[0].includes('-cover.jpg')) {\r\n        return prev.slice(1);\r\n      }\r\n      return prev;\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    // 重置错误状态\r\n    setShowRestaurantError(false);\r\n\r\n    if (!content.trim()) {\r\n      toast.error(t(\"community.contentRequired\", \"请输入内容\"));\r\n      return;\r\n    }\r\n\r\n    // 普通用户必须选择餐厅\r\n    if (isRegularUser && restaurantIds.length === 0) {\r\n      setShowRestaurantError(true);\r\n      toast.error(t(\"community.restaurantRequired\", \"请选择餐厅\"));\r\n      return;\r\n    }\r\n\r\n    await createPost.mutateAsync({\r\n      content,\r\n      image_urls: imageUrls,\r\n      video_url: videoUrl || undefined,\r\n      activity_id: activityId || undefined,\r\n      restaurant_ids: restaurantIds.length > 0 ? restaurantIds : undefined,\r\n    });\r\n\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n\r\n  // 获取商家餐厅名称\r\n  const getMerchantRestaurantName = () => {\r\n    if (!merchantRestaurant) return t(\"community.noRestaurant\", \"未关联餐厅\");\r\n    return getLocalizedField(merchantRestaurant, \"name\");\r\n  };\r\n\r\n  // Handle recipe creation success\r\n  const handleRecipeSuccess = () => {\r\n    resetForm();\r\n    setOpen(false);\r\n  };\r\n\r\n  return (\r\n    <Sheet open={open} onOpenChange={handleOpenChange}>\r\n      <SheetTrigger asChild>\r\n        {trigger || (\r\n          <Button>{t(\"community.createPost\", \"发布帖子\")}</Button>\r\n        )}\r\n      </SheetTrigger>\r\n      <SheetContent \r\n        side=\"bottom\" \r\n        className=\"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden\"\r\n      >\r\n        <VisuallyHidden.Root>\r\n          <SheetTitle>{t(\"community.createPost\", \"发布帖子\")}</SheetTitle>\r\n        </VisuallyHidden.Root>\r\n\r\n        {/* Post Type Selection */}\r\n        {postType === 'selecting' && (\r\n          <div className=\"h-full flex flex-col\">\r\n            <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setOpen(false)}\r\n                className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n              >\r\n                <ArrowLeft className=\"h-5 w-5\" />\r\n              </button>\r\n              <span className=\"font-medium\">{t(\"community.create\", \"发布\")}</span>\r\n              <div className=\"w-6\" />\r\n            </div>\r\n            <PostTypeSelector onSelect={setPostType} />\r\n          </div>\r\n        )}\r\n\r\n        {/* Recipe Creation Wizard */}\r\n        {postType === 'recipe' && (\r\n          <CreateRecipeWizard \r\n            onClose={() => setPostType('selecting')} \r\n            onSuccess={handleRecipeSuccess}\r\n          />\r\n        )}\r\n\r\n        {/* Regular Post Creation */}\r\n        {postType === 'post' && (\r\n          <>\r\n\r\n        {/* Top Navigation - for regular post */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => canCreateRecipe ? setPostType('selecting') : setOpen(false)}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md transition-colors\"\r\n          >\r\n            <ArrowLeft className=\"h-5 w-5\" />\r\n          </button>\r\n          <Button\r\n            size=\"sm\"\r\n            onClick={handleSubmit}\r\n            disabled={createPost.isPending || !content.trim()}\r\n            className=\"rounded-full px-6\"\r\n          >\r\n            {createPost.isPending && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {t(\"community.publish\", \"发布\")}\r\n          </Button>\r\n        </div>\r\n\r\n        {/* 可滚动内容区 */}\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <div className=\"px-4 py-4 space-y-4\">\r\n            {/* Points Hint - Only show if user hasn't posted today */}\r\n            {!checkingPost && !hasPostedToday && (\r\n              <div className=\"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <Gift className=\"h-4 w-4 shrink-0\" />\r\n                  <span>{t(\"community.dailyPointsHint\", \"每日发布首个帖子可获得5积分！\")}</span>\r\n                </div>\r\n                <PostPointsRulesDialog />\r\n              </div>\r\n            )}\r\n\r\n            {/* 内容输入区 */}\r\n            <Textarea\r\n              value={content}\r\n              onChange={(e) => setContent(e.target.value)}\r\n              placeholder={t(\"community.contentPlaceholder\", \"分享你的想法...\")}\r\n              className=\"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap\"\r\n            />\r\n\r\n            {/* 图片预览 */}\r\n            {imageUrls.length > 0 && (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                {imageUrls.map((url, index) => (\r\n                  <div key={index} className=\"relative aspect-square rounded-lg overflow-hidden bg-muted\">\r\n                    <img \r\n                      src={url} \r\n                      alt=\"\" \r\n                      className=\"w-full h-full object-cover\" \r\n                    />\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => removeImage(index)}\r\n                      className=\"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                    >\r\n                      <X className=\"h-3 w-3\" />\r\n                    </button>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* 视频预览 */}\r\n            {videoUrl && (\r\n              <div className=\"relative rounded-lg overflow-hidden\">\r\n                <video src={videoUrl} controls className=\"w-full max-h-48\" preload=\"metadata\" />\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={removeVideo}\r\n                  className=\"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* 关联信息区 */}\r\n        <div className=\"px-4 py-2 pb-0 bg-background shrink-0 space-y-2\">\r\n          <div className=\"flex items-center gap-6\">\r\n            {/* 餐厅选择 */}\r\n            <div className={`flex items-center gap-3 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : ''}`}>\r\n              <MapPin className={`h-5 w-5 shrink-0 ${showRestaurantError && isRegularUser && restaurantIds.length === 0 ? 'text-destructive' : 'text-muted-foreground'}`} />\r\n              {isMerchant ? (\r\n                <span className=\"text-sm text-muted-foreground\">\r\n                  {getMerchantRestaurantName()}\r\n                </span>\r\n              ) : (\r\n                <MultiRestaurantSelectDrawer\r\n                  open={restaurantOpen}\r\n                  onOpenChange={(open) => {\r\n                    setRestaurantOpen(open);\r\n                    if (open) setShowRestaurantError(false);\r\n                  }}\r\n                  value={restaurantIds}\r\n                  onSelect={(ids) => {\r\n                    setRestaurantIds(ids);\r\n                    setShowRestaurantError(false);\r\n                  }}\r\n                  restaurants={restaurants || []}\r\n                  required={isRegularUser}\r\n                />\r\n              )}\r\n            </div>\r\n\r\n            {/* 活动选择 */}\r\n            <div className=\"flex items-center gap-3\">\r\n              <Calendar className=\"h-5 w-5 text-muted-foreground shrink-0\" />\r\n              <ActivitySelectDrawer\r\n                open={activityOpen}\r\n                onOpenChange={setActivityOpen}\r\n                value={activityId}\r\n                onSelect={setActivityId}\r\n                activities={activeActivities}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {/* 错误提示 */}\r\n          {showRestaurantError && isRegularUser && restaurantIds.length === 0 && (\r\n            <p className=\"text-xs text-destructive pl-8\">\r\n              {t(\"community.restaurantRequired\", \"请选择餐厅\")}\r\n            </p>\r\n          )}\r\n        </div>\r\n\r\n        {/* 底部媒体工具栏 - 固定 */}\r\n        <div className=\"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0\">\r\n          <input\r\n            ref={imageInputRef}\r\n            type=\"file\"\r\n            accept=\"image/*\"\r\n            multiple\r\n            className=\"hidden\"\r\n            onChange={handleImageUpload}\r\n          />\r\n          <input\r\n            ref={videoInputRef}\r\n            type=\"file\"\r\n            accept=\"video/*\"\r\n            className=\"hidden\"\r\n            onChange={handleVideoUpload}\r\n          />\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => imageInputRef.current?.click()}\r\n            disabled={uploading || imageUrls.length >= 9}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Image className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.photo\", \"照片\")}</span>\r\n          </button>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => videoInputRef.current?.click()}\r\n            disabled={uploading || !!videoUrl}\r\n            className=\"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors\"\r\n          >\r\n            <Video className=\"h-5 w-5\" />\r\n            <span className=\"text-sm\">{t(\"community.video\", \"视频\")}</span>\r\n          </button>\r\n\r\n          <EmojiPicker\r\n            onSelect={(emoji) => setContent((prev) => prev + emoji)}\r\n          />\r\n\r\n        {uploading && <Loader2 className=\"h-5 w-5 animate-spin ml-auto\" />}\r\n        </div>\r\n        </>\r\n        )}\r\n      </SheetContent>\r\n    </Sheet>\r\n  );\r\n};\r\n\r\nexport default CreatePostDialog;\r\n","import { useCallback, useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, LayoutGrid, List, Clock, Flame, LayoutList, FileText, Utensils } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport CreatePostDialog from \"@/components/community/CreatePostDialog\";\r\nimport { useCommunityPosts, useCanCreatePost, SortOption, PostTypeFilter } from \"@/hooks/useCommunityPosts\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { useInfiniteScroll } from \"@/hooks/useInfiniteScroll\";\r\n\r\n// Skeleton for grid card\r\nconst PostGridSkeleton = () => (\r\n  <div className=\"rounded-xl overflow-hidden bg-card border border-border/50\">\r\n    <Skeleton className=\"aspect-[4/5] w-full\" />\r\n    <div className=\"p-3 space-y-3\">\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-4 w-full\" />\r\n        <Skeleton className=\"h-4 w-3/4\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <Skeleton className=\"h-5 w-5 rounded-full\" />\r\n          <Skeleton className=\"h-3 w-16\" />\r\n        </div>\r\n        <Skeleton className=\"h-4 w-10\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n);\r\n\r\nconst Community = () => {\r\n  const { t } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const isMobile = useIsMobile();\r\n  \r\n  // Layout state: 'double' for 2 columns, 'single' for 1 column (mobile only)\r\n  const [mobileLayout, setMobileLayout] = useState<'double' | 'single'>(() => {\r\n    const saved = localStorage.getItem('community-mobile-layout');\r\n    return (saved === 'single' ? 'single' : 'double') as 'double' | 'single';\r\n  });\r\n\r\n  // Sort state\r\n  const [sortBy, setSortBy] = useState<SortOption>(() => {\r\n    const saved = localStorage.getItem('community-sort');\r\n    return (saved === 'popular' ? 'popular' : 'latest') as SortOption;\r\n  });\r\n\r\n  // Post type filter state\r\n  const [postType, setPostType] = useState<PostTypeFilter>(() => {\r\n    const saved = localStorage.getItem('community-post-type');\r\n    return (['all', 'post', 'recipe'].includes(saved || '') ? saved : 'all') as PostTypeFilter;\r\n  });\r\n  \r\n  const { data: posts, isLoading } = useCommunityPosts({\r\n    status: \"approved\",\r\n    sortBy,\r\n    postType\r\n  });\r\n  const { data: canPost } = useCanCreatePost();\r\n\r\n  // Infinite scroll - only render 12 posts initially, load more on scroll\r\n  const {\r\n    displayedData: displayedPosts,\r\n    hasMore,\r\n    sentinelRef,\r\n  } = useInfiniteScroll({\r\n    data: posts,\r\n    initialItemsPerPage: 12,\r\n    incrementPerPage: 12,\r\n  });\r\n  \r\n  // Pull-to-refresh handler - clears cache and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear caches first to ensure fresh data\r\n    queryClient.removeQueries({ queryKey: ['community-posts'] });\r\n    queryClient.removeQueries({ queryKey: ['can-create-post'] });\r\n    queryClient.removeQueries({ queryKey: ['has-posted-today'] });\r\n    \r\n    // Refetch with fresh data\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['community-posts'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['can-create-post'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['has-posted-today'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  const toggleMobileLayout = () => {\r\n    const newLayout = mobileLayout === 'double' ? 'single' : 'double';\r\n    setMobileLayout(newLayout);\r\n    localStorage.setItem('community-mobile-layout', newLayout);\r\n  };\r\n\r\n  const handleSortChange = (value: string) => {\r\n    const newSort = value as SortOption;\r\n    setSortBy(newSort);\r\n    localStorage.setItem('community-sort', newSort);\r\n  };\r\n\r\n  const handlePostTypeChange = (value: PostTypeFilter) => {\r\n    setPostType(value);\r\n    localStorage.setItem('community-post-type', value);\r\n  };\r\n\r\n  // Grid classes based on layout\r\n  // Desktop (lg+): 4 columns, Tablet (md): 3 columns, Mobile: 1 or 2 based on toggle\r\n  const getGridClasses = () => {\r\n    if (isMobile) {\r\n      return mobileLayout === 'single' \r\n        ? 'columns-1 gap-4' \r\n        : 'columns-2 gap-3';\r\n    }\r\n    // Tablet: 3 columns, Desktop: 4 columns\r\n    return 'columns-3 lg:columns-4 gap-4';\r\n  };\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in\">\r\n        <div className=\"container mx-auto max-w-5xl\">\r\n          {/* Header */}\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <div>\r\n              <h1 className=\"text-3xl sm:text-4xl mb-2 text-primary font-medium\">\r\n                {t(\"community.title\", \"社区\")}\r\n              </h1>\r\n              <p className=\"text-muted-foreground text-base sm:text-lg\">\r\n                {t(\"community.description\", \"分享美食体验，发现更多精彩\")}\r\n              </p>\r\n            </div>\r\n            {canPost && (\r\n              <CreatePostDialog\r\n                trigger={\r\n                  <Button size=\"sm\" className=\"gap-1.5\">\r\n                    <Plus className=\"h-4 w-4\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"community.createPost\", \"发布\")}</span>\r\n                  </Button>\r\n                }\r\n              />\r\n            )}\r\n          </div>\r\n          \r\n          {/* Sort, Filter and Layout controls */}\r\n          <div className=\"flex items-center gap-2 mb-4\">\r\n            {/* Sort tabs */}\r\n            <div className=\"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n              <button\r\n                onClick={() => handleSortChange('latest')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'latest' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Clock className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortLatest\", \"最新\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handleSortChange('popular')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  sortBy === 'popular' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Flame className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.sortPopular\", \"热门\")}</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Post type filter tabs */}\r\n            <div className=\"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n              <button\r\n                onClick={() => handlePostTypeChange('all')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'all' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <LayoutList className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterAll\", \"全部\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handlePostTypeChange('post')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'post' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <FileText className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterPost\", \"帖子\")}</span>\r\n              </button>\r\n              <button\r\n                onClick={() => handlePostTypeChange('recipe')}\r\n                className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${\r\n                  postType === 'recipe' \r\n                    ? 'bg-background text-foreground shadow-sm' \r\n                    : ''\r\n                }`}\r\n              >\r\n                <Utensils className=\"h-3.5 w-3.5\" />\r\n                <span className=\"hidden sm:inline\">{t(\"community.filterRecipe\", \"食谱\")}</span>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Layout toggle - only show on mobile, always on the right */}\r\n            {isMobile && (\r\n              <button\r\n                onClick={toggleMobileLayout}\r\n                className=\"ml-auto inline-flex h-9 items-center justify-center whitespace-nowrap rounded-md bg-muted px-2.5 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\r\n                title={mobileLayout === 'double' \r\n                  ? t(\"community.singleColumn\", \"单列布局\") \r\n                  : t(\"community.doubleColumn\", \"双列布局\")}\r\n              >\r\n                {mobileLayout === 'double' ? (\r\n                  <List className=\"h-3.5 w-3.5\" />\r\n                ) : (\r\n                  <LayoutGrid className=\"h-3.5 w-3.5\" />\r\n                )}\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          {/* Content */}\r\n          {isLoading ? (\r\n            <div className={getGridClasses()}>\r\n              {Array.from({ length: 8 }).map((_, i) => (\r\n                <div key={i} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                  <PostGridSkeleton />\r\n                </div>\r\n              ))}\r\n            </div>\r\n          ) : posts && posts.length > 0 ? (\r\n            <>\r\n              <div className={getGridClasses()}>\r\n                {displayedPosts.map(post => (\r\n                  <div key={post.id} className=\"break-inside-avoid mb-3 sm:mb-4\">\r\n                    <PostGridCard \r\n                      post={post} \r\n                      showAssociations={isMobile && mobileLayout === 'single'}\r\n                    />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              {/* Infinite scroll sentinel */}\r\n              {hasMore && (\r\n                <div ref={sentinelRef} className=\"flex justify-center py-6\">\r\n                  <div className=\"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\r\n                </div>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <div className=\"flex flex-col items-center justify-center min-h-[60vh] text-center px-4\">\r\n              <div className=\"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4\">\r\n                <Plus className=\"w-8 h-8 text-muted-foreground/50\" />\r\n              </div>\r\n              <p className=\"text-muted-foreground text-lg\">\r\n                {t(\"community.noPosts\", \"暂无帖子\")}\r\n              </p>\r\n              {canPost && (\r\n                <p className=\"mt-2 text-sm text-muted-foreground/70\">\r\n                  {t(\"community.beFirst\", \"成为第一个发帖的人吧！\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Community;\r\n"],"names":["PostPointsRulesDialog","t","useTranslation","settings","usePointsSettings","postPoints","s","minLength","requireMedia","Dialog","jsx","DialogTrigger","jsxs","DialogContent","DialogHeader","DialogTitle","Gift","CheckCircle","Clock","Shield","PostTypeSelector","onSelect","FileText","Utensils","useCreateRecipe","queryClient","useQueryClient","useMutation","params","user","supabase","content","imageUrls","step","url","data","error","err","toast","CreateRecipeWizard","onClose","onSuccess","createRecipe","currentStep","setCurrentStep","useState","coverImage","setCoverImage","recipeData","setRecipeData","ingredients","setIngredients","steps","setSteps","nutrition","setNutrition","introduction","setIntroduction","STEPS","progress","validateBasicStep","validateIngredientsStep","i","validateStepsStep","handleNext","prev","handleBack","handleSubmit","validIngredients","validSteps","hasNutrition","renderStepContent","RecipeBasicStep","RecipeIngredientsStep","RecipeStepsStep","ArrowLeft","Progress","index","Button","ArrowRight","Loader2","Check","CreatePostDialog","trigger","getLocalizedField","useLocalizedContent","createPost","useCreatePost","activities","useActivities","restaurants","useRestaurants","role","isMerchant","isAdmin","isSupervisor","useUserRole","merchantRestaurant","useMerchantRestaurant","hasPostedToday","checkingPost","useHasPostedToday","open","setOpen","postType","setPostType","setContent","setImageUrls","videoUrl","setVideoUrl","activityId","setActivityId","restaurantIds","setRestaurantIds","uploading","setUploading","restaurantOpen","setRestaurantOpen","activityOpen","setActivityOpen","showRestaurantError","setShowRestaurantError","imageInputRef","useRef","videoInputRef","isRegularUser","canCreateRecipe","useEffect","resetForm","handleOpenChange","newOpen","activeActivities","a","handleImageUpload","e","files","uploadedUrls","file","fileExt","fileName","uploadError","publicUrl","extractVideoFirstFrame","videoFile","resolve","reject","video","canvas","ctx","hasResolved","captureFrame","blob","handleVideoUpload","videoExt","videoFileName","videoError","videoPublicUrl","coverBlob","coverFileName","coverError","coverUrl","removeImage","_","removeVideo","getMerchantRestaurantName","handleRecipeSuccess","Sheet","SheetTrigger","SheetContent","VisuallyHidden.Root","SheetTitle","Fragment","Textarea","X","MapPin","MultiRestaurantSelectDrawer","ids","Calendar","ActivitySelectDrawer","Image","Video","EmojiPicker","emoji","PostGridSkeleton","Skeleton","Community","isMobile","useIsMobile","mobileLayout","setMobileLayout","sortBy","setSortBy","saved","posts","isLoading","useCommunityPosts","canPost","useCanCreatePost","displayedPosts","hasMore","sentinelRef","useInfiniteScroll","handleRefresh","useCallback","toggleMobileLayout","newLayout","handleSortChange","value","newSort","handlePostTypeChange","getGridClasses","PullToRefresh","Plus","Flame","LayoutList","List","LayoutGrid","post","PostGridCard"],"mappings":"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"}