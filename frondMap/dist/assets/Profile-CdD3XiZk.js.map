{"version":3,"mappings":";mqDAoBO,SAASA,GAAuB,CACrC,KAAAC,EACA,aAAAC,EACA,SAAAC,CACF,EAAgC,CACxB,MAAE,EAAAC,GAAMC,KAEd,aACGC,GAAO,MAAAL,EAAY,aAAAC,EAClB,SAACK,EAAA,KAAAC,GAAA,CAAc,UAAU,2BACvB,UAAAC,MAACC,IACC,SAACD,MAAAE,GAAA,CAAY,UAAU,qCACpB,SAAAR,EAAS,MACZ,CACF,GAEAI,OAAC,MAAI,WAAU,YAEb,UAAAA,EAAA,KAACK,EAAM,SAAQ,YAAY,UAAU,kCACnC,UAACH,MAAAI,GAAA,CAAM,UAAU,uCAAwC,GACxDT,EAAE,2BAA2B,GAChC,EAGCD,EAAS,WACPM,MAAA,OAAI,UAAU,iEACb,SAAAA,EAAA,IAAC,OACC,IAAKN,EAAS,UACd,IAAKA,EAAS,MACd,UAAU,+BAEd,EAIFM,EAAA,IAAC,OACC,UAAU;AAAA,sDAEV,wBAAyB,CAAE,OAAQN,EAAS,OAAQ,EACtD,GACF,EACF,EACF,EAEJ,CC5DO,MAAMW,GAAe,IAAM,CAC1B,MAAE,KAAAC,GAASC,KAEjB,OAAOC,GAAS,CACd,SAAU,CAAC,YAAaF,GAAM,EAAE,EAChC,QAAS,SAAY,CACf,IAACA,EAAM,MAAO,GAElB,KAAM,CAAE,KAAMG,EAAW,MAAAC,CAAM,EAAI,MAAMC,EACtC,KAAK,WAAW,EAChB,OAAO,eAAe,EACtB,GAAG,UAAWL,EAAK,EAAE,EAExB,GAAII,EAAa,MAAAA,EAEjB,GAAI,CAACD,GAAaA,EAAU,SAAW,QAAU,GAEjD,MAAMG,EAAgBH,EAAU,IAAKI,GAAMA,EAAE,aAAa,EAEpD,CAAE,KAAMC,EAAa,MAAOC,GAAoB,MAAMJ,EACzD,KAAK,aAAa,EAClB,OAAO,GAAG,EACV,GAAG,KAAMC,CAAa,EACtB,GAAG,UAAW,EAAI,EAErB,GAAIG,EAAuB,MAAAA,EAE3B,OAAOD,GAAe,EACxB,EACA,QAAS,CAAC,CAACR,CAAA,CACZ,CACH,EC/BaU,GAAkB,IAAM,CAC7B,MAAE,KAAAV,GAASC,KAEjB,OAAOC,GAAS,CACd,SAAU,CAAC,gBAAiBF,GAAM,EAAE,EACpC,QAAS,SAAY,CACf,IAACA,EAAM,MAAO,GAGZ,MAAE,KAAMW,EAAU,MAAAP,CAAM,EAAI,MAAMC,EACrC,KAAK,UAAU,EACf,OAAO,GAAG,EACV,GAAG,UAAWL,EAAK,EAAE,EACrB,GAAG,YAAa,IAAI,EACpB,MAAM,aAAc,CAAE,UAAW,EAAO,GAE3C,GAAII,EAAa,MAAAA,EACjB,GAAI,CAACO,GAAYA,EAAS,SAAW,QAAU,GAGzC,MAAAL,EAAgBK,EACnB,OAAYC,KAAE,cAAgB,YAAY,EAC1C,IAASA,KAAE,SAAS,EACjBC,EAAcF,EACjB,OAAYC,KAAE,cAAgB,UAAU,EACxC,IAASA,KAAE,SAAS,EAGjBE,MAAoB,IACtB,GAAAR,EAAc,OAAS,EAAG,CAC5B,KAAM,CAAE,KAAME,CAAY,EAAI,MAAMH,EACjC,KAAK,aAAa,EAClB,OAAO,4BAA4B,EACnC,GAAG,KAAMC,CAAa,EAEzBE,GAAa,QAAa,IACxBM,EAAc,IAAI,EAAE,GAAI,CAAE,KAAM,EAAE,KAAM,QAAS,EAAE,SAAW,OAAW,QAAS,EAAE,SAAW,OAAW,EAC3G,CACH,CAGM,MAAAC,MAAkB,IACpB,GAAAF,EAAY,OAAS,EAAG,CAC1B,KAAM,CAAE,KAAMG,CAAW,EAAI,MAAMX,EAChC,KAAK,YAAY,EACjB,OAAO,kCAAkC,EACzC,GAAG,KAAMQ,CAAW,EAEvBG,GAAY,QAAaC,GAAA,CACvBF,EAAY,IAAIE,EAAE,GAAI,CAAE,SAAUA,EAAE,SAAU,SAAUA,EAAE,SAAU,SAAUA,EAAE,QAAU,GAC3F,CACH,CAGO,OAAAN,EAAS,IAAeO,GAAA,CACzB,GAAAA,EAAQ,cAAgB,aAAc,CACxC,MAAMC,EAAaL,EAAc,IAAII,EAAQ,SAAS,EAC/C,OACL,GAAGA,EACH,YAAaC,GAAY,MAAQ,qBACjC,eAAgBA,GAAY,QAC5B,eAAgBA,GAAY,QAC9B,SACSD,EAAQ,cAAgB,WAAY,CAC7C,MAAM9B,EAAW2B,EAAY,IAAIG,EAAQ,SAAS,EAC3C,OACL,GAAGA,EACH,YAAa9B,GAAU,UAAY,mBACnC,eAAgBA,GAAU,SAC1B,eAAgBA,GAAU,SAE9B,CACO,OAAA8B,CAAA,CACR,CACH,EACA,QAAS,CAAC,CAAClB,EACX,UAAW,IACZ,CACH,ECtDaoB,GAAwB,IAAM,CACnC,MAAE,KAAApB,GAASC,KACX,CAAE,KAAMoB,EAAgB,IAAOC,GAAuB,EAE5D,OAAOpB,GAAS,CACd,SAAU,CAAC,qBAAsBF,GAAM,EAAE,EACzC,QAAS,SAAY,CACnB,GAAI,CAACA,GAAQqB,EAAc,SAAW,QAAU,GAEhD,MAAMf,EAAgBe,EAAc,IAAIE,GAAKA,EAAE,EAAE,EAG3C,CAAE,KAAMC,EAAqB,MAAApB,CAAA,EAAU,MAAMC,EAChD,KAAK,sBAAsB,EAC3B,OAAO,GAAG,EACV,GAAG,gBAAiBC,CAAa,EACjC,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,GAAIF,EAAa,MAAAA,EACjB,GAAI,CAACoB,GAAuBA,EAAoB,SAAW,QAAU,GAGrE,KAAM,CAAE,KAAMhB,CAAY,EAAI,MAAMH,EACjC,KAAK,aAAa,EAClB,OAAO,qCAAqC,EAC5C,GAAG,KAAMC,CAAa,EAGnBO,EAAc,CAAC,GAAG,IAAI,IAAIW,EAAoB,IAAUC,KAAG,WAAW,CAAC,CAAC,EACxE,CAAE,KAAMT,GAAe,MAAMX,EAChC,KAAK,YAAY,EACjB,OAAO,GAAG,EACV,GAAG,KAAMQ,CAAW,EACpB,GAAG,SAAU,WAAW,EAqBpB,OAlByCW,EAC7C,IAAUC,GAAA,CACT,MAAMN,EAAaX,GAAa,QAAUe,EAAE,KAAOE,EAAG,aAAa,EAC7DrC,EAAW4B,GAAY,QAAUC,EAAE,KAAOQ,EAAG,WAAW,EAEvD,OACL,YAAaA,EAAG,YAChB,cAAeA,EAAG,cAClB,gBAAiBN,GAAY,MAAQ,GACrC,mBAAoBA,GAAY,SAAW,KAC3C,mBAAoBA,GAAY,SAAW,KAC3C,mBAAoBA,GAAY,SAAW,GAC3C,SAAU/B,GAAY,KACtB,WAAYqC,EAAG,WACjB,CACD,EACA,OAAeC,KAAK,WAAa,IAAI,CAG1C,EACA,QAAS,CAAC,CAAC1B,GAAQqB,EAAc,OAAS,EAC3C,CACH,EC/CMM,GAAgB,CACpB,CAAE,KAAM,OAAQ,QAAS,WAAY,KAAM,MAAO,EAClD,CAAE,KAAM,MAAO,QAAS,QAAS,KAAM,MAAO,EAC9C,CAAE,KAAM,MAAO,QAAS,SAAU,KAAM,MAAO,EAC/C,CAAE,KAAM,MAAO,QAAS,UAAW,KAAM,MAAO,EAChD,CAAE,KAAM,MAAO,QAAS,QAAS,KAAM,MAAO,EAC9C,CAAE,KAAM,MAAO,QAAS,KAAM,KAAM,MAAO,EAC3C,CAAE,KAAM,MAAO,QAAS,cAAe,KAAM,MAAO,EACpD,CAAE,KAAM,MAAO,QAAS,UAAW,KAAM,MAAO,EAChD,CAAE,KAAM,MAAO,QAAS,QAAS,KAAM,MAAO,EAC9C,CAAE,KAAM,KAAM,QAAS,aAAc,KAAM,MAAO,EAClD,CAAE,KAAM,MAAO,QAAS,SAAU,KAAM,MAAO,CACjD,EAGMC,GAAsBC,GAAyC,CACnE,GAAI,CAACA,EAAW,MAAO,CAAE,KAAM,OAAQ,OAAQ,IAG/C,UAAWC,KAAWH,GACpB,GAAIE,EAAU,WAAWC,EAAQ,IAAI,EAC5B,OACL,KAAMA,EAAQ,KACd,OAAQD,EAAU,MAAMC,EAAQ,KAAK,MAAM,EAAE,KAAK,GAMxD,MAAO,CAAE,KAAM,OAAQ,OAAQD,CAAU,CAC3C,EAUME,GAAoB,CAAC,CAAE,QAAAC,KAAsC,CAC3D,MAAE,GAAM1C,KACR2C,EAAWC,KACX,CAAE,KAAAlC,GAASC,KACX,CAAE,QAAAkC,GAAYC,KACd,CAAClD,EAAMmD,CAAO,EAAIC,WAAS,EAAK,EAChC,CAACC,EAAaC,CAAc,EAAIF,WAASN,EAAQ,YAAY,EAG7DS,EAAcb,GAAmBI,EAAQ,KAAK,EAC9C,CAACU,EAAWC,CAAY,EAAIL,WAASG,EAAY,IAAI,EACrD,CAACG,EAAOC,CAAQ,EAAIP,WAASG,EAAY,MAAM,EAC/C,CAACK,EAAgBC,CAAiB,EAAIT,WAAS,EAAK,EAEpD,CAACU,EAAYC,CAAa,EAAIX,WAAsB,IAAI,EACxD,CAACY,EAAeC,CAAgB,EAAIb,EAAS,SAAAN,EAAQ,YAAc,EAAE,EACrE,CAACoB,EAAkBC,CAAmB,EAAIf,WAAS,EAAK,EACxD,CAACgB,EAAmBC,CAAoB,EAAIjB,WAAS,EAAK,EAC1D,CAACkB,EAAmBC,CAAoB,EAAInB,WAAS,EAAE,EACvD,CAACoB,GAAYC,CAAa,EAAIrB,WAAS,EAAK,EAG5CsB,GAAcC,SAAO,EAAK,EAGhCC,YAAU,IAAM,CACd,MAAMC,EAAUH,GAAY,QAIxB,GAHJA,GAAY,QAAU1E,EAGlBA,GAAQ,CAAC6E,EAAS,CACpBvB,EAAeR,EAAQ,YAAY,EAC7B,MAAAgC,EAAiBpC,GAAmBI,EAAQ,KAAK,EACvDW,EAAaqB,EAAe,IAAI,EAChCnB,EAASmB,EAAe,MAAM,EACbb,EAAAnB,EAAQ,YAAc,EAAE,EACzCiB,EAAc,IAAI,EAClBF,EAAkB,EAAK,CACzB,GACC,CAAC7D,EAAM8C,EAAQ,aAAcA,EAAQ,MAAOA,EAAQ,UAAU,CAAC,EAGlE,KAAM,CAACiC,GAAiBC,CAAkB,EAAI5B,WAAS,EAAK,EACtD,CAAC6B,EAAoBC,CAAqB,EAAI9B,WAAS,EAAK,EAC5D,CAAC+B,GAAyBC,CAA0B,EAAIhC,WAAS,EAAK,EACtE,CAACiC,EAAUC,CAAW,EAAIlC,WAAS,EAAE,EACrC,CAACmC,EAAcC,CAAe,EAAIpC,WAAS,EAAE,EAC7C,CAACqC,GAAcC,EAAe,EAAItC,WAAS,EAAE,EAC7C,CAACuC,GAAkBC,EAAmB,EAAIxC,WAAS,EAAK,EACxD,CAACyC,GAAkBC,EAAmB,EAAI1C,WAAS,EAAK,EACxD,CAAC2C,GAAiBC,EAAkB,EAAI5C,WAAS,EAAK,EAGtD,CAAC6C,GAAoBC,EAAqB,EAAI9C,WAAS,EAAK,EAC5D,CAAC+C,GAAuBC,EAAwB,EAAIhD,WAAS,EAAK,EAClE,CAACiD,GAAiBC,EAAkB,EAAIlD,WAAS,EAAE,EACnD,CAACmD,GAAaC,EAAc,EAAIpD,WAAS,EAAE,EAC3C,CAACqD,GAAiBC,EAAkB,EAAItD,WAAS,EAAE,EACnD,CAACuD,GAAqBC,EAAsB,EAAIxD,WAAS,EAAK,EAC9D,CAACyD,GAAmBC,EAAoB,EAAI1D,WAAS,EAAE,EACvD,CAAC2D,GAAuBC,EAAwB,EAAI5D,WAAS,EAAK,EAClE,CAAC6D,GAAoBC,EAAqB,EAAI9D,WAAS,EAAK,EAC5D,CAAC+D,EAAkBC,EAAmB,EAAIhE,WAA8C,IAAI,EAE5FiE,GAAuB1C,SAAyB,IAAI,EACpD2C,GAAuB3C,SAAyB,IAAI,EACpD4C,GAA4B5C,SAAyB,IAAI,EAEzD6C,GAAgBC,KAChBC,GAAeC,KAGrB/C,YAAU,IAAM,CACVe,IAAoB0B,GAAqB,SAC3CA,GAAqB,QAAQ,OAC/B,EACC,CAAC1B,EAAgB,CAAC,EAGrBf,YAAU,IAAM,CACViB,IAAoByB,GAAqB,SAC3CA,GAAqB,QAAQ,OAC/B,EACC,CAACzB,EAAgB,CAAC,EAGrBjB,YAAU,IAAM,CACVmC,IAAyBQ,GAA0B,SACrDA,GAA0B,QAAQ,OACpC,EACC,CAACR,EAAqB,CAAC,EAEpB,MAAAa,GAAsBC,GAA2C,CACrE,MAAMC,EAAOD,EAAE,OAAO,QAAQ,CAAC,EAC/B,GAAIC,EAAM,CACR,GAAIA,EAAK,KAAO,EAAI,KAAO,KACzB,OAEF/D,EAAc+D,CAAI,EACD7D,EAAA,IAAI,gBAAgB6D,CAAI,CAAC,CAC5C,GAGIC,GAAa,SAAY,CAC7B,IAAIC,EAAalF,EAAQ,WAEzB,GAAIgB,EAAY,CACd,MAAMmE,GAAc,MAAMP,GAAa,YAAY5D,CAAU,EACzDmE,KAA0BD,EAAAC,GAChC,CAGA,MAAMtF,EAAYe,EAAQ,GAAGF,CAAS,IAAIE,CAAK,GAAK,OAEpD,MAAM8D,GAAc,YAAY,CAC9B,aAAcnE,EACd,MAAOV,EACP,WAAYqF,GAAc,OAC3B,EAEDnE,EAAkB,EAAK,EACvBV,EAAQ,EAAK,GAGT+E,GAAsB,SAAY,CACtC,GAAI,GAACpH,GAAQwD,EAAkB,gBAAkB,UAEjD,CAAAG,EAAc,EAAI,EACd,IAEF,KAAM,CAAE,MAAAvD,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,iBAAkB,CAClE,KAAM,CAAE,OAAQL,EAAK,EAAG,EACzB,EAED,GAAII,EAAO,CACHiH,EAAA,MAAM,EAAE,6BAA6B,CAAC,EAC5C,QAAQ,MAAMjH,CAAK,EACnBuD,EAAc,EAAK,EACnB,MACF,CAGM0D,EAAA,QAAQ,EAAE,8BAA8B,CAAC,EAG/C9D,EAAqB,EAAK,EAC1BF,EAAoB,EAAK,EACzBI,EAAqB,EAAE,EAGvB,MAAM,IAAI,QAAQ6D,GAAW,WAAWA,EAAS,IAAI,CAAC,EAGhD,MAAAjH,EAAS,KAAK,UACpB4B,EAAS,OAAO,QACT7B,EAAY,CACnBiH,EAAM,MAAMjH,EAAM,SAAW,EAAE,6BAA6B,CAAC,EAC7DuD,EAAc,EAAK,SACnB,CACAA,EAAc,EAAK,CACrB,IAGI4D,GAAyB,SAAY,CACrC,GAACvH,GAAM,MAEP,IACF,KAAM,CAAE,MAAAI,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,yBAA0B,CAC1E,KAAM,CAAE,MAAOL,EAAK,KAAM,EAC3B,EAED,GAAII,EAAa,MAAAA,EAEjB0E,GAAoB,EAAI,EAClBuC,EAAA,QAAQ,EAAE,4BAA4B,CAAC,QACtCjH,EAAY,CACbiH,EAAA,MAAM,EAAE,wBAAwB,CAAC,EACvC,QAAQ,MAAMjH,CAAK,CACrB,GAGIoH,GAAuB,SAAY,CACvC,GAAI,CAAC/C,EAAc,CACX4C,EAAA,MAAM,EAAE,8BAA8B,CAAC,EAC7C,MACF,CAEI,IACI,MAAE,KAAAI,EAAM,MAAArH,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,oBAAqB,CAC3E,KAAM,CAAE,MAAOL,GAAM,MAAO,KAAMyE,CAAa,EAChD,EAEG,GAAArE,GAAS,CAACqH,GAAM,QAAS,CACrBJ,EAAA,MAAM,EAAE,uBAAuB,CAAC,EACtC,MACF,CAEMA,EAAA,QAAQ,EAAE,0BAA0B,CAAC,EAC3CnD,EAAmB,EAAK,EACxBE,EAAsB,EAAI,QACnBhE,EAAY,CACbiH,EAAA,MAAM,EAAE,4BAA4B,CAAC,EAC3C,QAAQ,MAAMjH,CAAK,CACrB,GAGIsH,GAAyB,SAAY,CACzC,GAAI,CAACnD,GAAY,CAACA,EAAS,SAAS,GAAG,EAAG,CAClC8C,EAAA,MAAM,EAAE,yBAAyB,CAAC,EACxC,MACF,CAEI,IACF,KAAM,CAAE,MAAAjH,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,yBAA0B,CAC1E,KAAM,CAAE,MAAOkE,CAAS,EACzB,EAED,GAAInE,EAAa,MAAAA,EAEXiH,EAAA,QAAQ,EAAE,4BAA4B,CAAC,EAC7CrC,GAAoB,EAAI,QACjB5E,EAAY,CACbiH,EAAA,MAAM,EAAE,wBAAwB,CAAC,EACvC,QAAQ,MAAMjH,CAAK,CACrB,GAGIuH,GAAuB,SAAY,CACvC,GAAI,CAAChD,GAAc,CACX0C,EAAA,MAAM,EAAE,8BAA8B,CAAC,EAC7C,MACF,CAEI,IACI,MAAE,KAAAI,EAAM,MAAArH,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,oBAAqB,CAC3E,KAAM,CAAE,MAAOkE,EAAU,KAAMI,EAAa,EAC7C,EAEG,GAAAvE,GAAS,CAACqH,GAAM,QAAS,CACrBJ,EAAA,MAAM,EAAE,uBAAuB,CAAC,EACtC,MACF,CAEMA,EAAA,QAAQ,EAAE,0BAA0B,CAAC,EAE3CjD,EAAsB,EAAK,EAE3B,WAAW,IAAM,CACfE,EAA2B,EAAI,GAC9B,GAAG,QACClE,EAAY,CACbiH,EAAA,MAAM,EAAE,0BAA0B,CAAC,EACzC,QAAQ,MAAMjH,CAAK,CACrB,GAGIwH,GAAoB,SAAY,CACpC1C,GAAmB,EAAI,EACnB,IACI,MAAE,KAAM,CAAE,QAAA2C,IAAc,MAAMxH,EAAS,KAAK,aAC9C,IAACwH,GAAW,CAAC7H,EAAM,CACfqH,EAAA,MAAM,EAAE,oBAAoB,CAAC,EACnCnC,GAAmB,EAAK,EACxB,MACF,CAGM,MAAE,KAAAuC,EAAM,MAAArH,EAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,eAAgB,CACtE,KAAM,CACJ,OAAQL,EAAK,GACb,SAAUA,EAAK,MACf,aAAAyE,EACA,SAAAF,EACA,aAAAI,EACF,EACA,QAAS,CACP,cAAe,UAAUkD,EAAQ,YAAY,EAC/C,EACD,EAEG,GAAAzH,IAAS,CAACqH,GAAM,QAClB,MAAM,IAAI,MAAMA,GAAM,OAAS,wBAAwB,EAGnDJ,EAAA,QAAQ,EAAE,2BAA2B,CAAC,EAG5C/C,EAA2B,EAAK,EAChCjC,EAAQ,EAAK,EAGbqC,EAAgB,EAAE,EAClBF,EAAY,EAAE,EACdI,GAAgB,EAAE,EAClBE,GAAoB,EAAK,EACzBE,GAAoB,EAAK,EAGzB,MAAM,IAAI,QAAQsC,IAAW,WAAWA,GAAS,IAAI,CAAC,EAChD,MAAAjH,EAAS,KAAK,UACpB4B,EAAS,OAAO,QACT7B,EAAY,CACnBiH,EAAM,MAAMjH,EAAM,SAAW,EAAE,wBAAwB,CAAC,EACxD,QAAQ,MAAMA,CAAK,SACnB,CACA8E,GAAmB,EAAK,CAC1B,GAII4C,GAAyBC,GAAmD,CAChF,IAAIC,EAAW,EASX,OAPAD,EAAS,QAAU,GAAGC,IACtBD,EAAS,QAAU,GAAGC,IACtB,QAAQ,KAAKD,CAAQ,GAAGC,IACxB,QAAQ,KAAKD,CAAQ,GAAGC,IACxB,QAAQ,KAAKD,CAAQ,GAAGC,IACxB,eAAe,KAAKD,CAAQ,GAAGC,IAE/BA,GAAY,EAAU,OACtBA,GAAY,EAAU,SACnB,UAGHC,GAAuB,MAAOlB,GAAyB,CAI3D,GAHAA,GAAG,eAAe,EAClBA,GAAG,gBAAgB,EAEf,CAACxB,GAAiB,CACd8B,EAAA,MAAM,EAAE,8BAA8B,CAAC,EAC7C,MACF,CAEI,IAEF,KAAM,CAAE,aAAAa,CAAA,EAAiB,MAAMC,GAAA,6BAAAD,IAAA,aAAO,+BAAuB,sBAAAA,EAAA,6BACvDE,GAAaF,EACjB,2CACA,mNACA,CACE,KAAM,CACJ,eAAgB,GAChB,iBAAkB,EACpB,CACF,GAGI,CAAE,MAAA9H,EAAM,EAAI,MAAMgI,GAAW,KAAK,mBAAmB,CACzD,MAAOpI,GAAM,OAAS,GACtB,SAAUuF,EAAA,CACX,EAED,GAAInF,GAAO,CACHiH,EAAA,MAAM,EAAE,8BAA8B,CAAC,EAC7C,MACF,CAEMA,EAAA,QAAQ,EAAE,6BAA6B,CAAC,EAC9CjC,GAAsB,EAAK,EAC3BE,GAAyB,EAAI,QACtBlF,EAAY,CACbiH,EAAA,MAAM,EAAE,4BAA4B,CAAC,EAC3C,QAAQ,MAAMjH,CAAK,CACrB,GAGIiI,GAA8B,SAAY,CAC1C,GAACrI,GAAM,MAEP,IACF,KAAM,CAAE,MAAAI,CAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,yBAA0B,CAC1E,KAAM,CAAE,MAAOL,EAAK,KAAM,EAC3B,EAED,GAAII,EAAa,MAAAA,EAEjB8F,GAAyB,EAAI,EACvBmB,EAAA,QAAQ,EAAE,4BAA4B,CAAC,QACtCjH,EAAY,CACbiH,EAAA,MAAM,EAAE,wBAAwB,CAAC,EACvC,QAAQ,MAAMjH,CAAK,CACrB,GAGIkI,GAA4B,MAAOvB,GAAyB,CAIhE,GAHAA,GAAG,eAAe,EAClBA,GAAG,gBAAgB,EAEf,CAAChB,GAAmB,CAChBsB,EAAA,MAAM,EAAE,8BAA8B,CAAC,EAC7C,MACF,CAEI,IACI,MAAE,KAAAI,EAAM,MAAArH,EAAM,EAAI,MAAMC,EAAS,UAAU,OAAO,oBAAqB,CAC3E,KAAM,CAAE,MAAOL,GAAM,MAAO,KAAM+F,EAAkB,EACrD,EAEG,GAAA3F,IAAS,CAACqH,GAAM,QAAS,CACrBJ,EAAA,MAAM,EAAE,uBAAuB,CAAC,EACtC,MACF,CAEMA,EAAA,QAAQ,EAAE,0BAA0B,CAAC,EAC3CjC,GAAsB,EAAK,EAC3BE,GAAyB,EAAI,QACtBlF,EAAY,CACbiH,EAAA,MAAM,EAAE,4BAA4B,CAAC,EAC3C,QAAQ,MAAMjH,CAAK,CACrB,GAGImI,GAAuB,MAAOxB,GAAyB,CAIvD,GAHJA,GAAG,eAAe,EAClBA,GAAG,gBAAgB,EAEf,CAACtB,IAAe,CAACE,GAAiB,CAC9B0B,EAAA,MAAM,EAAE,0BAA0B,CAAC,EACzC,MACF,CAEI,GAAA5B,GAAY,OAAS,EAAG,CACpB4B,EAAA,MAAM,EAAE,0BAA0B,CAAC,EACzC,MACF,CAEA,GAAI5B,KAAgBE,GAAiB,CAC7B0B,EAAA,MAAM,EAAE,4BAA4B,CAAC,EAC3C,MACF,CAEAjB,GAAsB,EAAI,EACtB,IACF,KAAM,CAAE,MAAAhG,CAAM,EAAI,MAAMC,EAAS,KAAK,WAAW,CAC/C,SAAUoF,EAAA,CACX,EAED,GAAIrF,EAAa,MAAAA,EAEXiH,EAAA,QAAQ,EAAE,yBAAyB,CAAC,EAG1C/B,GAAyB,EAAK,EAC9BjD,EAAQ,EAAK,EACbmD,GAAmB,EAAE,EACrBE,GAAe,EAAE,EACjBE,GAAmB,EAAE,EACrBE,GAAuB,EAAK,EAC5BE,GAAqB,EAAE,EACvBE,GAAyB,EAAK,QACvB9F,EAAY,CACnBiH,EAAM,MAAMjH,EAAM,SAAW,EAAE,8BAA8B,CAAC,EAC9D,QAAQ,MAAMA,CAAK,SACnB,CACAgG,GAAsB,EAAK,CAC7B,GAGF,cACG7G,GAAA,CAAO,KAAAL,EAAY,aAAcmD,EAChC,UAAA3C,MAAC8I,IAAc,QAAO,GACpB,SAAChJ,EAAA,KAAAiJ,EAAA,CAAO,QAAQ,UACd,UAAC/I,MAAAgJ,GAAA,CAAS,UAAU,eAAe,EAClC,EAAE,qBAAqB,GAC1B,EACF,EACClJ,OAAAC,GAAc,WAAU,6DACvB,UAAAD,OAACG,GACC,iBAACC,GAAA,CAAa,SAAE,uBAAqB,EAAE,QACtC+I,GAAA,CAAmB,SAAE,kCAAgC,EAAE,GAC1D,EACCnJ,OAAA,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,mCACb,UAACA,OAAAoJ,GAAA,CAAO,UAAU,4BAChB,UAAClJ,MAAAmJ,GAAA,CAAY,IAAK3F,EAAe,QAChC4F,GAAgB,UAAAvG,GAAa,OAAO,CAAC,EAAE,YAAY,EAAE,GACxD,SACC,MACC,WAAA7C,EAAA,IAACqJ,EAAA,CACC,KAAK,OACL,OAAO,UACP,SAAUjC,GACV,UAAU,SACV,GAAG,gBACL,EACAtH,EAAA,KAACiJ,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAM,SAAS,eAAe,eAAe,GAAG,MAAM,EAC/D,UAAU,qBAEV,UAAC/I,MAAAsJ,GAAA,CAAO,UAAU,qCAAqC,EACtD,EAAE,sBAAsB,GAC3B,GACF,GACF,EAECxJ,OAAA,MAAI,WAAU,cACb,UAAAE,MAACuJ,GAAM,QAAQ,cAAc,UAAU,UAAW,WAAE,qBAAqB,EAAE,EAC3EvJ,EAAA,IAACqJ,EAAA,CACC,GAAG,cACH,MAAOxG,EACP,SAAWwE,GAAMvE,EAAeuE,EAAE,OAAO,KAAK,EAC9C,YAAa,EAAE,qBAAqB,EACpC,UAAU,MACZ,GACF,EAECvH,OAAA,MAAI,WAAU,cACb,UAAAE,MAACuJ,GAAM,QAAQ,QAAQ,UAAU,UAAW,WAAE,eAAe,EAAE,EAC9D,CAACjH,EAAQ,OAAS,CAACc,EAClBpD,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAM1F,EAAkB,EAAI,EACrC,UAAU,2BAET,WAAE,wBAAwB,IAE3BD,GAAkB,CAACd,EAAQ,aAC5B,OAAI,UAAU,aACb,UAAAxC,EAAA,KAAC0J,GAAA,CACC,MAAOxG,EACP,cAAeC,EAEf,UAACjD,MAAAyJ,IAAc,UAAU,gBACvB,SAACzJ,MAAA0J,GAAY,aAAY,OAAO,EAClC,EACC1J,MAAA2J,GAAA,CACE,SAAc1H,GAAA,IAAKD,GACjBhC,MAAA4J,GAA2B,OAAO5H,EAAK,KACtC,SAAClC,OAAA,QAAK,UAAU,0BACd,gBAAC,QAAM,WAAK,KAAK,QAChB,OAAM,UAAAkC,EAAK,KAAK,GACnB,CAJe,EAAAA,EAAK,IAKtB,CACD,EACH,GACF,EACAhC,EAAA,IAACqJ,EAAA,CACC,GAAG,QACH,UAAU,aACV,MAAOnG,EACP,SAAWmE,GAAMlE,EAASkE,EAAE,OAAO,KAAK,EACxC,YAAa,EAAE,0BAA0B,EAC3C,EACF,GAEAvH,OAAC,MAAI,WAAU,0BACb,UAAAE,EAAA,IAACqJ,EAAA,CACC,MAAO,GAAGrG,CAAS,IAAIE,CAAK,GAC5B,SAAQ,GACR,UAAU,aACZ,EACAlD,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAM1F,EAAkB,EAAI,EACrC,UAAU,4BAET,WAAE,2BAA2B,EAChC,GACF,GAEJ,EAGC,CAACZ,GACC3C,OAAA,OAAI,UAAU,4BACb,UAAAE,MAACuJ,EAAM,WAAU,UAAW,WAAE,eAAe,EAAE,EAC9CzJ,OAAA,MAAI,WAAU,0BACb,UAAAE,EAAA,IAACqJ,EAAA,CACC,MAAO/I,GAAM,OAAS,GACtB,SAAQ,GACR,UAAU,aACZ,EACAR,EAAA,KAACiJ,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAMvE,EAAmB,EAAI,EACtC,UAAU,UAEV,UAACxE,MAAA6J,GAAA,CAAK,UAAU,eAAe,EAC9B,EAAE,gBAAgB,GACrB,GACF,GACF,SAID,MAAI,WAAW,eAAepH,EAAU,gBAAkB,EAAE,GAC3D,UAAAzC,MAACuJ,EAAM,WAAU,UAAW,WAAE,wBAAwB,EAAE,EACxDzJ,EAAA,KAACiJ,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAMrD,GAAsB,EAAI,EACzC,UAAU,2BAEV,UAAC1F,MAAA8J,GAAA,CAAK,UAAU,eAAe,EAC9B,EAAE,wBAAwB,GAC7B,GACF,GACF,EACChK,OAAA,MAAI,WAAU,mFACZ,WAAC2C,GACA3C,EAAA,KAACiJ,EAAA,CACC,QAAQ,cACR,KAAK,KACL,QAAS,IAAMpF,EAAoB,EAAI,EACvC,UAAU,sCAEV,UAAC3D,MAAA+J,GAAA,CAAO,UAAU,qCAAqC,EACtD,EAAE,uBAAuB,GAC5B,SAED,MAAI,WAAW,+BAA+BtH,EAAU,aAAe,EAAE,GACxE,UAAAzC,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAM,CACb1F,EAAkB,EAAK,EACvBV,EAAQ,EAAK,CACf,EACA,UAAU,yDAET,WAAE,eAAe,EACpB,EACA3C,EAAA,IAAC+I,EAAA,CACC,KAAK,KACL,QAASxB,GACT,SAAUP,GAAc,WAAaE,GAAa,UAClD,UAAU,yDAET,SAAAF,GAAc,WAAaE,GAAa,UACrC,EAAE,gBAAgB,EAClB,EAAE,aAAa,EACrB,GACF,GACF,GACF,QAGC8C,GAAY,MAAMtG,EAAkB,aAAcC,EACjD,gBAACsG,GACC,WAAAnK,OAACoK,GACC,iBAACC,GAAA,CAAkB,SAAE,gCAA8B,EAAE,QACpDC,GAAA,CACE,SAAE,oCAAkC,EACvC,GACF,SACCC,GACC,iBAACC,GAAA,CAAmB,SAAE,iBAAe,EAAE,EACvCtK,EAAA,IAACuK,GAAA,CACC,QAAS,IAAM,CACb5G,EAAoB,EAAK,EACzBE,EAAqB,EAAI,CAC3B,EACA,UAAU,yCAET,WAAE,iBAAiB,EACtB,GACF,GACF,EACF,QAGCmG,GAAY,MAAMpG,EAAmB,aAAcC,EAClD,gBAACoG,GACC,WAAAnK,OAACoK,GACC,iBAACC,GAAA,CAAkB,SAAE,gCAA8B,EAAE,EACpDrK,OAAAsK,GAAuB,WAAU,YAChC,gBAAC,KAAG,SAAE,oCAAkC,EAAE,EACzCtK,OAAA,MAAI,WAAU,YACb,UAAAE,MAACuJ,EAAM,SAAQ,iBACZ,WAAE,6BAA6B,EAClC,EACAvJ,EAAA,IAACqJ,EAAA,CACC,GAAG,iBACH,MAAOvF,EACP,SAAWuD,GAAMtD,EAAqBsD,EAAE,OAAO,KAAK,EACpD,YAAY,SACZ,UAAU,YACZ,GACF,GACF,GACF,SACCgD,GACC,WAACrK,MAAAsK,GAAA,CAAkB,QAAS,IAAMvG,EAAqB,EAAE,EACtD,WAAE,eAAe,EACpB,EACA/D,EAAA,IAACuK,GAAA,CACC,QAAS7C,GACT,SAAU5D,EAAkB,YAAY,IAAM,UAAYE,GAC1D,UAAU,yCAET,SAAa,EAAAA,GAAE,iBAAsB,uBAAN,CAA6B,CAC/D,GACF,GACF,EACF,EAGChE,MAAAgK,IAAY,KAAMzF,GAAiB,aAAcC,EAChD,SAAC1E,EAAA,KAAAmK,GAAmB,WAAU,2BAC5B,UAAAnK,OAACoK,GACC,iBAACC,GAAA,CAAkB,SAAE,0BAAwB,EAAE,QAC9CC,GAAA,CACE,SAAE,wBAAsB,EAC3B,GACF,EAECtK,OAAA,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,wBAAsB,EAAE,EACjCzJ,OAAA,MAAI,WAAU,aACb,UAAAE,EAAA,IAACqJ,EAAA,CACC,MAAO/I,GAAM,OAAS,GACtB,SAAQ,GACR,UAAU,SACZ,EACAN,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAASlB,GACT,SAAU1C,GAET,SAAmB,EAAAA,GAAE,mBAAwB,kBAAN,CAAwB,CAClE,GACF,GACF,EAECA,IACErF,EAAA,WAAI,WAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,4BAA0B,EAAE,EACtCvJ,EAAA,IAACqJ,EAAA,CACC,IAAKxC,GACL,MAAO9B,EACP,SAAWsC,GAAMrC,EAAgBqC,EAAE,OAAO,KAAK,EAC/C,YAAa,EAAE,mBAAmB,EAClC,UAAW,EACb,GACF,GAEJ,SAECgD,GACC,WAACrK,MAAAsK,GAAA,CAAkB,QAAS,IAAM,CAChC9F,EAAmB,EAAK,EAExB,WAAW,IAAM,CACfQ,EAAgB,EAAE,EAClBI,GAAoB,EAAK,GACxB,GAAG,CACJ,WAAE,iBAAe,EAAE,EACtBD,IACEnF,MAAAuK,GAAA,CAAkB,QAASzC,GACzB,WAAE,gBAAgB,EACrB,GAEJ,GACF,EACF,EAGC9H,MAAAgK,IAAY,KAAMvF,EAAoB,aAAcC,EACnD,SAAC5E,EAAA,KAAAmK,GAAmB,WAAU,2BAC5B,UAACnK,OAAAoK,GAAA,CAAkB,UAAU,wBAC3B,UAAAlK,MAACmK,GAAiB,WAAU,UACzB,WAAE,wBAAwB,EAC7B,QACCC,GAAuB,WAAU,cAC/B,WAAE,sBAAsB,EAC3B,GACF,EAECtK,OAAA,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,YACb,UAAAE,MAACuJ,EAAM,WAAU,sBAAuB,WAAE,kBAAkB,EAAE,EAC7DzJ,OAAA,MAAI,WAAU,aACb,UAAAE,EAAA,IAACqJ,EAAA,CACC,KAAK,QACL,MAAOxE,EACP,SAAWwC,GAAMvC,EAAYuC,EAAE,OAAO,KAAK,EAC3C,YAAa,EAAE,uBAAuB,EACtC,SAAUhC,GACV,UAAU,uCACZ,EACArF,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAASf,GACT,SAAU,CAACnD,GAAYQ,GACvB,UAAU,iCAET,SAAmB,EAAAA,GAAE,mBAAwB,kBAAN,CAAwB,CAClE,GACF,GACF,EAECA,IACEvF,EAAA,WAAI,WAAU,gEACb,UAAAE,MAACuJ,EAAM,WAAU,sBAAuB,WAAE,0BAA0B,EAAE,EACtEvJ,EAAA,IAACqJ,EAAA,CACC,IAAKvC,GACL,MAAO7B,GACP,SAAWoC,GAAMnC,GAAgBmC,EAAE,OAAO,KAAK,EAC/C,YAAa,EAAE,mBAAmB,EAClC,UAAW,EACX,UAAU,gCACZ,GACF,GAEJ,EAECvH,OAAAuK,GAAkB,WAAU,6BAC1B,UACChF,IAAArF,EAAA,IAACuK,GAAA,CACC,QAAStC,GACT,SAAU,CAAChD,IAAgBA,GAAa,SAAW,EACnD,UAAU,wCACX,iBAED,EAEFjF,EAAA,IAACsK,GAAA,CACC,QAAS,IAAM,CACb5F,EAAsB,EAAK,EAE3B,WAAW,IAAM,CACfI,EAAY,EAAE,EACdI,GAAgB,EAAE,EAClBI,GAAoB,EAAK,GACxB,GAAG,CACR,EACA,UAAU,cACX,cAED,GACF,GACF,EACF,EAGCtF,MAAAgK,IAAY,KAAMrF,GAAyB,aAAcC,EACxD,SAAC9E,EAAA,KAAAmK,GAAmB,WAAU,2BAC5B,UAAAnK,OAACoK,GACC,WAAClK,MAAAmK,IAAiB,SAAM,WACvBnK,MAAAoK,IAAuB,SAExB,qBACF,EAECtK,OAAA,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,uDACb,gBAAC,KAAE,UAAU,iDAAiD,SAAK,gBAClE,KAAE,UAAU,0CAA0C,SAEvD,mCACF,EACCA,OAAA,MAAI,WAAU,YACb,UAACA,OAAA,OAAI,UAAU,+BACb,gBAAC,QAAK,UAAU,wBAAwB,SAAK,UAC5CE,EAAA,YAAK,UAAU,cAAe,YAAM,MAAM,GAC7C,EACCF,OAAA,MAAI,WAAU,+BACb,gBAAC,QAAK,UAAU,wBAAwB,SAAI,eAC3C,QAAK,UAAU,cAAe,SAAS+E,EAAA,GAC1C,GACF,GACF,SAECwF,GACC,WAACrK,MAAAsK,GAAA,CAAkB,QAAS,IAAM,CAChC1F,EAA2B,EAAK,EAEhC,WAAW,IAAM,CACfI,EAAgB,EAAE,EAClBF,EAAY,EAAE,EACdI,GAAgB,EAAE,EAClBE,GAAoB,EAAK,EACzBE,GAAoB,EAAK,GACxB,GAAG,GACL,SAAE,OACLtF,EAAA,IAACuK,GAAA,CACC,QAASrC,GACT,SAAU3C,GAET,YAAkB,SAAW,OAChC,GACF,GACF,EACF,EAGCvF,MAAAgK,IAAY,KAAMvE,GAAoB,aAAcC,GACnD,SAAC5F,EAAA,KAAAmK,GAAmB,WAAU,2BAC5B,UAAAnK,OAACoK,GACC,iBAACC,GAAA,CAAkB,SAAE,6BAA2B,EAAE,QACjDC,GAAA,CACE,SAAE,2BAAyB,EAC9B,GACF,QAEC,MAAI,WAAU,iBACZ,SAACjE,GAsBErG,OAAA0K,EAAA,oBAAC1K,OAAA,OAAI,UAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,wBAAsB,EAAE,EACjCzJ,OAAA,MAAI,WAAU,aACb,UAAAE,EAAA,IAACqJ,EAAA,CACC,MAAO/I,GAAM,OAAS,GACtB,SAAQ,GACR,UAAU,SACZ,EACAN,EAAA,IAAC+I,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAASJ,GACT,SAAUpC,GAET,SAAwB,EAAAA,GAAE,mBAAwB,kBAAN,CAAwB,CACvE,GACF,GACF,EAECA,IACEzG,EAAA,WAAI,WAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,4BAA0B,EAAE,EACtCvJ,EAAA,IAACqJ,EAAA,CACC,IAAKtC,GACL,MAAOV,GACP,SAAWgB,GAAMf,GAAqBe,EAAE,OAAO,KAAK,EACpD,YAAa,EAAE,mBAAmB,EAClC,UAAW,EACb,GACF,GAEJ,EAnDEvH,EAAA,KAAA0K,WAAA,WAAC1K,OAAA,OAAI,UAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,2BAAyB,EAAE,EACrCvJ,EAAA,IAACqJ,EAAA,CACC,KAAK,WACL,MAAOxD,GACP,SAAWwB,GAAMvB,GAAmBuB,EAAE,OAAO,KAAK,EAClD,YAAa,EAAE,8BAA8B,EAC/C,GACF,EACAvH,EAAA,KAACiJ,EAAA,CACC,QAAQ,OACR,KAAK,KACL,QAAS,IAAM3C,GAAuB,EAAI,EAC1C,UAAU,qBAET,YAAE,wBAAwB,EAAE,IAAE,EAAE,8BAA8B,GACjE,GACF,CAkCA,CAEJ,SAECiE,GACC,WAACrK,MAAAsK,GAAA,CAAkB,QAAS,IAAM,CAChC5E,GAAsB,EAAK,EAC3B,WAAW,IAAM,CACfI,GAAmB,EAAE,EACrBM,GAAuB,EAAK,EAC5BE,GAAqB,EAAE,EACvBE,GAAyB,EAAK,GAC7B,GAAG,CACJ,WAAE,iBAAe,EAAE,EACtBL,GACCI,IACGvG,MAAAuK,GAAkB,SAAS3B,GACzB,SAAE,kBAAgB,CACrB,SAGD2B,GAAkB,SAAShC,GACzB,WAAE,gBAAgB,EACrB,GAEJ,GACF,EACF,EAGCvI,MAAAgK,IAAY,KAAMrE,GAAuB,aAAcC,GACtD,SAAC9F,EAAA,KAAAmK,GAAmB,WAAU,2BAC5B,UAAAnK,OAACoK,GACC,iBAACC,GAAA,CAAkB,SAAE,0BAAwB,EAAE,QAC9CC,GAAA,CACE,SAAE,2BAAyB,EAC9B,GACF,EAECtK,OAAA,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,uBAAqB,EAAE,EACjCvJ,EAAA,IAACqJ,EAAA,CACC,KAAK,WACL,MAAOtD,GACP,SAAWsB,GAAM,CACArB,GAAAqB,EAAE,OAAO,KAAK,EACzBA,EAAE,OAAO,MACXT,GAAoBwB,GAAsBf,EAAE,OAAO,KAAK,CAAC,EAEzDT,GAAoB,IAAI,CAE5B,EACA,YAAa,EAAE,0BAA0B,EAC3C,EACCD,GACE7G,EAAA,WAAI,WAAU,YACb,UAACA,OAAA,OAAI,UAAU,aACb,UAACE,MAAA,OAAI,UAAW,+CACd2G,IAAqB,OAAS,iBAC9BA,IAAqB,SAAW,aAChC,YACF,GAAI,EACH3G,EAAA,WAAI,UAAW,+CACd2G,IAAqB,UAAYA,IAAqB,SACtDA,IAAqB,SAAW,aAAe,aAC/C,UACF,GAAI,EACJ3G,MAAC,OAAI,UAAW,+CACd2G,IAAqB,SAAW,aAAe,UACjD,GAAI,GACN,QACC,IAAE,WAAW,WACZA,IAAqB,OAAS,mBAC9BA,IAAqB,SAAW,eAChC,cACF,GACG,WAAE,yBAAyBA,CAAgB,EAAE,EAChD,GACF,GAEJ,EAEC7G,OAAA,MAAI,WAAU,YACb,gBAACyJ,EAAA,CAAO,SAAE,8BAA4B,EAAE,EACxCvJ,EAAA,IAACqJ,EAAA,CACC,KAAK,WACL,MAAOpD,GACP,SAAWoB,GAAMnB,GAAmBmB,EAAE,OAAO,KAAK,EAClD,YAAa,EAAE,uCAAuC,EACxD,GACF,EAECtB,IAAeE,IAAmBF,KAAgBE,IAChDjG,EAAA,SAAE,UAAU,2BAA4B,SAAE,8BAA4B,EAAE,GAE7E,SAECqK,GACC,WAACrK,MAAAsK,GAAA,CAAkB,QAAS,IAAM,CAChC1E,GAAyB,EAAK,EAC9B,WAAW,IAAM,CACfI,GAAe,EAAE,EACjBE,GAAmB,EAAE,EACrBU,GAAoB,IAAI,GACvB,GAAG,CACJ,WAAE,iBAAe,EAAE,EACvB5G,EAAA,IAACuK,GAAA,CACC,QAAS1B,GACT,SAAU,CAAC9C,IAAe,CAACE,IAAmBF,KAAgBE,IAAmBQ,GAEhF,SAAqB,EAAAA,GAAE,iBAAsB,wBAAN,CAA8B,CACxE,GACF,GACF,EACF,GACF,CAEJ,ECrnCMgE,GAAiB,CAAC,CACtB,MAAO,OACP,KAAMC,GACN,SAAU,mBACZ,EAAG,CACD,MAAO,OACP,KAAMC,GACN,SAAU,mBACZ,EAAG,CACD,MAAO,SACP,KAAMC,GACN,SAAU,qBACZ,EAAG,CACD,MAAO,QACP,KAAMC,GACN,SAAU,oBACZ,CAAC,EACK5I,GAAgB,CAAC,CACrB,KAAM,OACN,QAAS,WACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,QACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,SACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,UACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,QACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,KACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,cACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,UACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,QACT,KAAM,MACR,EAAG,CACD,KAAM,KACN,QAAS,aACT,KAAM,MACR,EAAG,CACD,KAAM,MACN,QAAS,SACT,KAAM,MACR,CAAC,EACK6I,GAAY,CAAC,WAAY,QAAS,SAAU,UAAW,QAAS,iBAAkB,cAAe,UAAW,QAAS,OAAO,EAQ5HC,GAAc,CAAC,CACnB,YAAAC,EACA,SAAAC,EACA,SAAAC,EACA,UAAAC,EACA,OAAAC,CACF,IAAwB,CAChB,MACJ,EAAAzL,GACEC,GAAe,EACb,CAACyL,EAAUC,CAAW,EAAI1I,WAA0B,CACxD,MAAOoI,GAAa,OAAS,OAC7B,OAAQA,GAAa,QAAU,GAC/B,SAAUA,GAAa,UAAY,GACnC,KAAMA,GAAa,MAAQ,GAC3B,YAAaA,GAAa,aAAe,GACzC,QAASA,GAAa,SAAW,WACjC,MAAOA,GAAa,OAAS,GAC7B,WAAYA,GAAa,YAAc,OACvC,WAAYA,GAAa,YAAc,GACxC,EACKO,EAAgBlE,GAAuB,CAC3CA,EAAE,eAAe,EACjB4D,EAASI,CAAQ,GAEnB,OAAQvL,OAAA,QAAK,SAAUyL,EAAc,UAAU,YAC3C,UAACzL,OAAA,OAAI,UAAU,YACb,UAAAE,MAACuJ,EAAM,SAAQ,QAAS,SAAA5J,EAAE,eAAe,EAAE,SAC1C6J,GAAO,OAAO6B,EAAS,MAAO,iBAAwBC,EAAY,CACnE,GAAGD,EACH,MAAOG,CACR,GACG,UAAAxL,MAACyJ,IACC,SAACzJ,MAAA0J,GAAA,CAAY,YAAa/J,EAAE,qBAAqB,EAAG,CACtD,GACCK,MAAA2J,GAAA,CACE,SAAec,GAAA,IAAagB,GAAAzL,MAAC4J,GAA6B,OAAO6B,EAAM,MACpE,SAAC3L,OAAA,OAAI,UAAU,0BACb,UAAAE,MAACyL,EAAM,KAAN,CAAW,UAAU,SAAU,GAC/B9L,EAAE8L,EAAM,QAAQ,GACnB,CAJ0C,EAAAA,EAAM,KAKlD,CAAa,CACjB,IACF,GACF,EAEA3L,OAAC,MAAI,WAAU,YACb,UAACA,OAAAyJ,EAAA,CAAM,QAAQ,SAAU,UAAA5J,EAAE,gBAAgB,EAAE,MAAE,EAC/CK,MAACqJ,GAAM,GAAG,SAAS,MAAOgC,EAAS,OAAQ,SAAUhE,GAAKiE,EAAY,CACtE,GAAGD,EACH,OAAQhE,EAAE,OAAO,MAClB,EAAG,YAAa1H,EAAE,2BAA2B,EAAG,SAAQ,GAAC,GAC1D,EAEAG,OAAC,MAAI,WAAU,yBACb,UAACA,OAAA,OAAI,UAAU,YACb,UAAAE,MAACuJ,EAAM,SAAQ,WAAY,SAAA5J,EAAE,kBAAkB,EAAE,EACjDK,MAACqJ,GAAM,GAAG,WAAW,MAAOgC,EAAS,SAAU,SAAUhE,GAAKiE,EAAY,CAC1E,GAAGD,EACH,SAAUhE,EAAE,OAAO,KACpB,GAAG,YAAa1H,EAAE,6BAA6B,CAAG,IACnD,EACAG,OAAC,MAAI,WAAU,YACb,UAACA,OAAAyJ,EAAA,CAAM,QAAQ,OAAQ,UAAA5J,EAAE,cAAc,EAAE,MAAE,EAC3CK,MAACqJ,GAAM,GAAG,OAAO,MAAOgC,EAAS,KAAM,SAAUhE,GAAKiE,EAAY,CAClE,GAAGD,EACH,KAAMhE,EAAE,OAAO,MAChB,EAAG,YAAa1H,EAAE,yBAAyB,EAAG,SAAQ,GAAC,GACxD,GACF,EAEAG,OAAC,MAAI,WAAU,yBACb,UAACA,OAAA,OAAI,UAAU,YACb,UAACA,OAAAyJ,EAAA,CAAM,QAAQ,cAAe,UAAA5J,EAAE,oBAAoB,EAAE,MAAE,EACxDK,MAACqJ,GAAM,GAAG,cAAc,MAAOgC,EAAS,YAAa,SAAUhE,GAAKiE,EAAY,CAChF,GAAGD,EACH,YAAahE,EAAE,OAAO,MACvB,EAAG,YAAa1H,EAAE,+BAA+B,EAAG,SAAQ,GAAC,GAC9D,EACAG,OAAC,MAAI,WAAU,YACb,UAACA,OAAAyJ,EAAA,CAAM,QAAQ,UAAW,UAAA5J,EAAE,iBAAiB,EAAE,MAAE,SAChD6J,GAAO,OAAO6B,EAAS,QAAS,iBAAwBC,EAAY,CACrE,GAAGD,EACH,QAASG,CACV,GACG,UAAAxL,MAACyJ,IACC,SAACzJ,MAAA0J,GAAA,CAAY,YAAa/J,EAAE,uBAAuB,EAAG,CACxD,GACCK,EAAA,IAAA2J,GAAA,CACE,SAAUmB,GAAA,IAAe1I,GAAApC,EAAA,IAAC4J,GAAyB,OAAOxH,EACtD,SAAAA,CAAA,EADsCA,CAEzC,CAAa,EACjB,GACJ,GACA,GACF,EAEAtC,OAAC,MAAI,WAAU,YACb,UAACA,OAAAyJ,EAAA,CAAM,QAAQ,QAAS,UAAA5J,EAAE,eAAe,EAAE,MAAE,EAC7CG,OAAC,MAAI,WAAU,aACb,UAAAA,OAAC0J,IAAO,MAAO6B,EAAS,WAAY,iBAAwBC,EAAY,CACxE,GAAGD,EACH,WAAYG,CACb,GACG,UAAAxL,MAACyJ,IAAc,UAAU,YACvB,eAACC,GAAY,aAAY,OAAO,CAClC,GACC1J,MAAA2J,GAAA,CACE,SAAc1H,GAAA,IAAYD,GAAAhC,MAAC4J,GAA2B,OAAO5H,EAAK,KAC/D,SAAClC,OAAA,QAAK,UAAU,0BACd,UAACE,MAAA,QAAM,WAAK,IAAK,GACjBA,MAAC,OAAM,UAAAgC,EAAK,IAAK,IACnB,CAJwC,EAAAA,EAAK,IAK/C,CAAa,CACjB,IACF,EACAhC,MAACqJ,EAAM,IAAG,QAAQ,UAAU,SAAS,MAAOgC,EAAS,MAAO,SAAUhE,GAAKiE,EAAY,CACvF,GAAGD,EACH,MAAOhE,EAAE,OAAO,MACjB,EAAG,YAAa1H,EAAE,0BAA0B,EAAG,SAAQ,GAAC,GACzD,GACF,EAEAG,OAAC,MAAI,WAAU,8BACb,UAACE,MAAA0L,GAAA,CAAS,GAAG,aAAa,QAASL,EAAS,WAAY,mBAA4BC,EAAY,CAChG,GAAGD,EACH,WAAYM,CACb,GAAG,EACF3L,MAACuJ,GAAM,QAAQ,aAAa,UAAU,qCACnC,SAAA5J,EAAE,sBAAsB,EAC3B,GACF,EAEAG,OAAC8L,GAAa,WAAU,iBACtB,UAAC5L,MAAA+I,EAAA,CAAO,KAAK,SAAS,QAAQ,UAAU,QAASmC,EAC9C,SAAEvL,EAAA,eAAe,CACpB,SACCoJ,EAAO,MAAK,SAAS,SAAUoC,EAC7B,SAAYxL,EAAAwL,EAAE,gBAAmBC,EAAW,cAAmB,aAAlC,EAChC,GACF,CACF,GACJ,EAUMS,GAAc,CAAC,CACnB,QAAAC,EACA,OAAAC,EACA,SAAAC,EACA,aAAAC,EACA,WAAAjI,EACA,iBAAAkI,EACA,UAAAC,EAAY,EACd,IAAwB,CAChB,MACJ,EAAAxM,GACEC,GAAe,EACbwM,EAAc3B,GAAe,KAAU4B,KAAE,QAAUP,EAAQ,KAAK,GAAKrB,GAAe,CAAC,EACrF6B,EAAYF,EAAY,KAC9B,OAAQpM,MAAA,OAAI,UAAW,wEAAwE8L,EAAQ,WAAa,iCAAmC,EAAE,GACrJ,SAAAhM,EAAA,KAAC,MAAI,WAAU,yCACb,UAACA,OAAA,OAAI,UAAU,gCACb,UAAAE,EAAA,IAAC,MAAI,WAAW,oBAAoB8L,EAAQ,WAAa,gBAAkB,eAAe,GACxF,SAAC9L,MAAAsM,EAAA,CAAU,UAAU,sBAAuB,GAC9C,EACAxM,OAAC,MAAI,WAAU,iBACb,UAACA,OAAA,OAAI,UAAU,+BACb,UAAAE,MAAC,QAAK,UAAU,gCACb,SAAEL,EAAAyM,EAAY,QAAQ,EACzB,EACCN,EAAQ,YAAchM,EAAA,KAACK,GAAM,QAAQ,YAAY,UAAU,UACxD,UAACH,MAAAuM,GAAA,CAAK,UAAU,2BAA4B,GAC3C5M,EAAE,iBAAiB,GACtB,GACJ,EACAG,OAAC,IAAE,WAAU,0BACV,UAAQgM,EAAA,OAAQA,EAAQ,UAAY,KAAKA,EAAQ,QAAQ,IAC5D,QACC,IAAE,WAAU,gCACV,UAACA,EAAQ,YAAaA,EAAQ,KAAMA,EAAQ,OAAO,EAAE,OAAO,OAAO,EAAE,KAAK,IAAI,EACjF,EACCA,EAAQ,OAAUhM,OAAA,KAAE,UAAU,6DAC3B,UAACE,MAAAwM,GAAA,CAAM,UAAU,SAAU,GAC1BV,EAAQ,WAAW,IAAEA,EAAQ,OAChC,GACJ,GACF,EAEAhM,OAAC,MAAI,WAAU,0BACZ,UAAC,CAAAgM,EAAQ,YAAc9L,MAAC+I,EAAO,SAAQ,QAAQ,KAAK,OAAO,QAAS,IAAMkD,EAAaH,EAAQ,EAAE,EAAG,SAAUI,EAAkB,MAAOvM,EAAE,sBAAsB,EAC5J,SAACK,EAAA,IAAAuM,GAAA,CAAK,UAAU,UAAU,CAC5B,SACDxD,EAAO,SAAQ,QAAQ,KAAK,OAAO,QAAS,IAAMgD,EAAOD,CAAO,EAAG,MAAOnM,EAAE,aAAa,EACxF,eAAC8M,GAAK,WAAU,SAAU,GAC5B,EACCN,UAAcnC,GACX,WAAChK,MAAA0M,GAAA,CAAmB,QAAO,GACzB,SAAA1M,MAAC+I,GAAO,QAAQ,QAAQ,KAAK,OAAO,UAAU,0CAA0C,MAAOpJ,EAAE,eAAe,EAC9G,SAAAK,MAAC+J,IAAO,UAAU,UAAU,EAC9B,CACF,UACCE,GACC,WAAAnK,OAACoK,GACC,WAAClK,EAAA,IAAAmK,GAAA,CAAkB,SAAExK,EAAA,qBAAqB,CAAE,GAC3CK,EAAA,IAAAoK,GAAA,CACE,SAAEzK,EAAA,2BAA2B,CAChC,IACF,SACC0K,GACC,WAACrK,EAAA,IAAAsK,GAAA,CAAmB,SAAE3K,EAAA,eAAe,CAAE,SACtC4K,GAAkB,SAAS,IAAMyB,EAASF,EAAQ,EAAE,EAAG,UAAU,qEAAqE,SAAU9H,EAC9I,SAAarE,EAAAqE,EAAE,kBAAuB,eAAN,EACnC,GACF,GACF,GACF,GACJ,EACF,EACF,EACJ,EACM2I,GAAoB,IAAM,CACxB,MACJ,EAAAhN,GACEC,GAAe,EACb,CACJ,KAAMgN,EACN,UAAAzB,GACE0B,GAAiB,EACf,CACJ,KAAMvK,GACJwK,GAAW,EACTC,EAAgBC,KAChBC,EAAgBC,KAChBlG,EAAgBC,KAChBkG,EAAgBC,KAChBC,EAAoBC,KACpB,CAACC,EAAiBC,CAAkB,EAAI5K,WAAS,EAAK,EACtD,CAAC6K,EAAgBC,CAAiB,EAAI9K,WAA6B,IAAI,EACvE,CAAC+K,EAAoBC,CAAqB,EAAIhL,WAAiC,IAAI,EACnF,CAACiL,EAAkBC,CAAmB,EAAIlL,WAAS,EAAK,EACxDmL,EAAoB,CAACzL,GAAS,MAC9B0L,EAAgBjG,GAA0B,CAE1C,GAAAgG,GAAqBhG,EAAK,MAAO,CACnC6F,EAAsB7F,CAAI,EAC1B+F,EAAoB,EAAI,EACxB,MACF,CACAf,EAAc,OAAOhF,EAAM,CACzB,UAAW,IAAMyF,EAAmB,EAAK,EAC1C,GAEGS,EAA+B,IAAM,CACzC,GAAI,CAACN,EAAoB,OAGzB,MAAMxL,EAAY,GAAGwL,EAAmB,YAAc,MAAM,IAAIA,EAAmB,KAAK,GACxF3G,EAAc,OAAO,CACnB,MAAO7E,CAAA,CACR,EAGD4K,EAAc,OAAOY,EAAoB,CACvC,UAAW,IAAM,CACfH,EAAmB,EAAK,EACxBI,EAAsB,IAAI,EAC1BE,EAAoB,EAAK,CAC3B,EACD,GAEGI,EAA2B,IAAM,CACrCN,EAAsB,IAAI,EAC1BE,EAAoB,EAAK,GAErBK,EAAgBpG,GAA0B,CACzC0F,GACLR,EAAc,OAAO,CACnB,GAAIQ,EAAe,GACnB,QAAS1F,CAAA,EACR,CACD,UAAW,IAAM2F,EAAkB,IAAI,EACxC,GAEGU,EAAgBC,GAAe,CACnClB,EAAc,OAAOkB,CAAE,GAEnBC,EAAoBD,GAAe,CACvChB,EAAkB,OAAOgB,CAAE,GAE7B,GAAIlD,EACF,cAAQoD,EACJ,WAAAvO,MAACwO,GACC,UAAA1O,OAAC2O,GAAU,WAAU,0BACnB,UAACzO,MAAA6K,GAAA,CAAO,UAAU,SAAU,GAC3BlL,EAAE,qBAAqB,GAC1B,CACF,GACAK,MAAC0O,GACC,SAAC1O,MAAA,OAAI,UAAU,yCACZ,SAAAL,EAAE,gBAAgB,EACrB,CACF,EACF,IAEE,MAAAgP,EAAe/B,GAAaA,EAAU,OAAS,EACrD,cAAQ2B,EACJ,WAAAvO,MAACwO,GACC,UAAA1O,OAAC,MAAI,WAAU,oEACb,UAACA,OAAA,OAAI,UAAU,6BACb,UAACA,OAAA2O,GAAA,CAAU,UAAU,0BACnB,UAACzO,MAAA6K,GAAA,CAAO,UAAU,uBAAwB,GACzClL,EAAE,qBAAqB,GAC1B,QACCiP,GAAgB,WAAU,uBAAwB,SAAAjP,EAAE,2BAA2B,EAAE,GACpF,EACCgP,GAAiB7O,OAAAD,GAAA,CAAO,KAAM0N,EAAiB,aAAcC,EAC1D,UAACxN,MAAA8I,GAAA,CAAc,QAAO,GACpB,SAAAhJ,OAACiJ,GAAO,KAAK,KAAK,UAAU,iCAC1B,UAAC/I,MAAA6O,GAAA,CAAK,UAAU,cAAe,SAC9B,OAAK,WAAU,WAAY,SAAAlP,EAAE,gBAAgB,EAAE,GAClD,CACF,GACAG,OAACC,GAAc,WAAU,mBACvB,UAAAD,OAACG,GACC,WAACD,EAAA,IAAAE,GAAA,CAAa,SAAEP,EAAA,gBAAgB,CAAE,GACjCK,EAAA,IAAAiJ,GAAA,CACE,SAAEtJ,EAAA,wBAAwB,CAC7B,IACF,EACAK,MAAC+K,GAAY,UAAUiD,EAAc,SAAU,IAAMR,EAAmB,EAAK,EAAG,UAAWT,EAAc,SAAW,IACtH,GACF,GACJ,CACF,SACC2B,EACE,UAAAC,EAAgB3O,EAAA,WAAI,UAAU,YAC1B,SAAA4M,EAAU,IAAId,SAAYD,GAA6B,SAAAC,EAAkB,OAAQ4B,EAAmB,SAAUU,EAAc,aAAcE,EAAkB,WAAYnB,EAAc,UAAW,iBAAkBE,EAAkB,UAAW,UAAWT,EAAU,OAAS,CAAnO,EAAAd,EAAQ,EAA8N,CAAE,EACtR,EAAUhM,OAAA,OAAI,UAAU,mBACtB,UAACE,MAAA6K,GAAA,CAAO,UAAU,iDAAkD,SACnE,IAAE,WAAU,6BAA8B,SAAAlL,EAAE,qBAAqB,EAAE,SACnEoJ,EAAO,SAAS,IAAMyE,EAAmB,EAAI,EAC5C,UAACxN,MAAA6O,GAAA,CAAK,UAAU,cAAe,GAC9BlP,EAAE,kBAAkB,GACvB,GACF,CACJ,GAGCK,EAAA,IAAAH,GAAA,CAAO,KAAM,CAAC,CAAC4N,EAAgB,aAAc,IAAMC,EAAkB,IAAI,EACxE,SAAC5N,OAAAC,GAAA,CAAc,UAAU,mBACvB,UAAAD,OAACG,GACC,WAACD,EAAA,IAAAE,GAAA,CAAa,SAAEP,EAAA,qBAAqB,CAAE,GACtCK,EAAA,IAAAiJ,GAAA,CACE,SAAEtJ,EAAA,yBAAyB,CAC9B,IACF,EACC8N,GAAmBzN,EAAA,IAAA+K,GAAA,CAAY,YAAa0C,EAAgB,SAAUU,EAAc,SAAU,IAAMT,EAAkB,IAAI,EAAG,UAAWT,EAAc,UAAW,OAAM,GAAC,GAC3K,CACF,SAGCjD,GAAY,MAAM6D,EAAkB,aAAcC,EACjD,gBAAC7D,GACC,WAAAnK,OAACoK,GACC,WAAClK,EAAA,IAAAmK,GAAA,CAAkB,SAAExK,EAAA,2BAA2B,CAAE,GACjDK,EAAA,IAAAoK,GAAA,CACE,SAAEzK,EAAA,iCAAiC,CACtC,IACF,SACC0K,GACC,WAAArK,MAACsK,GAAkB,SAAS4D,EACzB,SAAAvO,EAAE,eAAe,EACpB,QACC4K,GAAkB,SAAS0D,EAA8B,SAAUlB,EAAc,WAAa/F,EAAc,UAC1G,SAAc+F,EAAA,WAAa/F,EAAc,UAAYrH,EAAE,eAAe,EAAIA,EAAE,gBAAgB,EAC/F,GACF,GACF,CACF,EACF,GACJ,ECvdA,IAAImP,GAAY,OAAO,eACnBC,GAAsB,OAAO,sBAC7BC,GAAe,OAAO,UAAU,eAChCC,GAAe,OAAO,UAAU,qBAChCC,GAAkB,CAACC,EAAKC,EAAK5D,IAAU4D,KAAOD,EAAML,GAAUK,EAAKC,EAAK,CAAE,WAAY,GAAM,aAAc,GAAM,SAAU,GAAM,MAAA5D,CAAO,GAAI2D,EAAIC,CAAG,EAAI5D,EACtJ6D,GAAiB,CAAC9N,EAAG+N,IAAM,CAC7B,QAASC,KAAQD,IAAMA,EAAI,IACrBN,GAAa,KAAKM,EAAGC,CAAI,GAC3BL,GAAgB3N,EAAGgO,EAAMD,EAAEC,CAAI,CAAC,EACpC,GAAIR,GACF,QAASQ,KAAQR,GAAoBO,CAAC,EAChCL,GAAa,KAAKK,EAAGC,CAAI,GAC3BL,GAAgB3N,EAAGgO,EAAMD,EAAEC,CAAI,CAAC,EAEtC,OAAOhO,CACT,EACIiO,GAAY,CAACC,EAAQC,IAAY,CACnC,IAAIC,EAAS,GACb,QAASJ,KAAQE,EACXT,GAAa,KAAKS,EAAQF,CAAI,GAAKG,EAAQ,QAAQH,CAAI,EAAI,IAC7DI,EAAOJ,CAAI,EAAIE,EAAOF,CAAI,GAC9B,GAAIE,GAAU,MAAQV,GACpB,QAASQ,KAAQR,GAAoBU,CAAM,EACrCC,EAAQ,QAAQH,CAAI,EAAI,GAAKN,GAAa,KAAKQ,EAAQF,CAAI,IAC7DI,EAAOJ,CAAI,EAAIE,EAAOF,CAAI,GAEhC,OAAOI,CACT,EAMA;AAAA;AAAA;AAAA;AAAA,GAKA,IAAIC,IACFC,GAAe,CACf,MAAMC,EAAU,MAAMA,CAAQ,CAM5B,YAAYC,EAASC,EAAsBC,EAAeC,EAAK,CAQ7D,GAPA,KAAK,QAAUH,EACf,KAAK,qBAAuBC,EAG5B,KAAK,QAAU,GAEf,KAAK,WAAa,GACdD,EAAUD,EAAQ,aAAeC,EAAUD,EAAQ,YACrD,MAAM,IAAI,WAAW,4BAA4B,EACnD,GAAII,EAAM,IAAMA,EAAM,EACpB,MAAM,IAAI,WAAW,yBAAyB,EAChD,KAAK,KAAOH,EAAU,EAAI,GAC1B,IAAII,EAAM,GACV,QAASC,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAC7BD,EAAI,KAAK,EAAK,EAChB,QAASC,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAC7B,KAAK,QAAQ,KAAKD,EAAI,MAAO,GAC7B,KAAK,WAAW,KAAKA,EAAI,MAAO,GAElC,KAAK,qBAAoB,EACzB,MAAME,EAAe,KAAK,oBAAoBJ,CAAa,EAE3D,GADA,KAAK,cAAcI,CAAY,EAC3BH,GAAO,GAAI,CACb,IAAII,EAAa,IACjB,QAASF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,KAAK,UAAUA,CAAC,EAChB,KAAK,eAAeA,CAAC,EACrB,MAAMG,EAAU,KAAK,kBACjBA,EAAUD,IACZJ,EAAME,EACNE,EAAaC,GAEf,KAAK,UAAUH,CAAC,CACjB,CACF,CACDI,EAAO,GAAKN,GAAOA,GAAO,CAAC,EAC3B,KAAK,KAAOA,EACZ,KAAK,UAAUA,CAAG,EAClB,KAAK,eAAeA,CAAG,EACvB,KAAK,WAAa,EACnB,CAOD,OAAO,WAAWO,EAAMC,EAAK,CAC3B,MAAMC,EAAOd,EAAW,UAAU,aAAaY,CAAI,EACnD,OAAOX,EAAQ,eAAea,EAAMD,CAAG,CACxC,CAKD,OAAO,aAAa3I,EAAM2I,EAAK,CAC7B,MAAME,EAAMf,EAAW,UAAU,UAAU9H,CAAI,EAC/C,OAAO+H,EAAQ,eAAe,CAACc,CAAG,EAAGF,CAAG,CACzC,CAWD,OAAO,eAAeC,EAAMD,EAAKG,EAAa,EAAGC,EAAa,GAAIC,EAAO,GAAIC,EAAW,GAAM,CAC5F,GAAI,EAAElB,EAAQ,aAAee,GAAcA,GAAcC,GAAcA,GAAchB,EAAQ,cAAgBiB,EAAO,IAAMA,EAAO,EAC/H,MAAM,IAAI,WAAW,eAAe,EACtC,IAAIhB,EACAkB,EACJ,IAAKlB,EAAUc,GAAcd,IAAW,CACtC,MAAMmB,EAAoBpB,EAAQ,oBAAoBC,EAASW,CAAG,EAAI,EAChES,EAAWC,EAAU,aAAaT,EAAMZ,CAAO,EACrD,GAAIoB,GAAYD,EAAmB,CACjCD,EAAeE,EACf,KACD,CACD,GAAIpB,GAAWe,EACb,MAAM,IAAI,WAAW,eAAe,CACvC,CACD,UAAWO,IAAU,CAACvB,EAAQ,IAAI,OAAQA,EAAQ,IAAI,SAAUA,EAAQ,IAAI,IAAI,EAC1EkB,GAAYC,GAAgBnB,EAAQ,oBAAoBC,EAASsB,CAAM,EAAI,IAC7EX,EAAMW,GAEV,IAAIC,EAAK,GACT,UAAWV,KAAOD,EAAM,CACtBY,EAAWX,EAAI,KAAK,SAAU,EAAGU,CAAE,EACnCC,EAAWX,EAAI,SAAUA,EAAI,KAAK,iBAAiBb,CAAO,EAAGuB,CAAE,EAC/D,UAAWhC,KAAKsB,EAAI,QAAS,EAC3BU,EAAG,KAAKhC,CAAC,CACZ,CACDkB,EAAOc,EAAG,QAAUL,CAAY,EAChC,MAAMO,EAAmB1B,EAAQ,oBAAoBC,EAASW,CAAG,EAAI,EACrEF,EAAOc,EAAG,QAAUE,CAAgB,EACpCD,EAAW,EAAG,KAAK,IAAI,EAAGC,EAAmBF,EAAG,MAAM,EAAGA,CAAE,EAC3DC,EAAW,GAAI,EAAID,EAAG,OAAS,GAAK,EAAGA,CAAE,EACzCd,EAAOc,EAAG,OAAS,GAAK,CAAC,EACzB,QAASG,EAAU,IAAKH,EAAG,OAASE,EAAkBC,GAAW,IAC/DF,EAAWE,EAAS,EAAGH,CAAE,EAC3B,IAAIrB,EAAgB,GACpB,KAAOA,EAAc,OAAS,EAAIqB,EAAG,QACnCrB,EAAc,KAAK,CAAC,EACtB,OAAAqB,EAAG,QAAQ,CAAChC,EAAGc,IAAMH,EAAcG,IAAM,CAAC,GAAKd,GAAK,GAAKc,EAAI,EAAE,EACxD,IAAIN,EAAQC,EAASW,EAAKT,EAAec,CAAI,CACrD,CAKD,UAAUW,EAAGC,EAAG,CACd,MAAO,IAAKD,GAAKA,EAAI,KAAK,MAAQ,GAAKC,GAAKA,EAAI,KAAK,MAAQ,KAAK,QAAQA,CAAC,EAAED,CAAC,CAC/E,CAED,YAAa,CACX,OAAO,KAAK,OACb,CAGD,sBAAuB,CACrB,QAAStB,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAC7B,KAAK,kBAAkB,EAAGA,EAAGA,EAAI,GAAK,CAAC,EACvC,KAAK,kBAAkBA,EAAG,EAAGA,EAAI,GAAK,CAAC,EAEzC,KAAK,kBAAkB,EAAG,CAAC,EAC3B,KAAK,kBAAkB,KAAK,KAAO,EAAG,CAAC,EACvC,KAAK,kBAAkB,EAAG,KAAK,KAAO,CAAC,EACvC,MAAMwB,EAAc,KAAK,+BACnBC,EAAWD,EAAY,OAC7B,QAASxB,EAAI,EAAGA,EAAIyB,EAAUzB,IAC5B,QAAS0B,EAAI,EAAGA,EAAID,EAAUC,IACtB1B,GAAK,GAAK0B,GAAK,GAAK1B,GAAK,GAAK0B,GAAKD,EAAW,GAAKzB,GAAKyB,EAAW,GAAKC,GAAK,GACjF,KAAK,qBAAqBF,EAAYxB,CAAC,EAAGwB,EAAYE,CAAC,CAAC,EAG9D,KAAK,eAAe,CAAC,EACrB,KAAK,YAAW,CACjB,CAGD,eAAef,EAAM,CACnB,MAAMhJ,EAAO,KAAK,qBAAqB,YAAc,EAAIgJ,EACzD,IAAIgB,EAAMhK,EACV,QAASqI,EAAI,EAAGA,EAAI,GAAIA,IACtB2B,EAAMA,GAAO,GAAKA,IAAQ,GAAK,KACjC,MAAMC,GAAQjK,GAAQ,GAAKgK,GAAO,MAClCvB,EAAOwB,IAAS,IAAM,CAAC,EACvB,QAAS5B,EAAI,EAAGA,GAAK,EAAGA,IACtB,KAAK,kBAAkB,EAAGA,EAAG6B,EAAOD,EAAM5B,CAAC,CAAC,EAC9C,KAAK,kBAAkB,EAAG,EAAG6B,EAAOD,EAAM,CAAC,CAAC,EAC5C,KAAK,kBAAkB,EAAG,EAAGC,EAAOD,EAAM,CAAC,CAAC,EAC5C,KAAK,kBAAkB,EAAG,EAAGC,EAAOD,EAAM,CAAC,CAAC,EAC5C,QAAS5B,EAAI,EAAGA,EAAI,GAAIA,IACtB,KAAK,kBAAkB,GAAKA,EAAG,EAAG6B,EAAOD,EAAM5B,CAAC,CAAC,EACnD,QAASA,EAAI,EAAGA,EAAI,EAAGA,IACrB,KAAK,kBAAkB,KAAK,KAAO,EAAIA,EAAG,EAAG6B,EAAOD,EAAM5B,CAAC,CAAC,EAC9D,QAASA,EAAI,EAAGA,EAAI,GAAIA,IACtB,KAAK,kBAAkB,EAAG,KAAK,KAAO,GAAKA,EAAG6B,EAAOD,EAAM5B,CAAC,CAAC,EAC/D,KAAK,kBAAkB,EAAG,KAAK,KAAO,EAAG,EAAI,CAC9C,CAGD,aAAc,CACZ,GAAI,KAAK,QAAU,EACjB,OACF,IAAI2B,EAAM,KAAK,QACf,QAAS3B,EAAI,EAAGA,EAAI,GAAIA,IACtB2B,EAAMA,GAAO,GAAKA,IAAQ,IAAM,KAClC,MAAMC,EAAO,KAAK,SAAW,GAAKD,EAClCvB,EAAOwB,IAAS,IAAM,CAAC,EACvB,QAAS5B,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAC3B,MAAM8B,EAAQD,EAAOD,EAAM5B,CAAC,EACtB7O,EAAI,KAAK,KAAO,GAAK6O,EAAI,EACzBd,EAAI,KAAK,MAAMc,EAAI,CAAC,EAC1B,KAAK,kBAAkB7O,EAAG+N,EAAG4C,CAAK,EAClC,KAAK,kBAAkB5C,EAAG/N,EAAG2Q,CAAK,CACnC,CACF,CAGD,kBAAkBR,EAAGC,EAAG,CACtB,QAASQ,EAAK,GAAIA,GAAM,EAAGA,IACzB,QAASC,EAAK,GAAIA,GAAM,EAAGA,IAAM,CAC/B,MAAMC,EAAO,KAAK,IAAI,KAAK,IAAID,CAAE,EAAG,KAAK,IAAID,CAAE,CAAC,EAC1CG,EAAKZ,EAAIU,EACTG,EAAKZ,EAAIQ,EACX,GAAKG,GAAMA,EAAK,KAAK,MAAQ,GAAKC,GAAMA,EAAK,KAAK,MACpD,KAAK,kBAAkBD,EAAIC,EAAIF,GAAQ,GAAKA,GAAQ,CAAC,CACxD,CAEJ,CAGD,qBAAqBX,EAAGC,EAAG,CACzB,QAASQ,EAAK,GAAIA,GAAM,EAAGA,IACzB,QAASC,EAAK,GAAIA,GAAM,EAAGA,IACzB,KAAK,kBAAkBV,EAAIU,EAAIT,EAAIQ,EAAI,KAAK,IAAI,KAAK,IAAIC,CAAE,EAAG,KAAK,IAAID,CAAE,CAAC,GAAK,CAAC,CAErF,CAGD,kBAAkBT,EAAGC,EAAGa,EAAQ,CAC9B,KAAK,QAAQb,CAAC,EAAED,CAAC,EAAIc,EACrB,KAAK,WAAWb,CAAC,EAAED,CAAC,EAAI,EACzB,CAID,oBAAoB3J,EAAM,CACxB,MAAM0K,EAAM,KAAK,QACX/B,EAAM,KAAK,qBACjB,GAAI3I,EAAK,QAAU+H,EAAQ,oBAAoB2C,EAAK/B,CAAG,EACrD,MAAM,IAAI,WAAW,kBAAkB,EACzC,MAAMgC,EAAY5C,EAAQ,4BAA4BY,EAAI,OAAO,EAAE+B,CAAG,EAChEE,EAAc7C,EAAQ,wBAAwBY,EAAI,OAAO,EAAE+B,CAAG,EAC9DG,EAAe,KAAK,MAAM9C,EAAQ,qBAAqB2C,CAAG,EAAI,CAAC,EAC/DI,EAAiBH,EAAYE,EAAeF,EAC5CI,EAAgB,KAAK,MAAMF,EAAeF,CAAS,EACzD,IAAIK,EAAS,GACb,MAAMC,EAAQlD,EAAQ,0BAA0B6C,CAAW,EAC3D,QAASvC,EAAI,EAAG6C,EAAI,EAAG7C,EAAIsC,EAAWtC,IAAK,CACzC,IAAI8C,EAAMnL,EAAK,MAAMkL,EAAGA,EAAIH,EAAgBH,GAAevC,EAAIyC,EAAiB,EAAI,EAAE,EACtFI,GAAKC,EAAI,OACT,MAAMC,EAAMrD,EAAQ,4BAA4BoD,EAAKF,CAAK,EACtD5C,EAAIyC,GACNK,EAAI,KAAK,CAAC,EACZH,EAAO,KAAKG,EAAI,OAAOC,CAAG,CAAC,CAC5B,CACD,IAAIC,EAAS,GACb,QAAShD,EAAI,EAAGA,EAAI2C,EAAO,CAAC,EAAE,OAAQ3C,IACpC2C,EAAO,QAAQ,CAACM,EAAOvB,IAAM,EACvB1B,GAAK0C,EAAgBH,GAAeb,GAAKe,IAC3CO,EAAO,KAAKC,EAAMjD,CAAC,CAAC,CAChC,CAAS,EAEH,OAAAI,EAAO4C,EAAO,QAAUR,CAAY,EAC7BQ,CACR,CAGD,cAAcrL,EAAM,CAClB,GAAIA,EAAK,QAAU,KAAK,MAAM+H,EAAQ,qBAAqB,KAAK,OAAO,EAAI,CAAC,EAC1E,MAAM,IAAI,WAAW,kBAAkB,EACzC,IAAIM,EAAI,EACR,QAASkD,EAAQ,KAAK,KAAO,EAAGA,GAAS,EAAGA,GAAS,EAAG,CAClDA,GAAS,IACXA,EAAQ,GACV,QAASC,EAAO,EAAGA,EAAO,KAAK,KAAMA,IACnC,QAASzB,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,MAAMJ,EAAI4B,EAAQxB,EAEZH,GADU2B,EAAQ,EAAI,IAAM,EACf,KAAK,KAAO,EAAIC,EAAOA,EACtC,CAAC,KAAK,WAAW5B,CAAC,EAAED,CAAC,GAAKtB,EAAIrI,EAAK,OAAS,IAC9C,KAAK,QAAQ4J,CAAC,EAAED,CAAC,EAAIO,EAAOlK,EAAKqI,IAAM,CAAC,EAAG,GAAKA,EAAI,EAAE,EACtDA,IAEH,CAEJ,CACDI,EAAOJ,GAAKrI,EAAK,OAAS,CAAC,CAC5B,CAMD,UAAUgJ,EAAM,CACd,GAAIA,EAAO,GAAKA,EAAO,EACrB,MAAM,IAAI,WAAW,yBAAyB,EAChD,QAASY,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAC7B,QAASD,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAAK,CAClC,IAAI8B,EACJ,OAAQzC,EAAI,CACV,IAAK,GACHyC,GAAU9B,EAAIC,GAAK,GAAK,EACxB,MACF,IAAK,GACH6B,EAAS7B,EAAI,GAAK,EAClB,MACF,IAAK,GACH6B,EAAS9B,EAAI,GAAK,EAClB,MACF,IAAK,GACH8B,GAAU9B,EAAIC,GAAK,GAAK,EACxB,MACF,IAAK,GACH6B,GAAU,KAAK,MAAM9B,EAAI,CAAC,EAAI,KAAK,MAAMC,EAAI,CAAC,GAAK,GAAK,EACxD,MACF,IAAK,GACH6B,EAAS9B,EAAIC,EAAI,EAAID,EAAIC,EAAI,GAAK,EAClC,MACF,IAAK,GACH6B,GAAU9B,EAAIC,EAAI,EAAID,EAAIC,EAAI,GAAK,GAAK,EACxC,MACF,IAAK,GACH6B,IAAW9B,EAAIC,GAAK,EAAID,EAAIC,EAAI,GAAK,GAAK,EAC1C,MACF,QACE,MAAM,IAAI,MAAM,aAAa,CAChC,CACG,CAAC,KAAK,WAAWA,CAAC,EAAED,CAAC,GAAK8B,IAC5B,KAAK,QAAQ7B,CAAC,EAAED,CAAC,EAAI,CAAC,KAAK,QAAQC,CAAC,EAAED,CAAC,EAC1C,CAEJ,CAGD,iBAAkB,CAChB,IAAI0B,EAAS,EACb,QAASzB,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAAK,CAClC,IAAI8B,EAAW,GACXC,EAAO,EACPC,EAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EACrC,QAASjC,EAAI,EAAGA,EAAI,KAAK,KAAMA,IACzB,KAAK,QAAQC,CAAC,EAAED,CAAC,GAAK+B,GACxBC,IACIA,GAAQ,EACVN,GAAUtD,EAAQ,WACX4D,EAAO,GACdN,MAEF,KAAK,wBAAwBM,EAAMC,CAAU,EACxCF,IACHL,GAAU,KAAK,2BAA2BO,CAAU,EAAI7D,EAAQ,YAClE2D,EAAW,KAAK,QAAQ9B,CAAC,EAAED,CAAC,EAC5BgC,EAAO,GAGXN,GAAU,KAAK,+BAA+BK,EAAUC,EAAMC,CAAU,EAAI7D,EAAQ,UACrF,CACD,QAAS4B,EAAI,EAAGA,EAAI,KAAK,KAAMA,IAAK,CAClC,IAAI+B,EAAW,GACXG,EAAO,EACPD,EAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,CAAC,EACrC,QAAShC,EAAI,EAAGA,EAAI,KAAK,KAAMA,IACzB,KAAK,QAAQA,CAAC,EAAED,CAAC,GAAK+B,GACxBG,IACIA,GAAQ,EACVR,GAAUtD,EAAQ,WACX8D,EAAO,GACdR,MAEF,KAAK,wBAAwBQ,EAAMD,CAAU,EACxCF,IACHL,GAAU,KAAK,2BAA2BO,CAAU,EAAI7D,EAAQ,YAClE2D,EAAW,KAAK,QAAQ9B,CAAC,EAAED,CAAC,EAC5BkC,EAAO,GAGXR,GAAU,KAAK,+BAA+BK,EAAUG,EAAMD,CAAU,EAAI7D,EAAQ,UACrF,CACD,QAAS6B,EAAI,EAAGA,EAAI,KAAK,KAAO,EAAGA,IACjC,QAASD,EAAI,EAAGA,EAAI,KAAK,KAAO,EAAGA,IAAK,CACtC,MAAMQ,EAAQ,KAAK,QAAQP,CAAC,EAAED,CAAC,EAC3BQ,GAAS,KAAK,QAAQP,CAAC,EAAED,EAAI,CAAC,GAAKQ,GAAS,KAAK,QAAQP,EAAI,CAAC,EAAED,CAAC,GAAKQ,GAAS,KAAK,QAAQP,EAAI,CAAC,EAAED,EAAI,CAAC,IAC1G0B,GAAUtD,EAAQ,WACrB,CAEH,IAAI+D,EAAO,EACX,UAAW1D,KAAO,KAAK,QACrB0D,EAAO1D,EAAI,OAAO,CAAC2D,EAAK5B,IAAU4B,GAAO5B,EAAQ,EAAI,GAAI2B,CAAI,EAC/D,MAAME,EAAQ,KAAK,KAAO,KAAK,KACzBd,EAAI,KAAK,KAAK,KAAK,IAAIY,EAAO,GAAKE,EAAQ,EAAE,EAAIA,CAAK,EAAI,EAChE,OAAAvD,EAAO,GAAKyC,GAAKA,GAAK,CAAC,EACvBG,GAAUH,EAAInD,EAAQ,WACtBU,EAAO,GAAK4C,GAAUA,GAAU,OAAO,EAChCA,CACR,CAKD,8BAA+B,CAC7B,GAAI,KAAK,SAAW,EAClB,MAAO,GACJ,CACH,MAAMvB,EAAW,KAAK,MAAM,KAAK,QAAU,CAAC,EAAI,EAC1CmC,EAAO,KAAK,SAAW,GAAK,GAAK,KAAK,MAAM,KAAK,QAAU,EAAI,IAAMnC,EAAW,EAAI,EAAE,EAAI,EAChG,IAAIuB,EAAS,CAAC,CAAC,EACf,QAASa,EAAM,KAAK,KAAO,EAAGb,EAAO,OAASvB,EAAUoC,GAAOD,EAC7DZ,EAAO,OAAO,EAAG,EAAGa,CAAG,EACzB,OAAOb,CACR,CACF,CAID,OAAO,qBAAqBX,EAAK,CAC/B,GAAIA,EAAM3C,EAAQ,aAAe2C,EAAM3C,EAAQ,YAC7C,MAAM,IAAI,WAAW,6BAA6B,EACpD,IAAIsD,GAAU,GAAKX,EAAM,KAAOA,EAAM,GACtC,GAAIA,GAAO,EAAG,CACZ,MAAMZ,EAAW,KAAK,MAAMY,EAAM,CAAC,EAAI,EACvCW,IAAW,GAAKvB,EAAW,IAAMA,EAAW,GACxCY,GAAO,IACTW,GAAU,GACb,CACD,OAAA5C,EAAO,KAAO4C,GAAUA,GAAU,KAAK,EAChCA,CACR,CAID,OAAO,oBAAoBX,EAAK/B,EAAK,CACnC,OAAO,KAAK,MAAMZ,EAAQ,qBAAqB2C,CAAG,EAAI,CAAC,EAAI3C,EAAQ,wBAAwBY,EAAI,OAAO,EAAE+B,CAAG,EAAI3C,EAAQ,4BAA4BY,EAAI,OAAO,EAAE+B,CAAG,CACpK,CAGD,OAAO,0BAA0ByB,EAAQ,CACvC,GAAIA,EAAS,GAAKA,EAAS,IACzB,MAAM,IAAI,WAAW,qBAAqB,EAC5C,IAAId,EAAS,GACb,QAAShD,EAAI,EAAGA,EAAI8D,EAAS,EAAG9D,IAC9BgD,EAAO,KAAK,CAAC,EACfA,EAAO,KAAK,CAAC,EACb,IAAIe,EAAO,EACX,QAAS/D,EAAI,EAAGA,EAAI8D,EAAQ9D,IAAK,CAC/B,QAAS0B,EAAI,EAAGA,EAAIsB,EAAO,OAAQtB,IACjCsB,EAAOtB,CAAC,EAAIhC,EAAQ,oBAAoBsD,EAAOtB,CAAC,EAAGqC,CAAI,EACnDrC,EAAI,EAAIsB,EAAO,SACjBA,EAAOtB,CAAC,GAAKsB,EAAOtB,EAAI,CAAC,GAE7BqC,EAAOrE,EAAQ,oBAAoBqE,EAAM,CAAC,CAC3C,CACD,OAAOf,CACR,CAED,OAAO,4BAA4BrL,EAAMqM,EAAS,CAChD,IAAIhB,EAASgB,EAAQ,IAAKC,GAAM,CAAC,EACjC,UAAW/E,KAAKvH,EAAM,CACpB,MAAMuM,EAAShF,EAAI8D,EAAO,MAAK,EAC/BA,EAAO,KAAK,CAAC,EACbgB,EAAQ,QAAQ,CAACG,EAAMnE,IAAMgD,EAAOhD,CAAC,GAAKN,EAAQ,oBAAoByE,EAAMD,CAAM,CAAC,CACpF,CACD,OAAOlB,CACR,CAGD,OAAO,oBAAoB1B,EAAGC,EAAG,CAC/B,GAAID,IAAM,GAAUC,IAAM,EACxB,MAAM,IAAI,WAAW,mBAAmB,EAC1C,IAAI6C,EAAI,EACR,QAASpE,EAAI,EAAGA,GAAK,EAAGA,IACtBoE,EAAIA,GAAK,GAAKA,IAAM,GAAK,IACzBA,IAAM7C,IAAMvB,EAAI,GAAKsB,EAEvB,OAAAlB,EAAOgE,IAAM,GAAK,CAAC,EACZA,CACR,CAGD,2BAA2Bb,EAAY,CACrC,MAAMc,EAAId,EAAW,CAAC,EACtBnD,EAAOiE,GAAK,KAAK,KAAO,CAAC,EACzB,MAAMC,EAAOD,EAAI,GAAKd,EAAW,CAAC,GAAKc,GAAKd,EAAW,CAAC,GAAKc,EAAI,GAAKd,EAAW,CAAC,GAAKc,GAAKd,EAAW,CAAC,GAAKc,EAC7G,OAAQC,GAAQf,EAAW,CAAC,GAAKc,EAAI,GAAKd,EAAW,CAAC,GAAKc,EAAI,EAAI,IAAMC,GAAQf,EAAW,CAAC,GAAKc,EAAI,GAAKd,EAAW,CAAC,GAAKc,EAAI,EAAI,EACrI,CAED,+BAA+BE,EAAiBC,EAAkBjB,EAAY,CAC5E,OAAIgB,IACF,KAAK,wBAAwBC,EAAkBjB,CAAU,EACzDiB,EAAmB,GAErBA,GAAoB,KAAK,KACzB,KAAK,wBAAwBA,EAAkBjB,CAAU,EAClD,KAAK,2BAA2BA,CAAU,CAClD,CAED,wBAAwBiB,EAAkBjB,EAAY,CAChDA,EAAW,CAAC,GAAK,IACnBiB,GAAoB,KAAK,MAC3BjB,EAAW,IAAG,EACdA,EAAW,QAAQiB,CAAgB,CACpC,CACL,EAGE9E,EAAQ,YAAc,EAEtBA,EAAQ,YAAc,GAEtBA,EAAQ,WAAa,EACrBA,EAAQ,WAAa,EACrBA,EAAQ,WAAa,GACrBA,EAAQ,WAAa,GACrBA,EAAQ,wBAA0B,CAGhC,CAAC,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAElK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAEnK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAEnK,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,CAEvK,EACEA,EAAQ,4BAA8B,CAGpC,CAAC,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAE5I,CAAC,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAErJ,CAAC,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,EAExJ,CAAC,GAAI,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAE,CAE7J,EAEED,EAAW,OAASC,EACpB,SAASyB,EAAWsD,EAAKC,EAAKxD,EAAI,CAChC,GAAIwD,EAAM,GAAKA,EAAM,IAAMD,IAAQC,EACjC,MAAM,IAAI,WAAW,oBAAoB,EAC3C,QAAS1E,EAAI0E,EAAM,EAAG1E,GAAK,EAAGA,IAC5BkB,EAAG,KAAKuD,IAAQzE,EAAI,CAAC,CACxB,CACD,SAAS6B,EAAOP,EAAGtB,EAAG,CACpB,OAAQsB,IAAMtB,EAAI,IAAM,CACzB,CACD,SAASI,EAAOuE,EAAM,CACpB,GAAI,CAACA,EACH,MAAM,IAAI,MAAM,iBAAiB,CACpC,CACD,MAAMC,EAAa,MAAMA,CAAW,CAKlC,YAAYC,EAAMC,EAAUC,EAAS,CAInC,GAHA,KAAK,KAAOF,EACZ,KAAK,SAAWC,EAChB,KAAK,QAAUC,EACXD,EAAW,EACb,MAAM,IAAI,WAAW,kBAAkB,EACzC,KAAK,QAAUC,EAAQ,OACxB,CAKD,OAAO,UAAUpN,EAAM,CACrB,IAAIuJ,EAAK,GACT,UAAWhC,KAAKvH,EACdwJ,EAAWjC,EAAG,EAAGgC,CAAE,EACrB,OAAO,IAAI0D,EAAWA,EAAW,KAAK,KAAMjN,EAAK,OAAQuJ,CAAE,CAC5D,CAED,OAAO,YAAY8D,EAAQ,CACzB,GAAI,CAACJ,EAAW,UAAUI,CAAM,EAC9B,MAAM,IAAI,WAAW,wCAAwC,EAC/D,IAAI9D,EAAK,GACT,QAASlB,EAAI,EAAGA,EAAIgF,EAAO,QAAU,CACnC,MAAMX,EAAI,KAAK,IAAIW,EAAO,OAAShF,EAAG,CAAC,EACvCmB,EAAW,SAAS6D,EAAO,UAAUhF,EAAGA,EAAIqE,CAAC,EAAG,EAAE,EAAGA,EAAI,EAAI,EAAGnD,CAAE,EAClElB,GAAKqE,CACN,CACD,OAAO,IAAIO,EAAWA,EAAW,KAAK,QAASI,EAAO,OAAQ9D,CAAE,CACjE,CAID,OAAO,iBAAiBb,EAAM,CAC5B,GAAI,CAACuE,EAAW,eAAevE,CAAI,EACjC,MAAM,IAAI,WAAW,6DAA6D,EACpF,IAAIa,EAAK,GACLlB,EACJ,IAAKA,EAAI,EAAGA,EAAI,GAAKK,EAAK,OAAQL,GAAK,EAAG,CACxC,IAAIiF,EAAOL,EAAW,qBAAqB,QAAQvE,EAAK,OAAOL,CAAC,CAAC,EAAI,GACrEiF,GAAQL,EAAW,qBAAqB,QAAQvE,EAAK,OAAOL,EAAI,CAAC,CAAC,EAClEmB,EAAW8D,EAAM,GAAI/D,CAAE,CACxB,CACD,OAAIlB,EAAIK,EAAK,QACXc,EAAWyD,EAAW,qBAAqB,QAAQvE,EAAK,OAAOL,CAAC,CAAC,EAAG,EAAGkB,CAAE,EACpE,IAAI0D,EAAWA,EAAW,KAAK,aAAcvE,EAAK,OAAQa,CAAE,CACpE,CAGD,OAAO,aAAab,EAAM,CACxB,OAAIA,GAAQ,GACH,GACAuE,EAAW,UAAUvE,CAAI,EACzB,CAACuE,EAAW,YAAYvE,CAAI,CAAC,EAC7BuE,EAAW,eAAevE,CAAI,EAC9B,CAACuE,EAAW,iBAAiBvE,CAAI,CAAC,EAElC,CAACuE,EAAW,UAAUA,EAAW,gBAAgBvE,CAAI,CAAC,CAAC,CACjE,CAGD,OAAO,QAAQ6E,EAAW,CACxB,IAAIhE,EAAK,GACT,GAAIgE,EAAY,EACd,MAAM,IAAI,WAAW,mCAAmC,EACrD,GAAIA,EAAY,IACnB/D,EAAW+D,EAAW,EAAGhE,CAAE,UACpBgE,EAAY,MACnB/D,EAAW,EAAG,EAAGD,CAAE,EACnBC,EAAW+D,EAAW,GAAIhE,CAAE,UACnBgE,EAAY,IACrB/D,EAAW,EAAG,EAAGD,CAAE,EACnBC,EAAW+D,EAAW,GAAIhE,CAAE,MAE5B,OAAM,IAAI,WAAW,mCAAmC,EAC1D,OAAO,IAAI0D,EAAWA,EAAW,KAAK,IAAK,EAAG1D,CAAE,CACjD,CAGD,OAAO,UAAUb,EAAM,CACrB,OAAOuE,EAAW,cAAc,KAAKvE,CAAI,CAC1C,CAID,OAAO,eAAeA,EAAM,CAC1B,OAAOuE,EAAW,mBAAmB,KAAKvE,CAAI,CAC/C,CAGD,SAAU,CACR,OAAO,KAAK,QAAQ,OACrB,CAGD,OAAO,aAAaE,EAAMZ,EAAS,CACjC,IAAIqD,EAAS,EACb,UAAWxC,KAAOD,EAAM,CACtB,MAAM4E,EAAS3E,EAAI,KAAK,iBAAiBb,CAAO,EAChD,GAAIa,EAAI,UAAY,GAAK2E,EACvB,MAAO,KACTnC,GAAU,EAAImC,EAAS3E,EAAI,QAAQ,MACpC,CACD,OAAOwC,CACR,CAED,OAAO,gBAAgBoC,EAAK,CAC1BA,EAAM,UAAUA,CAAG,EACnB,IAAIpC,EAAS,GACb,QAAShD,EAAI,EAAGA,EAAIoF,EAAI,OAAQpF,IAC1BoF,EAAI,OAAOpF,CAAC,GAAK,IACnBgD,EAAO,KAAKoC,EAAI,WAAWpF,CAAC,CAAC,GAE7BgD,EAAO,KAAK,SAASoC,EAAI,UAAUpF,EAAI,EAAGA,EAAI,CAAC,EAAG,EAAE,CAAC,EACrDA,GAAK,GAGT,OAAOgD,CACR,CACL,EAGE4B,EAAW,cAAgB,WAE3BA,EAAW,mBAAqB,wBAGhCA,EAAW,qBAAuB,gDAClC,IAAI5D,EAAY4D,EAChBnF,EAAW,UAAYmF,CACzB,GAAGpF,KAAcA,GAAY,CAAE,EAAC,GAC9BC,GAAe,EAEb4F,GAAY,CACZ,MAAMC,EAAO,KAAW,CAGtB,YAAYC,EAASC,EAAY,CAC/B,KAAK,QAAUD,EACf,KAAK,WAAaC,CACnB,CACP,EAEIF,EAAK,IAAM,IAAIA,EAAK,EAAG,CAAC,EAExBA,EAAK,OAAS,IAAIA,EAAK,EAAG,CAAC,EAE3BA,EAAK,SAAW,IAAIA,EAAK,EAAG,CAAC,EAE7BA,EAAK,KAAO,IAAIA,EAAK,EAAG,CAAC,EAEzBD,EAAQ,IAAMC,CAClB,GAAc7F,EAAW,SAAWA,EAAW,OAAS,GAAG,CAC3D,GAAGD,KAAcA,GAAY,CAAE,EAAC,GAC9BC,GAAe,EAEbgG,GAAe,CACf,MAAMC,EAAQ,KAAY,CAExB,YAAYC,EAAUC,EAAkB,CACtC,KAAK,SAAWD,EAChB,KAAK,iBAAmBC,CACzB,CAID,iBAAiBvD,EAAK,CACpB,OAAO,KAAK,iBAAiB,KAAK,OAAOA,EAAM,GAAK,EAAE,CAAC,CACxD,CACP,EAEIqD,EAAM,QAAU,IAAIA,EAAM,EAAG,CAAC,GAAI,GAAI,EAAE,CAAC,EACzCA,EAAM,aAAe,IAAIA,EAAM,EAAG,CAAC,EAAG,GAAI,EAAE,CAAC,EAC7CA,EAAM,KAAO,IAAIA,EAAM,EAAG,CAAC,EAAG,GAAI,EAAE,CAAC,EACrCA,EAAM,MAAQ,IAAIA,EAAM,EAAG,CAAC,EAAG,GAAI,EAAE,CAAC,EACtCA,EAAM,IAAM,IAAIA,EAAM,EAAG,CAAC,EAAG,EAAG,CAAC,CAAC,EAElCD,EAAW,KAAOC,CACtB,GAAiBjG,EAAW,YAAcA,EAAW,UAAY,GAAG,CACpE,GAAGD,KAAcA,GAAY,CAAE,EAAC,EAChC,IAAIqG,GAAoBrG,GAGxB;AAAA;AAAA;AAAA;AAAA,GAKA,IAAIsG,GAAkB,CACpB,EAAGD,GAAkB,OAAO,IAAI,IAChC,EAAGA,GAAkB,OAAO,IAAI,OAChC,EAAGA,GAAkB,OAAO,IAAI,SAChC,EAAGA,GAAkB,OAAO,IAAI,IAClC,EACIE,GAAe,IACfC,GAAgB,IAChBC,GAAkB,UAClBC,GAAkB,UAClBC,GAAwB,GACxBC,GAAqB,EACrBC,GAAmB,EACnBC,GAAsB,EACtBC,GAAoB,GACxB,SAASC,GAAaC,EAASC,EAAS,EAAG,CACzC,MAAMC,EAAM,GACZ,OAAAF,EAAQ,QAAQ,SAAS1G,EAAKwB,EAAG,CAC/B,IAAIqF,EAAQ,KACZ7G,EAAI,QAAQ,SAAS8G,EAAMvF,EAAG,CAC5B,GAAI,CAACuF,GAAQD,IAAU,KAAM,CAC3BD,EAAI,KACF,IAAIC,EAAQF,CAAM,IAAInF,EAAImF,CAAM,IAAIpF,EAAIsF,CAAK,MAAMA,EAAQF,CAAM,GAC3E,EACQE,EAAQ,KACR,MACD,CACD,GAAItF,IAAMvB,EAAI,OAAS,EAAG,CACxB,GAAI,CAAC8G,EACH,OAEED,IAAU,KACZD,EAAI,KAAK,IAAIrF,EAAIoF,CAAM,IAAInF,EAAImF,CAAM,SAASpF,EAAIoF,CAAM,GAAG,EAE3DC,EAAI,KACF,IAAIC,EAAQF,CAAM,IAAInF,EAAImF,CAAM,KAAKpF,EAAI,EAAIsF,CAAK,MAAMA,EAAQF,CAAM,GAClF,EAEQ,MACD,CACGG,GAAQD,IAAU,OACpBA,EAAQtF,EAEhB,CAAK,CACL,CAAG,EACMqF,EAAI,KAAK,EAAE,CACpB,CACA,SAASG,GAAgBL,EAASM,EAAY,CAC5C,OAAON,EAAQ,MAAO,EAAC,IAAI,CAAC1G,EAAKwB,IAC3BA,EAAIwF,EAAW,GAAKxF,GAAKwF,EAAW,EAAIA,EAAW,EAC9ChH,EAEFA,EAAI,IAAI,CAAC8G,EAAMvF,IAChBA,EAAIyF,EAAW,GAAKzF,GAAKyF,EAAW,EAAIA,EAAW,EAC9CF,EAEF,EACR,CACF,CACH,CACA,SAASG,GAAiBC,EAAOC,EAAMR,EAAQS,EAAe,CAC5D,GAAIA,GAAiB,KACnB,OAAO,KAET,MAAMC,EAAWH,EAAM,OAASP,EAAS,EACnCW,EAAc,KAAK,MAAMH,EAAOX,EAAiB,EACjDe,EAAQF,EAAWF,EACnBK,GAAKJ,EAAc,OAASE,GAAeC,EAC3CE,GAAKL,EAAc,QAAUE,GAAeC,EAC5ChG,EAAI6F,EAAc,GAAK,KAAOF,EAAM,OAAS,EAAIM,EAAI,EAAIJ,EAAc,EAAIG,EAC3E/F,EAAI4F,EAAc,GAAK,KAAOF,EAAM,OAAS,EAAIO,EAAI,EAAIL,EAAc,EAAIG,EAC3EG,EAAUN,EAAc,SAAW,KAAO,EAAIA,EAAc,QAClE,IAAIJ,EAAa,KACjB,GAAII,EAAc,SAAU,CAC1B,IAAIO,EAAS,KAAK,MAAMpG,CAAC,EACrBqG,EAAS,KAAK,MAAMpG,CAAC,EACrBqG,EAAQ,KAAK,KAAKL,EAAIjG,EAAIoG,CAAM,EAChCG,EAAQ,KAAK,KAAKL,EAAIjG,EAAIoG,CAAM,EACpCZ,EAAa,CAAE,EAAGW,EAAQ,EAAGC,EAAQ,EAAGC,EAAO,EAAGC,EACnD,CACD,MAAMC,EAAcX,EAAc,YAClC,MAAO,CAAE,EAAA7F,EAAG,EAAAC,EAAG,EAAAiG,EAAG,EAAAD,EAAG,WAAAR,EAAY,QAAAU,EAAS,YAAAK,EAC5C,CACA,SAASC,GAAcC,EAAeC,EAAY,CAChD,OAAIA,GAAc,KACT,KAAK,IAAI,KAAK,MAAMA,CAAU,EAAG,CAAC,EAEpCD,EAAgB3B,GAAmBC,EAC5C,CACA,SAAS4B,GAAU,CACjB,MAAA9M,EACA,MAAA+M,EACA,WAAA1H,EACA,cAAAuH,EACA,WAAAC,EACA,cAAAd,EACA,KAAAD,EACA,WAAAkB,CACF,EAAG,CACD,IAAIC,EAASC,EAAM,QAAQ,IAAM,CAE/B,MAAMC,GADS,MAAM,QAAQnN,CAAK,EAAIA,EAAQ,CAACA,CAAK,GAC5B,OAAO,CAACoN,EAAO,KACrCA,EAAM,KAAK,GAAG3C,GAAkB,UAAU,aAAa,CAAC,CAAC,EAClD2C,GACN,CAAE,GACL,OAAO3C,GAAkB,OAAO,eAC9B0C,EACAzC,GAAgBqC,CAAK,EACrB1H,EACA,OACA,OACA2H,CACN,CACG,EAAE,CAAChN,EAAO+M,EAAO1H,EAAY2H,CAAU,CAAC,EACzC,KAAM,CAAE,MAAAnB,EAAO,OAAAP,EAAQ,SAAAU,EAAU,wBAAAqB,GAA4BH,EAAM,QAAQ,IAAM,CAC/E,IAAII,EAASL,EAAO,aACpB,MAAMM,EAAUZ,GAAcC,EAAeC,CAAU,EACjDW,EAAYF,EAAO,OAASC,EAAU,EACtCE,EAA2B7B,GAC/B0B,EACAxB,EACAyB,EACAxB,CACN,EACI,MAAO,CACL,MAAOuB,EACP,OAAQC,EACR,SAAUC,EACV,wBAAyBC,CAC/B,CACA,EAAK,CAACR,EAAQnB,EAAMC,EAAea,EAAeC,CAAU,CAAC,EAC3D,MAAO,CACL,OAAAI,EACA,OAAA3B,EACA,MAAAO,EACA,SAAAG,EACA,wBAAAqB,CACJ,CACA,CACA,IAAIK,GAAkB,UAAW,CAC/B,GAAI,CACF,IAAI,OAAM,EAAG,QAAQ,IAAI,MAAQ,CAClC,MAAW,CACV,MAAO,EACR,CACD,MAAO,EACT,IACIC,GAAeT,EAAM,WACvB,SAAuBU,EAAOC,EAAc,CAC1C,MAAMC,EAAKF,EAAO,CAChB,MAAA5N,EACA,KAAA8L,EAAOnB,GACP,MAAAoC,EAAQnC,GACR,QAAAmD,EAAUlD,GACV,QAAAmD,EAAUlD,GACV,cAAA8B,EAAgB7B,GAChB,WAAA1F,EAAa2F,GACb,WAAAgC,EACA,WAAAH,EACA,cAAAd,CACD,EAAG+B,EAYEG,EAZejK,GAAU8J,EAAI,CACjC,QACA,OACA,QACA,UACA,UACA,gBACA,aACA,aACA,aACA,eACN,CAAK,EACsB,CAAE,MAAAI,GAAUD,EAAIE,EAAanK,GAAUiK,EAAI,CAAC,OAAO,CAAC,EACrEG,EAA0CrC,GAAc,IACxDsC,EAAUnB,EAAM,OAAO,IAAI,EAC3BoB,EAASpB,EAAM,OAAO,IAAI,EAC1BqB,EAAerB,EAAM,YACxBsB,GAAS,CACRH,EAAQ,QAAUG,EACd,OAAOX,GAAiB,WAC1BA,EAAaW,CAAI,EACRX,IACTA,EAAa,QAAUW,EAE1B,EACD,CAACX,CAAY,CACnB,EACU,CAACY,EAAaC,CAAgB,EAAIxB,EAAM,SAAS,EAAK,EACtD,CAAE,OAAA5B,EAAQ,MAAAO,EAAO,SAAAG,GAAU,wBAAAqB,CAAuB,EAAKP,GAAU,CACrE,MAAA9M,EACA,MAAA+M,EACA,WAAA1H,EACA,WAAA2H,EACA,cAAAJ,EACA,WAAAC,EACA,cAAAd,EACA,KAAAD,CACN,CAAK,EACDoB,EAAM,UAAU,IAAM,CACpB,GAAImB,EAAQ,SAAW,KAAM,CAC3B,MAAMM,EAASN,EAAQ,QACjBO,EAAMD,EAAO,WAAW,IAAI,EAClC,GAAI,CAACC,EACH,OAEF,IAAIC,EAAchD,EAClB,MAAMiD,GAAQR,EAAO,QACfS,EAAoB1B,GAA2B,MAAQyB,KAAU,MAAQA,GAAM,UAAYA,GAAM,gBAAkB,GAAKA,GAAM,eAAiB,EACjJC,GACE1B,EAAwB,YAAc,OACxCwB,EAAcnD,GACZG,EACAwB,EAAwB,UACtC,GAGQ,MAAM2B,EAAa,OAAO,kBAAoB,EAC9CL,EAAO,OAASA,EAAO,MAAQ7C,EAAOkD,EACtC,MAAM9C,EAAQJ,EAAOE,GAAWgD,EAChCJ,EAAI,MAAM1C,EAAOA,CAAK,EACtB0C,EAAI,UAAYb,EAChBa,EAAI,SAAS,EAAG,EAAG5C,GAAUA,EAAQ,EACrC4C,EAAI,UAAYZ,EACZN,GACFkB,EAAI,KAAK,IAAI,OAAOxD,GAAayD,EAAavD,CAAM,CAAC,CAAC,EAEtDO,EAAM,QAAQ,SAASlH,EAAKsK,EAAK,CAC/BtK,EAAI,QAAQ,SAAS8G,GAAMyD,GAAK,CAC1BzD,IACFmD,EAAI,SAASM,GAAM5D,EAAQ2D,EAAM3D,EAAQ,EAAG,CAAC,CAE7D,CAAa,CACb,CAAW,EAEC+B,IACFuB,EAAI,YAAcvB,EAAwB,SAExC0B,GACFH,EAAI,UACFE,GACAzB,EAAwB,EAAI/B,EAC5B+B,EAAwB,EAAI/B,EAC5B+B,EAAwB,EACxBA,EAAwB,CACpC,CAEO,CACP,CAAK,EACDH,EAAM,UAAU,IAAM,CACpBwB,EAAiB,EAAK,CAC5B,EAAO,CAACN,CAAM,CAAC,EACX,MAAMe,GAActL,GAAe,CAAE,OAAQiI,EAAM,MAAOA,GAAQoC,CAAK,EACvE,IAAIkB,GAAM,KACV,OAAIhB,GAAU,OACZgB,GAAsBlC,EAAM,cAC1B,MACA,CACE,IAAKkB,EACL,IAAKA,EACL,MAAO,CAAE,QAAS,MAAQ,EAC1B,OAAQ,IAAM,CACZM,EAAiB,EAAI,CACtB,EACD,IAAKJ,EACL,YAAwDjB,GAAwB,WACjF,CACT,GAE2BH,EAAM,cAAcA,EAAM,SAAU,KAAsBA,EAAM,cACrF,SACArJ,GAAe,CACb,MAAOsL,GACP,OAAQrD,EACR,MAAOA,EACP,IAAKyC,EACL,KAAM,KACP,EAAEJ,CAAU,CACd,EAAEiB,EAAG,CACP,CACH,EACAzB,GAAa,YAAc,eAC3B,IAAI0B,GAAYnC,EAAM,WACpB,SAAoBU,EAAOC,EAAc,CACvC,MAAMC,EAAKF,EAAO,CAChB,MAAA5N,EACA,KAAA8L,EAAOnB,GACP,MAAAoC,EAAQnC,GACR,QAAAmD,EAAUlD,GACV,QAAAmD,EAAUlD,GACV,cAAA8B,EAAgB7B,GAChB,WAAA1F,EAAa2F,GACb,WAAAgC,EACA,MAAAsC,EACA,WAAAzC,EACA,cAAAd,CACD,EAAG+B,EAAIK,EAAanK,GAAU8J,EAAI,CACjC,QACA,OACA,QACA,UACA,UACA,gBACA,aACA,aACA,QACA,aACA,eACN,CAAK,EACK,CAAE,OAAAxC,EAAQ,MAAAO,EAAO,SAAAG,EAAU,wBAAAqB,CAAuB,EAAKP,GAAU,CACrE,MAAA9M,EACA,MAAA+M,EACA,WAAA1H,EACA,WAAA2H,EACA,cAAAJ,EACA,WAAAC,EACA,cAAAd,EACA,KAAAD,CACN,CAAK,EACD,IAAI+C,EAAchD,EACdiD,EAAQ,KACR/C,GAAiB,MAAQsB,GAA2B,OAClDA,EAAwB,YAAc,OACxCwB,EAAcnD,GACZG,EACAwB,EAAwB,UAClC,GAEMyB,EAAwB5B,EAAM,cAC5B,QACA,CACE,KAAMnB,EAAc,IACpB,OAAQsB,EAAwB,EAChC,MAAOA,EAAwB,EAC/B,EAAGA,EAAwB,EAAI/B,EAC/B,EAAG+B,EAAwB,EAAI/B,EAC/B,oBAAqB,OACrB,QAAS+B,EAAwB,QACjC,YAAaA,EAAwB,WACtC,CACT,GAEI,MAAMkC,EAASnE,GAAayD,EAAavD,CAAM,EAC/C,OAAuB4B,EAAM,cAC3B,MACArJ,GAAe,CACb,OAAQiI,EACR,MAAOA,EACP,QAAS,OAAOE,CAAQ,IAAIA,CAAQ,GACpC,IAAK6B,EACL,KAAM,KACP,EAAEM,CAAU,EACb,CAAC,CAACmB,GAAyBpC,EAAM,cAAc,QAAS,KAAMoC,CAAK,EACnDpC,EAAM,cACpB,OACA,CACE,KAAMa,EACN,EAAG,SAAS/B,CAAQ,IAAIA,CAAQ,MAChC,eAAgB,YACjB,CACF,EACekB,EAAM,cAAc,OAAQ,CAAE,KAAMc,EAAS,EAAGuB,EAAQ,eAAgB,aAAc,EACtGT,CACN,CACG,CACH,EACAO,GAAU,YAAc,YC1lCjB,MAAMG,GAAqB,CAAC,CAAE,KAAAxb,EAAM,aAAAC,EAAc,OAAAwb,KAAsC,CACvF,MAAE,EAAAtb,GAAMC,KACR,CAAE,kBAAAsb,GAAsBC,KACxB,CAACC,EAAYC,CAAa,EAAIzY,WAAS,EAAK,EAE5C0Y,EAAWL,EAAO,cAAc,iBAChCM,EAAON,EAAO,cAAc,KAC5BO,EAAS,CAAC,CAACP,EAAO,QAExB,OACGjb,MAAAH,GAAA,CAAO,KAAAL,EAAY,aAAeA,GAAS,CAC1CC,EAAaD,CAAI,EACZA,GAAM6b,EAAc,EAAK,GAE9B,SAAAvb,OAACC,GAAc,WAAU,wBACvB,UAAAC,MAACC,GACC,UAAAH,OAACI,GAAY,WAAU,0BACrB,UAACF,MAAAyb,GAAA,CAAO,UAAU,sBAAuB,GACxC9b,EAAE,yBAAyB,GAC9B,CACF,SAEC+b,GAAW,WAAU,oBACpB,SAAC5b,EAAA,YAAI,UAAU,YAEb,UAAAA,OAAC,MACC,WAACA,OAAA,OAAI,UAAU,8CACb,UAAAE,MAAC,MAAG,UAAU,oCACX,SAAkBkb,EAAAI,EAAU,OAAO,EACtC,EACCtb,MAAAG,EAAA,CAAM,QAASqb,EAAS,YAAc,UACpC,SAAS7b,EAAA6b,EAAE,uBAA4B,2BAAN,CACpC,IACF,EAECF,GAAU,gBAAkBA,GAAU,gBAAkBA,GAAU,eACjEtb,MAAC,IAAE,WAAU,gCACV,SAAAkb,EAAkBI,EAAU,aAAa,CAC5C,GACE,MACN,QAECK,GAAU,IAGX3b,EAAA,IAAC,OACC,UAAU,wFACV,QAAS,IAAMqb,EAAc,CAACD,CAAU,EAExC,SAACpb,EAAA,WAAI,UAAU,mCACZ,WAGGF,OAAA0K,EAAA,oBAACxK,MAAA,OAAI,UAAU,0BACb,SAAAA,EAAA,IAAC6a,GAAA,CACC,MAAOU,GAAQ,GACf,KAAM,IACN,MAAM,IACN,cAAe,KAEnB,QACC,IAAE,WAAU,gCACV,SAAA5b,EAAE,6BAA6B,EAClC,GACF,EAIEG,OAAA0K,EAAA,oBAACxK,EAAA,SAAE,UAAU,8CACV,SACHub,EAAA,EACAzb,OAAC,MAAI,WAAU,gDACb,UAACE,MAAA4b,GAAA,CAAO,UAAU,SAAU,SAC3B,IAAE,WAAU,UACV,SAAAjc,EAAE,6BAA6B,EAClC,GACF,GACF,CAEJ,GACF,EAGAG,OAAC,MAAI,WAAU,uDACb,UAACE,MAAA6b,GAAA,CAAI,UAAU,sBAAuB,UACrC,MACC,WAAA7b,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,0BAA0B,EAC/B,EACCK,EAAA,SAAE,UAAU,iCACV,YAAU,gBAAkB,aACzB,GAAGsb,GAAU,cAAc,QAC3B,IAAIA,GAAU,cAAc,GAClC,GACF,GACF,EAGAxb,OAAC,MAAI,WAAU,yBACb,UAACE,MAAA8b,GAAA,CAAM,UAAU,sCAAuC,UACvD,MACC,WAAA9b,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,2BAA2B,EAChC,EACAK,MAAC,IAAE,WAAU,gCACV,SAAA+b,GAAO,IAAI,KAAKd,EAAO,UAAU,EAAG,kBAAkB,CACzD,IACF,GACF,EAGCO,GACC1b,EAAA,KAAC,MAAI,WAAU,yBACb,UAACE,MAAAgc,GAAA,CAAS,UAAU,sCAAuC,UAC1D,MACC,WAAAhc,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,wBAAwB,EAC7B,EACAK,MAAC,IAAE,WAAU,gCACV,SAAA+b,GAAO,IAAI,KAAKd,EAAO,OAAO,EAAG,kBAAkB,CACtD,IACF,GACF,EAIFnb,OAAC,MAAI,WAAU,yBACb,UAACE,MAAAgc,GAAA,CAAS,UAAU,sCAAuC,UAC1D,MACC,WAAAhc,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,0BAA0B,EAC/B,EACAK,MAAC,IAAE,WAAU,gCACV,SAAAsb,GAAU,YACP,GAAGS,GAAO,IAAI,KAAKT,EAAS,UAAU,EAAG,YAAY,CAAC,MAAMS,GAAO,IAAI,KAAKT,EAAS,WAAW,EAAG,YAAY,CAAC,GAChH3b,EAAE,0BAA0B,CAClC,IACF,GACF,EAGC2b,GAAU,kBAAoBA,EAAS,iBAAmB,GACxDxb,OAAA,OAAI,UAAU,yBACb,UAACE,MAAA6b,GAAA,CAAI,UAAU,sCAAuC,UACrD,MACC,WAAA7b,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,0BAA0B,EAC/B,EACAG,OAAC,IAAE,WAAU,gCAAgC,cACzCwb,EAAS,kBACb,GACF,GACF,EAIDA,GAAU,qBAAuBA,EAAS,oBAAsB,GAC9Dxb,OAAA,OAAI,UAAU,yBACb,UAACE,MAAA6b,GAAA,CAAI,UAAU,sCAAuC,UACrD,MACC,WAAA7b,MAAC,IAAE,WAAU,sCACV,SAAAL,EAAE,6BAA6B,EAClC,EACAG,OAAC,IAAE,WAAU,gCAAgC,cACzCwb,EAAS,qBACb,GACF,GACF,QAGDK,GAAU,IAGVV,EAAO,aAAeA,EAAO,SAAW,SACvCnb,EAAA,KAACmc,EAAA,CACC,GAAI,aAAahB,EAAO,WAAW,GACnC,UAAU,mHAEV,UAACjb,MAAA6b,GAAA,CAAI,UAAU,sBAAuB,GACtC/b,OAAC,OAAK,WAAU,sCACb,UAAAH,EAAE,wBAAwB,EAAE,KAAGA,EAAE,6BAA6B,GACjE,EACAG,OAAC,OAAK,WAAU,gCAAgC,cAC5CH,EAAE,8BAA8B,EAAE,KACtC,GACF,GAEJ,CACF,GACF,EACF,EAEJ,EChKauc,GAAoB,IAAM,CAC/B,MAAE,KAAA5b,GAASC,KAEjB,OAAOC,GAAS,CACd,SAAU,CAAC,iBAAkBF,GAAM,KAAK,EACxC,QAAS,SAAY,CACnB,GAAI,CAACA,GAAM,MAAO,MAAO,GAEnB,MAAE,KAAAyH,EAAM,MAAArH,GAAU,MAAMC,EAC3B,KAAK,iBAAiB,EACtB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQP,EACA,MAAM,eAAgB,CAAE,UAAW,GAAO,EAE7C,GAAID,EAAa,MAAAA,EACV,OAAAqH,CACT,EACA,QAAS,CAAC,CAACzH,GAAM,MAClB,CACH,EAGa6b,GAAqB,IAAM,CAChC,MAAE,KAAA7b,GAASC,KAEjB,OAAOC,GAAS,CACd,SAAU,CAAC,kBAAmBF,GAAM,KAAK,EACzC,QAAS,SAAY,CACnB,GAAI,CAACA,GAAM,MAAO,MAAO,GAEnB,MAAE,KAAAyH,EAAM,MAAArH,GAAU,MAAMC,EAC3B,KAAK,kBAAkB,EACvB,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQP,EACA,MAAM,aAAc,CAAE,UAAW,GAAO,EAE3C,GAAID,EAAa,MAAAA,EACV,OAAAqH,CACT,EACA,QAAS,CAAC,CAACzH,GAAM,MAClB,CACH,EChGa8b,GAAiB,IAAM,CAC5B,MAAE,EAAAzc,GAAMC,KACR,CAAE,KAAMyc,EAAS,UAAAlR,GAAc+Q,GAAkB,EACjD,CAAE,kBAAAhB,GAAsBC,KAExBmB,EAAkBC,GAAmB,CACzC,OAAQA,EAAQ,CACd,IAAK,YACH,aAAQpc,EAAM,WAAU,eAAgB,SAAAR,EAAE,0BAA0B,CAAE,GACxE,IAAK,UACH,aAAQQ,EAAM,SAAQ,YAAa,SAAAR,EAAE,wBAAwB,CAAE,GACjE,IAAK,YACH,aAAQQ,EAAM,SAAQ,cAAe,SAAAR,EAAE,0BAA0B,CAAE,GACrE,IAAK,YACH,aAAQQ,EAAM,WAAU,cAAe,SAAAR,EAAE,0BAA0B,CAAE,GACvE,QACE,OAAQK,MAAAG,EAAA,CAAM,QAAQ,UAAW,SAAOoc,CAAA,EAC5C,GAGF,cACGhO,EACC,WAACzO,OAAA0O,GAAA,CAAW,UAAU,OACpB,UAAC1O,OAAA2O,GAAA,CAAU,UAAU,kCACnB,UAACzO,MAAAwc,GAAA,CAAa,UAAU,SAAU,GACjC7c,EAAE,8BAA8B,GACnC,QACCiP,GAAgB,WAAU,UACxB,SAAAjP,EAAE,oCAAoC,EACzC,GACF,EACAK,MAAC0O,EAAY,WAAU,OACpB,SAAAvD,QACE,MAAI,WAAU,2BAA4B,SAAAxL,EAAE,gBAAgB,EAAE,EAC7D0c,GAAWA,EAAQ,OAAS,EAC7Brc,EAAA,WAAI,UAAU,YACZ,SAAAqc,EAAQ,IAAKI,GAAW,CACjB,MAAAC,EAAiBD,EAAO,YAC1BvB,EAAkBuB,EAAO,YAAa,MAAM,EAC5CA,EAAO,gBAGT,OAAA3c,EAAA,KAAC,OAEC,UAAU,8DAEV,UAACA,OAAA,OAAI,UAAU,8CACb,UAAAE,EAAA,IAAC,MAAI,WAAU,SACZ,SAAAyc,EAAO,cACN3c,EAAA,KAACmc,EAAA,CACC,GAAI,eAAeQ,EAAO,aAAa,GACvC,UAAU,6DAEV,UAACzc,MAAA2c,GAAA,CAAM,UAAU,qBAAsB,GACtCD,CAAA,EAGH,EAAA5c,EAAA,KAAC,OAAK,WAAU,wBACd,UAACE,MAAA2c,GAAA,CAAM,UAAU,qBAAsB,GACtCD,CAAA,EACH,CAEJ,GACCJ,EAAeG,EAAO,MAAM,GAC/B,EAEA3c,OAAC,MAAI,WAAU,qDACb,UAACA,OAAA,QAAK,UAAU,0BACd,UAACE,MAAAwc,GAAA,CAAa,UAAU,SAAU,GACjCT,GAAO,IAAI,KAAKU,EAAO,YAAY,EAAG,YAAY,GACrD,EACA3c,OAAC,OAAK,WAAU,0BACd,UAACE,MAAA8b,GAAA,CAAM,UAAU,SAAU,GAC1BW,EAAO,aAAa,MAAM,EAAG,CAAC,GACjC,EACA3c,OAAC,OAAK,WAAU,0BACd,UAACE,MAAA4c,GAAA,CAAM,UAAU,SAAU,GAC1BH,EAAO,WAAW,IAAE9c,EAAE,gBAAgB,GACzC,GACF,EAEC8c,EAAO,OACNzc,EAAA,IAAC,KAAE,UAAU,kDACV,WAAO,MACV,IAzCGyc,EAAO,GA6CjB,GACH,EAECzc,MAAA,KAAE,UAAU,iDACV,SAAAL,EAAE,kCAAkC,EACvC,CAEJ,EACF,GAEJ,EClGakd,GAAkB,IAAM,CAC7B,MAAE,EAAAld,GAAMC,KACR,CAAE,KAAMyc,EAAS,UAAAlR,GAAcgR,GAAmB,EAClD,CAAE,kBAAAjB,GAAsBC,KAExBmB,EAAkBC,GAAmB,CACzC,OAAQA,EAAQ,CACd,IAAK,YACH,aAAQpc,EAAM,WAAU,eAAgB,SAAAR,EAAE,2BAA2B,CAAE,GACzE,IAAK,UACH,aAAQQ,EAAM,SAAQ,YAAa,SAAAR,EAAE,yBAAyB,CAAE,GAClE,IAAK,YACH,aAAQQ,EAAM,SAAQ,cAAe,SAAAR,EAAE,2BAA2B,CAAE,GACtE,IAAK,aACH,aAAQQ,EAAM,WAAU,cAAe,SAAAR,EAAE,4BAA4B,CAAE,GACzE,QACE,OAAQK,MAAAG,EAAA,CAAM,QAAQ,UAAW,SAAOoc,CAAA,EAC5C,GAGF,cACGhO,EACC,WAACzO,OAAA0O,GAAA,CAAW,UAAU,OACpB,UAAC1O,OAAA2O,GAAA,CAAU,UAAU,kCACnB,UAACzO,MAAA8c,GAAA,CAAM,UAAU,SAAU,GAC1Bnd,EAAE,+BAA+B,GACpC,QACCiP,GAAgB,WAAU,UACxB,SAAAjP,EAAE,qCAAqC,EAC1C,GACF,EACAK,MAAC0O,EAAY,WAAU,OACpB,SAAAvD,QACE,MAAI,WAAU,2BAA4B,SAAAxL,EAAE,gBAAgB,EAAE,EAC7D0c,GAAWA,EAAQ,OAAS,EAC7Brc,EAAA,WAAI,UAAU,YACZ,SAAAqc,EAAQ,IAAKI,GAAW,CACjB,MAAAC,EAAiBD,EAAO,YAC1BvB,EAAkBuB,EAAO,YAAa,MAAM,EAC5CA,EAAO,gBAGT,OAAA3c,EAAA,KAAC,OAEC,UAAU,8DAEV,UAACA,OAAA,OAAI,UAAU,8CACb,UAAAE,EAAA,IAAC,MAAI,WAAU,SACZ,SAAAyc,EAAO,cACN3c,EAAA,KAACmc,EAAA,CACC,GAAI,eAAeQ,EAAO,aAAa,GACvC,UAAU,6DAEV,UAACzc,MAAA2c,GAAA,CAAM,UAAU,qBAAsB,GACtCD,CAAA,EAGH,EAAA5c,EAAA,KAAC,OAAK,WAAU,wBACd,UAACE,MAAA2c,GAAA,CAAM,UAAU,qBAAsB,GACtCD,CAAA,EACH,CAEJ,GACCJ,EAAeG,EAAO,MAAM,GAC/B,EAEA3c,OAAC,MAAI,WAAU,0DACb,UAACE,MAAA,QACE,YAAO,IAAI,KAAKyc,EAAO,UAAU,EAAG,kBAAkB,EACzD,EACCA,EAAO,cACL3c,OAAA,QAAK,UAAU,8BAA8B,cAC1C2c,EAAO,aAAa,QAAQ,CAAC,GACjC,GAEJ,EAECA,EAAO,kBACL3c,OAAA,KAAE,UAAU,uDACX,UAACE,MAAA6K,GAAA,CAAO,UAAU,8BAA+B,GAChD7K,EAAA,YAAK,UAAU,eAAgB,WAAO,iBAAiB,GAC1D,EAGDyc,EAAO,OACNzc,EAAA,IAAC,KAAE,UAAU,kDACV,WAAO,MACV,IA5CGyc,EAAO,GAgDjB,GACH,EAECzc,MAAA,KAAE,UAAU,iDACV,SAAAL,EAAE,mCAAmC,EACxC,CAEJ,EACF,GAEJ,EC9EMod,GAAcC,OAAK,CAAC,CACxB,QAAAxb,EACA,kBAAA0Z,EACA,EAAAvb,CACF,IAIM,CACE,MAAAsd,EAAWzb,EAAQ,oBAAsB,UACzC0b,EAAY1b,EAAQ,oBAAsB,UAG1C2b,EAAoB,IAAM,CAC1B,IAAC3b,EAAQ,cAAgB,CAAC,MAAM,QAAQA,EAAQ,YAAY,EAAU,YAE1E,MAAM4b,EAAiC,CACrC,KAAMzd,EAAE,kBAAmB,MAAM,EACjC,UAAWA,EAAE,uBAAwB,MAAM,EAC3C,WAAYA,EAAE,wBAAyB,MAAM,EAC7C,YAAaA,EAAE,wBAAyB,MAAM,EAC9C,SAAUA,EAAE,sBAAuB,IAAI,EACvC,WAAYA,EAAE,wBAAyB,MAAM,EAC7C,wBAAyBA,EAAE,2BAA4B,KAAK,EAC5D,YAAaA,EAAE,wBAAyB,MAAM,GAGzC,OAAA6B,EAAQ,aAAa,IAAK6b,GAAmBD,EAAOC,CAAM,GAAKA,CAAM,EAAE,KAAK,IAAI,GAIvF,OAAAvd,EAAA,KAAC,MAAI,WAAU,2EACb,UAAAA,EAAA,KAACmc,EAAA,CACC,GAAI,IAAIza,EAAQ,WAAW,IAAIA,EAAQ,SAAS,GAChD,UAAU,QAEV,UAAC1B,OAAA,OAAI,UAAU,8CACb,UAAAE,MAAC,MAAG,UAAU,8EACX,SAAkBkb,EAAA1Z,EAAS,aAAa,EAC3C,EACAxB,MAAC,QAAK,UAAU,6DACb,YAAoB,IAAI,KAAKwB,EAAQ,UAAU,EAAG,CACjD,UAAW,EACZ,GACH,GACF,EACCxB,EAAA,SAAE,UAAU,0DAA2D,WAAQ,QAAQ,EACvFwB,EAAQ,WACPxB,EAAA,IAAC,OACC,IAAKwB,EAAQ,UACb,IAAI,UACJ,UAAU,yCACV,QAAQ,OACV,GAEJ,EAGC0b,GACEld,MAAA,OAAI,UAAU,+BACb,gBAACG,EAAM,SAAQ,UAAU,UAAU,+EACjC,UAACH,MAAA8b,GAAA,CAAM,UAAU,cAAe,GAC/Bnc,EAAE,4BAA6B,KAAK,GACvC,CACF,GAGDsd,GACCnd,EAAA,KAAC,MAAI,WAAU,mBACb,UAAAA,EAAA,KAACK,EAAM,SAAQ,UAAU,UAAU,gEACjC,UAACH,MAAAsd,GAAA,CAAY,UAAU,cAAe,GACrC3d,EAAE,2BAA4B,MAAM,GACvC,EACCwd,EAAkB,GAChBrd,OAAA,KAAE,UAAU,qCACV,UAAAH,EAAE,wBAAyB,MAAM,EAAE,KAAGwd,EAAkB,GAC3D,GAEJ,CAEJ,GAEJ,CAAC,EACDJ,GAAY,YAAc,cAG1B,MAAMQ,GAAyBP,OAAK,CAAC,CACnC,WAAAvb,EACA,kBAAAyZ,EACA,EAAAvb,CACF,IAIM,CAEJ,GAAI,CAAC8B,GAAc,CAACA,EAAW,GACtB,YAGT,MAAMib,EAAiBxB,EAAkBzZ,EAAY,MAAM,GAAKA,EAAW,MAAQ,GAC7E+b,EAAiB,MAAM,QAAQ/b,EAAW,IAAI,EAChDA,EAAW,KAAK,KAAK,KAAK,EACzBA,EAAW,MAAQ,GAGtB,OAAA3B,EAAA,KAACmc,EAAA,CACC,GAAI,eAAexa,EAAW,EAAE,GAChC,MAAO,CAAE,KAAM,SAAU,EACzB,UAAU,yFAEV,UAACzB,MAAA,OAAI,UAAU,qFACb,SAAAA,EAAA,IAAC,OACC,IAAKyB,EAAW,WAAa,uEAC7B,IAAK,OAAOib,CAAc,EAC1B,UAAU,6BACV,QAAQ,OACR,QAAUrV,GAAM,CACdA,EAAE,cAAc,IAAM,sEACxB,IAEJ,EACAvH,OAAC,MAAI,WAAU,iBACb,UAACE,EAAA,UAAG,UAAU,uEACX,SACH0c,EAAA,EACC1c,EAAA,SAAE,UAAU,kDACV,SACHwd,EAAA,EACA1d,OAAC,MAAI,WAAU,0BACb,UAAAE,MAACuM,IAAK,UAAW,WAAW9K,EAAW,OAAS,0BAA4B,uBAAuB,GAAI,EACtGA,EAAW,OACTzB,MAAA,QAAK,UAAU,cAAe,SAAAyB,EAAW,OAAO,QAAQ,CAAC,CAAE,GAE3D3B,EAAA,aAAK,UAAU,8DACb,UAAAH,EAAE,0BAA0B,QAAG,KAAG,IAAGA,EAAE,0BAA0B,GACpE,GAEJ,GACF,IAGN,CAAC,EACD4d,GAAuB,YAAc,yBAGrC,MAAME,GAA2BT,OAAK,CAAC,CACrC,aAAAU,EACA,kBAAAxC,EACA,EAAAvb,EACA,SAAAge,CACF,IAKM,CACJ,KAAM,CAACC,EAAYC,CAAa,EAAIjb,WAAS,EAAK,EAElD,OAEI9C,EAAA,KAAA0K,WAAA,WAAAxK,EAAA,IAAC,OACC,QAAS,IAAM6d,EAAc,EAAI,EACjC,UAAW,gFAAgFF,EAAW,MAAQ,KAAK,GAEnH,gBAAC,MAAI,WAAW,oBAAoBA,EAAW,QAAU,OAAO,GAC7D,UAAAD,EAAa,UAAU,WACtB1d,EAAA,IAAC,OACC,IAAK0d,EAAa,SAAS,UAC3B,IAAK,OAAOxC,EAAkBwC,EAAa,SAAU,OAAO,CAAC,EAC7D,UAAW,yCAAyCC,EAAW,YAAc,WAAW,GACxF,QAAQ,OACV,EAEF7d,OAAC,MAAI,WAAU,iBACb,UAACE,EAAA,UAAG,UAAW,2CAA2C2d,EAAW,UAAY,EAAE,GAChF,SAAkBzC,EAAAwC,EAAa,SAAU,OAAO,EACnD,EACA1d,EAAA,IAAC,OACC,UAAW,uDAAuD2d,EAAW,mBAAqB,kBAAkB,GACpH,wBAAyB,CACvB,OAAQzC,EAAkBwC,EAAa,SAAU,SAAS,CAC5D,EACF,SACC,IAAE,WAAW,qCACX,UAAA/d,EAAE,kBAAkB,EAAE,IAAE,IACxBme,GAAoB,IAAI,KAAKJ,EAAa,UAAU,EAAG,CACtD,UAAW,GACZ,GACH,GACF,QACCtd,GAAM,WAAW,2CAA2Cud,EAAW,UAAY,SAAS,GAAI,GACnG,EACF,EAEA3d,EAAA,IAACT,GAAA,CACC,KAAMqe,EACN,aAAcC,EACd,SAAU,CACR,MAAO,OAAO3C,EAAkBwC,EAAa,SAAU,OAAO,CAAC,EAC/D,UAAWA,EAAa,UAAU,UAClC,QAAS,OAAOxC,EAAkBwC,EAAa,SAAU,SAAS,CAAC,CACrE,EACF,CACF,GAEJ,CAAC,EACDD,GAAyB,YAAc,2BAGvC,MAAMM,GAAuBf,OAAK,CAAC,CACjC,cAAAgB,EACA,kBAAA9C,EACA,EAAAvb,EACA,SAAAge,CACF,IAcM,CACJ,MAAMje,EAAWse,EAAc,SACzBld,EAAckd,EAAc,YAElC,cACG,MAAI,WAAW,2DAA2DL,EAAW,MAAQ,KAAK,GACjG,UAAA3d,EAAA,IAACic,EAAA,CACC,GAAI,aAAavc,EAAS,EAAE,GAC5B,UAAWie,EAAW,aAAe,aAErC,gBAAC,MAAI,WAAW,oBAAoBA,EAAW,QAAU,OAAO,GAC7D,UAAAje,EAAS,WACRM,EAAA,IAAC,OACC,IAAKN,EAAS,UACd,IAAK,OAAOwb,EAAkBxb,EAAU,OAAO,CAAC,EAChD,UAAW,yCAAyCie,EAAW,YAAc,WAAW,GACxF,QAAQ,OACV,EAEF7d,OAAC,MAAI,WAAU,iBACb,UAACE,MAAA,MAAG,UAAW,2CAA2C2d,EAAW,UAAY,EAAE,GAChF,SAAAzC,EAAkBxb,EAAU,OAAO,CACtC,GACAM,EAAA,IAAC,OACC,UAAW,4DAA4D2d,EAAW,mBAAqB,kBAAkB,GACzH,wBAAyB,CACvB,OAAQzC,EAAkBxb,EAAU,SAAS,CAC/C,EACF,EACAI,OAAC,MAAI,WAAU,2EACb,UAACA,OAAA,QAAK,UAAU,0BACd,UAACE,MAAAgc,GAAA,CAAS,UAAU,SAAU,GAC7B,IAAI,KAAKtc,EAAS,UAAU,EAAE,mBAAmB,GACpD,EACCA,EAAS,UACRI,OAAC,OAAK,gBACD,IAAI,KAAKJ,EAAS,QAAQ,EAAE,mBAAmB,GACpD,GAEJ,GACF,GACF,EACF,SAGC,MAAI,WAAW,yBAAyBie,EAAW,OAAS,MAAM,GACjE,UAAA7d,OAAC,OAAI,UAAW,2BAA2B6d,EAAW,SAAW,MAAM,GACrE,UAAA3d,MAAC2c,IAAM,UAAW,gBAAgBgB,EAAW,cAAgB,SAAS,GAAI,SACzE,OAAK,WAAW,+BAA+BA,EAAW,UAAY,SAAS,GAC7E,UAAAhe,EAAE,kCAAkC,EAAE,KAAGmB,EAAY,OAAO,KAC/D,GACF,EACAd,MAAC,MAAI,WAAW,kBAAkB2d,EAAW,UAAY,OAAO,GAC7D,SAAA7c,EAAY,IAAKW,GAChBzB,EAAA,IAACG,EAAA,CAEC,QAAQ,YACR,UAAWwd,EAAW,sBAAwB,UAE7C,SAAAzC,EAAkBzZ,EAAY,MAAM,GAJhCA,EAAW,EAMnB,GACH,GACF,CACF,GAEJ,CAAC,EACDsc,GAAqB,YAAc,uBAGnC,MAAME,GAAiBjB,OAAK,CAAC,CAC3B,OAAA/B,EACA,kBAAAC,EACA,EAAAvb,EACA,SAAAge,CACF,IAKM,CACJ,KAAM,CAACO,EAAaC,CAAc,EAAIvb,WAAS,EAAK,EAC9C0Y,EAAWL,EAAO,cAAc,iBAChCM,EAAON,EAAO,cAAc,KAC5BO,EAAS,CAAC,CAACP,EAAO,QAExB,OAEInb,EAAA,KAAA0K,WAAA,WAAA1K,EAAA,KAAC,OACC,UAAW,sDACT0b,EAAS,cAAgB,qBAC3B,IAAImC,EAAW,MAAQ,KAAK,GAC5B,QAAS,IAAMQ,EAAe,EAAI,EAElC,UAACre,OAAA,OAAI,UAAU,8CACb,UAACA,OAAA,OAAI,UAAU,SACb,UAACE,MAAA,MAAG,UAAW,2CAA2C2d,EAAW,UAAY,WAAW,GACzF,SAAAzC,EAAkBI,EAAU,OAAO,CACtC,GACAtb,MAAC,IAAE,WAAW,sCAAsC2d,EAAW,UAAY,SAAS,GACjF,SAAAzC,EAAkBI,EAAU,aAAa,CAC5C,IACF,QACCnb,EAAM,SAASqb,EAAS,YAAc,UAAW,UAAWmC,EAAW,UAAY,GACjF,SAAShe,IAAE,uBAA4B,2BAAN,EACpC,GACF,SAEC,MAAI,WAAW,gCAAgCge,EAAW,UAAY,SAAS,GAC9E,UAAC3d,EAAA,YAAK,UAAU,8CACb,SACHub,EAAA,EACCvb,EAAA,YAAK,UAAU,wBACb,YAAU,gBAAkB,aACzB,GAAGsb,GAAU,cAAc,IAC3B,IAAIA,GAAU,cAAc,GAClC,GACF,EAEAtb,EAAA,IAAC,MAAI,WAAW,yBAAyB2d,EAAW,UAAY,SAAS,GACtE,SACCnC,EAAA1b,EAAA,KAAC,OAAM,WAAAH,EAAE,wBAAwB,EAAE,KAAGoc,GAAO,IAAI,KAAKd,EAAO,OAAO,EAAG,kBAAkB,EAAE,GACzFK,GAAU,YACZxb,OAAC,OAAM,WAAAH,EAAE,4BAA4B,EAAE,KAAGoc,GAAO,IAAI,KAAKT,EAAS,WAAW,EAAG,YAAY,GAAE,EAE9Ftb,EAAA,YAAM,SAAEL,EAAA,0BAA0B,CAAE,GAEzC,GACF,EAEAK,EAAA,IAACgb,GAAA,CACC,KAAMkD,EACN,aAAcC,EACd,OAAAlD,CAAA,CACF,CACF,GAEJ,CAAC,EACDgD,GAAe,YAAc,iBAE7B,MAAMG,GAAU,IAAM,CACd,MAAE,EAAAze,GAAMC,KACR,CAAE,KAAAU,GAASC,KACXod,EAAWU,KACX,CAAE,KAAM/b,EAAS,UAAWgc,CAAA,EAAmBxR,KAC/C,CAAE,KAAMrM,EAAW,UAAW8d,CAAA,EAAqBle,KACnD,CAAE,KAAMY,EAAU,UAAWud,CAAA,EAAoBxd,KACjD,CAAE,KAAMyd,EAAe,UAAWC,CAAA,EAAyBC,KAC3D,CAAE,KAAMC,EAAoB,UAAWC,CAAA,EAA8Bnd,KACrE,CAAE,KAAMod,EAAa,UAAWC,CAAA,EAAmBC,KACnD,CAAE,KAAAC,EAAM,WAAAC,EAAY,aAAAC,GAAiBzc,GAAY,EACjD,CAAE,kBAAAwY,GAAsBC,KAExBiE,EAAyBF,GAAcC,EAGvC,CAACE,EAAWC,CAAY,EAAI1c,WAAS,SAAS,EAC9C,CAAC2c,EAAaC,CAAc,EAAI5c,EAAsB,WACtD,CAAC6c,EAAiBC,CAAkB,EAAI9c,EAAA,SAAiC,CAAE,GAC3E,CAAC+c,GAAaC,CAAc,EAAIhd,eAA0B,IAAI,CAAC,SAAS,CAAC,CAAC,EAE1Eid,GAAOT,EAAyB,CACpC,CAAE,MAAO,UAAW,MAAOzf,EAAE,iBAAiB,EAAG,KAAMmgB,EAAK,EAC5D,CAAE,MAAO,YAAa,MAAOngB,EAAE,mBAAmB,EAAG,KAAMS,EAAM,EACjE,CAAE,MAAO,WAAY,MAAOT,EAAE,kBAAkB,EAAG,KAAMogB,EAAc,EACvE,CAAE,MAAO,aAAc,MAAOpgB,EAAE,gCAAgC,EAAG,KAAMqc,EAAS,GAChF,CACF,CAAE,MAAO,UAAW,MAAOrc,EAAE,iBAAiB,EAAG,KAAMmgB,EAAK,EAC5D,CAAE,MAAO,YAAa,MAAOngB,EAAE,mBAAmB,EAAG,KAAMS,EAAM,EACjE,CAAE,MAAO,WAAY,MAAOT,EAAE,kBAAkB,EAAG,KAAMogB,EAAc,GAInEC,GAAsBC,GAAqB,CAC/CP,EAA4BQ,IAAA,CAC1B,GAAGA,EACH,CAACD,CAAQ,EAAG,OAAO,OACnB,KAIEE,EAAyBF,GAAqB,CAC9C,GAAAN,GAAY,IAAIM,CAAQ,EAAG,CAEvB,MAAAG,EAAgBX,EAAgBQ,CAAQ,GAAK,EACnD,WAAW,IAAM,OAAO,SAAS,EAAGG,CAAa,EAAG,CAAC,OAGrD,WAAW,IAAM,OAAO,SAAS,EAAG,CAAC,EAAG,CAAC,EAC1BR,EAAAM,OAAY,IAAI,CAAC,GAAGA,EAAMD,CAAQ,CAAC,CAAC,CACrD,EAIF7b,YAAU,IAAM,CACd,GAAI,CAACmb,EAAa,OAElB,MAAMc,EAAe,IAAM,CACnB,MAAAC,EAAQf,EAAY,qBACpBgB,EAASV,GAAKS,CAAK,EAAE,MAEvBC,IAAWlB,IAEbW,GAAmBX,CAAS,EAE5Bc,EAAsBI,CAAM,EAC5BjB,EAAaiB,CAAM,EACrB,EAGU,OAAAhB,EAAA,GAAG,SAAUc,CAAY,EAC9B,IAAM,CACCd,EAAA,IAAI,SAAUc,CAAY,IAEvC,CAACd,EAAaF,EAAWI,EAAiBE,EAAW,CAAC,EAEnD,MAAAa,EAAkBP,GAAqB,CAC3C,GAAIA,IAAaZ,EAAW,OAG5BW,GAAmBX,CAAS,EAE5B,MAAMiB,EAAQT,GAAK,UAAUlgB,GAAKA,EAAE,QAAUsgB,CAAQ,EAClDK,IAAU,IAAMf,GAClBA,EAAY,SAASe,CAAK,EAI5BH,EAAsBF,CAAQ,EAC9BX,EAAaW,CAAQ,GAGjBQ,EAAcC,KAEdC,GAAgBC,cAAY,SAAY,CAC5C,MAAM,QAAQ,IAAI,CAChBH,EAAY,kBAAkB,CAAE,SAAU,CAAC,SAAS,EAAG,EACvDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,WAAW,EAAG,EACzDA,EAAY,kBAAkB,CAAE,SAAU,CAAC,eAAe,EAAG,EAC7DA,EAAY,kBAAkB,CAAE,SAAU,CAAC,eAAe,EAAG,EAC7DA,EAAY,kBAAkB,CAAE,SAAU,CAAC,cAAc,EAAG,EAC7D,GACA,CAACA,CAAW,CAAC,EAEZ,IAACngB,GAAQge,EACX,aACG,MAAI,WAAU,yCACb,SAAAte,MAAC,OAAI,UAAU,8BACb,SAACA,EAAA,WAAI,UAAU,cAAe,SAAAL,EAAE,gBAAgB,CAAE,GACpD,CACF,GAIE,MAAAkhB,EAAqBlhB,EAAPsf,EAAS,gBAAgBA,CAAI,GAAQ,mBAAN,EAEnD,aACG6B,GAAc,WAAWH,GAC1B,SAAC3gB,EAAA,WAAI,UAAW,gCAAgC2d,EAAW,aAAe,2BAA2B,GACnG,gBAAC,MAAI,WAAW,+BAA+BA,EAAW,OAAS,EAAE,GAElE,WAACA,GACA3d,MAAAwK,WAAA,CACE,SAACxK,EAAA,IAAAuO,EAAA,CAAK,UAAU,eAChB,SAACvO,EAAA,IAAA0O,EAAA,CAAY,UAAU,4BACrB,SAAC5O,OAAA,OAAI,UAAU,uEACb,UAACA,OAAAoJ,GAAA,CAAO,UAAU,YAChB,UAAAlJ,EAAA,IAACmJ,GAAY,KAAK7G,GAAS,YAAc,GAAI,EAC7CtC,MAACoJ,GAAe,WAAU,WACvB,SAAA9G,GAAS,cAAc,OAAO,CAAC,EAAE,YAAY,GAAK,GACrD,IACF,EACAxC,OAAC,MAAI,WAAU,kCACb,UAAAE,EAAA,IAAC,KAAG,WAAU,0CACX,SAAAsC,GAAS,aACZ,EACCtC,EAAA,SAAE,UAAU,qCACV,WAAK,MACR,EACCsC,GAAS,OACRtC,EAAA,IAAC,KAAE,UAAU,qCACV,WAAQ,MACX,EAEDif,GAAQA,IAAS,cACf9e,EAAM,WAAU,wBACd,SACH0gB,EAAA,EAGF/gB,OAAC,MAAI,WAAU,+BACb,UAACE,MAAA+gB,GAAA,CAAM,UAAU,wBAAyB,SACzC,OAAK,WAAU,wBAAyB,SAAAze,GAAS,QAAU,EAAE,QAC7D,OAAK,WAAU,wBAAyB,SAAE3C,EAAA,iBAAkB,IAAI,EAAE,QAClEqhB,GAAoB,KACvB,GACF,EAEAlhB,OAAC,MAAI,WAAU,8CACZ,UAAWwC,GAAAtC,EAAA,IAACqC,IAAkB,QAAAC,CAAkB,GAEhD8c,GAA0B9c,GACzBtC,EAAA,IAACihB,GAAA,CACC,SAAU3e,GAAS,uBAAyB,GAC5C,SAAUA,GAAS,0BAA4B,KACjD,GAEJ,GACF,EACF,CACF,GACA,EAIDqb,EAGG7d,EAAA,KAAA0K,WAAA,WAAAxK,EAAA,IAACkhB,GAAA,CACC,OAAQ1B,EACR,KAAM,CACJ,MAAO,QACP,KAAM,EACR,EACA,UAAU,SAEV,SAAA1f,EAAA,KAACqhB,GAAgB,WAAU,QAEzB,UAAAnhB,MAACohB,IAAa,UAAU,OACtB,SAACthB,EAAA,YAAI,UAAU,iBACb,UAACE,EAAA,IAAAuO,EAAA,CACC,eAACG,EAAY,WAAU,YACrB,SAAC5O,EAAA,YAAI,UAAU,mCACb,UAACA,OAAAoJ,GAAA,CAAO,UAAU,YAChB,UAAAlJ,EAAA,IAACmJ,GAAY,KAAK7G,GAAS,YAAc,GAAI,EAC7CtC,MAACoJ,GAAe,WAAU,WACvB,SAAA9G,GAAS,cAAc,OAAO,CAAC,EAAE,YAAY,GAAK,GACrD,IACF,EACAxC,OAAC,MAAI,WAAU,4BACb,UAAAE,EAAA,IAAC,KAAG,WAAU,0CACX,SAAAsC,GAAS,aACZ,EACCtC,EAAA,SAAE,UAAU,qCACV,WAAK,MACR,EAEAF,OAAC,MAAI,WAAU,8CACb,UAACE,MAAA+gB,GAAA,CAAM,UAAU,wBAAyB,SACzC,OAAK,WAAU,gBAAiB,SAAAze,GAAS,QAAU,EAAE,QACrD,OAAK,WAAU,gCAAiC,SAAE3C,EAAA,iBAAkB,IAAI,EAAE,QAC1EqhB,GAAoB,KACvB,EACC1e,GAAS,OACRtC,EAAA,IAAC,KAAE,UAAU,qCACV,WAAQ,MACX,EAEDif,GAAQA,IAAS,cACf9e,EAAM,WAAU,qCACd,SACH0gB,EAAA,EAEDve,GACCxC,EAAA,KAAC,MAAI,WAAU,8CACb,UAAAE,MAACqC,IAAkB,QAAAC,EAAkB,EAEpC8c,GACCpf,EAAA,IAACihB,GAAA,CACC,SAAU3e,GAAS,uBAAyB,GAC5C,SAAUA,GAAS,0BAA4B,KACjD,GAEJ,GAEJ,EACF,EACF,GACF,SAGCiM,EACC,WAACzO,OAAA0O,GAAA,CAAW,UAAU,OACpB,UAAC1O,OAAA2O,GAAA,CAAU,UAAU,kCACnB,UAACzO,MAAAyb,GAAA,CAAO,UAAU,SAAU,GAC3B9b,EAAE,uBAAuB,GAC5B,QACCiP,GAAgB,WAAU,UAAW,SAAAjP,EAAE,6BAA6B,EAAE,GACzE,EACAK,MAAC0O,EAAY,WAAU,OACpB,SAAAqQ,QACE,MAAI,WAAU,2BAA4B,SAAApf,EAAE,gBAAgB,EAAE,EAC7Dmf,GAAeA,EAAY,OAAS,EACrC9e,EAAA,WAAI,UAAU,YACZ,SAAA8e,EAAY,IAAK7D,GAChBjb,EAAA,IAACie,GAAA,CAEC,OAAAhD,EACA,kBAAAC,EACA,EAAAvb,EACA,SAAU,IAJLsb,EAAO,GAMf,CACH,GAECnb,OAAA,KAAE,UAAU,iDACV,UAAAH,EAAE,2BAA2B,EAAG,IACjCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,kCAAkC,EACvC,GACF,CAEJ,IACF,QAGCgN,GAAkB,UAGlByP,GAAe,UAGfS,GAAgB,KACnB,CACF,SAGCuE,GAAa,WAAU,OACtB,SAACphB,MAAA,OAAI,UAAU,OACb,SAAAA,MAACuO,GACC,SAACvO,MAAA0O,EAAA,CAAY,UAAU,OACrB,SAAA5O,OAACuhB,IAAK,aAAa,cAAc,UAAU,SACzC,UAACvhB,OAAAwhB,GAAA,CAAS,UAAU,+BAClB,UAAAxhB,EAAA,KAACyhB,EAAY,OAAM,cAAc,UAAU,kCACzC,UAACvhB,MAAA2c,GAAA,CAAM,UAAU,SAAU,GAC1Bhd,EAAE,6BAA6B,EAC/Bc,GAAaA,EAAU,OAAS,GAC/BT,MAACG,EAAM,SAAQ,YAAY,UAAU,4CAClC,SAAAM,EAAU,MACb,IAEJ,EACCX,EAAA,KAAAyhB,EAAA,CAAY,MAAM,aAAa,UAAU,kCACxC,UAACvhB,MAAAgc,GAAA,CAAS,UAAU,SAAU,GAC7Brc,EAAE,2BAA2B,EAC7B8e,GAAiBA,EAAc,OAAS,GACvCze,MAACG,EAAM,SAAQ,YAAY,UAAU,4CAClC,SAAAse,EAAc,MACjB,IAEJ,GACF,EAEAze,MAACwhB,EAAY,OAAM,cAChB,SAAAjD,QACE,MAAI,WAAU,2BAA4B,SAAA5e,EAAE,gBAAgB,EAAE,EAC7Dc,GAAaA,EAAU,OAAS,EACjCT,EAAA,WAAI,UAAU,yBACZ,SAAAS,EAAU,IAAKgB,GACdzB,EAAA,IAACud,GAAA,CAEC,WAAA9b,EACA,kBAAAyZ,EACA,EAAAvb,CAAA,EAHK8B,EAAW,EAKnB,GACH,EAECzB,MAAA,KAAE,UAAU,iDAAkD,SAAAL,EAAE,qBAAqB,EAAE,CAE5F,GAEAK,MAACwhB,EAAY,OAAM,aAChB,SAAA9C,QACE,MAAI,WAAU,2BAA4B,SAAA/e,EAAE,gBAAgB,EAAE,EAC7D8e,GAAiBA,EAAc,OAAS,EACzCze,EAAA,WAAI,UAAU,YACZ,SAAAye,EAAc,IAAKf,GAClB1d,EAAA,IAACyd,GAAA,CAEC,aAAAC,EACA,kBAAAxC,EACA,EAAAvb,EACA,SAAU,IAJL+d,EAAa,GAMrB,CACH,GAEC5d,OAAA,KAAE,UAAU,iDACV,UAAAH,EAAE,6BAA6B,EAAG,IACnCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,0BAA0B,EAC/B,GACF,CAEJ,EACF,GACF,GACF,EACF,CACF,GAGAK,EAAA,IAACohB,IAAa,UAAU,OACtB,eAAC,MAAI,WAAU,OACb,SAAAthB,EAAA,KAACyO,EACC,WAACzO,OAAA0O,GAAA,CAAW,UAAU,OACpB,UAAC1O,OAAA2O,GAAA,CAAU,UAAU,kCACnB,UAACzO,MAAA+f,GAAA,CAAc,UAAU,SAAU,GAClCpgB,EAAE,oBAAoB,GACzB,QACCiP,GAAgB,WAAU,UAAW,SAAAjP,EAAE,sBAAsB,EAAE,GAClE,EACAK,MAAC0O,GAAY,UAAU,iBACpB,WACE1O,MAAA,OAAI,UAAU,2BAA4B,SAAAL,EAAE,gBAAgB,CAAE,GAC7DsB,GAAYA,EAAS,OAAS,EAChCA,EAAS,IAAKO,GACZxB,EAAA,IAAC+c,GAAA,CAEC,QAAAvb,EACA,kBAAA0Z,EACA,EAAAvb,CAAA,EAHK6B,EAAQ,EAKhB,GAEAxB,EAAA,SAAE,UAAU,iDAAkD,SAAAL,EAAE,oBAAoB,CAAE,GAE3F,EACF,EACF,GACF,EAGCyf,GACEpf,EAAA,IAAAohB,GAAA,CAAa,UAAU,OACtB,eAAC,MAAI,WAAU,OACb,SAAAthB,OAACyO,EACC,WAACzO,OAAA0O,GAAA,CAAW,UAAU,OACpB,UAAC1O,OAAA2O,GAAA,CAAU,UAAU,kCACnB,UAACzO,MAAAgc,GAAA,CAAS,UAAU,SAAU,GAC7Brc,EAAE,gCAAgC,GACrC,QACCiP,GAAgB,WAAU,UACxB,SAAAjP,EAAE,oCAAoC,EACzC,GACF,EACAK,MAAC0O,GAAY,UAAU,OACrB,eAAC,MAAI,WAAU,YACZ,SAAAmQ,EACE7e,EAAA,WAAI,UAAU,2BAA4B,SAAAL,EAAE,gBAAgB,CAAE,GAC7Dif,GAAsBA,EAAmB,OAAS,EACpD9e,EAAA,KAAC,MACC,WAACA,OAAA,MAAG,UAAU,uDACZ,UAACE,MAAA2c,GAAA,CAAM,UAAU,SAAU,GAC1Bhd,EAAE,8BAA8B,GACnC,EACCK,EAAA,WAAI,UAAU,YACX,UAAM,KACN,MAAMyhB,EAAiB7C,EAAmB,OAAO,CAAC8C,EAAKC,IAAkB,CACvE,MAAMC,EAAaD,EAAc,YAC7B,OAACD,EAAIE,CAAU,IACjBF,EAAIE,CAAU,EAAI,CAChB,SAAUD,EAAc,SACxB,YAAa,CAAC,EACd,kBAAmBA,EAAc,aAGjCD,EAAAE,CAAU,EAAE,YAAY,KAAK,CAC/B,GAAID,EAAc,cAClB,KAAMA,EAAc,gBACpB,QAASA,EAAc,mBACvB,QAASA,EAAc,mBACxB,EACMD,CACT,EAAG,CAAyB,GAE5B,OAAO,OAAO,OAAOD,CAAc,EAAE,IAAKI,GACxC7hB,EAAA,IAAC+d,GAAA,CAEC,cAAe8D,EACf,kBAAA3G,EACA,EAAAvb,EACA,SAAU,IAJLkiB,EAAM,SAAS,GAMvB,MAEL,EACF,GAEA/hB,OAAC,IAAE,WAAU,iDACV,UAAAH,EAAE,kCAAkC,EAAG,IACxCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,0BAA0B,EAC/B,EACF,EAEJ,GACF,EACF,EACF,GACF,GAEJ,EACF,EAGAK,EAAA,IAAC,MAAI,WAAU,4DACb,SAAAA,MAAC,MAAI,WAAU,6CACZ,SAAA6f,GAAK,IAAKiC,GAAQ,CACjB,MAAMC,EAAOD,EAAI,KAEf,OAAAhiB,EAAA,KAAC,UAEC,QAAS,IAAM0gB,EAAesB,EAAI,KAAK,EACvC,UAAW,wEACTzC,IAAcyC,EAAI,MACd,eACA,uBACN,GAEA,UAAC9hB,MAAA+hB,EAAA,CAAK,UAAW,GAAG1C,IAAcyC,EAAI,MAAQ,UAAY,SAAS,EAAI,GACtE9hB,EAAA,YAAK,UAAU,sBAAuB,WAAI,MAAM,IAT5C8hB,EAAI,MAUX,CAEH,EACH,CACF,IACF,EAEChiB,EAAA,KAAAuhB,GAAA,CAAK,aAAa,YAAY,UAAU,yBACvC,UAAAvhB,OAACwhB,IAAS,UAAW,eAAelC,EAAyB,cAAgB,aAAa,GACxF,UAACtf,OAAAyhB,EAAA,CAAY,MAAM,YACjB,UAACvhB,MAAAI,GAAA,CAAM,UAAU,cAAe,GAC/BT,EAAE,mBAAmB,GACxB,EACAG,OAACyhB,EAAY,OAAM,UACjB,UAACvhB,MAAAyb,GAAA,CAAO,UAAU,cAAe,GAChC9b,EAAE,uBAAuB,GAC5B,EACAG,OAACyhB,EAAY,OAAM,WACjB,UAACvhB,MAAA+f,GAAA,CAAc,UAAU,cAAe,GACvCpgB,EAAE,kBAAkB,GACvB,EACCyf,GACCtf,EAAA,KAACyhB,EAAY,OAAM,aACjB,UAACvhB,MAAAgc,GAAA,CAAS,UAAU,cAAe,GAClCrc,EAAE,gCAAgC,GACrC,EAEFG,OAACyhB,EAAY,OAAM,YACjB,UAACvhB,MAAA6K,GAAA,CAAO,UAAU,cAAe,GAChClL,EAAE,qBAAqB,GAC1B,EACAG,OAACyhB,EAAY,OAAM,SACjB,UAACvhB,MAAA4c,GAAA,CAAM,UAAU,cAAe,GAC/Bjd,EAAE,sBAAsB,GAC3B,GACF,EAEDK,MAAAwhB,EAAA,CAAY,MAAM,YACjB,eAACjT,EACC,UAAAvO,MAAC0O,EAAY,WAAU,OACrB,SAAC5O,OAAAuhB,GAAA,CAAK,aAAa,cAAc,UAAU,SACzC,UAACvhB,OAAAwhB,GAAA,CAAS,UAAU,+BAClB,UAAAxhB,EAAA,KAACyhB,EAAY,OAAM,cAAc,UAAU,0BACzC,UAACvhB,MAAA2c,GAAA,CAAM,UAAU,SAAU,GAC1Bhd,EAAE,6BAA6B,EAC/Bc,GAAaA,EAAU,OAAS,GAC/BT,MAACG,EAAM,SAAQ,YAAY,UAAU,4CAClC,SAAAM,EAAU,MACb,IAEJ,EACCX,EAAA,KAAAyhB,EAAA,CAAY,MAAM,aAAa,UAAU,0BACxC,UAACvhB,MAAAgc,GAAA,CAAS,UAAU,SAAU,GAC7Brc,EAAE,2BAA2B,EAC7B8e,GAAiBA,EAAc,OAAS,GACvCze,MAACG,EAAM,SAAQ,YAAY,UAAU,4CAClC,SAAAse,EAAc,MACjB,IAEJ,GACF,EAEAze,MAACwhB,EAAY,OAAM,cAChB,SAAAjD,QACE,MAAI,WAAU,mBAAoB,SAAA5e,EAAE,gBAAgB,EAAE,EACrDc,GAAaA,EAAU,OAAS,EACjCT,EAAA,WAAI,UAAU,4BACZ,SAAAS,EAAU,IAAKgB,GACdzB,EAAA,IAACud,GAAA,CAEC,WAAA9b,EACA,kBAAAyZ,EACA,EAAAvb,CAAA,EAHK8B,EAAW,EAKnB,GACH,EAECzB,MAAA,KAAE,UAAU,yCAA0C,SAAAL,EAAE,qBAAqB,EAAE,CAEpF,GAEAK,MAACwhB,EAAY,OAAM,aAChB,SAAA9C,QACE,MAAI,WAAU,mBAAoB,SAAA/e,EAAE,gBAAgB,EAAE,EACrD8e,GAAiBA,EAAc,OAAS,EACzCze,EAAA,WAAI,UAAU,YACZ,SAAAye,EAAc,IAAKf,GAClB1d,EAAA,IAACyd,GAAA,CAEC,aAAAC,EACA,kBAAAxC,EACA,EAAAvb,EACA,SAAAge,CAAA,EAJKD,EAAa,GAMrB,CACH,GAEC5d,OAAA,KAAE,UAAU,yCACV,UAAAH,EAAE,6BAA6B,EAAG,IACnCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,0BAA0B,EAC/B,GACF,CAEJ,IACF,EACF,CACF,GACF,EAECK,MAAAwhB,EAAA,CAAY,MAAM,WACjB,gBAACjT,EACC,WAAAzO,EAAA,KAAC0O,GAAW,WAAWmP,EAAW,OAAS,GACzC,UAAA7d,OAAC2O,IAAU,UAAW,2BAA2BkP,EAAW,UAAY,EAAE,GACxE,UAAC3d,MAAA+f,GAAA,CAAc,UAAU,SAAU,GAClCpgB,EAAE,oBAAoB,GACzB,EACAK,MAAC4O,IAAgB,UAAW+O,EAAW,UAAY,GAChD,SAAAhe,EAAE,sBAAsB,EAC3B,GACF,EACCK,EAAA,IAAA0O,EAAA,CAAY,UAAW,0BAA0BiP,EAAW,OAAS,EAAE,GACrE,SACCa,EAAAxe,MAAC,MAAI,WAAW,oBAAoB2d,EAAW,UAAY,EAAE,GAC1D,SAAAhe,EAAE,gBAAgB,EACrB,EACEsB,GAAYA,EAAS,OAAS,EAChCA,EAAS,IAAKO,GACZxB,EAAA,IAAC+c,GAAA,CAEC,QAAAvb,EACA,kBAAA0Z,EACA,EAAAvb,CAAA,EAHK6B,EAAQ,GAKhB,EAEAxB,EAAA,SAAE,UAAW,0CAA0C2d,EAAW,UAAY,EAAE,GAC9E,SAAEhe,EAAA,oBAAoB,CACzB,GAEJ,GACF,CACF,GAECyf,GACEpf,MAAAwhB,EAAA,CAAY,MAAM,aACjB,gBAACjT,EACC,WAAAzO,EAAA,KAAC0O,GAAW,WAAWmP,EAAW,OAAS,GACzC,UAAA7d,OAAC2O,IAAU,UAAW,2BAA2BkP,EAAW,UAAY,EAAE,GACxE,UAAC3d,MAAAgc,GAAA,CAAS,UAAU,SAAU,GAC7Brc,EAAE,gCAAgC,GACrC,EACAK,MAAC4O,IAAgB,UAAW+O,EAAW,UAAY,GAChD,SAAAhe,EAAE,oCAAoC,EACzC,GACF,EACCK,EAAA,IAAA0O,EAAA,CAAY,UAAWiP,EAAW,OAAS,GAC1C,SAAC3d,EAAA,WAAI,UAAW2d,EAAW,YAAc,YAEtC,WACE3d,MAAA,OAAI,UAAW,oBAAoB2d,EAAW,UAAY,EAAE,GAC1D,SAAEhe,EAAA,gBAAgB,CACrB,GACEif,GAAsBA,EAAmB,OAAS,SACnD,MACC,WAAA9e,OAAC,MAAG,UAAW,sDAAsD6d,EAAW,YAAc,SAAS,GACrG,UAAA3d,EAAA,IAAC2c,GAAM,WAAWgB,EAAW,UAAY,UAAW,EACnDhe,EAAE,8BAA8B,GACnC,QACC,MAAI,WAAWge,EAAW,YAAc,YACrC,UAAM,KAEN,MAAM8D,EAAiB7C,EAAmB,OAAO,CAAC8C,EAAKC,IAAkB,CACvE,MAAMC,EAAaD,EAAc,YAC7B,OAACD,EAAIE,CAAU,IACjBF,EAAIE,CAAU,EAAI,CAChB,SAAUD,EAAc,SACxB,YAAa,CAAC,EACd,kBAAmBA,EAAc,aAGjCD,EAAAE,CAAU,EAAE,YAAY,KAAK,CAC/B,GAAID,EAAc,cAClB,KAAMA,EAAc,gBACpB,QAASA,EAAc,mBACvB,QAASA,EAAc,mBACxB,EACMD,CACT,EAAG,CAAyB,GAE5B,OAAO,OAAO,OAAOD,CAAc,EAAE,IAAKI,GACxC7hB,EAAA,IAAC+d,GAAA,CAEC,cAAe8D,EACf,kBAAA3G,EACA,EAAAvb,EACA,SAAAge,CAAA,EAJKkE,EAAM,SAAS,GAMvB,MAEL,CACF,WAEC,IAAE,WAAW,0CAA0ClE,EAAW,UAAY,EAAE,GAC9E,UAAAhe,EAAE,kCAAkC,EAAG,IACxCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,0BAA0B,EAC/B,EACF,EAEJ,GACF,GACF,CACF,GAGDK,MAAAwhB,EAAA,CAAY,MAAM,UACjB,gBAACjT,EACC,WAAAzO,EAAA,KAAC0O,GAAW,WAAWmP,EAAW,OAAS,GACzC,UAAA7d,OAAC2O,IAAU,UAAW,2BAA2BkP,EAAW,UAAY,EAAE,GACxE,UAAC3d,MAAAyb,GAAA,CAAO,UAAU,SAAU,GAC3B9b,EAAE,uBAAuB,GAC5B,EACAK,MAAC4O,IAAgB,UAAW+O,EAAW,UAAY,GAChD,SAAAhe,EAAE,6BAA6B,EAClC,GACF,EACCK,MAAA0O,EAAA,CAAY,UAAWiP,EAAW,OAAS,GACzC,SAAAoB,EACE/e,MAAA,OAAI,UAAW,oBAAoB2d,EAAW,UAAY,EAAE,GAC1D,SAAEhe,EAAA,gBAAgB,EACrB,EACEmf,GAAeA,EAAY,OAAS,QACrC,MAAI,WAAW,uBAAuBnB,EAAW,cAAgB,gBAAgB,GAC/E,SAAYmB,EAAA,IAAK7D,GAChBjb,EAAA,IAACie,GAAA,CAEC,OAAAhD,EACA,kBAAAC,EACA,EAAAvb,EACA,SAAAge,CAAA,EAJK1C,EAAO,EAMf,GACH,EAECnb,OAAA,KAAE,UAAW,0CAA0C6d,EAAW,UAAY,EAAE,GAC9E,UAAAhe,EAAE,2BAA2B,EAAG,IACjCK,MAACic,GAAK,GAAG,cAAc,UAAU,+BAC9B,SAAAtc,EAAE,kCAAkC,EACvC,GACF,CAEJ,IACF,CACF,SAEC6hB,EAAY,OAAM,YACjB,SAAAxhB,MAAC2M,IAAkB,GACrB,QAEC6U,EAAY,OAAM,SACjB,SAAC1hB,EAAA,YAAI,UAAU,yBACb,UAAAE,EAAA,IAACoc,GAAe,UACfS,GAAgB,KACnB,CACF,IACF,GAEF,EACF,CACA,EAEJ","names":["ActivityFavoriteDialog","open","onOpenChange","activity","t","useTranslation","Dialog","jsxs","DialogContent","jsx","DialogHeader","DialogTitle","Badge","Heart","useFavorites","user","useAuth","useQuery","favorites","error","supabase","restaurantIds","f","restaurants","restaurantError","useUserComments","comments","c","activityIds","restaurantMap","activityMap","activities","a","comment","restaurant","useMerchantActivities","myRestaurants","useMerchantRestaurants","r","activityRestaurants","ar","item","COUNTRY_CODES","parsePhoneWithCode","fullPhone","country","EditProfileDialog","profile","navigate","useNavigate","isAdmin","useUserRole","setOpen","useState","displayName","setDisplayName","parsedPhone","phoneCode","setPhoneCode","phone","setPhone","isEditingPhone","setIsEditingPhone","avatarFile","setAvatarFile","avatarPreview","setAvatarPreview","showDeleteDialog","setShowDeleteDialog","showConfirmDialog","setShowConfirmDialog","deleteConfirmText","setDeleteConfirmText","isDeleting","setIsDeleting","prevOpenRef","useRef","useEffect","wasOpen","newParsedPhone","showEmailDialog","setShowEmailDialog","showNewEmailDialog","setShowNewEmailDialog","showConfirmUpdateDialog","setShowConfirmUpdateDialog","newEmail","setNewEmail","oldEmailCode","setOldEmailCode","newEmailCode","setNewEmailCode","oldEmailCodeSent","setOldEmailCodeSent","newEmailCodeSent","setNewEmailCodeSent","isUpdatingEmail","setIsUpdatingEmail","showPasswordDialog","setShowPasswordDialog","showNewPasswordDialog","setShowNewPasswordDialog","currentPassword","setCurrentPassword","newPassword","setNewPassword","confirmPassword","setConfirmPassword","useEmailForPassword","setUseEmailForPassword","passwordEmailCode","setPasswordEmailCode","passwordEmailCodeSent","setPasswordEmailCodeSent","isUpdatingPassword","setIsUpdatingPassword","passwordStrength","setPasswordStrength","oldEmailCodeInputRef","newEmailCodeInputRef","passwordEmailCodeInputRef","updateProfile","useUpdateProfile","uploadAvatar","useUploadAvatar","handleAvatarChange","e","file","handleSave","avatar_url","uploadedUrl","handleDeleteAccount","toast","resolve","handleSendOldEmailCode","handleVerifyOldEmail","data","handleSendNewEmailCode","handleVerifyNewEmail","handleUpdateEmail","session","checkPasswordStrength","password","strength","handleVerifyPassword","createClient","__vitePreload","tempClient","handleSendPasswordEmailCode","handleVerifyPasswordEmail","handleUpdatePassword","DialogTrigger","Button","Settings","DialogDescription","Avatar","AvatarImage","AvatarFallback","Input","Upload","Label","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Mail","Lock","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Fragment","ADDRESS_LABELS","Home","Briefcase","Building","MapPin","COUNTRIES","AddressForm","initialData","onSubmit","onCancel","isLoading","isEdit","formData","setFormData","handleSubmit","value","label","Checkbox","checked","DialogFooter","AddressCard","address","onEdit","onDelete","onSetDefault","isSettingDefault","canDelete","labelConfig","l","LabelIcon","Star","Phone","Edit","AlertDialogTrigger","AddressManagement","addresses","useUserAddresses","useProfile","createAddress","useCreateAddress","updateAddress","useUpdateAddress","deleteAddress","useDeleteAddress","setDefaultAddress","useSetDefaultAddress","isAddDialogOpen","setIsAddDialogOpen","editingAddress","setEditingAddress","pendingAddressData","setPendingAddressData","showPhoneConfirm","setShowPhoneConfirm","profileHasNoPhone","handleCreate","handleConfirmCreateWithPhone","handleCancelPhoneConfirm","handleUpdate","handleDelete","id","handleSetDefault","Card","CardHeader","CardTitle","CardContent","hasAddresses","CardDescription","Plus","__defProp","__getOwnPropSymbols","__hasOwnProp","__propIsEnum","__defNormalProp","obj","key","__spreadValues","b","prop","__objRest","source","exclude","target","qrcodegen","qrcodegen2","_QrCode","version","errorCorrectionLevel","dataCodewords","msk","row","i","allCodewords","minPenalty","penalty","assert","text","ecl","segs","seg","minVersion","maxVersion","mask","boostEcl","dataUsedBits","dataCapacityBits2","usedBits","QrSegment","newEcl","bb","appendBits","dataCapacityBits","padByte","x","y","alignPatPos","numAlign","j","rem","bits","getBit","color","dy","dx","dist","xx","yy","isDark","ver","numBlocks","blockEccLen","rawCodewords","numShortBlocks","shortBlockLen","blocks","rsDiv","k","dat","ecc","result","block","right","vert","invert","runColor","runX","runHistory","runY","dark","sum","total","step","pos","degree","root","divisor","_","factor","coef","z","n","core","currentRunColor","currentRunLength","val","len","cond","_QrSegment","mode","numChars","bitData","digits","temp","assignVal","ccbits","str","QrCode2","_Ecc","ordinal","formatBits","QrSegment2","_Mode","modeBits","numBitsCharCount","qrcodegen_default","ERROR_LEVEL_MAP","DEFAULT_SIZE","DEFAULT_LEVEL","DEFAULT_BGCOLOR","DEFAULT_FGCOLOR","DEFAULT_INCLUDEMARGIN","DEFAULT_MINVERSION","SPEC_MARGIN_SIZE","DEFAULT_MARGIN_SIZE","DEFAULT_IMG_SCALE","generatePath","modules","margin","ops","start","cell","excavateModules","excavation","getImageSettings","cells","size","imageSettings","numCells","defaultSize","scale","w","h","opacity","floorX","floorY","ceilW","ceilH","crossOrigin","getMarginSize","includeMargin","marginSize","useQRCode","level","boostLevel","qrcode","React","segments","accum","calculatedImageSettings","cells2","margin2","numCells2","calculatedImageSettings2","SUPPORTS_PATH2D","QRCodeCanvas","props","forwardedRef","_a","bgColor","fgColor","_b","style","otherProps","imgSrc","_canvas","_image","setCanvasRef","node","isImgLoaded","setIsImageLoaded","canvas","ctx","cellsToDraw","image","haveImageToRender","pixelRatio","rdx","cdx","canvasStyle","img","QRCodeSVG","title","fgPath","CouponDetailDialog","coupon","getLocalizedField","useLocalizedContent","showQrCode","setShowQrCode","template","code","isUsed","Ticket","ScrollArea","Separator","QrCode","Tag","Clock","format","Calendar","Link","useBookingRecords","useDeliveryRecords","BookingRecords","records","getStatusBadge","status","CalendarDays","record","restaurantName","Store","Users","DeliveryRecords","Truck","CommentItem","memo","isFailed","isPending","getRiskReasonText","labels","reason","AlertCircle","FavoriteRestaurantItem","restaurantType","ActivitySubscriptionItem","subscription","isMobile","dialogOpen","setDialogOpen","formatDistanceToNow","MerchantActivityItem","activityGroup","UserCouponItem","detailsOpen","setDetailsOpen","Profile","useIsMobile","profileLoading","favoritesLoading","commentsLoading","subscriptions","subscriptionsLoading","useSubscriptions","merchantActivities","merchantActivitiesLoading","userCoupons","couponsLoading","useUserCoupons","role","isMerchant","isSupervisor","isMerchantOrSupervisor","activeTab","setActiveTab","carouselApi","setCarouselApi","scrollPositions","setScrollPositions","visitedTabs","setVisitedTabs","tabs","User","MessageSquare","saveScrollPosition","tabValue","prev","restoreScrollPosition","savedPosition","handleSelect","index","newTab","handleTabClick","queryClient","useQueryClient","handleRefresh","useCallback","roleDisplay","PullToRefresh","Coins","PointsHistoryDialog","ActivityTermsAgreement","Carousel","CarouselContent","CarouselItem","Tabs","TabsList","TabsTrigger","TabsContent","activityGroups","acc","participation","activityId","group","tab","Icon"],"ignoreList":[6],"sources":["../../src/components/ActivityFavoriteDialog.tsx","../../src/hooks/useFavorites.ts","../../src/hooks/useUserComments.ts","../../src/hooks/useMerchantActivities.ts","../../src/components/EditProfileDialog.tsx","../../src/components/AddressManagement.tsx","../../node_modules/qrcode.react/lib/esm/index.js","../../src/components/CouponDetailDialog.tsx","../../src/hooks/useOrderRecords.ts","../../src/components/BookingRecords.tsx","../../src/components/DeliveryRecords.tsx","../../src/pages/Profile.tsx"],"sourcesContent":["import { useTranslation } from \"react-i18next\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Heart } from \"lucide-react\";\r\n\r\ninterface ActivityFavoriteDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  activity: {\r\n    title: string;\r\n    image_url?: string | null;\r\n    content: string;\r\n  };\r\n}\r\n\r\nexport function ActivityFavoriteDialog({\r\n  open,\r\n  onOpenChange,\r\n  activity,\r\n}: ActivityFavoriteDialogProps) {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-lg font-semibold line-clamp-2\">\r\n            {activity.title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {/* Favorited badge */}\r\n          <Badge variant=\"secondary\" className=\"flex items-center gap-1.5 w-fit\">\r\n            <Heart className=\"w-3.5 h-3.5 fill-primary text-primary\" />\r\n            {t(\"profile.activityFavorited\")}\r\n          </Badge>\r\n          \r\n          {/* Activity image */}\r\n          {activity.image_url && (\r\n            <div className=\"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30\">\r\n              <img\r\n                src={activity.image_url}\r\n                alt={activity.title}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            </div>\r\n          )}\r\n          \r\n          {/* Activity content - max 4 lines */}\r\n          <div \r\n            className=\"text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r\n              [&_span[style*='color']]:!text-inherit\"\r\n            dangerouslySetInnerHTML={{ __html: activity.content }}\r\n          />\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport const useFavorites = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"favorites\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const { data: favorites, error } = await supabase\r\n        .from(\"favorites\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", user.id);\r\n\r\n      if (error) throw error;\r\n\r\n      if (!favorites || favorites.length === 0) return [];\r\n\r\n      const restaurantIds = favorites.map((f) => f.restaurant_id);\r\n\r\n      const { data: restaurants, error: restaurantError } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"*\")\r\n        .in(\"id\", restaurantIds)\r\n        .eq(\"visible\", true);\r\n\r\n      if (restaurantError) throw restaurantError;\r\n\r\n      return restaurants || [];\r\n    },\r\n    enabled: !!user,\r\n  });\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport const useUserComments = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"user-comments\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      // Fetch all user comments including flagged ones\r\n      const { data: comments, error } = await supabase\r\n        .from(\"comments\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .is(\"parent_id\", null)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      if (!comments || comments.length === 0) return [];\r\n\r\n      // Collect unique target IDs by type\r\n      const restaurantIds = comments\r\n        .filter(c => c.target_type === \"restaurant\")\r\n        .map(c => c.target_id);\r\n      const activityIds = comments\r\n        .filter(c => c.target_type === \"activity\")\r\n        .map(c => c.target_id);\r\n\r\n      // Batch fetch restaurants\r\n      const restaurantMap = new Map<string, { name: string; name_en?: string; name_pt?: string }>();\r\n      if (restaurantIds.length > 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name, name_en, name_pt\")\r\n          .in(\"id\", restaurantIds);\r\n        \r\n        restaurants?.forEach(r => {\r\n          restaurantMap.set(r.id, { name: r.name, name_en: r.name_en || undefined, name_pt: r.name_pt || undefined });\r\n        });\r\n      }\r\n\r\n      // Batch fetch activities\r\n      const activityMap = new Map<string, { title_zh: string; title_en?: string; title_pt?: string }>();\r\n      if (activityIds.length > 0) {\r\n        const { data: activities } = await supabase\r\n          .from(\"activities\")\r\n          .select(\"id, title_zh, title_en, title_pt\")\r\n          .in(\"id\", activityIds);\r\n        \r\n        activities?.forEach(a => {\r\n          activityMap.set(a.id, { title_zh: a.title_zh, title_en: a.title_en, title_pt: a.title_pt });\r\n        });\r\n      }\r\n\r\n      // Map comments with target info\r\n      return comments.map(comment => {\r\n        if (comment.target_type === \"restaurant\") {\r\n          const restaurant = restaurantMap.get(comment.target_id);\r\n          return {\r\n            ...comment,\r\n            target_name: restaurant?.name || \"Unknown Restaurant\",\r\n            target_name_en: restaurant?.name_en,\r\n            target_name_pt: restaurant?.name_pt,\r\n          };\r\n        } else if (comment.target_type === \"activity\") {\r\n          const activity = activityMap.get(comment.target_id);\r\n          return {\r\n            ...comment,\r\n            target_name: activity?.title_zh || \"Unknown Activity\",\r\n            target_name_en: activity?.title_en,\r\n            target_name_pt: activity?.title_pt,\r\n          };\r\n        }\r\n        return comment;\r\n      });\r\n    },\r\n    enabled: !!user,\r\n    staleTime: 30000, // Cache for 30 seconds\r\n  });\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useMerchantRestaurants } from \"./useActivityParticipation\";\r\n\r\ninterface MerchantActivityParticipation {\r\n  activity_id: string;\r\n  restaurant_id: string;\r\n  restaurant_name: string;\r\n  restaurant_name_en: string | null;\r\n  restaurant_name_pt: string | null;\r\n  restaurant_address: string;\r\n  activity: {\r\n    id: string;\r\n    title_en: string;\r\n    title_zh: string;\r\n    title_pt: string;\r\n    content_en: string;\r\n    content_zh: string;\r\n    content_pt: string;\r\n    image_url: string | null;\r\n    start_date: string;\r\n    end_date: string | null;\r\n    created_at: string;\r\n  } | null;\r\n  created_at: string;\r\n}\r\n\r\nexport const useMerchantActivities = () => {\r\n  const { user } = useAuth();\r\n  const { data: myRestaurants = [] } = useMerchantRestaurants();\r\n\r\n  return useQuery({\r\n    queryKey: [\"merchantActivities\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user || myRestaurants.length === 0) return [];\r\n\r\n      const restaurantIds = myRestaurants.map(r => r.id);\r\n\r\n      // Get all activity_restaurants entries for merchant's restaurants\r\n      const { data: activityRestaurants, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(\"*\")\r\n        .in(\"restaurant_id\", restaurantIds)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      if (!activityRestaurants || activityRestaurants.length === 0) return [];\r\n\r\n      // Fetch restaurant details\r\n      const { data: restaurants } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"id, name, name_en, name_pt, address\")\r\n        .in(\"id\", restaurantIds);\r\n\r\n      // Fetch activity details - only published activities (draft activities should be invisible to merchants)\r\n      const activityIds = [...new Set(activityRestaurants.map(ar => ar.activity_id))];\r\n      const { data: activities } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"*\")\r\n        .in(\"id\", activityIds)\r\n        .eq(\"status\", \"published\");\r\n\r\n      // Combine data - filter out entries where activity is null (draft activities)\r\n      const result: MerchantActivityParticipation[] = activityRestaurants\r\n        .map(ar => {\r\n          const restaurant = restaurants?.find(r => r.id === ar.restaurant_id);\r\n          const activity = activities?.find(a => a.id === ar.activity_id);\r\n\r\n          return {\r\n            activity_id: ar.activity_id,\r\n            restaurant_id: ar.restaurant_id,\r\n            restaurant_name: restaurant?.name || \"\",\r\n            restaurant_name_en: restaurant?.name_en || null,\r\n            restaurant_name_pt: restaurant?.name_pt || null,\r\n            restaurant_address: restaurant?.address || \"\",\r\n            activity: activity || null,\r\n            created_at: ar.created_at,\r\n          };\r\n        })\r\n        .filter(item => item.activity !== null); // Remove draft activities\r\n\r\n      return result;\r\n    },\r\n    enabled: !!user && myRestaurants.length > 0,\r\n  });\r\n};\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Settings, Upload, Trash2, Mail, Lock } from \"lucide-react\";\r\nimport { useUpdateProfile, useUploadAvatar } from \"@/hooks/useProfile\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst COUNTRY_CODES = [\r\n  { code: \"+351\", country: \"Portugal\", flag: \"\" },\r\n  { code: \"+34\", country: \"Spain\", flag: \"\" },\r\n  { code: \"+33\", country: \"France\", flag: \"\" },\r\n  { code: \"+49\", country: \"Germany\", flag: \"\" },\r\n  { code: \"+39\", country: \"Italy\", flag: \"\" },\r\n  { code: \"+44\", country: \"UK\", flag: \"\" },\r\n  { code: \"+31\", country: \"Netherlands\", flag: \"\" },\r\n  { code: \"+32\", country: \"Belgium\", flag: \"\" },\r\n  { code: \"+86\", country: \"China\", flag: \"\" },\r\n  { code: \"+1\", country: \"USA/Canada\", flag: \"\" },\r\n  { code: \"+55\", country: \"Brazil\", flag: \"\" },\r\n];\r\n\r\n// Helper to parse phone with country code\r\nconst parsePhoneWithCode = (fullPhone: string | null | undefined) => {\r\n  if (!fullPhone) return { code: \"+351\", number: \"\" };\r\n  \r\n  // Try to match country code at the start\r\n  for (const country of COUNTRY_CODES) {\r\n    if (fullPhone.startsWith(country.code)) {\r\n      return { \r\n        code: country.code, \r\n        number: fullPhone.slice(country.code.length).trim() \r\n      };\r\n    }\r\n  }\r\n  \r\n  // If no match, return default code and full number\r\n  return { code: \"+351\", number: fullPhone };\r\n};\r\n\r\ninterface EditProfileDialogProps {\r\n  profile: {\r\n    display_name: string;\r\n    phone?: string | null;\r\n    avatar_url?: string | null;\r\n  };\r\n}\r\n\r\nconst EditProfileDialog = ({ profile }: EditProfileDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const { isAdmin } = useUserRole();\r\n  const [open, setOpen] = useState(false);\r\n  const [displayName, setDisplayName] = useState(profile.display_name);\r\n  \r\n  // Parse phone with country code\r\n  const parsedPhone = parsePhoneWithCode(profile.phone);\r\n  const [phoneCode, setPhoneCode] = useState(parsedPhone.code);\r\n  const [phone, setPhone] = useState(parsedPhone.number);\r\n  const [isEditingPhone, setIsEditingPhone] = useState(false);\r\n  \r\n  const [avatarFile, setAvatarFile] = useState<File | null>(null);\r\n  const [avatarPreview, setAvatarPreview] = useState(profile.avatar_url || \"\");\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n  const [deleteConfirmText, setDeleteConfirmText] = useState(\"\");\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Track previous open state to only sync when dialog first opens\r\n  const prevOpenRef = useRef(false);\r\n  \r\n  // Sync profile data only when dialog transitions from closed to open\r\n  useEffect(() => {\r\n    const wasOpen = prevOpenRef.current;\r\n    prevOpenRef.current = open;\r\n    \r\n    // Only sync data when dialog is opening (not when profile data changes while dialog is open)\r\n    if (open && !wasOpen) {\r\n      setDisplayName(profile.display_name);\r\n      const newParsedPhone = parsePhoneWithCode(profile.phone);\r\n      setPhoneCode(newParsedPhone.code);\r\n      setPhone(newParsedPhone.number);\r\n      setAvatarPreview(profile.avatar_url || \"\");\r\n      setAvatarFile(null);\r\n      setIsEditingPhone(false);\r\n    }\r\n  }, [open, profile.display_name, profile.phone, profile.avatar_url]);\r\n  \r\n  // Email change states\r\n  const [showEmailDialog, setShowEmailDialog] = useState(false);\r\n  const [showNewEmailDialog, setShowNewEmailDialog] = useState(false);\r\n  const [showConfirmUpdateDialog, setShowConfirmUpdateDialog] = useState(false);\r\n  const [newEmail, setNewEmail] = useState(\"\");\r\n  const [oldEmailCode, setOldEmailCode] = useState(\"\");\r\n  const [newEmailCode, setNewEmailCode] = useState(\"\");\r\n  const [oldEmailCodeSent, setOldEmailCodeSent] = useState(false);\r\n  const [newEmailCodeSent, setNewEmailCodeSent] = useState(false);\r\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\r\n\r\n  // Password change states\r\n  const [showPasswordDialog, setShowPasswordDialog] = useState(false);\r\n  const [showNewPasswordDialog, setShowNewPasswordDialog] = useState(false);\r\n  const [currentPassword, setCurrentPassword] = useState(\"\");\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [useEmailForPassword, setUseEmailForPassword] = useState(false);\r\n  const [passwordEmailCode, setPasswordEmailCode] = useState(\"\");\r\n  const [passwordEmailCodeSent, setPasswordEmailCodeSent] = useState(false);\r\n  const [isUpdatingPassword, setIsUpdatingPassword] = useState(false);\r\n  const [passwordStrength, setPasswordStrength] = useState<'weak' | 'medium' | 'strong' | null>(null);\r\n\r\n  const oldEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n  const newEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n  const passwordEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const updateProfile = useUpdateProfile();\r\n  const uploadAvatar = useUploadAvatar();\r\n\r\n  // Auto-focus old email verification code input\r\n  useEffect(() => {\r\n    if (oldEmailCodeSent && oldEmailCodeInputRef.current) {\r\n      oldEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [oldEmailCodeSent]);\r\n\r\n  // Auto-focus new email verification code input\r\n  useEffect(() => {\r\n    if (newEmailCodeSent && newEmailCodeInputRef.current) {\r\n      newEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [newEmailCodeSent]);\r\n\r\n  // Auto-focus password email verification code input\r\n  useEffect(() => {\r\n    if (passwordEmailCodeSent && passwordEmailCodeInputRef.current) {\r\n      passwordEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [passwordEmailCodeSent]);\r\n\r\n  const handleAvatarChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 2 * 1024 * 1024) {\r\n        return;\r\n      }\r\n      setAvatarFile(file);\r\n      setAvatarPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    let avatar_url = profile.avatar_url;\r\n\r\n    if (avatarFile) {\r\n      const uploadedUrl = await uploadAvatar.mutateAsync(avatarFile);\r\n      if (uploadedUrl) avatar_url = uploadedUrl;\r\n    }\r\n\r\n    // Combine phone code and number\r\n    const fullPhone = phone ? `${phoneCode} ${phone}` : undefined;\r\n\r\n    await updateProfile.mutateAsync({\r\n      display_name: displayName,\r\n      phone: fullPhone,\r\n      avatar_url: avatar_url || undefined,\r\n    });\r\n\r\n    setIsEditingPhone(false);\r\n    setOpen(false);\r\n  };\r\n\r\n  const handleDeleteAccount = async () => {\r\n    if (!user || deleteConfirmText.toLowerCase() !== \"delete\") return;\r\n    \r\n    setIsDeleting(true);\r\n    try {\r\n      // Call edge function to delete account\r\n      const { error } = await supabase.functions.invoke(\"delete-account\", {\r\n        body: { userId: user.id },\r\n      });\r\n      \r\n      if (error) {\r\n        toast.error(t(\"profile.deleteAccountFailed\"));\r\n        console.error(error);\r\n        setIsDeleting(false);\r\n        return;\r\n      }\r\n      \r\n      // Show success message first\r\n      toast.success(t(\"profile.deleteAccountSuccess\"));\r\n      \r\n      // Close dialogs\r\n      setShowConfirmDialog(false);\r\n      setShowDeleteDialog(false);\r\n      setDeleteConfirmText(\"\");\r\n      \r\n      // Wait a moment for user to see the message\r\n      await new Promise(resolve => setTimeout(resolve, 1500));\r\n      \r\n      // Then sign out and navigate\r\n      await supabase.auth.signOut();\r\n      navigate(\"/auth\");\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"profile.deleteAccountFailed\"));\r\n      setIsDeleting(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleSendOldEmailCode = async () => {\r\n    if (!user?.email) return;\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: user.email },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      setOldEmailCodeSent(true);\r\n      toast.success(t(\"profile.codeSentToOldEmail\"));\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyOldEmail = async () => {\r\n    if (!oldEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: user?.email, code: oldEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldEmailVerified\"));\r\n      setShowEmailDialog(false);\r\n      setShowNewEmailDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleSendNewEmailCode = async () => {\r\n    if (!newEmail || !newEmail.includes(\"@\")) {\r\n      toast.error(t(\"profile.enterValidEmail\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: newEmail },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(t(\"profile.codeSentToNewEmail\"));\r\n      setNewEmailCodeSent(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyNewEmail = async () => {\r\n    if (!newEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: newEmail, code: newEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.newEmailVerified\"));\r\n      // Close current dialog and open confirm dialog\r\n      setShowNewEmailDialog(false);\r\n      // Use setTimeout to ensure smooth dialog transition\r\n      setTimeout(() => {\r\n        setShowConfirmUpdateDialog(true);\r\n      }, 100);\r\n    } catch (error: any) {\r\n      toast.error(t(\"toast.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleUpdateEmail = async () => {\r\n    setIsUpdatingEmail(true);\r\n    try {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!session || !user) {\r\n        toast.error(t(\"toast.pleaseSignIn\"));\r\n        setIsUpdatingEmail(false);\r\n        return;\r\n      }\r\n\r\n      // Update email\r\n      const { data, error } = await supabase.functions.invoke(\"update-email\", {\r\n        body: {\r\n          userId: user.id,\r\n          oldEmail: user.email,\r\n          oldEmailCode,\r\n          newEmail,\r\n          newEmailCode,\r\n        },\r\n        headers: {\r\n          Authorization: `Bearer ${session.access_token}`,\r\n        },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        throw new Error(data?.error || \"Failed to update email\");\r\n      }\r\n\r\n      toast.success(t(\"toast.emailUpdatedSuccess\"));\r\n      \r\n      // Close dialogs\r\n      setShowConfirmUpdateDialog(false);\r\n      setOpen(false);\r\n      \r\n      // Reset email change states\r\n      setOldEmailCode(\"\");\r\n      setNewEmail(\"\");\r\n      setNewEmailCode(\"\");\r\n      setOldEmailCodeSent(false);\r\n      setNewEmailCodeSent(false);\r\n      \r\n      // Sign out and redirect to login\r\n      await new Promise(resolve => setTimeout(resolve, 1500));\r\n      await supabase.auth.signOut();\r\n      navigate(\"/auth\");\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"toast.emailUpdateError\"));\r\n      console.error(error);\r\n    } finally {\r\n      setIsUpdatingEmail(false);\r\n    }\r\n  };\r\n\r\n  // Password change handlers\r\n  const checkPasswordStrength = (password: string): 'weak' | 'medium' | 'strong' => {\r\n    let strength = 0;\r\n    \r\n    if (password.length >= 6) strength++;\r\n    if (password.length >= 8) strength++;\r\n    if (/[a-z]/.test(password)) strength++;\r\n    if (/[A-Z]/.test(password)) strength++;\r\n    if (/[0-9]/.test(password)) strength++;\r\n    if (/[^a-zA-Z0-9]/.test(password)) strength++;\r\n    \r\n    if (strength <= 2) return 'weak';\r\n    if (strength <= 4) return 'medium';\r\n    return 'strong';\r\n  };\r\n\r\n  const handleVerifyPassword = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!currentPassword) {\r\n      toast.error(t(\"profile.enterCurrentPassword\"));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Create a temporary client to verify password without triggering auth state changes\r\n      const { createClient } = await import('@supabase/supabase-js');\r\n      const tempClient = createClient(\r\n        import.meta.env.VITE_SUPABASE_URL,\r\n        import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY,\r\n        {\r\n          auth: {\r\n            persistSession: false,\r\n            autoRefreshToken: false,\r\n          }\r\n        }\r\n      );\r\n\r\n      const { error } = await tempClient.auth.signInWithPassword({\r\n        email: user?.email || \"\",\r\n        password: currentPassword,\r\n      });\r\n\r\n      if (error) {\r\n        toast.error(t(\"profile.oldPasswordIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldPasswordVerified\"));\r\n      setShowPasswordDialog(false);\r\n      setShowNewPasswordDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleSendPasswordEmailCode = async () => {\r\n    if (!user?.email) return;\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: user.email },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      setPasswordEmailCodeSent(true);\r\n      toast.success(t(\"profile.codeSentToOldEmail\"));\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyPasswordEmail = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!passwordEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: user?.email, code: passwordEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldEmailVerified\"));\r\n      setShowPasswordDialog(false);\r\n      setShowNewPasswordDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleUpdatePassword = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!newPassword || !confirmPassword) {\r\n      toast.error(t(\"profile.enterNewPassword\"));\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 6) {\r\n      toast.error(t(\"profile.passwordTooShort\"));\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      toast.error(t(\"profile.passwordsDontMatch\"));\r\n      return;\r\n    }\r\n\r\n    setIsUpdatingPassword(true);\r\n    try {\r\n      const { error } = await supabase.auth.updateUser({\r\n        password: newPassword,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(t(\"profile.passwordUpdated\"));\r\n      \r\n      // Close dialogs and reset states\r\n      setShowNewPasswordDialog(false);\r\n      setOpen(false);\r\n      setCurrentPassword(\"\");\r\n      setNewPassword(\"\");\r\n      setConfirmPassword(\"\");\r\n      setUseEmailForPassword(false);\r\n      setPasswordEmailCode(\"\");\r\n      setPasswordEmailCodeSent(false);\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"profile.passwordUpdateFailed\"));\r\n      console.error(error);\r\n    } finally {\r\n      setIsUpdatingPassword(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"outline\">\r\n          <Settings className=\"w-4 h-4 mr-2\" />\r\n          {t(\"profile.editProfile\")}\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"profile.editProfile\")}</DialogTitle>\r\n          <DialogDescription>{t(\"profile.editProfileDescription\")}</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-3 py-3\">\r\n          <div className=\"flex flex-col items-center gap-3\">\r\n            <Avatar className=\"w-16 h-16 sm:w-24 sm:h-24\">\r\n              <AvatarImage src={avatarPreview} />\r\n              <AvatarFallback>{displayName?.charAt(0).toUpperCase()}</AvatarFallback>\r\n            </Avatar>\r\n            <div>\r\n              <Input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleAvatarChange}\r\n                className=\"hidden\"\r\n                id=\"avatar-upload\"\r\n              />\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => document.getElementById(\"avatar-upload\")?.click()}\r\n                className=\"text-xs sm:text-sm\"\r\n              >\r\n                <Upload className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\r\n                {t(\"profile.uploadAvatar\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-1.5\">\r\n            <Label htmlFor=\"displayName\" className=\"text-sm\">{t(\"profile.displayName\")}</Label>\r\n            <Input\r\n              id=\"displayName\"\r\n              value={displayName}\r\n              onChange={(e) => setDisplayName(e.target.value)}\r\n              placeholder={t(\"profile.displayName\")}\r\n              className=\"h-9\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-1.5\">\r\n            <Label htmlFor=\"phone\" className=\"text-sm\">{t(\"profile.phone\")}</Label>\r\n            {!profile.phone && !isEditingPhone ? (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setIsEditingPhone(true)}\r\n                className=\"w-full justify-start h-9\"\r\n              >\r\n                {t(\"profile.addPhoneNumber\")}\r\n              </Button>\r\n            ) : isEditingPhone || !profile.phone ? (\r\n              <div className=\"flex gap-2\">\r\n                <Select\r\n                  value={phoneCode}\r\n                  onValueChange={setPhoneCode}\r\n                >\r\n                  <SelectTrigger className=\"w-[110px] h-9\">\r\n                    <SelectValue placeholder=\"+351\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {COUNTRY_CODES.map((item) => (\r\n                      <SelectItem key={item.code} value={item.code}>\r\n                        <span className=\"flex items-center gap-2\">\r\n                          <span>{item.flag}</span>\r\n                          <span>{item.code}</span>\r\n                        </span>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                <Input\r\n                  id=\"phone\"\r\n                  className=\"flex-1 h-9\"\r\n                  value={phone}\r\n                  onChange={(e) => setPhone(e.target.value)}\r\n                  placeholder={t(\"profile.phonePlaceholder\")}\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center gap-2\">\r\n                <Input\r\n                  value={`${phoneCode} ${phone}`}\r\n                  disabled\r\n                  className=\"h-9 flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => setIsEditingPhone(true)}\r\n                  className=\"text-xs whitespace-nowrap\"\r\n                >\r\n                  {t(\"profile.modifyPhoneNumber\")}\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Email change - only for non-admin users */}\r\n          {!isAdmin && (\r\n            <div className=\"space-y-1.5 pt-2 border-t\">\r\n              <Label className=\"text-sm\">{t(\"profile.email\")}</Label>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Input\r\n                  value={user?.email || \"\"}\r\n                  disabled\r\n                  className=\"h-9 flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => setShowEmailDialog(true)}\r\n                  className=\"text-xs\"\r\n                >\r\n                  <Mail className=\"w-3 h-3 mr-1\" />\r\n                  {t(\"profile.modify\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Password change - available for all users */}\r\n          <div className={`space-y-1.5 ${isAdmin ? \"pt-2 border-t\" : \"\"}`}>\r\n            <Label className=\"text-sm\">{t(\"profile.changePassword\")}</Label>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setShowPasswordDialog(true)}\r\n              className=\"w-full justify-start h-9\"\r\n            >\r\n              <Lock className=\"w-3 h-3 mr-2\" />\r\n              {t(\"profile.changePassword\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t\">\r\n          {!isAdmin && (\r\n            <Button \r\n              variant=\"destructive\"\r\n              size=\"sm\"\r\n              onClick={() => setShowDeleteDialog(true)}\r\n              className=\"w-full sm:w-auto text-xs sm:text-sm\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\r\n              {t(\"profile.deleteAccount\")}\r\n            </Button>\r\n          )}\r\n          <div className={`flex gap-2 w-full sm:w-auto ${isAdmin ? \"sm:ml-auto\" : \"\"}`}>\r\n            <Button \r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => {\r\n                setIsEditingPhone(false);\r\n                setOpen(false);\r\n              }}\r\n              className=\"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm\"\r\n            >\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              onClick={handleSave}\r\n              disabled={updateProfile.isPending || uploadAvatar.isPending}\r\n              className=\"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm\"\r\n            >\r\n              {updateProfile.isPending || uploadAvatar.isPending\r\n                ? t(\"common.loading\")\r\n                : t(\"common.save\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n\r\n      {/* First confirmation dialog */}\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.deleteAccountWarning\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.deleteAccountDescription\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => {\r\n                setShowDeleteDialog(false);\r\n                setShowConfirmDialog(true);\r\n              }}\r\n              className=\"bg-destructive hover:bg-destructive/90\"\r\n            >\r\n              {t(\"common.continue\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Final confirmation dialog */}\r\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.confirmDeleteAccount\")}</AlertDialogTitle>\r\n            <AlertDialogDescription className=\"space-y-4\">\r\n              <p>{t(\"profile.confirmDeleteDescription\")}</p>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"confirm-delete\">\r\n                  {t(\"profile.typeDeleteToConfirm\")}\r\n                </Label>\r\n                <Input\r\n                  id=\"confirm-delete\"\r\n                  value={deleteConfirmText}\r\n                  onChange={(e) => setDeleteConfirmText(e.target.value)}\r\n                  placeholder=\"DELETE\"\r\n                  className=\"uppercase\"\r\n                />\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => setDeleteConfirmText(\"\")}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteAccount}\r\n              disabled={deleteConfirmText.toLowerCase() !== \"delete\" || isDeleting}\r\n              className=\"bg-destructive hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? t(\"common.loading\") : t(\"profile.deleteAccount\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Verify old email dialog */}\r\n      <AlertDialog open={showEmailDialog} onOpenChange={setShowEmailDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.verifyOldEmail\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.oldEmailStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.currentEmail\")}</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  value={user?.email || \"\"}\r\n                  disabled\r\n                  className=\"flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={handleSendOldEmailCode}\r\n                  disabled={oldEmailCodeSent}\r\n                >\r\n                  {oldEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {oldEmailCodeSent && (\r\n              <div className=\"space-y-2\">\r\n                <Label>{t(\"profile.verificationCode\")}</Label>\r\n                <Input\r\n                  ref={oldEmailCodeInputRef}\r\n                  value={oldEmailCode}\r\n                  onChange={(e) => setOldEmailCode(e.target.value)}\r\n                  placeholder={t(\"profile.enterCode\")}\r\n                  maxLength={4}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowEmailDialog(false);\r\n              // Reset states after cancel\r\n              setTimeout(() => {\r\n                setOldEmailCode(\"\");\r\n                setOldEmailCodeSent(false);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            {oldEmailCodeSent && (\r\n              <AlertDialogAction onClick={handleVerifyOldEmail}>\r\n                {t(\"profile.verify\")}\r\n              </AlertDialogAction>\r\n            )}\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* New email dialog - Input and verify in one step */}\r\n      <AlertDialog open={showNewEmailDialog} onOpenChange={setShowNewEmailDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader className=\"text-center space-y-3\">\r\n            <AlertDialogTitle className=\"text-xl\">\r\n              {t(\"profile.verifyNewEmail\")}\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription className=\"text-center\">\r\n              {t(\"profile.newEmailStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-sm font-normal\">{t(\"profile.newEmail\")}</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  type=\"email\"\r\n                  value={newEmail}\r\n                  onChange={(e) => setNewEmail(e.target.value)}\r\n                  placeholder={t(\"profile.enterNewEmail\")}\r\n                  disabled={newEmailCodeSent}\r\n                  className=\"border-2 focus:border-primary flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={handleSendNewEmailCode}\r\n                  disabled={!newEmail || newEmailCodeSent}\r\n                  className=\"text-xs whitespace-nowrap px-3\"\r\n                >\r\n                  {newEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {newEmailCodeSent && (\r\n              <div className=\"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300\">\r\n                <Label className=\"text-sm font-normal\">{t(\"profile.verificationCode\")}</Label>\r\n                <Input\r\n                  ref={newEmailCodeInputRef}\r\n                  value={newEmailCode}\r\n                  onChange={(e) => setNewEmailCode(e.target.value)}\r\n                  placeholder={t(\"profile.enterCode\")}\r\n                  maxLength={4}\r\n                  className=\"border-2 focus:border-primary\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter className=\"flex-col sm:flex-col gap-2\">\r\n            {newEmailCodeSent && (\r\n              <AlertDialogAction \r\n                onClick={handleVerifyNewEmail}\r\n                disabled={!newEmailCode || newEmailCode.length !== 4}\r\n                className=\"w-full bg-primary hover:bg-primary/90\"\r\n              >\r\n                \r\n              </AlertDialogAction>\r\n            )}\r\n            <AlertDialogCancel \r\n              onClick={() => {\r\n                setShowNewEmailDialog(false);\r\n                // Reset states after a delay to allow dialog transition\r\n                setTimeout(() => {\r\n                  setNewEmail(\"\");\r\n                  setNewEmailCode(\"\");\r\n                  setNewEmailCodeSent(false);\r\n                }, 300);\r\n              }}\r\n              className=\"w-full mt-0\"\r\n            >\r\n              \r\n            </AlertDialogCancel>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Confirm update dialog */}\r\n      <AlertDialog open={showConfirmUpdateDialog} onOpenChange={setShowConfirmUpdateDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle></AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n               3/3: \r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm\">\r\n              <p className=\"font-medium text-green-900 dark:text-green-100\"></p>\r\n              <p className=\"text-green-700 dark:text-green-300 mt-1\">\r\n                \"\"\r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-muted-foreground\">:</span>\r\n                <span className=\"font-medium\">{user?.email}</span>\r\n              </div>\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-muted-foreground\">:</span>\r\n                <span className=\"font-medium\">{newEmail}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowConfirmUpdateDialog(false);\r\n              // Reset states after cancel\r\n              setTimeout(() => {\r\n                setOldEmailCode(\"\");\r\n                setNewEmail(\"\");\r\n                setNewEmailCode(\"\");\r\n                setOldEmailCodeSent(false);\r\n                setNewEmailCodeSent(false);\r\n              }, 300);\r\n            }}></AlertDialogCancel>\r\n            <AlertDialogAction \r\n              onClick={handleUpdateEmail}\r\n              disabled={isUpdatingEmail}\r\n            >\r\n              {isUpdatingEmail ? \"...\" : \"\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Verify password/email dialog */}\r\n      <AlertDialog open={showPasswordDialog} onOpenChange={setShowPasswordDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.verifyOldPassword\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.oldPasswordStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            {!useEmailForPassword ? (\r\n              <>\r\n                <div className=\"space-y-2\">\r\n                  <Label>{t(\"profile.currentPassword\")}</Label>\r\n                  <Input\r\n                    type=\"password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    placeholder={t(\"profile.enterCurrentPassword\")}\r\n                  />\r\n                </div>\r\n                <Button\r\n                  variant=\"link\"\r\n                  size=\"sm\"\r\n                  onClick={() => setUseEmailForPassword(true)}\r\n                  className=\"text-xs p-0 h-auto\"\r\n                >\r\n                  {t(\"profile.forgotPassword\")} {t(\"profile.useEmailVerification\")}\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div className=\"space-y-2\">\r\n                  <Label>{t(\"profile.currentEmail\")}</Label>\r\n                  <div className=\"flex gap-2\">\r\n                    <Input\r\n                      value={user?.email || \"\"}\r\n                      disabled\r\n                      className=\"flex-1\"\r\n                    />\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={handleSendPasswordEmailCode}\r\n                      disabled={passwordEmailCodeSent}\r\n                    >\r\n                      {passwordEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n\r\n                {passwordEmailCodeSent && (\r\n                  <div className=\"space-y-2\">\r\n                    <Label>{t(\"profile.verificationCode\")}</Label>\r\n                    <Input\r\n                      ref={passwordEmailCodeInputRef}\r\n                      value={passwordEmailCode}\r\n                      onChange={(e) => setPasswordEmailCode(e.target.value)}\r\n                      placeholder={t(\"profile.enterCode\")}\r\n                      maxLength={4}\r\n                    />\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowPasswordDialog(false);\r\n              setTimeout(() => {\r\n                setCurrentPassword(\"\");\r\n                setUseEmailForPassword(false);\r\n                setPasswordEmailCode(\"\");\r\n                setPasswordEmailCodeSent(false);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            {useEmailForPassword ? (\r\n              passwordEmailCodeSent && (\r\n                <AlertDialogAction onClick={handleVerifyPasswordEmail}>\r\n                  {t(\"profile.verify\")}\r\n                </AlertDialogAction>\r\n              )\r\n            ) : (\r\n              <AlertDialogAction onClick={handleVerifyPassword}>\r\n                {t(\"profile.verify\")}\r\n              </AlertDialogAction>\r\n            )}\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* New password dialog */}\r\n      <AlertDialog open={showNewPasswordDialog} onOpenChange={setShowNewPasswordDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.setNewPassword\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.newPasswordStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.newPassword\")}</Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={newPassword}\r\n                onChange={(e) => {\r\n                  setNewPassword(e.target.value);\r\n                  if (e.target.value) {\r\n                    setPasswordStrength(checkPasswordStrength(e.target.value));\r\n                  } else {\r\n                    setPasswordStrength(null);\r\n                  }\r\n                }}\r\n                placeholder={t(\"profile.enterNewPassword\")}\r\n              />\r\n              {passwordStrength && (\r\n                <div className=\"space-y-1\">\r\n                  <div className=\"flex gap-1\">\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'weak' ? 'bg-destructive' : \r\n                      passwordStrength === 'medium' ? 'bg-warning' : \r\n                      'bg-success'\r\n                    }`} />\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'medium' || passwordStrength === 'strong' ? \r\n                      passwordStrength === 'medium' ? 'bg-warning' : 'bg-success' : \r\n                      'bg-muted'\r\n                    }`} />\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'strong' ? 'bg-success' : 'bg-muted'\r\n                    }`} />\r\n                  </div>\r\n                  <p className={`text-xs ${\r\n                    passwordStrength === 'weak' ? 'text-destructive' : \r\n                    passwordStrength === 'medium' ? 'text-warning' : \r\n                    'text-success'\r\n                  }`}>\r\n                    {t(`auth.passwordStrength.${passwordStrength}`)}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.confirmNewPassword\")}</Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={confirmPassword}\r\n                onChange={(e) => setConfirmPassword(e.target.value)}\r\n                placeholder={t(\"profile.confirmNewPasswordPlaceholder\")}\r\n              />\r\n            </div>\r\n\r\n            {newPassword && confirmPassword && newPassword !== confirmPassword && (\r\n              <p className=\"text-sm text-destructive\">{t(\"profile.passwordsDontMatch\")}</p>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowNewPasswordDialog(false);\r\n              setTimeout(() => {\r\n                setNewPassword(\"\");\r\n                setConfirmPassword(\"\");\r\n                setPasswordStrength(null);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleUpdatePassword}\r\n              disabled={!newPassword || !confirmPassword || newPassword !== confirmPassword || isUpdatingPassword}\r\n            >\r\n              {isUpdatingPassword ? t(\"common.loading\") : t(\"profile.updatePassword\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default EditProfileDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useUserAddresses, useCreateAddress, useUpdateAddress, useDeleteAddress, useSetDefaultAddress, type UserAddress, type AddressFormData } from \"@/hooks/useUserAddresses\";\r\nimport { useProfile, useUpdateProfile } from \"@/hooks/useProfile\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { MapPin, Plus, Edit, Trash2, Star, Home, Building, Briefcase, Phone } from \"lucide-react\";\r\nconst ADDRESS_LABELS = [{\r\n  value: \"Home\",\r\n  icon: Home,\r\n  labelKey: \"address.labelHome\"\r\n}, {\r\n  value: \"Work\",\r\n  icon: Briefcase,\r\n  labelKey: \"address.labelWork\"\r\n}, {\r\n  value: \"Office\",\r\n  icon: Building,\r\n  labelKey: \"address.labelOffice\"\r\n}, {\r\n  value: \"Other\",\r\n  icon: MapPin,\r\n  labelKey: \"address.labelOther\"\r\n}];\r\nconst COUNTRY_CODES = [{\r\n  code: \"+351\",\r\n  country: \"Portugal\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+34\",\r\n  country: \"Spain\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+33\",\r\n  country: \"France\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+49\",\r\n  country: \"Germany\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+39\",\r\n  country: \"Italy\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+44\",\r\n  country: \"UK\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+31\",\r\n  country: \"Netherlands\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+32\",\r\n  country: \"Belgium\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+86\",\r\n  country: \"China\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+1\",\r\n  country: \"USA/Canada\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+55\",\r\n  country: \"Brazil\",\r\n  flag: \"\"\r\n}];\r\nconst COUNTRIES = [\"Portugal\", \"Spain\", \"France\", \"Germany\", \"Italy\", \"United Kingdom\", \"Netherlands\", \"Belgium\", \"China\", \"Other\"];\r\ninterface AddressFormProps {\r\n  initialData?: Partial<AddressFormData>;\r\n  onSubmit: (data: AddressFormData) => void;\r\n  onCancel: () => void;\r\n  isLoading?: boolean;\r\n  isEdit?: boolean;\r\n}\r\nconst AddressForm = ({\r\n  initialData,\r\n  onSubmit,\r\n  onCancel,\r\n  isLoading,\r\n  isEdit\r\n}: AddressFormProps) => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const [formData, setFormData] = useState<AddressFormData>({\r\n    label: initialData?.label || \"Home\",\r\n    street: initialData?.street || \"\",\r\n    district: initialData?.district || \"\",\r\n    city: initialData?.city || \"\",\r\n    postal_code: initialData?.postal_code || \"\",\r\n    country: initialData?.country || \"Portugal\",\r\n    phone: initialData?.phone || \"\",\r\n    phone_code: initialData?.phone_code || \"+351\",\r\n    is_default: initialData?.is_default || false\r\n  });\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    onSubmit(formData);\r\n  };\r\n  return <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"label\">{t(\"address.label\")}</Label>\r\n        <Select value={formData.label} onValueChange={value => setFormData({\r\n        ...formData,\r\n        label: value\r\n      })}>\r\n          <SelectTrigger>\r\n            <SelectValue placeholder={t(\"address.selectLabel\")} />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            {ADDRESS_LABELS.map(label => <SelectItem key={label.value} value={label.value}>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <label.icon className=\"w-4 h-4\" />\r\n                  {t(label.labelKey)}\r\n                </div>\r\n              </SelectItem>)}\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"street\">{t(\"address.street\")} *</Label>\r\n        <Input id=\"street\" value={formData.street} onChange={e => setFormData({\r\n        ...formData,\r\n        street: e.target.value\r\n      })} placeholder={t(\"address.streetPlaceholder\")} required />\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"district\">{t(\"address.district\")}</Label>\r\n          <Input id=\"district\" value={formData.district} onChange={e => setFormData({\r\n          ...formData,\r\n          district: e.target.value\r\n        })} placeholder={t(\"address.districtPlaceholder\")} />\r\n        </div>\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"city\">{t(\"address.city\")} *</Label>\r\n          <Input id=\"city\" value={formData.city} onChange={e => setFormData({\r\n          ...formData,\r\n          city: e.target.value\r\n        })} placeholder={t(\"address.cityPlaceholder\")} required />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"postal_code\">{t(\"address.postalCode\")} *</Label>\r\n          <Input id=\"postal_code\" value={formData.postal_code} onChange={e => setFormData({\r\n          ...formData,\r\n          postal_code: e.target.value\r\n        })} placeholder={t(\"address.postalCodePlaceholder\")} required />\r\n        </div>\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"country\">{t(\"address.country\")} *</Label>\r\n          <Select value={formData.country} onValueChange={value => setFormData({\r\n          ...formData,\r\n          country: value\r\n        })}>\r\n            <SelectTrigger>\r\n              <SelectValue placeholder={t(\"address.selectCountry\")} />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {COUNTRIES.map(country => <SelectItem key={country} value={country}>\r\n                  {country}\r\n                </SelectItem>)}\r\n            </SelectContent>\r\n        </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"phone\">{t(\"address.phone\")} *</Label>\r\n        <div className=\"flex gap-2\">\r\n          <Select value={formData.phone_code} onValueChange={value => setFormData({\r\n          ...formData,\r\n          phone_code: value\r\n        })}>\r\n            <SelectTrigger className=\"w-[130px]\">\r\n              <SelectValue placeholder=\"+351\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {COUNTRY_CODES.map(item => <SelectItem key={item.code} value={item.code}>\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <span>{item.flag}</span>\r\n                    <span>{item.code}</span>\r\n                  </span>\r\n                </SelectItem>)}\r\n            </SelectContent>\r\n          </Select>\r\n          <Input id=\"phone\" className=\"flex-1\" value={formData.phone} onChange={e => setFormData({\r\n          ...formData,\r\n          phone: e.target.value\r\n        })} placeholder={t(\"address.phonePlaceholder\")} required />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center space-x-2\">\r\n        <Checkbox id=\"is_default\" checked={formData.is_default} onCheckedChange={checked => setFormData({\r\n        ...formData,\r\n        is_default: checked as boolean\r\n      })} />\r\n        <Label htmlFor=\"is_default\" className=\"text-sm font-normal cursor-pointer\">\r\n          {t(\"address.setAsDefault\")}\r\n        </Label>\r\n      </div>\r\n\r\n      <DialogFooter className=\"gap-2 sm:gap-0\">\r\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n          {t(\"common.cancel\")}\r\n        </Button>\r\n        <Button type=\"submit\" disabled={isLoading}>\r\n          {isLoading ? t(\"common.saving\") : isEdit ? t(\"common.save\") : t(\"address.add\")}\r\n        </Button>\r\n      </DialogFooter>\r\n    </form>;\r\n};\r\ninterface AddressCardProps {\r\n  address: UserAddress;\r\n  onEdit: (address: UserAddress) => void;\r\n  onDelete: (id: string) => void;\r\n  onSetDefault: (id: string) => void;\r\n  isDeleting?: boolean;\r\n  isSettingDefault?: boolean;\r\n  canDelete?: boolean;\r\n}\r\nconst AddressCard = ({\r\n  address,\r\n  onEdit,\r\n  onDelete,\r\n  onSetDefault,\r\n  isDeleting,\r\n  isSettingDefault,\r\n  canDelete = true\r\n}: AddressCardProps) => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const labelConfig = ADDRESS_LABELS.find(l => l.value === address.label) || ADDRESS_LABELS[3];\r\n  const LabelIcon = labelConfig.icon;\r\n  return <div className={`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${address.is_default ? 'bg-primary/5 border-primary/20' : ''}`}>\r\n      <div className=\"flex items-start justify-between gap-4\">\r\n        <div className=\"flex items-start gap-3 flex-1\">\r\n          <div className={`p-2 rounded-full ${address.is_default ? 'bg-primary/20' : 'bg-primary/10'}`}>\r\n            <LabelIcon className=\"w-5 h-5 text-primary\" />\r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <div className=\"flex items-center gap-2 mb-1\">\r\n              <span className=\"font-semibold text-foreground\">\r\n                {t(labelConfig.labelKey)}\r\n              </span>\r\n              {address.is_default && <Badge variant=\"secondary\" className=\"text-xs\">\r\n                  <Star className=\"w-3 h-3 mr-1 fill-current\" />\r\n                  {t(\"address.default\")}\r\n                </Badge>}\r\n            </div>\r\n            <p className=\"text-sm text-foreground\">\r\n              {address.street}{address.district && `, ${address.district}`}\r\n            </p>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              {[address.postal_code, address.city, address.country].filter(Boolean).join(\", \")}\r\n            </p>\r\n            {address.phone && <p className=\"text-sm text-muted-foreground flex items-center gap-1 mt-1\">\r\n                <Phone className=\"w-3 h-3\" />\r\n                {address.phone_code} {address.phone}\r\n              </p>}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          {!address.is_default && <Button variant=\"ghost\" size=\"icon\" onClick={() => onSetDefault(address.id)} disabled={isSettingDefault} title={t(\"address.setAsDefault\")}>\r\n              <Star className=\"w-4 h-4\" />\r\n            </Button>}\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => onEdit(address)} title={t(\"common.edit\")}>\r\n            <Edit className=\"w-4 h-4\" />\r\n          </Button>\r\n          {canDelete && <AlertDialog>\r\n              <AlertDialogTrigger asChild>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\" title={t(\"common.delete\")}>\r\n                  <Trash2 className=\"w-4 h-4\" />\r\n                </Button>\r\n              </AlertDialogTrigger>\r\n              <AlertDialogContent>\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle>{t(\"address.deleteTitle\")}</AlertDialogTitle>\r\n                  <AlertDialogDescription>\r\n                    {t(\"address.deleteDescription\")}\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                  <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n                  <AlertDialogAction onClick={() => onDelete(address.id)} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\" disabled={isDeleting}>\r\n                    {isDeleting ? t(\"common.deleting\") : t(\"common.delete\")}\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>}\r\n        </div>\r\n      </div>\r\n    </div>;\r\n};\r\nconst AddressManagement = () => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const {\r\n    data: addresses,\r\n    isLoading\r\n  } = useUserAddresses();\r\n  const {\r\n    data: profile\r\n  } = useProfile();\r\n  const createAddress = useCreateAddress();\r\n  const updateAddress = useUpdateAddress();\r\n  const updateProfile = useUpdateProfile();\r\n  const deleteAddress = useDeleteAddress();\r\n  const setDefaultAddress = useSetDefaultAddress();\r\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\r\n  const [editingAddress, setEditingAddress] = useState<UserAddress | null>(null);\r\n  const [pendingAddressData, setPendingAddressData] = useState<AddressFormData | null>(null);\r\n  const [showPhoneConfirm, setShowPhoneConfirm] = useState(false);\r\n  const profileHasNoPhone = !profile?.phone;\r\n  const handleCreate = (data: AddressFormData) => {\r\n    // If profile has no phone and address has phone, show confirmation\r\n    if (profileHasNoPhone && data.phone) {\r\n      setPendingAddressData(data);\r\n      setShowPhoneConfirm(true);\r\n      return;\r\n    }\r\n    createAddress.mutate(data, {\r\n      onSuccess: () => setIsAddDialogOpen(false)\r\n    });\r\n  };\r\n  const handleConfirmCreateWithPhone = () => {\r\n    if (!pendingAddressData) return;\r\n\r\n    // Update profile phone\r\n    const fullPhone = `${pendingAddressData.phone_code || '+351'} ${pendingAddressData.phone}`;\r\n    updateProfile.mutate({\r\n      phone: fullPhone\r\n    });\r\n\r\n    // Create address\r\n    createAddress.mutate(pendingAddressData, {\r\n      onSuccess: () => {\r\n        setIsAddDialogOpen(false);\r\n        setPendingAddressData(null);\r\n        setShowPhoneConfirm(false);\r\n      }\r\n    });\r\n  };\r\n  const handleCancelPhoneConfirm = () => {\r\n    setPendingAddressData(null);\r\n    setShowPhoneConfirm(false);\r\n  };\r\n  const handleUpdate = (data: AddressFormData) => {\r\n    if (!editingAddress) return;\r\n    updateAddress.mutate({\r\n      id: editingAddress.id,\r\n      address: data\r\n    }, {\r\n      onSuccess: () => setEditingAddress(null)\r\n    });\r\n  };\r\n  const handleDelete = (id: string) => {\r\n    deleteAddress.mutate(id);\r\n  };\r\n  const handleSetDefault = (id: string) => {\r\n    setDefaultAddress.mutate(id);\r\n  };\r\n  if (isLoading) {\r\n    return <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <MapPin className=\"w-5 h-5\" />\r\n            {t(\"address.myAddresses\")}\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-center py-8 text-muted-foreground\">\r\n            {t(\"common.loading\")}\r\n          </div>\r\n        </CardContent>\r\n      </Card>;\r\n  }\r\n  const hasAddresses = addresses && addresses.length > 0;\r\n  return <Card>\r\n      <CardHeader>\r\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3\">\r\n          <div className=\"space-y-1.5 min-w-0 flex-1\">\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <MapPin className=\"w-5 h-5 flex-shrink-0\" />\r\n              {t(\"address.myAddresses\")}\r\n            </CardTitle>\r\n            <CardDescription className=\"text-xs text-primary\">{t(\"address.manageDescription\")}</CardDescription>\r\n          </div>\r\n          {hasAddresses && <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\r\n              <DialogTrigger asChild>\r\n                <Button size=\"sm\" className=\"w-full sm:w-auto flex-shrink-0\">\r\n                  <Plus className=\"w-4 h-4 mr-2\" />\r\n                  <span className=\"truncate\">{t(\"address.addNew\")}</span>\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent className=\"sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                  <DialogTitle>{t(\"address.addNew\")}</DialogTitle>\r\n                  <DialogDescription>\r\n                    {t(\"address.addDescription\")}\r\n                  </DialogDescription>\r\n                </DialogHeader>\r\n                <AddressForm onSubmit={handleCreate} onCancel={() => setIsAddDialogOpen(false)} isLoading={createAddress.isPending} />\r\n              </DialogContent>\r\n            </Dialog>}\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {hasAddresses ? <div className=\"space-y-4\">\r\n            {addresses.map(address => <AddressCard key={address.id} address={address} onEdit={setEditingAddress} onDelete={handleDelete} onSetDefault={handleSetDefault} isDeleting={deleteAddress.isPending} isSettingDefault={setDefaultAddress.isPending} canDelete={addresses.length > 1} />)}\r\n          </div> : <div className=\"text-center py-8\">\r\n            <MapPin className=\"w-12 h-12 mx-auto text-muted-foreground/50 mb-4\" />\r\n            <p className=\"text-muted-foreground mb-4\">{t(\"address.noAddresses\")}</p>\r\n            <Button onClick={() => setIsAddDialogOpen(true)}>\r\n              <Plus className=\"w-4 h-4 mr-2\" />\r\n              {t(\"address.addFirst\")}\r\n            </Button>\r\n          </div>}\r\n      </CardContent>\r\n\r\n      {/* Edit Dialog */}\r\n      <Dialog open={!!editingAddress} onOpenChange={() => setEditingAddress(null)}>\r\n        <DialogContent className=\"sm:max-w-[500px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"address.editAddress\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {t(\"address.editDescription\")}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {editingAddress && <AddressForm initialData={editingAddress} onSubmit={handleUpdate} onCancel={() => setEditingAddress(null)} isLoading={updateAddress.isPending} isEdit />}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Phone Confirmation Dialog */}\r\n      <AlertDialog open={showPhoneConfirm} onOpenChange={setShowPhoneConfirm}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"address.phoneConfirmTitle\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"address.phoneConfirmDescription\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={handleCancelPhoneConfirm}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleConfirmCreateWithPhone} disabled={createAddress.isPending || updateProfile.isPending}>\r\n              {createAddress.isPending || updateProfile.isPending ? t(\"common.saving\") : t(\"common.confirm\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Card>;\r\n};\r\nexport default AddressManagement;","var __defProp = Object.defineProperty;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {}))\n    if (__hasOwnProp.call(b, prop))\n      __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(b)) {\n      if (__propIsEnum.call(b, prop))\n        __defNormalProp(a, prop, b[prop]);\n    }\n  return a;\n};\nvar __objRest = (source, exclude) => {\n  var target = {};\n  for (var prop in source)\n    if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0)\n      target[prop] = source[prop];\n  if (source != null && __getOwnPropSymbols)\n    for (var prop of __getOwnPropSymbols(source)) {\n      if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop))\n        target[prop] = source[prop];\n    }\n  return target;\n};\n\n// src/index.tsx\nimport React from \"react\";\n\n// src/third-party/qrcodegen/index.ts\n/**\n * @license QR Code generator library (TypeScript)\n * Copyright (c) Project Nayuki.\n * SPDX-License-Identifier: MIT\n */\nvar qrcodegen;\n((qrcodegen2) => {\n  const _QrCode = class _QrCode {\n    /*-- Constructor (low level) and fields --*/\n    // Creates a new QR Code with the given version number,\n    // error correction level, data codeword bytes, and mask number.\n    // This is a low-level API that most users should not use directly.\n    // A mid-level API is the encodeSegments() function.\n    constructor(version, errorCorrectionLevel, dataCodewords, msk) {\n      this.version = version;\n      this.errorCorrectionLevel = errorCorrectionLevel;\n      // The modules of this QR Code (false = light, true = dark).\n      // Immutable after constructor finishes. Accessed through getModule().\n      this.modules = [];\n      // Indicates function modules that are not subjected to masking. Discarded when constructor finishes.\n      this.isFunction = [];\n      if (version < _QrCode.MIN_VERSION || version > _QrCode.MAX_VERSION)\n        throw new RangeError(\"Version value out of range\");\n      if (msk < -1 || msk > 7)\n        throw new RangeError(\"Mask value out of range\");\n      this.size = version * 4 + 17;\n      let row = [];\n      for (let i = 0; i < this.size; i++)\n        row.push(false);\n      for (let i = 0; i < this.size; i++) {\n        this.modules.push(row.slice());\n        this.isFunction.push(row.slice());\n      }\n      this.drawFunctionPatterns();\n      const allCodewords = this.addEccAndInterleave(dataCodewords);\n      this.drawCodewords(allCodewords);\n      if (msk == -1) {\n        let minPenalty = 1e9;\n        for (let i = 0; i < 8; i++) {\n          this.applyMask(i);\n          this.drawFormatBits(i);\n          const penalty = this.getPenaltyScore();\n          if (penalty < minPenalty) {\n            msk = i;\n            minPenalty = penalty;\n          }\n          this.applyMask(i);\n        }\n      }\n      assert(0 <= msk && msk <= 7);\n      this.mask = msk;\n      this.applyMask(msk);\n      this.drawFormatBits(msk);\n      this.isFunction = [];\n    }\n    /*-- Static factory functions (high level) --*/\n    // Returns a QR Code representing the given Unicode text string at the given error correction level.\n    // As a conservative upper bound, this function is guaranteed to succeed for strings that have 738 or fewer\n    // Unicode code points (not UTF-16 code units) if the low error correction level is used. The smallest possible\n    // QR Code version is automatically chosen for the output. The ECC level of the result may be higher than the\n    // ecl argument if it can be done without increasing the version.\n    static encodeText(text, ecl) {\n      const segs = qrcodegen2.QrSegment.makeSegments(text);\n      return _QrCode.encodeSegments(segs, ecl);\n    }\n    // Returns a QR Code representing the given binary data at the given error correction level.\n    // This function always encodes using the binary segment mode, not any text mode. The maximum number of\n    // bytes allowed is 2953. The smallest possible QR Code version is automatically chosen for the output.\n    // The ECC level of the result may be higher than the ecl argument if it can be done without increasing the version.\n    static encodeBinary(data, ecl) {\n      const seg = qrcodegen2.QrSegment.makeBytes(data);\n      return _QrCode.encodeSegments([seg], ecl);\n    }\n    /*-- Static factory functions (mid level) --*/\n    // Returns a QR Code representing the given segments with the given encoding parameters.\n    // The smallest possible QR Code version within the given range is automatically\n    // chosen for the output. Iff boostEcl is true, then the ECC level of the result\n    // may be higher than the ecl argument if it can be done without increasing the\n    // version. The mask number is either between 0 to 7 (inclusive) to force that\n    // mask, or -1 to automatically choose an appropriate mask (which may be slow).\n    // This function allows the user to create a custom sequence of segments that switches\n    // between modes (such as alphanumeric and byte) to encode text in less space.\n    // This is a mid-level API; the high-level API is encodeText() and encodeBinary().\n    static encodeSegments(segs, ecl, minVersion = 1, maxVersion = 40, mask = -1, boostEcl = true) {\n      if (!(_QrCode.MIN_VERSION <= minVersion && minVersion <= maxVersion && maxVersion <= _QrCode.MAX_VERSION) || mask < -1 || mask > 7)\n        throw new RangeError(\"Invalid value\");\n      let version;\n      let dataUsedBits;\n      for (version = minVersion; ; version++) {\n        const dataCapacityBits2 = _QrCode.getNumDataCodewords(version, ecl) * 8;\n        const usedBits = QrSegment.getTotalBits(segs, version);\n        if (usedBits <= dataCapacityBits2) {\n          dataUsedBits = usedBits;\n          break;\n        }\n        if (version >= maxVersion)\n          throw new RangeError(\"Data too long\");\n      }\n      for (const newEcl of [_QrCode.Ecc.MEDIUM, _QrCode.Ecc.QUARTILE, _QrCode.Ecc.HIGH]) {\n        if (boostEcl && dataUsedBits <= _QrCode.getNumDataCodewords(version, newEcl) * 8)\n          ecl = newEcl;\n      }\n      let bb = [];\n      for (const seg of segs) {\n        appendBits(seg.mode.modeBits, 4, bb);\n        appendBits(seg.numChars, seg.mode.numCharCountBits(version), bb);\n        for (const b of seg.getData())\n          bb.push(b);\n      }\n      assert(bb.length == dataUsedBits);\n      const dataCapacityBits = _QrCode.getNumDataCodewords(version, ecl) * 8;\n      assert(bb.length <= dataCapacityBits);\n      appendBits(0, Math.min(4, dataCapacityBits - bb.length), bb);\n      appendBits(0, (8 - bb.length % 8) % 8, bb);\n      assert(bb.length % 8 == 0);\n      for (let padByte = 236; bb.length < dataCapacityBits; padByte ^= 236 ^ 17)\n        appendBits(padByte, 8, bb);\n      let dataCodewords = [];\n      while (dataCodewords.length * 8 < bb.length)\n        dataCodewords.push(0);\n      bb.forEach((b, i) => dataCodewords[i >>> 3] |= b << 7 - (i & 7));\n      return new _QrCode(version, ecl, dataCodewords, mask);\n    }\n    /*-- Accessor methods --*/\n    // Returns the color of the module (pixel) at the given coordinates, which is false\n    // for light or true for dark. The top left corner has the coordinates (x=0, y=0).\n    // If the given coordinates are out of bounds, then false (light) is returned.\n    getModule(x, y) {\n      return 0 <= x && x < this.size && 0 <= y && y < this.size && this.modules[y][x];\n    }\n    // Modified to expose modules for easy access\n    getModules() {\n      return this.modules;\n    }\n    /*-- Private helper methods for constructor: Drawing function modules --*/\n    // Reads this object's version field, and draws and marks all function modules.\n    drawFunctionPatterns() {\n      for (let i = 0; i < this.size; i++) {\n        this.setFunctionModule(6, i, i % 2 == 0);\n        this.setFunctionModule(i, 6, i % 2 == 0);\n      }\n      this.drawFinderPattern(3, 3);\n      this.drawFinderPattern(this.size - 4, 3);\n      this.drawFinderPattern(3, this.size - 4);\n      const alignPatPos = this.getAlignmentPatternPositions();\n      const numAlign = alignPatPos.length;\n      for (let i = 0; i < numAlign; i++) {\n        for (let j = 0; j < numAlign; j++) {\n          if (!(i == 0 && j == 0 || i == 0 && j == numAlign - 1 || i == numAlign - 1 && j == 0))\n            this.drawAlignmentPattern(alignPatPos[i], alignPatPos[j]);\n        }\n      }\n      this.drawFormatBits(0);\n      this.drawVersion();\n    }\n    // Draws two copies of the format bits (with its own error correction code)\n    // based on the given mask and this object's error correction level field.\n    drawFormatBits(mask) {\n      const data = this.errorCorrectionLevel.formatBits << 3 | mask;\n      let rem = data;\n      for (let i = 0; i < 10; i++)\n        rem = rem << 1 ^ (rem >>> 9) * 1335;\n      const bits = (data << 10 | rem) ^ 21522;\n      assert(bits >>> 15 == 0);\n      for (let i = 0; i <= 5; i++)\n        this.setFunctionModule(8, i, getBit(bits, i));\n      this.setFunctionModule(8, 7, getBit(bits, 6));\n      this.setFunctionModule(8, 8, getBit(bits, 7));\n      this.setFunctionModule(7, 8, getBit(bits, 8));\n      for (let i = 9; i < 15; i++)\n        this.setFunctionModule(14 - i, 8, getBit(bits, i));\n      for (let i = 0; i < 8; i++)\n        this.setFunctionModule(this.size - 1 - i, 8, getBit(bits, i));\n      for (let i = 8; i < 15; i++)\n        this.setFunctionModule(8, this.size - 15 + i, getBit(bits, i));\n      this.setFunctionModule(8, this.size - 8, true);\n    }\n    // Draws two copies of the version bits (with its own error correction code),\n    // based on this object's version field, iff 7 <= version <= 40.\n    drawVersion() {\n      if (this.version < 7)\n        return;\n      let rem = this.version;\n      for (let i = 0; i < 12; i++)\n        rem = rem << 1 ^ (rem >>> 11) * 7973;\n      const bits = this.version << 12 | rem;\n      assert(bits >>> 18 == 0);\n      for (let i = 0; i < 18; i++) {\n        const color = getBit(bits, i);\n        const a = this.size - 11 + i % 3;\n        const b = Math.floor(i / 3);\n        this.setFunctionModule(a, b, color);\n        this.setFunctionModule(b, a, color);\n      }\n    }\n    // Draws a 9*9 finder pattern including the border separator,\n    // with the center module at (x, y). Modules can be out of bounds.\n    drawFinderPattern(x, y) {\n      for (let dy = -4; dy <= 4; dy++) {\n        for (let dx = -4; dx <= 4; dx++) {\n          const dist = Math.max(Math.abs(dx), Math.abs(dy));\n          const xx = x + dx;\n          const yy = y + dy;\n          if (0 <= xx && xx < this.size && 0 <= yy && yy < this.size)\n            this.setFunctionModule(xx, yy, dist != 2 && dist != 4);\n        }\n      }\n    }\n    // Draws a 5*5 alignment pattern, with the center module\n    // at (x, y). All modules must be in bounds.\n    drawAlignmentPattern(x, y) {\n      for (let dy = -2; dy <= 2; dy++) {\n        for (let dx = -2; dx <= 2; dx++)\n          this.setFunctionModule(x + dx, y + dy, Math.max(Math.abs(dx), Math.abs(dy)) != 1);\n      }\n    }\n    // Sets the color of a module and marks it as a function module.\n    // Only used by the constructor. Coordinates must be in bounds.\n    setFunctionModule(x, y, isDark) {\n      this.modules[y][x] = isDark;\n      this.isFunction[y][x] = true;\n    }\n    /*-- Private helper methods for constructor: Codewords and masking --*/\n    // Returns a new byte string representing the given data with the appropriate error correction\n    // codewords appended to it, based on this object's version and error correction level.\n    addEccAndInterleave(data) {\n      const ver = this.version;\n      const ecl = this.errorCorrectionLevel;\n      if (data.length != _QrCode.getNumDataCodewords(ver, ecl))\n        throw new RangeError(\"Invalid argument\");\n      const numBlocks = _QrCode.NUM_ERROR_CORRECTION_BLOCKS[ecl.ordinal][ver];\n      const blockEccLen = _QrCode.ECC_CODEWORDS_PER_BLOCK[ecl.ordinal][ver];\n      const rawCodewords = Math.floor(_QrCode.getNumRawDataModules(ver) / 8);\n      const numShortBlocks = numBlocks - rawCodewords % numBlocks;\n      const shortBlockLen = Math.floor(rawCodewords / numBlocks);\n      let blocks = [];\n      const rsDiv = _QrCode.reedSolomonComputeDivisor(blockEccLen);\n      for (let i = 0, k = 0; i < numBlocks; i++) {\n        let dat = data.slice(k, k + shortBlockLen - blockEccLen + (i < numShortBlocks ? 0 : 1));\n        k += dat.length;\n        const ecc = _QrCode.reedSolomonComputeRemainder(dat, rsDiv);\n        if (i < numShortBlocks)\n          dat.push(0);\n        blocks.push(dat.concat(ecc));\n      }\n      let result = [];\n      for (let i = 0; i < blocks[0].length; i++) {\n        blocks.forEach((block, j) => {\n          if (i != shortBlockLen - blockEccLen || j >= numShortBlocks)\n            result.push(block[i]);\n        });\n      }\n      assert(result.length == rawCodewords);\n      return result;\n    }\n    // Draws the given sequence of 8-bit codewords (data and error correction) onto the entire\n    // data area of this QR Code. Function modules need to be marked off before this is called.\n    drawCodewords(data) {\n      if (data.length != Math.floor(_QrCode.getNumRawDataModules(this.version) / 8))\n        throw new RangeError(\"Invalid argument\");\n      let i = 0;\n      for (let right = this.size - 1; right >= 1; right -= 2) {\n        if (right == 6)\n          right = 5;\n        for (let vert = 0; vert < this.size; vert++) {\n          for (let j = 0; j < 2; j++) {\n            const x = right - j;\n            const upward = (right + 1 & 2) == 0;\n            const y = upward ? this.size - 1 - vert : vert;\n            if (!this.isFunction[y][x] && i < data.length * 8) {\n              this.modules[y][x] = getBit(data[i >>> 3], 7 - (i & 7));\n              i++;\n            }\n          }\n        }\n      }\n      assert(i == data.length * 8);\n    }\n    // XORs the codeword modules in this QR Code with the given mask pattern.\n    // The function modules must be marked and the codeword bits must be drawn\n    // before masking. Due to the arithmetic of XOR, calling applyMask() with\n    // the same mask value a second time will undo the mask. A final well-formed\n    // QR Code needs exactly one (not zero, two, etc.) mask applied.\n    applyMask(mask) {\n      if (mask < 0 || mask > 7)\n        throw new RangeError(\"Mask value out of range\");\n      for (let y = 0; y < this.size; y++) {\n        for (let x = 0; x < this.size; x++) {\n          let invert;\n          switch (mask) {\n            case 0:\n              invert = (x + y) % 2 == 0;\n              break;\n            case 1:\n              invert = y % 2 == 0;\n              break;\n            case 2:\n              invert = x % 3 == 0;\n              break;\n            case 3:\n              invert = (x + y) % 3 == 0;\n              break;\n            case 4:\n              invert = (Math.floor(x / 3) + Math.floor(y / 2)) % 2 == 0;\n              break;\n            case 5:\n              invert = x * y % 2 + x * y % 3 == 0;\n              break;\n            case 6:\n              invert = (x * y % 2 + x * y % 3) % 2 == 0;\n              break;\n            case 7:\n              invert = ((x + y) % 2 + x * y % 3) % 2 == 0;\n              break;\n            default:\n              throw new Error(\"Unreachable\");\n          }\n          if (!this.isFunction[y][x] && invert)\n            this.modules[y][x] = !this.modules[y][x];\n        }\n      }\n    }\n    // Calculates and returns the penalty score based on state of this QR Code's current modules.\n    // This is used by the automatic mask choice algorithm to find the mask pattern that yields the lowest score.\n    getPenaltyScore() {\n      let result = 0;\n      for (let y = 0; y < this.size; y++) {\n        let runColor = false;\n        let runX = 0;\n        let runHistory = [0, 0, 0, 0, 0, 0, 0];\n        for (let x = 0; x < this.size; x++) {\n          if (this.modules[y][x] == runColor) {\n            runX++;\n            if (runX == 5)\n              result += _QrCode.PENALTY_N1;\n            else if (runX > 5)\n              result++;\n          } else {\n            this.finderPenaltyAddHistory(runX, runHistory);\n            if (!runColor)\n              result += this.finderPenaltyCountPatterns(runHistory) * _QrCode.PENALTY_N3;\n            runColor = this.modules[y][x];\n            runX = 1;\n          }\n        }\n        result += this.finderPenaltyTerminateAndCount(runColor, runX, runHistory) * _QrCode.PENALTY_N3;\n      }\n      for (let x = 0; x < this.size; x++) {\n        let runColor = false;\n        let runY = 0;\n        let runHistory = [0, 0, 0, 0, 0, 0, 0];\n        for (let y = 0; y < this.size; y++) {\n          if (this.modules[y][x] == runColor) {\n            runY++;\n            if (runY == 5)\n              result += _QrCode.PENALTY_N1;\n            else if (runY > 5)\n              result++;\n          } else {\n            this.finderPenaltyAddHistory(runY, runHistory);\n            if (!runColor)\n              result += this.finderPenaltyCountPatterns(runHistory) * _QrCode.PENALTY_N3;\n            runColor = this.modules[y][x];\n            runY = 1;\n          }\n        }\n        result += this.finderPenaltyTerminateAndCount(runColor, runY, runHistory) * _QrCode.PENALTY_N3;\n      }\n      for (let y = 0; y < this.size - 1; y++) {\n        for (let x = 0; x < this.size - 1; x++) {\n          const color = this.modules[y][x];\n          if (color == this.modules[y][x + 1] && color == this.modules[y + 1][x] && color == this.modules[y + 1][x + 1])\n            result += _QrCode.PENALTY_N2;\n        }\n      }\n      let dark = 0;\n      for (const row of this.modules)\n        dark = row.reduce((sum, color) => sum + (color ? 1 : 0), dark);\n      const total = this.size * this.size;\n      const k = Math.ceil(Math.abs(dark * 20 - total * 10) / total) - 1;\n      assert(0 <= k && k <= 9);\n      result += k * _QrCode.PENALTY_N4;\n      assert(0 <= result && result <= 2568888);\n      return result;\n    }\n    /*-- Private helper functions --*/\n    // Returns an ascending list of positions of alignment patterns for this version number.\n    // Each position is in the range [0,177), and are used on both the x and y axes.\n    // This could be implemented as lookup table of 40 variable-length lists of integers.\n    getAlignmentPatternPositions() {\n      if (this.version == 1)\n        return [];\n      else {\n        const numAlign = Math.floor(this.version / 7) + 2;\n        const step = this.version == 32 ? 26 : Math.ceil((this.version * 4 + 4) / (numAlign * 2 - 2)) * 2;\n        let result = [6];\n        for (let pos = this.size - 7; result.length < numAlign; pos -= step)\n          result.splice(1, 0, pos);\n        return result;\n      }\n    }\n    // Returns the number of data bits that can be stored in a QR Code of the given version number, after\n    // all function modules are excluded. This includes remainder bits, so it might not be a multiple of 8.\n    // The result is in the range [208, 29648]. This could be implemented as a 40-entry lookup table.\n    static getNumRawDataModules(ver) {\n      if (ver < _QrCode.MIN_VERSION || ver > _QrCode.MAX_VERSION)\n        throw new RangeError(\"Version number out of range\");\n      let result = (16 * ver + 128) * ver + 64;\n      if (ver >= 2) {\n        const numAlign = Math.floor(ver / 7) + 2;\n        result -= (25 * numAlign - 10) * numAlign - 55;\n        if (ver >= 7)\n          result -= 36;\n      }\n      assert(208 <= result && result <= 29648);\n      return result;\n    }\n    // Returns the number of 8-bit data (i.e. not error correction) codewords contained in any\n    // QR Code of the given version number and error correction level, with remainder bits discarded.\n    // This stateless pure function could be implemented as a (40*4)-cell lookup table.\n    static getNumDataCodewords(ver, ecl) {\n      return Math.floor(_QrCode.getNumRawDataModules(ver) / 8) - _QrCode.ECC_CODEWORDS_PER_BLOCK[ecl.ordinal][ver] * _QrCode.NUM_ERROR_CORRECTION_BLOCKS[ecl.ordinal][ver];\n    }\n    // Returns a Reed-Solomon ECC generator polynomial for the given degree. This could be\n    // implemented as a lookup table over all possible parameter values, instead of as an algorithm.\n    static reedSolomonComputeDivisor(degree) {\n      if (degree < 1 || degree > 255)\n        throw new RangeError(\"Degree out of range\");\n      let result = [];\n      for (let i = 0; i < degree - 1; i++)\n        result.push(0);\n      result.push(1);\n      let root = 1;\n      for (let i = 0; i < degree; i++) {\n        for (let j = 0; j < result.length; j++) {\n          result[j] = _QrCode.reedSolomonMultiply(result[j], root);\n          if (j + 1 < result.length)\n            result[j] ^= result[j + 1];\n        }\n        root = _QrCode.reedSolomonMultiply(root, 2);\n      }\n      return result;\n    }\n    // Returns the Reed-Solomon error correction codeword for the given data and divisor polynomials.\n    static reedSolomonComputeRemainder(data, divisor) {\n      let result = divisor.map((_) => 0);\n      for (const b of data) {\n        const factor = b ^ result.shift();\n        result.push(0);\n        divisor.forEach((coef, i) => result[i] ^= _QrCode.reedSolomonMultiply(coef, factor));\n      }\n      return result;\n    }\n    // Returns the product of the two given field elements modulo GF(2^8/0x11D). The arguments and result\n    // are unsigned 8-bit integers. This could be implemented as a lookup table of 256*256 entries of uint8.\n    static reedSolomonMultiply(x, y) {\n      if (x >>> 8 != 0 || y >>> 8 != 0)\n        throw new RangeError(\"Byte out of range\");\n      let z = 0;\n      for (let i = 7; i >= 0; i--) {\n        z = z << 1 ^ (z >>> 7) * 285;\n        z ^= (y >>> i & 1) * x;\n      }\n      assert(z >>> 8 == 0);\n      return z;\n    }\n    // Can only be called immediately after a light run is added, and\n    // returns either 0, 1, or 2. A helper function for getPenaltyScore().\n    finderPenaltyCountPatterns(runHistory) {\n      const n = runHistory[1];\n      assert(n <= this.size * 3);\n      const core = n > 0 && runHistory[2] == n && runHistory[3] == n * 3 && runHistory[4] == n && runHistory[5] == n;\n      return (core && runHistory[0] >= n * 4 && runHistory[6] >= n ? 1 : 0) + (core && runHistory[6] >= n * 4 && runHistory[0] >= n ? 1 : 0);\n    }\n    // Must be called at the end of a line (row or column) of modules. A helper function for getPenaltyScore().\n    finderPenaltyTerminateAndCount(currentRunColor, currentRunLength, runHistory) {\n      if (currentRunColor) {\n        this.finderPenaltyAddHistory(currentRunLength, runHistory);\n        currentRunLength = 0;\n      }\n      currentRunLength += this.size;\n      this.finderPenaltyAddHistory(currentRunLength, runHistory);\n      return this.finderPenaltyCountPatterns(runHistory);\n    }\n    // Pushes the given value to the front and drops the last value. A helper function for getPenaltyScore().\n    finderPenaltyAddHistory(currentRunLength, runHistory) {\n      if (runHistory[0] == 0)\n        currentRunLength += this.size;\n      runHistory.pop();\n      runHistory.unshift(currentRunLength);\n    }\n  };\n  /*-- Constants and tables --*/\n  // The minimum version number supported in the QR Code Model 2 standard.\n  _QrCode.MIN_VERSION = 1;\n  // The maximum version number supported in the QR Code Model 2 standard.\n  _QrCode.MAX_VERSION = 40;\n  // For use in getPenaltyScore(), when evaluating which mask is best.\n  _QrCode.PENALTY_N1 = 3;\n  _QrCode.PENALTY_N2 = 3;\n  _QrCode.PENALTY_N3 = 40;\n  _QrCode.PENALTY_N4 = 10;\n  _QrCode.ECC_CODEWORDS_PER_BLOCK = [\n    // Version: (note that index 0 is for padding, and is set to an illegal value)\n    //0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40    Error correction level\n    [-1, 7, 10, 15, 20, 26, 18, 20, 24, 30, 18, 20, 24, 26, 30, 22, 24, 28, 30, 28, 28, 28, 28, 30, 30, 26, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    // Low\n    [-1, 10, 16, 26, 18, 24, 16, 18, 22, 22, 26, 30, 22, 22, 24, 24, 28, 28, 26, 26, 26, 26, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28],\n    // Medium\n    [-1, 13, 22, 18, 26, 18, 24, 18, 22, 20, 24, 28, 26, 24, 20, 30, 24, 28, 28, 26, 30, 28, 30, 30, 30, 30, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    // Quartile\n    [-1, 17, 28, 22, 16, 22, 28, 26, 26, 24, 28, 24, 28, 22, 24, 24, 30, 28, 28, 26, 28, 30, 24, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30]\n    // High\n  ];\n  _QrCode.NUM_ERROR_CORRECTION_BLOCKS = [\n    // Version: (note that index 0 is for padding, and is set to an illegal value)\n    //0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40    Error correction level\n    [-1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4, 4, 6, 6, 6, 6, 7, 8, 8, 9, 9, 10, 12, 12, 12, 13, 14, 15, 16, 17, 18, 19, 19, 20, 21, 22, 24, 25],\n    // Low\n    [-1, 1, 1, 1, 2, 2, 4, 4, 4, 5, 5, 5, 8, 9, 9, 10, 10, 11, 13, 14, 16, 17, 17, 18, 20, 21, 23, 25, 26, 28, 29, 31, 33, 35, 37, 38, 40, 43, 45, 47, 49],\n    // Medium\n    [-1, 1, 1, 2, 2, 4, 4, 6, 6, 8, 8, 8, 10, 12, 16, 12, 17, 16, 18, 21, 20, 23, 23, 25, 27, 29, 34, 34, 35, 38, 40, 43, 45, 48, 51, 53, 56, 59, 62, 65, 68],\n    // Quartile\n    [-1, 1, 1, 2, 4, 4, 4, 5, 6, 8, 8, 11, 11, 16, 16, 18, 16, 19, 21, 25, 25, 25, 34, 30, 32, 35, 37, 40, 42, 45, 48, 51, 54, 57, 60, 63, 66, 70, 74, 77, 81]\n    // High\n  ];\n  let QrCode = _QrCode;\n  qrcodegen2.QrCode = _QrCode;\n  function appendBits(val, len, bb) {\n    if (len < 0 || len > 31 || val >>> len != 0)\n      throw new RangeError(\"Value out of range\");\n    for (let i = len - 1; i >= 0; i--)\n      bb.push(val >>> i & 1);\n  }\n  function getBit(x, i) {\n    return (x >>> i & 1) != 0;\n  }\n  function assert(cond) {\n    if (!cond)\n      throw new Error(\"Assertion error\");\n  }\n  const _QrSegment = class _QrSegment {\n    /*-- Constructor (low level) and fields --*/\n    // Creates a new QR Code segment with the given attributes and data.\n    // The character count (numChars) must agree with the mode and the bit buffer length,\n    // but the constraint isn't checked. The given bit buffer is cloned and stored.\n    constructor(mode, numChars, bitData) {\n      this.mode = mode;\n      this.numChars = numChars;\n      this.bitData = bitData;\n      if (numChars < 0)\n        throw new RangeError(\"Invalid argument\");\n      this.bitData = bitData.slice();\n    }\n    /*-- Static factory functions (mid level) --*/\n    // Returns a segment representing the given binary data encoded in\n    // byte mode. All input byte arrays are acceptable. Any text string\n    // can be converted to UTF-8 bytes and encoded as a byte mode segment.\n    static makeBytes(data) {\n      let bb = [];\n      for (const b of data)\n        appendBits(b, 8, bb);\n      return new _QrSegment(_QrSegment.Mode.BYTE, data.length, bb);\n    }\n    // Returns a segment representing the given string of decimal digits encoded in numeric mode.\n    static makeNumeric(digits) {\n      if (!_QrSegment.isNumeric(digits))\n        throw new RangeError(\"String contains non-numeric characters\");\n      let bb = [];\n      for (let i = 0; i < digits.length; ) {\n        const n = Math.min(digits.length - i, 3);\n        appendBits(parseInt(digits.substring(i, i + n), 10), n * 3 + 1, bb);\n        i += n;\n      }\n      return new _QrSegment(_QrSegment.Mode.NUMERIC, digits.length, bb);\n    }\n    // Returns a segment representing the given text string encoded in alphanumeric mode.\n    // The characters allowed are: 0 to 9, A to Z (uppercase only), space,\n    // dollar, percent, asterisk, plus, hyphen, period, slash, colon.\n    static makeAlphanumeric(text) {\n      if (!_QrSegment.isAlphanumeric(text))\n        throw new RangeError(\"String contains unencodable characters in alphanumeric mode\");\n      let bb = [];\n      let i;\n      for (i = 0; i + 2 <= text.length; i += 2) {\n        let temp = _QrSegment.ALPHANUMERIC_CHARSET.indexOf(text.charAt(i)) * 45;\n        temp += _QrSegment.ALPHANUMERIC_CHARSET.indexOf(text.charAt(i + 1));\n        appendBits(temp, 11, bb);\n      }\n      if (i < text.length)\n        appendBits(_QrSegment.ALPHANUMERIC_CHARSET.indexOf(text.charAt(i)), 6, bb);\n      return new _QrSegment(_QrSegment.Mode.ALPHANUMERIC, text.length, bb);\n    }\n    // Returns a new mutable list of zero or more segments to represent the given Unicode text string.\n    // The result may use various segment modes and switch modes to optimize the length of the bit stream.\n    static makeSegments(text) {\n      if (text == \"\")\n        return [];\n      else if (_QrSegment.isNumeric(text))\n        return [_QrSegment.makeNumeric(text)];\n      else if (_QrSegment.isAlphanumeric(text))\n        return [_QrSegment.makeAlphanumeric(text)];\n      else\n        return [_QrSegment.makeBytes(_QrSegment.toUtf8ByteArray(text))];\n    }\n    // Returns a segment representing an Extended Channel Interpretation\n    // (ECI) designator with the given assignment value.\n    static makeEci(assignVal) {\n      let bb = [];\n      if (assignVal < 0)\n        throw new RangeError(\"ECI assignment value out of range\");\n      else if (assignVal < 1 << 7)\n        appendBits(assignVal, 8, bb);\n      else if (assignVal < 1 << 14) {\n        appendBits(2, 2, bb);\n        appendBits(assignVal, 14, bb);\n      } else if (assignVal < 1e6) {\n        appendBits(6, 3, bb);\n        appendBits(assignVal, 21, bb);\n      } else\n        throw new RangeError(\"ECI assignment value out of range\");\n      return new _QrSegment(_QrSegment.Mode.ECI, 0, bb);\n    }\n    // Tests whether the given string can be encoded as a segment in numeric mode.\n    // A string is encodable iff each character is in the range 0 to 9.\n    static isNumeric(text) {\n      return _QrSegment.NUMERIC_REGEX.test(text);\n    }\n    // Tests whether the given string can be encoded as a segment in alphanumeric mode.\n    // A string is encodable iff each character is in the following set: 0 to 9, A to Z\n    // (uppercase only), space, dollar, percent, asterisk, plus, hyphen, period, slash, colon.\n    static isAlphanumeric(text) {\n      return _QrSegment.ALPHANUMERIC_REGEX.test(text);\n    }\n    /*-- Methods --*/\n    // Returns a new copy of the data bits of this segment.\n    getData() {\n      return this.bitData.slice();\n    }\n    // (Package-private) Calculates and returns the number of bits needed to encode the given segments at\n    // the given version. The result is infinity if a segment has too many characters to fit its length field.\n    static getTotalBits(segs, version) {\n      let result = 0;\n      for (const seg of segs) {\n        const ccbits = seg.mode.numCharCountBits(version);\n        if (seg.numChars >= 1 << ccbits)\n          return Infinity;\n        result += 4 + ccbits + seg.bitData.length;\n      }\n      return result;\n    }\n    // Returns a new array of bytes representing the given string encoded in UTF-8.\n    static toUtf8ByteArray(str) {\n      str = encodeURI(str);\n      let result = [];\n      for (let i = 0; i < str.length; i++) {\n        if (str.charAt(i) != \"%\")\n          result.push(str.charCodeAt(i));\n        else {\n          result.push(parseInt(str.substring(i + 1, i + 3), 16));\n          i += 2;\n        }\n      }\n      return result;\n    }\n  };\n  /*-- Constants --*/\n  // Describes precisely all strings that are encodable in numeric mode.\n  _QrSegment.NUMERIC_REGEX = /^[0-9]*$/;\n  // Describes precisely all strings that are encodable in alphanumeric mode.\n  _QrSegment.ALPHANUMERIC_REGEX = /^[A-Z0-9 $%*+.\\/:-]*$/;\n  // The set of all legal characters in alphanumeric mode,\n  // where each character value maps to the index in the string.\n  _QrSegment.ALPHANUMERIC_CHARSET = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:\";\n  let QrSegment = _QrSegment;\n  qrcodegen2.QrSegment = _QrSegment;\n})(qrcodegen || (qrcodegen = {}));\n((qrcodegen2) => {\n  let QrCode;\n  ((QrCode2) => {\n    const _Ecc = class _Ecc {\n      // The QR Code can tolerate about 30% erroneous codewords\n      /*-- Constructor and fields --*/\n      constructor(ordinal, formatBits) {\n        this.ordinal = ordinal;\n        this.formatBits = formatBits;\n      }\n    };\n    /*-- Constants --*/\n    _Ecc.LOW = new _Ecc(0, 1);\n    // The QR Code can tolerate about  7% erroneous codewords\n    _Ecc.MEDIUM = new _Ecc(1, 0);\n    // The QR Code can tolerate about 15% erroneous codewords\n    _Ecc.QUARTILE = new _Ecc(2, 3);\n    // The QR Code can tolerate about 25% erroneous codewords\n    _Ecc.HIGH = new _Ecc(3, 2);\n    let Ecc = _Ecc;\n    QrCode2.Ecc = _Ecc;\n  })(QrCode = qrcodegen2.QrCode || (qrcodegen2.QrCode = {}));\n})(qrcodegen || (qrcodegen = {}));\n((qrcodegen2) => {\n  let QrSegment;\n  ((QrSegment2) => {\n    const _Mode = class _Mode {\n      /*-- Constructor and fields --*/\n      constructor(modeBits, numBitsCharCount) {\n        this.modeBits = modeBits;\n        this.numBitsCharCount = numBitsCharCount;\n      }\n      /*-- Method --*/\n      // (Package-private) Returns the bit width of the character count field for a segment in\n      // this mode in a QR Code at the given version number. The result is in the range [0, 16].\n      numCharCountBits(ver) {\n        return this.numBitsCharCount[Math.floor((ver + 7) / 17)];\n      }\n    };\n    /*-- Constants --*/\n    _Mode.NUMERIC = new _Mode(1, [10, 12, 14]);\n    _Mode.ALPHANUMERIC = new _Mode(2, [9, 11, 13]);\n    _Mode.BYTE = new _Mode(4, [8, 16, 16]);\n    _Mode.KANJI = new _Mode(8, [8, 10, 12]);\n    _Mode.ECI = new _Mode(7, [0, 0, 0]);\n    let Mode = _Mode;\n    QrSegment2.Mode = _Mode;\n  })(QrSegment = qrcodegen2.QrSegment || (qrcodegen2.QrSegment = {}));\n})(qrcodegen || (qrcodegen = {}));\nvar qrcodegen_default = qrcodegen;\n\n// src/index.tsx\n/**\n * @license qrcode.react\n * Copyright (c) Paul O'Shannessy\n * SPDX-License-Identifier: ISC\n */\nvar ERROR_LEVEL_MAP = {\n  L: qrcodegen_default.QrCode.Ecc.LOW,\n  M: qrcodegen_default.QrCode.Ecc.MEDIUM,\n  Q: qrcodegen_default.QrCode.Ecc.QUARTILE,\n  H: qrcodegen_default.QrCode.Ecc.HIGH\n};\nvar DEFAULT_SIZE = 128;\nvar DEFAULT_LEVEL = \"L\";\nvar DEFAULT_BGCOLOR = \"#FFFFFF\";\nvar DEFAULT_FGCOLOR = \"#000000\";\nvar DEFAULT_INCLUDEMARGIN = false;\nvar DEFAULT_MINVERSION = 1;\nvar SPEC_MARGIN_SIZE = 4;\nvar DEFAULT_MARGIN_SIZE = 0;\nvar DEFAULT_IMG_SCALE = 0.1;\nfunction generatePath(modules, margin = 0) {\n  const ops = [];\n  modules.forEach(function(row, y) {\n    let start = null;\n    row.forEach(function(cell, x) {\n      if (!cell && start !== null) {\n        ops.push(\n          `M${start + margin} ${y + margin}h${x - start}v1H${start + margin}z`\n        );\n        start = null;\n        return;\n      }\n      if (x === row.length - 1) {\n        if (!cell) {\n          return;\n        }\n        if (start === null) {\n          ops.push(`M${x + margin},${y + margin} h1v1H${x + margin}z`);\n        } else {\n          ops.push(\n            `M${start + margin},${y + margin} h${x + 1 - start}v1H${start + margin}z`\n          );\n        }\n        return;\n      }\n      if (cell && start === null) {\n        start = x;\n      }\n    });\n  });\n  return ops.join(\"\");\n}\nfunction excavateModules(modules, excavation) {\n  return modules.slice().map((row, y) => {\n    if (y < excavation.y || y >= excavation.y + excavation.h) {\n      return row;\n    }\n    return row.map((cell, x) => {\n      if (x < excavation.x || x >= excavation.x + excavation.w) {\n        return cell;\n      }\n      return false;\n    });\n  });\n}\nfunction getImageSettings(cells, size, margin, imageSettings) {\n  if (imageSettings == null) {\n    return null;\n  }\n  const numCells = cells.length + margin * 2;\n  const defaultSize = Math.floor(size * DEFAULT_IMG_SCALE);\n  const scale = numCells / size;\n  const w = (imageSettings.width || defaultSize) * scale;\n  const h = (imageSettings.height || defaultSize) * scale;\n  const x = imageSettings.x == null ? cells.length / 2 - w / 2 : imageSettings.x * scale;\n  const y = imageSettings.y == null ? cells.length / 2 - h / 2 : imageSettings.y * scale;\n  const opacity = imageSettings.opacity == null ? 1 : imageSettings.opacity;\n  let excavation = null;\n  if (imageSettings.excavate) {\n    let floorX = Math.floor(x);\n    let floorY = Math.floor(y);\n    let ceilW = Math.ceil(w + x - floorX);\n    let ceilH = Math.ceil(h + y - floorY);\n    excavation = { x: floorX, y: floorY, w: ceilW, h: ceilH };\n  }\n  const crossOrigin = imageSettings.crossOrigin;\n  return { x, y, h, w, excavation, opacity, crossOrigin };\n}\nfunction getMarginSize(includeMargin, marginSize) {\n  if (marginSize != null) {\n    return Math.max(Math.floor(marginSize), 0);\n  }\n  return includeMargin ? SPEC_MARGIN_SIZE : DEFAULT_MARGIN_SIZE;\n}\nfunction useQRCode({\n  value,\n  level,\n  minVersion,\n  includeMargin,\n  marginSize,\n  imageSettings,\n  size,\n  boostLevel\n}) {\n  let qrcode = React.useMemo(() => {\n    const values = Array.isArray(value) ? value : [value];\n    const segments = values.reduce((accum, v) => {\n      accum.push(...qrcodegen_default.QrSegment.makeSegments(v));\n      return accum;\n    }, []);\n    return qrcodegen_default.QrCode.encodeSegments(\n      segments,\n      ERROR_LEVEL_MAP[level],\n      minVersion,\n      void 0,\n      void 0,\n      boostLevel\n    );\n  }, [value, level, minVersion, boostLevel]);\n  const { cells, margin, numCells, calculatedImageSettings } = React.useMemo(() => {\n    let cells2 = qrcode.getModules();\n    const margin2 = getMarginSize(includeMargin, marginSize);\n    const numCells2 = cells2.length + margin2 * 2;\n    const calculatedImageSettings2 = getImageSettings(\n      cells2,\n      size,\n      margin2,\n      imageSettings\n    );\n    return {\n      cells: cells2,\n      margin: margin2,\n      numCells: numCells2,\n      calculatedImageSettings: calculatedImageSettings2\n    };\n  }, [qrcode, size, imageSettings, includeMargin, marginSize]);\n  return {\n    qrcode,\n    margin,\n    cells,\n    numCells,\n    calculatedImageSettings\n  };\n}\nvar SUPPORTS_PATH2D = function() {\n  try {\n    new Path2D().addPath(new Path2D());\n  } catch (e) {\n    return false;\n  }\n  return true;\n}();\nvar QRCodeCanvas = React.forwardRef(\n  function QRCodeCanvas2(props, forwardedRef) {\n    const _a = props, {\n      value,\n      size = DEFAULT_SIZE,\n      level = DEFAULT_LEVEL,\n      bgColor = DEFAULT_BGCOLOR,\n      fgColor = DEFAULT_FGCOLOR,\n      includeMargin = DEFAULT_INCLUDEMARGIN,\n      minVersion = DEFAULT_MINVERSION,\n      boostLevel,\n      marginSize,\n      imageSettings\n    } = _a, extraProps = __objRest(_a, [\n      \"value\",\n      \"size\",\n      \"level\",\n      \"bgColor\",\n      \"fgColor\",\n      \"includeMargin\",\n      \"minVersion\",\n      \"boostLevel\",\n      \"marginSize\",\n      \"imageSettings\"\n    ]);\n    const _b = extraProps, { style } = _b, otherProps = __objRest(_b, [\"style\"]);\n    const imgSrc = imageSettings == null ? void 0 : imageSettings.src;\n    const _canvas = React.useRef(null);\n    const _image = React.useRef(null);\n    const setCanvasRef = React.useCallback(\n      (node) => {\n        _canvas.current = node;\n        if (typeof forwardedRef === \"function\") {\n          forwardedRef(node);\n        } else if (forwardedRef) {\n          forwardedRef.current = node;\n        }\n      },\n      [forwardedRef]\n    );\n    const [isImgLoaded, setIsImageLoaded] = React.useState(false);\n    const { margin, cells, numCells, calculatedImageSettings } = useQRCode({\n      value,\n      level,\n      minVersion,\n      boostLevel,\n      includeMargin,\n      marginSize,\n      imageSettings,\n      size\n    });\n    React.useEffect(() => {\n      if (_canvas.current != null) {\n        const canvas = _canvas.current;\n        const ctx = canvas.getContext(\"2d\");\n        if (!ctx) {\n          return;\n        }\n        let cellsToDraw = cells;\n        const image = _image.current;\n        const haveImageToRender = calculatedImageSettings != null && image !== null && image.complete && image.naturalHeight !== 0 && image.naturalWidth !== 0;\n        if (haveImageToRender) {\n          if (calculatedImageSettings.excavation != null) {\n            cellsToDraw = excavateModules(\n              cells,\n              calculatedImageSettings.excavation\n            );\n          }\n        }\n        const pixelRatio = window.devicePixelRatio || 1;\n        canvas.height = canvas.width = size * pixelRatio;\n        const scale = size / numCells * pixelRatio;\n        ctx.scale(scale, scale);\n        ctx.fillStyle = bgColor;\n        ctx.fillRect(0, 0, numCells, numCells);\n        ctx.fillStyle = fgColor;\n        if (SUPPORTS_PATH2D) {\n          ctx.fill(new Path2D(generatePath(cellsToDraw, margin)));\n        } else {\n          cells.forEach(function(row, rdx) {\n            row.forEach(function(cell, cdx) {\n              if (cell) {\n                ctx.fillRect(cdx + margin, rdx + margin, 1, 1);\n              }\n            });\n          });\n        }\n        if (calculatedImageSettings) {\n          ctx.globalAlpha = calculatedImageSettings.opacity;\n        }\n        if (haveImageToRender) {\n          ctx.drawImage(\n            image,\n            calculatedImageSettings.x + margin,\n            calculatedImageSettings.y + margin,\n            calculatedImageSettings.w,\n            calculatedImageSettings.h\n          );\n        }\n      }\n    });\n    React.useEffect(() => {\n      setIsImageLoaded(false);\n    }, [imgSrc]);\n    const canvasStyle = __spreadValues({ height: size, width: size }, style);\n    let img = null;\n    if (imgSrc != null) {\n      img = /* @__PURE__ */ React.createElement(\n        \"img\",\n        {\n          src: imgSrc,\n          key: imgSrc,\n          style: { display: \"none\" },\n          onLoad: () => {\n            setIsImageLoaded(true);\n          },\n          ref: _image,\n          crossOrigin: calculatedImageSettings == null ? void 0 : calculatedImageSettings.crossOrigin\n        }\n      );\n    }\n    return /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement(\n      \"canvas\",\n      __spreadValues({\n        style: canvasStyle,\n        height: size,\n        width: size,\n        ref: setCanvasRef,\n        role: \"img\"\n      }, otherProps)\n    ), img);\n  }\n);\nQRCodeCanvas.displayName = \"QRCodeCanvas\";\nvar QRCodeSVG = React.forwardRef(\n  function QRCodeSVG2(props, forwardedRef) {\n    const _a = props, {\n      value,\n      size = DEFAULT_SIZE,\n      level = DEFAULT_LEVEL,\n      bgColor = DEFAULT_BGCOLOR,\n      fgColor = DEFAULT_FGCOLOR,\n      includeMargin = DEFAULT_INCLUDEMARGIN,\n      minVersion = DEFAULT_MINVERSION,\n      boostLevel,\n      title,\n      marginSize,\n      imageSettings\n    } = _a, otherProps = __objRest(_a, [\n      \"value\",\n      \"size\",\n      \"level\",\n      \"bgColor\",\n      \"fgColor\",\n      \"includeMargin\",\n      \"minVersion\",\n      \"boostLevel\",\n      \"title\",\n      \"marginSize\",\n      \"imageSettings\"\n    ]);\n    const { margin, cells, numCells, calculatedImageSettings } = useQRCode({\n      value,\n      level,\n      minVersion,\n      boostLevel,\n      includeMargin,\n      marginSize,\n      imageSettings,\n      size\n    });\n    let cellsToDraw = cells;\n    let image = null;\n    if (imageSettings != null && calculatedImageSettings != null) {\n      if (calculatedImageSettings.excavation != null) {\n        cellsToDraw = excavateModules(\n          cells,\n          calculatedImageSettings.excavation\n        );\n      }\n      image = /* @__PURE__ */ React.createElement(\n        \"image\",\n        {\n          href: imageSettings.src,\n          height: calculatedImageSettings.h,\n          width: calculatedImageSettings.w,\n          x: calculatedImageSettings.x + margin,\n          y: calculatedImageSettings.y + margin,\n          preserveAspectRatio: \"none\",\n          opacity: calculatedImageSettings.opacity,\n          crossOrigin: calculatedImageSettings.crossOrigin\n        }\n      );\n    }\n    const fgPath = generatePath(cellsToDraw, margin);\n    return /* @__PURE__ */ React.createElement(\n      \"svg\",\n      __spreadValues({\n        height: size,\n        width: size,\n        viewBox: `0 0 ${numCells} ${numCells}`,\n        ref: forwardedRef,\n        role: \"img\"\n      }, otherProps),\n      !!title && /* @__PURE__ */ React.createElement(\"title\", null, title),\n      /* @__PURE__ */ React.createElement(\n        \"path\",\n        {\n          fill: bgColor,\n          d: `M0,0 h${numCells}v${numCells}H0z`,\n          shapeRendering: \"crispEdges\"\n        }\n      ),\n      /* @__PURE__ */ React.createElement(\"path\", { fill: fgColor, d: fgPath, shapeRendering: \"crispEdges\" }),\n      image\n    );\n  }\n);\nQRCodeSVG.displayName = \"QRCodeSVG\";\nexport {\n  QRCodeCanvas,\n  QRCodeSVG\n};\n","import { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Calendar, Tag, Ticket, Clock, QrCode } from \"lucide-react\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { format } from \"date-fns\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\n\r\ninterface CouponDetailDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  coupon: any;\r\n}\r\n\r\nexport const CouponDetailDialog = ({ open, onOpenChange, coupon }: CouponDetailDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [showQrCode, setShowQrCode] = useState(false);\r\n  \r\n  const template = coupon.coupon_codes?.coupon_templates;\r\n  const code = coupon.coupon_codes?.code;\r\n  const isUsed = !!coupon.used_at;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(open) => {\r\n      onOpenChange(open);\r\n      if (!open) setShowQrCode(false);\r\n    }}>\r\n      <DialogContent className=\"max-w-lg max-h-[90vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Ticket className=\"w-5 h-5 text-primary\" />\r\n            {t(\"profile.coupons.details\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"max-h-[70vh] pr-4\">\r\n          <div className=\"space-y-4\">\r\n            {/*  */}\r\n            <div>\r\n              <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                <h3 className=\"text-xl font-bold text-foreground\">\r\n                  {getLocalizedField(template, \"title\")}\r\n                </h3>\r\n                <Badge variant={isUsed ? \"secondary\" : \"default\"}>\r\n                  {isUsed ? t(\"profile.coupons.used\") : t(\"profile.coupons.available\")}\r\n                </Badge>\r\n              </div>\r\n              \r\n              {template?.description_zh || template?.description_en || template?.description_pt ? (\r\n                <p className=\"text-muted-foreground text-sm\">\r\n                  {getLocalizedField(template, \"description\")}\r\n                </p>\r\n              ) : null}\r\n            </div>\r\n\r\n            <Separator />\r\n\r\n            {/*  */}\r\n            <div \r\n              className=\"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors\"\r\n              onClick={() => setShowQrCode(!showQrCode)}\r\n            >\r\n              <div className=\"flex flex-col items-center gap-3\">\r\n                {showQrCode ? (\r\n                  <>\r\n                    {/*  */}\r\n                    <div className=\"bg-white p-3 rounded-lg\">\r\n                      <QRCodeSVG\r\n                        value={code || \"\"}\r\n                        size={140}\r\n                        level=\"M\"\r\n                        includeMargin={false}\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {t(\"profile.coupons.tapToHideQr\")}\r\n                    </p>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    {/*  */}\r\n                    <p className=\"text-2xl font-mono font-bold tracking-wider\">\r\n                      {code}\r\n                    </p>\r\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n                      <QrCode className=\"w-4 h-4\" />\r\n                      <p className=\"text-xs\">\r\n                        {t(\"profile.coupons.tapToShowQr\")}\r\n                      </p>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center gap-2 p-3 bg-primary/10 rounded-lg\">\r\n              <Tag className=\"w-5 h-5 text-primary\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.discount\")}\r\n                </p>\r\n                <p className=\"text-xl font-bold text-primary\">\r\n                  {template?.discount_type === \"percentage\" \r\n                    ? `${template?.discount_value}% OFF` \r\n                    : `${template?.discount_value}`}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-start gap-3\">\r\n              <Clock className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.claimedAt\")}\r\n                </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {format(new Date(coupon.claimed_at), \"yyyy-MM-dd HH:mm\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            {isUsed && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Calendar className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.usedOn\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {format(new Date(coupon.used_at), \"yyyy-MM-dd HH:mm\")}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-start gap-3\">\r\n              <Calendar className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.validity\")}\r\n                </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {template?.valid_until \r\n                    ? `${format(new Date(template.valid_from), \"yyyy-MM-dd\")} - ${format(new Date(template.valid_until), \"yyyy-MM-dd\")}`\r\n                    : t(\"profile.coupons.noExpiry\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            {template?.min_order_amount && template.min_order_amount > 0 && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Tag className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.minOrder\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {template.min_order_amount}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  */}\r\n            {template?.max_discount_amount && template.max_discount_amount > 0 && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Tag className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.maxDiscount\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {template.max_discount_amount}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <Separator />\r\n\r\n            {/*  -  */}\r\n            {coupon.activity_id && coupon.source === \"share\" && (\r\n              <Link\r\n                to={`/activity/${coupon.activity_id}`}\r\n                className=\"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary\"\r\n              >\r\n                <Tag className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.source\")}: {t(\"profile.coupons.fromSharing\")}\r\n                </span>\r\n                <span className=\"text-xs text-muted-foreground\">\r\n                  ({t(\"profile.coupons.viewActivity\")})\r\n                </span>\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport interface BookingRecord {\r\n  id: string;\r\n  customer_email: string;\r\n  customer_name: string | null;\r\n  customer_phone: string | null;\r\n  restaurant_id: string | null;\r\n  restaurant_name: string;\r\n  booking_date: string;\r\n  booking_time: string;\r\n  party_size: number;\r\n  status: string;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  restaurants?: {\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n    image_url: string | null;\r\n  } | null;\r\n}\r\n\r\nexport interface DeliveryRecord {\r\n  id: string;\r\n  customer_email: string;\r\n  customer_name: string | null;\r\n  customer_phone: string | null;\r\n  restaurant_id: string | null;\r\n  restaurant_name: string;\r\n  order_date: string;\r\n  total_amount: number | null;\r\n  status: string;\r\n  delivery_address: string | null;\r\n  items: any[] | null;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  restaurants?: {\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n    image_url: string | null;\r\n  } | null;\r\n}\r\n\r\n// \r\nexport const useBookingRecords = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"bookingRecords\", user?.email],\r\n    queryFn: async () => {\r\n      if (!user?.email) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"booking_records\")\r\n        .select(`\r\n          *,\r\n          restaurants (\r\n            name,\r\n            name_en,\r\n            name_pt,\r\n            image_url\r\n          )\r\n        `)\r\n        .order(\"booking_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as BookingRecord[];\r\n    },\r\n    enabled: !!user?.email,\r\n  });\r\n};\r\n\r\n// \r\nexport const useDeliveryRecords = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"deliveryRecords\", user?.email],\r\n    queryFn: async () => {\r\n      if (!user?.email) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"delivery_records\")\r\n        .select(`\r\n          *,\r\n          restaurants (\r\n            name,\r\n            name_en,\r\n            name_pt,\r\n            image_url\r\n          )\r\n        `)\r\n        .order(\"order_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as DeliveryRecord[];\r\n    },\r\n    enabled: !!user?.email,\r\n  });\r\n};\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { format } from \"date-fns\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CalendarDays, Clock, Users, Store } from \"lucide-react\";\r\nimport { useBookingRecords } from \"@/hooks/useOrderRecords\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\nexport const BookingRecords = () => {\r\n  const { t } = useTranslation();\r\n  const { data: records, isLoading } = useBookingRecords();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case \"confirmed\":\r\n        return <Badge className=\"bg-green-500\">{t(\"booking.status.confirmed\")}</Badge>;\r\n      case \"pending\":\r\n        return <Badge variant=\"secondary\">{t(\"booking.status.pending\")}</Badge>;\r\n      case \"cancelled\":\r\n        return <Badge variant=\"destructive\">{t(\"booking.status.cancelled\")}</Badge>;\r\n      case \"completed\":\r\n        return <Badge className=\"bg-blue-500\">{t(\"booking.status.completed\")}</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n          <CalendarDays className=\"w-5 h-5\" />\r\n          {t(\"profile.bookingRecords.title\")}\r\n        </CardTitle>\r\n        <CardDescription className=\"text-xs\">\r\n          {t(\"profile.bookingRecords.description\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"px-3\">\r\n        {isLoading ? (\r\n          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n        ) : records && records.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {records.map((record) => {\r\n              const restaurantName = record.restaurants \r\n                ? getLocalizedField(record.restaurants, \"name\") \r\n                : record.restaurant_name;\r\n              \r\n              return (\r\n                <div\r\n                  key={record.id}\r\n                  className=\"p-3 rounded-lg border hover:shadow-medium transition-shadow\"\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                    <div className=\"flex-1\">\r\n                      {record.restaurant_id ? (\r\n                        <Link \r\n                          to={`/restaurant/${record.restaurant_id}`}\r\n                          className=\"font-semibold text-sm hover:text-primary transition-colors\"\r\n                        >\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </Link>\r\n                      ) : (\r\n                        <span className=\"font-semibold text-sm\">\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {getStatusBadge(record.status)}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <CalendarDays className=\"w-3 h-3\" />\r\n                      {format(new Date(record.booking_date), \"yyyy-MM-dd\")}\r\n                    </span>\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <Clock className=\"w-3 h-3\" />\r\n                      {record.booking_time.slice(0, 5)}\r\n                    </span>\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <Users className=\"w-3 h-3\" />\r\n                      {record.party_size} {t(\"booking.people\")}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  {record.notes && (\r\n                    <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\r\n                      {record.notes}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n            {t(\"profile.bookingRecords.noRecords\")}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { format } from \"date-fns\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Truck, Store, MapPin } from \"lucide-react\";\r\nimport { useDeliveryRecords } from \"@/hooks/useOrderRecords\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\nexport const DeliveryRecords = () => {\r\n  const { t } = useTranslation();\r\n  const { data: records, isLoading } = useDeliveryRecords();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case \"completed\":\r\n        return <Badge className=\"bg-green-500\">{t(\"delivery.status.completed\")}</Badge>;\r\n      case \"pending\":\r\n        return <Badge variant=\"secondary\">{t(\"delivery.status.pending\")}</Badge>;\r\n      case \"cancelled\":\r\n        return <Badge variant=\"destructive\">{t(\"delivery.status.cancelled\")}</Badge>;\r\n      case \"delivering\":\r\n        return <Badge className=\"bg-blue-500\">{t(\"delivery.status.delivering\")}</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n          <Truck className=\"w-5 h-5\" />\r\n          {t(\"profile.deliveryRecords.title\")}\r\n        </CardTitle>\r\n        <CardDescription className=\"text-xs\">\r\n          {t(\"profile.deliveryRecords.description\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"px-3\">\r\n        {isLoading ? (\r\n          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n        ) : records && records.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {records.map((record) => {\r\n              const restaurantName = record.restaurants \r\n                ? getLocalizedField(record.restaurants, \"name\") \r\n                : record.restaurant_name;\r\n              \r\n              return (\r\n                <div\r\n                  key={record.id}\r\n                  className=\"p-3 rounded-lg border hover:shadow-medium transition-shadow\"\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                    <div className=\"flex-1\">\r\n                      {record.restaurant_id ? (\r\n                        <Link \r\n                          to={`/restaurant/${record.restaurant_id}`}\r\n                          className=\"font-semibold text-sm hover:text-primary transition-colors\"\r\n                        >\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </Link>\r\n                      ) : (\r\n                        <span className=\"font-semibold text-sm\">\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {getStatusBadge(record.status)}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2\">\r\n                    <span>\r\n                      {format(new Date(record.order_date), \"yyyy-MM-dd HH:mm\")}\r\n                    </span>\r\n                    {record.total_amount && (\r\n                      <span className=\"font-medium text-foreground\">\r\n                        {record.total_amount.toFixed(2)}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {record.delivery_address && (\r\n                    <p className=\"text-xs text-muted-foreground flex items-start gap-1\">\r\n                      <MapPin className=\"w-3 h-3 mt-0.5 flex-shrink-0\" />\r\n                      <span className=\"line-clamp-1\">{record.delivery_address}</span>\r\n                    </p>\r\n                  )}\r\n                  \r\n                  {record.notes && (\r\n                    <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\r\n                      {record.notes}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n            {t(\"profile.deliveryRecords.noRecords\")}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n","import { Link } from \"react-router-dom\";\r\nimport { ActivityFavoriteDialog } from \"@/components/ActivityFavoriteDialog\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { memo, useState, useEffect, useCallback } from \"react\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Carousel, CarouselContent, CarouselItem, CarouselApi } from \"@/components/ui/carousel\";\r\nimport { Heart, Star, Calendar, MessageSquare, Store, Users, MapPin, User, Ticket, Coins, History, ShoppingBag, AlertCircle, Clock } from \"lucide-react\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useFavorites } from \"@/hooks/useFavorites\";\r\nimport { useUserComments } from \"@/hooks/useUserComments\";\r\nimport { useSubscriptions } from \"@/hooks/useActivities\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useMerchantActivities } from \"@/hooks/useMerchantActivities\";\r\nimport { useUserCoupons } from \"@/hooks/useCoupons\";\r\nimport EditProfileDialog from \"@/components/EditProfileDialog\";\r\nimport AddressManagement from \"@/components/AddressManagement\";\r\nimport ActivityTermsAgreement from \"@/components/ActivityTermsAgreement\";\r\nimport { CouponDetailDialog } from \"@/components/CouponDetailDialog\";\r\nimport { PointsHistoryDialog } from \"@/components/PointsHistoryDialog\";\r\nimport { BookingRecords } from \"@/components/BookingRecords\";\r\nimport { DeliveryRecords } from \"@/components/DeliveryRecords\";\r\nimport { formatDistanceToNow, format } from \"date-fns\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\n\r\n// Memoized Comment Item Component\r\nconst CommentItem = memo(({ \r\n  comment, \r\n  getLocalizedField,\r\n  t\r\n}: { \r\n  comment: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: any;\r\n}) => {\r\n  const isFailed = comment.moderation_status === \"flagged\";\r\n  const isPending = comment.moderation_status === \"pending\";\r\n  \r\n  // Parse risk reasons with localized labels\r\n  const getRiskReasonText = () => {\r\n    if (!comment.risk_reasons || !Array.isArray(comment.risk_reasons)) return null;\r\n    \r\n    const labels: Record<string, string> = {\r\n      spam: t(\"riskReason.spam\", \"\"),\r\n      offensive: t(\"riskReason.offensive\", \"\"),\r\n      harassment: t(\"riskReason.harassment\", \"\"),\r\n      fake_review: t(\"riskReason.fakeReview\", \"\"),\r\n      flooding: t(\"riskReason.flooding\", \"\"),\r\n      irrelevant: t(\"riskReason.irrelevant\", \"\"),\r\n      sensitive_word_detected: t(\"riskReason.sensitiveWord\", \"\"),\r\n      parse_error: t(\"riskReason.parseError\", \"\"),\r\n    };\r\n    \r\n    return comment.risk_reasons.map((reason: string) => labels[reason] || reason).join(\", \");\r\n  };\r\n  \r\n  return (\r\n    <div className=\"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow\">\r\n      <Link\r\n        to={`/${comment.target_type}/${comment.target_id}`}\r\n        className=\"block\"\r\n      >\r\n        <div className=\"flex items-start justify-between mb-2 gap-2\">\r\n          <h3 className=\"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1\">\r\n            {getLocalizedField(comment, \"target_name\")}\r\n          </h3>\r\n          <span className=\"text-xs md:text-sm text-muted-foreground whitespace-nowrap\">\r\n            {formatDistanceToNow(new Date(comment.created_at), {\r\n              addSuffix: true,\r\n            })}\r\n          </span>\r\n        </div>\r\n        <p className=\"text-muted-foreground line-clamp-2 text-sm md:text-base\">{comment.content}</p>\r\n        {comment.image_url && (\r\n          <img\r\n            src={comment.image_url}\r\n            alt=\"Comment\"\r\n            className=\"mt-2 rounded-lg max-w-full md:max-w-xs\"\r\n            loading=\"lazy\"\r\n          />\r\n        )}\r\n      </Link>\r\n      \r\n      {/* Status badges */}\r\n      {isPending && (\r\n        <div className=\"mt-2 flex items-center gap-2\">\r\n          <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            {t(\"restaurant.commentPending\", \"\")}\r\n          </Badge>\r\n        </div>\r\n      )}\r\n      \r\n      {isFailed && (\r\n        <div className=\"mt-2 space-y-1.5\">\r\n          <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs\">\r\n            <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"restaurant.commentFailed\", \"\")}\r\n          </Badge>\r\n          {getRiskReasonText() && (\r\n            <p className=\"text-xs text-destructive/80 pl-0.5\">\r\n              {t(\"restaurant.failReason\", \"\")}: {getRiskReasonText()}\r\n            </p>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCommentItem.displayName = \"CommentItem\";\r\n\r\n// Memoized Favorite Restaurant Item Component\r\nconst FavoriteRestaurantItem = memo(({ \r\n  restaurant, \r\n  getLocalizedField,\r\n  t\r\n}: { \r\n  restaurant: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n}) => {\r\n  // Skip rendering if restaurant is invalid\r\n  if (!restaurant || !restaurant.id) {\r\n    return null;\r\n  }\r\n  \r\n  const restaurantName = getLocalizedField(restaurant, \"name\") || restaurant.name || \"\";\r\n  const restaurantType = Array.isArray(restaurant.type) \r\n    ? restaurant.type.join(\"  \") \r\n    : (restaurant.type || \"\");\r\n  \r\n  return (\r\n    <Link\r\n      to={`/restaurant/${restaurant.id}`}\r\n      state={{ from: \"profile\" }}\r\n      className=\"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow\"\r\n    >\r\n      <div className=\"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0\">\r\n        <img\r\n          src={restaurant.image_url || \"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80\"}\r\n          alt={String(restaurantName)}\r\n          className=\"w-full h-full object-cover\"\r\n          loading=\"lazy\"\r\n          onError={(e) => {\r\n            e.currentTarget.src = \"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80\";\r\n          }}\r\n        />\r\n      </div>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <h3 className=\"font-semibold text-base md:text-lg text-card-foreground line-clamp-1\">\r\n          {restaurantName}\r\n        </h3>\r\n        <p className=\"text-muted-foreground text-sm mb-2 line-clamp-1\">\r\n          {restaurantType}\r\n        </p>\r\n        <div className=\"flex items-center gap-1\">\r\n          <Star className={`w-4 h-4 ${restaurant.rating ? \"fill-accent text-accent\" : \"text-muted-foreground\"}`} />\r\n          {restaurant.rating ? (\r\n            <span className=\"font-medium\">{restaurant.rating.toFixed(1)}</span>\r\n          ) : (\r\n            <span className=\"text-xs text-muted-foreground text-center whitespace-nowrap\">\r\n              {t(\"restaurant.noRatingLine1\")}<br />{t(\"restaurant.noRatingLine2\")}\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </Link>\r\n  );\r\n});\r\nFavoriteRestaurantItem.displayName = \"FavoriteRestaurantItem\";\r\n\r\n// Memoized Activity Subscription Item Component\r\nconst ActivitySubscriptionItem = memo(({ \r\n  subscription, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  subscription: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  \r\n  return (\r\n    <>\r\n      <div\r\n        onClick={() => setDialogOpen(true)}\r\n        className={`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${isMobile ? \"p-3\" : \"p-4\"}`}\r\n      >\r\n        <div className={`flex items-start ${isMobile ? \"gap-3\" : \"gap-4\"}`}>\r\n          {subscription.activity?.image_url && (\r\n            <img\r\n              src={subscription.activity.image_url}\r\n              alt={String(getLocalizedField(subscription.activity, \"title\"))}\r\n              className={`rounded-lg object-cover flex-shrink-0 ${isMobile ? \"w-20 h-20\" : \"w-24 h-24\"}`}\r\n              loading=\"lazy\"\r\n            />\r\n          )}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n              {getLocalizedField(subscription.activity, \"title\")}\r\n            </h3>\r\n            <div \r\n              className={`text-muted-foreground line-clamp-2 prose max-w-none ${isMobile ? \"text-xs prose-xs\" : \"text-sm prose-sm\"}`}\r\n              dangerouslySetInnerHTML={{ \r\n                __html: getLocalizedField(subscription.activity, \"content\") \r\n              }}\r\n            />\r\n            <p className={`text-muted-foreground mt-2 ${isMobile ? \"text-xs\" : \"text-xs\"}`}>\r\n              {t(\"profile.joinedOn\")}:{\" \"}\r\n              {formatDistanceToNow(new Date(subscription.created_at), {\r\n                addSuffix: true,\r\n              })}\r\n            </p>\r\n          </div>\r\n          <Heart className={`text-primary fill-primary flex-shrink-0 ${isMobile ? \"w-4 h-4\" : \"w-5 h-5\"}`} />\r\n        </div>\r\n      </div>\r\n      \r\n      <ActivityFavoriteDialog\r\n        open={dialogOpen}\r\n        onOpenChange={setDialogOpen}\r\n        activity={{\r\n          title: String(getLocalizedField(subscription.activity, \"title\")),\r\n          image_url: subscription.activity?.image_url,\r\n          content: String(getLocalizedField(subscription.activity, \"content\")),\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n});\r\nActivitySubscriptionItem.displayName = \"ActivitySubscriptionItem\";\r\n\r\n// Memoized Merchant Activity Participation Item - grouped by activity\r\nconst MerchantActivityItem = memo(({ \r\n  activityGroup, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  activityGroup: {\r\n    activity: any;\r\n    restaurants: Array<{\r\n      id: string;\r\n      name: string;\r\n      name_en: string | null;\r\n      name_pt: string | null;\r\n    }>;\r\n    participationDate: string;\r\n  };\r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const activity = activityGroup.activity;\r\n  const restaurants = activityGroup.restaurants;\r\n  \r\n  return (\r\n    <div className={`rounded-lg border hover:shadow-medium transition-shadow ${isMobile ? \"p-3\" : \"p-4\"}`}>\r\n      <Link\r\n        to={`/activity/${activity.id}`}\r\n        className={isMobile ? \"block mb-2\" : \"block mb-3\"}\r\n      >\r\n        <div className={`flex items-start ${isMobile ? \"gap-3\" : \"gap-4\"}`}>\r\n          {activity.image_url && (\r\n            <img\r\n              src={activity.image_url}\r\n              alt={String(getLocalizedField(activity, \"title\"))}\r\n              className={`rounded-lg object-cover flex-shrink-0 ${isMobile ? \"w-20 h-20\" : \"w-24 h-24\"}`}\r\n              loading=\"lazy\"\r\n            />\r\n          )}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n              {getLocalizedField(activity, \"title\")}\r\n            </h3>\r\n            <div \r\n              className={`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${isMobile ? \"text-xs prose-xs\" : \"text-sm prose-sm\"}`}\r\n              dangerouslySetInnerHTML={{ \r\n                __html: getLocalizedField(activity, \"content\") \r\n              }}\r\n            />\r\n            <div className=\"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap\">\r\n              <span className=\"flex items-center gap-1\">\r\n                <Calendar className=\"w-3 h-3\" />\r\n                {new Date(activity.start_date).toLocaleDateString()}\r\n              </span>\r\n              {activity.end_date && (\r\n                <span>\r\n                  - {new Date(activity.end_date).toLocaleDateString()}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Link>\r\n      \r\n      {/* Participating restaurants list */}\r\n      <div className={`pt-2 md:pt-3 border-t ${isMobile ? \"mt-2\" : \"mt-3\"}`}>\r\n        <div className={`flex items-center gap-2 ${isMobile ? \"mb-1.5\" : \"mb-2\"}`}>\r\n          <Store className={`text-primary ${isMobile ? \"w-3.5 h-3.5\" : \"w-4 h-4\"}`} />\r\n          <span className={`font-medium text-foreground ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n            {t(\"profile.participatingRestaurants\")} ({restaurants.length})\r\n          </span>\r\n        </div>\r\n        <div className={`flex flex-wrap ${isMobile ? \"gap-1.5\" : \"gap-2\"}`}>\r\n          {restaurants.map((restaurant) => (\r\n            <Badge \r\n              key={restaurant.id}\r\n              variant=\"secondary\"\r\n              className={isMobile ? \"text-xs px-2 py-0.5\" : \"text-xs\"}\r\n            >\r\n              {getLocalizedField(restaurant, \"name\")}\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nMerchantActivityItem.displayName = \"MerchantActivityItem\";\r\n\r\n// Memoized User Coupon Item Component\r\nconst UserCouponItem = memo(({ \r\n  coupon, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  coupon: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const [detailsOpen, setDetailsOpen] = useState(false);\r\n  const template = coupon.coupon_codes?.coupon_templates;\r\n  const code = coupon.coupon_codes?.code;\r\n  const isUsed = !!coupon.used_at;\r\n  \r\n  return (\r\n    <>\r\n      <div \r\n        className={`rounded-lg border transition-shadow cursor-pointer ${\r\n          isUsed ? 'bg-muted/30' : 'hover:shadow-medium'\r\n        } ${isMobile ? \"p-3\" : \"p-4\"}`}\r\n        onClick={() => setDetailsOpen(true)}\r\n      >\r\n        <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n          <div className=\"flex-1\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"text-base\"}`}>\r\n              {getLocalizedField(template, \"title\")}\r\n            </h3>\r\n            <p className={`text-muted-foreground line-clamp-2 ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n              {getLocalizedField(template, \"description\")}\r\n            </p>\r\n          </div>\r\n          <Badge variant={isUsed ? \"secondary\" : \"default\"} className={isMobile ? \"text-xs\" : \"\"}>\r\n            {isUsed ? t(\"profile.coupons.used\") : t(\"profile.coupons.available\")}\r\n          </Badge>\r\n        </div>\r\n        \r\n        <div className={`flex items-center gap-2 mb-2 ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n          <span className=\"font-mono bg-secondary/50 px-2 py-1 rounded\">\r\n            {code}\r\n          </span>\r\n          <span className=\"text-muted-foreground\">\r\n            {template?.discount_type === \"percentage\" \r\n              ? `${template?.discount_value}%` \r\n              : `${template?.discount_value}`}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className={`text-muted-foreground ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n          {isUsed ? (\r\n            <span>{t(\"profile.coupons.usedOn\")}: {format(new Date(coupon.used_at), \"yyyy-MM-dd HH:mm\")}</span>\r\n          ) : template?.valid_until ? (\r\n            <span>{t(\"profile.coupons.validUntil\")}: {format(new Date(template.valid_until), \"yyyy-MM-dd\")}</span>\r\n          ) : (\r\n            <span>{t(\"profile.coupons.noExpiry\")}</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      <CouponDetailDialog \r\n        open={detailsOpen}\r\n        onOpenChange={setDetailsOpen}\r\n        coupon={coupon}\r\n      />\r\n    </>\r\n  );\r\n});\r\nUserCouponItem.displayName = \"UserCouponItem\";\r\n\r\nconst Profile = () => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const isMobile = useIsMobile();\r\n  const { data: profile, isLoading: profileLoading } = useProfile();\r\n  const { data: favorites, isLoading: favoritesLoading } = useFavorites();\r\n  const { data: comments, isLoading: commentsLoading } = useUserComments();\r\n  const { data: subscriptions, isLoading: subscriptionsLoading } = useSubscriptions();\r\n  const { data: merchantActivities, isLoading: merchantActivitiesLoading } = useMerchantActivities();\r\n  const { data: userCoupons, isLoading: couponsLoading } = useUserCoupons();\r\n  const { role, isMerchant, isSupervisor } = useUserRole();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  const isMerchantOrSupervisor = isMerchant || isSupervisor;\r\n  \r\n  // Mobile tab state\r\n  const [activeTab, setActiveTab] = useState(\"profile\");\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [scrollPositions, setScrollPositions] = useState<Record<string, number>>({});\r\n  const [visitedTabs, setVisitedTabs] = useState<Set<string>>(new Set([\"profile\"]));\r\n  \r\n  const tabs = isMerchantOrSupervisor ? [\r\n    { value: \"profile\", label: t(\"profile.profile\"), icon: User },\r\n    { value: \"favorites\", label: t(\"profile.favorites\"), icon: Heart },\r\n    { value: \"comments\", label: t(\"profile.comments\"), icon: MessageSquare },\r\n    { value: \"activities\", label: t(\"profile.participatedActivities\"), icon: Calendar },\r\n  ] : [\r\n    { value: \"profile\", label: t(\"profile.profile\"), icon: User },\r\n    { value: \"favorites\", label: t(\"profile.favorites\"), icon: Heart },\r\n    { value: \"comments\", label: t(\"profile.comments\"), icon: MessageSquare },\r\n  ];\r\n\r\n  // Save current scroll position\r\n  const saveScrollPosition = (tabValue: string) => {\r\n    setScrollPositions(prev => ({\r\n      ...prev,\r\n      [tabValue]: window.scrollY\r\n    }));\r\n  };\r\n\r\n  // Restore scroll position or scroll to top for new tabs\r\n  const restoreScrollPosition = (tabValue: string) => {\r\n    if (visitedTabs.has(tabValue)) {\r\n      // Restore previous position\r\n      const savedPosition = scrollPositions[tabValue] || 0;\r\n      setTimeout(() => window.scrollTo(0, savedPosition), 0);\r\n    } else {\r\n      // New tab, scroll to top\r\n      setTimeout(() => window.scrollTo(0, 0), 0);\r\n      setVisitedTabs(prev => new Set([...prev, tabValue]));\r\n    }\r\n  };\r\n\r\n  // Sync carousel with active tab\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    const handleSelect = () => {\r\n      const index = carouselApi.selectedScrollSnap();\r\n      const newTab = tabs[index].value;\r\n      \r\n      if (newTab !== activeTab) {\r\n        // Save current tab's scroll position before switching\r\n        saveScrollPosition(activeTab);\r\n        // Restore new tab's scroll position\r\n        restoreScrollPosition(newTab);\r\n        setActiveTab(newTab);\r\n      }\r\n    };\r\n    \r\n    carouselApi.on(\"select\", handleSelect);\r\n    return () => {\r\n      carouselApi.off(\"select\", handleSelect);\r\n    };\r\n  }, [carouselApi, activeTab, scrollPositions, visitedTabs]);\r\n\r\n  const handleTabClick = (tabValue: string) => {\r\n    if (tabValue === activeTab) return;\r\n    \r\n    // Save current tab's scroll position\r\n    saveScrollPosition(activeTab);\r\n    \r\n    const index = tabs.findIndex(t => t.value === tabValue);\r\n    if (index !== -1 && carouselApi) {\r\n      carouselApi.scrollTo(index);\r\n    }\r\n    \r\n    // Restore new tab's scroll position\r\n    restoreScrollPosition(tabValue);\r\n    setActiveTab(tabValue);\r\n  };\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['profile'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['favorites'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-comments'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['subscriptions'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-coupons'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  if (!user || profileLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4\">\r\n        <div className=\"container mx-auto max-w-6xl\">\r\n          <div className=\"text-center\">{t(\"common.loading\")}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const roleDisplay = role ? t(`profile.role.${role}`) : t(\"profile.role.user\");\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n    <div className={`min-h-screen bg-secondary/20 ${isMobile ? \"pb-20 pt-4\" : \"py-4 md:py-8 px-3 md:px-4\"}`}>\r\n      <div className={`container mx-auto max-w-6xl ${isMobile ? \"px-3\" : \"\"}`}>\r\n        {/* Desktop/Tablet: Profile Header */}\r\n        {!isMobile && (\r\n          <>\r\n            <Card className=\"mb-6 md:mb-8\">\r\n            <CardContent className=\"pt-4 md:pt-6 pb-4 md:pb-6\">\r\n              <div className=\"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6\">\r\n                <Avatar className=\"w-24 h-24\">\r\n                  <AvatarImage src={profile?.avatar_url || \"\"} />\r\n                  <AvatarFallback className=\"text-3xl\">\r\n                    {profile?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n                  </AvatarFallback>\r\n                </Avatar>\r\n                <div className=\"flex-1 text-center md:text-left\">\r\n                  <h1 className=\"text-3xl font-bold mb-2 text-foreground\">\r\n                    {profile?.display_name}\r\n                  </h1>\r\n                  <p className=\"text-muted-foreground mb-2 md:mb-3\">\r\n                    {user.email}\r\n                  </p>\r\n                  {profile?.phone && (\r\n                    <p className=\"text-muted-foreground mb-2 md:mb-3\">\r\n                      {profile.phone}\r\n                    </p>\r\n                  )}\r\n                  {role && role !== 'user' && (\r\n                    <Badge className=\"bg-primary capitalize\">\r\n                      {roleDisplay}\r\n                    </Badge>\r\n                  )}\r\n                  {/* Points display */}\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    <Coins className=\"h-5 w-5 text-amber-500\" />\r\n                    <span className=\"font-semibold text-lg\">{profile?.points || 0}</span>\r\n                    <span className=\"text-muted-foreground\">{t(\"profile.points\", \"\")}</span>\r\n                    <PointsHistoryDialog />\r\n                  </div>\r\n                </div>\r\n                {/* Buttons container - horizontal layout */}\r\n                <div className=\"flex flex-col sm:flex-row gap-2 items-start\">\r\n                  {profile && <EditProfileDialog profile={profile} />}\r\n                  {/* Activity Terms Agreement for merchants/supervisors - Desktop */}\r\n                  {isMerchantOrSupervisor && profile && (\r\n                    <ActivityTermsAgreement \r\n                      isAgreed={profile?.activity_terms_agreed || false}\r\n                      agreedAt={profile?.activity_terms_agreed_at || null}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          </>\r\n        )}\r\n\r\n        {/* Tabs */}\r\n        {isMobile ? (\r\n          <>\r\n            {/* Mobile: Swipeable content carousel */}\r\n            <Carousel \r\n              setApi={setCarouselApi}\r\n              opts={{\r\n                align: \"start\",\r\n                loop: false,\r\n              }}\r\n              className=\"w-full\"\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {/* Profile Tab */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4 space-y-4\">\r\n                    <Card>\r\n                      <CardContent className=\"pt-6 pb-6\">\r\n                        <div className=\"flex flex-col items-center gap-4\">\r\n                          <Avatar className=\"w-20 h-20\">\r\n                            <AvatarImage src={profile?.avatar_url || \"\"} />\r\n                            <AvatarFallback className=\"text-2xl\">\r\n                              {profile?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n                            </AvatarFallback>\r\n                          </Avatar>\r\n                          <div className=\"flex-1 text-center w-full\">\r\n                            <h1 className=\"text-2xl font-bold mb-2 text-foreground\">\r\n                              {profile?.display_name}\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground text-sm mb-2\">\r\n                              {user.email}\r\n                            </p>\r\n                            {/* Mobile Points display */}\r\n                            <div className=\"flex items-center justify-center gap-2 mb-2\">\r\n                              <Coins className=\"h-4 w-4 text-amber-500\" />\r\n                              <span className=\"font-semibold\">{profile?.points || 0}</span>\r\n                              <span className=\"text-muted-foreground text-sm\">{t(\"profile.points\", \"\")}</span>\r\n                              <PointsHistoryDialog />\r\n                            </div>\r\n                            {profile?.phone && (\r\n                              <p className=\"text-muted-foreground text-sm mb-3\">\r\n                                {profile.phone}\r\n                              </p>\r\n                            )}\r\n                            {role && role !== 'user' && (\r\n                              <Badge className=\"bg-primary capitalize text-xs mb-4\">\r\n                                {roleDisplay}\r\n                              </Badge>\r\n                            )}\r\n                            {profile && (\r\n                              <div className=\"mt-4 flex flex-col sm:flex-row gap-2 w-full\">\r\n                                <EditProfileDialog profile={profile} />\r\n                                {/* Activity Terms Agreement for merchants/supervisors - Mobile */}\r\n                                {isMerchantOrSupervisor && (\r\n                                  <ActivityTermsAgreement \r\n                                    isAgreed={profile?.activity_terms_agreed || false}\r\n                                    agreedAt={profile?.activity_terms_agreed_at || null}\r\n                                  />\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </CardContent>\r\n                    </Card>\r\n                    \r\n                    {/* My Coupons Section */}\r\n                    <Card>\r\n                      <CardHeader className=\"pb-3\">\r\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                          <Ticket className=\"w-5 h-5\" />\r\n                          {t(\"profile.coupons.title\")}\r\n                        </CardTitle>\r\n                        <CardDescription className=\"text-xs\">{t(\"profile.coupons.description\")}</CardDescription>\r\n                      </CardHeader>\r\n                      <CardContent className=\"px-3\">\r\n                        {couponsLoading ? (\r\n                          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                        ) : userCoupons && userCoupons.length > 0 ? (\r\n                          <div className=\"space-y-3\">\r\n                            {userCoupons.map((coupon) => (\r\n                              <UserCouponItem\r\n                                key={coupon.id}\r\n                                coupon={coupon}\r\n                                getLocalizedField={getLocalizedField}\r\n                                t={t}\r\n                                isMobile={true}\r\n                              />\r\n                            ))}\r\n                          </div>\r\n                        ) : (\r\n                          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                            {t(\"profile.coupons.noCoupons\")}{\" \"}\r\n                            <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                              {t(\"profile.coupons.browseActivities\")}\r\n                            </Link>\r\n                          </p>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                    \r\n                    {/* My Addresses Section - without title */}\r\n                    <AddressManagement />\r\n                    \r\n                    {/* Booking Records Section */}\r\n                    <BookingRecords />\r\n                    \r\n                    {/* Delivery Records Section */}\r\n                    <DeliveryRecords />\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Favorites Tab */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4\">\r\n                    <Card>\r\n                      <CardContent className=\"pt-4\">\r\n                        <Tabs defaultValue=\"restaurants\" className=\"w-full\">\r\n                          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\r\n                            <TabsTrigger value=\"restaurants\" className=\"flex items-center gap-2 text-xs\">\r\n                              <Store className=\"w-4 h-4\" />\r\n                              {t(\"profile.restaurantFavorites\")}\r\n                              {favorites && favorites.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {favorites.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"activities\" className=\"flex items-center gap-2 text-xs\">\r\n                              <Calendar className=\"w-4 h-4\" />\r\n                              {t(\"profile.activityFavorites\")}\r\n                              {subscriptions && subscriptions.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {subscriptions.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                          </TabsList>\r\n                          \r\n                          <TabsContent value=\"restaurants\">\r\n                            {favoritesLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : favorites && favorites.length > 0 ? (\r\n                              <div className=\"grid gap-3 grid-cols-1\">\r\n                                {favorites.map((restaurant) => (\r\n                                  <FavoriteRestaurantItem\r\n                                    key={restaurant.id}\r\n                                    restaurant={restaurant}\r\n                                    getLocalizedField={getLocalizedField}\r\n                                    t={t}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">{t(\"profile.noFavorites\")}</p>\r\n                            )}\r\n                          </TabsContent>\r\n                          \r\n                          <TabsContent value=\"activities\">\r\n                            {subscriptionsLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : subscriptions && subscriptions.length > 0 ? (\r\n                              <div className=\"space-y-3\">\r\n                                {subscriptions.map((subscription) => (\r\n                                  <ActivitySubscriptionItem\r\n                                    key={subscription.id}\r\n                                    subscription={subscription}\r\n                                    getLocalizedField={getLocalizedField}\r\n                                    t={t}\r\n                                    isMobile={true}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                                {t(\"profile.noActivityFavorites\")}{\" \"}\r\n                                <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                                  {t(\"profile.browseActivities\")}\r\n                                </Link>\r\n                              </p>\r\n                            )}\r\n                          </TabsContent>\r\n                        </Tabs>\r\n                      </CardContent>\r\n                    </Card>\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Comments Tab */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4\">\r\n                    <Card>\r\n                      <CardHeader className=\"pb-3\">\r\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                          <MessageSquare className=\"w-5 h-5\" />\r\n                          {t(\"profile.myComments\")}\r\n                        </CardTitle>\r\n                        <CardDescription className=\"text-xs\">{t(\"profile.commentsDesc\")}</CardDescription>\r\n                      </CardHeader>\r\n                      <CardContent className=\"space-y-3 px-3\">\r\n                        {commentsLoading ? (\r\n                          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                        ) : comments && comments.length > 0 ? (\r\n                          comments.map((comment) => (\r\n                            <CommentItem\r\n                              key={comment.id}\r\n                              comment={comment}\r\n                              getLocalizedField={getLocalizedField}\r\n                              t={t}\r\n                            />\r\n                          ))\r\n                        ) : (\r\n                          <p className=\"text-muted-foreground text-center py-8 text-sm\">{t(\"profile.noComments\")}</p>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Activities Tab - Only for merchants/supervisors */}\r\n                {isMerchantOrSupervisor && (\r\n                  <CarouselItem className=\"pl-0\">\r\n                    <div className=\"pb-4\">\r\n                      <Card>\r\n                        <CardHeader className=\"pb-3\">\r\n                          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                            <Calendar className=\"w-5 h-5\" />\r\n                            {t(\"profile.participatedActivities\")}\r\n                          </CardTitle>\r\n                          <CardDescription className=\"text-xs\">\r\n                            {t(\"profile.participatedActivitiesDesc\")}\r\n                          </CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"px-3\">\r\n                          <div className=\"space-y-4\">\r\n                            {merchantActivitiesLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : merchantActivities && merchantActivities.length > 0 ? (\r\n                              <div>\r\n                                <h3 className=\"font-semibold mb-3 flex items-center gap-2 text-base\">\r\n                                  <Store className=\"w-4 h-4\" />\r\n                                  {t(\"profile.restaurantActivities\")}\r\n                                </h3>\r\n                                <div className=\"space-y-3\">\r\n                                  {(() => {\r\n                                    const activityGroups = merchantActivities.reduce((acc, participation) => {\r\n                                      const activityId = participation.activity_id;\r\n                                      if (!acc[activityId]) {\r\n                                        acc[activityId] = {\r\n                                          activity: participation.activity,\r\n                                          restaurants: [],\r\n                                          participationDate: participation.created_at\r\n                                        };\r\n                                      }\r\n                                      acc[activityId].restaurants.push({\r\n                                        id: participation.restaurant_id,\r\n                                        name: participation.restaurant_name,\r\n                                        name_en: participation.restaurant_name_en,\r\n                                        name_pt: participation.restaurant_name_pt,\r\n                                      });\r\n                                      return acc;\r\n                                    }, {} as Record<string, any>);\r\n                                    \r\n                                    return Object.values(activityGroups).map((group: any) => (\r\n                                      <MerchantActivityItem\r\n                                        key={group.activity.id}\r\n                                        activityGroup={group}\r\n                                        getLocalizedField={getLocalizedField}\r\n                                        t={t}\r\n                                        isMobile={true}\r\n                                      />\r\n                                    ));\r\n                                  })()}\r\n                                </div>\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                                {t(\"profile.noParticipatedActivities\")}{\" \"}\r\n                                <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                                  {t(\"profile.browseActivities\")}\r\n                                </Link>\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                        </CardContent>\r\n                      </Card>\r\n                    </div>\r\n                  </CarouselItem>\r\n                )}\r\n              </CarouselContent>\r\n            </Carousel>\r\n            \r\n            {/* Mobile: Fixed bottom navigation */}\r\n            <div className=\"fixed bottom-0 left-0 right-0 bg-background border-t z-50\">\r\n              <div className=\"flex justify-around items-center py-2 px-2\">\r\n                {tabs.map((tab) => {\r\n                  const Icon = tab.icon;\r\n                  return (\r\n                    <button\r\n                      key={tab.value}\r\n                      onClick={() => handleTabClick(tab.value)}\r\n                      className={`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${\r\n                        activeTab === tab.value\r\n                          ? \"text-primary\"\r\n                          : \"text-muted-foreground\"\r\n                      }`}\r\n                    >\r\n                      <Icon className={`${activeTab === tab.value ? \"w-6 h-6\" : \"w-5 h-5\"}`} />\r\n                      <span className=\"text-xs font-medium\">{tab.label}</span>\r\n                    </button>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          </>\r\n        ) : (\r\n          <Tabs defaultValue=\"favorites\" className=\"space-y-4 md:space-y-6\">\r\n            <TabsList className={`grid w-full ${isMerchantOrSupervisor ? 'grid-cols-6' : 'grid-cols-5'}`}>\r\n              <TabsTrigger value=\"favorites\">\r\n                <Heart className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.favorites\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"coupons\">\r\n                <Ticket className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.coupons.title\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"comments\">\r\n                <MessageSquare className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.comments\")}\r\n              </TabsTrigger>\r\n              {isMerchantOrSupervisor && (\r\n                <TabsTrigger value=\"activities\">\r\n                  <Calendar className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"profile.participatedActivities\")}\r\n                </TabsTrigger>\r\n              )}\r\n              <TabsTrigger value=\"addresses\">\r\n                <MapPin className=\"w-4 h-4 mr-2\" />\r\n                {t(\"address.myAddresses\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"orders\">\r\n                <Users className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.orderRecords\")}\r\n              </TabsTrigger>\r\n            </TabsList>\r\n\r\n          <TabsContent value=\"favorites\">\r\n            <Card>\r\n              <CardContent className=\"pt-6\">\r\n                <Tabs defaultValue=\"restaurants\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-2 mb-6\">\r\n                    <TabsTrigger value=\"restaurants\" className=\"flex items-center gap-2\">\r\n                      <Store className=\"w-4 h-4\" />\r\n                      {t(\"profile.restaurantFavorites\")}\r\n                      {favorites && favorites.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {favorites.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"activities\" className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"w-4 h-4\" />\r\n                      {t(\"profile.activityFavorites\")}\r\n                      {subscriptions && subscriptions.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {subscriptions.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"restaurants\">\r\n                    {favoritesLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : favorites && favorites.length > 0 ? (\r\n                      <div className=\"grid gap-4 md:grid-cols-2\">\r\n                        {favorites.map((restaurant) => (\r\n                          <FavoriteRestaurantItem\r\n                            key={restaurant.id}\r\n                            restaurant={restaurant}\r\n                            getLocalizedField={getLocalizedField}\r\n                            t={t}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"profile.noFavorites\")}</p>\r\n                    )}\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"activities\">\r\n                    {subscriptionsLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : subscriptions && subscriptions.length > 0 ? (\r\n                      <div className=\"space-y-4\">\r\n                        {subscriptions.map((subscription) => (\r\n                          <ActivitySubscriptionItem\r\n                            key={subscription.id}\r\n                            subscription={subscription}\r\n                            getLocalizedField={getLocalizedField}\r\n                            t={t}\r\n                            isMobile={isMobile}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">\r\n                        {t(\"profile.noActivityFavorites\")}{\" \"}\r\n                        <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                          {t(\"profile.browseActivities\")}\r\n                        </Link>\r\n                      </p>\r\n                    )}\r\n                  </TabsContent>\r\n                </Tabs>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"comments\">\r\n            <Card>\r\n              <CardHeader className={isMobile ? \"pb-3\" : \"\"}>\r\n                <CardTitle className={`flex items-center gap-2 ${isMobile ? \"text-lg\" : \"\"}`}>\r\n                  <MessageSquare className=\"w-5 h-5\" />\r\n                  {t(\"profile.myComments\")}\r\n                </CardTitle>\r\n                <CardDescription className={isMobile ? \"text-xs\" : \"\"}>\r\n                  {t(\"profile.commentsDesc\")}\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent className={`space-y-3 md:space-y-4 ${isMobile ? \"px-3\" : \"\"}`}>\r\n                {commentsLoading ? (\r\n                  <div className={`text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"common.loading\")}\r\n                  </div>\r\n                ) : comments && comments.length > 0 ? (\r\n                  comments.map((comment) => (\r\n                    <CommentItem\r\n                      key={comment.id}\r\n                      comment={comment}\r\n                      getLocalizedField={getLocalizedField}\r\n                      t={t}\r\n                    />\r\n                  ))\r\n                ) : (\r\n                  <p className={`text-muted-foreground text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"profile.noComments\")}\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {isMerchantOrSupervisor && (\r\n            <TabsContent value=\"activities\">\r\n              <Card>\r\n                <CardHeader className={isMobile ? \"pb-3\" : \"\"}>\r\n                  <CardTitle className={`flex items-center gap-2 ${isMobile ? \"text-lg\" : \"\"}`}>\r\n                    <Calendar className=\"w-5 h-5\" />\r\n                    {t(\"profile.participatedActivities\")}\r\n                  </CardTitle>\r\n                  <CardDescription className={isMobile ? \"text-xs\" : \"\"}>\r\n                    {t(\"profile.participatedActivitiesDesc\")}\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className={isMobile ? \"px-3\" : \"\"}>\r\n                  <div className={isMobile ? \"space-y-4\" : \"space-y-6\"}>\r\n                    {/* Restaurant participations */}\r\n                    {merchantActivitiesLoading ? (\r\n                      <div className={`text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                        {t(\"common.loading\")}\r\n                      </div>\r\n                    ) : merchantActivities && merchantActivities.length > 0 ? (\r\n                      <div>\r\n                        <h3 className={`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${isMobile ? \"text-base\" : \"text-lg\"}`}>\r\n                          <Store className={isMobile ? \"w-4 h-4\" : \"w-5 h-5\"} />\r\n                          {t(\"profile.restaurantActivities\")}\r\n                        </h3>\r\n                        <div className={isMobile ? \"space-y-3\" : \"space-y-4\"}>\r\n                          {(() => {\r\n                            // Group activities by activity_id\r\n                            const activityGroups = merchantActivities.reduce((acc, participation) => {\r\n                              const activityId = participation.activity_id;\r\n                              if (!acc[activityId]) {\r\n                                acc[activityId] = {\r\n                                  activity: participation.activity,\r\n                                  restaurants: [],\r\n                                  participationDate: participation.created_at\r\n                                };\r\n                              }\r\n                              acc[activityId].restaurants.push({\r\n                                id: participation.restaurant_id,\r\n                                name: participation.restaurant_name,\r\n                                name_en: participation.restaurant_name_en,\r\n                                name_pt: participation.restaurant_name_pt,\r\n                              });\r\n                              return acc;\r\n                            }, {} as Record<string, any>);\r\n\r\n                            return Object.values(activityGroups).map((group: any) => (\r\n                              <MerchantActivityItem\r\n                                key={group.activity.id}\r\n                                activityGroup={group}\r\n                                getLocalizedField={getLocalizedField}\r\n                                t={t}\r\n                                isMobile={isMobile}\r\n                              />\r\n                            ));\r\n                          })()}\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <p className={`text-muted-foreground text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                        {t(\"profile.noParticipatedActivities\")}{\" \"}\r\n                        <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                          {t(\"profile.browseActivities\")}\r\n                        </Link>\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n          )}\r\n\r\n          <TabsContent value=\"coupons\">\r\n            <Card>\r\n              <CardHeader className={isMobile ? \"pb-3\" : \"\"}>\r\n                <CardTitle className={`flex items-center gap-2 ${isMobile ? \"text-lg\" : \"\"}`}>\r\n                  <Ticket className=\"w-5 h-5\" />\r\n                  {t(\"profile.coupons.title\")}\r\n                </CardTitle>\r\n                <CardDescription className={isMobile ? \"text-xs\" : \"\"}>\r\n                  {t(\"profile.coupons.description\")}\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent className={isMobile ? \"px-3\" : \"\"}>\r\n                {couponsLoading ? (\r\n                  <div className={`text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"common.loading\")}\r\n                  </div>\r\n                ) : userCoupons && userCoupons.length > 0 ? (\r\n                  <div className={`grid gap-3 md:gap-4 ${isMobile ? \"grid-cols-1\" : \"md:grid-cols-2\"}`}>\r\n                    {userCoupons.map((coupon) => (\r\n                      <UserCouponItem\r\n                        key={coupon.id}\r\n                        coupon={coupon}\r\n                        getLocalizedField={getLocalizedField}\r\n                        t={t}\r\n                        isMobile={isMobile}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p className={`text-muted-foreground text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"profile.coupons.noCoupons\")}{\" \"}\r\n                    <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                      {t(\"profile.coupons.browseActivities\")}\r\n                    </Link>\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"addresses\">\r\n            <AddressManagement />\r\n          </TabsContent>\r\n          \r\n          <TabsContent value=\"orders\">\r\n            <div className=\"space-y-4 md:space-y-6\">\r\n              <BookingRecords />\r\n              <DeliveryRecords />\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n        )}\r\n      </div>\r\n    </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Profile;\r\n"],"file":"assets/Profile-CdD3XiZk.js"}