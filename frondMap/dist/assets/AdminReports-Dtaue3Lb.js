import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as j}from"./vendor-react-iAJ0IrSD.js";import{u as le,a as K,b as de}from"./vendor-query-BlSVl3IQ.js";import{c as ce,L as P,C as i,j as n,t as l,ac as h,k as d,I,B as p,z as oe,A as me,E as xe,F as f,r as O,ai as he,D as pe,a as ue,b as je,d as fe,$ as ge,a6 as ve,a7 as ye,a8 as we,a9 as Ne,aa as w,ab as Ce,s as N,y as C}from"./index-Do1W_89N.js";import{u as Se}from"./vendor-i18n-DxKeo2S1.js";import{F as k}from"./flag-PIOKyp7U.js";import{C as be}from"./clock-C2dMhwrG.js";import{C as De}from"./circle-alert-DQaz5Go2.js";import{C as _e}from"./circle-check-big-CeTGEohx.js";import{C as ke}from"./circle-x-C1hLrEm8.js";import{T as Re}from"./trending-up-DWx64Qpz.js";import{R as S,L as Fe,C as z,X as Q,Y as V,T as b,b as Le,P as X,e as H,f as Y,B as Te,d as Ae}from"./vendor-charts-Bz7hPIBd.js";import{S as $e}from"./search-DsePuv7P.js";import{F as Ee}from"./filter-CBzs1yBA.js";import{E as G}from"./external-link-CmznQ2n3.js";import{s as W}from"./startOfDay-D6pD3B6q.js";import{s as Be}from"./subDays-DgL-WRAj.js";import{f as R}from"./format-DMNSJgyu.js";import"./vendor-supabase-KNAP0qdW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=ce("ChartPie",[["path",{d:"M21 12c.552 0 1.005-.449.95-.998a10 10 0 0 0-8.953-8.951c-.55-.055-.998.398-.998.95v8a1 1 0 0 0 1 1z",key:"pzmjnu"}],["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}]]),rs=()=>{const{t:s}=Se(),F=le(),[r,g]=j.useState(null),[L,T]=j.useState(""),[A,$]=j.useState(""),[E,J]=j.useState(""),[v,u]=j.useState("all"),{data:c,isLoading:Z}=K({queryKey:["admin-reports"],queryFn:async()=>{const{data:a,error:t}=await N.from("reports").select(`
          *,
          reporter:profiles(display_name, avatar_url)
        `).order("created_at",{ascending:!1});if(t)throw t;return a}}),{data:D}=K({queryKey:["emailConfig","report"],queryFn:async()=>{const{data:a,error:t}=await N.from("email_config").select("*").eq("type","report").single();if(t)throw t;return a}}),B=c?.filter(a=>{const t=E.toLowerCase(),m=a.description.toLowerCase().includes(t)||a.reporter?.display_name?.toLowerCase().includes(t)||a.reason.toLowerCase().includes(t),x=v==="all"||a.status===v;return m&&x}),o={total:c?.length||0,pending:c?.filter(a=>a.status==="pending").length||0,reviewing:c?.filter(a=>a.status==="reviewing").length||0,resolved:c?.filter(a=>a.status==="resolved").length||0,dismissed:c?.filter(a=>a.status==="dismissed").length||0},ee=Array.from({length:7},(a,t)=>{const m=W(Be(new Date,6-t)),x=R(m,"yyyy-MM-dd"),y=c?.filter(ne=>R(W(new Date(ne.created_at)),"yyyy-MM-dd")===x).length||0;return{date:R(m,"MM/dd"),count:y}}),M=["spam","harassment","inappropriate_content","misinformation","copyright","fraud","hate_speech","violence","other"].map(a=>({name:s(`report.reasons.${a}`),value:c?.filter(t=>t.reason===a).length||0})).filter(a=>a.value>0),se=["comment","restaurant","activity","user"].map(a=>({name:s(`admin.reportType.${a}`),value:c?.filter(t=>t.target_type===a).length||0})).filter(a=>a.value>0),U=["#016450","#018a6f","#4CAF50","#81C784","#FFA726","#FF7043","#EF5350","#EC407A","#AB47BC"],ae=async()=>{const a=prompt(s("joinUs.enterNewEmail"),D?.recipient_email);if(a)try{const{error:t}=await N.from("email_config").update({recipient_email:a}).eq("id",D?.id);if(t)throw t;F.invalidateQueries({queryKey:["emailConfig"]}),C.success(s("joinUs.emailUpdated"))}catch(t){console.error("Error updating email:",t),C.error(s("joinUs.emailUpdateError"))}},_=de({mutationFn:async({id:a,status:t,notes:m})=>{const x={updated_at:new Date().toISOString()};t&&(x.status=t),m!==void 0&&(x.admin_notes=m);const{error:y}=await N.from("reports").update(x).eq("id",a);if(y)throw y},onSuccess:()=>{F.invalidateQueries({queryKey:["admin-reports"]}),C.success(s("toast.reportUpdatedSuccess")),g(null)},onError:a=>{C.error(a.message||s("toast.reportUpdateFailed"))}}),q=a=>{const t={pending:"default",reviewing:"secondary",resolved:"default",dismissed:"destructive"};return e.jsx(O,{variant:t[a]||"default",children:s(`admin.reportStatus.${a}`)})},te=(a,t)=>{switch(a){case"restaurant":return`/restaurant/${t}`;case"activity":return`/activity/${t}`;case"comment":return"#";case"user":return"/profile";default:return"#"}},re=a=>{g(a),T(a.admin_notes||""),$(a.status)},ie=()=>{r&&_.mutate({id:r.id,status:A,notes:L})};return Z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{className:"w-8 h-8 animate-spin"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold",children:s("admin.reports")}),e.jsx("p",{className:"text-muted-foreground mt-2",children:s("admin.reportsDescription")})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("joinUs.recipientEmail")}),e.jsx(h,{children:s("joinUs.recipientEmailDesc")})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{value:D?.recipient_email||"",readOnly:!0}),e.jsx(p,{onClick:ae,children:s("common.edit")})]})})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.totalReports")}),e.jsx(k,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.allReportsCount")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.pending")}),e.jsx(be,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.pending}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.awaitingReview")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.reviewing")}),e.jsx(De,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.reviewing}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.underReview")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.resolved")}),e.jsx(_e,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.resolved}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.resolvedReports")})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:s("admin.reportStatus.dismissed")}),e.jsx(ke,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.dismissed}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("admin.dismissedReports")})]})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5 text-primary"}),e.jsx(l,{children:s("admin.reportsTrend")})]}),e.jsx(h,{children:s("admin.reportsTrendDesc")})]}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(Fe,{data:ee,children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"date"}),e.jsx(V,{}),e.jsx(b,{}),e.jsx(Le,{type:"monotone",dataKey:"count",stroke:"hsl(var(--primary))",strokeWidth:2,name:s("admin.reportsCount")})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5 text-primary"}),e.jsx(l,{children:s("admin.reportsReasonDist")})]}),e.jsx(h,{children:s("admin.reportsReasonDistDesc")})]}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(X,{children:[e.jsx(H,{data:M,cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:M.map((a,t)=>e.jsx(Y,{fill:U[t%U.length]},`cell-${t}`))}),e.jsx(b,{})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("admin.reportsTypeDist")}),e.jsx(h,{children:s("admin.reportsTypeDistDesc")})]}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(Te,{data:se,children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name"}),e.jsx(V,{}),e.jsx(b,{}),e.jsx(Ae,{dataKey:"value",fill:"hsl(var(--primary))",name:s("admin.reportsCount")})]})})})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:s("admin.reportsStatusDist")}),e.jsx(h,{children:s("admin.reportsStatusDistDesc")})]}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(X,{children:[e.jsx(H,{data:[{name:s("admin.reportStatus.pending"),value:o.pending},{name:s("admin.reportStatus.reviewing"),value:o.reviewing},{name:s("admin.reportStatus.resolved"),value:o.resolved},{name:s("admin.reportStatus.dismissed"),value:o.dismissed}].filter(a=>a.value>0),cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percent:t})=>`${a}: ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:[{color:"#FFA726"},{color:"#42A5F5"},{color:"#66BB6A"},{color:"#EF5350"}].map((a,t)=>e.jsx(Y,{fill:a.color},`cell-${t}`))}),e.jsx(b,{})]})})})]})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx(l,{children:s("admin.allReports")}),e.jsx(h,{children:s("admin.manageReportsDesc")})]})}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(I,{placeholder:s("admin.searchReports"),value:E,onChange:a=>J(a.target.value),className:"pl-10"})]}),e.jsxs(oe,{children:[e.jsx(me,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"gap-2",children:[e.jsx(Ee,{className:"w-4 h-4"}),s(v==="all"?"admin.allStatus":`admin.reportStatus.${v}`)]})}),e.jsxs(xe,{align:"end",className:"bg-background",children:[e.jsx(f,{onClick:()=>u("all"),children:s("admin.allStatus")}),e.jsx(f,{onClick:()=>u("pending"),children:s("admin.reportStatus.pending")}),e.jsx(f,{onClick:()=>u("reviewing"),children:s("admin.reportStatus.reviewing")}),e.jsx(f,{onClick:()=>u("resolved"),children:s("admin.reportStatus.resolved")}),e.jsx(f,{onClick:()=>u("dismissed"),children:s("admin.reportStatus.dismissed")})]})]})]})]}),e.jsx(d,{children:e.jsxs("div",{className:"grid gap-4",children:[B?.map(a=>e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s(`admin.reportType.${a.target_type}`)}),q(a.status),e.jsx(O,{variant:"outline",children:s(`report.reasons.${a.reason}`)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.description.substring(0,150),a.description.length>150&&"..."]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[s("admin.reportedBy"),": ",a.reporter?.display_name]}),e.jsxs("span",{children:[s("admin.reportedAt"),":"," ",he(new Date(a.created_at),{addSuffix:!0})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>re(a),children:s("admin.viewReport")}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>window.open(te(a.target_type,a.target_id),"_blank"),children:e.jsx(G,{className:"w-4 h-4"})})]})]})},a.id)),B?.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.noReports")})]})]})})]})]}),e.jsx(pe,{open:!!r,onOpenChange:()=>g(null),children:e.jsxs(ue,{className:"max-w-[90vw] sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(je,{children:[e.jsxs(fe,{children:[s("admin.viewReport")," - ",r?.id]}),e.jsx(ge,{children:s(`admin.reportType.${r?.target_type}`)})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedBy"),":"]})," ",r.reporter?.display_name]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("admin.reportedAt"),":"]})," ",new Date(r.created_at).toLocaleString()]}),e.jsxs("div",{children:[e.jsxs("span",{className:"font-medium",children:[s("report.reason"),":"]})," ",s(`report.reasons.${r.reason}`)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",q(r.status)]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.detailsLabel")}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:r.description})]}),r.reporter_contact&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.contactLabel")}),e.jsx("p",{className:"text-sm",children:r.reporter_contact})]}),r.evidence_urls&&r.evidence_urls.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:s("report.evidenceLabel")}),e.jsx("ul",{className:"space-y-1",children:r.evidence_urls.map((a,t)=>e.jsx("li",{children:e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline flex items-center gap-1",children:[e.jsx(G,{className:"w-3 h-3"}),a]})},t))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.updateStatus")}),e.jsxs(ve,{value:A,onValueChange:$,children:[e.jsx(ye,{children:e.jsx(we,{})}),e.jsxs(Ne,{children:[e.jsx(w,{value:"pending",children:s("admin.reportStatus.pending")}),e.jsx(w,{value:"reviewing",children:s("admin.reportStatus.reviewing")}),e.jsx(w,{value:"resolved",children:s("admin.reportStatus.resolved")}),e.jsx(w,{value:"dismissed",children:s("admin.reportStatus.dismissed")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:s("admin.adminNotes")}),e.jsx(Ce,{value:L,onChange:a=>T(a.target.value),placeholder:"Add internal notes...",rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>g(null),children:s("common.cancel")}),e.jsx(p,{onClick:ie,disabled:_.isPending,children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),s("common.loading")]}):s("admin.saveNotes")})]})]})]})})]})};export{rs as default};
//# sourceMappingURL=AdminReports-Dtaue3Lb.js.map
