import{r as c,j as e}from"./vendor-react-core-BErlw7p5.js";import{C as n,j as i,I as z,X as L,Y as P,Z as D,$ as _,a0 as m,S as v,B as X,o as A}from"./index-CEqKPgls.js";import{T as Y,a as Z,b as w,c as j,d as q,e as o}from"./table-BmTgE8rr.js";import{t as K}from"./useAdmin-_9qYsNyJ.js";import{u as Q,P as W,a as ee,b as k,c as se,d as ae,f as re}from"./usePagination-lYmgCpru.js";import{u as te}from"./vendor-i18n-CqcxoxDo.js";import{ab as T,b1 as p,t as le,F as ne,U as de,x as ce,l as ie,C as me}from"./vendor-icons-C2Bicc1E.js";import{C as oe}from"./vendor-date-fYlqblcl.js";import"./vendor-editor-BdQcs4B3.js";import"./vendor-misc-DH4LiFnZ.js";import"./vendor-router-CLK0c9aH.js";import"./vendor-ui-other-CPTlx-W2.js";import"./vendor-query-BS0wY7WL.js";import"./vendor-supabase-Clrw0GhO.js";import"./vendor-ui-dialog-Sv_VEL0d.js";import"./vendor-ui-dropdown-DwTcg2UT.js";const Ce=()=>{const{t:r}=te(),{data:l,isLoading:I}=K(),[F,R]=c.useState(new Set),[x,U]=c.useState(""),[u,B]=c.useState("all"),[N,M]=c.useState("all"),H=c.useMemo(()=>l?[...new Set(l.map(t=>t.table_name))].sort():[],[l]),E=c.useMemo(()=>l?l.filter(s=>{const t=x===""||s.user_name?.toLowerCase().includes(x.toLowerCase())||s.table_name.toLowerCase().includes(x.toLowerCase()),a=u==="all"||s.action===u,g=N==="all"||s.table_name===N;return t&&a&&g}):[],[l,x,u,N]),{currentPage:d,totalPages:h,paginatedData:b,goToPage:f,canGoNext:y,canGoPrevious:S,startIndex:V,endIndex:$,totalItems:G}=Q({data:E,itemsPerPage:15}),J=s=>{R(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},O=s=>({INSERT:{variant:"default",className:"bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 border-emerald-500/20 hover:bg-emerald-500/20"},UPDATE:{variant:"secondary",className:"bg-amber-500/10 text-amber-600 dark:text-amber-400 border-amber-500/20 hover:bg-amber-500/20"},DELETE:{variant:"destructive",className:"bg-red-500/10 text-red-600 dark:text-red-400 border-red-500/20 hover:bg-red-500/20"}})[s]||{variant:"outline",className:""},C=s=>{if(!s)return null;try{return JSON.stringify(s,null,2)}catch{return String(s)}};return I?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"text-muted-foreground",children:r("common.loading")})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(T,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:r("admin.operationLogs")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r("admin.viewSystemLogs")})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-emerald-500/5 to-emerald-500/10 dark:from-emerald-500/10 dark:to-emerald-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-emerald-500/10 dark:bg-emerald-500/20",children:e.jsx(p,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"INSERT"}),e.jsx("p",{className:"text-xl font-bold text-emerald-600 dark:text-emerald-400",children:l?.filter(s=>s.action==="INSERT").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-amber-500/5 to-amber-500/10 dark:from-amber-500/10 dark:to-amber-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-amber-500/10 dark:bg-amber-500/20",children:e.jsx(p,{className:"h-4 w-4 text-amber-600 dark:text-amber-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"UPDATE"}),e.jsx("p",{className:"text-xl font-bold text-amber-600 dark:text-amber-400",children:l?.filter(s=>s.action==="UPDATE").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-red-500/5 to-red-500/10 dark:from-red-500/10 dark:to-red-500/20",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-red-500/10 dark:bg-red-500/20",children:e.jsx(p,{className:"h-4 w-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"DELETE"}),e.jsx("p",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:l?.filter(s=>s.action==="DELETE").length||0})]})]})})}),e.jsx(n,{className:"border-none shadow-sm bg-gradient-to-br from-primary/5 to-primary/10",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:e.jsx(T,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r("common.total")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:l?.length||0})]})]})})})]}),e.jsx(n,{className:"border-none shadow-sm",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(z,{placeholder:r("common.search"),value:x,onChange:s=>U(s.target.value),className:"pl-9"})]}),e.jsxs(L,{value:u,onValueChange:B,children:[e.jsxs(P,{className:"w-full sm:w-[140px]",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),e.jsx(D,{placeholder:r("admin.action")})]}),e.jsxs(_,{children:[e.jsx(m,{value:"all",children:r("common.all")}),e.jsx(m,{value:"INSERT",children:"INSERT"}),e.jsx(m,{value:"UPDATE",children:"UPDATE"}),e.jsx(m,{value:"DELETE",children:"DELETE"})]})]}),e.jsxs(L,{value:N,onValueChange:M,children:[e.jsxs(P,{className:"w-full sm:w-[180px]",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),e.jsx(D,{placeholder:r("admin.table")})]}),e.jsxs(_,{children:[e.jsx(m,{value:"all",children:r("common.all")}),H.map(s=>e.jsx(m,{value:s,children:s},s))]})]})]})})}),E.length>0&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r("common.showing")," ",V,"-",$," ",r("common.of")," ",G," ",r("common.results")]}),b&&b.length>0?e.jsx(n,{className:"border-none shadow-sm overflow-hidden",children:e.jsx(v,{className:"w-full",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(w,{className:"bg-muted/30 hover:bg-muted/30",children:[e.jsx(j,{className:"w-[50px]"}),e.jsx(j,{className:"min-w-[120px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),r("admin.user")]})}),e.jsx(j,{className:"min-w-[120px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4"}),r("admin.table")]})}),e.jsx(j,{className:"min-w-[100px]",children:r("admin.action")}),e.jsx(j,{className:"min-w-[160px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),r("admin.time")]})})]})}),e.jsx(q,{children:b.map(s=>{const t=F.has(s.id),a=s.old_data||s.new_data,g=O(s.action);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:`cursor-pointer transition-colors ${a?"hover:bg-muted/50":""}`,onClick:()=>a&&J(s.id),children:[e.jsx(o,{className:"w-[50px]",children:a&&e.jsx(X,{variant:"ghost",size:"icon",className:"h-6 w-6",children:t?e.jsx(ie,{className:"h-4 w-4"}):e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(o,{children:e.jsx("span",{className:"font-medium",children:s.user_name||"-"})}),e.jsx(o,{children:e.jsx(A,{variant:"outline",className:"font-mono text-xs",children:s.table_name})}),e.jsx(o,{children:e.jsx(A,{variant:g.variant,className:g.className,children:s.action})}),e.jsx(o,{className:"text-muted-foreground text-sm",children:oe(new Date(s.created_at),"yyyy-MM-dd HH:mm:ss")})]},s.id),t&&a&&e.jsx(w,{children:e.jsx(o,{colSpan:5,className:"bg-muted/20 p-0",children:e.jsx("div",{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.old_data&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 dark:bg-red-400"}),e.jsx("span",{className:"font-semibold text-sm text-red-600 dark:text-red-400",children:r("admin.oldData")})]}),e.jsx(v,{className:"h-[200px] rounded-lg border border-red-500/20 dark:border-red-400/30 bg-red-500/5 dark:bg-red-500/10",children:e.jsx("pre",{className:"p-3 text-xs font-mono whitespace-pre-wrap break-all text-foreground",children:C(s.old_data)})})]}),s.new_data&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-emerald-500 dark:bg-emerald-400"}),e.jsx("span",{className:"font-semibold text-sm text-emerald-600 dark:text-emerald-400",children:r("admin.newData")})]}),e.jsx(v,{className:"h-[200px] rounded-lg border border-emerald-500/20 dark:border-emerald-400/30 bg-emerald-500/5 dark:bg-emerald-500/10",children:e.jsx("pre",{className:"p-3 text-xs font-mono whitespace-pre-wrap break-all text-foreground",children:C(s.new_data)})})]})]})})})},`${s.id}-expanded`)]})})})]})})}):e.jsx(n,{className:"border-none shadow-sm",children:e.jsx(i,{className:"py-16 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 rounded-full bg-muted",children:e.jsx(T,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"text-muted-foreground",children:r("admin.noLogs")})]})})}),h>1&&e.jsx(W,{children:e.jsxs(ee,{children:[e.jsx(k,{children:e.jsx(se,{onClick:()=>S&&f(d-1),className:S?"cursor-pointer":"pointer-events-none opacity-50"})}),Array.from({length:Math.min(5,h)},(s,t)=>{let a;return h<=5||d<=3?a=t+1:d>=h-2?a=h-4+t:a=d-2+t,e.jsx(k,{children:e.jsx(ae,{onClick:()=>f(a),isActive:d===a,className:"cursor-pointer",children:a})},a)}),e.jsx(k,{children:e.jsx(re,{onClick:()=>y&&f(d+1),className:y?"cursor-pointer":"pointer-events-none opacity-50"})})]})})]})};export{Ce as default};
//# sourceMappingURL=AdminLogs-0b17ifyd.js.map
