import{p as H,r as i,j as e,el as je,bh as fe,ay as ve,d1 as Ne,aw as we,dE as q,bU as W,ak as ae,w as G,em as te,en as ne,eo as le,cP as Z,cQ as ee,cM as be,bi as ye,ep as Ce,cO as _e,bs as O,ab as Se,X as De,bW as ze,b4 as Be,bx as Le}from"./vendor-react-DwI6ZJq7.js";import{U as k,B as f,C as D,q as z,I as S,s as M,i as X,ai as Te,D as re,c as ie,d as oe,e as ce,T as de,V as Ee,f as Ie,W as Pe,S as Ae,p as Ue,F as Re,$ as ke,A as Fe,a7 as Me,t as He,v as Ve,w as $e,x as qe,y as Ge,z as Qe,E as We}from"./index-C7QjDrm6.js";import{b as Oe,c as Xe,a as Ye,d as Je}from"./useBrands-DsimGPlx.js";import{T as me,a as ue,b as T,c as E}from"./tabs-Bv26OHLw.js";import{u as Ke}from"./useLocalizedContent-MCfjRTM4.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-BlA2nlsP.js";const Ze=()=>Math.random().toString(36).substring(2,9),Q={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],["link"],["clean"]]},es=({blocks:a,onChange:u})=>{const{t:s,i18n:g}=H(),[c,h]=i.useState(null),j=t=>{const o={id:Ze(),type:t,...t==="text"?{content_zh:"",content_en:"",content_pt:""}:{url:"",alt:""}};u([...a,o])},w=t=>{u(a.filter(o=>o.id!==t))},l=(t,o)=>{const n=[...a],d=o==="up"?t-1:t+1;d<0||d>=a.length||([n[t],n[d]]=[n[d],n[t]],u(n))},v=(t,o)=>{u(a.map(n=>n.id===t?{...n,...o}:n))},C=async(t,o)=>{if(!o.type.startsWith("image/")){G.error(s("admin.brand.invalidImageType"));return}h(t);try{const n=o.name.split(".").pop(),d=`brand-content-${Date.now()}.${n}`,{error:b}=await M.storage.from("restaurant-images").upload(d,o);if(b)throw b;const{data:{publicUrl:_}}=M.storage.from("restaurant-images").getPublicUrl(d);v(t,{url:_}),G.success(s("admin.brand.imageUploaded"))}catch(n){console.error("Upload error:",n),G.error(n.message||s("admin.brand.uploadError"))}finally{h(null)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{children:s("admin.brand.contentBlocks")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>j("text"),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),s("admin.brand.addText")]}),e.jsxs(f,{type:"button",variant:"outline",size:"sm",onClick:()=>j("image"),children:[e.jsx(fe,{className:"h-4 w-4 mr-1"}),s("admin.brand.addImage")]})]})]}),a.length===0&&e.jsx(D,{className:"border-dashed",children:e.jsxs(z,{className:"py-8 text-center text-muted-foreground",children:[e.jsx("p",{children:s("admin.brand.noBlocks")}),e.jsx("p",{className:"text-sm mt-1",children:s("admin.brand.addBlockHint")})]})}),e.jsx("div",{className:"space-y-3",children:a.map((t,o)=>e.jsx(D,{className:"relative",children:e.jsx(z,{className:"pt-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1 pt-2",children:[e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:o===0,onClick:()=>l(o,"up"),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center justify-center h-6 w-6 text-muted-foreground",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-6 w-6",disabled:o===a.length-1,onClick:()=>l(o,"down"),children:e.jsx(we,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex-1 min-w-0",children:t.type==="text"?e.jsxs(me,{defaultValue:"zh",className:"w-full",children:[e.jsxs(ue,{className:"mb-2",children:[e.jsx(T,{value:"zh",children:s("admin.chinese")}),e.jsx(T,{value:"en",children:s("admin.english")}),e.jsx(T,{value:"pt",children:s("admin.portuguese")})]}),e.jsx(E,{value:"zh",children:e.jsx(q,{theme:"snow",value:t.content_zh||"",onChange:n=>v(t.id,{content_zh:n}),modules:Q,placeholder:s("admin.brand.textPlaceholder")})}),e.jsx(E,{value:"en",children:e.jsx(q,{theme:"snow",value:t.content_en||"",onChange:n=>v(t.id,{content_en:n}),modules:Q,placeholder:s("admin.brand.textPlaceholder")})}),e.jsx(E,{value:"pt",children:e.jsx(q,{theme:"snow",value:t.content_pt||"",onChange:n=>v(t.id,{content_pt:n}),modules:Q,placeholder:s("admin.brand.textPlaceholder")})})]}):e.jsxs("div",{className:"space-y-3",children:[t.url?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t.url,alt:t.alt||"",className:"w-full max-h-48 object-contain rounded-lg bg-muted"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center rounded-lg",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(S,{type:"file",accept:"image/*",className:"hidden",onChange:n=>{const d=n.target.files?.[0];d&&C(t.id,d)}}),e.jsx(f,{type:"button",variant:"secondary",size:"sm",children:s("common.replace")})]})})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsx(S,{type:"file",accept:"image/*",className:"hidden",onChange:n=>{const d=n.target.files?.[0];d&&C(t.id,d)}}),e.jsx("div",{className:"border-2 border-dashed rounded-lg p-8 text-center hover:border-primary transition-colors",children:c===t.id?e.jsxs("div",{className:"animate-pulse text-muted-foreground",children:[s("common.uploading"),"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.brand.clickToUpload")})]})})]}),e.jsx(S,{placeholder:s("admin.brand.imageAlt"),value:t.alt||"",onChange:n=>v(t.id,{alt:n.target.value})})]})}),e.jsx(f,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>w(t.id),children:e.jsx(ae,{className:"h-4 w-4"})})]})})},t.id))})]})},xe=Te("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),ss=i.forwardRef(({className:a,variant:u,size:s,...g},c)=>e.jsx(te,{ref:c,className:X(xe({variant:u,size:s,className:a})),...g}));ss.displayName=te.displayName;const he=i.createContext({size:"default",variant:"default"}),pe=i.forwardRef(({className:a,variant:u,size:s,children:g,...c},h)=>e.jsx(ne,{ref:h,className:X("flex items-center justify-center gap-1",a),...c,children:e.jsx(he.Provider,{value:{variant:u,size:s},children:g})}));pe.displayName=ne.displayName;const F=i.forwardRef(({className:a,children:u,variant:s,size:g,...c},h)=>{const j=i.useContext(he);return e.jsx(le,{ref:h,className:X(xe({variant:j.variant||s,size:j.size||g}),a),...c,children:u})});F.displayName=le.displayName;function as({open:a,onOpenChange:u,imageFile:s,onCropComplete:g}){const{t:c}=H(),[h,j]=i.useState(""),[w,l]=i.useState(),[v,C]=i.useState(),[t,o]=i.useState("free"),n=i.useRef(null),[d,b]=i.useState(!1),_={free:void 0,"1:1":1,"4:3":4/3};i.useEffect(()=>{if(a&&s){const r=new FileReader;r.addEventListener("load",()=>{j(r.result?.toString()||"")}),r.readAsDataURL(s)}},[a,s]);const I=i.useCallback(r=>{const{width:x,height:p}=r.currentTarget,y=_[t];l(y?Z(ee({unit:"%",width:80},y,x,p),x,p):{unit:"%",x:10,y:10,width:80,height:80})},[t]);i.useEffect(()=>{if(!n.current||!h)return;const{width:r,height:x}=n.current;if(r===0)return;const p=_[t];p&&l(Z(ee({unit:"%",width:80},p,r,x),r,x))},[t]);const P=i.useCallback(async(r,x)=>{const p=document.createElement("canvas"),y=p.getContext("2d");if(!y)throw new Error("No 2d context");const L=r.naturalWidth/r.width,B=r.naturalHeight/r.height;return p.width=x.width*L,p.height=x.height*B,y.imageSmoothingQuality="high",y.drawImage(r,x.x*L,x.y*B,x.width*L,x.height*B,0,0,p.width,p.height),new Promise((V,$)=>{p.toBlob(U=>{if(!U){$(new Error("Canvas is empty"));return}V(U)},"image/png",1)})},[]),A=i.useCallback(async()=>{if(!(!v||!n.current)){b(!0);try{const r=await P(n.current,v),x=new File([r],s.name,{type:"image/png"}),p=URL.createObjectURL(r);g(x,p),u(!1)}catch(r){console.error("Error cropping image:",r)}finally{b(!1)}}},[v,s,g,u,P]);return e.jsx(re,{open:a,onOpenChange:u,children:e.jsxs(ie,{className:"max-w-[95vw] sm:max-w-3xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(oe,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-4 border-b",children:[e.jsxs(ce,{className:"text-lg sm:text-xl flex items-center gap-2",children:[e.jsx(be,{className:"w-5 h-5 text-primary"}),c("admin.cropImage","裁剪图片")]}),e.jsx(de,{className:"text-xs sm:text-sm",children:c("admin.cropLogoDescription","自由裁剪品牌Logo大小")})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 space-y-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-muted-foreground",children:[c("admin.aspectRatio","比例"),":"]}),e.jsxs(pe,{type:"single",value:t,onValueChange:r=>r&&o(r),className:"gap-1",children:[e.jsx(F,{value:"free",size:"sm",className:"text-xs px-3",children:c("admin.freeAspect","自由")}),e.jsxs(F,{value:"1:1",size:"sm",className:"text-xs px-3 gap-1",children:[e.jsx(ye,{className:"w-3 h-3"})," 1:1"]}),e.jsxs(F,{value:"4:3",size:"sm",className:"text-xs px-3 gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"})," 4:3"]})]})]}),e.jsx("div",{className:"relative w-full overflow-hidden rounded-lg border",children:h&&e.jsx(_e,{crop:w,onChange:r=>l(r),onComplete:r=>C(r),aspect:_[t],className:"max-h-[50vh] sm:max-h-[60vh]",children:e.jsx("img",{ref:n,src:h,alt:"Crop preview",onLoad:I,className:"max-w-full h-auto"})})})]}),e.jsxs(Ee,{className:"px-4 sm:px-6 pb-4 sm:pb-6 pt-4 border-t gap-2 sm:gap-0",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>u(!1),disabled:d,className:"w-full sm:w-auto",children:c("common.cancel")}),e.jsx(f,{type:"button",onClick:A,disabled:!v||d,className:"w-full sm:w-auto",children:d?c("common.processing","处理中..."):c("admin.confirmCrop","确认裁剪")})]})]})})}function se({brand:a,trigger:u}){const{t:s}=H(),{toast:g}=Ie(),c=Oe(),h=Xe(),[j,w]=i.useState(!1),[l,v]=i.useState(!1),[C,t]=i.useState(a?.name||""),[o,n]=i.useState(a?.name_en||""),[d,b]=i.useState(a?.name_pt||""),[_,I]=i.useState([]),[P,A]=i.useState(null),[r,x]=i.useState(a?.logo_url||null),[p,y]=i.useState(!1),[L,B]=i.useState(null);i.useEffect(()=>{if(j&&a){t(a.name||""),n(a.name_en||""),b(a.name_pt||""),x(a.logo_url||null);const m=a.content_blocks||[];I(m)}else j&&!a&&(t(""),n(""),b(""),x(null),A(null),I([]))},[j,a]);const V=m=>{const N=m.target.files?.[0];N&&(B(N),y(!0)),m.target.value=""},$=(m,N)=>{A(m),x(N),B(null)},U=async(m,N)=>{const R=m.name.split(".").pop(),J=`${N}_${Math.random()}.${R}`,{error:K}=await M.storage.from("restaurant-images").upload(J,m);if(K)throw K;const{data:{publicUrl:ge}}=M.storage.from("restaurant-images").getPublicUrl(J);return ge},Y=async m=>{if(m.preventDefault(),!C.trim()){g({title:s("common.error"),description:s("admin.brand.nameRequired"),variant:"destructive"});return}v(!0);try{let N=a?.logo_url||null;P&&(N=await U(P,"brand_logo"));const R={name:C,name_en:o||null,name_pt:d||null,logo_url:N,content_blocks:_};a?await h.mutateAsync({id:a.id,...R}):await c.mutateAsync(R),w(!1)}catch(N){g({title:s("common.error"),description:N.message,variant:"destructive"})}finally{v(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs(re,{open:j,onOpenChange:w,children:[e.jsx(Pe,{asChild:!0,children:u}),e.jsxs(ie,{className:"max-w-[95vw] sm:max-w-4xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(oe,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[e.jsxs(ce,{className:"text-2xl flex items-center gap-2",children:[e.jsx(O,{className:"w-6 h-6 text-primary"}),s(a?"admin.brand.edit":"admin.brand.create")]}),e.jsx(de,{className:"text-base",children:s(a?"admin.brand.editDesc":"admin.brand.createDesc")})]}),e.jsx(Ae,{className:"px-6 h-[calc(95vh-220px)]",children:e.jsxs("form",{onSubmit:Y,className:"space-y-6 py-6",children:[e.jsx(D,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(z,{className:"p-6",children:[e.jsxs(k,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(Se,{className:"w-5 h-5 text-primary"}),s("admin.brand.name")]}),e.jsxs(me,{defaultValue:"zh",className:"w-full",children:[e.jsxs(ue,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"zh",children:s("admin.chinese")}),e.jsx(T,{value:"en",children:s("admin.english")}),e.jsx(T,{value:"pt",children:s("admin.portuguese")})]}),e.jsx(E,{value:"zh",className:"mt-4",children:e.jsx(S,{value:C,onChange:m=>t(m.target.value),placeholder:s("admin.brand.namePlaceholder")})}),e.jsx(E,{value:"en",className:"mt-4",children:e.jsx(S,{value:o,onChange:m=>n(m.target.value),placeholder:s("admin.brand.namePlaceholderEn")})}),e.jsx(E,{value:"pt",className:"mt-4",children:e.jsx(S,{value:d,onChange:m=>b(m.target.value),placeholder:s("admin.brand.namePlaceholderPt")})})]})]})}),e.jsx(D,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsxs(z,{className:"p-6",children:[e.jsxs(k,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"w-5 h-5 text-primary"}),s("admin.brand.logo")]}),e.jsxs("div",{className:"flex items-center gap-4",children:[r&&e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:r,alt:"Logo Preview",className:"w-24 h-24 object-contain rounded-lg shadow-lg ring-2 ring-primary/20 bg-muted"}),e.jsx(f,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{A(null),x(null)},children:e.jsx(De,{className:"h-3 w-3"})})]}),e.jsxs(k,{htmlFor:"logo-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 px-6 py-4 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[e.jsx(W,{className:"h-6 w-6 text-primary"}),e.jsx("p",{className:"font-medium text-xs",children:s("admin.uploadImage")})]}),e.jsx(S,{id:"logo-upload",type:"file",accept:"image/*",className:"hidden",onChange:V})]})]})]})}),e.jsx(D,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:e.jsx(z,{className:"p-6",children:e.jsx(es,{blocks:_,onChange:I})})})]})}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t bg-muted/30",children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>w(!1),children:s("common.cancel")}),e.jsx(f,{onClick:Y,disabled:l,children:s(l?"common.saving":a?"common.save":"common.create")})]})]})]}),L&&e.jsx(as,{open:p,onOpenChange:m=>{y(m),m||B(null)},imageFile:L,onCropComplete:$})]})}const us=()=>{const{t:a}=H(),{data:u,isLoading:s}=Ye(),g=Je(),{getLocalizedField:c}=Ke(),[h,j]=i.useState(""),w=u?.filter(l=>l.name.toLowerCase().includes(h.toLowerCase())||l.name_en?.toLowerCase().includes(h.toLowerCase())||l.name_pt?.toLowerCase().includes(h.toLowerCase()));return s?e.jsx("div",{className:"text-center",children:a("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:a("admin.brand.title")}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.brand.subtitle")})]}),e.jsx(se,{trigger:e.jsxs(f,{children:[e.jsx(ze,{className:"mr-2 h-4 w-4"}),a("admin.brand.create")]})})]}),e.jsx(D,{children:e.jsx(z,{className:"pt-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(S,{placeholder:a("admin.brand.search"),value:h,onChange:l=>j(l.target.value),className:"pl-9"})]})})}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:w?.map(l=>e.jsxs(D,{className:"overflow-hidden",children:[l.image_url&&e.jsx("div",{className:"aspect-video overflow-hidden",children:e.jsx("img",{src:l.image_url,alt:l.name,className:"w-full h-full object-cover"})}),e.jsx(Ue,{className:"pb-2",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[l.logo_url?e.jsx("img",{src:l.logo_url,alt:`${l.name} logo`,className:"w-10 h-10 object-contain rounded-lg bg-muted p-1"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(Re,{className:"text-lg",children:c(l,"name")}),e.jsx(ke,{className:"text-xs",children:l.name!==l.name_en&&l.name_en&&e.jsx("span",{className:"mr-2",children:l.name_en})})]})]})})}),e.jsxs(z,{className:"pt-0",children:[(l.intro_zh||l.intro_en||l.intro_pt)&&e.jsx("div",{className:`text-sm text-muted-foreground line-clamp-2 mb-4 prose prose-sm max-w-none\r
                    [&_p]:m-0 [&_*]:text-muted-foreground`,dangerouslySetInnerHTML:{__html:c(l,"intro")||""}}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(se,{brand:l,trigger:e.jsxs(f,{variant:"outline",size:"sm",className:"flex-1",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),a("common.edit")]})}),e.jsxs(Fe,{children:[e.jsx(Me,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsxs(He,{children:[e.jsxs(Ve,{children:[e.jsx($e,{children:a("admin.brand.deleteConfirm")}),e.jsx(qe,{children:a("admin.brand.deleteWarning")})]}),e.jsxs(Ge,{children:[e.jsx(Qe,{children:a("common.cancel")}),e.jsx(We,{onClick:()=>g.mutate(l.id),children:a("common.delete")})]})]})]})]})]})]},l.id))}),w?.length===0&&e.jsx(D,{children:e.jsxs(z,{className:"py-12 text-center",children:[e.jsx(O,{className:"mx-auto h-12 w-12 text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.brand.empty")})]})})]})};export{us as default};
//# sourceMappingURL=AdminBrands-CFNZzQsh.js.map
