import{p as te,cc as ae,r as d,bO as re,bS as ne,j as e,cd as ie,y as le,M as oe,ba as ce,a4 as U,bv as de,br as E,c5 as me,am as xe,a_ as ue,an as q,aM as L,X as je,L as z,bj as he,W as pe,bz as fe}from"./vendor-react-Dx9aTW_3.js";import{b as ge,C as O,q as A,B as _,p as ve,F as Ne,$ as be,i as m,I as v,X as w,o as ye,D as Ue,c as _e,d as we,e as Ce,T as Ve,s as Se}from"./index-YQstMq3Q.js";import{F as Ie,a as x,b as u,d as p,e as j,c as N}from"./form-QuI-zkAM.js";import{d as ke}from"./useInvitationCodes-DYzhnA-u.js";import{P as Pe}from"./progress-1wSF8fmx.js";import{N as De,P as $,O as b,Q as Re}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-X8tv2THq.js";const G=["booking","delivery","qrcode"],Ge=()=>{const{t,i18n:C}=te(),[V]=ae(),[P,D]=d.useState(!1),[H,R]=d.useState(!1),[n,S]=d.useState(1),[B,I]=d.useState(!1),{settings:i}=ge(),Q=ke(),[c,f]=d.useState({isValidating:!1,isValid:null,inviterUserId:null}),W=d.useMemo(()=>De({restaurant_type:$(["standard","ghost"]),name:b().min(2,{message:t("joinUs.nameMin")}),email:b().email({message:t("joinUs.emailInvalid")}),phone:b().min(6,{message:t("joinUs.phoneMin")}),restaurant_name:b().min(2,{message:t("joinUs.restaurantNameMin")}),restaurant_address:b().min(2,{message:t("joinUs.addressMin")}),features_selected:Re($(G)).min(1,{message:t("joinUs.featuresMin")}),invitation_code:b().optional()}),[t]),r=re({resolver:ne(W),defaultValues:{restaurant_type:"standard",name:"",email:"",phone:"",restaurant_name:"",restaurant_address:"",features_selected:[],invitation_code:V.get("code")||""}}),X=r.watch("restaurant_type"),l=r.watch("features_selected")?.includes("qrcode"),o=X==="ghost",g=o?3:4;d.useEffect(()=>{const s=V.get("code");s&&l&&!o&&T(s)},[V,l,o]),d.useEffect(()=>{(!l||o)&&(r.setValue("invitation_code",""),f({isValidating:!1,isValid:null,inviterUserId:null}))},[l,o,r]),d.useEffect(()=>{o&&r.setValue("features_selected",["delivery"])},[o,r]);const T=async s=>{if(!s||s.length<6){f({isValidating:!1,isValid:null,inviterUserId:null});return}f({isValidating:!0,isValid:null,inviterUserId:null});try{const a=await Q.mutateAsync(s);f(a?{isValidating:!1,isValid:!0,inviterUserId:a.user_id}:{isValidating:!1,isValid:!1,inviterUserId:null})}catch{f({isValidating:!1,isValid:!1,inviterUserId:null})}},J=async()=>{let s=[];switch(n){case 1:s=["restaurant_type"];break;case 2:s=["name","email","phone"];break;case 3:s=["restaurant_name","restaurant_address"];break;case 4:o||(s=["features_selected"]);break}return await r.trigger(s)},K=async s=>{s.preventDefault(),s.stopPropagation(),await J()&&n<g&&S(h=>h+1)},Y=s=>{s.preventDefault(),s.stopPropagation(),n>1&&S(a=>a-1)},Z=async s=>{D(!0);try{const a=C.language||"en",h=o?["delivery"]:s.features_selected,{error:y}=await Se.functions.invoke("send-join-request-email",{body:{...s,features_selected:h,language:a,invitation_code:!o&&c.isValid?s.invitation_code:null,invited_by_user_id:!o&&c.inviterUserId?c.inviterUserId:null,restaurant_type:s.restaurant_type}});if(y){if(y.message.includes("rate_limit_exceeded"))w({title:t("joinUs.rateLimitError"),description:t("joinUs.rateLimitErrorDesc"),variant:"destructive"});else throw y;return}R(!0),r.reset(),S(1),w({title:t("joinUs.successTitle"),description:t("joinUs.successDescription")})}catch(a){console.error("Error submitting join request:",a),w({title:t("common.error"),description:t("joinUs.submitError"),variant:"destructive"})}finally{D(!1)}},ee=()=>{const s=C.language;return s==="zh"&&i?.join_success_title_zh?i.join_success_title_zh:s==="pt"&&i?.join_success_title_pt?i.join_success_title_pt:i?.join_success_title_en?i.join_success_title_en:t("joinUs.successTitle")},se=()=>{const s=C.language;return s==="zh"&&i?.join_success_message_zh?i.join_success_message_zh:s==="pt"&&i?.join_success_message_pt?i.join_success_message_pt:i?.join_success_message_en?i.join_success_message_en:t("joinUs.successMessage")},F=i?.join_contact_phone||"968815050",k=i?.contact_email,M=n/g*100;return H?e.jsx("div",{className:"min-h-screen pt-20 pb-12 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsx(O,{className:"border-primary",children:e.jsxs(A,{className:"pt-12 pb-12 text-center",children:[e.jsx(ie,{className:"w-16 h-16 text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-4",children:ee()}),e.jsx("p",{className:"text-muted-foreground mb-4 max-w-md mx-auto",children:se()}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6",children:[e.jsxs("a",{href:`tel:${F}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:F})]}),k&&e.jsxs("a",{href:`mailto:${k}`,className:"flex items-center gap-2 text-primary font-semibold hover:underline",children:[e.jsx(oe,{className:"w-5 h-5"}),e.jsx("span",{children:k})]})]}),e.jsx(_,{onClick:()=>R(!1),children:t("joinUs.submitAnother")})]})})})}):e.jsxs("div",{className:"min-h-screen pt-4 pb-12 px-4 bg-secondary/20",children:[e.jsx("div",{className:"container mx-auto max-w-2xl",children:e.jsxs(O,{children:[e.jsxs(ve,{className:"text-center space-y-2",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ce,{className:"w-12 h-12 text-primary"})}),e.jsx(Ne,{className:"text-3xl font-bold",children:t("joinUs.title")}),e.jsx(be,{className:"text-base",children:t("joinUs.description")})]}),e.jsxs("div",{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:t("joinUs.step",{current:n,total:g})}),e.jsxs("span",{className:"text-sm font-medium",children:[Math.round(M),"%"]})]}),e.jsx(Pe,{value:M,className:"h-2"}),e.jsx("div",{className:"flex justify-between mt-4",children:Array.from({length:g},(s,a)=>a+1).map(s=>e.jsx("div",{className:m("flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors",s<n?"bg-primary text-primary-foreground":s===n?"bg-primary text-primary-foreground ring-2 ring-primary ring-offset-2":"bg-muted text-muted-foreground"),children:s<n?e.jsx(U,{className:"w-4 h-4"}):s},s))})]}),e.jsx(A,{children:e.jsx(Ie,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Z),className:"space-y-6",children:[n===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:t("joinUs.selectRestaurantType")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("joinUs.selectRestaurantTypeDesc")})]}),e.jsx(x,{control:r.control,name:"restaurant_type",render:({field:s})=>e.jsxs(u,{children:[e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{onClick:()=>s.onChange("standard"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",s.value==="standard"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",s.value==="standard"?"bg-primary/10":"bg-muted"),children:e.jsx(de,{className:m("w-8 h-8",s.value==="standard"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t("joinUs.standardRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t("joinUs.standardRestaurantDesc")})]})]}),s.value==="standard"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(U,{className:"w-5 h-5 text-primary"})})]}),e.jsxs("div",{onClick:()=>s.onChange("ghost"),className:m("relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50",s.value==="ghost"?"border-primary bg-primary/5":"border-muted"),children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-3",children:[e.jsx("div",{className:m("p-3 rounded-full",s.value==="ghost"?"bg-primary/10":"bg-muted"),children:e.jsx(E,{className:m("w-8 h-8",s.value==="ghost"?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t("joinUs.ghostRestaurant")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t("joinUs.ghostRestaurantDesc")})]})]}),s.value==="ghost"&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx(U,{className:"w-5 h-5 text-primary"})}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),I(!0)},className:"absolute top-3 left-3 p-1 rounded-full hover:bg-muted transition-colors",children:e.jsx(me,{className:"w-4 h-4 text-muted-foreground"})})]})]})}),e.jsx(j,{})]})})]}),n===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(xe,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:t("joinUs.contactInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("joinUs.contactInfoDesc")})]}),e.jsx(x,{control:r.control,name:"name",render:({field:s})=>e.jsxs(u,{children:[e.jsx(N,{children:t("joinUs.name")}),e.jsx(p,{children:e.jsx(v,{placeholder:t("joinUs.namePlaceholder"),...s})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"email",render:({field:s})=>e.jsxs(u,{children:[e.jsx(N,{children:t("joinUs.email")}),e.jsx(p,{children:e.jsx(v,{type:"email",placeholder:t("joinUs.emailPlaceholder"),...s})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"phone",render:({field:s})=>e.jsxs(u,{children:[e.jsx(N,{children:t("joinUs.phone")}),e.jsx(p,{children:e.jsx(v,{type:"tel",placeholder:t("joinUs.phonePlaceholder"),...s})}),e.jsx(j,{})]})})]}),n===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(ue,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:t("joinUs.restaurantInfo")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("joinUs.restaurantInfoDesc")})]}),e.jsx(x,{control:r.control,name:"restaurant_name",render:({field:s})=>e.jsxs(u,{children:[e.jsx(N,{children:t("joinUs.restaurantName")}),e.jsx(p,{children:e.jsx(v,{placeholder:t("joinUs.restaurantNamePlaceholder"),...s})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"restaurant_address",render:({field:s})=>e.jsxs(u,{children:[e.jsx(N,{children:t("joinUs.restaurantAddress")}),e.jsx(p,{children:e.jsx(v,{placeholder:t("joinUs.restaurantAddressPlaceholder"),...s})}),e.jsx(j,{})]})})]}),n===4&&!o&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(q,{className:"w-8 h-8 text-primary"})}),e.jsx("h3",{className:"text-lg font-semibold",children:t("joinUs.featuresNeeded")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("joinUs.featuresDescription")})]}),e.jsx(x,{control:r.control,name:"features_selected",render:({field:s})=>e.jsxs(u,{children:[e.jsx("div",{className:"space-y-3",children:G.map(a=>{const h=s.value?.includes(a);return e.jsxs("div",{className:"flex flex-row items-center space-x-3 space-y-0 rounded-lg border p-4 cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>{h?s.onChange(s.value?.filter(y=>y!==a)):s.onChange([...s.value||[],a])},children:[e.jsx("div",{className:m("h-4 w-4 shrink-0 rounded-sm border flex items-center justify-center transition-colors",h?"bg-primary border-primary text-primary-foreground":"border-primary"),children:h&&e.jsx(U,{className:"h-3 w-3"})}),e.jsx("span",{className:"font-normal cursor-pointer flex-1 text-sm",children:t(`joinUs.feature.${a}`)})]},a)})}),e.jsx(j,{})]})}),e.jsx(x,{control:r.control,name:"invitation_code",render:({field:s})=>e.jsxs(u,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),t("joinUs.invitationCode"),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs",children:["(",t("joinUs.optional"),")"]})]}),e.jsx(p,{children:e.jsxs("div",{className:"relative",children:[e.jsx(v,{placeholder:t("joinUs.invitationCodePlaceholder","如有邀请码请输入"),...s,disabled:!l,onChange:a=>{s.onChange(a),l&&T(a.target.value)},onFocus:()=>{l||w({title:t("joinUs.qrcodeRequired","请先勾选扫码点餐"),description:t("joinUs.qrcodeRequiredDesc","只有选择扫码点餐功能后才能使用邀请码")})},className:m("pr-10",!l&&"cursor-not-allowed opacity-50")}),l&&c.isValidating&&e.jsx(L,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground"}),l&&!c.isValidating&&c.isValid===!0&&e.jsx(U,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-green-500"}),l&&!c.isValidating&&c.isValid===!1&&s.value&&e.jsx(je,{className:"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-red-500"})]})}),!l&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t("joinUs.qrcodeRequiredHint","需要勾选扫码点餐功能后才能填写邀请码")}),l&&c.isValid===!0&&e.jsx("p",{className:"text-xs text-green-600",children:t("joinUs.invitationCodeValid","邀请码有效")}),l&&c.isValid===!1&&s.value&&e.jsx("p",{className:"text-xs text-red-600",children:t("joinUs.invitationCodeInvalid","邀请码无效")}),e.jsx(j,{})]})})]}),n===g&&e.jsxs("div",{className:"text-xs text-muted-foreground text-center pb-4",children:[t("joinUs.consentText")," ",e.jsx(z,{to:"/privacy-policy",className:"text-primary hover:underline",children:t("joinUs.privacyPolicy")})," ",t("joinUs.and")," ",e.jsx(z,{to:"/terms-of-service",className:"text-primary hover:underline",children:t("joinUs.termsOfService")})]}),e.jsxs("div",{className:"flex justify-between gap-4 pt-4",children:[n>1?e.jsxs(_,{type:"button",variant:"outline",onClick:Y,className:"flex-1",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),t("joinUs.prev")]}):e.jsx("div",{className:"flex-1"}),n<g?e.jsxs(_,{type:"button",onClick:K,className:"flex-1",children:[t("joinUs.next"),e.jsx(pe,{className:"w-4 h-4 ml-2"})]}):e.jsxs(_,{type:"submit",className:"flex-1",disabled:P,children:[P&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),t("joinUs.submit")]})]}),e.jsx("div",{className:"text-center pt-4",children:e.jsxs("button",{type:"button",onClick:()=>ye("https://xiaoxiong.pt/en/pages/subscription"),className:"inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[t("joinUs.visitOurWebsite","访问我们的官网查看详细信息"),e.jsx(fe,{className:"w-3 h-3"})]})})]})})})]})}),e.jsx(Ue,{open:B,onOpenChange:I,children:e.jsxs(_e,{className:"sm:max-w-md",children:[e.jsxs(we,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"}),t("joinUs.ghostRestaurantInfoTitle")]}),e.jsx(Ve,{asChild:!0,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx("p",{children:t("joinUs.ghostRestaurantInfo1")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium text-foreground",children:t("joinUs.ghostRestaurantFeatures")}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[e.jsx("li",{children:t("joinUs.ghostRestaurantFeature1")}),e.jsx("li",{children:t("joinUs.ghostRestaurantFeature2")}),e.jsx("li",{children:t("joinUs.ghostRestaurantFeature3")})]})]}),e.jsx("p",{className:"text-sm",children:t("joinUs.ghostRestaurantInfo2")})]})})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(_,{onClick:()=>I(!1),children:t("common.gotIt")})})]})})]})};export{Ge as default};
//# sourceMappingURL=JoinUs-DrjvbiVN.js.map
