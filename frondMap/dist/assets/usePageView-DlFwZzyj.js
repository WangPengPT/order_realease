import{r as i}from"./vendor-react-iAJ0IrSD.js";import{u as l,s as a}from"./index-Bc-ZO2b2.js";const s="location_cache",u=()=>{const r="visitor_id";let t=localStorage.getItem(r);return t||(t=crypto.randomUUID(),localStorage.setItem(r,t)),t},y=()=>{try{const r=sessionStorage.getItem(s);if(r)return JSON.parse(r)}catch{}return null},g=r=>{try{sessionStorage.setItem(s,JSON.stringify(r))}catch{}},f=async()=>{const r=y();if(r)return r;try{const{data:t,error:o}=await a.functions.invoke("get-location");if(o)return console.error("Failed to fetch location:",o),{country:null,city:null,region:null};const e={country:t?.country||null,city:t?.city||null,region:t?.region||null,ip:t?.ip||null};return(e.country||e.city)&&g(e),e}catch(t){return console.error("Failed to fetch location data:",t),{country:null,city:null,region:null}}},p=({pageType:r,targetId:t})=>{const{user:o}=l(),e=i.useRef(!1);i.useEffect(()=>{if(e.current)return;e.current=!0,(async()=>{try{const n=u(),c=await f();await a.from("page_views").insert({page_type:r,target_id:t||null,visitor_id:n,user_id:o?.id||null,user_agent:navigator.userAgent,referer:document.referrer||null,country:c.country,city:c.city,region:c.region})}catch(n){console.error("Failed to track page view:",n)}})()},[r,t,o?.id])};export{p as u};
//# sourceMappingURL=usePageView-DlFwZzyj.js.map
