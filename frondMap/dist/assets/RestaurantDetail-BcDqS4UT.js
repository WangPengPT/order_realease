const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-C1-_eqtC.js","assets/vendor-ui-DAmPMpEA.js","assets/vendor-react-iAJ0IrSD.js","assets/index-BcrfGQEh.js","assets/vendor-i18n-DxKeo2S1.js","assets/vendor-charts-Bz7hPIBd.js","assets/vendor-query-BlSVl3IQ.js","assets/vendor-supabase-KNAP0qdW.js","assets/index-Dc9HR9RS.css","assets/ReportDialog-Dvxx6D6B.js","assets/input-otp-BAhwknvE.js","assets/shield-alert-DewI1FnT.js","assets/plus-CN0JuuEq.js","assets/useSensitiveWords-Ca2n4Wak.js","assets/clock-DGED8Oob.js","assets/circle-alert-LTD3IVAL.js","assets/star-DqKRai6M.js","assets/image-C10sDEfq.js","assets/volume-x-DCede4Rw.js"])))=>i.map(i=>d[i]);
import{u as Z,_ as Ye}from"./vendor-i18n-DxKeo2S1.js";import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as n,j as Je,f as Qe,u as Ze,L as le}from"./vendor-react-iAJ0IrSD.js";import{r as me,h as i,C,i as k,j as D,t as he,d as es,s as ss,B as w,v as G,D as ts,a as as,X as rs,w as ns,n as is,x as ls,y as A,z as os,A as cs,E as ds,F as _,G as be,q as oe,M as ms,P as hs,L as P,J as ye,K as _e,N as Ce,O as ke,Q as De,R as Se,T as Re,V as ze}from"./index-BcrfGQEh.js";import{S as Ie}from"./separator-CM8vz3w9.js";import{C as W,a as V,b as H}from"./collapsible-D8JvcdyC.js";import{d as us,a as xs,c as gs}from"./useRestaurants-Bz5Pv7_Q.js";import{u as Te,D as ps,R as fs}from"./ReportDialog-Dvxx6D6B.js";import{u as js}from"./useLocalizedContent-tJ7i_ycU.js";import{f as Ns,N as ws}from"./timeUtils-DgGT_sRJ.js";import{g as vs,c as bs,N as Me,o as ys}from"./geolocation-DjMp4CuT.js";import{c as ce,b as _s,m as Cs}from"./externalLinks-DoJcn4fI.js";import{S as de}from"./star-DqKRai6M.js";import{m as E}from"./vendor-map-BaCLwlqt.js";import{u as ks}from"./usePageView-CqD0tuwr.js";import{u as Ds}from"./useActivityParticipation-ChrDiqMd.js";import{u as Ss,R as Rs}from"./RestaurantFormDialog-3oDjvZXU.js";import{a as zs}from"./vendor-query-BlSVl3IQ.js";import{u as Oe}from"./use-mobile-B0RZNQEx.js";import{C as Is,a as Ms,b as Ls,c as $s,d as Ts}from"./carousel-BxHNJlLZ.js";import{I as Os}from"./image-C10sDEfq.js";import{C as Ae}from"./chevron-left-BHcY9IrV.js";import{H as As}from"./heart-ClAJibHi.js";import{S as F}from"./share-2-BQXZmVW4.js";import{M as q}from"./message-circle-C4oJUb2D.js";import{L as Ps}from"./link-2-gMUYL1jG.js";import{S as Es}from"./square-pen-B33wHQe-.js";import{S as Fs}from"./shield-alert-DewI1FnT.js";import{C as qs}from"./clock-DGED8Oob.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";import"./index-DPX4vtt3.js";import"./input-otp-BAhwknvE.js";import"./plus-CN0JuuEq.js";import"./index.esm-CVRqJy9l.js";import"./types-CpDVS0Ep.js";/* empty css                  */import"./checkbox-4ejPvdP9.js";import"./switch-6XNkJMpb.js";import"./tabs-C_tzE0Ci.js";import"./upload-DGLlOmKj.js";import"./grip-vertical-CMonN56R.js";import"./RichTextEditor--UO8SiL1.js";import"./vendor-editor-BxSQdrX3.js";import"./key-B-h86fwt.js";import"./arrow-left-4K88mBFI.js";import"./arrow-right-D-aBf8aw.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=me("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=me("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vs=me("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]),Hs=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(i,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(i,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(i,{className:"h-10 w-10 rounded-md"}),e.jsx(i,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(C,{className:"shadow-large",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(i,{className:"h-6 w-16 rounded-full"}),e.jsx(i,{className:"h-6 w-20 rounded-full"}),e.jsx(i,{className:"h-6 w-14 rounded-full"})]}),e.jsx(i,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(i,{className:"h-5 w-20"}),e.jsx(i,{className:"h-5 w-24"}),e.jsx(i,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-10 w-28 rounded-md"}),e.jsx(i,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-5 w-24"}),e.jsx(i,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-8 w-24 rounded-full"}),e.jsx(i,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(i,{className:"h-5 w-full"}),e.jsx(i,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(i,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(i,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(i,{className:"h-5 w-40"}),e.jsx(i,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(C,{className:"mt-6 shadow-large",children:[e.jsx(k,{children:e.jsx(i,{className:"h-6 w-20"})}),e.jsx(D,{children:e.jsx(i,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(C,{className:"mt-6 shadow-large",children:[e.jsx(k,{children:e.jsx(i,{className:"h-6 w-24"})}),e.jsx(D,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(c=>e.jsx(i,{className:"h-24 w-24 rounded-lg flex-shrink-0"},c))})})]}),e.jsxs(C,{className:"mt-6 shadow-large",children:[e.jsxs(k,{className:"flex flex-row items-center justify-between",children:[e.jsx(i,{className:"h-6 w-32"}),e.jsx(i,{className:"h-9 w-24 rounded-md"})]}),e.jsx(D,{className:"space-y-4",children:[1,2,3].map(c=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(i,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-4 w-24"}),e.jsx(i,{className:"h-4 w-16"})]}),e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-3/4"})]})]},c))})]})]})]}),Us=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],Ks=({restaurantId:c})=>{const{t:x}=Z(),{data:a}=Te(c,"restaurant"),d=a?.filter(l=>l.rating_value)||[],p=d.length?d.reduce((l,h)=>l+(h.rating_value||0),0)/d.length:0,g=[5,4,3,2,1].map(l=>({star:l,count:d.filter(h=>h.rating_value===l).length,percentage:d.length?(d.filter(h=>h.rating_value===l).length/d.length*100).toFixed(0):0})),j=d.reduce((l,h)=>(h.price_range&&(l[h.price_range]=(l[h.price_range]||0)+1),l),{}),v=j&&Object.keys(j).length>0?Object.entries(j).sort((l,h)=>h[1]-l[1])[0]:null;return e.jsxs(C,{children:[e.jsx(k,{children:e.jsx(he,{children:x("restaurant.rating")})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:p.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(l=>e.jsx(de,{className:es("w-5 h-5",l<=Math.round(p)?"fill-accent text-accent":"text-muted-foreground")},l))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[d.length," ",x("restaurant.ratingsCount")]}),v&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(ps,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:Us.find(l=>l.value===v[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:g.map(({star:l,count:h,percentage:S})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[l," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${S}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:h})]},l))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:x("restaurant.signInToRate")})]})]})},Bs=c=>(Z(),zs({queryKey:["restaurant-activities",c],queryFn:async()=>{const{data:x,error:a}=await ss.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",c);if(a)throw a;const d=new Date;return x.filter(g=>{const j=g.activities;if(!j)return!1;const v=new Date(j.start_date),l=j.end_date?new Date(j.end_date):null;return v<=d&&(!l||l>=d)}).map(g=>({activity_id:g.activity_id,title_zh:g.activities.title_zh,title_en:g.activities.title_en,title_pt:g.activities.title_pt,intro_zh:g.activities.intro_zh,intro_en:g.activities.intro_en,intro_pt:g.activities.intro_pt,badge_text_zh:g.activities.badge_text_zh,badge_text_en:g.activities.badge_text_en,badge_text_pt:g.activities.badge_text_pt,badge_color:g.activities.badge_color}))},enabled:!!c})),Xs=(c,x)=>x==="zh"?c.title_zh:x==="pt"?c.title_pt:c.title_en,Le=(c,x)=>{let a="";return x==="zh"?a=c.badge_text_zh||c.title_zh:x==="pt"?a=c.badge_text_pt||c.title_pt:a=c.badge_text_en||c.title_en,a},Ys=(c,x)=>x==="zh"?c.intro_zh||"":x==="pt"?c.intro_pt||"":c.intro_en||"",$e="dish-gallery-view-mode";function Js({restaurantId:c,showGallery:x=!0}){const{t:a}=Z(),{data:d=[],isLoading:p}=Ss(c),[g,j]=n.useState(!1),[v,l]=n.useState(0),[h,S]=n.useState(!1),R=Oe(),[b,U]=n.useState(()=>{if(typeof window<"u"){const o=localStorage.getItem($e);return o==="single"||o==="multi"?o:"multi"}return"multi"});n.useEffect(()=>{localStorage.setItem($e,b)},[b]);const y=n.useCallback(o=>{l(o),j(!0)},[]),M=n.useCallback(()=>{j(!1)},[]),z=n.useCallback(()=>{l(o=>o===0?d.length-1:o-1)},[d.length]),L=n.useCallback(()=>{l(o=>o===d.length-1?0:o+1)},[d.length]),$=n.useCallback(o=>{o.key==="ArrowLeft"&&z(),o.key==="ArrowRight"&&L(),o.key==="Escape"&&M()},[z,L,M]);if(p||!x||!d.length)return null;const ee=()=>R&&b==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(C,{children:e.jsxs(W,{open:!h,onOpenChange:o=>S(!o),children:[e.jsx(k,{className:"pb-3",children:e.jsx(V,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{className:"text-lg flex items-center gap-2",children:[e.jsx(Os,{className:"w-5 h-5"}),a("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",d.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[R&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:o=>o.stopPropagation(),children:[e.jsx(w,{variant:b==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:o=>{o.stopPropagation(),U("single")},title:a("dishImages.singleView"),children:e.jsx(Ws,{className:"h-4 w-4"})}),e.jsx(w,{variant:b==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:o=>{o.stopPropagation(),U("multi")},title:a("dishImages.multiView"),children:e.jsx(Gs,{className:"h-4 w-4"})})]}),e.jsx(G,{className:`w-5 h-5 text-muted-foreground transition-transform ${h?"":"rotate-180"}`})]})]})})}),e.jsx(H,{children:e.jsxs(D,{children:[e.jsxs(Is,{className:"w-full",children:[e.jsx(Ms,{className:"-ml-2 md:-ml-4",children:d.map((o,K)=>e.jsx(Ls,{className:ee(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>y(K),children:e.jsx("img",{src:o.image_url,alt:`Dish ${K+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},o.id))}),d.length>(R&&b==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx($s,{className:"-left-3 md:-left-4"}),e.jsx(Ts,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:a("dishImages.clickToEnlarge")})]})})]})}),e.jsx(ts,{open:g,onOpenChange:j,children:e.jsx(as,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:$,children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(w,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:M,children:e.jsx(rs,{className:"w-6 h-6"})}),d.length>1&&e.jsx(w,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:z,children:e.jsx(Ae,{className:"w-8 h-8"})}),e.jsx("img",{src:d[v]?.image_url,alt:`Dish ${v+1}`,className:"max-w-full max-h-[85vh] object-contain"}),d.length>1&&e.jsx(w,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:L,children:e.jsx(ns,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[v+1," / ",d.length]})]})})})]})}const Qs=n.lazy(()=>Ye(()=>import("./RestaurantComments-C1-_eqtC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]))),Xt=()=>{const{id:c}=Je(),x=Qe(),{t:a,i18n:d}=Z(),{user:p}=is(),{localizeRestaurant:g,getLocalizedField:j}=js(),v=Oe(),l=n.useRef(null),h=n.useRef(null),[S,R]=n.useState(null),[b,U]=n.useState(!1),[y,M]=n.useState(!0),[z,L]=n.useState(!1),[$,ee]=n.useState(!1),[o,K]=n.useState(!0),[B,Pe]=n.useState(!0),[se,Zs]=n.useState(!1),te=n.useRef(null),ae=n.useRef(null),[Ee,re]=n.useState(!1),[Fe,X]=n.useState(!1),[qe,ue]=n.useState(!1),Ge=Ze();ks({pageType:"restaurant",targetId:c});const xe=x.state?.fromActivity,ge=x.state?.from==="admin"?"/admin/restaurants":xe?`/activity/${xe}`:"/restaurants",{data:s,isLoading:We}=us(c),{data:Ve=[]}=xs(),{data:Y}=Te(c,"restaurant",{enabled:B}),pe=gs(),{role:st,isAdmin:fe}=ls(),{data:He=[]}=Ds(),{data:ne=[]}=Bs(c),je=s&&He.some(t=>t.id===s.id),f=s?g(s):null,Ue=s?Ve.includes(s.id):!1;n.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const I=n.useMemo(()=>{const t={};return Y?.forEach(r=>{r.price_range&&(t[r.price_range]||(t[r.price_range]={count:0,latestDate:r.created_at}),t[r.price_range].count+=1,r.created_at>t[r.price_range].latestDate&&(t[r.price_range].latestDate=r.created_at))}),t},[Y]),Ne=n.useMemo(()=>I?Object.values(I).reduce((t,r)=>t+r.count,0):0,[I]),we=n.useMemo(()=>!I||Ne<10?null:Object.entries(I).sort(([,r],[,u])=>u.count!==r.count?u.count-r.count:u.latestDate.localeCompare(r.latestDate))[0]?.[0]||null,[I,Ne]),{ratingCount:ie,averageRating:Ke}=n.useMemo(()=>{const t=Y?.filter(m=>m.rating_value)||[],r=t.length,u=r>0?t.reduce((m,N)=>m+(N.rating_value||0),0)/r:0;return{ratingCount:r,averageRating:u}},[Y]);n.useEffect(()=>{s&&vs().then(t=>{const r=bs(t.coords.latitude,t.coords.longitude,s.lat,s.lng);R(r)}).catch(()=>{R(null)})},[s]);const Be=n.useCallback(()=>{!p||!s||pe.mutate(s.id)},[p,s,pe]),T=n.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),A.success(a("common.linkCopied"))}catch(t){console.error("Error copying link:",t),A.error(a("common.shareError"))}},[a]),ve=n.useCallback(async()=>{if(!s||!f)return;const t={title:f.name,text:`${f.name} - Xiaoxiong Market

${f.description||f.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(t)?(await navigator.share(t),A.success(a("common.shareSuccess"))):T()}catch(r){r.name!=="AbortError"&&(console.error("Error sharing:",r),A.error(a("common.shareError")))}},[s,f,T,a]),O=n.useCallback(t=>{if(!s||!f)return;const r=encodeURIComponent(window.location.href),u=encodeURIComponent(f.name);let m="";switch(t){case"whatsapp":m=`https://wa.me/?text=${u}%20${r}`;break;case"facebook":m=`https://www.facebook.com/sharer/sharer.php?u=${r}`;break;case"twitter":m=`https://twitter.com/intent/tweet?text=${u}&url=${r}`;break;case"telegram":m=`https://t.me/share/url?url=${r}&text=${u}`;break;case"wechat":T(),A.info(a("common.shareVia")+" WeChat");return;default:return}ce()?window.location.href=m:window.open(m,"_blank","width=600,height=400")},[s,f,T,a]);return n.useEffect(()=>{const t=new IntersectionObserver(u=>{u.forEach(m=>{m.isIntersecting&&!o&&K(!0)})},{rootMargin:"100px"}),r=new IntersectionObserver(u=>{u.forEach(m=>{m.isIntersecting&&!B&&Pe(!0)})},{rootMargin:"200px"});return te.current&&t.observe(te.current),ae.current&&r.observe(ae.current),()=>{t.disconnect(),r.disconnect()}},[o,B]),n.useEffect(()=>{if(!l.current||!s||!o||!y||h.current)return;const t="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!E.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:_s(),isIOSWebView:ce(),userAgent:navigator.userAgent});return}const r=()=>{if(!l.current)return;const u=l.current.getBoundingClientRect();if(console.log("[RestaurantDetail Map] Container dimensions:",u.width,u.height),u.width===0||u.height===0){setTimeout(r,100);return}try{E.accessToken=t,h.current=new E.Map({container:l.current,style:"mapbox://styles/mapbox/light-v11",center:[s.lng,s.lat],zoom:15,cooperativeGestures:!0}),h.current.on("error",N=>{console.error("[RestaurantDetail Map] Map error:",N)});const m=document.createElement("div");m.style.backgroundImage=`url(${Cs})`,m.style.width="40px",m.style.height="40px",m.style.backgroundSize="contain",m.style.backgroundRepeat="no-repeat",m.style.backgroundPosition="center",m.style.cursor="pointer",new E.Marker({element:m}).setLngLat([s.lng,s.lat]).addTo(h.current),h.current.addControl(new E.NavigationControl)}catch(m){console.error("[RestaurantDetail Map] Failed to initialize map:",m)}};return setTimeout(r,50),()=>{h.current?.remove(),h.current=null}},[s,o,y]),n.useEffect(()=>{if(y&&h.current){const t=setTimeout(()=>{h.current?.resize(),s&&h.current?.setCenter([s.lng,s.lat])},350);return()=>clearTimeout(t)}},[y,s]),We?e.jsx(Hs,{}):!s||!f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:a("error.notFound")}),e.jsx(w,{asChild:!0,className:"mt-4",children:e.jsx(le,{to:ge,children:a("common.back")})})]})}):e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:f.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(w,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(le,{to:ge,children:e.jsx(Ae,{className:"w-5 h-5"})})}),p&&e.jsx(w,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:Be,children:e.jsx(As,{className:`w-5 h-5 ${Ue?"fill-destructive text-destructive":""}`})}),v&&navigator.share?e.jsx(w,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${p?"right-16":"right-4"}`,onClick:()=>{if(!p){X(!0);return}ve()},children:e.jsx(F,{className:"w-5 h-5"})}):e.jsxs(os,{children:[e.jsx(cs,{asChild:!0,children:e.jsx(w,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${p?"right-16":"right-4"}`,onClick:t=>{p||(t.preventDefault(),X(!0))},children:e.jsx(F,{className:"w-5 h-5"})})}),e.jsxs(ds,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(_,{onClick:ve,children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),a("common.moreOptions")]}),e.jsx(be,{})]}),e.jsxs(_,{onClick:()=>O("wechat"),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(_,{onClick:()=>O("whatsapp"),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(_,{onClick:()=>O("facebook"),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(_,{onClick:()=>O("twitter"),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(_,{onClick:()=>O("telegram"),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(be,{}),e.jsxs(_,{onClick:T,children:[e.jsx(Ps,{className:"w-4 h-4 mr-2"}),a("common.copyLink")]})]})]}),(je||fe)&&s&&e.jsx(Rs,{restaurant:s,trigger:e.jsx(w,{variant:"secondary",size:"icon",className:`absolute top-4 ${p?"right-28":"right-16"}`,children:e.jsx(Es,{className:"w-5 h-5"})})}),s&&e.jsx(fs,{targetType:"restaurant",targetId:s.id,onLoginRequired:()=>X(!0),trigger:e.jsx(w,{variant:"secondary",size:"icon",className:`absolute top-4 ${je||fe?p?"right-40":"right-28":p?"right-28":"right-16"}`,children:e.jsx(Fs,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(C,{className:"shadow-large",children:[e.jsx(k,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:f.type.slice(0,3).map((t,r)=>e.jsx(oe,{variant:"secondary",children:t},r))}),e.jsx(he,{className:"text-3xl mb-2",children:f.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[S!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[S.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{className:`w-5 h-5 ${ie>0?"fill-accent text-accent":"text-muted-foreground"}`}),ie>0?e.jsxs("span",{className:"font-semibold text-base",children:[Ke.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",ie,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:a("restaurant.noRatingWithHint")})]}),we&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:we})]})]}),f.description&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:f.description}})]})})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[ne.length>0&&e.jsxs(W,{open:$,onOpenChange:ee,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(de,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:a("activities.title")}),!$&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:ne.map((t,r)=>e.jsx(oe,{variant:"default",className:"text-white",style:{backgroundColor:t.badge_color||"#9b87f5"},children:Le(t,d.language)},`activity-${r}`))})]}),e.jsx(G,{className:`w-5 h-5 text-muted-foreground transition-transform ${$?"rotate-180":""}`})]})}),e.jsx(H,{className:"mt-3 space-y-2",children:ne.map((t,r)=>{const u=Ys(t,d.language);return e.jsxs(le,{to:`/activity/${t.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(oe,{variant:"default",className:"text-white mr-2",style:{backgroundColor:t.badge_color||"#9b87f5"},children:Le(t,d.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[u||Xs(t,d.language)," ... →"]})]},`activity-detail-${r}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ms,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:a("restaurant.address")}),e.jsx("p",{className:"text-muted-foreground",children:s.address})]})]}),s.phone&&e.jsxs("a",{href:`tel:${s.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(hs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:a("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:s.phone})]})]}),s.opening_hours&&e.jsxs(W,{open:b,onOpenChange:U,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(qs,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:a("restaurant.hours")}),!b&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[a("restaurant.today")," ",Ns(s.opening_hours)]})]}),e.jsx(G,{className:`w-5 h-5 text-muted-foreground transition-transform ${b?"rotate-180":""}`})]})}),e.jsx(H,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],r={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},u=t[new Date().getDay()===0?6:new Date().getDay()-1];return t.map(m=>{const N=s.opening_hours[m],J=m===u,Xe=a(`restaurant.${r[m]}`);let Q="N/A";return N&&(N.closed?Q=a("restaurant.closed"):N.splitShift?Q=`${N.open} - ${N.close}, ${N.open2} - ${N.close2}`:Q=`${N.open} - ${N.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${J?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${J?"text-primary":"text-foreground"}`,children:[Xe,J&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",a("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${J?"text-primary font-semibold":"text-muted-foreground"} ${N?.closed?"italic":""}`,children:Q})]},m)})})()})})]})]}),s&&(j(s,"announcement")||s.announcement_zh)&&e.jsxs(W,{open:z,onOpenChange:L,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(q,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:a("restaurant.announcement")}),e.jsx(G,{className:`w-5 h-5 text-muted-foreground transition-transform ${z?"rotate-180":""}`})]})}),e.jsx(H,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:j(s,"announcement")||s.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(w,{variant:"secondary",className:"w-full",onClick:()=>re(!0),children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),a("restaurant.getDirections")]}),s.show_website_button&&s.website_url&&e.jsxs(w,{className:"w-full",disabled:se,onClick:()=>ue(!0),children:[se?e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(q,{className:"w-4 h-4 mr-2"}),a("restaurant.joinPrivate")]})]}),e.jsx(ws,{open:Ee,onOpenChange:re,onConfirm:()=>{ys(s.lat,s.lng,f.name),re(!1)},destinationName:f.name}),e.jsx(ye,{open:qe,onOpenChange:ue,children:e.jsxs(_e,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:a("restaurant.joinPrivateTitle")}),e.jsx(De,{children:a("restaurant.joinPrivateDescription")})]}),e.jsxs(Se,{children:[e.jsx(Re,{children:a("common.cancel")}),e.jsxs(ze,{onClick:()=>{const t=new URL(s.website_url);p&&t.searchParams.set("user_id",p.id);const r=t.toString();ce()?window.location.href=r:window.open(r,"_blank")},children:[se?e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}):null,a("restaurant.joinPrivateConfirm")]})]})]})}),e.jsx(Js,{restaurantId:s.id,showGallery:s.show_dish_gallery!==!1}),e.jsx("div",{ref:te,children:e.jsxs(W,{open:y,onOpenChange:M,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(V,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:a("restaurant.map")}),e.jsx(G,{className:`w-5 h-5 text-muted-foreground transition-transform ${y?"rotate-180":""}`})]})}),e.jsx(H,{children:o?e.jsx("div",{ref:l,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Ie,{}),e.jsx(Ks,{restaurantId:s.id}),e.jsx(Ie,{}),e.jsx("div",{ref:ae,children:B?e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(Qs,{restaurantId:s.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(ye,{open:Fe,onOpenChange:X,children:e.jsxs(_e,{children:[e.jsxs(Ce,{children:[e.jsx(ke,{children:a("activities.loginRequired")}),e.jsx(De,{children:a("activities.loginRequiredMessage")})]}),e.jsxs(Se,{children:[e.jsx(Re,{children:a("common.cancel")}),e.jsx(ze,{onClick:()=>Ge("/auth"),children:a("activities.goToLogin")})]})]})})]})};export{Xt as default};
//# sourceMappingURL=RestaurantDetail-BcDqS4UT.js.map
