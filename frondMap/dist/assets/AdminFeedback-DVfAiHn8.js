import{u as B,ad as P,r as k,p as I,ae as F,j as e,au as Q,af as V,ag as K,ah as L,ai as O,aj as c,C as U,e as z,o as W,an as X,f as G,K as J,B as o,N as Y,ar as Z,O as $,Q as ee,R as ae,T as se,U as te,V as ie,W as re,D as ne,t as de,a4 as le,a5 as ce,a6 as oe,a7 as l,ak as me,s as f,z as g,n as m}from"./index-DVul3rRI.js";import{T as ue,a as xe,b as T,c as r,d as he,e as n}from"./table-DNURx4s1.js";import{I as fe}from"./image-D5R4LjR2.js";import{E as v}from"./eye-BCkNdHAq.js";import{T as ge}from"./trash-2-i8G4gdCQ.js";import{C as A}from"./circle-check-big-CKVGoSN1.js";import{C as _}from"./circle-x-Cr8oK9Vh.js";import{C as je}from"./clock-B_uRC1lR.js";import{f as R}from"./format-Il-ANUNE.js";import"./startOfDay-BNzNGG7l.js";const Fe=()=>{const{t:a}=B(),N=P(),[u,E]=k.useState("all"),[t,j]=k.useState(null),[w,y]=k.useState(""),{data:d,isLoading:M}=I({queryKey:["admin-feedback",u],queryFn:async()=>{let s=f.from("feedback").select("*").order("created_at",{ascending:!1});u!=="all"&&(s=s.eq("status",u));const{data:i,error:h}=await s;if(h)throw h;return i}}),x=F({mutationFn:async({id:s,status:i,notes:h})=>{const{data:{user:p}}=await f.auth.getUser(),{error:S}=await f.from("feedback").update({status:i,admin_notes:h||null,reviewed_at:new Date().toISOString(),reviewed_by:p==null?void 0:p.id}).eq("id",s);if(S)throw S},onSuccess:()=>{N.invalidateQueries({queryKey:["admin-feedback"]}),g.success(a("admin.feedback.updateSuccess","Feedback status updated")),j(null)},onError:s=>{console.error("Error updating feedback:",s),g.error(a("admin.feedback.updateError","Failed to update feedback"))}}),q=F({mutationFn:async s=>{const{error:i}=await f.from("feedback").delete().eq("id",s);if(i)throw i},onSuccess:()=>{N.invalidateQueries({queryKey:["admin-feedback"]}),g.success(a("admin.feedback.deleteSuccess","Feedback deleted"))},onError:s=>{console.error("Error deleting feedback:",s),g.error(a("admin.feedback.deleteError","Failed to delete feedback"))}}),C=s=>{switch(s){case"pending":return e.jsxs(m,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),a("admin.feedback.status.pending","Pending")]});case"reviewing":return e.jsxs(m,{variant:"outline",className:"flex items-center gap-1 border-yellow-500 text-yellow-600",children:[e.jsx(v,{className:"h-3 w-3"}),a("admin.feedback.status.reviewing","Reviewing")]});case"resolved":return e.jsxs(m,{variant:"default",className:"flex items-center gap-1 bg-green-500",children:[e.jsx(A,{className:"h-3 w-3"}),a("admin.feedback.status.resolved","Resolved")]});case"dismissed":return e.jsxs(m,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),a("admin.feedback.status.dismissed","Dismissed")]});default:return e.jsx(m,{variant:"secondary",children:s})}},D=s=>({bug:a("feedback.reasons.bug","Bug"),suggestion:a("feedback.reasons.suggestion","Suggestion"),feature:a("feedback.reasons.feature","Feature Request"),complaint:a("feedback.reasons.complaint","Complaint"),praise:a("feedback.reasons.praise","Praise"),other:a("feedback.reasons.other","Other")})[s]||s,H=s=>{j(s),y(s.admin_notes||"")},b=s=>{t&&x.mutate({id:t.id,status:s,notes:w})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Q,{className:"h-6 w-6"}),a("admin.feedback.title","User Feedback")]}),e.jsx("p",{className:"text-muted-foreground",children:a("admin.feedback.description","View and manage user feedback submissions")})]}),e.jsxs(V,{value:u,onValueChange:E,children:[e.jsx(K,{className:"w-[180px]",children:e.jsx(L,{placeholder:a("admin.feedback.filterByStatus","Filter by status")})}),e.jsxs(O,{children:[e.jsx(c,{value:"all",children:a("admin.feedback.allStatus","All Status")}),e.jsx(c,{value:"pending",children:a("admin.feedback.status.pending","Pending")}),e.jsx(c,{value:"reviewing",children:a("admin.feedback.status.reviewing","Reviewing")}),e.jsx(c,{value:"resolved",children:a("admin.feedback.status.resolved","Resolved")}),e.jsx(c,{value:"dismissed",children:a("admin.feedback.status.dismissed","Dismissed")})]})]})]}),e.jsxs(U,{children:[e.jsxs(z,{children:[e.jsx(W,{children:a("admin.feedback.listTitle","Feedback List")}),e.jsxs(X,{children:[(d==null?void 0:d.length)||0," ",a("admin.feedback.totalCount","feedback submissions")]})]}),e.jsx(G,{children:M?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(J,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):d&&d.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ue,{children:[e.jsx(xe,{children:e.jsxs(T,{children:[e.jsx(r,{children:a("admin.feedback.email","Email")}),e.jsx(r,{children:a("admin.feedback.reason","Type")}),e.jsx(r,{className:"max-w-[300px]",children:a("admin.feedback.content","Content")}),e.jsx(r,{children:a("admin.feedback.image","Image")}),e.jsx(r,{children:a("admin.feedback.status","Status")}),e.jsx(r,{children:a("admin.feedback.createdAt","Submitted")}),e.jsx(r,{className:"text-right",children:a("common.actions","Actions")})]})}),e.jsx(he,{children:d.map(s=>e.jsxs(T,{children:[e.jsx(n,{className:"font-medium",children:s.email}),e.jsx(n,{children:D(s.reason)}),e.jsx(n,{className:"max-w-[300px] truncate",children:s.content}),e.jsx(n,{children:s.image_url?e.jsx("a",{href:s.image_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx(fe,{className:"h-4 w-4 text-primary"})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(n,{children:C(s.status)}),e.jsx(n,{children:R(new Date(s.created_at),"yyyy-MM-dd HH:mm")}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>H(s),children:e.jsx(v,{className:"h-4 w-4"})}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive",children:e.jsx(ge,{className:"h-4 w-4"})})}),e.jsxs($,{children:[e.jsxs(ee,{children:[e.jsx(ae,{children:a("admin.feedback.confirmDelete","Delete Feedback?")}),e.jsx(se,{children:a("admin.feedback.confirmDeleteDesc","This action cannot be undone.")})]}),e.jsxs(te,{children:[e.jsx(ie,{children:a("common.cancel")}),e.jsx(re,{onClick:()=>q.mutate(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:a("common.delete")})]})]})]})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:a("admin.feedback.noFeedback","No feedback submissions yet")})})]}),e.jsx(ne,{open:!!t,onOpenChange:()=>j(null),children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsxs(le,{children:[e.jsx(ce,{children:a("admin.feedback.details","Feedback Details")}),e.jsx(oe,{children:t&&R(new Date(t.created_at),"yyyy-MM-dd HH:mm:ss")})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:a("admin.feedback.email","Email")}),e.jsx("p",{className:"font-medium",children:t.email})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:a("admin.feedback.reason","Type")}),e.jsx("p",{className:"font-medium",children:D(t.reason)})]})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:a("admin.feedback.content","Content")}),e.jsx("div",{className:"mt-1 p-3 bg-muted rounded-md whitespace-pre-wrap",children:t.content})]}),t.image_url&&e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:a("admin.feedback.image","Screenshot")}),e.jsx("div",{className:"mt-1",children:e.jsx("a",{href:t.image_url,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:t.image_url,alt:"Feedback screenshot",className:"max-h-48 rounded-md border cursor-pointer hover:opacity-80 transition-opacity"})})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-muted-foreground",children:a("admin.feedback.currentStatus","Current Status")}),e.jsx("div",{className:"mt-1",children:C(t.status)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"admin-notes",children:a("admin.feedback.adminNotes","Admin Notes")}),e.jsx(me,{id:"admin-notes",value:w,onChange:s=>y(s.target.value),placeholder:a("admin.feedback.adminNotesPlaceholder","Add notes for this feedback..."),rows:3,className:"mt-1"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>b("reviewing"),disabled:x.isPending,children:[e.jsx(v,{className:"mr-2 h-4 w-4"}),a("admin.feedback.markReviewing","Mark as Reviewing")]}),e.jsxs(o,{variant:"default",className:"bg-green-600 hover:bg-green-700",onClick:()=>b("resolved"),disabled:x.isPending,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),a("admin.feedback.markResolved","Mark as Resolved")]}),e.jsxs(o,{variant:"destructive",onClick:()=>b("dismissed"),disabled:x.isPending,children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),a("admin.feedback.markDismissed","Dismiss")]})]})]})]})})]})};export{Fe as default};
