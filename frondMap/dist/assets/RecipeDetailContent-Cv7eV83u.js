import{p as H,r as c,j as e,ec as Y,bf as Z,bG as ee,bt as se,ed as te,ef as W,X as xe,bj as ue,a4 as he,W as ge,bc as J,be as Q,b3 as X,bq as K}from"./vendor-react-DP7WA3kK.js";import{C as L,g as C,p as re,P as ne,Q as ae,R as ie,q as F,B as A}from"./index-CWtKsrnp.js";import{S as B}from"./separator-vdu3zomP.js";import{u as le}from"./useLocalizedContent-pJiq6loG.js";import{T as q}from"./TranslateButton-CDT71iR9.js";import{I as V}from"./ImagePreviewModal-DDIp00IR.js";import{H as ce,p as de,I as me,J as oe}from"./vendor-utils-vwQGbBim.js";import{P as fe}from"./progress-D0VIuMvK.js";const pe=({post:s,onStartCooking:z})=>{const{t,i18n:o}=H(),{getLocalizedField:v}=le(),[_,h]=c.useState(null),[S,g]=c.useState(null),[p,f]=c.useState({}),[x,w]=c.useState(null),y=S||(()=>{const u={zh:"content_zh",en:"content_en",pt:"content_pt"}[o.language]||"content",m=s[u];return m&&typeof m=="string"&&m.trim()?m:s.content})(),k=_||v(s,"recipe_name")||s.recipe_name,T=()=>{const i=[];if(s.recipe_name&&i.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&i.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const u=s.ingredients.map(m=>m.name).join("|");i.push(`[INGREDIENTS]${u}`)}return i.join(`
---
`)},E=i=>{if(!i){h(null),g(null),f({});return}i.split(`
---
`).forEach(m=>{if(m.startsWith("[NAME]"))h(m.replace("[NAME]",""));else if(m.startsWith("[CONTENT]"))g(m.replace("[CONTENT]",""));else if(m.startsWith("[INGREDIENTS]")){const R=m.replace("[INGREDIENTS]","").split("|"),P={};R.forEach((U,$)=>{P[$]=U.trim()}),f(P)}})},a=()=>{switch(o.language){case"zh":return oe;case"pt":return me;default:return de}},d=i=>{switch(i){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},j=i=>{switch(i){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return i}},D=s.image_urls&&s.image_urls.length>0,I=s.steps&&s.steps.length>0;return e.jsxs(L,{className:"overflow-hidden",children:[D&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:k||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>w(s.image_urls[0])}),e.jsxs(C,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(re,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ne,{className:"h-10 w-10",children:[e.jsx(ae,{src:s.author?.avatar_url||void 0}),e.jsx(ie,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ce(new Date(s.created_at),{addSuffix:!0,locale:a()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(q,{text:T(),onTranslation:E,label:t("recipe.translateAll")})}),e.jsx("h2",{className:"text-xl font-bold",children:k}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(C,{variant:"outline",className:d(s.difficulty),children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),j(s.difficulty)]})]})]}),e.jsxs(F,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:y})}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-orange-500"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(B,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsx("ul",{className:"space-y-2",children:s.ingredients.map((i,u)=>e.jsxs("li",{className:"flex items-center justify-between text-sm py-1.5 border-b border-border/50 last:border-0",children:[e.jsx("span",{children:p[u]||i.name}),e.jsxs("span",{className:"text-muted-foreground ml-2 shrink-0",children:[i.amount," ",i.unit]})]},u))})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((i,u)=>e.jsxs(C,{variant:"secondary",className:"text-xs",children:["#",i]},u))}),I&&e.jsxs(A,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:z,children:[e.jsx(W,{className:"h-6 w-6"}),t("recipe.startCooking","开始烹饪"),e.jsxs(C,{variant:"secondary",className:"ml-2",children:[s.steps.length," ",t("recipe.stepsCount","步")]})]})]}),e.jsx(V,{imageUrl:x||"",isOpen:!!x,onClose:()=>w(null)})]})},je=({steps:s,onExit:z})=>{const{t}=H(),[o,v]=c.useState(0),[_,h]=c.useState({}),[S,g]=c.useState(null),p=[...s].sort((a,d)=>a.order-d.order),f=p.length,x=p[o],w=(o+1)/f*100,M=o===f-1,y=o===0,k=()=>{M||v(a=>a+1)},T=()=>{y||v(a=>a-1)},E=()=>{z()};return e.jsxs("div",{className:"flex flex-col h-full min-h-[60vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:z,children:e.jsx(xe,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:t("recipe.stepProgress","步骤 {{current}} / {{total}}",{current:o+1,total:f})}),e.jsx(q,{text:p.map(a=>a.description).join(`
---
`),onTranslation:a=>{if(a){const d=a.split(`
---
`),j={};d.forEach((D,I)=>{j[I]=D}),h(j)}else h({})}})]}),e.jsx(fe,{value:w,className:"h-1 rounded-none"}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg",children:x.order})}),(()=>{const a=x.image_urls&&x.image_urls.length>0?x.image_urls:x.image_url?[x.image_url]:[];return a.length>0&&e.jsx("div",{className:"mb-6 flex flex-wrap justify-center gap-2",children:a.map((d,j)=>e.jsx("img",{src:d,alt:`Step ${x.order} - ${j+1}`,className:`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${a.length===1?"max-w-[75%]":"w-[calc(50%-0.25rem)]"}`,onClick:()=>g(d)},j))})})(),e.jsx("p",{className:"text-lg leading-relaxed text-center",children:_[o]||x.description})]}),e.jsx("div",{className:"flex justify-center gap-1.5 py-3",children:p.map((a,d)=>e.jsx("button",{className:`w-2 h-2 rounded-full transition-all ${d===o?"bg-primary w-6":d<o?"bg-primary/50":"bg-muted-foreground/30"}`,onClick:()=>v(d)},d))}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t bg-background",children:[e.jsxs(A,{variant:"outline",size:"lg",onClick:T,disabled:y,className:"gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),t("recipe.prevStep","上一步")]}),M?e.jsxs(A,{size:"lg",onClick:E,className:"gap-2",variant:"default",children:[e.jsx(he,{className:"h-5 w-5"}),t("recipe.complete","完成")]}):e.jsxs(A,{size:"lg",onClick:k,className:"gap-2",children:[t("recipe.nextStep","下一步"),e.jsx(ge,{className:"h-5 w-5"})]})]}),e.jsx(V,{imageUrl:S||"",isOpen:!!S,onClose:()=>g(null)})]})},ke=({post:s,showActions:z=!1})=>{const{t,i18n:o}=H(),{getLocalizedField:v}=le(),[_,h]=c.useState("guided"),[S,g]=c.useState("overview"),[p,f]=c.useState(null),[x,w]=c.useState(null),[M,y]=c.useState({}),[k,T]=c.useState({}),[E,a]=c.useState(null);c.useRef(null);const d=c.useCallback(()=>{g("cooking"),requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"smooth"})})},[]),D=x||(()=>{const l={zh:"content_zh",en:"content_en",pt:"content_pt"}[o.language]||"content",n=s[l];return n&&typeof n=="string"&&n.trim()?n:s.content})(),I=p||v(s,"recipe_name")||s.recipe_name,i=()=>{const r=[];if(s.recipe_name&&r.push(`[NAME]${s.recipe_name}`),s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&r.push(`[CONTENT]${s.content}`),s.ingredients&&s.ingredients.length>0){const l=s.ingredients.map(n=>n.name).join("|");r.push(`[INGREDIENTS]${l}`)}if(s.steps&&s.steps.length>0){const l=s.steps.sort((n,N)=>n.order-N.order).map(n=>n.description).join("|");r.push(`[STEPS]${l}`)}return r.join(`
---
`)},u=r=>{if(!r){f(null),w(null),y({}),T({});return}r.split(`
---
`).forEach(n=>{if(n.startsWith("[NAME]"))f(n.replace("[NAME]",""));else if(n.startsWith("[CONTENT]"))w(n.replace("[CONTENT]",""));else if(n.startsWith("[INGREDIENTS]")){const N=n.replace("[INGREDIENTS]","").split("|"),b={};N.forEach((O,G)=>{b[G]=O.trim()}),y(b)}else if(n.startsWith("[STEPS]")){const N=n.replace("[STEPS]","").split("|"),b={};N.forEach((O,G)=>{b[G]=O.trim()}),T(b)}})},m=()=>{switch(o.language){case"zh":return oe;case"pt":return me;default:return de}},R=r=>{switch(r){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},P=r=>{switch(r){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return r}},U=s.image_urls&&s.image_urls.length>0,$=s.steps&&s.steps.length>0;return _==="guided"&&S==="cooking"&&$?e.jsx(L,{className:"overflow-hidden",children:e.jsx(je,{steps:s.steps,onExit:()=>g("overview")})}):_==="guided"?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>h("guided"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(W,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>h("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(J,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsx(pe,{post:s,onStartCooking:d}),e.jsx(L,{children:e.jsx(F,{className:"py-4",children:e.jsxs("div",{className:"flex items-center gap-6 text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(Q,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(X,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(K,{className:"h-4 w-4"}),s.shares_count||0]})]})})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{h("guided"),g("overview")},className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),t("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>h("full"),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm",children:[e.jsx(J,{className:"h-4 w-4"}),t("recipe.fullMode","完整模式")]})]})}),e.jsxs(L,{className:"overflow-hidden",children:[U&&e.jsxs("div",{className:"relative aspect-video overflow-hidden",children:[e.jsx("img",{src:s.image_urls[0],alt:I||"",className:"w-full h-full object-cover cursor-pointer",onClick:()=>a(s.image_urls[0])}),e.jsxs(C,{className:"absolute top-3 left-3 bg-primary text-primary-foreground gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs(re,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs(ne,{className:"h-10 w-10",children:[e.jsx(ae,{src:s.author?.avatar_url||void 0}),e.jsx(ie,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:ce(new Date(s.created_at),{addSuffix:!0,locale:m()})})]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(q,{text:i(),onTranslation:u,label:t("recipe.translateAllFull")})}),e.jsx("h2",{className:"text-xl font-bold",children:I}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",t("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",t("recipe.servings","人份")]})]}),s.difficulty&&e.jsxs(C,{variant:"outline",className:R(s.difficulty),children:[e.jsx(se,{className:"h-3 w-3 mr-1"}),P(s.difficulty)]})]})]}),e.jsxs(F,{className:"space-y-6",children:[s.content&&s.content.trim()&&!s.content.includes("主要配料：")&&e.jsx("div",{children:e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:D})}),s.nutrition&&(s.nutrition.calories||s.nutrition.protein||s.nutrition.carbs||s.nutrition.fat)&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3 flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-primary"}),t("recipe.nutrition","营养信息")]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[s.nutrition.calories&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:s.nutrition.calories}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.kcal","千卡")})]}),s.nutrition.protein&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.protein,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.protein","蛋白质")})]}),s.nutrition.carbs&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.carbs,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.carbs","碳水")})]}),s.nutrition.fat&&e.jsxs("div",{className:"text-center p-2 bg-muted/50 rounded-lg",children:[e.jsxs("p",{className:"text-lg font-bold text-primary",children:[s.nutrition.fat,"g"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("recipe.fat","脂肪")})]})]})]}),e.jsx(B,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsx("ul",{className:"space-y-2",children:s.ingredients.map((r,l)=>e.jsxs("li",{className:"flex items-center justify-between text-sm py-1.5 border-b border-border/50 last:border-0",children:[e.jsx("span",{children:M[l]||r.name}),e.jsxs("span",{className:"text-muted-foreground ml-2 shrink-0",children:[r.amount," ",r.unit]})]},l))})]}),e.jsx(B,{}),$&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[t("recipe.steps","步骤")," (",s.steps.length,")"]}),e.jsx("ol",{className:"space-y-4",children:s.steps.sort((r,l)=>r.order-l.order).map((r,l)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:r.order}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("p",{className:"text-sm",children:k[l]||r.description}),(()=>{const n=r.image_urls&&r.image_urls.length>0?r.image_urls:r.image_url?[r.image_url]:[];return n.length>0&&e.jsx("div",{className:`flex gap-2 ${n.length===1?"":"flex-wrap"}`,children:n.map((N,b)=>e.jsx("img",{src:N,alt:`Step ${r.order} - ${b+1}`,className:`rounded-lg max-h-48 object-cover cursor-pointer ${n.length===1?"w-full":"w-[calc(50%-0.25rem)]"}`,onClick:()=>a(N)},b))})})()]})]},l))})]}),s.recipe_tags&&s.recipe_tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:s.recipe_tags.map((r,l)=>e.jsxs(C,{variant:"secondary",className:"text-xs",children:["#",r]},l))}),e.jsxs("div",{className:"flex items-center gap-6 pt-4 border-t text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(Q,{className:"h-4 w-4"}),s.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(X,{className:"h-4 w-4"}),s.comments_count||0]}),e.jsxs("span",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx(K,{className:"h-4 w-4"}),s.shares_count||0]})]})]})]}),e.jsx(V,{imageUrl:E||"",isOpen:!!E,onClose:()=>a(null)})]})};export{ke as R};
//# sourceMappingURL=RecipeDetailContent-Cv7eV83u.js.map
