{"version":3,"file":"AIRecipe-7UxU1Kun.js","sources":["../../src/components/ai-recipe/IngredientPhotoStep.tsx","../../src/components/ai-recipe/IngredientConfirmStep.tsx","../../src/components/ai-recipe/PreferencesStep.tsx","../../src/components/ai-recipe/RecipeSelectStep.tsx","../../src/components/ai-recipe/MealDetailView.tsx","../../src/components/ai-recipe/AIRecipeCookingView.tsx","../../src/components/ai-recipe/MealCookingView.tsx","../../src/components/ai-recipe/AIRecipeSharePrompt.tsx","../../src/pages/AIRecipe.tsx"],"sourcesContent":["import { useState, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Camera, Loader2, ImageIcon, PenLine, X, Plus } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport CameraCapture from \"./CameraCapture\";\r\n\r\nconst MAX_PHOTOS = 5;\r\n\r\ninterface IngredientPhotoStepProps {\r\n  onPhotosUploaded: (imageUrls: string[]) => void;\r\n  onSkipToManual: () => void;\r\n  uploadImage: (file: File, folder: string) => Promise<string | null>;\r\n  isUploading?: boolean;\r\n  initialImageUrls?: string[];\r\n  onRequireLogin?: () => boolean;\r\n}\r\n\r\ninterface PhotoItem {\r\n  id: string;\r\n  preview: string;\r\n  url: string | null;\r\n  uploading: boolean;\r\n}\r\n\r\nconst IngredientPhotoStep = ({ onPhotosUploaded, onSkipToManual, uploadImage, isUploading, initialImageUrls, onRequireLogin }: IngredientPhotoStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [photos, setPhotos] = useState<PhotoItem[]>(() => {\r\n    if (initialImageUrls && initialImageUrls.length > 0) {\r\n      return initialImageUrls.map((url, i) => ({\r\n        id: `restored-${i}`,\r\n        preview: url,\r\n        url,\r\n        uploading: false,\r\n      }));\r\n    }\r\n    return [];\r\n  });\r\n  const [showCamera, setShowCamera] = useState(false);\r\n  const fileRef = useRef<HTMLInputElement>(null);\r\n\r\n  const uploadingCount = photos.filter(p => p.uploading).length;\r\n  const allUploaded = photos.length > 0 && photos.every(p => p.url !== null);\r\n\r\n  const handleFiles = async (files: FileList | File[]) => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n\r\n    const fileArray = Array.from(files);\r\n    const remaining = MAX_PHOTOS - photos.length;\r\n    const toAdd = fileArray.slice(0, remaining).filter(f => f.size <= 10 * 1024 * 1024);\r\n\r\n    if (toAdd.length === 0) return;\r\n\r\n    const newItems: PhotoItem[] = toAdd.map(f => ({\r\n      id: `${Date.now()}-${Math.random().toString(36).slice(2)}`,\r\n      preview: URL.createObjectURL(f),\r\n      url: null,\r\n      uploading: true,\r\n    }));\r\n\r\n    setPhotos(prev => [...prev, ...newItems]);\r\n\r\n    await Promise.all(\r\n      toAdd.map(async (file, i) => {\r\n        const url = await uploadImage(file, \"ai-recipe-ingredients\");\r\n        if (url) {\r\n          setPhotos(prev =>\r\n            prev.map(p => p.id === newItems[i].id ? { ...p, url, uploading: false } : p)\r\n          );\r\n        } else {\r\n          setPhotos(prev => prev.filter(p => p.id !== newItems[i].id));\r\n        }\r\n      })\r\n    );\r\n  };\r\n\r\n  const handleCameraCapture = (file: File) => {\r\n    setShowCamera(false);\r\n    handleFiles([file]);\r\n  };\r\n\r\n  const handleOpenCamera = () => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n    setShowCamera(true);\r\n  };\r\n\r\n  const removePhoto = (id: string) => {\r\n    setPhotos(prev => prev.filter(p => p.id !== id));\r\n  };\r\n\r\n  const handleSubmit = () => {\r\n    if (onRequireLogin && !onRequireLogin()) return;\r\n    const urls = photos.map(p => p.url).filter(Boolean) as string[];\r\n    if (urls.length > 0) {\r\n      onPhotosUploaded(urls);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {showCamera && (\r\n        <CameraCapture\r\n          onCapture={handleCameraCapture}\r\n          onClose={() => setShowCamera(false)}\r\n        />\r\n      )}\r\n\r\n      <div className=\"flex flex-col items-center justify-center gap-6 py-8\">\r\n        <div className=\"text-center space-y-2\">\r\n          <div className=\"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto\">\r\n            <Camera className=\"h-10 w-10 text-primary\" />\r\n          </div>\r\n          <h3 className=\"text-lg font-semibold\">\r\n            {t(\"aiRecipe.photoTitle\", \"拍摄您的食材\")}\r\n          </h3>\r\n          <p className=\"text-sm text-muted-foreground max-w-xs\">\r\n            {t(\"aiRecipe.photoDescMulti\", \"拍照或上传食材照片（最多5张），AI 将自动识别食材\")}\r\n          </p>\r\n        </div>\r\n\r\n        {/* Photo grid */}\r\n        {photos.length > 0 && (\r\n          <div className=\"w-full max-w-sm grid grid-cols-3 gap-2\">\r\n            {photos.map((photo) => (\r\n              <div key={photo.id} className=\"relative aspect-square rounded-lg overflow-hidden border bg-muted\">\r\n                <img src={photo.preview} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                {photo.uploading && (\r\n                  <div className=\"absolute inset-0 bg-background/60 flex items-center justify-center\">\r\n                    <Loader2 className=\"h-5 w-5 animate-spin text-primary\" />\r\n                  </div>\r\n                )}\r\n                <button\r\n                  onClick={() => removePhoto(photo.id)}\r\n                  className=\"absolute top-1 right-1 w-5 h-5 rounded-full bg-black/60 text-white flex items-center justify-center\"\r\n                >\r\n                  <X className=\"h-3 w-3\" />\r\n                </button>\r\n              </div>\r\n            ))}\r\n            {photos.length < MAX_PHOTOS && (\r\n              <button\r\n                onClick={() => fileRef.current?.click()}\r\n                className=\"aspect-square rounded-lg border-2 border-dashed border-muted-foreground/30 flex flex-col items-center justify-center gap-1 text-muted-foreground hover:border-primary/50 hover:text-primary transition-colors\"\r\n                disabled={uploadingCount > 0}\r\n              >\r\n                <Plus className=\"h-5 w-5\" />\r\n                <span className=\"text-xs\">{photos.length}/{MAX_PHOTOS}</span>\r\n              </button>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Action buttons */}\r\n        {photos.length === 0 ? (\r\n          <div className=\"flex gap-3 w-full max-w-sm\">\r\n            <Button\r\n              variant=\"default\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleOpenCamera}\r\n            >\r\n              <Camera className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.takePhoto\", \"拍照\")}\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={() => fileRef.current?.click()}\r\n            >\r\n              <ImageIcon className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.uploadPhoto\", \"相册\")}\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <div className=\"flex gap-3 w-full max-w-sm\">\r\n            <Button\r\n              variant=\"outline\"\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleOpenCamera}\r\n              disabled={photos.length >= MAX_PHOTOS || uploadingCount > 0}\r\n            >\r\n              <Camera className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.addMore\", \"继续拍照\")}\r\n            </Button>\r\n            <Button\r\n              className=\"flex-1 gap-2\"\r\n              onClick={handleSubmit}\r\n              disabled={!allUploaded || uploadingCount > 0}\r\n            >\r\n              {uploadingCount > 0 ? (\r\n                <>\r\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  {t(\"common.uploading\", \"上传中...\")}\r\n                </>\r\n              ) : (\r\n                t(\"aiRecipe.startIdentify\", \"开始识别\")\r\n              )}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {/* Skip to manual input */}\r\n        <Button\r\n          variant=\"ghost\"\r\n          className=\"gap-2 text-muted-foreground\"\r\n          onClick={onSkipToManual}\r\n          disabled={uploadingCount > 0}\r\n        >\r\n          <PenLine className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.skipToManual\", \"跳过，手动输入食材\")}\r\n        </Button>\r\n\r\n        <input\r\n          ref={fileRef}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          multiple\r\n          className=\"hidden\"\r\n          onChange={(e) => {\r\n            const files = e.target.files;\r\n            if (files?.length) handleFiles(files);\r\n            e.target.value = \"\";\r\n          }}\r\n        />\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default IngredientPhotoStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Plus, Trash2, Edit2, Check, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { IdentifiedIngredient } from \"@/hooks/useAIRecipe\";\r\n\r\ninterface IngredientConfirmStepProps {\r\n  ingredients: IdentifiedIngredient[];\r\n  onChange: (ingredients: IdentifiedIngredient[]) => void;\r\n}\r\n\r\nconst IngredientConfirmStep = ({ ingredients, onChange }: IngredientConfirmStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [editIndex, setEditIndex] = useState<number | null>(null);\r\n  const [editName, setEditName] = useState(\"\");\r\n  const [editAmount, setEditAmount] = useState(\"\");\r\n  const [editUnit, setEditUnit] = useState(\"\");\r\n  const [newName, setNewName] = useState(\"\");\r\n\r\n  const handleEdit = (index: number) => {\r\n    setEditIndex(index);\r\n    setEditName(ingredients[index].name);\r\n    setEditAmount(ingredients[index].estimated_amount || \"\");\r\n    setEditUnit(ingredients[index].unit || \"\");\r\n  };\r\n\r\n  const handleSaveEdit = () => {\r\n    if (editIndex === null || !editName.trim()) return;\r\n    const updated = [...ingredients];\r\n    updated[editIndex] = { ...updated[editIndex], name: editName.trim(), estimated_amount: editAmount.trim(), unit: editUnit.trim() };\r\n    onChange(updated);\r\n    setEditIndex(null);\r\n  };\r\n\r\n  const handleDelete = (index: number) => {\r\n    onChange(ingredients.filter((_, i) => i !== index));\r\n  };\r\n\r\n  const handleAdd = () => {\r\n    if (!newName.trim()) return;\r\n    onChange([...ingredients, { name: newName.trim(), estimated_amount: \"\", unit: \"\" }]);\r\n    setNewName(\"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <div className=\"text-center space-y-1 mb-4\">\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.confirmIngredients\", \"确认食材\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.confirmIngredientsDesc\", \"确认 AI 识别的食材，您可以添加、编辑或删除\")}\r\n        </p>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        {ingredients.map((item, index) => (\r\n          <div\r\n            key={index}\r\n            className=\"flex items-center gap-2 p-3 rounded-lg border bg-card\"\r\n          >\r\n            {editIndex === index ? (\r\n              <>\r\n                <Input\r\n                  value={editName}\r\n                  onChange={(e) => setEditName(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.ingredientName\", \"食材名称\")}\r\n                  className=\"flex-1 h-8\"\r\n                  autoFocus\r\n                />\r\n                <Input\r\n                  value={editAmount}\r\n                  onChange={(e) => setEditAmount(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.amount\", \"数量\")}\r\n                  className=\"w-16 h-8\"\r\n                />\r\n                <Input\r\n                  value={editUnit}\r\n                  onChange={(e) => setEditUnit(e.target.value)}\r\n                  placeholder={t(\"aiRecipe.unit\", \"单位\")}\r\n                  className=\"w-14 h-8\"\r\n                />\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={handleSaveEdit}>\r\n                  <Check className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={() => setEditIndex(null)}>\r\n                  <X className=\"h-4 w-4\" />\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <span className=\"flex-1 text-sm font-medium\">{item.name}</span>\r\n                {item.estimated_amount && (\r\n                  <Badge variant=\"outline\" className=\"text-xs\">\r\n                    {item.estimated_amount}{item.unit || \"\"}\r\n                  </Badge>\r\n                )}\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8\" onClick={() => handleEdit(index)}>\r\n                  <Edit2 className=\"h-3.5 w-3.5\" />\r\n                </Button>\r\n                <Button size=\"icon\" variant=\"ghost\" className=\"h-8 w-8 text-destructive\" onClick={() => handleDelete(index)}>\r\n                  <Trash2 className=\"h-3.5 w-3.5\" />\r\n                </Button>\r\n              </>\r\n            )}\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Add new ingredient */}\r\n      <div className=\"flex gap-2\">\r\n        <Input\r\n          value={newName}\r\n          onChange={(e) => setNewName(e.target.value)}\r\n          placeholder={t(\"aiRecipe.addIngredientPlaceholder\", \"添加食材...\")}\r\n          className=\"flex-1\"\r\n          onKeyDown={(e) => e.key === \"Enter\" && handleAdd()}\r\n        />\r\n        <Button onClick={handleAdd} disabled={!newName.trim()} size=\"icon\">\r\n          <Plus className=\"h-4 w-4\" />\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default IngredientConfirmStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChefHat, Users, SkipForward, UtensilsCrossed, MessageSquare } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\n\r\nexport interface RecipePreferences {\r\n  difficulty?: \"easy\" | \"medium\" | \"hard\";\r\n  servings?: number;\r\n  dishCount?: number;\r\n  notes?: string;\r\n}\r\n\r\ninterface PreferencesStepProps {\r\n  onConfirm: (prefs: RecipePreferences) => void;\r\n  onSkip: () => void;\r\n  initialValues?: RecipePreferences;\r\n}\r\n\r\nconst SERVINGS_OPTIONS = [1, 2, 3, 4, 6];\r\nconst DISH_COUNT_OPTIONS = [1, 2, 3, 4, 5, 6];\r\n\r\nconst PreferencesStep = ({ onConfirm, onSkip, initialValues }: PreferencesStepProps) => {\r\n  const { t } = useTranslation();\r\n  const [difficulty, setDifficulty] = useState<\"easy\" | \"medium\" | \"hard\" | undefined>(initialValues?.difficulty);\r\n  const [servings, setServings] = useState<number | undefined>(initialValues?.servings);\r\n  const [dishCount, setDishCount] = useState<number | undefined>(initialValues?.dishCount);\r\n  const [notes, setNotes] = useState(initialValues?.notes || \"\");\r\n  const isCustom = initialValues?.servings != null && !SERVINGS_OPTIONS.includes(initialValues.servings);\r\n  const [showCustom, setShowCustom] = useState(isCustom);\r\n  const [customServings, setCustomServings] = useState(isCustom ? String(initialValues?.servings) : \"\");\r\n\r\n  const difficulties = [\r\n    { value: \"easy\" as const, label: t(\"recipe.difficulty.easy\", \"简单\"), desc: t(\"aiRecipe.diffEasyDesc\", \"适合零基础新手\") },\r\n    { value: \"medium\" as const, label: t(\"recipe.difficulty.medium\", \"中等\"), desc: t(\"aiRecipe.diffMediumDesc\", \"有一点烹饪经验\") },\r\n    { value: \"hard\" as const, label: t(\"recipe.difficulty.hard\", \"困难\"), desc: t(\"aiRecipe.diffHardDesc\", \"挑战高难度菜肴\") },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"text-center space-y-1\">\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.preferences\", \"烹饪偏好\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.preferencesDesc\", \"设置您的偏好，AI 会据此推荐更合适的菜谱\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Difficulty */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <ChefHat className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.preferredDifficulty\", \"期望难度\")}\r\n        </div>\r\n        <div className=\"grid grid-cols-3 gap-2\">\r\n          {difficulties.map((d) => (\r\n            <button\r\n              key={d.value}\r\n              onClick={() => setDifficulty(difficulty === d.value ? undefined : d.value)}\r\n              className={`p-3 rounded-lg border text-center transition-all ${\r\n                difficulty === d.value\r\n                  ? \"border-primary bg-primary/10 ring-1 ring-primary\"\r\n                  : \"hover:border-primary/50\"\r\n              }`}\r\n            >\r\n              <div className=\"text-sm font-medium\">{d.label}</div>\r\n              <div className=\"text-xs text-muted-foreground mt-0.5\">{d.desc}</div>\r\n            </button>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Servings */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <Users className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.preferredServings\", \"用餐人数\")}\r\n        </div>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          {SERVINGS_OPTIONS.map((s) => (\r\n            <Badge\r\n              key={s}\r\n              variant={servings === s && !showCustom ? \"default\" : \"outline\"}\r\n              className=\"cursor-pointer px-4 py-2 text-sm\"\r\n              onClick={() => { setServings(s); setShowCustom(false); setCustomServings(\"\"); }}\r\n            >\r\n              {s} {t(\"recipe.servingsUnit\", \"人份\")}\r\n            </Badge>\r\n          ))}\r\n          <Badge\r\n            variant={showCustom ? \"default\" : \"outline\"}\r\n            className=\"cursor-pointer px-4 py-2 text-sm\"\r\n            onClick={() => { setShowCustom(true); setServings(undefined); }}\r\n          >\r\n            {t(\"aiRecipe.customServings\", \"自定义\")}\r\n          </Badge>\r\n        </div>\r\n        {showCustom && (\r\n          <div className=\"flex items-center gap-2 mt-2\">\r\n            <Input\r\n              type=\"number\"\r\n              min={1}\r\n              max={99}\r\n              placeholder={t(\"aiRecipe.enterServings\", \"输入人数\")}\r\n              value={customServings}\r\n              onChange={(e) => {\r\n                setCustomServings(e.target.value);\r\n                const n = parseInt(e.target.value);\r\n                setServings(n > 0 ? n : undefined);\r\n              }}\r\n              className=\"w-28\"\r\n            />\r\n            <span className=\"text-sm text-muted-foreground\">{t(\"recipe.servingsUnit\", \"人份\")}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Dish Count */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <UtensilsCrossed className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.dishCount\", \"菜品数量\")}\r\n        </div>\r\n        <p className=\"text-xs text-muted-foreground\">\r\n          {t(\"aiRecipe.dishCountDesc\", \"不指定时 AI 会根据人数和食材自动判断\")}\r\n        </p>\r\n        <div className=\"flex flex-wrap gap-2\">\r\n          <Badge\r\n            variant={dishCount === undefined ? \"default\" : \"outline\"}\r\n            className=\"cursor-pointer px-4 py-2 text-sm\"\r\n            onClick={() => setDishCount(undefined)}\r\n          >\r\n            {t(\"aiRecipe.autoDecide\", \"自动\")}\r\n          </Badge>\r\n          {DISH_COUNT_OPTIONS.map((c) => (\r\n            <Badge\r\n              key={c}\r\n              variant={dishCount === c ? \"default\" : \"outline\"}\r\n              className=\"cursor-pointer px-4 py-2 text-sm\"\r\n              onClick={() => setDishCount(c)}\r\n            >\r\n              {c} {t(\"aiRecipe.dishUnit\", \"道菜\")}\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Notes */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n          <MessageSquare className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.cookingNotes\", \"备注\")}\r\n        </div>\r\n        <Textarea\r\n          value={notes}\r\n          onChange={(e) => setNotes(e.target.value)}\r\n          placeholder={t(\"aiRecipe.cookingNotesPlaceholder\", \"如：不要太辣、想做一桌年夜饭、偏清淡口味等...\")}\r\n          rows={3}\r\n          className=\"resize-none\"\r\n        />\r\n      </div>\r\n\r\n      <div className=\"flex gap-3 pt-2\">\r\n        <Button variant=\"outline\" className=\"flex-1 gap-1\" onClick={onSkip}>\r\n          <SkipForward className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.skipPreferences\", \"跳过\")}\r\n        </Button>\r\n        <Button className=\"flex-1\" onClick={() => onConfirm({ difficulty, servings, dishCount, notes: notes.trim() || undefined })}>\r\n          {t(\"aiRecipe.confirmPreferences\", \"确认并生成\")}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PreferencesStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, AlertTriangle, RefreshCw, ImageIcon, Sparkles, Globe, Check, UtensilsCrossed, Info, Pencil, History, ChevronDown } from \"lucide-react\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { RecipePreferences } from \"@/components/ai-recipe/PreferencesStep\";\r\n\r\ninterface RecipeSelectStepProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  recipeHistory?: AIRecipeSuggestion[][];\r\n  onSelectHistoryMeal?: (meal: AIRecipeSuggestion[]) => void;\r\n  onConfirmMeal: () => void;\r\n  onRegenerate?: (updatedNotes?: string) => void;\r\n  isRegenerating?: boolean;\r\n  preferences?: RecipePreferences;\r\n}\r\n\r\nconst RecipeSelectStep = ({ recipes, recipeHistory = [], onSelectHistoryMeal, onConfirmMeal, onRegenerate, isRegenerating, preferences }: RecipeSelectStepProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [editingNotes, setEditingNotes] = useState(false);\r\n  const [notesValue, setNotesValue] = useState(preferences?.notes || \"\");\r\n  const [showHistory, setShowHistory] = useState(false);\r\n\r\n  const getLocalizedName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getLocalizedSubtitle = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.subtitle_en) return recipe.subtitle_en;\r\n    if (i18n.language === \"pt\" && recipe.subtitle_pt) return recipe.subtitle_pt;\r\n    return recipe.subtitle;\r\n  };\r\n\r\n  const difficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const totalCookTime = recipes.reduce((sum, r) => sum + (r.cook_time || 0), 0);\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Meal Plan Header */}\r\n      <div className=\"text-center space-y-2 mb-4\">\r\n        <div className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-primary/10 rounded-full\">\r\n          <UtensilsCrossed className=\"h-4 w-4 text-primary\" />\r\n          <span className=\"text-sm font-medium text-primary\">\r\n            {t(\"aiRecipe.mealPlan\", \"完整菜单\")}\r\n          </span>\r\n        </div>\r\n        <h3 className=\"text-lg font-semibold\">\r\n          {t(\"aiRecipe.mealPlanTitle\", \"AI 为您设计了一桌菜\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground\">\r\n          {t(\"aiRecipe.mealPlanDesc\", \"共 {{count}} 道菜，总计约 {{time}} 分钟\", { count: recipes.length, time: totalCookTime })}\r\n        </p>\r\n        {/* Dish count explanation */}\r\n        {preferences && (\r\n          <div className=\"inline-flex items-start gap-1.5 text-xs text-muted-foreground bg-muted/50 rounded-lg px-3 py-2 mt-1 text-left max-w-sm mx-auto\">\r\n            <Info className=\"h-3.5 w-3.5 mt-0.5 shrink-0\" />\r\n            <span>\r\n              {preferences.dishCount\r\n                ? t(\"aiRecipe.dishCountExplain\", \"按照您指定的 {{count}} 道菜生成\", { count: preferences.dishCount })\r\n                : preferences.notes\r\n                  ? t(\"aiRecipe.dishCountFromNotes\", \"根据您的备注「{{notes}}」，AI 为您规划了 {{count}} 道菜\", { notes: preferences.notes.length > 20 ? preferences.notes.slice(0, 20) + \"…\" : preferences.notes, count: recipes.length })\r\n                  : t(\"aiRecipe.dishCountAuto\", \"AI 根据 {{servings}} 人份的食材自动规划了 {{count}} 道菜\", { servings: preferences.servings || recipes[0]?.servings || \"?\", count: recipes.length })\r\n              }\r\n            </span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* All dishes in the meal */}\r\n      <div className=\"space-y-3\">\r\n        {recipes.map((recipe, index) => (\r\n          <Card key={index} className=\"overflow-hidden\">\r\n            {recipe.image_url ? (\r\n              <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n                <img\r\n                  src={recipe.image_url}\r\n                  alt={getLocalizedName(recipe)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n                <Badge\r\n                  variant=\"secondary\"\r\n                  className=\"absolute top-2 left-2 text-xs font-bold\"\r\n                >\r\n                  {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                </Badge>\r\n                <Badge\r\n                  variant=\"secondary\"\r\n                  className=\"absolute bottom-2 right-2 text-[10px] gap-1 opacity-80\"\r\n                >\r\n                  {recipe.image_source === \"ai\" ? (\r\n                    <>\r\n                      <Sparkles className=\"h-2.5 w-2.5\" />\r\n                      {t(\"aiRecipe.imageSourceAI\", \"AI 生成\")}\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <Globe className=\"h-2.5 w-2.5\" />\r\n                      {t(\"aiRecipe.imageSourceWeb\", \"来自网络\")}\r\n                    </>\r\n                  )}\r\n                </Badge>\r\n              </div>\r\n            ) : (\r\n              <div className=\"w-full aspect-[16/9] bg-muted flex items-center justify-center relative\">\r\n                <ImageIcon className=\"h-8 w-8 text-muted-foreground/40\" />\r\n                <Badge\r\n                  variant=\"secondary\"\r\n                  className=\"absolute top-2 left-2 text-xs font-bold\"\r\n                >\r\n                  {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                </Badge>\r\n              </div>\r\n            )}\r\n            <CardHeader className=\"pb-2\">\r\n              <h4 className=\"font-semibold\">{getLocalizedName(recipe)}</h4>\r\n              {getLocalizedSubtitle(recipe) && (\r\n                <p className=\"text-xs text-muted-foreground italic\">{getLocalizedSubtitle(recipe)}</p>\r\n              )}\r\n            </CardHeader>\r\n            <CardContent className=\"pt-0\">\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <Clock className=\"h-3 w-3\" />\r\n                  {recipe.cook_time} {t(\"recipe.minutes\", \"分钟\")}\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <ChefHat className=\"h-3 w-3\" />\r\n                  {difficultyLabel(recipe.difficulty)}\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                  <Users className=\"h-3 w-3\" />\r\n                  {recipe.servings} {t(\"recipe.servingsUnit\", \"人份\")}\r\n                </Badge>\r\n              </div>\r\n\r\n              {recipe.missing_ingredients && recipe.missing_ingredients.length > 0 && (\r\n                <div className=\"mt-2 flex items-start gap-1.5 text-xs text-destructive\">\r\n                  <AlertTriangle className=\"h-3.5 w-3.5 mt-0.5 shrink-0\" />\r\n                  <span>\r\n                    {t(\"aiRecipe.missingIngredients\", \"需要额外食材：\")}\r\n                    {(() => {\r\n                      const lang = i18n.language;\r\n                      const list =\r\n                        lang === \"en\" ? (recipe as any).missing_ingredients_en || recipe.missing_ingredients :\r\n                        lang === \"pt\" ? (recipe as any).missing_ingredients_pt || recipe.missing_ingredients :\r\n                        recipe.missing_ingredients;\r\n                      return list.join(lang === \"zh\" ? \"、\" : \", \");\r\n                    })()}\r\n                  </span>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Editable notes */}\r\n      <div className=\"space-y-2\">\r\n        {editingNotes ? (\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-xs font-medium text-muted-foreground\">\r\n              {t(\"aiRecipe.editNotes\", \"编辑备注（修改后点击换一批即可重新生成）\")}\r\n            </label>\r\n            <Textarea\r\n              value={notesValue}\r\n              onChange={(e) => setNotesValue(e.target.value)}\r\n              placeholder={t(\"aiRecipe.notesPlaceholder\", \"例如：两菜一汤、清淡为主...\")}\r\n              className=\"min-h-[60px] text-sm\"\r\n            />\r\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setEditingNotes(false)}>\r\n              {t(\"common.done\", \"完成\")}\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          <button\r\n            onClick={() => setEditingNotes(true)}\r\n            className=\"inline-flex items-center gap-1.5 text-xs text-muted-foreground hover:text-primary transition-colors\"\r\n          >\r\n            <Pencil className=\"h-3 w-3\" />\r\n            {notesValue\r\n              ? t(\"aiRecipe.currentNotes\", \"备注：{{notes}}\", { notes: notesValue.length > 30 ? notesValue.slice(0, 30) + \"…\" : notesValue })\r\n              : t(\"aiRecipe.addNotes\", \"添加备注（如：两菜一汤）\")}\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Action buttons */}\r\n      <div className=\"flex gap-3 pt-2 sticky bottom-4\">\r\n        {onRegenerate && (\r\n          <Button\r\n            variant=\"outline\"\r\n            className=\"flex-1 gap-1.5\"\r\n            onClick={() => onRegenerate(notesValue || undefined)}\r\n            disabled={isRegenerating}\r\n          >\r\n            <RefreshCw className={`h-4 w-4 ${isRegenerating ? \"animate-spin\" : \"\"}`} />\r\n            {isRegenerating\r\n              ? t(\"aiRecipe.regenerating\", \"重新生成中...\")\r\n              : t(\"aiRecipe.regenerateRecipes\", \"换一批\")}\r\n          </Button>\r\n        )}\r\n        <Button className=\"flex-1 gap-1.5\" onClick={onConfirmMeal}>\r\n          <Check className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.confirmMeal\", \"确认菜单\")}\r\n        </Button>\r\n      </div>\r\n\r\n      {/* History section */}\r\n      {recipeHistory.length > 0 && onSelectHistoryMeal && (\r\n        <div className=\"border rounded-xl overflow-hidden\">\r\n          <button\r\n            className=\"w-full flex items-center justify-between px-4 py-3 text-sm font-medium hover:bg-muted/50 transition-colors\"\r\n            onClick={() => setShowHistory(h => !h)}\r\n          >\r\n            <span className=\"flex items-center gap-2 text-muted-foreground\">\r\n              <History className=\"h-4 w-4\" />\r\n              {t(\"aiRecipe.historyMeals\", \"历史菜单\")}\r\n              <Badge variant=\"secondary\" className=\"text-xs\">{recipeHistory.length}</Badge>\r\n            </span>\r\n            <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${showHistory ? \"rotate-180\" : \"\"}`} />\r\n          </button>\r\n\r\n          {showHistory && (\r\n            <div className=\"divide-y\">\r\n              {recipeHistory.map((meal, hi) => (\r\n                <div key={hi} className=\"px-4 py-3 space-y-1.5\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <span className=\"text-xs text-muted-foreground\">\r\n                      {t(\"aiRecipe.historyEntry\", \"第 {{n}} 次生成\", { n: recipeHistory.length - hi })}\r\n                    </span>\r\n                    <Button\r\n                      size=\"sm\"\r\n                      variant=\"ghost\"\r\n                      className=\"h-7 text-xs gap-1 text-primary\"\r\n                      onClick={() => { onSelectHistoryMeal(meal); setShowHistory(false); }}\r\n                    >\r\n                      <Check className=\"h-3 w-3\" />\r\n                      {t(\"aiRecipe.useThisMeal\", \"选这桌\")}\r\n                    </Button>\r\n                  </div>\r\n                  <div className=\"flex flex-wrap gap-1.5\">\r\n                    {meal.map((dish, di) => (\r\n                      <span key={di} className=\"text-xs bg-muted rounded-full px-2.5 py-0.5\">\r\n                        {i18n.language === \"en\" && dish.recipe_name_en ? dish.recipe_name_en\r\n                          : i18n.language === \"pt\" && dish.recipe_name_pt ? dish.recipe_name_pt\r\n                          : dish.recipe_name}\r\n                      </span>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeSelectStep;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, ChevronDown, ChevronUp, Sparkles, Globe } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\n\r\ninterface MealDetailViewProps {\r\n  recipes: AIRecipeSuggestion[];\r\n}\r\n\r\nconst MealDetailView = ({ recipes }: MealDetailViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [expandedIndex, setExpandedIndex] = useState<number>(0);\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getLocalSubtitle = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.subtitle_en) return recipe.subtitle_en;\r\n    if (i18n.language === \"pt\" && recipe.subtitle_pt) return recipe.subtitle_pt;\r\n    return recipe.subtitle;\r\n  };\r\n\r\n  const difficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {recipes.map((recipe, index) => (\r\n        <Collapsible\r\n          key={index}\r\n          open={expandedIndex === index}\r\n          onOpenChange={(open) => setExpandedIndex(open ? index : -1)}\r\n        >\r\n          <Card className=\"overflow-hidden\">\r\n            {/* Recipe image */}\r\n            {recipe.image_url && (\r\n              <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n                <img\r\n                  src={recipe.image_url}\r\n                  alt={getLocalName(recipe)}\r\n                  className=\"w-full h-full object-cover\"\r\n                  loading=\"lazy\"\r\n                />\r\n                <div className=\"absolute bottom-2 right-2\">\r\n                  <span className=\"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full\">\r\n                    {recipe.image_source === \"ai\" ? (\r\n                      <><Sparkles className=\"h-2.5 w-2.5\" />AI 生成</>\r\n                    ) : (\r\n                      <><Globe className=\"h-2.5 w-2.5\" />来自网络</>\r\n                    )}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            )}\r\n            <CollapsibleTrigger className=\"w-full text-left\">\r\n              <CardHeader className=\"pb-2 flex flex-row items-center justify-between\">\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Badge variant=\"secondary\" className=\"text-xs shrink-0\">\r\n                      {t(\"aiRecipe.dishNumber\", \"第 {{n}} 道\", { n: index + 1 })}\r\n                    </Badge>\r\n                    <h4 className=\"font-semibold truncate\">{getLocalName(recipe)}</h4>\r\n                  </div>\r\n                  {getLocalSubtitle(recipe) && (\r\n                    <p className=\"text-xs text-muted-foreground italic mt-1\">{getLocalSubtitle(recipe)}</p>\r\n                  )}\r\n                  <div className=\"flex flex-wrap gap-2 mt-2\">\r\n                    <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                      <Clock className=\"h-3 w-3\" />\r\n                      {recipe.cook_time}{t(\"recipe.minutes\", \"分钟\")}\r\n                    </Badge>\r\n                    <Badge variant=\"outline\" className=\"gap-1 text-xs\">\r\n                      <ChefHat className=\"h-3 w-3\" />\r\n                      {difficultyLabel(recipe.difficulty)}\r\n                    </Badge>\r\n                  </div>\r\n                </div>\r\n                {expandedIndex === index ? (\r\n                  <ChevronUp className=\"h-5 w-5 text-muted-foreground shrink-0 ml-2\" />\r\n                ) : (\r\n                  <ChevronDown className=\"h-5 w-5 text-muted-foreground shrink-0 ml-2\" />\r\n                )}\r\n              </CardHeader>\r\n            </CollapsibleTrigger>\r\n\r\n            <CollapsibleContent>\r\n              <CardContent className=\"pt-0 space-y-4\">\r\n                {/* Ingredients */}\r\n                <div>\r\n                  <h5 className=\"font-semibold text-sm mb-2\">{t(\"recipe.step.ingredients\", \"配料\")}</h5>\r\n                  <div className=\"space-y-1\">\r\n                    {recipe.ingredients.map((ing, i) => {\r\n                      const localName = i18n.language === \"en\" && ing.name_en ? ing.name_en\r\n                        : i18n.language === \"pt\" && ing.name_pt ? ing.name_pt\r\n                        : ing.name;\r\n                      return (\r\n                        <div key={i} className=\"flex justify-between text-sm py-1 border-b border-dashed last:border-0\">\r\n                          <span>{localName}</span>\r\n                          <span className=\"text-muted-foreground\">\r\n                            {ing.amount} {i18n.language === \"en\" && ing.unit_en ? ing.unit_en\r\n                              : i18n.language === \"pt\" && ing.unit_pt ? ing.unit_pt\r\n                              : ing.unit}\r\n                          </span>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Steps */}\r\n                <div>\r\n                  <h5 className=\"font-semibold text-sm mb-2\">{t(\"recipe.step.steps\", \"步骤\")}</h5>\r\n                  <div className=\"space-y-3\">\r\n                    {recipe.steps.map((step, i) => {\r\n                      const localDesc = i18n.language === \"en\" && step.description_en ? step.description_en\r\n                        : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n                        : step.description;\r\n                      return (\r\n                        <div key={i} className=\"flex gap-3\">\r\n                          <div className=\"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center shrink-0 mt-0.5\">\r\n                            <span className=\"text-xs font-bold text-primary\">{step.order || i + 1}</span>\r\n                          </div>\r\n                          <p className=\"text-sm leading-relaxed\">{localDesc}</p>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </CollapsibleContent>\r\n          </Card>\r\n        </Collapsible>\r\n      ))}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MealDetailView;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Clock, Users, ChefHat, PlayCircle, List, Sparkles, Globe, SkipForward } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport RecipeCookingMode from \"@/components/community/recipe/RecipeCookingMode\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface AIRecipeCookingViewProps {\r\n  recipe: AIRecipeSuggestion;\r\n  ingredientImageUrl?: string;\r\n  onComplete: () => void;\r\n  onBack: () => void;\r\n  onSkip?: () => void;\r\n}\r\n\r\ntype ViewMode = \"guided\" | \"full\";\r\n\r\nconst AIRecipeCookingView = ({ recipe, ingredientImageUrl, onComplete, onBack, onSkip }: AIRecipeCookingViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [viewMode, setViewMode] = useState<ViewMode>(\"guided\");\r\n  const [guidedStarted, setGuidedStarted] = useState(false);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n\r\n  const getName = () => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case \"medium\": return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case \"hard\": return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case \"easy\": return \"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30\";\r\n      case \"medium\": return \"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30\";\r\n      case \"hard\": return \"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30\";\r\n      default: return \"bg-muted text-muted-foreground\";\r\n    }\r\n  };\r\n\r\n  const steps = recipe.steps.map((s, i) => ({ ...s, order: s.order || i + 1 }));\r\n\r\n  // Guided mode - cooking phase (step-by-step)\r\n  if (viewMode === \"guided\" && guidedStarted) {\r\n    return (\r\n      <Card className=\"overflow-hidden\">\r\n        <RecipeCookingMode\r\n          steps={steps}\r\n          onExit={() => setGuidedStarted(false)}\r\n          onComplete={onComplete}\r\n        />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Mode toggle\r\n  const ModeToggle = () => (\r\n    <div className=\"flex justify-end\">\r\n      <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n        <button\r\n          onClick={() => { setViewMode(\"guided\"); setGuidedStarted(false); }}\r\n          className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${viewMode === \"guided\" ? \"bg-background text-foreground shadow-sm\" : \"\"}`}\r\n        >\r\n          <PlayCircle className=\"h-4 w-4\" />\r\n          {t(\"recipe.guidedMode\", \"流程模式\")}\r\n        </button>\r\n        <button\r\n          onClick={() => setViewMode(\"full\")}\r\n          className={`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${viewMode === \"full\" ? \"bg-background text-foreground shadow-sm\" : \"\"}`}\r\n        >\r\n          <List className=\"h-4 w-4\" />\r\n          {t(\"recipe.fullMode\", \"完整模式\")}\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Overview content (shared between guided overview and full mode top)\r\n  const RecipeHeader = () => (\r\n    <Card className=\"overflow-hidden\">\r\n\r\n      {/* Recipe image */}\r\n      {recipe.image_url && (\r\n        <div className=\"relative w-full aspect-[16/9] bg-muted\">\r\n          <img\r\n            src={recipe.image_url}\r\n            alt={getName()}\r\n            className=\"w-full h-full object-cover\"\r\n          />\r\n          <div className=\"absolute bottom-2 right-2\">\r\n            <span className=\"inline-flex items-center gap-1 text-[10px] bg-black/50 text-white px-2 py-0.5 rounded-full\">\r\n              {recipe.image_source === \"ai\" ? (\r\n                <>\r\n                  <Sparkles className=\"h-2.5 w-2.5\" />\r\n                  AI 生成\r\n                </>\r\n              ) : (\r\n                <>\r\n                  <Globe className=\"h-2.5 w-2.5\" />\r\n                  来自网络\r\n                </>\r\n              )}\r\n            </span>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <CardHeader className=\"pb-3\">\r\n        <h2 className=\"text-xl font-bold\">{getName()}</h2>\r\n        <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n          {recipe.cook_time && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Clock className=\"h-4 w-4\" />\r\n              <span>{recipe.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n            </div>\r\n          )}\r\n          {recipe.servings && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Users className=\"h-4 w-4\" />\r\n              <span>{recipe.servings} {t(\"recipe.servingsUnit\", \"人份\")}</span>\r\n            </div>\r\n          )}\r\n          {recipe.difficulty && (\r\n            <Badge variant=\"outline\" className={getDifficultyColor(recipe.difficulty)}>\r\n              <ChefHat className=\"h-3 w-3 mr-1\" />\r\n              {getDifficultyLabel(recipe.difficulty)}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Introduction */}\r\n        {(() => {\r\n          const intro = i18n.language === \"en\" && recipe.introduction_en ? recipe.introduction_en\r\n            : i18n.language === \"pt\" && recipe.introduction_pt ? recipe.introduction_pt\r\n            : recipe.introduction;\r\n          return intro && <p className=\"text-sm text-muted-foreground whitespace-pre-line\">{intro}</p>;\r\n        })()}\r\n\r\n        <Separator />\r\n\r\n        {/* Ingredients */}\r\n        {recipe.ingredients.length > 0 && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3\">\r\n              {t(\"recipe.ingredients\", \"食材\")} ({recipe.ingredients.length})\r\n            </h3>\r\n            <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n              <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n              <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n            </div>\r\n            <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n              {recipe.ingredients.map((ingredient, index) => {\r\n                const localName = i18n.language === \"en\" && ingredient.name_en ? ingredient.name_en\r\n                  : i18n.language === \"pt\" && ingredient.name_pt ? ingredient.name_pt\r\n                  : ingredient.name;\r\n                return (\r\n                  <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                    <span className=\"flex-1 min-w-0 truncate\">{localName}</span>\r\n                    <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                      {ingredient.amount} {i18n.language === \"en\" && ingredient.unit_en ? ingredient.unit_en\r\n                        : i18n.language === \"pt\" && ingredient.unit_pt ? ingredient.unit_pt\r\n                        : ingredient.unit}\r\n                    </span>\r\n                  </li>\r\n                );\r\n              })}\r\n            </ul>\r\n          </div>\r\n        )}\r\n\r\n        {/* Guided mode: Start cooking button + skip */}\r\n        {viewMode === \"guided\" && (\r\n          <>\r\n            <Separator />\r\n            <Button\r\n              size=\"lg\"\r\n              className=\"w-full gap-2 h-14 text-lg\"\r\n              onClick={() => setGuidedStarted(true)}\r\n            >\r\n              <PlayCircle className=\"h-6 w-6\" />\r\n              {t(\"recipe.startCooking\", \"开始烹饪\")}\r\n              <Badge variant=\"secondary\" className=\"ml-2\">\r\n                {steps.length} {t(\"recipe.stepsCount\", \"步\")}\r\n              </Badge>\r\n            </Button>\r\n            {onSkip && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                className=\"w-full gap-2 text-muted-foreground\"\r\n                onClick={onSkip}\r\n              >\r\n                <SkipForward className=\"h-4 w-4\" />\r\n                {t(\"aiRecipe.skipDish\", \"跳过这道菜\")}\r\n              </Button>\r\n            )}\r\n          </>\r\n        )}\r\n\r\n        {/* Full mode: Steps inline */}\r\n        {viewMode === \"full\" && (\r\n          <>\r\n            <Separator />\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.step.steps\", \"步骤\")} ({steps.length})\r\n              </h3>\r\n              <ol className=\"space-y-4\">\r\n                {steps.map((step, index) => {\r\n                  const localDesc = i18n.language === \"en\" && step.description_en ? step.description_en\r\n                    : i18n.language === \"pt\" && step.description_pt ? step.description_pt\r\n                    : step.description;\r\n                  return (\r\n                    <li key={index} className=\"flex gap-3\">\r\n                      <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\r\n                        {step.order}\r\n                      </div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <p className=\"text-sm\">{localDesc}</p>\r\n                        {(() => {\r\n                          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n                          return imgs.length > 0 && (\r\n                            <div className={`flex gap-2 ${imgs.length === 1 ? \"\" : \"flex-wrap\"}`}>\r\n                              {imgs.map((url, imgIdx) => (\r\n                                <img\r\n                                  key={imgIdx}\r\n                                  src={url}\r\n                                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                                  className={`rounded-lg max-h-48 object-cover cursor-pointer ${imgs.length === 1 ? \"w-full\" : \"w-[calc(50%-0.25rem)]\"}`}\r\n                                  onClick={() => setPreviewImageUrl(url)}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </li>\r\n                  );\r\n                })}\r\n              </ol>\r\n            </div>\r\n          </>\r\n        )}\r\n\r\n        {viewMode === \"full\" && (\r\n          <Button\r\n            size=\"lg\"\r\n            variant=\"outline\"\r\n            className=\"w-full gap-2\"\r\n            onClick={onComplete}\r\n          >\r\n            {t(\"recipe.completeCooking\", \"完成烹饪\")}\r\n          </Button>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      <ModeToggle />\r\n      <RecipeHeader />\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipeCookingView;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Check, SkipForward } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport AIRecipeCookingView from \"./AIRecipeCookingView\";\r\n\r\ninterface MealCookingViewProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  ingredientImageUrl: string;\r\n  onComplete: (skippedIndices: number[]) => void;\r\n  onBack: () => void;\r\n}\r\n\r\nconst MealCookingView = ({ recipes, ingredientImageUrl, onComplete, onBack }: MealCookingViewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [currentDishIndex, setCurrentDishIndex] = useState(0);\r\n  const [completedDishes, setCompletedDishes] = useState<Set<number>>(new Set());\r\n  const [skippedDishes, setSkippedDishes] = useState<Set<number>>(new Set());\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const isAllResolved = (completed: Set<number>, skipped: Set<number>) =>\r\n    completed.size + skipped.size === recipes.length;\r\n\r\n  const moveToNext = (completed: Set<number>, skipped: Set<number>, fromIndex: number) => {\r\n    if (isAllResolved(completed, skipped)) {\r\n      onComplete(Array.from(skipped));\r\n      return;\r\n    }\r\n    // Find next unresolved dish\r\n    for (let i = fromIndex + 1; i < recipes.length; i++) {\r\n      if (!completed.has(i) && !skipped.has(i)) {\r\n        setCurrentDishIndex(i);\r\n        return;\r\n      }\r\n    }\r\n    for (let i = 0; i < fromIndex; i++) {\r\n      if (!completed.has(i) && !skipped.has(i)) {\r\n        setCurrentDishIndex(i);\r\n        return;\r\n      }\r\n    }\r\n    onComplete(Array.from(skipped));\r\n  };\r\n\r\n  const handleDishComplete = () => {\r\n    const newCompleted = new Set(completedDishes);\r\n    newCompleted.add(currentDishIndex);\r\n    setCompletedDishes(newCompleted);\r\n    moveToNext(newCompleted, skippedDishes, currentDishIndex);\r\n  };\r\n\r\n  const handleSkipDish = () => {\r\n    const newSkipped = new Set(skippedDishes);\r\n    newSkipped.add(currentDishIndex);\r\n    setSkippedDishes(newSkipped);\r\n    moveToNext(completedDishes, newSkipped, currentDishIndex);\r\n  };\r\n\r\n  const doneDishes = completedDishes.size + skippedDishes.size;\r\n\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {/* Dish navigation tabs */}\r\n      <div className=\"flex items-center gap-2 overflow-x-auto pb-1 scrollbar-hide\">\r\n        {recipes.map((recipe, index) => (\r\n          <button\r\n            key={index}\r\n            onClick={() => setCurrentDishIndex(index)}\r\n            className={`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-all border shrink-0 ${\r\n              currentDishIndex === index\r\n                ? \"bg-primary text-primary-foreground border-primary\"\r\n                : completedDishes.has(index)\r\n                ? \"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-300 dark:border-green-700\"\r\n                : skippedDishes.has(index)\r\n                ? \"bg-muted text-muted-foreground/50 border-border line-through\"\r\n                : \"bg-muted text-muted-foreground border-border hover:border-primary/50\"\r\n            }`}\r\n          >\r\n            {completedDishes.has(index) && <Check className=\"h-3 w-3\" />}\r\n            {skippedDishes.has(index) && <SkipForward className=\"h-3 w-3\" />}\r\n            {getLocalName(recipe)}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Progress */}\r\n      <div className=\"text-center text-xs text-muted-foreground\">\r\n        {t(\"aiRecipe.cookingProgress\", \"已完成 {{done}}/{{total}} 道菜\", {\r\n          done: completedDishes.size,\r\n          total: recipes.length,\r\n        })}\r\n        {skippedDishes.size > 0 && (\r\n          <span className=\"ml-1 opacity-60\">\r\n            ({t(\"aiRecipe.skippedCount\", \"已跳过 {{n}} 道\", { n: skippedDishes.size })})\r\n          </span>\r\n        )}\r\n      </div>\r\n\r\n      {/* Current dish cooking view - key resets state when switching dishes */}\r\n      <AIRecipeCookingView\r\n        key={currentDishIndex}\r\n        recipe={recipes[currentDishIndex]}\r\n        ingredientImageUrl={ingredientImageUrl}\r\n        onComplete={handleDishComplete}\r\n        onBack={onBack}\r\n        onSkip={recipes.length > 1 && !skippedDishes.has(currentDishIndex) ? handleSkipDish : undefined}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MealCookingView;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { PartyPopper, X, Check, Bookmark, Loader2 } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { useState } from \"react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\n\r\ninterface AIRecipeSharePromptProps {\r\n  recipes: AIRecipeSuggestion[];\r\n  /** Indices of dishes the user skipped during cooking — pre-deselected */\r\n  skippedIndices?: number[];\r\n  onShare: (selectedIndices: number[]) => void;\r\n  onSkip: () => void;\r\n  onSaveRecipe?: (recipe: AIRecipeSuggestion) => Promise<any>;\r\n  /** Called when user un-saves a previously saved recipe */\r\n  onUnsaveRecipe?: (id: string) => Promise<any>;\r\n  isSaving?: boolean;\r\n}\r\n\r\nconst AIRecipeSharePrompt = ({ recipes, skippedIndices = [], onShare, onSkip, onSaveRecipe, onUnsaveRecipe, isSaving }: AIRecipeSharePromptProps) => {\r\n  const { t, i18n } = useTranslation();\r\n\r\n  // Pre-deselect skipped dishes\r\n  const [selectedIndices, setSelectedIndices] = useState<Set<number>>(\r\n    new Set(recipes.map((_, i) => i).filter(i => !skippedIndices.includes(i)))\r\n  );\r\n\r\n  // Map: recipe index → saved recipe id (or true if saved without id)\r\n  const [savedMap, setSavedMap] = useState<Map<number, string>>(new Map());\r\n  const [savingIndex, setSavingIndex] = useState<number | null>(null);\r\n\r\n  const handleToggleSave = async (index: number, e: React.MouseEvent) => {\r\n    e.stopPropagation();\r\n    if (!onSaveRecipe) return;\r\n\r\n    if (savedMap.has(index)) {\r\n      // Already saved → cancel save (delete)\r\n      const savedId = savedMap.get(index);\r\n      if (savedId && onUnsaveRecipe) {\r\n        setSavingIndex(index);\r\n        try {\r\n          await onUnsaveRecipe(savedId);\r\n          setSavedMap(prev => {\r\n            const next = new Map(prev);\r\n            next.delete(index);\r\n            return next;\r\n          });\r\n        } finally {\r\n          setSavingIndex(null);\r\n        }\r\n      }\r\n    } else {\r\n      // Not saved → save\r\n      setSavingIndex(index);\r\n      try {\r\n        const result = await onSaveRecipe(recipes[index]);\r\n        setSavedMap(prev => new Map(prev).set(index, result?.id || \"saved\"));\r\n      } finally {\r\n        setSavingIndex(null);\r\n      }\r\n    }\r\n  };\r\n\r\n  const getLocalName = (recipe: AIRecipeSuggestion) => {\r\n    if (i18n.language === \"en\" && recipe.recipe_name_en) return recipe.recipe_name_en;\r\n    if (i18n.language === \"pt\" && recipe.recipe_name_pt) return recipe.recipe_name_pt;\r\n    return recipe.recipe_name;\r\n  };\r\n\r\n  const toggleDish = (index: number) => {\r\n    const next = new Set(selectedIndices);\r\n    if (next.has(index)) next.delete(index);\r\n    else next.add(index);\r\n    setSelectedIndices(next);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center gap-5 py-6\">\r\n      <div className=\"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center\">\r\n        <PartyPopper className=\"h-8 w-8 text-primary\" />\r\n      </div>\r\n\r\n      <div className=\"text-center space-y-1.5\">\r\n        <h3 className=\"text-xl font-bold\">\r\n          {t(\"aiRecipe.cookingDone\", \"烹饪完成！🎉\")}\r\n        </h3>\r\n        <p className=\"text-sm text-muted-foreground max-w-xs mx-auto\">\r\n          {t(\"aiRecipe.shareSelectDesc\", \"选择您想要分享到社区的菜品，每道菜需要拍摄成品照片\")}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Dish selection list */}\r\n      <div className=\"w-full max-w-sm space-y-2\">\r\n        {recipes.map((recipe, index) => {\r\n          const isSkipped = skippedIndices.includes(index);\r\n          const isSaved = savedMap.has(index);\r\n          return (\r\n            <button\r\n              key={index}\r\n              onClick={() => !isSkipped && toggleDish(index)}\r\n              className={`w-full flex items-center gap-3 p-3 rounded-xl border transition-all text-left ${\r\n                isSkipped\r\n                  ? \"border-border bg-muted/20 opacity-40 cursor-not-allowed\"\r\n                  : selectedIndices.has(index)\r\n                  ? \"border-primary bg-primary/5 ring-1 ring-primary/20\"\r\n                  : \"border-border bg-muted/30 opacity-60\"\r\n              }`}\r\n            >\r\n              {/* Dish image */}\r\n              <div className=\"w-14 h-14 rounded-lg overflow-hidden bg-muted shrink-0\">\r\n                {recipe.image_url ? (\r\n                  <img src={recipe.image_url} alt={recipe.recipe_name} className=\"w-full h-full object-cover\" />\r\n                ) : (\r\n                  <div className=\"w-full h-full flex items-center justify-center text-muted-foreground text-lg\">\r\n                    🍽️\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Dish info */}\r\n              <div className=\"flex-1 min-w-0\">\r\n                <p className=\"font-medium text-sm truncate\">{getLocalName(recipe)}</p>\r\n                {recipe.subtitle && (\r\n                  <p className=\"text-xs text-muted-foreground italic truncate mt-0.5\">{recipe.subtitle}</p>\r\n                )}\r\n                <div className=\"flex items-center gap-1.5 mt-1\">\r\n                  <Badge variant=\"secondary\" className=\"text-[10px] px-1.5 py-0\">\r\n                    {recipe.cook_time}{t(\"recipe.minuteShort\", \"分钟\")}\r\n                  </Badge>\r\n                  {isSkipped && (\r\n                    <Badge variant=\"outline\" className=\"text-[10px] px-1.5 py-0 text-muted-foreground\">\r\n                      {t(\"aiRecipe.skipped\", \"已跳过\")}\r\n                    </Badge>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Save / Unsave toggle button */}\r\n              {onSaveRecipe && !isSkipped && (\r\n                <button\r\n                  onClick={(e) => handleToggleSave(index, e)}\r\n                  disabled={savingIndex === index}\r\n                  className={`p-1.5 rounded-lg shrink-0 transition-colors ${\r\n                    isSaved\r\n                      ? \"text-primary\"\r\n                      : \"text-muted-foreground hover:text-primary hover:bg-primary/10\"\r\n                  }`}\r\n                >\r\n                  {savingIndex === index ? (\r\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                  ) : (\r\n                    <Bookmark className={`h-4 w-4 ${isSaved ? \"fill-primary\" : \"\"}`} />\r\n                  )}\r\n                </button>\r\n              )}\r\n\r\n              {/* Selection indicator */}\r\n              {!isSkipped && (\r\n                <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center shrink-0 transition-colors ${\r\n                  selectedIndices.has(index)\r\n                    ? \"bg-primary border-primary text-primary-foreground\"\r\n                    : \"border-muted-foreground/30\"\r\n                }`}>\r\n                  {selectedIndices.has(index) && <Check className=\"h-3.5 w-3.5\" />}\r\n                </div>\r\n              )}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <div className=\"w-full max-w-sm space-y-3\">\r\n        <Button\r\n          className=\"w-full gap-2 h-12\"\r\n          onClick={() => onShare(Array.from(selectedIndices).sort())}\r\n          disabled={selectedIndices.size === 0}\r\n        >\r\n          {selectedIndices.size > 0\r\n            ? t(\"aiRecipe.shareSelected\", \"分享 {{count}} 道菜到社区\", { count: selectedIndices.size })\r\n            : t(\"aiRecipe.shareToComm\", \"分享到社区\")}\r\n        </Button>\r\n        <Button variant=\"outline\" className=\"w-full gap-2\" onClick={onSkip}>\r\n          <X className=\"h-4 w-4\" />\r\n          {t(\"aiRecipe.noThanks\", \"暂时不分享\")}\r\n        </Button>\r\n      </div>\r\n\r\n      <p className=\"text-xs text-muted-foreground text-center max-w-xs\">\r\n        {t(\"aiRecipe.shareNote\", \"分享需要拍摄成品照片进行验证，以确保内容真实可靠\")}\r\n      </p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipeSharePrompt;\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { ArrowLeft, Loader2, Sparkles, Bookmark, X, Camera, SkipForward } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { useAIRecipe, IdentifiedIngredient, AIRecipeSuggestion } from \"@/hooks/useAIRecipe\";\r\nimport { useCreateRecipe } from \"@/hooks/useCreateRecipe\";\r\nimport { useSavedRecipes } from \"@/hooks/useSavedRecipes\";\r\nimport { useLoginRequired } from \"@/hooks/useLoginRequired\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\r\nimport IngredientPhotoStep from \"@/components/ai-recipe/IngredientPhotoStep\";\r\nimport IngredientConfirmStep from \"@/components/ai-recipe/IngredientConfirmStep\";\r\nimport PreferencesStep, { RecipePreferences } from \"@/components/ai-recipe/PreferencesStep\";\r\nimport RecipeSelectStep from \"@/components/ai-recipe/RecipeSelectStep\";\r\nimport MealDetailView from \"@/components/ai-recipe/MealDetailView\";\r\nimport MealCookingView from \"@/components/ai-recipe/MealCookingView\";\r\nimport ResultPhotoStep from \"@/components/ai-recipe/ResultPhotoStep\";\r\nimport AIRecipeSharePrompt from \"@/components/ai-recipe/AIRecipeSharePrompt\";\r\nimport PublishConfirmStep from \"@/components/ai-recipe/PublishConfirmStep\";\r\n\r\ntype Step = \"photo\" | \"confirm\" | \"preferences\" | \"generating\" | \"select\" | \"detail\" | \"cooking\" | \"share-prompt\" | \"result\" | \"publish\";\r\n\r\nconst STEP_ORDER: Step[] = [\"photo\", \"confirm\", \"preferences\", \"generating\", \"select\", \"detail\", \"cooking\", \"share-prompt\", \"result\", \"publish\"];\r\n\r\nconst SESSION_KEY = \"ai-recipe-session\";\r\n\r\ninterface SessionState {\r\n  step: Step;\r\n  ingredientImageUrls: string[];\r\n  ingredients: IdentifiedIngredient[];\r\n  preferences: RecipePreferences;\r\n  recipes: AIRecipeSuggestion[];\r\n  publishingDishIndex: number;\r\n  publishQueue: number[];\r\n  resultImageUrl: string;\r\n  photoVerified: boolean;\r\n}\r\n\r\nconst loadSession = (): Partial<SessionState> => {\r\n  try {\r\n    const raw = sessionStorage.getItem(SESSION_KEY);\r\n    if (raw) return JSON.parse(raw);\r\n  } catch {}\r\n  return {};\r\n};\r\n\r\nconst AIRecipe = () => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const backTo = (location.state as any)?.from || \"/ai-recipe\";\r\n  const { requireLogin } = useLoginRequired();\r\n  const { identifyIngredients, generateRecipes, verifyResultPhoto, uploadImage, isIdentifying, isGenerating, isVerifying } = useAIRecipe();\r\n  const [showCloseConfirm, setShowCloseConfirm] = useState(false);\r\n  const createRecipe = useCreateRecipe();\r\n  const { saveRecipe, deleteRecipe, isSaving } = useSavedRecipes();\r\n\r\n  const [saved] = useState(() => loadSession());\r\n  const hasExistingSession = !!(saved.step && saved.step !== \"photo\" && saved.step !== \"generating\" && (saved.ingredients?.length || saved.recipes?.length));\r\n\r\n  const [showResumeDialog, setShowResumeDialog] = useState(hasExistingSession);\r\n  const [sessionActive, setSessionActive] = useState(!hasExistingSession);\r\n\r\n  const [step, setStep] = useState<Step>(\"photo\");\r\n  const [ingredientImageUrls, setIngredientImageUrls] = useState<string[]>([]);\r\n  const [ingredients, setIngredients] = useState<IdentifiedIngredient[]>([]);\r\n  const [preferences, setPreferences] = useState<RecipePreferences>({});\r\n  const [recipes, setRecipes] = useState<AIRecipeSuggestion[]>([]);\r\n  const recipesRef = useRef<AIRecipeSuggestion[]>([]);\r\n  const [recipeHistory, setRecipeHistory] = useState<AIRecipeSuggestion[][]>([]);\r\n  const [publishingDishIndex, setPublishingDishIndex] = useState<number>(0);\r\n  const [publishQueue, setPublishQueue] = useState<number[]>([]);\r\n  const [resultImageUrl, setResultImageUrl] = useState<string>(\"\");\r\n  const [photoVerified, setPhotoVerified] = useState(false);\r\n  const [resultNote, setResultNote] = useState<string>(\"\");\r\n  const [skippedCookingIndices, setSkippedCookingIndices] = useState<number[]>([]);\r\n\r\n  const handleResumeSession = () => {\r\n    setStep(saved.step && saved.step !== \"generating\" ? saved.step : \"photo\");\r\n    setIngredientImageUrls(saved.ingredientImageUrls || []);\r\n    setIngredients(saved.ingredients || []);\r\n    setPreferences(saved.preferences || {});\r\n    const savedRecipes = saved.recipes || [];\r\n    recipesRef.current = savedRecipes;\r\n    setRecipes(savedRecipes);\r\n    setPublishingDishIndex(saved.publishingDishIndex || 0);\r\n    setPublishQueue(saved.publishQueue || []);\r\n    setResultImageUrl(saved.resultImageUrl || \"\");\r\n    setPhotoVerified(saved.photoVerified || false);\r\n    setSessionActive(true);\r\n    setShowResumeDialog(false);\r\n  };\r\n\r\n  // Keep ref always in sync with recipes state — most reliable way to avoid stale closures\r\n  useEffect(() => {\r\n    recipesRef.current = recipes;\r\n  }, [recipes]);\r\n\r\n  const handleNewSession = () => {\r\n    sessionStorage.removeItem(SESSION_KEY);\r\n    setSessionActive(true);\r\n    setShowResumeDialog(false);\r\n  };\r\n\r\n  const stepIndex = STEP_ORDER.indexOf(step);\r\n  const progress = ((stepIndex + 1) / STEP_ORDER.length) * 100;\r\n\r\n  // Persist state to sessionStorage (only when session is active to avoid overwriting with defaults)\r\n  useEffect(() => {\r\n    if (!sessionActive) return;\r\n    try {\r\n      const lightRecipes = recipes.map(r => ({\r\n        ...r,\r\n        image_url: r.image_url && r.image_url.startsWith(\"data:\") ? undefined : r.image_url,\r\n      }));\r\n      const state: SessionState = { step, ingredientImageUrls, ingredients, preferences, recipes: lightRecipes as any, publishingDishIndex, publishQueue, resultImageUrl, photoVerified };\r\n      sessionStorage.setItem(SESSION_KEY, JSON.stringify(state));\r\n    } catch (e) {\r\n      console.warn(\"Session save failed (quota):\", e);\r\n    }\r\n  }, [sessionActive, step, ingredientImageUrls, ingredients, preferences, recipes, publishingDishIndex, publishQueue, resultImageUrl, photoVerified]);\r\n\r\n  // Scroll to top when step changes\r\n  useEffect(() => {\r\n    window.scrollTo({ top: 0, behavior: \"instant\" });\r\n  }, [step]);\r\n\r\n  const currentPublishRecipe = publishQueue.length > 0 ? recipes[publishQueue[0]] : null;\r\n  const currentQueuePosition = publishQueue.length > 0 ? 1 : 0;\r\n  // Step 1a: Photos uploaded → identify\r\n  const handlePhotosUploaded = async (urls: string[]) => {\r\n    if (!requireLogin()) return;\r\n    setIngredientImageUrls(urls);\r\n    const allIngredients: IdentifiedIngredient[] = [];\r\n    const seen = new Set<string>();\r\n    for (const url of urls) {\r\n      const result = await identifyIngredients(url);\r\n      if (result) {\r\n        for (const ing of result) {\r\n          if (!seen.has(ing.name)) {\r\n            seen.add(ing.name);\r\n            allIngredients.push(ing);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (allIngredients.length > 0) {\r\n      setIngredients(allIngredients);\r\n      setStep(\"confirm\");\r\n    }\r\n  };\r\n\r\n  const handleSkipToManual = () => {\r\n    if (!requireLogin()) return;\r\n    setIngredients([]);\r\n    setStep(\"confirm\");\r\n  };\r\n\r\n  const handleConfirmIngredients = () => {\r\n    if (ingredients.length === 0) {\r\n      toast.error(t(\"aiRecipe.noIngredients\", \"请至少保留一种食材\"));\r\n      return;\r\n    }\r\n    setStep(\"preferences\");\r\n  };\r\n\r\n  const handlePreferencesConfirm = async (prefs: RecipePreferences) => {\r\n    setPreferences(prefs);\r\n    await doGenerate(prefs);\r\n  };\r\n\r\n  const handlePreferencesSkip = async () => {\r\n    setPreferences({});\r\n    await doGenerate({});\r\n  };\r\n\r\n  const doGenerate = async (prefs: RecipePreferences, excludeDishes?: string[]) => {\r\n    setStep(\"generating\");\r\n    // Snapshot current recipes from ref before async call (ref is always latest via useEffect)\r\n    const currentBeforeGenerate = recipesRef.current.slice();\r\n    const result = await generateRecipes(ingredients, prefs.difficulty, prefs.servings, prefs.dishCount, prefs.notes, excludeDishes);\r\n    if (result && result.length > 0) {\r\n      // Push snapshot into history only if non-empty and not a dup of history top\r\n      if (currentBeforeGenerate.length > 0) {\r\n        setRecipeHistory(prev => {\r\n          const isDup =\r\n            prev.length > 0 &&\r\n            prev[0].length === currentBeforeGenerate.length &&\r\n            prev[0][0]?.recipe_name === currentBeforeGenerate[0]?.recipe_name;\r\n          if (isDup) return prev;\r\n          return [currentBeforeGenerate, ...prev].slice(0, 5);\r\n        });\r\n      }\r\n      setRecipes(result); // useEffect will update recipesRef.current\r\n      setStep(\"select\");\r\n    } else {\r\n      setStep(\"preferences\");\r\n    }\r\n  };\r\n\r\n  // Confirm entire meal\r\n  const handleConfirmMeal = () => {\r\n    setStep(\"detail\");\r\n  };\r\n\r\n  // Save all recipes\r\n  const handleSaveAllRecipes = async () => {\r\n    for (const recipe of recipes) {\r\n      await saveRecipe(recipe);\r\n    }\r\n  };\r\n\r\n  const handleStartCooking = () => {\r\n    setStep(\"cooking\");\r\n  };\r\n\r\n  const handleCookingComplete = (skippedIndices: number[]) => {\r\n    setSkippedCookingIndices(skippedIndices);\r\n    setStep(\"share-prompt\");\r\n  };\r\n\r\n  const [showSaveBeforeAction, setShowSaveBeforeAction] = useState<\"share\" | \"skip\" | null>(null);\r\n\r\n  const handleWantToShare = (selectedIndices: number[]) => {\r\n    setPublishQueue(selectedIndices);\r\n    setShowSaveBeforeAction(\"share\");\r\n  };\r\n\r\n  const handleSkipShare = () => {\r\n    sessionStorage.removeItem(SESSION_KEY);\r\n    toast.success(t(\"aiRecipe.cookingComplete\", \"太棒了！烹饪完成！\"));\r\n    navigate(\"/community\");\r\n  };\r\n\r\n  const handleSaveAndContinue = async (action: \"share\" | \"skip\") => {\r\n    for (const recipe of recipes) {\r\n      await saveRecipe(recipe);\r\n    }\r\n    setShowSaveBeforeAction(null);\r\n    if (action === \"share\") {\r\n      setPublishingDishIndex(publishQueue[0] || 0);\r\n      setStep(\"result\");\r\n    } else {\r\n      handleSkipShare();\r\n    }\r\n  };\r\n\r\n  const handleSkipSaveAndContinue = (action: \"share\" | \"skip\") => {\r\n    setShowSaveBeforeAction(null);\r\n    if (action === \"share\") {\r\n      setPublishingDishIndex(publishQueue[0] || 0);\r\n      setStep(\"result\");\r\n    } else {\r\n      handleSkipShare();\r\n    }\r\n  };\r\n\r\n  // Result photo verified\r\n  const handlePhotoVerified = (url: string, verified: boolean, note?: string) => {\r\n    setResultImageUrl(url);\r\n    setPhotoVerified(verified);\r\n    if (note) setResultNote(note);\r\n    if (verified) {\r\n      setStep(\"publish\");\r\n    }\r\n  };\r\n\r\n  // Publish current dish\r\n  const handlePublish = async (notes?: string) => {\r\n    if (!currentPublishRecipe || !resultImageUrl) return;\r\n\r\n    try {\r\n      await createRecipe.mutateAsync({\r\n        recipe_name: currentPublishRecipe.recipe_name,\r\n        recipe_name_en: currentPublishRecipe.recipe_name_en,\r\n        recipe_name_pt: currentPublishRecipe.recipe_name_pt,\r\n        subtitle: currentPublishRecipe.subtitle,\r\n        subtitle_en: currentPublishRecipe.subtitle_en,\r\n        subtitle_pt: currentPublishRecipe.subtitle_pt,\r\n        cook_time: currentPublishRecipe.cook_time,\r\n        difficulty: currentPublishRecipe.difficulty,\r\n        servings: currentPublishRecipe.servings,\r\n        ingredients: currentPublishRecipe.ingredients,\r\n        steps: currentPublishRecipe.steps.map((s, i) => ({ ...s, order: i + 1 })),\r\n        cover_image: resultImageUrl,\r\n        introduction: currentPublishRecipe.introduction || \"\",\r\n        introduction_en: currentPublishRecipe.introduction_en,\r\n        introduction_pt: currentPublishRecipe.introduction_pt,\r\n        cooking_note: notes?.trim() || resultNote || undefined,\r\n        ai_recipe_source: {\r\n          source: \"ai_recipe\",\r\n          ingredient_images: ingredientImageUrls,\r\n          identified_ingredients: ingredients,\r\n          selected_recipe_index: publishQueue[0],\r\n          all_recipes: recipes.map(r => r.recipe_name),\r\n          result_image: resultImageUrl,\r\n          photo_verified: photoVerified,\r\n        },\r\n      });\r\n\r\n      // Remove current from queue and move to next\r\n      const remaining = publishQueue.slice(1);\r\n      setPublishQueue(remaining);\r\n\r\n      if (remaining.length > 0) {\r\n        toast.success(t(\"aiRecipe.dishPublished\", \"第 {{n}} 道菜已发布！继续下一道\", { n: currentQueuePosition }));\r\n        setPublishingDishIndex(remaining[0]);\r\n        setResultImageUrl(\"\");\r\n        setPhotoVerified(false);\r\n        setResultNote(\"\");\r\n        setStep(\"result\");\r\n      } else {\r\n        sessionStorage.removeItem(SESSION_KEY);\r\n        toast.success(t(\"aiRecipe.allPublished\", \"所有菜谱已发布到社区！\"));\r\n        navigate(\"/community\");\r\n      }\r\n    } catch (err) {\r\n      // Error handled in hook\r\n    }\r\n  };\r\n\r\n  // Skip current dish in publish queue\r\n  const handleSkipCurrentDish = () => {\r\n    const remaining = publishQueue.slice(1);\r\n    setPublishQueue(remaining);\r\n\r\n    if (remaining.length > 0) {\r\n      setPublishingDishIndex(remaining[0]);\r\n      setResultImageUrl(\"\");\r\n      setPhotoVerified(false);\r\n      setResultNote(\"\");\r\n      setStep(\"result\");\r\n    } else {\r\n      sessionStorage.removeItem(SESSION_KEY);\r\n      toast.success(t(\"aiRecipe.publishDone\", \"发布完成！\"));\r\n      navigate(\"/community\");\r\n    }\r\n  };\r\n\r\n  const handleBack = () => {\r\n    switch (step) {\r\n      case \"confirm\": setStep(\"photo\"); break;\r\n      case \"preferences\": setStep(\"confirm\"); break;\r\n      case \"select\": setStep(\"preferences\"); break;\r\n      case \"detail\": setStep(\"select\"); break;\r\n      case \"cooking\": setStep(\"detail\"); break;\r\n      case \"share-prompt\": setStep(\"cooking\"); break;\r\n      case \"result\": setStep(\"share-prompt\"); break;\r\n      case \"publish\": setStep(\"result\"); break;\r\n      default:\r\n        navigate(\"/ai-recipe\", { replace: true, state: { from: backTo } });\r\n        break;\r\n    }\r\n  };\r\n\r\n  const getStepTitle = () => {\r\n    switch (step) {\r\n      case \"photo\": return t(\"aiRecipe.stepPhoto\", \"拍摄食材\");\r\n      case \"confirm\": return t(\"aiRecipe.stepConfirm\", \"确认食材\");\r\n      case \"preferences\": return t(\"aiRecipe.stepPreferences\", \"烹饪偏好\");\r\n      case \"generating\": return t(\"aiRecipe.stepGenerating\", \"生成菜谱\");\r\n      case \"select\": return t(\"aiRecipe.stepMealPlan\", \"完整菜单\");\r\n      case \"detail\": return t(\"aiRecipe.stepDetail\", \"菜谱详情\");\r\n      case \"cooking\": return t(\"aiRecipe.stepCooking\", \"烹饪中\");\r\n      case \"share-prompt\": return t(\"aiRecipe.stepShare\", \"分享\");\r\n      case \"result\": return currentPublishRecipe\r\n        ? t(\"aiRecipe.stepResultDish\", \"拍摄成品 ({{n}}/{{total}})\", { n: currentQueuePosition, total: publishQueue.length + currentQueuePosition - 1 })\r\n        : t(\"aiRecipe.stepResult\", \"拍摄成品\");\r\n      case \"publish\": return t(\"aiRecipe.stepPublish\", \"发布\");\r\n    }\r\n  };\r\n\r\n  const getResumeStepLabel = () => {\r\n    const s = saved.step;\r\n    if (s === \"select\" || s === \"detail\") return t(\"aiRecipe.resumeAtSelect\", \"已生成菜单\");\r\n    if (s === \"cooking\") return t(\"aiRecipe.resumeAtCooking\", \"烹饪中\");\r\n    if (s === \"confirm\") return t(\"aiRecipe.resumeAtConfirm\", \"食材确认\");\r\n    if (s === \"preferences\") return t(\"aiRecipe.resumeAtPrefs\", \"烹饪偏好\");\r\n    if (s === \"share-prompt\" || s === \"result\" || s === \"publish\") return t(\"aiRecipe.resumeAtShare\", \"分享/发布\");\r\n    return \"\";\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex flex-col bg-background\">\r\n      {/* Resume session dialog - blocks main content until user decides */}\r\n      {showResumeDialog ? (\r\n        <Dialog open={showResumeDialog} onOpenChange={(open) => { if (!open) { setShowResumeDialog(false); navigate('/community', { state: { openCreatePost: true } }); } }}>\r\n          <DialogContent>\r\n            <DialogHeader>\r\n              <DialogTitle className=\"flex items-center gap-2\">\r\n                <Sparkles className=\"h-5 w-5 text-primary\" />\r\n                {t(\"aiRecipe.resumeTitle\", \"检测到未完成的食谱\")}\r\n              </DialogTitle>\r\n              <DialogDescription className=\"space-y-2\">\r\n                <span>{t(\"aiRecipe.resumeDesc\", \"您有一个未完成的 AI 食谱流程，是否要继续？\")}</span>\r\n                {saved.recipes && saved.recipes.length > 0 && (\r\n                  <span className=\"block text-xs mt-2 bg-muted rounded-lg px-3 py-2\">\r\n                    {saved.recipes.map(r => r.recipe_name).join(\"、\")}\r\n                  </span>\r\n                )}\r\n                <span className=\"block text-xs text-muted-foreground\">\r\n                  {t(\"aiRecipe.resumeProgress\", \"进度：{{step}}\", { step: getResumeStepLabel() })}\r\n                </span>\r\n              </DialogDescription>\r\n            </DialogHeader>\r\n            <DialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <Button variant=\"outline\" onClick={handleNewSession}>\r\n                {t(\"aiRecipe.startNew\", \"重新开始\")}\r\n              </Button>\r\n              <Button onClick={handleResumeSession}>\r\n                {t(\"aiRecipe.resumeContinue\", \"继续上次\")}\r\n              </Button>\r\n            </DialogFooter>\r\n          </DialogContent>\r\n        </Dialog>\r\n      ) : null}\r\n      {!showResumeDialog && <>\r\n      {/* Header */}\r\n      <div className=\"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10\">\r\n        <div className=\"flex items-center justify-between mb-2\">\r\n          <button\r\n            onClick={step === \"publish\" || step === \"share-prompt\" ? () => setShowCloseConfirm(true) : handleBack}\r\n            className=\"p-1 -ml-1 hover:bg-muted rounded-md\"\r\n          >\r\n            {step === \"publish\" || step === \"share-prompt\" ? <X className=\"h-5 w-5\" /> : <ArrowLeft className=\"h-5 w-5\" />}\r\n          </button>\r\n          <div className=\"flex items-center gap-2\">\r\n            <Sparkles className=\"h-4 w-4 text-primary\" />\r\n            <h2 className=\"font-medium\">{getStepTitle()}</h2>\r\n          </div>\r\n          <div className=\"w-6\" />\r\n        </div>\r\n        <Progress value={progress} className=\"h-1\" />\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div className=\"flex-1 overflow-y-auto p-4 max-w-lg mx-auto w-full\">\r\n        {step === \"photo\" && (\r\n          <IngredientPhotoStep\r\n            onPhotosUploaded={handlePhotosUploaded}\r\n            onSkipToManual={handleSkipToManual}\r\n            uploadImage={uploadImage}\r\n            isUploading={isIdentifying}\r\n            initialImageUrls={ingredientImageUrls}\r\n            onRequireLogin={requireLogin}\r\n          />\r\n        )}\r\n\r\n        {isIdentifying && (\r\n          <div className=\"flex flex-col items-center gap-3 py-12\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            <p className=\"text-sm text-muted-foreground\">{t(\"aiRecipe.identifying\", \"AI 正在识别食材...\")}</p>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"confirm\" && !isIdentifying && (\r\n          <div className=\"space-y-4\">\r\n            <IngredientConfirmStep ingredients={ingredients} onChange={setIngredients} />\r\n            <Button className=\"w-full\" onClick={handleConfirmIngredients}>\r\n              {t(\"aiRecipe.nextStep\", \"下一步\")}\r\n            </Button>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"preferences\" && (\r\n          <PreferencesStep\r\n            onConfirm={handlePreferencesConfirm}\r\n            onSkip={handlePreferencesSkip}\r\n            initialValues={preferences}\r\n          />\r\n        )}\r\n\r\n        {step === \"generating\" && (\r\n          <div className=\"flex flex-col items-center gap-3 py-12\">\r\n            <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            <p className=\"text-sm text-muted-foreground\">{t(\"aiRecipe.generatingMeal\", \"AI 正在为您设计一桌菜...\")}</p>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"select\" && (\r\n          <RecipeSelectStep\r\n            recipes={recipes}\r\n            recipeHistory={recipeHistory}\r\n            onSelectHistoryMeal={(meal) => {\r\n              // Snapshot current via ref (always up-to-date due to useEffect)\r\n              const current = recipesRef.current.slice();\r\n              setRecipeHistory(prev => {\r\n                // Remove selected meal from history\r\n                const filtered = prev.filter(h => h !== meal);\r\n                // Push current into history (deduplicated)\r\n                if (current.length === 0) return filtered;\r\n                const isDup = filtered.length > 0 && filtered[0][0]?.recipe_name === current[0]?.recipe_name && filtered[0].length === current.length;\r\n                return isDup ? filtered : [current, ...filtered].slice(0, 5);\r\n              });\r\n              setRecipes(meal); // useEffect will sync recipesRef.current\r\n            }}\r\n            onConfirmMeal={handleConfirmMeal}\r\n            onRegenerate={(updatedNotes?: string) => {\r\n              const excludeNames = recipes.map(r => r.recipe_name);\r\n              const updatedPrefs = { ...preferences, notes: updatedNotes !== undefined ? updatedNotes : preferences.notes };\r\n              setPreferences(updatedPrefs);\r\n              doGenerate(updatedPrefs, excludeNames);\r\n            }}\r\n            isRegenerating={isGenerating}\r\n            preferences={preferences}\r\n          />\r\n        )}\r\n\r\n        {step === \"detail\" && recipes.length > 0 && (\r\n          <div className=\"space-y-4\">\r\n            <MealDetailView recipes={recipes} />\r\n            <div className=\"flex gap-3\">\r\n              <Button variant=\"outline\" className=\"flex-1\" onClick={() => setStep(\"select\")}>\r\n                {t(\"aiRecipe.changeMeal\", \"换一桌\")}\r\n              </Button>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"gap-1\"\r\n                onClick={handleSaveAllRecipes}\r\n                disabled={isSaving}\r\n              >\r\n                <Bookmark className=\"h-4 w-4\" />\r\n                {t(\"aiRecipe.saveAll\", \"全部保存\")}\r\n              </Button>\r\n              <Button className=\"flex-1\" onClick={handleStartCooking}>\r\n                {t(\"aiRecipe.startCooking\", \"开始烹饪\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {step === \"cooking\" && recipes.length > 0 && (\r\n          <MealCookingView\r\n            recipes={recipes}\r\n            ingredientImageUrl={ingredientImageUrls[0] || \"\"}\r\n            onComplete={handleCookingComplete}\r\n            onBack={() => setStep(\"detail\")}\r\n          />\r\n        )}\r\n\r\n        {step === \"share-prompt\" && recipes.length > 0 && (\r\n          <div className=\"space-y-4\">\r\n            <AIRecipeSharePrompt\r\n              recipes={recipes}\r\n              skippedIndices={skippedCookingIndices}\r\n              onShare={handleWantToShare}\r\n              onSkip={() => setShowSaveBeforeAction(\"skip\")}\r\n              onSaveRecipe={saveRecipe}\r\n              onUnsaveRecipe={deleteRecipe}\r\n              isSaving={isSaving}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {/* Save before action dialog */}\r\n        <AlertDialog open={!!showSaveBeforeAction} onOpenChange={(open) => !open && setShowSaveBeforeAction(null)}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>{t(\"aiRecipe.saveBeforeTitle\", \"保存食谱？\")}</AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {t(\"aiRecipe.saveBeforeDescMeal\", \"是否将这桌菜的所有食谱保存到您的收藏中？\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <AlertDialogCancel onClick={() => showSaveBeforeAction && handleSkipSaveAndContinue(showSaveBeforeAction)}>\r\n                {t(\"aiRecipe.noSave\", \"不保存\")}\r\n              </AlertDialogCancel>\r\n              <AlertDialogAction\r\n                onClick={() => showSaveBeforeAction && handleSaveAndContinue(showSaveBeforeAction)}\r\n                disabled={isSaving}\r\n              >\r\n                <Bookmark className=\"h-4 w-4 mr-1\" />\r\n                {t(\"aiRecipe.saveAllRecipes\", \"保存全部食谱\")}\r\n              </AlertDialogAction>\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n\r\n        {step === \"result\" && currentPublishRecipe && (\r\n          <div className=\"space-y-4\">\r\n            {/* Current dish indicator */}\r\n            {publishQueue.length > 0 && (\r\n              <div className=\"flex items-center gap-3 p-3 rounded-xl border bg-muted/30\">\r\n                <div className=\"w-12 h-12 rounded-lg overflow-hidden bg-muted shrink-0\">\r\n                  {currentPublishRecipe.image_url ? (\r\n                    <img src={currentPublishRecipe.image_url} alt=\"\" className=\"w-full h-full object-cover\" />\r\n                  ) : (\r\n                    <div className=\"w-full h-full flex items-center justify-center text-lg\">🍽️</div>\r\n                  )}\r\n                </div>\r\n                <div className=\"flex-1 min-w-0\">\r\n                  <p className=\"font-medium text-sm truncate\">{currentPublishRecipe.recipe_name}</p>\r\n                  {currentPublishRecipe.subtitle && (\r\n                    <p className=\"text-xs text-muted-foreground italic truncate\">{currentPublishRecipe.subtitle}</p>\r\n                  )}\r\n                </div>\r\n                {publishQueue.length > 1 && (\r\n                  <Button variant=\"ghost\" size=\"sm\" className=\"text-xs shrink-0\" onClick={handleSkipCurrentDish}>\r\n                    <SkipForward className=\"h-3.5 w-3.5 mr-1\" />\r\n                    {t(\"aiRecipe.skipThisDish\", \"跳过\")}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n            )}\r\n            <ResultPhotoStep\r\n              onPhotoVerified={handlePhotoVerified}\r\n              uploadImage={uploadImage}\r\n              verifyPhoto={verifyResultPhoto}\r\n              recipeName={currentPublishRecipe.recipe_name}\r\n              isVerifying={isVerifying}\r\n            />\r\n          </div>\r\n        )}\r\n\r\n        {step === \"publish\" && currentPublishRecipe && (\r\n          <PublishConfirmStep\r\n            resultImageUrl={resultImageUrl}\r\n            recipeName={currentPublishRecipe.recipe_name}\r\n            initialNote={resultNote}\r\n            onPublish={handlePublish}\r\n            onSkip={handleSkipCurrentDish}\r\n            isPublishing={createRecipe.isPending}\r\n          />\r\n        )}\r\n\r\n        {/* Close confirmation dialog */}\r\n        <AlertDialog open={showCloseConfirm} onOpenChange={setShowCloseConfirm}>\r\n          <AlertDialogContent>\r\n            <AlertDialogHeader>\r\n              <AlertDialogTitle>\r\n                {step === \"share-prompt\"\r\n                  ? t(\"aiRecipe.exitShareTitle\", \"确认退出？\")\r\n                  : t(\"aiRecipe.closeConfirmTitle\", \"确认离开？\")}\r\n              </AlertDialogTitle>\r\n              <AlertDialogDescription>\r\n                {step === \"share-prompt\"\r\n                  ? t(\"aiRecipe.exitShareDesc\", \"您还没有保存食谱，退出后食谱将丢失。是否先保存？\")\r\n                  : t(\"aiRecipe.closeConfirmDesc\", \"离开后将放弃发布，您的成品照片和食谱将不会保存到社区。\")}\r\n              </AlertDialogDescription>\r\n            </AlertDialogHeader>\r\n            <AlertDialogFooter className=\"flex-col sm:flex-row gap-2\">\r\n              <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n              {step === \"share-prompt\" ? (\r\n                <>\r\n                  <AlertDialogAction\r\n                    onClick={async () => {\r\n                      for (const recipe of recipes) {\r\n                        await saveRecipe(recipe);\r\n                      }\r\n                      setShowCloseConfirm(false);\r\n                      handleSkipShare();\r\n                    }}\r\n                    disabled={isSaving}\r\n                  >\r\n                    <Bookmark className=\"h-4 w-4 mr-1\" />\r\n                    {t(\"aiRecipe.saveAndExit\", \"保存并退出\")}\r\n                  </AlertDialogAction>\r\n                  <AlertDialogAction\r\n                    className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n                    onClick={() => {\r\n                      setShowCloseConfirm(false);\r\n                      handleSkipShare();\r\n                    }}\r\n                  >\r\n                    {t(\"aiRecipe.exitWithoutSave\", \"不保存，直接退出\")}\r\n                  </AlertDialogAction>\r\n                </>\r\n              ) : (\r\n                <AlertDialogAction onClick={handleSkipShare}>\r\n                  {t(\"aiRecipe.confirmLeave\", \"确认离开\")}\r\n                </AlertDialogAction>\r\n              )}\r\n            </AlertDialogFooter>\r\n          </AlertDialogContent>\r\n        </AlertDialog>\r\n      </div>\r\n      </>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AIRecipe;\r\n"],"names":["MAX_PHOTOS","IngredientPhotoStep","onPhotosUploaded","onSkipToManual","uploadImage","isUploading","initialImageUrls","onRequireLogin","t","useTranslation","photos","setPhotos","useState","url","i","showCamera","setShowCamera","fileRef","useRef","uploadingCount","p","allUploaded","handleFiles","files","fileArray","remaining","toAdd","f","newItems","prev","file","handleCameraCapture","handleOpenCamera","removePhoto","id","handleSubmit","urls","jsxs","Fragment","jsx","CameraCapture","Camera","photo","Loader2","X","Plus","Button","ImageIcon","PenLine","e","IngredientConfirmStep","ingredients","onChange","editIndex","setEditIndex","editName","setEditName","editAmount","setEditAmount","editUnit","setEditUnit","newName","setNewName","handleEdit","index","handleSaveEdit","updated","handleDelete","_","handleAdd","item","Input","Check","Badge","Edit2","Trash2","SERVINGS_OPTIONS","DISH_COUNT_OPTIONS","PreferencesStep","onConfirm","onSkip","initialValues","difficulty","setDifficulty","servings","setServings","dishCount","setDishCount","notes","setNotes","isCustom","showCustom","setShowCustom","customServings","setCustomServings","difficulties","ChefHat","d","Users","s","n","UtensilsCrossed","c","MessageSquare","Textarea","SkipForward","RecipeSelectStep","recipes","recipeHistory","onSelectHistoryMeal","onConfirmMeal","onRegenerate","isRegenerating","preferences","i18n","editingNotes","setEditingNotes","notesValue","setNotesValue","showHistory","setShowHistory","getLocalizedName","recipe","getLocalizedSubtitle","difficultyLabel","totalCookTime","sum","r","Info","Card","Sparkles","Globe","CardHeader","CardContent","Clock","AlertTriangle","lang","Pencil","RefreshCw","h","History","ChevronDown","meal","hi","dish","di","MealDetailView","expandedIndex","setExpandedIndex","getLocalName","getLocalSubtitle","Collapsible","open","CollapsibleTrigger","ChevronUp","CollapsibleContent","ing","localName","step","localDesc","AIRecipeCookingView","ingredientImageUrl","onComplete","onBack","viewMode","setViewMode","guidedStarted","setGuidedStarted","previewImageUrl","setPreviewImageUrl","getName","getDifficultyLabel","getDifficultyColor","steps","RecipeCookingMode","ModeToggle","PlayCircle","List","RecipeHeader","intro","Separator","ingredient","imgs","imgIdx","ImagePreviewModal","MealCookingView","currentDishIndex","setCurrentDishIndex","completedDishes","setCompletedDishes","skippedDishes","setSkippedDishes","isAllResolved","completed","skipped","moveToNext","fromIndex","handleDishComplete","newCompleted","handleSkipDish","newSkipped","AIRecipeSharePrompt","skippedIndices","onShare","onSaveRecipe","onUnsaveRecipe","isSaving","selectedIndices","setSelectedIndices","savedMap","setSavedMap","savingIndex","setSavingIndex","handleToggleSave","savedId","next","result","toggleDish","PartyPopper","isSkipped","isSaved","Bookmark","STEP_ORDER","SESSION_KEY","loadSession","raw","AIRecipe","navigate","useNavigate","backTo","useLocation","requireLogin","useLoginRequired","identifyIngredients","generateRecipes","verifyResultPhoto","isIdentifying","isGenerating","isVerifying","useAIRecipe","showCloseConfirm","setShowCloseConfirm","createRecipe","useCreateRecipe","saveRecipe","deleteRecipe","useSavedRecipes","saved","hasExistingSession","showResumeDialog","setShowResumeDialog","sessionActive","setSessionActive","setStep","ingredientImageUrls","setIngredientImageUrls","setIngredients","setPreferences","setRecipes","recipesRef","setRecipeHistory","publishingDishIndex","setPublishingDishIndex","publishQueue","setPublishQueue","resultImageUrl","setResultImageUrl","photoVerified","setPhotoVerified","resultNote","setResultNote","skippedCookingIndices","setSkippedCookingIndices","handleResumeSession","savedRecipes","useEffect","handleNewSession","progress","lightRecipes","state","currentPublishRecipe","currentQueuePosition","handlePhotosUploaded","allIngredients","seen","handleSkipToManual","handleConfirmIngredients","toast","handlePreferencesConfirm","prefs","doGenerate","handlePreferencesSkip","excludeDishes","currentBeforeGenerate","handleConfirmMeal","handleSaveAllRecipes","handleStartCooking","handleCookingComplete","showSaveBeforeAction","setShowSaveBeforeAction","handleWantToShare","handleSkipShare","handleSaveAndContinue","action","handleSkipSaveAndContinue","handlePhotoVerified","verified","note","handlePublish","handleSkipCurrentDish","handleBack","getStepTitle","getResumeStepLabel","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","ArrowLeft","Progress","current","filtered","updatedNotes","excludeNames","updatedPrefs","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","ResultPhotoStep","PublishConfirmStep"],"mappings":"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"}