const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-QnE9GqXs.js","assets/vendor-ui-BO6fjm1h.js","assets/vendor-react-CrHRjzzo.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-BO6fjm1h.js";import{u as qt,r as g,R as z,L as W}from"./vendor-react-CrHRjzzo.js";import{D as be,c as _e,d as Se,e as Ee,k as P,a6 as Be,u as Pe,s as O,ah as ht,aW as xt,aX as Gt,aI as ut,B as E,aY as Kt,aE as is,aB as ks,aC as Ds,aD as Rs,I,aZ as Yt,aF as F,a_ as ss,a$ as ts,b0 as as,b1 as rs,b2 as ns,b3 as Xt,b4 as Wt,b5 as pt,A as oe,t as ce,v as de,x as me,y as he,z as xe,G as ue,H as re,ai as S,aP as ft,q as L,a0 as H,a9 as q,p as Fe,a1 as $,aS as Y,b6 as Xs,aH as Zt,r as Is,a7 as Jt,ar as ea,b7 as sa,b8 as ta,b9 as aa,ba as ra,bb as He,S as na,bc as ia,bd as Ge,a8 as Oe,az as pe,au as Ws,Z as fe,ax as Vs,be as la,bf as oa,L as ca,bg as da,aM as Ms,aN as ma,$ as Ss,bh as Fs,bi as $e,bj as Ie,bk as Zs,aG as ha,bl as xa,aL as ua,bm as pa,C as fa,bn as ls,bo as ga,bp as ja,bq as va,br as Na,b as ya,R as wa,U as Js,bs as ze,bt as et}from"./index-DPt6srxb.js";import{u as Z,_ as Ca}from"./vendor-i18n-DWR4v88Y.js";import{a as Qe,u as ba}from"./vendor-query-EnOED-MY.js";import{T as Es,a as As,b as J,c as ee}from"./tabs-jl3FeDUE.js";import{C as _a,a as Sa,b as Ke}from"./carousel-CUB2D-Ji.js";import{a as Ea}from"./useActivities-BVrK1Gn7.js";import{u as cs}from"./useLocalizedContent-S0TAoDtX.js";import{u as Aa}from"./useActivityParticipation-Bosvj9r1.js";import{d as Pa}from"./useCoupons-DH7ZbUN7.js";import{u as ka,a as Da,b as Ra,c as Ia,d as Ma,P as st}from"./PointsHistoryDialog-RI8iJofY.js";import{C as Fa}from"./checkbox-DY_NHJK4.js";import{A as tt}from"./ActivityTermsAgreement-D0WQbi6o.js";import{S as Os}from"./separator-Cw8_ERVs.js";import{f as Ne}from"./format-BKpO4UHC.js";import{P as Oa}from"./PullToRefresh-eghfMZXi.js";import{C as Ta,a as La,b as $a}from"./collapsible-C8Nxqkr0.js";import{u as za,a as Ua,b as Ba,c as Ha}from"./useInvitationCodes-DuxioI8-.js";import{u as Qa}from"./index.esm-DEEUA1pv.js";import{o as Va,s as Ye,t as qa}from"./types-DEaQs9QY.js";import{F as Ga,a as Xe,b as We,c as Ze,d as Je,e as es}from"./form-BToQRNUG.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./usePoints-D8U3b7Tg.js";import"./useActivityRules-DSppRhAY.js";import"./startOfDay-Dg24GAz-.js";import"./index-CPTVb0MP.js";function Ka({open:s,onOpenChange:t,activity:l}){const{t:n}=Z();return e.jsx(be,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(Se,{children:e.jsx(Ee,{className:"text-lg font-semibold line-clamp-2",children:l.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(P,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Be,{className:"w-3.5 h-3.5 fill-primary text-primary"}),n("profile.activityFavorited")]}),l.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:l.image_url,alt:l.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:l.content}})]})]})})}const Ya=()=>{const{user:s}=Pe();return Qe({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:l}=await O.from("favorites").select("restaurant_id").eq("user_id",s.id);if(l)throw l;if(!t||t.length===0)return[];const n=t.map(x=>x.restaurant_id),{data:h,error:o}=await O.from("restaurants").select("*").in("id",n).eq("visible",!0);if(o)throw o;return h||[]},enabled:!!s})},Xa=()=>{const{user:s}=Pe();return Qe({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:l}=await O.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(l)throw l;if(!t||t.length===0)return[];const n=t.filter(d=>d.target_type==="restaurant").map(d=>d.target_id),h=t.filter(d=>d.target_type==="activity").map(d=>d.target_id),o=new Map;if(n.length>0){const{data:d}=await O.from("restaurants").select("id, name, name_en, name_pt").in("id",n);d?.forEach(r=>{o.set(r.id,{name:r.name,name_en:r.name_en||void 0,name_pt:r.name_pt||void 0})})}const x=new Map;if(h.length>0){const{data:d}=await O.from("activities").select("id, title_zh, title_en, title_pt").in("id",h);d?.forEach(r=>{x.set(r.id,{title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt})})}return t.map(d=>{if(d.target_type==="restaurant"){const r=o.get(d.target_id);return{...d,target_name:r?.name||"Unknown Restaurant",target_name_en:r?.name_en,target_name_pt:r?.name_pt}}else if(d.target_type==="activity"){const r=x.get(d.target_id);return{...d,target_name:r?.title_zh||"Unknown Activity",target_name_en:r?.title_en,target_name_pt:r?.title_pt}}return d})},enabled:!!s,staleTime:3e4})},Wa=()=>{const{user:s}=Pe(),{data:t=[]}=Aa();return Qe({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||t.length===0)return[];const l=t.map(a=>a.id),{data:n,error:h}=await O.from("activity_restaurants").select("*").in("restaurant_id",l).order("created_at",{ascending:!1});if(h)throw h;if(!n||n.length===0)return[];const{data:o}=await O.from("restaurants").select("id, name, name_en, name_pt, address").in("id",l),x=[...new Set(n.map(a=>a.activity_id))],{data:d}=await O.from("activities").select("*").in("id",x).eq("status","published");return n.map(a=>{const i=o?.find(m=>m.id===a.restaurant_id),c=d?.find(m=>m.id===a.activity_id);return{activity_id:a.activity_id,restaurant_id:a.restaurant_id,restaurant_name:i?.name||"",restaurant_name_en:i?.name_en||null,restaurant_name_pt:i?.name_pt||null,restaurant_address:i?.address||"",activity:c||null,created_at:a.created_at}}).filter(a=>a.activity!==null)},enabled:!!s&&t.length>0})},gt=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],at=s=>{if(!s)return{code:"+351",number:""};for(const t of gt)if(s.startsWith(t.code))return{code:t.code,number:s.slice(t.code.length).trim()};return{code:"+351",number:s}},rt=({profile:s})=>{const{t}=Z(),l=qt(),{user:n}=Pe(),{isAdmin:h}=ht(),[o,x]=g.useState(!1),[d,r]=g.useState(s.display_name),a=at(s.phone),[i,c]=g.useState(a.code),[m,f]=g.useState(a.number),[p,v]=g.useState(!1),[N,D]=g.useState(null),[w,y]=g.useState(s.avatar_url||""),[A,T]=g.useState(!1),[B,se]=g.useState(!1),[Q,R]=g.useState(""),[ne,U]=g.useState(!1),ge=g.useRef(!1);g.useEffect(()=>{const u=ge.current;if(ge.current=o,o&&!u){r(s.display_name);const C=at(s.phone);c(C.code),f(C.number),y(s.avatar_url||""),D(null),v(!1)}},[o,s.display_name,s.phone,s.avatar_url]);const[ye,V]=g.useState(!1),[X,G]=g.useState(!1),[ie,te]=g.useState(!1),[j,_]=g.useState(""),[k,K]=g.useState(""),[je,ke]=g.useState(""),[De,Ve]=g.useState(!1),[we,qe]=g.useState(!1),[qs,ds]=g.useState(!1),[kt,Te]=g.useState(!1),[Dt,Le]=g.useState(!1),[ms,hs]=g.useState(""),[le,xs]=g.useState(""),[Ce,us]=g.useState(""),[Gs,ps]=g.useState(!1),[fs,gs]=g.useState(""),[Re,js]=g.useState(!1),[Ks,Ys]=g.useState(!1),[ae,vs]=g.useState(null),Ns=g.useRef(null),ys=g.useRef(null),ws=g.useRef(null),Cs=xt(),bs=Gt();g.useEffect(()=>{De&&Ns.current&&Ns.current.focus()},[De]),g.useEffect(()=>{we&&ys.current&&ys.current.focus()},[we]),g.useEffect(()=>{Re&&ws.current&&ws.current.focus()},[Re]);const Rt=u=>{const C=u.target.files?.[0];if(C){if(C.size>2*1024*1024)return;D(C),y(URL.createObjectURL(C))}},It=async()=>{let u=s.avatar_url;if(N){const ve=await bs.mutateAsync(N);ve&&(u=ve)}const C=m?`${i} ${m}`:void 0;await Cs.mutateAsync({display_name:d,phone:C,avatar_url:u||void 0}),v(!1),x(!1)},Mt=async()=>{if(!(!n||Q.toLowerCase()!=="delete")){U(!0);try{const{error:u}=await O.functions.invoke("delete-account",{body:{userId:n.id}});if(u){S.error(t("profile.deleteAccountFailed")),console.error(u),U(!1);return}S.success(t("profile.deleteAccountSuccess")),se(!1),T(!1),R(""),await new Promise(C=>setTimeout(C,1500)),await O.auth.signOut(),l("/auth")}catch(u){S.error(u.message||t("profile.deleteAccountFailed")),U(!1)}finally{U(!1)}}},Ft=async()=>{if(n?.email)try{const{error:u}=await O.functions.invoke("send-verification-code",{body:{email:n.email}});if(u)throw u;Ve(!0),S.success(t("profile.codeSentToOldEmail"))}catch(u){S.error(t("profile.sendCodeFailed")),console.error(u)}},Ot=async()=>{if(!k){S.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:C}=await O.functions.invoke("verify-email-code",{body:{email:n?.email,code:k}});if(C||!u?.success){S.error(t("profile.codeIncorrect"));return}S.success(t("profile.oldEmailVerified")),V(!1),G(!0)}catch(u){S.error(t("profile.verificationFailed")),console.error(u)}},Tt=async()=>{if(!j||!j.includes("@")){S.error(t("profile.enterValidEmail"));return}try{const{error:u}=await O.functions.invoke("send-verification-code",{body:{email:j}});if(u)throw u;S.success(t("profile.codeSentToNewEmail")),qe(!0)}catch(u){S.error(t("profile.sendCodeFailed")),console.error(u)}},Lt=async()=>{if(!je){S.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:C}=await O.functions.invoke("verify-email-code",{body:{email:j,code:je}});if(C||!u?.success){S.error(t("profile.codeIncorrect"));return}S.success(t("profile.newEmailVerified")),G(!1),setTimeout(()=>{te(!0)},100)}catch(u){S.error(t("toast.verificationFailed")),console.error(u)}},$t=async()=>{ds(!0);try{const{data:{session:u}}=await O.auth.getSession();if(!u||!n){S.error(t("toast.pleaseSignIn")),ds(!1);return}const{data:C,error:ve}=await O.functions.invoke("update-email",{body:{userId:n.id,oldEmail:n.email,oldEmailCode:k,newEmail:j,newEmailCode:je},headers:{Authorization:`Bearer ${u.access_token}`}});if(ve||!C?.success)throw new Error(C?.error||"Failed to update email");S.success(t("toast.emailUpdatedSuccess")),te(!1),x(!1),K(""),_(""),ke(""),Ve(!1),qe(!1),await new Promise(_s=>setTimeout(_s,1500)),await O.auth.signOut(),l("/auth")}catch(u){S.error(u.message||t("toast.emailUpdateError")),console.error(u)}finally{ds(!1)}},zt=u=>{let C=0;return u.length>=6&&C++,u.length>=8&&C++,/[a-z]/.test(u)&&C++,/[A-Z]/.test(u)&&C++,/[0-9]/.test(u)&&C++,/[^a-zA-Z0-9]/.test(u)&&C++,C<=2?"weak":C<=4?"medium":"strong"},Ut=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!ms){S.error(t("profile.enterCurrentPassword"));return}try{const{createClient:C}=await Ca(async()=>{const{createClient:Vt}=await import("./vendor-supabase-QnE9GqXs.js");return{createClient:Vt}},__vite__mapDeps([0,1,2])),ve=C("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:_s}=await ve.auth.signInWithPassword({email:n?.email||"",password:ms});if(_s){S.error(t("profile.oldPasswordIncorrect"));return}S.success(t("profile.oldPasswordVerified")),Te(!1),Le(!0)}catch(C){S.error(t("profile.verificationFailed")),console.error(C)}},Bt=async()=>{if(n?.email)try{const{error:u}=await O.functions.invoke("send-verification-code",{body:{email:n.email}});if(u)throw u;js(!0),S.success(t("profile.codeSentToOldEmail"))}catch(u){S.error(t("profile.sendCodeFailed")),console.error(u)}},Ht=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!fs){S.error(t("profile.enterCodePlaceholder"));return}try{const{data:C,error:ve}=await O.functions.invoke("verify-email-code",{body:{email:n?.email,code:fs}});if(ve||!C?.success){S.error(t("profile.codeIncorrect"));return}S.success(t("profile.oldEmailVerified")),Te(!1),Le(!0)}catch(C){S.error(t("profile.verificationFailed")),console.error(C)}},Qt=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!le||!Ce){S.error(t("profile.enterNewPassword"));return}if(le.length<6){S.error(t("profile.passwordTooShort"));return}if(le!==Ce){S.error(t("profile.passwordsDontMatch"));return}Ys(!0);try{const{error:C}=await O.auth.updateUser({password:le});if(C)throw C;S.success(t("profile.passwordUpdated")),Le(!1),x(!1),hs(""),xs(""),us(""),ps(!1),gs(""),js(!1)}catch(C){S.error(C.message||t("profile.passwordUpdateFailed")),console.error(C)}finally{Ys(!1)}};return e.jsxs(be,{open:o,onOpenChange:x,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(E,{variant:"outline",children:[e.jsx(Kt,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),e.jsxs(_e,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Se,{children:[e.jsx(Ee,{children:t("profile.editProfile")}),e.jsx(is,{children:t("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(ks,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(Ds,{src:w}),e.jsx(Rs,{children:d?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(I,{type:"file",accept:"image/*",onChange:Rt,className:"hidden",id:"avatar-upload"}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(Yt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),e.jsx(I,{id:"displayName",value:d,onChange:u=>r(u.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(F,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!s.phone&&!p?e.jsx(E,{variant:"outline",size:"sm",onClick:()=>v(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):p||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ss,{value:i,onValueChange:c,children:[e.jsx(ts,{className:"w-[110px] h-9",children:e.jsx(as,{placeholder:"+351"})}),e.jsx(rs,{children:gt.map(u=>e.jsx(ns,{value:u.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:u.flag}),e.jsx("span",{children:u.code})]})},u.code))})]}),e.jsx(I,{id:"phone",className:"flex-1 h-9",value:m,onChange:u=>f(u.target.value),placeholder:t("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:`${i} ${m}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(E,{variant:"outline",size:"sm",onClick:()=>v(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!h&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(F,{className:"text-sm",children:t("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:n?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>V(!0),className:"text-xs",children:[e.jsx(Xt,{className:"w-3 h-3 mr-1"}),t("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${h?"pt-2 border-t":""}`,children:[e.jsx(F,{className:"text-sm",children:t("profile.changePassword")}),e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>Te(!0),className:"w-full justify-start h-9",children:[e.jsx(Wt,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!h&&e.jsxs(E,{variant:"destructive",size:"sm",onClick:()=>T(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(pt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${h?"sm:ml-auto":""}`,children:[e.jsx(E,{variant:"outline",size:"sm",onClick:()=>{v(!1),x(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),e.jsx(E,{size:"sm",onClick:It,disabled:Cs.isPending||bs.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:Cs.isPending||bs.isPending?t("common.loading"):t("common.save")})]})]})]}),e.jsx(oe,{open:A,onOpenChange:T,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.deleteAccountWarning")}),e.jsx(he,{children:t("profile.deleteAccountDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{children:t("common.cancel")}),e.jsx(re,{onClick:()=>{T(!1),se(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),e.jsx(oe,{open:B,onOpenChange:se,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.confirmDeleteAccount")}),e.jsxs(he,{className:"space-y-4",children:[e.jsx("p",{children:t("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),e.jsx(I,{id:"confirm-delete",value:Q,onChange:u=>R(u.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>R(""),children:t("common.cancel")}),e.jsx(re,{onClick:Mt,disabled:Q.toLowerCase()!=="delete"||ne,className:"bg-destructive hover:bg-destructive/90",children:t(ne?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(oe,{open:ye,onOpenChange:V,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldEmail")}),e.jsx(he,{children:t("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:n?.email||"",disabled:!0,className:"flex-1"}),e.jsx(E,{variant:"outline",size:"sm",onClick:Ft,disabled:De,children:t(De?"profile.codeSent":"profile.sendCode")})]})]}),De&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.verificationCode")}),e.jsx(I,{ref:Ns,value:k,onChange:u=>K(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{V(!1),setTimeout(()=>{K(""),Ve(!1)},300)},children:t("common.cancel")}),De&&e.jsx(re,{onClick:Ot,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:X,onOpenChange:G,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{className:"text-center space-y-3",children:[e.jsx(me,{className:"text-xl",children:t("profile.verifyNewEmail")}),e.jsx(he,{className:"text-center",children:t("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{className:"text-sm font-normal",children:t("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"email",value:j,onChange:u=>_(u.target.value),placeholder:t("profile.enterNewEmail"),disabled:we,className:"border-2 focus:border-primary flex-1"}),e.jsx(E,{variant:"outline",size:"sm",onClick:Tt,disabled:!j||we,className:"text-xs whitespace-nowrap px-3",children:t(we?"profile.codeSent":"profile.sendCode")})]})]}),we&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(F,{className:"text-sm font-normal",children:t("profile.verificationCode")}),e.jsx(I,{ref:ys,value:je,onChange:u=>ke(u.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(xe,{className:"flex-col sm:flex-col gap-2",children:[we&&e.jsx(re,{onClick:Lt,disabled:!je||je.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(ue,{onClick:()=>{G(!1),setTimeout(()=>{_(""),ke(""),qe(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(oe,{open:ie,onOpenChange:te,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(he,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:n?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:j})]})]})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{te(!1),setTimeout(()=>{K(""),_(""),ke(""),Ve(!1),qe(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(re,{onClick:$t,disabled:qs,children:qs?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(oe,{open:kt,onOpenChange:Te,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.verifyOldPassword")}),e.jsx(he,{children:t("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Gs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{value:n?.email||"",disabled:!0,className:"flex-1"}),e.jsx(E,{variant:"outline",size:"sm",onClick:Bt,disabled:Re,children:t(Re?"profile.codeSent":"profile.sendCode")})]})]}),Re&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.verificationCode")}),e.jsx(I,{ref:ws,value:fs,onChange:u=>gs(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.currentPassword")}),e.jsx(I,{type:"password",value:ms,onChange:u=>hs(u.target.value),placeholder:t("profile.enterCurrentPassword")})]}),e.jsxs(E,{variant:"link",size:"sm",onClick:()=>ps(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{Te(!1),setTimeout(()=>{hs(""),ps(!1),gs(""),js(!1)},300)},children:t("common.cancel")}),Gs?Re&&e.jsx(re,{onClick:Ht,children:t("profile.verify")}):e.jsx(re,{onClick:Ut,children:t("profile.verify")})]})]})}),e.jsx(oe,{open:Dt,onOpenChange:Le,children:e.jsxs(ce,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(de,{children:[e.jsx(me,{children:t("profile.setNewPassword")}),e.jsx(he,{children:t("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.newPassword")}),e.jsx(I,{type:"password",value:le,onChange:u=>{xs(u.target.value),u.target.value?vs(zt(u.target.value)):vs(null)},placeholder:t("profile.enterNewPassword")}),ae&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="weak"?"bg-destructive":ae==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="medium"||ae==="strong"?ae==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${ae==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${ae==="weak"?"text-destructive":ae==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${ae}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{children:t("profile.confirmNewPassword")}),e.jsx(I,{type:"password",value:Ce,onChange:u=>us(u.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),le&&Ce&&le!==Ce&&e.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:()=>{Le(!1),setTimeout(()=>{xs(""),us(""),vs(null)},300)},children:t("common.cancel")}),e.jsx(re,{onClick:Qt,disabled:!le||!Ce||le!==Ce||Ks,children:t(Ks?"common.loading":"profile.updatePassword")})]})]})})]})},Ts=[{value:"Home",icon:ta,labelKey:"address.labelHome"},{value:"Work",icon:aa,labelKey:"address.labelWork"},{value:"Office",icon:ra,labelKey:"address.labelOffice"},{value:"Other",icon:Fe,labelKey:"address.labelOther"}],Za=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Ja=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],nt=({initialData:s,onSubmit:t,onCancel:l,isLoading:n,isEdit:h})=>{const{t:o}=Z(),[x,d]=g.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),r=a=>{a.preventDefault(),t(x)};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"label",children:o("address.label")}),e.jsxs(ss,{value:x.label,onValueChange:a=>d({...x,label:a}),children:[e.jsx(ts,{children:e.jsx(as,{placeholder:o("address.selectLabel")})}),e.jsx(rs,{children:Ts.map(a=>e.jsx(ns,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),o(a.labelKey)]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"street",children:[o("address.street")," *"]}),e.jsx(I,{id:"street",value:x.street,onChange:a=>d({...x,street:a.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"district",children:o("address.district")}),e.jsx(I,{id:"district",value:x.district,onChange:a=>d({...x,district:a.target.value}),placeholder:o("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"city",children:[o("address.city")," *"]}),e.jsx(I,{id:"city",value:x.city,onChange:a=>d({...x,city:a.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),e.jsx(I,{id:"postal_code",value:x.postal_code,onChange:a=>d({...x,postal_code:a.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"country",children:[o("address.country")," *"]}),e.jsxs(ss,{value:x.country,onValueChange:a=>d({...x,country:a}),children:[e.jsx(ts,{children:e.jsx(as,{placeholder:o("address.selectCountry")})}),e.jsx(rs,{children:Ja.map(a=>e.jsx(ns,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"phone",children:[o("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ss,{value:x.phone_code,onValueChange:a=>d({...x,phone_code:a}),children:[e.jsx(ts,{className:"w-[130px]",children:e.jsx(as,{placeholder:"+351"})}),e.jsx(rs,{children:Za.map(a=>e.jsx(ns,{value:a.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.flag}),e.jsx("span",{children:a.code})]})},a.code))})]}),e.jsx(I,{id:"phone",className:"flex-1",value:x.phone,onChange:a=>d({...x,phone:a.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fa,{id:"is_default",checked:x.is_default,onCheckedChange:a=>d({...x,is_default:a})}),e.jsx(F,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),e.jsxs(Zt,{className:"gap-2 sm:gap-0",children:[e.jsx(E,{type:"button",variant:"outline",onClick:l,children:o("common.cancel")}),e.jsx(E,{type:"submit",disabled:n,children:o(n?"common.saving":h?"common.save":"address.add")})]})]})},er=({address:s,onEdit:t,onDelete:l,onSetDefault:n,isDeleting:h,isSettingDefault:o,canDelete:x=!0})=>{const{t:d}=Z(),r=Ts.find(i=>i.value===s.label)||Ts[3],a=r.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:d(r.labelKey)}),s.is_default&&e.jsxs(P,{variant:"secondary",className:"text-xs",children:[e.jsx(Is,{className:"w-3 h-3 mr-1 fill-current"}),d("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Jt,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>n(s.id),disabled:o,title:d("address.setAsDefault"),children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>t(s),title:d("common.edit"),children:e.jsx(ea,{className:"w-4 h-4"})}),x&&e.jsxs(oe,{children:[e.jsx(sa,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:d("common.delete"),children:e.jsx(pt,{className:"w-4 h-4"})})}),e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:d("address.deleteTitle")}),e.jsx(he,{children:d("address.deleteDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{children:d("common.cancel")}),e.jsx(re,{onClick:()=>l(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:h,children:d(h?"common.deleting":"common.delete")})]})]})]})]})]})})},it=()=>{const{t:s}=Z(),{data:t,isLoading:l}=ka(),{data:n}=ft(),h=Da(),o=Ra(),x=xt(),d=Ia(),r=Ma(),[a,i]=g.useState(!1),[c,m]=g.useState(null),[f,p]=g.useState(null),[v,N]=g.useState(!1),D=!n?.phone,w=R=>{if(D&&R.phone){p(R),N(!0);return}h.mutate(R,{onSuccess:()=>i(!1)})},y=()=>{if(!f)return;const R=`${f.phone_code||"+351"} ${f.phone}`;x.mutate({phone:R}),h.mutate(f,{onSuccess:()=>{i(!1),p(null),N(!1)}})},A=()=>{p(null),N(!1)},T=R=>{c&&o.mutate({id:c.id,address:R},{onSuccess:()=>m(null)})},B=R=>{d.mutate(R)},se=R=>{r.mutate(R)};if(l)return e.jsxs(L,{children:[e.jsx(H,{children:e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx($,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const Q=t&&t.length>0;return e.jsxs(L,{children:[e.jsx(H,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(Y,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),Q&&e.jsxs(be,{open:a,onOpenChange:i,children:[e.jsx(ut,{asChild:!0,children:e.jsxs(E,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(_e,{className:"sm:max-w-[500px]",children:[e.jsxs(Se,{children:[e.jsx(Ee,{children:s("address.addNew")}),e.jsx(is,{children:s("address.addDescription")})]}),e.jsx(nt,{onSubmit:w,onCancel:()=>i(!1),isLoading:h.isPending})]})]})]})}),e.jsx($,{children:Q?e.jsx("div",{className:"space-y-4",children:t.map(R=>e.jsx(er,{address:R,onEdit:m,onDelete:B,onSetDefault:se,isDeleting:d.isPending,isSettingDefault:r.isPending,canDelete:t.length>1},R.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Fe,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(E,{onClick:()=>i(!0),children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(be,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(_e,{className:"sm:max-w-[500px]",children:[e.jsxs(Se,{children:[e.jsx(Ee,{children:s("address.editAddress")}),e.jsx(is,{children:s("address.editDescription")})]}),c&&e.jsx(nt,{initialData:c,onSubmit:T,onCancel:()=>m(null),isLoading:o.isPending,isEdit:!0})]})}),e.jsx(oe,{open:v,onOpenChange:N,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(me,{children:s("address.phoneConfirmTitle")}),e.jsx(he,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(xe,{children:[e.jsx(ue,{onClick:A,children:s("common.cancel")}),e.jsx(re,{onClick:y,disabled:h.isPending||x.isPending,children:h.isPending||x.isPending?s("common.saving"):s("common.confirm")})]})]})})]})};var sr=Object.defineProperty,os=Object.getOwnPropertySymbols,jt=Object.prototype.hasOwnProperty,vt=Object.prototype.propertyIsEnumerable,lt=(s,t,l)=>t in s?sr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l,Ls=(s,t)=>{for(var l in t||(t={}))jt.call(t,l)&&lt(s,l,t[l]);if(os)for(var l of os(t))vt.call(t,l)&&lt(s,l,t[l]);return s},$s=(s,t)=>{var l={};for(var n in s)jt.call(s,n)&&t.indexOf(n)<0&&(l[n]=s[n]);if(s!=null&&os)for(var n of os(s))t.indexOf(n)<0&&vt.call(s,n)&&(l[n]=s[n]);return l};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var Ae;(s=>{const t=class b{constructor(r,a,i,c){if(this.version=r,this.errorCorrectionLevel=a,this.modules=[],this.isFunction=[],r<b.MIN_VERSION||r>b.MAX_VERSION)throw new RangeError("Version value out of range");if(c<-1||c>7)throw new RangeError("Mask value out of range");this.size=r*4+17;let m=[];for(let p=0;p<this.size;p++)m.push(!1);for(let p=0;p<this.size;p++)this.modules.push(m.slice()),this.isFunction.push(m.slice());this.drawFunctionPatterns();const f=this.addEccAndInterleave(i);if(this.drawCodewords(f),c==-1){let p=1e9;for(let v=0;v<8;v++){this.applyMask(v),this.drawFormatBits(v);const N=this.getPenaltyScore();N<p&&(c=v,p=N),this.applyMask(v)}}h(0<=c&&c<=7),this.mask=c,this.applyMask(c),this.drawFormatBits(c),this.isFunction=[]}static encodeText(r,a){const i=s.QrSegment.makeSegments(r);return b.encodeSegments(i,a)}static encodeBinary(r,a){const i=s.QrSegment.makeBytes(r);return b.encodeSegments([i],a)}static encodeSegments(r,a,i=1,c=40,m=-1,f=!0){if(!(b.MIN_VERSION<=i&&i<=c&&c<=b.MAX_VERSION)||m<-1||m>7)throw new RangeError("Invalid value");let p,v;for(p=i;;p++){const y=b.getNumDataCodewords(p,a)*8,A=x.getTotalBits(r,p);if(A<=y){v=A;break}if(p>=c)throw new RangeError("Data too long")}for(const y of[b.Ecc.MEDIUM,b.Ecc.QUARTILE,b.Ecc.HIGH])f&&v<=b.getNumDataCodewords(p,y)*8&&(a=y);let N=[];for(const y of r){l(y.mode.modeBits,4,N),l(y.numChars,y.mode.numCharCountBits(p),N);for(const A of y.getData())N.push(A)}h(N.length==v);const D=b.getNumDataCodewords(p,a)*8;h(N.length<=D),l(0,Math.min(4,D-N.length),N),l(0,(8-N.length%8)%8,N),h(N.length%8==0);for(let y=236;N.length<D;y^=253)l(y,8,N);let w=[];for(;w.length*8<N.length;)w.push(0);return N.forEach((y,A)=>w[A>>>3]|=y<<7-(A&7)),new b(p,a,w,m)}getModule(r,a){return 0<=r&&r<this.size&&0<=a&&a<this.size&&this.modules[a][r]}getModules(){return this.modules}drawFunctionPatterns(){for(let i=0;i<this.size;i++)this.setFunctionModule(6,i,i%2==0),this.setFunctionModule(i,6,i%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const r=this.getAlignmentPatternPositions(),a=r.length;for(let i=0;i<a;i++)for(let c=0;c<a;c++)i==0&&c==0||i==0&&c==a-1||i==a-1&&c==0||this.drawAlignmentPattern(r[i],r[c]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(r){const a=this.errorCorrectionLevel.formatBits<<3|r;let i=a;for(let m=0;m<10;m++)i=i<<1^(i>>>9)*1335;const c=(a<<10|i)^21522;h(c>>>15==0);for(let m=0;m<=5;m++)this.setFunctionModule(8,m,n(c,m));this.setFunctionModule(8,7,n(c,6)),this.setFunctionModule(8,8,n(c,7)),this.setFunctionModule(7,8,n(c,8));for(let m=9;m<15;m++)this.setFunctionModule(14-m,8,n(c,m));for(let m=0;m<8;m++)this.setFunctionModule(this.size-1-m,8,n(c,m));for(let m=8;m<15;m++)this.setFunctionModule(8,this.size-15+m,n(c,m));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let r=this.version;for(let i=0;i<12;i++)r=r<<1^(r>>>11)*7973;const a=this.version<<12|r;h(a>>>18==0);for(let i=0;i<18;i++){const c=n(a,i),m=this.size-11+i%3,f=Math.floor(i/3);this.setFunctionModule(m,f,c),this.setFunctionModule(f,m,c)}}drawFinderPattern(r,a){for(let i=-4;i<=4;i++)for(let c=-4;c<=4;c++){const m=Math.max(Math.abs(c),Math.abs(i)),f=r+c,p=a+i;0<=f&&f<this.size&&0<=p&&p<this.size&&this.setFunctionModule(f,p,m!=2&&m!=4)}}drawAlignmentPattern(r,a){for(let i=-2;i<=2;i++)for(let c=-2;c<=2;c++)this.setFunctionModule(r+c,a+i,Math.max(Math.abs(c),Math.abs(i))!=1)}setFunctionModule(r,a,i){this.modules[a][r]=i,this.isFunction[a][r]=!0}addEccAndInterleave(r){const a=this.version,i=this.errorCorrectionLevel;if(r.length!=b.getNumDataCodewords(a,i))throw new RangeError("Invalid argument");const c=b.NUM_ERROR_CORRECTION_BLOCKS[i.ordinal][a],m=b.ECC_CODEWORDS_PER_BLOCK[i.ordinal][a],f=Math.floor(b.getNumRawDataModules(a)/8),p=c-f%c,v=Math.floor(f/c);let N=[];const D=b.reedSolomonComputeDivisor(m);for(let y=0,A=0;y<c;y++){let T=r.slice(A,A+v-m+(y<p?0:1));A+=T.length;const B=b.reedSolomonComputeRemainder(T,D);y<p&&T.push(0),N.push(T.concat(B))}let w=[];for(let y=0;y<N[0].length;y++)N.forEach((A,T)=>{(y!=v-m||T>=p)&&w.push(A[y])});return h(w.length==f),w}drawCodewords(r){if(r.length!=Math.floor(b.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let i=this.size-1;i>=1;i-=2){i==6&&(i=5);for(let c=0;c<this.size;c++)for(let m=0;m<2;m++){const f=i-m,v=(i+1&2)==0?this.size-1-c:c;!this.isFunction[v][f]&&a<r.length*8&&(this.modules[v][f]=n(r[a>>>3],7-(a&7)),a++)}}h(a==r.length*8)}applyMask(r){if(r<0||r>7)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let i=0;i<this.size;i++){let c;switch(r){case 0:c=(i+a)%2==0;break;case 1:c=a%2==0;break;case 2:c=i%3==0;break;case 3:c=(i+a)%3==0;break;case 4:c=(Math.floor(i/3)+Math.floor(a/2))%2==0;break;case 5:c=i*a%2+i*a%3==0;break;case 6:c=(i*a%2+i*a%3)%2==0;break;case 7:c=((i+a)%2+i*a%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[a][i]&&c&&(this.modules[a][i]=!this.modules[a][i])}}getPenaltyScore(){let r=0;for(let m=0;m<this.size;m++){let f=!1,p=0,v=[0,0,0,0,0,0,0];for(let N=0;N<this.size;N++)this.modules[m][N]==f?(p++,p==5?r+=b.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,v),f||(r+=this.finderPenaltyCountPatterns(v)*b.PENALTY_N3),f=this.modules[m][N],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,v)*b.PENALTY_N3}for(let m=0;m<this.size;m++){let f=!1,p=0,v=[0,0,0,0,0,0,0];for(let N=0;N<this.size;N++)this.modules[N][m]==f?(p++,p==5?r+=b.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,v),f||(r+=this.finderPenaltyCountPatterns(v)*b.PENALTY_N3),f=this.modules[N][m],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,v)*b.PENALTY_N3}for(let m=0;m<this.size-1;m++)for(let f=0;f<this.size-1;f++){const p=this.modules[m][f];p==this.modules[m][f+1]&&p==this.modules[m+1][f]&&p==this.modules[m+1][f+1]&&(r+=b.PENALTY_N2)}let a=0;for(const m of this.modules)a=m.reduce((f,p)=>f+(p?1:0),a);const i=this.size*this.size,c=Math.ceil(Math.abs(a*20-i*10)/i)-1;return h(0<=c&&c<=9),r+=c*b.PENALTY_N4,h(0<=r&&r<=2568888),r}getAlignmentPatternPositions(){if(this.version==1)return[];{const r=Math.floor(this.version/7)+2,a=this.version==32?26:Math.ceil((this.version*4+4)/(r*2-2))*2;let i=[6];for(let c=this.size-7;i.length<r;c-=a)i.splice(1,0,c);return i}}static getNumRawDataModules(r){if(r<b.MIN_VERSION||r>b.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*r+128)*r+64;if(r>=2){const i=Math.floor(r/7)+2;a-=(25*i-10)*i-55,r>=7&&(a-=36)}return h(208<=a&&a<=29648),a}static getNumDataCodewords(r,a){return Math.floor(b.getNumRawDataModules(r)/8)-b.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r]*b.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r]}static reedSolomonComputeDivisor(r){if(r<1||r>255)throw new RangeError("Degree out of range");let a=[];for(let c=0;c<r-1;c++)a.push(0);a.push(1);let i=1;for(let c=0;c<r;c++){for(let m=0;m<a.length;m++)a[m]=b.reedSolomonMultiply(a[m],i),m+1<a.length&&(a[m]^=a[m+1]);i=b.reedSolomonMultiply(i,2)}return a}static reedSolomonComputeRemainder(r,a){let i=a.map(c=>0);for(const c of r){const m=c^i.shift();i.push(0),a.forEach((f,p)=>i[p]^=b.reedSolomonMultiply(f,m))}return i}static reedSolomonMultiply(r,a){if(r>>>8||a>>>8)throw new RangeError("Byte out of range");let i=0;for(let c=7;c>=0;c--)i=i<<1^(i>>>7)*285,i^=(a>>>c&1)*r;return h(i>>>8==0),i}finderPenaltyCountPatterns(r){const a=r[1];h(a<=this.size*3);const i=a>0&&r[2]==a&&r[3]==a*3&&r[4]==a&&r[5]==a;return(i&&r[0]>=a*4&&r[6]>=a?1:0)+(i&&r[6]>=a*4&&r[0]>=a?1:0)}finderPenaltyTerminateAndCount(r,a,i){return r&&(this.finderPenaltyAddHistory(a,i),a=0),a+=this.size,this.finderPenaltyAddHistory(a,i),this.finderPenaltyCountPatterns(i)}finderPenaltyAddHistory(r,a){a[0]==0&&(r+=this.size),a.pop(),a.unshift(r)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=t;function l(d,r,a){if(r<0||r>31||d>>>r)throw new RangeError("Value out of range");for(let i=r-1;i>=0;i--)a.push(d>>>i&1)}function n(d,r){return(d>>>r&1)!=0}function h(d){if(!d)throw new Error("Assertion error")}const o=class M{constructor(r,a,i){if(this.mode=r,this.numChars=a,this.bitData=i,a<0)throw new RangeError("Invalid argument");this.bitData=i.slice()}static makeBytes(r){let a=[];for(const i of r)l(i,8,a);return new M(M.Mode.BYTE,r.length,a)}static makeNumeric(r){if(!M.isNumeric(r))throw new RangeError("String contains non-numeric characters");let a=[];for(let i=0;i<r.length;){const c=Math.min(r.length-i,3);l(parseInt(r.substring(i,i+c),10),c*3+1,a),i+=c}return new M(M.Mode.NUMERIC,r.length,a)}static makeAlphanumeric(r){if(!M.isAlphanumeric(r))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],i;for(i=0;i+2<=r.length;i+=2){let c=M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(i))*45;c+=M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(i+1)),l(c,11,a)}return i<r.length&&l(M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(i)),6,a),new M(M.Mode.ALPHANUMERIC,r.length,a)}static makeSegments(r){return r==""?[]:M.isNumeric(r)?[M.makeNumeric(r)]:M.isAlphanumeric(r)?[M.makeAlphanumeric(r)]:[M.makeBytes(M.toUtf8ByteArray(r))]}static makeEci(r){let a=[];if(r<0)throw new RangeError("ECI assignment value out of range");if(r<128)l(r,8,a);else if(r<16384)l(2,2,a),l(r,14,a);else if(r<1e6)l(6,3,a),l(r,21,a);else throw new RangeError("ECI assignment value out of range");return new M(M.Mode.ECI,0,a)}static isNumeric(r){return M.NUMERIC_REGEX.test(r)}static isAlphanumeric(r){return M.ALPHANUMERIC_REGEX.test(r)}getData(){return this.bitData.slice()}static getTotalBits(r,a){let i=0;for(const c of r){const m=c.mode.numCharCountBits(a);if(c.numChars>=1<<m)return 1/0;i+=4+m+c.bitData.length}return i}static toUtf8ByteArray(r){r=encodeURI(r);let a=[];for(let i=0;i<r.length;i++)r.charAt(i)!="%"?a.push(r.charCodeAt(i)):(a.push(parseInt(r.substring(i+1,i+3),16)),i+=2);return a}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=o;s.QrSegment=o})(Ae||(Ae={}));(s=>{(t=>{const l=class{constructor(h,o){this.ordinal=h,this.formatBits=o}};l.LOW=new l(0,1),l.MEDIUM=new l(1,0),l.QUARTILE=new l(2,3),l.HIGH=new l(3,2),t.Ecc=l})(s.QrCode||(s.QrCode={}))})(Ae||(Ae={}));(s=>{(t=>{const l=class{constructor(h,o){this.modeBits=h,this.numBitsCharCount=o}numCharCountBits(h){return this.numBitsCharCount[Math.floor((h+7)/17)]}};l.NUMERIC=new l(1,[10,12,14]),l.ALPHANUMERIC=new l(2,[9,11,13]),l.BYTE=new l(4,[8,16,16]),l.KANJI=new l(8,[8,10,12]),l.ECI=new l(7,[0,0,0]),t.Mode=l})(s.QrSegment||(s.QrSegment={}))})(Ae||(Ae={}));var Me=Ae;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var tr={L:Me.QrCode.Ecc.LOW,M:Me.QrCode.Ecc.MEDIUM,Q:Me.QrCode.Ecc.QUARTILE,H:Me.QrCode.Ecc.HIGH},Nt=128,yt="L",wt="#FFFFFF",Ct="#000000",bt=!1,_t=1,ar=4,rr=0,nr=.1;function St(s,t=0){const l=[];return s.forEach(function(n,h){let o=null;n.forEach(function(x,d){if(!x&&o!==null){l.push(`M${o+t} ${h+t}h${d-o}v1H${o+t}z`),o=null;return}if(d===n.length-1){if(!x)return;o===null?l.push(`M${d+t},${h+t} h1v1H${d+t}z`):l.push(`M${o+t},${h+t} h${d+1-o}v1H${o+t}z`);return}x&&o===null&&(o=d)})}),l.join("")}function Et(s,t){return s.slice().map((l,n)=>n<t.y||n>=t.y+t.h?l:l.map((h,o)=>o<t.x||o>=t.x+t.w?h:!1))}function ir(s,t,l,n){if(n==null)return null;const h=s.length+l*2,o=Math.floor(t*nr),x=h/t,d=(n.width||o)*x,r=(n.height||o)*x,a=n.x==null?s.length/2-d/2:n.x*x,i=n.y==null?s.length/2-r/2:n.y*x,c=n.opacity==null?1:n.opacity;let m=null;if(n.excavate){let p=Math.floor(a),v=Math.floor(i),N=Math.ceil(d+a-p),D=Math.ceil(r+i-v);m={x:p,y:v,w:N,h:D}}const f=n.crossOrigin;return{x:a,y:i,h:r,w:d,excavation:m,opacity:c,crossOrigin:f}}function lr(s,t){return t!=null?Math.max(Math.floor(t),0):s?ar:rr}function At({value:s,level:t,minVersion:l,includeMargin:n,marginSize:h,imageSettings:o,size:x,boostLevel:d}){let r=z.useMemo(()=>{const p=(Array.isArray(s)?s:[s]).reduce((v,N)=>(v.push(...Me.QrSegment.makeSegments(N)),v),[]);return Me.QrCode.encodeSegments(p,tr[t],l,void 0,void 0,d)},[s,t,l,d]);const{cells:a,margin:i,numCells:c,calculatedImageSettings:m}=z.useMemo(()=>{let f=r.getModules();const p=lr(n,h),v=f.length+p*2,N=ir(f,x,p,o);return{cells:f,margin:p,numCells:v,calculatedImageSettings:N}},[r,x,o,n,h]);return{qrcode:r,margin:i,cells:a,numCells:c,calculatedImageSettings:m}}var or=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),cr=z.forwardRef(function(t,l){const n=t,{value:h,size:o=Nt,level:x=yt,bgColor:d=wt,fgColor:r=Ct,includeMargin:a=bt,minVersion:i=_t,boostLevel:c,marginSize:m,imageSettings:f}=n,v=$s(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:N}=v,D=$s(v,["style"]),w=f?.src,y=z.useRef(null),A=z.useRef(null),T=z.useCallback(V=>{y.current=V,typeof l=="function"?l(V):l&&(l.current=V)},[l]),[B,se]=z.useState(!1),{margin:Q,cells:R,numCells:ne,calculatedImageSettings:U}=At({value:h,level:x,minVersion:i,boostLevel:c,includeMargin:a,marginSize:m,imageSettings:f,size:o});z.useEffect(()=>{if(y.current!=null){const V=y.current,X=V.getContext("2d");if(!X)return;let G=R;const ie=A.current,te=U!=null&&ie!==null&&ie.complete&&ie.naturalHeight!==0&&ie.naturalWidth!==0;te&&U.excavation!=null&&(G=Et(R,U.excavation));const j=window.devicePixelRatio||1;V.height=V.width=o*j;const _=o/ne*j;X.scale(_,_),X.fillStyle=d,X.fillRect(0,0,ne,ne),X.fillStyle=r,or?X.fill(new Path2D(St(G,Q))):R.forEach(function(k,K){k.forEach(function(je,ke){je&&X.fillRect(ke+Q,K+Q,1,1)})}),U&&(X.globalAlpha=U.opacity),te&&X.drawImage(ie,U.x+Q,U.y+Q,U.w,U.h)}}),z.useEffect(()=>{se(!1)},[w]);const ge=Ls({height:o,width:o},N);let ye=null;return w!=null&&(ye=z.createElement("img",{src:w,key:w,style:{display:"none"},onLoad:()=>{se(!0)},ref:A,crossOrigin:U?.crossOrigin})),z.createElement(z.Fragment,null,z.createElement("canvas",Ls({style:ge,height:o,width:o,ref:T,role:"img"},D)),ye)});cr.displayName="QRCodeCanvas";var Pt=z.forwardRef(function(t,l){const n=t,{value:h,size:o=Nt,level:x=yt,bgColor:d=wt,fgColor:r=Ct,includeMargin:a=bt,minVersion:i=_t,boostLevel:c,title:m,marginSize:f,imageSettings:p}=n,v=$s(n,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:N,cells:D,numCells:w,calculatedImageSettings:y}=At({value:h,level:x,minVersion:i,boostLevel:c,includeMargin:a,marginSize:f,imageSettings:p,size:o});let A=D,T=null;p!=null&&y!=null&&(y.excavation!=null&&(A=Et(D,y.excavation)),T=z.createElement("image",{href:p.src,height:y.h,width:y.w,x:y.x+N,y:y.y+N,preserveAspectRatio:"none",opacity:y.opacity,crossOrigin:y.crossOrigin}));const B=St(A,N);return z.createElement("svg",Ls({height:o,width:o,viewBox:`0 0 ${w} ${w}`,ref:l,role:"img"},v),!!m&&z.createElement("title",null,m),z.createElement("path",{fill:d,d:`M0,0 h${w}v${w}H0z`,shapeRendering:"crispEdges"}),z.createElement("path",{fill:r,d:B,shapeRendering:"crispEdges"}),T)});Pt.displayName="QRCodeSVG";const dr=({open:s,onOpenChange:t,coupon:l})=>{const{t:n}=Z(),{getLocalizedField:h}=cs(),[o,x]=g.useState(!1),d=l.coupon_codes?.coupon_templates,r=l.coupon_codes?.code,a=!!l.used_at;return e.jsx(be,{open:s,onOpenChange:i=>{t(i),i||x(!1)},children:e.jsxs(_e,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(Se,{children:e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),n("profile.coupons.details")]})}),e.jsx(na,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:h(d,"title")}),e.jsx(P,{variant:a?"secondary":"default",children:n(a?"profile.coupons.used":"profile.coupons.available")})]}),d?.description_zh||d?.description_en||d?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:h(d,"description")}):null]}),e.jsx(Os,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>x(!o),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Pt,{value:r||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ia,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:n("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Ge,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:d?.discount_type==="percentage"?`${d?.discount_value}% OFF`:`â‚¬${d?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Oe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(l.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),a&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:Ne(new Date(l.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d?.valid_until?`${Ne(new Date(d.valid_from),"yyyy-MM-dd")} - ${Ne(new Date(d.valid_until),"yyyy-MM-dd")}`:n("profile.coupons.noExpiry")})]})]}),d?.min_order_amount&&d.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.min_order_amount]})]})]}),d?.max_discount_amount&&d.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ge,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:n("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.max_discount_amount]})]})]}),e.jsx(Os,{}),l.activity_id&&l.source==="share"&&e.jsxs(W,{to:`/activity/${l.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[n("profile.coupons.source"),": ",n("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",n("profile.coupons.viewActivity"),")"]})]})]})})]})})},mr=()=>{const{user:s}=Pe();return Qe({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:l}=await O.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(l)throw l;return t},enabled:!!s?.email})},hr=()=>{const{user:s}=Pe();return Qe({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:l}=await O.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(l)throw l;return t},enabled:!!s?.email})},ot=()=>{const{t:s}=Z(),{data:t,isLoading:l}=mr(),{getLocalizedField:n}=cs(),h=o=>{switch(o){case"confirmed":return e.jsx(P,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(P,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(P,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(P,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(P,{variant:"outline",children:o})}};return e.jsxs(L,{children:[e.jsxs(H,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ws,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(Y,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx($,{className:"px-3",children:l?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?n(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(W,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),h(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ws,{className:"w-3 h-3"}),Ne(new Date(o.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"w-3 h-3"}),o.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Vs,{className:"w-3 h-3"}),o.party_size," ",s("booking.people")]})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},ct=()=>{const{t:s}=Z(),{data:t,isLoading:l}=hr(),{getLocalizedField:n}=cs(),h=o=>{switch(o){case"completed":return e.jsx(P,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(P,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(P,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(P,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(P,{variant:"outline",children:o})}};return e.jsxs(L,{children:[e.jsxs(H,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(la,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(Y,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx($,{className:"px-3",children:l?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?n(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(W,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(fe,{className:"w-4 h-4 inline mr-1"}),x]})}),h(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:Ne(new Date(o.order_date),"yyyy-MM-dd HH:mm")}),o.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",o.total_amount.toFixed(2)]})]}),o.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(Fe,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:o.delivery_address})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},xr=Va({full_name:Ye().min(2,"å§“åè‡³å°‘2ä¸ªå­—ç¬¦"),nif:Ye().min(9,"NIFè‡³å°‘9ä½").max(15,"NIFæœ€å¤š15ä½"),contact:Ye().min(5,"è”ç³»æ–¹å¼è‡³å°‘5ä¸ªå­—ç¬¦"),address:Ye().min(5,"åœ°å€è‡³å°‘5ä¸ªå­—ç¬¦")}),Ps=({open:s,onOpenChange:t,mode:l,existingData:n})=>{const{t:h}=Z(),o=za(),x=Ua(),d=Qa({resolver:qa(xr),defaultValues:{full_name:n?.full_name||"",nif:n?.nif||"",contact:n?.contact||"",address:n?.address||""}});g.useEffect(()=>{s&&n?d.reset({full_name:n.full_name||"",nif:n.nif||"",contact:n.contact||"",address:n.address||""}):s&&!n&&d.reset({full_name:"",nif:"",contact:"",address:""})},[s,n,d]);const r=async i=>{try{const c={full_name:i.full_name,nif:i.nif,contact:i.contact,address:i.address};l==="reapply"&&n?.id?await x.mutateAsync({id:n.id,data:c}):await o.mutateAsync(c),t(!1),d.reset()}catch{}},a=o.isPending||x.isPending;return e.jsx(be,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:"sm:max-w-md",children:[e.jsxs(Se,{children:[e.jsxs(Ee,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),l==="apply"?h("profile.invitationCode.applyTitle","ç”³è¯·é‚€è¯·ç "):h("profile.invitationCode.reapplyTitle","é‡æ–°ç”³è¯·é‚€è¯·ç ")]}),e.jsx(is,{children:h("profile.invitationCode.applyDesc","è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ä»¥ç”³è¯·ä¸“å±žé‚€è¯·ç ")})]}),e.jsx(Ga,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(r),className:"space-y-4",children:[e.jsx(Xe,{control:d.control,name:"full_name",render:({field:i})=>e.jsxs(We,{children:[e.jsx(Ze,{children:h("profile.invitationCode.fullName","å…¨å")}),e.jsx(Je,{children:e.jsx(I,{placeholder:h("profile.invitationCode.fullNamePlaceholder","è¯·è¾“å…¥æ‚¨çš„å…¨å"),...i})}),e.jsx(es,{})]})}),e.jsx(Xe,{control:d.control,name:"nif",render:({field:i})=>e.jsxs(We,{children:[e.jsx(Ze,{children:h("profile.invitationCode.nif","NIF (ç¨ŽåŠ¡è¯†åˆ«å·)")}),e.jsx(Je,{children:e.jsx(I,{placeholder:h("profile.invitationCode.nifPlaceholder","è¯·è¾“å…¥æ‚¨çš„NIF"),...i})}),e.jsx(es,{})]})}),e.jsx(Xe,{control:d.control,name:"contact",render:({field:i})=>e.jsxs(We,{children:[e.jsx(Ze,{children:h("profile.invitationCode.contact","è”ç³»æ–¹å¼")}),e.jsx(Je,{children:e.jsx(I,{placeholder:h("profile.invitationCode.contactPlaceholder","è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆç”µè¯/å¾®ä¿¡ç­‰ï¼‰"),...i})}),e.jsx(es,{})]})}),e.jsx(Xe,{control:d.control,name:"address",render:({field:i})=>e.jsxs(We,{children:[e.jsx(Ze,{children:h("profile.invitationCode.address","åœ°å€")}),e.jsx(Je,{children:e.jsx(oa,{placeholder:h("profile.invitationCode.addressPlaceholder","è¯·è¾“å…¥æ‚¨çš„åœ°å€"),className:"resize-none",rows:3,...i})}),e.jsx(es,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>t(!1),children:h("common.cancel","å–æ¶ˆ")}),e.jsxs(E,{type:"submit",disabled:a,children:[a&&e.jsx(ca,{className:"w-4 h-4 mr-2 animate-spin"}),l==="apply"?h("profile.invitationCode.submit","æäº¤ç”³è¯·"):h("profile.invitationCode.resubmit","é‡æ–°æäº¤")]})]})]})})]})})},Ue=({open:s,onOpenChange:t})=>{const{t:l}=Z();return e.jsx(be,{open:s,onOpenChange:t,children:e.jsxs(_e,{className:"sm:max-w-md",children:[e.jsx(Se,{children:e.jsx(Ee,{className:"flex items-center gap-2",children:l("profile.invitationCode.helpTitle","é‚€è¯·ç ä½¿ç”¨è¯´æ˜Ž")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(da,{className:"h-4 w-4"}),e.jsx("span",{children:l("profile.invitationCode.helpRequirements","ç”³è¯·è¦æ±‚")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:l("profile.invitationCode.helpRequirementsDesc","ç”³è¯·é‚€è¯·ç éœ€æä¾›ï¼šå…¨åã€NIFï¼ˆç¨ŽåŠ¡è¯†åˆ«å·ï¼‰ã€è”ç³»æ–¹å¼ã€åœ°å€")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{children:l("profile.invitationCode.helpUsage","ä½¿ç”¨æ¡ä»¶")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:l("profile.invitationCode.helpUsageDesc",'é‚€è¯·ç åªèƒ½åœ¨"åŠ å…¥æˆ‘ä»¬"ç”³è¯·ä¸­ä½¿ç”¨ï¼Œä¸”ä»…åœ¨å‹¾é€‰"æ‰«ç ç‚¹é¤"åŠŸèƒ½åŽæ‰èƒ½å¡«å†™')})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(ma,{className:"h-4 w-4"}),e.jsx("span",{children:l("profile.invitationCode.helpBenefit","ç¦åˆ©è¯´æ˜Ž")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:l("profile.invitationCode.helpBenefitDesc","æˆåŠŸé‚€è¯·å•†å®¶åŽï¼Œè¢«é‚€è¯·äººå¯èŽ·å¾—ä»·å€¼99æ¬§å…ƒçš„é¢å¤–å…è´¹æœˆã€‚é‚€è¯·åŒæ–¹å¯è‡ªç”±åå•†ç¦åˆ©åˆ†é…æ–¹å¼ã€‚")})]}),e.jsx(Os,{}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:l("profile.invitationCode.copyright","Â© 2026 å°ç†Šå¸‚åœº. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚æœ€ç»ˆè§£é‡Šæƒå½’å°ç†Šå¸‚åœºæ‰€æœ‰ã€‚")})]})]})})},dt=s=>{switch(s){case"zh":return va;case"pt":return ja;default:return ga}},mt=({isMobile:s})=>{const{t,i18n:l}=Z(),{data:n,isLoading:h}=Ba(),{data:o=[]}=Ha(),[x,d]=g.useState(!1),[r,a]=g.useState(!1),[i,c]=g.useState(!1),[m,f]=g.useState(!1),p=async()=>{n?.code&&(await navigator.clipboard.writeText(n.code),c(!0),ua({title:t("profile.invitationCode.copied","å·²å¤åˆ¶"),description:t("profile.invitationCode.copiedDesc","é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}),setTimeout(()=>c(!1),2e3))},v=o.filter(w=>!(n?.status==="approved"&&w.id===n.id||w.id===n?.id)),N=(w,y)=>{switch(w){case"pending":return e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.pending","å®¡æ ¸ä¸­")]});case"approved":return e.jsxs(P,{variant:"outline",className:"text-primary border-primary",children:[e.jsx(Ms,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.approved","å·²é€šè¿‡")]});case"rejected":return e.jsxs(P,{variant:"destructive",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.rejected","å·²æ‹’ç»")]});case"revoked":return e.jsxs(P,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.revoked","å·²æ”¶å›ž")]});default:return null}},D=()=>v.length===0?null:e.jsxs(Ta,{open:m,onOpenChange:f,className:"mt-4",children:[e.jsx(La,{asChild:!0,children:e.jsxs(E,{variant:"ghost",size:"sm",className:"w-full justify-between text-muted-foreground hover:text-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"w-4 h-4"}),t("profile.invitationCode.history","åŽ†å²è®°å½•")," (",v.length,")"]}),e.jsx(fa,{className:`w-4 h-4 transition-transform ${m?"rotate-180":""}`})]})}),e.jsx($a,{className:"mt-2 space-y-2",children:v.map(w=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono font-medium",children:w.code}),N(w.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[t("profile.invitationCode.appliedAt","ç”³è¯·æ—¶é—´"),": ",ls(new Date(w.created_at),{addSuffix:!0,locale:dt(l.language)})]}),w.reviewed_at&&e.jsxs("p",{children:[t("profile.invitationCode.reviewedAt","å®¡æ ¸æ—¶é—´"),": ",ls(new Date(w.reviewed_at),{addSuffix:!0,locale:dt(l.language)})]}),w.rejection_reason&&e.jsxs("p",{className:"text-destructive",children:[t("profile.invitationCode.reason","åŽŸå› "),": ",w.rejection_reason]}),w.status==="approved"&&e.jsxs("p",{children:[t("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",w.usage_count," ",t("profile.invitationCode.people","äºº")]})]})]},w.id))})]});return h?e.jsxs(L,{children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsx(Ss,{className:"h-6 w-32"}),e.jsx(Ss,{className:"h-4 w-48 mt-2"})]}),e.jsx($,{className:s?"px-4 pb-4":"",children:e.jsx(Ss,{className:"h-20 w-full"})})]}):n?n.status==="pending"?e.jsxs(L,{className:"border-yellow-500/30",children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5 text-yellow-500"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(E,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Y,{children:t("profile.invitationCode.pendingDesc","æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.pending","å®¡æ ¸ä¸­")]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t("profile.invitationCode.pendingMessage","ç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å®¡æ ¸é€šè¿‡åŽæ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚")})]}),D()]}),e.jsx(Ue,{open:r,onOpenChange:a})]}):n.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-destructive/30",children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-destructive"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(E,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Y,{children:t("profile.invitationCode.rejectedDesc","æ‚¨çš„ç”³è¯·æœªé€šè¿‡å®¡æ ¸")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-destructive/10 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"destructive",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.rejected","å·²æ‹’ç»")]})}),n.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[t("profile.invitationCode.reason","åŽŸå› "),":"]})," ",n.rejection_reason]})]}),e.jsxs(E,{onClick:()=>d(!0),variant:"outline",className:"w-full",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),D()]})]}),e.jsx(Ps,{open:x,onOpenChange:d,mode:"reapply",existingData:{id:n.id,full_name:n.full_name,nif:n.nif,contact:n.contact||"",address:n.address}}),e.jsx(Ue,{open:r,onOpenChange:a})]}):n.status==="revoked"?e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-orange-500/30",children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-orange-500"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(E,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Y,{children:t("profile.invitationCode.revokedDesc","æ‚¨çš„é‚€è¯·ç å·²è¢«æ”¶å›ž")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(P,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Ie,{className:"w-3 h-3 mr-1"}),t("profile.invitationCode.revoked","å·²æ”¶å›ž")]})}),n.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[t("profile.invitationCode.reason","åŽŸå› "),":"]})," ",n.rejection_reason]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:t("profile.invitationCode.revokedMessage","æ‚¨çš„é‚€è¯·ç å·²è¢«ç®¡ç†å‘˜æ”¶å›žï¼Œå¦‚éœ€ç»§ç»­ä½¿ç”¨è¯·é‡æ–°ç”³è¯·ã€‚")})]}),e.jsxs(E,{onClick:()=>d(!0),variant:"outline",className:"w-full",children:[e.jsx(Zs,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),D()]})]}),e.jsx(Ps,{open:x,onOpenChange:d,mode:"reapply",existingData:{id:n.id,full_name:n.full_name,nif:n.nif,contact:n.contact||"",address:n.address}}),e.jsx(Ue,{open:r,onOpenChange:a})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"border-primary/30",children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5 text-primary"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(E,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Y,{children:t("profile.invitationCode.approvedDesc","åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™æ–°å•†å®¶")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:t("profile.invitationCode.yourCode","æ‚¨çš„é‚€è¯·ç ")}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary tracking-wider",children:n.code})]}),e.jsx(E,{variant:"outline",size:"icon",onClick:p,className:"flex-shrink-0",children:i?e.jsx(ha,{className:"w-4 h-4 text-primary"}):e.jsx(xa,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Vs,{className:"w-4 h-4"}),e.jsxs("span",{children:[t("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",n.usage_count," ",t("profile.invitationCode.people","äºº")]})]}),D()]})]}),e.jsx(Ue,{open:r,onOpenChange:a})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{children:[e.jsxs(H,{className:s?"p-4":"",children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Fs,{className:"w-5 h-5 text-primary"}),t("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(E,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>a(!0),children:e.jsx($e,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Y,{children:t("profile.invitationCode.noCodeDesc","ç”³è¯·ä¸“å±žé‚€è¯·ç ï¼Œé‚€è¯·æ–°å•†å®¶åŠ å…¥å¹³å°")})]}),e.jsxs($,{className:s?"px-4 pb-4":"",children:[e.jsxs(E,{onClick:()=>d(!0),className:"w-full",children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),t("profile.invitationCode.apply","ç”³è¯·é‚€è¯·ç ")]}),D()]})]}),e.jsx(Ps,{open:x,onOpenChange:d,mode:"apply"}),e.jsx(Ue,{open:r,onOpenChange:a})]})},zs=g.memo(({comment:s,getLocalizedField:t,t:l})=>{const n=s.moderation_status==="flagged",h=s.moderation_status==="pending",o=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const x={spam:l("riskReason.spam","åžƒåœ¾ä¿¡æ¯"),offensive:l("riskReason.offensive","ä¸å½“è¨€è®º"),harassment:l("riskReason.harassment","éªšæ‰°æ”»å‡»"),fake_review:l("riskReason.fakeReview","è™šå‡è¯„è®º"),flooding:l("riskReason.flooding","åˆ·å±"),irrelevant:l("riskReason.irrelevant","æ— å…³å†…å®¹"),sensitive_word_detected:l("riskReason.sensitiveWord","æ•æ„Ÿè¯"),parse_error:l("riskReason.parseError","è§£æžé”™è¯¯")};return s.risk_reasons.map(d=>x[d]||d).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(W,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:ls(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),h&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(P,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(Oe,{className:"w-3 h-3 mr-1"}),l("restaurant.commentPending","å®¡æ ¸ä¸­")]})}),n&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(P,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(Na,{className:"w-3 h-3 mr-1"}),l("restaurant.commentFailed","å‘é€å¤±è´¥")]}),o()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[l("restaurant.failReason","å¤±è´¥åŽŸå› "),": ",o()]})]})]})});zs.displayName="CommentItem";const Us=g.memo(({restaurant:s,getLocalizedField:t,t:l})=>{if(!s||!s.id)return null;const n=t(s,"name")||s.name||"",h=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(W,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(n),className:"w-full h-full object-cover",loading:"lazy",onError:o=>{o.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:n}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:h}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[l("restaurant.noRatingLine1"),e.jsx("br",{}),l("restaurant.noRatingLine2")]})]})]})]})});Us.displayName="FavoriteRestaurantItem";const Bs=g.memo(({subscription:s,getLocalizedField:t,t:l,isMobile:n})=>{const[h,o]=g.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${n?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(t(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[l("profile.joinedOn"),":"," ",ls(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Be,{className:`text-primary fill-primary flex-shrink-0 ${n?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(Ka,{open:h,onOpenChange:o,activity:{title:String(t(s.activity,"title")),image_url:s.activity?.image_url,content:String(t(s.activity,"content"))}})]})});Bs.displayName="ActivitySubscriptionItem";const Hs=g.memo(({activityGroup:s,getLocalizedField:t,t:l,isMobile:n})=>{const h=s.activity,o=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${n?"p-3":"p-4"}`,children:[e.jsx(W,{to:`/activity/${h.id}`,className:n?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${n?"gap-3":"gap-4"}`,children:[h.image_url&&e.jsx("img",{src:h.image_url,alt:String(t(h,"title")),className:`rounded-lg object-cover flex-shrink-0 ${n?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":""}`,children:t(h,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${n?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(h,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"w-3 h-3"}),new Date(h.start_date).toLocaleDateString()]}),h.end_date&&e.jsxs("span",{children:["- ",new Date(h.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${n?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${n?"mb-1.5":"mb-2"}`,children:[e.jsx(fe,{className:`text-primary ${n?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${n?"text-xs":"text-sm"}`,children:[l("profile.participatingRestaurants")," (",o.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${n?"gap-1.5":"gap-2"}`,children:o.map(x=>e.jsx(P,{variant:"secondary",className:n?"text-xs px-2 py-0.5":"text-xs",children:t(x,"name")},x.id))})]})]})});Hs.displayName="MerchantActivityItem";const Qs=g.memo(({coupon:s,getLocalizedField:t,t:l,isMobile:n})=>{const[h,o]=g.useState(!1),x=s.coupon_codes?.coupon_templates,d=s.coupon_codes?.code,r=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${r?"bg-muted/30":"hover:shadow-medium"} ${n?"p-3":"p-4"}`,onClick:()=>o(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${n?"text-sm":"text-base"}`,children:t(x,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${n?"text-xs":"text-sm"}`,children:t(x,"description")})]}),e.jsx(P,{variant:r?"secondary":"default",className:n?"text-xs":"",children:l(r?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${n?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:d}),e.jsx("span",{className:"text-muted-foreground",children:x?.discount_type==="percentage"?`${x?.discount_value}%`:`â‚¬${x?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${n?"text-xs":"text-sm"}`,children:r?e.jsxs("span",{children:[l("profile.coupons.usedOn"),": ",Ne(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):x?.valid_until?e.jsxs("span",{children:[l("profile.coupons.validUntil"),": ",Ne(new Date(x.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:l("profile.coupons.noExpiry")})})]}),e.jsx(dr,{open:h,onOpenChange:o,coupon:s})]})});Qs.displayName="UserCouponItem";const Qr=()=>{const{t:s}=Z(),{user:t}=Pe(),l=ya();wa();const{data:n,isLoading:h}=ft(),{data:o,isLoading:x}=Ya(),{data:d,isLoading:r}=Xa(),{data:a,isLoading:i}=Ea(),{data:c,isLoading:m}=Wa(),{data:f,isLoading:p}=Pa(),{role:v,isMerchant:N,isSupervisor:D}=ht(),{getLocalizedField:w}=cs(),y=N||D,[A,T]=g.useState("profile"),[B,se]=g.useState(),[Q,R]=g.useState({}),[ne,U]=g.useState(new Set(["profile"])),ge=y?[{value:"profile",label:s("profile.profile"),icon:Js},{value:"favorites",label:s("profile.favorites"),icon:Be},{value:"comments",label:s("profile.comments"),icon:ze},{value:"activities",label:s("profile.participatedActivities"),icon:pe}]:[{value:"profile",label:s("profile.profile"),icon:Js},{value:"favorites",label:s("profile.favorites"),icon:Be},{value:"comments",label:s("profile.comments"),icon:ze}],ye=j=>{R(_=>({..._,[j]:window.scrollY}))},V=j=>{if(ne.has(j)){const _=Q[j]||0;setTimeout(()=>window.scrollTo(0,_),0)}else setTimeout(()=>window.scrollTo(0,0),0),U(_=>new Set([..._,j]))};g.useEffect(()=>{if(!B)return;const j=()=>{const _=B.selectedScrollSnap(),k=ge[_].value;k!==A&&(ye(A),V(k),T(k))};return B.on("select",j),()=>{B.off("select",j)}},[B,A,Q,ne]);const X=j=>{if(j===A)return;ye(A);const _=ge.findIndex(k=>k.value===j);_!==-1&&B&&B.scrollTo(_),V(j),T(j)},G=ba(),ie=g.useCallback(async()=>{await Promise.all([G.invalidateQueries({queryKey:["profile"]}),G.invalidateQueries({queryKey:["favorites"]}),G.invalidateQueries({queryKey:["user-comments"]}),G.invalidateQueries({queryKey:["subscriptions"]}),G.invalidateQueries({queryKey:["user-coupons"]})])},[G]);if(!t||h)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const te=s(v?`profile.role.${v}`:"profile.role.user");return e.jsx(Oa,{onRefresh:ie,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${l?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${l?"px-3":""}`,children:[!l&&e.jsx(e.Fragment,{children:e.jsx(L,{className:"mb-6 md:mb-8",children:e.jsx($,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(ks,{className:"w-24 h-24",children:[e.jsx(Ds,{src:n?.avatar_url||""}),e.jsx(Rs,{className:"text-3xl",children:n?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:n?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),n?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:n.phone}),v&&v!=="user"&&e.jsx(P,{className:"bg-primary capitalize",children:te}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(et,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:n?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points","ç§¯åˆ†")}),e.jsx(st,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[n&&e.jsx(rt,{profile:n}),y&&n&&e.jsx(tt,{isAgreed:n?.activity_terms_agreed||!1,agreedAt:n?.activity_terms_agreed_at||null})]})]})})})}),l?e.jsxs(e.Fragment,{children:[e.jsx(_a,{setApi:se,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Sa,{className:"-ml-0",children:[e.jsx(Ke,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(L,{children:e.jsx($,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ks,{className:"w-20 h-20",children:[e.jsx(Ds,{src:n?.avatar_url||""}),e.jsx(Rs,{className:"text-2xl",children:n?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:n?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(et,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:n?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points","ç§¯åˆ†")}),e.jsx(st,{})]}),n?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:n.phone}),v&&v!=="user"&&e.jsx(P,{className:"bg-primary capitalize text-xs mb-4",children:te}),n&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(rt,{profile:n}),y&&e.jsx(tt,{isAgreed:n?.activity_terms_agreed||!1,agreedAt:n?.activity_terms_agreed_at||null})]})]})]})})}),e.jsx(mt,{isMobile:!0}),e.jsxs(L,{children:[e.jsxs(H,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(Y,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx($,{className:"px-3",children:p?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):f&&f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(j=>e.jsx(Qs,{coupon:j,getLocalizedField:w,t:s,isMobile:!0},j.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(it,{}),e.jsx(ot,{}),e.jsx(ct,{})]})}),e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(L,{children:e.jsx($,{className:"pt-4",children:e.jsxs(Es,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(As,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(J,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(J,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(ee,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(j=>e.jsx(Us,{restaurant:j,getLocalizedField:w,t:s},j.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(ee,{value:"activities",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(j=>e.jsx(Bs,{subscription:j,getLocalizedField:w,t:s,isMobile:!0},j.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(L,{children:[e.jsxs(H,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(Y,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx($,{className:"space-y-3 px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):d&&d.length>0?d.map(j=>e.jsx(zs,{comment:j,getLocalizedField:w,t:s},j.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),y&&e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(L,{children:[e.jsxs(H,{className:"pb-3",children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(Y,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx($,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const j=c.reduce((_,k)=>{const K=k.activity_id;return _[K]||(_[K]={activity:k.activity,restaurants:[],participationDate:k.created_at}),_[K].restaurants.push({id:k.restaurant_id,name:k.restaurant_name,name_en:k.restaurant_name_en,name_pt:k.restaurant_name_pt}),_},{});return Object.values(j).map(_=>e.jsx(Hs,{activityGroup:_,getLocalizedField:w,t:s,isMobile:!0},_.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:"fixed left-0 right-0 bottom-0 bg-background border-t z-40",children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:ge.map(j=>{const _=j.icon;return e.jsxs("button",{onClick:()=>X(j.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${A===j.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(_,{className:`${A===j.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:j.label})]},j.value)})})})]}):e.jsxs(Es,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(As,{className:`grid w-full ${y?"grid-cols-7":"grid-cols-6"} bg-card border rounded-lg shadow-sm h-auto p-1`,children:[e.jsxs(J,{value:"favorites",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(J,{value:"coupons",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(J,{value:"comments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),y&&e.jsxs(J,{value:"activities",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(J,{value:"invitation-code",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Fs,{className:"w-4 h-4 mr-2"}),s("profile.invitationCode.title","é‚€è¯·ç ")]}),e.jsxs(J,{value:"addresses",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(J,{value:"orders",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(ee,{value:"favorites",children:e.jsx(L,{children:e.jsx($,{className:"pt-6",children:e.jsxs(Es,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(As,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(J,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(J,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(P,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(ee,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(j=>e.jsx(Us,{restaurant:j,getLocalizedField:w,t:s},j.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(ee,{value:"activities",children:i?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-4",children:a.map(j=>e.jsx(Bs,{subscription:j,getLocalizedField:w,t:s,isMobile:l},j.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(ee,{value:"comments",children:e.jsxs(L,{children:[e.jsxs(H,{className:l?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(ze,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(Y,{className:l?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx($,{className:`space-y-3 md:space-y-4 ${l?"px-3":""}`,children:r?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):d&&d.length>0?d.map(j=>e.jsx(zs,{comment:j,getLocalizedField:w,t:s},j.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:s("profile.noComments")})})]})}),y&&e.jsx(ee,{value:"activities",children:e.jsxs(L,{children:[e.jsxs(H,{className:l?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(pe,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(Y,{className:l?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx($,{className:l?"px-3":"",children:e.jsx("div",{className:l?"space-y-4":"space-y-6",children:m?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${l?"text-base":"text-lg"}`,children:[e.jsx(fe,{className:l?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:l?"space-y-3":"space-y-4",children:(()=>{const j=c.reduce((_,k)=>{const K=k.activity_id;return _[K]||(_[K]={activity:k.activity,restaurants:[],participationDate:k.created_at}),_[K].restaurants.push({id:k.restaurant_id,name:k.restaurant_name,name_en:k.restaurant_name_en,name_pt:k.restaurant_name_pt}),_},{});return Object.values(j).map(_=>e.jsx(Hs,{activityGroup:_,getLocalizedField:w,t:s,isMobile:l},_.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(ee,{value:"invitation-code",children:e.jsx(mt,{})}),e.jsx(ee,{value:"coupons",children:e.jsxs(L,{children:[e.jsxs(H,{className:l?"pb-3":"",children:[e.jsxs(q,{className:`flex items-center gap-2 ${l?"text-lg":""}`,children:[e.jsx(He,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(Y,{className:l?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx($,{className:l?"px-3":"",children:p?e.jsx("div",{className:`text-center py-8 ${l?"text-sm":""}`,children:s("common.loading")}):f&&f.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${l?"grid-cols-1":"md:grid-cols-2"}`,children:f.map(j=>e.jsx(Qs,{coupon:j,getLocalizedField:w,t:s,isMobile:l},j.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${l?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(W,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(ee,{value:"addresses",children:e.jsx(it,{})}),e.jsx(ee,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(ot,{}),e.jsx(ct,{})]})})]})]})})})};export{Qr as default};
//# sourceMappingURL=Profile-GmkLHQWQ.js.map
