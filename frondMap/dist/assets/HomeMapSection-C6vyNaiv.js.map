{"version":3,"file":"HomeMapSection-C6vyNaiv.js","sources":["../../src/components/HomeMapSection.tsx"],"sourcesContent":["import { formatTrademarkSymbols } from \"@/lib/textFormatting\";\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card } from \"@/components/ui/card\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\r\nimport { Navigation, Maximize, Minimize, MapPin, Star, MoreHorizontal, Filter, ChevronUp, ChevronDown } from \"lucide-react\";\r\nimport { useRestaurants, useRestaurantTypes } from \"@/hooks/useRestaurants\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { calculateDistance, getUserLocation } from \"@/lib/geolocation\";\r\nimport RestaurantMap from \"@/components/RestaurantMap\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport { useActivities } from \"@/hooks/useActivities\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useActivityRestaurantCounts } from \"@/hooks/useActivityRestaurantCounts\";\r\nimport logoIcon from \"@/assets/xiaoxiong-logo-clean.png\";\r\nimport LocationPermissionDialog from \"@/components/LocationPermissionDialog\";\r\n\r\nconst MapRestaurantTags = ({ restaurant, language }: { \r\n  restaurant: any; \r\n  language: string;\r\n}) => {\r\n  const [visibleCount, setVisibleCount] = useState(999);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  \r\n  const allTags = restaurant.type.slice(0, 3).map((type: string, idx: number) => ({ \r\n    key: `type-${idx}`, \r\n    label: type, \r\n    variant: \"secondary\" as const,\r\n    color: undefined \r\n  }));\r\n  \r\n  useEffect(() => {\r\n    const checkOverflow = () => {\r\n      if (!containerRef.current) return;\r\n      \r\n      const container = containerRef.current;\r\n      const badges = Array.from(container.querySelectorAll('.tag-badge')) as HTMLElement[];\r\n      \r\n      if (badges.length === 0) {\r\n        setTimeout(checkOverflow, 50);\r\n        return;\r\n      }\r\n      \r\n      const firstBadgeTop = badges[0]?.offsetTop;\r\n      let lastVisibleIndex = badges.length;\r\n      \r\n      for (let i = 0; i < badges.length; i++) {\r\n        if (badges[i].offsetTop > firstBadgeTop) {\r\n          lastVisibleIndex = i;\r\n          break;\r\n        }\r\n      }\r\n      \r\n      if (lastVisibleIndex < badges.length) {\r\n        lastVisibleIndex = Math.max(1, lastVisibleIndex - 1);\r\n      }\r\n      \r\n      setVisibleCount(lastVisibleIndex);\r\n    };\r\n    \r\n    setVisibleCount(999);\r\n    const timer = setTimeout(checkOverflow, 100);\r\n    \r\n    window.addEventListener('resize', checkOverflow);\r\n    return () => {\r\n      clearTimeout(timer);\r\n      window.removeEventListener('resize', checkOverflow);\r\n    };\r\n  }, [allTags.length, restaurant.id]);\r\n  \r\n  const visibleTags = allTags.slice(0, visibleCount);\r\n  const hasMore = allTags.length > visibleCount;\r\n  \r\n  return (\r\n    <div className=\"flex items-center gap-2\">\r\n      <div ref={containerRef} className=\"flex gap-1.5 flex-wrap flex-1\">\r\n        {visibleTags.map((tag) => (\r\n          <Badge \r\n            key={tag.key} \r\n            variant={tag.variant}\r\n            className=\"text-xs font-medium whitespace-nowrap tag-badge\"\r\n            style={tag.color ? { backgroundColor: tag.color, color: 'white' } : undefined}\r\n          >\r\n            {tag.label}\r\n          </Badge>\r\n        ))}\r\n      </div>\r\n      {hasMore && (\r\n        <Popover>\r\n          <PopoverTrigger asChild>\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0\">\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </PopoverTrigger>\r\n          <PopoverContent className=\"w-80\">\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              {allTags.map((tag) => (\r\n                <Badge \r\n                  key={tag.key} \r\n                  variant={tag.variant}\r\n                  className=\"text-xs font-medium\"\r\n                  style={tag.color ? { backgroundColor: tag.color, color: 'white' } : undefined}\r\n                >\r\n                  {tag.label}\r\n                </Badge>\r\n              ))}\r\n            </div>\r\n          </PopoverContent>\r\n        </Popover>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst HomeMapSection = () => {\r\n  const navigate = useNavigate();\r\n  const { t, i18n } = useTranslation();\r\n  const { toast } = useToast();\r\n  const { localizeRestaurant } = useLocalizedContent();\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedTypes, setSelectedTypes] = useState<string[]>([]);\r\n  const [selectedActivity, setSelectedActivity] = useState<string | null>(null);\r\n  const [activityRestaurantIds, setActivityRestaurantIds] = useState<string[]>([]);\r\n  const [radiusFilter, setRadiusFilter] = useState<number | null>(null);\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null);\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n  const [showAllTypes, setShowAllTypes] = useState(false);\r\n  const [showAllActivities, setShowAllActivities] = useState(false);\r\n  const mapRef = useRef<mapboxgl.Map | null>(null);\r\n  const savedMapState = useRef<{ center: [number, number]; zoom: number } | null>(null);\r\n  const restaurantRefs = useRef<{ [key: string]: HTMLDivElement | null }>({});\r\n  const [selectedRestaurantId, setSelectedRestaurantId] = useState<string | null>(null);\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [showLocationDialog, setShowLocationDialog] = useState(false);\r\n  const [isMapCollapsed, setIsMapCollapsed] = useState(false);\r\n  const [isMobileListExpanded, setIsMobileListExpanded] = useState(false);\r\n\r\n  const MOBILE_DEFAULT_VISIBLE = 4;\r\n\r\n  const { data: restaurants, isLoading } = useRestaurants(searchQuery, selectedTypes.length > 0 ? selectedTypes.join(',') : undefined);\r\n  const { data: restaurantTypes = [] } = useRestaurantTypes();\r\n  const { data: activities = [] } = useActivities();\r\n  const { data: activityRestaurantCounts = {} } = useActivityRestaurantCounts();\r\n\r\n  const activitiesWithRestaurants = activities.filter(activity => (activityRestaurantCounts[activity.id] || 0) > 0);\r\n\r\n  const handleTypeFilter = (type: string) => {\r\n    setSelectedTypes(prev => {\r\n      if (prev.includes(type)) {\r\n        return prev.filter(t => t !== type);\r\n      } else {\r\n        return [...prev, type];\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleRequestLocation = () => {\r\n    setShowLocationDialog(true);\r\n  };\r\n\r\n  const requestLocation = async () => {\r\n    setShowLocationDialog(false);\r\n    try {\r\n      const position = await getUserLocation();\r\n      setUserLocation({\r\n        lat: position.coords.latitude,\r\n        lng: position.coords.longitude,\r\n      });\r\n      toast({\r\n        title: t(\"restaurants.locationEnabled\"),\r\n        description: t(\"restaurants.sortByDistance\"),\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Location error:\", error);\r\n    }\r\n  };\r\n\r\n  const handleRadiusChange = (radius: number | null) => {\r\n    setRadiusFilter(radius);\r\n    if (radius && !userLocation) {\r\n      handleRequestLocation();\r\n    }\r\n  };\r\n\r\n  const handleActivityFilter = async (activityId: string) => {\r\n    if (selectedActivity === activityId) {\r\n      setSelectedActivity(null);\r\n      setActivityRestaurantIds([]);\r\n    } else {\r\n      setSelectedActivity(activityId);\r\n      const { data, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"activity_id\", activityId);\r\n      \r\n      if (error) {\r\n        console.error(\"Error fetching activity restaurants:\", error);\r\n        setActivityRestaurantIds([]);\r\n      } else {\r\n        setActivityRestaurantIds(data.map(ar => ar.restaurant_id));\r\n      }\r\n    }\r\n  };\r\n\r\n  const processedRestaurants = restaurants?.map(restaurant => {\r\n    const localized = localizeRestaurant(restaurant);\r\n    if (userLocation) {\r\n      const distance = calculateDistance(\r\n        userLocation.lat,\r\n        userLocation.lng,\r\n        restaurant.lat,\r\n        restaurant.lng\r\n      );\r\n      return { ...localized, distance };\r\n    }\r\n    return localized;\r\n  }) || [];\r\n\r\n  const activityFilteredRestaurants = selectedActivity \r\n    ? processedRestaurants.filter(r => activityRestaurantIds.includes(r.id)) \r\n    : processedRestaurants;\r\n\r\n  const filteredRestaurants = radiusFilter && userLocation\r\n    ? activityFilteredRestaurants\r\n        .filter(r => r.distance && r.distance <= radiusFilter)\r\n        .sort((a, b) => (a.distance || 0) - (b.distance || 0))\r\n    : userLocation \r\n      ? activityFilteredRestaurants.sort((a, b) => (a.distance || 0) - (b.distance || 0))\r\n      : activityFilteredRestaurants.sort((a, b) => (b.rating || 0) - (a.rating || 0));\r\n\r\n  const handleRestaurantClick = (restaurant: any) => {\r\n    navigate(`/restaurant/${restaurant.id}`);\r\n  };\r\n\r\n  const handleMarkerClick = (restaurant: any) => {\r\n    setSelectedRestaurantId(restaurant.id);\r\n    \r\n    const restaurantElement = restaurantRefs.current[restaurant.id];\r\n    if (restaurantElement) {\r\n      restaurantElement.scrollIntoView({ \r\n        behavior: 'smooth', \r\n        block: 'center'\r\n      });\r\n    }\r\n  };\r\n\r\n  const toggleFullscreen = () => {\r\n    const mapContainer = document.getElementById('home-map-container');\r\n    if (!mapContainer) return;\r\n\r\n    if (!isFullscreen) {\r\n      if (mapRef.current) {\r\n        const center = mapRef.current.getCenter();\r\n        const zoom = mapRef.current.getZoom();\r\n        savedMapState.current = { center: [center.lng, center.lat], zoom };\r\n      }\r\n      if (mapContainer.requestFullscreen) {\r\n        mapContainer.requestFullscreen();\r\n      }\r\n    } else {\r\n      if (document.exitFullscreen) {\r\n        document.exitFullscreen();\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleFullscreenChange = () => {\r\n      const isNowFullscreen = !!document.fullscreenElement;\r\n      setIsFullscreen(isNowFullscreen);\r\n      \r\n      if (!isNowFullscreen && savedMapState.current && mapRef.current) {\r\n        setTimeout(() => {\r\n          mapRef.current?.jumpTo({\r\n            center: savedMapState.current!.center,\r\n            zoom: savedMapState.current!.zoom,\r\n          });\r\n        }, 100);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handleFullscreenChange);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"animate-fade-in\">\r\n      {/* Header - Left aligned */}\r\n      <div className=\"text-left mb-6\">\r\n        <h2 className=\"text-xl sm:text-2xl font-bold text-foreground mb-2 sm:mb-3\">\r\n          {t(\"nav.mapView\")}\r\n        </h2>\r\n        <p className=\"text-sm sm:text-base text-muted-foreground\">{t(\"map.subtitle\")}</p>\r\n      </div>\r\n        \r\n      {/* Search and Filters - Left aligned */}\r\n      <div className=\"mb-6 space-y-4\">\r\n        <div className=\"flex flex-col md:flex-row gap-3\">\r\n          <div className=\"flex-1 max-w-md\">\r\n            <Input\r\n              placeholder={t(\"restaurants.search\")}\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              className=\"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary\"\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"flex gap-2 md:contents\">\r\n            <Button\r\n              variant={userLocation ? \"default\" : \"outline\"}\r\n              onClick={userLocation ? undefined : handleRequestLocation}\r\n              className=\"flex-1 md:flex-initial gap-2 h-11 md:px-6\"\r\n            >\r\n              <Navigation className={`w-4 h-4 ${userLocation ? 'animate-pulse' : ''}`} />\r\n              <span className=\"md:hidden\">{t(\"restaurants.getLocationMobile\")}</span>\r\n              <span className=\"hidden md:inline\">{userLocation ? t(\"restaurants.locationEnabled\") : t(\"restaurants.getLocation\")}</span>\r\n            </Button>\r\n\r\n            <Button\r\n              variant={showFilters ? \"default\" : \"outline\"}\r\n              onClick={() => setShowFilters(!showFilters)}\r\n              className=\"flex-1 md:flex-initial gap-2 h-11 md:px-6\"\r\n            >\r\n              <Filter className=\"w-4 h-4\" />\r\n              {t(\"restaurants.filter\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filters Container */}\r\n        {showFilters && (\r\n          <div className=\"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in\">\r\n            {/* Type Filters Section */}\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex items-center gap-2 flex-wrap\">\r\n                <span className=\"text-sm font-semibold text-foreground\">{t(\"restaurants.restaurantTypes\")}:</span>\r\n                {selectedTypes.length > 0 && (\r\n                  <Badge\r\n                    variant=\"outline\"\r\n                    className=\"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5\"\r\n                    onClick={() => setSelectedTypes([])}>\r\n                    {t(\"common.actions.clearFilter\")}\r\n                  </Badge>\r\n                )}\r\n                {restaurantTypes.length > 8 && (\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    className=\"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200\"\r\n                    onClick={() => setShowAllTypes(!showAllTypes)}\r\n                  >\r\n                    {showAllTypes ? t(\"common.showLess\") : t(\"common.showMore\")}\r\n                  </Button>\r\n                )}\r\n              </div>\r\n              <div className=\"relative overflow-hidden\">\r\n                <div className={`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${showAllTypes ? 'animate-expand-height' : ''}`}>\r\n                  {(showAllTypes ? restaurantTypes : restaurantTypes.slice(0, 8)).map((type, index) => (\r\n                    <Badge\r\n                      key={type}\r\n                      variant={selectedTypes.includes(type) ? \"default\" : \"secondary\"}\r\n                      className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${selectedTypes.includes(type) ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                      style={{ animationDelay: `${index * 30}ms` }}\r\n                      onClick={() => handleTypeFilter(type)}\r\n                    >\r\n                      {type}\r\n                    </Badge>\r\n                  ))}\r\n                </div>\r\n                <div className=\"sm:hidden relative -mx-1 px-1\">\r\n                  <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth\">\r\n                    {restaurantTypes.map((type, index) => (\r\n                      <Badge\r\n                        key={type}\r\n                        variant={selectedTypes.includes(type) ? \"default\" : \"secondary\"}\r\n                        className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${selectedTypes.includes(type) ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                        style={{ animationDelay: `${index * 30}ms` }}\r\n                        onClick={() => handleTypeFilter(type)}\r\n                      >\r\n                        {type}\r\n                      </Badge>\r\n                    ))}\r\n                  </div>\r\n                  <div className=\"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none\" />\r\n                  <div className=\"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Activity Filters Section */}\r\n            {activitiesWithRestaurants.length > 0 && (\r\n              <div className=\"space-y-2 pt-1 border-t border-border/30\">\r\n                <div className=\"flex items-center gap-2 flex-wrap\">\r\n                  <span className=\"text-sm font-semibold text-foreground\">{t(\"nav.activities\")}:</span>\r\n                  {selectedActivity && (\r\n                    <Badge\r\n                      variant=\"outline\"\r\n                      className=\"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5\"\r\n                      onClick={() => {\r\n                        setSelectedActivity(null);\r\n                        setActivityRestaurantIds([]);\r\n                      }}>\r\n                      {t(\"common.actions.clearFilter\")}\r\n                    </Badge>\r\n                  )}\r\n                  {activitiesWithRestaurants.length > 8 && (\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200\"\r\n                      onClick={() => setShowAllActivities(!showAllActivities)}\r\n                    >\r\n                      {showAllActivities ? t(\"common.showLess\") : t(\"common.showMore\")}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                <div className=\"relative overflow-hidden\">\r\n                  <div className={`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${showAllActivities ? 'animate-expand-height' : ''}`}>\r\n                    {(showAllActivities ? activitiesWithRestaurants : activitiesWithRestaurants.slice(0, 8)).map((activity, index) => {\r\n                      const activityLabel = i18n.language === 'zh' \r\n                        ? (activity.badge_text_zh || activity.title_zh)\r\n                        : i18n.language === 'pt' \r\n                        ? (activity.badge_text_pt || activity.title_pt)\r\n                        : (activity.badge_text_en || activity.title_en);\r\n                      return (\r\n                        <Badge\r\n                          key={activity.id}\r\n                          variant={selectedActivity === activity.id ? \"default\" : \"secondary\"}\r\n                          className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${selectedActivity === activity.id ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                          style={{ animationDelay: `${index * 30}ms` }}\r\n                          onClick={() => handleActivityFilter(activity.id)}\r\n                        >\r\n                          {activityLabel}\r\n                        </Badge>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                  <div className=\"sm:hidden relative -mx-1 px-1\">\r\n                    <div className=\"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth\">\r\n                      {activitiesWithRestaurants.map((activity, index) => {\r\n                        const activityLabel = i18n.language === 'zh' \r\n                          ? (activity.badge_text_zh || activity.title_zh)\r\n                          : i18n.language === 'pt' \r\n                          ? (activity.badge_text_pt || activity.title_pt)\r\n                          : (activity.badge_text_en || activity.title_en);\r\n                        return (\r\n                          <Badge\r\n                            key={activity.id}\r\n                            variant={selectedActivity === activity.id ? \"default\" : \"secondary\"}\r\n                            className={`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${selectedActivity === activity.id ? 'ring-2 ring-primary/30 shadow-sm' : ''}`}\r\n                            style={{ animationDelay: `${index * 30}ms` }}\r\n                            onClick={() => handleActivityFilter(activity.id)}\r\n                          >\r\n                            {activityLabel}\r\n                          </Badge>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                    <div className=\"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none\" />\r\n                    <div className=\"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none\" />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Radius Filter */}\r\n        {userLocation && (\r\n          <div className=\"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10\">\r\n            <span className=\"text-sm font-semibold text-primary\">{t(\"restaurants.radius\")}:</span>\r\n            <Badge\r\n              variant={radiusFilter === null ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(null)}\r\n            >\r\n              {t(\"restaurants.allRestaurants\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 5 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(5)}\r\n            >\r\n              {t(\"restaurants.radius5km\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 10 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(10)}\r\n            >\r\n              {t(\"restaurants.radius10km\")}\r\n            </Badge>\r\n            <Badge\r\n              variant={radiusFilter === 20 ? \"default\" : \"secondary\"}\r\n              className=\"cursor-pointer hover:scale-105 transition-transform\"\r\n              onClick={() => handleRadiusChange(20)}\r\n            >\r\n              {t(\"restaurants.radius20km\")}\r\n            </Badge>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Map and List Layout */}\r\n      {!isLoading && filteredRestaurants && (\r\n        <div className=\"flex flex-col lg:flex-row gap-6\">\r\n          {/* Map */}\r\n          <div className={`w-full lg:flex-1 transition-all duration-300 ease-in-out ${isMapCollapsed ? 'h-0 overflow-hidden lg:h-[500px]' : 'h-[400px] lg:h-[500px]'}`}>\r\n            <div id=\"home-map-container\" className={`${isFullscreen ? 'fixed inset-0 z-50 bg-background' : 'w-full h-full'} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`}>\r\n              <Button\r\n                variant=\"secondary\"\r\n                size=\"icon\"\r\n                className=\"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                onClick={toggleFullscreen}\r\n              >\r\n                {isFullscreen ? (\r\n                  <Minimize className=\"w-5 h-5\" />\r\n                ) : (\r\n                  <Maximize className=\"w-5 h-5\" />\r\n                )}\r\n              </Button>\r\n              <div className=\"h-full relative\">\r\n                <RestaurantMap\r\n                  restaurants={filteredRestaurants}\r\n                  onRestaurantClick={handleRestaurantClick}\r\n                  userLocation={userLocation}\r\n                  radiusFilter={radiusFilter}\r\n                  onMarkerClick={handleMarkerClick}\r\n                  showViewDetailsButton={true}\r\n                  onMapInit={(mapInstance) => {\r\n                    mapRef.current = mapInstance;\r\n                  }}\r\n                />\r\n                <div className=\"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg\">\r\n                  <img \r\n                    src={logoIcon} \r\n                    alt=\"Xiaoxiong Market Logo\" \r\n                    className=\"h-6 w-6 object-contain\"\r\n                  />\r\n                  <span className=\"text-sm font-semibold text-foreground whitespace-nowrap\">\r\n                    {i18n.language === 'zh' ? '小熊市场' : 'Xiaoxiong Market'}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          {/* Mobile Map Toggle Button */}\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1\"\r\n            onClick={() => setIsMapCollapsed(!isMapCollapsed)}\r\n          >\r\n            {isMapCollapsed ? (\r\n              <>\r\n                <ChevronDown className=\"w-4 h-4\" />\r\n                {t(\"map.showMap\")}\r\n              </>\r\n            ) : (\r\n              <>\r\n                <ChevronUp className=\"w-4 h-4\" />\r\n                {t(\"map.hideMap\")}\r\n              </>\r\n            )}\r\n          </Button>\r\n\r\n          {/* Restaurant List Sidebar */}\r\n          <div className=\"w-full lg:w-[420px] flex flex-col\">\r\n            <div className=\"mb-4 pb-4 border-b border-border\">\r\n              <h2 className=\"text-xl sm:text-2xl font-bold text-foreground flex items-center gap-2\">\r\n                <MapPin className=\"w-6 h-6 text-primary\" />\r\n                {t(\"restaurants.title\")}\r\n                <Badge variant=\"secondary\" className=\"ml-2\">{filteredRestaurants.length}</Badge>\r\n              </h2>\r\n              {userLocation && (\r\n                <p className=\"text-sm text-muted-foreground mt-2 flex items-center gap-1.5\">\r\n                  <Navigation className=\"w-4 h-4\" />\r\n                  {t(\"restaurants.sortedByDistance\")}\r\n                </p>\r\n              )}\r\n            </div>\r\n            \r\n            {filteredRestaurants.length === 0 ? (\r\n              <div className=\"flex flex-col items-center justify-center py-12 text-center\">\r\n                <MapPin className=\"w-16 h-16 text-muted-foreground/40 mb-4\" />\r\n                <h3 className=\"text-xl font-semibold text-foreground mb-2\">\r\n                  {t(\"restaurants.noResults\")}\r\n                </h3>\r\n                <p className=\"text-muted-foreground max-w-xs\">\r\n                  {t(\"restaurants.noResultsDesc\")}\r\n                </p>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"lg:hidden space-y-3 pb-4\">\r\n                  {(isMobileListExpanded \r\n                    ? filteredRestaurants \r\n                    : filteredRestaurants.slice(0, MOBILE_DEFAULT_VISIBLE)\r\n                  ).map((restaurant) => (\r\n                    <Card\r\n                      key={restaurant.id}\r\n                      ref={(el) => restaurantRefs.current[restaurant.id] = el}\r\n                      className={`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${\r\n                        selectedRestaurantId === restaurant.id \r\n                          ? 'border-primary ring-2 ring-primary ring-offset-2' \r\n                          : 'border-transparent'\r\n                      }`}\r\n                      onClick={() => handleRestaurantClick(restaurant)}\r\n                    >\r\n                      <div className=\"flex flex-col gap-3\">\r\n                        <div className=\"flex items-start justify-between gap-2\">\r\n                          <div className=\"flex flex-col gap-2\">\r\n                            <h3 className=\"font-bold text-lg text-foreground line-clamp-1 flex-1\">\r\n                              {formatTrademarkSymbols(restaurant.name)}\r\n                            </h3>\r\n                            {restaurant.distance !== undefined && (\r\n                              <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit\">\r\n                                <Navigation className=\"w-4 h-4 text-primary\" />\r\n                                <span className=\"font-bold text-sm text-primary\">\r\n                                  {restaurant.distance < 1 \r\n                                    ? `${(restaurant.distance * 1000).toFixed(0)} m` \r\n                                    : `${restaurant.distance.toFixed(1)} km`}\r\n                                </span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                          {restaurant.rating > 0 && (\r\n                            <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0\">\r\n                              <Star className=\"w-4 h-4\" style={{ fill: '#016450', color: '#016450' }} />\r\n                              <span className=\"font-bold text-sm text-primary\">{restaurant.rating}</span>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        \r\n                        {restaurant.type && restaurant.type.length > 0 && (\r\n                          <MapRestaurantTags \r\n                            restaurant={restaurant} \r\n                            language={i18n.language}\r\n                          />\r\n                        )}\r\n                        \r\n                        <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\r\n                          <MapPin className=\"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60\" />\r\n                          <span className=\"line-clamp-2\">{restaurant.address}</span>\r\n                        </div>\r\n                      </div>\r\n                    </Card>\r\n                  ))}\r\n                  \r\n                  {filteredRestaurants.length > MOBILE_DEFAULT_VISIBLE && (\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      className=\"w-full mt-2 gap-2\"\r\n                      onClick={() => setIsMobileListExpanded(!isMobileListExpanded)}\r\n                    >\r\n                      {isMobileListExpanded ? (\r\n                        <>\r\n                          <ChevronUp className=\"w-4 h-4\" />\r\n                          {t(\"map.collapseList\")}\r\n                        </>\r\n                      ) : (\r\n                        <>\r\n                          <ChevronDown className=\"w-4 h-4\" />\r\n                          {t(\"map.showAllRestaurants\", { count: filteredRestaurants.length })}\r\n                        </>\r\n                      )}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n                \r\n                <ScrollArea className=\"hidden lg:block h-[420px] pr-4\">\r\n                  <div className=\"space-y-3 pb-4\">\r\n                    {filteredRestaurants.map((restaurant) => (\r\n                      <Card\r\n                        key={restaurant.id}\r\n                        ref={(el) => restaurantRefs.current[restaurant.id] = el}\r\n                        className={`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${\r\n                          selectedRestaurantId === restaurant.id \r\n                            ? 'border-primary ring-2 ring-primary ring-offset-2' \r\n                            : 'border-transparent'\r\n                        }`}\r\n                        onClick={() => handleRestaurantClick(restaurant)}\r\n                      >\r\n                        <div className=\"flex flex-col gap-3\">\r\n                          <div className=\"flex items-start justify-between gap-2\">\r\n                            <div className=\"flex flex-col gap-2\">\r\n                              <h3 className=\"font-bold text-lg text-foreground line-clamp-1 flex-1\">\r\n                                {formatTrademarkSymbols(restaurant.name)}\r\n                              </h3>\r\n                              {restaurant.distance !== undefined && (\r\n                                <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit\">\r\n                                  <Navigation className=\"w-4 h-4 text-primary\" />\r\n                                  <span className=\"font-bold text-sm text-primary\">\r\n                                    {restaurant.distance < 1 \r\n                                      ? `${(restaurant.distance * 1000).toFixed(0)} m` \r\n                                      : `${restaurant.distance.toFixed(1)} km`}\r\n                                  </span>\r\n                                </div>\r\n                              )}\r\n                            </div>\r\n                            {restaurant.rating > 0 && (\r\n                              <div className=\"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0\">\r\n                                <Star className=\"w-4 h-4\" style={{ fill: '#016450', color: '#016450' }} />\r\n                                <span className=\"font-bold text-sm text-primary\">{restaurant.rating}</span>\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        \r\n                          {restaurant.type && restaurant.type.length > 0 && (\r\n                            <MapRestaurantTags \r\n                              restaurant={restaurant} \r\n                              language={i18n.language}\r\n                            />\r\n                          )}\r\n                          \r\n                          <div className=\"flex items-start gap-2 text-sm text-muted-foreground\">\r\n                            <MapPin className=\"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60\" />\r\n                            <span className=\"line-clamp-2\">{restaurant.address}</span>\r\n                          </div>\r\n                        </div>\r\n                      </Card>\r\n                    ))}\r\n                  </div>\r\n                </ScrollArea>\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <LocationPermissionDialog\r\n        open={showLocationDialog}\r\n        onOpenChange={setShowLocationDialog}\r\n        onConfirm={requestLocation}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default HomeMapSection;\r\n"],"names":["MapRestaurantTags","restaurant","language","visibleCount","setVisibleCount","useState","containerRef","useRef","allTags","type","idx","useEffect","checkOverflow","container","badges","firstBadgeTop","lastVisibleIndex","i","timer","visibleTags","hasMore","jsxs","jsx","tag","Badge","Popover","PopoverTrigger","Button","MoreHorizontal","PopoverContent","HomeMapSection","navigate","useNavigate","i18n","useTranslation","toast","useToast","localizeRestaurant","useLocalizedContent","searchQuery","setSearchQuery","selectedTypes","setSelectedTypes","selectedActivity","setSelectedActivity","activityRestaurantIds","setActivityRestaurantIds","radiusFilter","setRadiusFilter","userLocation","setUserLocation","isFullscreen","setIsFullscreen","showAllTypes","setShowAllTypes","showAllActivities","setShowAllActivities","mapRef","savedMapState","restaurantRefs","selectedRestaurantId","setSelectedRestaurantId","showFilters","setShowFilters","showLocationDialog","setShowLocationDialog","isMapCollapsed","setIsMapCollapsed","isMobileListExpanded","setIsMobileListExpanded","MOBILE_DEFAULT_VISIBLE","restaurants","isLoading","useRestaurants","restaurantTypes","useRestaurantTypes","activities","useActivities","activityRestaurantCounts","useActivityRestaurantCounts","activitiesWithRestaurants","activity","handleTypeFilter","prev","t","handleRequestLocation","requestLocation","position","getUserLocation","error","handleRadiusChange","radius","handleActivityFilter","activityId","data","supabase","ar","processedRestaurants","localized","distance","calculateDistance","activityFilteredRestaurants","r","filteredRestaurants","a","b","handleRestaurantClick","handleMarkerClick","restaurantElement","toggleFullscreen","mapContainer","center","zoom","handleFullscreenChange","isNowFullscreen","Input","e","Navigation","Filter","index","activityLabel","Minimize","Maximize","RestaurantMap","mapInstance","logoIcon","Fragment","ChevronDown","ChevronUp","MapPin","Card","el","formatTrademarkSymbols","Star","ScrollArea","LocationPermissionDialog"],"mappings":"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"}