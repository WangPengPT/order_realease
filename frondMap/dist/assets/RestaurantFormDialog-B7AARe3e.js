import{o as es,s as re,f as ts,ag as ut,ah as zt,z as He,a4 as G,r as a,af as Z,bs as Xe,d as Nn,j as r,C as je,a as ns,m as ss,aq as rs,b as De,J as bt,B as pe,K as is,N as os,O as as,Q as ls,R as cs,T as ds,X as It,e as us,y as fs,D as hs,ad as ms,q as ps,a6 as gs,a7 as xs,a8 as nn,a9 as vs,Z as bs,aa as I,I as L,a_ as sn,an as yt,i as rt,P as ys}from"./index-Dz3rGluG.js";import{u as ws}from"./index.esm-DAa0k52D.js";import{o as Ns,s as Y,a as wt,n as rn,b as on,t as Cs}from"./types-Cv-8t_6m.js";import{m as Nt}from"./mapbox-gl-D0Sl7PBk.js";import{C as Ue}from"./checkbox-skc6Q1x3.js";import{S as js}from"./switch-CpMnsUET.js";import{T as Ds,a as Ss,b as Ct,c as jt}from"./tabs-BeIppft1.js";import{I as Cn}from"./image-CSIY-KkQ.js";import{U as At}from"./upload-CgyP0Lm5.js";import{G as Rs}from"./grip-vertical-mHf89O0u.js";import{R as Dt}from"./RichTextEditor-2_Ayk27-.js";import{K as _s}from"./key-DZfDyWPx.js";import{C as Es}from"./clock-CGZ2lzTa.js";const Is=e=>es({queryKey:["dish-images",e],queryFn:async()=>{const{data:t,error:n}=await re.from("restaurant_dish_images").select("*").eq("restaurant_id",e).order("sort_order",{ascending:!0});if(n)throw n;return t},enabled:!!e}),As=()=>{const{user:e}=ts(),t=ut();return zt({mutationFn:async({restaurantId:n,file:s})=>{if(!e)throw new Error("Must be logged in");const{data:i,error:o}=await re.from("restaurant_dish_images").select("id").eq("restaurant_id",n);if(o)throw o;if(i&&i.length>=10)throw new Error("MAX_IMAGES_REACHED");const l=s.name.split(".").pop(),c=`${n}/${Date.now()}-${Math.random().toString(36).substring(7)}.${l}`,{error:u}=await re.storage.from("dish-images").upload(c,s);if(u)throw u;const{data:{publicUrl:f}}=re.storage.from("dish-images").getPublicUrl(c),m=i?i.length:0,{data:h,error:x}=await re.from("restaurant_dish_images").insert({restaurant_id:n,image_url:f,sort_order:m,created_by:e.id}).select().single();if(x)throw x;return h},onSuccess:(n,s)=>{t.invalidateQueries({queryKey:["dish-images",s.restaurantId]}),He.success(G.t("dishImages.uploadSuccess"))},onError:n=>{n.message==="MAX_IMAGES_REACHED"?He.error(G.t("dishImages.maxImagesReached")):He.error(G.t("dishImages.uploadFailed"))}})},Ms=()=>{const e=ut();return zt({mutationFn:async({imageId:t,restaurantId:n,imageUrl:s})=>{const i=s.split("/dish-images/");i[1]&&await re.storage.from("dish-images").remove([i[1]]);const{error:o}=await re.from("restaurant_dish_images").delete().eq("id",t);if(o)throw o;return{restaurantId:n}},onSuccess:t=>{e.invalidateQueries({queryKey:["dish-images",t.restaurantId]}),He.success(G.t("dishImages.deleteSuccess"))},onError:()=>{He.error(G.t("dishImages.deleteFailed"))}})},Ts=()=>{const e=ut();return zt({mutationFn:async({images:t,restaurantId:n})=>{const s=t.map(i=>re.from("restaurant_dish_images").update({sort_order:i.sort_order}).eq("id",i.id));return await Promise.all(s),{restaurantId:n}},onSuccess:t=>{e.invalidateQueries({queryKey:["dish-images",t.restaurantId]})}})};function ks(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>s=>{t.forEach(i=>i(s))},t)}const ft=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Oe(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function Ft(e){return"nodeType"in e}function ee(e){var t,n;return e?Oe(e)?e:Ft(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Pt(e){const{Document:t}=ee(e);return e instanceof t}function Ze(e){return Oe(e)?!1:e instanceof ee(e).HTMLElement}function jn(e){return e instanceof ee(e).SVGElement}function Le(e){return e?Oe(e)?e.document:Ft(e)?Pt(e)?e:Ze(e)||jn(e)?e.ownerDocument:document:document:document}const fe=ft?a.useLayoutEffect:a.useEffect;function $t(e){const t=a.useRef(e);return fe(()=>{t.current=e}),a.useCallback(function(){for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return t.current==null?void 0:t.current(...s)},[])}function Os(){const e=a.useRef(null),t=a.useCallback((s,i)=>{e.current=setInterval(s,i)},[]),n=a.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Ve(e,t){t===void 0&&(t=[e]);const n=a.useRef(e);return fe(()=>{n.current!==e&&(n.current=e)},t),n}function et(e,t){const n=a.useRef();return a.useMemo(()=>{const s=e(n.current);return n.current=s,s},[...t])}function at(e){const t=$t(e),n=a.useRef(null),s=a.useCallback(i=>{i!==n.current&&(t==null||t(i,n.current)),n.current=i},[]);return[n,s]}function Mt(e){const t=a.useRef();return a.useEffect(()=>{t.current=e},[e]),t.current}let St={};function tt(e,t){return a.useMemo(()=>{if(t)return t;const n=St[e]==null?0:St[e]+1;return St[e]=n,e+"-"+n},[e,t])}function Dn(e){return function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s.reduce((o,l)=>{const c=Object.entries(l);for(const[u,f]of c){const m=o[u];m!=null&&(o[u]=m+e*f)}return o},{...t})}}const ke=Dn(1),Ge=Dn(-1);function Ls(e){return"clientX"in e&&"clientY"in e}function Bt(e){if(!e)return!1;const{KeyboardEvent:t}=ee(e.target);return t&&e instanceof t}function zs(e){if(!e)return!1;const{TouchEvent:t}=ee(e.target);return t&&e instanceof t}function Tt(e){if(zs(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Ls(e)?{x:e.clientX,y:e.clientY}:null}const Je=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Je.Translate.toString(e),Je.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:s}=e;return t+" "+n+"ms "+s}}}),an="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Fs(e){return e.matches(an)?e:e.querySelector(an)}const Ps={display:"none"};function $s(e){let{id:t,value:n}=e;return Z.createElement("div",{id:t,style:Ps},n)}function Bs(e){let{id:t,announcement:n,ariaLiveType:s="assertive"}=e;const i={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Z.createElement("div",{id:t,style:i,role:"status","aria-live":s,"aria-atomic":!0},n)}function qs(){const[e,t]=a.useState("");return{announce:a.useCallback(s=>{s!=null&&t(s)},[]),announcement:e}}const Sn=a.createContext(null);function Us(e){const t=a.useContext(Sn);a.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Xs(){const[e]=a.useState(()=>new Set),t=a.useCallback(s=>(e.add(s),()=>e.delete(s)),[e]);return[a.useCallback(s=>{let{type:i,event:o}=s;e.forEach(l=>{var c;return(c=l[i])==null?void 0:c.call(l,o)})},[e]),t]}const Hs={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ks={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Ws(e){let{announcements:t=Ks,container:n,hiddenTextDescribedById:s,screenReaderInstructions:i=Hs}=e;const{announce:o,announcement:l}=qs(),c=tt("DndLiveRegion"),[u,f]=a.useState(!1);if(a.useEffect(()=>{f(!0)},[]),Us(a.useMemo(()=>({onDragStart(h){let{active:x}=h;o(t.onDragStart({active:x}))},onDragMove(h){let{active:x,over:b}=h;t.onDragMove&&o(t.onDragMove({active:x,over:b}))},onDragOver(h){let{active:x,over:b}=h;o(t.onDragOver({active:x,over:b}))},onDragEnd(h){let{active:x,over:b}=h;o(t.onDragEnd({active:x,over:b}))},onDragCancel(h){let{active:x,over:b}=h;o(t.onDragCancel({active:x,over:b}))}}),[o,t])),!u)return null;const m=Z.createElement(Z.Fragment,null,Z.createElement($s,{id:s,value:i.draggable}),Z.createElement(Bs,{id:c,announcement:l}));return n?Xe.createPortal(m,n):m}var q;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(q||(q={}));function lt(){}function ln(e,t){return a.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Ys(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.useMemo(()=>[...t].filter(s=>s!=null),[...t])}const le=Object.freeze({x:0,y:0});function Rn(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function _n(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return n-s}function Vs(e,t){let{data:{value:n}}=e,{data:{value:s}}=t;return s-n}function cn(e){let{left:t,top:n,height:s,width:i}=e;return[{x:t,y:n},{x:t+i,y:n},{x:t,y:n+s},{x:t+i,y:n+s}]}function En(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function dn(e,t,n){return t===void 0&&(t=e.left),n===void 0&&(n=e.top),{x:t+e.width*.5,y:n+e.height*.5}}const Gs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const i=dn(t,t.left,t.top),o=[];for(const l of s){const{id:c}=l,u=n.get(c);if(u){const f=Rn(dn(u),i);o.push({id:c,data:{droppableContainer:l,value:f}})}}return o.sort(_n)},Js=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const i=cn(t),o=[];for(const l of s){const{id:c}=l,u=n.get(c);if(u){const f=cn(u),m=i.reduce((x,b,S)=>x+Rn(f[S],b),0),h=Number((m/4).toFixed(4));o.push({id:c,data:{droppableContainer:l,value:h}})}}return o.sort(_n)};function Qs(e,t){const n=Math.max(t.top,e.top),s=Math.max(t.left,e.left),i=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),l=i-s,c=o-n;if(s<i&&n<o){const u=t.width*t.height,f=e.width*e.height,m=l*c,h=m/(u+f-m);return Number(h.toFixed(4))}return 0}const Zs=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:s}=e;const i=[];for(const o of s){const{id:l}=o,c=n.get(l);if(c){const u=Qs(c,t);u>0&&i.push({id:l,data:{droppableContainer:o,value:u}})}}return i.sort(Vs)};function er(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function In(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:le}function tr(e){return function(n){for(var s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];return i.reduce((l,c)=>({...l,top:l.top+e*c.y,bottom:l.bottom+e*c.y,left:l.left+e*c.x,right:l.right+e*c.x}),{...n})}}const nr=tr(1);function sr(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function rr(e,t,n){const s=sr(t);if(!s)return e;const{scaleX:i,scaleY:o,x:l,y:c}=s,u=e.left-l-(1-i)*parseFloat(n),f=e.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),m=i?e.width/i:e.width,h=o?e.height/o:e.height;return{width:m,height:h,top:f,right:u+m,bottom:f+h,left:u}}const ir={ignoreTransform:!1};function ze(e,t){t===void 0&&(t=ir);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:f,transformOrigin:m}=ee(e).getComputedStyle(e);f&&(n=rr(n,f,m))}const{top:s,left:i,width:o,height:l,bottom:c,right:u}=n;return{top:s,left:i,width:o,height:l,bottom:c,right:u}}function un(e){return ze(e,{ignoreTransform:!0})}function or(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function ar(e,t){return t===void 0&&(t=ee(e).getComputedStyle(e)),t.position==="fixed"}function lr(e,t){t===void 0&&(t=ee(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(i=>{const o=t[i];return typeof o=="string"?n.test(o):!1})}function ht(e,t){const n=[];function s(i){if(t!=null&&n.length>=t||!i)return n;if(Pt(i)&&i.scrollingElement!=null&&!n.includes(i.scrollingElement))return n.push(i.scrollingElement),n;if(!Ze(i)||jn(i)||n.includes(i))return n;const o=ee(e).getComputedStyle(i);return i!==e&&lr(i,o)&&n.push(i),ar(i,o)?n:s(i.parentNode)}return e?s(e):n}function An(e){const[t]=ht(e,1);return t??null}function Rt(e){return!ft||!e?null:Oe(e)?e:Ft(e)?Pt(e)||e===Le(e).scrollingElement?window:Ze(e)?e:null:null}function Mn(e){return Oe(e)?e.scrollX:e.scrollLeft}function Tn(e){return Oe(e)?e.scrollY:e.scrollTop}function kt(e){return{x:Mn(e),y:Tn(e)}}var X;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(X||(X={}));function kn(e){return!ft||!e?!1:e===document.scrollingElement}function On(e){const t={x:0,y:0},n=kn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},s={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},i=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,l=e.scrollTop>=s.y,c=e.scrollLeft>=s.x;return{isTop:i,isLeft:o,isBottom:l,isRight:c,maxScroll:s,minScroll:t}}const cr={x:.2,y:.2};function dr(e,t,n,s,i){let{top:o,left:l,right:c,bottom:u}=n;s===void 0&&(s=10),i===void 0&&(i=cr);const{isTop:f,isBottom:m,isLeft:h,isRight:x}=On(e),b={x:0,y:0},S={x:0,y:0},y={height:t.height*i.y,width:t.width*i.x};return!f&&o<=t.top+y.height?(b.y=X.Backward,S.y=s*Math.abs((t.top+y.height-o)/y.height)):!m&&u>=t.bottom-y.height&&(b.y=X.Forward,S.y=s*Math.abs((t.bottom-y.height-u)/y.height)),!x&&c>=t.right-y.width?(b.x=X.Forward,S.x=s*Math.abs((t.right-y.width-c)/y.width)):!h&&l<=t.left+y.width&&(b.x=X.Backward,S.x=s*Math.abs((t.left+y.width-l)/y.width)),{direction:b,speed:S}}function ur(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:t,left:n,right:s,bottom:i}=e.getBoundingClientRect();return{top:t,left:n,right:s,bottom:i,width:e.clientWidth,height:e.clientHeight}}function Ln(e){return e.reduce((t,n)=>ke(t,kt(n)),le)}function fr(e){return e.reduce((t,n)=>t+Mn(n),0)}function hr(e){return e.reduce((t,n)=>t+Tn(n),0)}function mr(e,t){if(t===void 0&&(t=ze),!e)return;const{top:n,left:s,bottom:i,right:o}=t(e);An(e)&&(i<=0||o<=0||n>=window.innerHeight||s>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const pr=[["x",["left","right"],fr],["y",["top","bottom"],hr]];class qt{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const s=ht(n),i=Ln(s);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,l,c]of pr)for(const u of l)Object.defineProperty(this,u,{get:()=>{const f=c(s),m=i[o]-f;return this.rect[u]+m},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ke{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var s;return(s=this.target)==null?void 0:s.removeEventListener(...n)})},this.target=t}add(t,n,s){var i;(i=this.target)==null||i.addEventListener(t,n,s),this.listeners.push([t,n,s])}}function gr(e){const{EventTarget:t}=ee(e);return e instanceof t?e:Le(e)}function _t(e,t){const n=Math.abs(e.x),s=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+s**2)>t:"x"in t&&"y"in t?n>t.x&&s>t.y:"x"in t?n>t.x:"y"in t?s>t.y:!1}var oe;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(oe||(oe={}));function fn(e){e.preventDefault()}function xr(e){e.stopPropagation()}var E;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(E||(E={}));const zn={start:[E.Space,E.Enter],cancel:[E.Esc],end:[E.Space,E.Enter,E.Tab]},vr=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case E.Right:return{...n,x:n.x+25};case E.Left:return{...n,x:n.x-25};case E.Down:return{...n,y:n.y+25};case E.Up:return{...n,y:n.y-25}}};class Ut{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ke(Le(n)),this.windowListeners=new Ke(ee(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(oe.Resize,this.handleCancel),this.windowListeners.add(oe.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(oe.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,s=t.node.current;s&&mr(s),n(le)}handleKeyDown(t){if(Bt(t)){const{active:n,context:s,options:i}=this.props,{keyboardCodes:o=zn,coordinateGetter:l=vr,scrollBehavior:c="smooth"}=i,{code:u}=t;if(o.end.includes(u)){this.handleEnd(t);return}if(o.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:f}=s.current,m=f?{x:f.left,y:f.top}:le;this.referenceCoordinates||(this.referenceCoordinates=m);const h=l(t,{active:n,context:s.current,currentCoordinates:m});if(h){const x=Ge(h,m),b={x:0,y:0},{scrollableAncestors:S}=s.current;for(const y of S){const N=t.code,{isTop:p,isRight:C,isLeft:j,isBottom:_,maxScroll:v,minScroll:R}=On(y),w=ur(y),D={x:Math.min(N===E.Right?w.right-w.width/2:w.right,Math.max(N===E.Right?w.left:w.left+w.width/2,h.x)),y:Math.min(N===E.Down?w.bottom-w.height/2:w.bottom,Math.max(N===E.Down?w.top:w.top+w.height/2,h.y))},T=N===E.Right&&!C||N===E.Left&&!j,F=N===E.Down&&!_||N===E.Up&&!p;if(T&&D.x!==h.x){const O=y.scrollLeft+x.x,P=N===E.Right&&O<=v.x||N===E.Left&&O>=R.x;if(P&&!x.y){y.scrollTo({left:O,behavior:c});return}P?b.x=y.scrollLeft-O:b.x=N===E.Right?y.scrollLeft-v.x:y.scrollLeft-R.x,b.x&&y.scrollBy({left:-b.x,behavior:c});break}else if(F&&D.y!==h.y){const O=y.scrollTop+x.y,P=N===E.Down&&O<=v.y||N===E.Up&&O>=R.y;if(P&&!x.x){y.scrollTo({top:O,behavior:c});return}P?b.y=y.scrollTop-O:b.y=N===E.Down?y.scrollTop-v.y:y.scrollTop-R.y,b.y&&y.scrollBy({top:-b.y,behavior:c});break}}this.handleMove(t,ke(Ge(h,this.referenceCoordinates),b))}}}handleMove(t,n){const{onMove:s}=this.props;t.preventDefault(),s(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Ut.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:s=zn,onActivation:i}=t,{active:o}=n;const{code:l}=e.nativeEvent;if(s.start.includes(l)){const c=o.activatorNode.current;return c&&e.target!==c?!1:(e.preventDefault(),i==null||i({event:e.nativeEvent}),!0)}return!1}}];function hn(e){return!!(e&&"distance"in e)}function mn(e){return!!(e&&"delay"in e)}class Xt{constructor(t,n,s){var i;s===void 0&&(s=gr(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:l}=o;this.props=t,this.events=n,this.document=Le(l),this.documentListeners=new Ke(this.document),this.listeners=new Ke(s),this.windowListeners=new Ke(ee(l)),this.initialCoordinates=(i=Tt(o))!=null?i:le,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:s}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(oe.Resize,this.handleCancel),this.windowListeners.add(oe.DragStart,fn),this.windowListeners.add(oe.VisibilityChange,this.handleCancel),this.windowListeners.add(oe.ContextMenu,fn),this.documentListeners.add(oe.Keydown,this.handleKeydown),n){if(s!=null&&s({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(mn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(hn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:s,onPending:i}=this.props;i(s,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(oe.Click,xr,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(oe.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:s,initialCoordinates:i,props:o}=this,{onMove:l,options:{activationConstraint:c}}=o;if(!i)return;const u=(n=Tt(t))!=null?n:le,f=Ge(i,u);if(!s&&c){if(hn(c)){if(c.tolerance!=null&&_t(f,c.tolerance))return this.handleCancel();if(_t(f,c.distance))return this.handleStart()}if(mn(c)&&_t(f,c.tolerance))return this.handleCancel();this.handlePending(c,f);return}t.cancelable&&t.preventDefault(),l(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===E.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const br={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ht extends Xt{constructor(t){const{event:n}=t,s=Le(n.target);super(t,br,s)}}Ht.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return!n.isPrimary||n.button!==0?!1:(s==null||s({event:n}),!0)}}];const yr={move:{name:"mousemove"},end:{name:"mouseup"}};var Ot;(function(e){e[e.RightClick=2]="RightClick"})(Ot||(Ot={}));class wr extends Xt{constructor(t){super(t,yr,Le(t.event.target))}}wr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;return n.button===Ot.RightClick?!1:(s==null||s({event:n}),!0)}}];const Et={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Nr extends Xt{constructor(t){super(t,Et)}static setup(){return window.addEventListener(Et.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(Et.move.name,t)};function t(){}}}Nr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:s}=t;const{touches:i}=n;return i.length>1?!1:(s==null||s({event:n}),!0)}}];var We;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(We||(We={}));var ct;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(ct||(ct={}));function Cr(e){let{acceleration:t,activator:n=We.Pointer,canScroll:s,draggingRect:i,enabled:o,interval:l=5,order:c=ct.TreeOrder,pointerCoordinates:u,scrollableAncestors:f,scrollableAncestorRects:m,delta:h,threshold:x}=e;const b=Dr({delta:h,disabled:!o}),[S,y]=Os(),N=a.useRef({x:0,y:0}),p=a.useRef({x:0,y:0}),C=a.useMemo(()=>{switch(n){case We.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case We.DraggableRect:return i}},[n,i,u]),j=a.useRef(null),_=a.useCallback(()=>{const R=j.current;if(!R)return;const w=N.current.x*p.current.x,D=N.current.y*p.current.y;R.scrollBy(w,D)},[]),v=a.useMemo(()=>c===ct.TreeOrder?[...f].reverse():f,[c,f]);a.useEffect(()=>{if(!o||!f.length||!C){y();return}for(const R of v){if((s==null?void 0:s(R))===!1)continue;const w=f.indexOf(R),D=m[w];if(!D)continue;const{direction:T,speed:F}=dr(R,D,C,t,x);for(const O of["x","y"])b[O][T[O]]||(F[O]=0,T[O]=0);if(F.x>0||F.y>0){y(),j.current=R,S(_,l),N.current=F,p.current=T;return}}N.current={x:0,y:0},p.current={x:0,y:0},y()},[t,_,s,y,o,l,JSON.stringify(C),JSON.stringify(b),S,f,v,m,JSON.stringify(x)])}const jr={x:{[X.Backward]:!1,[X.Forward]:!1},y:{[X.Backward]:!1,[X.Forward]:!1}};function Dr(e){let{delta:t,disabled:n}=e;const s=Mt(t);return et(i=>{if(n||!s||!i)return jr;const o={x:Math.sign(t.x-s.x),y:Math.sign(t.y-s.y)};return{x:{[X.Backward]:i.x[X.Backward]||o.x===-1,[X.Forward]:i.x[X.Forward]||o.x===1},y:{[X.Backward]:i.y[X.Backward]||o.y===-1,[X.Forward]:i.y[X.Forward]||o.y===1}}},[n,t,s])}function Sr(e,t){const n=t!=null?e.get(t):void 0,s=n?n.node.current:null;return et(i=>{var o;return t==null?null:(o=s??i)!=null?o:null},[s,t])}function Rr(e,t){return a.useMemo(()=>e.reduce((n,s)=>{const{sensor:i}=s,o=i.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,s)}));return[...n,...o]},[]),[e,t])}var Qe;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Qe||(Qe={}));var Lt;(function(e){e.Optimized="optimized"})(Lt||(Lt={}));const pn=new Map;function _r(e,t){let{dragging:n,dependencies:s,config:i}=t;const[o,l]=a.useState(null),{frequency:c,measure:u,strategy:f}=i,m=a.useRef(e),h=N(),x=Ve(h),b=a.useCallback(function(p){p===void 0&&(p=[]),!x.current&&l(C=>C===null?p:C.concat(p.filter(j=>!C.includes(j))))},[x]),S=a.useRef(null),y=et(p=>{if(h&&!n)return pn;if(!p||p===pn||m.current!==e||o!=null){const C=new Map;for(let j of e){if(!j)continue;if(o&&o.length>0&&!o.includes(j.id)&&j.rect.current){C.set(j.id,j.rect.current);continue}const _=j.node.current,v=_?new qt(u(_),_):null;j.rect.current=v,v&&C.set(j.id,v)}return C}return p},[e,o,n,h,u]);return a.useEffect(()=>{m.current=e},[e]),a.useEffect(()=>{h||b()},[n,h]),a.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),a.useEffect(()=>{h||typeof c!="number"||S.current!==null||(S.current=setTimeout(()=>{b(),S.current=null},c))},[c,h,b,...s]),{droppableRects:y,measureDroppableContainers:b,measuringScheduled:o!=null};function N(){switch(f){case Qe.Always:return!1;case Qe.BeforeDragging:return n;default:return!n}}}function Fn(e,t){return et(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Er(e,t){return Fn(e,t)}function Ir(e){let{callback:t,disabled:n}=e;const s=$t(t),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(s)},[s,n]);return a.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function mt(e){let{callback:t,disabled:n}=e;const s=$t(t),i=a.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(s)},[n]);return a.useEffect(()=>()=>i==null?void 0:i.disconnect(),[i]),i}function Ar(e){return new qt(ze(e),e)}function gn(e,t,n){t===void 0&&(t=Ar);const[s,i]=a.useState(null);function o(){i(u=>{if(!e)return null;if(e.isConnected===!1){var f;return(f=u??n)!=null?f:null}const m=t(e);return JSON.stringify(u)===JSON.stringify(m)?u:m})}const l=Ir({callback(u){if(e)for(const f of u){const{type:m,target:h}=f;if(m==="childList"&&h instanceof HTMLElement&&h.contains(e)){o();break}}}}),c=mt({callback:o});return fe(()=>{o(),e?(c==null||c.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[e]),s}function Mr(e){const t=Fn(e);return In(e,t)}const xn=[];function Tr(e){const t=a.useRef(e),n=et(s=>e?s&&s!==xn&&e&&t.current&&e.parentNode===t.current.parentNode?s:ht(e):xn,[e]);return a.useEffect(()=>{t.current=e},[e]),n}function kr(e){const[t,n]=a.useState(null),s=a.useRef(e),i=a.useCallback(o=>{const l=Rt(o.target);l&&n(c=>c?(c.set(l,kt(l)),new Map(c)):null)},[]);return a.useEffect(()=>{const o=s.current;if(e!==o){l(o);const c=e.map(u=>{const f=Rt(u);return f?(f.addEventListener("scroll",i,{passive:!0}),[f,kt(f)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),s.current=e}return()=>{l(e),l(o)};function l(c){c.forEach(u=>{const f=Rt(u);f==null||f.removeEventListener("scroll",i)})}},[i,e]),a.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,l)=>ke(o,l),le):Ln(e):le,[e,t])}function vn(e,t){t===void 0&&(t=[]);const n=a.useRef(null);return a.useEffect(()=>{n.current=null},t),a.useEffect(()=>{const s=e!==le;s&&!n.current&&(n.current=e),!s&&n.current&&(n.current=null)},[e]),n.current?Ge(e,n.current):le}function Or(e){a.useEffect(()=>{if(!ft)return;const t=e.map(n=>{let{sensor:s}=n;return s.setup==null?void 0:s.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Lr(e,t){return a.useMemo(()=>e.reduce((n,s)=>{let{eventName:i,handler:o}=s;return n[i]=l=>{o(l,t)},n},{}),[e,t])}function Pn(e){return a.useMemo(()=>e?or(e):null,[e])}const bn=[];function zr(e,t){t===void 0&&(t=ze);const[n]=e,s=Pn(n?ee(n):null),[i,o]=a.useState(bn);function l(){o(()=>e.length?e.map(u=>kn(u)?s:new qt(t(u),u)):bn)}const c=mt({callback:l});return fe(()=>{c==null||c.disconnect(),l(),e.forEach(u=>c==null?void 0:c.observe(u))},[e]),i}function Fr(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ze(t)?t:e}function Pr(e){let{measure:t}=e;const[n,s]=a.useState(null),i=a.useCallback(f=>{for(const{target:m}of f)if(Ze(m)){s(h=>{const x=t(m);return h?{...h,width:x.width,height:x.height}:x});break}},[t]),o=mt({callback:i}),l=a.useCallback(f=>{const m=Fr(f);o==null||o.disconnect(),m&&(o==null||o.observe(m)),s(m?t(m):null)},[t,o]),[c,u]=at(l);return a.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const $r=[{sensor:Ht,options:{}},{sensor:Ut,options:{}}],Br={current:{}},ot={draggable:{measure:un},droppable:{measure:un,strategy:Qe.WhileDragging,frequency:Lt.Optimized},dragOverlay:{measure:ze}};class Ye extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,s;return(n=(s=this.get(t))==null?void 0:s.node.current)!=null?n:void 0}}const qr={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ye,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:lt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:ot,measureDroppableContainers:lt,windowRect:null,measuringScheduled:!1},Ur={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:lt,draggableNodes:new Map,over:null,measureDroppableContainers:lt},pt=a.createContext(Ur),$n=a.createContext(qr);function Xr(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ye}}}function Hr(e,t){switch(t.type){case q.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case q.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case q.DragEnd:case q.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case q.RegisterDroppable:{const{element:n}=t,{id:s}=n,i=new Ye(e.droppable.containers);return i.set(s,n),{...e,droppable:{...e.droppable,containers:i}}}case q.SetDroppableDisabled:{const{id:n,key:s,disabled:i}=t,o=e.droppable.containers.get(n);if(!o||s!==o.key)return e;const l=new Ye(e.droppable.containers);return l.set(n,{...o,disabled:i}),{...e,droppable:{...e.droppable,containers:l}}}case q.UnregisterDroppable:{const{id:n,key:s}=t,i=e.droppable.containers.get(n);if(!i||s!==i.key)return e;const o=new Ye(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Kr(e){let{disabled:t}=e;const{active:n,activatorEvent:s,draggableNodes:i}=a.useContext(pt),o=Mt(s),l=Mt(n==null?void 0:n.id);return a.useEffect(()=>{if(!t&&!s&&o&&l!=null){if(!Bt(o)||document.activeElement===o.target)return;const c=i.get(l);if(!c)return;const{activatorNode:u,node:f}=c;if(!u.current&&!f.current)return;requestAnimationFrame(()=>{for(const m of[u.current,f.current]){if(!m)continue;const h=Fs(m);if(h){h.focus();break}}})}},[s,t,i,l,o]),null}function Wr(e,t){let{transform:n,...s}=t;return e!=null&&e.length?e.reduce((i,o)=>o({transform:i,...s}),n):n}function Yr(e){return a.useMemo(()=>({draggable:{...ot.draggable,...e==null?void 0:e.draggable},droppable:{...ot.droppable,...e==null?void 0:e.droppable},dragOverlay:{...ot.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Vr(e){let{activeNode:t,measure:n,initialRect:s,config:i=!0}=e;const o=a.useRef(!1),{x:l,y:c}=typeof i=="boolean"?{x:i,y:i}:i;fe(()=>{if(!l&&!c||!t){o.current=!1;return}if(o.current||!s)return;const f=t==null?void 0:t.node.current;if(!f||f.isConnected===!1)return;const m=n(f),h=In(m,s);if(l||(h.x=0),c||(h.y=0),o.current=!0,Math.abs(h.x)>0||Math.abs(h.y)>0){const x=An(f);x&&x.scrollBy({top:h.y,left:h.x})}},[t,l,c,s,n])}const Bn=a.createContext({...le,scaleX:1,scaleY:1});var Ne;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ne||(Ne={}));const Gr=a.memo(function(t){var n,s,i,o;let{id:l,accessibility:c,autoScroll:u=!0,children:f,sensors:m=$r,collisionDetection:h=Zs,measuring:x,modifiers:b,...S}=t;const y=a.useReducer(Hr,void 0,Xr),[N,p]=y,[C,j]=Xs(),[_,v]=a.useState(Ne.Uninitialized),R=_===Ne.Initialized,{draggable:{active:w,nodes:D,translate:T},droppable:{containers:F}}=N,O=w!=null?D.get(w):null,P=a.useRef({initial:null,translated:null}),z=a.useMemo(()=>{var W;return w!=null?{id:w,data:(W=O==null?void 0:O.data)!=null?W:Br,rect:P}:null},[w,O]),$=a.useRef(null),[Ce,Se]=a.useState(null),[U,Re]=a.useState(null),ae=Ve(S,Object.values(S)),ge=tt("DndDescribedBy",l),d=a.useMemo(()=>F.getEnabled(),[F]),g=Yr(x),{droppableRects:A,measureDroppableContainers:k,measuringScheduled:B}=_r(d,{dragging:R,dependencies:[T.x,T.y],config:g.droppable}),J=Sr(D,w),H=a.useMemo(()=>U?Tt(U):null,[U]),Q=Zn(),V=Er(J,g.draggable.measure);Vr({activeNode:w!=null?D.get(w):null,config:Q.layoutShiftCompensation,initialRect:V,measure:g.draggable.measure});const M=gn(J,g.draggable.measure,V),Fe=gn(J?J.parentElement:null),ce=a.useRef({activatorEvent:null,active:null,activeNode:J,collisionRect:null,collisions:null,droppableRects:A,draggableNodes:D,draggingNode:null,draggingNodeRect:null,droppableContainers:F,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),_e=F.getNodeFor((n=ce.current.over)==null?void 0:n.id),he=Pr({measure:g.dragOverlay.measure}),Ee=(s=he.nodeRef.current)!=null?s:J,Ie=R?(i=he.rect)!=null?i:M:null,Yt=!!(he.nodeRef.current&&he.rect),Vt=Mr(Yt?null:M),gt=Pn(Ee?ee(Ee):null),xe=Tr(R?_e??J:null),nt=zr(xe),st=Wr(b,{transform:{x:T.x-Vt.x,y:T.y-Vt.y,scaleX:1,scaleY:1},activatorEvent:U,active:z,activeNodeRect:M,containerNodeRect:Fe,draggingNodeRect:Ie,over:ce.current.over,overlayNodeRect:he.rect,scrollableAncestors:xe,scrollableAncestorRects:nt,windowRect:gt}),Gt=H?ke(H,T):null,Jt=kr(xe),Kn=vn(Jt),Wn=vn(Jt,[M]),Ae=ke(st,Kn),Me=Ie?nr(Ie,st):null,Pe=z&&Me?h({active:z,collisionRect:Me,droppableRects:A,droppableContainers:d,pointerCoordinates:Gt}):null,Qt=En(Pe,"id"),[ve,Zt]=a.useState(null),Yn=Yt?st:ke(st,Wn),Vn=er(Yn,(o=ve==null?void 0:ve.rect)!=null?o:null,M),xt=a.useRef(null),en=a.useCallback((W,te)=>{let{sensor:ne,options:be}=te;if($.current==null)return;const ie=D.get($.current);if(!ie)return;const se=W.nativeEvent,de=new ne({active:$.current,activeNode:ie,event:se,options:be,context:ce,onAbort(K){if(!D.get(K))return;const{onDragAbort:ue}=ae.current,me={id:K};ue==null||ue(me),C({type:"onDragAbort",event:me})},onPending(K,ye,ue,me){if(!D.get(K))return;const{onDragPending:Be}=ae.current,we={id:K,constraint:ye,initialCoordinates:ue,offset:me};Be==null||Be(we),C({type:"onDragPending",event:we})},onStart(K){const ye=$.current;if(ye==null)return;const ue=D.get(ye);if(!ue)return;const{onDragStart:me}=ae.current,$e={activatorEvent:se,active:{id:ye,data:ue.data,rect:P}};Xe.unstable_batchedUpdates(()=>{me==null||me($e),v(Ne.Initializing),p({type:q.DragStart,initialCoordinates:K,active:ye}),C({type:"onDragStart",event:$e}),Se(xt.current),Re(se)})},onMove(K){p({type:q.DragMove,coordinates:K})},onEnd:Te(q.DragEnd),onCancel:Te(q.DragCancel)});xt.current=de;function Te(K){return async function(){const{active:ue,collisions:me,over:$e,scrollAdjustedTranslate:Be}=ce.current;let we=null;if(ue&&Be){const{cancelDrop:qe}=ae.current;we={activatorEvent:se,active:ue,collisions:me,delta:Be,over:$e},K===q.DragEnd&&typeof qe=="function"&&await Promise.resolve(qe(we))&&(K=q.DragCancel)}$.current=null,Xe.unstable_batchedUpdates(()=>{p({type:K}),v(Ne.Uninitialized),Zt(null),Se(null),Re(null),xt.current=null;const qe=K===q.DragEnd?"onDragEnd":"onDragCancel";if(we){const vt=ae.current[qe];vt==null||vt(we),C({type:qe,event:we})}})}}},[D]),Gn=a.useCallback((W,te)=>(ne,be)=>{const ie=ne.nativeEvent,se=D.get(be);if($.current!==null||!se||ie.dndKit||ie.defaultPrevented)return;const de={active:se};W(ne,te.options,de)===!0&&(ie.dndKit={capturedBy:te.sensor},$.current=be,en(ne,te))},[D,en]),tn=Rr(m,Gn);Or(m),fe(()=>{M&&_===Ne.Initializing&&v(Ne.Initialized)},[M,_]),a.useEffect(()=>{const{onDragMove:W}=ae.current,{active:te,activatorEvent:ne,collisions:be,over:ie}=ce.current;if(!te||!ne)return;const se={active:te,activatorEvent:ne,collisions:be,delta:{x:Ae.x,y:Ae.y},over:ie};Xe.unstable_batchedUpdates(()=>{W==null||W(se),C({type:"onDragMove",event:se})})},[Ae.x,Ae.y]),a.useEffect(()=>{const{active:W,activatorEvent:te,collisions:ne,droppableContainers:be,scrollAdjustedTranslate:ie}=ce.current;if(!W||$.current==null||!te||!ie)return;const{onDragOver:se}=ae.current,de=be.get(Qt),Te=de&&de.rect.current?{id:de.id,rect:de.rect.current,data:de.data,disabled:de.disabled}:null,K={active:W,activatorEvent:te,collisions:ne,delta:{x:ie.x,y:ie.y},over:Te};Xe.unstable_batchedUpdates(()=>{Zt(Te),se==null||se(K),C({type:"onDragOver",event:K})})},[Qt]),fe(()=>{ce.current={activatorEvent:U,active:z,activeNode:J,collisionRect:Me,collisions:Pe,droppableRects:A,draggableNodes:D,draggingNode:Ee,draggingNodeRect:Ie,droppableContainers:F,over:ve,scrollableAncestors:xe,scrollAdjustedTranslate:Ae},P.current={initial:Ie,translated:Me}},[z,J,Pe,Me,D,Ee,Ie,A,F,ve,xe,Ae]),Cr({...Q,delta:T,draggingRect:Me,pointerCoordinates:Gt,scrollableAncestors:xe,scrollableAncestorRects:nt});const Jn=a.useMemo(()=>({active:z,activeNode:J,activeNodeRect:M,activatorEvent:U,collisions:Pe,containerNodeRect:Fe,dragOverlay:he,draggableNodes:D,droppableContainers:F,droppableRects:A,over:ve,measureDroppableContainers:k,scrollableAncestors:xe,scrollableAncestorRects:nt,measuringConfiguration:g,measuringScheduled:B,windowRect:gt}),[z,J,M,U,Pe,Fe,he,D,F,A,ve,k,xe,nt,g,B,gt]),Qn=a.useMemo(()=>({activatorEvent:U,activators:tn,active:z,activeNodeRect:M,ariaDescribedById:{draggable:ge},dispatch:p,draggableNodes:D,over:ve,measureDroppableContainers:k}),[U,tn,z,M,p,ge,D,ve,k]);return Z.createElement(Sn.Provider,{value:j},Z.createElement(pt.Provider,{value:Qn},Z.createElement($n.Provider,{value:Jn},Z.createElement(Bn.Provider,{value:Vn},f)),Z.createElement(Kr,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Z.createElement(Ws,{...c,hiddenTextDescribedById:ge}));function Zn(){const W=(Ce==null?void 0:Ce.autoScrollEnabled)===!1,te=typeof u=="object"?u.enabled===!1:u===!1,ne=R&&!W&&!te;return typeof u=="object"?{...u,enabled:ne}:{enabled:ne}}}),Jr=a.createContext(null),yn="button",Qr="Draggable";function Zr(e){let{id:t,data:n,disabled:s=!1,attributes:i}=e;const o=tt(Qr),{activators:l,activatorEvent:c,active:u,activeNodeRect:f,ariaDescribedById:m,draggableNodes:h,over:x}=a.useContext(pt),{role:b=yn,roleDescription:S="draggable",tabIndex:y=0}=i??{},N=(u==null?void 0:u.id)===t,p=a.useContext(N?Bn:Jr),[C,j]=at(),[_,v]=at(),R=Lr(l,t),w=Ve(n);fe(()=>(h.set(t,{id:t,key:o,node:C,activatorNode:_,data:w}),()=>{const T=h.get(t);T&&T.key===o&&h.delete(t)}),[h,t]);const D=a.useMemo(()=>({role:b,tabIndex:y,"aria-disabled":s,"aria-pressed":N&&b===yn?!0:void 0,"aria-roledescription":S,"aria-describedby":m.draggable}),[s,b,y,N,S,m.draggable]);return{active:u,activatorEvent:c,activeNodeRect:f,attributes:D,isDragging:N,listeners:s?void 0:R,node:C,over:x,setNodeRef:j,setActivatorNodeRef:v,transform:p}}function ei(){return a.useContext($n)}const ti="Droppable",ni={timeout:25};function si(e){let{data:t,disabled:n=!1,id:s,resizeObserverConfig:i}=e;const o=tt(ti),{active:l,dispatch:c,over:u,measureDroppableContainers:f}=a.useContext(pt),m=a.useRef({disabled:n}),h=a.useRef(!1),x=a.useRef(null),b=a.useRef(null),{disabled:S,updateMeasurementsFor:y,timeout:N}={...ni,...i},p=Ve(y??s),C=a.useCallback(()=>{if(!h.current){h.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{f(Array.isArray(p.current)?p.current:[p.current]),b.current=null},N)},[N]),j=mt({callback:C,disabled:S||!l}),_=a.useCallback((D,T)=>{j&&(T&&(j.unobserve(T),h.current=!1),D&&j.observe(D))},[j]),[v,R]=at(_),w=Ve(t);return a.useEffect(()=>{!j||!v.current||(j.disconnect(),h.current=!1,j.observe(v.current))},[v,j]),a.useEffect(()=>(c({type:q.RegisterDroppable,element:{id:s,key:o,disabled:n,node:v,rect:x,data:w}}),()=>c({type:q.UnregisterDroppable,key:o,id:s})),[s]),a.useEffect(()=>{n!==m.current.disabled&&(c({type:q.SetDroppableDisabled,id:s,key:o,disabled:n}),m.current.disabled=n)},[s,o,n,c]),{active:l,rect:x,isOver:(u==null?void 0:u.id)===s,node:v,over:u,setNodeRef:R}}function Kt(e,t,n){const s=e.slice();return s.splice(n<0?s.length+n:n,0,s.splice(t,1)[0]),s}function ri(e,t){return e.reduce((n,s,i)=>{const o=t.get(s);return o&&(n[i]=o),n},Array(e.length))}function it(e){return e!==null&&e>=0}function ii(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function oi(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const Wt=e=>{let{rects:t,activeIndex:n,overIndex:s,index:i}=e;const o=Kt(t,s,n),l=t[i],c=o[i];return!c||!l?null:{x:c.left-l.left,y:c.top-l.top,scaleX:c.width/l.width,scaleY:c.height/l.height}},qn="Sortable",Un=Z.createContext({activeIndex:-1,containerId:qn,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Wt,disabled:{draggable:!1,droppable:!1}});function ai(e){let{children:t,id:n,items:s,strategy:i=Wt,disabled:o=!1}=e;const{active:l,dragOverlay:c,droppableRects:u,over:f,measureDroppableContainers:m}=ei(),h=tt(qn,n),x=c.rect!==null,b=a.useMemo(()=>s.map(R=>typeof R=="object"&&"id"in R?R.id:R),[s]),S=l!=null,y=l?b.indexOf(l.id):-1,N=f?b.indexOf(f.id):-1,p=a.useRef(b),C=!ii(b,p.current),j=N!==-1&&y===-1||C,_=oi(o);fe(()=>{C&&S&&m(b)},[C,b,S,m]),a.useEffect(()=>{p.current=b},[b]);const v=a.useMemo(()=>({activeIndex:y,containerId:h,disabled:_,disableTransforms:j,items:b,overIndex:N,useDragOverlay:x,sortedRects:ri(b,u),strategy:i}),[y,h,_.draggable,_.droppable,j,b,N,u,x,i]);return Z.createElement(Un.Provider,{value:v},t)}const li=e=>{let{id:t,items:n,activeIndex:s,overIndex:i}=e;return Kt(n,s,i).indexOf(t)},ci=e=>{let{containerId:t,isSorting:n,wasDragging:s,index:i,items:o,newIndex:l,previousItems:c,previousContainerId:u,transition:f}=e;return!f||!s||c!==o&&i===l?!1:n?!0:l!==i&&t===u},di={duration:200,easing:"ease"},Xn="transform",ui=Je.Transition.toString({property:Xn,duration:0,easing:"linear"}),fi={roleDescription:"sortable"};function hi(e){let{disabled:t,index:n,node:s,rect:i}=e;const[o,l]=a.useState(null),c=a.useRef(n);return fe(()=>{if(!t&&n!==c.current&&s.current){const u=i.current;if(u){const f=ze(s.current,{ignoreTransform:!0}),m={x:u.left-f.left,y:u.top-f.top,scaleX:u.width/f.width,scaleY:u.height/f.height};(m.x||m.y)&&l(m)}}n!==c.current&&(c.current=n)},[t,n,s,i]),a.useEffect(()=>{o&&l(null)},[o]),o}function mi(e){let{animateLayoutChanges:t=ci,attributes:n,disabled:s,data:i,getNewIndex:o=li,id:l,strategy:c,resizeObserverConfig:u,transition:f=di}=e;const{items:m,containerId:h,activeIndex:x,disabled:b,disableTransforms:S,sortedRects:y,overIndex:N,useDragOverlay:p,strategy:C}=a.useContext(Un),j=pi(s,b),_=m.indexOf(l),v=a.useMemo(()=>({sortable:{containerId:h,index:_,items:m},...i}),[h,i,_,m]),R=a.useMemo(()=>m.slice(m.indexOf(l)),[m,l]),{rect:w,node:D,isOver:T,setNodeRef:F}=si({id:l,data:v,disabled:j.droppable,resizeObserverConfig:{updateMeasurementsFor:R,...u}}),{active:O,activatorEvent:P,activeNodeRect:z,attributes:$,setNodeRef:Ce,listeners:Se,isDragging:U,over:Re,setActivatorNodeRef:ae,transform:ge}=Zr({id:l,data:v,attributes:{...fi,...n},disabled:j.draggable}),d=ks(F,Ce),g=!!O,A=g&&!S&&it(x)&&it(N),k=!p&&U,B=k&&A?ge:null,H=A?B??(c??C)({rects:y,activeNodeRect:z,activeIndex:x,overIndex:N,index:_}):null,Q=it(x)&&it(N)?o({id:l,items:m,activeIndex:x,overIndex:N}):_,V=O==null?void 0:O.id,M=a.useRef({activeId:V,items:m,newIndex:Q,containerId:h}),Fe=m!==M.current.items,ce=t({active:O,containerId:h,isDragging:U,isSorting:g,id:l,index:_,items:m,newIndex:M.current.newIndex,previousItems:M.current.items,previousContainerId:M.current.containerId,transition:f,wasDragging:M.current.activeId!=null}),_e=hi({disabled:!ce,index:_,node:D,rect:w});return a.useEffect(()=>{g&&M.current.newIndex!==Q&&(M.current.newIndex=Q),h!==M.current.containerId&&(M.current.containerId=h),m!==M.current.items&&(M.current.items=m)},[g,Q,h,m]),a.useEffect(()=>{if(V===M.current.activeId)return;if(V!=null&&M.current.activeId==null){M.current.activeId=V;return}const Ee=setTimeout(()=>{M.current.activeId=V},50);return()=>clearTimeout(Ee)},[V]),{active:O,activeIndex:x,attributes:$,data:v,rect:w,index:_,newIndex:Q,items:m,isOver:T,isSorting:g,isDragging:U,listeners:Se,node:D,overIndex:N,over:Re,setNodeRef:d,setActivatorNodeRef:ae,setDroppableNodeRef:F,setDraggableNodeRef:Ce,transform:_e??H,transition:he()};function he(){if(_e||Fe&&M.current.newIndex===_)return ui;if(!(k&&!Bt(P)||!f)&&(g||ce))return Je.Transition.toString({...f,property:Xn})}}function pi(e,t){var n,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(s=e==null?void 0:e.droppable)!=null?s:t.droppable}}function dt(e){if(!e)return!1;const t=e.data.current;return!!(t&&"sortable"in t&&typeof t.sortable=="object"&&"containerId"in t.sortable&&"items"in t.sortable&&"index"in t.sortable)}const gi=[E.Down,E.Right,E.Up,E.Left],xi=(e,t)=>{let{context:{active:n,collisionRect:s,droppableRects:i,droppableContainers:o,over:l,scrollableAncestors:c}}=t;if(gi.includes(e.code)){if(e.preventDefault(),!n||!s)return;const u=[];o.getEnabled().forEach(h=>{if(!h||h!=null&&h.disabled)return;const x=i.get(h.id);if(x)switch(e.code){case E.Down:s.top<x.top&&u.push(h);break;case E.Up:s.top>x.top&&u.push(h);break;case E.Left:s.left>x.left&&u.push(h);break;case E.Right:s.left<x.left&&u.push(h);break}});const f=Js({active:n,collisionRect:s,droppableRects:i,droppableContainers:u,pointerCoordinates:null});let m=En(f,"id");if(m===(l==null?void 0:l.id)&&f.length>1&&(m=f[1].id),m!=null){const h=o.get(n.id),x=o.get(m),b=x?i.get(x.id):null,S=x==null?void 0:x.node.current;if(S&&b&&h&&x){const N=ht(S).some((R,w)=>c[w]!==R),p=Hn(h,x),C=vi(h,x),j=N||!p?{x:0,y:0}:{x:C?s.width-b.width:0,y:C?s.height-b.height:0},_={x:b.left,y:b.top};return j.x&&j.y?_:Ge(_,j)}}}};function Hn(e,t){return!dt(e)||!dt(t)?!1:e.data.current.sortable.containerId===t.data.current.sortable.containerId}function vi(e,t){return!dt(e)||!dt(t)||!Hn(e,t)?!1:e.data.current.sortable.index<t.data.current.sortable.index}function bi({image:e,index:t,onDelete:n}){const{attributes:s,listeners:i,setNodeRef:o,transform:l,transition:c,isDragging:u}=mi({id:e.id}),f={transform:Je.Transform.toString(l),transition:c,zIndex:u?10:1,opacity:u?.8:1};return r.jsxs("div",{ref:o,style:f,className:`relative group aspect-square rounded-lg overflow-hidden border ${u?"ring-2 ring-primary shadow-lg":""}`,children:[r.jsx("div",{...s,...i,className:"absolute top-1 left-1 z-10 p-1 bg-black/60 rounded cursor-grab active:cursor-grabbing opacity-0 group-hover:opacity-100 transition-opacity",children:r.jsx(Rs,{className:"w-4 h-4 text-white"})}),r.jsx("img",{src:e.image_url,alt:`Dish ${t+1}`,className:"w-full h-full object-cover",draggable:!1}),r.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:r.jsx(pe,{type:"button",variant:"destructive",size:"icon",className:"h-8 w-8",onClick:m=>{m.preventDefault(),m.stopPropagation(),n(e.id,e.image_url)},children:r.jsx(It,{className:"w-4 h-4"})})}),r.jsx("div",{className:"absolute bottom-1 right-1 bg-black/60 text-white text-xs px-1.5 py-0.5 rounded",children:t+1})]})}function yi({restaurantId:e}){const{t}=Nn(),n=a.useRef(null),{data:s=[],isLoading:i}=Is(e),o=As(),l=Ms(),c=Ts(),[u,f]=a.useState(null),[m,h]=a.useState([]),[x,b]=a.useState(!1),S=m.length>0?m:s,y=Ys(ln(Ht,{activationConstraint:{distance:8}}),ln(Ut,{coordinateGetter:xi})),N=v=>{const{active:R,over:w}=v;if(w&&R.id!==w.id){const D=S.findIndex(P=>P.id===R.id),T=S.findIndex(P=>P.id===w.id),F=Kt(S,D,T);h(F);const O=F.map((P,z)=>({id:P.id,sort_order:z}));c.mutate({images:O,restaurantId:e},{onSuccess:()=>{h([])},onError:()=>{h([])}})}},p=async v=>{var w;const R=(w=v.target.files)==null?void 0:w[0];R&&(R.size>5*1024*1024||R.type.startsWith("image/")&&(await o.mutateAsync({restaurantId:e,file:R}),n.current&&(n.current.value="")))},C=async()=>{if(!u||x)return;const{id:v,url:R}=u;b(!0);try{await l.mutateAsync({imageId:v,restaurantId:e,imageUrl:R}),f(null)}catch(w){console.error("Delete failed:",w)}finally{b(!1)}},j=v=>{!v&&!x&&f(null)},_=S.length<10;return r.jsxs(je,{children:[r.jsxs(ns,{className:"pb-3",children:[r.jsxs(ss,{className:"text-lg flex items-center gap-2",children:[r.jsx(Cn,{className:"w-5 h-5"}),t("dishImages.title")]}),r.jsxs(rs,{children:[t("dishImages.description",{current:S.length,max:10}),S.length>1&&r.jsx("span",{className:"block mt-1 text-xs",children:t("dishImages.dragToReorder")})]})]}),r.jsxs(De,{children:[i?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx(bt,{className:"w-6 h-6 animate-spin"})}):r.jsxs("div",{className:"space-y-4",children:[S.length>0&&r.jsx(Gr,{sensors:y,collisionDetection:Gs,onDragEnd:N,children:r.jsx(ai,{items:S.map(v=>v.id),strategy:Wt,children:r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:S.map((v,R)=>r.jsx(bi,{image:v,index:R,onDelete:(w,D)=>f({id:w,url:D})},v.id))})})}),_&&r.jsxs("div",{children:[r.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:p,disabled:o.isPending}),r.jsxs(pe,{type:"button",variant:"outline",className:"w-full",onClick:()=>{var v;return(v=n.current)==null?void 0:v.click()},disabled:o.isPending,children:[o.isPending?r.jsx(bt,{className:"w-4 h-4 mr-2 animate-spin"}):r.jsx(At,{className:"w-4 h-4 mr-2"}),t("dishImages.upload")]})]}),!_&&r.jsx("p",{className:"text-sm text-muted-foreground text-center",children:t("dishImages.maxReached")})]}),r.jsx(is,{open:!!u,onOpenChange:j,children:r.jsx(os,{onClick:v=>v.stopPropagation(),onKeyDown:v=>{v.key==="Enter"&&(v.preventDefault(),v.stopPropagation())},children:r.jsxs("form",{onSubmit:v=>v.preventDefault(),children:[r.jsxs(as,{children:[r.jsx(ls,{children:t("dishImages.deleteConfirmTitle")}),r.jsx(cs,{children:t("dishImages.deleteConfirmDescription")})]}),r.jsxs(ds,{className:"mt-4",children:[r.jsx(pe,{type:"button",variant:"outline",onClick:v=>{v.preventDefault(),v.stopPropagation(),x||f(null)},disabled:x,children:t("common.cancel")}),r.jsxs(pe,{type:"button",variant:"destructive",onClick:v=>{v.preventDefault(),v.stopPropagation(),C()},disabled:x,children:[x?r.jsx(bt,{className:"w-4 h-4 mr-2 animate-spin"}):null,t("common.delete")]})]})]})})})]})]})}const wi=Ns({name:Y().min(1,G.t("validation.nameRequired")),name_en:Y().min(1,G.t("validation.nameRequired")),name_pt:Y().min(1,G.t("validation.nameRequired")),key_id:Y().optional(),type:wt(Y()).min(1,G.t("validation.typeRequired")).max(3,G.t("validation.typeMaximum")),type_en:wt(Y()).min(1,G.t("validation.typeRequired")).max(3,G.t("validation.typeMaximum")),type_pt:wt(Y()).min(1,G.t("validation.typeRequired")).max(3,G.t("validation.typeMaximum")),description:Y().optional(),description_en:Y().optional(),description_pt:Y().optional(),announcement_zh:Y().optional(),announcement_en:Y().optional(),announcement_pt:Y().optional(),address:Y().min(1,G.t("validation.addressRequired")),lat:rn(),lng:rn(),phone:Y().optional(),website_url:Y().optional(),show_website_button:on().default(!0),show_dish_gallery:on().default(!0)}),wn=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];function Oi({restaurant:e,trigger:t}){const{t:n}=Nn(),{toast:s}=us(),i=ut(),{isAdmin:o}=fs(),[l,c]=a.useState(!1),[u,f]=a.useState(null),[m,h]=a.useState((e==null?void 0:e.image_url)||null),[x,b]=a.useState(!1),S=a.useRef(null),y=a.useRef(null),N=a.useRef(null),[p,C]=a.useState(()=>{const d={};return wn.forEach(g=>{d[g]={open:"12:00",close:"23:00",closed:!1,splitShift:!1,open2:"19:00",close2:"23:00"}}),e!=null&&e.opening_hours?{...d,...e.opening_hours}:d}),[j,_]=a.useState(()=>e!=null&&e.type&&Array.isArray(e.type)?e.type.map((d,g)=>{var A,k;return{zh:d,en:((A=e.type_en)==null?void 0:A[g])||"",pt:((k=e.type_pt)==null?void 0:k[g])||""}}):[{zh:"",en:"",pt:""}]),{register:v,handleSubmit:R,formState:{errors:w},setValue:D,watch:T}=ws({resolver:Cs(wi),defaultValues:e?{name:e.name,name_en:e.name_en||"",name_pt:e.name_pt||"",key_id:e.key_id||"",type:Array.isArray(e.type)?e.type:[e.type],type_en:Array.isArray(e.type_en)?e.type_en:e.type_en?[e.type_en]:[""],type_pt:Array.isArray(e.type_pt)?e.type_pt:e.type_pt?[e.type_pt]:[""],description:e.description||"",description_en:e.description_en||"",description_pt:e.description_pt||"",announcement_zh:e.announcement_zh||"",announcement_en:e.announcement_en||"",announcement_pt:e.announcement_pt||"",address:e.address,lat:typeof e.lat=="number"&&!isNaN(e.lat)?e.lat:38.7223,lng:typeof e.lng=="number"&&!isNaN(e.lng)?e.lng:-9.1393,phone:e.phone||"",website_url:e.website_url||"",show_website_button:e.show_website_button??!0,show_dish_gallery:e.show_dish_gallery??!0}:{name:"",name_en:"",name_pt:"",key_id:"",type:[""],type_en:[""],type_pt:[""],description:"",description_en:"",description_pt:"",announcement_zh:"",announcement_en:"",announcement_pt:"",address:"",lat:38.7223,lng:-9.1393,phone:"",website_url:"",show_website_button:!0,show_dish_gallery:!0}}),F=()=>{j.length<3&&_([...j,{zh:"",en:"",pt:""}])},O=d=>{j.length>1&&_(j.filter((g,A)=>A!==d))},P=(d,g,A)=>{const k=[...j];k[d][g]=A,_(k),D("type",k.map(B=>B.zh).filter(Boolean)),D("type_en",k.map(B=>B.en).filter(Boolean)),D("type_pt",k.map(B=>B.pt).filter(Boolean))},z=T("lat"),$=T("lng"),Ce=T("show_website_button"),Se=T("show_dish_gallery"),U=(d,g)=>typeof d=="number"&&typeof g=="number"&&!isNaN(d)&&!isNaN(g)&&isFinite(d)&&isFinite(g);a.useEffect(()=>{if(!l){y.current&&(y.current.remove(),y.current=null,N.current=null);return}if(y.current)return;const d="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g",A=setTimeout(()=>{if(!S.current){console.error("Map container not found");return}try{Nt.accessToken=d;const k=U(z,$)?$:-9.1393,B=U(z,$)?z:38.7223;y.current=new Nt.Map({container:S.current,style:"mapbox://styles/mapbox/light-v11",center:[k,B],zoom:15}),y.current.scrollZoom.disable(),y.current.on("load",()=>{y.current&&(U(z,$)&&(N.current=new Nt.Marker({draggable:!0}).setLngLat([$,z]).addTo(y.current)),N.current.on("dragend",()=>{const H=N.current.getLngLat();D("lng",H.lng),D("lat",H.lat)}),setTimeout(()=>{var H;(H=y.current)==null||H.resize()},100))});const J=H=>{var Q,V;H.ctrlKey||H.metaKey?(Q=y.current)==null||Q.scrollZoom.enable():(V=y.current)==null||V.scrollZoom.disable()};S.current.addEventListener("wheel",J),y.current.on("click",H=>{var M;const{lng:Q,lat:V}=H.lngLat;D("lng",Q),D("lat",V),(M=N.current)==null||M.setLngLat([Q,V])}),y.current.on("error",H=>{console.error("Map error:",H)})}catch(k){console.error("Failed to initialize map:",k)}},500);return()=>{clearTimeout(A)}},[l,z,$]),a.useEffect(()=>{N.current&&y.current&&U(z,$)&&(N.current.setLngLat([$,z]),y.current.setCenter([$,z]))},[z,$]);const Re=d=>{var A;const g=(A=d.target.files)==null?void 0:A[0];if(g){f(g);const k=new FileReader;k.onloadend=()=>{h(k.result)},k.readAsDataURL(g)}},ae=async()=>{if(!u)return(e==null?void 0:e.image_url)||null;const d=u.name.split(".").pop(),A=`${`${Math.random()}.${d}`}`,{error:k}=await re.storage.from("restaurant-images").upload(A,u);if(k)throw k;const{data:{publicUrl:B}}=re.storage.from("restaurant-images").getPublicUrl(A);return B},ge=async d=>{b(!0);try{const{data:{user:g}}=await re.auth.getUser();if(!g)throw new Error("Not authenticated");const A=await ae(),k={name:d.name,name_en:d.name_en,name_pt:d.name_pt,key_id:d.key_id||null,type:d.type,type_en:d.type_en,type_pt:d.type_pt,description:d.description||null,description_en:d.description_en||null,description_pt:d.description_pt||null,announcement_zh:d.announcement_zh||null,announcement_en:d.announcement_en||null,announcement_pt:d.announcement_pt||null,address:d.address,lat:d.lat,lng:d.lng,phone:d.phone||null,website_url:d.website_url||null,show_website_button:d.show_website_button,show_dish_gallery:d.show_dish_gallery,image_url:A,opening_hours:p};if(e){const{error:B}=await re.from("restaurants").update({...k,updated_by:g.id}).eq("id",e.id);if(B)throw B;s({title:n("common.success"),description:n("admin.restaurantUpdated")})}else{const{error:B}=await re.from("restaurants").insert([{...k,created_by:g.id}]);if(B)throw B;s({title:n("common.success"),description:n("admin.restaurantCreated")})}i.invalidateQueries({queryKey:["restaurants"]}),c(!1)}catch(g){s({title:n("common.error"),description:g.message,variant:"destructive"})}finally{b(!1)}};return r.jsxs(hs,{open:l,onOpenChange:c,children:[r.jsx(ms,{asChild:!0,children:t}),r.jsxs(ps,{className:"max-w-[95vw] sm:max-w-6xl max-h-[95vh] overflow-hidden flex flex-col p-0",children:[r.jsxs(gs,{className:"px-6 pt-6 pb-4 border-b bg-muted/30",children:[r.jsxs(xs,{className:"text-2xl flex items-center gap-2",children:[r.jsx(nn,{className:"w-6 h-6 text-primary"}),n(e?"admin.editRestaurant":"admin.addRestaurant")]}),r.jsx(vs,{className:"text-base",children:n(e?"admin.editRestaurantDetails":"admin.createRestaurantWithInfo")})]}),r.jsx(bs,{className:"px-6 h-[calc(95vh-220px)]",children:r.jsxs("form",{onSubmit:R(ge),className:"space-y-6 py-6",children:[r.jsx(je,{className:"border-primary/20 bg-gradient-to-br from-background to-muted/20",children:r.jsxs(De,{className:"p-6",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[r.jsx(At,{className:"w-5 h-5 text-primary"}),n("admin.restaurantImage")]}),r.jsxs("div",{className:"flex items-center gap-6",children:[m&&r.jsxs("div",{className:"relative group",children:[r.jsx("img",{src:m,alt:"Preview",className:"w-40 h-40 object-cover rounded-lg shadow-lg ring-2 ring-primary/20 transition-transform duration-200 group-hover:scale-105"}),r.jsx(pe,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-8 w-8 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{f(null),h(null)},children:r.jsx(It,{className:"h-4 w-4"})})]}),r.jsxs(I,{htmlFor:"image-upload",className:"cursor-pointer",children:[r.jsxs("div",{className:"flex flex-col items-center gap-3 px-8 py-6 border-2 border-dashed border-primary/30 rounded-lg hover:border-primary hover:bg-primary/5 transition-all duration-200",children:[r.jsx(At,{className:"h-8 w-8 text-primary"}),r.jsxs("div",{className:"text-center",children:[r.jsx("p",{className:"font-medium text-sm",children:n("admin.uploadImage")}),r.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:n("admin.imageMaxSize")})]})]}),r.jsx(L,{id:"image-upload",type:"file",accept:"image/*",className:"hidden",onChange:Re})]})]})]})}),(e==null?void 0:e.id)&&r.jsx(je,{className:"border-primary/20",children:r.jsxs(De,{className:"p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(Cn,{className:"w-5 h-5 text-primary"}),n("admin.dishGallery")]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{htmlFor:"show-dish-gallery",className:"text-sm text-muted-foreground",children:n("admin.showDishGallery")}),r.jsx(js,{id:"show-dish-gallery",checked:Se,onCheckedChange:d=>D("show_dish_gallery",d)})]})]}),r.jsx(yi,{restaurantId:e.id})]})}),r.jsx(je,{className:"border-primary/20",children:r.jsxs(De,{className:"p-6",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2 mb-4",children:[r.jsx(sn,{className:"w-5 h-5 text-primary"}),n("admin.multilingualContent")]}),r.jsxs(Ds,{defaultValue:"zh",className:"w-full",children:[r.jsxs(Ss,{className:"grid w-full grid-cols-3 mb-6",children:[r.jsxs(Ct,{value:"zh",className:"gap-2",children:[" ",n("admin.chinese")]}),r.jsxs(Ct,{value:"en",className:"gap-2",children:[" ",n("admin.english")]}),r.jsxs(Ct,{value:"pt",className:"gap-2",children:[" ",n("admin.portuguese")]})]}),r.jsxs(jt,{value:"zh",className:"space-y-4 mt-0",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"name",className:"text-sm font-medium",children:n("admin.restaurantName")}),r.jsx(L,{id:"name",...v("name"),placeholder:n("admin.enterRestaurantName"),className:"text-base"}),w.name&&r.jsx("p",{className:"text-sm text-destructive",children:w.name.message})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx(I,{className:"text-sm font-medium",children:n("admin.restaurantType")}),j.length<3&&r.jsx(pe,{type:"button",variant:"outline",size:"sm",onClick:F,children:n("admin.addType")})]}),j.map((d,g)=>r.jsxs("div",{className:"flex gap-2 items-center",children:[r.jsx(L,{placeholder:n("admin.typeExample"),value:d.zh,onChange:A=>P(g,"zh",A.target.value)}),r.jsx(pe,{type:"button",variant:"ghost",size:"icon",onClick:()=>O(g),disabled:j.length===1,children:r.jsx(It,{className:"h-4 w-4"})})]},g)),w.type&&r.jsx("p",{className:"text-sm text-destructive",children:w.type.message})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"description",className:"text-sm font-medium",children:n("admin.description")}),r.jsx(Dt,{value:T("description")||"",onChange:d=>D("description",d),placeholder:n("admin.enterDescription")})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"announcement_zh",className:"text-sm font-medium",children:n("admin.announcement")}),r.jsx(yt,{id:"announcement_zh",...v("announcement_zh"),rows:2,placeholder:n("admin.enterAnnouncement")}),r.jsx("p",{className:"text-xs text-muted-foreground",children:n("admin.announcementHint")})]})]}),r.jsxs(jt,{value:"en",className:"space-y-4 mt-0",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"name_en",className:"text-sm font-medium",children:"Restaurant Name"}),r.jsx(L,{id:"name_en",...v("name_en"),placeholder:"Enter restaurant name...",className:"text-base"}),w.name_en&&r.jsx("p",{className:"text-sm text-destructive",children:w.name_en.message})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(I,{className:"text-sm font-medium",children:"Restaurant Types (1-3 tags)"}),j.map((d,g)=>r.jsx("div",{className:"flex gap-2 items-center",children:r.jsx(L,{placeholder:"e.g. Cantonese",value:d.en,onChange:A=>P(g,"en",A.target.value)})},g))]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"description_en",className:"text-sm font-medium",children:"Description"}),r.jsx(Dt,{value:T("description_en")||"",onChange:d=>D("description_en",d),placeholder:"Enter restaurant description..."})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"announcement_en",className:"text-sm font-medium",children:"Announcement"}),r.jsx(yt,{id:"announcement_en",...v("announcement_en"),rows:2,placeholder:"Enter announcement (optional)..."}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Display important notices at top of restaurant page"})]})]}),r.jsxs(jt,{value:"pt",className:"space-y-4 mt-0",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"name_pt",className:"text-sm font-medium",children:"Nome do Restaurante"}),r.jsx(L,{id:"name_pt",...v("name_pt"),placeholder:"Digite o nome do restaurante...",className:"text-base"}),w.name_pt&&r.jsx("p",{className:"text-sm text-destructive",children:w.name_pt.message})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx(I,{className:"text-sm font-medium",children:"Tipos de Restaurante (1-3 tags)"}),j.map((d,g)=>r.jsx("div",{className:"flex gap-2 items-center",children:r.jsx(L,{placeholder:"ex: Cantonesa",value:d.pt,onChange:A=>P(g,"pt",A.target.value)})},g))]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"description_pt",className:"text-sm font-medium",children:"Descrio"}),r.jsx(Dt,{value:T("description_pt")||"",onChange:d=>D("description_pt",d),placeholder:"Digite a descrio do restaurante..."})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"announcement_pt",className:"text-sm font-medium",children:"Anncio"}),r.jsx(yt,{id:"announcement_pt",...v("announcement_pt"),rows:2,placeholder:"Digite o anncio (opcional)..."}),r.jsx("p",{className:"text-xs text-muted-foreground",children:"Exibir avisos importantes no topo da pgina do restaurante"})]})]})]})]})}),r.jsx(je,{className:"border-primary/20",children:r.jsxs(De,{className:"p-6 space-y-4",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(rt,{className:"w-5 h-5 text-primary"}),n("admin.locationAndContact")]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs(I,{htmlFor:"address",className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(rt,{className:"w-4 h-4"}),n("admin.address")]}),r.jsx(L,{id:"address",...v("address"),placeholder:n("admin.enterAddress")}),w.address&&r.jsx("p",{className:"text-sm text-destructive",children:w.address.message})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs(I,{htmlFor:"phone",className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(ys,{className:"w-4 h-4"}),n("admin.phone")]}),r.jsx(L,{id:"phone",...v("phone"),placeholder:"+351..."})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs(I,{htmlFor:"website_url",className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(sn,{className:"w-4 h-4"}),n("admin.website")]}),r.jsx(L,{id:"website_url",...v("website_url"),placeholder:"https://",readOnly:!o,disabled:!o,className:o?"":"bg-muted cursor-not-allowed"}),!o&&r.jsx("p",{className:"text-xs text-muted-foreground",children:n("admin.websiteReadOnly")})]}),o&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs(I,{htmlFor:"key_id",className:"text-sm font-medium flex items-center gap-2",children:[r.jsx(_s,{className:"w-4 h-4"}),"Key ID (API)"]}),r.jsx(L,{id:"key_id",...v("key_id"),placeholder:": saldanha01"})]}),r.jsxs("div",{className:"flex items-center space-x-2 pt-8",children:[r.jsx(Ue,{id:"show_website_button",checked:Ce,onCheckedChange:d=>D("show_website_button",d)}),r.jsx(I,{htmlFor:"show_website_button",className:"cursor-pointer text-sm",children:n("admin.showWebsiteButton")})]})]})]})}),r.jsx(je,{className:"border-primary/20",children:r.jsxs(De,{className:"p-6 space-y-4",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(rt,{className:"w-5 h-5 text-primary"}),n("admin.location")]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"lat",className:"text-sm font-medium",children:n("admin.latitude")}),r.jsx(L,{id:"lat",type:"number",step:"any",...v("lat",{valueAsNumber:!0})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(I,{htmlFor:"lng",className:"text-sm font-medium",children:n("admin.longitude")}),r.jsx(L,{id:"lng",type:"number",step:"any",...v("lng",{valueAsNumber:!0})})]})]}),r.jsx("div",{ref:S,className:"h-96 w-full rounded-lg border-2 border-primary/20 shadow-sm",style:{minHeight:"384px"}}),r.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[r.jsx(rt,{className:"w-4 h-4"}),n("admin.clickOrDragToSetLocation")]})]})}),r.jsx(je,{className:"border-primary/20 overflow-hidden",children:r.jsxs(De,{className:"p-3 md:p-6 space-y-4",children:[r.jsxs(I,{className:"text-base font-semibold flex items-center gap-2",children:[r.jsx(Es,{className:"w-5 h-5 text-primary"}),n("admin.openingHours")]}),r.jsx("div",{className:"space-y-2",children:wn.map(d=>r.jsxs("div",{className:"space-y-2 p-2 md:p-3 rounded-lg hover:bg-muted/50 transition-colors",children:[r.jsxs("div",{className:"md:hidden space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(I,{className:"capitalize font-semibold text-sm",children:n(`admin.day.${d}`)}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ue,{id:`split-mobile-${d}`,checked:p[d].splitShift,onCheckedChange:g=>C({...p,[d]:{...p[d],splitShift:g}}),disabled:p[d].closed,className:"h-4 w-4"}),r.jsx(I,{htmlFor:`split-mobile-${d}`,className:"cursor-pointer text-xs",children:""})]}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(Ue,{id:`closed-mobile-${d}`,checked:p[d].closed,onCheckedChange:g=>C({...p,[d]:{...p[d],closed:g}}),className:"h-4 w-4"}),r.jsx(I,{htmlFor:`closed-mobile-${d}`,className:"cursor-pointer text-xs",children:n("admin.closed")})]})]})]}),!p[d].closed&&r.jsx("div",{className:"space-y-1.5",children:p[d].splitShift?r.jsxs("div",{className:"space-y-1.5",children:[r.jsxs("div",{className:"grid grid-cols-[32px_1fr_12px_1fr] gap-1 items-center",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:""}),r.jsx(L,{type:"time",value:p[d].open,onChange:g=>C({...p,[d]:{...p[d],open:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"}),r.jsx("span",{className:"text-muted-foreground text-xs text-center",children:"-"}),r.jsx(L,{type:"time",value:p[d].close,onChange:g=>C({...p,[d]:{...p[d],close:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"})]}),r.jsxs("div",{className:"grid grid-cols-[32px_1fr_12px_1fr] gap-1 items-center",children:[r.jsx("span",{className:"text-xs text-muted-foreground",children:""}),r.jsx(L,{type:"time",value:p[d].open2||"19:00",onChange:g=>C({...p,[d]:{...p[d],open2:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"}),r.jsx("span",{className:"text-muted-foreground text-xs text-center",children:"-"}),r.jsx(L,{type:"time",value:p[d].close2||"23:00",onChange:g=>C({...p,[d]:{...p[d],close2:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"})]})]}):r.jsxs("div",{className:"grid grid-cols-[1fr_12px_1fr] gap-1 items-center",children:[r.jsx(L,{type:"time",value:p[d].open,onChange:g=>C({...p,[d]:{...p[d],open:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"}),r.jsx("span",{className:"text-muted-foreground text-xs text-center",children:"-"}),r.jsx(L,{type:"time",value:p[d].close,onChange:g=>C({...p,[d]:{...p[d],close:g.target.value}}),className:"h-8 text-xs px-2 min-w-0"})]})})]}),r.jsxs("div",{className:"hidden md:block",children:[r.jsxs("div",{className:"grid grid-cols-[120px_1fr_auto] gap-4 items-center",children:[r.jsx(I,{className:"capitalize font-semibold",children:n(`admin.day.${d}`)}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Ue,{id:`split-${d}`,checked:p[d].splitShift,onCheckedChange:g=>C({...p,[d]:{...p[d],splitShift:g}}),disabled:p[d].closed}),r.jsx(I,{htmlFor:`split-${d}`,className:"cursor-pointer text-sm",children:""})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(Ue,{id:`closed-${d}`,checked:p[d].closed,onCheckedChange:g=>C({...p,[d]:{...p[d],closed:g}})}),r.jsx(I,{htmlFor:`closed-${d}`,className:"cursor-pointer",children:n("admin.closed")})]})]}),!p[d].closed&&r.jsx("div",{className:"ml-[120px] space-y-2 mt-2",children:p[d].splitShift?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),r.jsx(L,{type:"time",value:p[d].open,onChange:g=>C({...p,[d]:{...p[d],open:g.target.value}}),className:"w-32"}),r.jsx("span",{className:"text-muted-foreground",children:"-"}),r.jsx(L,{type:"time",value:p[d].close,onChange:g=>C({...p,[d]:{...p[d],close:g.target.value}}),className:"w-32"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-muted-foreground w-12",children:""}),r.jsx(L,{type:"time",value:p[d].open2||"19:00",onChange:g=>C({...p,[d]:{...p[d],open2:g.target.value}}),className:"w-32"}),r.jsx("span",{className:"text-muted-foreground",children:"-"}),r.jsx(L,{type:"time",value:p[d].close2||"23:00",onChange:g=>C({...p,[d]:{...p[d],close2:g.target.value}}),className:"w-32"})]})]}):r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(L,{type:"time",value:p[d].open,onChange:g=>C({...p,[d]:{...p[d],open:g.target.value}}),className:"w-32"}),r.jsx("span",{className:"text-muted-foreground",children:"-"}),r.jsx(L,{type:"time",value:p[d].close,onChange:g=>C({...p,[d]:{...p[d],close:g.target.value}}),className:"w-32"})]})})]})]},d))})]})})]})}),r.jsxs("div",{className:"flex justify-end gap-2 px-6 py-4 border-t bg-muted/30",children:[r.jsx(pe,{type:"button",variant:"outline",onClick:()=>c(!1),children:n("common.cancel")}),r.jsxs(pe,{type:"submit",disabled:x,onClick:R(ge),className:"gap-2",children:[r.jsx(nn,{className:"w-4 h-4"}),n(x?"common.saving":"common.save")]})]})]})]})}export{Oi as R,Is as u};
