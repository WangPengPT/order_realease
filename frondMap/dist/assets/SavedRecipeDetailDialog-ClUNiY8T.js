import{p as L,r as d,j as e,ce as R,el as M,bc as U,bn as X,b4 as G,cC as S,bh as A,bG as P,a$ as V}from"./vendor-react-DImbKuZP.js";import{a as Y,q as j,D as Z,c as q,d as Q,e as W,C as z,S as K,E as ee,B as N,F as se}from"./index-_G3CuCzp.js";import{D as te,a as ae,b as ne,c as re}from"./drawer-CK8DetMs.js";import{S as E}from"./separator-8wE-3N0K.js";import{R as le}from"./RecipeCookingMode-B5DymqUo.js";const ie="https://tzdgqhwyzsxkxnncgzap.supabase.co/functions/v1/ai-recipe/generate-images",ue=({open:m,onOpenChange:T,recipe:s,recipeName:b,onSave:x,isSaving:w,isSaved:n,initialImageUrl:f})=>{const{t:a,i18n:y}=L(),$=Y(),[l,g]=d.useState("guided"),[v,u]=d.useState("overview"),[C,i]=d.useState(null),[F,c]=d.useState(!1),p=d.useRef(null);if(d.useEffect(()=>{if(!(!m||!s)){if(f){i(f),c(!1);return}if(s.image_url){i(s.image_url),c(!1);return}p.current!==s.recipe_name&&(p.current=s.recipe_name,c(!0),i(null),fetch(ie,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw"},body:JSON.stringify({recipes:[{recipe_name:s.recipe_name,recipe_name_en:s.recipe_name_en}]})}).then(t=>t.json()).then(t=>{const r=t.images?.[0]?.image_url||null;i(r)}).catch(()=>i(null)).finally(()=>c(!1)))}},[m,s,f]),!s)return null;const k=()=>y.language==="en"&&s.recipe_name_en?s.recipe_name_en:y.language==="pt"&&s.recipe_name_pt?s.recipe_name_pt:s.recipe_name,J=t=>{switch(t){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30";default:return"bg-muted text-muted-foreground"}},H=t=>{switch(t){case"easy":return a("recipe.difficulty.easy","简单");case"medium":return a("recipe.difficulty.medium","中等");case"hard":return a("recipe.difficulty.hard","困难");default:return t}},o=s.steps?.map((t,r)=>({order:t.order||r+1,description:t.description,image_url:void 0,image_urls:void 0}))||[],h=o.length>0,B=()=>{u("cooking")},_=t=>{t||(g("guided"),u("overview"),i(null),c(!1),p.current=null),T(t)},I=()=>e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>{g("guided"),u("overview")},className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${l==="guided"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(M,{className:"h-4 w-4"}),a("recipe.guidedMode","流程模式")]}),e.jsxs("button",{onClick:()=>g("full"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 ${l==="full"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(U,{className:"h-4 w-4"}),a("recipe.fullMode","完整模式")]})]})}),D=()=>e.jsx(z,{className:"overflow-hidden",children:e.jsx(le,{steps:o,onExit:()=>u("overview")})}),O=()=>e.jsxs(z,{className:"overflow-hidden",children:[e.jsx("div",{className:"relative w-full aspect-[16/9] bg-muted overflow-hidden",children:F?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"absolute inset-0 w-full h-full rounded-none"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-1.5 z-10",children:[e.jsx(X,{className:"h-4 w-4 text-primary animate-pulse"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("aiRecipe.generatingImage","AI 正在生成图片...")})]})]}):C?e.jsx("img",{src:C,alt:k(),className:"w-full h-full object-cover"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(G,{className:"h-10 w-10 text-muted-foreground/30"})})}),e.jsxs(ee,{className:"pb-3",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(N,{className:"bg-primary text-primary-foreground gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),a("recipe.badge","食谱")]})}),e.jsx("h2",{className:"text-xl font-bold",children:k()}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3",children:[s.cook_time&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.cook_time," ",a("recipe.minutes","分钟")]})]}),s.servings&&e.jsxs("div",{className:"flex items-center gap-1.5 text-sm text-muted-foreground",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",a("recipe.servingsUnit","人份")]})]}),s.difficulty&&e.jsxs(N,{variant:"outline",className:J(s.difficulty),children:[e.jsx(V,{className:"h-3 w-3 mr-1"}),H(s.difficulty)]})]})]}),e.jsxs(se,{className:"space-y-6",children:[s.introduction&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line",children:s.introduction}),e.jsx(E,{}),s.ingredients&&s.ingredients.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[a("recipe.ingredients","食材")," (",s.ingredients.length,")"]}),e.jsxs("div",{className:"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50",children:[e.jsx("span",{className:"flex-1",children:a("recipe.ingredientName","名称")}),e.jsx("span",{className:"w-24 text-right",children:a("recipe.amount","用量")})]}),e.jsx("ul",{className:"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50",children:s.ingredients.map((t,r)=>e.jsxs("li",{className:"flex items-center text-sm px-2 py-2",children:[e.jsx("span",{className:"flex-1 min-w-0 truncate",children:t.name}),e.jsxs("span",{className:"w-24 text-right text-muted-foreground shrink-0",children:[t.amount," ",t.unit]})]},r))})]}),l==="guided"&&h&&e.jsxs(j,{size:"lg",className:"w-full gap-2 h-14 text-lg",onClick:B,children:[e.jsx(M,{className:"h-6 w-6"}),a("recipe.startCooking","开始烹饪"),e.jsxs(N,{variant:"secondary",className:"ml-2",children:[o.length," ",a("recipe.stepsCount","步")]})]}),l==="full"&&h&&e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-sm mb-3",children:[a("recipe.steps","步骤")," (",o.length,")"]}),e.jsx("ol",{className:"space-y-4",children:o.map((t,r)=>e.jsxs("li",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold",children:t.order}),e.jsx("p",{className:"text-sm flex-1",children:t.description})]},r))})]})]})]})]});return $?e.jsx(te,{open:m,onOpenChange:_,children:e.jsxs(ae,{className:"max-h-[90vh]",children:[e.jsxs(ne,{className:"flex flex-row items-center justify-between",children:[e.jsx(re,{className:"line-clamp-1 flex-1",children:b}),x&&s&&e.jsxs(j,{variant:"ghost",size:"sm",className:`gap-1.5 shrink-0 ${n?"text-primary":""}`,onClick:()=>!n&&x(s),disabled:w||n,children:[e.jsx(R,{className:`h-4 w-4 ${n?"fill-primary":""}`}),n?a("aiRecipe.saved","已保存"):a("aiRecipe.save","保存")]})]}),e.jsx("div",{className:"px-4 pb-6 overflow-y-auto max-h-[78vh]",children:l==="guided"&&v==="cooking"&&h?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx(O,{})]})})]})}):e.jsx(Z,{open:m,onOpenChange:_,children:e.jsxs(q,{className:"max-w-lg max-h-[90vh] overflow-hidden flex flex-col p-0",children:[e.jsxs(Q,{className:"px-6 pt-6 pb-0 flex flex-row items-center justify-between",children:[e.jsx(W,{className:"line-clamp-1 flex-1",children:b}),x&&s&&e.jsxs(j,{variant:"ghost",size:"sm",className:`gap-1.5 shrink-0 ${n?"text-primary":""}`,onClick:()=>!n&&x(s),disabled:w||n,children:[e.jsx(R,{className:`h-4 w-4 ${n?"fill-primary":""}`}),n?a("aiRecipe.saved","已保存"):a("aiRecipe.save","保存")]})]}),e.jsx("div",{className:"overflow-y-auto px-6 pb-6 flex-1",children:l==="guided"&&v==="cooking"&&h?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx(O,{})]})})]})})};export{ue as S};
//# sourceMappingURL=SavedRecipeDetailDialog-ClUNiY8T.js.map
