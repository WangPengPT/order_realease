{"version":3,"mappings":"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","names":["ActivityFavoriteDialog","open","onOpenChange","activity","useTranslation","Dialog","jsxs","DialogContent","jsx","DialogHeader","DialogTitle","Badge","Heart","useFavorites","user","useAuth","useQuery","favorites","error","supabase","restaurantIds","f","restaurants","restaurantError","useUserComments","comments","c","activityIds","restaurantMap","r","activityMap","activities","a","comment","restaurant","useMerchantActivities","myRestaurants","useMerchantRestaurants","activityRestaurants","ar","item","COUNTRY_CODES","parsePhoneWithCode","fullPhone","country","EditProfileDialog","profile","t","navigate","useNavigate","isAdmin","useUserRole","setOpen","useState","displayName","setDisplayName","parsedPhone","phoneCode","setPhoneCode","phone","setPhone","isEditingPhone","setIsEditingPhone","avatarFile","setAvatarFile","avatarPreview","setAvatarPreview","showDeleteDialog","setShowDeleteDialog","showConfirmDialog","setShowConfirmDialog","deleteConfirmText","setDeleteConfirmText","isDeleting","setIsDeleting","prevOpenRef","useRef","useEffect","wasOpen","newParsedPhone","showEmailDialog","setShowEmailDialog","showNewEmailDialog","setShowNewEmailDialog","showConfirmUpdateDialog","setShowConfirmUpdateDialog","newEmail","setNewEmail","oldEmailCode","setOldEmailCode","newEmailCode","setNewEmailCode","oldEmailCodeSent","setOldEmailCodeSent","newEmailCodeSent","setNewEmailCodeSent","isUpdatingEmail","setIsUpdatingEmail","showPasswordDialog","setShowPasswordDialog","showNewPasswordDialog","setShowNewPasswordDialog","currentPassword","setCurrentPassword","newPassword","setNewPassword","confirmPassword","setConfirmPassword","useEmailForPassword","setUseEmailForPassword","passwordEmailCode","setPasswordEmailCode","passwordEmailCodeSent","setPasswordEmailCodeSent","isUpdatingPassword","setIsUpdatingPassword","passwordStrength","setPasswordStrength","oldEmailCodeInputRef","newEmailCodeInputRef","passwordEmailCodeInputRef","updateProfile","useUpdateProfile","uploadAvatar","useUploadAvatar","handleAvatarChange","e","file","handleSave","avatar_url","uploadedUrl","handleDeleteAccount","toast","resolve","handleSendOldEmailCode","handleVerifyOldEmail","data","handleSendNewEmailCode","handleVerifyNewEmail","handleUpdateEmail","session","checkPasswordStrength","password","strength","handleVerifyPassword","createClient","__vitePreload","tempClient","handleSendPasswordEmailCode","handleVerifyPasswordEmail","handleUpdatePassword","DialogTrigger","Button","Settings","DialogDescription","Avatar","AvatarImage","AvatarFallback","Input","Upload","Label","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Mail","Lock","Trash2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Fragment","ADDRESS_LABELS","Home","Briefcase","Building","MapPin","COUNTRIES","AddressForm","initialData","onSubmit","onCancel","isLoading","isEdit","formData","setFormData","handleSubmit","value","label","Checkbox","checked","DialogFooter","AddressCard","address","onEdit","onDelete","onSetDefault","isSettingDefault","canDelete","labelConfig","l","LabelIcon","Star","Phone","Edit","AlertDialogTrigger","AddressManagement","addresses","useUserAddresses","useProfile","createAddress","useCreateAddress","updateAddress","useUpdateAddress","deleteAddress","useDeleteAddress","setDefaultAddress","useSetDefaultAddress","isAddDialogOpen","setIsAddDialogOpen","editingAddress","setEditingAddress","pendingAddressData","setPendingAddressData","showPhoneConfirm","setShowPhoneConfirm","profileHasNoPhone","handleCreate","handleConfirmCreateWithPhone","handleCancelPhoneConfirm","handleUpdate","handleDelete","id","handleSetDefault","Card","CardHeader","CardTitle","CardContent","hasAddresses","CardDescription","Plus","CouponDetailDialog","coupon","getLocalizedField","useLocalizedContent","showQrCode","setShowQrCode","template","code","isUsed","Ticket","ScrollArea","Separator","QRCodeSVG","QrCode","Tag","Clock","format","Calendar","Link","useBookingRecords","useDeliveryRecords","BookingRecords","records","getStatusBadge","status","CalendarDays","record","restaurantName","Store","Users","DeliveryRecords","Truck","formSchema","z.object","z.string","ApplyInvitationCodeDialog","mode","existingData","applyMutation","useApplyInvitationCode","reapplyMutation","useReapplyInvitationCode","form","useForm","zodResolver","values","Form","FormField","field","FormItem","FormLabel","FormControl","FormMessage","Textarea","Loader2","InvitationCodeHelpDialog","ClipboardList","CheckCircle","Gift","getDateLocale","lang","zhCN","pt","enUS","InvitationCodeSection","isMobile","i18n","invitationCode","useMyInvitationCode","codeHistory","useMyInvitationCodeHistory","applyDialogOpen","setApplyDialogOpen","helpDialogOpen","setHelpDialogOpen","copied","setCopied","historyOpen","setHistoryOpen","handleCopy","pastCodes","reason","XCircle","renderHistorySection","Collapsible","CollapsibleTrigger","History","ChevronDown","CollapsibleContent","formatDistanceToNow","Skeleton","HelpCircle","RefreshCw","Check","Copy","UserPlus","CommentItem","memo","isFailed","isPending","getRiskReasonText","labels","AlertCircle","FavoriteRestaurantItem","restaurantType","ActivitySubscriptionItem","subscription","dialogOpen","setDialogOpen","MerchantActivityItem","activityGroup","UserCouponItem","detailsOpen","setDetailsOpen","Profile","useIsMobile","useEnvironment","profileLoading","favoritesLoading","commentsLoading","subscriptions","subscriptionsLoading","useSubscriptions","merchantActivities","merchantActivitiesLoading","userCoupons","couponsLoading","useUserCoupons","userPosts","postsLoading","useCommunityPosts","role","isMerchant","isSupervisor","siteSettings","useSiteSettings","isMerchantOrSupervisor","activeTab","setActiveTab","carouselApi","setCarouselApi","scrollPositions","setScrollPositions","visitedTabs","setVisitedTabs","tabs","User","MessageSquare","saveScrollPosition","tabValue","prev","restoreScrollPosition","savedPosition","handleSelect","index","newTab","handleTabClick","queryClient","useQueryClient","handleRefresh","useCallback","roleDisplay","PullToRefresh","Coins","PointsHistoryDialog","ShoppingBag","ActivityTermsAgreement","Carousel","CarouselContent","CarouselItem","Tabs","TabsList","TabsTrigger","TabsContent","FileText","post","PostGridCard","activityGroups","acc","participation","activityId","group","tab","Icon"],"ignoreList":[],"sources":["../../src/components/ActivityFavoriteDialog.tsx","../../src/hooks/useFavorites.ts","../../src/hooks/useUserComments.ts","../../src/hooks/useMerchantActivities.ts","../../src/components/EditProfileDialog.tsx","../../src/components/AddressManagement.tsx","../../src/components/CouponDetailDialog.tsx","../../src/hooks/useOrderRecords.ts","../../src/components/BookingRecords.tsx","../../src/components/DeliveryRecords.tsx","../../src/components/ApplyInvitationCodeDialog.tsx","../../src/components/InvitationCodeHelpDialog.tsx","../../src/components/InvitationCodeSection.tsx","../../src/pages/Profile.tsx"],"sourcesContent":["import { useTranslation } from \"react-i18next\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Heart } from \"lucide-react\";\r\n\r\ninterface ActivityFavoriteDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  activity: {\r\n    title: string;\r\n    image_url?: string | null;\r\n    content: string;\r\n  };\r\n}\r\n\r\nexport function ActivityFavoriteDialog({\r\n  open,\r\n  onOpenChange,\r\n  activity,\r\n}: ActivityFavoriteDialogProps) {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"text-lg font-semibold line-clamp-2\">\r\n            {activity.title}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4\">\r\n          {/* Favorited badge */}\r\n          <Badge variant=\"secondary\" className=\"flex items-center gap-1.5 w-fit\">\r\n            <Heart className=\"w-3.5 h-3.5 fill-primary text-primary\" />\r\n            {t(\"profile.activityFavorited\")}\r\n          </Badge>\r\n          \r\n          {/* Activity image */}\r\n          {activity.image_url && (\r\n            <div className=\"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30\">\r\n              <img\r\n                src={activity.image_url}\r\n                alt={activity.title}\r\n                className=\"w-full h-full object-cover\"\r\n              />\r\n            </div>\r\n          )}\r\n          \r\n          {/* Activity content - max 4 lines */}\r\n          <div \r\n            className=\"text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r\n              [&_span[style*='color']]:!text-inherit\"\r\n            dangerouslySetInnerHTML={{ __html: activity.content }}\r\n          />\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport const useFavorites = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"favorites-restaurants\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      const { data: favorites, error } = await supabase\r\n        .from(\"favorites\")\r\n        .select(\"restaurant_id\")\r\n        .eq(\"user_id\", user.id);\r\n\r\n      if (error) {\r\n        console.error(\"Error fetching favorites:\", error);\r\n        throw error;\r\n      }\r\n\r\n      if (!favorites || favorites.length === 0) return [];\r\n\r\n      const restaurantIds = favorites.map((f) => f.restaurant_id);\r\n\r\n      const { data: restaurants, error: restaurantError } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"*\")\r\n        .in(\"id\", restaurantIds)\r\n        .eq(\"visible\", true);\r\n\r\n      if (restaurantError) {\r\n        console.error(\"Error fetching favorite restaurants:\", restaurantError);\r\n        throw restaurantError;\r\n      }\r\n\r\n      return restaurants || [];\r\n    },\r\n    enabled: !!user,\r\n  });\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport const useUserComments = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"user-comments\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user) return [];\r\n\r\n      // Fetch all user comments including flagged ones\r\n      const { data: comments, error } = await supabase\r\n        .from(\"comments\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .is(\"parent_id\", null)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      if (!comments || comments.length === 0) return [];\r\n\r\n      // Collect unique target IDs by type\r\n      const restaurantIds = comments\r\n        .filter(c => c.target_type === \"restaurant\")\r\n        .map(c => c.target_id);\r\n      const activityIds = comments\r\n        .filter(c => c.target_type === \"activity\")\r\n        .map(c => c.target_id);\r\n\r\n      // Batch fetch restaurants\r\n      const restaurantMap = new Map<string, { name: string; name_en?: string; name_pt?: string }>();\r\n      if (restaurantIds.length > 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name, name_en, name_pt\")\r\n          .in(\"id\", restaurantIds);\r\n        \r\n        restaurants?.forEach(r => {\r\n          restaurantMap.set(r.id, { name: r.name, name_en: r.name_en || undefined, name_pt: r.name_pt || undefined });\r\n        });\r\n      }\r\n\r\n      // Batch fetch activities\r\n      const activityMap = new Map<string, { title_zh: string; title_en?: string; title_pt?: string }>();\r\n      if (activityIds.length > 0) {\r\n        const { data: activities } = await supabase\r\n          .from(\"activities\")\r\n          .select(\"id, title_zh, title_en, title_pt\")\r\n          .in(\"id\", activityIds);\r\n        \r\n        activities?.forEach(a => {\r\n          activityMap.set(a.id, { title_zh: a.title_zh, title_en: a.title_en, title_pt: a.title_pt });\r\n        });\r\n      }\r\n\r\n      // Map comments with target info\r\n      return comments.map(comment => {\r\n        if (comment.target_type === \"restaurant\") {\r\n          const restaurant = restaurantMap.get(comment.target_id);\r\n          return {\r\n            ...comment,\r\n            target_name: restaurant?.name || \"Unknown Restaurant\",\r\n            target_name_en: restaurant?.name_en,\r\n            target_name_pt: restaurant?.name_pt,\r\n          };\r\n        } else if (comment.target_type === \"activity\") {\r\n          const activity = activityMap.get(comment.target_id);\r\n          return {\r\n            ...comment,\r\n            target_name: activity?.title_zh || \"Unknown Activity\",\r\n            target_name_en: activity?.title_en,\r\n            target_name_pt: activity?.title_pt,\r\n          };\r\n        }\r\n        return comment;\r\n      });\r\n    },\r\n    enabled: !!user,\r\n    staleTime: 30000, // Cache for 30 seconds\r\n  });\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useMerchantRestaurants } from \"./useActivityParticipation\";\r\n\r\ninterface MerchantActivityParticipation {\r\n  activity_id: string;\r\n  restaurant_id: string;\r\n  restaurant_name: string;\r\n  restaurant_name_en: string | null;\r\n  restaurant_name_pt: string | null;\r\n  restaurant_address: string;\r\n  activity: {\r\n    id: string;\r\n    title_en: string;\r\n    title_zh: string;\r\n    title_pt: string;\r\n    content_en: string;\r\n    content_zh: string;\r\n    content_pt: string;\r\n    image_url: string | null;\r\n    start_date: string;\r\n    end_date: string | null;\r\n    created_at: string;\r\n  } | null;\r\n  created_at: string;\r\n}\r\n\r\nexport const useMerchantActivities = () => {\r\n  const { user } = useAuth();\r\n  const { data: myRestaurants = [] } = useMerchantRestaurants();\r\n\r\n  return useQuery({\r\n    queryKey: [\"merchantActivities\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user || myRestaurants.length === 0) return [];\r\n\r\n      const restaurantIds = myRestaurants.map(r => r.id);\r\n\r\n      // Get all activity_restaurants entries for merchant's restaurants\r\n      const { data: activityRestaurants, error } = await supabase\r\n        .from(\"activity_restaurants\")\r\n        .select(\"*\")\r\n        .in(\"restaurant_id\", restaurantIds)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      if (!activityRestaurants || activityRestaurants.length === 0) return [];\r\n\r\n      // Fetch restaurant details\r\n      const { data: restaurants } = await supabase\r\n        .from(\"restaurants\")\r\n        .select(\"id, name, name_en, name_pt, address\")\r\n        .in(\"id\", restaurantIds);\r\n\r\n      // Fetch activity details - only published activities (draft activities should be invisible to merchants)\r\n      const activityIds = [...new Set(activityRestaurants.map(ar => ar.activity_id))];\r\n      const { data: activities } = await supabase\r\n        .from(\"activities\")\r\n        .select(\"*\")\r\n        .in(\"id\", activityIds)\r\n        .eq(\"status\", \"published\");\r\n\r\n      // Combine data - filter out entries where activity is null (draft activities)\r\n      const result: MerchantActivityParticipation[] = activityRestaurants\r\n        .map(ar => {\r\n          const restaurant = restaurants?.find(r => r.id === ar.restaurant_id);\r\n          const activity = activities?.find(a => a.id === ar.activity_id);\r\n\r\n          return {\r\n            activity_id: ar.activity_id,\r\n            restaurant_id: ar.restaurant_id,\r\n            restaurant_name: restaurant?.name || \"\",\r\n            restaurant_name_en: restaurant?.name_en || null,\r\n            restaurant_name_pt: restaurant?.name_pt || null,\r\n            restaurant_address: restaurant?.address || \"\",\r\n            activity: activity || null,\r\n            created_at: ar.created_at,\r\n          };\r\n        })\r\n        .filter(item => item.activity !== null); // Remove draft activities\r\n\r\n      return result;\r\n    },\r\n    enabled: !!user && myRestaurants.length > 0,\r\n  });\r\n};\r\n","import { useState, useEffect, useRef } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from \"@/components/ui/dialog\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Settings, Upload, Trash2, Mail, Lock } from \"lucide-react\";\r\nimport { useUpdateProfile, useUploadAvatar } from \"@/hooks/useProfile\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\nconst COUNTRY_CODES = [\r\n  { code: \"+351\", country: \"Portugal\", flag: \"\" },\r\n  { code: \"+34\", country: \"Spain\", flag: \"\" },\r\n  { code: \"+33\", country: \"France\", flag: \"\" },\r\n  { code: \"+49\", country: \"Germany\", flag: \"\" },\r\n  { code: \"+39\", country: \"Italy\", flag: \"\" },\r\n  { code: \"+44\", country: \"UK\", flag: \"\" },\r\n  { code: \"+31\", country: \"Netherlands\", flag: \"\" },\r\n  { code: \"+32\", country: \"Belgium\", flag: \"\" },\r\n  { code: \"+86\", country: \"China\", flag: \"\" },\r\n  { code: \"+1\", country: \"USA/Canada\", flag: \"\" },\r\n  { code: \"+55\", country: \"Brazil\", flag: \"\" },\r\n];\r\n\r\n// Helper to parse phone with country code\r\nconst parsePhoneWithCode = (fullPhone: string | null | undefined) => {\r\n  if (!fullPhone) return { code: \"+351\", number: \"\" };\r\n  \r\n  // Try to match country code at the start\r\n  for (const country of COUNTRY_CODES) {\r\n    if (fullPhone.startsWith(country.code)) {\r\n      return { \r\n        code: country.code, \r\n        number: fullPhone.slice(country.code.length).trim() \r\n      };\r\n    }\r\n  }\r\n  \r\n  // If no match, return default code and full number\r\n  return { code: \"+351\", number: fullPhone };\r\n};\r\n\r\ninterface EditProfileDialogProps {\r\n  profile: {\r\n    display_name: string;\r\n    phone?: string | null;\r\n    avatar_url?: string | null;\r\n  };\r\n}\r\n\r\nconst EditProfileDialog = ({ profile }: EditProfileDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const { isAdmin } = useUserRole();\r\n  const [open, setOpen] = useState(false);\r\n  const [displayName, setDisplayName] = useState(profile.display_name);\r\n  \r\n  // Parse phone with country code\r\n  const parsedPhone = parsePhoneWithCode(profile.phone);\r\n  const [phoneCode, setPhoneCode] = useState(parsedPhone.code);\r\n  const [phone, setPhone] = useState(parsedPhone.number);\r\n  const [isEditingPhone, setIsEditingPhone] = useState(false);\r\n  \r\n  const [avatarFile, setAvatarFile] = useState<File | null>(null);\r\n  const [avatarPreview, setAvatarPreview] = useState(profile.avatar_url || \"\");\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\r\n  const [deleteConfirmText, setDeleteConfirmText] = useState(\"\");\r\n  const [isDeleting, setIsDeleting] = useState(false);\r\n\r\n  // Track previous open state to only sync when dialog first opens\r\n  const prevOpenRef = useRef(false);\r\n  \r\n  // Sync profile data only when dialog transitions from closed to open\r\n  useEffect(() => {\r\n    const wasOpen = prevOpenRef.current;\r\n    prevOpenRef.current = open;\r\n    \r\n    // Only sync data when dialog is opening (not when profile data changes while dialog is open)\r\n    if (open && !wasOpen) {\r\n      setDisplayName(profile.display_name);\r\n      const newParsedPhone = parsePhoneWithCode(profile.phone);\r\n      setPhoneCode(newParsedPhone.code);\r\n      setPhone(newParsedPhone.number);\r\n      setAvatarPreview(profile.avatar_url || \"\");\r\n      setAvatarFile(null);\r\n      setIsEditingPhone(false);\r\n    }\r\n  }, [open, profile.display_name, profile.phone, profile.avatar_url]);\r\n  \r\n  // Email change states\r\n  const [showEmailDialog, setShowEmailDialog] = useState(false);\r\n  const [showNewEmailDialog, setShowNewEmailDialog] = useState(false);\r\n  const [showConfirmUpdateDialog, setShowConfirmUpdateDialog] = useState(false);\r\n  const [newEmail, setNewEmail] = useState(\"\");\r\n  const [oldEmailCode, setOldEmailCode] = useState(\"\");\r\n  const [newEmailCode, setNewEmailCode] = useState(\"\");\r\n  const [oldEmailCodeSent, setOldEmailCodeSent] = useState(false);\r\n  const [newEmailCodeSent, setNewEmailCodeSent] = useState(false);\r\n  const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);\r\n\r\n  // Password change states\r\n  const [showPasswordDialog, setShowPasswordDialog] = useState(false);\r\n  const [showNewPasswordDialog, setShowNewPasswordDialog] = useState(false);\r\n  const [currentPassword, setCurrentPassword] = useState(\"\");\r\n  const [newPassword, setNewPassword] = useState(\"\");\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\r\n  const [useEmailForPassword, setUseEmailForPassword] = useState(false);\r\n  const [passwordEmailCode, setPasswordEmailCode] = useState(\"\");\r\n  const [passwordEmailCodeSent, setPasswordEmailCodeSent] = useState(false);\r\n  const [isUpdatingPassword, setIsUpdatingPassword] = useState(false);\r\n  const [passwordStrength, setPasswordStrength] = useState<'weak' | 'medium' | 'strong' | null>(null);\r\n\r\n  const oldEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n  const newEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n  const passwordEmailCodeInputRef = useRef<HTMLInputElement>(null);\r\n\r\n  const updateProfile = useUpdateProfile();\r\n  const uploadAvatar = useUploadAvatar();\r\n\r\n  // Auto-focus old email verification code input\r\n  useEffect(() => {\r\n    if (oldEmailCodeSent && oldEmailCodeInputRef.current) {\r\n      oldEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [oldEmailCodeSent]);\r\n\r\n  // Auto-focus new email verification code input\r\n  useEffect(() => {\r\n    if (newEmailCodeSent && newEmailCodeInputRef.current) {\r\n      newEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [newEmailCodeSent]);\r\n\r\n  // Auto-focus password email verification code input\r\n  useEffect(() => {\r\n    if (passwordEmailCodeSent && passwordEmailCodeInputRef.current) {\r\n      passwordEmailCodeInputRef.current.focus();\r\n    }\r\n  }, [passwordEmailCodeSent]);\r\n\r\n  const handleAvatarChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 2 * 1024 * 1024) {\r\n        return;\r\n      }\r\n      setAvatarFile(file);\r\n      setAvatarPreview(URL.createObjectURL(file));\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    let avatar_url = profile.avatar_url;\r\n\r\n    if (avatarFile) {\r\n      const uploadedUrl = await uploadAvatar.mutateAsync(avatarFile);\r\n      if (uploadedUrl) avatar_url = uploadedUrl;\r\n    }\r\n\r\n    // Combine phone code and number\r\n    const fullPhone = phone ? `${phoneCode} ${phone}` : undefined;\r\n\r\n    await updateProfile.mutateAsync({\r\n      display_name: displayName,\r\n      phone: fullPhone,\r\n      avatar_url: avatar_url || undefined,\r\n    });\r\n\r\n    setIsEditingPhone(false);\r\n    setOpen(false);\r\n  };\r\n\r\n  const handleDeleteAccount = async () => {\r\n    if (!user || deleteConfirmText.toLowerCase() !== \"delete\") return;\r\n    \r\n    setIsDeleting(true);\r\n    try {\r\n      // Call edge function to delete account\r\n      const { error } = await supabase.functions.invoke(\"delete-account\", {\r\n        body: { userId: user.id },\r\n      });\r\n      \r\n      if (error) {\r\n        toast.error(t(\"profile.deleteAccountFailed\"));\r\n        console.error(error);\r\n        setIsDeleting(false);\r\n        return;\r\n      }\r\n      \r\n      // Show success message first\r\n      toast.success(t(\"profile.deleteAccountSuccess\"));\r\n      \r\n      // Close dialogs\r\n      setShowConfirmDialog(false);\r\n      setShowDeleteDialog(false);\r\n      setDeleteConfirmText(\"\");\r\n      \r\n      // Wait a moment for user to see the message\r\n      await new Promise(resolve => setTimeout(resolve, 1500));\r\n      \r\n      // Then sign out and navigate\r\n      await supabase.auth.signOut();\r\n      navigate(\"/auth\");\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"profile.deleteAccountFailed\"));\r\n      setIsDeleting(false);\r\n    } finally {\r\n      setIsDeleting(false);\r\n    }\r\n  };\r\n\r\n  const handleSendOldEmailCode = async () => {\r\n    if (!user?.email) return;\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: user.email },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      setOldEmailCodeSent(true);\r\n      toast.success(t(\"profile.codeSentToOldEmail\"));\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyOldEmail = async () => {\r\n    if (!oldEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: user?.email, code: oldEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldEmailVerified\"));\r\n      setShowEmailDialog(false);\r\n      setShowNewEmailDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleSendNewEmailCode = async () => {\r\n    if (!newEmail || !newEmail.includes(\"@\")) {\r\n      toast.error(t(\"profile.enterValidEmail\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: newEmail },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(t(\"profile.codeSentToNewEmail\"));\r\n      setNewEmailCodeSent(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyNewEmail = async () => {\r\n    if (!newEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: newEmail, code: newEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.newEmailVerified\"));\r\n      // Close current dialog and open confirm dialog\r\n      setShowNewEmailDialog(false);\r\n      // Use setTimeout to ensure smooth dialog transition\r\n      setTimeout(() => {\r\n        setShowConfirmUpdateDialog(true);\r\n      }, 100);\r\n    } catch (error: any) {\r\n      toast.error(t(\"toast.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleUpdateEmail = async () => {\r\n    setIsUpdatingEmail(true);\r\n    try {\r\n      const { data: { session } } = await supabase.auth.getSession();\r\n      if (!session || !user) {\r\n        toast.error(t(\"toast.pleaseSignIn\"));\r\n        setIsUpdatingEmail(false);\r\n        return;\r\n      }\r\n\r\n      // Update email\r\n      const { data, error } = await supabase.functions.invoke(\"update-email\", {\r\n        body: {\r\n          userId: user.id,\r\n          oldEmail: user.email,\r\n          oldEmailCode,\r\n          newEmail,\r\n          newEmailCode,\r\n        },\r\n        headers: {\r\n          Authorization: `Bearer ${session.access_token}`,\r\n        },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        throw new Error(data?.error || \"Failed to update email\");\r\n      }\r\n\r\n      toast.success(t(\"toast.emailUpdatedSuccess\"));\r\n      \r\n      // Close dialogs\r\n      setShowConfirmUpdateDialog(false);\r\n      setOpen(false);\r\n      \r\n      // Reset email change states\r\n      setOldEmailCode(\"\");\r\n      setNewEmail(\"\");\r\n      setNewEmailCode(\"\");\r\n      setOldEmailCodeSent(false);\r\n      setNewEmailCodeSent(false);\r\n      \r\n      // Sign out and redirect to login\r\n      await new Promise(resolve => setTimeout(resolve, 1500));\r\n      await supabase.auth.signOut();\r\n      navigate(\"/auth\");\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"toast.emailUpdateError\"));\r\n      console.error(error);\r\n    } finally {\r\n      setIsUpdatingEmail(false);\r\n    }\r\n  };\r\n\r\n  // Password change handlers\r\n  const checkPasswordStrength = (password: string): 'weak' | 'medium' | 'strong' => {\r\n    let strength = 0;\r\n    \r\n    if (password.length >= 6) strength++;\r\n    if (password.length >= 8) strength++;\r\n    if (/[a-z]/.test(password)) strength++;\r\n    if (/[A-Z]/.test(password)) strength++;\r\n    if (/[0-9]/.test(password)) strength++;\r\n    if (/[^a-zA-Z0-9]/.test(password)) strength++;\r\n    \r\n    if (strength <= 2) return 'weak';\r\n    if (strength <= 4) return 'medium';\r\n    return 'strong';\r\n  };\r\n\r\n  const handleVerifyPassword = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!currentPassword) {\r\n      toast.error(t(\"profile.enterCurrentPassword\"));\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Create a temporary client to verify password without triggering auth state changes\r\n      const { createClient } = await import('@supabase/supabase-js');\r\n      const tempClient = createClient(\r\n        import.meta.env.VITE_SUPABASE_URL,\r\n        import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY,\r\n        {\r\n          auth: {\r\n            persistSession: false,\r\n            autoRefreshToken: false,\r\n          }\r\n        }\r\n      );\r\n\r\n      const { error } = await tempClient.auth.signInWithPassword({\r\n        email: user?.email || \"\",\r\n        password: currentPassword,\r\n      });\r\n\r\n      if (error) {\r\n        toast.error(t(\"profile.oldPasswordIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldPasswordVerified\"));\r\n      setShowPasswordDialog(false);\r\n      setShowNewPasswordDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleSendPasswordEmailCode = async () => {\r\n    if (!user?.email) return;\r\n    \r\n    try {\r\n      const { error } = await supabase.functions.invoke(\"send-verification-code\", {\r\n        body: { email: user.email },\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      setPasswordEmailCodeSent(true);\r\n      toast.success(t(\"profile.codeSentToOldEmail\"));\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.sendCodeFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleVerifyPasswordEmail = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!passwordEmailCode) {\r\n      toast.error(t(\"profile.enterCodePlaceholder\"));\r\n      return;\r\n    }\r\n    \r\n    try {\r\n      const { data, error } = await supabase.functions.invoke(\"verify-email-code\", {\r\n        body: { email: user?.email, code: passwordEmailCode },\r\n      });\r\n\r\n      if (error || !data?.success) {\r\n        toast.error(t(\"profile.codeIncorrect\"));\r\n        return;\r\n      }\r\n\r\n      toast.success(t(\"profile.oldEmailVerified\"));\r\n      setShowPasswordDialog(false);\r\n      setShowNewPasswordDialog(true);\r\n    } catch (error: any) {\r\n      toast.error(t(\"profile.verificationFailed\"));\r\n      console.error(error);\r\n    }\r\n  };\r\n\r\n  const handleUpdatePassword = async (e?: React.MouseEvent) => {\r\n    e?.preventDefault();\r\n    e?.stopPropagation();\r\n    \r\n    if (!newPassword || !confirmPassword) {\r\n      toast.error(t(\"profile.enterNewPassword\"));\r\n      return;\r\n    }\r\n\r\n    if (newPassword.length < 6) {\r\n      toast.error(t(\"profile.passwordTooShort\"));\r\n      return;\r\n    }\r\n\r\n    if (newPassword !== confirmPassword) {\r\n      toast.error(t(\"profile.passwordsDontMatch\"));\r\n      return;\r\n    }\r\n\r\n    setIsUpdatingPassword(true);\r\n    try {\r\n      const { error } = await supabase.auth.updateUser({\r\n        password: newPassword,\r\n      });\r\n\r\n      if (error) throw error;\r\n\r\n      toast.success(t(\"profile.passwordUpdated\"));\r\n      \r\n      // Close dialogs and reset states\r\n      setShowNewPasswordDialog(false);\r\n      setOpen(false);\r\n      setCurrentPassword(\"\");\r\n      setNewPassword(\"\");\r\n      setConfirmPassword(\"\");\r\n      setUseEmailForPassword(false);\r\n      setPasswordEmailCode(\"\");\r\n      setPasswordEmailCodeSent(false);\r\n    } catch (error: any) {\r\n      toast.error(error.message || t(\"profile.passwordUpdateFailed\"));\r\n      console.error(error);\r\n    } finally {\r\n      setIsUpdatingPassword(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        <Button variant=\"outline\">\r\n          <Settings className=\"w-4 h-4 mr-2\" />\r\n          {t(\"profile.editProfile\")}\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto\">\r\n        <DialogHeader>\r\n          <DialogTitle>{t(\"profile.editProfile\")}</DialogTitle>\r\n          <DialogDescription>{t(\"profile.editProfileDescription\")}</DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-3 py-3\">\r\n          <div className=\"flex flex-col items-center gap-3\">\r\n            <Avatar className=\"w-16 h-16 sm:w-24 sm:h-24\">\r\n              <AvatarImage src={avatarPreview} />\r\n              <AvatarFallback>{displayName?.charAt(0).toUpperCase()}</AvatarFallback>\r\n            </Avatar>\r\n            <div>\r\n              <Input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={handleAvatarChange}\r\n                className=\"hidden\"\r\n                id=\"avatar-upload\"\r\n              />\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => document.getElementById(\"avatar-upload\")?.click()}\r\n                className=\"text-xs sm:text-sm\"\r\n              >\r\n                <Upload className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\r\n                {t(\"profile.uploadAvatar\")}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"space-y-1.5\">\r\n            <Label htmlFor=\"displayName\" className=\"text-sm\">{t(\"profile.displayName\")}</Label>\r\n            <Input\r\n              id=\"displayName\"\r\n              value={displayName}\r\n              onChange={(e) => setDisplayName(e.target.value)}\r\n              placeholder={t(\"profile.displayName\")}\r\n              className=\"h-9\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"space-y-1.5\">\r\n            <Label htmlFor=\"phone\" className=\"text-sm\">{t(\"profile.phone\")}</Label>\r\n            {!profile.phone && !isEditingPhone ? (\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => setIsEditingPhone(true)}\r\n                className=\"w-full justify-start h-9\"\r\n              >\r\n                {t(\"profile.addPhoneNumber\")}\r\n              </Button>\r\n            ) : isEditingPhone || !profile.phone ? (\r\n              <div className=\"flex gap-2\">\r\n                <Select\r\n                  value={phoneCode}\r\n                  onValueChange={setPhoneCode}\r\n                >\r\n                  <SelectTrigger className=\"w-[110px] h-9\">\r\n                    <SelectValue placeholder=\"+351\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {COUNTRY_CODES.map((item) => (\r\n                      <SelectItem key={item.code} value={item.code}>\r\n                        <span className=\"flex items-center gap-2\">\r\n                          <span>{item.flag}</span>\r\n                          <span>{item.code}</span>\r\n                        </span>\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                <Input\r\n                  id=\"phone\"\r\n                  className=\"flex-1 h-9\"\r\n                  value={phone}\r\n                  onChange={(e) => setPhone(e.target.value)}\r\n                  placeholder={t(\"profile.phonePlaceholder\")}\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div className=\"flex items-center gap-2\">\r\n                <Input\r\n                  value={`${phoneCode} ${phone}`}\r\n                  disabled\r\n                  className=\"h-9 flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => setIsEditingPhone(true)}\r\n                  className=\"text-xs whitespace-nowrap\"\r\n                >\r\n                  {t(\"profile.modifyPhoneNumber\")}\r\n                </Button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {/* Email change - only for non-admin users */}\r\n          {!isAdmin && (\r\n            <div className=\"space-y-1.5 pt-2 border-t\">\r\n              <Label className=\"text-sm\">{t(\"profile.email\")}</Label>\r\n              <div className=\"flex items-center gap-2\">\r\n                <Input\r\n                  value={user?.email || \"\"}\r\n                  disabled\r\n                  className=\"h-9 flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => setShowEmailDialog(true)}\r\n                  className=\"text-xs\"\r\n                >\r\n                  <Mail className=\"w-3 h-3 mr-1\" />\r\n                  {t(\"profile.modify\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Password change - available for all users */}\r\n          <div className={`space-y-1.5 ${isAdmin ? \"pt-2 border-t\" : \"\"}`}>\r\n            <Label className=\"text-sm\">{t(\"profile.changePassword\")}</Label>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setShowPasswordDialog(true)}\r\n              className=\"w-full justify-start h-9\"\r\n            >\r\n              <Lock className=\"w-3 h-3 mr-2\" />\r\n              {t(\"profile.changePassword\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n        <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t\">\r\n          {!isAdmin && (\r\n            <Button \r\n              variant=\"destructive\"\r\n              size=\"sm\"\r\n              onClick={() => setShowDeleteDialog(true)}\r\n              className=\"w-full sm:w-auto text-xs sm:text-sm\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2\" />\r\n              {t(\"profile.deleteAccount\")}\r\n            </Button>\r\n          )}\r\n          <div className={`flex gap-2 w-full sm:w-auto ${isAdmin ? \"sm:ml-auto\" : \"\"}`}>\r\n            <Button \r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => {\r\n                setIsEditingPhone(false);\r\n                setOpen(false);\r\n              }}\r\n              className=\"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm\"\r\n            >\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              onClick={handleSave}\r\n              disabled={updateProfile.isPending || uploadAvatar.isPending}\r\n              className=\"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm\"\r\n            >\r\n              {updateProfile.isPending || uploadAvatar.isPending\r\n                ? t(\"common.loading\")\r\n                : t(\"common.save\")}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n\r\n      {/* First confirmation dialog */}\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.deleteAccountWarning\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.deleteAccountDescription\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => {\r\n                setShowDeleteDialog(false);\r\n                setShowConfirmDialog(true);\r\n              }}\r\n              className=\"bg-destructive hover:bg-destructive/90\"\r\n            >\r\n              {t(\"common.continue\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Final confirmation dialog */}\r\n      <AlertDialog open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.confirmDeleteAccount\")}</AlertDialogTitle>\r\n            <AlertDialogDescription className=\"space-y-4\">\r\n              <p>{t(\"profile.confirmDeleteDescription\")}</p>\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"confirm-delete\">\r\n                  {t(\"profile.typeDeleteToConfirm\")}\r\n                </Label>\r\n                <Input\r\n                  id=\"confirm-delete\"\r\n                  value={deleteConfirmText}\r\n                  onChange={(e) => setDeleteConfirmText(e.target.value)}\r\n                  placeholder=\"DELETE\"\r\n                  className=\"uppercase\"\r\n                />\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => setDeleteConfirmText(\"\")}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleDeleteAccount}\r\n              disabled={deleteConfirmText.toLowerCase() !== \"delete\" || isDeleting}\r\n              className=\"bg-destructive hover:bg-destructive/90\"\r\n            >\r\n              {isDeleting ? t(\"common.loading\") : t(\"profile.deleteAccount\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Verify old email dialog */}\r\n      <AlertDialog open={showEmailDialog} onOpenChange={setShowEmailDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.verifyOldEmail\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.oldEmailStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.currentEmail\")}</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  value={user?.email || \"\"}\r\n                  disabled\r\n                  className=\"flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={handleSendOldEmailCode}\r\n                  disabled={oldEmailCodeSent}\r\n                >\r\n                  {oldEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {oldEmailCodeSent && (\r\n              <div className=\"space-y-2\">\r\n                <Label>{t(\"profile.verificationCode\")}</Label>\r\n                <Input\r\n                  ref={oldEmailCodeInputRef}\r\n                  value={oldEmailCode}\r\n                  onChange={(e) => setOldEmailCode(e.target.value)}\r\n                  placeholder={t(\"profile.enterCode\")}\r\n                  maxLength={4}\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowEmailDialog(false);\r\n              // Reset states after cancel\r\n              setTimeout(() => {\r\n                setOldEmailCode(\"\");\r\n                setOldEmailCodeSent(false);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            {oldEmailCodeSent && (\r\n              <AlertDialogAction onClick={handleVerifyOldEmail}>\r\n                {t(\"profile.verify\")}\r\n              </AlertDialogAction>\r\n            )}\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* New email dialog - Input and verify in one step */}\r\n      <AlertDialog open={showNewEmailDialog} onOpenChange={setShowNewEmailDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader className=\"text-center space-y-3\">\r\n            <AlertDialogTitle className=\"text-xl\">\r\n              {t(\"profile.verifyNewEmail\")}\r\n            </AlertDialogTitle>\r\n            <AlertDialogDescription className=\"text-center\">\r\n              {t(\"profile.newEmailStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-sm font-normal\">{t(\"profile.newEmail\")}</Label>\r\n              <div className=\"flex gap-2\">\r\n                <Input\r\n                  type=\"email\"\r\n                  value={newEmail}\r\n                  onChange={(e) => setNewEmail(e.target.value)}\r\n                  placeholder={t(\"profile.enterNewEmail\")}\r\n                  disabled={newEmailCodeSent}\r\n                  className=\"border-2 focus:border-primary flex-1\"\r\n                />\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={handleSendNewEmailCode}\r\n                  disabled={!newEmail || newEmailCodeSent}\r\n                  className=\"text-xs whitespace-nowrap px-3\"\r\n                >\r\n                  {newEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n\r\n            {newEmailCodeSent && (\r\n              <div className=\"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300\">\r\n                <Label className=\"text-sm font-normal\">{t(\"profile.verificationCode\")}</Label>\r\n                <Input\r\n                  ref={newEmailCodeInputRef}\r\n                  value={newEmailCode}\r\n                  onChange={(e) => setNewEmailCode(e.target.value)}\r\n                  placeholder={t(\"profile.enterCode\")}\r\n                  maxLength={4}\r\n                  className=\"border-2 focus:border-primary\"\r\n                />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter className=\"flex-col sm:flex-col gap-2\">\r\n            {newEmailCodeSent && (\r\n              <AlertDialogAction \r\n                onClick={handleVerifyNewEmail}\r\n                disabled={!newEmailCode || newEmailCode.length !== 4}\r\n                className=\"w-full bg-primary hover:bg-primary/90\"\r\n              >\r\n                \r\n              </AlertDialogAction>\r\n            )}\r\n            <AlertDialogCancel \r\n              onClick={() => {\r\n                setShowNewEmailDialog(false);\r\n                // Reset states after a delay to allow dialog transition\r\n                setTimeout(() => {\r\n                  setNewEmail(\"\");\r\n                  setNewEmailCode(\"\");\r\n                  setNewEmailCodeSent(false);\r\n                }, 300);\r\n              }}\r\n              className=\"w-full mt-0\"\r\n            >\r\n              \r\n            </AlertDialogCancel>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Confirm update dialog */}\r\n      <AlertDialog open={showConfirmUpdateDialog} onOpenChange={setShowConfirmUpdateDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle></AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n               3/3: \r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm\">\r\n              <p className=\"font-medium text-green-900 dark:text-green-100\"></p>\r\n              <p className=\"text-green-700 dark:text-green-300 mt-1\">\r\n                \"\"\r\n              </p>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-muted-foreground\">:</span>\r\n                <span className=\"font-medium\">{user?.email}</span>\r\n              </div>\r\n              <div className=\"flex justify-between text-sm\">\r\n                <span className=\"text-muted-foreground\">:</span>\r\n                <span className=\"font-medium\">{newEmail}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowConfirmUpdateDialog(false);\r\n              // Reset states after cancel\r\n              setTimeout(() => {\r\n                setOldEmailCode(\"\");\r\n                setNewEmail(\"\");\r\n                setNewEmailCode(\"\");\r\n                setOldEmailCodeSent(false);\r\n                setNewEmailCodeSent(false);\r\n              }, 300);\r\n            }}></AlertDialogCancel>\r\n            <AlertDialogAction \r\n              onClick={handleUpdateEmail}\r\n              disabled={isUpdatingEmail}\r\n            >\r\n              {isUpdatingEmail ? \"...\" : \"\"}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Verify password/email dialog */}\r\n      <AlertDialog open={showPasswordDialog} onOpenChange={setShowPasswordDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.verifyOldPassword\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.oldPasswordStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            {!useEmailForPassword ? (\r\n              <>\r\n                <div className=\"space-y-2\">\r\n                  <Label>{t(\"profile.currentPassword\")}</Label>\r\n                  <Input\r\n                    type=\"password\"\r\n                    value={currentPassword}\r\n                    onChange={(e) => setCurrentPassword(e.target.value)}\r\n                    placeholder={t(\"profile.enterCurrentPassword\")}\r\n                  />\r\n                </div>\r\n                <Button\r\n                  variant=\"link\"\r\n                  size=\"sm\"\r\n                  onClick={() => setUseEmailForPassword(true)}\r\n                  className=\"text-xs p-0 h-auto\"\r\n                >\r\n                  {t(\"profile.forgotPassword\")} {t(\"profile.useEmailVerification\")}\r\n                </Button>\r\n              </>\r\n            ) : (\r\n              <>\r\n                <div className=\"space-y-2\">\r\n                  <Label>{t(\"profile.currentEmail\")}</Label>\r\n                  <div className=\"flex gap-2\">\r\n                    <Input\r\n                      value={user?.email || \"\"}\r\n                      disabled\r\n                      className=\"flex-1\"\r\n                    />\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={handleSendPasswordEmailCode}\r\n                      disabled={passwordEmailCodeSent}\r\n                    >\r\n                      {passwordEmailCodeSent ? t(\"profile.codeSent\") : t(\"profile.sendCode\")}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n\r\n                {passwordEmailCodeSent && (\r\n                  <div className=\"space-y-2\">\r\n                    <Label>{t(\"profile.verificationCode\")}</Label>\r\n                    <Input\r\n                      ref={passwordEmailCodeInputRef}\r\n                      value={passwordEmailCode}\r\n                      onChange={(e) => setPasswordEmailCode(e.target.value)}\r\n                      placeholder={t(\"profile.enterCode\")}\r\n                      maxLength={4}\r\n                    />\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowPasswordDialog(false);\r\n              setTimeout(() => {\r\n                setCurrentPassword(\"\");\r\n                setUseEmailForPassword(false);\r\n                setPasswordEmailCode(\"\");\r\n                setPasswordEmailCodeSent(false);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            {useEmailForPassword ? (\r\n              passwordEmailCodeSent && (\r\n                <AlertDialogAction onClick={handleVerifyPasswordEmail}>\r\n                  {t(\"profile.verify\")}\r\n                </AlertDialogAction>\r\n              )\r\n            ) : (\r\n              <AlertDialogAction onClick={handleVerifyPassword}>\r\n                {t(\"profile.verify\")}\r\n              </AlertDialogAction>\r\n            )}\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* New password dialog */}\r\n      <AlertDialog open={showNewPasswordDialog} onOpenChange={setShowNewPasswordDialog}>\r\n        <AlertDialogContent className=\"max-w-[90vw] sm:max-w-md\">\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"profile.setNewPassword\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"profile.newPasswordStep\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          \r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.newPassword\")}</Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={newPassword}\r\n                onChange={(e) => {\r\n                  setNewPassword(e.target.value);\r\n                  if (e.target.value) {\r\n                    setPasswordStrength(checkPasswordStrength(e.target.value));\r\n                  } else {\r\n                    setPasswordStrength(null);\r\n                  }\r\n                }}\r\n                placeholder={t(\"profile.enterNewPassword\")}\r\n              />\r\n              {passwordStrength && (\r\n                <div className=\"space-y-1\">\r\n                  <div className=\"flex gap-1\">\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'weak' ? 'bg-destructive' : \r\n                      passwordStrength === 'medium' ? 'bg-warning' : \r\n                      'bg-success'\r\n                    }`} />\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'medium' || passwordStrength === 'strong' ? \r\n                      passwordStrength === 'medium' ? 'bg-warning' : 'bg-success' : \r\n                      'bg-muted'\r\n                    }`} />\r\n                    <div className={`h-1.5 flex-1 rounded-full transition-colors ${\r\n                      passwordStrength === 'strong' ? 'bg-success' : 'bg-muted'\r\n                    }`} />\r\n                  </div>\r\n                  <p className={`text-xs ${\r\n                    passwordStrength === 'weak' ? 'text-destructive' : \r\n                    passwordStrength === 'medium' ? 'text-warning' : \r\n                    'text-success'\r\n                  }`}>\r\n                    {t(`auth.passwordStrength.${passwordStrength}`)}\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"profile.confirmNewPassword\")}</Label>\r\n              <Input\r\n                type=\"password\"\r\n                value={confirmPassword}\r\n                onChange={(e) => setConfirmPassword(e.target.value)}\r\n                placeholder={t(\"profile.confirmNewPasswordPlaceholder\")}\r\n              />\r\n            </div>\r\n\r\n            {newPassword && confirmPassword && newPassword !== confirmPassword && (\r\n              <p className=\"text-sm text-destructive\">{t(\"profile.passwordsDontMatch\")}</p>\r\n            )}\r\n          </div>\r\n\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={() => {\r\n              setShowNewPasswordDialog(false);\r\n              setTimeout(() => {\r\n                setNewPassword(\"\");\r\n                setConfirmPassword(\"\");\r\n                setPasswordStrength(null);\r\n              }, 300);\r\n            }}>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={handleUpdatePassword}\r\n              disabled={!newPassword || !confirmPassword || newPassword !== confirmPassword || isUpdatingPassword}\r\n            >\r\n              {isUpdatingPassword ? t(\"common.loading\") : t(\"profile.updatePassword\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default EditProfileDialog;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useUserAddresses, useCreateAddress, useUpdateAddress, useDeleteAddress, useSetDefaultAddress, type UserAddress, type AddressFormData } from \"@/hooks/useUserAddresses\";\r\nimport { useProfile, useUpdateProfile } from \"@/hooks/useProfile\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { MapPin, Plus, Edit, Trash2, Star, Home, Building, Briefcase, Phone } from \"lucide-react\";\r\nconst ADDRESS_LABELS = [{\r\n  value: \"Home\",\r\n  icon: Home,\r\n  labelKey: \"address.labelHome\"\r\n}, {\r\n  value: \"Work\",\r\n  icon: Briefcase,\r\n  labelKey: \"address.labelWork\"\r\n}, {\r\n  value: \"Office\",\r\n  icon: Building,\r\n  labelKey: \"address.labelOffice\"\r\n}, {\r\n  value: \"Other\",\r\n  icon: MapPin,\r\n  labelKey: \"address.labelOther\"\r\n}];\r\nconst COUNTRY_CODES = [{\r\n  code: \"+351\",\r\n  country: \"Portugal\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+34\",\r\n  country: \"Spain\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+33\",\r\n  country: \"France\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+49\",\r\n  country: \"Germany\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+39\",\r\n  country: \"Italy\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+44\",\r\n  country: \"UK\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+31\",\r\n  country: \"Netherlands\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+32\",\r\n  country: \"Belgium\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+86\",\r\n  country: \"China\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+1\",\r\n  country: \"USA/Canada\",\r\n  flag: \"\"\r\n}, {\r\n  code: \"+55\",\r\n  country: \"Brazil\",\r\n  flag: \"\"\r\n}];\r\nconst COUNTRIES = [\"Portugal\", \"Spain\", \"France\", \"Germany\", \"Italy\", \"United Kingdom\", \"Netherlands\", \"Belgium\", \"China\", \"Other\"];\r\ninterface AddressFormProps {\r\n  initialData?: Partial<AddressFormData>;\r\n  onSubmit: (data: AddressFormData) => void;\r\n  onCancel: () => void;\r\n  isLoading?: boolean;\r\n  isEdit?: boolean;\r\n}\r\nconst AddressForm = ({\r\n  initialData,\r\n  onSubmit,\r\n  onCancel,\r\n  isLoading,\r\n  isEdit\r\n}: AddressFormProps) => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const [formData, setFormData] = useState<AddressFormData>({\r\n    label: initialData?.label || \"Home\",\r\n    street: initialData?.street || \"\",\r\n    district: initialData?.district || \"\",\r\n    city: initialData?.city || \"\",\r\n    postal_code: initialData?.postal_code || \"\",\r\n    country: initialData?.country || \"Portugal\",\r\n    phone: initialData?.phone || \"\",\r\n    phone_code: initialData?.phone_code || \"+351\",\r\n    is_default: initialData?.is_default || false\r\n  });\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    onSubmit(formData);\r\n  };\r\n  return <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"label\">{t(\"address.label\")}</Label>\r\n        <Select value={formData.label} onValueChange={value => setFormData({\r\n        ...formData,\r\n        label: value\r\n      })}>\r\n          <SelectTrigger>\r\n            <SelectValue placeholder={t(\"address.selectLabel\")} />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            {ADDRESS_LABELS.map(label => <SelectItem key={label.value} value={label.value}>\r\n                <div className=\"flex items-center gap-2\">\r\n                  <label.icon className=\"w-4 h-4\" />\r\n                  {t(label.labelKey)}\r\n                </div>\r\n              </SelectItem>)}\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"street\">{t(\"address.street\")} *</Label>\r\n        <Input id=\"street\" value={formData.street} onChange={e => setFormData({\r\n        ...formData,\r\n        street: e.target.value\r\n      })} placeholder={t(\"address.streetPlaceholder\")} required />\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"district\">{t(\"address.district\")}</Label>\r\n          <Input id=\"district\" value={formData.district} onChange={e => setFormData({\r\n          ...formData,\r\n          district: e.target.value\r\n        })} placeholder={t(\"address.districtPlaceholder\")} />\r\n        </div>\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"city\">{t(\"address.city\")} *</Label>\r\n          <Input id=\"city\" value={formData.city} onChange={e => setFormData({\r\n          ...formData,\r\n          city: e.target.value\r\n        })} placeholder={t(\"address.cityPlaceholder\")} required />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"grid grid-cols-2 gap-4\">\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"postal_code\">{t(\"address.postalCode\")} *</Label>\r\n          <Input id=\"postal_code\" value={formData.postal_code} onChange={e => setFormData({\r\n          ...formData,\r\n          postal_code: e.target.value\r\n        })} placeholder={t(\"address.postalCodePlaceholder\")} required />\r\n        </div>\r\n        <div className=\"space-y-2\">\r\n          <Label htmlFor=\"country\">{t(\"address.country\")} *</Label>\r\n          <Select value={formData.country} onValueChange={value => setFormData({\r\n          ...formData,\r\n          country: value\r\n        })}>\r\n            <SelectTrigger>\r\n              <SelectValue placeholder={t(\"address.selectCountry\")} />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {COUNTRIES.map(country => <SelectItem key={country} value={country}>\r\n                  {country}\r\n                </SelectItem>)}\r\n            </SelectContent>\r\n        </Select>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"space-y-2\">\r\n        <Label htmlFor=\"phone\">{t(\"address.phone\")} *</Label>\r\n        <div className=\"flex gap-2\">\r\n          <Select value={formData.phone_code} onValueChange={value => setFormData({\r\n          ...formData,\r\n          phone_code: value\r\n        })}>\r\n            <SelectTrigger className=\"w-[130px]\">\r\n              <SelectValue placeholder=\"+351\" />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {COUNTRY_CODES.map(item => <SelectItem key={item.code} value={item.code}>\r\n                  <span className=\"flex items-center gap-2\">\r\n                    <span>{item.flag}</span>\r\n                    <span>{item.code}</span>\r\n                  </span>\r\n                </SelectItem>)}\r\n            </SelectContent>\r\n          </Select>\r\n          <Input id=\"phone\" className=\"flex-1\" value={formData.phone} onChange={e => setFormData({\r\n          ...formData,\r\n          phone: e.target.value\r\n        })} placeholder={t(\"address.phonePlaceholder\")} required />\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"flex items-center space-x-2\">\r\n        <Checkbox id=\"is_default\" checked={formData.is_default} onCheckedChange={checked => setFormData({\r\n        ...formData,\r\n        is_default: checked as boolean\r\n      })} />\r\n        <Label htmlFor=\"is_default\" className=\"text-sm font-normal cursor-pointer\">\r\n          {t(\"address.setAsDefault\")}\r\n        </Label>\r\n      </div>\r\n\r\n      <DialogFooter className=\"gap-2 sm:gap-0\">\r\n        <Button type=\"button\" variant=\"outline\" onClick={onCancel}>\r\n          {t(\"common.cancel\")}\r\n        </Button>\r\n        <Button type=\"submit\" disabled={isLoading}>\r\n          {isLoading ? t(\"common.saving\") : isEdit ? t(\"common.save\") : t(\"address.add\")}\r\n        </Button>\r\n      </DialogFooter>\r\n    </form>;\r\n};\r\ninterface AddressCardProps {\r\n  address: UserAddress;\r\n  onEdit: (address: UserAddress) => void;\r\n  onDelete: (id: string) => void;\r\n  onSetDefault: (id: string) => void;\r\n  isDeleting?: boolean;\r\n  isSettingDefault?: boolean;\r\n  canDelete?: boolean;\r\n}\r\nconst AddressCard = ({\r\n  address,\r\n  onEdit,\r\n  onDelete,\r\n  onSetDefault,\r\n  isDeleting,\r\n  isSettingDefault,\r\n  canDelete = true\r\n}: AddressCardProps) => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const labelConfig = ADDRESS_LABELS.find(l => l.value === address.label) || ADDRESS_LABELS[3];\r\n  const LabelIcon = labelConfig.icon;\r\n  return <div className={`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${address.is_default ? 'bg-primary/5 border-primary/20' : ''}`}>\r\n      <div className=\"flex items-start justify-between gap-4\">\r\n        <div className=\"flex items-start gap-3 flex-1\">\r\n          <div className={`p-2 rounded-full ${address.is_default ? 'bg-primary/20' : 'bg-primary/10'}`}>\r\n            <LabelIcon className=\"w-5 h-5 text-primary\" />\r\n          </div>\r\n          <div className=\"flex-1 min-w-0\">\r\n            <div className=\"flex items-center gap-2 mb-1\">\r\n              <span className=\"font-semibold text-foreground\">\r\n                {t(labelConfig.labelKey)}\r\n              </span>\r\n              {address.is_default && <Badge variant=\"secondary\" className=\"text-xs\">\r\n                  <Star className=\"w-3 h-3 mr-1 fill-current\" />\r\n                  {t(\"address.default\")}\r\n                </Badge>}\r\n            </div>\r\n            <p className=\"text-sm text-foreground\">\r\n              {address.street}{address.district && `, ${address.district}`}\r\n            </p>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              {[address.postal_code, address.city, address.country].filter(Boolean).join(\", \")}\r\n            </p>\r\n            {address.phone && <p className=\"text-sm text-muted-foreground flex items-center gap-1 mt-1\">\r\n                <Phone className=\"w-3 h-3\" />\r\n                {address.phone_code} {address.phone}\r\n              </p>}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-1\">\r\n          {!address.is_default && <Button variant=\"ghost\" size=\"icon\" onClick={() => onSetDefault(address.id)} disabled={isSettingDefault} title={t(\"address.setAsDefault\")}>\r\n              <Star className=\"w-4 h-4\" />\r\n            </Button>}\r\n          <Button variant=\"ghost\" size=\"icon\" onClick={() => onEdit(address)} title={t(\"common.edit\")}>\r\n            <Edit className=\"w-4 h-4\" />\r\n          </Button>\r\n          {canDelete && <AlertDialog>\r\n              <AlertDialogTrigger asChild>\r\n                <Button variant=\"ghost\" size=\"icon\" className=\"text-destructive hover:text-destructive\" title={t(\"common.delete\")}>\r\n                  <Trash2 className=\"w-4 h-4\" />\r\n                </Button>\r\n              </AlertDialogTrigger>\r\n              <AlertDialogContent>\r\n                <AlertDialogHeader>\r\n                  <AlertDialogTitle>{t(\"address.deleteTitle\")}</AlertDialogTitle>\r\n                  <AlertDialogDescription>\r\n                    {t(\"address.deleteDescription\")}\r\n                  </AlertDialogDescription>\r\n                </AlertDialogHeader>\r\n                <AlertDialogFooter>\r\n                  <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n                  <AlertDialogAction onClick={() => onDelete(address.id)} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\" disabled={isDeleting}>\r\n                    {isDeleting ? t(\"common.deleting\") : t(\"common.delete\")}\r\n                  </AlertDialogAction>\r\n                </AlertDialogFooter>\r\n              </AlertDialogContent>\r\n            </AlertDialog>}\r\n        </div>\r\n      </div>\r\n    </div>;\r\n};\r\nconst AddressManagement = () => {\r\n  const {\r\n    t\r\n  } = useTranslation();\r\n  const {\r\n    data: addresses,\r\n    isLoading\r\n  } = useUserAddresses();\r\n  const {\r\n    data: profile\r\n  } = useProfile();\r\n  const createAddress = useCreateAddress();\r\n  const updateAddress = useUpdateAddress();\r\n  const updateProfile = useUpdateProfile();\r\n  const deleteAddress = useDeleteAddress();\r\n  const setDefaultAddress = useSetDefaultAddress();\r\n  const [isAddDialogOpen, setIsAddDialogOpen] = useState(false);\r\n  const [editingAddress, setEditingAddress] = useState<UserAddress | null>(null);\r\n  const [pendingAddressData, setPendingAddressData] = useState<AddressFormData | null>(null);\r\n  const [showPhoneConfirm, setShowPhoneConfirm] = useState(false);\r\n  const profileHasNoPhone = !profile?.phone;\r\n  const handleCreate = (data: AddressFormData) => {\r\n    // If profile has no phone and address has phone, show confirmation\r\n    if (profileHasNoPhone && data.phone) {\r\n      setPendingAddressData(data);\r\n      setShowPhoneConfirm(true);\r\n      return;\r\n    }\r\n    createAddress.mutate(data, {\r\n      onSuccess: () => setIsAddDialogOpen(false)\r\n    });\r\n  };\r\n  const handleConfirmCreateWithPhone = () => {\r\n    if (!pendingAddressData) return;\r\n\r\n    // Update profile phone\r\n    const fullPhone = `${pendingAddressData.phone_code || '+351'} ${pendingAddressData.phone}`;\r\n    updateProfile.mutate({\r\n      phone: fullPhone\r\n    });\r\n\r\n    // Create address\r\n    createAddress.mutate(pendingAddressData, {\r\n      onSuccess: () => {\r\n        setIsAddDialogOpen(false);\r\n        setPendingAddressData(null);\r\n        setShowPhoneConfirm(false);\r\n      }\r\n    });\r\n  };\r\n  const handleCancelPhoneConfirm = () => {\r\n    setPendingAddressData(null);\r\n    setShowPhoneConfirm(false);\r\n  };\r\n  const handleUpdate = (data: AddressFormData) => {\r\n    if (!editingAddress) return;\r\n    updateAddress.mutate({\r\n      id: editingAddress.id,\r\n      address: data\r\n    }, {\r\n      onSuccess: () => setEditingAddress(null)\r\n    });\r\n  };\r\n  const handleDelete = (id: string) => {\r\n    deleteAddress.mutate(id);\r\n  };\r\n  const handleSetDefault = (id: string) => {\r\n    setDefaultAddress.mutate(id);\r\n  };\r\n  if (isLoading) {\r\n    return <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <MapPin className=\"w-5 h-5\" />\r\n            {t(\"address.myAddresses\")}\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"text-center py-8 text-muted-foreground\">\r\n            {t(\"common.loading\")}\r\n          </div>\r\n        </CardContent>\r\n      </Card>;\r\n  }\r\n  const hasAddresses = addresses && addresses.length > 0;\r\n  return <Card>\r\n      <CardHeader>\r\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3\">\r\n          <div className=\"space-y-1.5 min-w-0 flex-1\">\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <MapPin className=\"w-5 h-5 flex-shrink-0\" />\r\n              {t(\"address.myAddresses\")}\r\n            </CardTitle>\r\n            <CardDescription className=\"text-xs text-primary\">{t(\"address.manageDescription\")}</CardDescription>\r\n          </div>\r\n          {hasAddresses && <Dialog open={isAddDialogOpen} onOpenChange={setIsAddDialogOpen}>\r\n              <DialogTrigger asChild>\r\n                <Button size=\"sm\" className=\"w-full sm:w-auto flex-shrink-0\">\r\n                  <Plus className=\"w-4 h-4 mr-2\" />\r\n                  <span className=\"truncate\">{t(\"address.addNew\")}</span>\r\n                </Button>\r\n              </DialogTrigger>\r\n              <DialogContent className=\"sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                  <DialogTitle>{t(\"address.addNew\")}</DialogTitle>\r\n                  <DialogDescription>\r\n                    {t(\"address.addDescription\")}\r\n                  </DialogDescription>\r\n                </DialogHeader>\r\n                <AddressForm onSubmit={handleCreate} onCancel={() => setIsAddDialogOpen(false)} isLoading={createAddress.isPending} />\r\n              </DialogContent>\r\n            </Dialog>}\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {hasAddresses ? <div className=\"space-y-4\">\r\n            {addresses.map(address => <AddressCard key={address.id} address={address} onEdit={setEditingAddress} onDelete={handleDelete} onSetDefault={handleSetDefault} isDeleting={deleteAddress.isPending} isSettingDefault={setDefaultAddress.isPending} canDelete={addresses.length > 1} />)}\r\n          </div> : <div className=\"text-center py-8\">\r\n            <MapPin className=\"w-12 h-12 mx-auto text-muted-foreground/50 mb-4\" />\r\n            <p className=\"text-muted-foreground mb-4\">{t(\"address.noAddresses\")}</p>\r\n            <Button onClick={() => setIsAddDialogOpen(true)}>\r\n              <Plus className=\"w-4 h-4 mr-2\" />\r\n              {t(\"address.addFirst\")}\r\n            </Button>\r\n          </div>}\r\n      </CardContent>\r\n\r\n      {/* Edit Dialog */}\r\n      <Dialog open={!!editingAddress} onOpenChange={() => setEditingAddress(null)}>\r\n        <DialogContent className=\"sm:max-w-[500px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"address.editAddress\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {t(\"address.editDescription\")}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          {editingAddress && <AddressForm initialData={editingAddress} onSubmit={handleUpdate} onCancel={() => setEditingAddress(null)} isLoading={updateAddress.isPending} isEdit />}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Phone Confirmation Dialog */}\r\n      <AlertDialog open={showPhoneConfirm} onOpenChange={setShowPhoneConfirm}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"address.phoneConfirmTitle\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"address.phoneConfirmDescription\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={handleCancelPhoneConfirm}>\r\n              {t(\"common.cancel\")}\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleConfirmCreateWithPhone} disabled={createAddress.isPending || updateProfile.isPending}>\r\n              {createAddress.isPending || updateProfile.isPending ? t(\"common.saving\") : t(\"common.confirm\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </Card>;\r\n};\r\nexport default AddressManagement;","import { useState } from \"react\";\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Calendar, Tag, Ticket, Clock, QrCode } from \"lucide-react\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { format } from \"date-fns\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { QRCodeSVG } from \"qrcode.react\";\r\n\r\ninterface CouponDetailDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  coupon: any;\r\n}\r\n\r\nexport const CouponDetailDialog = ({ open, onOpenChange, coupon }: CouponDetailDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [showQrCode, setShowQrCode] = useState(false);\r\n  \r\n  const template = coupon.coupon_codes?.coupon_templates;\r\n  const code = coupon.coupon_codes?.code;\r\n  const isUsed = !!coupon.used_at;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={(open) => {\r\n      onOpenChange(open);\r\n      if (!open) setShowQrCode(false);\r\n    }}>\r\n      <DialogContent className=\"max-w-lg max-h-[90vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Ticket className=\"w-5 h-5 text-primary\" />\r\n            {t(\"profile.coupons.details\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"max-h-[70vh] pr-4\">\r\n          <div className=\"space-y-4\">\r\n            {/*  */}\r\n            <div>\r\n              <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                <h3 className=\"text-xl font-bold text-foreground\">\r\n                  {getLocalizedField(template, \"title\")}\r\n                </h3>\r\n                <Badge variant={isUsed ? \"secondary\" : \"default\"}>\r\n                  {isUsed ? t(\"profile.coupons.used\") : t(\"profile.coupons.available\")}\r\n                </Badge>\r\n              </div>\r\n              \r\n              {template?.description_zh || template?.description_en || template?.description_pt ? (\r\n                <p className=\"text-muted-foreground text-sm\">\r\n                  {getLocalizedField(template, \"description\")}\r\n                </p>\r\n              ) : null}\r\n            </div>\r\n\r\n            <Separator />\r\n\r\n            {/*  */}\r\n            <div \r\n              className=\"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors\"\r\n              onClick={() => setShowQrCode(!showQrCode)}\r\n            >\r\n              <div className=\"flex flex-col items-center gap-3\">\r\n                {showQrCode ? (\r\n                  <>\r\n                    {/*  */}\r\n                    <div className=\"bg-white p-3 rounded-lg\">\r\n                      <QRCodeSVG\r\n                        value={code || \"\"}\r\n                        size={140}\r\n                        level=\"M\"\r\n                        includeMargin={false}\r\n                      />\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {t(\"profile.coupons.tapToHideQr\")}\r\n                    </p>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    {/*  */}\r\n                    <p className=\"text-2xl font-mono font-bold tracking-wider\">\r\n                      {code}\r\n                    </p>\r\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n                      <QrCode className=\"w-4 h-4\" />\r\n                      <p className=\"text-xs\">\r\n                        {t(\"profile.coupons.tapToShowQr\")}\r\n                      </p>\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-center gap-2 p-3 bg-primary/10 rounded-lg\">\r\n              <Tag className=\"w-5 h-5 text-primary\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.discount\")}\r\n                </p>\r\n                <p className=\"text-xl font-bold text-primary\">\r\n                  {template?.discount_type === \"percentage\" \r\n                    ? `${template?.discount_value}% OFF` \r\n                    : `${template?.discount_value}`}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-start gap-3\">\r\n              <Clock className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.claimedAt\")}\r\n                </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {format(new Date(coupon.claimed_at), \"yyyy-MM-dd HH:mm\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            {isUsed && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Calendar className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.usedOn\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {format(new Date(coupon.used_at), \"yyyy-MM-dd HH:mm\")}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  */}\r\n            <div className=\"flex items-start gap-3\">\r\n              <Calendar className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n              <div>\r\n                <p className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.validity\")}\r\n                </p>\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  {template?.valid_until \r\n                    ? `${format(new Date(template.valid_from), \"yyyy-MM-dd\")} - ${format(new Date(template.valid_until), \"yyyy-MM-dd\")}`\r\n                    : t(\"profile.coupons.noExpiry\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {/*  */}\r\n            {template?.min_order_amount && template.min_order_amount > 0 && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Tag className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.minOrder\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {template.min_order_amount}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  */}\r\n            {template?.max_discount_amount && template.max_discount_amount > 0 && (\r\n              <div className=\"flex items-start gap-3\">\r\n                <Tag className=\"w-5 h-5 text-muted-foreground mt-0.5\" />\r\n                <div>\r\n                  <p className=\"text-sm font-medium text-foreground\">\r\n                    {t(\"profile.coupons.maxDiscount\")}\r\n                  </p>\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {template.max_discount_amount}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <Separator />\r\n\r\n            {/*  -  */}\r\n            {coupon.activity_id && coupon.source === \"share\" && (\r\n              <Link\r\n                to={`/activity/${coupon.activity_id}`}\r\n                className=\"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary\"\r\n              >\r\n                <Tag className=\"w-4 h-4 text-primary\" />\r\n                <span className=\"text-sm font-medium text-foreground\">\r\n                  {t(\"profile.coupons.source\")}: {t(\"profile.coupons.fromSharing\")}\r\n                </span>\r\n                <span className=\"text-xs text-muted-foreground\">\r\n                  ({t(\"profile.coupons.viewActivity\")})\r\n                </span>\r\n              </Link>\r\n            )}\r\n          </div>\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\n\r\nexport interface BookingRecord {\r\n  id: string;\r\n  customer_email: string;\r\n  customer_name: string | null;\r\n  customer_phone: string | null;\r\n  restaurant_id: string | null;\r\n  restaurant_name: string;\r\n  booking_date: string;\r\n  booking_time: string;\r\n  party_size: number;\r\n  status: string;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  restaurants?: {\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n    image_url: string | null;\r\n  } | null;\r\n}\r\n\r\nexport interface DeliveryRecord {\r\n  id: string;\r\n  customer_email: string;\r\n  customer_name: string | null;\r\n  customer_phone: string | null;\r\n  restaurant_id: string | null;\r\n  restaurant_name: string;\r\n  order_date: string;\r\n  total_amount: number | null;\r\n  status: string;\r\n  delivery_address: string | null;\r\n  items: any[] | null;\r\n  notes: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n  restaurants?: {\r\n    name: string;\r\n    name_en: string | null;\r\n    name_pt: string | null;\r\n    image_url: string | null;\r\n  } | null;\r\n}\r\n\r\n// \r\nexport const useBookingRecords = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"bookingRecords\", user?.email],\r\n    queryFn: async () => {\r\n      if (!user?.email) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"booking_records\")\r\n        .select(`\r\n          *,\r\n          restaurants (\r\n            name,\r\n            name_en,\r\n            name_pt,\r\n            image_url\r\n          )\r\n        `)\r\n        .order(\"booking_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as BookingRecord[];\r\n    },\r\n    enabled: !!user?.email,\r\n  });\r\n};\r\n\r\n// \r\nexport const useDeliveryRecords = () => {\r\n  const { user } = useAuth();\r\n\r\n  return useQuery({\r\n    queryKey: [\"deliveryRecords\", user?.email],\r\n    queryFn: async () => {\r\n      if (!user?.email) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"delivery_records\")\r\n        .select(`\r\n          *,\r\n          restaurants (\r\n            name,\r\n            name_en,\r\n            name_pt,\r\n            image_url\r\n          )\r\n        `)\r\n        .order(\"order_date\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as DeliveryRecord[];\r\n    },\r\n    enabled: !!user?.email,\r\n  });\r\n};\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { format } from \"date-fns\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { CalendarDays, Clock, Users, Store } from \"lucide-react\";\r\nimport { useBookingRecords } from \"@/hooks/useOrderRecords\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\nexport const BookingRecords = () => {\r\n  const { t } = useTranslation();\r\n  const { data: records, isLoading } = useBookingRecords();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case \"confirmed\":\r\n        return <Badge className=\"bg-green-500\">{t(\"booking.status.confirmed\")}</Badge>;\r\n      case \"pending\":\r\n        return <Badge variant=\"secondary\">{t(\"booking.status.pending\")}</Badge>;\r\n      case \"cancelled\":\r\n        return <Badge variant=\"destructive\">{t(\"booking.status.cancelled\")}</Badge>;\r\n      case \"completed\":\r\n        return <Badge className=\"bg-blue-500\">{t(\"booking.status.completed\")}</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n          <CalendarDays className=\"w-5 h-5\" />\r\n          {t(\"profile.bookingRecords.title\")}\r\n        </CardTitle>\r\n        <CardDescription className=\"text-xs\">\r\n          {t(\"profile.bookingRecords.description\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"px-3\">\r\n        {isLoading ? (\r\n          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n        ) : records && records.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {records.map((record) => {\r\n              const restaurantName = record.restaurants \r\n                ? getLocalizedField(record.restaurants, \"name\") \r\n                : record.restaurant_name;\r\n              \r\n              return (\r\n                <div\r\n                  key={record.id}\r\n                  className=\"p-3 rounded-lg border hover:shadow-medium transition-shadow\"\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                    <div className=\"flex-1\">\r\n                      {record.restaurant_id ? (\r\n                        <Link \r\n                          to={`/restaurant/${record.restaurant_id}`}\r\n                          className=\"font-semibold text-sm hover:text-primary transition-colors\"\r\n                        >\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </Link>\r\n                      ) : (\r\n                        <span className=\"font-semibold text-sm\">\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {getStatusBadge(record.status)}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground\">\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <CalendarDays className=\"w-3 h-3\" />\r\n                      {format(new Date(record.booking_date), \"yyyy-MM-dd\")}\r\n                    </span>\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <Clock className=\"w-3 h-3\" />\r\n                      {record.booking_time.slice(0, 5)}\r\n                    </span>\r\n                    <span className=\"flex items-center gap-1\">\r\n                      <Users className=\"w-3 h-3\" />\r\n                      {record.party_size} {t(\"booking.people\")}\r\n                    </span>\r\n                  </div>\r\n                  \r\n                  {record.notes && (\r\n                    <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\r\n                      {record.notes}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n            {t(\"profile.bookingRecords.noRecords\")}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n","import { useTranslation } from \"react-i18next\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { format } from \"date-fns\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Truck, Store, MapPin } from \"lucide-react\";\r\nimport { useDeliveryRecords } from \"@/hooks/useOrderRecords\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\n\r\nexport const DeliveryRecords = () => {\r\n  const { t } = useTranslation();\r\n  const { data: records, isLoading } = useDeliveryRecords();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    switch (status) {\r\n      case \"completed\":\r\n        return <Badge className=\"bg-green-500\">{t(\"delivery.status.completed\")}</Badge>;\r\n      case \"pending\":\r\n        return <Badge variant=\"secondary\">{t(\"delivery.status.pending\")}</Badge>;\r\n      case \"cancelled\":\r\n        return <Badge variant=\"destructive\">{t(\"delivery.status.cancelled\")}</Badge>;\r\n      case \"delivering\":\r\n        return <Badge className=\"bg-blue-500\">{t(\"delivery.status.delivering\")}</Badge>;\r\n      default:\r\n        return <Badge variant=\"outline\">{status}</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader className=\"pb-3\">\r\n        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n          <Truck className=\"w-5 h-5\" />\r\n          {t(\"profile.deliveryRecords.title\")}\r\n        </CardTitle>\r\n        <CardDescription className=\"text-xs\">\r\n          {t(\"profile.deliveryRecords.description\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"px-3\">\r\n        {isLoading ? (\r\n          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n        ) : records && records.length > 0 ? (\r\n          <div className=\"space-y-3\">\r\n            {records.map((record) => {\r\n              const restaurantName = record.restaurants \r\n                ? getLocalizedField(record.restaurants, \"name\") \r\n                : record.restaurant_name;\r\n              \r\n              return (\r\n                <div\r\n                  key={record.id}\r\n                  className=\"p-3 rounded-lg border hover:shadow-medium transition-shadow\"\r\n                >\r\n                  <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n                    <div className=\"flex-1\">\r\n                      {record.restaurant_id ? (\r\n                        <Link \r\n                          to={`/restaurant/${record.restaurant_id}`}\r\n                          className=\"font-semibold text-sm hover:text-primary transition-colors\"\r\n                        >\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </Link>\r\n                      ) : (\r\n                        <span className=\"font-semibold text-sm\">\r\n                          <Store className=\"w-4 h-4 inline mr-1\" />\r\n                          {restaurantName}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {getStatusBadge(record.status)}\r\n                  </div>\r\n                  \r\n                  <div className=\"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2\">\r\n                    <span>\r\n                      {format(new Date(record.order_date), \"yyyy-MM-dd HH:mm\")}\r\n                    </span>\r\n                    {record.total_amount && (\r\n                      <span className=\"font-medium text-foreground\">\r\n                        {record.total_amount.toFixed(2)}\r\n                      </span>\r\n                    )}\r\n                  </div>\r\n                  \r\n                  {record.delivery_address && (\r\n                    <p className=\"text-xs text-muted-foreground flex items-start gap-1\">\r\n                      <MapPin className=\"w-3 h-3 mt-0.5 flex-shrink-0\" />\r\n                      <span className=\"line-clamp-1\">{record.delivery_address}</span>\r\n                    </p>\r\n                  )}\r\n                  \r\n                  {record.notes && (\r\n                    <p className=\"text-xs text-muted-foreground mt-2 line-clamp-2\">\r\n                      {record.notes}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n            {t(\"profile.deliveryRecords.noRecords\")}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n","import { useForm } from \"react-hook-form\";\r\nimport { useEffect } from \"react\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Loader2, Ticket } from \"lucide-react\";\r\nimport { useApplyInvitationCode, useReapplyInvitationCode } from \"@/hooks/useInvitationCodes\";\r\n\r\nconst formSchema = z.object({\r\n  full_name: z.string().min(2, \"2\"),\r\n  nif: z.string().min(9, \"NIF9\").max(15, \"NIF15\"),\r\n  contact: z.string().min(5, \"5\"),\r\n  address: z.string().min(5, \"5\"),\r\n});\r\n\r\ntype FormValues = z.infer<typeof formSchema>;\r\n\r\ninterface ApplyInvitationCodeDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  mode: \"apply\" | \"reapply\";\r\n  existingData?: {\r\n    id: string;\r\n    full_name: string;\r\n    nif: string;\r\n    contact: string;\r\n    address: string;\r\n  };\r\n}\r\n\r\nexport const ApplyInvitationCodeDialog = ({\r\n  open,\r\n  onOpenChange,\r\n  mode,\r\n  existingData,\r\n}: ApplyInvitationCodeDialogProps) => {\r\n  const { t } = useTranslation();\r\n  const applyMutation = useApplyInvitationCode();\r\n  const reapplyMutation = useReapplyInvitationCode();\r\n\r\n  const form = useForm<FormValues>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      full_name: existingData?.full_name || \"\",\r\n      nif: existingData?.nif || \"\",\r\n      contact: existingData?.contact || \"\",\r\n      address: existingData?.address || \"\",\r\n    },\r\n  });\r\n\r\n  // Reset form when existingData changes or dialog opens\r\n  useEffect(() => {\r\n    if (open && existingData) {\r\n      form.reset({\r\n        full_name: existingData.full_name || \"\",\r\n        nif: existingData.nif || \"\",\r\n        contact: existingData.contact || \"\",\r\n        address: existingData.address || \"\",\r\n      });\r\n    } else if (open && !existingData) {\r\n      form.reset({\r\n        full_name: \"\",\r\n        nif: \"\",\r\n        contact: \"\",\r\n        address: \"\",\r\n      });\r\n    }\r\n  }, [open, existingData, form]);\r\n\r\n  const onSubmit = async (values: FormValues) => {\r\n    try {\r\n      const data = {\r\n        full_name: values.full_name,\r\n        nif: values.nif,\r\n        contact: values.contact,\r\n        address: values.address,\r\n      };\r\n      if (mode === \"reapply\" && existingData?.id) {\r\n        await reapplyMutation.mutateAsync({ id: existingData.id, data });\r\n      } else {\r\n        await applyMutation.mutateAsync(data);\r\n      }\r\n      onOpenChange(false);\r\n      form.reset();\r\n    } catch {\r\n      // Error handled by mutation\r\n    }\r\n  };\r\n\r\n  const isLoading = applyMutation.isPending || reapplyMutation.isPending;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Ticket className=\"w-5 h-5 text-primary\" />\r\n            {mode === \"apply\" \r\n              ? t(\"profile.invitationCode.applyTitle\", \"\")\r\n              : t(\"profile.invitationCode.reapplyTitle\", \"\")}\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            {t(\"profile.invitationCode.applyDesc\", \"\")}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <Form {...form}>\r\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\r\n            <FormField\r\n              control={form.control}\r\n              name=\"full_name\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>{t(\"profile.invitationCode.fullName\", \"\")}</FormLabel>\r\n                  <FormControl>\r\n                    <Input \r\n                      placeholder={t(\"profile.invitationCode.fullNamePlaceholder\", \"\")} \r\n                      {...field} \r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <FormField\r\n              control={form.control}\r\n              name=\"nif\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>{t(\"profile.invitationCode.nif\", \"NIF ()\")}</FormLabel>\r\n                  <FormControl>\r\n                    <Input \r\n                      placeholder={t(\"profile.invitationCode.nifPlaceholder\", \"NIF\")} \r\n                      {...field} \r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <FormField\r\n              control={form.control}\r\n              name=\"contact\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>{t(\"profile.invitationCode.contact\", \"\")}</FormLabel>\r\n                  <FormControl>\r\n                    <Input \r\n                      placeholder={t(\"profile.invitationCode.contactPlaceholder\", \"/\")} \r\n                      {...field} \r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <FormField\r\n              control={form.control}\r\n              name=\"address\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>{t(\"profile.invitationCode.address\", \"\")}</FormLabel>\r\n                  <FormControl>\r\n                    <Textarea \r\n                      placeholder={t(\"profile.invitationCode.addressPlaceholder\", \"\")} \r\n                      className=\"resize-none\"\r\n                      rows={3}\r\n                      {...field} \r\n                    />\r\n                  </FormControl>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n\r\n            <div className=\"flex justify-end gap-2 pt-4\">\r\n              <Button type=\"button\" variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n                {t(\"common.cancel\", \"\")}\r\n              </Button>\r\n              <Button type=\"submit\" disabled={isLoading}>\r\n                {isLoading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\r\n                {mode === \"apply\" \r\n                  ? t(\"profile.invitationCode.submit\", \"\")\r\n                  : t(\"profile.invitationCode.resubmit\", \"\")}\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default ApplyInvitationCodeDialog;\r\n","import { useTranslation } from \"react-i18next\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { ClipboardList, CheckCircle, Gift } from \"lucide-react\";\r\n\r\ninterface InvitationCodeHelpDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\nexport const InvitationCodeHelpDialog = ({\r\n  open,\r\n  onOpenChange,\r\n}: InvitationCodeHelpDialogProps) => {\r\n  const { t } = useTranslation();\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            {t(\"profile.invitationCode.helpTitle\", \"\")}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4\">\r\n          {/* Application Requirements */}\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center gap-2 text-primary font-medium\">\r\n              <ClipboardList className=\"h-4 w-4\" />\r\n              <span>{t(\"profile.invitationCode.helpRequirements\", \"\")}</span>\r\n            </div>\r\n            <p className=\"text-sm text-muted-foreground pl-6\">\r\n              {t(\"profile.invitationCode.helpRequirementsDesc\", \"NIF\")}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Usage Conditions */}\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center gap-2 text-primary font-medium\">\r\n              <CheckCircle className=\"h-4 w-4\" />\r\n              <span>{t(\"profile.invitationCode.helpUsage\", \"\")}</span>\r\n            </div>\r\n            <p className=\"text-sm text-muted-foreground pl-6\">\r\n              {t(\"profile.invitationCode.helpUsageDesc\", \"\\\"\\\"\\\"\\\"\")}\r\n            </p>\r\n          </div>\r\n\r\n          {/* Benefit Details */}\r\n          <div className=\"space-y-2\">\r\n            <div className=\"flex items-center gap-2 text-primary font-medium\">\r\n              <Gift className=\"h-4 w-4\" />\r\n              <span>{t(\"profile.invitationCode.helpBenefit\", \"\")}</span>\r\n            </div>\r\n            <p className=\"text-sm text-muted-foreground pl-6\">\r\n              {t(\"profile.invitationCode.helpBenefitDesc\", \"99\")}\r\n            </p>\r\n          </div>\r\n\r\n          <Separator />\r\n\r\n          {/* Copyright */}\r\n          <p className=\"text-xs text-muted-foreground text-center\">\r\n            {t(\"profile.invitationCode.copyright\", \" 2026 . \")}\r\n          </p>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\r\nimport { Copy, Check, Clock, XCircle, CheckCircle, UserPlus, RefreshCw, Users, History, ChevronDown, HelpCircle } from \"lucide-react\";\r\nimport { useMyInvitationCode, useMyInvitationCodeHistory } from \"@/hooks/useInvitationCodes\";\r\nimport { ApplyInvitationCodeDialog } from \"@/components/ApplyInvitationCodeDialog\";\r\nimport { InvitationCodeHelpDialog } from \"@/components/InvitationCodeHelpDialog\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\n\r\ninterface InvitationCodeSectionProps {\r\n  isMobile?: boolean;\r\n}\r\n\r\nconst getDateLocale = (lang: string) => {\r\n  switch (lang) {\r\n    case \"zh\": return zhCN;\r\n    case \"pt\": return pt;\r\n    default: return enUS;\r\n  }\r\n};\r\n\r\nexport const InvitationCodeSection = ({ isMobile }: InvitationCodeSectionProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { data: invitationCode, isLoading } = useMyInvitationCode();\r\n  const { data: codeHistory = [] } = useMyInvitationCodeHistory();\r\n  const [applyDialogOpen, setApplyDialogOpen] = useState(false);\r\n  const [helpDialogOpen, setHelpDialogOpen] = useState(false);\r\n  const [copied, setCopied] = useState(false);\r\n  const [historyOpen, setHistoryOpen] = useState(false);\r\n\r\n  const handleCopy = async () => {\r\n    if (invitationCode?.code) {\r\n      await navigator.clipboard.writeText(invitationCode.code);\r\n      setCopied(true);\r\n      toast({\r\n        title: t(\"profile.invitationCode.copied\", \"\"),\r\n        description: t(\"profile.invitationCode.copiedDesc\", \"\"),\r\n      });\r\n      setTimeout(() => setCopied(false), 2000);\r\n    }\r\n  };\r\n\r\n  // Filter history to show past codes (excluding current active one if approved)\r\n  const pastCodes = codeHistory.filter(code => {\r\n    // If current code is approved, exclude it from history\r\n    if (invitationCode?.status === \"approved\" && code.id === invitationCode.id) {\r\n      return false;\r\n    }\r\n    // For pending/rejected/revoked, show all in history except current\r\n    if (code.id === invitationCode?.id) {\r\n      return false;\r\n    }\r\n    return true;\r\n  });\r\n\r\n  const getStatusBadge = (status: string, reason?: string | null) => {\r\n    switch (status) {\r\n      case \"pending\":\r\n        return (\r\n          <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            {t(\"profile.invitationCode.pending\", \"\")}\r\n          </Badge>\r\n        );\r\n      case \"approved\":\r\n        return (\r\n          <Badge variant=\"outline\" className=\"text-primary border-primary\">\r\n            <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"profile.invitationCode.approved\", \"\")}\r\n          </Badge>\r\n        );\r\n      case \"rejected\":\r\n        return (\r\n          <Badge variant=\"destructive\">\r\n            <XCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"profile.invitationCode.rejected\", \"\")}\r\n          </Badge>\r\n        );\r\n      case \"revoked\":\r\n        return (\r\n          <Badge variant=\"outline\" className=\"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50\">\r\n            <XCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"profile.invitationCode.revoked\", \"\")}\r\n          </Badge>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  };\r\n\r\n  const renderHistorySection = () => {\r\n    if (pastCodes.length === 0) return null;\r\n\r\n    return (\r\n      <Collapsible open={historyOpen} onOpenChange={setHistoryOpen} className=\"mt-4\">\r\n        <CollapsibleTrigger asChild>\r\n          <Button variant=\"ghost\" size=\"sm\" className=\"w-full justify-between text-muted-foreground hover:text-foreground\">\r\n            <span className=\"flex items-center gap-2\">\r\n              <History className=\"w-4 h-4\" />\r\n              {t(\"profile.invitationCode.history\", \"\")} ({pastCodes.length})\r\n            </span>\r\n            <ChevronDown className={`w-4 h-4 transition-transform ${historyOpen ? \"rotate-180\" : \"\"}`} />\r\n          </Button>\r\n        </CollapsibleTrigger>\r\n        <CollapsibleContent className=\"mt-2 space-y-2\">\r\n          {pastCodes.map((code) => (\r\n            <div \r\n              key={code.id} \r\n              className=\"p-3 rounded-lg border bg-muted/30 text-sm\"\r\n            >\r\n              <div className=\"flex items-center justify-between mb-2\">\r\n                <span className=\"font-mono font-medium\">{code.code}</span>\r\n                {getStatusBadge(code.status)}\r\n              </div>\r\n              <div className=\"text-xs text-muted-foreground space-y-1\">\r\n                <p>\r\n                  {t(\"profile.invitationCode.appliedAt\", \"\")}: {formatDistanceToNow(new Date(code.created_at), { \r\n                    addSuffix: true, \r\n                    locale: getDateLocale(i18n.language) \r\n                  })}\r\n                </p>\r\n                {code.reviewed_at && (\r\n                  <p>\r\n                    {t(\"profile.invitationCode.reviewedAt\", \"\")}: {formatDistanceToNow(new Date(code.reviewed_at), { \r\n                      addSuffix: true, \r\n                      locale: getDateLocale(i18n.language) \r\n                    })}\r\n                  </p>\r\n                )}\r\n                {code.rejection_reason && (\r\n                  <p className=\"text-destructive\">\r\n                    {t(\"profile.invitationCode.reason\", \"\")}: {code.rejection_reason}\r\n                  </p>\r\n                )}\r\n                {code.status === \"approved\" && (\r\n                  <p>\r\n                    {t(\"profile.invitationCode.usageCount\", \"\")}: {code.usage_count} {t(\"profile.invitationCode.people\", \"\")}\r\n                  </p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </CollapsibleContent>\r\n      </Collapsible>\r\n    );\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Card>\r\n        <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n          <Skeleton className=\"h-6 w-32\" />\r\n          <Skeleton className=\"h-4 w-48 mt-2\" />\r\n        </CardHeader>\r\n        <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n          <Skeleton className=\"h-20 w-full\" />\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // No application yet - show apply button\r\n  if (!invitationCode) {\r\n    return (\r\n      <>\r\n        <Card>\r\n          <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <UserPlus className=\"w-5 h-5 text-primary\" />\r\n              {t(\"profile.invitationCode.title\", \"\")}\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setHelpDialogOpen(true)}>\r\n                <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n              </Button>\r\n            </CardTitle>\r\n            <CardDescription>\r\n              {t(\"profile.invitationCode.noCodeDesc\", \"\")}\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n            <Button onClick={() => setApplyDialogOpen(true)} className=\"w-full\">\r\n              <UserPlus className=\"w-4 h-4 mr-2\" />\r\n              {t(\"profile.invitationCode.apply\", \"\")}\r\n            </Button>\r\n            {renderHistorySection()}\r\n          </CardContent>\r\n        </Card>\r\n        <ApplyInvitationCodeDialog \r\n          open={applyDialogOpen} \r\n          onOpenChange={setApplyDialogOpen}\r\n          mode=\"apply\"\r\n        />\r\n        <InvitationCodeHelpDialog open={helpDialogOpen} onOpenChange={setHelpDialogOpen} />\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Pending status\r\n  if (invitationCode.status === \"pending\") {\r\n    return (\r\n      <Card className=\"border-yellow-500/30\">\r\n        <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n          <CardTitle className=\"flex items-center gap-2\">\r\n            <Clock className=\"w-5 h-5 text-yellow-500\" />\r\n            {t(\"profile.invitationCode.title\", \"\")}\r\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setHelpDialogOpen(true)}>\r\n              <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n            </Button>\r\n          </CardTitle>\r\n          <CardDescription>\r\n            {t(\"profile.invitationCode.pendingDesc\", \"\")}\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n          <div className=\"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4\">\r\n            <div className=\"flex items-center gap-2 mb-2\">\r\n              <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500\">\r\n                <Clock className=\"w-3 h-3 mr-1\" />\r\n                {t(\"profile.invitationCode.pending\", \"\")}\r\n              </Badge>\r\n            </div>\r\n            <p className=\"text-sm text-muted-foreground\">\r\n              {t(\"profile.invitationCode.pendingMessage\", \"\")}\r\n            </p>\r\n          </div>\r\n          {renderHistorySection()}\r\n        </CardContent>\r\n        <InvitationCodeHelpDialog open={helpDialogOpen} onOpenChange={setHelpDialogOpen} />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Rejected status\r\n  if (invitationCode.status === \"rejected\") {\r\n    return (\r\n      <>\r\n        <Card className=\"border-destructive/30\">\r\n          <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <XCircle className=\"w-5 h-5 text-destructive\" />\r\n              {t(\"profile.invitationCode.title\", \"\")}\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setHelpDialogOpen(true)}>\r\n                <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n              </Button>\r\n            </CardTitle>\r\n            <CardDescription>\r\n              {t(\"profile.invitationCode.rejectedDesc\", \"\")}\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n            <div className=\"bg-destructive/10 rounded-lg p-4 mb-4\">\r\n              <div className=\"flex items-center gap-2 mb-2\">\r\n                <Badge variant=\"destructive\">\r\n                  <XCircle className=\"w-3 h-3 mr-1\" />\r\n                  {t(\"profile.invitationCode.rejected\", \"\")}\r\n                </Badge>\r\n              </div>\r\n              {invitationCode.rejection_reason && (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  <span className=\"font-medium\">{t(\"profile.invitationCode.reason\", \"\")}:</span> {invitationCode.rejection_reason}\r\n                </p>\r\n              )}\r\n            </div>\r\n            <Button onClick={() => setApplyDialogOpen(true)} variant=\"outline\" className=\"w-full\">\r\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n              {t(\"profile.invitationCode.reapply\", \"\")}\r\n            </Button>\r\n            {renderHistorySection()}\r\n          </CardContent>\r\n        </Card>\r\n        <ApplyInvitationCodeDialog \r\n          open={applyDialogOpen} \r\n          onOpenChange={setApplyDialogOpen}\r\n          mode=\"reapply\"\r\n          existingData={{\r\n            id: invitationCode.id,\r\n            full_name: invitationCode.full_name,\r\n            nif: invitationCode.nif,\r\n            contact: invitationCode.contact || \"\",\r\n            address: invitationCode.address,\r\n          }}\r\n        />\r\n        <InvitationCodeHelpDialog open={helpDialogOpen} onOpenChange={setHelpDialogOpen} />\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Revoked status - invitation code has been revoked by admin\r\n  if (invitationCode.status === \"revoked\") {\r\n    return (\r\n      <>\r\n        <Card className=\"border-orange-500/30\">\r\n          <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <XCircle className=\"w-5 h-5 text-orange-500\" />\r\n              {t(\"profile.invitationCode.title\", \"\")}\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setHelpDialogOpen(true)}>\r\n                <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n              </Button>\r\n            </CardTitle>\r\n            <CardDescription>\r\n              {t(\"profile.invitationCode.revokedDesc\", \"\")}\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n            <div className=\"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4\">\r\n              <div className=\"flex items-center gap-2 mb-2\">\r\n                <Badge variant=\"outline\" className=\"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50\">\r\n                  <XCircle className=\"w-3 h-3 mr-1\" />\r\n                  {t(\"profile.invitationCode.revoked\", \"\")}\r\n                </Badge>\r\n              </div>\r\n              {invitationCode.rejection_reason && (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  <span className=\"font-medium\">{t(\"profile.invitationCode.reason\", \"\")}:</span> {invitationCode.rejection_reason}\r\n                </p>\r\n              )}\r\n              <p className=\"text-sm text-muted-foreground mt-2\">\r\n                {t(\"profile.invitationCode.revokedMessage\", \"\")}\r\n              </p>\r\n            </div>\r\n            <Button onClick={() => setApplyDialogOpen(true)} variant=\"outline\" className=\"w-full\">\r\n              <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n              {t(\"profile.invitationCode.reapply\", \"\")}\r\n            </Button>\r\n            {renderHistorySection()}\r\n          </CardContent>\r\n        </Card>\r\n        <ApplyInvitationCodeDialog \r\n          open={applyDialogOpen} \r\n          onOpenChange={setApplyDialogOpen}\r\n          mode=\"reapply\"\r\n          existingData={{\r\n            id: invitationCode.id,\r\n            full_name: invitationCode.full_name,\r\n            nif: invitationCode.nif,\r\n            contact: invitationCode.contact || \"\",\r\n            address: invitationCode.address,\r\n          }}\r\n        />\r\n        <InvitationCodeHelpDialog open={helpDialogOpen} onOpenChange={setHelpDialogOpen} />\r\n      </>\r\n    );\r\n  }\r\n\r\n  // Approved status - show code\r\n  return (\r\n    <>\r\n    <Card className=\"border-primary/30\">\r\n      <CardHeader className={isMobile ? \"p-4\" : \"\"}>\r\n        <CardTitle className=\"flex items-center gap-2\">\r\n          <CheckCircle className=\"w-5 h-5 text-primary\" />\r\n          {t(\"profile.invitationCode.title\", \"\")}\r\n          <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\" onClick={() => setHelpDialogOpen(true)}>\r\n            <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n          </Button>\r\n        </CardTitle>\r\n        <CardDescription>\r\n          {t(\"profile.invitationCode.approvedDesc\", \"\")}\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className={isMobile ? \"px-4 pb-4\" : \"\"}>\r\n        <div className=\"bg-primary/10 rounded-lg p-4 mb-4\">\r\n          <div className=\"flex items-center justify-between gap-4\">\r\n            <div>\r\n              <p className=\"text-xs text-muted-foreground mb-1\">\r\n                {t(\"profile.invitationCode.yourCode\", \"\")}\r\n              </p>\r\n              <p className=\"text-2xl font-mono font-bold text-primary tracking-wider\">\r\n                {invitationCode.code}\r\n              </p>\r\n            </div>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"icon\"\r\n              onClick={handleCopy}\r\n              className=\"flex-shrink-0\"\r\n            >\r\n              {copied ? (\r\n                <Check className=\"w-4 h-4 text-primary\" />\r\n              ) : (\r\n                <Copy className=\"w-4 h-4\" />\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n          <Users className=\"w-4 h-4\" />\r\n          <span>\r\n            {t(\"profile.invitationCode.usageCount\", \"\")}: {invitationCode.usage_count} {t(\"profile.invitationCode.people\", \"\")}\r\n          </span>\r\n        </div>\r\n        {renderHistorySection()}\r\n      </CardContent>\r\n    </Card>\r\n    <InvitationCodeHelpDialog open={helpDialogOpen} onOpenChange={setHelpDialogOpen} />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default InvitationCodeSection;\r\n","import { Link } from \"react-router-dom\";\r\nimport { ActivityFavoriteDialog } from \"@/components/ActivityFavoriteDialog\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { memo, useState, useEffect, useCallback } from \"react\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\r\nimport { Carousel, CarouselContent, CarouselItem, CarouselApi } from \"@/components/ui/carousel\";\r\nimport { Heart, Star, Calendar, MessageSquare, Store, Users, MapPin, User, Ticket, Coins, History, ShoppingBag, AlertCircle, Clock, UserPlus, FileText } from \"lucide-react\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useFavorites } from \"@/hooks/useFavorites\";\r\nimport { useUserComments } from \"@/hooks/useUserComments\";\r\nimport { useSubscriptions } from \"@/hooks/useActivities\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { useMerchantActivities } from \"@/hooks/useMerchantActivities\";\r\nimport { useUserCoupons } from \"@/hooks/useCoupons\";\r\nimport { useCommunityPosts } from \"@/hooks/useCommunityPosts\";\r\nimport PostGridCard from \"@/components/community/PostGridCard\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport EditProfileDialog from \"@/components/EditProfileDialog\";\r\nimport AddressManagement from \"@/components/AddressManagement\";\r\nimport ActivityTermsAgreement from \"@/components/ActivityTermsAgreement\";\r\nimport { CouponDetailDialog } from \"@/components/CouponDetailDialog\";\r\nimport { PointsHistoryDialog } from \"@/components/PointsHistoryDialog\";\r\nimport { BookingRecords } from \"@/components/BookingRecords\";\r\nimport { DeliveryRecords } from \"@/components/DeliveryRecords\";\r\nimport { formatDistanceToNow, format } from \"date-fns\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { InvitationCodeSection } from \"@/components/InvitationCodeSection\";\r\nimport { useEnvironment } from \"@/hooks/useEnvironment\";\r\n\r\n// Memoized Comment Item Component\r\nconst CommentItem = memo(({ \r\n  comment, \r\n  getLocalizedField,\r\n  t\r\n}: { \r\n  comment: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: any;\r\n}) => {\r\n  const isFailed = comment.moderation_status === \"flagged\";\r\n  const isPending = comment.moderation_status === \"pending\";\r\n  \r\n  // Parse risk reasons with localized labels\r\n  const getRiskReasonText = () => {\r\n    if (!comment.risk_reasons || !Array.isArray(comment.risk_reasons)) return null;\r\n    \r\n    const labels: Record<string, string> = {\r\n      spam: t(\"riskReason.spam\"),\r\n      offensive: t(\"riskReason.offensive\"),\r\n      harassment: t(\"riskReason.harassment\"),\r\n      fake_review: t(\"riskReason.fakeReview\"),\r\n      flooding: t(\"riskReason.flooding\"),\r\n      irrelevant: t(\"riskReason.irrelevant\"),\r\n      sensitive_word_detected: t(\"riskReason.sensitiveWord\"),\r\n      parse_error: t(\"riskReason.parseError\"),\r\n    };\r\n    \r\n    return comment.risk_reasons.map((reason: string) => labels[reason] || reason).join(\", \");\r\n  };\r\n  \r\n  return (\r\n    <div className=\"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow\">\r\n      <Link\r\n        to={`/${comment.target_type}/${comment.target_id}`}\r\n        className=\"block\"\r\n      >\r\n        <div className=\"flex items-start justify-between mb-2 gap-2\">\r\n          <h3 className=\"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1\">\r\n            {getLocalizedField(comment, \"target_name\")}\r\n          </h3>\r\n          <span className=\"text-xs md:text-sm text-muted-foreground whitespace-nowrap\">\r\n            {formatDistanceToNow(new Date(comment.created_at), {\r\n              addSuffix: true,\r\n            })}\r\n          </span>\r\n        </div>\r\n        <p className=\"text-muted-foreground line-clamp-2 text-sm md:text-base\">{comment.content}</p>\r\n        {comment.image_url && (\r\n          <img\r\n            src={comment.image_url}\r\n            alt=\"Comment\"\r\n            className=\"mt-2 rounded-lg max-w-full md:max-w-xs\"\r\n            loading=\"lazy\"\r\n          />\r\n        )}\r\n      </Link>\r\n      \r\n      {/* Status badges */}\r\n      {isPending && (\r\n        <div className=\"mt-2 flex items-center gap-2\">\r\n          <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            {t(\"restaurant.commentPending\")}\r\n          </Badge>\r\n        </div>\r\n      )}\r\n      \r\n      {isFailed && (\r\n        <div className=\"mt-2 space-y-1.5\">\r\n          <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs\">\r\n            <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"restaurant.commentFailed\")}\r\n          </Badge>\r\n          {getRiskReasonText() && (\r\n            <p className=\"text-xs text-destructive/80 pl-0.5\">\r\n              {t(\"restaurant.failReason\")}: {getRiskReasonText()}\r\n            </p>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCommentItem.displayName = \"CommentItem\";\r\n\r\n// Memoized Favorite Restaurant Item Component\r\nconst FavoriteRestaurantItem = memo(({ \r\n  restaurant, \r\n  getLocalizedField,\r\n  t\r\n}: { \r\n  restaurant: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n}) => {\r\n  // Skip rendering if restaurant is invalid\r\n  if (!restaurant || !restaurant.id) {\r\n    return null;\r\n  }\r\n  \r\n  const restaurantName = getLocalizedField(restaurant, \"name\") || restaurant.name || \"\";\r\n  const restaurantType = Array.isArray(restaurant.type) \r\n    ? restaurant.type.join(\"  \") \r\n    : (restaurant.type || \"\");\r\n  \r\n  return (\r\n    <Link\r\n      to={`/restaurant/${restaurant.id}`}\r\n      state={{ from: \"profile\" }}\r\n      className=\"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow\"\r\n    >\r\n      <div className=\"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0\">\r\n        <img\r\n          src={restaurant.image_url || \"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80\"}\r\n          alt={String(restaurantName)}\r\n          className=\"w-full h-full object-cover\"\r\n          loading=\"lazy\"\r\n          onError={(e) => {\r\n            e.currentTarget.src = \"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80\";\r\n          }}\r\n        />\r\n      </div>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <h3 className=\"font-semibold text-base md:text-lg text-card-foreground line-clamp-1\">\r\n          {restaurantName}\r\n        </h3>\r\n        <p className=\"text-muted-foreground text-sm mb-2 line-clamp-1\">\r\n          {restaurantType}\r\n        </p>\r\n        <div className=\"flex items-center gap-1\">\r\n          <Star className={`w-4 h-4 ${restaurant.rating ? \"fill-accent text-accent\" : \"text-muted-foreground\"}`} />\r\n          {restaurant.rating ? (\r\n            <span className=\"font-medium\">{restaurant.rating.toFixed(1)}</span>\r\n          ) : (\r\n            <span className=\"text-xs text-muted-foreground text-center whitespace-nowrap\">\r\n              {t(\"restaurant.noRatingLine1\")}<br />{t(\"restaurant.noRatingLine2\")}\r\n            </span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </Link>\r\n  );\r\n});\r\nFavoriteRestaurantItem.displayName = \"FavoriteRestaurantItem\";\r\n\r\n// Memoized Activity Subscription Item Component\r\nconst ActivitySubscriptionItem = memo(({ \r\n  subscription, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  subscription: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const [dialogOpen, setDialogOpen] = useState(false);\r\n  \r\n  return (\r\n    <>\r\n      <div\r\n        onClick={() => setDialogOpen(true)}\r\n        className={`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${isMobile ? \"p-3\" : \"p-4\"}`}\r\n      >\r\n        <div className={`flex items-start ${isMobile ? \"gap-3\" : \"gap-4\"}`}>\r\n          {subscription.activity?.image_url && (\r\n            <img\r\n              src={subscription.activity.image_url}\r\n              alt={String(getLocalizedField(subscription.activity, \"title\"))}\r\n              className={`rounded-lg object-cover flex-shrink-0 ${isMobile ? \"w-20 h-20\" : \"w-24 h-24\"}`}\r\n              loading=\"lazy\"\r\n            />\r\n          )}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n              {getLocalizedField(subscription.activity, \"title\")}\r\n            </h3>\r\n            <div \r\n              className={`text-muted-foreground line-clamp-2 prose max-w-none ${isMobile ? \"text-xs prose-xs\" : \"text-sm prose-sm\"}`}\r\n              dangerouslySetInnerHTML={{ \r\n                __html: getLocalizedField(subscription.activity, \"content\") \r\n              }}\r\n            />\r\n            <p className={`text-muted-foreground mt-2 ${isMobile ? \"text-xs\" : \"text-xs\"}`}>\r\n              {t(\"profile.joinedOn\")}:{\" \"}\r\n              {formatDistanceToNow(new Date(subscription.created_at), {\r\n                addSuffix: true,\r\n              })}\r\n            </p>\r\n          </div>\r\n          <Heart className={`text-primary fill-primary flex-shrink-0 ${isMobile ? \"w-4 h-4\" : \"w-5 h-5\"}`} />\r\n        </div>\r\n      </div>\r\n      \r\n      <ActivityFavoriteDialog\r\n        open={dialogOpen}\r\n        onOpenChange={setDialogOpen}\r\n        activity={{\r\n          title: String(getLocalizedField(subscription.activity, \"title\")),\r\n          image_url: subscription.activity?.image_url,\r\n          content: String(getLocalizedField(subscription.activity, \"content\")),\r\n        }}\r\n      />\r\n    </>\r\n  );\r\n});\r\nActivitySubscriptionItem.displayName = \"ActivitySubscriptionItem\";\r\n\r\n// Memoized Merchant Activity Participation Item - grouped by activity\r\nconst MerchantActivityItem = memo(({ \r\n  activityGroup, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  activityGroup: {\r\n    activity: any;\r\n    restaurants: Array<{\r\n      id: string;\r\n      name: string;\r\n      name_en: string | null;\r\n      name_pt: string | null;\r\n    }>;\r\n    participationDate: string;\r\n  };\r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const activity = activityGroup.activity;\r\n  const restaurants = activityGroup.restaurants;\r\n  \r\n  return (\r\n    <div className={`rounded-lg border hover:shadow-medium transition-shadow ${isMobile ? \"p-3\" : \"p-4\"}`}>\r\n      <Link\r\n        to={`/activity/${activity.id}`}\r\n        className={isMobile ? \"block mb-2\" : \"block mb-3\"}\r\n      >\r\n        <div className={`flex items-start ${isMobile ? \"gap-3\" : \"gap-4\"}`}>\r\n          {activity.image_url && (\r\n            <img\r\n              src={activity.image_url}\r\n              alt={String(getLocalizedField(activity, \"title\"))}\r\n              className={`rounded-lg object-cover flex-shrink-0 ${isMobile ? \"w-20 h-20\" : \"w-24 h-24\"}`}\r\n              loading=\"lazy\"\r\n            />\r\n          )}\r\n          <div className=\"flex-1 min-w-0\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n              {getLocalizedField(activity, \"title\")}\r\n            </h3>\r\n            <div \r\n              className={`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${isMobile ? \"text-xs prose-xs\" : \"text-sm prose-sm\"}`}\r\n              dangerouslySetInnerHTML={{ \r\n                __html: getLocalizedField(activity, \"content\") \r\n              }}\r\n            />\r\n            <div className=\"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap\">\r\n              <span className=\"flex items-center gap-1\">\r\n                <Calendar className=\"w-3 h-3\" />\r\n                {new Date(activity.start_date).toLocaleDateString()}\r\n              </span>\r\n              {activity.end_date && (\r\n                <span>\r\n                  - {new Date(activity.end_date).toLocaleDateString()}\r\n                </span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Link>\r\n      \r\n      {/* Participating restaurants list */}\r\n      <div className={`pt-2 md:pt-3 border-t ${isMobile ? \"mt-2\" : \"mt-3\"}`}>\r\n        <div className={`flex items-center gap-2 ${isMobile ? \"mb-1.5\" : \"mb-2\"}`}>\r\n          <Store className={`text-primary ${isMobile ? \"w-3.5 h-3.5\" : \"w-4 h-4\"}`} />\r\n          <span className={`font-medium text-foreground ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n            {t(\"profile.participatingRestaurants\")} ({restaurants.length})\r\n          </span>\r\n        </div>\r\n        <div className={`flex flex-wrap ${isMobile ? \"gap-1.5\" : \"gap-2\"}`}>\r\n          {restaurants.map((restaurant) => (\r\n            <Badge \r\n              key={restaurant.id}\r\n              variant=\"secondary\"\r\n              className={isMobile ? \"text-xs px-2 py-0.5\" : \"text-xs\"}\r\n            >\r\n              {getLocalizedField(restaurant, \"name\")}\r\n            </Badge>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nMerchantActivityItem.displayName = \"MerchantActivityItem\";\r\n\r\n// Memoized User Coupon Item Component\r\nconst UserCouponItem = memo(({ \r\n  coupon, \r\n  getLocalizedField,\r\n  t,\r\n  isMobile\r\n}: { \r\n  coupon: any; \r\n  getLocalizedField: (obj: any, field: string) => any;\r\n  t: (key: string) => string;\r\n  isMobile?: boolean;\r\n}) => {\r\n  const [detailsOpen, setDetailsOpen] = useState(false);\r\n  const template = coupon.coupon_codes?.coupon_templates;\r\n  const code = coupon.coupon_codes?.code;\r\n  const isUsed = !!coupon.used_at;\r\n  \r\n  return (\r\n    <>\r\n      <div \r\n        className={`rounded-lg border transition-shadow cursor-pointer ${\r\n          isUsed ? 'bg-muted/30' : 'hover:shadow-medium'\r\n        } ${isMobile ? \"p-3\" : \"p-4\"}`}\r\n        onClick={() => setDetailsOpen(true)}\r\n      >\r\n        <div className=\"flex items-start justify-between gap-3 mb-2\">\r\n          <div className=\"flex-1\">\r\n            <h3 className={`font-semibold text-card-foreground mb-1 ${isMobile ? \"text-sm\" : \"text-base\"}`}>\r\n              {getLocalizedField(template, \"title\")}\r\n            </h3>\r\n            <p className={`text-muted-foreground line-clamp-2 ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n              {getLocalizedField(template, \"description\")}\r\n            </p>\r\n          </div>\r\n          <Badge variant={isUsed ? \"secondary\" : \"default\"} className={isMobile ? \"text-xs\" : \"\"}>\r\n            {isUsed ? t(\"profile.coupons.used\") : t(\"profile.coupons.available\")}\r\n          </Badge>\r\n        </div>\r\n        \r\n        <div className={`flex items-center gap-2 mb-2 ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n          <span className=\"font-mono bg-secondary/50 px-2 py-1 rounded\">\r\n            {code}\r\n          </span>\r\n          <span className=\"text-muted-foreground\">\r\n            {template?.discount_type === \"percentage\" \r\n              ? `${template?.discount_value}%` \r\n              : `${template?.discount_value}`}\r\n          </span>\r\n        </div>\r\n        \r\n        <div className={`text-muted-foreground ${isMobile ? \"text-xs\" : \"text-sm\"}`}>\r\n          {isUsed ? (\r\n            <span>{t(\"profile.coupons.usedOn\")}: {format(new Date(coupon.used_at), \"yyyy-MM-dd HH:mm\")}</span>\r\n          ) : template?.valid_until ? (\r\n            <span>{t(\"profile.coupons.validUntil\")}: {format(new Date(template.valid_until), \"yyyy-MM-dd\")}</span>\r\n          ) : (\r\n            <span>{t(\"profile.coupons.noExpiry\")}</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n      \r\n      <CouponDetailDialog \r\n        open={detailsOpen}\r\n        onOpenChange={setDetailsOpen}\r\n        coupon={coupon}\r\n      />\r\n    </>\r\n  );\r\n});\r\nUserCouponItem.displayName = \"UserCouponItem\";\r\n\r\nconst Profile = () => {\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const isMobile = useIsMobile();\r\n  const { isWebView } = useEnvironment();\r\n  const { data: profile, isLoading: profileLoading } = useProfile();\r\n  const { data: favorites, isLoading: favoritesLoading } = useFavorites();\r\n  const { data: comments, isLoading: commentsLoading } = useUserComments();\r\n  const { data: subscriptions, isLoading: subscriptionsLoading } = useSubscriptions();\r\n  const { data: merchantActivities, isLoading: merchantActivitiesLoading } = useMerchantActivities();\r\n  const { data: userCoupons, isLoading: couponsLoading } = useUserCoupons();\r\n  const { data: userPosts, isLoading: postsLoading } = useCommunityPosts({ authorId: user?.id });\r\n  const { role, isMerchant, isSupervisor, isAdmin } = useUserRole();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const { settings: siteSettings } = useSiteSettings();\r\n  \r\n  const isMerchantOrSupervisor = isMerchant || isSupervisor;\r\n  \r\n  // Mobile tab state\r\n  const [activeTab, setActiveTab] = useState(\"profile\");\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [scrollPositions, setScrollPositions] = useState<Record<string, number>>({});\r\n  const [visitedTabs, setVisitedTabs] = useState<Set<string>>(new Set([\"profile\"]));\r\n  \r\n  const tabs = isMerchantOrSupervisor ? [\r\n    { value: \"profile\", label: t(\"profile.profile\"), icon: User },\r\n    { value: \"favorites\", label: t(\"profile.favorites\"), icon: Heart },\r\n    { value: \"comments\", label: t(\"profile.comments\"), icon: MessageSquare },\r\n    { value: \"activities\", label: t(\"profile.participatedActivities\"), icon: Calendar },\r\n  ] : [\r\n    { value: \"profile\", label: t(\"profile.profile\"), icon: User },\r\n    { value: \"favorites\", label: t(\"profile.favorites\"), icon: Heart },\r\n    { value: \"comments\", label: t(\"profile.comments\"), icon: MessageSquare },\r\n  ];\r\n\r\n  // Save current scroll position\r\n  const saveScrollPosition = (tabValue: string) => {\r\n    setScrollPositions(prev => ({\r\n      ...prev,\r\n      [tabValue]: window.scrollY\r\n    }));\r\n  };\r\n\r\n  // Restore scroll position or scroll to top for new tabs\r\n  // Use requestAnimationFrame to avoid visual glitches during carousel transitions\r\n  const restoreScrollPosition = (tabValue: string) => {\r\n    if (visitedTabs.has(tabValue)) {\r\n      // Restore previous position after carousel animation settles\r\n      const savedPosition = scrollPositions[tabValue] || 0;\r\n      requestAnimationFrame(() => {\r\n        requestAnimationFrame(() => {\r\n          window.scrollTo({ top: savedPosition, behavior: 'instant' });\r\n        });\r\n      });\r\n    } else {\r\n      // New tab, scroll to top\r\n      requestAnimationFrame(() => {\r\n        requestAnimationFrame(() => {\r\n          window.scrollTo({ top: 0, behavior: 'instant' });\r\n        });\r\n      });\r\n      setVisitedTabs(prev => new Set([...prev, tabValue]));\r\n    }\r\n  };\r\n\r\n  // Sync carousel with active tab\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    const handleSelect = () => {\r\n      const index = carouselApi.selectedScrollSnap();\r\n      const newTab = tabs[index].value;\r\n      \r\n      if (newTab !== activeTab) {\r\n        // Save current tab's scroll position before switching\r\n        saveScrollPosition(activeTab);\r\n        // Restore new tab's scroll position\r\n        restoreScrollPosition(newTab);\r\n        setActiveTab(newTab);\r\n      }\r\n    };\r\n    \r\n    carouselApi.on(\"select\", handleSelect);\r\n    return () => {\r\n      carouselApi.off(\"select\", handleSelect);\r\n    };\r\n  }, [carouselApi, activeTab, scrollPositions, visitedTabs]);\r\n\r\n  const handleTabClick = (tabValue: string) => {\r\n    if (tabValue === activeTab) return;\r\n    \r\n    // Save current tab's scroll position\r\n    saveScrollPosition(activeTab);\r\n    \r\n    const index = tabs.findIndex(t => t.value === tabValue);\r\n    if (index !== -1 && carouselApi) {\r\n      carouselApi.scrollTo(index);\r\n    }\r\n    \r\n    // Restore new tab's scroll position\r\n    restoreScrollPosition(tabValue);\r\n    setActiveTab(tabValue);\r\n  };\r\n\r\n  const queryClient = useQueryClient();\r\n\r\n  // Pull-to-refresh handler - clears all caches and forces fresh data\r\n  const handleRefresh = useCallback(async () => {\r\n    // Clear all profile-related caches first\r\n    queryClient.removeQueries({ queryKey: ['profile'] });\r\n    queryClient.removeQueries({ queryKey: ['favorites'] });\r\n    queryClient.removeQueries({ queryKey: ['favorites-restaurants'] });\r\n    queryClient.removeQueries({ queryKey: ['user-comments'] });\r\n    queryClient.removeQueries({ queryKey: ['subscriptions'] });\r\n    queryClient.removeQueries({ queryKey: ['user-coupons'] });\r\n    queryClient.removeQueries({ queryKey: ['merchant-activities'] });\r\n    queryClient.removeQueries({ queryKey: ['user-points'] });\r\n    queryClient.removeQueries({ queryKey: ['community-posts'] });\r\n    \r\n    // Refetch with fresh data\r\n    await Promise.all([\r\n      queryClient.invalidateQueries({ queryKey: ['profile'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['favorites'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['favorites-restaurants'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-comments'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['subscriptions'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-coupons'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['merchant-activities'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['user-points'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['community-posts'] }),\r\n    ]);\r\n  }, [queryClient]);\r\n\r\n  if (!user || profileLoading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-secondary/20 py-8 px-4\">\r\n        <div className=\"container mx-auto max-w-6xl\">\r\n          <div className=\"text-center\">{t(\"common.loading\")}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const roleDisplay = role ? t(`profile.role.${role}`) : t(\"profile.role.user\");\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n    <div className={`min-h-screen bg-secondary/20 ${isMobile ? \"pb-20 pt-4\" : \"py-4 md:py-8 px-3 md:px-4\"}`}>\r\n      <div className={`container mx-auto max-w-6xl ${isMobile ? \"px-3\" : \"\"}`}>\r\n        {/* Desktop/Tablet: Profile Header */}\r\n        {!isMobile && (\r\n          <>\r\n            <Card className=\"mb-6 md:mb-8\">\r\n            <CardContent className=\"pt-4 md:pt-6 pb-4 md:pb-6\">\r\n              <div className=\"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6\">\r\n                <Avatar className=\"w-24 h-24\">\r\n                  <AvatarImage src={profile?.avatar_url || \"\"} />\r\n                  <AvatarFallback className=\"text-3xl\">\r\n                    {profile?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n                  </AvatarFallback>\r\n                </Avatar>\r\n                <div className=\"flex-1 text-center md:text-left\">\r\n                  <h1 className=\"text-3xl font-bold mb-2 text-foreground\">\r\n                    {profile?.display_name}\r\n                  </h1>\r\n                  <p className=\"text-muted-foreground mb-2 md:mb-3\">\r\n                    {user.email}\r\n                  </p>\r\n                  {profile?.phone && (\r\n                    <p className=\"text-muted-foreground mb-2 md:mb-3\">\r\n                      {profile.phone}\r\n                    </p>\r\n                  )}\r\n                  {role && role !== 'user' && (\r\n                    <Badge className=\"bg-primary capitalize\">\r\n                      {roleDisplay}\r\n                    </Badge>\r\n                  )}\r\n                  {/* Points display */}\r\n                  <div className=\"flex items-center gap-2 mt-2\">\r\n                    <Coins className=\"h-5 w-5 text-amber-500\" />\r\n                    <span className=\"font-semibold text-lg\">{profile?.points || 0}</span>\r\n                    <span className=\"text-muted-foreground\">{t(\"profile.points\")}</span>\r\n                    <PointsHistoryDialog />\r\n                    {(siteSettings?.shop_enabled !== false || isAdmin) && (\r\n                      <Link \r\n                        to=\"/shop\" \r\n                        className=\"ml-2 inline-flex items-center gap-1 text-sm text-primary hover:underline\"\r\n                      >\r\n                        <ShoppingBag className=\"h-4 w-4\" />\r\n                        {t(\"profile.pointsShop\")}\r\n                      </Link>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {/* Buttons container - horizontal layout */}\r\n                <div className=\"flex flex-col sm:flex-row gap-2 items-start\">\r\n                  {profile && <EditProfileDialog profile={profile} />}\r\n                  {/* Activity Terms Agreement for merchants/supervisors - Desktop */}\r\n                  {isMerchantOrSupervisor && profile && (\r\n                    <ActivityTermsAgreement \r\n                      isAgreed={profile?.activity_terms_agreed || false}\r\n                      agreedAt={profile?.activity_terms_agreed_at || null}\r\n                    />\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n          </>\r\n        )}\r\n\r\n        {/* Tabs */}\r\n        {isMobile ? (\r\n          <>\r\n            {/* Mobile: Swipeable content carousel */}\r\n            <Carousel \r\n              setApi={setCarouselApi}\r\n              opts={{\r\n                align: \"start\",\r\n                loop: false,\r\n              }}\r\n              className=\"w-full\"\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {/* Profile Tab */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4 space-y-4\">\r\n                    <Card>\r\n                      <CardContent className=\"pt-6 pb-6\">\r\n                        <div className=\"flex flex-col items-center gap-4\">\r\n                          <Avatar className=\"w-20 h-20\">\r\n                            <AvatarImage src={profile?.avatar_url || \"\"} />\r\n                            <AvatarFallback className=\"text-2xl\">\r\n                              {profile?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n                            </AvatarFallback>\r\n                          </Avatar>\r\n                          <div className=\"flex-1 text-center w-full\">\r\n                            <h1 className=\"text-2xl font-bold mb-2 text-foreground\">\r\n                              {profile?.display_name}\r\n                            </h1>\r\n                            <p className=\"text-muted-foreground text-sm mb-2\">\r\n                              {user.email}\r\n                            </p>\r\n                            {/* Mobile Points display */}\r\n                            <div className=\"flex items-center justify-center gap-2 mb-1\">\r\n                              <Coins className=\"h-4 w-4 text-amber-500\" />\r\n                              <span className=\"font-semibold\">{profile?.points || 0}</span>\r\n                              <span className=\"text-muted-foreground text-sm\">{t(\"profile.points\")}</span>\r\n                              <PointsHistoryDialog />\r\n                            </div>\r\n                            {(siteSettings?.shop_enabled !== false || isAdmin) && (\r\n                              <Link \r\n                                to=\"/shop\" \r\n                                className=\"inline-flex items-center justify-center gap-1 text-xs text-primary hover:underline mb-2\"\r\n                              >\r\n                                <ShoppingBag className=\"h-3 w-3\" />\r\n                                {t(\"profile.pointsShop\")}\r\n                              </Link>\r\n                            )}\r\n                            {profile?.phone && (\r\n                              <p className=\"text-muted-foreground text-sm mb-3\">\r\n                                {profile.phone}\r\n                              </p>\r\n                            )}\r\n                            {role && role !== 'user' && (\r\n                              <Badge className=\"bg-primary capitalize text-xs mb-4\">\r\n                                {roleDisplay}\r\n                              </Badge>\r\n                            )}\r\n                            {profile && (\r\n                              <div className=\"mt-4 flex flex-col sm:flex-row gap-2 w-full\">\r\n                                <EditProfileDialog profile={profile} />\r\n                                {/* Activity Terms Agreement for merchants/supervisors - Mobile */}\r\n                                {isMerchantOrSupervisor && (\r\n                                  <ActivityTermsAgreement \r\n                                    isAgreed={profile?.activity_terms_agreed || false}\r\n                                    agreedAt={profile?.activity_terms_agreed_at || null}\r\n                                  />\r\n                                )}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </div>\r\n                      </CardContent>\r\n                    </Card>\r\n                    \r\n                    {/* Invitation Code Section */}\r\n                    <InvitationCodeSection isMobile={true} />\r\n                    \r\n                    {/* My Coupons Section */}\r\n                    <Card>\r\n                      <CardHeader className=\"pb-3\">\r\n                        <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                          <Ticket className=\"w-5 h-5\" />\r\n                          {t(\"profile.coupons.title\")}\r\n                        </CardTitle>\r\n                        <CardDescription className=\"text-xs\">{t(\"profile.coupons.description\")}</CardDescription>\r\n                      </CardHeader>\r\n                      <CardContent className=\"px-3\">\r\n                        {couponsLoading ? (\r\n                          <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                        ) : userCoupons && userCoupons.length > 0 ? (\r\n                          <div className=\"space-y-3\">\r\n                            {userCoupons.map((coupon) => (\r\n                              <UserCouponItem\r\n                                key={coupon.id}\r\n                                coupon={coupon}\r\n                                getLocalizedField={getLocalizedField}\r\n                                t={t}\r\n                                isMobile={true}\r\n                              />\r\n                            ))}\r\n                          </div>\r\n                        ) : (\r\n                          <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                            {t(\"profile.coupons.noCoupons\")}{\" \"}\r\n                            <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                              {t(\"profile.coupons.browseActivities\")}\r\n                            </Link>\r\n                          </p>\r\n                        )}\r\n                      </CardContent>\r\n                    </Card>\r\n                    \r\n                    {/* My Addresses Section - without title */}\r\n                    <AddressManagement />\r\n                    \r\n                    {/* Booking Records Section */}\r\n                    <BookingRecords />\r\n                    \r\n                    {/* Delivery Records Section */}\r\n                    <DeliveryRecords />\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Favorites Tab */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4\">\r\n                    <Card>\r\n                      <CardContent className=\"pt-4\">\r\n                        <Tabs defaultValue=\"restaurants\" className=\"w-full\">\r\n                          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\r\n                            <TabsTrigger value=\"restaurants\" className=\"flex items-center gap-2 text-xs\">\r\n                              <Store className=\"w-4 h-4\" />\r\n                              {t(\"profile.restaurantFavorites\")}\r\n                              {favorites && favorites.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {favorites.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"activities\" className=\"flex items-center gap-2 text-xs\">\r\n                              <Calendar className=\"w-4 h-4\" />\r\n                              {t(\"profile.activityFavorites\")}\r\n                              {subscriptions && subscriptions.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {subscriptions.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                          </TabsList>\r\n                          \r\n                          <TabsContent value=\"restaurants\">\r\n                            {favoritesLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : favorites && favorites.length > 0 ? (\r\n                              <div className=\"grid gap-3 grid-cols-1\">\r\n                                {favorites.map((restaurant) => (\r\n                                  <FavoriteRestaurantItem\r\n                                    key={restaurant.id}\r\n                                    restaurant={restaurant}\r\n                                    getLocalizedField={getLocalizedField}\r\n                                    t={t}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">{t(\"profile.noFavorites\")}</p>\r\n                            )}\r\n                          </TabsContent>\r\n                          \r\n                          <TabsContent value=\"activities\">\r\n                            {subscriptionsLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : subscriptions && subscriptions.length > 0 ? (\r\n                              <div className=\"space-y-3\">\r\n                                {subscriptions.map((subscription) => (\r\n                                  <ActivitySubscriptionItem\r\n                                    key={subscription.id}\r\n                                    subscription={subscription}\r\n                                    getLocalizedField={getLocalizedField}\r\n                                    t={t}\r\n                                    isMobile={true}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                                {t(\"profile.noActivityFavorites\")}{\" \"}\r\n                                <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                                  {t(\"profile.browseActivities\")}\r\n                                </Link>\r\n                              </p>\r\n                            )}\r\n                          </TabsContent>\r\n                        </Tabs>\r\n                      </CardContent>\r\n                    </Card>\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Social Tab (Comments + Posts) */}\r\n                <CarouselItem className=\"pl-0\">\r\n                  <div className=\"pb-4\">\r\n                    <Card>\r\n                      <CardContent className=\"pt-4\">\r\n                        <Tabs defaultValue=\"comments\" className=\"w-full\">\r\n                          <TabsList className=\"grid w-full grid-cols-2 mb-4\">\r\n                            <TabsTrigger value=\"comments\" className=\"flex items-center gap-2 text-xs\">\r\n                              <MessageSquare className=\"w-4 h-4\" />\r\n                              {t(\"profile.myComments\")}\r\n                              {comments && comments.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {comments.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                            <TabsTrigger value=\"posts\" className=\"flex items-center gap-2 text-xs\">\r\n                              <FileText className=\"w-4 h-4\" />\r\n                              {t(\"profile.myPosts\")}\r\n                              {userPosts && userPosts.length > 0 && (\r\n                                <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                                  {userPosts.length}\r\n                                </Badge>\r\n                              )}\r\n                            </TabsTrigger>\r\n                          </TabsList>\r\n                          \r\n                          <TabsContent value=\"comments\">\r\n                            {commentsLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : comments && comments.length > 0 ? (\r\n                              <div className=\"space-y-3\">\r\n                                {comments.map((comment) => (\r\n                                  <CommentItem\r\n                                    key={comment.id}\r\n                                    comment={comment}\r\n                                    getLocalizedField={getLocalizedField}\r\n                                    t={t}\r\n                                  />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">{t(\"profile.noComments\")}</p>\r\n                            )}\r\n                          </TabsContent>\r\n                          \r\n                          <TabsContent value=\"posts\">\r\n                            {postsLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : userPosts && userPosts.length > 0 ? (\r\n                              <div className=\"space-y-3\">\r\n                                {userPosts.map((post) => (\r\n                                  <PostGridCard key={post.id} post={post} showAssociations />\r\n                                ))}\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                                {t(\"profile.noPosts\")}{\" \"}\r\n                                <Link to=\"/community\" className=\"text-primary hover:underline\">\r\n                                  {t(\"profile.browseActivities\")}\r\n                                </Link>\r\n                              </p>\r\n                            )}\r\n                          </TabsContent>\r\n                        </Tabs>\r\n                      </CardContent>\r\n                    </Card>\r\n                  </div>\r\n                </CarouselItem>\r\n                \r\n                {/* Activities Tab - Only for merchants/supervisors */}\r\n                {isMerchantOrSupervisor && (\r\n                  <CarouselItem className=\"pl-0\">\r\n                    <div className=\"pb-4\">\r\n                      <Card>\r\n                        <CardHeader className=\"pb-3\">\r\n                          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n                            <Calendar className=\"w-5 h-5\" />\r\n                            {t(\"profile.participatedActivities\")}\r\n                          </CardTitle>\r\n                          <CardDescription className=\"text-xs\">\r\n                            {t(\"profile.participatedActivitiesDesc\")}\r\n                          </CardDescription>\r\n                        </CardHeader>\r\n                        <CardContent className=\"px-3\">\r\n                          <div className=\"space-y-4\">\r\n                            {merchantActivitiesLoading ? (\r\n                              <div className=\"text-center py-8 text-sm\">{t(\"common.loading\")}</div>\r\n                            ) : merchantActivities && merchantActivities.length > 0 ? (\r\n                              <div>\r\n                                <h3 className=\"font-semibold mb-3 flex items-center gap-2 text-base\">\r\n                                  <Store className=\"w-4 h-4\" />\r\n                                  {t(\"profile.restaurantActivities\")}\r\n                                </h3>\r\n                                <div className=\"space-y-3\">\r\n                                  {(() => {\r\n                                    const activityGroups = merchantActivities.reduce((acc, participation) => {\r\n                                      const activityId = participation.activity_id;\r\n                                      if (!acc[activityId]) {\r\n                                        acc[activityId] = {\r\n                                          activity: participation.activity,\r\n                                          restaurants: [],\r\n                                          participationDate: participation.created_at\r\n                                        };\r\n                                      }\r\n                                      acc[activityId].restaurants.push({\r\n                                        id: participation.restaurant_id,\r\n                                        name: participation.restaurant_name,\r\n                                        name_en: participation.restaurant_name_en,\r\n                                        name_pt: participation.restaurant_name_pt,\r\n                                      });\r\n                                      return acc;\r\n                                    }, {} as Record<string, any>);\r\n                                    \r\n                                    return Object.values(activityGroups).map((group: any) => (\r\n                                      <MerchantActivityItem\r\n                                        key={group.activity.id}\r\n                                        activityGroup={group}\r\n                                        getLocalizedField={getLocalizedField}\r\n                                        t={t}\r\n                                        isMobile={true}\r\n                                      />\r\n                                    ));\r\n                                  })()}\r\n                                </div>\r\n                              </div>\r\n                            ) : (\r\n                              <p className=\"text-muted-foreground text-center py-8 text-sm\">\r\n                                {t(\"profile.noParticipatedActivities\")}{\" \"}\r\n                                <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                                  {t(\"profile.browseActivities\")}\r\n                                </Link>\r\n                              </p>\r\n                            )}\r\n                          </div>\r\n                        </CardContent>\r\n                      </Card>\r\n                    </div>\r\n                  </CarouselItem>\r\n                )}\r\n              </CarouselContent>\r\n            </Carousel>\r\n          </>\r\n        ) : (\r\n          <Tabs defaultValue=\"favorites\" className=\"space-y-4 md:space-y-6\">\r\n            <TabsList className={`grid w-full ${isMerchantOrSupervisor ? 'grid-cols-7' : 'grid-cols-6'} bg-card border rounded-lg shadow-sm h-auto p-1`}>\r\n              <TabsTrigger value=\"favorites\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <Heart className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.favorites\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"coupons\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <Ticket className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.coupons.title\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"comments\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <MessageSquare className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.comments\")}\r\n              </TabsTrigger>\r\n              {isMerchantOrSupervisor && (\r\n                <TabsTrigger value=\"activities\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                  <Calendar className=\"w-4 h-4 mr-2\" />\r\n                  {t(\"profile.participatedActivities\")}\r\n                </TabsTrigger>\r\n              )}\r\n              <TabsTrigger value=\"invitation-code\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <UserPlus className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.invitationCode.title\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"addresses\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <MapPin className=\"w-4 h-4 mr-2\" />\r\n                {t(\"address.myAddresses\")}\r\n              </TabsTrigger>\r\n              <TabsTrigger value=\"orders\" className=\"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm\">\r\n                <Users className=\"w-4 h-4 mr-2\" />\r\n                {t(\"profile.orderRecords\")}\r\n              </TabsTrigger>\r\n            </TabsList>\r\n\r\n          <TabsContent value=\"favorites\">\r\n            <Card>\r\n              <CardContent className=\"pt-6\">\r\n                <Tabs defaultValue=\"restaurants\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-2 mb-6\">\r\n                    <TabsTrigger value=\"restaurants\" className=\"flex items-center gap-2\">\r\n                      <Store className=\"w-4 h-4\" />\r\n                      {t(\"profile.restaurantFavorites\")}\r\n                      {favorites && favorites.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {favorites.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"activities\" className=\"flex items-center gap-2\">\r\n                      <Calendar className=\"w-4 h-4\" />\r\n                      {t(\"profile.activityFavorites\")}\r\n                      {subscriptions && subscriptions.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {subscriptions.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"restaurants\">\r\n                    {favoritesLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : favorites && favorites.length > 0 ? (\r\n                      <div className=\"grid gap-4 md:grid-cols-2\">\r\n                        {favorites.map((restaurant) => (\r\n                          <FavoriteRestaurantItem\r\n                            key={restaurant.id}\r\n                            restaurant={restaurant}\r\n                            getLocalizedField={getLocalizedField}\r\n                            t={t}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"profile.noFavorites\")}</p>\r\n                    )}\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"activities\">\r\n                    {subscriptionsLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : subscriptions && subscriptions.length > 0 ? (\r\n                      <div className=\"space-y-4\">\r\n                        {subscriptions.map((subscription) => (\r\n                          <ActivitySubscriptionItem\r\n                            key={subscription.id}\r\n                            subscription={subscription}\r\n                            getLocalizedField={getLocalizedField}\r\n                            t={t}\r\n                            isMobile={isMobile}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">\r\n                        {t(\"profile.noActivityFavorites\")}{\" \"}\r\n                        <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                          {t(\"profile.browseActivities\")}\r\n                        </Link>\r\n                      </p>\r\n                    )}\r\n                  </TabsContent>\r\n                </Tabs>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"comments\">\r\n            <Card>\r\n              <CardContent className=\"pt-6\">\r\n                <Tabs defaultValue=\"comments\" className=\"w-full\">\r\n                  <TabsList className=\"grid w-full grid-cols-2 mb-6\">\r\n                    <TabsTrigger value=\"comments\" className=\"flex items-center gap-2\">\r\n                      <MessageSquare className=\"w-4 h-4\" />\r\n                      {t(\"profile.myComments\")}\r\n                      {comments && comments.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {comments.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                    <TabsTrigger value=\"posts\" className=\"flex items-center gap-2\">\r\n                      <FileText className=\"w-4 h-4\" />\r\n                      {t(\"profile.myPosts\")}\r\n                      {userPosts && userPosts.length > 0 && (\r\n                        <Badge variant=\"secondary\" className=\"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5\">\r\n                          {userPosts.length}\r\n                        </Badge>\r\n                      )}\r\n                    </TabsTrigger>\r\n                  </TabsList>\r\n                  \r\n                  <TabsContent value=\"comments\">\r\n                    {commentsLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : comments && comments.length > 0 ? (\r\n                      <div className=\"space-y-4\">\r\n                        {comments.map((comment) => (\r\n                          <CommentItem\r\n                            key={comment.id}\r\n                            comment={comment}\r\n                            getLocalizedField={getLocalizedField}\r\n                            t={t}\r\n                          />\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">{t(\"profile.noComments\")}</p>\r\n                    )}\r\n                  </TabsContent>\r\n                  \r\n                  <TabsContent value=\"posts\">\r\n                    {postsLoading ? (\r\n                      <div className=\"text-center py-8\">{t(\"common.loading\")}</div>\r\n                    ) : userPosts && userPosts.length > 0 ? (\r\n                      <div className=\"columns-2 gap-4 md:columns-3\">\r\n                        {userPosts.map((post) => (\r\n                          <div key={post.id} className=\"break-inside-avoid mb-4\">\r\n                            <PostGridCard post={post} />\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-8\">\r\n                        {t(\"profile.noPosts\")}{\" \"}\r\n                        <Link to=\"/community\" className=\"text-primary hover:underline\">\r\n                          {t(\"profile.browseActivities\")}\r\n                        </Link>\r\n                      </p>\r\n                    )}\r\n                  </TabsContent>\r\n                </Tabs>\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          {isMerchantOrSupervisor && (\r\n            <TabsContent value=\"activities\">\r\n              <Card>\r\n                <CardHeader className={isMobile ? \"pb-3\" : \"\"}>\r\n                  <CardTitle className={`flex items-center gap-2 ${isMobile ? \"text-lg\" : \"\"}`}>\r\n                    <Calendar className=\"w-5 h-5\" />\r\n                    {t(\"profile.participatedActivities\")}\r\n                  </CardTitle>\r\n                  <CardDescription className={isMobile ? \"text-xs\" : \"\"}>\r\n                    {t(\"profile.participatedActivitiesDesc\")}\r\n                  </CardDescription>\r\n                </CardHeader>\r\n                <CardContent className={isMobile ? \"px-3\" : \"\"}>\r\n                  <div className={isMobile ? \"space-y-4\" : \"space-y-6\"}>\r\n                    {/* Restaurant participations */}\r\n                    {merchantActivitiesLoading ? (\r\n                      <div className={`text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                        {t(\"common.loading\")}\r\n                      </div>\r\n                    ) : merchantActivities && merchantActivities.length > 0 ? (\r\n                      <div>\r\n                        <h3 className={`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${isMobile ? \"text-base\" : \"text-lg\"}`}>\r\n                          <Store className={isMobile ? \"w-4 h-4\" : \"w-5 h-5\"} />\r\n                          {t(\"profile.restaurantActivities\")}\r\n                        </h3>\r\n                        <div className={isMobile ? \"space-y-3\" : \"space-y-4\"}>\r\n                          {(() => {\r\n                            // Group activities by activity_id\r\n                            const activityGroups = merchantActivities.reduce((acc, participation) => {\r\n                              const activityId = participation.activity_id;\r\n                              if (!acc[activityId]) {\r\n                                acc[activityId] = {\r\n                                  activity: participation.activity,\r\n                                  restaurants: [],\r\n                                  participationDate: participation.created_at\r\n                                };\r\n                              }\r\n                              acc[activityId].restaurants.push({\r\n                                id: participation.restaurant_id,\r\n                                name: participation.restaurant_name,\r\n                                name_en: participation.restaurant_name_en,\r\n                                name_pt: participation.restaurant_name_pt,\r\n                              });\r\n                              return acc;\r\n                            }, {} as Record<string, any>);\r\n\r\n                            return Object.values(activityGroups).map((group: any) => (\r\n                              <MerchantActivityItem\r\n                                key={group.activity.id}\r\n                                activityGroup={group}\r\n                                getLocalizedField={getLocalizedField}\r\n                                t={t}\r\n                                isMobile={isMobile}\r\n                              />\r\n                            ));\r\n                          })()}\r\n                        </div>\r\n                      </div>\r\n                    ) : (\r\n                      <p className={`text-muted-foreground text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                        {t(\"profile.noParticipatedActivities\")}{\" \"}\r\n                        <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                          {t(\"profile.browseActivities\")}\r\n                        </Link>\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </CardContent>\r\n              </Card>\r\n            </TabsContent>\r\n          )}\r\n\r\n          {/* Invitation Code Tab */}\r\n          <TabsContent value=\"invitation-code\">\r\n            <InvitationCodeSection />\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"coupons\">\r\n            <Card>\r\n              <CardHeader className={isMobile ? \"pb-3\" : \"\"}>\r\n                <CardTitle className={`flex items-center gap-2 ${isMobile ? \"text-lg\" : \"\"}`}>\r\n                  <Ticket className=\"w-5 h-5\" />\r\n                  {t(\"profile.coupons.title\")}\r\n                </CardTitle>\r\n                <CardDescription className={isMobile ? \"text-xs\" : \"\"}>\r\n                  {t(\"profile.coupons.description\")}\r\n                </CardDescription>\r\n              </CardHeader>\r\n              <CardContent className={isMobile ? \"px-3\" : \"\"}>\r\n                {couponsLoading ? (\r\n                  <div className={`text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"common.loading\")}\r\n                  </div>\r\n                ) : userCoupons && userCoupons.length > 0 ? (\r\n                  <div className={`grid gap-3 md:gap-4 ${isMobile ? \"grid-cols-1\" : \"md:grid-cols-2\"}`}>\r\n                    {userCoupons.map((coupon) => (\r\n                      <UserCouponItem\r\n                        key={coupon.id}\r\n                        coupon={coupon}\r\n                        getLocalizedField={getLocalizedField}\r\n                        t={t}\r\n                        isMobile={isMobile}\r\n                      />\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p className={`text-muted-foreground text-center py-8 ${isMobile ? \"text-sm\" : \"\"}`}>\r\n                    {t(\"profile.coupons.noCoupons\")}{\" \"}\r\n                    <Link to=\"/activities\" className=\"text-primary hover:underline\">\r\n                      {t(\"profile.coupons.browseActivities\")}\r\n                    </Link>\r\n                  </p>\r\n                )}\r\n              </CardContent>\r\n            </Card>\r\n          </TabsContent>\r\n\r\n          <TabsContent value=\"addresses\">\r\n            <AddressManagement />\r\n          </TabsContent>\r\n          \r\n          <TabsContent value=\"orders\">\r\n            <div className=\"space-y-4 md:space-y-6\">\r\n              <BookingRecords />\r\n              <DeliveryRecords />\r\n            </div>\r\n          </TabsContent>\r\n        </Tabs>\r\n        )}\r\n\r\n        {/* Mobile: Fixed bottom navigation - completely isolated from carousel rendering */}\r\n        {isMobile && (\r\n          <div \r\n            className=\"fixed left-4 right-4 z-40 bg-white/20 dark:bg-black/25 backdrop-blur-sm border border-white/40 dark:border-white/30 shadow-[0_2px_20px_rgba(0,0,0,0.08)] rounded-[28px] overflow-hidden\"\r\n            style={{ \r\n              contain: 'layout style paint',\r\n              isolation: 'isolate',\r\n              backfaceVisibility: 'hidden',\r\n              transform: 'translateZ(0)',\r\n              bottom: 'max(1rem, calc(env(safe-area-inset-bottom) + 0.25rem))',\r\n            }}\r\n          >\r\n            {/*  */}\r\n            <div className=\"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/10 via-transparent to-transparent pointer-events-none\" />\r\n            <div className=\"relative flex justify-around items-center h-16 px-4\">\r\n              {tabs.map((tab) => {\r\n                const Icon = tab.icon;\r\n                return (\r\n                  <button\r\n                    key={tab.value}\r\n                    onClick={() => handleTabClick(tab.value)}\r\n                    className={`relative flex flex-col items-center justify-center flex-1 h-12 py-1.5 px-2 mx-0.5 transition-all duration-200 rounded-2xl ${\r\n                      activeTab === tab.value\r\n                        ? \"text-primary dark:text-white bg-primary/15 dark:bg-white/15\"\r\n                        : \"text-gray-700 dark:text-white/80 active:bg-black/5 dark:active:bg-white/5\"\r\n                    }`}\r\n                  >\r\n                    <Icon \r\n                      className={`h-5 w-5 mb-0.5 transition-all duration-200 ${\r\n                        activeTab === tab.value \r\n                          ? \"scale-110 drop-shadow-[0_0_6px_rgba(34,197,94,0.6)] dark:drop-shadow-[0_0_6px_rgba(255,255,255,0.6)]\" \r\n                          : \"\"\r\n                      }`} \r\n                    />\r\n                    <span className={`text-xs text-center leading-tight ${activeTab === tab.value ? \"font-semibold\" : \"font-normal\"}`}>\r\n                      {tab.label}\r\n                    </span>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Profile;\r\n"],"file":"assets/Profile-CUw0S2jo.js"}