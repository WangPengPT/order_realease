{"version":3,"file":"RecipeDetailContent-COFQZClE.js","sources":["../../src/components/community/PostCard.tsx","../../src/components/community/recipe/RecipeAds.tsx","../../src/components/community/recipe/RecipeOverview.tsx","../../src/components/community/recipe/RecipeCookingMode.tsx","../../src/components/community/recipe/RecipeDetailContent.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Heart, MessageCircle, Share2, MoreHorizontal, Calendar, X, ChevronLeft, ChevronRight, MapPin, FileImage, ChevronDown, ChevronUp, Pencil, Clock } from \"lucide-react\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  type CarouselApi,\r\n} from \"@/components/ui/carousel\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { CommunityPost, useLikePost, useSharePost, useDeletePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport { useSmartShare, ShareDrawer } from \"@/components/ShareDrawer\";\r\nimport EditPostDialog from \"@/components/community/EditPostDialog\";\r\nimport EditRecipeDialog from \"@/components/community/EditRecipeDialog\";\r\n\r\ninterface PostCardProps {\r\n  post: CommunityPost;\r\n  showActions?: boolean;\r\n  isDetailPage?: boolean;\r\n}\r\n\r\nconst PostCard = ({ post, showActions = true, isDetailPage = false }: PostCardProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const sharePost = useSharePost();\r\n  const deletePost = useDeletePost();\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [showEditDialog, setShowEditDialog] = useState(false);\r\n  const [imageError, setImageError] = useState<Record<string, boolean>>({});\r\n  const [previewOpen, setPreviewOpen] = useState(false);\r\n  const [previewIndex, setPreviewIndex] = useState(0);\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [previewCarouselApi, setPreviewCarouselApi] = useState<CarouselApi>();\r\n  const [currentSlide, setCurrentSlide] = useState(0);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\r\n  const [isSwiping, setIsSwiping] = useState(false);\r\n  const [swipeOffset, setSwipeOffset] = useState(0);\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [imageDimensions, setImageDimensions] = useState<Record<string, { width: number; height: number }>>({});\r\n  const [longImageScrollStart, setLongImageScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n  const [showAllRestaurants, setShowAllRestaurants] = useState(false);\r\n  const { share: smartShareFn, DrawerComponent: SmartShareDrawer } = useSmartShare();\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (previewOpen) {\r\n      const scrollY = window.scrollY;\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [previewOpen]);\r\n\r\n  // Listen to carousel slide changes\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    \r\n    carouselApi.on(\"select\", () => {\r\n      setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    });\r\n  }, [carouselApi]);\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const handleLike = () => {\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    const shareUrl = `${window.location.origin}/community/${post.id}`;\r\n    \r\n    smartShareFn({\r\n      title: t(\"community.shareTitle\", \"分享帖子\"),\r\n      text: post.content.replace(/<[^>]*>/g, '').substring(0, 100),\r\n      url: shareUrl,\r\n    }, () => {\r\n      if (user) {\r\n        sharePost.mutate(post.id);\r\n      }\r\n      toast.success(t(\"community.shareSuccess\", \"分享成功\"));\r\n    });\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    deletePost.mutate(post.id);\r\n    setShowDeleteDialog(false);\r\n  };\r\n\r\n  const handleImageClick = (index: number) => {\r\n    if (isDetailPage) {\r\n      // On detail page, open preview\r\n      setPreviewIndex(index);\r\n      setPreviewOpen(true);\r\n    } else {\r\n      // On feed, navigate to post detail\r\n      navigate(`/community/${post.id}`);\r\n    }\r\n  };\r\n\r\n  const handlePrevImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === 0 ? (post.image_urls?.length || 1) - 1 : prev - 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleNextImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(-window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === (post.image_urls?.length || 1) - 1 ? 0 : prev + 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>, url: string) => {\r\n    const img = e.currentTarget;\r\n    setImageDimensions(prev => ({\r\n      ...prev,\r\n      [url]: { width: img.naturalWidth, height: img.naturalHeight }\r\n    }));\r\n  };\r\n\r\n  const isLongImage = (url: string) => {\r\n    const dims = imageDimensions[url];\r\n    return dims ? dims.height / dims.width > 1.5 : false;\r\n  };\r\n\r\n  const isAuthor = user?.id === post.author_id;\r\n  const activityTitle = post.activity\r\n    ? getLocalizedField(post.activity, \"title\")\r\n    : null;\r\n  \r\n  // Get all restaurants (from new junction table + legacy single restaurant)\r\n  const allRestaurants = [\r\n    ...(post.restaurants || []),\r\n    ...(post.restaurant && !post.restaurants?.find(r => r.id === post.restaurant?.id) ? [post.restaurant] : []),\r\n  ];\r\n  \r\n  // Max visible restaurants before collapsing\r\n  const maxVisibleRestaurants = isDetailPage ? 3 : 2;\r\n  const visibleRestaurants = showAllRestaurants \r\n    ? allRestaurants \r\n    : allRestaurants.slice(0, maxVisibleRestaurants);\r\n  const hasMoreRestaurants = allRestaurants.length > maxVisibleRestaurants;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const localizedContent = getLocalizedField(post, \"content\");\r\n  \r\n  // Check if we have a pre-stored translation for current language\r\n  const hasLocalizedTranslation = \r\n    (i18n.language === \"zh\" && post.content_zh) ||\r\n    (i18n.language === \"en\" && post.content_en) ||\r\n    (i18n.language === \"pt\" && post.content_pt);\r\n  \r\n  // Use localized content, or translated content, or original\r\n  // Convert newlines to <br> for proper display\r\n  const rawContent = translatedContent || localizedContent || post.content;\r\n  const displayContent = rawContent?.replace(/\\n/g, '<br>') || '';\r\n\r\n  return (\r\n    <>\r\n      <Card className=\"overflow-hidden\">\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Avatar className=\"h-10 w-10\">\r\n                <AvatarImage src={post.author?.avatar_url || undefined} />\r\n                <AvatarFallback>\r\n                  {post.author?.display_name?.charAt(0) || \"?\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div>\r\n                <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {formatDistanceToNow(new Date(post.created_at), {\r\n                    addSuffix: true,\r\n                    locale: getDateLocale(),\r\n                  })}\r\n                </p>\r\n                {/* Pending status badge for author */}\r\n                {isAuthor && post.status === \"pending\" && (\r\n                  <Badge variant=\"outline\" className=\"text-amber-600 border-amber-500 bg-amber-50 dark:bg-amber-950/30 text-xs mt-0.5\">\r\n                    <Clock className=\"w-3 h-3 mr-1\" />\r\n                    {t(\"community.pendingReview\", \"审核中\")}\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {showActions && isAuthor && (\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowEditDialog(true)}\r\n                  >\r\n                    <Pencil className=\"h-4 w-4 mr-2\" />\r\n                    {t(\"common.edit\", \"编辑\")}\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowDeleteDialog(true)}\r\n                    className=\"text-destructive\"\r\n                  >\r\n                    {t(\"common.delete\", \"删除\")}\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"pt-0 pb-3\">\r\n          {/* Activity & Restaurant Badges */}\r\n          {(post.activity || allRestaurants.length > 0) && (\r\n            <div className=\"flex flex-wrap gap-2 mb-3 items-center\">\r\n              {post.activity && (\r\n                <Link to={`/activity/${post.activity.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <Calendar className=\"h-3 w-3\" />\r\n                    {activityTitle}\r\n                  </Badge>\r\n                </Link>\r\n              )}\r\n              {visibleRestaurants.map((restaurant) => (\r\n                <Link key={restaurant.id} to={`/restaurant/${restaurant.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <MapPin className=\"h-3 w-3\" />\r\n                    {getLocalizedField(restaurant, \"name\")}\r\n                  </Badge>\r\n                </Link>\r\n              ))}\r\n              {hasMoreRestaurants && !showAllRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(true)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  +{allRestaurants.length - maxVisibleRestaurants} {t(\"community.more\", \"更多\")}\r\n                  <ChevronDown className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n              {showAllRestaurants && hasMoreRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(false)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  {t(\"community.collapse\", \"收起\")}\r\n                  <ChevronUp className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Content */}\r\n          <Link to={`/community/${post.id}`}>\r\n            <div\r\n              className={`prose prose-sm max-w-none dark:prose-invert ${!isDetailPage ? 'line-clamp-6' : ''}`}\r\n              dangerouslySetInnerHTML={{ __html: displayContent }}\r\n            />\r\n          </Link>\r\n\r\n          {/* Translate Button - only show if no pre-stored translation */}\r\n          {!hasLocalizedTranslation && (\r\n            <TranslateButton \r\n              text={post.content} \r\n              onTranslation={setTranslatedContent}\r\n              className=\"mt-1\"\r\n            />\r\n          )}\r\n\r\n          {/* Images - Carousel only for multiple images */}\r\n          {/* In detail page with video, filter out auto-generated cover images */}\r\n          {(() => {\r\n            const displayImageUrls = isDetailPage && post.video_url\r\n              ? (post.image_urls || []).filter(url => !url.includes('-cover'))\r\n              : post.image_urls;\r\n            \r\n            if (!displayImageUrls || displayImageUrls.length === 0) return null;\r\n            \r\n            return (\r\n              <div className=\"relative mt-3\">\r\n                {displayImageUrls.length === 1 ? (\r\n                  // Single image - always limit max height\r\n                  (() => {\r\n                    const url = displayImageUrls[0];\r\n                    const isLong = isLongImage(url);\r\n                    return (\r\n                      <div \r\n                        className=\"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]\"\r\n                        onClick={() => handleImageClick(0)}\r\n                      >\r\n                        {!imageError[url] ? (\r\n                          <>\r\n                            <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top\"\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                              onError={() =>\r\n                                setImageError((prev) => ({ ...prev, [url]: true }))\r\n                              }\r\n                            />\r\n                            {/* Long image indicator */}\r\n                            {isLong && (\r\n                              <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                <FileImage className=\"h-3 w-3\" />\r\n                                <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : (\r\n                          <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })()\r\n                ) : (\r\n                  // Multiple images - use carousel with smart display\r\n                  <>\r\n                    <Carousel \r\n                      setApi={setCarouselApi} \r\n                      className=\"w-full\"\r\n                      opts={{ loop: true }}\r\n                    >\r\n                      <CarouselContent className=\"-ml-0\">\r\n                        {displayImageUrls.map((url, index) => {\r\n                          const isLong = isLongImage(url);\r\n                          return (\r\n                            <CarouselItem key={index} className=\"pl-0\">\r\n                              <div \r\n                                className=\"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted\"\r\n                                onClick={() => handleImageClick(index)}\r\n                              >\r\n                                {!imageError[url] ? (\r\n                                  <>\r\n                                    <img\r\n                                      src={url}\r\n                                      alt=\"\"\r\n                                      className=\"w-full h-full object-contain\"\r\n                                      onLoad={(e) => handleImageLoad(e, url)}\r\n                                      onError={() =>\r\n                                        setImageError((prev) => ({ ...prev, [url]: true }))\r\n                                      }\r\n                                    />\r\n                                    {/* Long image indicator */}\r\n                                    {isLong && (\r\n                                      <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <FileImage className=\"h-3 w-3\" />\r\n                                        <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                                      </div>\r\n                                    )}\r\n                                  </>\r\n                                ) : (\r\n                                  <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">\r\n                                      {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </CarouselItem>\r\n                          );\r\n                        })}\r\n                      </CarouselContent>\r\n                    </Carousel>\r\n                    \r\n                    {/* Top-right slide counter */}\r\n                    <div className=\"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10\">\r\n                      {currentSlide + 1}/{displayImageUrls.length}\r\n                    </div>\r\n                    \r\n                    {/* Bottom navigation dots */}\r\n                    <div className=\"flex justify-center gap-1.5 mt-2\">\r\n                      {displayImageUrls.map((_, index) => (\r\n                        <button\r\n                          key={index}\r\n                          className={`w-1.5 h-1.5 rounded-full transition-colors ${\r\n                            index === currentSlide \r\n                              ? \"bg-primary\" \r\n                              : \"bg-muted-foreground/30\"\r\n                          }`}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            carouselApi?.scrollTo(index);\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })()}\r\n\r\n          {/* Video */}\r\n          {post.video_url && (\r\n            <div className=\"mt-3 rounded-lg overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                controls\r\n                className=\"w-full max-h-96\"\r\n                preload=\"metadata\"\r\n                playsInline\r\n              />\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n\r\n        <CardFooter className=\"pt-0 border-t\">\r\n          <div className=\"flex items-center gap-4 pt-3 w-full\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className={`gap-2 ${post.user_liked ? \"text-red-500\" : \"\"}`}\r\n              onClick={handleLike}\r\n              disabled={!user}\r\n            >\r\n              <Heart\r\n                className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n              />\r\n              <span>{post.likes_count}</span>\r\n            </Button>\r\n\r\n            <Link to={`/community/${post.id}`}>\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\r\n                <MessageCircle className=\"h-4 w-4\" />\r\n                <span>{post.comments_count}</span>\r\n              </Button>\r\n            </Link>\r\n\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={handleShare}>\r\n              <Share2 className=\"h-4 w-4\" />\r\n              <span>{post.shares_count}</span>\r\n            </Button>\r\n          </div>\r\n        </CardFooter>\r\n      </Card>\r\n\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"community.deleteWarning\", \"删除后无法恢复，确定要删除这篇帖子吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDelete}>\r\n              {t(\"common.delete\", \"删除\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Edit Dialog - type-aware */}\r\n      {(post as any).post_type === 'recipe' ? (\r\n        <EditRecipeDialog\r\n          post={post}\r\n          open={showEditDialog}\r\n          onOpenChange={setShowEditDialog}\r\n        />\r\n      ) : (\r\n        <EditPostDialog\r\n          post={post}\r\n          open={showEditDialog}\r\n          onOpenChange={setShowEditDialog}\r\n        />\r\n      )}\r\n\r\n      {/* Image Preview - Using Carousel for smooth swipe like feed */}\r\n      {previewOpen && createPortal(\r\n        <div \r\n          className=\"fixed inset-0 z-[100] bg-black overflow-hidden\"\r\n          onClick={(e) => {\r\n            // Only close if clicking on backdrop, not carousel\r\n            if (e.target === e.currentTarget) {\r\n              setPreviewOpen(false);\r\n            }\r\n          }}\r\n          onWheel={(e) => e.stopPropagation()}\r\n          onTouchMove={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Image Counter */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full\">\r\n              {previewIndex + 1} / {post.image_urls.length}\r\n            </div>\r\n          )}\r\n\r\n          {/* Close Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n            onClick={() => setPreviewOpen(false)}\r\n          >\r\n            <X className=\"h-6 w-6\" />\r\n          </Button>\r\n\r\n          {/* Full screen Carousel - centered with calc() constraints */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <Carousel\r\n              className=\"w-full\"\r\n              opts={{ loop: true, startIndex: previewIndex }}\r\n              setApi={(api) => {\r\n                setPreviewCarouselApi(api);\r\n                if (api) {\r\n                  api.on(\"select\", () => {\r\n                    setPreviewIndex(api.selectedScrollSnap());\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {post.image_urls?.map((url, index) => {\r\n                  const dims = imageDimensions[url];\r\n                  const isLong = dims ? dims.height / dims.width > 1.5 : false;\r\n                  return (\r\n                    <CarouselItem key={index} className=\"pl-0 flex items-center justify-center\">\r\n                      {isLong ? (\r\n                        <div \r\n                          className=\"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain\"\r\n                          onMouseDown={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onMouseUp={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const deltaY = Math.abs(e.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              if (deltaY < 10 && deltaScroll < 10) {\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                          onTouchStart={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.touches[0].clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onTouchEnd={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const touch = e.changedTouches[0];\r\n                              const deltaY = Math.abs(touch.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              // Use a slightly larger threshold for touch to account for touch inaccuracy\r\n                              if (deltaY < 15 && deltaScroll < 15) {\r\n                                e.preventDefault();\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                        >\r\n                        <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"block select-none\"\r\n                              style={{\r\n                                width: '100vw',\r\n                                minHeight: '100dvh',\r\n                                height: 'auto',\r\n                                margin: 0\r\n                              }}\r\n                              draggable={false}\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                            />\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center\">\r\n                          <img\r\n                            src={url}\r\n                            alt=\"\"\r\n                            className=\"object-contain w-screen h-screen select-none cursor-pointer\"\r\n                            draggable={false}\r\n                            onClick={() => setPreviewOpen(false)}\r\n                            onLoad={(e) => handleImageLoad(e, url)}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </CarouselItem>\r\n                  );\r\n                })}\r\n              </CarouselContent>\r\n            </Carousel>\r\n          </div>\r\n\r\n          {/* Desktop Navigation Buttons - connected to Carousel API */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollPrev()}\r\n              >\r\n                <ChevronLeft className=\"h-8 w-8\" />\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollNext()}\r\n              >\r\n                <ChevronRight className=\"h-8 w-8\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>,\r\n        document.body\r\n      )}\r\n      \r\n      {/* Smart Share Drawer for WebView environments */}\r\n      {SmartShareDrawer}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PostCard;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { ExternalLink } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport ExternalLinkConfirmDialog from \"@/components/ExternalLinkConfirmDialog\";\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\n\r\ninterface Ad {\r\n  id: string;\r\n  name: string;\r\n  image_url: string | null;\r\n  mobile_image_url: string | null;\r\n  desktop_image_url: string | null;\r\n  link_url: string | null;\r\n  is_active: boolean;\r\n  sort_order: number;\r\n  start_date: string | null;\r\n  end_date: string | null;\r\n}\r\n\r\nconst adsTable = () => (supabase as any).from(\"ads\");\r\n\r\nconst RecipeAds = () => {\r\n  const { t } = useTranslation();\r\n  const isMobile = useIsMobile();\r\n  const [pendingUrl, setPendingUrl] = useState<string | null>(null);\r\n  const [pendingAdName, setPendingAdName] = useState<string | null>(null);\r\n\r\n  const { data: ads } = useQuery({\r\n    queryKey: [\"active-ads\"],\r\n    queryFn: async () => {\r\n      const now = new Date().toISOString();\r\n      const { data, error } = await adsTable()\r\n        .select(\"*\")\r\n        .eq(\"is_active\", true)\r\n        .or(`start_date.is.null,start_date.lte.${now}`)\r\n        .or(`end_date.is.null,end_date.gte.${now}`)\r\n        .order(\"sort_order\", { ascending: true });\r\n      if (error) throw error;\r\n      return data as Ad[];\r\n    },\r\n    staleTime: 5 * 60 * 1000,\r\n  });\r\n\r\n  if (!ads || ads.length === 0) return null;\r\n\r\n  const handleAdClick = (ad: Ad) => {\r\n    if (ad.link_url) {\r\n      setPendingUrl(ad.link_url);\r\n      setPendingAdName(ad.name);\r\n    }\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    if (pendingUrl) {\r\n      window.open(pendingUrl, \"_blank\", \"noopener,noreferrer\");\r\n      setPendingUrl(null);\r\n      setPendingAdName(null);\r\n    }\r\n  };\r\n\r\n  const getImageUrl = (ad: Ad) => {\r\n    if (isMobile) {\r\n      return ad.mobile_image_url || ad.desktop_image_url || ad.image_url;\r\n    }\r\n    return ad.desktop_image_url || ad.mobile_image_url || ad.image_url;\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-2 mt-3\">\r\n        {ads.map((ad) => {\r\n          const imgUrl = getImageUrl(ad);\r\n          return (\r\n            <div\r\n              key={ad.id}\r\n              className=\"relative rounded-lg overflow-hidden border border-border/50 hover:border-primary/30 transition-colors cursor-pointer\"\r\n              style={{ aspectRatio: isMobile ? '375/112' : '672/112' }}\r\n              onClick={() => handleAdClick(ad)}\r\n            >\r\n              {/* Ad label */}\r\n              <Badge className=\"absolute top-1.5 left-1.5 z-10 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded hover:bg-black/60\">\r\n                {t(\"common.ad\", \"广告\")}\r\n              </Badge>\r\n\r\n              {imgUrl ? (\r\n                <img\r\n                  src={imgUrl}\r\n                  alt={ad.name}\r\n                  className=\"w-full h-full object-cover\"\r\n                />\r\n              ) : (\r\n                <div className=\"flex items-center gap-2 px-3 bg-muted/50 text-sm text-muted-foreground w-full h-full justify-center\">\r\n                  <ExternalLink className=\"h-3.5 w-3.5 shrink-0\" />\r\n                  <span className=\"truncate\">{ad.name}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      <ExternalLinkConfirmDialog\r\n        open={!!pendingUrl}\r\n        onOpenChange={(open) => { if (!open) { setPendingUrl(null); setPendingAdName(null); } }}\r\n        onConfirm={handleConfirm}\r\n        url={pendingUrl || undefined}\r\n        title={t(\"common.adLinkTitle\", \"外部链接\")}\r\n        description={t(\"common.adLinkDescription\", \"您即将离开本站，前往广告链接「{{name}}」的外部页面\", { name: pendingAdName || \"\" })}\r\n        confirmLabel={t(\"common.adLinkContinue\", \"继续前往\")}\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RecipeAds;\r\n","import { useState, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Clock, Users, Utensils, Flame, ChefHat, PlayCircle, ChevronDown, ChevronUp } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RecipeStep, Ingredient, NutritionInfo } from \"./RecipeTypes\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\nimport RecipeAds from \"./RecipeAds\";\r\n\r\ninterface ExtendedPost extends CommunityPost {\r\n  post_type?: string;\r\n  recipe_name?: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  cook_time?: number;\r\n  difficulty?: string;\r\n  servings?: number;\r\n  ingredients?: Ingredient[];\r\n  steps?: RecipeStep[];\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\ninterface RecipeOverviewProps {\r\n  post: ExtendedPost;\r\n  onStartCooking: () => void;\r\n}\r\n\r\nconst RecipeOverview = ({ post, onStartCooking }: RecipeOverviewProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const [translatedName, setTranslatedName] = useState<string | null>(null);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [translatedIngredients, setTranslatedIngredients] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  const [showFullContent, setShowFullContent] = useState(false);\r\n  const [showAllIngredients, setShowAllIngredients] = useState(false);\r\n\r\n  const CONTENT_MAX_LENGTH = 200;\r\n  const INGREDIENTS_PREVIEW_COUNT = 5;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const getLocalizedContent = () => {\r\n    const langMap: Record<string, string> = {\r\n      'zh': 'content_zh',\r\n      'en': 'content_en', \r\n      'pt': 'content_pt'\r\n    };\r\n    const field = langMap[i18n.language] || 'content';\r\n    const localizedValue = post[field as keyof typeof post];\r\n    if (localizedValue && typeof localizedValue === 'string' && localizedValue.trim()) {\r\n      return localizedValue;\r\n    }\r\n    return post.content;\r\n  };\r\n\r\n  const displayContent = translatedContent || getLocalizedContent();\r\n  const displayName = translatedName || getLocalizedField(post, \"recipe_name\") || post.recipe_name;\r\n\r\n  // Build combined text for translation: name + content + ingredients\r\n  const buildTranslationText = () => {\r\n    const parts: string[] = [];\r\n    // Recipe name\r\n    if (post.recipe_name) {\r\n      parts.push(`[NAME]${post.recipe_name}`);\r\n    }\r\n    // Content (if exists and not auto-generated)\r\n    if (post.content && post.content.trim() && !post.content.includes('主要配料：')) {\r\n      parts.push(`[CONTENT]${post.content}`);\r\n    }\r\n    // Ingredients\r\n    if (post.ingredients && post.ingredients.length > 0) {\r\n      const ingredientNames = post.ingredients.map(i => i.name).join('|');\r\n      parts.push(`[INGREDIENTS]${ingredientNames}`);\r\n    }\r\n    return parts.join('\\n---\\n');\r\n  };\r\n\r\n  // Parse translation result\r\n  const handleTranslation = (translated: string | null) => {\r\n    if (!translated) {\r\n      setTranslatedName(null);\r\n      setTranslatedContent(null);\r\n      setTranslatedIngredients({});\r\n      return;\r\n    }\r\n    \r\n    const sections = translated.split('\\n---\\n');\r\n    sections.forEach(section => {\r\n      if (section.startsWith('[NAME]')) {\r\n        setTranslatedName(section.replace('[NAME]', ''));\r\n      } else if (section.startsWith('[CONTENT]')) {\r\n        setTranslatedContent(section.replace('[CONTENT]', ''));\r\n      } else if (section.startsWith('[INGREDIENTS]')) {\r\n        const names = section.replace('[INGREDIENTS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        names.forEach((name, idx) => { map[idx] = name.trim(); });\r\n        setTranslatedIngredients(map);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\": return zhCN;\r\n      case \"pt\": return pt;\r\n      default: return enUS;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return 'bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30';\r\n      case 'medium': return 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30';\r\n      case 'hard': return 'bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case 'medium': return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case 'hard': return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasSteps = post.steps && post.steps.length > 0;\r\n\r\n  return (\r\n    <Card className=\"overflow-hidden\">\r\n      {/* Hero Image */}\r\n      {hasImages && (\r\n        <div className=\"relative aspect-video overflow-hidden\">\r\n          <img\r\n            src={post.image_urls![0]}\r\n            alt={displayName || \"\"}\r\n            className=\"w-full h-full object-cover cursor-pointer\"\r\n            onClick={() => setPreviewImageUrl(post.image_urls![0])}\r\n          />\r\n          <Badge className=\"absolute top-3 left-3 bg-primary text-primary-foreground gap-1\">\r\n            <Utensils className=\"h-3 w-3\" />\r\n            {t(\"recipe.badge\", \"食谱\")}\r\n          </Badge>\r\n        </div>\r\n      )}\r\n\r\n      <CardHeader className=\"pb-3\">\r\n        {/* Author */}\r\n        <div className=\"flex items-center gap-3 mb-4\">\r\n          <Avatar className=\"h-10 w-10\">\r\n            <AvatarImage src={post.author?.avatar_url || undefined} />\r\n            <AvatarFallback>\r\n              {post.author?.display_name?.charAt(0) || \"?\"}\r\n            </AvatarFallback>\r\n          </Avatar>\r\n          <div>\r\n            <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              {formatDistanceToNow(new Date(post.created_at), {\r\n                addSuffix: true,\r\n                locale: getDateLocale(),\r\n              })}\r\n            </p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Translate All Button - above recipe name */}\r\n        <div className=\"mb-2\">\r\n          <TranslateButton \r\n            text={buildTranslationText()} \r\n            onTranslation={handleTranslation}\r\n            label={t(\"recipe.translateAll\")}\r\n          />\r\n        </div>\r\n\r\n        {/* Recipe Name */}\r\n        <h2 className=\"text-xl font-bold\">{displayName}</h2>\r\n\r\n        {/* Meta Info */}\r\n        <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n          {post.cook_time && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Clock className=\"h-4 w-4\" />\r\n              <span>{post.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n            </div>\r\n          )}\r\n          {post.servings && (\r\n            <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n              <Users className=\"h-4 w-4\" />\r\n              <span>{post.servings} {t(\"recipe.servings\", \"人份\")}</span>\r\n            </div>\r\n          )}\r\n          {post.difficulty && (\r\n            <Badge variant=\"outline\" className={getDifficultyColor(post.difficulty)}>\r\n              <ChefHat className=\"h-3 w-3 mr-1\" />\r\n              {getDifficultyLabel(post.difficulty)}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      </CardHeader>\r\n\r\n      <CardContent className=\"space-y-6\">\r\n        {/* Description - collapsible if long */}\r\n        {post.content && post.content.trim() && !post.content.includes('主要配料：') && (\r\n          <div>\r\n            <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\r\n              {showFullContent || (displayContent || '').length <= CONTENT_MAX_LENGTH\r\n                ? displayContent\r\n                : (displayContent || '').slice(0, CONTENT_MAX_LENGTH) + '...'}\r\n            </p>\r\n            {(displayContent || '').length > CONTENT_MAX_LENGTH && (\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"px-0 h-auto py-1 text-xs text-primary\"\r\n                onClick={() => setShowFullContent(!showFullContent)}\r\n              >\r\n                {showFullContent ? t(\"common.collapse\", \"收起\") : t(\"common.viewAll\", \"查看全部\")}\r\n                {showFullContent ? <ChevronUp className=\"h-3 w-3 ml-1\" /> : <ChevronDown className=\"h-3 w-3 ml-1\" />}\r\n              </Button>\r\n            )}\r\n          </div>\r\n        )}\r\n\r\n        {/* Nutrition Info */}\r\n        {post.nutrition && (post.nutrition.calories || post.nutrition.protein || post.nutrition.carbs || post.nutrition.fat) && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3 flex items-center gap-2\">\r\n              <Flame className=\"h-4 w-4 text-orange-500\" />\r\n              {t(\"recipe.nutrition\", \"营养信息\")}\r\n            </h3>\r\n            <div className=\"grid grid-cols-4 gap-2\">\r\n              {post.nutrition.calories && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.calories}</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.kcal\", \"千卡\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.protein && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.protein}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.protein\", \"蛋白质\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.carbs && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.carbs}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.carbs\", \"碳水\")}</p>\r\n                </div>\r\n              )}\r\n              {post.nutrition.fat && (\r\n                <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                  <p className=\"text-lg font-bold text-primary\">{post.nutrition.fat}g</p>\r\n                  <p className=\"text-xs text-muted-foreground\">{t(\"recipe.fat\", \"脂肪\")}</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <Separator />\r\n\r\n        {/* Ingredients - collapsible */}\r\n        {post.ingredients && post.ingredients.length > 0 && (\r\n          <div>\r\n            <h3 className=\"font-semibold text-sm mb-3\">\r\n              {t(\"recipe.ingredients\", \"食材\")} ({post.ingredients.length})\r\n            </h3>\r\n            {/* Table header */}\r\n            <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n              <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n              <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n            </div>\r\n            <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n              {(showAllIngredients ? post.ingredients : post.ingredients.slice(0, INGREDIENTS_PREVIEW_COUNT)).map((ingredient, index) => (\r\n                <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                  <span className=\"flex-1 min-w-0 truncate\">{translatedIngredients[index] || ingredient.name}</span>\r\n                  <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                    {ingredient.amount} {ingredient.unit}\r\n                  </span>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n            {post.ingredients.length > INGREDIENTS_PREVIEW_COUNT && (\r\n              <>\r\n                {showAllIngredients && <RecipeAds />}\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"w-full mt-2 text-xs text-primary\"\r\n                  onClick={() => setShowAllIngredients(!showAllIngredients)}\r\n                >\r\n                  {showAllIngredients\r\n                    ? t(\"common.collapse\", \"收起\")\r\n                    : t(\"recipe.showAllIngredients\", { count: post.ingredients.length })}\r\n                  {showAllIngredients ? <ChevronUp className=\"h-3 w-3 ml-1\" /> : <ChevronDown className=\"h-3 w-3 ml-1\" />}\r\n                </Button>\r\n              </>\r\n            )}\r\n            {/* Show ads when no collapse needed (fewer ingredients) */}\r\n            {post.ingredients.length <= INGREDIENTS_PREVIEW_COUNT && <RecipeAds />}\r\n          </div>\r\n        )}\r\n\r\n        {/* Tags */}\r\n        {post.recipe_tags && post.recipe_tags.length > 0 && (\r\n          <div className=\"flex flex-wrap gap-2 pt-2\">\r\n            {post.recipe_tags.map((tag, index) => (\r\n              <Badge key={index} variant=\"secondary\" className=\"text-xs\">\r\n                #{tag}\r\n              </Badge>\r\n            ))}\r\n          </div>\r\n        )}\r\n\r\n        {/* Start Cooking Button */}\r\n        {hasSteps && (\r\n          <Button \r\n            size=\"lg\" \r\n            className=\"w-full gap-2 h-14 text-lg\"\r\n            onClick={onStartCooking}\r\n          >\r\n            <PlayCircle className=\"h-6 w-6\" />\r\n            {t(\"recipe.startCooking\", \"开始烹饪\")}\r\n            <Badge variant=\"secondary\" className=\"ml-2\">\r\n              {post.steps!.length} {t(\"recipe.stepsCount\", \"步\")}\r\n            </Badge>\r\n          </Button>\r\n        )}\r\n      </CardContent>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default RecipeOverview;\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { ChevronLeft, ChevronRight, Check, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport { RecipeStep } from \"./RecipeTypes\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RecipeCookingModeProps {\r\n  steps: RecipeStep[];\r\n  onExit: () => void;\r\n}\r\n\r\nconst RecipeCookingMode = ({ steps, onExit }: RecipeCookingModeProps) => {\r\n  const { t } = useTranslation();\r\n  const [currentStep, setCurrentStep] = useState(0);\r\n  const [translatedSteps, setTranslatedSteps] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  \r\n  const sortedSteps = [...steps].sort((a, b) => a.order - b.order);\r\n  const totalSteps = sortedSteps.length;\r\n  const step = sortedSteps[currentStep];\r\n  const progress = ((currentStep + 1) / totalSteps) * 100;\r\n  const isLastStep = currentStep === totalSteps - 1;\r\n  const isFirstStep = currentStep === 0;\r\n\r\n  const handleNext = () => {\r\n    if (!isLastStep) {\r\n      setCurrentStep(prev => prev + 1);\r\n    }\r\n  };\r\n\r\n  const handlePrev = () => {\r\n    if (!isFirstStep) {\r\n      setCurrentStep(prev => prev - 1);\r\n    }\r\n  };\r\n\r\n  const handleComplete = () => {\r\n    onExit();\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full min-h-[60vh]\">\r\n      {/* Header */}\r\n      <div className=\"flex items-center justify-between px-4 py-3 border-b bg-background sticky top-0 z-10\">\r\n        <Button variant=\"ghost\" size=\"icon\" onClick={onExit}>\r\n          <X className=\"h-5 w-5\" />\r\n        </Button>\r\n        <span className=\"font-medium\">\r\n          {t(\"recipe.stepProgress\", \"步骤 {{current}} / {{total}}\", { \r\n            current: currentStep + 1, \r\n            total: totalSteps \r\n          })}\r\n        </span>\r\n        <TranslateButton \r\n          text={sortedSteps.map(s => s.description).join('\\n---\\n')} \r\n          onTranslation={(translated) => {\r\n            if (translated) {\r\n              const descriptions = translated.split('\\n---\\n');\r\n              const map: Record<number, string> = {};\r\n              descriptions.forEach((desc, idx) => { map[idx] = desc; });\r\n              setTranslatedSteps(map);\r\n            } else {\r\n              setTranslatedSteps({});\r\n            }\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {/* Progress bar */}\r\n      <Progress value={progress} className=\"h-1 rounded-none\" />\r\n\r\n      {/* Step content */}\r\n      <div className=\"flex-1 overflow-y-auto p-6\">\r\n        {/* Step number badge */}\r\n        <div className=\"flex items-center justify-center mb-6\">\r\n          <div className=\"w-16 h-16 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-2xl font-bold shadow-lg\">\r\n            {step.order}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Step images */}\r\n        {(() => {\r\n          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n          return imgs.length > 0 && (\r\n            <div className=\"mb-6 flex flex-wrap justify-center gap-2\">\r\n              {imgs.map((url, imgIdx) => (\r\n                <img\r\n                  key={imgIdx}\r\n                  src={url}\r\n                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                  className={`h-auto max-h-64 object-cover cursor-pointer rounded-xl ${imgs.length === 1 ? 'max-w-[75%]' : 'w-[calc(50%-0.25rem)]'}`}\r\n                  onClick={() => setPreviewImageUrl(url)}\r\n                />\r\n              ))}\r\n            </div>\r\n          );\r\n        })()}\r\n\r\n        {/* Step description */}\r\n        <p className=\"text-lg leading-relaxed text-center\">\r\n          {translatedSteps[currentStep] || step.description}\r\n        </p>\r\n      </div>\r\n\r\n      {/* Step dots indicator */}\r\n      <div className=\"flex justify-center gap-1.5 py-3\">\r\n        {sortedSteps.map((_, index) => (\r\n          <button\r\n            key={index}\r\n            className={`w-2 h-2 rounded-full transition-all ${\r\n              index === currentStep \r\n                ? 'bg-primary w-6' \r\n                : index < currentStep \r\n                  ? 'bg-primary/50' \r\n                  : 'bg-muted-foreground/30'\r\n            }`}\r\n            onClick={() => setCurrentStep(index)}\r\n          />\r\n        ))}\r\n      </div>\r\n\r\n      {/* Navigation buttons */}\r\n      <div className=\"flex items-center justify-between p-4 border-t bg-background\">\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"lg\"\r\n          onClick={handlePrev}\r\n          disabled={isFirstStep}\r\n          className=\"gap-2\"\r\n        >\r\n          <ChevronLeft className=\"h-5 w-5\" />\r\n          {t(\"recipe.prevStep\", \"上一步\")}\r\n        </Button>\r\n\r\n        {isLastStep ? (\r\n          <Button\r\n            size=\"lg\"\r\n            onClick={handleComplete}\r\n            className=\"gap-2\"\r\n            variant=\"default\"\r\n          >\r\n            <Check className=\"h-5 w-5\" />\r\n            {t(\"recipe.complete\", \"完成\")}\r\n          </Button>\r\n        ) : (\r\n          <Button\r\n            size=\"lg\"\r\n            onClick={handleNext}\r\n            className=\"gap-2\"\r\n          >\r\n            {t(\"recipe.nextStep\", \"下一步\")}\r\n            <ChevronRight className=\"h-5 w-5\" />\r\n          </Button>\r\n        )}\r\n      </div>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeCookingMode;\r\n","import { useState, useRef, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Clock, Users, Utensils, Flame, ChefHat, Heart, MessageCircle, Share2, List, PlayCircle } from \"lucide-react\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { CommunityPost } from \"@/hooks/useCommunityPosts\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { RecipeStep, Ingredient, NutritionInfo } from \"./RecipeTypes\";\r\nimport RecipeOverview from \"./RecipeOverview\";\r\nimport RecipeCookingMode from \"./RecipeCookingMode\";\r\nimport RecipeAds from \"./RecipeAds\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface ExtendedPost extends CommunityPost {\r\n  post_type?: string;\r\n  recipe_name?: string;\r\n  recipe_name_en?: string;\r\n  recipe_name_pt?: string;\r\n  cook_time?: number;\r\n  difficulty?: string;\r\n  servings?: number;\r\n  ingredients?: Ingredient[];\r\n  steps?: RecipeStep[];\r\n  nutrition?: NutritionInfo;\r\n  recipe_tags?: string[];\r\n  recipe_category?: string;\r\n}\r\n\r\ninterface RecipeDetailContentProps {\r\n  post: ExtendedPost;\r\n  showActions?: boolean;\r\n}\r\n\r\ntype ViewMode = 'guided' | 'full';\r\ntype GuidedPhase = 'overview' | 'cooking';\r\n\r\nconst RecipeDetailContent = ({ post, showActions = false }: RecipeDetailContentProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  \r\n  // View mode: 'guided' (step-by-step) or 'full' (all at once)\r\n  const [viewMode, setViewMode] = useState<ViewMode>('guided');\r\n  // For guided mode: 'overview' (info + ingredients) or 'cooking' (steps)\r\n  const [guidedPhase, setGuidedPhase] = useState<GuidedPhase>('overview');\r\n  // Translation state\r\n  const [translatedName, setTranslatedName] = useState<string | null>(null);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [translatedIngredients, setTranslatedIngredients] = useState<Record<number, string>>({});\r\n  const [translatedSteps, setTranslatedSteps] = useState<Record<number, string>>({});\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n  const cookingRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleStartCooking = useCallback(() => {\r\n    setGuidedPhase('cooking');\r\n    // Scroll to top after render\r\n    requestAnimationFrame(() => {\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    });\r\n  }, []);\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const getLocalizedContent = () => {\r\n    const langMap: Record<string, string> = {\r\n      'zh': 'content_zh',\r\n      'en': 'content_en', \r\n      'pt': 'content_pt'\r\n    };\r\n    const field = langMap[i18n.language] || 'content';\r\n    const localizedValue = post[field as keyof typeof post];\r\n    if (localizedValue && typeof localizedValue === 'string' && localizedValue.trim()) {\r\n      return localizedValue;\r\n    }\r\n    return post.content;\r\n  };\r\n\r\n  const displayContent = translatedContent || getLocalizedContent();\r\n  const displayName = translatedName || getLocalizedField(post, \"recipe_name\") || post.recipe_name;\r\n\r\n  // Build combined text for translation: name + content + ingredients + steps\r\n  const buildTranslationText = () => {\r\n    const parts: string[] = [];\r\n    if (post.recipe_name) {\r\n      parts.push(`[NAME]${post.recipe_name}`);\r\n    }\r\n    if (post.content && post.content.trim() && !post.content.includes('主要配料：')) {\r\n      parts.push(`[CONTENT]${post.content}`);\r\n    }\r\n    if (post.ingredients && post.ingredients.length > 0) {\r\n      const ingredientNames = post.ingredients.map(i => i.name).join('|');\r\n      parts.push(`[INGREDIENTS]${ingredientNames}`);\r\n    }\r\n    if (post.steps && post.steps.length > 0) {\r\n      const stepDescs = post.steps.sort((a, b) => a.order - b.order).map(s => s.description).join('|');\r\n      parts.push(`[STEPS]${stepDescs}`);\r\n    }\r\n    return parts.join('\\n---\\n');\r\n  };\r\n\r\n  // Parse translation result\r\n  const handleTranslation = (translated: string | null) => {\r\n    if (!translated) {\r\n      setTranslatedName(null);\r\n      setTranslatedContent(null);\r\n      setTranslatedIngredients({});\r\n      setTranslatedSteps({});\r\n      return;\r\n    }\r\n    \r\n    const sections = translated.split('\\n---\\n');\r\n    sections.forEach(section => {\r\n      if (section.startsWith('[NAME]')) {\r\n        setTranslatedName(section.replace('[NAME]', ''));\r\n      } else if (section.startsWith('[CONTENT]')) {\r\n        setTranslatedContent(section.replace('[CONTENT]', ''));\r\n      } else if (section.startsWith('[INGREDIENTS]')) {\r\n        const names = section.replace('[INGREDIENTS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        names.forEach((name, idx) => { map[idx] = name.trim(); });\r\n        setTranslatedIngredients(map);\r\n      } else if (section.startsWith('[STEPS]')) {\r\n        const descs = section.replace('[STEPS]', '').split('|');\r\n        const map: Record<number, string> = {};\r\n        descs.forEach((desc, idx) => { map[idx] = desc.trim(); });\r\n        setTranslatedSteps(map);\r\n      }\r\n    });\r\n  };\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\": return zhCN;\r\n      case \"pt\": return pt;\r\n      default: return enUS;\r\n    }\r\n  };\r\n\r\n  const getDifficultyColor = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return 'bg-green-500/20 text-green-700 dark:text-green-400 border-green-500/30';\r\n      case 'medium': return 'bg-yellow-500/20 text-yellow-700 dark:text-yellow-400 border-yellow-500/30';\r\n      case 'hard': return 'bg-red-500/20 text-red-700 dark:text-red-400 border-red-500/30';\r\n      default: return 'bg-muted text-muted-foreground';\r\n    }\r\n  };\r\n\r\n  const getDifficultyLabel = (d: string) => {\r\n    switch (d) {\r\n      case 'easy': return t(\"recipe.difficulty.easy\", \"简单\");\r\n      case 'medium': return t(\"recipe.difficulty.medium\", \"中等\");\r\n      case 'hard': return t(\"recipe.difficulty.hard\", \"困难\");\r\n      default: return d;\r\n    }\r\n  };\r\n\r\n  const hasImages = post.image_urls && post.image_urls.length > 0;\r\n  const hasSteps = post.steps && post.steps.length > 0;\r\n\r\n  // Guided mode - Cooking phase (full screen step-by-step)\r\n  if (viewMode === 'guided' && guidedPhase === 'cooking' && hasSteps) {\r\n    return (\r\n      <Card className=\"overflow-hidden\">\r\n        <RecipeCookingMode \r\n          steps={post.steps!} \r\n          onExit={() => setGuidedPhase('overview')} \r\n        />\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  // Guided mode - Overview phase\r\n  if (viewMode === 'guided') {\r\n    return (\r\n      <div className=\"space-y-4\">\r\n        {/* Mode toggle */}\r\n        <div className=\"flex justify-end\">\r\n          <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n            <button\r\n              onClick={() => setViewMode('guided')}\r\n              className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm\"\r\n            >\r\n              <PlayCircle className=\"h-4 w-4\" />\r\n              {t(\"recipe.guidedMode\", \"流程模式\")}\r\n            </button>\r\n            <button\r\n              onClick={() => setViewMode('full')}\r\n              className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5\"\r\n            >\r\n              <List className=\"h-4 w-4\" />\r\n              {t(\"recipe.fullMode\", \"完整模式\")}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <RecipeOverview \r\n          post={post} \r\n          onStartCooking={handleStartCooking} \r\n        />\r\n\r\n        {/* Stats */}\r\n        <Card>\r\n          <CardContent className=\"py-4\">\r\n            <div className=\"flex items-center gap-6 text-muted-foreground\">\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <Heart className=\"h-4 w-4\" />\r\n                {post.likes_count || 0}\r\n              </span>\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <MessageCircle className=\"h-4 w-4\" />\r\n                {post.comments_count || 0}\r\n              </span>\r\n              <span className=\"flex items-center gap-1.5 text-sm\">\r\n                <Share2 className=\"h-4 w-4\" />\r\n                {post.shares_count || 0}\r\n              </span>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Full mode - Original layout with all content\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Mode toggle */}\r\n      <div className=\"flex justify-end\">\r\n        <div className=\"inline-flex h-9 items-center rounded-md bg-muted p-1 text-muted-foreground\">\r\n          <button\r\n            onClick={() => {\r\n              setViewMode('guided');\r\n              setGuidedPhase('overview');\r\n            }}\r\n            className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5\"\r\n          >\r\n            <PlayCircle className=\"h-4 w-4\" />\r\n            {t(\"recipe.guidedMode\", \"流程模式\")}\r\n          </button>\r\n          <button\r\n            onClick={() => setViewMode('full')}\r\n            className=\"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium transition-all gap-1.5 bg-background text-foreground shadow-sm\"\r\n          >\r\n            <List className=\"h-4 w-4\" />\r\n            {t(\"recipe.fullMode\", \"完整模式\")}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <Card className=\"overflow-hidden\">\r\n        {/* Hero Image */}\r\n        {hasImages && (\r\n          <div className=\"relative aspect-video overflow-hidden\">\r\n            <img\r\n              src={post.image_urls![0]}\r\n              alt={displayName || \"\"}\r\n              className=\"w-full h-full object-cover cursor-pointer\"\r\n              onClick={() => setPreviewImageUrl(post.image_urls![0])}\r\n            />\r\n            <Badge className=\"absolute top-3 left-3 bg-primary text-primary-foreground gap-1\">\r\n              <Utensils className=\"h-3 w-3\" />\r\n              {t(\"recipe.badge\", \"食谱\")}\r\n            </Badge>\r\n          </div>\r\n        )}\r\n\r\n        <CardHeader className=\"pb-3\">\r\n          {/* Author */}\r\n          <div className=\"flex items-center gap-3 mb-4\">\r\n            <Avatar className=\"h-10 w-10\">\r\n              <AvatarImage src={post.author?.avatar_url || undefined} />\r\n              <AvatarFallback>\r\n                {post.author?.display_name?.charAt(0) || \"?\"}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <div>\r\n              <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                {formatDistanceToNow(new Date(post.created_at), {\r\n                  addSuffix: true,\r\n                  locale: getDateLocale(),\r\n                })}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Translate All Button - above recipe name */}\r\n          <div className=\"mb-2\">\r\n            <TranslateButton \r\n              text={buildTranslationText()} \r\n              onTranslation={handleTranslation}\r\n              label={t(\"recipe.translateAllFull\")}\r\n            />\r\n          </div>\r\n\r\n          {/* Recipe Name */}\r\n          <h2 className=\"text-xl font-bold\">{displayName}</h2>\r\n\r\n          {/* Meta Info */}\r\n          <div className=\"flex flex-wrap items-center gap-3 mt-3\">\r\n            {post.cook_time && (\r\n              <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n                <Clock className=\"h-4 w-4\" />\r\n                <span>{post.cook_time} {t(\"recipe.minutes\", \"分钟\")}</span>\r\n              </div>\r\n            )}\r\n            {post.servings && (\r\n              <div className=\"flex items-center gap-1.5 text-sm text-muted-foreground\">\r\n                <Users className=\"h-4 w-4\" />\r\n                <span>{post.servings} {t(\"recipe.servings\", \"人份\")}</span>\r\n              </div>\r\n            )}\r\n            {post.difficulty && (\r\n              <Badge variant=\"outline\" className={getDifficultyColor(post.difficulty)}>\r\n                <ChefHat className=\"h-3 w-3 mr-1\" />\r\n                {getDifficultyLabel(post.difficulty)}\r\n              </Badge>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"space-y-6\">\r\n          {/* Description - only show if there's actual content */}\r\n          {post.content && post.content.trim() && !post.content.includes('主要配料：') && (\r\n            <div>\r\n              <p className=\"text-sm text-muted-foreground whitespace-pre-line\">\r\n                {displayContent}\r\n              </p>\r\n            </div>\r\n          )}\r\n\r\n          {/* Nutrition Info */}\r\n          {post.nutrition && (post.nutrition.calories || post.nutrition.protein || post.nutrition.carbs || post.nutrition.fat) && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3 flex items-center gap-2\">\r\n                <Flame className=\"h-4 w-4 text-primary\" />\r\n                {t(\"recipe.nutrition\", \"营养信息\")}\r\n              </h3>\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                {post.nutrition.calories && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.calories}</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.kcal\", \"千卡\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.protein && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.protein}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.protein\", \"蛋白质\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.carbs && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.carbs}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.carbs\", \"碳水\")}</p>\r\n                  </div>\r\n                )}\r\n                {post.nutrition.fat && (\r\n                  <div className=\"text-center p-2 bg-muted/50 rounded-lg\">\r\n                    <p className=\"text-lg font-bold text-primary\">{post.nutrition.fat}g</p>\r\n                    <p className=\"text-xs text-muted-foreground\">{t(\"recipe.fat\", \"脂肪\")}</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <Separator />\r\n\r\n          {/* Ingredients */}\r\n          {post.ingredients && post.ingredients.length > 0 && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.ingredients\", \"食材\")} ({post.ingredients.length})\r\n              </h3>\r\n              {/* Table header */}\r\n              <div className=\"flex items-center text-xs text-muted-foreground font-medium px-2 py-1.5 bg-muted/50 rounded-t-md border border-border/50\">\r\n                <span className=\"flex-1\">{t(\"recipe.ingredientName\", \"名称\")}</span>\r\n                <span className=\"w-24 text-right\">{t(\"recipe.amount\", \"用量\")}</span>\r\n              </div>\r\n              <ul className=\"border border-t-0 border-border/50 rounded-b-md divide-y divide-border/50\">\r\n                {post.ingredients.map((ingredient, index) => (\r\n                  <li key={index} className=\"flex items-center text-sm px-2 py-2\">\r\n                    <span className=\"flex-1 min-w-0 truncate\">{translatedIngredients[index] || ingredient.name}</span>\r\n                    <span className=\"w-24 text-right text-muted-foreground shrink-0\">\r\n                      {ingredient.amount} {ingredient.unit}\r\n                    </span>\r\n                  </li>\r\n                ))}\r\n              </ul>\r\n              <RecipeAds />\r\n            </div>\r\n          )}\r\n\r\n          <Separator />\r\n\r\n          {/* Steps */}\r\n          {hasSteps && (\r\n            <div>\r\n              <h3 className=\"font-semibold text-sm mb-3\">\r\n                {t(\"recipe.steps\", \"步骤\")} ({post.steps!.length})\r\n              </h3>\r\n              <ol className=\"space-y-4\">\r\n                {post.steps!\r\n                  .sort((a, b) => a.order - b.order)\r\n                  .map((step, index) => (\r\n                    <li key={index} className=\"flex gap-3\">\r\n                      <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\r\n                        {step.order}\r\n                      </div>\r\n                      <div className=\"flex-1 space-y-2\">\r\n                        <p className=\"text-sm\">{translatedSteps[index] || step.description}</p>\r\n                        {(() => {\r\n                          const imgs = (step.image_urls && step.image_urls.length > 0) ? step.image_urls : step.image_url ? [step.image_url] : [];\r\n                          return imgs.length > 0 && (\r\n                            <div className={`flex gap-2 ${imgs.length === 1 ? '' : 'flex-wrap'}`}>\r\n                              {imgs.map((url, imgIdx) => (\r\n                                <img\r\n                                  key={imgIdx}\r\n                                  src={url}\r\n                                  alt={`Step ${step.order} - ${imgIdx + 1}`}\r\n                                  className={`rounded-lg max-h-48 object-cover cursor-pointer ${imgs.length === 1 ? 'w-full' : 'w-[calc(50%-0.25rem)]'}`}\r\n                                  onClick={() => setPreviewImageUrl(url)}\r\n                                />\r\n                              ))}\r\n                            </div>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </li>\r\n                  ))}\r\n              </ol>\r\n            </div>\r\n          )}\r\n\r\n          {/* Tags */}\r\n          {post.recipe_tags && post.recipe_tags.length > 0 && (\r\n            <div className=\"flex flex-wrap gap-2 pt-2\">\r\n              {post.recipe_tags.map((tag, index) => (\r\n                <Badge key={index} variant=\"secondary\" className=\"text-xs\">\r\n                  #{tag}\r\n                </Badge>\r\n              ))}\r\n            </div>\r\n          )}\r\n\r\n          {/* Stats */}\r\n          <div className=\"flex items-center gap-6 pt-4 border-t text-muted-foreground\">\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <Heart className=\"h-4 w-4\" />\r\n              {post.likes_count || 0}\r\n            </span>\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <MessageCircle className=\"h-4 w-4\" />\r\n              {post.comments_count || 0}\r\n            </span>\r\n            <span className=\"flex items-center gap-1.5 text-sm\">\r\n              <Share2 className=\"h-4 w-4\" />\r\n              {post.shares_count || 0}\r\n            </span>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      <ImagePreviewModal\r\n        imageUrl={previewImageUrl || \"\"}\r\n        isOpen={!!previewImageUrl}\r\n        onClose={() => setPreviewImageUrl(null)}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RecipeDetailContent;\r\n"],"names":["PostCard","post","showActions","isDetailPage","t","i18n","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","sharePost","useSharePost","deletePost","useDeletePost","showDeleteDialog","setShowDeleteDialog","useState","showEditDialog","setShowEditDialog","imageError","setImageError","previewOpen","setPreviewOpen","previewIndex","setPreviewIndex","carouselApi","setCarouselApi","previewCarouselApi","setPreviewCarouselApi","currentSlide","setCurrentSlide","translatedContent","setTranslatedContent","imageDimensions","setImageDimensions","longImageScrollStart","setLongImageScrollStart","showAllRestaurants","setShowAllRestaurants","smartShareFn","SmartShareDrawer","useSmartShare","useEffect","scrollY","getDateLocale","zhCN","pt","enUS","handleLike","handleShare","shareUrl","toast","handleDelete","handleImageClick","index","handleImageLoad","e","url","img","prev","isLongImage","dims","isAuthor","activityTitle","allRestaurants","r","maxVisibleRestaurants","visibleRestaurants","hasMoreRestaurants","localizedContent","hasLocalizedTranslation","displayContent","jsxs","Fragment","Card","jsx","CardHeader","Avatar","AvatarImage","AvatarFallback","Badge","Clock","DropdownMenu","DropdownMenuTrigger","Button","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","Pencil","CardContent","Link","Calendar","restaurant","MapPin","ChevronDown","ChevronUp","TranslateButton","displayImageUrls","isLong","FileImage","Carousel","CarouselContent","CarouselItem","_","CardFooter","Heart","MessageCircle","Share2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","EditRecipeDialog","EditPostDialog","createPortal","X","api","target","deltaY","deltaScroll","touch","ChevronLeft","ChevronRight","adsTable","supabase","RecipeAds","isMobile","useIsMobile","pendingUrl","setPendingUrl","pendingAdName","setPendingAdName","ads","useQuery","now","data","error","handleAdClick","ad","handleConfirm","getImageUrl","imgUrl","ExternalLink","ExternalLinkConfirmDialog","open","RecipeOverview","onStartCooking","translatedName","setTranslatedName","translatedIngredients","setTranslatedIngredients","previewImageUrl","setPreviewImageUrl","showFullContent","setShowFullContent","showAllIngredients","setShowAllIngredients","CONTENT_MAX_LENGTH","INGREDIENTS_PREVIEW_COUNT","field","localizedValue","displayName","buildTranslationText","parts","ingredientNames","i","handleTranslation","translated","section","names","map","name","idx","getDifficultyColor","d","getDifficultyLabel","hasImages","hasSteps","Utensils","Users","ChefHat","Flame","Separator","ingredient","tag","PlayCircle","ImagePreviewModal","RecipeCookingMode","steps","onExit","currentStep","setCurrentStep","translatedSteps","setTranslatedSteps","sortedSteps","a","b","totalSteps","step","progress","isLastStep","isFirstStep","handleNext","handlePrev","handleComplete","s","descriptions","desc","Progress","imgs","imgIdx","Check","RecipeDetailContent","viewMode","setViewMode","guidedPhase","setGuidedPhase","useRef","handleStartCooking","useCallback","stepDescs","descs","List"],"mappings":"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"}