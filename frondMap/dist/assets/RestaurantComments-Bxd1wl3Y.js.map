{"version":3,"file":"RestaurantComments-Bxd1wl3Y.js","sources":["../../src/components/TranslateButton.tsx","../../src/components/TranslatableText.tsx","../../src/components/ImagePreviewModal.tsx","../../src/components/RestaurantComments.tsx"],"sourcesContent":["import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Languages, Loader2, RotateCcw } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\n\r\ninterface TranslateButtonProps {\r\n  text: string;\r\n  className?: string;\r\n  onTranslation?: (translatedText: string | null) => void;\r\n}\r\n\r\n// Simple cache to store translations and avoid repeated API calls\r\nconst translationCache = new Map<string, string>();\r\n\r\nconst TranslateButton = ({ text, className, onTranslation }: TranslateButtonProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [isTranslating, setIsTranslating] = useState(false);\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n  const [showTranslation, setShowTranslation] = useState(false);\r\n  const [lastTranslatedLang, setLastTranslatedLang] = useState<string | null>(null);\r\n\r\n  // Reset translation when language changes\r\n  const currentLang = i18n.language;\r\n  \r\n  // If language changed and we have a translation, reset it\r\n  if (lastTranslatedLang && lastTranslatedLang !== currentLang && showTranslation) {\r\n    setShowTranslation(false);\r\n    setTranslatedText(null);\r\n    onTranslation?.(null);\r\n  }\r\n\r\n  const handleTranslate = async () => {\r\n    // Get current language at call time, not render time\r\n    const targetLang = i18n.language;\r\n    const cacheKey = `${text.substring(0, 100)}_${targetLang}`;\r\n    \r\n    // If already showing translation for the same language, toggle back to original\r\n    if (showTranslation && lastTranslatedLang === targetLang) {\r\n      setShowTranslation(false);\r\n      onTranslation?.(null);\r\n      return;\r\n    }\r\n\r\n    // Check global cache\r\n    const cached = translationCache.get(cacheKey);\r\n    if (cached) {\r\n      setTranslatedText(cached);\r\n      setShowTranslation(true);\r\n      setLastTranslatedLang(targetLang);\r\n      onTranslation?.(cached);\r\n      return;\r\n    }\r\n\r\n    // Call translation API\r\n    setIsTranslating(true);\r\n    console.log('[TranslateButton] Calling translate-content with targetLang:', targetLang);\r\n    try {\r\n      const { data, error } = await supabase.functions.invoke('translate-content', {\r\n        body: { text, targetLang }\r\n      });\r\n      console.log('[TranslateButton] Response:', data, error);\r\n\r\n      if (error) {\r\n        console.error('Translation error:', error);\r\n        toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n        return;\r\n      }\r\n\r\n      if (data?.translatedText) {\r\n        // Store in cache\r\n        translationCache.set(cacheKey, data.translatedText);\r\n        setTranslatedText(data.translatedText);\r\n        setShowTranslation(true);\r\n        setLastTranslatedLang(targetLang);\r\n        onTranslation?.(data.translatedText);\r\n      } else if (data?.error) {\r\n        toast.error(data.error);\r\n      }\r\n    } catch (err) {\r\n      console.error('Translation error:', err);\r\n      toast.error(t(\"translate.error\", \"翻译失败，请稍后重试\"));\r\n    } finally {\r\n      setIsTranslating(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Button\r\n      variant=\"ghost\"\r\n      size=\"sm\"\r\n      className={`gap-1.5 h-auto py-1 px-2 text-xs text-muted-foreground hover:text-foreground ${className || ''}`}\r\n      onClick={handleTranslate}\r\n      disabled={isTranslating}\r\n    >\r\n      {isTranslating ? (\r\n        <>\r\n          <Loader2 className=\"h-3 w-3 animate-spin\" />\r\n          <span>{t(\"translate.translating\", \"翻译中...\")}</span>\r\n        </>\r\n      ) : showTranslation ? (\r\n        <>\r\n          <RotateCcw className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.showOriginal\", \"显示原文\")}</span>\r\n        </>\r\n      ) : (\r\n        <>\r\n          <Languages className=\"h-3 w-3\" />\r\n          <span>{t(\"translate.button\", \"翻译\")}</span>\r\n        </>\r\n      )}\r\n    </Button>\r\n  );\r\n};\r\n\r\nexport default TranslateButton;\r\n","import { useState } from \"react\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\n\r\ninterface TranslatableTextProps {\r\n  text: string;\r\n  className?: string;\r\n}\r\n\r\nconst TranslatableText = ({ text, className }: TranslatableTextProps) => {\r\n  const [translatedText, setTranslatedText] = useState<string | null>(null);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <p className=\"text-xs sm:text-sm text-foreground break-words\">\r\n        {translatedText || text}\r\n      </p>\r\n      <TranslateButton \r\n        text={text} \r\n        onTranslation={setTranslatedText}\r\n        className=\"mt-0.5\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TranslatableText;\r\n","import { useState, useEffect, useRef, useLayoutEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface ImagePreviewModalProps {\r\n  imageUrl: string;\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n}\r\n\r\nconst ImagePreviewModal = ({ imageUrl, isOpen, onClose }: ImagePreviewModalProps) => {\r\n  const [isLongImage, setIsLongImage] = useState(false);\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n  const [scrollStart, setScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n  const [realWidth, setRealWidth] = useState(window.innerWidth);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      const scrollY = window.scrollY;\r\n      setRealWidth(window.innerWidth);\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [isOpen]);\r\n\r\n  // Reset state when image URL changes\r\n  useEffect(() => {\r\n    setIsLongImage(false);\r\n    setImageLoaded(false);\r\n  }, [imageUrl]);\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const img = e.currentTarget;\r\n    const ratio = img.naturalHeight / img.naturalWidth;\r\n    setIsLongImage(ratio > 1.5);\r\n    setImageLoaded(true);\r\n  };\r\n\r\n  const handleContainerClick = (e: React.MouseEvent) => {\r\n    if (e.target === e.currentTarget) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleTouchEnd = (e: React.TouchEvent) => {\r\n    if (!scrollStart) return;\r\n    \r\n    const touch = e.changedTouches[0];\r\n    const deltaY = Math.abs(touch.clientY - scrollStart.y);\r\n    const container = containerRef.current;\r\n    const deltaScroll = container ? Math.abs(container.scrollTop - scrollStart.scrollTop) : 0;\r\n    \r\n    if (deltaY < 15 && deltaScroll < 15) {\r\n      e.preventDefault();\r\n      onClose();\r\n    }\r\n    setScrollStart(null);\r\n  };\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return createPortal(\r\n    <div \r\n      className=\"fixed inset-0 z-[100] bg-black\"\r\n      style={{ \r\n        left: 0,\r\n        right: 0,\r\n        top: 0,\r\n        bottom: 0,\r\n        width: '100vw',\r\n        height: '100dvh',\r\n        overflow: 'hidden',\r\n        margin: 0,\r\n        padding: 0\r\n      }}\r\n    >\r\n      {/* Close Button */}\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n        onClick={onClose}\r\n      >\r\n        <X className=\"h-6 w-6\" />\r\n      </Button>\r\n\r\n      {/* Image Container */}\r\n      <div \r\n        ref={containerRef}\r\n        className=\"w-full h-full overflow-x-hidden overscroll-contain\"\r\n        style={{\r\n          overflowY: isLongImage ? 'auto' : 'hidden',\r\n          WebkitOverflowScrolling: 'touch',\r\n        }}\r\n        onClick={handleContainerClick}\r\n        onTouchStart={(e) => {\r\n          setScrollStart({ \r\n            y: e.touches[0].clientY, \r\n            scrollTop: containerRef.current?.scrollTop || 0 \r\n          });\r\n        }}\r\n        onTouchEnd={handleTouchEnd}\r\n        onMouseDown={(e) => {\r\n          setScrollStart({ \r\n            y: e.clientY, \r\n            scrollTop: containerRef.current?.scrollTop || 0 \r\n          });\r\n        }}\r\n        onMouseUp={(e) => {\r\n          if (scrollStart) {\r\n            const deltaY = Math.abs(e.clientY - scrollStart.y);\r\n            const container = containerRef.current;\r\n            const deltaScroll = container ? Math.abs(container.scrollTop - scrollStart.scrollTop) : 0;\r\n            if (deltaY < 10 && deltaScroll < 10) {\r\n              onClose();\r\n            }\r\n            setScrollStart(null);\r\n          }\r\n        }}\r\n      >\r\n        {/* Hidden image to detect dimensions */}\r\n        {!imageLoaded && (\r\n          <img \r\n            src={imageUrl} \r\n            alt=\"\" \r\n            onLoad={handleImageLoad}\r\n            style={{ position: 'absolute', opacity: 0, pointerEvents: 'none' }}\r\n          />\r\n        )}\r\n        \r\n        {/* Actual visible image */}\r\n        {imageLoaded && (\r\n          isLongImage ? (\r\n            <img\r\n              src={imageUrl}\r\n              alt=\"\"\r\n              draggable={false}\r\n              className=\"select-none pointer-events-none\"\r\n              style={{ \r\n                display: 'block',\r\n                width: realWidth,\r\n                minWidth: '100vw',\r\n                maxWidth: '100vw',\r\n                height: 'auto'\r\n              }}\r\n            />\r\n          ) : (\r\n            <div \r\n              className=\"w-full h-full flex items-center justify-center\"\r\n              onClick={onClose}\r\n            >\r\n              <img\r\n                src={imageUrl}\r\n                alt=\"\"\r\n                draggable={false}\r\n                className=\"max-w-full max-h-full object-contain select-none\"\r\n              />\r\n            </div>\r\n          )\r\n        )}\r\n      </div>\r\n    </div>,\r\n    document.body\r\n  );\r\n};\r\n\r\nexport default ImagePreviewModal;\r\n","import { useState, useCallback, useMemo, memo } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport { useComments, useAddComment, useDeleteComment, Comment } from \"@/hooks/useComments\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useProfile } from \"@/hooks/useProfile\";\r\nimport { useUserRole } from \"@/hooks/useUserRole\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useCheckSensitiveWords } from \"@/hooks/useSensitiveWords\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { MessageSquare, Trash2, Reply, Image as ImageIcon, X, Star, DollarSign, ShieldAlert, VolumeX, Clock, AlertCircle } from \"lucide-react\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport ReportDialog from \"@/components/ReportDialog\";\r\nimport TranslatableText from \"@/components/TranslatableText\";\r\nimport ImagePreviewModal from \"@/components/ImagePreviewModal\";\r\n\r\ninterface RestaurantCommentsProps {\r\n  restaurantId?: string;\r\n  targetId?: string;\r\n  targetType?: \"restaurant\" | \"activity\" | \"post\";\r\n}\r\n\r\nconst priceRanges = [\r\n  { value: \"0-5\", label: \"0-5€\" },\r\n  { value: \"5-10\", label: \"5-10€\" },\r\n  { value: \"10-15\", label: \"10-15€\" },\r\n  { value: \"15-20\", label: \"15-20€\" },\r\n  { value: \"20-25\", label: \"20-25€\" },\r\n  { value: \"25-30\", label: \"25-30€\" },\r\n  { value: \"30-40\", label: \"30-40€\" },\r\n  { value: \"40-50\", label: \"40-50€\" },\r\n  { value: \"50+\", label: \"50€+\" },\r\n];\r\n\r\n// Component for comment image with long image detection\r\nconst CommentImage = memo(({ imageUrl, onPreview }: { imageUrl: string; onPreview: () => void }) => {\r\n  const { t } = useTranslation();\r\n  const [isLongImage, setIsLongImage] = useState(false);\r\n  const [imageLoaded, setImageLoaded] = useState(false);\r\n\r\n  const handleImageLoad = useCallback((e: React.SyntheticEvent<HTMLImageElement>) => {\r\n    const img = e.currentTarget;\r\n    const aspectRatio = img.naturalHeight / img.naturalWidth;\r\n    setIsLongImage(aspectRatio > 1.5);\r\n    setImageLoaded(true);\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"relative mt-2 inline-block max-w-full sm:max-w-sm w-full\">\r\n      <img\r\n        src={imageUrl}\r\n        alt=\"Comment attachment\"\r\n        className=\"rounded-lg w-full max-h-[300px] sm:max-h-[400px] object-cover object-top cursor-pointer hover:opacity-90 transition-opacity\"\r\n        onClick={onPreview}\r\n        onLoad={handleImageLoad}\r\n      />\r\n      {imageLoaded && isLongImage && (\r\n        <Badge \r\n          variant=\"secondary\" \r\n          className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-1.5 py-0.5\"\r\n        >\r\n          {t(\"community.longImage\", \"长图\")}\r\n        </Badge>\r\n      )}\r\n    </div>\r\n  );\r\n});\r\nCommentImage.displayName = \"CommentImage\";\r\n\r\nconst RestaurantComments = ({ restaurantId, targetId, targetType = \"restaurant\" }: RestaurantCommentsProps) => {\r\n  // Support both old prop name (restaurantId) and new prop name (targetId)\r\n  const actualTargetId = targetId || restaurantId || \"\";\r\n  const { t } = useTranslation();\r\n  const { user } = useAuth();\r\n  const { data: profile } = useProfile();\r\n  const { isAdmin } = useUserRole();\r\n  const { toast } = useToast();\r\n  const navigate = useNavigate();\r\n  const [newComment, setNewComment] = useState(\"\");\r\n  const [rating, setRating] = useState(0);\r\n  const [hoverRating, setHoverRating] = useState(0);\r\n  const [priceRange, setPriceRange] = useState(\"\");\r\n  const [replyTo, setReplyTo] = useState<string | null>(null);\r\n  const [replyContent, setReplyContent] = useState(\"\");\r\n  const [commentImage, setCommentImage] = useState<File | null>(null);\r\n  const [commentImagePreview, setCommentImagePreview] = useState<string | null>(null);\r\n  const [replyImage, setReplyImage] = useState<File | null>(null);\r\n  const [replyImagePreview, setReplyImagePreview] = useState<string | null>(null);\r\n  const [uploading, setUploading] = useState(false);\r\n  const [showLoginDialog, setShowLoginDialog] = useState(false);\r\n  const [deleteConfirmId, setDeleteConfirmId] = useState<string | null>(null);\r\n  const [previewImageUrl, setPreviewImageUrl] = useState<string | null>(null);\r\n\r\n  const { data: comments, isLoading } = useComments(actualTargetId, targetType);\r\n  const addComment = useAddComment();\r\n  const deleteComment = useDeleteComment();\r\n  const { checkContent } = useCheckSensitiveWords();\r\n\r\n  const uploadImage = useCallback(async (file: File): Promise<string | null> => {\r\n    try {\r\n      const fileExt = file.name.split(\".\").pop();\r\n      const fileName = `${user?.id}-${Date.now()}.${fileExt}`;\r\n      const filePath = `${fileName}`;\r\n\r\n      const { error: uploadError, data } = await supabase.storage\r\n        .from(\"comment-images\")\r\n        .upload(filePath, file);\r\n\r\n      if (uploadError) throw uploadError;\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from(\"comment-images\")\r\n        .getPublicUrl(filePath);\r\n\r\n      return publicUrl;\r\n    } catch (error) {\r\n      console.error(\"Error uploading image:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.imageUploadFailed\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return null;\r\n    }\r\n  }, [user, toast, t]);\r\n\r\n  const handleImageSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>, isReply: boolean = false) => {\r\n    const file = e.target.files?.[0];\r\n    if (file) {\r\n      if (file.size > 5 * 1024 * 1024) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"restaurant.imageTooLarge\"),\r\n          variant: \"destructive\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (isReply) {\r\n        setReplyImage(file);\r\n        setReplyImagePreview(URL.createObjectURL(file));\r\n      } else {\r\n        setCommentImage(file);\r\n        setCommentImagePreview(URL.createObjectURL(file));\r\n      }\r\n    }\r\n  }, [toast, t]);\r\n\r\n  const clearImage = useCallback((isReply: boolean = false) => {\r\n    if (isReply) {\r\n      setReplyImage(null);\r\n      setReplyImagePreview(null);\r\n    } else {\r\n      setCommentImage(null);\r\n      setCommentImagePreview(null);\r\n    }\r\n  }, []);\r\n\r\n  const handleSubmitComment = useCallback(async () => {\r\n    if (!newComment.trim() || !user) return;\r\n    \r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(newComment);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n    \r\n    // For restaurant comments, require rating\r\n    if (targetType === \"restaurant\" && !rating) {\r\n      toast({\r\n        title: t(\"common.hint\", \"提示\"),\r\n        description: t(\"toast.pleaseSelectRating\"),\r\n        variant: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (commentImage) {\r\n      const uploadedUrl = await uploadImage(commentImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: newComment,\r\n      ratingValue: targetType === \"restaurant\" ? rating : undefined,\r\n      priceRange: targetType === \"restaurant\" && priceRange ? priceRange : undefined,\r\n      imageUrl,\r\n    });\r\n\r\n    setNewComment(\"\");\r\n    setRating(0);\r\n    setPriceRange(\"\");\r\n    setCommentImage(null);\r\n    setCommentImagePreview(null);\r\n    setUploading(false);\r\n  }, [newComment, user, profile, targetType, rating, toast, t, commentImage, uploadImage, addComment, restaurantId, priceRange, checkContent]);\r\n\r\n  const handleSubmitReply = useCallback(async (parentId: string) => {\r\n    if (!replyContent.trim() || !user) return;\r\n\r\n    // Check if user is muted\r\n    if (profile?.is_muted) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.youAreMuted\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Check for sensitive words\r\n    const sensitiveCheck = checkContent(replyContent);\r\n    if (sensitiveCheck.hasSensitive) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"restaurant.sensitiveWordsDetected\", \"评论包含敏感词，请修改后重试\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setUploading(true);\r\n    let imageUrl: string | undefined;\r\n\r\n    if (replyImage) {\r\n      const uploadedUrl = await uploadImage(replyImage);\r\n      if (uploadedUrl) imageUrl = uploadedUrl;\r\n    }\r\n\r\n    await addComment.mutateAsync({\r\n      targetId: actualTargetId,\r\n      targetType: targetType,\r\n      content: replyContent,\r\n      parentId,\r\n      imageUrl,\r\n    });\r\n\r\n    setReplyContent(\"\");\r\n    setReplyTo(null);\r\n    setReplyImage(null);\r\n    setReplyImagePreview(null);\r\n    setUploading(false);\r\n  }, [replyContent, user, profile, replyImage, uploadImage, addComment, restaurantId, targetType, checkContent, toast, t]);\r\n\r\n  const handleDeleteComment = useCallback(async (commentId: string) => {\r\n    await deleteComment.mutateAsync(commentId);\r\n    setDeleteConfirmId(null);\r\n  }, [deleteComment]);\r\n\r\n  const CommentItem = memo(({ comment, isReply = false }: { comment: Comment; isReply?: boolean }) => (\r\n    <div className={`flex gap-2 sm:gap-3 ${isReply ? \"ml-8 sm:ml-12 mt-3\" : \"\"}`}>\r\n      <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n        <AvatarImage src={comment.profiles?.avatar_url} />\r\n        <AvatarFallback className=\"text-xs sm:text-sm\">\r\n          {comment.profiles?.display_name?.charAt(0).toUpperCase() || \"U\"}\r\n        </AvatarFallback>\r\n      </Avatar>\r\n      <div className=\"flex-1 min-w-0\">\r\n        <div className=\"flex items-center gap-2 flex-wrap\">\r\n          <span className=\"font-semibold text-xs sm:text-sm truncate\">{comment.profiles?.display_name}</span>\r\n          <span className=\"text-xs text-muted-foreground shrink-0\">\r\n            {formatDistanceToNow(new Date(comment.created_at), { addSuffix: true })}\r\n          </span>\r\n          {comment.edited && (\r\n            <span className=\"text-xs text-muted-foreground italic\">({t(\"restaurant.edited\")})</span>\r\n          )}\r\n          {/* Show moderation status badges for user's own comments */}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"pending\" && (\r\n            <Badge variant=\"outline\" className=\"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs py-0 h-5\">\r\n              <Clock className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentPending\", \"审核中\")}\r\n            </Badge>\r\n          )}\r\n          {user?.id === comment.user_id && comment.moderation_status === \"flagged\" && (\r\n            <Badge variant=\"outline\" className=\"text-destructive border-destructive bg-destructive/10 text-xs py-0 h-5\">\r\n              <AlertCircle className=\"w-3 h-3 mr-1\" />\r\n              {t(\"restaurant.commentFailed\", \"发送失败\")}\r\n            </Badge>\r\n          )}\r\n        </div>\r\n        \r\n        {/* Display rating and price range for main comments */}\r\n        {!isReply && comment.rating_value && (\r\n          <div className=\"flex items-center gap-3 mt-1 mb-2\">\r\n            <div className=\"flex items-center gap-1\">\r\n              {[1, 2, 3, 4, 5].map((star) => (\r\n                <Star\r\n                  key={star}\r\n                  className={cn(\r\n                    \"w-4 h-4\",\r\n                    star <= comment.rating_value!\r\n                      ? \"fill-accent text-accent\"\r\n                      : \"text-muted-foreground\"\r\n                  )}\r\n                />\r\n              ))}\r\n            </div>\r\n            {comment.price_range && (\r\n              <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\r\n                <DollarSign className=\"w-3 h-3\" />\r\n                <span>{priceRanges.find(r => r.value === comment.price_range)?.label}</span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n        \r\n        <TranslatableText text={comment.content} className=\"mt-1\" />\r\n        {comment.image_url && (\r\n          <CommentImage \r\n            imageUrl={comment.image_url} \r\n            onPreview={() => setPreviewImageUrl(comment.image_url!)} \r\n          />\r\n        )}\r\n        <div className=\"flex gap-2 sm:gap-3 mt-2\">\r\n          {!isReply && user && !profile?.is_muted && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setReplyTo(comment.id)}\r\n              className=\"h-7 text-xs px-2 sm:px-3\"\r\n            >\r\n              <Reply className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"restaurant.reply\")}</span>\r\n            </Button>\r\n          )}\r\n          {(user?.id === comment.user_id || isAdmin) && (\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              onClick={() => setDeleteConfirmId(comment.id)}\r\n              className=\"h-7 text-xs text-destructive hover:text-destructive px-2 sm:px-3\"\r\n            >\r\n              <Trash2 className=\"w-3 h-3 mr-1\" />\r\n              <span className=\"hidden xs:inline\">{t(\"common.delete\")}</span>\r\n            </Button>\r\n          )}\r\n          {user?.id !== comment.user_id && (\r\n            <ReportDialog\r\n              targetType=\"comment\"\r\n              targetId={comment.id}\r\n              onLoginRequired={() => setShowLoginDialog(true)}\r\n              trigger={\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-7 text-xs px-2 sm:px-3\"\r\n                >\r\n                  <ShieldAlert className=\"w-3 h-3 mr-1\" />\r\n                  <span className=\"hidden xs:inline\">{t(\"report.title\")}</span>\r\n                </Button>\r\n              }\r\n            />\r\n          )}\r\n        </div>\r\n\r\n        {replyTo === comment.id && (\r\n          <div className=\"mt-3 space-y-2\">\r\n            <div className=\"flex flex-col sm:flex-row gap-2\">\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Textarea\r\n                  value={replyContent}\r\n                  onChange={(e) => setReplyContent(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeReply\")}\r\n                  className=\"min-h-[80px] text-sm\"\r\n                />\r\n                  {replyImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={replyImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(replyImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(true)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n              </div>\r\n              <div className=\"flex sm:flex-col gap-2\">\r\n                <Button\r\n                  size=\"sm\"\r\n                  onClick={() => handleSubmitReply(comment.id)}\r\n                  disabled={!replyContent.trim() || uploading}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {uploading ? t(\"common.loading\") : t(\"restaurant.reply\")}\r\n                </Button>\r\n                <Input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => handleImageSelect(e, true)}\r\n                  className=\"hidden\"\r\n                  id={`reply-image-${comment.id}`}\r\n                  disabled={uploading}\r\n                />\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => document.getElementById(`reply-image-${comment.id}`)?.click()}\r\n                  disabled={uploading}\r\n                  className=\"text-xs sm:px-3\"\r\n                >\r\n                  <ImageIcon className=\"h-4 w-4 sm:mr-1\" />\r\n                  <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                </Button>\r\n                <Button\r\n                  size=\"sm\"\r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setReplyTo(null);\r\n                    setReplyContent(\"\");\r\n                    clearImage(true);\r\n                  }}\r\n                  className=\"text-xs\"\r\n                >\r\n                  {t(\"common.cancel\")}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {comment.replies && comment.replies.length > 0 && (\r\n          <div className=\"mt-3 space-y-3\">\r\n            {comment.replies.map((reply) => (\r\n              <CommentItem key={reply.id} comment={reply} isReply />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  ));\r\n  CommentItem.displayName = \"CommentItem\";\r\n\r\n  if (isLoading) {\r\n    return <div className=\"text-center py-8\">{t(\"common.loading\")}</div>;\r\n  }\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 sm:space-y-6\">\r\n      <div className=\"flex items-center gap-2\">\r\n        <MessageSquare className=\"w-4 sm:w-5 h-4 sm:h-5\" />\r\n        <h2 className=\"text-xl sm:text-2xl font-bold\">\r\n          {t(\"restaurant.reviews\")} ({comments?.length || 0})\r\n        </h2>\r\n      </div>\r\n\r\n      {user ? (\r\n        profile?.is_muted ? (\r\n          <Card className=\"border-yellow-300 bg-yellow-50/50 dark:bg-yellow-950/20\">\r\n            <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6\">\r\n              <div className=\"flex items-center gap-3 text-yellow-600 dark:text-yellow-400\">\r\n                <VolumeX className=\"w-5 h-5 shrink-0\" />\r\n                <span className=\"text-sm font-medium\">{t(\"restaurant.youAreMutedNotice\")}</span>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ) : (\r\n        <Card>\r\n          <CardContent className=\"pt-4 sm:pt-6 px-3 sm:px-6\">\r\n            <div className=\"flex gap-2 sm:gap-3\">\r\n              <Avatar className=\"w-8 h-8 sm:w-10 sm:h-10 shrink-0\">\r\n                <AvatarImage src={profile?.avatar_url || undefined} />\r\n                <AvatarFallback className=\"text-xs sm:text-sm\">\r\n                  {profile?.display_name?.charAt(0).toUpperCase() || user?.email?.charAt(0).toUpperCase() || \"U\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div className=\"flex-1 space-y-2 sm:space-y-3 min-w-0\">\r\n                {/* Rating and Price Range - Only for restaurant */}\r\n                {targetType === \"restaurant\" && (\r\n                  <div className=\"space-y-3\">\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <Star className=\"w-4 h-4 text-accent\" />\r\n                        评分 <span className=\"text-destructive\">*</span>\r\n                      </label>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onMouseEnter={() => setHoverRating(star)}\r\n                            onMouseLeave={() => setHoverRating(0)}\r\n                            onClick={() => setRating(star)}\r\n                            className=\"transition-transform hover:scale-110\"\r\n                          >\r\n                            <Star\r\n                              className={cn(\r\n                                \"w-7 h-7 cursor-pointer transition-colors\",\r\n                                star <= (hoverRating || rating)\r\n                                  ? \"fill-accent text-accent\"\r\n                                  : \"text-muted-foreground hover:text-accent\"\r\n                              )}\r\n                            />\r\n                          </button>\r\n                        ))}\r\n                        {rating > 0 && (\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">\r\n                            ({rating}/5)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n\r\n                    <div className=\"space-y-2\">\r\n                      <label className=\"text-sm font-medium flex items-center gap-2\">\r\n                        <DollarSign className=\"w-4 h-4\" />\r\n                        {t(\"restaurant.priceRange\")}\r\n                      </label>\r\n                      <Select value={priceRange} onValueChange={setPriceRange}>\r\n                        <SelectTrigger className=\"w-full\">\r\n                          <SelectValue placeholder={t(\"restaurant.selectPriceRange\")} />\r\n                        </SelectTrigger>\r\n                        <SelectContent className=\"bg-background\">\r\n                          {priceRanges.map((range) => (\r\n                            <SelectItem key={range.value} value={range.value}>\r\n                              {range.label}\r\n                            </SelectItem>\r\n                          ))}\r\n                        </SelectContent>\r\n                      </Select>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                <Textarea\r\n                  value={newComment}\r\n                  onChange={(e) => setNewComment(e.target.value)}\r\n                  placeholder={t(\"restaurant.writeComment\")}\r\n                  className=\"min-h-[80px] sm:min-h-[100px] text-sm\"\r\n                />\r\n                {commentImagePreview && (\r\n                  <div className=\"relative inline-block\">\r\n                    <img\r\n                      src={commentImagePreview}\r\n                      alt=\"Preview\"\r\n                      className=\"w-24 h-24 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity\"\r\n                      onClick={() => setPreviewImageUrl(commentImagePreview)}\r\n                    />\r\n                    <Button\r\n                      size=\"icon\"\r\n                      variant=\"destructive\"\r\n                      className=\"absolute -top-2 -right-2 h-6 w-6 rounded-full\"\r\n                      onClick={() => clearImage(false)}\r\n                    >\r\n                      <X className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </div>\r\n                )}\r\n                <div className=\"flex flex-wrap gap-2\">\r\n                  <Input\r\n                    type=\"file\"\r\n                    accept=\"image/*\"\r\n                    onChange={(e) => handleImageSelect(e, false)}\r\n                    className=\"hidden\"\r\n                    id=\"comment-image\"\r\n                    disabled={uploading}\r\n                  />\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => document.getElementById(\"comment-image\")?.click()}\r\n                    disabled={uploading}\r\n                    className=\"text-xs\"\r\n                  >\r\n                    <ImageIcon className=\"h-4 w-4 sm:mr-2\" />\r\n                    <span className=\"hidden sm:inline\">{t(\"restaurant.addImage\")}</span>\r\n                  </Button>\r\n                  <Button\r\n                    onClick={handleSubmitComment}\r\n                    disabled={!newComment.trim() || addComment.isPending || uploading}\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                  >\r\n                    {uploading || addComment.isPending ? t(\"common.loading\") : t(\"restaurant.postComment\")}\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        )\r\n      ) : (\r\n        <Card>\r\n          <CardContent className=\"py-4 sm:py-6 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.signInToComment\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      <div className=\"space-y-4 sm:space-y-6\">\r\n        {comments?.map((comment) => (\r\n          <Card key={comment.id}>\r\n            <CardHeader className=\"p-3 sm:p-6\">\r\n              <CommentItem comment={comment} />\r\n            </CardHeader>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n\r\n      {comments?.length === 0 && (\r\n        <Card>\r\n          <CardContent className=\"py-8 sm:py-12 px-3 sm:px-6 text-center text-muted-foreground text-sm\">\r\n            {t(\"restaurant.noComments\")}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n\r\n    {/* Login Required Dialog */}\r\n    <AlertDialog open={showLoginDialog} onOpenChange={setShowLoginDialog}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{t(\"activities.loginRequired\")}</AlertDialogTitle>\r\n          <AlertDialogDescription>\r\n            {t(\"activities.loginRequiredMessage\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n          <AlertDialogAction onClick={() => navigate(\"/auth\")}>\r\n            {t(\"activities.goToLogin\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n\r\n    {/* Delete Comment Confirmation Dialog */}\r\n    <AlertDialog open={!!deleteConfirmId} onOpenChange={(open) => !open && setDeleteConfirmId(null)}>\r\n      <AlertDialogContent className=\"max-w-sm\">\r\n        <AlertDialogHeader>\r\n          <div className=\"mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full bg-destructive/10\">\r\n            <Trash2 className=\"h-7 w-7 text-destructive\" />\r\n          </div>\r\n          <AlertDialogTitle className=\"text-center\">\r\n            {t(\"restaurant.deleteComment\")}\r\n          </AlertDialogTitle>\r\n          <AlertDialogDescription className=\"text-center\">\r\n            {t(\"restaurant.confirmDelete\")}\r\n          </AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter className=\"sm:justify-center gap-2\">\r\n          <AlertDialogCancel className=\"sm:w-24\">\r\n            {t(\"common.cancel\")}\r\n          </AlertDialogCancel>\r\n          <AlertDialogAction\r\n            onClick={() => deleteConfirmId && handleDeleteComment(deleteConfirmId)}\r\n            className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90 sm:w-24\"\r\n          >\r\n            {t(\"common.delete\")}\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n    \r\n    {/* Image Preview Modal */}\r\n    <ImagePreviewModal\r\n      imageUrl={previewImageUrl || \"\"}\r\n      isOpen={!!previewImageUrl}\r\n      onClose={() => setPreviewImageUrl(null)}\r\n    />\r\n    </>\r\n  );\r\n};\r\n\r\nexport default RestaurantComments;\r\n"],"names":["translationCache","TranslateButton","text","className","onTranslation","t","i18n","useTranslation","isTranslating","setIsTranslating","useState","translatedText","setTranslatedText","showTranslation","setShowTranslation","lastTranslatedLang","setLastTranslatedLang","currentLang","handleTranslate","targetLang","cacheKey","cached","data","error","supabase","toast","err","jsx","Button","jsxs","Fragment","Loader2","RotateCcw","Languages","TranslatableText","ImagePreviewModal","imageUrl","isOpen","onClose","isLongImage","setIsLongImage","imageLoaded","setImageLoaded","scrollStart","setScrollStart","realWidth","setRealWidth","containerRef","useRef","useEffect","scrollY","handleImageLoad","e","img","ratio","handleContainerClick","handleTouchEnd","touch","deltaY","container","deltaScroll","createPortal","X","priceRanges","CommentImage","memo","onPreview","useCallback","aspectRatio","Badge","RestaurantComments","restaurantId","targetId","targetType","actualTargetId","user","useAuth","profile","useProfile","isAdmin","useUserRole","useToast","navigate","useNavigate","newComment","setNewComment","rating","setRating","hoverRating","setHoverRating","priceRange","setPriceRange","replyTo","setReplyTo","replyContent","setReplyContent","commentImage","setCommentImage","commentImagePreview","setCommentImagePreview","replyImage","setReplyImage","replyImagePreview","setReplyImagePreview","uploading","setUploading","showLoginDialog","setShowLoginDialog","deleteConfirmId","setDeleteConfirmId","previewImageUrl","setPreviewImageUrl","comments","isLoading","useComments","addComment","useAddComment","deleteComment","useDeleteComment","checkContent","useCheckSensitiveWords","uploadImage","file","fileExt","filePath","uploadError","publicUrl","handleImageSelect","isReply","clearImage","handleSubmitComment","uploadedUrl","handleSubmitReply","parentId","handleDeleteComment","commentId","CommentItem","comment","Avatar","AvatarImage","AvatarFallback","Clock","AlertCircle","star","Star","cn","DollarSign","r","Reply","Trash2","ReportDialog","ShieldAlert","Textarea","Input","ImageIcon","reply","MessageSquare","Card","CardContent","VolumeX","Select","SelectTrigger","SelectValue","SelectContent","range","SelectItem","CardHeader","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","open"],"mappings":"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"}