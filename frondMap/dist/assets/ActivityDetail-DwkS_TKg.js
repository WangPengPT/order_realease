import{c as Ls,j as e,n as o,C as H,o as Y,p as W,r as i,u as X,B as w,M as we,D as Ce,d as ke,e as Se,f as _e,m as te,a9 as es,aa as $e,x as R,ab as oe,ac as ss,L as K,K as as,ad as Ts,ae as Oe,O as Es,Q as As,R as Is,T as P,V as Be,N as A,af as ts,y as Z,G as Ms,J as Ps,a as Rs,t as Fs,ag as zs,ah as T,i as ae,z as He,k as $s,a6 as Os,a7 as Bs,a8 as Hs,a5 as qs,E as qe,W as Us,Y as Gs,Z as Ws,$ as Xs,a0 as Vs,a1 as Js,a2 as Qs,a3 as Ys}from"./index-tBrG_sQo.js";import{S as Ue}from"./separator-Bhf_yabo.js";import{C as Zs,a as Ks,b as ea}from"./collapsible-RiYgVVfA.js";import{a as sa,C as aa,p as Ge}from"./xiaoxiong-logo-v3-CipwHCt9.js";import{b as ta,c as ra,a as na,d as ia,e as la,f as oa,g as ca,h as da}from"./useActivities-BfgvOiGy.js";import{u as ma,a as ha,b as ua}from"./useActivityParticipation-Cbngg8Mx.js";import{u as rs}from"./useLocalizedContent-C8cRpYbI.js";import xa from"./RestaurantComments-BLehiucG.js";import{m as G}from"./mapbox-gl-Bo0TkXhU.js";import{b as pa,c as be,m as ga}from"./externalLinks-DoJcn4fI.js";import{T as fa}from"./triangle-alert-CUdoTqdA.js";import{C as We}from"./checkbox-Bp8vb7M1.js";import{R as ja}from"./ReportDialog-DUf60CTN.js";import{A as va}from"./ActivityTermsAgreement-B2gUOuAL.js";import{T as Na,a as wa,b as fe,c as je}from"./tabs-Dwxc8yrY.js";import{u as ba,a as ya}from"./useGlobalHandbook-rZAXeX8L.js";import{R as ve}from"./RichTextEditor-DJqY-WqT.js";import{B as ye}from"./book-open-CeOIL4q4.js";import{S as Ca}from"./save-CgfNIfho.js";import{S as ka}from"./square-pen-DX51RvZ3.js";import{L as Sa}from"./LocationPermissionDialog-4PSizDlA.js";import{u as ns}from"./use-mobile-CV99uTOU.js";import{C as _a}from"./circle-check-big-BCKwhIZv.js";import{G as ce}from"./gift-BfDyMfYG.js";import{S as B}from"./share-2-Ds55YXQl.js";import{M as le}from"./message-circle-CSIQGvho.js";import{L as Da}from"./link-2-gPFh2p_o.js";import{g as La,c as Ta,N as Ne}from"./geolocation-CL5hmKkt.js";import{u as Ea,a as Aa,b as Ia,c as Ma}from"./useCoupons-D8Bq6W7Z.js";import{u as Pa}from"./usePageView-BaAQlfSB.js";import{F as Ra}from"./forward-BgjVnSzQ.js";import{U as is}from"./users-CKOtRTM7.js";import{C as Fa}from"./chevron-left-Cd8qLCGa.js";import{S as Xe}from"./shield-alert-CL6ZHph9.js";import{F as za}from"./file-pen-btTl1lWu.js";import{F as Ve}from"./file-text-DfUvtSju.js";import{U as Je}from"./utensils-crossed-CBvPUiAz.js";import{S as Qe}from"./shopping-bag-DTK0VZ-L.js";import{H as Ye}from"./heart-D_Hvwpsh.js";import{S as $a}from"./star-DGUzKXpx.js";import{f as Ze}from"./format-DGXNDZcH.js";import"./index-Hi4FXdV0.js";import"./useSensitiveWords-D96963ea.js";import"./clock-CfDFVEuU.js";import"./circle-alert-otnbVy-Q.js";import"./image-BT7MLyHa.js";import"./volume-x-CS8YYLlm.js";import"./input-otp-D8cd1jdR.js";import"./plus-BnrcyCVr.js";import"./useActivityRules-Bu6aZ9rB.js";import"./isEqual-0tuMjcui.js";import"./startOfDay-D9HvL57p.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oa=Ls("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]),Ba=()=>e.jsxs("div",{className:"min-h-screen bg-secondary/20 pb-8",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[e.jsx(o,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(o,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(o,{className:"h-10 w-10 rounded-md"}),e.jsx(o,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-20 relative z-10",children:[e.jsx(H,{className:"shadow-large",children:e.jsxs(Y,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsx(o,{className:"h-6 w-16 rounded-full"}),e.jsx(o,{className:"h-6 w-20 rounded-full"}),e.jsx(o,{className:"h-6 w-24 rounded-full"})]}),e.jsx(o,{className:"h-9 w-3/4 mb-4"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsx(o,{className:"h-5 w-24"}),e.jsx(o,{className:"h-5 w-20"}),e.jsx(o,{className:"h-5 w-28"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(o,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"h-4 w-32"}),e.jsx(o,{className:"h-4 w-40"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-10 w-10 rounded-full"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(o,{className:"h-4 w-20"}),e.jsx(o,{className:"h-4 w-32"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(o,{className:"h-10 w-28 rounded-md"}),e.jsx(o,{className:"h-10 w-32 rounded-md"}),e.jsx(o,{className:"h-10 w-24 rounded-md"})]})]})}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsx(Y,{children:e.jsx(o,{className:"h-6 w-36"})}),e.jsxs(W,{className:"space-y-3",children:[e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-5/6"}),e.jsx(o,{className:"h-4 w-4/5"})]})]}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsx(Y,{children:e.jsx(o,{className:"h-6 w-28"})}),e.jsxs(W,{className:"space-y-2",children:[e.jsx(o,{className:"h-4 w-full"}),e.jsx(o,{className:"h-4 w-3/4"})]})]}),e.jsxs(H,{className:"mt-6 shadow-large",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between",children:[e.jsx(o,{className:"h-6 w-40"}),e.jsx(o,{className:"h-5 w-24"})]}),e.jsxs(W,{children:[e.jsx(o,{className:"h-[200px] w-full rounded-lg mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx(o,{className:"h-16 w-16 rounded-lg flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(o,{className:"h-5 w-40"}),e.jsx(o,{className:"h-4 w-full"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"h-5 w-16 rounded-full"}),e.jsx(o,{className:"h-5 w-12"})]})]})]},t))})]})]})]})]}),ls=i.memo(({restaurants:t,onMarkerClick:m})=>{const{t:g}=X(),s=i.useRef(null),a=i.useRef(null),h=i.useRef([]),[v,j]=i.useState(!1),[c,y]=i.useState(null),x=i.useRef(null);return i.useEffect(()=>{if(!s.current||a.current)return;const I="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!G.supported()){console.warn("[ActivityMap] WebGL not supported",{isIOSDevice:pa(),isIOSWebView:be(),userAgent:navigator.userAgent}),y(g("map.webglNotSupported","Your browser does not support map display"));return}const k=()=>{if(!s.current)return;const p=s.current.getBoundingClientRect();if(console.log("[ActivityMap] Container dimensions:",p.width,p.height),p.width===0||p.height===0){setTimeout(k,100);return}try{G.accessToken=I;const l=t.reduce((u,b)=>u+Number(b.restaurants.lat||0),0)/t.length,d=t.reduce((u,b)=>u+Number(b.restaurants.lng||0),0)/t.length;a.current=new G.Map({container:s.current,style:"mapbox://styles/mapbox/light-v11",center:[d,l],zoom:12,cooperativeGestures:!0,doubleClickZoom:!1}),a.current.on("error",u=>{console.error("[ActivityMap] Map error:",u),y(g("map.loadError","Map failed to load"))}),a.current.addControl(new G.NavigationControl,"top-right"),a.current.on("load",()=>{j(!0)})}catch(l){console.error("[ActivityMap] Failed to initialize map:",l),y(g("map.loadError","Map failed to load"))}};return k(),()=>{var p;h.current.forEach(l=>l.remove()),h.current=[],x.current&&(x.current.remove(),x.current=null),(p=a.current)==null||p.remove(),a.current=null,j(!1)}},[t.length,g]),i.useEffect(()=>{if(!a.current||!v||t.length===0)return;(()=>{var k;if(h.current.forEach(p=>p.remove()),h.current=[],x.current&&(x.current.remove(),x.current=null),t.forEach(p=>{const l=Number(p.restaurants.lat),d=Number(p.restaurants.lng);if(isNaN(l)||isNaN(d))return;const u=document.createElement("div");u.className="p-3 min-w-[200px]",u.innerHTML=`
          <div class="space-y-2">
            <h3 class="font-bold text-base text-foreground">${p.restaurants.name}</h3>
            <p class="text-xs text-muted-foreground">${p.restaurants.address}</p>
          </div>
        `;const b=new G.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([d,l]).setDOMContent(u),f=document.createElement("div");f.className="custom-marker",f.style.backgroundImage=`url(${ga})`,f.style.width="40px",f.style.height="40px",f.style.backgroundSize="contain",f.style.backgroundRepeat="no-repeat",f.style.backgroundPosition="center",f.style.cursor="pointer";const N=new G.Marker({element:f,draggable:!1}).setLngLat([d,l]).addTo(a.current),E=N.getElement();E.style.cursor="pointer";const S=z=>{z.stopPropagation(),z.preventDefault(),x.current&&x.current!==b&&x.current.remove(),b.addTo(a.current),x.current=b,a.current.easeTo({center:[d,l],zoom:17,duration:800}),m&&m(p.restaurant_id)};E.addEventListener("click",S,!0),b.on("close",()=>{x.current===b&&(x.current=null)}),h.current.push(N)}),t.length>1){const p=new G.LngLatBounds;t.forEach(l=>{const d=Number(l.restaurants.lat),u=Number(l.restaurants.lng);!isNaN(d)&&!isNaN(u)&&p.extend([u,d])}),(k=a.current)==null||k.fitBounds(p,{padding:50,maxZoom:14})}})()},[t,v,m]),t.length===0?null:c?e.jsxs("div",{className:"w-full h-[350px] rounded-lg bg-muted/50 flex flex-col items-center justify-center p-6 text-center",children:[e.jsx(fa,{className:"w-10 h-10 text-muted-foreground mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:c}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:g("map.viewListInstead","Please view the restaurant list below")}),be()&&e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>window.open(window.location.href,"_blank"),children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),g("map.openInBrowser","Open in Browser")]})]}):e.jsx("div",{ref:s,className:"w-full h-[350px] rounded-lg"})});ls.displayName="ActivityParticipationMap";const Ha=({open:t,onOpenChange:m,restaurants:g,participatingRestaurantIds:s,onConfirm:a,isPending:h,isParticipating:v})=>{const{t:j}=X(),{localizeRestaurant:c}=rs(),[y,x]=i.useState([]);i.useEffect(()=>{t&&x(s)},[t,s]);const I=l=>{x(d=>d.includes(l)?d.filter(u=>u!==l):[...d,l])},k=()=>{y.length===g.length?x([]):x(g.map(l=>l.id))},p=()=>{a(y)};return e.jsx(Ce,{open:t,onOpenChange:m,children:e.jsxs(ke,{className:"max-w-[90vw] sm:max-w-[600px] max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs(Se,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"选择参与的餐厅"]}),e.jsx(es,{children:"勾选要参与活动的餐厅，取消勾选将退出活动"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-2 border-b",children:[e.jsx(We,{id:"select-all",checked:y.length===g.length,onCheckedChange:k}),e.jsxs($e,{htmlFor:"select-all",className:"cursor-pointer font-semibold",children:["全选/取消全选 (",y.length,"/",g.length,")"]})]}),e.jsx("div",{className:"space-y-3",children:g.map(l=>{const d=c(l),u=y.includes(l.id),b=s.includes(l.id);return e.jsx(H,{className:`transition-all ${u?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(We,{id:l.id,checked:u,onCheckedChange:()=>I(l.id)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs($e,{htmlFor:l.id,className:"cursor-pointer flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold truncate",children:d.name}),b&&e.jsxs(R,{variant:"secondary",className:"text-xs",children:[e.jsx(oe,{className:"w-3 h-3 mr-1"}),"已参与"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:l.address}),d.type&&d.type.length>0&&e.jsx("div",{className:"flex gap-1 mt-1 flex-wrap",children:d.type.slice(0,2).map((f,N)=>e.jsx(R,{variant:"outline",className:"text-xs",children:f},N))})]})]})})},l.id)})})]}),e.jsxs(ss,{children:[e.jsx(w,{variant:"outline",onClick:()=>m(!1),disabled:h,children:j("common.cancel")}),e.jsx(w,{onClick:p,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),j("common.loading")]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"确认 (",y.length,")"]})})]})]})})},Ke=({children:t})=>{const{t:m,i18n:g}=X(),{isAdmin:s}=as(),{data:a,isLoading:h}=ba(),v=ya(),[j,c]=i.useState(!1),[y,x]=i.useState(!1),[I,k]=i.useState("zh"),[p,l]=i.useState(""),[d,u]=i.useState(""),[b,f]=i.useState("");i.useEffect(()=>{a&&(l(a.content_zh),u(a.content_en),f(a.content_pt))},[a]);const N=()=>{if(!a)return"";const z=g.language;return z==="zh"?a.content_zh||a.content_en||a.content_pt||"":z==="pt"?a.content_pt||a.content_en||a.content_zh||"":a.content_en||a.content_zh||a.content_pt||""},E=a&&(a.content_zh||a.content_en||a.content_pt),S=async()=>{if(a)try{await v.mutateAsync({id:a.id,content_zh:p,content_en:d,content_pt:b}),Oe({title:m("common.success"),description:m("activities.handbook.updateSuccess")}),x(!1)}catch{Oe({title:m("common.error"),description:m("activities.handbook.updateError"),variant:"destructive"})}};return e.jsxs(Ce,{open:j,onOpenChange:c,children:[e.jsx(Ts,{asChild:!0,children:t}),e.jsxs(ke,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Se,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5 text-primary"}),e.jsx(_e,{children:m("activities.handbook.title")})]})}),h?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{className:"w-6 h-6 animate-spin text-primary"})}):y&&s?e.jsx("div",{className:"space-y-4",children:e.jsxs(Na,{value:I,onValueChange:k,children:[e.jsxs(wa,{className:"grid w-full grid-cols-3",children:[e.jsx(fe,{value:"zh",children:"中文"}),e.jsx(fe,{value:"en",children:"English"}),e.jsx(fe,{value:"pt",children:"Português"})]}),e.jsx(je,{value:"zh",className:"mt-4",children:e.jsx(ve,{value:p,onChange:l,placeholder:"请输入中文活动手册内容..."})}),e.jsx(je,{value:"en",className:"mt-4",children:e.jsx(ve,{value:d,onChange:u,placeholder:"Enter English activity handbook content..."})}),e.jsx(je,{value:"pt",className:"mt-4",children:e.jsx(ve,{value:b,onChange:f,placeholder:"Digite o conteúdo do manual da atividade em português..."})})]})}):e.jsx("div",{className:"space-y-4",children:E?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:N()}}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ye,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:m("activities.handbook.empty")}),s&&e.jsx("p",{className:"text-sm mt-2",children:m("activities.handbook.addPrompt")})]})}),e.jsx(ss,{className:"gap-2 sm:gap-0",children:y?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"outline",onClick:()=>x(!1),children:m("common.cancel")}),e.jsxs(w,{onClick:S,disabled:v.isPending,children:[v.isPending?e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ca,{className:"w-4 h-4 mr-2"}),m("common.save")]})]}):s&&e.jsxs(w,{onClick:()=>x(!0),children:[e.jsx(ka,{className:"w-4 h-4 mr-2"}),m(E?"common.edit":"activities.handbook.add")]})})]})]})},qa=({open:t,onOpenChange:m,activityTitle:g,activityId:s,onShareComplete:a,onShareAction:h,isProcessing:v=!1,hasAlreadyClaimed:j=!1})=>{const{t:c}=X(),y=ns(),[x,I]=i.useState(!1),[k,p]=i.useState(!1);i.useEffect(()=>{p(typeof navigator<"u"&&!!navigator.share&&typeof navigator.canShare=="function")},[]);const l=async()=>{try{await navigator.clipboard.writeText(window.location.href),A.success(c("common.linkCopied")),I(!0),h==null||h()}catch(f){console.error("Error copying link:",f),A.error(c("common.shareError"))}},d=f=>{const N=encodeURIComponent(window.location.href),E=encodeURIComponent(`${g} - Xiaoxiong Market`);let S="";switch(f){case"whatsapp":S=`https://wa.me/?text=${E}%20${N}`;break;case"facebook":S=`https://www.facebook.com/sharer/sharer.php?u=${N}`;break;case"twitter":S=`https://twitter.com/intent/tweet?text=${E}&url=${N}`;break;case"telegram":S=`https://t.me/share/url?url=${N}&text=${E}`;break;case"linkedin":S=`https://www.linkedin.com/sharing/share-offsite/?url=${N}`;break;case"reddit":S=`https://reddit.com/submit?url=${N}&title=${E}`;break;case"line":S=`https://social-plugins.line.me/lineit/share?url=${N}`;break;case"wechat":l(),A.info(c("sharing.copiedForWeChat"));return;case"instagram":l(),A.info(c("sharing.copiedForInstagram"));return;default:return}be()?window.location.href=S:window.open(S,"_blank","noopener,noreferrer"),I(!0),h==null||h()},u=async()=>{const f={title:g,text:`${g} - Xiaoxiong Market`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(f)?(await navigator.share(f),I(!0),h==null||h()):l()}catch(N){N.name!=="AbortError"&&(console.error("Error sharing:",N),A.error(c("common.shareError")))}},b=()=>{x&&a()};return e.jsx(Ce,{open:t,onOpenChange:m,children:e.jsxs(ke,{className:"sm:max-w-md",children:[e.jsxs(Se,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[j?e.jsx(_a,{className:"w-5 h-5 text-primary"}):e.jsx(ce,{className:"w-5 h-5 text-primary"}),c("shareDialog.title")]}),e.jsx(es,{className:"space-y-2",children:j?e.jsx("p",{className:"text-primary font-medium",children:c("shareDialog.alreadyShared")}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:c("shareDialog.description")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c("shareDialog.hint")})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:y&&k?e.jsxs(w,{onClick:u,className:"w-full",variant:"default",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),c("sharing.shareToApps")]}):e.jsxs(Es,{children:[e.jsx(As,{asChild:!0,children:e.jsxs(w,{className:"w-full",variant:"default",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),c("sharing.selectPlatform")]})}),e.jsxs(Is,{className:"w-56",children:[k&&e.jsxs(e.Fragment,{children:[e.jsxs(P,{onClick:u,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),c("sharing.systemShare")]}),e.jsx(Be,{})]}),e.jsxs(P,{onClick:()=>d("wechat"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(P,{onClick:()=>d("instagram"),children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Instagram"]}),e.jsxs(P,{onClick:()=>d("whatsapp"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(P,{onClick:()=>d("facebook"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(P,{onClick:()=>d("twitter"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(P,{onClick:()=>d("telegram"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsxs(P,{onClick:()=>d("linkedin"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"LinkedIn"]}),e.jsxs(P,{onClick:()=>d("line"),children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"LINE"]}),e.jsxs(P,{onClick:()=>d("reddit"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Reddit"]}),e.jsx(Be,{}),e.jsxs(P,{onClick:l,children:[e.jsx(Da,{className:"w-4 h-4 mr-2"}),c("common.copyLink")]})]})]})}),!j&&e.jsx(w,{onClick:b,disabled:!x||v,className:"w-full",variant:x?"default":"secondary",children:v?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}),c("shareDialog.claiming")]}):x?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),c("shareDialog.confirmButton")]}):c("shareDialog.shareFirst")})]})]})})},Ua=({activityId:t,initialCount:m=0})=>{const{t:g}=X(),s=ts(),[a,h]=i.useState(m),v=i.useCallback(async()=>{const{count:j}=await Z.from("activity_shares").select("*",{count:"exact",head:!0}).eq("activity_id",t);j!==null&&h(j)},[t]);return i.useEffect(()=>{h(m)},[m]),i.useEffect(()=>{const j=Z.channel(`share-count-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"activity_shares",filter:`activity_id=eq.${t}`},()=>{v(),s.invalidateQueries({queryKey:["shareCount",t]})}).subscribe();return()=>{Z.removeChannel(j)}},[t,v,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(Ra,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[a," ",g("activities.shareCount")]})]})},Ga=({activityId:t,initialCount:m=0})=>{const{t:g}=X(),s=ts(),[a,h]=i.useState(m),v=i.useCallback(async()=>{const{count:j}=await Z.from("subscriptions").select("*",{count:"exact",head:!0}).eq("activity_id",t);j!==null&&h(j)},[t]);return i.useEffect(()=>{h(m)},[m]),i.useEffect(()=>{const j=Z.channel(`subscriber-count-${t}`).on("postgres_changes",{event:"*",schema:"public",table:"subscriptions",filter:`activity_id=eq.${t}`},()=>{v(),s.invalidateQueries({queryKey:["subscriberCount",t]})}).subscribe();return()=>{Z.removeChannel(j)}},[t,v,s]),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(is,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[a," ",g("activities.subscribersCount")]})]})},Ut=()=>{var Fe;const{id:t}=Ms(),m=Ps(),g=Rs(),{t:s}=X(),{user:a}=Fs(),{isMerchant:h,isSupervisor:v,isAdmin:j}=as(),{data:c}=zs(),{localizeActivity:y,localizeRestaurant:x,currentLang:I}=rs();ns();const[k,p]=T.useState(!1),[l,d]=T.useState(!1),[u,b]=T.useState(null),[f,N]=T.useState(!1),[E,S]=T.useState(!1),[z,de]=T.useState(!1),[os,De]=T.useState(!1),[me,cs]=T.useState(!0),[ds,he]=T.useState(!1),[ms,ue]=T.useState(!1),[hs,Le]=T.useState(!1),[us,xe]=T.useState(!1);Pa({pageType:"activity",targetId:t}),sa(t);const{data:re=[]}=Ea(t),{data:V=!1}=Aa(t),{data:pe}=Ia(),Te=Ma(),q=re.length>0||!!pe,xs=T.useCallback(r=>{g(`/restaurant/${r}`,{state:{fromActivity:t}})},[g,t]),Ee=((Fe=m.state)==null?void 0:Fe.from)==="admin"?"/admin/activities":"/activities",{data:n,isLoading:ps}=ta(t),{data:$,isLoading:gs}=ra(t),{data:fs=[]}=na(),js=fs.map(r=>r.activity_id),{data:vs=0}=ia(t),{data:Ns=0}=la(t),J=oa(),{data:C}=ca(n==null?void 0:n.creator_id),ge=da(),{data:F=[]}=ma(),{data:U=[]}=ha(t),O=ua(),_=n?y(n):null,Ae=n?js.includes(n.id):!1,ee=h||v,ws=i.useCallback(()=>{!a||!n||ge.mutate(n.id)},[a,n,ge]),ne=F.filter(r=>U.includes(r.id)).length,se=ne>0;F.length,ne>0&&ne<F.length;const bs=i.useCallback(()=>{if(!(!n||!ee||F.length===0))if(v)de(!0);else if(se)for(const r of F)U.includes(r.id)&&O.mutate({activityId:n.id,restaurantId:r.id});else for(const r of F)O.mutate({activityId:n.id,restaurantId:r.id})},[n,ee,F,v,se,U,O]),ys=i.useCallback(r=>{if(!n)return;const D=r.filter(M=>!U.includes(M)),L=U.filter(M=>!r.includes(M));D.forEach(M=>{O.mutate({activityId:n.id,restaurantId:M})}),L.forEach(M=>{O.mutate({activityId:n.id,restaurantId:M})}),de(!1)},[n,U,O]),Cs=i.useCallback(()=>{ue(!0)},[]),ks=i.useCallback(async()=>{ue(!1),S(!0);try{const r=await La();b({lat:r.coords.latitude,lng:r.coords.longitude}),N(!0),A.success(s("map.locationEnabled"))}catch(r){console.error("Location error:",r),N(!1)}finally{S(!1)}},[s]);i.useCallback(()=>{b(null),N(!1)},[]),T.useEffect(()=>{if(a&&q&&!V&&me){const r=setTimeout(()=>{cs(!1)},3e3);return()=>clearTimeout(r)}},[a,q,V,me]);const Ie=i.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),A.success(s("common.linkCopied"))}catch(r){console.error("Error copying link:",r),A.error(s("common.shareError"))}},[s]),Me=i.useCallback(async()=>{if(!n||!_)return;const r={title:_.title,text:`${_.title} - Xiaoxiong Market

${_.content.replace(/<[^>]*>/g,"").substring(0,200)}...`,url:window.location.href};try{navigator.share&&typeof navigator.canShare=="function"&&navigator.canShare(r)?(await navigator.share(r),A.success(s("common.shareSuccess"))):Ie()}catch(D){D.name!=="AbortError"&&(console.error("Error sharing:",D),A.error(s("common.shareError")))}},[n,_,Ie,s]),Ss=i.useCallback(()=>{if(!(!n||!_)){if(!a){xe(!0);return}q?he(!0):(Me(),J.mutateAsync({activityId:t,userId:a.id}).catch(()=>{}))}},[n,_,a,q,Me,J,t]),_s=i.useCallback(async()=>{if(!(!n||!a)){Le(!0);try{await J.mutateAsync({activityId:t,userId:a.id});const r=re.length>0?re[0]:pe;r&&(await Te.mutateAsync({templateId:r.id,activityId:t,source:"share"}),A.success(s("coupon.claimSuccess"))),he(!1)}catch(r){console.error("Error claiming coupon:",r),A.error(s("common.error"))}finally{Le(!1)}}},[n,a,J,t,re,pe,Te,s]),Ds=i.useCallback(()=>{!a||!t||J.mutateAsync({activityId:t,userId:a.id}).catch(r=>{console.log("Share already recorded or error:",r)})},[a,t,J]),Q=i.useMemo(()=>{if(!$)return[];const r=$.map(D=>{if(u){const L=Ta(u.lat,u.lng,Number(D.restaurants.lat),Number(D.restaurants.lng));return{...D,distance:L}}return{...D,distance:void 0}});return f&&u?r.sort((D,L)=>D.distance!==void 0&&L.distance!==void 0?D.distance-L.distance:0):r.sort((D,L)=>{const M=Number(D.restaurants.rating)||0;return(Number(L.restaurants.rating)||0)-M})},[$,f,u]);if(ps)return e.jsx(Ba,{});if(!n||!_||n.status==="draft"&&!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(w,{asChild:!0,className:"mt-4",children:e.jsx(ae,{to:Ee,children:s("common.back")})})]})});const Pe=new Date(n.start_date),ie=n.end_date?new Date(n.end_date):null,Re=ie?new Date<=ie:new Date>=Pe;return e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden",children:[n.media_type==="video"&&n.video_url?e.jsx("video",{src:n.video_url,poster:n.image_url||void 0,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,autoPlay:!0}):e.jsx("img",{src:n.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=1200&q=80",alt:_.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(w,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(ae,{to:Ee,children:e.jsx(Fa,{className:"w-5 h-5"})})}),a&&ee&&c&&!c.activity_terms_agreed&&e.jsxs(ae,{to:"/profile?tab=activities",className:"absolute top-4 left-16 bg-destructive/95 backdrop-blur-sm text-destructive-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse flex items-center gap-1.5 hover:bg-destructive transition-colors",children:[e.jsx(Xe,{className:"w-3.5 h-3.5"}),s("activities.termsNotAgreed")]}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 items-start",children:[n.status==="draft"&&j&&e.jsxs(R,{variant:"outline",className:"bg-amber-500/90 text-white border-amber-600",children:[e.jsx(za,{className:"w-3 h-3 mr-1"}),s("admin.activities.draftPreview")]}),n.pinned&&e.jsx(R,{className:"bg-accent",children:s("activities.pinned")}),e.jsx(ja,{targetType:"activity",targetId:n.id,onLoginRequired:()=>xe(!0),trigger:e.jsx(w,{variant:"secondary",size:"icon",className:"shadow-lg",children:e.jsx(Xe,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs(w,{variant:"secondary",size:"icon",className:"shadow-lg relative",onClick:Ss,children:[e.jsx(B,{className:"w-5 h-5"}),q&&!V&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-primary text-primary-foreground rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(ce,{className:"w-2.5 h-2.5"})}),q&&V&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-green-500 text-white rounded-full w-4 h-4 flex items-center justify-center",children:e.jsx(oe,{className:"w-2.5 h-2.5"})})]}),a&&q&&!V&&me&&e.jsxs("div",{className:"absolute top-full right-0 mt-2 bg-primary/95 backdrop-blur-sm text-primary-foreground text-xs px-3 py-1.5 rounded-full shadow-lg whitespace-nowrap animate-pulse z-10",children:[e.jsx(ce,{className:"w-3 h-3 inline mr-1"}),s("activities.shareToGetCoupon")]})]})]})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(H,{className:"shadow-large",children:[e.jsxs(Y,{className:"relative",children:[e.jsx("div",{className:"hidden sm:block absolute top-4 right-4",children:e.jsx(Ke,{children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Ve,{className:"w-4 h-4"}),s("activities.handbook.button")]})})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:pr-32",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(R,{variant:Re?"default":"secondary",children:s(Re?"activities.ongoing":"activities.ended")}),n.repeat_mode&&n.repeat_mode!=="none"&&n.repeat_mode!=="days_before"&&e.jsx(R,{variant:"outline",children:s(`activities.repeat.${n.repeat_mode}`)}),n.service_type&&e.jsxs(R,{variant:"outline",className:"flex items-center gap-1.5",children:[n.service_type==="dine_in"&&e.jsx(Je,{className:"w-3.5 h-3.5"}),n.service_type==="takeaway"&&e.jsx(Qe,{className:"w-3.5 h-3.5"}),n.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"w-3.5 h-3.5"}),e.jsx(Qe,{className:"w-3.5 h-3.5"})]}),s(`activities.serviceType.${n.service_type}`)]}),e.jsx("div",{className:"sm:hidden",children:e.jsx(Ke,{children:e.jsxs(w,{variant:"outline",size:"sm",className:"gap-1.5 h-7 px-2",children:[e.jsx(Ve,{className:"w-3.5 h-3.5"}),s("activities.handbook.button")]})})})]}),e.jsx(He,{className:"text-3xl",children:_.title}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx($s,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[Ze(Pe,"PPP"),ie&&` - ${Ze(ie,"PPP")}`]})]}),e.jsx(Ga,{activityId:t,initialCount:vs}),e.jsx(Ua,{activityId:t,initialCount:Ns}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(te,{className:"w-4 h-4 shrink-0"}),e.jsxs("span",{children:[($==null?void 0:$.length)||0," ",s("activities.restaurantsParticipating")]})]}),e.jsxs("div",{className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(aa,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:s("activities.creatorLabel")}),C!=null&&C.isAdmin?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Ge,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]}):C!=null&&C.restaurant?e.jsxs(ae,{to:`/restaurant/${C.restaurant.id}`,className:"flex items-center gap-1",onClick:r=>r.stopPropagation(),children:[C.avatar_url?e.jsxs(Os,{className:"w-4 h-4",children:[e.jsx(Bs,{src:C.avatar_url,alt:"Creator"}),e.jsx(Hs,{className:"text-[8px]",children:C.restaurant.name.charAt(0)})]}):e.jsx("div",{className:"w-4 h-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-[8px] font-medium",children:C.restaurant.name.charAt(0)})}),e.jsx("span",{className:"text-primary font-medium hover:underline",children:(()=>{const r=qs.language;return r==="zh"?C.restaurant.name:r==="pt"?C.restaurant.name_pt||C.restaurant.name_en||C.restaurant.name:C.restaurant.name_en||C.restaurant.name})()})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("img",{src:Ge,alt:"Platform",className:"w-4 h-4 rounded-full object-contain"}),e.jsx("span",{className:"font-medium",children:s("activities.createdByPlatform")})]})]})]}),a&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[ee&&F.length>0&&(c!=null&&c.activity_terms_agreed?e.jsx(w,{onClick:bs,disabled:O.isPending,size:"lg",variant:se?"outline":"default",className:"w-full sm:w-auto",children:v?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"选择参与的餐厅"]}):se?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"退出活动"]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"参与活动"]})}):e.jsx(w,{onClick:()=>De(!0),size:"lg",variant:"outline",className:"w-full sm:w-auto text-muted-foreground",children:s("activities.agreeTermsFirst")})),e.jsx(w,{onClick:ws,disabled:ge.isPending,size:"lg",variant:Ae?"outline":"secondary",className:"w-full sm:w-auto",children:Ae?e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4 mr-2 fill-current"}),s("activities.favorited")||"已收藏"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),s("activities.favorite")||"收藏活动"]})})]}),!a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s("activities.signInToJoin")}),e.jsxs("p",{className:"text-xs text-muted-foreground/80 flex items-center gap-1.5",children:[e.jsx(is,{className:"w-3.5 h-3.5"}),s("activities.signInToJoinHint")]})]})]})]}),e.jsxs(W,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:s("activities.about")}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                  prose-headings:text-foreground prose-headings:font-semibold\r
                  prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                  prose-p:leading-relaxed prose-p:my-3\r
                  prose-strong:text-foreground prose-strong:font-semibold\r
                  prose-ul:my-3 prose-ol:my-3\r
                  prose-li:my-1\r
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline\r
                  [&_*]:!text-inherit [&_span[style*='color']]:!text-muted-foreground`,dangerouslySetInnerHTML:{__html:_.content}})]}),_.usage_instructions&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ye,{className:"w-6 h-6 text-primary"}),s("activities.usageInstructions")]}),e.jsx("div",{className:`prose prose-sm max-w-none text-muted-foreground\r
                      prose-headings:text-foreground prose-headings:font-semibold\r
                      prose-h1:text-2xl prose-h2:text-xl prose-h3:text-lg\r
                      prose-p:leading-relaxed prose-p:my-3\r
                      prose-strong:text-foreground prose-strong:font-semibold\r
                      prose-ul:my-3 prose-ol:my-3\r
                      prose-li:my-1\r
                      prose-a:text-primary prose-a:no-underline hover:prose-a:underline`,dangerouslySetInnerHTML:{__html:_.usage_instructions}})]})]}),e.jsx(Ue,{}),gs?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(K,{className:"w-6 h-6 animate-spin text-primary"})}):$&&$.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Zs,{open:k,onOpenChange:p,children:e.jsxs(H,{className:"border-primary/20 shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden",children:[e.jsx(Y,{className:"pb-3",children:e.jsx(Ks,{asChild:!0,children:e.jsxs("div",{className:"flex items-center justify-between cursor-pointer group",children:[e.jsxs(He,{className:"text-lg font-semibold flex items-center gap-2 transition-colors duration-200 group-hover:text-primary",children:[e.jsx(te,{className:"w-5 h-5 transition-transform duration-300 group-hover:scale-110"}),s("activities.participatingRestaurants")]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{variant:"secondary",className:"transition-opacity duration-200",children:s(k?"common.showLess":"common.showDetails")}),e.jsx("div",{className:"transition-transform duration-300 ease-in-out",style:{transform:k?"rotate(180deg)":"rotate(0deg)"},children:e.jsx(qe,{className:"w-5 h-5 text-muted-foreground group-hover:text-primary"})})]})]})})}),e.jsx(ea,{className:"overflow-hidden transition-all duration-500 ease-in-out data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",children:e.jsxs(W,{className:"pt-0 pb-6 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:f?e.jsxs(R,{variant:"default",className:"flex items-center gap-1.5",children:[e.jsx(Ne,{className:"w-3.5 h-3.5"}),s("activities.sortByLocationEnabled")]}):e.jsxs(w,{variant:"outline",size:"sm",onClick:Cs,disabled:E,children:[E?e.jsx(K,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(Ne,{className:"w-4 h-4 mr-2"}),s("activities.enableLocationSort")]})}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:(l?Q:Q.slice(0,6)).map((r,D)=>{const L=x(r.restaurants);return e.jsx(H,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 opacity-0 animate-fade-in h-full flex flex-col",style:{animationDelay:`${D*50}ms`,animationFillMode:"forwards"},children:e.jsxs(ae,{to:`/restaurant/${r.restaurant_id}`,state:{fromActivity:n.id},className:"flex flex-col h-full",children:[e.jsxs("div",{className:"relative h-40 overflow-hidden flex-shrink-0",children:[e.jsx("img",{src:r.restaurants.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=400&q=80",alt:L.name,className:"w-full h-full object-cover transition-transform hover:scale-105"}),L.type&&L.type.length>0&&e.jsx("div",{className:"absolute top-2 left-2 flex flex-wrap gap-1",children:L.type.slice(0,3).map((M,ze)=>e.jsx(R,{className:"bg-primary",children:M},ze))})]}),e.jsxs(W,{className:"pt-4 pb-4 flex flex-col flex-grow",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-1",children:L.name}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:[e.jsx(we,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:r.restaurants.address})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-border/50",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($a,{className:`w-4 h-4 ${r.restaurants.rating?"fill-accent text-accent":"text-muted-foreground"}`}),r.restaurants.rating?e.jsx("span",{className:"font-semibold text-sm",children:r.restaurants.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[s("restaurant.noRatingLine1"),e.jsx("br",{}),s("restaurant.noRatingLine2")]})]}),r.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-sm text-foreground",children:[r.distance.toFixed(1)," km"]})]})]})]})]})},r.id)})}),Q.length>6&&!l&&e.jsxs(w,{variant:"outline",className:"w-full hover:bg-primary hover:text-primary-foreground transition-all duration-200",onClick:()=>d(!0),children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"查看更多 (",Q.length-6," 个餐厅)"]})]})})]})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2 mb-4",children:[e.jsx(we,{className:"w-6 h-6"}),s("activities.participatingRestaurants")," (",Q.length,")"]}),e.jsx(ls,{restaurants:Q,onMarkerClick:xs})]})]}):null,e.jsx(xa,{restaurantId:n.id,targetType:"activity"})]})]})}),v&&e.jsx(Ha,{open:z,onOpenChange:de,restaurants:F,participatingRestaurantIds:U,onConfirm:ys,isPending:O.isPending,isParticipating:se}),ee&&e.jsx(va,{isAgreed:(c==null?void 0:c.activity_terms_agreed)||!1,agreedAt:(c==null?void 0:c.activity_terms_agreed_at)||null,open:os,onOpenChange:De}),e.jsx(qa,{open:ds,onOpenChange:he,activityTitle:(_==null?void 0:_.title)||"",activityId:t,onShareComplete:_s,onShareAction:Ds,isProcessing:hs,hasAlreadyClaimed:V}),e.jsx(Sa,{open:ms,onOpenChange:ue,onConfirm:ks}),e.jsx(Us,{open:us,onOpenChange:xe,children:e.jsxs(Gs,{children:[e.jsxs(Ws,{children:[e.jsx(Xs,{children:s("activities.loginRequired")}),e.jsx(Vs,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(Js,{children:[e.jsx(Qs,{children:s("common.cancel")}),e.jsx(Ys,{onClick:()=>g("/auth"),children:s("activities.goToLogin")})]})]})})]})};export{Ut as default};
