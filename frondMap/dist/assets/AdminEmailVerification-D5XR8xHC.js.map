{"version":3,"file":"AdminEmailVerification-D5XR8xHC.js","sources":["../../src/hooks/useEmailVerificationLogs.ts","../../src/pages/admin/AdminEmailVerification.tsx"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\n\r\nexport type VerificationStatus = \"verified\" | \"expired\" | \"pending\";\r\n\r\nexport interface EmailVerificationLog {\r\n  id: string;\r\n  email: string;\r\n  verified: boolean;\r\n  created_at: string;\r\n  expires_at: string;\r\n  status: VerificationStatus;\r\n  domain: string;\r\n  isSchoolEmail: boolean;\r\n}\r\n\r\nexport interface EmailVerificationStats {\r\n  total: number;\r\n  verified: number;\r\n  expired: number;\r\n  pending: number;\r\n  verificationRate: number;\r\n}\r\n\r\nconst getEmailDomain = (email: string): string => {\r\n  const parts = email.split(\"@\");\r\n  return parts.length > 1 ? parts[1] : \"\";\r\n};\r\n\r\nconst isSchoolEmail = (domain: string): boolean => {\r\n  const schoolPatterns = [\r\n    \".edu\",\r\n    \".edu.pt\",\r\n    \".edu.br\",\r\n    \".edu.cn\",\r\n    \"iscte\",\r\n    \"estudantes\",\r\n    \"alunos\",\r\n    \"student\",\r\n    \"university\",\r\n    \"universidade\",\r\n    \"uni.\",\r\n    \".ac.\",\r\n  ];\r\n  return schoolPatterns.some((pattern) => domain.toLowerCase().includes(pattern));\r\n};\r\n\r\nexport const useEmailVerificationLogs = (\r\n  statusFilter?: VerificationStatus | \"all\",\r\n  searchQuery?: string,\r\n  domainFilter?: string,\r\n  page: number = 0,\r\n  pageSize: number = 50\r\n) => {\r\n  return useQuery({\r\n    queryKey: [\"email-verification-logs\", statusFilter, searchQuery, domainFilter, page, pageSize],\r\n    queryFn: async () => {\r\n      // Build query with server-side filtering\r\n      let query = supabase\r\n        .from(\"email_verification_codes\")\r\n        .select(\"*\", { count: \"exact\" })\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      // Apply server-side filters\r\n      if (statusFilter === \"verified\") {\r\n        query = query.eq(\"verified\", true);\r\n      } else if (statusFilter === \"expired\") {\r\n        query = query.eq(\"verified\", false).lt(\"expires_at\", new Date().toISOString());\r\n      } else if (statusFilter === \"pending\") {\r\n        query = query.eq(\"verified\", false).gte(\"expires_at\", new Date().toISOString());\r\n      }\r\n\r\n      if (searchQuery) {\r\n        query = query.ilike(\"email\", `%${searchQuery}%`);\r\n      }\r\n\r\n      if (domainFilter) {\r\n        query = query.ilike(\"email\", `%@${domainFilter}`);\r\n      }\r\n\r\n      // Apply pagination\r\n      const from = page * pageSize;\r\n      const to = from + pageSize - 1;\r\n      query = query.range(from, to);\r\n\r\n      const { data, error, count } = await query;\r\n\r\n      if (error) throw error;\r\n\r\n      const now = new Date();\r\n      \r\n      const logs: EmailVerificationLog[] = (data || []).map((item) => {\r\n        const domain = getEmailDomain(item.email);\r\n        const expiresAt = new Date(item.expires_at);\r\n        \r\n        let status: VerificationStatus;\r\n        if (item.verified) {\r\n          status = \"verified\";\r\n        } else if (expiresAt < now) {\r\n          status = \"expired\";\r\n        } else {\r\n          status = \"pending\";\r\n        }\r\n\r\n        return {\r\n          id: item.id,\r\n          email: item.email,\r\n          verified: item.verified || false,\r\n          created_at: item.created_at || \"\",\r\n          expires_at: item.expires_at,\r\n          status,\r\n          domain,\r\n          isSchoolEmail: isSchoolEmail(domain),\r\n        };\r\n      });\r\n\r\n      return {\r\n        logs,\r\n        totalCount: count || 0,\r\n        totalPages: Math.ceil((count || 0) / pageSize),\r\n        currentPage: page,\r\n      };\r\n    },\r\n  });\r\n};\r\n\r\n// Use database function to get accurate stats without 1000 row limit\r\nexport const useEmailVerificationStats = () => {\r\n  return useQuery({\r\n    queryKey: [\"email-verification-stats\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase.rpc(\"get_email_verification_stats\");\r\n\r\n      if (error) throw error;\r\n\r\n      // Handle the response - it could be the stats object or an error object\r\n      if (data && typeof data === 'object' && 'error' in data) {\r\n        throw new Error(String(data.error));\r\n      }\r\n\r\n      const stats = data as unknown as EmailVerificationStats;\r\n      \r\n      return {\r\n        total: stats.total || 0,\r\n        verified: stats.verified || 0,\r\n        expired: stats.expired || 0,\r\n        pending: stats.pending || 0,\r\n        verificationRate: stats.verificationRate || 0,\r\n      };\r\n    },\r\n  });\r\n};\r\n\r\n// Use database function to get domain stats\r\nexport const useEmailDomains = () => {\r\n  return useQuery({\r\n    queryKey: [\"email-domains\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase.rpc(\"get_email_domain_stats\");\r\n\r\n      if (error) throw error;\r\n\r\n      if (!data || !Array.isArray(data)) {\r\n        return [];\r\n      }\r\n\r\n      return data.map((item: { domain: string; count: number }) => ({\r\n        domain: item.domain,\r\n        count: item.count,\r\n        isSchoolEmail: isSchoolEmail(item.domain),\r\n      }));\r\n    },\r\n  });\r\n};\r\n","import { useState } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"@/components/ui/table\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"@/components/ui/select\";\r\nimport {\r\n  useEmailVerificationLogs,\r\n  useEmailVerificationStats,\r\n  useEmailDomains,\r\n  type VerificationStatus,\r\n} from \"@/hooks/useEmailVerificationLogs\";\r\nimport { format } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Search, CheckCircle, XCircle, Clock, Mail, GraduationCap, RefreshCw } from \"lucide-react\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n\r\nconst AdminEmailVerification = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const [statusFilter, setStatusFilter] = useState<VerificationStatus | \"all\">(\"all\");\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [domainFilter, setDomainFilter] = useState(\"\");\r\n  const [currentPage, setCurrentPage] = useState(0);\r\n  const pageSize = 50;\r\n\r\n  const { data: logsData, isLoading: logsLoading, refetch } = useEmailVerificationLogs(\r\n    statusFilter,\r\n    searchQuery,\r\n    domainFilter,\r\n    currentPage,\r\n    pageSize\r\n  );\r\n  const { data: stats, isLoading: statsLoading } = useEmailVerificationStats();\r\n  const { data: domains } = useEmailDomains();\r\n\r\n  const logs = logsData?.logs || [];\r\n  const totalCount = logsData?.totalCount || 0;\r\n  const totalPages = logsData?.totalPages || 0;\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateString: string) => {\r\n    if (!dateString) return \"-\";\r\n    return format(new Date(dateString), \"yyyy-MM-dd HH:mm\", {\r\n      locale: getDateLocale(),\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status: VerificationStatus) => {\r\n    switch (status) {\r\n      case \"verified\":\r\n        return (\r\n          <Badge className=\"bg-green-500/10 text-green-600 hover:bg-green-500/20\">\r\n            <CheckCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"admin.emailVerification.verified\", \"已验证\")}\r\n          </Badge>\r\n        );\r\n      case \"expired\":\r\n        return (\r\n          <Badge variant=\"destructive\" className=\"bg-red-500/10 text-red-600 hover:bg-red-500/20\">\r\n            <XCircle className=\"w-3 h-3 mr-1\" />\r\n            {t(\"admin.emailVerification.expired\", \"已过期\")}\r\n          </Badge>\r\n        );\r\n      case \"pending\":\r\n        return (\r\n          <Badge variant=\"secondary\" className=\"bg-yellow-500/10 text-yellow-600 hover:bg-yellow-500/20\">\r\n            <Clock className=\"w-3 h-3 mr-1\" />\r\n            {t(\"admin.emailVerification.pending\", \"待验证\")}\r\n          </Badge>\r\n        );\r\n    }\r\n  };\r\n\r\n  const handleRefresh = () => {\r\n    queryClient.invalidateQueries({ queryKey: [\"email-verification-logs\"] });\r\n    queryClient.invalidateQueries({ queryKey: [\"email-verification-stats\"] });\r\n    queryClient.invalidateQueries({ queryKey: [\"email-domains\"] });\r\n    refetch();\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex items-center justify-between\">\r\n        <div>\r\n          <h1 className=\"text-2xl font-bold\">\r\n            {t(\"admin.emailVerification.title\", \"邮箱验证管理\")}\r\n          </h1>\r\n          <p className=\"text-muted-foreground\">\r\n            {t(\"admin.emailVerification.description\", \"查看所有验证码发送记录和验证状态\")}\r\n          </p>\r\n        </div>\r\n        <Button variant=\"outline\" size=\"sm\" onClick={handleRefresh}>\r\n          <RefreshCw className=\"w-4 h-4 mr-2\" />\r\n          {t(\"common.refresh\", \"刷新\")}\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Stats Cards */}\r\n      <div className=\"grid gap-4 md:grid-cols-4\">\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.emailVerification.totalSent\", \"总发送数\")}\r\n            </CardTitle>\r\n            <Mail className=\"h-4 w-4 text-muted-foreground\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {statsLoading ? (\r\n              <Skeleton className=\"h-8 w-16\" />\r\n            ) : (\r\n              <div className=\"text-2xl font-bold\">{stats?.total || 0}</div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.emailVerification.verifiedCount\", \"已验证\")}\r\n            </CardTitle>\r\n            <CheckCircle className=\"h-4 w-4 text-green-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {statsLoading ? (\r\n              <Skeleton className=\"h-8 w-16\" />\r\n            ) : (\r\n              <div className=\"text-2xl font-bold text-green-600\">{stats?.verified || 0}</div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.emailVerification.expiredCount\", \"已过期未验证\")}\r\n            </CardTitle>\r\n            <XCircle className=\"h-4 w-4 text-red-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {statsLoading ? (\r\n              <Skeleton className=\"h-8 w-16\" />\r\n            ) : (\r\n              <div className=\"text-2xl font-bold text-red-600\">{stats?.expired || 0}</div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n\r\n        <Card>\r\n          <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n            <CardTitle className=\"text-sm font-medium\">\r\n              {t(\"admin.emailVerification.verificationRate\", \"验证成功率\")}\r\n            </CardTitle>\r\n            <CheckCircle className=\"h-4 w-4 text-blue-500\" />\r\n          </CardHeader>\r\n          <CardContent>\r\n            {statsLoading ? (\r\n              <Skeleton className=\"h-8 w-16\" />\r\n            ) : (\r\n              <div className=\"text-2xl font-bold text-blue-600\">{stats?.verificationRate || 0}%</div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">\r\n            {t(\"admin.emailVerification.filters\", \"筛选条件\")}\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex flex-col sm:flex-row gap-4\">\r\n            <div className=\"relative flex-1\">\r\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n              <Input\r\n                placeholder={t(\"admin.emailVerification.searchPlaceholder\", \"搜索邮箱...\")}\r\n                value={searchQuery}\r\n                onChange={(e) => {\r\n                  setSearchQuery(e.target.value);\r\n                  setCurrentPage(0);\r\n                }}\r\n                className=\"pl-10\"\r\n              />\r\n            </div>\r\n\r\n            <Select value={statusFilter} onValueChange={(v) => {\r\n              setStatusFilter(v as VerificationStatus | \"all\");\r\n              setCurrentPage(0);\r\n            }}>\r\n              <SelectTrigger className=\"w-full sm:w-40\">\r\n                <SelectValue placeholder={t(\"admin.emailVerification.allStatus\", \"全部状态\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">{t(\"admin.emailVerification.allStatus\", \"全部状态\")}</SelectItem>\r\n                <SelectItem value=\"verified\">{t(\"admin.emailVerification.verified\", \"已验证\")}</SelectItem>\r\n                <SelectItem value=\"expired\">{t(\"admin.emailVerification.expired\", \"已过期\")}</SelectItem>\r\n                <SelectItem value=\"pending\">{t(\"admin.emailVerification.pending\", \"待验证\")}</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n\r\n            <Select value={domainFilter || \"all\"} onValueChange={(v) => {\r\n              setDomainFilter(v === \"all\" ? \"\" : v);\r\n              setCurrentPage(0);\r\n            }}>\r\n              <SelectTrigger className=\"w-full sm:w-48\">\r\n                <SelectValue placeholder={t(\"admin.emailVerification.allDomains\", \"全部域名\")} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">{t(\"admin.emailVerification.allDomains\", \"全部域名\")}</SelectItem>\r\n                {domains?.map((d) => (\r\n                  <SelectItem key={d.domain} value={d.domain}>\r\n                    {d.isSchoolEmail && <GraduationCap className=\"w-3 h-3 inline mr-1\" />}\r\n                    {d.domain} ({d.count})\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Data Table */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg flex items-center gap-2\">\r\n            {t(\"admin.emailVerification.records\", \"验证记录\")}\r\n            <Badge variant=\"secondary\">{totalCount}</Badge>\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {logsLoading ? (\r\n            <div className=\"space-y-3\">\r\n              {[...Array(5)].map((_, i) => (\r\n                <Skeleton key={i} className=\"h-12 w-full\" />\r\n              ))}\r\n            </div>\r\n          ) : logs.length > 0 ? (\r\n            <>\r\n              <div className=\"rounded-md border\">\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>{t(\"admin.emailVerification.email\", \"邮箱\")}</TableHead>\r\n                      <TableHead>{t(\"admin.emailVerification.status\", \"状态\")}</TableHead>\r\n                      <TableHead>{t(\"admin.emailVerification.domain\", \"域名\")}</TableHead>\r\n                      <TableHead>{t(\"admin.emailVerification.sentAt\", \"发送时间\")}</TableHead>\r\n                      <TableHead>{t(\"admin.emailVerification.expiresAt\", \"过期时间\")}</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {logs.map((log) => (\r\n                      <TableRow key={log.id}>\r\n                        <TableCell className=\"font-medium\">{log.email}</TableCell>\r\n                        <TableCell>{getStatusBadge(log.status)}</TableCell>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {log.isSchoolEmail && (\r\n                              <GraduationCap className=\"w-4 h-4 text-blue-500\" />\r\n                            )}\r\n                            <span className=\"text-sm text-muted-foreground\">{log.domain}</span>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell className=\"text-sm text-muted-foreground\">\r\n                          {formatDate(log.created_at)}\r\n                        </TableCell>\r\n                        <TableCell className=\"text-sm text-muted-foreground\">\r\n                          {formatDate(log.expires_at)}\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </div>\r\n              \r\n              {/* Pagination */}\r\n              {totalPages > 1 && (\r\n                <div className=\"flex items-center justify-between mt-4\">\r\n                  <p className=\"text-sm text-muted-foreground\">\r\n                    {t(\"admin.emailVerification.showing\", \"显示\")} {currentPage * pageSize + 1} - {Math.min((currentPage + 1) * pageSize, totalCount)} {t(\"admin.emailVerification.of\", \"共\")} {totalCount}\r\n                  </p>\r\n                  <div className=\"flex gap-2\">\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setCurrentPage(Math.max(0, currentPage - 1))}\r\n                      disabled={currentPage === 0}\r\n                    >\r\n                      {t(\"common.previous\", \"上一页\")}\r\n                    </Button>\r\n                    <Button\r\n                      variant=\"outline\"\r\n                      size=\"sm\"\r\n                      onClick={() => setCurrentPage(Math.min(totalPages - 1, currentPage + 1))}\r\n                      disabled={currentPage >= totalPages - 1}\r\n                    >\r\n                      {t(\"common.next\", \"下一页\")}\r\n                    </Button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </>\r\n          ) : (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              {t(\"admin.emailVerification.noRecords\", \"暂无记录\")}\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminEmailVerification;\r\n"],"names":["getEmailDomain","email","parts","isSchoolEmail","domain","pattern","useEmailVerificationLogs","statusFilter","searchQuery","domainFilter","page","pageSize","useQuery","query","supabase","from","to","data","error","count","now","item","expiresAt","status","useEmailVerificationStats","stats","useEmailDomains","AdminEmailVerification","t","i18n","useTranslation","queryClient","useQueryClient","setStatusFilter","useState","setSearchQuery","setDomainFilter","currentPage","setCurrentPage","logsData","logsLoading","refetch","statsLoading","domains","logs","totalCount","totalPages","getDateLocale","zhCN","pt","enUS","formatDate","dateString","format","getStatusBadge","jsxs","Badge","jsx","CheckCircle","XCircle","Clock","handleRefresh","Button","RefreshCw","Card","CardHeader","CardTitle","Mail","CardContent","Skeleton","Search","Input","e","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","d","GraduationCap","_","i","Fragment","Table","TableHeader","TableRow","TableHead","TableBody","log","TableCell"],"mappings":"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"}