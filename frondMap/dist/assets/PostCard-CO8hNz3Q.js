import{j as e}from"./vendor-ui-DmpovMYY.js";import{u as O,r,L as j}from"./vendor-react-iAJ0IrSD.js";import{C as B,a as R,b as U}from"./carousel-DfwULQqg.js";import{u as q,n as G,G as J,av as K,aw as Q,ax as W,b9 as X,a7 as V,a8 as Y,B as i,E as Z,a9 as ee,aa as ae,J as se,h as te,at as le,K as re,Q as ie,M as ne,a6 as ce,ah as oe,ai as me,aj as de,ak as he,al as ue,am as xe,an as ge,ao as je,D as fe,b as ve,X as we,a1 as Ne,a2 as Ce,cb as be,cm as _e,cn as pe,a4 as o}from"./index-B44MF3Hr.js";import{f as ye,g as ke,b as De}from"./useCommunityPosts-wpEGpJA0.js";import{u as Se}from"./useLocalizedContent-BN2IWylL.js";import{u as Ae}from"./vendor-i18n-DxKeo2S1.js";const Fe=({post:a,showActions:N=!0,isDetailPage:C=!1})=>{const{t,i18n:b}=Ae(),{user:n}=q(),_=O(),{getLocalizedField:f}=Se(),p=ye(),m=ke(),y=De(),[k,d]=r.useState(!1),[D,S]=r.useState({}),[A,h]=r.useState(!1),[u,x]=r.useState(0),[c,z]=r.useState(),[v,w]=r.useState(0);r.useEffect(()=>{c&&(w(c.selectedScrollSnap()),c.on("select",()=>{w(c.selectedScrollSnap())}))},[c]);const P=()=>{switch(b.language){case"zh":return pe;case"pt":return _e;default:return be}},I=()=>{n&&p.mutate({postId:a.id,liked:a.user_liked||!1})},E=async()=>{const s=`${window.location.origin}/community/${a.id}`;if(navigator.share)try{await navigator.share({title:t("community.shareTitle","分享帖子"),url:s}),n&&m.mutate(a.id),o.success(t("community.shareSuccess","分享成功"))}catch(l){l?.name!=="AbortError"&&(await navigator.clipboard.writeText(s),o.success(t("community.linkCopied","链接已复制到剪贴板")),n&&m.mutate(a.id))}else try{await navigator.clipboard.writeText(s),o.success(t("community.linkCopied","链接已复制到剪贴板")),n&&m.mutate(a.id)}catch{o.error(t("community.shareFailed","分享失败"))}},L=()=>{y.mutate(a.id),d(!1)},T=s=>{C?(x(s),h(!0)):_(`/community/${a.id}`)},$=()=>{x(s=>s===0?(a.image_urls?.length||1)-1:s-1)},F=()=>{x(s=>s===(a.image_urls?.length||1)-1?0:s+1)},M=n?.id===a.author_id,H=a.activity?f(a.activity,"title"):null;return e.jsxs(e.Fragment,{children:[e.jsxs(G,{className:"overflow-hidden",children:[e.jsx(J,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(K,{className:"h-10 w-10",children:[e.jsx(Q,{src:a.author?.avatar_url||void 0}),e.jsx(W,{children:a.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:a.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:X(new Date(a.created_at),{addSuffix:!0,locale:P()})})]})]}),N&&M&&e.jsxs(V,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsx(ee,{align:"end",children:e.jsx(ae,{onClick:()=>d(!0),className:"text-destructive",children:t("common.delete","删除")})})]})]})}),e.jsxs(se,{className:"pt-0 pb-3",children:[a.activity&&e.jsx(j,{to:`/activity/${a.activity.id}`,children:e.jsxs(te,{variant:"secondary",className:"mb-3 gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),H]})}),e.jsx(j,{to:`/community/${a.id}`,children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:f(a,"content")}})}),a.image_urls&&a.image_urls.length>0&&e.jsxs("div",{className:"relative mt-3",children:[e.jsx(B,{setApi:z,className:"w-full",opts:{loop:!0},children:e.jsx(R,{className:"-ml-0",children:a.image_urls.map((s,l)=>e.jsx(U,{className:"pl-0",children:e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>T(l),children:D[s]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover",onError:()=>S(g=>({...g,[s]:!0}))})})},l))})}),a.image_urls.length>1&&e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[v+1,"/",a.image_urls.length]}),a.image_urls.length>1&&e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:a.image_urls.map((s,l)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${l===v?"bg-primary":"bg-muted-foreground/30"}`,onClick:g=>{g.stopPropagation(),c?.scrollTo(l)}},l))})]}),a.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden",children:e.jsx("video",{src:a.video_url,controls:!0,className:"w-full max-h-96",preload:"metadata"})})]}),e.jsx(re,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:`gap-2 ${a.user_liked?"text-red-500":""}`,onClick:I,disabled:!n,children:[e.jsx(ie,{className:`h-4 w-4 ${a.user_liked?"fill-current":""}`}),e.jsx("span",{children:a.likes_count})]}),e.jsx(j,{to:`/community/${a.id}`,children:e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx("span",{children:a.comments_count})]})}),e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",onClick:E,children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:a.shares_count})]})]})})]}),e.jsx(oe,{open:k,onOpenChange:d,children:e.jsxs(me,{children:[e.jsxs(de,{children:[e.jsx(he,{children:t("common.confirmDelete","确认删除")}),e.jsx(ue,{children:t("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(xe,{children:[e.jsx(ge,{children:t("common.cancel","取消")}),e.jsx(je,{onClick:L,children:t("common.delete","删除")})]})]})}),e.jsx(fe,{open:A,onOpenChange:h,children:e.jsx(ve,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-10 text-white hover:bg-white/20",onClick:()=>h(!1),children:e.jsx(we,{className:"h-6 w-6"})}),a.image_urls&&a.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-2 z-10 text-white hover:bg-white/20",onClick:$,children:e.jsx(Ne,{className:"h-8 w-8"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-2 z-10 text-white hover:bg-white/20",onClick:F,children:e.jsx(Ce,{className:"h-8 w-8"})})]}),a.image_urls&&a.image_urls[u]&&e.jsx("img",{src:a.image_urls[u],alt:"",className:"max-w-full max-h-[90vh] object-contain"}),a.image_urls&&a.image_urls.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm bg-black/50 px-3 py-1 rounded-full",children:[u+1," / ",a.image_urls.length]})]})})})]})};export{Fe as P};
//# sourceMappingURL=PostCard-CO8hNz3Q.js.map
