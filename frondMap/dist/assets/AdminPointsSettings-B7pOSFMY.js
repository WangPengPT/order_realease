import{p as J,r,j as e,bz as K,cB as Q,bL as O,b_ as R,b7 as W,al as X,w as i}from"./vendor-react-BJ_Fufgb.js";import{B as f,C as j,z as y,G as v,$ as L,E as N,V as w,I as C,s as u}from"./index-BSqTIOKh.js";import{c as Y,d as ee}from"./usePoints-Bd0g_0w-.js";import{A as se,a as te}from"./alert-BClJO8OI.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-Z4kpnli5.js";import"./vendor-supabase-Dbipw1Nj.js";const me=()=>{const{t:s}=J(),{data:l,isLoading:z}=Y(),h=ee(),[m,P]=r.useState(""),[p,_]=r.useState(""),[g,k]=r.useState(""),[B,D]=r.useState(!1),[x,b]=r.useState(""),[T,A]=r.useState(!1),[q,E]=r.useState(!1),[H,$]=r.useState(!1),[c,d]=r.useState(null);if(r.useState(()=>{if(l){const t=l.find(n=>n.key==="comment_points"),o=l.find(n=>n.key==="min_comment_length"),a=l.find(n=>n.key==="post_points");t&&P(t.value),o&&_(o.value),a&&k(a.value)}}),l&&!m&&!p&&!g){const t=l.find(n=>n.key==="comment_points"),o=l.find(n=>n.key==="min_comment_length"),a=l.find(n=>n.key==="post_points");t&&!m&&P(t.value),o&&!p&&_(o.value),a&&!g&&k(a.value)}const M=async()=>{try{await Promise.all([h.mutateAsync({key:"comment_points",value:m}),h.mutateAsync({key:"min_comment_length",value:p}),h.mutateAsync({key:"post_points",value:g})]),i.success(s("admin.pointsSettings.saveSuccess")),D(!1)}catch{i.error(s("admin.pointsSettings.saveFailed"))}},F=(t,o)=>{t(o),D(!0)},V=async()=>{if(!x.trim()){i.error(s("admin.pointsSettings.enterEmailOrId"));return}$(!0),d(null);try{const t=x.trim();if(t.includes("@")){const{data:a,error:n}=await u.functions.invoke("get-user-emails");if(n)throw n;const I=a?.emails||{},S=Object.keys(I).find(U=>I[U]?.toLowerCase()===t.toLowerCase());if(S){const{data:U}=await u.from("profiles").select("display_name").eq("id",S).single();d({id:S,email:I[S],display_name:U?.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}else i.error(s("admin.pointsSettings.userNotFound"))}else{const{data:a,error:n}=await u.from("profiles").select("id, display_name").eq("id",t).single();if(n||!a){i.error(s("admin.pointsSettings.userNotFound"));return}d({id:a.id,email:s("admin.pointsSettings.foundById","(Found by ID)"),display_name:a.display_name||s("common.unknownUser","Unknown User")}),i.success(s("admin.pointsSettings.userFound"))}}catch(t){console.error("Search error:",t),i.error(s("admin.pointsSettings.searchFailed"))}finally{$(!1)}},Z=async()=>{if(!c){i.error(s("admin.pointsSettings.searchUserFirst"));return}A(!0);try{const t=new Date().toISOString().split("T")[0],{error:o,count:a}=await u.from("points_transactions").delete().eq("user_id",c.id).eq("type","comment").gte("created_at",t).lt("created_at",`${t}T23:59:59.999Z`);if(o)throw o;a===0?i.info(s("admin.pointsSettings.noRecordFound")):i.success(s("admin.pointsSettings.resetSuccess")),b(""),d(null)}catch(t){console.error("Reset error:",t),i.error(s("admin.pointsSettings.resetFailed"))}finally{A(!1)}},G=async()=>{if(!c){i.error(s("admin.pointsSettings.searchUserFirst"));return}E(!0);try{const t=new Date().toISOString().split("T")[0],{error:o,count:a}=await u.from("points_transactions").delete().eq("user_id",c.id).eq("type","post").gte("created_at",t).lt("created_at",`${t}T23:59:59.999Z`);if(o)throw o;a===0?i.info(s("admin.pointsSettings.noPostRecordFound")):i.success(s("admin.pointsSettings.resetPostSuccess")),b(""),d(null)}catch(t){console.error("Reset post error:",t),i.error(s("admin.pointsSettings.resetFailed"))}finally{E(!1)}};return z?e.jsx("div",{className:"p-6",children:s("common.loading")}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s("admin.pointsSettings.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("admin.pointsSettings.description")})]}),e.jsxs(f,{onClick:M,disabled:!B||h.isPending,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),s("common.save")]})]}),e.jsxs(se,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(te,{children:s("admin.pointsSettings.info")})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),s("admin.pointsSettings.commentSettings")]}),e.jsx(L,{children:s("admin.pointsSettings.commentSettingsDesc")})]}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"commentPoints",children:s("admin.pointsSettings.commentPoints")}),e.jsx(C,{id:"commentPoints",type:"number",min:"0",value:m,onChange:t=>F(P,t.target.value),placeholder:"5"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.commentPointsHelp")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"minCommentLength",children:s("admin.pointsSettings.minCommentLength")}),e.jsx(C,{id:"minCommentLength",type:"number",min:"0",value:p,onChange:t=>F(_,t.target.value),placeholder:"10"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.minCommentLengthHelp")})]})]})})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),s("admin.pointsSettings.postSettings")]}),e.jsx(L,{children:s("admin.pointsSettings.postSettingsDesc")})]}),e.jsx(N,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"postPoints",children:s("admin.pointsSettings.postPoints")}),e.jsx(C,{id:"postPoints",type:"number",min:"0",value:g,onChange:t=>F(k,t.target.value),placeholder:"10",className:"max-w-xs"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.postPointsHelp")})]})})]}),e.jsxs(j,{children:[e.jsx(y,{children:e.jsx(v,{children:s("admin.pointsSettings.rulesPreview")})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule1")," ",e.jsx("strong",{children:p||"10"})," ",s("admin.pointsSettings.characters")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule2")," ",e.jsx("strong",{children:m||"5"})," ",s("admin.pointsSettings.points")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule3")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.postRule")," ",e.jsx("strong",{children:g||"10"})," ",s("admin.pointsSettings.points")]}),e.jsxs("p",{children:["• ",s("admin.pointsSettings.rule4")]})]})})]}),e.jsxs(j,{children:[e.jsxs(y,{children:[e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),s("admin.pointsSettings.testTools")]}),e.jsx(L,{children:s("admin.pointsSettings.testToolsDesc")})]}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(w,{children:s("admin.pointsSettings.resetDailyComment")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:x,onChange:t=>{b(t.target.value),d(null)},placeholder:s("admin.pointsSettings.emailOrIdPlaceholder"),className:"flex-1"}),e.jsxs(f,{onClick:V,disabled:H||!x.trim(),variant:"outline",children:[e.jsx(W,{className:`h-4 w-4 mr-2 ${H?"animate-spin":""}`}),s("admin.pointsSettings.search")]})]}),c&&e.jsxs("div",{className:"p-3 bg-muted rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:c.display_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.email}),e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:c.id})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{onClick:Z,disabled:T,variant:"destructive",size:"sm",children:[e.jsx(R,{className:`h-4 w-4 mr-2 ${T?"animate-spin":""}`}),s("admin.pointsSettings.reset")]}),e.jsxs(f,{onClick:G,disabled:q,variant:"destructive",size:"sm",children:[e.jsx(R,{className:`h-4 w-4 mr-2 ${q?"animate-spin":""}`}),s("admin.pointsSettings.resetPost")]})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("admin.pointsSettings.resetHelp")})]})})]})]})};export{me as default};
//# sourceMappingURL=AdminPointsSettings-B7pOSFMY.js.map
