const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-KNAP0qdW.js","assets/vendor-ui-DAmPMpEA.js","assets/vendor-react-iAJ0IrSD.js"])))=>i.map(i=>d[i]);
import{j as e}from"./vendor-ui-DAmPMpEA.js";import{u as Mt,r as j,R as L,L as G}from"./vendor-react-iAJ0IrSD.js";import{r as $e,D as Oe,a as Fe,b as Te,c as Le,q as k,n as Ce,s as D,x as Ks,ad as Ws,ae as Rt,a3 as Xs,B as F,$ as gs,Y as js,Z as vs,_ as Ns,I as O,a0 as R,a6 as Ve,a7 as qe,a8 as Ge,a9 as Ye,aa as Ke,af as Dt,ag as Zs,J as re,K as ne,N as ie,O as le,Q as oe,R as ce,T as de,V as J,y as _,a5 as Js,C as Q,i as ee,t as se,M as ke,j as V,ac as me,a2 as It,P as Ot,ah as Ft,S as Tt,f as he,g as ue,ai as et,U as Os,aj as De}from"./index-BcrfGQEh.js";import{u as xe,_ as Lt}from"./vendor-i18n-DxKeo2S1.js";import{H as Ie}from"./heart-ClAJibHi.js";import{T as ps,a as fs,b as X,c as Z}from"./tabs-C_tzE0Ci.js";import{C as $t,a as Ut,b as He}from"./carousel-BxHNJlLZ.js";import{a as Ue}from"./vendor-query-BlSVl3IQ.js";import{a as zt}from"./useActivities-B--CQBpN.js";import{u as Ze}from"./useLocalizedContent-tJ7i_ycU.js";import{u as Bt}from"./useActivityParticipation-ChrDiqMd.js";import{d as Ht}from"./useCoupons-BQ7M5Y8a.js";import{S as Qt}from"./settings-DieqpwJY.js";import{U as Vt}from"./upload-DGLlOmKj.js";import{L as qt}from"./lock-QhxtbcQI.js";import{u as Gt,a as Yt,b as Kt,c as Wt,d as Xt,P as Fs}from"./PointsHistoryDialog-BZIjPZEF.js";import{C as Zt}from"./checkbox-4ejPvdP9.js";import{P as Ts}from"./plus-CN0JuuEq.js";import{S as ys}from"./star-DqKRai6M.js";import{S as Jt}from"./square-pen-B33wHQe-.js";import{B as ea}from"./briefcase-B385EK3a.js";import{B as sa}from"./building-hfhXup05.js";import{A as Ls}from"./ActivityTermsAgreement-CDfVzj5c.js";import{S as $s}from"./separator-CM8vz3w9.js";import{T as We}from"./ticket-BIMDfaCH.js";import{C as ks}from"./clock-DGED8Oob.js";import{f as je}from"./format-C1rHoFdk.js";import{U as st}from"./users-B1UqT5l5.js";import{u as ta}from"./use-mobile-B0RZNQEx.js";import{C as aa}from"./circle-alert-LTD3IVAL.js";import{C as Us}from"./coins-BULu0WSs.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";import"./arrow-left-4K88mBFI.js";import"./arrow-right-D-aBf8aw.js";import"./usePoints-CTc4Rars.js";import"./history-CDUjO1Wv.js";import"./arrow-up-CuHoBHy6.js";import"./refresh-cw-BI_CDHcK.js";import"./shopping-bag-C9l5MTo_.js";import"./gift-CRogwpX5.js";import"./useActivityRules-ij-m5anW.js";import"./file-text-CT0gf2Ab.js";import"./startOfDay-CJ0Nm-E7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=$e("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=$e("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const na=$e("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=$e("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=$e("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);function la({open:s,onOpenChange:t,activity:i}){const{t:l}=xe();return e.jsx(Oe,{open:s,onOpenChange:t,children:e.jsxs(Fe,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(Te,{children:e.jsx(Le,{className:"text-lg font-semibold line-clamp-2",children:i.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(k,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Ie,{className:"w-3.5 h-3.5 fill-primary text-primary"}),l("profile.activityFavorited")]}),i.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:i.image_url,alt:i.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:i.content}})]})]})})}const oa=()=>{const{user:s}=Ce();return Ue({queryKey:["favorites",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await D.from("favorites").select("restaurant_id").eq("user_id",s.id);if(i)throw i;if(!t||t.length===0)return[];const l=t.map(x=>x.restaurant_id),{data:h,error:o}=await D.from("restaurants").select("*").in("id",l);if(o)throw o;return h||[]},enabled:!!s})},ca=()=>{const{user:s}=Ce();return Ue({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:t,error:i}=await D.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(i)throw i;if(!t||t.length===0)return[];const l=t.filter(d=>d.target_type==="restaurant").map(d=>d.target_id),h=t.filter(d=>d.target_type==="activity").map(d=>d.target_id),o=new Map;if(l.length>0){const{data:d}=await D.from("restaurants").select("id, name, name_en, name_pt").in("id",l);d?.forEach(r=>{o.set(r.id,{name:r.name,name_en:r.name_en||void 0,name_pt:r.name_pt||void 0})})}const x=new Map;if(h.length>0){const{data:d}=await D.from("activities").select("id, title_zh, title_en, title_pt").in("id",h);d?.forEach(r=>{x.set(r.id,{title_zh:r.title_zh,title_en:r.title_en,title_pt:r.title_pt})})}return t.map(d=>{if(d.target_type==="restaurant"){const r=o.get(d.target_id);return{...d,target_name:r?.name||"Unknown Restaurant",target_name_en:r?.name_en,target_name_pt:r?.name_pt}}else if(d.target_type==="activity"){const r=x.get(d.target_id);return{...d,target_name:r?.title_zh||"Unknown Activity",target_name_en:r?.title_en,target_name_pt:r?.title_pt}}return d})},enabled:!!s,staleTime:3e4})},da=()=>{const{user:s}=Ce(),{data:t=[]}=Bt();return Ue({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||t.length===0)return[];const i=t.map(a=>a.id),{data:l,error:h}=await D.from("activity_restaurants").select("*").in("restaurant_id",i).order("created_at",{ascending:!1});if(h)throw h;if(!l||l.length===0)return[];const{data:o}=await D.from("restaurants").select("id, name, name_en, name_pt, address").in("id",i),x=[...new Set(l.map(a=>a.activity_id))],{data:d}=await D.from("activities").select("*").in("id",x).eq("status","published");return l.map(a=>{const n=o?.find(m=>m.id===a.restaurant_id),c=d?.find(m=>m.id===a.activity_id);return{activity_id:a.activity_id,restaurant_id:a.restaurant_id,restaurant_name:n?.name||"",restaurant_name_en:n?.name_en||null,restaurant_name_pt:n?.name_pt||null,restaurant_address:n?.address||"",activity:c||null,created_at:a.created_at}}).filter(a=>a.activity!==null)},enabled:!!s&&t.length>0})},tt=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Bs=s=>{if(!s)return{code:"+351",number:""};for(const t of tt)if(s.startsWith(t.code))return{code:t.code,number:s.slice(t.code.length).trim()};return{code:"+351",number:s}},Hs=({profile:s})=>{const{t}=xe(),i=Mt(),{user:l}=Ce(),{isAdmin:h}=Ks(),[o,x]=j.useState(!1),[d,r]=j.useState(s.display_name),a=Bs(s.phone),[n,c]=j.useState(a.code),[m,f]=j.useState(a.number),[p,N]=j.useState(!1),[v,T]=j.useState(null),[E,y]=j.useState(s.avatar_url||""),[A,I]=j.useState(!1),[U,Y]=j.useState(!1),[z,P]=j.useState(""),[te,$]=j.useState(!1),pe=j.useRef(!1);j.useEffect(()=>{const u=pe.current;if(pe.current=o,o&&!u){r(s.display_name);const w=Bs(s.phone);c(w.code),f(w.number),y(s.avatar_url||""),T(null),N(!1)}},[o,s.display_name,s.phone,s.avatar_url]);const[ve,B]=j.useState(!1),[q,K]=j.useState(!1),[g,b]=j.useState(!1),[S,H]=j.useState(""),[be,_e]=j.useState(""),[fe,Ee]=j.useState(""),[Se,ze]=j.useState(!1),[Ne,Be]=j.useState(!1),[Ms,Je]=j.useState(!1),[pt,Me]=j.useState(!1),[ft,Re]=j.useState(!1),[es,ss]=j.useState(""),[ae,ts]=j.useState(""),[ye,as]=j.useState(""),[Rs,rs]=j.useState(!1),[ns,is]=j.useState(""),[Ae,ls]=j.useState(!1),[Ds,Is]=j.useState(!1),[W,os]=j.useState(null),cs=j.useRef(null),ds=j.useRef(null),ms=j.useRef(null),hs=Ws(),us=Rt();j.useEffect(()=>{Se&&cs.current&&cs.current.focus()},[Se]),j.useEffect(()=>{Ne&&ds.current&&ds.current.focus()},[Ne]),j.useEffect(()=>{Ae&&ms.current&&ms.current.focus()},[Ae]);const gt=u=>{const w=u.target.files?.[0];if(w){if(w.size>2*1024*1024)return;T(w),y(URL.createObjectURL(w))}},jt=async()=>{let u=s.avatar_url;if(v){const ge=await us.mutateAsync(v);ge&&(u=ge)}const w=m?`${n} ${m}`:void 0;await hs.mutateAsync({display_name:d,phone:w,avatar_url:u||void 0}),N(!1),x(!1)},vt=async()=>{if(!(!l||z.toLowerCase()!=="delete")){$(!0);try{const{error:u}=await D.functions.invoke("delete-account",{body:{userId:l.id}});if(u){_.error(t("profile.deleteAccountFailed")),console.error(u),$(!1);return}_.success(t("profile.deleteAccountSuccess")),Y(!1),I(!1),P(""),await new Promise(w=>setTimeout(w,1500)),await D.auth.signOut(),i("/auth")}catch(u){_.error(u.message||t("profile.deleteAccountFailed")),$(!1)}finally{$(!1)}}},Nt=async()=>{if(l?.email)try{const{error:u}=await D.functions.invoke("send-verification-code",{body:{email:l.email}});if(u)throw u;ze(!0),_.success(t("profile.codeSentToOldEmail"))}catch(u){_.error(t("profile.sendCodeFailed")),console.error(u)}},yt=async()=>{if(!be){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:w}=await D.functions.invoke("verify-email-code",{body:{email:l?.email,code:be}});if(w||!u?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),B(!1),K(!0)}catch(u){_.error(t("profile.verificationFailed")),console.error(u)}},wt=async()=>{if(!S||!S.includes("@")){_.error(t("profile.enterValidEmail"));return}try{const{error:u}=await D.functions.invoke("send-verification-code",{body:{email:S}});if(u)throw u;_.success(t("profile.codeSentToNewEmail")),Be(!0)}catch(u){_.error(t("profile.sendCodeFailed")),console.error(u)}},Ct=async()=>{if(!fe){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:u,error:w}=await D.functions.invoke("verify-email-code",{body:{email:S,code:fe}});if(w||!u?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.newEmailVerified")),K(!1),setTimeout(()=>{b(!0)},100)}catch(u){_.error(t("toast.verificationFailed")),console.error(u)}},bt=async()=>{Je(!0);try{const{data:{session:u}}=await D.auth.getSession();if(!u||!l){_.error(t("toast.pleaseSignIn")),Je(!1);return}const{data:w,error:ge}=await D.functions.invoke("update-email",{body:{userId:l.id,oldEmail:l.email,oldEmailCode:be,newEmail:S,newEmailCode:fe},headers:{Authorization:`Bearer ${u.access_token}`}});if(ge||!w?.success)throw new Error(w?.error||"Failed to update email");_.success(t("toast.emailUpdatedSuccess")),b(!1),x(!1),_e(""),H(""),Ee(""),ze(!1),Be(!1),await new Promise(xs=>setTimeout(xs,1500)),await D.auth.signOut(),i("/auth")}catch(u){_.error(u.message||t("toast.emailUpdateError")),console.error(u)}finally{Je(!1)}},_t=u=>{let w=0;return u.length>=6&&w++,u.length>=8&&w++,/[a-z]/.test(u)&&w++,/[A-Z]/.test(u)&&w++,/[0-9]/.test(u)&&w++,/[^a-zA-Z0-9]/.test(u)&&w++,w<=2?"weak":w<=4?"medium":"strong"},Et=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!es){_.error(t("profile.enterCurrentPassword"));return}try{const{createClient:w}=await Lt(async()=>{const{createClient:kt}=await import("./vendor-supabase-KNAP0qdW.js");return{createClient:kt}},__vite__mapDeps([0,1,2])),ge=w("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:xs}=await ge.auth.signInWithPassword({email:l?.email||"",password:es});if(xs){_.error(t("profile.oldPasswordIncorrect"));return}_.success(t("profile.oldPasswordVerified")),Me(!1),Re(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},St=async()=>{if(l?.email)try{const{error:u}=await D.functions.invoke("send-verification-code",{body:{email:l.email}});if(u)throw u;ls(!0),_.success(t("profile.codeSentToOldEmail"))}catch(u){_.error(t("profile.sendCodeFailed")),console.error(u)}},At=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!ns){_.error(t("profile.enterCodePlaceholder"));return}try{const{data:w,error:ge}=await D.functions.invoke("verify-email-code",{body:{email:l?.email,code:ns}});if(ge||!w?.success){_.error(t("profile.codeIncorrect"));return}_.success(t("profile.oldEmailVerified")),Me(!1),Re(!0)}catch(w){_.error(t("profile.verificationFailed")),console.error(w)}},Pt=async u=>{if(u?.preventDefault(),u?.stopPropagation(),!ae||!ye){_.error(t("profile.enterNewPassword"));return}if(ae.length<6){_.error(t("profile.passwordTooShort"));return}if(ae!==ye){_.error(t("profile.passwordsDontMatch"));return}Is(!0);try{const{error:w}=await D.auth.updateUser({password:ae});if(w)throw w;_.success(t("profile.passwordUpdated")),Re(!1),x(!1),ss(""),ts(""),as(""),rs(!1),is(""),ls(!1)}catch(w){_.error(w.message||t("profile.passwordUpdateFailed")),console.error(w)}finally{Is(!1)}};return e.jsxs(Oe,{open:o,onOpenChange:x,children:[e.jsx(Xs,{asChild:!0,children:e.jsxs(F,{variant:"outline",children:[e.jsx(Qt,{className:"w-4 h-4 mr-2"}),t("profile.editProfile")]})}),e.jsxs(Fe,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:t("profile.editProfile")}),e.jsx(gs,{children:t("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(js,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(vs,{src:E}),e.jsx(Ns,{children:d?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(O,{type:"file",accept:"image/*",onChange:gt,className:"hidden",id:"avatar-upload"}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(Vt,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{htmlFor:"displayName",className:"text-sm",children:t("profile.displayName")}),e.jsx(O,{id:"displayName",value:d,onChange:u=>r(u.target.value),placeholder:t("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(R,{htmlFor:"phone",className:"text-sm",children:t("profile.phone")}),!s.phone&&!p?e.jsx(F,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"w-full justify-start h-9",children:t("profile.addPhoneNumber")}):p||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ve,{value:n,onValueChange:c,children:[e.jsx(qe,{className:"w-[110px] h-9",children:e.jsx(Ge,{placeholder:"+351"})}),e.jsx(Ye,{children:tt.map(u=>e.jsx(Ke,{value:u.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:u.flag}),e.jsx("span",{children:u.code})]})},u.code))})]}),e.jsx(O,{id:"phone",className:"flex-1 h-9",value:m,onChange:u=>f(u.target.value),placeholder:t("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:`${n} ${m}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:()=>N(!0),className:"text-xs whitespace-nowrap",children:t("profile.modifyPhoneNumber")})]})]}),!h&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(R,{className:"text-sm",children:t("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>B(!0),className:"text-xs",children:[e.jsx(Dt,{className:"w-3 h-3 mr-1"}),t("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${h?"pt-2 border-t":""}`,children:[e.jsx(R,{className:"text-sm",children:t("profile.changePassword")}),e.jsxs(F,{variant:"outline",size:"sm",onClick:()=>Me(!0),className:"w-full justify-start h-9",children:[e.jsx(qt,{className:"w-3 h-3 mr-2"}),t("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!h&&e.jsxs(F,{variant:"destructive",size:"sm",onClick:()=>I(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(Zs,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),t("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${h?"sm:ml-auto":""}`,children:[e.jsx(F,{variant:"outline",size:"sm",onClick:()=>{N(!1),x(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:t("common.cancel")}),e.jsx(F,{size:"sm",onClick:jt,disabled:hs.isPending||us.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:hs.isPending||us.isPending?t("common.loading"):t("common.save")})]})]})]}),e.jsx(re,{open:A,onOpenChange:I,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:t("profile.deleteAccountWarning")}),e.jsx(oe,{children:t("profile.deleteAccountDescription")})]}),e.jsxs(ce,{children:[e.jsx(de,{children:t("common.cancel")}),e.jsx(J,{onClick:()=>{I(!1),Y(!0)},className:"bg-destructive hover:bg-destructive/90",children:t("common.continue")})]})]})}),e.jsx(re,{open:U,onOpenChange:Y,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:t("profile.confirmDeleteAccount")}),e.jsxs(oe,{className:"space-y-4",children:[e.jsx("p",{children:t("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"confirm-delete",children:t("profile.typeDeleteToConfirm")}),e.jsx(O,{id:"confirm-delete",value:z,onChange:u=>P(u.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(ce,{children:[e.jsx(de,{onClick:()=>P(""),children:t("common.cancel")}),e.jsx(J,{onClick:vt,disabled:z.toLowerCase()!=="delete"||te,className:"bg-destructive hover:bg-destructive/90",children:t(te?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(re,{open:ve,onOpenChange:B,children:e.jsxs(ne,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(le,{children:t("profile.verifyOldEmail")}),e.jsx(oe,{children:t("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:Nt,disabled:Se,children:t(Se?"profile.codeSent":"profile.sendCode")})]})]}),Se&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.verificationCode")}),e.jsx(O,{ref:cs,value:be,onChange:u=>_e(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}),e.jsxs(ce,{children:[e.jsx(de,{onClick:()=>{B(!1),setTimeout(()=>{_e(""),ze(!1)},300)},children:t("common.cancel")}),Se&&e.jsx(J,{onClick:yt,children:t("profile.verify")})]})]})}),e.jsx(re,{open:q,onOpenChange:K,children:e.jsxs(ne,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ie,{className:"text-center space-y-3",children:[e.jsx(le,{className:"text-xl",children:t("profile.verifyNewEmail")}),e.jsx(oe,{className:"text-center",children:t("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{className:"text-sm font-normal",children:t("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{type:"email",value:S,onChange:u=>H(u.target.value),placeholder:t("profile.enterNewEmail"),disabled:Ne,className:"border-2 focus:border-primary flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:wt,disabled:!S||Ne,className:"text-xs whitespace-nowrap px-3",children:t(Ne?"profile.codeSent":"profile.sendCode")})]})]}),Ne&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(R,{className:"text-sm font-normal",children:t("profile.verificationCode")}),e.jsx(O,{ref:ds,value:fe,onChange:u=>Ee(u.target.value),placeholder:t("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(ce,{className:"flex-col sm:flex-col gap-2",children:[Ne&&e.jsx(J,{onClick:Ct,disabled:!fe||fe.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(de,{onClick:()=>{K(!1),setTimeout(()=>{H(""),Ee(""),Be(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(re,{open:g,onOpenChange:b,children:e.jsxs(ne,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(le,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(oe,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:l?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:S})]})]})]}),e.jsxs(ce,{children:[e.jsx(de,{onClick:()=>{b(!1),setTimeout(()=>{_e(""),H(""),Ee(""),ze(!1),Be(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(J,{onClick:bt,disabled:Ms,children:Ms?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(re,{open:pt,onOpenChange:Me,children:e.jsxs(ne,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(le,{children:t("profile.verifyOldPassword")}),e.jsx(oe,{children:t("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:Rs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{value:l?.email||"",disabled:!0,className:"flex-1"}),e.jsx(F,{variant:"outline",size:"sm",onClick:St,disabled:Ae,children:t(Ae?"profile.codeSent":"profile.sendCode")})]})]}),Ae&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.verificationCode")}),e.jsx(O,{ref:ms,value:ns,onChange:u=>is(u.target.value),placeholder:t("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.currentPassword")}),e.jsx(O,{type:"password",value:es,onChange:u=>ss(u.target.value),placeholder:t("profile.enterCurrentPassword")})]}),e.jsxs(F,{variant:"link",size:"sm",onClick:()=>rs(!0),className:"text-xs p-0 h-auto",children:[t("profile.forgotPassword")," ",t("profile.useEmailVerification")]})]})}),e.jsxs(ce,{children:[e.jsx(de,{onClick:()=>{Me(!1),setTimeout(()=>{ss(""),rs(!1),is(""),ls(!1)},300)},children:t("common.cancel")}),Rs?Ae&&e.jsx(J,{onClick:At,children:t("profile.verify")}):e.jsx(J,{onClick:Et,children:t("profile.verify")})]})]})}),e.jsx(re,{open:ft,onOpenChange:Re,children:e.jsxs(ne,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ie,{children:[e.jsx(le,{children:t("profile.setNewPassword")}),e.jsx(oe,{children:t("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.newPassword")}),e.jsx(O,{type:"password",value:ae,onChange:u=>{ts(u.target.value),u.target.value?os(_t(u.target.value)):os(null)},placeholder:t("profile.enterNewPassword")}),W&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="weak"?"bg-destructive":W==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="medium"||W==="strong"?W==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${W==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${W==="weak"?"text-destructive":W==="medium"?"text-warning":"text-success"}`,children:t(`auth.passwordStrength.${W}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{children:t("profile.confirmNewPassword")}),e.jsx(O,{type:"password",value:ye,onChange:u=>as(u.target.value),placeholder:t("profile.confirmNewPasswordPlaceholder")})]}),ae&&ye&&ae!==ye&&e.jsx("p",{className:"text-sm text-destructive",children:t("profile.passwordsDontMatch")})]}),e.jsxs(ce,{children:[e.jsx(de,{onClick:()=>{Re(!1),setTimeout(()=>{ts(""),as(""),os(null)},300)},children:t("common.cancel")}),e.jsx(J,{onClick:Pt,disabled:!ae||!ye||ae!==ye||Ds,children:t(Ds?"common.loading":"profile.updatePassword")})]})]})})]})},ws=[{value:"Home",icon:ra,labelKey:"address.labelHome"},{value:"Work",icon:ea,labelKey:"address.labelWork"},{value:"Office",icon:sa,labelKey:"address.labelOffice"},{value:"Other",icon:ke,labelKey:"address.labelOther"}],ma=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],ha=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],Qs=({initialData:s,onSubmit:t,onCancel:i,isLoading:l,isEdit:h})=>{const{t:o}=xe(),[x,d]=j.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),r=a=>{a.preventDefault(),t(x)};return e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"label",children:o("address.label")}),e.jsxs(Ve,{value:x.label,onValueChange:a=>d({...x,label:a}),children:[e.jsx(qe,{children:e.jsx(Ge,{placeholder:o("address.selectLabel")})}),e.jsx(Ye,{children:ws.map(a=>e.jsx(Ke,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{className:"w-4 h-4"}),o(a.labelKey)]})},a.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"street",children:[o("address.street")," *"]}),e.jsx(O,{id:"street",value:x.street,onChange:a=>d({...x,street:a.target.value}),placeholder:o("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"district",children:o("address.district")}),e.jsx(O,{id:"district",value:x.district,onChange:a=>d({...x,district:a.target.value}),placeholder:o("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"city",children:[o("address.city")," *"]}),e.jsx(O,{id:"city",value:x.city,onChange:a=>d({...x,city:a.target.value}),placeholder:o("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"postal_code",children:[o("address.postalCode")," *"]}),e.jsx(O,{id:"postal_code",value:x.postal_code,onChange:a=>d({...x,postal_code:a.target.value}),placeholder:o("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"country",children:[o("address.country")," *"]}),e.jsxs(Ve,{value:x.country,onValueChange:a=>d({...x,country:a}),children:[e.jsx(qe,{children:e.jsx(Ge,{placeholder:o("address.selectCountry")})}),e.jsx(Ye,{children:ha.map(a=>e.jsx(Ke,{value:a,children:a},a))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(R,{htmlFor:"phone",children:[o("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ve,{value:x.phone_code,onValueChange:a=>d({...x,phone_code:a}),children:[e.jsx(qe,{className:"w-[130px]",children:e.jsx(Ge,{placeholder:"+351"})}),e.jsx(Ye,{children:ma.map(a=>e.jsx(Ke,{value:a.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.flag}),e.jsx("span",{children:a.code})]})},a.code))})]}),e.jsx(O,{id:"phone",className:"flex-1",value:x.phone,onChange:a=>d({...x,phone:a.target.value}),placeholder:o("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{id:"is_default",checked:x.is_default,onCheckedChange:a=>d({...x,is_default:a})}),e.jsx(R,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:o("address.setAsDefault")})]}),e.jsxs(It,{className:"gap-2 sm:gap-0",children:[e.jsx(F,{type:"button",variant:"outline",onClick:i,children:o("common.cancel")}),e.jsx(F,{type:"submit",disabled:l,children:o(l?"common.saving":h?"common.save":"address.add")})]})]})},ua=({address:s,onEdit:t,onDelete:i,onSetDefault:l,isDeleting:h,isSettingDefault:o,canDelete:x=!0})=>{const{t:d}=xe(),r=ws.find(n=>n.value===s.label)||ws[3],a=r.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(a,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:d(r.labelKey)}),s.is_default&&e.jsxs(k,{variant:"secondary",className:"text-xs",children:[e.jsx(ys,{className:"w-3 h-3 mr-1 fill-current"}),d("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Ot,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>l(s.id),disabled:o,title:d("address.setAsDefault"),children:e.jsx(ys,{className:"w-4 h-4"})}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>t(s),title:d("common.edit"),children:e.jsx(Jt,{className:"w-4 h-4"})}),x&&e.jsxs(re,{children:[e.jsx(Ft,{asChild:!0,children:e.jsx(F,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:d("common.delete"),children:e.jsx(Zs,{className:"w-4 h-4"})})}),e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:d("address.deleteTitle")}),e.jsx(oe,{children:d("address.deleteDescription")})]}),e.jsxs(ce,{children:[e.jsx(de,{children:d("common.cancel")}),e.jsx(J,{onClick:()=>i(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:h,children:d(h?"common.deleting":"common.delete")})]})]})]})]})]})})},Vs=()=>{const{t:s}=xe(),{data:t,isLoading:i}=Gt(),{data:l}=Js(),h=Yt(),o=Kt(),x=Ws(),d=Wt(),r=Xt(),[a,n]=j.useState(!1),[c,m]=j.useState(null),[f,p]=j.useState(null),[N,v]=j.useState(!1),T=!l?.phone,E=P=>{if(T&&P.phone){p(P),v(!0);return}h.mutate(P,{onSuccess:()=>n(!1)})},y=()=>{if(!f)return;const P=`${f.phone_code||"+351"} ${f.phone}`;x.mutate({phone:P}),h.mutate(f,{onSuccess:()=>{n(!1),p(null),v(!1)}})},A=()=>{p(null),v(!1)},I=P=>{c&&o.mutate({id:c.id,address:P},{onSuccess:()=>m(null)})},U=P=>{d.mutate(P)},Y=P=>{r.mutate(P)};if(i)return e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(V,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const z=t&&t.length>0;return e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(me,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),z&&e.jsxs(Oe,{open:a,onOpenChange:n,children:[e.jsx(Xs,{asChild:!0,children:e.jsxs(F,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(Fe,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:s("address.addNew")}),e.jsx(gs,{children:s("address.addDescription")})]}),e.jsx(Qs,{onSubmit:E,onCancel:()=>n(!1),isLoading:h.isPending})]})]})]})}),e.jsx(V,{children:z?e.jsx("div",{className:"space-y-4",children:t.map(P=>e.jsx(ua,{address:P,onEdit:m,onDelete:U,onSetDefault:Y,isDeleting:d.isPending,isSettingDefault:r.isPending,canDelete:t.length>1},P.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(F,{onClick:()=>n(!0),children:[e.jsx(Ts,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(Oe,{open:!!c,onOpenChange:()=>m(null),children:e.jsxs(Fe,{className:"sm:max-w-[500px]",children:[e.jsxs(Te,{children:[e.jsx(Le,{children:s("address.editAddress")}),e.jsx(gs,{children:s("address.editDescription")})]}),c&&e.jsx(Qs,{initialData:c,onSubmit:I,onCancel:()=>m(null),isLoading:o.isPending,isEdit:!0})]})}),e.jsx(re,{open:N,onOpenChange:v,children:e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:s("address.phoneConfirmTitle")}),e.jsx(oe,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(ce,{children:[e.jsx(de,{onClick:A,children:s("common.cancel")}),e.jsx(J,{onClick:y,disabled:h.isPending||x.isPending,children:h.isPending||x.isPending?s("common.saving"):s("common.confirm")})]})]})})]})};var xa=Object.defineProperty,Xe=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,qs=(s,t,i)=>t in s?xa(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,Cs=(s,t)=>{for(var i in t||(t={}))at.call(t,i)&&qs(s,i,t[i]);if(Xe)for(var i of Xe(t))rt.call(t,i)&&qs(s,i,t[i]);return s},bs=(s,t)=>{var i={};for(var l in s)at.call(s,l)&&t.indexOf(l)<0&&(i[l]=s[l]);if(s!=null&&Xe)for(var l of Xe(s))t.indexOf(l)<0&&rt.call(s,l)&&(i[l]=s[l]);return i};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var we;(s=>{const t=class C{constructor(r,a,n,c){if(this.version=r,this.errorCorrectionLevel=a,this.modules=[],this.isFunction=[],r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version value out of range");if(c<-1||c>7)throw new RangeError("Mask value out of range");this.size=r*4+17;let m=[];for(let p=0;p<this.size;p++)m.push(!1);for(let p=0;p<this.size;p++)this.modules.push(m.slice()),this.isFunction.push(m.slice());this.drawFunctionPatterns();const f=this.addEccAndInterleave(n);if(this.drawCodewords(f),c==-1){let p=1e9;for(let N=0;N<8;N++){this.applyMask(N),this.drawFormatBits(N);const v=this.getPenaltyScore();v<p&&(c=N,p=v),this.applyMask(N)}}h(0<=c&&c<=7),this.mask=c,this.applyMask(c),this.drawFormatBits(c),this.isFunction=[]}static encodeText(r,a){const n=s.QrSegment.makeSegments(r);return C.encodeSegments(n,a)}static encodeBinary(r,a){const n=s.QrSegment.makeBytes(r);return C.encodeSegments([n],a)}static encodeSegments(r,a,n=1,c=40,m=-1,f=!0){if(!(C.MIN_VERSION<=n&&n<=c&&c<=C.MAX_VERSION)||m<-1||m>7)throw new RangeError("Invalid value");let p,N;for(p=n;;p++){const y=C.getNumDataCodewords(p,a)*8,A=x.getTotalBits(r,p);if(A<=y){N=A;break}if(p>=c)throw new RangeError("Data too long")}for(const y of[C.Ecc.MEDIUM,C.Ecc.QUARTILE,C.Ecc.HIGH])f&&N<=C.getNumDataCodewords(p,y)*8&&(a=y);let v=[];for(const y of r){i(y.mode.modeBits,4,v),i(y.numChars,y.mode.numCharCountBits(p),v);for(const A of y.getData())v.push(A)}h(v.length==N);const T=C.getNumDataCodewords(p,a)*8;h(v.length<=T),i(0,Math.min(4,T-v.length),v),i(0,(8-v.length%8)%8,v),h(v.length%8==0);for(let y=236;v.length<T;y^=253)i(y,8,v);let E=[];for(;E.length*8<v.length;)E.push(0);return v.forEach((y,A)=>E[A>>>3]|=y<<7-(A&7)),new C(p,a,E,m)}getModule(r,a){return 0<=r&&r<this.size&&0<=a&&a<this.size&&this.modules[a][r]}getModules(){return this.modules}drawFunctionPatterns(){for(let n=0;n<this.size;n++)this.setFunctionModule(6,n,n%2==0),this.setFunctionModule(n,6,n%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const r=this.getAlignmentPatternPositions(),a=r.length;for(let n=0;n<a;n++)for(let c=0;c<a;c++)n==0&&c==0||n==0&&c==a-1||n==a-1&&c==0||this.drawAlignmentPattern(r[n],r[c]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(r){const a=this.errorCorrectionLevel.formatBits<<3|r;let n=a;for(let m=0;m<10;m++)n=n<<1^(n>>>9)*1335;const c=(a<<10|n)^21522;h(c>>>15==0);for(let m=0;m<=5;m++)this.setFunctionModule(8,m,l(c,m));this.setFunctionModule(8,7,l(c,6)),this.setFunctionModule(8,8,l(c,7)),this.setFunctionModule(7,8,l(c,8));for(let m=9;m<15;m++)this.setFunctionModule(14-m,8,l(c,m));for(let m=0;m<8;m++)this.setFunctionModule(this.size-1-m,8,l(c,m));for(let m=8;m<15;m++)this.setFunctionModule(8,this.size-15+m,l(c,m));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let r=this.version;for(let n=0;n<12;n++)r=r<<1^(r>>>11)*7973;const a=this.version<<12|r;h(a>>>18==0);for(let n=0;n<18;n++){const c=l(a,n),m=this.size-11+n%3,f=Math.floor(n/3);this.setFunctionModule(m,f,c),this.setFunctionModule(f,m,c)}}drawFinderPattern(r,a){for(let n=-4;n<=4;n++)for(let c=-4;c<=4;c++){const m=Math.max(Math.abs(c),Math.abs(n)),f=r+c,p=a+n;0<=f&&f<this.size&&0<=p&&p<this.size&&this.setFunctionModule(f,p,m!=2&&m!=4)}}drawAlignmentPattern(r,a){for(let n=-2;n<=2;n++)for(let c=-2;c<=2;c++)this.setFunctionModule(r+c,a+n,Math.max(Math.abs(c),Math.abs(n))!=1)}setFunctionModule(r,a,n){this.modules[a][r]=n,this.isFunction[a][r]=!0}addEccAndInterleave(r){const a=this.version,n=this.errorCorrectionLevel;if(r.length!=C.getNumDataCodewords(a,n))throw new RangeError("Invalid argument");const c=C.NUM_ERROR_CORRECTION_BLOCKS[n.ordinal][a],m=C.ECC_CODEWORDS_PER_BLOCK[n.ordinal][a],f=Math.floor(C.getNumRawDataModules(a)/8),p=c-f%c,N=Math.floor(f/c);let v=[];const T=C.reedSolomonComputeDivisor(m);for(let y=0,A=0;y<c;y++){let I=r.slice(A,A+N-m+(y<p?0:1));A+=I.length;const U=C.reedSolomonComputeRemainder(I,T);y<p&&I.push(0),v.push(I.concat(U))}let E=[];for(let y=0;y<v[0].length;y++)v.forEach((A,I)=>{(y!=N-m||I>=p)&&E.push(A[y])});return h(E.length==f),E}drawCodewords(r){if(r.length!=Math.floor(C.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let a=0;for(let n=this.size-1;n>=1;n-=2){n==6&&(n=5);for(let c=0;c<this.size;c++)for(let m=0;m<2;m++){const f=n-m,N=(n+1&2)==0?this.size-1-c:c;!this.isFunction[N][f]&&a<r.length*8&&(this.modules[N][f]=l(r[a>>>3],7-(a&7)),a++)}}h(a==r.length*8)}applyMask(r){if(r<0||r>7)throw new RangeError("Mask value out of range");for(let a=0;a<this.size;a++)for(let n=0;n<this.size;n++){let c;switch(r){case 0:c=(n+a)%2==0;break;case 1:c=a%2==0;break;case 2:c=n%3==0;break;case 3:c=(n+a)%3==0;break;case 4:c=(Math.floor(n/3)+Math.floor(a/2))%2==0;break;case 5:c=n*a%2+n*a%3==0;break;case 6:c=(n*a%2+n*a%3)%2==0;break;case 7:c=((n+a)%2+n*a%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[a][n]&&c&&(this.modules[a][n]=!this.modules[a][n])}}getPenaltyScore(){let r=0;for(let m=0;m<this.size;m++){let f=!1,p=0,N=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[m][v]==f?(p++,p==5?r+=C.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,N),f||(r+=this.finderPenaltyCountPatterns(N)*C.PENALTY_N3),f=this.modules[m][v],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,N)*C.PENALTY_N3}for(let m=0;m<this.size;m++){let f=!1,p=0,N=[0,0,0,0,0,0,0];for(let v=0;v<this.size;v++)this.modules[v][m]==f?(p++,p==5?r+=C.PENALTY_N1:p>5&&r++):(this.finderPenaltyAddHistory(p,N),f||(r+=this.finderPenaltyCountPatterns(N)*C.PENALTY_N3),f=this.modules[v][m],p=1);r+=this.finderPenaltyTerminateAndCount(f,p,N)*C.PENALTY_N3}for(let m=0;m<this.size-1;m++)for(let f=0;f<this.size-1;f++){const p=this.modules[m][f];p==this.modules[m][f+1]&&p==this.modules[m+1][f]&&p==this.modules[m+1][f+1]&&(r+=C.PENALTY_N2)}let a=0;for(const m of this.modules)a=m.reduce((f,p)=>f+(p?1:0),a);const n=this.size*this.size,c=Math.ceil(Math.abs(a*20-n*10)/n)-1;return h(0<=c&&c<=9),r+=c*C.PENALTY_N4,h(0<=r&&r<=2568888),r}getAlignmentPatternPositions(){if(this.version==1)return[];{const r=Math.floor(this.version/7)+2,a=this.version==32?26:Math.ceil((this.version*4+4)/(r*2-2))*2;let n=[6];for(let c=this.size-7;n.length<r;c-=a)n.splice(1,0,c);return n}}static getNumRawDataModules(r){if(r<C.MIN_VERSION||r>C.MAX_VERSION)throw new RangeError("Version number out of range");let a=(16*r+128)*r+64;if(r>=2){const n=Math.floor(r/7)+2;a-=(25*n-10)*n-55,r>=7&&(a-=36)}return h(208<=a&&a<=29648),a}static getNumDataCodewords(r,a){return Math.floor(C.getNumRawDataModules(r)/8)-C.ECC_CODEWORDS_PER_BLOCK[a.ordinal][r]*C.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][r]}static reedSolomonComputeDivisor(r){if(r<1||r>255)throw new RangeError("Degree out of range");let a=[];for(let c=0;c<r-1;c++)a.push(0);a.push(1);let n=1;for(let c=0;c<r;c++){for(let m=0;m<a.length;m++)a[m]=C.reedSolomonMultiply(a[m],n),m+1<a.length&&(a[m]^=a[m+1]);n=C.reedSolomonMultiply(n,2)}return a}static reedSolomonComputeRemainder(r,a){let n=a.map(c=>0);for(const c of r){const m=c^n.shift();n.push(0),a.forEach((f,p)=>n[p]^=C.reedSolomonMultiply(f,m))}return n}static reedSolomonMultiply(r,a){if(r>>>8||a>>>8)throw new RangeError("Byte out of range");let n=0;for(let c=7;c>=0;c--)n=n<<1^(n>>>7)*285,n^=(a>>>c&1)*r;return h(n>>>8==0),n}finderPenaltyCountPatterns(r){const a=r[1];h(a<=this.size*3);const n=a>0&&r[2]==a&&r[3]==a*3&&r[4]==a&&r[5]==a;return(n&&r[0]>=a*4&&r[6]>=a?1:0)+(n&&r[6]>=a*4&&r[0]>=a?1:0)}finderPenaltyTerminateAndCount(r,a,n){return r&&(this.finderPenaltyAddHistory(a,n),a=0),a+=this.size,this.finderPenaltyAddHistory(a,n),this.finderPenaltyCountPatterns(n)}finderPenaltyAddHistory(r,a){a[0]==0&&(r+=this.size),a.pop(),a.unshift(r)}};t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],s.QrCode=t;function i(d,r,a){if(r<0||r>31||d>>>r)throw new RangeError("Value out of range");for(let n=r-1;n>=0;n--)a.push(d>>>n&1)}function l(d,r){return(d>>>r&1)!=0}function h(d){if(!d)throw new Error("Assertion error")}const o=class M{constructor(r,a,n){if(this.mode=r,this.numChars=a,this.bitData=n,a<0)throw new RangeError("Invalid argument");this.bitData=n.slice()}static makeBytes(r){let a=[];for(const n of r)i(n,8,a);return new M(M.Mode.BYTE,r.length,a)}static makeNumeric(r){if(!M.isNumeric(r))throw new RangeError("String contains non-numeric characters");let a=[];for(let n=0;n<r.length;){const c=Math.min(r.length-n,3);i(parseInt(r.substring(n,n+c),10),c*3+1,a),n+=c}return new M(M.Mode.NUMERIC,r.length,a)}static makeAlphanumeric(r){if(!M.isAlphanumeric(r))throw new RangeError("String contains unencodable characters in alphanumeric mode");let a=[],n;for(n=0;n+2<=r.length;n+=2){let c=M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n))*45;c+=M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n+1)),i(c,11,a)}return n<r.length&&i(M.ALPHANUMERIC_CHARSET.indexOf(r.charAt(n)),6,a),new M(M.Mode.ALPHANUMERIC,r.length,a)}static makeSegments(r){return r==""?[]:M.isNumeric(r)?[M.makeNumeric(r)]:M.isAlphanumeric(r)?[M.makeAlphanumeric(r)]:[M.makeBytes(M.toUtf8ByteArray(r))]}static makeEci(r){let a=[];if(r<0)throw new RangeError("ECI assignment value out of range");if(r<128)i(r,8,a);else if(r<16384)i(2,2,a),i(r,14,a);else if(r<1e6)i(6,3,a),i(r,21,a);else throw new RangeError("ECI assignment value out of range");return new M(M.Mode.ECI,0,a)}static isNumeric(r){return M.NUMERIC_REGEX.test(r)}static isAlphanumeric(r){return M.ALPHANUMERIC_REGEX.test(r)}getData(){return this.bitData.slice()}static getTotalBits(r,a){let n=0;for(const c of r){const m=c.mode.numCharCountBits(a);if(c.numChars>=1<<m)return 1/0;n+=4+m+c.bitData.length}return n}static toUtf8ByteArray(r){r=encodeURI(r);let a=[];for(let n=0;n<r.length;n++)r.charAt(n)!="%"?a.push(r.charCodeAt(n)):(a.push(parseInt(r.substring(n+1,n+3),16)),n+=2);return a}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let x=o;s.QrSegment=o})(we||(we={}));(s=>{(t=>{const i=class{constructor(h,o){this.ordinal=h,this.formatBits=o}};i.LOW=new i(0,1),i.MEDIUM=new i(1,0),i.QUARTILE=new i(2,3),i.HIGH=new i(3,2),t.Ecc=i})(s.QrCode||(s.QrCode={}))})(we||(we={}));(s=>{(t=>{const i=class{constructor(h,o){this.modeBits=h,this.numBitsCharCount=o}numCharCountBits(h){return this.numBitsCharCount[Math.floor((h+7)/17)]}};i.NUMERIC=new i(1,[10,12,14]),i.ALPHANUMERIC=new i(2,[9,11,13]),i.BYTE=new i(4,[8,16,16]),i.KANJI=new i(8,[8,10,12]),i.ECI=new i(7,[0,0,0]),t.Mode=i})(s.QrSegment||(s.QrSegment={}))})(we||(we={}));var Pe=we;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var pa={L:Pe.QrCode.Ecc.LOW,M:Pe.QrCode.Ecc.MEDIUM,Q:Pe.QrCode.Ecc.QUARTILE,H:Pe.QrCode.Ecc.HIGH},nt=128,it="L",lt="#FFFFFF",ot="#000000",ct=!1,dt=1,fa=4,ga=0,ja=.1;function mt(s,t=0){const i=[];return s.forEach(function(l,h){let o=null;l.forEach(function(x,d){if(!x&&o!==null){i.push(`M${o+t} ${h+t}h${d-o}v1H${o+t}z`),o=null;return}if(d===l.length-1){if(!x)return;o===null?i.push(`M${d+t},${h+t} h1v1H${d+t}z`):i.push(`M${o+t},${h+t} h${d+1-o}v1H${o+t}z`);return}x&&o===null&&(o=d)})}),i.join("")}function ht(s,t){return s.slice().map((i,l)=>l<t.y||l>=t.y+t.h?i:i.map((h,o)=>o<t.x||o>=t.x+t.w?h:!1))}function va(s,t,i,l){if(l==null)return null;const h=s.length+i*2,o=Math.floor(t*ja),x=h/t,d=(l.width||o)*x,r=(l.height||o)*x,a=l.x==null?s.length/2-d/2:l.x*x,n=l.y==null?s.length/2-r/2:l.y*x,c=l.opacity==null?1:l.opacity;let m=null;if(l.excavate){let p=Math.floor(a),N=Math.floor(n),v=Math.ceil(d+a-p),T=Math.ceil(r+n-N);m={x:p,y:N,w:v,h:T}}const f=l.crossOrigin;return{x:a,y:n,h:r,w:d,excavation:m,opacity:c,crossOrigin:f}}function Na(s,t){return t!=null?Math.max(Math.floor(t),0):s?fa:ga}function ut({value:s,level:t,minVersion:i,includeMargin:l,marginSize:h,imageSettings:o,size:x,boostLevel:d}){let r=L.useMemo(()=>{const p=(Array.isArray(s)?s:[s]).reduce((N,v)=>(N.push(...Pe.QrSegment.makeSegments(v)),N),[]);return Pe.QrCode.encodeSegments(p,pa[t],i,void 0,void 0,d)},[s,t,i,d]);const{cells:a,margin:n,numCells:c,calculatedImageSettings:m}=L.useMemo(()=>{let f=r.getModules();const p=Na(l,h),N=f.length+p*2,v=va(f,x,p,o);return{cells:f,margin:p,numCells:N,calculatedImageSettings:v}},[r,x,o,l,h]);return{qrcode:r,margin:n,cells:a,numCells:c,calculatedImageSettings:m}}var ya=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),wa=L.forwardRef(function(t,i){const l=t,{value:h,size:o=nt,level:x=it,bgColor:d=lt,fgColor:r=ot,includeMargin:a=ct,minVersion:n=dt,boostLevel:c,marginSize:m,imageSettings:f}=l,N=bs(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:v}=N,T=bs(N,["style"]),E=f?.src,y=L.useRef(null),A=L.useRef(null),I=L.useCallback(B=>{y.current=B,typeof i=="function"?i(B):i&&(i.current=B)},[i]),[U,Y]=L.useState(!1),{margin:z,cells:P,numCells:te,calculatedImageSettings:$}=ut({value:h,level:x,minVersion:n,boostLevel:c,includeMargin:a,marginSize:m,imageSettings:f,size:o});L.useEffect(()=>{if(y.current!=null){const B=y.current,q=B.getContext("2d");if(!q)return;let K=P;const g=A.current,b=$!=null&&g!==null&&g.complete&&g.naturalHeight!==0&&g.naturalWidth!==0;b&&$.excavation!=null&&(K=ht(P,$.excavation));const S=window.devicePixelRatio||1;B.height=B.width=o*S;const H=o/te*S;q.scale(H,H),q.fillStyle=d,q.fillRect(0,0,te,te),q.fillStyle=r,ya?q.fill(new Path2D(mt(K,z))):P.forEach(function(be,_e){be.forEach(function(fe,Ee){fe&&q.fillRect(Ee+z,_e+z,1,1)})}),$&&(q.globalAlpha=$.opacity),b&&q.drawImage(g,$.x+z,$.y+z,$.w,$.h)}}),L.useEffect(()=>{Y(!1)},[E]);const pe=Cs({height:o,width:o},v);let ve=null;return E!=null&&(ve=L.createElement("img",{src:E,key:E,style:{display:"none"},onLoad:()=>{Y(!0)},ref:A,crossOrigin:$?.crossOrigin})),L.createElement(L.Fragment,null,L.createElement("canvas",Cs({style:pe,height:o,width:o,ref:I,role:"img"},T)),ve)});wa.displayName="QRCodeCanvas";var xt=L.forwardRef(function(t,i){const l=t,{value:h,size:o=nt,level:x=it,bgColor:d=lt,fgColor:r=ot,includeMargin:a=ct,minVersion:n=dt,boostLevel:c,title:m,marginSize:f,imageSettings:p}=l,N=bs(l,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:v,cells:T,numCells:E,calculatedImageSettings:y}=ut({value:h,level:x,minVersion:n,boostLevel:c,includeMargin:a,marginSize:f,imageSettings:p,size:o});let A=T,I=null;p!=null&&y!=null&&(y.excavation!=null&&(A=ht(T,y.excavation)),I=L.createElement("image",{href:p.src,height:y.h,width:y.w,x:y.x+v,y:y.y+v,preserveAspectRatio:"none",opacity:y.opacity,crossOrigin:y.crossOrigin}));const U=mt(A,v);return L.createElement("svg",Cs({height:o,width:o,viewBox:`0 0 ${E} ${E}`,ref:i,role:"img"},N),!!m&&L.createElement("title",null,m),L.createElement("path",{fill:d,d:`M0,0 h${E}v${E}H0z`,shapeRendering:"crispEdges"}),L.createElement("path",{fill:r,d:U,shapeRendering:"crispEdges"}),I)});xt.displayName="QRCodeSVG";const Ca=({open:s,onOpenChange:t,coupon:i})=>{const{t:l}=xe(),{getLocalizedField:h}=Ze(),[o,x]=j.useState(!1),d=i.coupon_codes?.coupon_templates,r=i.coupon_codes?.code,a=!!i.used_at;return e.jsx(Oe,{open:s,onOpenChange:n=>{t(n),n||x(!1)},children:e.jsxs(Fe,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(Te,{children:e.jsxs(Le,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5 text-primary"}),l("profile.coupons.details")]})}),e.jsx(Tt,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:h(d,"title")}),e.jsx(k,{variant:a?"secondary":"default",children:l(a?"profile.coupons.used":"profile.coupons.available")})]}),d?.description_zh||d?.description_en||d?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:h(d,"description")}):null]}),e.jsx($s,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>x(!o),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(xt,{value:r||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:r}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(na,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:l("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(Qe,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:d?.discount_type==="percentage"?`${d?.discount_value}% OFF`:`â‚¬${d?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ks,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:je(new Date(i.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),a&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:je(new Date(i.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:d?.valid_until?`${je(new Date(d.valid_from),"yyyy-MM-dd")} - ${je(new Date(d.valid_until),"yyyy-MM-dd")}`:l("profile.coupons.noExpiry")})]})]}),d?.min_order_amount&&d.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.min_order_amount]})]})]}),d?.max_discount_amount&&d.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:l("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",d.max_discount_amount]})]})]}),e.jsx($s,{}),i.activity_id&&i.source==="share"&&e.jsxs(G,{to:`/activity/${i.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(Qe,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[l("profile.coupons.source"),": ",l("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",l("profile.coupons.viewActivity"),")"]})]})]})})]})})},ba=()=>{const{user:s}=Ce();return Ue({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await D.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},_a=()=>{const{user:s}=Ce();return Ue({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:t,error:i}=await D.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(i)throw i;return t},enabled:!!s?.email})},Gs=()=>{const{t:s}=xe(),{data:t,isLoading:i}=ba(),{getLocalizedField:l}=Ze(),h=o=>{switch(o){case"confirmed":return e.jsx(k,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(k,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(k,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(k,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(k,{variant:"outline",children:o})}};return e.jsxs(Q,{children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(zs,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(me,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(V,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(G,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ue,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ue,{className:"w-4 h-4 inline mr-1"}),x]})}),h(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(zs,{className:"w-3 h-3"}),je(new Date(o.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ks,{className:"w-3 h-3"}),o.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-3 h-3"}),o.party_size," ",s("booking.people")]})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},Ys=()=>{const{t:s}=xe(),{data:t,isLoading:i}=_a(),{getLocalizedField:l}=Ze(),h=o=>{switch(o){case"completed":return e.jsx(k,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(k,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(k,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(k,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(k,{variant:"outline",children:o})}};return e.jsxs(Q,{children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(ia,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(me,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(V,{className:"px-3",children:i?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):t&&t.length>0?e.jsx("div",{className:"space-y-3",children:t.map(o=>{const x=o.restaurants?l(o.restaurants,"name"):o.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:o.restaurant_id?e.jsxs(G,{to:`/restaurant/${o.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ue,{className:"w-4 h-4 inline mr-1"}),x]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ue,{className:"w-4 h-4 inline mr-1"}),x]})}),h(o.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:je(new Date(o.order_date),"yyyy-MM-dd HH:mm")}),o.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",o.total_amount.toFixed(2)]})]}),o.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(ke,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:o.delivery_address})]}),o.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:o.notes})]},o.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},_s=j.memo(({comment:s,getLocalizedField:t,t:i})=>{const l=s.moderation_status==="flagged",h=s.moderation_status==="pending",o=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const x={spam:i("riskReason.spam","åžƒåœ¾ä¿¡æ¯"),offensive:i("riskReason.offensive","ä¸å½“è¨€è®º"),harassment:i("riskReason.harassment","éªšæ‰°æ”»å‡»"),fake_review:i("riskReason.fakeReview","è™šå‡è¯„è®º"),flooding:i("riskReason.flooding","åˆ·å±"),irrelevant:i("riskReason.irrelevant","æ— å…³å†…å®¹"),sensitive_word_detected:i("riskReason.sensitiveWord","æ•æ„Ÿè¯"),parse_error:i("riskReason.parseError","è§£æžé”™è¯¯")};return s.risk_reasons.map(d=>x[d]||d).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(G,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:t(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:et(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),h&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(k,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(ks,{className:"w-3 h-3 mr-1"}),i("restaurant.commentPending","å®¡æ ¸ä¸­")]})}),l&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(k,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(aa,{className:"w-3 h-3 mr-1"}),i("restaurant.commentFailed","å‘é€å¤±è´¥")]}),o()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[i("restaurant.failReason","å¤±è´¥åŽŸå› "),": ",o()]})]})]})});_s.displayName="CommentItem";const Es=j.memo(({restaurant:s,getLocalizedField:t,t:i})=>e.jsxs(G,{to:`/restaurant/${s.id}`,className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t(s,"name")),className:"w-full h-full object-cover",loading:"lazy",onError:l=>{l.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t(s,"name")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:t(s,"type")}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ys,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[i("restaurant.noRatingLine1"),e.jsx("br",{}),i("restaurant.noRatingLine2")]})]})]})]}));Es.displayName="FavoriteRestaurantItem";const Ss=j.memo(({subscription:s,getLocalizedField:t,t:i,isMobile:l})=>{const[h,o]=j.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>o(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${l?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(t(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[i("profile.joinedOn"),":"," ",et(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Ie,{className:`text-primary fill-primary flex-shrink-0 ${l?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(la,{open:h,onOpenChange:o,activity:{title:String(t(s.activity,"title")),image_url:s.activity?.image_url,content:String(t(s.activity,"content"))}})]})});Ss.displayName="ActivitySubscriptionItem";const As=j.memo(({activityGroup:s,getLocalizedField:t,t:i,isMobile:l})=>{const h=s.activity,o=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${l?"p-3":"p-4"}`,children:[e.jsx(G,{to:`/activity/${h.id}`,className:l?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${l?"gap-3":"gap-4"}`,children:[h.image_url&&e.jsx("img",{src:h.image_url,alt:String(t(h,"title")),className:`rounded-lg object-cover flex-shrink-0 ${l?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":""}`,children:t(h,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${l?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:t(h,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),new Date(h.start_date).toLocaleDateString()]}),h.end_date&&e.jsxs("span",{children:["- ",new Date(h.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${l?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${l?"mb-1.5":"mb-2"}`,children:[e.jsx(ue,{className:`text-primary ${l?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${l?"text-xs":"text-sm"}`,children:[i("profile.participatingRestaurants")," (",o.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${l?"gap-1.5":"gap-2"}`,children:o.map(x=>e.jsx(k,{variant:"secondary",className:l?"text-xs px-2 py-0.5":"text-xs",children:t(x,"name")},x.id))})]})]})});As.displayName="MerchantActivityItem";const Ps=j.memo(({coupon:s,getLocalizedField:t,t:i,isMobile:l})=>{const[h,o]=j.useState(!1),x=s.coupon_codes?.coupon_templates,d=s.coupon_codes?.code,r=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${r?"bg-muted/30":"hover:shadow-medium"} ${l?"p-3":"p-4"}`,onClick:()=>o(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${l?"text-sm":"text-base"}`,children:t(x,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${l?"text-xs":"text-sm"}`,children:t(x,"description")})]}),e.jsx(k,{variant:r?"secondary":"default",className:l?"text-xs":"",children:i(r?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${l?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:d}),e.jsx("span",{className:"text-muted-foreground",children:x?.discount_type==="percentage"?`${x?.discount_value}%`:`â‚¬${x?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${l?"text-xs":"text-sm"}`,children:r?e.jsxs("span",{children:[i("profile.coupons.usedOn"),": ",je(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):x?.valid_until?e.jsxs("span",{children:[i("profile.coupons.validUntil"),": ",je(new Date(x.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:i("profile.coupons.noExpiry")})})]}),e.jsx(Ca,{open:h,onOpenChange:o,coupon:s})]})});Ps.displayName="UserCouponItem";const jr=()=>{const{t:s}=xe(),{user:t}=Ce(),i=ta(),{data:l,isLoading:h}=Js(),{data:o,isLoading:x}=oa(),{data:d,isLoading:r}=ca(),{data:a,isLoading:n}=zt(),{data:c,isLoading:m}=da(),{data:f,isLoading:p}=Ht(),{role:N,isMerchant:v,isSupervisor:T}=Ks(),{getLocalizedField:E}=Ze(),y=v||T,[A,I]=j.useState("profile"),[U,Y]=j.useState(),[z,P]=j.useState({}),[te,$]=j.useState(new Set(["profile"])),pe=y?[{value:"profile",label:s("profile.profile"),icon:Os},{value:"favorites",label:s("profile.favorites"),icon:Ie},{value:"comments",label:s("profile.comments"),icon:De},{value:"activities",label:s("profile.participatedActivities"),icon:he}]:[{value:"profile",label:s("profile.profile"),icon:Os},{value:"favorites",label:s("profile.favorites"),icon:Ie},{value:"comments",label:s("profile.comments"),icon:De}],ve=g=>{P(b=>({...b,[g]:window.scrollY}))},B=g=>{if(te.has(g)){const b=z[g]||0;setTimeout(()=>window.scrollTo(0,b),0)}else setTimeout(()=>window.scrollTo(0,0),0),$(b=>new Set([...b,g]))};j.useEffect(()=>{if(!U)return;const g=()=>{const b=U.selectedScrollSnap(),S=pe[b].value;S!==A&&(ve(A),B(S),I(S))};return U.on("select",g),()=>{U.off("select",g)}},[U,A,z,te]);const q=g=>{if(g===A)return;ve(A);const b=pe.findIndex(S=>S.value===g);b!==-1&&U&&U.scrollTo(b),B(g),I(g)};if(!t||h)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const K=s(N?`profile.role.${N}`:"profile.role.user");return e.jsx("div",{className:`min-h-screen bg-secondary/20 ${i?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${i?"px-3":""}`,children:[!i&&e.jsx(e.Fragment,{children:e.jsx(Q,{className:"mb-6 md:mb-8",children:e.jsx(V,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(js,{className:"w-24 h-24",children:[e.jsx(vs,{src:l?.avatar_url||""}),e.jsx(Ns,{className:"text-3xl",children:l?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:l?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.email}),l?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:l.phone}),N&&N!=="user"&&e.jsx(k,{className:"bg-primary capitalize",children:K}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Us,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:l?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Fs,{})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[l&&e.jsx(Hs,{profile:l}),y&&l&&e.jsx(Ls,{isAgreed:l?.activity_terms_agreed||!1,agreedAt:l?.activity_terms_agreed_at||null})]})]})})})}),i?e.jsxs(e.Fragment,{children:[e.jsx($t,{setApi:Y,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(Ut,{className:"-ml-0",children:[e.jsx(He,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(Q,{children:e.jsx(V,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(js,{className:"w-20 h-20",children:[e.jsx(vs,{src:l?.avatar_url||""}),e.jsx(Ns,{className:"text-2xl",children:l?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:l?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:t.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(Us,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:l?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points","ç§¯åˆ†")}),e.jsx(Fs,{})]}),l?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:l.phone}),N&&N!=="user"&&e.jsx(k,{className:"bg-primary capitalize text-xs mb-4",children:K}),l&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Hs,{profile:l}),y&&e.jsx(Ls,{isAgreed:l?.activity_terms_agreed||!1,agreedAt:l?.activity_terms_agreed_at||null})]})]})]})})}),e.jsxs(Q,{children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(me,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(V,{className:"px-3",children:p?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):f&&f.length>0?e.jsx("div",{className:"space-y-3",children:f.map(g=>e.jsx(Ps,{coupon:g,getLocalizedField:E,t:s,isMobile:!0},g.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(Vs,{}),e.jsx(Gs,{}),e.jsx(Ys,{})]})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(Q,{children:e.jsx(V,{className:"pt-4",children:e.jsxs(ps,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(fs,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(X,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(ue,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(k,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(X,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(he,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(k,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(Z,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:o.map(g=>e.jsx(Es,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(Z,{value:"activities",children:n?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(g=>e.jsx(Ss,{subscription:g,getLocalizedField:E,t:s,isMobile:!0},g.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(Q,{children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(me,{className:"text-xs",children:s("profile.commentsDesc")})]}),e.jsx(V,{className:"space-y-3 px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):d&&d.length>0?d.map(g=>e.jsx(_s,{comment:g,getLocalizedField:E,t:s},g.id)):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})})]})})}),y&&e.jsx(He,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(Q,{children:[e.jsxs(ee,{className:"pb-3",children:[e.jsxs(se,{className:"text-lg flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(me,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(V,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:m?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(ue,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const g=c.reduce((b,S)=>{const H=S.activity_id;return b[H]||(b[H]={activity:S.activity,restaurants:[],participationDate:S.created_at}),b[H].restaurants.push({id:S.restaurant_id,name:S.restaurant_name,name_en:S.restaurant_name_en,name_pt:S.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(As,{activityGroup:b,getLocalizedField:E,t:s,isMobile:!0},b.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t z-50",children:e.jsx("div",{className:"flex justify-around items-center py-2 px-2",children:pe.map(g=>{const b=g.icon;return e.jsxs("button",{onClick:()=>q(g.value),className:`flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${A===g.value?"text-primary":"text-muted-foreground"}`,children:[e.jsx(b,{className:`${A===g.value?"w-6 h-6":"w-5 h-5"}`}),e.jsx("span",{className:"text-xs font-medium",children:g.label})]},g.value)})})})]}):e.jsxs(ps,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(fs,{className:`grid w-full ${y?"grid-cols-6":"grid-cols-5"}`,children:[e.jsxs(X,{value:"favorites",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(X,{value:"coupons",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(X,{value:"comments",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),y&&e.jsxs(X,{value:"activities",children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(X,{value:"addresses",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(X,{value:"orders",children:[e.jsx(st,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(Z,{value:"favorites",children:e.jsx(Q,{children:e.jsx(V,{className:"pt-6",children:e.jsxs(ps,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(fs,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(X,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),o&&o.length>0&&e.jsx(k,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:o.length})]}),e.jsxs(X,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),s("profile.activityFavorites"),a&&a.length>0&&e.jsx(k,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:a.length})]})]}),e.jsx(Z,{value:"restaurants",children:x?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):o&&o.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:o.map(g=>e.jsx(Es,{restaurant:g,getLocalizedField:E,t:s},g.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(Z,{value:"activities",children:n?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-4",children:a.map(g=>e.jsx(Ss,{subscription:g,getLocalizedField:E,t:s,isMobile:i},g.activity_id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(Z,{value:"comments",children:e.jsxs(Q,{children:[e.jsxs(ee,{className:i?"pb-3":"",children:[e.jsxs(se,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(De,{className:"w-5 h-5"}),s("profile.myComments")]}),e.jsx(me,{className:i?"text-xs":"",children:s("profile.commentsDesc")})]}),e.jsx(V,{className:`space-y-3 md:space-y-4 ${i?"px-3":""}`,children:r?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):d&&d.length>0?d.map(g=>e.jsx(_s,{comment:g,getLocalizedField:E,t:s},g.id)):e.jsx("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:s("profile.noComments")})})]})}),y&&e.jsx(Z,{value:"activities",children:e.jsxs(Q,{children:[e.jsxs(ee,{className:i?"pb-3":"",children:[e.jsxs(se,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(he,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(me,{className:i?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(V,{className:i?"px-3":"",children:e.jsx("div",{className:i?"space-y-4":"space-y-6",children:m?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):c&&c.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${i?"text-base":"text-lg"}`,children:[e.jsx(ue,{className:i?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:i?"space-y-3":"space-y-4",children:(()=>{const g=c.reduce((b,S)=>{const H=S.activity_id;return b[H]||(b[H]={activity:S.activity,restaurants:[],participationDate:S.created_at}),b[H].restaurants.push({id:S.restaurant_id,name:S.restaurant_name,name_en:S.restaurant_name_en,name_pt:S.restaurant_name_pt}),b},{});return Object.values(g).map(b=>e.jsx(As,{activityGroup:b,getLocalizedField:E,t:s,isMobile:i},b.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(Z,{value:"coupons",children:e.jsxs(Q,{children:[e.jsxs(ee,{className:i?"pb-3":"",children:[e.jsxs(se,{className:`flex items-center gap-2 ${i?"text-lg":""}`,children:[e.jsx(We,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(me,{className:i?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(V,{className:i?"px-3":"",children:p?e.jsx("div",{className:`text-center py-8 ${i?"text-sm":""}`,children:s("common.loading")}):f&&f.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${i?"grid-cols-1":"md:grid-cols-2"}`,children:f.map(g=>e.jsx(Ps,{coupon:g,getLocalizedField:E,t:s,isMobile:i},g.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${i?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(G,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(Z,{value:"addresses",children:e.jsx(Vs,{})}),e.jsx(Z,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(Gs,{}),e.jsx(Ys,{})]})})]})]})})};export{jr as default};
//# sourceMappingURL=Profile-QhGK9d6I.js.map
