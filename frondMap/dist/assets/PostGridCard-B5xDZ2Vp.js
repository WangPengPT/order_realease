import{r as n,p as V,u as B,j as e,bd as G,cZ as H,ak as U,cz as v,bl as Q,cu as W,bc as X,bE as Z,b3 as J,a_ as K,b9 as Y}from"./vendor-react-uzPisSBl.js";import{u as ee,O as se,P as ae,Q as te,R as C,B as i,V as re,W as le,X as ie,A as ne,q as ce,r as oe,t as de,v as me,w as ue,x as xe,y as he}from"./index-DMJMYAbQ.js";import{a as ge,b as fe}from"./useCommunityPosts-ByYZQ9S7.js";import{u as pe}from"./useLocalizedContent-BCXwZ8Rh.js";import{u as je}from"./useLoginRequired-dq5y9iE8.js";import{E as ve,a as be}from"./EditRecipeDialog-Qe6tA6HJ.js";const ye=({post:s,showAssociations:D=!1})=>{const{t}=V(),{user:_}=ee(),m=B(),{getLocalizedField:u}=pe(),{requireLogin:A}=je(),P=ge(),E=fe(),[$,L]=n.useState(!1),[R,x]=n.useState(!1),[b,h]=n.useState(!1),r=s,l=r.post_type==="recipe",y=_?.id===s.author_id,I=a=>{a.preventDefault(),a.stopPropagation(),A()&&P.mutate({postId:s.id,liked:s.user_liked||!1})},S=()=>m(`/community/${s.id}`),T=(a,j)=>{a.preventDefault(),a.stopPropagation(),m(`/restaurant/${j}`)},z=a=>{a.preventDefault(),a.stopPropagation(),s.activity?.id&&m(`/activity/${s.activity.id}`)},M=()=>{E.mutate(s.id),x(!1)},F=a=>a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"),N=u(s,"content"),c=n.useMemo(()=>F(N),[N]),w=s.image_urls&&s.image_urls.length>0,o=!!s.video_url,g=w||o,k=s.image_urls?.length||0,d=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(a=>a.id===s.restaurant?.id)?[s.restaurant]:[]],f=s.activity?u(s.activity,"title"):null,p=2,O=a=>{switch(a){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},q=a=>{switch(a){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return a}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 relative",onClick:S,children:[y&&e.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:a=>a.stopPropagation(),children:e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx(G,{className:"h-4 w-4 text-white"})})}),e.jsxs(te,{align:"end",className:"min-w-[120px]",children:[e.jsxs(C,{onClick:()=>h(!0),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),t("common.edit","编辑")]}),e.jsxs(C,{className:"text-destructive focus:text-destructive",onClick:()=>x(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),t("common.delete","删除")]})]})]})}),g&&e.jsxs("div",{className:`relative ${l?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[w?$?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",loading:"lazy",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>L(!0)}):o?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,l&&e.jsxs(i,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),t("recipe.badge","食谱")]}),o&&!l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!o&&k>1&&!l&&e.jsxs("div",{className:`absolute top-2 ${y?"right-11":"right-2"} bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1`,children:[e.jsx(W,{className:"h-3 w-3"}),e.jsx("span",{children:k})]})]}),!g&&l&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(v,{className:"h-12 w-12 text-primary/40"}),e.jsxs(i,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(v,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs("div",{className:"p-3",children:[l&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[r.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.cook_time,t("recipe.min","分")]})]}),r.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.servings,t("recipe.servingsShort","人")]})]}),r.difficulty&&e.jsx(i,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${O(r.difficulty)}`,children:q(r.difficulty)})]}),D&&(d.length>0||f)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[d.slice(0,p).map(a=>e.jsxs(i,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:j=>T(j,a.id),children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:u(a,"name")})]},a.id)),d.length>p&&e.jsxs(i,{variant:"secondary",className:"text-xs gap-1",children:["+",d.length-p]}),f&&e.jsxs(i,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:z,children:[e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:f})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${g?"":"min-h-[60px]"}`,children:l?r.recipe_name:c}),l&&c&&!c.includes("主要配料：")&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3 leading-relaxed mt-1",children:c}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsxs(re,{className:"h-5 w-5 flex-shrink-0",children:[e.jsx(le,{src:s.author?.avatar_url||void 0}),e.jsx(ie,{className:"text-[10px]",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${s.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:I,children:[e.jsx(Y,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count||0})]})]})]})]}),e.jsx(ne,{open:R,onOpenChange:x,children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:t("community.deleteConfirmTitle","确认删除")}),e.jsx(me,{children:t("community.deleteConfirmDesc","删除后将无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(ue,{children:[e.jsx(xe,{children:t("common.cancel","取消")}),e.jsx(he,{onClick:M,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete","删除")})]})]})}),l?e.jsx(ve,{post:s,open:b,onOpenChange:h}):e.jsx(be,{post:s,open:b,onOpenChange:h})]})},Ae=n.memo(ye);export{Ae as P};
//# sourceMappingURL=PostGridCard-B5xDZ2Vp.js.map
