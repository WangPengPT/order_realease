{"version":3,"file":"AdminJoinRequests-CmAMH1L8.js","sources":["../../src/pages/admin/AdminJoinRequests.tsx"],"sourcesContent":["import { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Textarea } from \"@/components/ui/textarea\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\r\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { Mail, Phone, Store, MapPin, Download, Search, Trash2, Filter, Send, ChevronDown } from \"lucide-react\";\r\nimport { useState, useEffect } from \"react\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\n\r\nconst STATUS_OPTIONS = [\"pending\", \"received\", \"completed\", \"cancelled\"] as const;\r\n\r\nconst AdminJoinRequests = () => {\r\n  const { t } = useTranslation();\r\n  const [search, setSearch] = useState(\"\");\r\n  const [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n  const [deleteId, setDeleteId] = useState<string | null>(null);\r\n  const [emailDialogOpen, setEmailDialogOpen] = useState(false);\r\n  const [selectedRequest, setSelectedRequest] = useState<any>(null);\r\n  const [merchantAccount, setMerchantAccount] = useState(\"\");\r\n  const [merchantPassword, setMerchantPassword] = useState(\"\");\r\n  const [sendingEmail, setSendingEmail] = useState(false);\r\n  const [creatingUser, setCreatingUser] = useState(false);\r\n  const [emailOnlyMode, setEmailOnlyMode] = useState(false);\r\n  const queryClient = useQueryClient();\r\n\r\n  const { data: joinRequests, isLoading } = useQuery({\r\n    queryKey: [\"joinRequests\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"join_requests\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n  });\r\n\r\n  const { data: emailConfig } = useQuery({\r\n    queryKey: [\"emailConfig\", \"join_request\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"email_config\")\r\n        .select(\"*\")\r\n        .eq(\"type\", \"join_request\")\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n  });\r\n\r\n  const { data: siteSettings } = useQuery({\r\n    queryKey: [\"siteSettings\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"site_settings\")\r\n        .select(\"logo_url\")\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n  });\r\n\r\n  // Realtime subscription for join_requests status updates\r\n  useEffect(() => {\r\n    const channel = supabase\r\n      .channel('join_requests_changes')\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'join_requests'\r\n        },\r\n        () => {\r\n          queryClient.invalidateQueries({ queryKey: [\"joinRequests\"] });\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [queryClient]);\r\n\r\n  const filteredRequests = joinRequests?.filter((request) => {\r\n    const searchLower = search.toLowerCase();\r\n    const matchesSearch = \r\n      request.name.toLowerCase().includes(searchLower) ||\r\n      request.email.toLowerCase().includes(searchLower) ||\r\n      request.restaurant_name.toLowerCase().includes(searchLower) ||\r\n      request.phone.toLowerCase().includes(searchLower);\r\n    \r\n    const matchesStatus = statusFilter === \"all\" || request.status === statusFilter;\r\n    \r\n    return matchesSearch && matchesStatus;\r\n  });\r\n\r\n  const handleUpdateEmail = async () => {\r\n    const newEmail = prompt(t(\"joinUs.enterNewEmail\"), emailConfig?.recipient_email);\r\n    if (!newEmail) return;\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from(\"email_config\")\r\n        .update({ recipient_email: newEmail })\r\n        .eq(\"id\", emailConfig?.id);\r\n\r\n      if (error) throw error;\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"joinUs.emailUpdated\"),\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error updating email:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"joinUs.emailUpdateError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const updateStatusMutation = useMutation({\r\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\r\n      const { error } = await supabase\r\n        .from(\"join_requests\")\r\n        .update({ status })\r\n        .eq(\"id\", id);\r\n      \r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"joinRequests\"] });\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"joinUs.statusUpdated\"),\r\n      });\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Error updating status:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"joinUs.statusUpdateError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  const deleteMutation = useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"join_requests\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n      \r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"joinRequests\"] });\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"joinUs.requestDeleted\"),\r\n      });\r\n      setDeleteId(null);\r\n    },\r\n    onError: (error) => {\r\n      console.error(\"Error deleting request:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"joinUs.deleteError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n\r\n  const handleExport = () => {\r\n    if (!filteredRequests || filteredRequests.length === 0) {\r\n      toast({\r\n        title: t(\"admin.noDataToExport\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const csvContent = [\r\n      [\"Name\", \"Email\", \"Phone\", \"Restaurant Name\", \"Restaurant Address\", \"Features\", \"Status\", \"Submitted Date\"],\r\n      ...filteredRequests.map((request) => [\r\n        request.name,\r\n        request.email,\r\n        request.phone,\r\n        request.restaurant_name,\r\n        request.restaurant_address || \"\",\r\n        Array.isArray(request.features_selected) ? request.features_selected.join(\", \") : \"\",\r\n        request.status || \"pending\",\r\n        new Date(request.created_at).toLocaleString(),\r\n      ]),\r\n    ]\r\n      .map((row) => row.map((cell) => `\"${cell}\"`).join(\",\"))\r\n      .join(\"\\n\");\r\n\r\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\r\n    const link = document.createElement(\"a\");\r\n    const url = URL.createObjectURL(blob);\r\n    link.setAttribute(\"href\", url);\r\n    link.setAttribute(\"download\", `join_requests_${new Date().toISOString()}.csv`);\r\n    link.click();\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast({\r\n      title: t(\"admin.exportSuccess\"),\r\n    });\r\n  };\r\n\r\n  const getStatusColor = (status: string) => {\r\n    switch (status) {\r\n      case \"completed\":\r\n        return \"default\";\r\n      case \"received\":\r\n        return \"secondary\";\r\n      case \"cancelled\":\r\n        return \"destructive\";\r\n      default:\r\n        return \"outline\";\r\n    }\r\n  };\r\n\r\n  const openEmailDialog = (request: any) => {\r\n    setSelectedRequest(request);\r\n    setMerchantAccount(request.email);\r\n    setMerchantPassword(\"\");\r\n    setEmailOnlyMode(false);\r\n    setEmailDialogOpen(true);\r\n  };\r\n\r\n  const handleSendEmail = async () => {\r\n    if (!selectedRequest || !merchantAccount.trim() || !merchantPassword.trim()) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"joinUs.accountPasswordRequired\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Validate password length\r\n    if (merchantPassword.length < 6) {\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"auth.passwordTooShort\"),\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Email-only mode: skip user creation\r\n      if (emailOnlyMode) {\r\n        setSendingEmail(true);\r\n        \r\n        const emailSubject = `【小熊市场】您的商家账号信息 - ${selectedRequest.restaurant_name}`;\r\n        const emailContent = `您的商家账号信息如下！`;\r\n\r\n        const { data, error } = await supabase.functions.invoke(\"send-merchant-email\", {\r\n          body: {\r\n            to: selectedRequest.email,\r\n            subject: emailSubject,\r\n            content: emailContent,\r\n            merchantName: selectedRequest.name,\r\n            account: merchantAccount,\r\n            password: merchantPassword,\r\n            logoUrl: siteSettings?.logo_url || null,\r\n          },\r\n        });\r\n\r\n        if (error) throw error;\r\n        if (!data.success) throw new Error(data.error);\r\n\r\n        // Update email_sent_at after email sent successfully\r\n        await supabase\r\n          .from(\"join_requests\")\r\n          .update({ \r\n            email_sent_at: new Date().toISOString()\r\n          })\r\n          .eq(\"id\", selectedRequest.id);\r\n\r\n        queryClient.invalidateQueries({ queryKey: [\"joinRequests\"] });\r\n\r\n        toast({\r\n          title: t(\"common.success\"),\r\n          description: t(\"joinUs.emailSentSuccess\"),\r\n        });\r\n        setEmailDialogOpen(false);\r\n        return;\r\n      }\r\n\r\n      // Create user mode\r\n      setCreatingUser(true);\r\n      \r\n      // Step 1: Create merchant user first\r\n      const { data: sessionData } = await supabase.auth.getSession();\r\n      \r\n      // Verify session exists\r\n      if (!sessionData?.session) {\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"auth.sessionExpired\"),\r\n          variant: \"destructive\",\r\n        });\r\n        setCreatingUser(false);\r\n        return;\r\n      }\r\n\r\n      const { data: createData, error: createError } = await supabase.functions.invoke(\"admin-create-user\", {\r\n        body: {\r\n          email: merchantAccount,\r\n          password: merchantPassword,\r\n          displayName: selectedRequest.name,\r\n          phone: selectedRequest.phone,\r\n          role: \"merchant\",\r\n        },\r\n      });\r\n\r\n      // Check for network/function invocation error\r\n      if (createError) {\r\n        console.error(\"Create user function error:\", createError);\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: createError.message || t(\"admin.createUserError\"),\r\n          variant: \"destructive\",\r\n        });\r\n        setCreatingUser(false);\r\n        return;\r\n      }\r\n\r\n      // Check for business logic error returned from edge function\r\n      if (createData?.error) {\r\n        console.error(\"Create user business error:\", createData.error);\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: createData.error,\r\n          variant: \"destructive\",\r\n        });\r\n        setCreatingUser(false);\r\n        return;\r\n      }\r\n\r\n      // Verify user was actually created\r\n      if (!createData?.success || !createData?.user) {\r\n        console.error(\"User creation failed - no user returned\");\r\n        toast({\r\n          title: t(\"common.error\"),\r\n          description: t(\"admin.createUserError\"),\r\n          variant: \"destructive\",\r\n        });\r\n        setCreatingUser(false);\r\n        return;\r\n      }\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"joinUs.merchantUserCreated\"),\r\n      });\r\n\r\n      setCreatingUser(false);\r\n      setSendingEmail(true);\r\n\r\n      // Step 2: Send email to merchant (only if user creation succeeded)\r\n      const emailSubject = `【小熊市场】您的商家账号已创建 - ${selectedRequest.restaurant_name}`;\r\n      const emailContent = `您的商家账号已创建成功！`;\r\n\r\n      const { data, error } = await supabase.functions.invoke(\"send-merchant-email\", {\r\n        body: {\r\n          to: selectedRequest.email,\r\n          subject: emailSubject,\r\n          content: emailContent,\r\n          merchantName: selectedRequest.name,\r\n          account: merchantAccount,\r\n          password: merchantPassword,\r\n          logoUrl: siteSettings?.logo_url || null,\r\n        },\r\n      });\r\n\r\n      if (error) throw error;\r\n      if (!data.success) throw new Error(data.error);\r\n\r\n      // Update status to \"received\" and record email_sent_at after email sent successfully\r\n      await supabase\r\n        .from(\"join_requests\")\r\n        .update({ \r\n          status: \"received\",\r\n          email_sent_at: new Date().toISOString()\r\n        })\r\n        .eq(\"id\", selectedRequest.id);\r\n\r\n      queryClient.invalidateQueries({ queryKey: [\"joinRequests\"] });\r\n\r\n      toast({\r\n        title: t(\"common.success\"),\r\n        description: t(\"joinUs.emailSentSuccess\"),\r\n      });\r\n      setEmailDialogOpen(false);\r\n    } catch (error: any) {\r\n      console.error(\"Error:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: error.message || t(\"joinUs.emailSendError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setCreatingUser(false);\r\n      setSendingEmail(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"space-y-6\">\r\n        <div>\r\n          <h2 className=\"text-3xl font-bold\">{t(\"joinUs.adminTitle\")}</h2>\r\n          <p className=\"text-muted-foreground mt-2\">{t(\"joinUs.adminDescription\")}</p>\r\n        </div>\r\n\r\n        <div className=\"grid gap-4 md:grid-cols-2\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>{t(\"joinUs.recipientEmail\")}</CardTitle>\r\n              <CardDescription>{t(\"joinUs.recipientEmailDesc\")}</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex items-center gap-4\">\r\n                <Input value={emailConfig?.recipient_email || \"\"} readOnly />\r\n                <Button onClick={handleUpdateEmail}>{t(\"common.edit\")}</Button>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>{t(\"joinUs.totalRequests\")}</CardTitle>\r\n              <CardDescription>{t(\"joinUs.totalRequestsDesc\")}</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"text-3xl font-bold\">{joinRequests?.length || 0}</div>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <CardTitle>{t(\"joinUs.allRequests\")}</CardTitle>\r\n                <CardDescription>{t(\"joinUs.allRequestsDesc\")}</CardDescription>\r\n              </div>\r\n              <Button onClick={handleExport} variant=\"outline\">\r\n                <Download className=\"w-4 h-4 mr-2\" />\r\n                {t(\"admin.exportCSV\")}\r\n              </Button>\r\n            </div>\r\n            <div className=\"flex items-center gap-4 mt-4\">\r\n              <div className=\"relative flex-1\">\r\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder={t(\"joinUs.searchPlaceholder\")}\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  className=\"pl-10\"\r\n                />\r\n              </div>\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"outline\" className=\"gap-2\">\r\n                    <Filter className=\"w-4 h-4\" />\r\n                    {statusFilter === \"all\" \r\n                      ? t(\"admin.allStatus\") \r\n                      : t(`joinUs.status.${statusFilter}`)}\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\" className=\"bg-background\">\r\n                  <DropdownMenuItem onClick={() => setStatusFilter(\"all\")}>\r\n                    {t(\"admin.allStatus\")}\r\n                  </DropdownMenuItem>\r\n                  {STATUS_OPTIONS.map((status) => (\r\n                    <DropdownMenuItem key={status} onClick={() => setStatusFilter(status)}>\r\n                      {t(`joinUs.status.${status}`)}\r\n                    </DropdownMenuItem>\r\n                  ))}\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {isLoading ? (\r\n              <div className=\"text-center py-8 text-muted-foreground\">{t(\"common.loading\")}</div>\r\n            ) : filteredRequests && filteredRequests.length > 0 ? (\r\n              <div className=\"overflow-x-auto\">\r\n                <Table>\r\n                  <TableHeader>\r\n                    <TableRow>\r\n                      <TableHead>{t(\"joinUs.name\")}</TableHead>\r\n                      <TableHead>{t(\"joinUs.contact\")}</TableHead>\r\n                      <TableHead>{t(\"joinUs.restaurant\")}</TableHead>\r\n                      <TableHead>{t(\"joinUs.featuresNeeded\")}</TableHead>\r\n                      <TableHead>{t(\"joinUs.status\")}</TableHead>\r\n                      <TableHead>{t(\"joinUs.submittedAt\")}</TableHead>\r\n                      <TableHead className=\"text-right\">{t(\"common.actions\")}</TableHead>\r\n                    </TableRow>\r\n                  </TableHeader>\r\n                  <TableBody>\r\n                    {filteredRequests.map((request) => (\r\n                      <TableRow key={request.id}>\r\n                        <TableCell className=\"font-medium\">{request.name}</TableCell>\r\n                        <TableCell>\r\n                          <div className=\"space-y-1\">\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <Mail className=\"w-3 h-3 text-muted-foreground\" />\r\n                              <a href={`mailto:${request.email}`} className=\"hover:underline\">\r\n                                {request.email}\r\n                              </a>\r\n                            </div>\r\n                            <div className=\"flex items-center gap-2 text-sm\">\r\n                              <Phone className=\"w-3 h-3 text-muted-foreground\" />\r\n                              <a href={`tel:${request.phone}`} className=\"hover:underline\">\r\n                                {request.phone}\r\n                              </a>\r\n                            </div>\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"space-y-1\">\r\n                            <div className=\"flex items-center gap-2 text-sm font-medium\">\r\n                              <Store className=\"w-3 h-3 text-muted-foreground\" />\r\n                              {request.restaurant_name}\r\n                            </div>\r\n                            {request.restaurant_address && (\r\n                              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                                <MapPin className=\"w-3 h-3\" />\r\n                                {request.restaurant_address}\r\n                              </div>\r\n                            )}\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"flex flex-wrap gap-1\">\r\n                            {Array.isArray(request.features_selected) &&\r\n                              request.features_selected.map((feature, idx) => (\r\n                                <Badge key={idx} variant=\"secondary\">\r\n                                  {t(`joinUs.feature.${feature}`)}\r\n                                </Badge>\r\n                              ))}\r\n                          </div>\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <Select\r\n                            value={request.status || \"pending\"}\r\n                            onValueChange={(value) => updateStatusMutation.mutate({ id: request.id, status: value })}\r\n                            disabled={updateStatusMutation.isPending}\r\n                          >\r\n                            <SelectTrigger className=\"w-[130px]\">\r\n                              <SelectValue>\r\n                                <Badge variant={getStatusColor(request.status || \"pending\")}>\r\n                                  {t(`joinUs.status.${request.status || \"pending\"}`)}\r\n                                </Badge>\r\n                              </SelectValue>\r\n                            </SelectTrigger>\r\n                            <SelectContent>\r\n                              {STATUS_OPTIONS.map((status) => (\r\n                                <SelectItem key={status} value={status}>\r\n                                  <Badge variant={getStatusColor(status)}>\r\n                                    {t(`joinUs.status.${status}`)}\r\n                                  </Badge>\r\n                                </SelectItem>\r\n                              ))}\r\n                            </SelectContent>\r\n                          </Select>\r\n                        </TableCell>\r\n                        <TableCell className=\"text-sm text-muted-foreground\">\r\n                          {formatDistanceToNow(new Date(request.created_at), { addSuffix: true })}\r\n                        </TableCell>\r\n                        <TableCell>\r\n                          <div className=\"flex items-center justify-end gap-2\">\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant=\"outline\"\r\n                              onClick={() => openEmailDialog(request)}\r\n                              title={t(\"joinUs.sendEmail\")}\r\n                            >\r\n                              <Send className=\"w-4 h-4\" />\r\n                            </Button>\r\n                            <Button\r\n                              size=\"sm\"\r\n                              variant=\"destructive\"\r\n                              onClick={() => setDeleteId(request.id)}\r\n                              disabled={deleteMutation.isPending}\r\n                            >\r\n                              <Trash2 className=\"w-4 h-4\" />\r\n                            </Button>\r\n                          </div>\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    ))}\r\n                  </TableBody>\r\n                </Table>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-8 text-muted-foreground\">{t(\"joinUs.noRequests\")}</div>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <AlertDialog open={deleteId !== null} onOpenChange={(open) => !open && setDeleteId(null)}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"joinUs.confirmDelete\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"joinUs.confirmDeleteDescription\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\")}</AlertDialogCancel>\r\n            <AlertDialogAction\r\n              onClick={() => deleteId && deleteMutation.mutate(deleteId)}\r\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\r\n            >\r\n              {t(\"common.delete\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      <Dialog open={emailDialogOpen} onOpenChange={setEmailDialogOpen}>\r\n        <DialogContent className=\"sm:max-w-[500px]\">\r\n          <DialogHeader>\r\n            <DialogTitle>{t(\"joinUs.sendAccountTitle\")}</DialogTitle>\r\n            <DialogDescription>\r\n              {t(\"joinUs.sendAccountDescription\", { name: selectedRequest?.name })}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4 py-4\">\r\n            <div className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\r\n              <div className=\"space-y-0.5\">\r\n                <Label htmlFor=\"emailOnlyMode\" className=\"font-medium\">{t(\"joinUs.emailOnlyMode\")}</Label>\r\n                <p className=\"text-xs text-muted-foreground\">{t(\"joinUs.emailOnlyModeDesc\")}</p>\r\n              </div>\r\n              <Switch\r\n                id=\"emailOnlyMode\"\r\n                checked={emailOnlyMode}\r\n                onCheckedChange={setEmailOnlyMode}\r\n              />\r\n            </div>\r\n            \r\n            {!emailOnlyMode && (\r\n              <div className=\"p-3 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg\">\r\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\r\n                  ℹ️ {t(\"joinUs.createUserModeNote\")}\r\n                </p>\r\n              </div>\r\n            )}\r\n            \r\n            <div className=\"space-y-2\">\r\n              <Label>{t(\"joinUs.emailRecipient\")}</Label>\r\n              <Input value={selectedRequest?.email || \"\"} disabled />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"account\">{t(\"joinUs.merchantAccount\")}</Label>\r\n              <Input\r\n                id=\"account\"\r\n                value={merchantAccount}\r\n                onChange={(e) => setMerchantAccount(e.target.value)}\r\n                placeholder={t(\"joinUs.merchantAccountPlaceholder\")}\r\n              />\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"password\">{t(\"joinUs.merchantPassword\")}</Label>\r\n              <Input\r\n                id=\"password\"\r\n                type=\"text\"\r\n                value={merchantPassword}\r\n                onChange={(e) => setMerchantPassword(e.target.value)}\r\n                placeholder={t(\"joinUs.merchantPasswordPlaceholder\")}\r\n              />\r\n            </div>\r\n            <div className=\"p-3 bg-amber-50 dark:bg-amber-950 border border-amber-200 dark:border-amber-800 rounded-lg\">\r\n              <p className=\"text-sm text-amber-700 dark:text-amber-300\">\r\n                ⚠️ {t(\"joinUs.passwordSecurityNote\")}\r\n              </p>\r\n            </div>\r\n          </div>\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setEmailDialogOpen(false)} disabled={creatingUser || sendingEmail}>\r\n              {t(\"common.cancel\")}\r\n            </Button>\r\n            <Button onClick={handleSendEmail} disabled={creatingUser || sendingEmail}>\r\n              {creatingUser \r\n                ? t(\"joinUs.creatingUser\") \r\n                : sendingEmail \r\n                  ? t(\"common.sending\") \r\n                  : emailOnlyMode \r\n                    ? t(\"joinUs.sendEmailOnly\")\r\n                    : t(\"joinUs.createAndSendEmail\")}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default AdminJoinRequests;\r\n"],"names":["STATUS_OPTIONS","AdminJoinRequests","t","useTranslation","search","setSearch","useState","statusFilter","setStatusFilter","deleteId","setDeleteId","emailDialogOpen","setEmailDialogOpen","selectedRequest","setSelectedRequest","merchantAccount","setMerchantAccount","merchantPassword","setMerchantPassword","sendingEmail","setSendingEmail","creatingUser","setCreatingUser","emailOnlyMode","setEmailOnlyMode","queryClient","useQueryClient","joinRequests","isLoading","useQuery","data","error","supabase","emailConfig","siteSettings","useEffect","channel","filteredRequests","request","searchLower","matchesSearch","matchesStatus","handleUpdateEmail","newEmail","toast","updateStatusMutation","useMutation","id","status","deleteMutation","handleExport","csvContent","row","cell","blob","link","url","getStatusColor","openEmailDialog","handleSendEmail","emailSubject","emailContent","sessionData","createData","createError","jsxs","Fragment","jsx","Card","CardHeader","CardTitle","CardDescription","CardContent","Input","Button","Download","Search","e","DropdownMenu","DropdownMenuTrigger","Filter","DropdownMenuContent","DropdownMenuItem","Table","TableHeader","TableRow","TableHead","TableBody","TableCell","Mail","Phone","Store","MapPin","feature","idx","Badge","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","Send","Trash2","AlertDialog","open","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","Switch","DialogFooter"],"mappings":"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"}