import{j as e}from"./vendor-ui-DAmPMpEA.js";import{u as Qe,r as o,L as qe}from"./vendor-react-iAJ0IrSD.js";import{y as Ke,u as Xe,l as Ye,g as fe,t as xe,T as ge,aT as we,v as pe,az as d,I as p,B as u,aU as J,aV as Q,w as je,aW as es,Q as h,a3 as a}from"./index-CWo17YGZ.js";import{T as ss,a as ts,b as ye,c as ve}from"./tabs-DtiS_8H7.js";import{u as y}from"./index.esm-CVRqJy9l.js";import{o as v,s as c,t as N}from"./types-CpDVS0Ep.js";import{I as Ne,a as be,b}from"./input-otp-C5MFU_OD.js";import{C as rs}from"./checkbox-0BxjGsDk.js";import{u as as}from"./vendor-i18n-DxKeo2S1.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-query-BlSVl3IQ.js";import"./vendor-supabase-KNAP0qdW.js";const vs=()=>{const{signIn:Se,signUp:Pe,signInWithGoogle:os,signInWithPhone:is,verifyOTP:ns,user:q,isBanned:K,isCheckingBanStatus:X}=Ke(),{settings:U}=Xe(),Y=U?.logo_url||Ye,ee=U?.logo_width||35,se=U?.logo_height||35,te=Qe(),[l,i]=o.useState(!1),[Ce,re]=o.useState("login"),[ls,ke]=o.useState("phone");o.useState(""),o.useState("+351");const[Fe,I]=o.useState("info"),[H,Ee]=o.useState(""),[R,ae]=o.useState(null),[f,V]=o.useState(0),[x,oe]=o.useState(null),[W,Te]=o.useState(!1);o.useState(!1),o.useState(!1);const[ie,Le]=o.useState(()=>{try{return localStorage.getItem("rememberMe")==="true"}catch{return!1}}),[ne,le]=o.useState(!1),[E,$]=o.useState("email"),[A,ce]=o.useState(""),[Me,de]=o.useState(""),[_,Ie]=o.useState(!1),[z,Re]=o.useState(!1),[g,G]=o.useState(null),[L,D]=o.useState(!1),[S,B]=o.useState(0),[O,Z]=o.useState(null),{t:s}=as(),Ve=v({email:c().email(s("auth.invalidEmail")),password:c().min(6,s("auth.passwordMin"))}),$e=v({displayName:c().min(2,s("auth.displayNameMin")),email:c().email(s("auth.invalidEmail")),password:c().min(6,s("auth.passwordMin")),confirmPassword:c()}).refine(t=>t.password===t.confirmPassword,{message:s("auth.passwordsDontMatch"),path:["confirmPassword"]}),Ae=v({phone:c().min(6,s("auth.phoneMin"))}),De=v({otp:c().length(6,s("auth.otpLength"))}),Be=v({code:c().length(4,"Verification code must be 4 digits")}),Oe=v({email:c().email(s("auth.invalidEmail"))}),Ue=v({code:c().length(4,"Verification code must be 4 digits")}),He=v({newPassword:c().min(6,s("auth.passwordMin")),confirmNewPassword:c()}).refine(t=>t.newPassword===t.confirmNewPassword,{message:s("auth.passwordsDontMatch"),path:["confirmNewPassword"]}),P=y({resolver:N(Ve)}),n=y({resolver:N($e)});y({resolver:N(Ae)}),y({resolver:N(De)});const C=y({resolver:N(Be)}),M=y({resolver:N(Oe)}),T=y({resolver:N(Ue)}),w=y({resolver:N(He)});o.useEffect(()=>{q&&!K&&!X&&te("/")},[q,te,K,X]),o.useEffect(()=>{let t;return f>0&&(t=setTimeout(()=>V(f-1),1e3)),()=>clearTimeout(t)},[f]),o.useEffect(()=>{let t;return S>0&&(t=setTimeout(()=>B(S-1),1e3),S<=1&&(D(!1),Z(null))),()=>clearTimeout(t)},[S]),o.useEffect(()=>{(async()=>{try{const{data:r,error:m}=await h.functions.invoke("check-login-security",{body:{action:"check"}});!m&&r?.isLimited&&(D(!0),B(r.remainingSeconds))}catch(r){console.error("Failed to check login security:",r)}})()},[]);const me=t=>{let r=0;return t.length>=6&&r++,t.length>=8&&r++,/[a-z]/.test(t)&&r++,/[A-Z]/.test(t)&&r++,/[0-9]/.test(t)&&r++,/[^a-zA-Z0-9]/.test(t)&&r++,r<=2?"weak":r<=4?"medium":"strong"},We=async t=>{if(L){const r=Math.ceil(S/60);a.error(s("auth.tooManyAttempts",{minutes:r}));return}i(!0);try{const{data:r,error:m}=await h.functions.invoke("check-login-security",{body:{action:"check"}});if(!m&&r?.isLimited){D(!0),B(r.remainingSeconds);const k=Math.ceil(r.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:k})),i(!1);return}const{error:j}=await Se(t.email,t.password,ie);if(j){if(j.message==="ACCOUNT_BANNED")return;await h.functions.invoke("check-login-security",{body:{action:"record",email:t.email,success:!1}}).then(({data:k})=>{if(k?.isLimited){D(!0),B(k.remainingSeconds);const F=Math.ceil(k.remainingSeconds/60);a.error(s("auth.tooManyAttempts",{minutes:F}))}else if(k?.attemptCount!==void 0){const F=5-k.attemptCount;Z(F>0?F:0),a.error(s("auth.invalidCredentials")),F>0&&F<=3&&a.warning(s("auth.remainingAttempts",{count:F}))}});return}await h.functions.invoke("check-login-security",{body:{action:"record",email:t.email,success:!0}}),Z(null),a.success(s("auth.signInSuccess"))}catch{a.error(s("auth.invalidCredentials"))}finally{i(!1)}},_e=async t=>{i(!0);try{ae(t),Ee(t.email);const{error:r}=await h.functions.invoke("send-verification-code",{body:{email:t.email}});if(r){a.error(s("auth.verificationCodeFailed")),console.error(r);return}I("verify"),a.success(s("auth.verificationCodeSent")),V(30)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},ze=async t=>{if(R){i(!0);try{const{data:r,error:m}=await h.functions.invoke("verify-email-code",{body:{email:H,code:t.code}});if(m||!r?.success){a.error(r?.error||s("auth.invalidVerificationCode"));return}const{error:j}=await Pe(R.email,R.password,R.displayName);if(j){j.message.includes("already registered")?a.error(s("auth.emailExists")):a.error(j.message);return}a.success(s("auth.signUpSuccess")),re("login"),I("info"),n.reset(),C.reset(),ae(null)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}}},ue=async()=>{if(!(f>0)){i(!0);try{const t=ne?A:H,{error:r}=await h.functions.invoke("send-verification-code",{body:{email:t}});if(r){a.error(s("toast.resendCodeFailed"));return}a.success(s("toast.verificationCodeResent")),V(30)}catch(t){a.error(t.message||"Failed to resend code")}finally{i(!1)}}},Ge=async t=>{i(!0);try{const{data:r,error:m}=await h.functions.invoke("check-email-registered",{body:{email:t.email}});if(m){a.error(s("error.general"));return}if(!r?.registered){a.error(s("auth.emailNotRegistered"));return}const{error:j}=await h.functions.invoke("send-verification-code",{body:{email:t.email}});if(j){a.error(s("auth.verificationCodeFailed"));return}ce(t.email),$("verify"),a.success(s("auth.verificationCodeSent")),V(30)}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},Ze=async t=>{i(!0);try{const{data:r,error:m}=await h.functions.invoke("verify-email-code",{body:{email:A,code:t.code}});if(m||!r?.success){a.error(r?.error||s("auth.invalidVerificationCode"));return}de(t.code),$("newPassword"),a.success(s("auth.codeVerified"))}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},Je=async t=>{i(!0);try{const{data:r,error:m}=await h.functions.invoke("reset-password",{body:{email:A,code:Me,newPassword:t.newPassword}});if(m||!r?.success){a.error(r?.error||s("auth.passwordResetFailed"));return}a.success(s("auth.passwordResetSuccess")),he()}catch(r){a.error(r.message||s("error.general"))}finally{i(!1)}},he=()=>{le(!1),$("email"),ce(""),de(""),M.reset(),T.reset(),w.reset(),G(null)};return ne?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(fe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(xe,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:Y,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(ge,{className:"text-2xl",children:s("auth.forgotPassword")}),e.jsxs(we,{children:[E==="email"&&s("auth.forgotPasswordDescription"),E==="verify"&&s("auth.verifyCodeDescription"),E==="newPassword"&&s("auth.setNewPasswordDescription")]})]}),e.jsxs(pe,{children:[E==="email"&&e.jsxs("form",{onSubmit:M.handleSubmit(Ge),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"forgot-email",children:s("auth.email")}),e.jsx(p,{id:"forgot-email",type:"email",placeholder:"you@example.com",...M.register("email")}),M.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:M.formState.errors.email.message})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.sendingCode":"auth.sendCode")})]}),E==="verify"&&e.jsxs("form",{onSubmit:T.handleSubmit(Ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("auth.verificationCode")}),e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:s("auth.verificationCodeHint",{email:A})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...T.register("code"),onChange:t=>T.setValue("code",t),children:e.jsxs(be,{children:[e.jsx(b,{index:0}),e.jsx(b,{index:1}),e.jsx(b,{index:2}),e.jsx(b,{index:3})]})})}),T.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:T.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"button",variant:"outline",className:"w-full",onClick:()=>$("email"),children:s("common.back")}),e.jsx(u,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.verifying":"auth.verify")})]}),e.jsx(u,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:l||f>0,children:f>0?s("auth.resendIn",{seconds:f}):s("auth.resendCode")})]}),E==="newPassword"&&e.jsxs("form",{onSubmit:w.handleSubmit(Je),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"new-password",children:s("auth.newPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"new-password",type:_?"text":"password",placeholder:s("auth.passwordPlaceholder"),...w.register("newPassword"),onChange:t=>{w.setValue("newPassword",t.target.value),t.target.value?G(me(t.target.value)):G(null)}}),e.jsx("button",{type:"button",onClick:()=>Ie(!_),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:_?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]}),w.formState.errors.newPassword&&e.jsx("p",{className:"text-sm text-destructive",children:w.formState.errors.newPassword.message}),g&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="weak"?"bg-destructive":g==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="medium"||g==="strong"?g==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${g==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${g==="weak"?"text-destructive":g==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${g}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirm-new-password",children:s("auth.confirmNewPassword")}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"confirm-new-password",type:z?"text":"password",placeholder:s("auth.passwordPlaceholder"),...w.register("confirmNewPassword")}),e.jsx("button",{type:"button",onClick:()=>Re(!z),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:z?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]}),w.formState.errors.confirmNewPassword&&e.jsx("p",{className:"text-sm text-destructive",children:w.formState.errors.confirmNewPassword.message})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:l,children:s(l?"common.loading":"auth.resetPassword")})]})]}),e.jsx(je,{children:e.jsxs(u,{variant:"ghost",className:"w-full",onClick:he,children:[e.jsx(es,{className:"h-4 w-4 mr-2"}),s("auth.backToLogin")]})})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-hero p-4",children:e.jsxs(fe,{className:"w-full max-w-md shadow-large",children:[e.jsxs(xe,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:Y,alt:"Logo",style:{width:`${ee}px`,height:`${se}px`},className:"object-contain drop-shadow-md"})}),e.jsx(ge,{className:"text-2xl",children:s("auth.welcome")}),e.jsx(we,{children:s("auth.subtitle")})]}),e.jsx(pe,{children:e.jsxs(ss,{value:Ce,onValueChange:t=>{re(t),ke("phone"),I("info")},className:"w-full",children:[e.jsxs(ts,{className:"grid w-full grid-cols-2",children:[e.jsx(ye,{value:"login",children:s("auth.login")}),e.jsx(ye,{value:"register",children:s("auth.register")})]}),e.jsx(ve,{value:"login",children:e.jsxs("form",{onSubmit:P.handleSubmit(We),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:s("auth.email")}),e.jsx(p,{id:"email",type:"email",placeholder:"you@example.com",...P.register("email")}),P.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:P.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"password",children:s("auth.password")}),e.jsxs("div",{className:"relative",children:[e.jsx(p,{id:"password",type:W?"text":"password",placeholder:"••••••••",...P.register("password")}),e.jsx("button",{type:"button",onClick:()=>Te(!W),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:W?e.jsx(J,{className:"h-4 w-4"}):e.jsx(Q,{className:"h-4 w-4"})})]}),P.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:P.formState.errors.password.message})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{id:"rememberMe",checked:ie,onCheckedChange:t=>{Le(t===!0),localStorage.setItem("rememberMe",String(t===!0))}}),e.jsx(d,{htmlFor:"rememberMe",className:"text-sm font-normal cursor-pointer",children:s("auth.rememberMe")})]}),e.jsx("button",{type:"button",className:"text-sm text-primary hover:underline",onClick:()=>le(!0),children:s("auth.forgotPassword")})]}),L&&e.jsxs("div",{className:"p-3 bg-destructive/10 border border-destructive/20 rounded-md",children:[e.jsx("p",{className:"text-sm text-destructive font-medium",children:s("auth.accountLocked")}),e.jsx("p",{className:"text-xs text-destructive/80 mt-1",children:s("auth.tooManyAttempts",{minutes:Math.ceil(S/60)})})]}),!L&&O!==null&&O<=3&&O>0&&e.jsx("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-md",children:e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:s("auth.remainingAttempts",{count:O})})}),e.jsx(u,{type:"submit",className:"w-full",disabled:l||L,children:l?s("auth.signingIn"):L?`${s("auth.signIn")} (${Math.ceil(S/60)}m)`:s("auth.signIn")})]})}),e.jsx(ve,{value:"register",children:Fe==="info"?e.jsxs("form",{onSubmit:n.handleSubmit(_e),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"display-name",children:s("auth.displayName")}),e.jsx(p,{id:"display-name",placeholder:"John Doe",...n.register("displayName")}),n.formState.errors.displayName&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.displayName.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-email",children:s("auth.email")}),e.jsx(p,{id:"register-email",type:"email",placeholder:"you@example.com",...n.register("email")}),n.formState.errors.email&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"register-password",children:s("auth.password")}),e.jsx(p,{id:"register-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("password"),onChange:t=>{n.setValue("password",t.target.value),t.target.value?oe(me(t.target.value)):oe(null)}}),n.formState.errors.password&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.password.message}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="weak"?"bg-destructive":x==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="medium"||x==="strong"?x==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${x==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${x==="weak"?"text-destructive":x==="medium"?"text-warning":"text-success"}`,children:s(`auth.passwordStrength.${x}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"confirm-password",children:s("auth.confirmPassword")}),e.jsx(p,{id:"confirm-password",type:"password",placeholder:s("auth.passwordPlaceholder"),...n.register("confirmPassword")}),n.formState.errors.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive",children:n.formState.errors.confirmPassword.message})]}),e.jsx(u,{type:"submit",className:"w-full",disabled:l,children:s(l?"auth.sendingCode":"auth.sendCode")})]}):e.jsxs("form",{onSubmit:C.handleSubmit(ze),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"verification-code",children:"Verification Code"}),e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Enter the 4-digit code sent to ",H]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Ne,{maxLength:4,...C.register("code"),onChange:t=>C.setValue("code",t),children:e.jsxs(be,{children:[e.jsx(b,{index:0}),e.jsx(b,{index:1}),e.jsx(b,{index:2}),e.jsx(b,{index:3})]})})}),C.formState.errors.code&&e.jsx("p",{className:"text-sm text-destructive text-center",children:C.formState.errors.code.message})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"button",variant:"outline",className:"w-full",onClick:()=>{I("info"),C.reset()},children:s("common.back")}),e.jsx(u,{type:"submit",className:"w-full",disabled:l,children:l?s("auth.verifying"):"Verify & Register"})]}),e.jsx(u,{type:"button",variant:"ghost",className:"w-full text-sm",onClick:ue,disabled:l||f>0,children:f>0?`Resend Code (${f}s)`:"Resend Code"})]})})]})}),e.jsx(je,{children:e.jsx("p",{className:"text-sm text-muted-foreground text-center w-full",children:e.jsx(qe,{to:"/",className:"text-primary hover:underline",children:s("auth.backToHome")})})})]})})};export{vs as default};
//# sourceMappingURL=Auth-Ddb9dAtZ.js.map
