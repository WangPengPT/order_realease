{"version":3,"file":"useInvitationCodes-Dw_jBvr8.js","sources":["../../src/hooks/useInvitationCodes.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { useEffect } from \"react\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\nexport interface InvitationCode {\r\n  id: string;\r\n  user_id: string;\r\n  code: string;\r\n  status: 'pending' | 'approved' | 'rejected' | 'revoked';\r\n  full_name: string;\r\n  nif: string;\r\n  contact: string;\r\n  address: string;\r\n  rejection_reason: string | null;\r\n  reviewed_by: string | null;\r\n  reviewed_at: string | null;\r\n  usage_count: number;\r\n  created_at: string;\r\n  updated_at: string;\r\n}\r\n\r\n// Hook for user to get their own invitation code with realtime updates\r\nexport const useMyInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  // Subscribe to realtime changes for this user's invitation codes\r\n  useEffect(() => {\r\n    if (!user?.id) return;\r\n\r\n    const channel = supabase\r\n      .channel(`invitation-code-${user.id}`)\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'invitation_codes',\r\n          filter: `user_id=eq.${user.id}`,\r\n        },\r\n        () => {\r\n          // Invalidate the query to trigger a refetch\r\n          queryClient.invalidateQueries({ queryKey: [\"my-invitation-code\", user.id] });\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [user?.id, queryClient]);\r\n\r\n  return useQuery({\r\n    queryKey: [\"my-invitation-code\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id) return null;\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .order(\"created_at\", { ascending: false })\r\n        .limit(1)\r\n        .maybeSingle();\r\n\r\n      if (error) throw error;\r\n      return data as InvitationCode | null;\r\n    },\r\n    enabled: !!user?.id,\r\n  });\r\n};\r\n\r\n// Hook for user to get their invitation code history (all codes including rejected/revoked)\r\nexport const useMyInvitationCodeHistory = () => {\r\n  const { user } = useAuth();\r\n  const queryClient = useQueryClient();\r\n\r\n  // Subscribe to realtime changes for this user's invitation codes\r\n  useEffect(() => {\r\n    if (!user?.id) return;\r\n\r\n    const channel = supabase\r\n      .channel(`invitation-code-history-${user.id}`)\r\n      .on(\r\n        'postgres_changes',\r\n        {\r\n          event: '*',\r\n          schema: 'public',\r\n          table: 'invitation_codes',\r\n          filter: `user_id=eq.${user.id}`,\r\n        },\r\n        () => {\r\n          queryClient.invalidateQueries({ queryKey: [\"my-invitation-code-history\", user.id] });\r\n        }\r\n      )\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [user?.id, queryClient]);\r\n\r\n  return useQuery({\r\n    queryKey: [\"my-invitation-code-history\", user?.id],\r\n    queryFn: async () => {\r\n      if (!user?.id) return [];\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"*\")\r\n        .eq(\"user_id\", user.id)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as InvitationCode[];\r\n    },\r\n    enabled: !!user?.id,\r\n  });\r\n};\r\n\r\n// Hook for user to apply for an invitation code\r\nexport const useApplyInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (data: { full_name: string; nif: string; contact: string; address: string }) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n\r\n      // First generate a unique code\r\n      const { data: codeResult, error: codeError } = await supabase\r\n        .rpc(\"generate_invitation_code\");\r\n\r\n      if (codeError) throw codeError;\r\n\r\n      // Insert the application\r\n      const { data: result, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .insert({\r\n          user_id: user.id,\r\n          code: codeResult,\r\n          full_name: data.full_name,\r\n          nif: data.nif,\r\n          contact: data.contact,\r\n          address: data.address,\r\n          status: \"pending\",\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Sync application info to profiles table\r\n      await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          full_name: data.full_name,\r\n          nif: data.nif,\r\n          contact: data.contact,\r\n          address: data.address,\r\n        })\r\n        .eq(\"id\", user.id);\r\n\r\n      return result;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"my-invitation-code\"] });\r\n      toast({\r\n        title: \"申请已提交\",\r\n        description: \"您的邀请码申请已提交，请等待管理员审核\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"申请失败\",\r\n        description: \"提交申请时发生错误，请稍后重试\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Hook for user to reapply after rejection\r\nexport const useReapplyInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, data }: { id: string; data: { full_name: string; nif: string; contact: string; address: string } }) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n\r\n      const { data: result, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .update({\r\n          full_name: data.full_name,\r\n          nif: data.nif,\r\n          contact: data.contact,\r\n          address: data.address,\r\n          status: \"pending\",\r\n          rejection_reason: null,\r\n          reviewed_by: null,\r\n          reviewed_at: null,\r\n        })\r\n        .eq(\"id\", id)\r\n        .eq(\"user_id\", user.id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n\r\n      // Sync application info to profiles table\r\n      await supabase\r\n        .from(\"profiles\")\r\n        .update({\r\n          full_name: data.full_name,\r\n          nif: data.nif,\r\n          contact: data.contact,\r\n          address: data.address,\r\n        })\r\n        .eq(\"id\", user.id);\r\n\r\n      return result;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"my-invitation-code\"] });\r\n      toast({\r\n        title: \"重新申请已提交\",\r\n        description: \"您的邀请码申请已重新提交，请等待管理员审核\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"申请失败\",\r\n        description: \"提交申请时发生错误，请稍后重试\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Admin hooks\r\n\r\n// Get all invitation codes for admin\r\nexport const useAdminInvitationCodes = () => {\r\n  return useQuery({\r\n    queryKey: [\"admin-invitation-codes\"],\r\n    queryFn: async () => {\r\n      // Step 1: 获取邀请码列表\r\n      const { data: codes, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      if (!codes?.length) return [];\r\n\r\n      // Step 2: 获取相关用户信息\r\n      const userIds = [...new Set(codes.map(c => c.user_id))];\r\n      const { data: profiles } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name, avatar_url\")\r\n        .in(\"id\", userIds);\r\n\r\n      // Step 3: 合并数据\r\n      return codes.map(code => ({\r\n        ...code,\r\n        profiles: profiles?.find(p => p.id === code.user_id) || null\r\n      }));\r\n    },\r\n  });\r\n};\r\n\r\n// Get invitation code stats for admin\r\nexport const useInvitationCodeStats = () => {\r\n  return useQuery({\r\n    queryKey: [\"invitation-code-stats\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"status\");\r\n\r\n      if (error) throw error;\r\n\r\n      const stats = {\r\n        total: data.length,\r\n        pending: data.filter(c => c.status === \"pending\").length,\r\n        approved: data.filter(c => c.status === \"approved\").length,\r\n        rejected: data.filter(c => c.status === \"rejected\").length,\r\n        revoked: data.filter(c => c.status === \"revoked\").length,\r\n      };\r\n\r\n      return stats;\r\n    },\r\n  });\r\n};\r\n\r\n// Get detailed usage stats for a specific invitation code\r\nexport const useInvitationCodeUsageDetails = (code: string | null) => {\r\n  return useQuery({\r\n    queryKey: [\"invitation-code-usage-details\", code],\r\n    queryFn: async () => {\r\n      if (!code) return null;\r\n\r\n      // Get join requests that used this code\r\n      const { data: joinRequests, error: joinError } = await supabase\r\n        .from(\"join_requests\")\r\n        .select(\"id, name, email, restaurant_name, status, created_at\")\r\n        .eq(\"invitation_code\", code)\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (joinError) throw joinError;\r\n\r\n      // Get registered users that used this code\r\n      const { data: invitedUsers, error: usersError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"id, display_name, avatar_url, created_at, invited_at\")\r\n        .eq(\"invitation_code_used\", code)\r\n        .order(\"invited_at\", { ascending: false });\r\n\r\n      if (usersError) throw usersError;\r\n\r\n      // Calculate stats\r\n      const totalUsed = joinRequests?.length || 0;\r\n      const completedJoinRequests = joinRequests?.filter(r => r.status === \"completed\").length || 0;\r\n      const pendingJoinRequests = joinRequests?.filter(r => r.status === \"pending\" || r.status === \"received\").length || 0;\r\n      const registeredUsers = invitedUsers?.length || 0;\r\n\r\n      // Success rate = (completed join requests + registered users) / total used * 100\r\n      const successRate = totalUsed > 0 \r\n        ? Math.round(((completedJoinRequests + registeredUsers) / totalUsed) * 100) \r\n        : 0;\r\n\r\n      return {\r\n        joinRequests: joinRequests || [],\r\n        invitedUsers: invitedUsers || [],\r\n        stats: {\r\n          totalUsed,\r\n          completedJoinRequests,\r\n          pendingJoinRequests,\r\n          registeredUsers,\r\n          successRate,\r\n        },\r\n      };\r\n    },\r\n    enabled: !!code,\r\n  });\r\n};\r\n\r\n// Get overall invitation code performance stats\r\nexport const useInvitationCodePerformanceStats = () => {\r\n  return useQuery({\r\n    queryKey: [\"invitation-code-performance-stats\"],\r\n    queryFn: async () => {\r\n      // Get all approved invitation codes with usage count\r\n      const { data: codes, error: codesError } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"code, usage_count\")\r\n        .eq(\"status\", \"approved\");\r\n\r\n      if (codesError) throw codesError;\r\n\r\n      // Get all join requests with invitation codes\r\n      const { data: joinRequests, error: joinError } = await supabase\r\n        .from(\"join_requests\")\r\n        .select(\"invitation_code, status\")\r\n        .not(\"invitation_code\", \"is\", null);\r\n\r\n      if (joinError) throw joinError;\r\n\r\n      // Get all users with invitation codes\r\n      const { data: invitedUsers, error: usersError } = await supabase\r\n        .from(\"profiles\")\r\n        .select(\"invitation_code_used\")\r\n        .not(\"invitation_code_used\", \"is\", null);\r\n\r\n      if (usersError) throw usersError;\r\n\r\n      const totalCodes = codes?.length || 0;\r\n      const totalUsage = codes?.reduce((sum, c) => sum + (c.usage_count || 0), 0) || 0;\r\n      const activeCodesCount = codes?.filter(c => (c.usage_count || 0) > 0).length || 0;\r\n\r\n      const completedJoinRequests = joinRequests?.filter(r => r.status === \"completed\").length || 0;\r\n      const totalJoinRequestsWithCode = joinRequests?.length || 0;\r\n      const totalRegisteredUsers = invitedUsers?.length || 0;\r\n\r\n      const overallSuccessRate = totalJoinRequestsWithCode > 0\r\n        ? Math.round(((completedJoinRequests + totalRegisteredUsers) / totalJoinRequestsWithCode) * 100)\r\n        : 0;\r\n\r\n      return {\r\n        totalCodes,\r\n        totalUsage,\r\n        activeCodesCount,\r\n        completedJoinRequests,\r\n        totalJoinRequestsWithCode,\r\n        totalRegisteredUsers,\r\n        overallSuccessRate,\r\n      };\r\n    },\r\n  });\r\n};\r\n\r\n// Admin approve invitation code\r\nexport const useApproveInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id: string) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .update({\r\n          status: \"approved\",\r\n          reviewed_by: user.id,\r\n          reviewed_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-invitation-codes\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"invitation-code-stats\"] });\r\n      toast({\r\n        title: \"审核通过\",\r\n        description: \"邀请码申请已通过\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"操作失败\",\r\n        description: \"审核操作失败，请稍后重试\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Admin reject invitation code\r\nexport const useRejectInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .update({\r\n          status: \"rejected\",\r\n          rejection_reason: reason,\r\n          reviewed_by: user.id,\r\n          reviewed_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-invitation-codes\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"invitation-code-stats\"] });\r\n      toast({\r\n        title: \"已拒绝\",\r\n        description: \"邀请码申请已拒绝\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"操作失败\",\r\n        description: \"审核操作失败，请稍后重试\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Admin revoke invitation code\r\nexport const useRevokeInvitationCode = () => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, reason }: { id: string; reason: string }) => {\r\n      if (!user?.id) throw new Error(\"User not authenticated\");\r\n\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .update({\r\n          status: \"revoked\",\r\n          rejection_reason: reason,\r\n          reviewed_by: user.id,\r\n          reviewed_at: new Date().toISOString(),\r\n        })\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"admin-invitation-codes\"] });\r\n      queryClient.invalidateQueries({ queryKey: [\"invitation-code-stats\"] });\r\n      toast({\r\n        title: \"已收回\",\r\n        description: \"邀请码已成功收回\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"操作失败\",\r\n        description: \"收回操作失败，请稍后重试\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\n// Validate invitation code (public)\r\nexport const useValidateInvitationCode = () => {\r\n  return useMutation({\r\n    mutationFn: async (code: string) => {\r\n      const { data, error } = await supabase\r\n        .from(\"invitation_codes\")\r\n        .select(\"id, code, user_id, status\")\r\n        .eq(\"code\", code.toUpperCase())\r\n        .eq(\"status\", \"approved\")\r\n        .maybeSingle();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n  });\r\n};\r\n\r\n// Increment invitation code usage\r\nexport const useIncrementInvitationCodeUsage = () => {\r\n  return useMutation({\r\n    mutationFn: async (code: string) => {\r\n      const { error } = await supabase\r\n        .rpc(\"increment_invitation_code_usage\", { code_text: code.toUpperCase() });\r\n\r\n      if (error) throw error;\r\n    },\r\n  });\r\n};\r\n"],"names":["useMyInvitationCode","user","useAuth","queryClient","useQueryClient","useEffect","channel","supabase","useQuery","data","error","useMyInvitationCodeHistory","useApplyInvitationCode","toast","useToast","useMutation","codeResult","codeError","result","useReapplyInvitationCode","id","useAdminInvitationCodes","codes","userIds","c","profiles","code","p","useInvitationCodeStats","useInvitationCodeUsageDetails","joinRequests","joinError","invitedUsers","usersError","totalUsed","completedJoinRequests","r","pendingJoinRequests","registeredUsers","successRate","useInvitationCodePerformanceStats","codesError","totalCodes","totalUsage","sum","activeCodesCount","totalJoinRequestsWithCode","totalRegisteredUsers","overallSuccessRate","useApproveInvitationCode","useRejectInvitationCode","reason","useRevokeInvitationCode","useValidateInvitationCode"],"mappings":"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"}