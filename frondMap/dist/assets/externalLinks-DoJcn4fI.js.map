{"version":3,"file":"externalLinks-DoJcn4fI.js","sources":["../../src/assets/map-icon.png","../../src/lib/externalLinks.ts"],"sourcesContent":["export default \"__VITE_ASSET__B_FllPTf__\"","// Detect if running in a Capacitor native app\r\nexport const isCapacitorApp = (): boolean => {\r\n  const cap = (window as any).Capacitor;\r\n  if (!cap) return false;\r\n  \r\n  // Check method form (Capacitor 3+)\r\n  if (typeof cap.isNativePlatform === 'function') {\r\n    return cap.isNativePlatform();\r\n  }\r\n  \r\n  // Check property form (some versions)\r\n  if (typeof cap.isNativePlatform === 'boolean') {\r\n    return cap.isNativePlatform;\r\n  }\r\n  \r\n  // Check isNative property (legacy compatibility)\r\n  if (typeof cap.isNative === 'boolean') {\r\n    return cap.isNative;\r\n  }\r\n  \r\n  // Check platform property\r\n  if (cap.getPlatform && typeof cap.getPlatform === 'function') {\r\n    const platform = cap.getPlatform();\r\n    return platform === 'ios' || platform === 'android';\r\n  }\r\n  \r\n  // If Capacitor object exists but no detection methods, assume it's native\r\n  return true;\r\n};\r\n\r\n// Detect if running in iOS WebView (WKWebView)\r\nexport const isIOSWebView = (): boolean => {\r\n  // If it's a Capacitor app, don't treat as generic WebView\r\n  if (isCapacitorApp()) return false;\r\n  \r\n  const ua = navigator.userAgent;\r\n  const isIOS = /iPad|iPhone|iPod/.test(ua);\r\n  \r\n  if (!isIOS) return false;\r\n  \r\n  // PWA standalone mode is not WebView\r\n  const isStandalone = (window.navigator as any).standalone === true;\r\n  if (isStandalone) return false;\r\n  \r\n  // Check for common in-app browsers (WeChat, QQ, Facebook, Instagram, etc.)\r\n  const isInAppBrowser = /FBAN|FBAV|Twitter|Instagram|Line|WeChat|MicroMessenger|QQ|Weibo|Douyin|TikTok|Alipay|DingTalk|Xiaohongshu/i.test(ua);\r\n  if (isInAppBrowser) return true;\r\n  \r\n  // WKWebView detection - check for missing Safari identifier\r\n  const hasSafari = /Safari\\//.test(ua);\r\n  const hasChrome = /CriOS/.test(ua);\r\n  const hasFirefox = /FxiOS/.test(ua);\r\n  const hasEdge = /EdgiOS/.test(ua);\r\n  \r\n  // If iOS but no browser identifier, it's likely a WebView\r\n  if (!hasSafari && !hasChrome && !hasFirefox && !hasEdge) return true;\r\n  \r\n  // Some WebViews include Safari but lack Version/ (Safari has \"Version/X.X\")\r\n  const hasVersion = /Version\\/[\\d.]+/.test(ua);\r\n  if (hasSafari && !hasVersion && !hasChrome && !hasFirefox && !hasEdge) return true;\r\n  \r\n  return false;\r\n};\r\n\r\n// Check if the device is iOS (Safari or any iOS browser)\r\nexport const isIOSDevice = (): boolean => {\r\n  const ua = navigator.userAgent;\r\n  return /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);\r\n};\r\n\r\n// Check if running in iOS Safari (not WebView)\r\nexport const isIOSSafari = (): boolean => {\r\n  if (!isIOSDevice()) return false;\r\n  if (isIOSWebView()) return false;\r\n  if (isCapacitorApp()) return false;\r\n  \r\n  const ua = navigator.userAgent;\r\n  // Safari has both \"Safari/\" and \"Version/\" in UA\r\n  return /Safari\\//.test(ua) && /Version\\/[\\d.]+/.test(ua);\r\n};\r\n\r\n// Detect if running in Android WebView\r\nexport const isAndroidWebView = (): boolean => {\r\n  const ua = navigator.userAgent;\r\n  const isAndroid = /Android/.test(ua);\r\n  // Android WebView typically has \"wv\" in the UA string\r\n  const isWebView = /wv/.test(ua) || /Version\\/[\\d.]+.*Chrome/.test(ua);\r\n  \r\n  return isAndroid && isWebView;\r\n};\r\n\r\n// Check if in any WebView\r\nexport const isInWebView = (): boolean => {\r\n  return isIOSWebView() || isAndroidWebView();\r\n};\r\n\r\n// Try to open URL with fallback for WebView environments\r\nexport const openExternalUrl = (url: string, options?: {\r\n  fallbackUrl?: string;\r\n  useSameWindow?: boolean;\r\n}): void => {\r\n  const { fallbackUrl, useSameWindow = false } = options || {};\r\n  \r\n  if (isIOSWebView()) {\r\n    // In iOS WebView, window.open is often blocked\r\n    // Use location.href for same-window navigation\r\n    if (useSameWindow) {\r\n      window.location.href = url;\r\n      return;\r\n    }\r\n    \r\n    // Try to open in new window first\r\n    const newWindow = window.open(url, '_blank');\r\n    \r\n    // If blocked, fall back to location.href or iframe trick\r\n    if (!newWindow || newWindow.closed) {\r\n      if (fallbackUrl) {\r\n        window.location.href = fallbackUrl;\r\n      } else {\r\n        // Use location.href as last resort\r\n        window.location.href = url;\r\n      }\r\n    }\r\n  } else {\r\n    // Standard browser behavior\r\n    window.open(url, '_blank');\r\n  }\r\n};\r\n\r\n// Open URL scheme (maps://, tel://, mailto://, etc.) with WebView compatibility\r\nexport const openUrlScheme = (\r\n  schemeUrl: string, \r\n  universalLinkFallback?: string\r\n): void => {\r\n  if (isIOSWebView()) {\r\n    // In iOS WebView, URL schemes need special handling\r\n    const start = Date.now();\r\n    const timeout = 1500;\r\n    let didNavigate = false;\r\n    \r\n    const handleVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        didNavigate = true;\r\n      }\r\n    };\r\n    \r\n    document.addEventListener('visibilitychange', handleVisibilityChange);\r\n    \r\n    // Try to open the scheme URL\r\n    window.location.href = schemeUrl;\r\n    \r\n    // Check after timeout if navigation happened\r\n    setTimeout(() => {\r\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n      \r\n      if (!didNavigate && universalLinkFallback && Date.now() - start >= timeout) {\r\n        // Scheme didn't work, try universal link\r\n        window.location.href = universalLinkFallback;\r\n      }\r\n    }, timeout);\r\n  } else if (isAndroidWebView()) {\r\n    // Android WebView - try intent URL or direct navigation\r\n    window.location.href = schemeUrl;\r\n  } else {\r\n    // Standard browser - can use window.open\r\n    window.open(schemeUrl, '_blank');\r\n  }\r\n};\r\n"],"names":["mapIcon","isCapacitorApp","cap","platform","isIOSWebView","ua","hasSafari","hasChrome","hasFirefox","hasEdge","hasVersion","isIOSDevice","isAndroidWebView","isAndroid","isWebView","isInWebView"],"mappings":"AAAA,MAAeA,EAAA,gCCCFC,EAAiB,IAAe,CAC3C,MAAMC,EAAO,OAAe,UACxB,GAAA,CAACA,EAAY,MAAA,GAGb,GAAA,OAAOA,EAAI,kBAAqB,WAClC,OAAOA,EAAI,mBAIT,GAAA,OAAOA,EAAI,kBAAqB,UAClC,OAAOA,EAAI,iBAIT,GAAA,OAAOA,EAAI,UAAa,UAC1B,OAAOA,EAAI,SAIb,GAAIA,EAAI,aAAe,OAAOA,EAAI,aAAgB,WAAY,CACtD,MAAAC,EAAWD,EAAI,cACd,OAAAC,IAAa,OAASA,IAAa,SAC5C,CAGO,MAAA,EACT,EAGaC,EAAe,IAAe,CAErC,GAAAH,EAAA,EAAyB,MAAA,GAE7B,MAAMI,EAAK,UAAU,UAOrB,GAJI,CAFU,mBAAmB,KAAKA,CAAE,GAKlB,OAAO,UAAkB,aAAe,GACrC,MAAA,GAIzB,GADuB,6GAA6G,KAAKA,CAAE,EAChH,MAAA,GAGrB,MAAAC,EAAY,WAAW,KAAKD,CAAE,EAC9BE,EAAY,QAAQ,KAAKF,CAAE,EAC3BG,EAAa,QAAQ,KAAKH,CAAE,EAC5BI,EAAU,SAAS,KAAKJ,CAAE,EAG5B,GAAA,CAACC,GAAa,CAACC,GAAa,CAACC,GAAc,CAACC,EAAgB,MAAA,GAG1D,MAAAC,EAAa,kBAAkB,KAAKL,CAAE,EACxC,MAAA,GAAAC,GAAa,CAACI,GAAc,CAACH,GAAa,CAACC,GAAc,CAACC,EAGhE,EAGaE,EAAc,IAAe,CACxC,MAAMN,EAAK,UAAU,UACd,MAAA,mBAAmB,KAAKA,CAAE,GAAM,UAAU,WAAa,YAAc,UAAU,eAAiB,CACzG,EAcaO,EAAmB,IAAe,CAC7C,MAAMP,EAAK,UAAU,UACfQ,EAAY,UAAU,KAAKR,CAAE,EAE7BS,EAAY,KAAK,KAAKT,CAAE,GAAK,0BAA0B,KAAKA,CAAE,EAEpE,OAAOQ,GAAaC,CACtB,EAGaC,EAAc,IAClBX,EAAA,GAAkBQ"}