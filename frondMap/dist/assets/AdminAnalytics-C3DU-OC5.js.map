{"version":3,"file":"AdminAnalytics-C3DU-OC5.js","sources":["../../src/hooks/useAnalytics.ts","../../src/hooks/useOnlineUsers.ts","../../src/components/admin/OnlineUsersDialog.tsx","../../src/pages/admin/AdminAnalytics.tsx"],"sourcesContent":["import { useQuery } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { startOfDay, subDays, format } from \"date-fns\";\r\n\r\ninterface RefererStats {\r\n  domain: string;\r\n  count: number;\r\n  percentage: number;\r\n}\r\n\r\ninterface LocationStats {\r\n  location: string;\r\n  count: number;\r\n  percentage: number;\r\n}\r\n\r\ninterface LocationDailyView {\r\n  date: string;\r\n  location: string;\r\n  views: number;\r\n}\r\n\r\ninterface PageViewStats {\r\n  totalViews: number;\r\n  uniqueVisitors: number;\r\n  viewsByPage: Record<string, number>;\r\n  dailyViews: Array<{ date: string; views: number; uniqueVisitors: number }>;\r\n  topRestaurants: Array<{ id: string; name: string; views: number }>;\r\n  topActivities: Array<{ id: string; title: string; views: number }>;\r\n  refererStats: RefererStats[];\r\n  countryStats: LocationStats[];\r\n  cityStats: LocationStats[];\r\n  countryDailyViews: LocationDailyView[];\r\n  cityDailyViews: LocationDailyView[];\r\n}\r\n\r\n// Parse referer URL to get domain\r\nconst getRefererDomain = (referer: string | null): string => {\r\n  if (!referer) return \"direct\";\r\n  try {\r\n    const url = new URL(referer);\r\n    return url.hostname.replace(\"www.\", \"\");\r\n  } catch {\r\n    return \"unknown\";\r\n  }\r\n};\r\n\r\nexport const useAnalytics = (days: number = 30) => {\r\n  return useQuery({\r\n    queryKey: [\"analytics\", days],\r\n    queryFn: async (): Promise<PageViewStats> => {\r\n      // Calculate date filter\r\n      let dateFilter: string | null = null;\r\n      if (days === 1) {\r\n        dateFilter = startOfDay(new Date()).toISOString();\r\n      } else if (days > 1) {\r\n        dateFilter = startOfDay(subDays(new Date(), days - 1)).toISOString();\r\n      }\r\n\r\n      // Fetch all data using pagination to overcome 1000 row limit\r\n      const PAGE_SIZE = 1000;\r\n      let allViews: any[] = [];\r\n      let page = 0;\r\n      let hasMore = true;\r\n\r\n      while (hasMore) {\r\n        let query = supabase\r\n          .from(\"page_views\")\r\n          .select(\"*\")\r\n          .order(\"created_at\", { ascending: false })\r\n          .range(page * PAGE_SIZE, (page + 1) * PAGE_SIZE - 1);\r\n\r\n        if (dateFilter) {\r\n          query = query.gte(\"created_at\", dateFilter);\r\n        }\r\n\r\n        const { data: pageViews, error } = await query;\r\n\r\n        if (error) throw error;\r\n\r\n        if (pageViews && pageViews.length > 0) {\r\n          allViews = allViews.concat(pageViews);\r\n          hasMore = pageViews.length === PAGE_SIZE;\r\n          page++;\r\n        } else {\r\n          hasMore = false;\r\n        }\r\n      }\r\n\r\n      const views = allViews;\r\n\r\n      // Calculate total views\r\n      const totalViews = views.length;\r\n\r\n      // Calculate unique visitors\r\n      const uniqueVisitorIds = new Set(views.map(v => v.visitor_id));\r\n      const uniqueVisitors = uniqueVisitorIds.size;\r\n\r\n      // Views by page type\r\n      const viewsByPage: Record<string, number> = {};\r\n      views.forEach(v => {\r\n        viewsByPage[v.page_type] = (viewsByPage[v.page_type] || 0) + 1;\r\n      });\r\n\r\n      // Daily views\r\n      const dailyMap = new Map<string, { views: number; visitors: Set<string> }>();\r\n      views.forEach(v => {\r\n        const date = format(new Date(v.created_at), \"yyyy-MM-dd\");\r\n        if (!dailyMap.has(date)) {\r\n          dailyMap.set(date, { views: 0, visitors: new Set() });\r\n        }\r\n        const day = dailyMap.get(date)!;\r\n        day.views++;\r\n        day.visitors.add(v.visitor_id);\r\n      });\r\n\r\n      const dailyViews = Array.from(dailyMap.entries())\r\n        .map(([date, data]) => ({\r\n          date,\r\n          views: data.views,\r\n          uniqueVisitors: data.visitors.size,\r\n        }))\r\n        .sort((a, b) => a.date.localeCompare(b.date));\r\n\r\n      // Referer statistics\r\n      const refererMap = new Map<string, number>();\r\n      views.forEach(v => {\r\n        const domain = getRefererDomain(v.referer);\r\n        refererMap.set(domain, (refererMap.get(domain) || 0) + 1);\r\n      });\r\n\r\n      const refererStats: RefererStats[] = Array.from(refererMap.entries())\r\n        .map(([domain, count]) => ({\r\n          domain,\r\n          count,\r\n          percentage: totalViews > 0 ? (count / totalViews) * 100 : 0,\r\n        }))\r\n        .sort((a, b) => b.count - a.count);\r\n\r\n      // Country statistics\r\n      const countryMap = new Map<string, number>();\r\n      views.forEach(v => {\r\n        const country = (v as any).country || \"unknown\";\r\n        countryMap.set(country, (countryMap.get(country) || 0) + 1);\r\n      });\r\n\r\n      const countryStats: LocationStats[] = Array.from(countryMap.entries())\r\n        .map(([location, count]) => ({\r\n          location,\r\n          count,\r\n          percentage: totalViews > 0 ? (count / totalViews) * 100 : 0,\r\n        }))\r\n        .sort((a, b) => b.count - a.count);\r\n\r\n      // City statistics\r\n      const cityMap = new Map<string, number>();\r\n      views.forEach(v => {\r\n        const city = (v as any).city || \"unknown\";\r\n        cityMap.set(city, (cityMap.get(city) || 0) + 1);\r\n      });\r\n\r\n      const cityStats: LocationStats[] = Array.from(cityMap.entries())\r\n        .map(([location, count]) => ({\r\n          location,\r\n          count,\r\n          percentage: totalViews > 0 ? (count / totalViews) * 100 : 0,\r\n        }))\r\n        .sort((a, b) => b.count - a.count);\r\n\r\n      // Country daily views (for trend analysis)\r\n      const countryDailyMap = new Map<string, Map<string, number>>();\r\n      views.forEach(v => {\r\n        const date = format(new Date(v.created_at), \"yyyy-MM-dd\");\r\n        const country = (v as any).country || \"unknown\";\r\n        if (!countryDailyMap.has(country)) {\r\n          countryDailyMap.set(country, new Map());\r\n        }\r\n        const dateMap = countryDailyMap.get(country)!;\r\n        dateMap.set(date, (dateMap.get(date) || 0) + 1);\r\n      });\r\n\r\n      const countryDailyViews: LocationDailyView[] = [];\r\n      countryDailyMap.forEach((dateMap, location) => {\r\n        dateMap.forEach((views, date) => {\r\n          countryDailyViews.push({ date, location, views });\r\n        });\r\n      });\r\n      countryDailyViews.sort((a, b) => a.date.localeCompare(b.date));\r\n\r\n      // City daily views (for trend analysis)\r\n      const cityDailyMap = new Map<string, Map<string, number>>();\r\n      views.forEach(v => {\r\n        const date = format(new Date(v.created_at), \"yyyy-MM-dd\");\r\n        const city = (v as any).city || \"unknown\";\r\n        if (!cityDailyMap.has(city)) {\r\n          cityDailyMap.set(city, new Map());\r\n        }\r\n        const dateMap = cityDailyMap.get(city)!;\r\n        dateMap.set(date, (dateMap.get(date) || 0) + 1);\r\n      });\r\n\r\n      const cityDailyViews: LocationDailyView[] = [];\r\n      cityDailyMap.forEach((dateMap, location) => {\r\n        dateMap.forEach((views, date) => {\r\n          cityDailyViews.push({ date, location, views });\r\n        });\r\n      });\r\n      cityDailyViews.sort((a, b) => a.date.localeCompare(b.date));\r\n\r\n      // Top restaurants\r\n      const restaurantViews = new Map<string, number>();\r\n      views\r\n        .filter(v => v.page_type === \"restaurant\" && v.target_id)\r\n        .forEach(v => {\r\n          restaurantViews.set(v.target_id!, (restaurantViews.get(v.target_id!) || 0) + 1);\r\n        });\r\n\r\n      const topRestaurantIds = Array.from(restaurantViews.entries())\r\n        .sort((a, b) => b[1] - a[1])\r\n        .slice(0, 10);\r\n\r\n      // Fetch restaurant names\r\n      let topRestaurants: Array<{ id: string; name: string; views: number }> = [];\r\n      if (topRestaurantIds.length > 0) {\r\n        const { data: restaurants } = await supabase\r\n          .from(\"restaurants\")\r\n          .select(\"id, name\")\r\n          .in(\"id\", topRestaurantIds.map(r => r[0]));\r\n\r\n        topRestaurants = topRestaurantIds.map(([id, views]) => ({\r\n          id,\r\n          name: restaurants?.find(r => r.id === id)?.name || \"Unknown\",\r\n          views,\r\n        }));\r\n      }\r\n\r\n      // Top activities\r\n      const activityViews = new Map<string, number>();\r\n      views\r\n        .filter(v => v.page_type === \"activity\" && v.target_id)\r\n        .forEach(v => {\r\n          activityViews.set(v.target_id!, (activityViews.get(v.target_id!) || 0) + 1);\r\n        });\r\n\r\n      const topActivityIds = Array.from(activityViews.entries())\r\n        .sort((a, b) => b[1] - a[1])\r\n        .slice(0, 10);\r\n\r\n      // Fetch activity titles\r\n      let topActivities: Array<{ id: string; title: string; views: number }> = [];\r\n      if (topActivityIds.length > 0) {\r\n        const { data: activities } = await supabase\r\n          .from(\"activities\")\r\n          .select(\"id, title_zh, title_en, title_pt\")\r\n          .in(\"id\", topActivityIds.map(a => a[0]));\r\n\r\n        topActivities = topActivityIds.map(([id, views]) => {\r\n          const activity = activities?.find(a => a.id === id);\r\n          return {\r\n            id,\r\n            title: activity?.title_zh || activity?.title_en || \"Unknown\",\r\n            views,\r\n          };\r\n        });\r\n      }\r\n\r\n      return {\r\n        totalViews,\r\n        uniqueVisitors,\r\n        viewsByPage,\r\n        dailyViews,\r\n        topRestaurants,\r\n        topActivities,\r\n        refererStats,\r\n        countryStats,\r\n        cityStats,\r\n        countryDailyViews,\r\n        cityDailyViews,\r\n      };\r\n    },\r\n  });\r\n};\r\n\r\nexport default useAnalytics;\r\n","import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useQuery } from '@tanstack/react-query';\r\nimport { RealtimeChannel } from '@supabase/supabase-js';\r\n\r\ninterface OnlineUser {\r\n  user_id: string;\r\n  is_online: boolean;\r\n  last_seen: string;\r\n  ip_address?: string | null;\r\n  city?: string | null;\r\n  country?: string | null;\r\n  profile?: {\r\n    display_name: string;\r\n    avatar_url: string | null;\r\n  };\r\n  role?: string;\r\n}\r\n\r\ninterface PresenceState {\r\n  [key: string]: { user_id: string; online_at: string }[];\r\n}\r\n\r\nexport const useOnlineUsers = () => {\r\n  const [realtimeOnlineIds, setRealtimeOnlineIds] = useState<Set<string>>(new Set());\r\n  const [channel, setChannel] = useState<RealtimeChannel | null>(null);\r\n\r\n  // Subscribe to presence channel to get real-time online status\r\n  useEffect(() => {\r\n    console.log('Initializing online users observer...');\r\n    \r\n    const presenceChannel = supabase.channel('online-users');\r\n\r\n    presenceChannel\r\n      .on('presence', { event: 'sync' }, () => {\r\n        const state = presenceChannel.presenceState() as PresenceState;\r\n        const onlineIds = new Set<string>();\r\n        \r\n        Object.keys(state).forEach(key => {\r\n          // Each key is a user_id, collect all online users\r\n          onlineIds.add(key);\r\n        });\r\n        \r\n        setRealtimeOnlineIds(onlineIds);\r\n        console.log('Presence sync - online users:', Array.from(onlineIds));\r\n      })\r\n      .on('presence', { event: 'join' }, ({ key, newPresences }) => {\r\n        console.log('User joined:', key, newPresences);\r\n        setRealtimeOnlineIds(prev => new Set([...prev, key]));\r\n      })\r\n      .on('presence', { event: 'leave' }, ({ key, leftPresences }) => {\r\n        console.log('User left:', key, leftPresences);\r\n        setRealtimeOnlineIds(prev => {\r\n          const next = new Set(prev);\r\n          next.delete(key);\r\n          return next;\r\n        });\r\n      })\r\n      .subscribe((status) => {\r\n        console.log('Presence channel status:', status);\r\n      });\r\n\r\n    setChannel(presenceChannel);\r\n\r\n    return () => {\r\n      console.log('Cleaning up online users observer...');\r\n      supabase.removeChannel(presenceChannel);\r\n    };\r\n  }, []);\r\n\r\n  // Fetch user details from database (profiles, roles, location info)\r\n  const { data: userDetails, isLoading, refetch: refetchDetails } = useQuery({\r\n    queryKey: ['online-users-details', Array.from(realtimeOnlineIds).sort().join(',')],\r\n    queryFn: async () => {\r\n      if (realtimeOnlineIds.size === 0) {\r\n        return [];\r\n      }\r\n\r\n      const userIds = Array.from(realtimeOnlineIds);\r\n      console.log('Fetching details for online users:', userIds);\r\n      \r\n      // Get presence data for location info\r\n      const { data: presenceData, error: presenceError } = await supabase\r\n        .from('user_presence')\r\n        .select('*')\r\n        .in('user_id', userIds);\r\n\r\n      if (presenceError) {\r\n        console.error('Error fetching presence:', presenceError);\r\n      }\r\n\r\n      // Get user profiles\r\n      const { data: profiles, error: profilesError } = await supabase\r\n        .rpc('get_public_profiles', { user_ids: userIds });\r\n\r\n      if (profilesError) {\r\n        console.error('Error fetching profiles:', profilesError);\r\n      }\r\n\r\n      // Get user roles\r\n      const { data: roles, error: rolesError } = await supabase\r\n        .from('user_roles')\r\n        .select('user_id, role')\r\n        .in('user_id', userIds);\r\n\r\n      if (rolesError) {\r\n        console.error('Error fetching roles:', rolesError);\r\n      }\r\n\r\n      const presenceMap = new Map((presenceData || []).map(p => [p.user_id, p]));\r\n      const profileMap = new Map((profiles || []).map(p => [p.id, p]));\r\n      const roleMap = new Map((roles || []).map(r => [r.user_id, r.role]));\r\n\r\n      return userIds.map(userId => {\r\n        const presence = presenceMap.get(userId);\r\n        const profile = profileMap.get(userId);\r\n        \r\n        return {\r\n          user_id: userId,\r\n          is_online: true, // All users in realtimeOnlineIds are online via WebSocket\r\n          last_seen: presence?.last_seen || new Date().toISOString(),\r\n          ip_address: presence?.ip_address,\r\n          city: presence?.city,\r\n          country: presence?.country,\r\n          profile: profile ? {\r\n            display_name: profile.display_name,\r\n            avatar_url: profile.avatar_url\r\n          } : undefined,\r\n          role: roleMap.get(userId)\r\n        };\r\n      });\r\n    },\r\n    enabled: realtimeOnlineIds.size > 0,\r\n    staleTime: 10000, // Cache for 10 seconds\r\n  });\r\n\r\n  // Fallback: Also check database for recently active users (in case WebSocket missed them)\r\n  // IMPORTANT: Only use last_seen time, NOT is_online flag (unreliable due to beforeunload issues)\r\n  const { data: dbOnlineUsers, refetch: refetchFallback } = useQuery({\r\n    queryKey: ['online-users-db-fallback'],\r\n    queryFn: async () => {\r\n      const twoMinutesAgo = new Date(Date.now() - 2 * 60 * 1000).toISOString();\r\n      \r\n      // Only check last_seen time - is_online is unreliable\r\n      const { data: presenceData, error } = await supabase\r\n        .from('user_presence')\r\n        .select('*')\r\n        .gte('last_seen', twoMinutesAgo)\r\n        .order('last_seen', { ascending: false });\r\n\r\n      if (error) {\r\n        console.error('Error fetching DB presence:', error);\r\n        return [];\r\n      }\r\n\r\n      if (!presenceData || presenceData.length === 0) {\r\n        return [];\r\n      }\r\n\r\n      const userIds = presenceData.map(p => p.user_id);\r\n      \r\n      const { data: profiles } = await supabase\r\n        .rpc('get_public_profiles', { user_ids: userIds });\r\n\r\n      const { data: roles } = await supabase\r\n        .from('user_roles')\r\n        .select('user_id, role')\r\n        .in('user_id', userIds);\r\n\r\n      const profileMap = new Map((profiles || []).map(p => [p.id, p]));\r\n      const roleMap = new Map((roles || []).map(r => [r.user_id, r.role]));\r\n\r\n      return presenceData.map(presence => ({\r\n        user_id: presence.user_id,\r\n        is_online: presence.is_online,\r\n        last_seen: presence.last_seen,\r\n        ip_address: presence.ip_address,\r\n        city: presence.city,\r\n        country: presence.country,\r\n        profile: profileMap.get(presence.user_id) ? {\r\n          display_name: profileMap.get(presence.user_id)!.display_name,\r\n          avatar_url: profileMap.get(presence.user_id)!.avatar_url\r\n        } : undefined,\r\n        role: roleMap.get(presence.user_id)\r\n      }));\r\n    },\r\n    refetchInterval: 30000, // Fallback refresh every 30 seconds\r\n  });\r\n\r\n  // Merge realtime and DB users, preferring realtime data\r\n  const mergedUsers = (() => {\r\n    const userMap = new Map<string, OnlineUser>();\r\n    \r\n    // Add DB fallback users first\r\n    (dbOnlineUsers || []).forEach(user => {\r\n      userMap.set(user.user_id, user);\r\n    });\r\n    \r\n    // Override with realtime users (more accurate)\r\n    (userDetails || []).forEach(user => {\r\n      userMap.set(user.user_id, { ...user, is_online: true });\r\n    });\r\n    \r\n    // Also add any realtime users not yet in the map (before details are fetched)\r\n    realtimeOnlineIds.forEach(userId => {\r\n      if (!userMap.has(userId)) {\r\n        userMap.set(userId, {\r\n          user_id: userId,\r\n          is_online: true,\r\n          last_seen: new Date().toISOString(),\r\n        });\r\n      }\r\n    });\r\n    \r\n    return Array.from(userMap.values());\r\n  })();\r\n\r\n  // Count should match the displayed users for consistency\r\n  const onlineCount = mergedUsers.length;\r\n\r\n  // Combined refetch function\r\n  const refetch = async () => {\r\n    await Promise.all([refetchDetails(), refetchFallback()]);\r\n  };\r\n\r\n  return {\r\n    onlineUsers: mergedUsers,\r\n    onlineCount,\r\n    isLoading,\r\n    refetch\r\n  };\r\n};\r\n\r\nexport const useUserOnlineStatus = (userId: string | undefined) => {\r\n  const [isOnline, setIsOnline] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!userId) {\r\n      setIsOnline(false);\r\n      return;\r\n    }\r\n\r\n    const channel = supabase.channel('online-users');\r\n\r\n    channel\r\n      .on('presence', { event: 'sync' }, () => {\r\n        const state = channel.presenceState();\r\n        setIsOnline(!!state[userId]);\r\n      })\r\n      .on('presence', { event: 'join' }, ({ key }) => {\r\n        if (key === userId) {\r\n          setIsOnline(true);\r\n        }\r\n      })\r\n      .on('presence', { event: 'leave' }, ({ key }) => {\r\n        if (key === userId) {\r\n          setIsOnline(false);\r\n        }\r\n      })\r\n      .subscribe();\r\n\r\n    return () => {\r\n      supabase.removeChannel(channel);\r\n    };\r\n  }, [userId]);\r\n\r\n  return { isOnline, isLoading: false };\r\n};\r\n","import { useState, useCallback } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n  DialogTrigger,\r\n} from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Users, Circle, RefreshCw, MapPin } from 'lucide-react';\r\nimport { useOnlineUsers } from '@/hooks/useOnlineUsers';\r\nimport { formatDistanceToNow } from 'date-fns';\r\nimport { zhCN, enUS, pt } from 'date-fns/locale';\r\nimport { toast } from 'sonner';\r\n\r\ninterface OnlineUsersDialogProps {\r\n  trigger?: React.ReactNode;\r\n}\r\n\r\nexport const OnlineUsersDialog = ({ trigger }: OnlineUsersDialogProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const [open, setOpen] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const { onlineUsers, onlineCount, isLoading, refetch } = useOnlineUsers();\r\n\r\n  const handleRefresh = useCallback(async () => {\r\n    setIsRefreshing(true);\r\n    try {\r\n      await refetch();\r\n      toast.success(t('common.refreshed', '已刷新'));\r\n    } finally {\r\n      setIsRefreshing(false);\r\n    }\r\n  }, [refetch, t]);\r\n\r\n  const getLocale = () => {\r\n    switch (i18n.language) {\r\n      case 'zh': return zhCN;\r\n      case 'pt': return pt;\r\n      default: return enUS;\r\n    }\r\n  };\r\n\r\n  const getRoleBadgeVariant = (role: string | undefined) => {\r\n    switch (role) {\r\n      case 'admin': return 'destructive';\r\n      case 'supervisor': return 'default';\r\n      case 'merchant': return 'secondary';\r\n      default: return 'outline';\r\n    }\r\n  };\r\n\r\n  const getRoleLabel = (role: string | undefined) => {\r\n    switch (role) {\r\n      case 'admin': return t('admin.role.admin', '管理员');\r\n      case 'supervisor': return t('admin.role.supervisor', '主管');\r\n      case 'merchant': return t('admin.role.merchant', '商家');\r\n      default: return t('admin.role.user', '用户');\r\n    }\r\n  };\r\n\r\n  const formatLocation = (city: string | null | undefined, country: string | null | undefined) => {\r\n    if (city && country) {\r\n      return `${city}, ${country}`;\r\n    }\r\n    return city || country || null;\r\n  };\r\n\r\n  const hasLocationData = (user: typeof onlineUsers[0]) => {\r\n    return user.city || user.country || user.ip_address;\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={setOpen}>\r\n      <DialogTrigger asChild>\r\n        {trigger || (\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Users className=\"w-4 h-4 mr-2\" />\r\n            {t('admin.onlineUsers.viewOnline', '查看在线用户')}\r\n          </Button>\r\n        )}\r\n      </DialogTrigger>\r\n      <DialogContent className=\"max-w-md\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Circle className=\"w-3 h-3 fill-green-500 text-green-500\" />\r\n            {t('admin.onlineUsers.title', '在线用户')} ({onlineCount})\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"flex justify-end mb-2\">\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"sm\" \r\n            onClick={handleRefresh} \r\n            disabled={isLoading || isRefreshing}\r\n          >\r\n            <RefreshCw className={`w-4 h-4 mr-1 ${(isLoading || isRefreshing) ? 'animate-spin' : ''}`} />\r\n            {t('common.refresh', '刷新')}\r\n          </Button>\r\n        </div>\r\n\r\n        <ScrollArea className=\"h-[400px] pr-4\">\r\n          {isLoading ? (\r\n            <div className=\"flex items-center justify-center h-32 text-muted-foreground\">\r\n              {t('common.loading', '加载中...')}\r\n            </div>\r\n          ) : onlineUsers.length === 0 ? (\r\n            <div className=\"flex items-center justify-center h-32 text-muted-foreground\">\r\n              {t('admin.onlineUsers.noOnline', '暂无在线用户')}\r\n            </div>\r\n          ) : (\r\n            <div className=\"space-y-3\">\r\n              {onlineUsers.map((user) => (\r\n                <div\r\n                  key={user.user_id}\r\n                  className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors\"\r\n                >\r\n                  <div className=\"relative\">\r\n                    <Avatar className=\"h-10 w-10\">\r\n                      <AvatarImage src={user.profile?.avatar_url || undefined} />\r\n                      <AvatarFallback>\r\n                        {user.profile?.display_name?.charAt(0) || '?'}\r\n                      </AvatarFallback>\r\n                    </Avatar>\r\n                    <Circle \r\n                      className={`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${\r\n                        user.is_online \r\n                          ? 'fill-green-500 text-green-500' \r\n                          : 'fill-yellow-500 text-yellow-500'\r\n                      }`} \r\n                    />\r\n                  </div>\r\n                  \r\n                  <div className=\"flex-1 min-w-0\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"font-medium truncate\">\r\n                        {user.profile?.display_name || t('common.anonymous', '匿名用户')}\r\n                      </span>\r\n                      <Badge variant={getRoleBadgeVariant(user.role)} className=\"text-xs\">\r\n                        {getRoleLabel(user.role)}\r\n                      </Badge>\r\n                    </div>\r\n                    <p className=\"text-xs text-muted-foreground\">\r\n                      {user.is_online \r\n                        ? t('admin.onlineUsers.online', '在线中')\r\n                        : t('admin.onlineUsers.lastSeen', '最后活跃 {{time}}', {\r\n                            time: formatDistanceToNow(new Date(user.last_seen), {\r\n                              addSuffix: true,\r\n                              locale: getLocale()\r\n                            })\r\n                          })\r\n                      }\r\n                    </p>\r\n                    {hasLocationData(user) && (\r\n                      <div className=\"flex items-center gap-1 mt-1 text-xs text-muted-foreground\">\r\n                        <MapPin className=\"w-3 h-3\" />\r\n                        <span className=\"truncate\">\r\n                          {formatLocation(user.city, user.country) && (\r\n                            <span>{formatLocation(user.city, user.country)}</span>\r\n                          )}\r\n                          {user.ip_address && (\r\n                            <>\r\n                              {formatLocation(user.city, user.country) && <span className=\"mx-1\">·</span>}\r\n                              <span className=\"font-mono text-[10px]\">{user.ip_address}</span>\r\n                            </>\r\n                          )}\r\n                        </span>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </ScrollArea>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n","import { useState, useMemo } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\r\nimport { \r\n  Eye, \r\n  Users, \r\n  TrendingUp, \r\n  Store, \r\n  Calendar, \r\n  BarChart3,\r\n  RefreshCw,\r\n  ArrowUpRight,\r\n  Globe,\r\n  Link2,\r\n  MapPin,\r\n  Building,\r\n  Circle\r\n} from \"lucide-react\";\r\nimport { useAnalytics } from \"@/hooks/useAnalytics\";\r\nimport { useOnlineUsers } from \"@/hooks/useOnlineUsers\";\r\nimport { OnlineUsersDialog } from \"@/components/admin/OnlineUsersDialog\";\r\nimport { \r\n  LineChart, \r\n  Line, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  ResponsiveContainer,\r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  BarChart,\r\n  Bar,\r\n  Legend\r\n} from \"recharts\";\r\nimport { format } from \"date-fns\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nconst COLORS = ['hsl(var(--primary))', 'hsl(var(--chart-2))', 'hsl(var(--chart-3))', 'hsl(var(--chart-4))', 'hsl(var(--chart-5))', 'hsl(var(--muted-foreground))'];\r\nconst TREND_COLORS = ['hsl(var(--primary))', 'hsl(var(--chart-2))', 'hsl(var(--chart-3))', 'hsl(var(--chart-4))', 'hsl(var(--chart-5))'];\r\n\r\nconst AdminAnalytics = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const [days, setDays] = useState(30);\r\n  const [selectedCountries, setSelectedCountries] = useState<string[]>([]);\r\n  const [selectedCities, setSelectedCities] = useState<string[]>([]);\r\n  const { data, isLoading, refetch, isRefetching } = useAnalytics(days);\r\n  const { onlineCount, isLoading: isLoadingOnline } = useOnlineUsers();\r\n\r\n  const pageTypeLabels: Record<string, string> = {\r\n    home: t(\"analytics.pageTypes.home\", \"首页\"),\r\n    restaurant: t(\"analytics.pageTypes.restaurant\", \"餐厅详情\"),\r\n    activity: t(\"analytics.pageTypes.activity\", \"活动详情\"),\r\n    restaurants: t(\"analytics.pageTypes.restaurants\", \"餐厅列表\"),\r\n    activities: t(\"analytics.pageTypes.activities\", \"活动列表\"),\r\n    map: t(\"analytics.pageTypes.map\", \"地图\"),\r\n    profile: t(\"analytics.pageTypes.profile\", \"个人资料\"),\r\n    auth: t(\"analytics.pageTypes.auth\", \"登录/注册\"),\r\n    \"join-us\": t(\"analytics.pageTypes.joinUs\", \"加入我们\"),\r\n    other: t(\"analytics.pageTypes.other\", \"其他\"),\r\n  };\r\n\r\n  const refererLabels: Record<string, string> = {\r\n    direct: t(\"analytics.referer.direct\", \"直接访问\"),\r\n    unknown: t(\"analytics.referer.unknown\", \"未知来源\"),\r\n  };\r\n\r\n  const locationLabels: Record<string, string> = {\r\n    unknown: t(\"analytics.location.unknown\", \"未知地区\"),\r\n  };\r\n\r\n  const getRefererLabel = (domain: string) => {\r\n    return refererLabels[domain] || domain;\r\n  };\r\n\r\n  const getLocationLabel = (location: string) => {\r\n    return locationLabels[location] || location;\r\n  };\r\n\r\n  // Get unique countries and cities for selection\r\n  const availableCountries = useMemo(() => {\r\n    return data?.countryStats?.slice(0, 10).map(item => item.location) || [];\r\n  }, [data?.countryStats]);\r\n\r\n  const availableCities = useMemo(() => {\r\n    return data?.cityStats?.slice(0, 10).map(item => item.location) || [];\r\n  }, [data?.cityStats]);\r\n\r\n  // Build country trend data\r\n  const countryTrendData = useMemo(() => {\r\n    if (!data?.countryDailyViews || selectedCountries.length === 0) return [];\r\n    \r\n    const dateMap = new Map<string, Record<string, number>>();\r\n    data.countryDailyViews\r\n      .filter(item => selectedCountries.includes(item.location))\r\n      .forEach(item => {\r\n        if (!dateMap.has(item.date)) {\r\n          dateMap.set(item.date, {});\r\n        }\r\n        dateMap.get(item.date)![item.location] = item.views;\r\n      });\r\n    \r\n    return Array.from(dateMap.entries())\r\n      .map(([date, locations]) => ({ date, ...locations }))\r\n      .sort((a, b) => a.date.localeCompare(b.date));\r\n  }, [data?.countryDailyViews, selectedCountries]);\r\n\r\n  // Build city trend data\r\n  const cityTrendData = useMemo(() => {\r\n    if (!data?.cityDailyViews || selectedCities.length === 0) return [];\r\n    \r\n    const dateMap = new Map<string, Record<string, number>>();\r\n    data.cityDailyViews\r\n      .filter(item => selectedCities.includes(item.location))\r\n      .forEach(item => {\r\n        if (!dateMap.has(item.date)) {\r\n          dateMap.set(item.date, {});\r\n        }\r\n        dateMap.get(item.date)![item.location] = item.views;\r\n      });\r\n    \r\n    return Array.from(dateMap.entries())\r\n      .map(([date, locations]) => ({ date, ...locations }))\r\n      .sort((a, b) => a.date.localeCompare(b.date));\r\n  }, [data?.cityDailyViews, selectedCities]);\r\n\r\n  const pieData = data?.viewsByPage\r\n    ? Object.entries(data.viewsByPage).map(([key, value]) => ({\r\n        name: pageTypeLabels[key] || key,\r\n        value,\r\n      }))\r\n    : [];\r\n\r\n  const refererChartData = data?.refererStats?.slice(0, 10).map(item => ({\r\n    name: getRefererLabel(item.domain),\r\n    value: item.count,\r\n    percentage: item.percentage.toFixed(1),\r\n  })) || [];\r\n\r\n  const countryChartData = data?.countryStats?.slice(0, 10).map(item => ({\r\n    name: getLocationLabel(item.location),\r\n    value: item.count,\r\n    percentage: item.percentage.toFixed(1),\r\n  })) || [];\r\n\r\n  const cityChartData = data?.cityStats?.slice(0, 10).map(item => ({\r\n    name: getLocationLabel(item.location),\r\n    value: item.count,\r\n    percentage: item.percentage.toFixed(1),\r\n  })) || [];\r\n\r\n  const toggleCountry = (country: string) => {\r\n    setSelectedCountries(prev => \r\n      prev.includes(country) \r\n        ? prev.filter(c => c !== country)\r\n        : prev.length < 5 ? [...prev, country] : prev\r\n    );\r\n  };\r\n\r\n  const toggleCity = (city: string) => {\r\n    setSelectedCities(prev => \r\n      prev.includes(city) \r\n        ? prev.filter(c => c !== city)\r\n        : prev.length < 5 ? [...prev, city] : prev\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n        <div>\r\n          <h1 className=\"text-3xl font-bold\">{t(\"analytics.title\", \"访问统计\")}</h1>\r\n          <p className=\"text-muted-foreground\">{t(\"analytics.description\", \"网站访问数据分析\")}</p>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <div className=\"flex gap-1 flex-wrap\">\r\n            <Button\r\n              variant={days === 1 ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              onClick={() => setDays(1)}\r\n            >\r\n              {t(\"analytics.today\", \"今日\")}\r\n            </Button>\r\n            {[7, 30, 90].map((d) => (\r\n              <Button\r\n                key={d}\r\n                variant={days === d ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                onClick={() => setDays(d)}\r\n              >\r\n                {d}{t(\"analytics.days\", \"天\")}\r\n              </Button>\r\n            ))}\r\n            <Button\r\n              variant={days === 0 ? \"default\" : \"outline\"}\r\n              size=\"sm\"\r\n              onClick={() => setDays(0)}\r\n            >\r\n              {t(\"analytics.all\", \"所有\")}\r\n            </Button>\r\n          </div>\r\n          <Button variant=\"outline\" size=\"sm\" onClick={() => refetch()} disabled={isRefetching}>\r\n            <RefreshCw className={`w-4 h-4 mr-1 ${isRefetching ? \"animate-spin\" : \"\"}`} />\r\n            {t(\"common.refresh\", \"刷新\")}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n\r\n      {isLoading ? (\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          {[...Array(4)].map((_, i) => (\r\n            <Skeleton key={i} className=\"h-32\" />\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        <>\r\n          {/* Summary Cards */}\r\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\r\n            {/* Online Users Card */}\r\n            <Card className=\"border-green-500/50 bg-green-500/5\">\r\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n                  <Circle className=\"h-3 w-3 fill-green-500 text-green-500\" />\r\n                  {t(\"analytics.onlineUsers\", \"在线用户\")}\r\n                </CardTitle>\r\n                <Users className=\"h-4 w-4 text-green-500\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\r\n                  {isLoadingOnline ? '-' : onlineCount}\r\n                </div>\r\n                <div className=\"mt-2\">\r\n                  <OnlineUsersDialog \r\n                    trigger={\r\n                      <Button variant=\"ghost\" size=\"sm\" className=\"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700\">\r\n                        {t(\"analytics.viewOnlineUsers\", \"查看在线用户\")} →\r\n                      </Button>\r\n                    }\r\n                  />\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">{t(\"analytics.totalViews\", \"总访问量\")}</CardTitle>\r\n                <Eye className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data?.totalViews.toLocaleString()}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {days === 0 \r\n                    ? t(\"analytics.allTime\", \"所有时间\")\r\n                    : days === 1 \r\n                      ? t(\"analytics.today\", \"今日\")\r\n                      : t(\"analytics.lastNDays\", \"最近{{days}}天\", { days })\r\n                  }\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">{t(\"analytics.uniqueVisitors\", \"独立访客\")}</CardTitle>\r\n                <Users className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{data?.uniqueVisitors.toLocaleString()}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"analytics.uniqueVisitorDesc\", \"基于访客ID\")}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">{t(\"analytics.restaurantViews\", \"餐厅浏览\")}</CardTitle>\r\n                <Store className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{(data?.viewsByPage?.restaurant || 0).toLocaleString()}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"analytics.restaurantViewsDesc\", \"餐厅详情页访问\")}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            <Card>\r\n              <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\r\n                <CardTitle className=\"text-sm font-medium\">{t(\"analytics.activityViews\", \"活动浏览\")}</CardTitle>\r\n                <Calendar className=\"h-4 w-4 text-muted-foreground\" />\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"text-2xl font-bold\">{(data?.viewsByPage?.activity || 0).toLocaleString()}</div>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {t(\"analytics.activityViewsDesc\", \"活动详情页访问\")}\r\n                </p>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Charts Row */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Daily Views Chart */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <TrendingUp className=\"w-5 h-5\" />\r\n                  {t(\"analytics.dailyTrend\", \"每日访问趋势\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"h-[300px]\">\r\n                  {data?.dailyViews && data.dailyViews.length > 0 ? (\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                      <LineChart data={data.dailyViews}>\r\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                        <XAxis \r\n                          dataKey=\"date\" \r\n                          tickFormatter={(value) => format(new Date(value), \"MM/dd\")}\r\n                          className=\"text-xs\"\r\n                        />\r\n                        <YAxis className=\"text-xs\" />\r\n                        <Tooltip \r\n                          labelFormatter={(value) => format(new Date(value), \"yyyy-MM-dd\")}\r\n                          contentStyle={{ \r\n                            backgroundColor: \"hsl(var(--background))\", \r\n                            border: \"1px solid hsl(var(--border))\" \r\n                          }}\r\n                        />\r\n                        <Line \r\n                          type=\"monotone\" \r\n                          dataKey=\"views\" \r\n                          stroke=\"hsl(var(--primary))\" \r\n                          strokeWidth={2}\r\n                          name={t(\"analytics.views\", \"访问量\")}\r\n                        />\r\n                        <Line \r\n                          type=\"monotone\" \r\n                          dataKey=\"uniqueVisitors\" \r\n                          stroke=\"hsl(var(--chart-2))\" \r\n                          strokeWidth={2}\r\n                          name={t(\"analytics.uniqueVisitors\", \"独立访客\")}\r\n                        />\r\n                      </LineChart>\r\n                    </ResponsiveContainer>\r\n                  ) : (\r\n                    <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                      {t(\"analytics.noData\", \"暂无数据\")}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* Page Type Distribution */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <BarChart3 className=\"w-5 h-5\" />\r\n                  {t(\"analytics.pageDistribution\", \"页面访问分布\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"h-[300px]\">\r\n                  {pieData.length > 0 ? (\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                      <PieChart>\r\n                        <Pie\r\n                          data={pieData}\r\n                          cx=\"50%\"\r\n                          cy=\"50%\"\r\n                          labelLine={false}\r\n                          label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}\r\n                          outerRadius={100}\r\n                          fill=\"#8884d8\"\r\n                          dataKey=\"value\"\r\n                        >\r\n                          {pieData.map((_, index) => (\r\n                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                          ))}\r\n                        </Pie>\r\n                        <Tooltip \r\n                          contentStyle={{ \r\n                            backgroundColor: \"hsl(var(--background))\", \r\n                            border: \"1px solid hsl(var(--border))\" \r\n                          }}\r\n                        />\r\n                      </PieChart>\r\n                    </ResponsiveContainer>\r\n                  ) : (\r\n                    <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                      {t(\"analytics.noData\", \"暂无数据\")}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Referer Statistics */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"flex items-center gap-2\">\r\n                <Globe className=\"w-5 h-5\" />\r\n                {t(\"analytics.refererStats\", \"访问来源统计\")}\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                {/* Referer Bar Chart */}\r\n                <div className=\"h-[300px]\">\r\n                  {refererChartData.length > 0 ? (\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                      <BarChart data={refererChartData} layout=\"vertical\">\r\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                        <XAxis type=\"number\" className=\"text-xs\" />\r\n                        <YAxis \r\n                          dataKey=\"name\" \r\n                          type=\"category\" \r\n                          width={120}\r\n                          className=\"text-xs\"\r\n                          tick={{ fontSize: 11 }}\r\n                        />\r\n                        <Tooltip \r\n                          formatter={(value: number, name: string, props: any) => [\r\n                            `${value} (${props.payload.percentage}%)`,\r\n                            t(\"analytics.views\", \"访问量\")\r\n                          ]}\r\n                          contentStyle={{ \r\n                            backgroundColor: \"hsl(var(--background))\", \r\n                            border: \"1px solid hsl(var(--border))\" \r\n                          }}\r\n                        />\r\n                        <Bar dataKey=\"value\" fill=\"hsl(var(--primary))\" radius={[0, 4, 4, 0]} />\r\n                      </BarChart>\r\n                    </ResponsiveContainer>\r\n                  ) : (\r\n                    <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                      {t(\"analytics.noData\", \"暂无数据\")}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Referer List */}\r\n                <div className=\"space-y-3 max-h-[300px] overflow-y-auto\">\r\n                  {data?.refererStats && data.refererStats.length > 0 ? (\r\n                    data.refererStats.map((item, index) => (\r\n                      <div key={item.domain} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <Badge variant={index < 3 ? \"default\" : \"secondary\"} className=\"w-6 h-6 p-0 justify-center\">\r\n                            {index + 1}\r\n                          </Badge>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Link2 className=\"w-4 h-4 text-muted-foreground\" />\r\n                            <span className=\"font-medium text-sm truncate max-w-[150px]\">\r\n                              {getRefererLabel(item.domain)}\r\n                            </span>\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-3\">\r\n                          <span className=\"text-sm font-medium\">{item.count}</span>\r\n                          <Badge variant=\"outline\" className=\"text-xs\">\r\n                            {item.percentage.toFixed(1)}%\r\n                          </Badge>\r\n                        </div>\r\n                      </div>\r\n                    ))\r\n                  ) : (\r\n                    <p className=\"text-muted-foreground text-center py-8\">\r\n                      {t(\"analytics.noData\", \"暂无数据\")}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Location Statistics */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Country Statistics */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Globe className=\"w-5 h-5\" />\r\n                  {t(\"analytics.countryStats\", \"国家/地区统计\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {/* Country Bar Chart */}\r\n                  <div className=\"h-[200px]\">\r\n                    {countryChartData.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <BarChart data={countryChartData} layout=\"vertical\">\r\n                          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                          <XAxis type=\"number\" className=\"text-xs\" />\r\n                          <YAxis \r\n                            dataKey=\"name\" \r\n                            type=\"category\" \r\n                            width={100}\r\n                            className=\"text-xs\"\r\n                            tick={{ fontSize: 11 }}\r\n                          />\r\n                          <Tooltip \r\n                            formatter={(value: number, name: string, props: any) => [\r\n                              `${value} (${props.payload.percentage}%)`,\r\n                              t(\"analytics.views\", \"访问量\")\r\n                            ]}\r\n                            contentStyle={{ \r\n                              backgroundColor: \"hsl(var(--background))\", \r\n                              border: \"1px solid hsl(var(--border))\" \r\n                            }}\r\n                          />\r\n                          <Bar dataKey=\"value\" fill=\"hsl(var(--chart-2))\" radius={[0, 4, 4, 0]} />\r\n                        </BarChart>\r\n                      </ResponsiveContainer>\r\n                    ) : (\r\n                      <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                        {t(\"analytics.noData\", \"暂无数据\")}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* Country List */}\r\n                  <div className=\"space-y-2 max-h-[200px] overflow-y-auto\">\r\n                    {data?.countryStats && data.countryStats.length > 0 ? (\r\n                      data.countryStats.slice(0, 10).map((item, index) => (\r\n                        <div key={item.location} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <Badge variant={index < 3 ? \"default\" : \"secondary\"} className=\"w-6 h-6 p-0 justify-center\">\r\n                              {index + 1}\r\n                            </Badge>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <Globe className=\"w-4 h-4 text-muted-foreground\" />\r\n                              <span className=\"font-medium text-sm truncate max-w-[120px]\">\r\n                                {getLocationLabel(item.location)}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-sm font-medium\">{item.count}</span>\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {item.percentage.toFixed(1)}%\r\n                            </Badge>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-4\">\r\n                        {t(\"analytics.noData\", \"暂无数据\")}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* City Statistics */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <Building className=\"w-5 h-5\" />\r\n                  {t(\"analytics.cityStats\", \"城市统计\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {/* City Bar Chart */}\r\n                  <div className=\"h-[200px]\">\r\n                    {cityChartData.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <BarChart data={cityChartData} layout=\"vertical\">\r\n                          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                          <XAxis type=\"number\" className=\"text-xs\" />\r\n                          <YAxis \r\n                            dataKey=\"name\" \r\n                            type=\"category\" \r\n                            width={100}\r\n                            className=\"text-xs\"\r\n                            tick={{ fontSize: 11 }}\r\n                          />\r\n                          <Tooltip \r\n                            formatter={(value: number, name: string, props: any) => [\r\n                              `${value} (${props.payload.percentage}%)`,\r\n                              t(\"analytics.views\", \"访问量\")\r\n                            ]}\r\n                            contentStyle={{ \r\n                              backgroundColor: \"hsl(var(--background))\", \r\n                              border: \"1px solid hsl(var(--border))\" \r\n                            }}\r\n                          />\r\n                          <Bar dataKey=\"value\" fill=\"hsl(var(--chart-3))\" radius={[0, 4, 4, 0]} />\r\n                        </BarChart>\r\n                      </ResponsiveContainer>\r\n                    ) : (\r\n                      <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                        {t(\"analytics.noData\", \"暂无数据\")}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  {/* City List */}\r\n                  <div className=\"space-y-2 max-h-[200px] overflow-y-auto\">\r\n                    {data?.cityStats && data.cityStats.length > 0 ? (\r\n                      data.cityStats.slice(0, 10).map((item, index) => (\r\n                        <div key={item.location} className=\"flex items-center justify-between p-2 rounded-lg bg-muted/50\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <Badge variant={index < 3 ? \"default\" : \"secondary\"} className=\"w-6 h-6 p-0 justify-center\">\r\n                              {index + 1}\r\n                            </Badge>\r\n                            <div className=\"flex items-center gap-2\">\r\n                              <MapPin className=\"w-4 h-4 text-muted-foreground\" />\r\n                              <span className=\"font-medium text-sm truncate max-w-[120px]\">\r\n                                {getLocationLabel(item.location)}\r\n                              </span>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span className=\"text-sm font-medium\">{item.count}</span>\r\n                            <Badge variant=\"outline\" className=\"text-xs\">\r\n                              {item.percentage.toFixed(1)}%\r\n                            </Badge>\r\n                          </div>\r\n                        </div>\r\n                      ))\r\n                    ) : (\r\n                      <p className=\"text-muted-foreground text-center py-4\">\r\n                        {t(\"analytics.noData\", \"暂无数据\")}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n          {/* Location Trend Analysis */}\r\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n            {/* Country Trend */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <TrendingUp className=\"w-5 h-5\" />\r\n                  {t(\"analytics.countryTrend\", \"国家/地区访问趋势\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {/* Country Selection */}\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {availableCountries.map((country, index) => (\r\n                      <Button\r\n                        key={country}\r\n                        variant={selectedCountries.includes(country) ? \"default\" : \"outline\"}\r\n                        size=\"sm\"\r\n                        onClick={() => toggleCountry(country)}\r\n                        className=\"text-xs\"\r\n                        style={selectedCountries.includes(country) ? { \r\n                          backgroundColor: TREND_COLORS[selectedCountries.indexOf(country) % TREND_COLORS.length] \r\n                        } : {}}\r\n                      >\r\n                        {getLocationLabel(country)}\r\n                      </Button>\r\n                    ))}\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    {t(\"analytics.selectLocationsHint\", \"选择最多5个地区查看趋势（点击选择/取消）\")}\r\n                  </p>\r\n\r\n                  {/* Country Trend Chart */}\r\n                  <div className=\"h-[250px]\">\r\n                    {countryTrendData.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <LineChart data={countryTrendData}>\r\n                          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                          <XAxis \r\n                            dataKey=\"date\" \r\n                            tickFormatter={(value) => format(new Date(value), \"MM/dd\")}\r\n                            className=\"text-xs\"\r\n                          />\r\n                          <YAxis className=\"text-xs\" />\r\n                          <Tooltip \r\n                            labelFormatter={(value) => format(new Date(value), \"yyyy-MM-dd\")}\r\n                            contentStyle={{ \r\n                              backgroundColor: \"hsl(var(--background))\", \r\n                              border: \"1px solid hsl(var(--border))\" \r\n                            }}\r\n                          />\r\n                          <Legend />\r\n                          {selectedCountries.map((country, index) => (\r\n                            <Line \r\n                              key={country}\r\n                              type=\"monotone\" \r\n                              dataKey={country}\r\n                              stroke={TREND_COLORS[index % TREND_COLORS.length]}\r\n                              strokeWidth={2}\r\n                              name={getLocationLabel(country)}\r\n                              dot={false}\r\n                            />\r\n                          ))}\r\n                        </LineChart>\r\n                      </ResponsiveContainer>\r\n                    ) : (\r\n                      <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                        {selectedCountries.length === 0 \r\n                          ? t(\"analytics.selectLocations\", \"请选择地区查看趋势\")\r\n                          : t(\"analytics.noData\", \"暂无数据\")}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n\r\n            {/* City Trend */}\r\n            <Card>\r\n              <CardHeader>\r\n                <CardTitle className=\"flex items-center gap-2\">\r\n                  <TrendingUp className=\"w-5 h-5\" />\r\n                  {t(\"analytics.cityTrend\", \"城市访问趋势\")}\r\n                </CardTitle>\r\n              </CardHeader>\r\n              <CardContent>\r\n                <div className=\"space-y-4\">\r\n                  {/* City Selection */}\r\n                  <div className=\"flex flex-wrap gap-2\">\r\n                    {availableCities.map((city, index) => (\r\n                      <Button\r\n                        key={city}\r\n                        variant={selectedCities.includes(city) ? \"default\" : \"outline\"}\r\n                        size=\"sm\"\r\n                        onClick={() => toggleCity(city)}\r\n                        className=\"text-xs\"\r\n                        style={selectedCities.includes(city) ? { \r\n                          backgroundColor: TREND_COLORS[selectedCities.indexOf(city) % TREND_COLORS.length] \r\n                        } : {}}\r\n                      >\r\n                        {getLocationLabel(city)}\r\n                      </Button>\r\n                    ))}\r\n                  </div>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    {t(\"analytics.selectLocationsHint\", \"选择最多5个地区查看趋势（点击选择/取消）\")}\r\n                  </p>\r\n\r\n                  {/* City Trend Chart */}\r\n                  <div className=\"h-[250px]\">\r\n                    {cityTrendData.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <LineChart data={cityTrendData}>\r\n                          <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\r\n                          <XAxis \r\n                            dataKey=\"date\" \r\n                            tickFormatter={(value) => format(new Date(value), \"MM/dd\")}\r\n                            className=\"text-xs\"\r\n                          />\r\n                          <YAxis className=\"text-xs\" />\r\n                          <Tooltip \r\n                            labelFormatter={(value) => format(new Date(value), \"yyyy-MM-dd\")}\r\n                            contentStyle={{ \r\n                              backgroundColor: \"hsl(var(--background))\", \r\n                              border: \"1px solid hsl(var(--border))\" \r\n                            }}\r\n                          />\r\n                          <Legend />\r\n                          {selectedCities.map((city, index) => (\r\n                            <Line \r\n                              key={city}\r\n                              type=\"monotone\" \r\n                              dataKey={city}\r\n                              stroke={TREND_COLORS[index % TREND_COLORS.length]}\r\n                              strokeWidth={2}\r\n                              name={getLocationLabel(city)}\r\n                              dot={false}\r\n                            />\r\n                          ))}\r\n                        </LineChart>\r\n                      </ResponsiveContainer>\r\n                    ) : (\r\n                      <div className=\"h-full flex items-center justify-center text-muted-foreground\">\r\n                        {selectedCities.length === 0 \r\n                          ? t(\"analytics.selectLocations\", \"请选择地区查看趋势\")\r\n                          : t(\"analytics.noData\", \"暂无数据\")}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </CardContent>\r\n            </Card>\r\n          </div>\r\n\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminAnalytics;\r\n"],"names":["getRefererDomain","referer","useAnalytics","days","useQuery","dateFilter","startOfDay","subDays","PAGE_SIZE","allViews","page","hasMore","query","supabase","pageViews","error","views","totalViews","uniqueVisitors","v","viewsByPage","dailyMap","date","format","day","dailyViews","data","a","b","refererMap","domain","refererStats","count","countryMap","country","countryStats","location","cityMap","city","cityStats","countryDailyMap","dateMap","countryDailyViews","cityDailyMap","cityDailyViews","restaurantViews","topRestaurantIds","topRestaurants","restaurants","r","id","activityViews","topActivityIds","topActivities","activities","activity","useOnlineUsers","realtimeOnlineIds","setRealtimeOnlineIds","useState","channel","setChannel","useEffect","presenceChannel","state","onlineIds","key","newPresences","prev","leftPresences","next","status","userDetails","isLoading","refetchDetails","userIds","presenceData","presenceError","profiles","profilesError","roles","rolesError","presenceMap","p","profileMap","roleMap","userId","presence","profile","dbOnlineUsers","refetchFallback","twoMinutesAgo","mergedUsers","userMap","user","onlineCount","OnlineUsersDialog","trigger","t","i18n","useTranslation","open","setOpen","isRefreshing","setIsRefreshing","onlineUsers","refetch","handleRefresh","useCallback","toast","getLocale","zhCN","pt","enUS","getRoleBadgeVariant","role","getRoleLabel","formatLocation","hasLocationData","jsxs","Dialog","jsx","DialogTrigger","Button","Users","DialogContent","DialogHeader","DialogTitle","Circle","RefreshCw","ScrollArea","Avatar","AvatarImage","AvatarFallback","Badge","formatDistanceToNow","MapPin","Fragment","COLORS","TREND_COLORS","AdminAnalytics","setDays","selectedCountries","setSelectedCountries","selectedCities","setSelectedCities","isRefetching","isLoadingOnline","pageTypeLabels","refererLabels","locationLabels","getRefererLabel","getLocationLabel","availableCountries","useMemo","item","availableCities","countryTrendData","locations","cityTrendData","pieData","value","refererChartData","countryChartData","cityChartData","toggleCountry","c","toggleCity","d","_","i","Skeleton","Card","CardHeader","CardTitle","CardContent","Eye","Store","Calendar","TrendingUp","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Line","BarChart3","PieChart","Pie","name","percent","index","Cell","Globe","BarChart","props","Bar","Link2","Building","Legend"],"mappings":"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"}