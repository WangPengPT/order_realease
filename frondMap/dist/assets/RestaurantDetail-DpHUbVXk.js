const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-wP31hLFs.js","assets/vendor-react-Dd_5Sawp.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/index-BTawsUvj.js","assets/vendor-supabase-BnZwaL-Z.js","assets/index-DyiDz2Og.css","assets/ReportDialog-Cp_Kt4H4.js","assets/input-otp-Blvy07zO.js","assets/useSensitiveWords-BVE9mXxk.js"])))=>i.map(i=>d[i]);
import{j as m,C as z,p as T,q as R,F as be,i as vs,s as ys,a as Xe,B as b,D as _s,c as ks,e as Cs,S as Ds,g as S,_ as Je,u as Ss,G as zs,J as We,n as Rs,A as U,t as H,v as K,w as V,x as Q,y as Y,E as B,o as re,z as X,K as Os,L as Is,M as Ls,N as G,O as Ue}from"./index-BTawsUvj.js";import{j as e,p as F,a$ as ee,bg as Ts,s as $s,r as l,bh as Ms,bi as As,bb as qs,aw as $,ar as Fs,X as Ps,bj as Ie,W as Ze,bk as es,bl as ze,L as ie,bm as J,be as ss,bn as ts,bo as Es,b1 as Bs,a_ as Re,y as as,b3 as Z,aM as le,bp as Gs,bq as Ws,aO as Us,u as Hs,q as Ks,w as je,br as He,bs as Ke,bt as De,bu as Vs,aW as Se,bv as Qs,bf as Ys,b6 as Xs}from"./vendor-react-Dd_5Sawp.js";import{S as Oe}from"./separator-D8n3METR.js";import{C as M,a as A,b as q}from"./collapsible-T0jops5T.js";import{d as Js,b as Zs,c as et}from"./useRestaurants-B9CCGo6C.js";import{u as rs,R as Ve}from"./ReportDialog-Cp_Kt4H4.js";import{u as Le}from"./useLocalizedContent-N57tkM8u.js";import{f as st}from"./timeUtils-pgRxO0UB.js";import{g as tt,c as at,o as rt,m as nt}from"./geolocation-DRm3QMsJ.js";import{m as ne}from"./vendor-map-CvE3ASYw.js";import{P as lt}from"./PullToRefresh-C5cS2eNQ.js";import{u as it}from"./usePageView-C6p0e0v-.js";import{u as ot}from"./ShareDrawer-2_-1zDpg.js";import{u as dt}from"./useActivityParticipation-DAMLSkIM.js";import{u as ct,R as Qe}from"./RestaurantFormDialog-_nVk0Ez9.js";import{C as mt,a as xt,b as ht,c as ut,d as pt}from"./carousel-DsT6l_nE.js";import{D as gt,a as ft,b as jt,c as wt,d as bt}from"./drawer-sPiVIRpe.js";import{u as Nt}from"./useBrands-bDJwP4VY.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-BnZwaL-Z.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-Blvy07zO.js";import"./checkbox-CWzN0tAj.js";import"./switch-CTzB6xo_.js";import"./radio-group-C4w5o0zI.js";import"./tabs-Bn7q7SHF.js";import"./RichTextEditor-8INFf3gT.js";const vt=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(m,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(m,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(m,{className:"h-10 w-10 rounded-md"}),e.jsx(m,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(z,{className:"shadow-large",children:[e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(m,{className:"h-6 w-16 rounded-full"}),e.jsx(m,{className:"h-6 w-20 rounded-full"}),e.jsx(m,{className:"h-6 w-14 rounded-full"})]}),e.jsx(m,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(m,{className:"h-5 w-20"}),e.jsx(m,{className:"h-5 w-24"}),e.jsx(m,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{className:"h-10 w-28 rounded-md"}),e.jsx(m,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"h-5 w-24"}),e.jsx(m,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{className:"h-8 w-24 rounded-full"}),e.jsx(m,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(m,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(m,{className:"h-5 w-full"}),e.jsx(m,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(m,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(m,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(m,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(m,{className:"h-5 w-40"}),e.jsx(m,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(z,{className:"mt-6 shadow-large",children:[e.jsx(T,{children:e.jsx(m,{className:"h-6 w-20"})}),e.jsx(R,{children:e.jsx(m,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(z,{className:"mt-6 shadow-large",children:[e.jsx(T,{children:e.jsx(m,{className:"h-6 w-24"})}),e.jsx(R,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(a=>e.jsx(m,{className:"h-24 w-24 rounded-lg flex-shrink-0"},a))})})]}),e.jsxs(z,{className:"mt-6 shadow-large",children:[e.jsxs(T,{className:"flex flex-row items-center justify-between",children:[e.jsx(m,{className:"h-6 w-32"}),e.jsx(m,{className:"h-9 w-24 rounded-md"})]}),e.jsx(R,{className:"space-y-4",children:[1,2,3].map(a=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-24"}),e.jsx(m,{className:"h-4 w-16"})]}),e.jsx(m,{className:"h-4 w-full"}),e.jsx(m,{className:"h-4 w-3/4"})]})]},a))})]})]})]}),yt=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],ns=({restaurantId:a})=>{const{t:d}=F(),{data:s}=rs(a,"restaurant"),o=s?.filter(i=>i.rating_value)||[],x=o.length?o.reduce((i,c)=>i+(c.rating_value||0),0)/o.length:0,p=[5,4,3,2,1].map(i=>({star:i,count:o.filter(c=>c.rating_value===i).length,percentage:o.length?(o.filter(c=>c.rating_value===i).length/o.length*100).toFixed(0):0})),h=o.reduce((i,c)=>(c.price_range&&(i[c.price_range]=(i[c.price_range]||0)+1),i),{}),_=h&&Object.keys(h).length>0?Object.entries(h).sort((i,c)=>c[1]-i[1])[0]:null;return e.jsxs(z,{children:[e.jsx(T,{children:e.jsx(be,{children:d("restaurant.rating")})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:x.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(i=>e.jsx(ee,{className:vs("w-5 h-5",i<=Math.round(x)?"fill-accent text-accent":"text-muted-foreground")},i))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[o.length," ",d("restaurant.ratingsCount")]}),_&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Ts,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:yt.find(i=>i.value===_[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:p.map(({star:i,count:c,percentage:N})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[i," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${N}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:c})]},i))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:d("restaurant.signInToRate")})]})]})},_t=a=>(F(),$s({queryKey:["restaurant-activities",a],queryFn:async()=>{const{data:d,error:s}=await ys.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",a);if(s)throw s;const o=new Date;return d.filter(p=>{const h=p.activities;if(!h)return!1;const _=new Date(h.start_date),i=h.end_date?new Date(h.end_date):null;return _<=o&&(!i||i>=o)}).map(p=>({activity_id:p.activity_id,title_zh:p.activities.title_zh,title_en:p.activities.title_en,title_pt:p.activities.title_pt,intro_zh:p.activities.intro_zh,intro_en:p.activities.intro_en,intro_pt:p.activities.intro_pt,badge_text_zh:p.activities.badge_text_zh,badge_text_en:p.activities.badge_text_en,badge_text_pt:p.activities.badge_text_pt,badge_color:p.activities.badge_color}))},enabled:!!a})),ls=(a,d)=>d==="zh"?a.title_zh:d==="pt"?a.title_pt:a.title_en,we=(a,d)=>{let s="";return d==="zh"?s=a.badge_text_zh||a.title_zh:d==="pt"?s=a.badge_text_pt||a.title_pt:s=a.badge_text_en||a.title_en,s},is=(a,d)=>d==="zh"?a.intro_zh||"":d==="pt"?a.intro_pt||"":a.intro_en||"",Ye="dish-gallery-view-mode";function os({restaurantId:a,showGallery:d=!0}){const{t:s}=F(),{data:o=[],isLoading:x}=ct(a),[p,h]=l.useState(!1),[_,i]=l.useState(0),[c,N]=l.useState(!1),f=Xe(),[j,D]=l.useState(()=>{if(typeof window<"u"){const u=localStorage.getItem(Ye);return u==="single"||u==="multi"?u:"multi"}return"multi"});l.useEffect(()=>{localStorage.setItem(Ye,j)},[j]);const w=l.useCallback(u=>{i(u),h(!0)},[]),k=l.useCallback(()=>{h(!1)},[]),O=l.useCallback(()=>{i(u=>u===0?o.length-1:u-1)},[o.length]),P=l.useCallback(()=>{i(u=>u===o.length-1?0:u+1)},[o.length]),I=l.useCallback(u=>{u.key==="ArrowLeft"&&O(),u.key==="ArrowRight"&&P(),u.key==="Escape"&&k()},[O,P,k]);if(x||!d||!o.length)return null;const se=()=>f&&j==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(z,{children:e.jsxs(M,{open:!c,onOpenChange:u=>N(!u),children:[e.jsx(T,{className:"pb-3",children:e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(be,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ms,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",o.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:u=>u.stopPropagation(),children:[e.jsx(b,{variant:j==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:u=>{u.stopPropagation(),D("single")},title:s("dishImages.singleView"),children:e.jsx(As,{className:"h-4 w-4"})}),e.jsx(b,{variant:j==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:u=>{u.stopPropagation(),D("multi")},title:s("dishImages.multiView"),children:e.jsx(qs,{className:"h-4 w-4"})})]}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${c?"":"rotate-180"}`})]})]})})}),e.jsx(q,{children:e.jsxs(R,{children:[e.jsxs(mt,{className:"w-full",children:[e.jsx(xt,{className:"-ml-2 md:-ml-4",children:o.map((u,oe)=>e.jsx(ht,{className:se(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>w(oe),children:e.jsx("img",{src:u.image_url,alt:`Dish ${oe+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},u.id))}),o.length>(f&&j==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"-left-3 md:-left-4"}),e.jsx(pt,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),e.jsx(_s,{open:p,onOpenChange:h,children:e.jsxs(ks,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:I,children:[e.jsx(Fs,{children:e.jsx(Cs,{children:s("restaurants.dishGallery","Dish Gallery")})}),e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:k,children:e.jsx(Ps,{className:"w-6 h-6"})}),o.length>1&&e.jsx(b,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:O,children:e.jsx(Ie,{className:"w-8 h-8"})}),e.jsx("img",{src:o[_]?.image_url,alt:`Dish ${_+1}`,className:"max-w-full max-h-[85vh] object-contain"}),o.length>1&&e.jsx(b,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:P,children:e.jsx(Ze,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[_+1," / ",o.length]})]})]})})]})}const kt=({ownerBio:a,ownerName:d,ownerAvatarUrl:s,avatarFallback:o})=>{const{t:x}=F();return e.jsxs(gt,{children:[e.jsx(ft,{asChild:!0,children:e.jsxs(b,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",children:[x("common.viewMore","查看全部"),e.jsx(Ze,{className:"w-4 h-4"})]})}),e.jsxs(jt,{className:"max-h-[85vh]",children:[e.jsx(wt,{className:"pb-2",children:e.jsxs(bt,{className:"flex items-center gap-2 text-lg",children:[e.jsx(es,{className:"w-5 h-5 text-primary"}),x("restaurants.ownerStory","主理人")]})}),e.jsx(Ds,{className:"flex-1 px-4 pb-8",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(ze,{className:"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 pt-6 space-y-4",children:e.jsx("p",{className:"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1",children:a})}),e.jsxs("div",{className:"mt-8 flex items-center gap-3 pt-6 border-t",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:s?e.jsx("img",{src:s,alt:d,className:"w-full h-full object-cover"}):o}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:d}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x("restaurants.chef","大厨")})]})]})]})})]})]})},Ct=({restaurant:a,localizedRestaurant:d,backUrl:s,user:o,isFavorite:x,onToggleFavorite:p,onShare:h,showEditButton:_,editButton:i,reportButton:c})=>{const{t:N}=F(),{getLocalizedField:f}=Le(),j=f(a,"owner_bio")||a.owner_bio,D=d.description,w=d.name?.charAt(0)?.toUpperCase()||"主",k=u=>u?.replace(/<[^>]*>/g,"")||"",O=j&&j.length>100?j.substring(0,100)+"...":j,P=j&&j.length>100,I=k(D),se=I&&I.length>120?I.substring(0,120)+"...":I;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:a.banner_url||a.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:d.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent"}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center z-30 p-3 md:p-4",children:[e.jsx(b,{asChild:!0,variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",children:e.jsx(ie,{to:s,children:e.jsx(Ie,{className:"w-4 h-4 md:w-5 md:h-5"})})}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[c,i,e.jsx(b,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:h,children:e.jsx(J,{className:"w-4 h-4 md:w-5 md:h-5"})}),o&&e.jsx(b,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:p,children:e.jsx(ss,{className:`w-4 h-4 md:w-5 md:h-5 ${x?"fill-destructive text-destructive":""}`})})]})]})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8",children:e.jsxs(z,{className:"shadow-xl border-border/50",children:[e.jsxs(T,{className:"pb-4 md:pb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 md:mb-2",children:[e.jsxs(S,{variant:"secondary",className:"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[e.jsx(ts,{className:"w-3 h-3"}),N("admin.templateGhost","Virtual Restaurant")]}),e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary",children:N("restaurants.exclusiveInterview","专属故事")})]}),e.jsx(be,{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:d.name})]}),e.jsx(R,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"md:col-span-3 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group",children:[e.jsx("img",{src:a.cover_image_url||a.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80",alt:d.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"})]}),(se||D)&&e.jsxs("div",{className:"space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 md:w-5 md:h-5 text-primary"}),N("restaurants.foodPhilosophy","美食哲学")]}),e.jsx("div",{className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2",dangerouslySetInnerHTML:{__html:D}})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden sticky top-20 self-start",children:[e.jsx("div",{className:"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10",children:a.owner_avatar_url?e.jsx("img",{src:a.owner_avatar_url,alt:d.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70",children:w})})}),e.jsxs(S,{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap",children:[e.jsx(es,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1"}),N("restaurants.ownerStory","主理人")]})]})})}),e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-foreground",children:d.name}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1",children:N("restaurants.chef","大厨")})]}),e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2",children:[e.jsx(ze,{className:"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180"}),N("restaurants.ownerWords","主理人故事")]}),j?e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:O}),P&&e.jsx(kt,{ownerBio:j,ownerName:d.name,ownerAvatarUrl:a.owner_avatar_url,avatarFallback:w})]}):e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground/60 italic",children:N("restaurants.noBioYet","暂无简介")})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"})]})})]})})]})})]})},Dt=l.lazy(()=>Je(()=>import("./RestaurantComments-wP31hLFs.js").then(a=>a.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),St=({restaurant:a,localizedRestaurant:d,restaurantActivities:s,ratingCount:o,averageRating:x,onTakeawayClick:p})=>{const{t:h,i18n:_}=F(),{getLocalizedField:i}=Le(),[c,N]=l.useState(!1),[f,j]=l.useState(!1),D=l.useRef(null);return e.jsxs("div",{className:"relative bg-background",children:[e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:h("restaurants.gallery","美食图鉴")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Es,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),h("restaurants.photoWall","照片墙")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(os,{restaurantId:a.id,showGallery:a.show_dish_gallery!==!1}),a.website_url&&a.show_takeaway_button&&e.jsx("div",{className:"mt-6 md:mt-8 max-w-md mx-auto",children:e.jsxs(b,{className:"w-full h-10 md:h-12 text-sm md:text-base",size:"lg",onClick:p,children:[e.jsx(Bs,{className:"w-4 h-4 md:w-5 md:h-5 mr-2"}),h("restaurant.takeawayOrder")]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:h("restaurants.info","详情")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Re,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),h("restaurants.contactInfo","联系信息")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(z,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(R,{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[d.type.slice(0,3).map((w,k)=>e.jsx(S,{variant:"secondary",className:"text-xs md:text-sm",children:w},k)),e.jsxs(S,{variant:"secondary",className:"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20",children:[e.jsx(ts,{className:"w-3 h-3"}),h("admin.templateGhost","Virtual Restaurant")]}),o>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(ee,{className:"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent"}),e.jsxs("span",{className:"font-bold text-base md:text-lg",children:[x.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs md:text-sm ml-1",children:["(",o,")"]})]})]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"grid gap-3 md:gap-4",children:[s.length>0&&e.jsxs(M,{open:c,onOpenChange:N,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-gradient-to-r from-primary/5 to-transparent border border-primary/10",children:[e.jsx(ee,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:h("activities.title")}),!c&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-1.5 mt-1",children:[s.slice(0,2).map((w,k)=>e.jsx(S,{variant:"default",className:"text-white text-[10px] md:text-xs",style:{backgroundColor:w.badge_color||"hsl(var(--primary))"},children:we(w,_.language)},`activity-${k}`)),s.length>2&&e.jsxs(S,{variant:"secondary",className:"text-[10px] md:text-xs",children:["+",s.length-2]})]})]}),e.jsx($,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${c?"rotate-180":""}`})]})}),e.jsx(q,{className:"mt-2 md:mt-3 space-y-1.5 md:space-y-2",children:s.map((w,k)=>{const O=is(w,_.language);return e.jsxs(ie,{to:`/activity/${w.activity_id}`,className:"block p-2 md:p-3 rounded-md md:rounded-lg hover:bg-muted/80 transition-colors border border-transparent hover:border-primary/20",children:[e.jsx(S,{variant:"default",className:"text-white mr-1.5 md:mr-2 text-[10px] md:text-xs",style:{backgroundColor:w.badge_color||"hsl(var(--primary))"},children:we(w,_.language)}),e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground",children:[O||ls(w,_.language)," ... →"]})]},`activity-detail-${k}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:h("restaurants.productionAddress")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words",children:a.address})]})]}),a.phone&&e.jsxs("a",{href:`tel:${a.phone}`,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group",children:[e.jsx(as,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:h("restaurant.phone")}),e.jsx("p",{className:"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1",children:a.phone})]})]}),a&&(i(a,"announcement")||a.announcement_zh)&&e.jsxs(M,{open:f,onOpenChange:j,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50",children:[e.jsx(Z,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:h("restaurant.announcement")}),e.jsx($,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${f?"rotate-180":""}`})]})}),e.jsx(q,{className:"mt-2 md:mt-3",children:e.jsx("div",{className:"p-3 md:p-4 rounded-md md:rounded-lg bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-xs md:text-sm text-foreground whitespace-pre-wrap leading-relaxed",children:i(a,"announcement")||a.announcement_zh})})})]})]})]})]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:h("restaurants.rating","评分")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ee,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),h("restaurants.rateUs","给我们评分")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(z,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(R,{className:"p-4 md:p-6 lg:p-8",children:e.jsx(ns,{restaurantId:a.id})})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:h("restaurants.reviews","评价")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Z,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),h("restaurants.customerReviews","用户评价")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(z,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(R,{className:"p-4 md:p-6 lg:p-8",ref:D,children:e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-8 md:py-12",children:e.jsx(le,{className:"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary"})}),children:e.jsx(Dt,{restaurantId:a.id})})})})]})})]})};function zt({brandId:a}){const{t:d,i18n:s}=F(),[o,x]=l.useState(!1),{data:p,isLoading:h}=Nt(a);if(h||!p)return null;const _=()=>{switch(s.language){case"zh":return p.intro_zh;case"pt":return p.intro_pt;default:return p.intro_en||p.intro_zh}},i=f=>{switch(s.language){case"zh":return f.content_zh;case"pt":return f.content_pt;default:return f.content_en||f.content_zh}},c=_(),N=p.content_blocks&&p.content_blocks.length>0;return!c&&!N?null:e.jsxs(M,{open:o,onOpenChange:x,className:"mt-4",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:d("brand.aboutUs")})]}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${o?"rotate-180":""}`})]})}),e.jsx(q,{children:e.jsxs("div",{className:"p-4 mt-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"space-y-4",children:N&&p.content_blocks.map((f,j)=>{const D=i(f),w=f.type==="image"&&j===0,k=f.type==="image"&&j===p.content_blocks.length-1;return e.jsxs("div",{children:[f.type==="text"&&D&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:D}}),f.type==="image"&&f.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:f.url,alt:f.alt||"",className:w?"w-16 h-16 object-contain rounded-lg":k?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},f.id)})}),c&&!N&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:c}})]})})]})}const Rt=l.lazy(()=>Je(()=>import("./RestaurantComments-wP31hLFs.js").then(a=>a.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),oa=()=>{const{id:a}=Ws(),d=Us(),{t:s,i18n:o}=F(),{user:x}=Ss(),{localizeRestaurant:p,getLocalizedField:h}=Le(),_=Xe(),i=l.useRef(null),c=l.useRef(null),[N,f]=l.useState(null),[j,D]=l.useState(!1),[w,k]=l.useState(!0),[O,P]=l.useState(!1),[I,se]=l.useState(!1),[u,oe]=l.useState(!0),[de,ds]=l.useState(!0),[cs,Ot]=l.useState(!1),Ne=l.useRef(null),ve=l.useRef(null),[ms,ye]=l.useState(!1),[Te,E]=l.useState(!1),[$e,te]=l.useState(!1),[xs,hs]=l.useState(!1),_e=Hs(),L=Ks(),{share:Me,DrawerComponent:us}=ot(),ps=l.useCallback(async()=>{L.removeQueries({queryKey:["restaurant",a]}),L.removeQueries({queryKey:["comments",a]}),L.removeQueries({queryKey:["restaurant-activities",a]}),L.removeQueries({queryKey:["dish-images",a]}),await Promise.all([L.invalidateQueries({queryKey:["restaurant",a]}),L.invalidateQueries({queryKey:["comments",a]}),L.invalidateQueries({queryKey:["restaurant-activities",a]}),L.invalidateQueries({queryKey:["dish-images",a]})])},[L,a]);it({pageType:"restaurant",targetId:a});const Ae=d.state?.fromActivity,gs=d.state?.from==="admin",fs=d.state?.from==="profile",ke=gs?"/admin/restaurants":fs?"/profile":Ae?`/activity/${Ae}`:"/restaurants",{data:t,isLoading:js}=Js(a),{data:ws=[]}=Zs(),{data:ce}=rs(a,"restaurant",{enabled:de}),qe=et(),{role:It,isAdmin:me}=zs(),{data:bs=[]}=dt(),{data:xe=[]}=_t(a),he=t&&bs.some(r=>r.id===t.id),v=t?p(t):null,Fe=t?ws.includes(t.id):!1;l.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const W=l.useMemo(()=>{const r={};return ce?.forEach(n=>{n.price_range&&(r[n.price_range]||(r[n.price_range]={count:0,latestDate:n.created_at}),r[n.price_range].count+=1,n.created_at>r[n.price_range].latestDate&&(r[n.price_range].latestDate=n.created_at))}),r},[ce]),Pe=l.useMemo(()=>W?Object.values(W).reduce((r,n)=>r+n.count,0):0,[W]),Ee=l.useMemo(()=>!W||Pe<10?null:Object.entries(W).sort(([,n],[,y])=>y.count!==n.count?y.count-n.count:y.latestDate.localeCompare(n.latestDate))[0]?.[0]||null,[W,Pe]),{ratingCount:ue,averageRating:Be}=l.useMemo(()=>{const r=ce?.filter(g=>g.rating_value)||[],n=r.length,y=n>0?r.reduce((g,C)=>g+(C.rating_value||0),0)/n:0;return{ratingCount:n,averageRating:y}},[ce]);l.useEffect(()=>{t&&tt().then(r=>{const n=at(r.coords.latitude,r.coords.longitude,t.lat,t.lng);f(n)}).catch(()=>{f(null)})},[t]);const Ge=l.useCallback(()=>{!x||!t||qe.mutate(t.id)},[x,t,qe]),pe=l.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),je.success(s("common.linkCopied"))}catch(r){console.error("Error copying link:",r),je.error(s("common.shareError"))}},[s]),Ce=l.useCallback(async()=>{!t||!v||Me({title:v.name,text:`${v.name} - Xiaoxiong Market

${v.description||v.address}`,url:window.location.href},()=>{je.success(s("common.shareSuccess"))})},[t,v,Me,s]),ae=l.useCallback(r=>{if(!t||!v)return;const n=encodeURIComponent(window.location.href),y=encodeURIComponent(v.name);let g="";switch(r){case"whatsapp":g=`https://wa.me/?text=${y}%20${n}`;break;case"facebook":g=`https://www.facebook.com/sharer/sharer.php?u=${n}`;break;case"twitter":g=`https://twitter.com/intent/tweet?text=${y}&url=${n}`;break;case"telegram":g=`https://t.me/share/url?url=${n}&text=${y}`;break;case"wechat":pe(),je.info(s("common.shareVia")+" WeChat");return;default:return}We()?window.location.href=g:window.open(g,"_blank","width=600,height=400")},[t,v,pe,s]);return l.useEffect(()=>{const r=new IntersectionObserver(y=>{y.forEach(g=>{g.isIntersecting&&!u&&oe(!0)})},{rootMargin:"100px"}),n=new IntersectionObserver(y=>{y.forEach(g=>{g.isIntersecting&&!de&&ds(!0)})},{rootMargin:"200px"});return Ne.current&&r.observe(Ne.current),ve.current&&n.observe(ve.current),()=>{r.disconnect(),n.disconnect()}},[u,de]),l.useEffect(()=>{if(!i.current||!t||!u||!w||c.current)return;const r="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!ne.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:Rs(),isIOSWebView:We(),userAgent:navigator.userAgent});return}const n=()=>{if(!i.current)return;const y=i.current.getBoundingClientRect();if(y.width===0||y.height===0){setTimeout(n,100);return}try{ne.accessToken=r,c.current=new ne.Map({container:i.current,style:"mapbox://styles/mapbox/light-v11",center:[t.lng,t.lat],zoom:15,cooperativeGestures:!0}),c.current.on("error",C=>{console.error("[RestaurantDetail Map] Map error:",C)});const g=document.createElement("div");g.style.backgroundImage=`url(${nt})`,g.style.width="40px",g.style.height="40px",g.style.backgroundSize="contain",g.style.backgroundRepeat="no-repeat",g.style.backgroundPosition="center",g.style.cursor="pointer",new ne.Marker({element:g}).setLngLat([t.lng,t.lat]).addTo(c.current),c.current.addControl(new ne.NavigationControl)}catch(g){console.error("[RestaurantDetail Map] Failed to initialize map:",g)}};return setTimeout(n,50),()=>{c.current?.remove(),c.current=null}},[t,u,w]),l.useEffect(()=>{if(w&&c.current){const r=setTimeout(()=>{c.current?.resize(),t&&c.current?.setCenter([t.lng,t.lat])},350);return()=>clearTimeout(r)}},[w,t]),js?e.jsx(vt,{}):!t||!v?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(b,{asChild:!0,className:"mt-4",children:e.jsx(ie,{to:ke,children:s("common.back")})})]})}):t.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Ct,{restaurant:t,localizedRestaurant:v,backUrl:ke,user:x,isFavorite:Fe,onToggleFavorite:Ge,onShare:()=>{if(!x){E(!0);return}_&&navigator.share?Ce():pe()},onReport:()=>{},showEditButton:he||me,editButton:(he||me)&&t?e.jsx(Qe,{restaurant:t,trigger:e.jsx(b,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(He,{className:"w-5 h-5"})})}):null,reportButton:t?e.jsx(Ve,{targetType:"restaurant",targetId:t.id,onLoginRequired:()=>E(!0),trigger:e.jsx(b,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(Ke,{className:"w-5 h-5"})})}):null}),e.jsx(St,{restaurant:t,localizedRestaurant:v,restaurantActivities:xe,ratingCount:ue,averageRating:Be,onTakeawayClick:()=>te(!0)}),e.jsx(U,{open:$e,onOpenChange:te,children:e.jsxs(H,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(K,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(De,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(V,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(Q,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(Y,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(B,{onClick:()=>{try{let r=t.website_url;if(x){const n=new URL(t.website_url);n.searchParams.set("user_id",x.id),r=n.toString()}re(r)}catch{re(t.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(X,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(U,{open:Te,onOpenChange:E,children:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(V,{children:s("activities.loginRequired")}),e.jsx(Q,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(Y,{children:[e.jsx(X,{children:s("common.cancel")}),e.jsx(B,{onClick:()=>_e("/auth"),children:s("activities.goToLogin")})]})]})})]}):e.jsx(lt,{onRefresh:ps,children:e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:t.cover_image_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:v.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(b,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(ie,{to:ke,children:e.jsx(Ie,{className:"w-5 h-5"})})}),x&&e.jsx(b,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:Ge,children:e.jsx(ss,{className:`w-5 h-5 ${Fe?"fill-destructive text-destructive":""}`})}),_&&navigator.share?e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${x?"right-16":"right-4"}`,onClick:()=>{if(!x){E(!0);return}Ce()},children:e.jsx(J,{className:"w-5 h-5"})}):e.jsxs(Os,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${x?"right-16":"right-4"}`,onClick:r=>{x||(r.preventDefault(),E(!0))},children:e.jsx(J,{className:"w-5 h-5"})})}),e.jsxs(Ls,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(G,{onClick:Ce,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(Ue,{})]}),e.jsxs(G,{onClick:()=>ae("wechat"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(G,{onClick:()=>ae("whatsapp"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(G,{onClick:()=>ae("facebook"),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(G,{onClick:()=>ae("twitter"),children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(G,{onClick:()=>ae("telegram"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(Ue,{}),e.jsxs(G,{onClick:pe,children:[e.jsx(Vs,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(he||me)&&t&&e.jsx(Qe,{restaurant:t,trigger:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 ${x?"right-28":"right-16"}`,children:e.jsx(He,{className:"w-5 h-5"})})}),t&&e.jsx(Ve,{targetType:"restaurant",targetId:t.id,onLoginRequired:()=>E(!0),trigger:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 ${he||me?x?"right-40":"right-28":x?"right-28":"right-16"}`,children:e.jsx(Ke,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(z,{className:"shadow-large",children:[e.jsx(T,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:v.type.slice(0,3).map((r,n)=>e.jsx(S,{variant:"secondary",children:r},n))}),e.jsx(be,{className:"text-3xl mb-2",children:v.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[N!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[N.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:`w-5 h-5 ${ue>0?"fill-accent text-accent":"text-muted-foreground"}`}),ue>0?e.jsxs("span",{className:"font-semibold text-base",children:[Be.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",ue,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),Ee&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Qs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:Ee})]})]}),t.brand_id&&e.jsx(zt,{brandId:t.brand_id}),v.description&&v.description.replace(/<[^>]*>/g,"").trim()!==""&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3",dangerouslySetInnerHTML:{__html:v.description}})]})})}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[xe.length>0&&e.jsxs(M,{open:I,onOpenChange:se,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ee,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!I&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:xe.map((r,n)=>e.jsx(S,{variant:"default",className:"text-white",style:{backgroundColor:r.badge_color||"#9b87f5"},children:we(r,o.language)},`activity-${n}`))})]}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${I?"rotate-180":""}`})]})}),e.jsx(q,{className:"mt-3 space-y-2",children:xe.map((r,n)=>{const y=is(r,o.language);return e.jsxs(ie,{to:`/activity/${r.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(S,{variant:"default",className:"text-white mr-2",style:{backgroundColor:r.badge_color||"#9b87f5"},children:we(r,o.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[y||ls(r,o.language)," ... →"]})]},`activity-detail-${n}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Re,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:t.address}),t.template==="ghost"&&e.jsx(S,{variant:"secondary",className:"text-xs",children:s("restaurants.ghostKitchen")})]})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(as,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:t.phone})]})]}),t.opening_hours&&t.template!=="ghost"&&e.jsxs(M,{open:j,onOpenChange:D,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ys,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!j&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",st(t.opening_hours)]})]}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${j?"rotate-180":""}`})]})}),e.jsx(q,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const r=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},y=r[new Date().getDay()===0?6:new Date().getDay()-1];return r.map(g=>{const C=t.opening_hours[g],ge=g===y,Ns=s(`restaurant.${n[g]}`);let fe="N/A";return C&&(C.closed?fe=s("restaurant.closed"):C.splitShift?fe=`${C.open} - ${C.close}, ${C.open2} - ${C.close2}`:fe=`${C.open} - ${C.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${ge?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${ge?"text-primary":"text-foreground"}`,children:[Ns,ge&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${ge?"text-primary font-semibold":"text-muted-foreground"} ${C?.closed?"italic":""}`,children:fe})]},g)})})()})})]})]}),t&&(h(t,"announcement")||t.announcement_zh)&&e.jsxs(M,{open:O,onOpenChange:P,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Z,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${O?"rotate-180":""}`})]})}),e.jsx(q,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:h(t,"announcement")||t.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[t.template!=="ghost"&&e.jsxs(b,{variant:"secondary",className:"w-full",onClick:()=>ye(!0),children:[e.jsx(Se,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),t.website_url&&(t.show_takeaway_button||t.show_booking_button&&t.template!=="ghost")&&e.jsxs(b,{className:"w-full",onClick:()=>te(!0),children:[e.jsx(Xs,{className:"w-4 h-4 mr-2"}),s("restaurant.orderOrBook","外卖/订台")]})]}),e.jsx(U,{open:ms,onOpenChange:ye,children:e.jsxs(H,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(K,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Se,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(V,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(Q,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:v.name})})]})]}),e.jsxs(Y,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(B,{onClick:()=>{rt(t.lat,t.lng,v.name),ye(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(X,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(U,{open:xs,onOpenChange:hs,children:e.jsxs(H,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(K,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(De,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(V,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(Q,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(Y,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(B,{onClick:()=>{const r=new URL(t.website_url);x&&r.searchParams.set("user_id",x.id);const n=r.toString();re(n)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[cs?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(X,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx(U,{open:$e,onOpenChange:te,children:e.jsxs(H,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(K,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(De,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(V,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(Q,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:x?s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面"):s("restaurant.orderOrBookLoginRequired","请先登录后再进入餐厅私域页面")})]})]}),e.jsxs(Y,{className:"relative flex-col gap-2 pt-4 mt-1",children:[x?e.jsx(B,{onClick:()=>{try{let r=t.website_url;if(x){const n=new URL(t.website_url);n.searchParams.set("user_id",x.id),r=n.toString()}re(r)}catch{re(t.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}):e.jsx(B,{onClick:()=>{te(!1),_e("/auth",{state:{from:d.pathname}})},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("auth.login","登录")}),e.jsx(X,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(os,{restaurantId:t.id,showGallery:t.show_dish_gallery!==!1}),t.template!=="ghost"&&e.jsx("div",{ref:Ne,children:e.jsxs(M,{open:w,onOpenChange:k,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(A,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx($,{className:`w-5 h-5 text-muted-foreground transition-transform ${w?"rotate-180":""}`})]})}),e.jsx(q,{children:u?e.jsx("div",{ref:i,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Oe,{}),e.jsx(ns,{restaurantId:t.id}),e.jsx(Oe,{}),e.jsx("div",{ref:ve,children:de?e.jsx(l.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(Rt,{restaurantId:t.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(U,{open:Te,onOpenChange:E,children:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(V,{children:s("activities.loginRequired")}),e.jsx(Q,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(Y,{children:[e.jsx(X,{children:s("common.cancel")}),e.jsx(B,{onClick:()=>_e("/auth"),children:s("activities.goToLogin")})]})]})}),us]})})};export{oa as default};
//# sourceMappingURL=RestaurantDetail-DpHUbVXk.js.map
