import{j as e}from"./vendor-ui-DAmPMpEA.js";import{r as g}from"./vendor-react-iAJ0IrSD.js";import{Q as b,a3 as xe,D as he,aC as ue,B as z,as as se,a as fe,b as pe,c as ge,bi as te,R as le,S as ye,av as je,aw as ve,ax as we,G as $,bc as Ne,j as ce,cc as be,cj as _e,ck as Se,s as De,g as D,t as C,T as k,v as M,aV as Ce,q as ke,i as Me,bA as X,bm as Ve,bN as Y,ab as Ee,b6 as Le}from"./index-COqZhysY.js";import{a as ae}from"./vendor-query-BlSVl3IQ.js";import{s as ne}from"./startOfDay-BXeLCDGF.js";import{s as Ae}from"./subDays-BNNOJnCs.js";import{f as F}from"./format-BmunoZQS.js";import{u as oe}from"./vendor-i18n-DxKeo2S1.js";import{R as K,L as Z,C as G,X as H,Y as W,T as B,b as Q,P as Te,e as Oe,f as ze,B as J,d as ee,a as re}from"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-KNAP0qdW.js";const Fe=n=>{if(!n)return"direct";try{return new URL(n).hostname.replace("www.","")}catch{return"unknown"}},Re=(n=30)=>ae({queryKey:["analytics",n],queryFn:async()=>{let h=null;n===1?h=ne(new Date).toISOString():n>1&&(h=ne(Ae(new Date,n-1)).toISOString());const v=1e3;let N=[],y=0,_=!0;for(;_;){let a=b.from("page_views").select("*").order("created_at",{ascending:!1}).range(y*v,(y+1)*v-1);h&&(a=a.gte("created_at",h));const{data:s,error:t}=await a;if(t)throw t;s&&s.length>0?(N=N.concat(s),_=s.length===v,y++):_=!1}const u=N,w=u.length,A=new Set(u.map(a=>a.visitor_id)).size,E={};u.forEach(a=>{E[a.page_type]=(E[a.page_type]||0)+1});const V=new Map;u.forEach(a=>{const s=F(new Date(a.created_at),"yyyy-MM-dd");V.has(s)||V.set(s,{views:0,visitors:new Set});const t=V.get(s);t.views++,t.visitors.add(a.visitor_id)});const I=Array.from(V.entries()).map(([a,s])=>({date:a,views:s.views,uniqueVisitors:s.visitors.size})).sort((a,s)=>a.date.localeCompare(s.date)),T=new Map;u.forEach(a=>{const s=Fe(a.referer);T.set(s,(T.get(s)||0)+1)});const R=Array.from(T.entries()).map(([a,s])=>({domain:a,count:s,percentage:w>0?s/w*100:0})).sort((a,s)=>s.count-a.count),S=new Map;u.forEach(a=>{const s=a.country||"unknown";S.set(s,(S.get(s)||0)+1)});const q=Array.from(S.entries()).map(([a,s])=>({location:a,count:s,percentage:w>0?s/w*100:0})).sort((a,s)=>s.count-a.count),i=new Map;u.forEach(a=>{const s=a.city||"unknown";i.set(s,(i.get(s)||0)+1)});const O=Array.from(i.entries()).map(([a,s])=>({location:a,count:s,percentage:w>0?s/w*100:0})).sort((a,s)=>s.count-a.count),l=new Map;u.forEach(a=>{const s=F(new Date(a.created_at),"yyyy-MM-dd"),t=a.country||"unknown";l.has(t)||l.set(t,new Map);const o=l.get(t);o.set(s,(o.get(s)||0)+1)});const r=[];l.forEach((a,s)=>{a.forEach((t,o)=>{r.push({date:o,location:s,views:t})})}),r.sort((a,s)=>a.date.localeCompare(s.date));const d=new Map;u.forEach(a=>{const s=F(new Date(a.created_at),"yyyy-MM-dd"),t=a.city||"unknown";d.has(t)||d.set(t,new Map);const o=d.get(t);o.set(s,(o.get(s)||0)+1)});const m=[];d.forEach((a,s)=>{a.forEach((t,o)=>{m.push({date:o,location:s,views:t})})}),m.sort((a,s)=>a.date.localeCompare(s.date));const f=new Map;u.filter(a=>a.page_type==="restaurant"&&a.target_id).forEach(a=>{f.set(a.target_id,(f.get(a.target_id)||0)+1)});const p=Array.from(f.entries()).sort((a,s)=>s[1]-a[1]).slice(0,10);let j=[];if(p.length>0){const{data:a}=await b.from("restaurants").select("id, name").in("id",p.map(s=>s[0]));j=p.map(([s,t])=>({id:s,name:a?.find(o=>o.id===s)?.name||"Unknown",views:t}))}const L=new Map;u.filter(a=>a.page_type==="activity"&&a.target_id).forEach(a=>{L.set(a.target_id,(L.get(a.target_id)||0)+1)});const x=Array.from(L.entries()).sort((a,s)=>s[1]-a[1]).slice(0,10);let P=[];if(x.length>0){const{data:a}=await b.from("activities").select("id, title_zh, title_en, title_pt").in("id",x.map(s=>s[0]));P=x.map(([s,t])=>{const o=a?.find(me=>me.id===s);return{id:s,title:o?.title_zh||o?.title_en||"Unknown",views:t}})}return{totalViews:w,uniqueVisitors:A,viewsByPage:E,dailyViews:I,topRestaurants:j,topActivities:P,refererStats:R,countryStats:q,cityStats:O,countryDailyViews:r,cityDailyViews:m}}}),de=()=>{const[n,h]=g.useState(new Set),[v,N]=g.useState(new Set),[y,_]=g.useState([]),[u,w]=g.useState(null),[c,A]=g.useState(null);g.useEffect(()=>{console.log("Initializing online users observer...");const l=b.channel("online-users");return l.on("presence",{event:"sync"},()=>{const r=l.presenceState(),d=new Set;Object.keys(r).forEach(m=>{d.add(m)}),h(d),console.log("Presence sync - online users:",Array.from(d))}).on("presence",{event:"join"},({key:r,newPresences:d})=>{console.log("User joined:",r,d),h(m=>new Set([...m,r]))}).on("presence",{event:"leave"},({key:r,leftPresences:d})=>{console.log("User left:",r,d),h(m=>{const f=new Set(m);return f.delete(r),f})}).subscribe(r=>{console.log("Presence channel status:",r)}),w(l),()=>{console.log("Cleaning up online users observer..."),b.removeChannel(l)}},[]),g.useEffect(()=>{console.log("Initializing online visitors observer...");const l=b.channel("online-visitors");return l.on("presence",{event:"sync"},()=>{const r=l.presenceState(),d=new Set,m=[];Object.entries(r).forEach(([f,p])=>{if(d.add(f),p&&p.length>0){const j=p[0];m.push({visitor_id:f,online_at:j.online_at,country:j.country,city:j.city})}}),N(d),_(m),console.log("Visitor presence sync - online visitors:",Array.from(d))}).on("presence",{event:"join"},({key:r,newPresences:d})=>{if(console.log("Visitor joined:",r,d),N(m=>new Set([...m,r])),d&&d.length>0){const m=d[0];_(f=>[...f.filter(p=>p.visitor_id!==r),{visitor_id:r,online_at:m.online_at,country:m.country,city:m.city}])}}).on("presence",{event:"leave"},({key:r,leftPresences:d})=>{console.log("Visitor left:",r,d),N(m=>{const f=new Set(m);return f.delete(r),f}),_(m=>m.filter(f=>f.visitor_id!==r))}).subscribe(r=>{console.log("Visitor presence channel status:",r)}),A(l),()=>{console.log("Cleaning up online visitors observer..."),b.removeChannel(l)}},[]);const{data:E,isLoading:V,refetch:I}=ae({queryKey:["online-users-details",Array.from(n).sort().join(",")],queryFn:async()=>{if(n.size===0)return[];const l=Array.from(n);console.log("Fetching details for online users:",l);const{data:r,error:d}=await b.from("user_presence").select("*").in("user_id",l);d&&console.error("Error fetching presence:",d);const{data:m,error:f}=await b.rpc("get_public_profiles",{user_ids:l});f&&console.error("Error fetching profiles:",f);const{data:p,error:j}=await b.from("user_roles").select("user_id, role").in("user_id",l);j&&console.error("Error fetching roles:",j);const L=new Map((r||[]).map(a=>[a.user_id,a])),x=new Map((m||[]).map(a=>[a.id,a])),P=new Map((p||[]).map(a=>[a.user_id,a.role]));return l.map(a=>{const s=L.get(a),t=x.get(a);return{user_id:a,is_online:!0,last_seen:s?.last_seen||new Date().toISOString(),ip_address:s?.ip_address,city:s?.city,country:s?.country,profile:t?{display_name:t.display_name,avatar_url:t.avatar_url}:void 0,role:P.get(a)}})},enabled:n.size>0,staleTime:1e4}),{data:T,refetch:R}=ae({queryKey:["online-users-db-fallback"],queryFn:async()=>{const l=new Date(Date.now()-12e4).toISOString(),{data:r,error:d}=await b.from("user_presence").select("*").gte("last_seen",l).order("last_seen",{ascending:!1});if(d)return console.error("Error fetching DB presence:",d),[];if(!r||r.length===0)return[];const m=r.map(x=>x.user_id),{data:f}=await b.rpc("get_public_profiles",{user_ids:m}),{data:p}=await b.from("user_roles").select("user_id, role").in("user_id",m),j=new Map((f||[]).map(x=>[x.id,x])),L=new Map((p||[]).map(x=>[x.user_id,x.role]));return r.map(x=>({user_id:x.user_id,is_online:x.is_online,last_seen:x.last_seen,ip_address:x.ip_address,city:x.city,country:x.country,profile:j.get(x.user_id)?{display_name:j.get(x.user_id).display_name,avatar_url:j.get(x.user_id).avatar_url}:void 0,role:L.get(x.user_id)}))},refetchInterval:3e4}),S=(()=>{const l=new Map;return(T||[]).forEach(r=>{l.set(r.user_id,r)}),(E||[]).forEach(r=>{l.set(r.user_id,{...r,is_online:!0})}),n.forEach(r=>{l.has(r)||l.set(r,{user_id:r,is_online:!0,last_seen:new Date().toISOString()})}),Array.from(l.values())})(),q=S.length,i=v.size;return{onlineUsers:S,onlineCount:q,onlineVisitors:y,visitorCount:i,isLoading:V,refetch:async()=>{await Promise.all([I(),R()])}}},Ue=({trigger:n})=>{const{t:h,i18n:v}=oe(),[N,y]=g.useState(!1),[_,u]=g.useState(!1),{onlineUsers:w,onlineCount:c,isLoading:A,refetch:E}=de(),V=g.useCallback(async()=>{u(!0);try{await E(),xe.success(h("common.refreshed","已刷新"))}finally{u(!1)}},[E,h]),I=()=>{switch(v.language){case"zh":return Se;case"pt":return _e;default:return be}},T=i=>{switch(i){case"admin":return"destructive";case"supervisor":return"default";case"merchant":return"secondary";default:return"outline"}},R=i=>{switch(i){case"admin":return h("admin.role.admin","管理员");case"supervisor":return h("admin.role.supervisor","主管");case"merchant":return h("admin.role.merchant","商家");default:return h("admin.role.user","用户")}},S=(i,O)=>i&&O?`${i}, ${O}`:i||O||null,q=i=>i.city||i.country||i.ip_address;return e.jsxs(he,{open:N,onOpenChange:y,children:[e.jsx(ue,{asChild:!0,children:n||e.jsxs(z,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),h("admin.onlineUsers.viewOnline","查看在线用户")]})}),e.jsxs(fe,{className:"max-w-md",children:[e.jsx(pe,{children:e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-3 h-3 fill-green-500 text-green-500"}),h("admin.onlineUsers.title","在线用户")," (",c,")"]})}),e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs(z,{variant:"ghost",size:"sm",onClick:V,disabled:A||_,children:[e.jsx(le,{className:`w-4 h-4 mr-1 ${A||_?"animate-spin":""}`}),h("common.refresh","刷新")]})}),e.jsx(ye,{className:"h-[400px] pr-4",children:A?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("common.loading","加载中...")}):w.length===0?e.jsx("div",{className:"flex items-center justify-center h-32 text-muted-foreground",children:h("admin.onlineUsers.noOnline","暂无在线用户")}):e.jsx("div",{className:"space-y-3",children:w.map(i=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(je,{className:"h-10 w-10",children:[e.jsx(ve,{src:i.profile?.avatar_url||void 0}),e.jsx(we,{children:i.profile?.display_name?.charAt(0)||"?"})]}),e.jsx(te,{className:`absolute -bottom-0.5 -right-0.5 w-3 h-3 ${i.is_online?"fill-green-500 text-green-500":"fill-yellow-500 text-yellow-500"}`})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium truncate",children:i.profile?.display_name||h("common.anonymous","匿名用户")}),e.jsx($,{variant:T(i.role),className:"text-xs",children:R(i.role)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.is_online?h("admin.onlineUsers.online","在线中"):h("admin.onlineUsers.lastSeen","最后活跃 {{time}}",{time:Ne(new Date(i.last_seen),{addSuffix:!0,locale:I()})})}),q(i)&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-muted-foreground",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsxs("span",{className:"truncate",children:[S(i.city,i.country)&&e.jsx("span",{children:S(i.city,i.country)}),i.ip_address&&e.jsxs(e.Fragment,{children:[S(i.city,i.country)&&e.jsx("span",{className:"mx-1",children:"·"}),e.jsx("span",{className:"font-mono text-[10px]",children:i.ip_address})]})]})]})]})]},i.user_id))})})]})]})},ie=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(var(--muted-foreground))"],U=["hsl(var(--primary))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],Xe=()=>{const{t:n,i18n:h}=oe(),[v,N]=g.useState(30),[y,_]=g.useState([]),[u,w]=g.useState([]),{data:c,isLoading:A,refetch:E,isRefetching:V}=Re(v),{onlineCount:I,visitorCount:T,isLoading:R}=de(),S={home:n("analytics.pageTypes.home","首页"),restaurant:n("analytics.pageTypes.restaurant","餐厅详情"),activity:n("analytics.pageTypes.activity","活动详情"),restaurants:n("analytics.pageTypes.restaurants","餐厅列表"),activities:n("analytics.pageTypes.activities","活动列表"),map:n("analytics.pageTypes.map","地图"),profile:n("analytics.pageTypes.profile","个人资料"),auth:n("analytics.pageTypes.auth","登录/注册"),"join-us":n("analytics.pageTypes.joinUs","加入我们"),other:n("analytics.pageTypes.other","其他")},q={direct:n("analytics.referer.direct","直接访问"),unknown:n("analytics.referer.unknown","未知来源")},i={unknown:n("analytics.location.unknown","未知地区")},O=s=>q[s]||s,l=s=>i[s]||s,r=g.useMemo(()=>c?.countryStats?.slice(0,10).map(s=>s.location)||[],[c?.countryStats]),d=g.useMemo(()=>c?.cityStats?.slice(0,10).map(s=>s.location)||[],[c?.cityStats]),m=g.useMemo(()=>{if(!c?.countryDailyViews||y.length===0)return[];const s=new Map;return c.countryDailyViews.filter(t=>y.includes(t.location)).forEach(t=>{s.has(t.date)||s.set(t.date,{}),s.get(t.date)[t.location]=t.views}),Array.from(s.entries()).map(([t,o])=>({date:t,...o})).sort((t,o)=>t.date.localeCompare(o.date))},[c?.countryDailyViews,y]),f=g.useMemo(()=>{if(!c?.cityDailyViews||u.length===0)return[];const s=new Map;return c.cityDailyViews.filter(t=>u.includes(t.location)).forEach(t=>{s.has(t.date)||s.set(t.date,{}),s.get(t.date)[t.location]=t.views}),Array.from(s.entries()).map(([t,o])=>({date:t,...o})).sort((t,o)=>t.date.localeCompare(o.date))},[c?.cityDailyViews,u]),p=c?.viewsByPage?Object.entries(c.viewsByPage).map(([s,t])=>({name:S[s]||s,value:t})):[],j=c?.refererStats?.slice(0,10).map(s=>({name:O(s.domain),value:s.count,percentage:s.percentage.toFixed(1)}))||[],L=c?.countryStats?.slice(0,10).map(s=>({name:l(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],x=c?.cityStats?.slice(0,10).map(s=>({name:l(s.location),value:s.count,percentage:s.percentage.toFixed(1)}))||[],P=s=>{_(t=>t.includes(s)?t.filter(o=>o!==s):t.length<5?[...t,s]:t)},a=s=>{w(t=>t.includes(s)?t.filter(o=>o!==s):t.length<5?[...t,s]:t)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:n("analytics.title","访问统计")}),e.jsx("p",{className:"text-muted-foreground",children:n("analytics.description","网站访问数据分析")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(z,{variant:v===1?"default":"outline",size:"sm",onClick:()=>N(1),children:n("analytics.today","今日")}),[7,30,90].map(s=>e.jsxs(z,{variant:v===s?"default":"outline",size:"sm",onClick:()=>N(s),children:[s,n("analytics.days","天")]},s)),e.jsx(z,{variant:v===0?"default":"outline",size:"sm",onClick:()=>N(0),children:n("analytics.all","所有")})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>E(),disabled:V,children:[e.jsx(le,{className:`w-4 h-4 mr-1 ${V?"animate-spin":""}`}),n("common.refresh","刷新")]})]})]}),A?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,t)=>e.jsx(De,{className:"h-32"},t))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs(D,{className:"border-green-500/50 bg-green-500/5",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs(k,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(te,{className:"h-3 w-3 fill-green-500 text-green-500"}),n("analytics.onlineUsers","在线用户")]}),e.jsx(se,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex items-baseline gap-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:R?"-":I}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx("span",{className:"text-sm",children:"+"}),e.jsx("span",{className:"text-lg font-semibold text-blue-600 dark:text-blue-400",children:R?"-":T}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n("analytics.visitors","访客")})]})]}),e.jsx("div",{className:"mt-2",children:e.jsx(Ue,{trigger:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs text-green-600 dark:text-green-400 hover:text-green-700",children:[n("analytics.viewOnlineUsers","查看在线用户")," →"]})})})]})]}),e.jsxs(D,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:n("analytics.totalViews","总访问量")}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?.totalViews.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:v===0?n("analytics.allTime","所有时间"):v===1?n("analytics.today","今日"):n("analytics.lastNDays","最近{{days}}天",{days:v})})]})]}),e.jsxs(D,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:n("analytics.uniqueVisitors","独立访客")}),e.jsx(se,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:c?.uniqueVisitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("analytics.uniqueVisitorDesc","基于访客ID")})]})]}),e.jsxs(D,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:n("analytics.restaurantViews","餐厅浏览")}),e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(c?.viewsByPage?.restaurant||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("analytics.restaurantViewsDesc","餐厅详情页访问")})]})]}),e.jsxs(D,{children:[e.jsxs(C,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(k,{className:"text-sm font-medium",children:n("analytics.activityViews","活动浏览")}),e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(M,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(c?.viewsByPage?.activity||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("analytics.activityViewsDesc","活动详情页访问")})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),n("analytics.dailyTrend","每日访问趋势")]})}),e.jsx(M,{children:e.jsx("div",{className:"h-[300px]",children:c?.dailyViews&&c.dailyViews.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:c.dailyViews,children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(W,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(Q,{type:"monotone",dataKey:"views",stroke:"hsl(var(--primary))",strokeWidth:2,name:n("analytics.views","访问量")}),e.jsx(Q,{type:"monotone",dataKey:"uniqueVisitors",stroke:"hsl(var(--chart-2))",strokeWidth:2,name:n("analytics.uniqueVisitors","独立访客")})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:n("analytics.noData","暂无数据")})})})]}),e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),n("analytics.pageDistribution","页面访问分布")]})}),e.jsx(M,{children:e.jsx("div",{className:"h-[300px]",children:p.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Te,{children:[e.jsx(Oe,{data:p,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:t})=>`${s} ${(t*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:p.map((s,t)=>e.jsx(ze,{fill:ie[t%ie.length]},`cell-${t}`))}),e.jsx(B,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:n("analytics.noData","暂无数据")})})})]})]}),e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),n("analytics.refererStats","访问来源统计")]})}),e.jsx(M,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-[300px]",children:j.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(J,{data:j,layout:"vertical",children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{type:"number",className:"text-xs"}),e.jsx(W,{dataKey:"name",type:"category",width:120,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,t,o)=>[`${s} (${o.payload.percentage}%)`,n("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--primary))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:n("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto",children:c?.refererStats&&c.refererStats.length>0?c.refererStats.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:t<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:t+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[150px]",children:O(s.domain)})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.domain)):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:n("analytics.noData","暂无数据")})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),n("analytics.countryStats","国家/地区统计")]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:L.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(J,{data:L,layout:"vertical",children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{type:"number",className:"text-xs"}),e.jsx(W,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,t,o)=>[`${s} (${o.payload.percentage}%)`,n("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-2))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:n("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:c?.countryStats&&c.countryStats.length>0?c.countryStats.slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:t<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:t+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:l(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:n("analytics.noData","暂无数据")})})]})})]}),e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),n("analytics.cityStats","城市统计")]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-[200px]",children:x.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(J,{data:x,layout:"vertical",children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{type:"number",className:"text-xs"}),e.jsx(W,{dataKey:"name",type:"category",width:100,className:"text-xs",tick:{fontSize:11}}),e.jsx(B,{formatter:(s,t,o)=>[`${s} (${o.payload.percentage}%)`,n("analytics.views","访问量")],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(ee,{dataKey:"value",fill:"hsl(var(--chart-3))",radius:[0,4,4,0]})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:n("analytics.noData","暂无数据")})}),e.jsx("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:c?.cityStats&&c.cityStats.length>0?c.cityStats.slice(0,10).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{variant:t<3?"default":"secondary",className:"w-6 h-6 p-0 justify-center",children:t+1}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm truncate max-w-[120px]",children:l(s.location)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.count}),e.jsxs($,{variant:"outline",className:"text-xs",children:[s.percentage.toFixed(1),"%"]})]})]},s.location)):e.jsx("p",{className:"text-muted-foreground text-center py-4",children:n("analytics.noData","暂无数据")})})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),n("analytics.countryTrend","国家/地区访问趋势")]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map((s,t)=>e.jsx(z,{variant:y.includes(s)?"default":"outline",size:"sm",onClick:()=>P(s),className:"text-xs",style:y.includes(s)?{backgroundColor:U[y.indexOf(s)%U.length]}:{},children:l(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:m.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m,children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(W,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(re,{}),y.map((s,t)=>e.jsx(Q,{type:"monotone",dataKey:s,stroke:U[t%U.length],strokeWidth:2,name:l(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:y.length===0?n("analytics.selectLocations","请选择地区查看趋势"):n("analytics.noData","暂无数据")})})]})})]}),e.jsxs(D,{children:[e.jsx(C,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5"}),n("analytics.cityTrend","城市访问趋势")]})}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map((s,t)=>e.jsx(z,{variant:u.includes(s)?"default":"outline",size:"sm",onClick:()=>a(s),className:"text-xs",style:u.includes(s)?{backgroundColor:U[u.indexOf(s)%U.length]}:{},children:l(s)},s))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n("analytics.selectLocationsHint","选择最多5个地区查看趋势（点击选择/取消）")}),e.jsx("div",{className:"h-[250px]",children:f.length>0?e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:f,children:[e.jsx(G,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(H,{dataKey:"date",tickFormatter:s=>F(new Date(s),"MM/dd"),className:"text-xs"}),e.jsx(W,{className:"text-xs"}),e.jsx(B,{labelFormatter:s=>F(new Date(s),"yyyy-MM-dd"),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),e.jsx(re,{}),u.map((s,t)=>e.jsx(Q,{type:"monotone",dataKey:s,stroke:U[t%U.length],strokeWidth:2,name:l(s),dot:!1},s))]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-muted-foreground",children:u.length===0?n("analytics.selectLocations","请选择地区查看趋势"):n("analytics.noData","暂无数据")})})]})})]})]})]})]})};export{Xe as default};
//# sourceMappingURL=AdminAnalytics-Bmj1TpYH.js.map
