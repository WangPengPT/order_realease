const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-DOsTWL3Y.js","assets/vendor-react-DP7WA3kK.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/index-Bj9FRlJR.js","assets/vendor-supabase-B6TzwYo7.js","assets/index-CDr-E5Wr.css","assets/TranslatableText-DNzY250B.js","assets/input-otp-BP5Q7hds.js","assets/TranslateButton-DViyDDzF.js","assets/useSensitiveWords-ChlWN5Fi.js","assets/ImagePreviewModal-DrgFYvEL.js"])))=>i.map(i=>d[i]);
import{j as b,C as M,p as Q,q as E,F as Be,i as Ae,s as Et,a as Qe,B as y,S as $t,l as At,g as O,b as Ft,_ as ut,u as Bt,G as qt,J as nt,k as Vt,A as me,t as xe,v as ue,w as he,x as pe,y as ge,E as ae,o as ye,z as fe,K as Gt,L as Ut,M as Ht,N as re,O as lt}from"./index-Bj9FRlJR.js";import{j as e,p as B,a$ as we,bg as Wt,s as Kt,r as a,bh as Qt,bi as Xt,bb as Yt,aw as X,bj as Xe,W as ht,bk as pt,bl as Ue,H as Zt,I as Jt,z as es,B as ts,ar as ss,F as as,X as rs,bm as ne,bn as ns,bo as ls,bp as is,aY as os,aZ as cs,L as Ce,bq as je,be as gt,br as Ye,bs as ft,bt as He,bu as jt,bv as bt,bw as ds,bx as ms,b1 as xs,by as us,a_ as We,y as wt,b3 as be,aM as ke,bz as hs,aO as ps,u as gs,q as fs,w as $e,bA as it,bB as ot,bC as Ve,bD as js,aW as Ge,bE as bs,bf as ws,b6 as Ns}from"./vendor-react-DP7WA3kK.js";import{S as Ke}from"./separator-D0s6Tfaf.js";import{C as Y,a as Z,b as J}from"./collapsible-C3y7KMnR.js";import{d as vs,b as ys,c as _s}from"./useRestaurants-CvPeAGrl.js";import{u as Nt,T as ks,R as ct}from"./TranslatableText-DNzY250B.js";import{u as Ze}from"./useLocalizedContent-pJiq6loG.js";import{f as Cs}from"./timeUtils-pgRxO0UB.js";import{g as Ss,c as Ts,o as zs,m as Is}from"./geolocation-DRm3QMsJ.js";import{m as _e}from"./vendor-map-CvE3ASYw.js";import{P as Ds}from"./PullToRefresh-y3-WJnXU.js";import{u as Rs}from"./usePageView-Cr3BE4PJ.js";import{u as Ps}from"./ShareDrawer-1p54f-GK.js";import{u as Ls}from"./useActivityParticipation-VyJ6Laso.js";import{u as Ms,R as dt}from"./RestaurantFormDialog-D7YMlGwo.js";import{C as vt,a as yt,b as _t,c as kt,d as Ct}from"./carousel-d35QJSQP.js";import{I as Os}from"./ImagePreviewModal-DrgFYvEL.js";import{D as Es,a as $s,b as As,c as Fs,d as Bs}from"./drawer-Cyc_USpe.js";import{u as St}from"./useBrands-ksjzhREf.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-B6TzwYo7.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-BP5Q7hds.js";import"./TranslateButton-DViyDDzF.js";import"./checkbox-BQSwbWYJ.js";import"./switch-C7766DPk.js";import"./radio-group-Cvb6RBC_.js";import"./tabs-DVw3Tnh0.js";import"./RichTextEditor-TfWUZcI4.js";const qs=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(b,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(b,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(b,{className:"h-10 w-10 rounded-md"}),e.jsx(b,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(M,{className:"shadow-large",children:[e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(b,{className:"h-6 w-16 rounded-full"}),e.jsx(b,{className:"h-6 w-20 rounded-full"}),e.jsx(b,{className:"h-6 w-14 rounded-full"})]}),e.jsx(b,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(b,{className:"h-5 w-20"}),e.jsx(b,{className:"h-5 w-24"}),e.jsx(b,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"h-10 w-28 rounded-md"}),e.jsx(b,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-5 w-24"}),e.jsx(b,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{className:"h-8 w-24 rounded-full"}),e.jsx(b,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(b,{className:"h-5 w-full"}),e.jsx(b,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(b,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(b,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(b,{className:"h-5 w-40"}),e.jsx(b,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(M,{className:"mt-6 shadow-large",children:[e.jsx(Q,{children:e.jsx(b,{className:"h-6 w-20"})}),e.jsx(E,{children:e.jsx(b,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(M,{className:"mt-6 shadow-large",children:[e.jsx(Q,{children:e.jsx(b,{className:"h-6 w-24"})}),e.jsx(E,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(t=>e.jsx(b,{className:"h-24 w-24 rounded-lg flex-shrink-0"},t))})})]}),e.jsxs(M,{className:"mt-6 shadow-large",children:[e.jsxs(Q,{className:"flex flex-row items-center justify-between",children:[e.jsx(b,{className:"h-6 w-32"}),e.jsx(b,{className:"h-9 w-24 rounded-md"})]}),e.jsx(E,{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-24"}),e.jsx(b,{className:"h-4 w-16"})]}),e.jsx(b,{className:"h-4 w-full"}),e.jsx(b,{className:"h-4 w-3/4"})]})]},t))})]})]})]}),Vs=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],Tt=({restaurantId:t})=>{const{t:l}=B(),{data:s}=Nt(t,"restaurant"),i=s?.filter(c=>c.rating_value)||[],x=i.length?i.reduce((c,u)=>c+(u.rating_value||0),0)/i.length:0,h=[5,4,3,2,1].map(c=>({star:c,count:i.filter(u=>u.rating_value===c).length,percentage:i.length?(i.filter(u=>u.rating_value===c).length/i.length*100).toFixed(0):0})),d=i.reduce((c,u)=>(u.price_range&&(c[u.price_range]=(c[u.price_range]||0)+1),c),{}),o=d&&Object.keys(d).length>0?Object.entries(d).sort((c,u)=>u[1]-c[1])[0]:null;return e.jsxs(M,{children:[e.jsx(Q,{children:e.jsx(Be,{children:l("restaurant.rating")})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:x.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(c=>e.jsx(we,{className:Ae("w-5 h-5",c<=Math.round(x)?"fill-accent text-accent":"text-muted-foreground")},c))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[i.length," ",l("restaurant.ratingsCount")]}),o&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(Wt,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:Vs.find(c=>c.value===o[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:h.map(({star:c,count:u,percentage:w})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[c," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${w}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:u})]},c))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:l("restaurant.signInToRate")})]})]})},Gs=t=>(B(),Kt({queryKey:["restaurant-activities",t],queryFn:async()=>{const{data:l,error:s}=await Et.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",t);if(s)throw s;const i=new Date;return l.filter(h=>{const d=h.activities;if(!d)return!1;const o=new Date(d.start_date),c=d.end_date?new Date(d.end_date):null;return o<=i&&(!c||c>=i)}).map(h=>({activity_id:h.activity_id,title_zh:h.activities.title_zh,title_en:h.activities.title_en,title_pt:h.activities.title_pt,intro_zh:h.activities.intro_zh,intro_en:h.activities.intro_en,intro_pt:h.activities.intro_pt,badge_text_zh:h.activities.badge_text_zh,badge_text_en:h.activities.badge_text_en,badge_text_pt:h.activities.badge_text_pt,badge_color:h.activities.badge_color}))},enabled:!!t})),zt=(t,l)=>l==="zh"?t.title_zh:l==="pt"?t.title_pt:t.title_en,Fe=(t,l)=>{let s="";return l==="zh"?s=t.badge_text_zh||t.title_zh:l==="pt"?s=t.badge_text_pt||t.title_pt:s=t.badge_text_en||t.title_en,s},It=(t,l)=>l==="zh"?t.intro_zh||"":l==="pt"?t.intro_pt||"":t.intro_en||"",mt="dish-gallery-view-mode";function Dt({restaurantId:t,showGallery:l=!0}){const{t:s}=B(),{data:i=[],isLoading:x}=Ms(t),[h,d]=a.useState(!1),[o,c]=a.useState(0),[u,w]=a.useState(!1),f=Qe(),[_,T]=a.useState(()=>{if(typeof window<"u"){const g=localStorage.getItem(mt);return g==="single"||g==="multi"?g:"multi"}return"multi"});a.useEffect(()=>{localStorage.setItem(mt,_)},[_]);const z=a.useCallback(g=>{c(g),d(!0)},[]),v=a.useCallback(()=>{d(!1)},[]),k=a.useCallback(()=>{c(g=>g===0?i.length-1:g-1)},[i.length]),$=a.useCallback(()=>{c(g=>g===i.length-1?0:g+1)},[i.length]);if(a.useCallback(g=>{g.key==="ArrowLeft"&&k(),g.key==="ArrowRight"&&$(),g.key==="Escape"&&v()},[k,$,v]),x||!l||!i.length)return null;const S=()=>f&&_==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsxs(Y,{open:!u,onOpenChange:g=>w(!g),children:[e.jsx(Q,{className:"pb-3",children:e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Be,{className:"text-lg flex items-center gap-2",children:[e.jsx(Qt,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",i.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:g=>g.stopPropagation(),children:[e.jsx(y,{variant:_==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:g=>{g.stopPropagation(),T("single")},title:s("dishImages.singleView"),children:e.jsx(Xt,{className:"h-4 w-4"})}),e.jsx(y,{variant:_==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:g=>{g.stopPropagation(),T("multi")},title:s("dishImages.multiView"),children:e.jsx(Yt,{className:"h-4 w-4"})})]}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${u?"":"rotate-180"}`})]})]})})}),e.jsx(J,{children:e.jsxs(E,{children:[e.jsxs(vt,{className:"w-full",children:[e.jsx(yt,{className:"-ml-2 md:-ml-4",children:i.map((g,R)=>e.jsx(_t,{className:S(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>z(R),children:e.jsx("img",{src:g.image_url,alt:`Dish ${R+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},g.id))}),i.length>(f&&_==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"-left-3 md:-left-4"}),e.jsx(Ct,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),h&&e.jsxs(e.Fragment,{children:[e.jsx(Os,{imageUrl:i[o]?.image_url||"",isOpen:h,onClose:v}),i.length>1&&e.jsxs("div",{className:"fixed inset-0 z-[101] pointer-events-none",children:[e.jsx(y,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:g=>{g.stopPropagation(),k()},children:e.jsx(Xe,{className:"w-8 h-8"})}),e.jsx(y,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 pointer-events-auto",onClick:g=>{g.stopPropagation(),$()},children:e.jsx(ht,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm pointer-events-auto",children:[o+1," / ",i.length]})]})]})]})}const Us=({ownerBio:t,ownerName:l,ownerAvatarUrl:s,avatarFallback:i})=>{const{t:x}=B();return e.jsxs(Es,{children:[e.jsx($s,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80 p-0 h-auto font-medium gap-1",children:[x("common.viewMore","查看全部"),e.jsx(ht,{className:"w-4 h-4"})]})}),e.jsxs(As,{className:"max-h-[85vh]",children:[e.jsx(Fs,{className:"pb-2",children:e.jsxs(Bs,{className:"flex items-center gap-2 text-lg",children:[e.jsx(pt,{className:"w-5 h-5 text-primary"}),x("restaurants.ownerStory","主理人")]})}),e.jsx($t,{className:"flex-1 px-4 pb-8",children:e.jsxs("div",{className:"relative max-w-2xl mx-auto",children:[e.jsx(Ue,{className:"absolute -top-4 -left-2 w-12 h-12 text-primary/10 rotate-180"}),e.jsx("div",{className:"relative z-10 pt-6 space-y-4",children:e.jsx("p",{className:"text-base md:text-lg text-foreground leading-relaxed whitespace-pre-wrap first-letter:text-4xl first-letter:font-bold first-letter:text-primary first-letter:float-left first-letter:mr-2 first-letter:mt-1",children:t})}),e.jsxs("div",{className:"mt-8 flex items-center gap-3 pt-6 border-t",children:[e.jsx("div",{className:"w-12 h-12 rounded-full overflow-hidden bg-gradient-to-br from-primary to-accent flex items-center justify-center text-primary-foreground font-bold text-lg shadow-lg",children:s?e.jsx("img",{src:s,alt:l,className:"w-full h-full object-cover"}):i}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-semibold text-foreground",children:l}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x("restaurants.chef","大厨")})]})]})]})})]})]})},Rt=({open:t,onOpenChange:l,videoUrl:s,posterUrl:i,title:x})=>{const{t:h}=B(),d=a.useRef(null),o=a.useRef(null),[c,u]=a.useState(!1),[w,f]=a.useState(!1),[_,T]=a.useState(!1),[z,v]=a.useState(0),[k,$]=a.useState(0),[S,g]=a.useState(!0),R=a.useRef(null),ee=n=>{const F=Math.floor(n/60),H=Math.floor(n%60);return`${F}:${H.toString().padStart(2,"0")}`},C=a.useCallback(()=>{d.current&&(c?d.current.pause():d.current.play())},[c]),te=a.useCallback(()=>{d.current&&(d.current.muted=!w,f(!w))},[w]),K=a.useCallback(async()=>{try{document.fullscreenElement?(await document.exitFullscreen(),T(!1)):(await d.current?.requestFullscreen(),T(!0))}catch(n){console.log("Fullscreen not supported:",n)}},[]),q=a.useCallback(n=>{if(!d.current||!o.current)return;const F=o.current.getBoundingClientRect(),j=(n.clientX-F.left)/F.width;d.current.currentTime=j*k},[k]),A=a.useCallback(()=>{g(!0),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{c&&g(!1)},3e3)},[c]),U=a.useCallback(n=>{if(!d.current||!o.current)return;n.preventDefault(),n.stopPropagation();const F=o.current.getBoundingClientRect(),H=n.touches[0].clientX-F.left,j=Math.max(0,Math.min(1,H/F.width));d.current.currentTime=j*k},[k]);a.useEffect(()=>(t&&d.current?(d.current.currentTime=0,v(0),g(!0),d.current.play().catch(()=>{u(!1)})):!t&&d.current&&(d.current.pause(),d.current.currentTime=0,u(!1),v(0),g(!0)),()=>{R.current&&clearTimeout(R.current)}),[t]);const Ne=a.useCallback(()=>u(!0),[]),se=a.useCallback(()=>u(!1),[]),le=a.useCallback(()=>{d.current&&v(d.current.currentTime)},[]),P=a.useCallback(()=>{d.current&&$(d.current.duration)},[]),ie=a.useCallback(()=>{u(!1),g(!0)},[]),V=k>0?z/k*100:0;return e.jsx(Zt,{open:t,onOpenChange:l,children:e.jsxs(Jt,{children:[e.jsx(es,{className:"fixed inset-0 z-[49] bg-black/90 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",style:{pointerEvents:"none"}}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{touchAction:"none"},onClick:n=>{n.target===n.currentTarget&&l(!1)},onTouchEnd:n=>{n.target===n.currentTarget&&l(!1)},children:e.jsxs(ts,{className:"relative w-full max-w-4xl bg-black rounded-lg overflow-hidden outline-none",style:{touchAction:"auto"},"aria-describedby":void 0,onMouseMove:A,onTouchStart:n=>{n.stopPropagation(),A()},onTouchMove:n=>{n.stopPropagation(),A()},onClick:n=>n.stopPropagation(),children:[e.jsx(ss,{children:e.jsx(as,{children:x||h("restaurants.videoPlayer","Video Player")})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:Ae("absolute top-3 right-3 z-[60] bg-black/50 hover:bg-black/70 text-white h-10 w-10 rounded-full transition-opacity duration-300",S?"opacity-100":"opacity-0 pointer-events-none"),onClick:n=>{n.stopPropagation(),l(!1)},children:e.jsx(rs,{className:"h-5 w-5"})}),x&&e.jsx("div",{className:Ae("absolute top-3 left-3 z-[60] transition-opacity duration-300 pointer-events-none",S?"opacity-100":"opacity-0"),children:e.jsx("h3",{className:"text-white font-semibold text-lg drop-shadow-lg",children:x})}),e.jsxs("div",{className:"relative aspect-video bg-black select-none",children:[e.jsx("video",{ref:d,src:s,poster:i,className:"w-full h-full object-contain cursor-pointer",playsInline:!0,preload:"metadata",onPlay:Ne,onPause:se,onTimeUpdate:le,onLoadedMetadata:P,onEnded:ie,onCanPlay:()=>{d.current&&!k&&$(d.current.duration)},onClick:n=>{n.stopPropagation(),C()},onTouchEnd:n=>{n.target===d.current&&(n.preventDefault(),C())}}),!c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30",style:{zIndex:5},onClick:n=>{n.stopPropagation(),C()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),C()},children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center hover:bg-white/30 transition-colors",children:e.jsx(ne,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:Ae("absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent px-4 py-3 transition-opacity duration-300",S?"opacity-100":"opacity-0"),style:{zIndex:30,pointerEvents:S?"auto":"none"},onClick:n=>n.stopPropagation(),onTouchStart:n=>n.stopPropagation(),onTouchMove:n=>n.stopPropagation(),children:[e.jsx("div",{ref:o,className:"w-full py-2 cursor-pointer mb-2 group",style:{touchAction:"none"},onClick:n=>{n.stopPropagation(),q(n)},onTouchStart:n=>{n.stopPropagation(),U(n)},onTouchMove:n=>{n.stopPropagation(),U(n)},onTouchEnd:n=>{n.stopPropagation()},children:e.jsx("div",{className:"w-full h-2 bg-white/30 rounded-full relative",children:e.jsx("div",{className:"h-full bg-primary rounded-full relative transition-all",style:{width:`${V}%`},children:e.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-5 h-5 bg-white rounded-full shadow-md -mr-2.5"})})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),C()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),C()},children:c?e.jsx(ns,{className:"h-6 w-6"}):e.jsx(ne,{className:"h-6 w-6"})}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),te()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),te()},children:w?e.jsx(ls,{className:"h-6 w-6"}):e.jsx(is,{className:"h-6 w-6"})}),e.jsxs("span",{className:"text-white text-sm font-medium select-none",children:[ee(z)," / ",ee(k)]})]}),e.jsx(y,{type:"button",variant:"ghost",size:"icon",className:"h-10 w-10 text-white hover:bg-white/20 active:scale-95",onClick:n=>{n.stopPropagation(),K()},onTouchEnd:n=>{n.preventDefault(),n.stopPropagation(),K()},children:_?e.jsx(os,{className:"h-6 w-6"}):e.jsx(cs,{className:"h-6 w-6"})})]})]})]})]})})]})})},Hs=({restaurant:t,localizedRestaurant:l,backUrl:s,user:i,isFavorite:x,onToggleFavorite:h,onShare:d,showEditButton:o,editButton:c,reportButton:u})=>{const{t:w}=B(),{getLocalizedField:f}=Ze();At();const[_,T]=a.useState(!1),[z,v]=a.useState(!1),[k,$]=a.useState(!1),S=a.useRef(null),g=f(t,"owner_bio")||t.owner_bio,R=l.description,ee=l.name?.charAt(0)?.toUpperCase()||"主",C=t.banner_media_type==="video"&&t.promo_video_url,te=t.banner_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",K=t.promo_video_poster||te,[q,A]=a.useState(!1),U=3,Ne=j=>j?.replace(/<[^>]*>/g,"")||"",se=g&&g.length>100?g.substring(0,100)+"...":g,le=g&&g.length>100,P=Ne(R),ie=P&&P.length>120?P.substring(0,120)+"...":P,V=a.useRef(null),n=a.useCallback(j=>{!S.current||!C||q||(j?S.current.play().catch(()=>{}):S.current.pause())},[C,q]),F=a.useCallback(async j=>{try{return j.muted=!0,j.volume=0,await j.play(),!0}catch(G){return console.warn("Video autoplay attempt failed:",G),!1}},[]);a.useEffect(()=>{if(!C||!S.current)return;const j=S.current;let G=0,oe,W=!0;const ce=async()=>{if(!W||G>=U){W&&G>=U&&(A(!0),v(!0));return}G++,await F(j)&&W?(v(!0),A(!1)):W&&G<U?oe=setTimeout(ce,500):W&&(A(!0),v(!0))},Se=()=>{ce()},Te=()=>{W&&$(!0)};return j.readyState>=2?ce():j.addEventListener("loadeddata",Se),j.addEventListener("error",Te),()=>{W=!1,clearTimeout(oe),j.removeEventListener("loadeddata",Se),j.removeEventListener("error",Te)}},[C,F]),a.useEffect(()=>{if(!C||q||!V.current)return;const j=new IntersectionObserver(G=>{G.forEach(oe=>{n(oe.isIntersecting)})},{threshold:.1});return j.observe(V.current),()=>{j.disconnect()}},[C,q,n]);const H=()=>{if(C&&t.promo_video_url)if(q&&S.current){const j=S.current;j.muted=!0,j.play().then(()=>{A(!1),v(!0)}).catch(()=>{T(!0)})}else T(!0)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{ref:V,className:"relative h-[33vh] md:h-[40vh] overflow-hidden bg-muted cursor-pointer group",onClick:H,children:[C&&!k?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:K,alt:l.name,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${z&&!q?"opacity-0":"opacity-100"}`,loading:"eager"}),e.jsx("video",{ref:S,src:t.promo_video_url,poster:K,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-500 ${z&&!q?"opacity-100":"opacity-0"}`,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,"webkit-playsinline":"true","x5-playsinline":"true","x5-video-player-type":"h5"})]}):e.jsx("img",{src:te,alt:l.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 via-background/20 to-transparent"}),C&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`w-16 h-16 md:w-20 md:h-20 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 transition-opacity duration-300 pointer-events-auto cursor-pointer ${q?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:e.jsx(ne,{className:"w-8 h-8 md:w-10 md:h-10 text-white ml-1",fill:"white"})})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center z-40 p-3 md:p-4",onClick:j=>j.stopPropagation(),children:[e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",children:e.jsx(Ce,{to:s,children:e.jsx(Xe,{className:"w-4 h-4 md:w-5 md:h-5"})})}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[u,c,e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:j=>{j.stopPropagation(),d()},children:e.jsx(je,{className:"w-4 h-4 md:w-5 md:h-5"})}),i&&e.jsx(y,{variant:"secondary",size:"icon",className:"h-9 w-9 md:h-10 md:w-10 shadow-lg",onClick:j=>{j.stopPropagation(),h()},children:e.jsx(gt,{className:`w-4 h-4 md:w-5 md:h-5 ${x?"fill-destructive text-destructive":""}`})})]})]})]}),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-8",children:[C&&e.jsx("div",{className:"flex justify-center mb-3",children:e.jsxs(y,{variant:"secondary",size:"sm",className:"gap-2 bg-primary/5 hover:bg-primary/10 text-primary/70 border border-primary/10 backdrop-blur-md",onClick:()=>{S.current&&S.current.pause(),T(!0)},children:[e.jsx(ne,{className:"w-4 h-4"}),w("restaurants.clickWatchFullVideo","点击观看完整视频")]})}),e.jsxs(M,{className:"shadow-xl border-border/50",children:[e.jsxs(Q,{className:"pb-4 md:pb-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1.5 md:mb-2",children:[e.jsxs(O,{variant:"secondary",className:"text-[10px] md:text-xs gap-1 bg-primary/10 text-primary border-primary/20",children:[w("admin.templateGhost","Virtual Restaurant"),e.jsx(Ye,{className:"w-3 h-3"})]}),l.type&&l.type.length>0&&e.jsx(O,{variant:"secondary",className:"text-[10px] md:text-xs bg-primary/10 text-primary border-primary/20",children:l.type.join(" · ")}),e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.15em] md:tracking-[0.2em] uppercase text-primary",children:w("restaurants.exclusiveInterview","专属故事")})]}),e.jsx(Be,{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold text-foreground leading-tight",children:l.name})]}),e.jsx(E,{className:"pt-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-5 md:gap-6 lg:gap-8",children:[e.jsxs("div",{className:"md:col-span-3 space-y-5 md:space-y-6",children:[e.jsxs("div",{className:"relative aspect-square md:aspect-square w-full max-w-md mx-auto overflow-hidden rounded-xl shadow-lg group",children:[e.jsx("img",{src:t.cover_image_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=800&q=80",alt:l.name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"})]}),(ie||R)&&e.jsxs("div",{className:"space-y-2 md:space-y-3 bg-muted/50 rounded-xl p-4 md:p-5 lg:p-6 border border-border/30",children:[e.jsxs("h3",{className:"text-base md:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4 md:w-5 md:h-5 text-primary rotate-180"}),w("restaurants.foodPhilosophy","美食哲学")]}),e.jsx("div",{className:"text-sm md:text-base text-muted-foreground leading-relaxed prose prose-sm dark:prose-invert max-w-none [&_*]:!text-muted-foreground [&_a]:!text-primary [&_a]:underline [&_p]:my-2",dangerouslySetInnerHTML:{__html:R}})]})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"bg-muted/30 rounded-2xl border border-border/30 overflow-hidden sticky top-20 self-start",children:[e.jsx("div",{className:"relative pt-6 md:pt-8 pb-4 md:pb-6 px-4 md:px-6 bg-gradient-to-b from-primary/5 to-transparent",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 sm:w-24 sm:h-24 md:w-28 md:h-28 rounded-full overflow-hidden border-4 border-background shadow-xl ring-4 ring-primary/10",children:t.owner_avatar_url?e.jsx("img",{src:t.owner_avatar_url,alt:l.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-primary/30 via-accent/20 to-muted flex items-center justify-center",children:e.jsx("span",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary/70",children:ee})})}),e.jsxs(O,{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 bg-primary text-primary-foreground border-0 px-2 md:px-3 py-0.5 md:py-1 text-[10px] md:text-xs font-medium shadow-lg whitespace-nowrap",children:[e.jsx(pt,{className:"w-2.5 h-2.5 md:w-3 md:h-3 mr-0.5 md:mr-1"}),w("restaurants.ownerStory","主理人")]})]})})}),e.jsxs("div",{className:"px-4 md:px-6 py-3 md:py-4 text-center border-b border-border/30",children:[e.jsx("h3",{className:"text-lg md:text-xl font-bold text-foreground",children:l.name}),e.jsx("p",{className:"text-[10px] md:text-xs text-muted-foreground font-medium tracking-wider uppercase mt-0.5 md:mt-1",children:w("restaurants.chef","大厨")})]}),e.jsxs("div",{className:"p-4 md:p-6 space-y-3 md:space-y-4",children:[e.jsxs("h4",{className:"text-xs md:text-sm font-semibold text-foreground flex items-center gap-1.5 md:gap-2",children:[e.jsx(Ue,{className:"w-3 h-3 md:w-4 md:h-4 text-primary rotate-180"}),w("restaurants.ownerWords","主理人故事")]}),g?e.jsxs("div",{className:"space-y-2 md:space-y-3",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:se}),le&&e.jsx(Us,{ownerBio:g,ownerName:l.name,ownerAvatarUrl:t.owner_avatar_url,avatarFallback:ee})]}):e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground/60 italic",children:w("restaurants.noBioYet","暂无简介")})]}),e.jsx("div",{className:"h-1.5 md:h-2 bg-gradient-to-r from-primary/20 via-primary/40 to-primary/20"})]})})]})})]})]}),C&&e.jsx(Rt,{open:_,onOpenChange:T,videoUrl:t.promo_video_url,posterUrl:K,title:l.name})]})},Ws=({brandId:t})=>{const{t:l,i18n:s}=B(),{data:i,isLoading:x}=St(t);if(x||!i)return null;const h=f=>{switch(s.language){case"zh":return f.content_zh;case"pt":return f.content_pt;default:return f.content_en||f.content_zh}},d=()=>{switch(s.language){case"zh":return i.name;case"pt":return i.name_pt||i.name;default:return i.name_en||i.name}},o=i.content_blocks&&i.content_blocks.length>0,c=!!i.logo_url,w=(()=>{switch(s.language){case"zh":return i.intro_zh;case"pt":return i.intro_pt;default:return i.intro_en||i.intro_zh}})();return!c&&!o&&!w?null:e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("brand.story","品牌故事")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ft,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),d()]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(M,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(E,{className:"p-4 md:p-6 lg:p-8",children:[c&&e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:i.logo_url,alt:d(),className:"w-20 h-20 md:w-24 md:h-24 object-contain rounded-xl"})}),o&&e.jsx("div",{className:"space-y-4",children:i.content_blocks.map((f,_)=>{const T=h(f),z=f.type==="image"&&_===0,v=f.type==="image"&&_===i.content_blocks.length-1;return e.jsxs("div",{children:[f.type==="text"&&T&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:T}}),f.type==="image"&&f.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:f.url,alt:f.alt||"",className:z?"w-16 h-16 object-contain rounded-lg":v?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},f.id)})}),w&&!o&&e.jsx(ks,{text:w})]})})]})})},Ks=[jt,bt,He],Qs=({showIntro:t=!0})=>{const{t:l,i18n:s}=B(),{settings:i,isLoading:x}=Ft();if(!t||x)return null;const h=i?.ghost_intro_content,d=s.language,o=h?d==="zh"?h.concept_zh:d==="pt"?h.concept_pt:h.concept_en:l("ghostIntro.concept"),c=h?.advantages?.map((u,w)=>({icon:Ks[w]||He,title:d==="zh"?u.title_zh:d==="pt"?u.title_pt:u.title_en,desc:d==="zh"?u.desc_zh:d==="pt"?u.desc_pt:u.desc_en}))||[{icon:jt,title:l("ghostIntro.advantage1Title"),desc:l("ghostIntro.advantage1Desc")},{icon:bt,title:l("ghostIntro.advantage2Title"),desc:l("ghostIntro.advantage2Desc")},{icon:He,title:l("ghostIntro.advantage3Title"),desc:l("ghostIntro.advantage3Desc")}];return e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:l("ghostIntro.label")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(Ye,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("ghostIntro.title")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(M,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(E,{className:"p-4 md:p-6 lg:p-8",children:[e.jsx("p",{className:"text-sm md:text-base text-muted-foreground leading-relaxed mb-6 md:mb-8",children:o}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:c.map((u,w)=>e.jsxs("div",{className:"flex flex-col items-center text-center p-4 rounded-xl bg-primary/5 border border-primary/10",children:[e.jsx("div",{className:"w-10 h-10 md:w-12 md:h-12 rounded-full bg-primary/10 flex items-center justify-center mb-3",children:e.jsx(u.icon,{className:"w-5 h-5 md:w-6 md:h-6 text-primary"})}),e.jsx("h3",{className:"font-semibold text-sm md:text-base text-foreground mb-1",children:u.title}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground leading-relaxed",children:u.desc})]},w))})]})})]})})},Xs=ds,Ys=t=>{if(!t)return"";const l=Math.floor(t/60),s=Math.floor(t%60);return`${l}:${s.toString().padStart(2,"0")}`},xt=({video:t,onClick:l,language:s})=>{const x=(()=>{switch(s){case"en":return t.title_en||t.title_zh||"";case"pt":return t.title_pt||t.title_en||t.title_zh||"";default:return t.title_zh||t.title_en||""}})();return e.jsxs(M,{className:"group cursor-pointer overflow-hidden border-border/50 hover:border-primary/30 transition-all hover:shadow-lg",onClick:l,children:[e.jsxs("div",{className:"relative",children:[e.jsx(Xs,{ratio:16/9,children:t.poster_url?e.jsx("img",{src:t.poster_url,alt:x,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",loading:"lazy"}):e.jsxs("div",{className:"w-full h-full bg-gradient-to-br from-primary/20 via-primary/10 to-muted flex items-center justify-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/20 backdrop-blur-sm flex items-center justify-center border border-primary/30",children:e.jsx(ne,{className:"w-8 h-8 text-primary ml-1",fill:"currentColor"})}),e.jsx(ms,{className:"absolute bottom-3 left-3 w-5 h-5 text-primary/40"})]})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none md:opacity-0 md:group-hover:opacity-100 transition-opacity",children:e.jsx("div",{className:"w-12 h-12 md:w-14 md:h-14 rounded-full bg-black/50 md:bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30 md:group-hover:scale-110 transition-transform",children:e.jsx(ne,{className:"w-6 h-6 md:w-7 md:h-7 text-white ml-0.5",fill:"white"})})}),t.duration&&e.jsx(O,{variant:"secondary",className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs border-0",children:Ys(t.duration)})]}),x&&e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"text-sm font-medium text-foreground line-clamp-2",children:x})})]})},Zs=({videos:t})=>{const{t:l,i18n:s}=B(),i=Qe(),[x,h]=a.useState(null);if(!t||t.length===0)return null;const d=o=>{switch(s.language){case"en":return o.title_en||o.title_zh||"";case"pt":return o.title_pt||o.title_en||o.title_zh||"";default:return o.title_zh||o.title_en||""}};return e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:"BEHIND THE KITCHEN"}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(ne,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),l("restaurants.videoSection","美食视界")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),i?e.jsxs(vt,{opts:{align:"start",loop:t.length>2},className:"w-full",children:[e.jsx(yt,{className:"-ml-2",children:t.map((o,c)=>e.jsx(_t,{className:"pl-2 basis-4/5 sm:basis-1/2",children:e.jsx(xt,{video:o,onClick:()=>h(o),language:s.language})},c))}),t.length>2&&e.jsxs(e.Fragment,{children:[e.jsx(kt,{className:"hidden sm:flex -left-4"}),e.jsx(Ct,{className:"hidden sm:flex -right-4"})]})]}):e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:t.map((o,c)=>e.jsx(xt,{video:o,onClick:()=>h(o),language:s.language},c))})]})}),e.jsx(Rt,{open:!!x,onOpenChange:o=>!o&&h(null),videoUrl:x?.url||"",posterUrl:x?.poster_url,title:x?d(x):void 0})]})},Js=a.lazy(()=>ut(()=>import("./RestaurantComments-DOsTWL3Y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),ea=({restaurant:t,localizedRestaurant:l,restaurantActivities:s,ratingCount:i,averageRating:x,onTakeawayClick:h,brandId:d})=>{const{t:o,i18n:c}=B(),{getLocalizedField:u}=Ze(),[w,f]=a.useState(!1),[_,T]=a.useState(!1),z=a.useRef(null);return e.jsxs("div",{className:"relative bg-background",children:[t.website_url&&t.show_takeaway_button&&e.jsx("section",{className:"py-6 md:py-8 bg-gradient-to-b from-muted/50 to-background",children:e.jsxs("div",{className:"container mx-auto max-w-2xl px-4",children:[e.jsxs("div",{className:"text-center mb-4 md:mb-5",children:[e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mb-1",children:o("restaurants.readyToOrder")}),e.jsx("p",{className:"text-sm md:text-base font-medium text-foreground",children:o("restaurants.orderNowHint")})]}),e.jsx("div",{className:"max-w-md mx-auto",children:e.jsxs(y,{className:"w-full h-11 md:h-12 text-sm md:text-base shadow-md hover:shadow-lg transition-shadow",size:"lg",onClick:h,children:[e.jsx(xs,{className:"w-4 h-4 md:w-5 md:h-5 mr-2"}),o("restaurant.takeawayOrder")]})}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-4 md:mt-5",children:[e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"}),e.jsx("span",{className:"text-[10px] md:text-xs text-muted-foreground uppercase tracking-wider",children:o("restaurants.orBrowse")}),e.jsx("div",{className:"h-px w-12 md:w-16 bg-border"})]})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-6xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:o("restaurants.gallery","美食图鉴")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(us,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),o("restaurants.photoWall","照片墙")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(Dt,{restaurantId:t.id,showGallery:t.show_dish_gallery!==!1})]})}),t.videos&&Array.isArray(t.videos)&&t.videos.length>0&&e.jsx(Zs,{videos:t.videos}),d&&e.jsx(Ws,{brandId:d}),e.jsx(Qs,{showIntro:t.show_ghost_intro!==!1}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:o("restaurants.info","详情")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(We,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),o("restaurants.contactInfo","联系信息")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(M,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsxs(E,{className:"p-4 md:p-6 lg:p-8 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 md:gap-3",children:[e.jsxs(O,{variant:"secondary",className:"gap-1 text-xs md:text-sm bg-primary/10 text-primary border-primary/20",children:[o("admin.templateGhost","Virtual Restaurant"),e.jsx(Ye,{className:"w-3 h-3"})]}),l.type.slice(0,3).map((v,k)=>e.jsx(O,{variant:"secondary",className:"text-xs md:text-sm",children:v},k)),i>0&&e.jsxs("div",{className:"flex items-center gap-1 ml-auto",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 fill-accent text-accent"}),e.jsxs("span",{className:"font-bold text-base md:text-lg",children:[x.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-xs md:text-sm ml-1",children:["(",i,")"]})]})]})]}),e.jsx(Ke,{}),e.jsxs("div",{className:"grid gap-3 md:gap-4",children:[s.length>0&&e.jsxs(Y,{open:w,onOpenChange:f,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-gradient-to-r from-primary/5 to-transparent border border-primary/10",children:[e.jsx(we,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:o("activities.title")}),!w&&e.jsxs("div",{className:"flex flex-wrap gap-1 md:gap-1.5 mt-1",children:[s.slice(0,2).map((v,k)=>e.jsx(O,{variant:"default",className:"text-white text-[10px] md:text-xs",style:{backgroundColor:v.badge_color||"hsl(var(--primary))"},children:Fe(v,c.language)},`activity-${k}`)),s.length>2&&e.jsxs(O,{variant:"secondary",className:"text-[10px] md:text-xs",children:["+",s.length-2]})]})]}),e.jsx(X,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${w?"rotate-180":""}`})]})}),e.jsx(J,{className:"mt-2 md:mt-3 space-y-1.5 md:space-y-2",children:s.map((v,k)=>{const $=It(v,c.language);return e.jsxs(Ce,{to:`/activity/${v.activity_id}`,className:"block p-2 md:p-3 rounded-md md:rounded-lg hover:bg-muted/80 transition-colors border border-transparent hover:border-primary/20",children:[e.jsx(O,{variant:"default",className:"text-white mr-1.5 md:mr-2 text-[10px] md:text-xs",style:{backgroundColor:v.badge_color||"hsl(var(--primary))"},children:Fe(v,c.language)}),e.jsxs("span",{className:"text-xs md:text-sm text-muted-foreground",children:[$||zt(v,c.language)," ... →"]})]},`activity-detail-${k}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-muted/70 transition-colors",children:[e.jsx(We,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:o("restaurants.kitchenAddress")}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground mt-0.5 md:mt-1 break-words",children:t.address})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50 hover:bg-primary/10 transition-colors cursor-pointer group",children:[e.jsx(wt,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:o("restaurant.phone")}),e.jsx("p",{className:"text-sm md:text-base text-primary group-hover:underline mt-0.5 md:mt-1",children:t.phone})]})]}),t&&(u(t,"announcement")||t.announcement_zh)&&e.jsxs(Y,{open:_,onOpenChange:T,className:"flex items-start gap-2 md:gap-3 p-3 md:p-4 rounded-lg md:rounded-xl bg-muted/50",children:[e.jsx(be,{className:"w-4 h-4 md:w-5 md:h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-sm md:text-base text-card-foreground",children:o("restaurant.announcement")}),e.jsx(X,{className:`w-4 h-4 md:w-5 md:h-5 text-muted-foreground transition-transform flex-shrink-0 ${_?"rotate-180":""}`})]})}),e.jsx(J,{className:"mt-2 md:mt-3",children:e.jsx("div",{className:"p-3 md:p-4 rounded-md md:rounded-lg bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-xs md:text-sm text-foreground whitespace-pre-wrap leading-relaxed",children:u(t,"announcement")||t.announcement_zh})})})]})]})]})]})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:o("restaurants.rating","评分")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(we,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),o("restaurants.rateUs","给我们评分")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(M,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(E,{className:"p-4 md:p-6 lg:p-8",children:e.jsx(Tt,{restaurantId:t.id})})})]})}),e.jsx("section",{className:"py-8 md:py-12 lg:py-16 bg-muted/30",children:e.jsxs("div",{className:"container mx-auto max-w-4xl px-4",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8 lg:mb-10",children:[e.jsx("p",{className:"text-[10px] md:text-xs font-medium tracking-[0.2em] md:tracking-[0.25em] uppercase text-primary mb-2 md:mb-3",children:o("restaurants.reviews","评价")}),e.jsxs("h2",{className:"text-xl md:text-2xl lg:text-3xl font-bold text-foreground flex items-center justify-center gap-2 md:gap-3",children:[e.jsx(be,{className:"w-5 h-5 md:w-6 md:h-6 lg:w-7 lg:h-7 text-primary"}),o("restaurants.customerReviews","用户评价")]}),e.jsx("div",{className:"w-12 md:w-16 h-0.5 md:h-1 bg-primary mx-auto mt-3 md:mt-4"})]}),e.jsx(M,{className:"border-0 shadow-lg md:shadow-xl overflow-hidden",children:e.jsx(E,{className:"p-4 md:p-6 lg:p-8",ref:z,children:e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-8 md:py-12",children:e.jsx(ke,{className:"w-6 h-6 md:w-8 md:h-8 animate-spin text-primary"})}),children:e.jsx(Js,{restaurantId:t.id})})})})]})})]})};function ta({brandId:t}){const{t:l,i18n:s}=B(),[i,x]=a.useState(!1),{data:h,isLoading:d}=St(t);if(d||!h)return null;const o=()=>{switch(s.language){case"zh":return h.intro_zh;case"pt":return h.intro_pt;default:return h.intro_en||h.intro_zh}},c=f=>{switch(s.language){case"zh":return f.content_zh;case"pt":return f.content_pt;default:return f.content_en||f.content_zh}},u=o(),w=h.content_blocks&&h.content_blocks.length>0;return!u&&!w?null:e.jsxs(Y,{open:i,onOpenChange:x,className:"mt-4",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"font-medium",children:l("brand.aboutUs")})]}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${i?"rotate-180":""}`})]})}),e.jsx(J,{children:e.jsxs("div",{className:"p-4 mt-2 rounded-lg bg-muted/30",children:[e.jsx("div",{className:"space-y-4",children:w&&h.content_blocks.map((f,_)=>{const T=c(f),z=f.type==="image"&&_===0,v=f.type==="image"&&_===h.content_blocks.length-1;return e.jsxs("div",{children:[f.type==="text"&&T&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:T}}),f.type==="image"&&f.url&&e.jsx("div",{className:"flex justify-start",children:e.jsx("img",{src:f.url,alt:f.alt||"",className:z?"w-16 h-16 object-contain rounded-lg":v?"h-12 w-auto object-contain opacity-80":"max-w-[120px] max-h-24 object-contain rounded-lg"})})]},f.id)})}),u&&!w&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:u}})]})})]})}const sa=a.lazy(()=>ut(()=>import("./RestaurantComments-DOsTWL3Y.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),Ma=()=>{const{id:t}=hs(),l=ps(),{t:s,i18n:i}=B(),{user:x}=Bt(),{localizeRestaurant:h,getLocalizedField:d}=Ze(),o=Qe(),c=a.useRef(null),u=a.useRef(null),[w,f]=a.useState(null),[_,T]=a.useState(!1),[z,v]=a.useState(!0),[k,$]=a.useState(!1),[S,g]=a.useState(!1),[R,ee]=a.useState(!0),[C,te]=a.useState(!0),[K,q]=a.useState(!1),A=a.useRef(null),U=a.useRef(null),[Ne,se]=a.useState(!1),[le,P]=a.useState(!1),[ie,V]=a.useState(!1),[n,F]=a.useState(!1),H=gs(),j=fs(),{share:G,DrawerComponent:oe}=Ps(),W=a.useCallback(async()=>{j.removeQueries({queryKey:["restaurant",t]}),j.removeQueries({queryKey:["comments",t]}),j.removeQueries({queryKey:["restaurant-activities",t]}),j.removeQueries({queryKey:["dish-images",t]}),await Promise.all([j.invalidateQueries({queryKey:["restaurant",t]}),j.invalidateQueries({queryKey:["comments",t]}),j.invalidateQueries({queryKey:["restaurant-activities",t]}),j.invalidateQueries({queryKey:["dish-images",t]})])},[j,t]);Rs({pageType:"restaurant",targetId:t});const ce=l.state?.fromActivity,Se=l.state?.from==="admin",Te=l.state?.from==="profile",ze=Se?"/admin/restaurants":Te?"/profile":ce?`/activity/${ce}`:"/restaurants",{data:r,isLoading:Pt}=vs(t),{data:Lt=[]}=ys(),{data:Ie}=Nt(t,"restaurant",{enabled:C}),Je=_s(),{role:aa,isAdmin:De}=qt(),{data:Mt=[]}=Ls(),{data:Re=[]}=Gs(t),Pe=r&&Mt.some(m=>m.id===r.id),I=r?h(r):null,et=r?Lt.includes(r.id):!1;a.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const de=a.useMemo(()=>{const m={};return Ie?.forEach(p=>{p.price_range&&(m[p.price_range]||(m[p.price_range]={count:0,latestDate:p.created_at}),m[p.price_range].count+=1,p.created_at>m[p.price_range].latestDate&&(m[p.price_range].latestDate=p.created_at))}),m},[Ie]),tt=a.useMemo(()=>de?Object.values(de).reduce((m,p)=>m+p.count,0):0,[de]),st=a.useMemo(()=>!de||tt<10?null:Object.entries(de).sort(([,p],[,D])=>D.count!==p.count?D.count-p.count:D.latestDate.localeCompare(p.latestDate))[0]?.[0]||null,[de,tt]),{ratingCount:Le,averageRating:at}=a.useMemo(()=>{const m=Ie?.filter(N=>N.rating_value)||[],p=m.length,D=p>0?m.reduce((N,L)=>N+(L.rating_value||0),0)/p:0;return{ratingCount:p,averageRating:D}},[Ie]);a.useEffect(()=>{r&&Ss().then(m=>{const p=Ts(m.coords.latitude,m.coords.longitude,r.lat,r.lng);f(p)}).catch(()=>{f(null)})},[r]);const rt=a.useCallback(()=>{!x||!r||Je.mutate(r.id)},[x,r,Je]),Me=a.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),$e.success(s("common.linkCopied"))}catch(m){console.error("Error copying link:",m),$e.error(s("common.shareError"))}},[s]),qe=a.useCallback(async()=>{!r||!I||G({title:I.name,text:`${I.name} - Xiaoxiong Market

${I.description||I.address}`,url:window.location.href},()=>{$e.success(s("common.shareSuccess"))})},[r,I,G,s]),ve=a.useCallback(m=>{if(!r||!I)return;const p=encodeURIComponent(window.location.href),D=encodeURIComponent(I.name);let N="";switch(m){case"whatsapp":N=`https://wa.me/?text=${D}%20${p}`;break;case"facebook":N=`https://www.facebook.com/sharer/sharer.php?u=${p}`;break;case"twitter":N=`https://twitter.com/intent/tweet?text=${D}&url=${p}`;break;case"telegram":N=`https://t.me/share/url?url=${p}&text=${D}`;break;case"wechat":Me(),$e.info(s("common.shareVia")+" WeChat");return;default:return}nt()?window.location.href=N:window.open(N,"_blank","width=600,height=400")},[r,I,Me,s]);return a.useEffect(()=>{const m=new IntersectionObserver(D=>{D.forEach(N=>{N.isIntersecting&&!R&&ee(!0)})},{rootMargin:"100px"}),p=new IntersectionObserver(D=>{D.forEach(N=>{N.isIntersecting&&!C&&te(!0)})},{rootMargin:"200px"});return A.current&&m.observe(A.current),U.current&&p.observe(U.current),()=>{m.disconnect(),p.disconnect()}},[R,C]),a.useEffect(()=>{if(!c.current||!r||!R||!z||u.current)return;const m="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!_e.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:Vt(),isIOSWebView:nt(),userAgent:navigator.userAgent});return}const p=()=>{if(!c.current)return;const D=c.current.getBoundingClientRect();if(D.width===0||D.height===0){setTimeout(p,100);return}try{_e.accessToken=m,u.current=new _e.Map({container:c.current,style:"mapbox://styles/mapbox/light-v11",center:[r.lng,r.lat],zoom:15,cooperativeGestures:!0}),u.current.on("error",L=>{console.error("[RestaurantDetail Map] Map error:",L)});const N=document.createElement("div");N.style.backgroundImage=`url(${Is})`,N.style.width="40px",N.style.height="40px",N.style.backgroundSize="contain",N.style.backgroundRepeat="no-repeat",N.style.backgroundPosition="center",N.style.cursor="pointer",new _e.Marker({element:N}).setLngLat([r.lng,r.lat]).addTo(u.current),u.current.addControl(new _e.NavigationControl)}catch(N){console.error("[RestaurantDetail Map] Failed to initialize map:",N)}};return setTimeout(p,50),()=>{u.current?.remove(),u.current=null}},[r,R,z]),a.useEffect(()=>{if(z&&u.current){const m=setTimeout(()=>{u.current?.resize(),r&&u.current?.setCenter([r.lng,r.lat])},350);return()=>clearTimeout(m)}},[z,r]),Pt?e.jsx(qs,{}):!r||!I?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(y,{asChild:!0,className:"mt-4",children:e.jsx(Ce,{to:ze,children:s("common.back")})})]})}):r.template==="ghost"?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(Hs,{restaurant:r,localizedRestaurant:I,backUrl:ze,user:x,isFavorite:et,onToggleFavorite:rt,onShare:()=>{if(!x){P(!0);return}o&&navigator.share?qe():Me()},onReport:()=>{},showEditButton:Pe||De,editButton:(Pe||De)&&r?e.jsx(dt,{restaurant:r,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(it,{className:"w-5 h-5"})})}):null,reportButton:r?e.jsx(ct,{targetType:"restaurant",targetId:r.id,onLoginRequired:()=>P(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:"backdrop-blur-sm bg-background/60",children:e.jsx(ot,{className:"w-5 h-5"})})}):null}),e.jsx(ea,{restaurant:r,localizedRestaurant:I,restaurantActivities:Re,ratingCount:Le,averageRating:at,onTakeawayClick:()=>V(!0),brandId:r.brand_id}),e.jsx(me,{open:ie,onOpenChange:V,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面")})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(ae,{onClick:()=>{try{let m=r.website_url;if(x){const p=new URL(r.website_url);p.searchParams.set("user_id",x.id),m=p.toString()}ye(m)}catch{ye(r.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(me,{open:le,onOpenChange:P,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:s("activities.loginRequired")}),e.jsx(pe,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(ge,{children:[e.jsx(fe,{children:s("common.cancel")}),e.jsx(ae,{onClick:()=>H("/auth"),children:s("activities.goToLogin")})]})]})})]}):e.jsx(Ds,{onRefresh:W,children:e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:r.cover_image_url||r.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:I.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(y,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(Ce,{to:ze,children:e.jsx(Xe,{className:"w-5 h-5"})})}),x&&e.jsx(y,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:rt,children:e.jsx(gt,{className:`w-5 h-5 ${et?"fill-destructive text-destructive":""}`})}),o&&navigator.share?e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${x?"right-16":"right-4"}`,onClick:()=>{if(!x){P(!0);return}qe()},children:e.jsx(je,{className:"w-5 h-5"})}):e.jsxs(Gt,{children:[e.jsx(Ut,{asChild:!0,children:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${x?"right-16":"right-4"}`,onClick:m=>{x||(m.preventDefault(),P(!0))},children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs(Ht,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(re,{onClick:qe,children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(lt,{})]}),e.jsxs(re,{onClick:()=>ve("wechat"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(re,{onClick:()=>ve("whatsapp"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(re,{onClick:()=>ve("facebook"),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(re,{onClick:()=>ve("twitter"),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(re,{onClick:()=>ve("telegram"),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(lt,{}),e.jsxs(re,{onClick:Me,children:[e.jsx(js,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(Pe||De)&&r&&e.jsx(dt,{restaurant:r,trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${x?"right-28":"right-16"}`,children:e.jsx(it,{className:"w-5 h-5"})})}),r&&e.jsx(ct,{targetType:"restaurant",targetId:r.id,onLoginRequired:()=>P(!0),trigger:e.jsx(y,{variant:"secondary",size:"icon",className:`absolute top-4 ${Pe||De?x?"right-40":"right-28":x?"right-28":"right-16"}`,children:e.jsx(ot,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(M,{className:"shadow-large",children:[e.jsx(Q,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:I.type.slice(0,3).map((m,p)=>e.jsx(O,{variant:"secondary",children:m},p))}),e.jsx(Be,{className:"text-3xl mb-2",children:I.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[w!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ge,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[w.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:`w-5 h-5 ${Le>0?"fill-accent text-accent":"text-muted-foreground"}`}),Le>0?e.jsxs("span",{className:"font-semibold text-base",children:[at.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",Le,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),st&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(bs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:st})]})]}),r.brand_id&&e.jsx(ta,{brandId:r.brand_id}),I.description&&I.description.replace(/<[^>]*>/g,"").trim()!==""&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline mt-3",dangerouslySetInnerHTML:{__html:I.description}})]})})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[Re.length>0&&e.jsxs(Y,{open:S,onOpenChange:g,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(we,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!S&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:Re.map((m,p)=>e.jsx(O,{variant:"default",className:"text-white",style:{backgroundColor:m.badge_color||"#9b87f5"},children:Fe(m,i.language)},`activity-${p}`))})]}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${S?"rotate-180":""}`})]})}),e.jsx(J,{className:"mt-3 space-y-2",children:Re.map((m,p)=>{const D=It(m,i.language);return e.jsxs(Ce,{to:`/activity/${m.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(O,{variant:"default",className:"text-white mr-2",style:{backgroundColor:m.badge_color||"#9b87f5"},children:Fe(m,i.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[D||zt(m,i.language)," ... →"]})]},`activity-detail-${p}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(We,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-muted-foreground",children:r.address}),r.template==="ghost"&&e.jsx(O,{variant:"secondary",className:"text-xs",children:s("restaurants.ghostKitchen")})]})]})]}),r.phone&&e.jsxs("a",{href:`tel:${r.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(wt,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:r.phone})]})]}),r.opening_hours&&r.template!=="ghost"&&e.jsxs(Y,{open:_,onOpenChange:T,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ws,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!_&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",Cs(r.opening_hours)]})]}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${_?"rotate-180":""}`})]})}),e.jsx(J,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const m=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],p={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},D=m[new Date().getDay()===0?6:new Date().getDay()-1];return m.map(N=>{const L=r.opening_hours[N],Oe=N===D,Ot=s(`restaurant.${p[N]}`);let Ee="N/A";return L&&(L.closed?Ee=s("restaurant.closed"):L.splitShift?Ee=`${L.open} - ${L.close}, ${L.open2} - ${L.close2}`:Ee=`${L.open} - ${L.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${Oe?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${Oe?"text-primary":"text-foreground"}`,children:[Ot,Oe&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${Oe?"text-primary font-semibold":"text-muted-foreground"} ${L?.closed?"italic":""}`,children:Ee})]},N)})})()})})]})]}),r&&(d(r,"announcement")||r.announcement_zh)&&e.jsxs(Y,{open:k,onOpenChange:$,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(be,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${k?"rotate-180":""}`})]})}),e.jsx(J,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:d(r,"announcement")||r.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[r.template!=="ghost"&&e.jsxs(y,{variant:"secondary",className:"w-full",onClick:()=>se(!0),children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),r.website_url&&(r.show_takeaway_button||r.show_booking_button&&r.template!=="ghost")&&e.jsxs(y,{className:"w-full",onClick:()=>V(!0),children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),s("restaurant.orderOrBook","外卖/订台")]})]}),e.jsx(me,{open:Ne,onOpenChange:se,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ge,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:I.name})})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(ae,{onClick:()=>{zs(r.lat,r.lng,I.name),se(!1)},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(me,{open:n,onOpenChange:F,children:e.jsxs(xe,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(he,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(pe,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(ae,{onClick:()=>{const m=new URL(r.website_url);x&&m.searchParams.set("user_id",x.id);const p=m.toString();ye(p)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[K?e.jsx(ke,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(fe,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx(me,{open:ie,onOpenChange:V,children:e.jsxs(xe,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-background/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-background/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(ue,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ve,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(he,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.orderOrBookTitle","外卖/订台")}),e.jsx(pe,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:x?s("restaurant.orderOrBookDescription","即将为您打开餐厅私域页面"):s("restaurant.orderOrBookLoginRequired","请先登录后再进入餐厅私域页面")})]})]}),e.jsxs(ge,{className:"relative flex-col gap-2 pt-4 mt-1",children:[x?e.jsx(ae,{onClick:()=>{try{let m=r.website_url;if(x){const p=new URL(r.website_url);p.searchParams.set("user_id",x.id),m=p.toString()}ye(m)}catch{ye(r.website_url)}},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("common.continue","继续")}):e.jsx(ae,{onClick:()=>{V(!1),H("/auth",{state:{from:l.pathname}})},className:"w-full rounded-xl h-11 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/25 transition-all duration-200",children:s("auth.login","登录")}),e.jsx(fe,{className:"w-full rounded-xl h-11 bg-secondary hover:bg-secondary/80 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(Dt,{restaurantId:r.id,showGallery:r.show_dish_gallery!==!1}),r.template!=="ghost"&&e.jsx("div",{ref:A,children:e.jsxs(Y,{open:z,onOpenChange:v,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(Z,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx(X,{className:`w-5 h-5 text-muted-foreground transition-transform ${z?"rotate-180":""}`})]})}),e.jsx(J,{children:R?e.jsx("div",{ref:c,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(ke,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Ke,{}),e.jsx(Tt,{restaurantId:r.id}),e.jsx(Ke,{}),e.jsx("div",{ref:U,children:C?e.jsx(a.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ke,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(sa,{restaurantId:r.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ke,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(me,{open:le,onOpenChange:P,children:e.jsxs(xe,{children:[e.jsxs(ue,{children:[e.jsx(he,{children:s("activities.loginRequired")}),e.jsx(pe,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(ge,{children:[e.jsx(fe,{children:s("common.cancel")}),e.jsx(ae,{onClick:()=>H("/auth"),children:s("activities.goToLogin")})]})]})}),oe]})})};export{Ma as default};
//# sourceMappingURL=RestaurantDetail-r4FmudK8.js.map
