{"version":3,"file":"useSensitiveWords-D-Lq9hHH.js","sources":["../../src/hooks/useSensitiveWords.ts"],"sourcesContent":["import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { useToast } from \"@/hooks/use-toast\";\r\n\r\nexport interface SensitiveWord {\r\n  id: string;\r\n  word: string;\r\n  created_at: string;\r\n  created_by: string | null;\r\n}\r\n\r\nexport const useSensitiveWords = () => {\r\n  return useQuery({\r\n    queryKey: [\"sensitive-words\"],\r\n    queryFn: async () => {\r\n      const { data, error } = await supabase\r\n        .from(\"sensitive_words\")\r\n        .select(\"*\")\r\n        .order(\"created_at\", { ascending: false });\r\n\r\n      if (error) throw error;\r\n      return data as SensitiveWord[];\r\n    },\r\n    staleTime: 60000, // Cache for 1 minute\r\n  });\r\n};\r\n\r\nexport const useCheckSensitiveWords = () => {\r\n  const { data: sensitiveWords } = useSensitiveWords();\r\n\r\n  const checkContent = (content: string): { hasSensitive: boolean; matchedWords: string[] } => {\r\n    if (!sensitiveWords || sensitiveWords.length === 0) {\r\n      return { hasSensitive: false, matchedWords: [] };\r\n    }\r\n\r\n    const lowerContent = content.toLowerCase();\r\n    const matchedWords: string[] = [];\r\n\r\n    for (const item of sensitiveWords) {\r\n      if (lowerContent.includes(item.word.toLowerCase())) {\r\n        matchedWords.push(item.word);\r\n      }\r\n    }\r\n\r\n    return {\r\n      hasSensitive: matchedWords.length > 0,\r\n      matchedWords,\r\n    };\r\n  };\r\n\r\n  return { checkContent, isLoading: !sensitiveWords };\r\n};\r\n\r\nexport const useAddSensitiveWord = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (word: string) => {\r\n      const { data, error } = await supabase\r\n        .from(\"sensitive_words\")\r\n        .insert({ word: word.trim().toLowerCase() })\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"sensitive-words\"] });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Sensitive word added successfully\",\r\n      });\r\n    },\r\n    onError: (error: any) => {\r\n      toast({\r\n        title: \"Error\",\r\n        description: error.message?.includes(\"duplicate\") \r\n          ? \"This word already exists\" \r\n          : \"Failed to add sensitive word\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useUpdateSensitiveWord = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async ({ id, word }: { id: string; word: string }) => {\r\n      const { data, error } = await supabase\r\n        .from(\"sensitive_words\")\r\n        .update({ word: word.trim().toLowerCase() })\r\n        .eq(\"id\", id)\r\n        .select()\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      return data;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"sensitive-words\"] });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Sensitive word updated successfully\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update sensitive word\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n\r\nexport const useDeleteSensitiveWord = () => {\r\n  const { toast } = useToast();\r\n  const queryClient = useQueryClient();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id: string) => {\r\n      const { error } = await supabase\r\n        .from(\"sensitive_words\")\r\n        .delete()\r\n        .eq(\"id\", id);\r\n\r\n      if (error) throw error;\r\n    },\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: [\"sensitive-words\"] });\r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Sensitive word deleted successfully\",\r\n      });\r\n    },\r\n    onError: () => {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete sensitive word\",\r\n        variant: \"destructive\",\r\n      });\r\n    },\r\n  });\r\n};\r\n"],"names":["useSensitiveWords","useQuery","data","error","supabase","useCheckSensitiveWords","sensitiveWords","content","lowerContent","matchedWords","item","useAddSensitiveWord","toast","useToast","queryClient","useQueryClient","useMutation","word","useUpdateSensitiveWord","id","useDeleteSensitiveWord"],"mappings":"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"}