{"version":3,"file":"PostCard-DJx1_0yV.js","sources":["../../src/components/community/PostCard.tsx"],"sourcesContent":["import { useState, useEffect } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { formatDistanceToNow } from \"date-fns\";\r\nimport { zhCN, enUS, pt } from \"date-fns/locale\";\r\nimport { Heart, MessageCircle, Share2, MoreHorizontal, Calendar, X, ChevronLeft, ChevronRight, MapPin, FileImage, ChevronDown, ChevronUp } from \"lucide-react\";\r\nimport {\r\n  Carousel,\r\n  CarouselContent,\r\n  CarouselItem,\r\n  type CarouselApi,\r\n} from \"@/components/ui/carousel\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardContent, CardFooter, CardHeader } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"@/components/ui/dropdown-menu\";\r\nimport { CommunityPost, useLikePost, useSharePost, useDeletePost } from \"@/hooks/useCommunityPosts\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { useLocalizedContent } from \"@/hooks/useLocalizedContent\";\r\nimport { toast } from \"sonner\";\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"@/components/ui/alert-dialog\";\r\nimport TranslateButton from \"@/components/TranslateButton\";\r\nimport { useSmartShare, ShareDrawer } from \"@/components/ShareDrawer\";\r\n\r\ninterface PostCardProps {\r\n  post: CommunityPost;\r\n  showActions?: boolean;\r\n  isDetailPage?: boolean;\r\n}\r\n\r\nconst PostCard = ({ post, showActions = true, isDetailPage = false }: PostCardProps) => {\r\n  const { t, i18n } = useTranslation();\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const { getLocalizedField } = useLocalizedContent();\r\n  const likePost = useLikePost();\r\n  const sharePost = useSharePost();\r\n  const deletePost = useDeletePost();\r\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\r\n  const [imageError, setImageError] = useState<Record<string, boolean>>({});\r\n  const [previewOpen, setPreviewOpen] = useState(false);\r\n  const [previewIndex, setPreviewIndex] = useState(0);\r\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\r\n  const [previewCarouselApi, setPreviewCarouselApi] = useState<CarouselApi>();\r\n  const [currentSlide, setCurrentSlide] = useState(0);\r\n  const [translatedContent, setTranslatedContent] = useState<string | null>(null);\r\n  const [touchStartX, setTouchStartX] = useState<number | null>(null);\r\n  const [isSwiping, setIsSwiping] = useState(false);\r\n  const [swipeOffset, setSwipeOffset] = useState(0);\r\n  const [isAnimating, setIsAnimating] = useState(false);\r\n  const [imageDimensions, setImageDimensions] = useState<Record<string, { width: number; height: number }>>({});\r\n  const [longImageScrollStart, setLongImageScrollStart] = useState<{ y: number; scrollTop: number } | null>(null);\r\n  const [showAllRestaurants, setShowAllRestaurants] = useState(false);\r\n  const { share: smartShareFn, DrawerComponent: SmartShareDrawer } = useSmartShare();\r\n\r\n  // Lock body scroll when preview is open\r\n  useEffect(() => {\r\n    if (previewOpen) {\r\n      const scrollY = window.scrollY;\r\n      document.body.style.position = 'fixed';\r\n      document.body.style.top = `-${scrollY}px`;\r\n      document.body.style.left = '0';\r\n      document.body.style.right = '0';\r\n      document.body.style.overflow = 'hidden';\r\n      \r\n      return () => {\r\n        document.body.style.position = '';\r\n        document.body.style.top = '';\r\n        document.body.style.left = '';\r\n        document.body.style.right = '';\r\n        document.body.style.overflow = '';\r\n        window.scrollTo(0, scrollY);\r\n      };\r\n    }\r\n  }, [previewOpen]);\r\n\r\n  // Listen to carousel slide changes\r\n  useEffect(() => {\r\n    if (!carouselApi) return;\r\n    \r\n    setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    \r\n    carouselApi.on(\"select\", () => {\r\n      setCurrentSlide(carouselApi.selectedScrollSnap());\r\n    });\r\n  }, [carouselApi]);\r\n\r\n  const getDateLocale = () => {\r\n    switch (i18n.language) {\r\n      case \"zh\":\r\n        return zhCN;\r\n      case \"pt\":\r\n        return pt;\r\n      default:\r\n        return enUS;\r\n    }\r\n  };\r\n\r\n  const handleLike = () => {\r\n    if (!user) return;\r\n    likePost.mutate({ postId: post.id, liked: post.user_liked || false });\r\n  };\r\n\r\n  const handleShare = async () => {\r\n    const shareUrl = `${window.location.origin}/community/${post.id}`;\r\n    \r\n    smartShareFn({\r\n      title: t(\"community.shareTitle\", \"分享帖子\"),\r\n      text: post.content.replace(/<[^>]*>/g, '').substring(0, 100),\r\n      url: shareUrl,\r\n    }, () => {\r\n      if (user) {\r\n        sharePost.mutate(post.id);\r\n      }\r\n      toast.success(t(\"community.shareSuccess\", \"分享成功\"));\r\n    });\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    deletePost.mutate(post.id);\r\n    setShowDeleteDialog(false);\r\n  };\r\n\r\n  const handleImageClick = (index: number) => {\r\n    if (isDetailPage) {\r\n      // On detail page, open preview\r\n      setPreviewIndex(index);\r\n      setPreviewOpen(true);\r\n    } else {\r\n      // On feed, navigate to post detail\r\n      navigate(`/community/${post.id}`);\r\n    }\r\n  };\r\n\r\n  const handlePrevImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === 0 ? (post.image_urls?.length || 1) - 1 : prev - 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleNextImage = () => {\r\n    if (isAnimating) return;\r\n    setIsAnimating(true);\r\n    setSwipeOffset(-window.innerWidth);\r\n    setTimeout(() => {\r\n      setPreviewIndex((prev) => \r\n        prev === (post.image_urls?.length || 1) - 1 ? 0 : prev + 1\r\n      );\r\n      setSwipeOffset(0);\r\n      setIsAnimating(false);\r\n    }, 250);\r\n  };\r\n\r\n  const handleImageLoad = (e: React.SyntheticEvent<HTMLImageElement>, url: string) => {\r\n    const img = e.currentTarget;\r\n    setImageDimensions(prev => ({\r\n      ...prev,\r\n      [url]: { width: img.naturalWidth, height: img.naturalHeight }\r\n    }));\r\n  };\r\n\r\n  const isLongImage = (url: string) => {\r\n    const dims = imageDimensions[url];\r\n    return dims ? dims.height / dims.width > 1.5 : false;\r\n  };\r\n\r\n  const isAuthor = user?.id === post.author_id;\r\n  const activityTitle = post.activity\r\n    ? getLocalizedField(post.activity, \"title\")\r\n    : null;\r\n  \r\n  // Get all restaurants (from new junction table + legacy single restaurant)\r\n  const allRestaurants = [\r\n    ...(post.restaurants || []),\r\n    ...(post.restaurant && !post.restaurants?.find(r => r.id === post.restaurant?.id) ? [post.restaurant] : []),\r\n  ];\r\n  \r\n  // Max visible restaurants before collapsing\r\n  const maxVisibleRestaurants = isDetailPage ? 3 : 2;\r\n  const visibleRestaurants = showAllRestaurants \r\n    ? allRestaurants \r\n    : allRestaurants.slice(0, maxVisibleRestaurants);\r\n  const hasMoreRestaurants = allRestaurants.length > maxVisibleRestaurants;\r\n\r\n  // Get localized content - prioritize pre-stored translations\r\n  const localizedContent = getLocalizedField(post, \"content\");\r\n  \r\n  // Check if we have a pre-stored translation for current language\r\n  const hasLocalizedTranslation = \r\n    (i18n.language === \"zh\" && post.content_zh) ||\r\n    (i18n.language === \"en\" && post.content_en) ||\r\n    (i18n.language === \"pt\" && post.content_pt);\r\n  \r\n  // Use localized content, or translated content, or original\r\n  // Convert newlines to <br> for proper display\r\n  const rawContent = translatedContent || localizedContent || post.content;\r\n  const displayContent = rawContent?.replace(/\\n/g, '<br>') || '';\r\n\r\n  return (\r\n    <>\r\n      <Card className=\"overflow-hidden\">\r\n        <CardHeader className=\"pb-3\">\r\n          <div className=\"flex items-start justify-between\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <Avatar className=\"h-10 w-10\">\r\n                <AvatarImage src={post.author?.avatar_url || undefined} />\r\n                <AvatarFallback>\r\n                  {post.author?.display_name?.charAt(0) || \"?\"}\r\n                </AvatarFallback>\r\n              </Avatar>\r\n              <div>\r\n                <p className=\"font-medium text-sm\">{post.author?.display_name}</p>\r\n                <p className=\"text-xs text-muted-foreground\">\r\n                  {formatDistanceToNow(new Date(post.created_at), {\r\n                    addSuffix: true,\r\n                    locale: getDateLocale(),\r\n                  })}\r\n                </p>\r\n              </div>\r\n            </div>\r\n\r\n            {showActions && isAuthor && (\r\n              <DropdownMenu>\r\n                <DropdownMenuTrigger asChild>\r\n                  <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\">\r\n                  <DropdownMenuItem\r\n                    onClick={() => setShowDeleteDialog(true)}\r\n                    className=\"text-destructive\"\r\n                  >\r\n                    {t(\"common.delete\", \"删除\")}\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n            )}\r\n          </div>\r\n        </CardHeader>\r\n\r\n        <CardContent className=\"pt-0 pb-3\">\r\n          {/* Activity & Restaurant Badges */}\r\n          {(post.activity || allRestaurants.length > 0) && (\r\n            <div className=\"flex flex-wrap gap-2 mb-3 items-center\">\r\n              {post.activity && (\r\n                <Link to={`/activity/${post.activity.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <Calendar className=\"h-3 w-3\" />\r\n                    {activityTitle}\r\n                  </Badge>\r\n                </Link>\r\n              )}\r\n              {visibleRestaurants.map((restaurant) => (\r\n                <Link key={restaurant.id} to={`/restaurant/${restaurant.id}`}>\r\n                  <Badge variant=\"secondary\" className=\"gap-1\">\r\n                    <MapPin className=\"h-3 w-3\" />\r\n                    {getLocalizedField(restaurant, \"name\")}\r\n                  </Badge>\r\n                </Link>\r\n              ))}\r\n              {hasMoreRestaurants && !showAllRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(true)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  +{allRestaurants.length - maxVisibleRestaurants} {t(\"community.more\", \"更多\")}\r\n                  <ChevronDown className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n              {showAllRestaurants && hasMoreRestaurants && (\r\n                <button\r\n                  onClick={() => setShowAllRestaurants(false)}\r\n                  className=\"text-xs text-muted-foreground hover:text-foreground flex items-center gap-0.5\"\r\n                >\r\n                  {t(\"community.collapse\", \"收起\")}\r\n                  <ChevronUp className=\"h-3 w-3\" />\r\n                </button>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Content */}\r\n          <Link to={`/community/${post.id}`}>\r\n            <div\r\n              className={`prose prose-sm max-w-none dark:prose-invert ${!isDetailPage ? 'line-clamp-6' : ''}`}\r\n              dangerouslySetInnerHTML={{ __html: displayContent }}\r\n            />\r\n          </Link>\r\n\r\n          {/* Translate Button - only show if no pre-stored translation */}\r\n          {!hasLocalizedTranslation && (\r\n            <TranslateButton \r\n              text={post.content} \r\n              onTranslation={setTranslatedContent}\r\n              className=\"mt-1\"\r\n            />\r\n          )}\r\n\r\n          {/* Images - Carousel only for multiple images */}\r\n          {/* In detail page with video, filter out auto-generated cover images */}\r\n          {(() => {\r\n            const displayImageUrls = isDetailPage && post.video_url\r\n              ? (post.image_urls || []).filter(url => !url.includes('-cover'))\r\n              : post.image_urls;\r\n            \r\n            if (!displayImageUrls || displayImageUrls.length === 0) return null;\r\n            \r\n            return (\r\n              <div className=\"relative mt-3\">\r\n                {displayImageUrls.length === 1 ? (\r\n                  // Single image - always limit max height\r\n                  (() => {\r\n                    const url = displayImageUrls[0];\r\n                    const isLong = isLongImage(url);\r\n                    return (\r\n                      <div \r\n                        className=\"relative overflow-hidden rounded-lg cursor-pointer max-h-[300px] sm:max-h-[400px]\"\r\n                        onClick={() => handleImageClick(0)}\r\n                      >\r\n                        {!imageError[url] ? (\r\n                          <>\r\n                            <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"w-full max-h-[300px] sm:max-h-[400px] object-cover object-top\"\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                              onError={() =>\r\n                                setImageError((prev) => ({ ...prev, [url]: true }))\r\n                              }\r\n                            />\r\n                            {/* Long image indicator */}\r\n                            {isLong && (\r\n                              <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                <FileImage className=\"h-3 w-3\" />\r\n                                <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        ) : (\r\n                          <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                            <span className=\"text-xs text-muted-foreground\">\r\n                              {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                            </span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })()\r\n                ) : (\r\n                  // Multiple images - use carousel with smart display\r\n                  <>\r\n                    <Carousel \r\n                      setApi={setCarouselApi} \r\n                      className=\"w-full\"\r\n                      opts={{ loop: true }}\r\n                    >\r\n                      <CarouselContent className=\"-ml-0\">\r\n                        {displayImageUrls.map((url, index) => {\r\n                          const isLong = isLongImage(url);\r\n                          return (\r\n                            <CarouselItem key={index} className=\"pl-0\">\r\n                              <div \r\n                                className=\"relative overflow-hidden rounded-lg cursor-pointer aspect-[4/3] bg-muted\"\r\n                                onClick={() => handleImageClick(index)}\r\n                              >\r\n                                {!imageError[url] ? (\r\n                                  <>\r\n                                    <img\r\n                                      src={url}\r\n                                      alt=\"\"\r\n                                      className=\"w-full h-full object-contain\"\r\n                                      onLoad={(e) => handleImageLoad(e, url)}\r\n                                      onError={() =>\r\n                                        setImageError((prev) => ({ ...prev, [url]: true }))\r\n                                      }\r\n                                    />\r\n                                    {/* Long image indicator */}\r\n                                    {isLong && (\r\n                                      <div className=\"absolute bottom-2 right-2 bg-black/60 text-white text-xs px-2 py-0.5 rounded-full flex items-center gap-1\">\r\n                                        <FileImage className=\"h-3 w-3\" />\r\n                                        <span>{t(\"community.longImage\", \"长图\")}</span>\r\n                                      </div>\r\n                                    )}\r\n                                  </>\r\n                                ) : (\r\n                                  <div className=\"w-full h-full min-h-[200px] bg-muted flex items-center justify-center\">\r\n                                    <span className=\"text-xs text-muted-foreground\">\r\n                                      {t(\"common.imageLoadError\", \"图片加载失败\")}\r\n                                    </span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </CarouselItem>\r\n                          );\r\n                        })}\r\n                      </CarouselContent>\r\n                    </Carousel>\r\n                    \r\n                    {/* Top-right slide counter */}\r\n                    <div className=\"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10\">\r\n                      {currentSlide + 1}/{displayImageUrls.length}\r\n                    </div>\r\n                    \r\n                    {/* Bottom navigation dots */}\r\n                    <div className=\"flex justify-center gap-1.5 mt-2\">\r\n                      {displayImageUrls.map((_, index) => (\r\n                        <button\r\n                          key={index}\r\n                          className={`w-1.5 h-1.5 rounded-full transition-colors ${\r\n                            index === currentSlide \r\n                              ? \"bg-primary\" \r\n                              : \"bg-muted-foreground/30\"\r\n                          }`}\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            carouselApi?.scrollTo(index);\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            );\r\n          })()}\r\n\r\n          {/* Video */}\r\n          {post.video_url && (\r\n            <div className=\"mt-3 rounded-lg overflow-hidden bg-gray-900\">\r\n              <video\r\n                src={post.video_url}\r\n                {...(post.image_urls?.length ? { poster: post.image_urls[0] } : {})}\r\n                controls\r\n                className=\"w-full max-h-96\"\r\n                preload=\"metadata\"\r\n                playsInline\r\n              />\r\n            </div>\r\n          )}\r\n        </CardContent>\r\n\r\n        <CardFooter className=\"pt-0 border-t\">\r\n          <div className=\"flex items-center gap-4 pt-3 w-full\">\r\n            <Button\r\n              variant=\"ghost\"\r\n              size=\"sm\"\r\n              className={`gap-2 ${post.user_liked ? \"text-red-500\" : \"\"}`}\r\n              onClick={handleLike}\r\n              disabled={!user}\r\n            >\r\n              <Heart\r\n                className={`h-4 w-4 ${post.user_liked ? \"fill-current\" : \"\"}`}\r\n              />\r\n              <span>{post.likes_count}</span>\r\n            </Button>\r\n\r\n            <Link to={`/community/${post.id}`}>\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\">\r\n                <MessageCircle className=\"h-4 w-4\" />\r\n                <span>{post.comments_count}</span>\r\n              </Button>\r\n            </Link>\r\n\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" onClick={handleShare}>\r\n              <Share2 className=\"h-4 w-4\" />\r\n              <span>{post.shares_count}</span>\r\n            </Button>\r\n          </div>\r\n        </CardFooter>\r\n      </Card>\r\n\r\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{t(\"common.confirmDelete\", \"确认删除\")}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {t(\"community.deleteWarning\", \"删除后无法恢复，确定要删除这篇帖子吗？\")}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>{t(\"common.cancel\", \"取消\")}</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleDelete}>\r\n              {t(\"common.delete\", \"删除\")}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Image Preview - Using Carousel for smooth swipe like feed */}\r\n      {previewOpen && createPortal(\r\n        <div \r\n          className=\"fixed inset-0 z-[100] bg-black overflow-hidden\"\r\n          onClick={(e) => {\r\n            // Only close if clicking on backdrop, not carousel\r\n            if (e.target === e.currentTarget) {\r\n              setPreviewOpen(false);\r\n            }\r\n          }}\r\n          onWheel={(e) => e.stopPropagation()}\r\n          onTouchMove={(e) => e.stopPropagation()}\r\n        >\r\n          {/* Image Counter */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full\">\r\n              {previewIndex + 1} / {post.image_urls.length}\r\n            </div>\r\n          )}\r\n\r\n          {/* Close Button */}\r\n          <Button\r\n            variant=\"ghost\"\r\n            size=\"icon\"\r\n            className=\"absolute top-4 right-4 z-10 text-white hover:bg-white/20\"\r\n            onClick={() => setPreviewOpen(false)}\r\n          >\r\n            <X className=\"h-6 w-6\" />\r\n          </Button>\r\n\r\n          {/* Full screen Carousel - centered with calc() constraints */}\r\n          <div className=\"absolute inset-0 flex items-center justify-center\">\r\n            <Carousel\r\n              className=\"w-full\"\r\n              opts={{ loop: true, startIndex: previewIndex }}\r\n              setApi={(api) => {\r\n                setPreviewCarouselApi(api);\r\n                if (api) {\r\n                  api.on(\"select\", () => {\r\n                    setPreviewIndex(api.selectedScrollSnap());\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <CarouselContent className=\"-ml-0\">\r\n                {post.image_urls?.map((url, index) => {\r\n                  const dims = imageDimensions[url];\r\n                  const isLong = dims ? dims.height / dims.width > 1.5 : false;\r\n                  return (\r\n                    <CarouselItem key={index} className=\"pl-0 flex items-center justify-center\">\r\n                      {isLong ? (\r\n                        <div \r\n                          className=\"w-full h-screen overflow-x-hidden overflow-y-scroll overscroll-contain\"\r\n                          onMouseDown={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onMouseUp={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const deltaY = Math.abs(e.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              if (deltaY < 10 && deltaScroll < 10) {\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                          onTouchStart={(e) => {\r\n                            const target = e.currentTarget;\r\n                            setLongImageScrollStart({ y: e.touches[0].clientY, scrollTop: target.scrollTop });\r\n                          }}\r\n                          onTouchEnd={(e) => {\r\n                            if (longImageScrollStart) {\r\n                              const touch = e.changedTouches[0];\r\n                              const deltaY = Math.abs(touch.clientY - longImageScrollStart.y);\r\n                              const deltaScroll = Math.abs(e.currentTarget.scrollTop - longImageScrollStart.scrollTop);\r\n                              // Use a slightly larger threshold for touch to account for touch inaccuracy\r\n                              if (deltaY < 15 && deltaScroll < 15) {\r\n                                e.preventDefault();\r\n                                setPreviewOpen(false);\r\n                              }\r\n                              setLongImageScrollStart(null);\r\n                            }\r\n                          }}\r\n                        >\r\n                        <img\r\n                              src={url}\r\n                              alt=\"\"\r\n                              className=\"block select-none\"\r\n                              style={{\r\n                                width: '100vw',\r\n                                minHeight: '100dvh',\r\n                                height: 'auto',\r\n                                margin: 0\r\n                              }}\r\n                              draggable={false}\r\n                              onLoad={(e) => handleImageLoad(e, url)}\r\n                            />\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center\">\r\n                          <img\r\n                            src={url}\r\n                            alt=\"\"\r\n                            className=\"object-contain w-screen h-screen select-none cursor-pointer\"\r\n                            draggable={false}\r\n                            onClick={() => setPreviewOpen(false)}\r\n                            onLoad={(e) => handleImageLoad(e, url)}\r\n                          />\r\n                        </div>\r\n                      )}\r\n                    </CarouselItem>\r\n                  );\r\n                })}\r\n              </CarouselContent>\r\n            </Carousel>\r\n          </div>\r\n\r\n          {/* Desktop Navigation Buttons - connected to Carousel API */}\r\n          {post.image_urls && post.image_urls.length > 1 && (\r\n            <>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollPrev()}\r\n              >\r\n                <ChevronLeft className=\"h-8 w-8\" />\r\n              </Button>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex\"\r\n                onClick={() => previewCarouselApi?.scrollNext()}\r\n              >\r\n                <ChevronRight className=\"h-8 w-8\" />\r\n              </Button>\r\n            </>\r\n          )}\r\n        </div>,\r\n        document.body\r\n      )}\r\n      \r\n      {/* Smart Share Drawer for WebView environments */}\r\n      {SmartShareDrawer}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default PostCard;\r\n"],"names":["PostCard","post","showActions","isDetailPage","t","i18n","useTranslation","user","useAuth","navigate","useNavigate","getLocalizedField","useLocalizedContent","likePost","useLikePost","sharePost","useSharePost","deletePost","useDeletePost","showDeleteDialog","setShowDeleteDialog","useState","imageError","setImageError","previewOpen","setPreviewOpen","previewIndex","setPreviewIndex","carouselApi","setCarouselApi","previewCarouselApi","setPreviewCarouselApi","currentSlide","setCurrentSlide","translatedContent","setTranslatedContent","imageDimensions","setImageDimensions","longImageScrollStart","setLongImageScrollStart","showAllRestaurants","setShowAllRestaurants","smartShareFn","SmartShareDrawer","useSmartShare","useEffect","scrollY","getDateLocale","zhCN","pt","enUS","handleLike","handleShare","shareUrl","toast","handleDelete","handleImageClick","index","handleImageLoad","e","url","img","prev","isLongImage","dims","isAuthor","activityTitle","allRestaurants","r","maxVisibleRestaurants","visibleRestaurants","hasMoreRestaurants","localizedContent","hasLocalizedTranslation","displayContent","jsxs","Fragment","Card","jsx","CardHeader","Avatar","AvatarImage","AvatarFallback","DropdownMenu","DropdownMenuTrigger","Button","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","CardContent","Link","Badge","Calendar","restaurant","MapPin","ChevronDown","ChevronUp","TranslateButton","displayImageUrls","isLong","FileImage","Carousel","CarouselContent","CarouselItem","_","CardFooter","Heart","MessageCircle","Share2","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","createPortal","X","api","target","deltaY","deltaScroll","touch","ChevronLeft","ChevronRight"],"mappings":"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"}