import{p as O,j as e,bJ as oe,bI as te,bc as ce,ao as Ce,bN as le,cy as de,q as me,v as Se,w as h,r as a,bR as X,b0 as Re,aM as re,a4 as Pe,dN as _e,X as ne,bb as Ie,a_ as Ue,bf as Te,cT as Ee,bW as ae,dP as qe,eq as Le,b6 as Me,b5 as De}from"./vendor-react-BDRnRVHv.js";import{D as $e,W as Ae,c as Fe,d as Oe,e as Be,s as w,h as F,G as Qe,af as ze,al as Ke,ag as Ge,ah as He,a8 as We,a as Ve,S as A}from"./index-4ynzYXNo.js";import{P as Je}from"./PostGridCard-DnD70SQU.js";import{c as Xe}from"./usePoints-CPmttJOW.js";import{R as Ye,b as Ze,c as es,M as ss,A as ts,d as rs}from"./EditRecipeDialog-JLc5c3aO.js";import{P as is}from"./progress-Xe9TpOIa.js";import{g as ns,h as as,i as os,u as cs,j as ls}from"./useCommunityPosts-B7JV6vWq.js";import{u as ds}from"./useActivities-C666VYuY.js";import{u as ms}from"./useRestaurants-B6y6NQ-V.js";import{u as us}from"./useLocalizedContent-DlPVPXMF.js";import{P as ps}from"./PullToRefresh-DBn1wYOK.js";import{u as hs}from"./useInfiniteScroll-CD5yTo1V.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-DA900zcV.js";import"./drawer-DFVAeTgM.js";import"./popover-D-hZJ7T8.js";import"./collapsible-BkHghtKx.js";const xs=()=>{const{t:r}=O(),{data:s}=Xe(),t=s?.find(l=>l.key==="post_points")?.value||"5",d=s?.find(l=>l.key==="min_post_length")?.value||"10",u=s?.find(l=>l.key==="post_require_media")?.value==="true";return e.jsxs($e,{children:[e.jsx(Ae,{asChild:!0,children:e.jsx("button",{className:"text-primary hover:underline text-sm whitespace-nowrap",children:r("community.viewPointsRules","查看详细规则")})}),e.jsxs(Fe,{className:"max-w-md",children:[e.jsx(Oe,{children:e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),r("community.pointsRulesTitle","发帖积分规则")]})}),e.jsxs("div",{className:"space-y-4 pt-2",children:[e.jsx("p",{className:"text-muted-foreground text-sm",children:r("community.pointsRulesIntro","通过发布社区帖子获得积分，具体规则如下：")}),e.jsxs("ul",{className:"space-y-3",children:[e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:r("community.rulePostPoints",{points:t})})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:r("community.ruleMinLength",{length:d})})]}),u&&e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(te,{className:"h-4 w-4 text-green-500 mt-0.5 shrink-0"}),e.jsx("span",{children:r("community.ruleRequireMedia","帖子必须包含至少一张图片或一个视频")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(ce,{className:"h-4 w-4 text-blue-500 mt-0.5 shrink-0"}),e.jsx("span",{children:r("community.ruleDailyLimit","每天仅可通过发帖获得一次积分奖励")})]}),e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(Ce,{className:"h-4 w-4 text-purple-500 mt-0.5 shrink-0"}),e.jsx("span",{children:r("community.ruleModerationRequired","帖子需通过审核后才能获得积分")})]})]})]})]})]})},fs=({onSelect:r})=>{const{t:s}=O();return e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:s("community.selectPostType","选择发布类型")}),e.jsx("p",{className:"text-muted-foreground text-sm mb-8 text-center",children:s("community.selectPostTypeDesc","选择您想要发布的内容类型")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full max-w-sm",children:[e.jsxs("button",{onClick:()=>r("post"),className:"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(le,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium",children:s("community.postType.post","发布帖子")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("community.postType.postDesc","分享美食体验和想法")})]})]}),e.jsxs("button",{onClick:()=>r("recipe"),className:"flex flex-col items-center gap-3 p-6 rounded-xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:e.jsx(de,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"font-medium",children:s("community.postType.recipe","发布食谱")}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s("community.postType.recipeDesc","分享烹饪教程和菜谱")})]})]})]})]})},gs=()=>{const r=me(),{t:s}=O();return Se({mutationFn:async t=>{const{data:{user:d}}=await w.auth.getUser();if(!d)throw new Error("Not authenticated");let u;t.introduction?u=t.introduction:u="";const l=[];t.cover_image&&l.push(t.cover_image),t.steps.forEach(o=>{o.image_urls&&o.image_urls.length>0?o.image_urls.forEach(k=>l.push(k)):o.image_url&&l.push(o.image_url)});const{data:U,error:x}=await w.from("community_posts").insert({author_id:d.id,post_type:"recipe",content:u,image_urls:l,recipe_name:t.recipe_name,cook_time:t.cook_time,difficulty:t.difficulty,servings:t.servings,ingredients:t.ingredients,steps:t.steps,nutrition:t.nutrition?t.nutrition:null,recipe_tags:t.recipe_tags||null,recipe_category:t.recipe_category||null,status:"pending",moderation_status:"pending"}).select().single();if(x)throw x;try{await w.functions.invoke("moderate-post",{body:{post_id:U.id,content:u,user_id:d.id,image_urls:l}})}catch(o){console.error("Moderation call failed:",o)}return U},onSuccess:()=>{r.invalidateQueries({queryKey:["community-posts"]}),r.invalidateQueries({queryKey:["has-posted-today"]}),h.success(s("recipe.publishSuccess","食谱发布成功"))},onError:t=>{console.error("Create recipe error:",t),h.error(s("recipe.publishError","发布失败"))}})},ys=({onClose:r,onSuccess:s})=>{const{t}=O(),d=gs(),[u,l]=a.useState(0),[U,x]=a.useState(null),[o,k]=a.useState({recipe_name:"",cook_time:void 0,difficulty:void 0,servings:void 0}),[j,$]=a.useState([{name:"",amount:"",unit:""}]),[L,R]=a.useState([{order:1,description:""}]),[g,M]=a.useState({}),[C,P]=a.useState(""),b=[{key:"basic",title:t("recipe.step.basic","基本信息")},{key:"ingredients",title:t("recipe.step.ingredients","配料")},{key:"steps",title:t("recipe.step.steps","步骤")}],S=(u+1)/b.length*100,c=()=>o.recipe_name?.trim()?!o.cook_time||o.cook_time<1?(h.error(t("recipe.cookTimeRequired","请输入烹饪时间")),!1):o.difficulty?!o.servings||o.servings<1?(h.error(t("recipe.servingsRequired","请输入份量")),!1):!0:(h.error(t("recipe.difficultyRequired","请选择难度")),!1):(h.error(t("recipe.nameRequired","请输入食谱名称")),!1),N=()=>j.filter(v=>v.name.trim()).length===0?(h.error(t("recipe.ingredientsRequired","请至少添加一种配料")),!1):!0,B=()=>L.filter(v=>v.description.trim()).length===0?(h.error(t("recipe.stepsRequired","请至少添加一个步骤")),!1):!0,G=()=>{u===0&&!c()||u===1&&!N()||l(y=>Math.min(y+1,b.length-1))},H=()=>{l(y=>Math.max(y-1,0))},_=async()=>{if(!B())return;const y=j.filter(I=>I.name.trim()),v=L.filter(I=>I.description.trim()).map((I,Z)=>({...I,order:Z+1})),Y=g.calories||g.protein||g.carbs||g.fat;try{await d.mutateAsync({recipe_name:o.recipe_name,cook_time:o.cook_time,difficulty:o.difficulty,servings:o.servings,ingredients:y,steps:v,cover_image:U,nutrition:Y?g:void 0,introduction:C.trim()||void 0}),s()}catch{}},Q=()=>{switch(u){case 0:return e.jsx(es,{data:o,coverImage:U,nutrition:g,introduction:C,onDataChange:k,onCoverImageChange:x,onNutritionChange:M,onIntroductionChange:P});case 1:return e.jsx(Ze,{ingredients:j,onChange:$});case 2:return e.jsx(Ye,{steps:L,onChange:R});default:return null}};return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b bg-background shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("button",{type:"button",onClick:r,className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("h2",{className:"font-medium",children:t("recipe.createTitle","创建食谱")}),e.jsx("div",{className:"w-6"})," "]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(is,{value:S,className:"h-1"}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground",children:b.map((y,v)=>e.jsx("span",{className:v===u?"text-primary font-medium":"",children:y.title},y.key))})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:Q()}),e.jsx("div",{className:"px-4 py-3 pb-[max(1rem,env(safe-area-inset-bottom))] border-t bg-background shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[u>0&&e.jsxs(F,{type:"button",variant:"outline",onClick:H,className:"flex-1",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),t("common.back","上一步")]}),u<b.length-1?e.jsxs(F,{type:"button",onClick:G,className:"flex-1",children:[t("common.next","下一步"),e.jsx(Re,{className:"h-4 w-4 ml-2"})]}):e.jsxs(F,{type:"button",onClick:_,disabled:d.isPending,className:"flex-1",children:[d.isPending?e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Pe,{className:"h-4 w-4 mr-2"}),t("recipe.publish","发布食谱")]})]})})]})},bs=({trigger:r})=>{const{t:s}=O(),{getLocalizedField:t}=us(),d=ns(),{data:u}=ds(),{data:l}=ms(),{role:U,isMerchant:x,isAdmin:o,isSupervisor:k}=Qe(),{data:j}=as(),{data:$,isLoading:L}=os(),[R,g]=a.useState(!1),[M,C]=a.useState("selecting"),[P,b]=a.useState(""),[S,c]=a.useState([]),[N,B]=a.useState(null),[G,H]=a.useState(""),[_,Q]=a.useState([]),[y,v]=a.useState(!1),[Y,I]=a.useState(!1),[Z,ie]=a.useState(!1),[ee,z]=a.useState(!1),W=a.useRef(null),V=a.useRef(null),K=!x&&!k&&!o,J=o||k||x;a.useEffect(()=>{x&&j&&R&&Q([j.id])},[x,j,R]);const se=()=>{C(J?"selecting":"post"),b(""),c([]),B(null),H(""),Q([]),I(!1),ie(!1),z(!1)};a.useEffect(()=>{R&&C(J?"selecting":"post")},[R,J]);const ue=i=>{g(i),i||se()},pe=u?.filter(i=>i.status==="published")||[],he=async i=>{const m=i.target.files;if(!(!m||m.length===0)){if(S.length+m.length>9){h.error(s("community.maxImages","最多上传9张图片"));return}v(!0);try{const{data:{user:f}}=await w.auth.getUser();if(!f)throw new Error("Not authenticated");const n=[];for(const p of Array.from(m)){const D=p.name.split(".").pop(),T=`${f.id}/${Date.now()}-${Math.random().toString(36).substring(7)}.${D}`,{error:E}=await w.storage.from("community-posts").upload(T,p);if(E)throw E;const{data:{publicUrl:q}}=w.storage.from("community-posts").getPublicUrl(T);n.push(q)}c(p=>[...p,...n])}catch(f){console.error("Upload error:",f),h.error(s("common.uploadError","上传失败"))}finally{v(!1),W.current&&(W.current.value="")}}},xe=i=>new Promise((m,f)=>{const n=document.createElement("video"),p=document.createElement("canvas"),D=p.getContext("2d");n.preload="auto",n.muted=!0,n.playsInline=!0;let T=!1;const E=()=>{T||n.videoWidth===0||n.videoHeight===0||(p.width=n.videoWidth,p.height=n.videoHeight,D&&(D.drawImage(n,0,0,p.width,p.height),p.toBlob(q=>{q&&q.size>0?(T=!0,n.pause(),URL.revokeObjectURL(n.src),m(q)):f(new Error("Failed to create blob"))},"image/jpeg",.85)))};n.onloadedmetadata=()=>{p.width=n.videoWidth,p.height=n.videoHeight,n.currentTime=.1},n.onseeked=()=>{setTimeout(E,100)},n.onerror=()=>{URL.revokeObjectURL(n.src),f(new Error("Failed to load video"))},setTimeout(()=>{T||(URL.revokeObjectURL(n.src),f(new Error("Timeout")))},1e4),n.src=URL.createObjectURL(i),n.load()}),fe=async i=>{const m=i.target.files?.[0];if(m){if(m.size>100*1024*1024){h.error(s("community.videoTooLarge","视频不能超过100MB"));return}v(!0);try{const{data:{user:f}}=await w.auth.getUser();if(!f)throw new Error("Not authenticated");const n=m.name.split(".").pop(),p=`${f.id}/${Date.now()}.${n}`,{error:D}=await w.storage.from("community-posts").upload(p,m);if(D)throw D;const{data:{publicUrl:T}}=w.storage.from("community-posts").getPublicUrl(p);B(T);try{h.info(s("community.extractingCover","正在提取视频封面..."));const E=await xe(m),q=`${f.id}/${Date.now()}-cover.jpg`,{error:Ne}=await w.storage.from("community-posts").upload(q,E);if(!Ne){const{data:{publicUrl:we}}=w.storage.from("community-posts").getPublicUrl(q);c(ke=>[we,...ke]),h.success(s("community.coverExtracted","封面已自动生成"))}}catch(E){console.warn("Cover extraction failed:",E)}}catch(f){console.error("Upload error:",f),h.error(s("common.uploadError","上传失败"))}finally{v(!1),V.current&&(V.current.value="")}}},ge=i=>{c(m=>m.filter((f,n)=>n!==i))},ye=()=>{B(null),c(i=>i.length>0&&i[0].includes("-cover.jpg")?i.slice(1):i)},be=async()=>{if(z(!1),!P.trim()){h.error(s("community.contentRequired","请输入内容"));return}if(K&&_.length===0){z(!0),h.error(s("community.restaurantRequired","请选择餐厅"));return}await d.mutateAsync({content:P,image_urls:S,video_url:N||void 0,activity_id:G||void 0,restaurant_ids:_.length>0?_:void 0}),se(),g(!1)},ve=()=>j?t(j,"name"):s("community.noRestaurant","未关联餐厅"),je=()=>{se(),g(!1)};return e.jsxs(ze,{open:R,onOpenChange:ue,children:[e.jsx(Ke,{asChild:!0,children:r||e.jsx(F,{children:s("community.createPost","发布帖子")})}),e.jsxs(Ge,{side:"bottom",className:"h-full flex flex-col p-0 rounded-none border-0 [&>button]:hidden",children:[e.jsx(_e,{children:e.jsx(He,{children:s("community.createPost","发布帖子")})}),M==="selecting"&&e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsx("span",{className:"font-medium",children:s("community.create","发布")}),e.jsx("div",{className:"w-6"})]}),e.jsx(fs,{onSelect:C})]}),M==="recipe"&&e.jsx(ys,{onClose:()=>C("selecting"),onSuccess:je}),M==="post"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-background shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>J?C("selecting"):g(!1),className:"p-1 -ml-1 hover:bg-muted rounded-md transition-colors",children:e.jsx(X,{className:"h-5 w-5"})}),e.jsxs(F,{size:"sm",onClick:be,disabled:d.isPending||!P.trim(),className:"rounded-full px-6",children:[d.isPending&&e.jsx(re,{className:"h-4 w-4 mr-2 animate-spin"}),s("community.publish","发布")]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[!L&&!$&&e.jsxs("div",{className:"flex items-center justify-between gap-2 px-3 py-2 bg-primary/10 dark:bg-primary/20 border border-primary/30 dark:border-primary/40 rounded-md text-sm text-primary dark:text-primary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 shrink-0"}),e.jsx("span",{children:s("community.dailyPointsHint","每日发布首个帖子可获得5积分！")})]}),e.jsx(xs,{})]}),e.jsx(We,{value:P,onChange:i=>b(i.target.value),placeholder:s("community.contentPlaceholder","分享你的想法..."),className:"min-h-[150px] border-none shadow-none resize-none focus-visible:ring-0 p-0 text-base whitespace-pre-wrap"}),S.length>0&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:S.map((i,m)=>e.jsxs("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-muted",children:[e.jsx("img",{src:i,alt:"",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>ge(m),className:"absolute top-1 right-1 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ne,{className:"h-3 w-3"})})]},m))}),N&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx("video",{src:N,controls:!0,className:"w-full max-h-48",preload:"metadata"}),e.jsx("button",{type:"button",onClick:ye,className:"absolute top-2 right-2 p-1 bg-black/50 rounded-full text-white hover:bg-black/70",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"px-4 py-2 pb-0 bg-background shrink-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:`flex items-center gap-3 ${ee&&K&&_.length===0?"text-destructive":""}`,children:[e.jsx(Ie,{className:`h-5 w-5 shrink-0 ${ee&&K&&_.length===0?"text-destructive":"text-muted-foreground"}`}),x?e.jsx("span",{className:"text-sm text-muted-foreground",children:ve()}):e.jsx(ss,{open:Y,onOpenChange:i=>{I(i),i&&z(!1)},value:_,onSelect:i=>{Q(i),z(!1)},restaurants:l||[],required:K})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsx(ts,{open:Z,onOpenChange:ie,value:G,onSelect:H,activities:pe})]})]}),ee&&K&&_.length===0&&e.jsx("p",{className:"text-xs text-destructive pl-8",children:s("community.restaurantRequired","请选择餐厅")})]}),e.jsxs("div",{className:"flex items-center gap-6 px-4 pt-0 py-2 pb-[max(2rem,calc(env(safe-area-inset-bottom)+1rem))] bg-background shrink-0",children:[e.jsx("input",{ref:W,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:he}),e.jsx("input",{ref:V,type:"file",accept:"video/*",className:"hidden",onChange:fe}),e.jsxs("button",{type:"button",onClick:()=>W.current?.click(),disabled:y||S.length>=9,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(Te,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:s("community.photo","照片")})]}),e.jsxs("button",{type:"button",onClick:()=>V.current?.click(),disabled:y||!!N,className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50 transition-colors",children:[e.jsx(Ee,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:s("community.video","视频")})]}),e.jsx(rs,{onSelect:i=>b(m=>m+i)}),y&&e.jsx(re,{className:"h-5 w-5 animate-spin ml-auto"})]})]})]})]})},vs=()=>e.jsxs("div",{className:"rounded-xl overflow-hidden bg-card border border-border/50",children:[e.jsx(A,{className:"aspect-[4/5] w-full"}),e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"h-4 w-full"}),e.jsx(A,{className:"h-4 w-3/4"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 rounded-full"}),e.jsx(A,{className:"h-3 w-16"})]}),e.jsx(A,{className:"h-4 w-10"})]})]})]}),Fs=()=>{const{t:r}=O(),s=me(),t=Ve(),[d,u]=a.useState(()=>localStorage.getItem("community-mobile-layout")==="single"?"single":"double"),[l,U]=a.useState(()=>localStorage.getItem("community-sort")==="popular"?"popular":"latest"),[x,o]=a.useState(()=>{const c=localStorage.getItem("community-post-type");return["all","post","recipe"].includes(c||"")?c:"all"}),{data:k,isLoading:j}=cs({status:"approved",sortBy:l,postType:x}),{data:$}=ls(),{displayedData:L,hasMore:R,sentinelRef:g}=hs({data:k,initialItemsPerPage:12,incrementPerPage:12}),M=a.useCallback(async()=>{s.removeQueries({queryKey:["community-posts"]}),s.removeQueries({queryKey:["can-create-post"]}),s.removeQueries({queryKey:["has-posted-today"]}),await Promise.all([s.invalidateQueries({queryKey:["community-posts"]}),s.invalidateQueries({queryKey:["can-create-post"]}),s.invalidateQueries({queryKey:["has-posted-today"]})])},[s]),C=()=>{const c=d==="double"?"single":"double";u(c),localStorage.setItem("community-mobile-layout",c)},P=c=>{const N=c;U(N),localStorage.setItem("community-sort",N)},b=c=>{o(c),localStorage.setItem("community-post-type",c)},S=()=>t?d==="single"?"columns-1 gap-4":"columns-2 gap-3":"columns-3 lg:columns-4 gap-4";return e.jsx(ps,{onRefresh:M,children:e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4 animate-fade-in",children:e.jsxs("div",{className:"container mx-auto max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl mb-2 text-primary font-medium",children:r("community.title","社区")}),e.jsx("p",{className:"text-muted-foreground text-base sm:text-lg",children:r("community.description","分享美食体验，发现更多精彩")})]}),$&&e.jsx(bs,{trigger:e.jsxs(F,{size:"sm",className:"gap-1.5",children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.createPost","发布")})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>P("latest"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${l==="latest"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.sortLatest","最新")})]}),e.jsxs("button",{onClick:()=>P("popular"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${l==="popular"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(qe,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.sortPopular","热门")})]})]}),e.jsxs("div",{className:"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",children:[e.jsxs("button",{onClick:()=>b("all"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${x==="all"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(Le,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.filterAll","全部")})]}),e.jsxs("button",{onClick:()=>b("post"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${x==="post"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(le,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.filterPost","帖子")})]}),e.jsxs("button",{onClick:()=>b("recipe"),className:`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 gap-1.5 ${x==="recipe"?"bg-background text-foreground shadow-sm":""}`,children:[e.jsx(de,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:r("community.filterRecipe","食谱")})]})]}),t&&e.jsx("button",{onClick:C,className:"ml-auto inline-flex h-9 items-center justify-center whitespace-nowrap rounded-md bg-muted px-2.5 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",title:d==="double"?r("community.singleColumn","单列布局"):r("community.doubleColumn","双列布局"),children:d==="double"?e.jsx(Me,{className:"h-3.5 w-3.5"}):e.jsx(De,{className:"h-3.5 w-3.5"})})]}),j?e.jsx("div",{className:S(),children:Array.from({length:8}).map((c,N)=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(vs,{})},N))}):k&&k.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:S(),children:L.map(c=>e.jsx("div",{className:"break-inside-avoid mb-3 sm:mb-4",children:e.jsx(Je,{post:c,showAssociations:t&&d==="single"})},c.id))}),R&&e.jsx("div",{ref:g,className:"flex justify-center py-6",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-2 border-primary border-t-transparent"})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-muted-foreground/50"})}),e.jsx("p",{className:"text-muted-foreground text-lg",children:r("community.noPosts","暂无帖子")}),$&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground/70",children:r("community.beFirst","成为第一个发帖的人吧！")})]})]})})})};export{Fs as default};
//# sourceMappingURL=Community-CgB0uGP4.js.map
