{"version":3,"file":"JoinUs-DyItjbv0.js","sources":["../../src/pages/JoinUs.tsx"],"sourcesContent":["import { useState, useMemo, useEffect } from \"react\";\r\nimport { useForm } from \"react-hook-form\";\r\nimport { zodResolver } from \"@hookform/resolvers/zod\";\r\nimport * as z from \"zod\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Link, useSearchParams } from \"react-router-dom\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Checkbox } from \"@/components/ui/checkbox\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"@/hooks/use-toast\";\r\nimport { \r\n  CheckCircle2, Loader2, Store, Phone, Mail, Ticket, Check, X, ExternalLink, \r\n  ChevronRight, ChevronLeft, HelpCircle, Ghost, Building2, User, MapPin\r\n} from \"lucide-react\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport { useValidateInvitationCode } from \"@/hooks/useInvitationCodes\";\r\nimport { openExternalUrl } from \"@/lib/externalLinks\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Progress } from \"@/components/ui/progress\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\n\r\nconst featureOptions = [\"booking\", \"delivery\", \"qrcode\"] as const;\r\n\r\ntype RestaurantType = \"standard\" | \"ghost\";\r\n\r\ntype FormValues = {\r\n  restaurant_type: RestaurantType;\r\n  name: string;\r\n  email: string;\r\n  phone: string;\r\n  restaurant_name: string;\r\n  restaurant_address: string;\r\n  features_selected: typeof featureOptions[number][];\r\n  invitation_code: string;\r\n};\r\n\r\nconst STEPS = [\r\n  { id: 1, key: \"type\" },\r\n  { id: 2, key: \"contact\" },\r\n  { id: 3, key: \"restaurant\" },\r\n  { id: 4, key: \"features\" },\r\n] as const;\r\n\r\nconst JoinUs = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const [searchParams] = useSearchParams();\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n  const [isSuccess, setIsSuccess] = useState(false);\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [showGhostInfo, setShowGhostInfo] = useState(false);\r\n  const { settings } = useSiteSettings();\r\n  const validateCodeMutation = useValidateInvitationCode();\r\n  const [codeValidation, setCodeValidation] = useState<{\r\n    isValidating: boolean;\r\n    isValid: boolean | null;\r\n    inviterUserId: string | null;\r\n  }>({ isValidating: false, isValid: null, inviterUserId: null });\r\n\r\n  const formSchema = useMemo(() => z.object({\r\n    restaurant_type: z.enum([\"standard\", \"ghost\"]),\r\n    name: z.string().min(2, { message: t(\"joinUs.nameMin\") }),\r\n    email: z.string().email({ message: t(\"joinUs.emailInvalid\") }),\r\n    phone: z.string().min(6, { message: t(\"joinUs.phoneMin\") }),\r\n    restaurant_name: z.string().min(2, { message: t(\"joinUs.restaurantNameMin\") }),\r\n    restaurant_address: z.string().min(2, { message: t(\"joinUs.addressMin\") }),\r\n    features_selected: z.array(z.enum(featureOptions)).min(1, { message: t(\"joinUs.featuresMin\") }),\r\n    invitation_code: z.string().optional(),\r\n  }), [t]);\r\n\r\n  const form = useForm<FormValues>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      restaurant_type: \"standard\",\r\n      name: \"\",\r\n      email: \"\",\r\n      phone: \"\",\r\n      restaurant_name: \"\",\r\n      restaurant_address: \"\",\r\n      features_selected: [],\r\n      invitation_code: searchParams.get(\"code\") || \"\",\r\n    },\r\n  });\r\n\r\n  const restaurantType = form.watch(\"restaurant_type\");\r\n  const featuresSelected = form.watch(\"features_selected\");\r\n  const isQrcodeSelected = featuresSelected?.includes(\"qrcode\");\r\n  const isGhostRestaurant = restaurantType === \"ghost\";\r\n\r\n  // Calculate total steps based on restaurant type\r\n  // Ghost restaurants skip the features step (step 4)\r\n  const totalSteps = isGhostRestaurant ? 3 : 4;\r\n\r\n  // Validate invitation code from URL on mount\r\n  useEffect(() => {\r\n    const codeFromUrl = searchParams.get(\"code\");\r\n    if (codeFromUrl && isQrcodeSelected && !isGhostRestaurant) {\r\n      handleValidateCode(codeFromUrl);\r\n    }\r\n  }, [searchParams, isQrcodeSelected, isGhostRestaurant]);\r\n\r\n  // Clear invitation code when qrcode is deselected or ghost restaurant selected\r\n  useEffect(() => {\r\n    if (!isQrcodeSelected || isGhostRestaurant) {\r\n      form.setValue(\"invitation_code\", \"\");\r\n      setCodeValidation({ isValidating: false, isValid: null, inviterUserId: null });\r\n    }\r\n  }, [isQrcodeSelected, isGhostRestaurant, form]);\r\n\r\n  // Auto-set features for ghost restaurant\r\n  useEffect(() => {\r\n    if (isGhostRestaurant) {\r\n      form.setValue(\"features_selected\", [\"delivery\"]);\r\n    }\r\n  }, [isGhostRestaurant, form]);\r\n\r\n  const handleValidateCode = async (code: string) => {\r\n    if (!code || code.length < 6) {\r\n      setCodeValidation({ isValidating: false, isValid: null, inviterUserId: null });\r\n      return;\r\n    }\r\n\r\n    setCodeValidation({ isValidating: true, isValid: null, inviterUserId: null });\r\n    \r\n    try {\r\n      const result = await validateCodeMutation.mutateAsync(code);\r\n      if (result) {\r\n        setCodeValidation({ \r\n          isValidating: false, \r\n          isValid: true, \r\n          inviterUserId: result.user_id \r\n        });\r\n      } else {\r\n        setCodeValidation({ isValidating: false, isValid: false, inviterUserId: null });\r\n      }\r\n    } catch {\r\n      setCodeValidation({ isValidating: false, isValid: false, inviterUserId: null });\r\n    }\r\n  };\r\n\r\n  const validateCurrentStep = async (): Promise<boolean> => {\r\n    let fieldsToValidate: (keyof FormValues)[] = [];\r\n    \r\n    switch (currentStep) {\r\n      case 1:\r\n        fieldsToValidate = [\"restaurant_type\"];\r\n        break;\r\n      case 2:\r\n        fieldsToValidate = [\"name\", \"email\", \"phone\"];\r\n        break;\r\n      case 3:\r\n        fieldsToValidate = [\"restaurant_name\", \"restaurant_address\"];\r\n        break;\r\n      case 4:\r\n        if (!isGhostRestaurant) {\r\n          fieldsToValidate = [\"features_selected\"];\r\n        }\r\n        break;\r\n    }\r\n    \r\n    const result = await form.trigger(fieldsToValidate);\r\n    return result;\r\n  };\r\n\r\n  const handleNext = async (e: React.MouseEvent<HTMLButtonElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const isValid = await validateCurrentStep();\r\n    if (isValid) {\r\n      if (currentStep < totalSteps) {\r\n        setCurrentStep(prev => prev + 1);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handlePrev = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (currentStep > 1) {\r\n      setCurrentStep(prev => prev - 1);\r\n    }\r\n  };\r\n\r\n  const onSubmit = async (data: FormValues) => {\r\n    setIsSubmitting(true);\r\n    try {\r\n      const currentLanguage = i18n.language || 'en';\r\n      \r\n      // For ghost restaurants, always use delivery only\r\n      const finalFeatures = isGhostRestaurant ? [\"delivery\"] : data.features_selected;\r\n      \r\n      const { error } = await supabase.functions.invoke(\"send-join-request-email\", {\r\n        body: { \r\n          ...data, \r\n          features_selected: finalFeatures,\r\n          language: currentLanguage,\r\n          invitation_code: (!isGhostRestaurant && codeValidation.isValid) ? data.invitation_code : null,\r\n          invited_by_user_id: (!isGhostRestaurant && codeValidation.inviterUserId) ? codeValidation.inviterUserId : null,\r\n          restaurant_type: data.restaurant_type,\r\n        },\r\n      });\r\n\r\n      if (error) {\r\n        if (error.message.includes(\"rate_limit_exceeded\")) {\r\n          toast({\r\n            title: t(\"joinUs.rateLimitError\"),\r\n            description: t(\"joinUs.rateLimitErrorDesc\"),\r\n            variant: \"destructive\",\r\n          });\r\n        } else {\r\n          throw error;\r\n        }\r\n        return;\r\n      }\r\n\r\n      setIsSuccess(true);\r\n      form.reset();\r\n      setCurrentStep(1);\r\n      toast({\r\n        title: t(\"joinUs.successTitle\"),\r\n        description: t(\"joinUs.successDescription\"),\r\n      });\r\n    } catch (error: any) {\r\n      console.error(\"Error submitting join request:\", error);\r\n      toast({\r\n        title: t(\"common.error\"),\r\n        description: t(\"joinUs.submitError\"),\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  // Get localized success content from settings\r\n  const getSuccessTitle = () => {\r\n    const lang = i18n.language;\r\n    if (lang === 'zh' && settings?.join_success_title_zh) return settings.join_success_title_zh;\r\n    if (lang === 'pt' && settings?.join_success_title_pt) return settings.join_success_title_pt;\r\n    if (settings?.join_success_title_en) return settings.join_success_title_en;\r\n    return t(\"joinUs.successTitle\");\r\n  };\r\n\r\n  const getSuccessMessage = () => {\r\n    const lang = i18n.language;\r\n    if (lang === 'zh' && settings?.join_success_message_zh) return settings.join_success_message_zh;\r\n    if (lang === 'pt' && settings?.join_success_message_pt) return settings.join_success_message_pt;\r\n    if (settings?.join_success_message_en) return settings.join_success_message_en;\r\n    return t(\"joinUs.successMessage\");\r\n  };\r\n\r\n  const contactPhone = settings?.join_contact_phone || '968815050';\r\n  const contactEmail = settings?.contact_email;\r\n\r\n  const progressPercent = (currentStep / totalSteps) * 100;\r\n\r\n  if (isSuccess) {\r\n    return (\r\n      <div className=\"min-h-screen pt-20 pb-12 px-4 bg-secondary/20\">\r\n        <div className=\"container mx-auto max-w-2xl\">\r\n          <Card className=\"border-primary\">\r\n            <CardContent className=\"pt-12 pb-12 text-center\">\r\n              <CheckCircle2 className=\"w-16 h-16 text-primary mx-auto mb-4\" />\r\n              <h2 className=\"text-2xl font-bold text-foreground mb-4\">\r\n                {getSuccessTitle()}\r\n              </h2>\r\n              <p className=\"text-muted-foreground mb-4 max-w-md mx-auto\">\r\n                {getSuccessMessage()}\r\n              </p>\r\n              <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4 mb-6\">\r\n                <a href={`tel:${contactPhone}`} className=\"flex items-center gap-2 text-primary font-semibold hover:underline\">\r\n                  <Phone className=\"w-5 h-5\" />\r\n                  <span>{contactPhone}</span>\r\n                </a>\r\n                {contactEmail && (\r\n                  <a href={`mailto:${contactEmail}`} className=\"flex items-center gap-2 text-primary font-semibold hover:underline\">\r\n                    <Mail className=\"w-5 h-5\" />\r\n                    <span>{contactEmail}</span>\r\n                  </a>\r\n                )}\r\n              </div>\r\n              <Button onClick={() => setIsSuccess(false)}>\r\n                {t(\"joinUs.submitAnother\")}\r\n              </Button>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen pt-4 pb-12 px-4 bg-secondary/20\">\r\n      <div className=\"container mx-auto max-w-2xl\">\r\n        <Card>\r\n          <CardHeader className=\"text-center space-y-2\">\r\n            <div className=\"flex justify-center mb-4\">\r\n              <Store className=\"w-12 h-12 text-primary\" />\r\n            </div>\r\n            <CardTitle className=\"text-3xl font-bold\">{t(\"joinUs.title\")}</CardTitle>\r\n            <CardDescription className=\"text-base\">\r\n              {t(\"joinUs.description\")}\r\n            </CardDescription>\r\n          </CardHeader>\r\n\r\n          {/* Progress Bar */}\r\n          <div className=\"px-6 pb-4\">\r\n            <div className=\"flex items-center justify-between mb-2\">\r\n              <span className=\"text-sm text-muted-foreground\">\r\n                {t(\"joinUs.step\", { current: currentStep, total: totalSteps })}\r\n              </span>\r\n              <span className=\"text-sm font-medium\">\r\n                {Math.round(progressPercent)}%\r\n              </span>\r\n            </div>\r\n            <Progress value={progressPercent} className=\"h-2\" />\r\n            \r\n            {/* Step Indicators */}\r\n            <div className=\"flex justify-between mt-4\">\r\n              {Array.from({ length: totalSteps }, (_, i) => i + 1).map((step) => (\r\n                <div\r\n                  key={step}\r\n                  className={cn(\r\n                    \"flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium transition-colors\",\r\n                    step < currentStep\r\n                      ? \"bg-primary text-primary-foreground\"\r\n                      : step === currentStep\r\n                      ? \"bg-primary text-primary-foreground ring-2 ring-primary ring-offset-2\"\r\n                      : \"bg-muted text-muted-foreground\"\r\n                  )}\r\n                >\r\n                  {step < currentStep ? (\r\n                    <Check className=\"w-4 h-4\" />\r\n                  ) : (\r\n                    step\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n\r\n          <CardContent>\r\n            <Form {...form}>\r\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\r\n                \r\n                {/* Step 1: Restaurant Type */}\r\n                {currentStep === 1 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"text-center mb-6\">\r\n                      <h3 className=\"text-lg font-semibold\">{t(\"joinUs.selectRestaurantType\")}</h3>\r\n                      <p className=\"text-sm text-muted-foreground\">{t(\"joinUs.selectRestaurantTypeDesc\")}</p>\r\n                    </div>\r\n                    \r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"restaurant_type\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormControl>\r\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\r\n                              {/* Standard Restaurant */}\r\n                              <div\r\n                                onClick={() => field.onChange(\"standard\")}\r\n                                className={cn(\r\n                                  \"relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50\",\r\n                                  field.value === \"standard\"\r\n                                    ? \"border-primary bg-primary/5\"\r\n                                    : \"border-muted\"\r\n                                )}\r\n                              >\r\n                                <div className=\"flex flex-col items-center text-center space-y-3\">\r\n                                  <div className={cn(\r\n                                    \"p-3 rounded-full\",\r\n                                    field.value === \"standard\" ? \"bg-primary/10\" : \"bg-muted\"\r\n                                  )}>\r\n                                    <Building2 className={cn(\r\n                                      \"w-8 h-8\",\r\n                                      field.value === \"standard\" ? \"text-primary\" : \"text-muted-foreground\"\r\n                                    )} />\r\n                                  </div>\r\n                                  <div>\r\n                                    <h4 className=\"font-semibold\">{t(\"joinUs.standardRestaurant\")}</h4>\r\n                                    <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                      {t(\"joinUs.standardRestaurantDesc\")}\r\n                                    </p>\r\n                                  </div>\r\n                                </div>\r\n                                {field.value === \"standard\" && (\r\n                                  <div className=\"absolute top-3 right-3\">\r\n                                    <Check className=\"w-5 h-5 text-primary\" />\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n\r\n                              {/* Ghost Restaurant */}\r\n                              <div\r\n                                onClick={() => field.onChange(\"ghost\")}\r\n                                className={cn(\r\n                                  \"relative cursor-pointer rounded-xl border-2 p-6 transition-all hover:border-primary/50\",\r\n                                  field.value === \"ghost\"\r\n                                    ? \"border-primary bg-primary/5\"\r\n                                    : \"border-muted\"\r\n                                )}\r\n                              >\r\n                                <div className=\"flex flex-col items-center text-center space-y-3\">\r\n                                  <div className={cn(\r\n                                    \"p-3 rounded-full\",\r\n                                    field.value === \"ghost\" ? \"bg-primary/10\" : \"bg-muted\"\r\n                                  )}>\r\n                                    <Ghost className={cn(\r\n                                      \"w-8 h-8\",\r\n                                      field.value === \"ghost\" ? \"text-primary\" : \"text-muted-foreground\"\r\n                                    )} />\r\n                                  </div>\r\n                                  <div>\r\n                                    <h4 className=\"font-semibold\">{t(\"joinUs.ghostRestaurant\")}</h4>\r\n                                    <p className=\"text-sm text-muted-foreground mt-1\">\r\n                                      {t(\"joinUs.ghostRestaurantDesc\")}\r\n                                    </p>\r\n                                  </div>\r\n                                </div>\r\n                                {field.value === \"ghost\" && (\r\n                                  <div className=\"absolute top-3 right-3\">\r\n                                    <Check className=\"w-5 h-5 text-primary\" />\r\n                                  </div>\r\n                                )}\r\n                                {/* Help Button */}\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    setShowGhostInfo(true);\r\n                                  }}\r\n                                  className=\"absolute top-3 left-3 p-1 rounded-full hover:bg-muted transition-colors\"\r\n                                >\r\n                                  <HelpCircle className=\"w-4 h-4 text-muted-foreground\" />\r\n                                </button>\r\n                              </div>\r\n                            </div>\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n                  </div>\r\n                )}\r\n\r\n                {/* Step 2: Contact Info */}\r\n                {currentStep === 2 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"text-center mb-6\">\r\n                      <div className=\"flex justify-center mb-3\">\r\n                        <User className=\"w-8 h-8 text-primary\" />\r\n                      </div>\r\n                      <h3 className=\"text-lg font-semibold\">{t(\"joinUs.contactInfo\")}</h3>\r\n                      <p className=\"text-sm text-muted-foreground\">{t(\"joinUs.contactInfoDesc\")}</p>\r\n                    </div>\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"name\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel>{t(\"joinUs.name\")}</FormLabel>\r\n                          <FormControl>\r\n                            <Input placeholder={t(\"joinUs.namePlaceholder\")} {...field} />\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"email\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel>{t(\"joinUs.email\")}</FormLabel>\r\n                          <FormControl>\r\n                            <Input type=\"email\" placeholder={t(\"joinUs.emailPlaceholder\")} {...field} />\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"phone\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel>{t(\"joinUs.phone\")}</FormLabel>\r\n                          <FormControl>\r\n                            <Input type=\"tel\" placeholder={t(\"joinUs.phonePlaceholder\")} {...field} />\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n                  </div>\r\n                )}\r\n\r\n                {/* Step 3: Restaurant Info */}\r\n                {currentStep === 3 && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"text-center mb-6\">\r\n                      <div className=\"flex justify-center mb-3\">\r\n                        <MapPin className=\"w-8 h-8 text-primary\" />\r\n                      </div>\r\n                      <h3 className=\"text-lg font-semibold\">{t(\"joinUs.restaurantInfo\")}</h3>\r\n                      <p className=\"text-sm text-muted-foreground\">{t(\"joinUs.restaurantInfoDesc\")}</p>\r\n                    </div>\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"restaurant_name\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel>{t(\"joinUs.restaurantName\")}</FormLabel>\r\n                          <FormControl>\r\n                            <Input placeholder={t(\"joinUs.restaurantNamePlaceholder\")} {...field} />\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"restaurant_address\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel>{t(\"joinUs.restaurantAddress\")}</FormLabel>\r\n                          <FormControl>\r\n                            <Input placeholder={t(\"joinUs.restaurantAddressPlaceholder\")} {...field} />\r\n                          </FormControl>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n                  </div>\r\n                )}\r\n\r\n                {/* Step 4: Features (only for standard restaurants) */}\r\n                {currentStep === 4 && !isGhostRestaurant && (\r\n                  <div className=\"space-y-6\">\r\n                    <div className=\"text-center mb-6\">\r\n                      <div className=\"flex justify-center mb-3\">\r\n                        <Ticket className=\"w-8 h-8 text-primary\" />\r\n                      </div>\r\n                      <h3 className=\"text-lg font-semibold\">{t(\"joinUs.featuresNeeded\")}</h3>\r\n                      <p className=\"text-sm text-muted-foreground\">{t(\"joinUs.featuresDescription\")}</p>\r\n                    </div>\r\n\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"features_selected\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <div className=\"space-y-3\">\r\n                            {featureOptions.map((feature) => {\r\n                              const isChecked = field.value?.includes(feature);\r\n                              \r\n                              return (\r\n                                <div\r\n                                  key={feature}\r\n                                  className=\"flex flex-row items-center space-x-3 space-y-0 rounded-lg border p-4 cursor-pointer hover:bg-muted/50 transition-colors\"\r\n                                  onClick={() => {\r\n                                    if (isChecked) {\r\n                                      field.onChange(field.value?.filter((value: string) => value !== feature));\r\n                                    } else {\r\n                                      field.onChange([...(field.value || []), feature]);\r\n                                    }\r\n                                  }}\r\n                                >\r\n                                  <div className={cn(\r\n                                    \"h-4 w-4 shrink-0 rounded-sm border flex items-center justify-center transition-colors\",\r\n                                    isChecked \r\n                                      ? \"bg-primary border-primary text-primary-foreground\" \r\n                                      : \"border-primary\"\r\n                                  )}>\r\n                                    {isChecked && <Check className=\"h-3 w-3\" />}\r\n                                  </div>\r\n                                  <span className=\"font-normal cursor-pointer flex-1 text-sm\">\r\n                                    {t(`joinUs.feature.${feature}`)}\r\n                                  </span>\r\n                                </div>\r\n                              );\r\n                            })}\r\n                          </div>\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n\r\n                    {/* Invitation Code Field - only show for standard restaurants with qrcode */}\r\n                    <FormField\r\n                      control={form.control}\r\n                      name=\"invitation_code\"\r\n                      render={({ field }) => (\r\n                        <FormItem>\r\n                          <FormLabel className=\"flex items-center gap-2\">\r\n                            <Ticket className=\"w-4 h-4\" />\r\n                            {t(\"joinUs.invitationCode\")}\r\n                            <span className=\"text-muted-foreground font-normal text-xs\">\r\n                              ({t(\"joinUs.optional\")})\r\n                            </span>\r\n                          </FormLabel>\r\n                          <FormControl>\r\n                            <div className=\"relative\">\r\n                              <Input \r\n                                placeholder={t(\"joinUs.invitationCodePlaceholder\", \"如有邀请码请输入\")} \r\n                                {...field}\r\n                                disabled={!isQrcodeSelected}\r\n                                onChange={(e) => {\r\n                                  field.onChange(e);\r\n                                  if (isQrcodeSelected) {\r\n                                    handleValidateCode(e.target.value);\r\n                                  }\r\n                                }}\r\n                                onFocus={() => {\r\n                                  if (!isQrcodeSelected) {\r\n                                    toast({\r\n                                      title: t(\"joinUs.qrcodeRequired\", \"请先勾选扫码点餐\"),\r\n                                      description: t(\"joinUs.qrcodeRequiredDesc\", \"只有选择扫码点餐功能后才能使用邀请码\"),\r\n                                    });\r\n                                  }\r\n                                }}\r\n                                className={cn(\"pr-10\", !isQrcodeSelected && \"cursor-not-allowed opacity-50\")}\r\n                              />\r\n                              {isQrcodeSelected && codeValidation.isValidating && (\r\n                                <Loader2 className=\"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 animate-spin text-muted-foreground\" />\r\n                              )}\r\n                              {isQrcodeSelected && !codeValidation.isValidating && codeValidation.isValid === true && (\r\n                                <Check className=\"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-green-500\" />\r\n                              )}\r\n                              {isQrcodeSelected && !codeValidation.isValidating && codeValidation.isValid === false && field.value && (\r\n                                <X className=\"w-4 h-4 absolute right-3 top-1/2 -translate-y-1/2 text-red-500\" />\r\n                              )}\r\n                            </div>\r\n                          </FormControl>\r\n                          {!isQrcodeSelected && (\r\n                            <p className=\"text-xs text-muted-foreground\">{t(\"joinUs.qrcodeRequiredHint\", \"需要勾选扫码点餐功能后才能填写邀请码\")}</p>\r\n                          )}\r\n                          {isQrcodeSelected && codeValidation.isValid === true && (\r\n                            <p className=\"text-xs text-green-600\">{t(\"joinUs.invitationCodeValid\", \"邀请码有效\")}</p>\r\n                          )}\r\n                          {isQrcodeSelected && codeValidation.isValid === false && field.value && (\r\n                            <p className=\"text-xs text-red-600\">{t(\"joinUs.invitationCodeInvalid\", \"邀请码无效\")}</p>\r\n                          )}\r\n                          <FormMessage />\r\n                        </FormItem>\r\n                      )}\r\n                    />\r\n                  </div>\r\n                )}\r\n\r\n                {/* Terms consent (show on last step) */}\r\n                {currentStep === totalSteps && (\r\n                  <div className=\"text-xs text-muted-foreground text-center pb-4\">\r\n                    {t(\"joinUs.consentText\")}{\" \"}\r\n                    <Link to=\"/privacy-policy\" className=\"text-primary hover:underline\">\r\n                      {t(\"joinUs.privacyPolicy\")}\r\n                    </Link>{\" \"}\r\n                    {t(\"joinUs.and\")}{\" \"}\r\n                    <Link to=\"/terms-of-service\" className=\"text-primary hover:underline\">\r\n                      {t(\"joinUs.termsOfService\")}\r\n                    </Link>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Navigation Buttons */}\r\n                <div className=\"flex justify-between gap-4 pt-4\">\r\n                  {currentStep > 1 ? (\r\n                    <Button\r\n                      type=\"button\"\r\n                      variant=\"outline\"\r\n                      onClick={handlePrev}\r\n                      className=\"flex-1\"\r\n                    >\r\n                      <ChevronLeft className=\"w-4 h-4 mr-2\" />\r\n                      {t(\"joinUs.prev\")}\r\n                    </Button>\r\n                  ) : (\r\n                    <div className=\"flex-1\" />\r\n                  )}\r\n                  \r\n                  {currentStep < totalSteps ? (\r\n                    <Button\r\n                      type=\"button\"\r\n                      onClick={handleNext}\r\n                      className=\"flex-1\"\r\n                    >\r\n                      {t(\"joinUs.next\")}\r\n                      <ChevronRight className=\"w-4 h-4 ml-2\" />\r\n                    </Button>\r\n                  ) : (\r\n                    <Button \r\n                      type=\"submit\" \r\n                      className=\"flex-1\" \r\n                      disabled={isSubmitting}\r\n                    >\r\n                      {isSubmitting && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\r\n                      {t(\"joinUs.submit\")}\r\n                    </Button>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Official website link */}\r\n                <div className=\"text-center pt-4\">\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => openExternalUrl(\"https://xiaoxiong.pt/en/pages/subscription\")}\r\n                    className=\"inline-flex items-center gap-1 text-sm text-primary hover:underline\"\r\n                  >\r\n                    {t(\"joinUs.visitOurWebsite\", \"访问我们的官网查看详细信息\")}\r\n                    <ExternalLink className=\"w-3 h-3\" />\r\n                  </button>\r\n                </div>\r\n              </form>\r\n            </Form>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Ghost Restaurant Info Dialog */}\r\n      <Dialog open={showGhostInfo} onOpenChange={setShowGhostInfo}>\r\n        <DialogContent className=\"sm:max-w-lg\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Ghost className=\"w-5 h-5 text-primary\" />\r\n              {t(\"joinUs.ghostRestaurantInfoTitle\")}\r\n            </DialogTitle>\r\n            <DialogDescription asChild>\r\n              <div className=\"space-y-4 pt-4\">\r\n                {/* Introduction paragraphs */}\r\n                <div className=\"space-y-3 text-sm\">\r\n                  <p>{t(\"joinUs.ghostRestaurantInfo1\")}</p>\r\n                  <p>{t(\"joinUs.ghostRestaurantInfo2\")}</p>\r\n                  <p>{t(\"joinUs.ghostRestaurantInfo3\")}</p>\r\n                </div>\r\n                \r\n                {/* Key Features */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"font-medium text-foreground\">{t(\"joinUs.ghostRestaurantFeatures\")}</h4>\r\n                  <ul className=\"space-y-2 text-sm\">\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <Check className=\"w-4 h-4 text-primary flex-shrink-0 mt-0.5\" />\r\n                      <span>{t(\"joinUs.ghostRestaurantFeature1\")}</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <Check className=\"w-4 h-4 text-primary flex-shrink-0 mt-0.5\" />\r\n                      <span>{t(\"joinUs.ghostRestaurantFeature2\")}</span>\r\n                    </li>\r\n                    <li className=\"flex items-start gap-2\">\r\n                      <Check className=\"w-4 h-4 text-primary flex-shrink-0 mt-0.5\" />\r\n                      <span>{t(\"joinUs.ghostRestaurantFeature3\")}</span>\r\n                    </li>\r\n                  </ul>\r\n                </div>\r\n                \r\n                {/* Summary */}\r\n                <div className=\"bg-primary/10 rounded-lg p-3 border border-primary/20\">\r\n                  <p className=\"text-sm font-medium text-primary\">\r\n                    {t(\"joinUs.ghostRestaurantSummary\")}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"flex justify-end pt-4\">\r\n            <Button onClick={() => setShowGhostInfo(false)}>\r\n              {t(\"common.gotIt\")}\r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default JoinUs;\r\n"],"names":["featureOptions","JoinUs","t","i18n","useTranslation","searchParams","useSearchParams","isSubmitting","setIsSubmitting","useState","isSuccess","setIsSuccess","currentStep","setCurrentStep","showGhostInfo","setShowGhostInfo","settings","useSiteSettings","validateCodeMutation","useValidateInvitationCode","codeValidation","setCodeValidation","formSchema","useMemo","z.object","z.enum","z.string","z.array","form","useForm","zodResolver","restaurantType","isQrcodeSelected","isGhostRestaurant","totalSteps","useEffect","codeFromUrl","handleValidateCode","code","result","validateCurrentStep","fieldsToValidate","handleNext","e","prev","handlePrev","onSubmit","data","currentLanguage","finalFeatures","error","supabase","toast","getSuccessTitle","lang","getSuccessMessage","contactPhone","contactEmail","progressPercent","jsx","Card","jsxs","CardContent","CheckCircle2","Phone","Mail","Button","CardHeader","Store","CardTitle","CardDescription","Progress","_","i","step","cn","Check","Form","FormField","field","FormItem","FormControl","Building2","Ghost","HelpCircle","FormMessage","User","FormLabel","Input","MapPin","Ticket","feature","isChecked","value","Loader2","X","Link","ChevronLeft","ChevronRight","openExternalUrl","ExternalLink","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription"],"mappings":"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"}