import{r as n,p as B,u as G,j as e,bd as H,cY as U,ak as V,cy as b,bk as q,ct as K,bc as Q,bC as Y,b3 as J,a_ as W,b9 as X}from"./vendor-react-BDRnRVHv.js";import{u as Z,K as ee,L as se,M as ae,N as D,B as i,P as te,Q as re,R as le,A as ie,q as ne,r as ce,t as oe,v as de,w as me,x as ue,y as xe}from"./index-4ynzYXNo.js";import{a as he,b as ge}from"./useCommunityPosts-B7JV6vWq.js";import{u as fe}from"./useLocalizedContent-DlPVPXMF.js";import{E as pe,a as je}from"./EditRecipeDialog-JLc5c3aO.js";const ve=({post:s,showAssociations:_=!1})=>{const{t}=B(),{user:m}=Z(),u=G(),{getLocalizedField:x}=fe(),A=he(),P=ge(),[E,$]=n.useState(!1),[I,h]=n.useState(!1),[y,g]=n.useState(!1),r=s,l=r.post_type==="recipe",N=m?.id===s.author_id,L=a=>{a.preventDefault(),a.stopPropagation(),m&&A.mutate({postId:s.id,liked:s.user_liked||!1})},M=()=>u(`/community/${s.id}`),R=(a,v)=>{a.preventDefault(),a.stopPropagation(),u(`/restaurant/${v}`)},S=a=>{a.preventDefault(),a.stopPropagation(),s.activity?.id&&u(`/activity/${s.activity.id}`)},T=()=>{P.mutate(s.id),h(!1)},z=a=>a.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">"),w=x(s,"content"),c=n.useMemo(()=>z(w),[w]),k=s.image_urls&&s.image_urls.length>0,o=!!s.video_url,f=k||o,C=s.image_urls?.length||0,d=[...s.restaurants||[],...s.restaurant&&!s.restaurants?.find(a=>a.id===s.restaurant?.id)?[s.restaurant]:[]],p=s.activity?x(s.activity,"title"):null,j=2,F=a=>{switch(a){case"easy":return"bg-green-500/20 text-green-700 dark:text-green-400";case"medium":return"bg-yellow-500/20 text-yellow-700 dark:text-yellow-400";case"hard":return"bg-red-500/20 text-red-700 dark:text-red-400";default:return"bg-muted text-muted-foreground"}},O=a=>{switch(a){case"easy":return t("recipe.difficulty.easy","简单");case"medium":return t("recipe.difficulty.medium","中等");case"hard":return t("recipe.difficulty.hard","困难");default:return a}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"group cursor-pointer rounded-lg overflow-hidden bg-card border border-border/50 hover:shadow-lg transition-all duration-300 hover:-translate-y-1 relative",onClick:M,children:[N&&e.jsx("div",{className:"absolute top-2 right-2 z-20",onClick:a=>a.stopPropagation(),children:e.jsxs(ee,{children:[e.jsx(se,{asChild:!0,children:e.jsx("button",{className:"h-7 w-7 rounded-full bg-black/40 backdrop-blur-sm flex items-center justify-center hover:bg-black/60 transition-colors",children:e.jsx(H,{className:"h-4 w-4 text-white"})})}),e.jsxs(ae,{align:"end",className:"min-w-[120px]",children:[e.jsxs(D,{onClick:()=>g(!0),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),t("common.edit","编辑")]}),e.jsxs(D,{className:"text-destructive focus:text-destructive",onClick:()=>h(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),t("common.delete","删除")]})]})]})}),f&&e.jsxs("div",{className:`relative ${l?"aspect-[4/3]":"aspect-[4/5]"} overflow-hidden`,children:[k?E?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:s.image_urls[0],alt:"",loading:"lazy",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",onError:()=>$(!0)}):o?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover",preload:"metadata",muted:!0,playsInline:!0}):null,l&&e.jsxs(i,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),t("recipe.badge","食谱")]}),o&&!l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5 text-white fill-white ml-0.5"})})}),!o&&C>1&&!l&&e.jsxs("div",{className:`absolute top-2 ${N?"right-11":"right-2"} bg-black/60 text-white text-xs px-2 py-0.5 rounded-full z-10 flex items-center gap-1`,children:[e.jsx(K,{className:"h-3 w-3"}),e.jsx("span",{children:C})]})]}),!f&&l&&e.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden bg-gradient-to-br from-primary/20 to-primary/5 flex items-center justify-center",children:[e.jsx(b,{className:"h-12 w-12 text-primary/40"}),e.jsxs(i,{className:"absolute top-2 left-2 bg-primary text-primary-foreground gap-1",children:[e.jsx(b,{className:"h-3 w-3"}),t("recipe.badge","食谱")]})]}),e.jsxs("div",{className:"p-3",children:[l&&e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground mb-2",children:[r.cook_time&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.cook_time,t("recipe.min","分")]})]}),r.servings&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[r.servings,t("recipe.servingsShort","人")]})]}),r.difficulty&&e.jsx(i,{variant:"secondary",className:`text-xs px-1.5 py-0 h-5 ${F(r.difficulty)}`,children:O(r.difficulty)})]}),_&&(d.length>0||p)&&e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-2",children:[d.slice(0,j).map(a=>e.jsxs(i,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:v=>R(v,a.id),children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:x(a,"name")})]},a.id)),d.length>j&&e.jsxs(i,{variant:"secondary",className:"text-xs gap-1",children:["+",d.length-j]}),p&&e.jsxs(i,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80 gap-1",onClick:S,children:[e.jsx(W,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:p})]})]}),e.jsx("p",{className:`text-sm font-medium line-clamp-2 leading-relaxed ${f?"":"min-h-[60px]"}`,children:l?r.recipe_name:c}),l&&c&&!c.includes("主要配料：")&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3 leading-relaxed mt-1",children:c}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsxs(te,{className:"h-5 w-5 flex-shrink-0",children:[e.jsx(re,{src:s.author?.avatar_url||void 0}),e.jsx(le,{className:"text-[10px]",children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate",children:s.author?.display_name})]}),e.jsxs("button",{className:`flex items-center gap-1 text-xs ${s.user_liked?"text-red-500":"text-muted-foreground"} hover:text-red-500 transition-colors`,onClick:L,disabled:!m,children:[e.jsx(X,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count||0})]})]})]})]}),e.jsx(ie,{open:I,onOpenChange:h,children:e.jsxs(ne,{children:[e.jsxs(ce,{children:[e.jsx(oe,{children:t("community.deleteConfirmTitle","确认删除")}),e.jsx(de,{children:t("community.deleteConfirmDesc","删除后将无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(me,{children:[e.jsx(ue,{children:t("common.cancel","取消")}),e.jsx(xe,{onClick:T,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("common.delete","删除")})]})]})}),l?e.jsx(pe,{post:s,open:y,onOpenChange:g}):e.jsx(je,{post:s,open:y,onOpenChange:g})]})},Ce=n.memo(ve);export{Ce as P};
//# sourceMappingURL=PostGridCard-DnD70SQU.js.map
