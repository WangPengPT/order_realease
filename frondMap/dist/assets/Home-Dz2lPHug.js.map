{"version":3,"file":"Home-Dz2lPHug.js","sources":["../../src/assets/google-play-badge-new.png","../../src/assets/app-store-badge.svg","../../src/components/AskXiaoxiongDialog.tsx","../../src/hooks/usePullToRefresh.ts","../../src/components/PullToRefresh.tsx","../../src/pages/Home.tsx"],"sourcesContent":["export default \"__VITE_ASSET__2yHCsJZn__\"","export default \"__VITE_ASSET__C2R1C$jg__\"","import { useState, useRef, useEffect } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { MessageCircle, Send, Loader2, User } from \"lucide-react\";\r\nimport { useSiteSettings } from \"@/hooks/useSiteSettings\";\r\nimport logoFallback from \"@/assets/xiaoxiong-logo-christmas.png\";\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/components/ui/dialog\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ninterface AskXiaoxiongDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n}\r\n\r\ninterface Message {\r\n  id: string;\r\n  role: \"user\" | \"assistant\";\r\n  content: string;\r\n  isStreaming?: boolean;\r\n}\r\n\r\nconst SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;\r\nconst SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY;\r\n\r\nconst AskXiaoxiongDialog = ({ open, onOpenChange }: AskXiaoxiongDialogProps) => {\r\n  const { i18n } = useTranslation();\r\n  const navigate = useNavigate();\r\n  const { settings } = useSiteSettings();\r\n  const logoUrl = settings?.logo_url || logoFallback;\r\n  const [input, setInput] = useState(\"\");\r\n  const [messages, setMessages] = useState<Message[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [userLocation, setUserLocation] = useState<{ lat: number; lng: number } | null>(null);\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  const scrollAreaRef = useRef<HTMLDivElement>(null);\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Get user location when dialog opens\r\n  useEffect(() => {\r\n    if (open && !userLocation) {\r\n      navigator.geolocation?.getCurrentPosition(\r\n        (position) => {\r\n          setUserLocation({\r\n            lat: position.coords.latitude,\r\n            lng: position.coords.longitude,\r\n          });\r\n        },\r\n        (error) => {\r\n          console.log(\"Unable to get user location:\", error.message);\r\n        },\r\n        { enableHighAccuracy: false, timeout: 5000, maximumAge: 300000 }\r\n      );\r\n    }\r\n  }, [open, userLocation]);\r\n\r\n  // Auto scroll to bottom when new messages arrive\r\n  useEffect(() => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  }, [messages]);\r\n\r\n  const handleSubmit = async () => {\r\n    if (!input.trim() || isLoading) return;\r\n\r\n    const userMessage: Message = {\r\n      id: Date.now().toString(),\r\n      role: \"user\",\r\n      content: input.trim(),\r\n    };\r\n\r\n    const assistantMessageId = (Date.now() + 1).toString();\r\n    const assistantMessage: Message = {\r\n      id: assistantMessageId,\r\n      role: \"assistant\",\r\n      content: \"\",\r\n      isStreaming: true,\r\n    };\r\n\r\n    setMessages((prev) => [...prev, userMessage, assistantMessage]);\r\n    setInput(\"\");\r\n    setIsLoading(true);\r\n\r\n    // Cancel any ongoing request\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n    abortControllerRef.current = new AbortController();\r\n\r\n    try {\r\n      const response = await fetch(`${SUPABASE_URL}/functions/v1/ask-xiaoxiong`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,\r\n          'apikey': SUPABASE_ANON_KEY,\r\n        },\r\n        body: JSON.stringify({ \r\n          text: userMessage.content, \r\n          stream: true,\r\n          lat: userLocation?.lat,\r\n          lng: userLocation?.lng,\r\n        }),\r\n        signal: abortControllerRef.current.signal,\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`Request failed with status: ${response.status}`);\r\n      }\r\n\r\n      if (!response.body) {\r\n        throw new Error('No response body');\r\n      }\r\n\r\n      const reader = response.body.getReader();\r\n      const decoder = new TextDecoder();\r\n      let accumulatedResult = \"\";\r\n\r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n        \r\n        if (done) {\r\n          break;\r\n        }\r\n\r\n        const chunk = decoder.decode(value, { stream: true });\r\n        accumulatedResult += chunk;\r\n        \r\n        // Clean up the result for display\r\n        let cleanResult = accumulatedResult;\r\n        if (cleanResult.startsWith('\"')) {\r\n          cleanResult = cleanResult.slice(1);\r\n        }\r\n        if (cleanResult.endsWith('\"')) {\r\n          cleanResult = cleanResult.slice(0, -1);\r\n        }\r\n        cleanResult = cleanResult.replace(/\\\\n/g, '\\n');\r\n        \r\n        // Update the assistant message\r\n        setMessages((prev) =>\r\n          prev.map((msg) =>\r\n            msg.id === assistantMessageId\r\n              ? { ...msg, content: cleanResult }\r\n              : msg\r\n          )\r\n        );\r\n      }\r\n\r\n      // Final cleanup\r\n      let finalResult = accumulatedResult;\r\n      if (finalResult.startsWith('\"')) {\r\n        finalResult = finalResult.slice(1);\r\n      }\r\n      if (finalResult.endsWith('\"')) {\r\n        finalResult = finalResult.slice(0, -1);\r\n      }\r\n      finalResult = finalResult.replace(/\\\\n/g, '\\n');\r\n      \r\n      setMessages((prev) =>\r\n        prev.map((msg) =>\r\n          msg.id === assistantMessageId\r\n            ? { ...msg, content: finalResult, isStreaming: false }\r\n            : msg\r\n        )\r\n      );\r\n\r\n    } catch (err) {\r\n      if (err instanceof Error && err.name === 'AbortError') {\r\n        console.log('Request aborted');\r\n        return;\r\n      }\r\n      console.error(\"Ask API error:\", err);\r\n      const errorMessage =\r\n        i18n.language === \"zh\"\r\n          ? \"抱歉，暂时无法获取结果，请稍后再试\"\r\n          : i18n.language === \"pt\"\r\n          ? \"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.\"\r\n          : \"Sorry, unable to get results. Please try again later.\";\r\n      \r\n      setMessages((prev) =>\r\n        prev.map((msg) =>\r\n          msg.id === assistantMessageId\r\n            ? { ...msg, content: errorMessage, isStreaming: false }\r\n            : msg\r\n        )\r\n      );\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleKeyDown = (e: React.KeyboardEvent) => {\r\n    if (e.key === \"Enter\" && !e.shiftKey) {\r\n      e.preventDefault();\r\n      handleSubmit();\r\n    }\r\n  };\r\n\r\n  const handleClose = () => {\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleLinkClick = (href: string) => {\r\n    handleClose();\r\n    navigate(href);\r\n  };\r\n\r\n  // Parse text with links: [text](/path) or [text](url)\r\n  const parseTextWithLinks = (text: string): JSX.Element[] => {\r\n    const linkRegex = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\r\n    const parts: JSX.Element[] = [];\r\n    let lastIndex = 0;\r\n    let match;\r\n    let keyIndex = 0;\r\n\r\n    while ((match = linkRegex.exec(text)) !== null) {\r\n      if (match.index > lastIndex) {\r\n        parts.push(<span key={keyIndex++}>{text.slice(lastIndex, match.index)}</span>);\r\n      }\r\n\r\n      const linkText = match[1];\r\n      const href = match[2];\r\n\r\n      if (href.startsWith(\"/\")) {\r\n        parts.push(\r\n          <button\r\n            key={keyIndex++}\r\n            onClick={() => handleLinkClick(href)}\r\n            className=\"text-primary hover:underline font-medium cursor-pointer\"\r\n          >\r\n            {linkText}\r\n          </button>\r\n        );\r\n      } else {\r\n        parts.push(\r\n          <a\r\n            key={keyIndex++}\r\n            href={href}\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n            className=\"text-primary hover:underline font-medium\"\r\n          >\r\n            {linkText}\r\n          </a>\r\n        );\r\n      }\r\n\r\n      lastIndex = match.index + match[0].length;\r\n    }\r\n\r\n    if (lastIndex < text.length) {\r\n      parts.push(<span key={keyIndex++}>{text.slice(lastIndex)}</span>);\r\n    }\r\n\r\n    return parts.length > 0 ? parts : [<span key=\"0\">{text}</span>];\r\n  };\r\n\r\n  // Remove bold markers from text\r\n  const removeBoldMarkers = (text: string): string => {\r\n    return text.replace(/\\*\\*(.*?)\\*\\*/g, '$1');\r\n  };\r\n\r\n  // Truncate text if too long\r\n  const truncateText = (text: string, maxLength: number = 20): string => {\r\n    if (text.length <= maxLength) return text;\r\n    return text.slice(0, maxLength) + '...';\r\n  };\r\n\r\n  // Render a markdown table\r\n  const renderTable = (tableLines: string[], key: number) => {\r\n    const parseRow = (line: string) =>\r\n      line\r\n        .split(\"|\")\r\n        .slice(1, -1)\r\n        .map((cell) => removeBoldMarkers(cell.trim()));\r\n\r\n    const headers = parseRow(tableLines[0]);\r\n    // Skip separator line (index 1), parse data rows\r\n    const rows = tableLines.slice(2).map(parseRow);\r\n\r\n    return (\r\n      <div key={key} className=\"overflow-x-auto my-2 max-w-full\">\r\n        <table className=\"w-full text-xs border border-border rounded-md overflow-hidden table-fixed\">\r\n          <thead className=\"bg-muted/60\">\r\n            <tr>\r\n              {headers.map((header, i) => (\r\n                <th\r\n                  key={i}\r\n                  className=\"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]\"\r\n                  title={header}\r\n                >\r\n                  {parseTextWithLinks(truncateText(header, 15))}\r\n                </th>\r\n              ))}\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.map((row, rowIndex) => (\r\n              <tr\r\n                key={rowIndex}\r\n                className=\"border-b border-border last:border-0 hover:bg-muted/30 transition-colors\"\r\n              >\r\n                {row.map((cell, cellIndex) => (\r\n                  <td \r\n                    key={cellIndex} \r\n                    className=\"px-2 py-2 truncate max-w-[100px]\"\r\n                    title={cell}\r\n                  >\r\n                    {parseTextWithLinks(truncateText(cell, 18))}\r\n                  </td>\r\n                ))}\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderMarkdown = (content: string) => {\r\n    const lines = content.split(\"\\n\");\r\n    const elements: JSX.Element[] = [];\r\n    let i = 0;\r\n\r\n    while (i < lines.length) {\r\n      const line = lines[i];\r\n\r\n      // Detect table: starts with | and contains multiple |\r\n      if (line.trim().startsWith(\"|\") && line.split(\"|\").length > 2) {\r\n        const tableLines: string[] = [];\r\n\r\n        // Collect all consecutive table lines\r\n        while (i < lines.length && lines[i].trim().startsWith(\"|\")) {\r\n          tableLines.push(lines[i]);\r\n          i++;\r\n        }\r\n\r\n        // Need at least header + separator + 1 data row, but render even with just header + separator\r\n        if (tableLines.length >= 2) {\r\n          elements.push(renderTable(tableLines, elements.length));\r\n        }\r\n        continue;\r\n      }\r\n\r\n      // Existing markdown rendering logic\r\n      if (line.startsWith(\"### \")) {\r\n        elements.push(\r\n          <h3 key={elements.length} className=\"text-base font-semibold mt-3 mb-1\">\r\n            {parseTextWithLinks(line.slice(4))}\r\n          </h3>\r\n        );\r\n      } else if (line.startsWith(\"## \")) {\r\n        elements.push(\r\n          <h2 key={elements.length} className=\"text-lg font-bold mt-4 mb-2\">\r\n            {parseTextWithLinks(line.slice(3))}\r\n          </h2>\r\n        );\r\n      } else if (line.startsWith(\"# \")) {\r\n        elements.push(\r\n          <h1 key={elements.length} className=\"text-xl font-bold mt-4 mb-2\">\r\n            {parseTextWithLinks(line.slice(2))}\r\n          </h1>\r\n        );\r\n      } else if (line.includes(\"**\")) {\r\n        const parts = line.split(/\\*\\*(.*?)\\*\\*/g);\r\n        elements.push(\r\n          <p key={elements.length} className=\"mb-1 leading-relaxed\">\r\n            {parts.map((part, idx) =>\r\n              idx % 2 === 1 ? (\r\n                <strong key={idx} className=\"font-semibold\">\r\n                  {parseTextWithLinks(part)}\r\n                </strong>\r\n              ) : (\r\n                parseTextWithLinks(part)\r\n              )\r\n            )}\r\n          </p>\r\n        );\r\n      } else if (line.startsWith(\"- \") || line.startsWith(\"* \")) {\r\n        elements.push(\r\n          <li key={elements.length} className=\"ml-4 mb-0.5 list-disc\">\r\n            {parseTextWithLinks(line.slice(2))}\r\n          </li>\r\n        );\r\n      } else if (/^\\d+\\.\\s/.test(line)) {\r\n        elements.push(\r\n          <li key={elements.length} className=\"ml-4 mb-0.5 list-decimal\">\r\n            {parseTextWithLinks(line.replace(/^\\d+\\.\\s/, \"\"))}\r\n          </li>\r\n        );\r\n      } else if (line.match(/^[-*_]{3,}$/)) {\r\n        elements.push(<hr key={elements.length} className=\"my-3 border-border\" />);\r\n      } else if (line.trim() === \"\") {\r\n        elements.push(<div key={elements.length} className=\"h-1\" />);\r\n      } else {\r\n        elements.push(\r\n          <p key={elements.length} className=\"mb-1 leading-relaxed\">\r\n            {parseTextWithLinks(line)}\r\n          </p>\r\n        );\r\n      }\r\n\r\n      i++;\r\n    }\r\n\r\n    return elements;\r\n  };\r\n\r\n  const getTitle = () => {\r\n    if (i18n.language === \"zh\") return \"和小熊聊聊\";\r\n    if (i18n.language === \"pt\") return \"Converse com Xiaoxiong\";\r\n    return \"Chat with Xiaoxiong\";\r\n  };\r\n\r\n  const getPlaceholder = () => {\r\n    if (i18n.language === \"zh\") return \"输入你的想法...\";\r\n    if (i18n.language === \"pt\") return \"Digite sua ideia...\";\r\n    return \"Type your idea...\";\r\n  };\r\n\r\n  const getWelcomeMessage = () => {\r\n    if (i18n.language === \"zh\") return \"你好！我是小熊，告诉我你想吃什么，我来帮你推荐餐厅！\";\r\n    if (i18n.language === \"pt\") return \"Olá! Eu sou o Xiaoxiong, me diga o que você quer comer e eu vou te ajudar a encontrar restaurantes!\";\r\n    return \"Hi! I'm Xiaoxiong, tell me what you want to eat and I'll help you find restaurants!\";\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={handleClose}>\r\n      <DialogContent className=\"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden\">\r\n        <DialogHeader className=\"px-4 py-3 border-b shrink-0 bg-primary/5\">\r\n          <DialogTitle className=\"flex items-center gap-2 text-base\">\r\n            <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden\">\r\n              <img src={logoUrl} alt=\"Logo\" className=\"w-6 h-6 object-contain\" />\r\n            </div>\r\n            {getTitle()}\r\n          </DialogTitle>\r\n        </DialogHeader>\r\n\r\n        {/* Chat Messages Area - Scrollable */}\r\n        <ScrollArea className=\"flex-1 h-0\" ref={scrollAreaRef}>\r\n          <div className=\"p-4 space-y-4\">\r\n            {/* Welcome message */}\r\n            {messages.length === 0 && (\r\n              <div className=\"flex gap-3\">\r\n                <div className=\"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0\">\r\n                  <MessageCircle className=\"w-4 h-4 text-primary\" />\r\n                </div>\r\n                <div className=\"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm\">\r\n                  {getWelcomeMessage()}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/* Messages */}\r\n            {messages.map((message) => (\r\n              <div\r\n                key={message.id}\r\n                className={cn(\r\n                  \"flex gap-3\",\r\n                  message.role === \"user\" && \"flex-row-reverse\"\r\n                )}\r\n              >\r\n                <div\r\n                  className={cn(\r\n                    \"w-8 h-8 rounded-full flex items-center justify-center shrink-0\",\r\n                    message.role === \"user\"\r\n                      ? \"bg-primary text-primary-foreground\"\r\n                      : \"bg-primary/10\"\r\n                  )}\r\n                >\r\n                  {message.role === \"user\" ? (\r\n                    <User className=\"h-4 w-4\" />\r\n                  ) : (\r\n                    <MessageCircle className=\"h-4 w-4\" />\r\n                  )}\r\n                </div>\r\n                <div\r\n                  className={cn(\r\n                    \"flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm\",\r\n                    message.role === \"user\"\r\n                      ? \"bg-primary text-primary-foreground rounded-tr-sm\"\r\n                      : \"bg-muted/50 rounded-tl-sm\"\r\n                  )}\r\n                >\r\n                  {message.role === \"assistant\" ? (\r\n                    <>\r\n                      {message.content ? (\r\n                        <div className=\"prose-sm\">\r\n                          {renderMarkdown(message.content)}\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center gap-2 text-muted-foreground\">\r\n                          <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                          <span>\r\n                            {i18n.language === \"zh\"\r\n                              ? \"思考中...\"\r\n                              : i18n.language === \"pt\"\r\n                              ? \"Pensando...\"\r\n                              : \"Thinking...\"}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {message.isStreaming && message.content && (\r\n                        <span className=\"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle\" />\r\n                      )}\r\n                    </>\r\n                  ) : (\r\n                    message.content\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n            <div ref={messagesEndRef} />\r\n          </div>\r\n        </ScrollArea>\r\n\r\n        {/* Input Section */}\r\n        <div className=\"p-3 border-t bg-background shrink-0\">\r\n          <div className=\"flex gap-2\">\r\n            <Input\r\n              value={input}\r\n              onChange={(e) => setInput(e.target.value)}\r\n              onKeyDown={handleKeyDown}\r\n              placeholder={getPlaceholder()}\r\n              disabled={isLoading}\r\n              className=\"flex-1 rounded-full bg-muted/50 border-0 focus-visible:ring-1\"\r\n              autoFocus\r\n            />\r\n            <Button\r\n              onClick={handleSubmit}\r\n              disabled={!input.trim() || isLoading}\r\n              size=\"icon\"\r\n              className=\"shrink-0 rounded-full\"\r\n            >\r\n              {isLoading ? (\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n              ) : (\r\n                <Send className=\"h-4 w-4\" />\r\n              )}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nexport default AskXiaoxiongDialog;\r\n","import { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\ninterface UsePullToRefreshOptions {\r\n  onRefresh: () => Promise<void>;\r\n  threshold?: number;\r\n  maxPull?: number;\r\n}\r\n\r\nexport function usePullToRefresh({\r\n  onRefresh,\r\n  threshold = 80,\r\n  maxPull = 120\r\n}: UsePullToRefreshOptions) {\r\n  const [isPulling, setIsPulling] = useState(false);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  const [pullDistance, setPullDistance] = useState(0);\r\n  \r\n  const startY = useRef(0);\r\n  const currentY = useRef(0);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n\r\n  const handleTouchStart = useCallback((e: TouchEvent) => {\r\n    // Only start if we're at the top of the page\r\n    const scrollTop = window.scrollY || document.documentElement.scrollTop;\r\n    if (scrollTop > 5) return;\r\n    \r\n    startY.current = e.touches[0].clientY;\r\n    setIsPulling(true);\r\n  }, []);\r\n\r\n  const handleTouchMove = useCallback((e: TouchEvent) => {\r\n    if (!isPulling || isRefreshing) return;\r\n    \r\n    currentY.current = e.touches[0].clientY;\r\n    const diff = currentY.current - startY.current;\r\n    \r\n    // Only pull down, not up\r\n    if (diff < 0) {\r\n      setPullDistance(0);\r\n      return;\r\n    }\r\n\r\n    // Prevent default to avoid browser's own pull-to-refresh\r\n    if (diff > 10) {\r\n      e.preventDefault();\r\n    }\r\n    \r\n    // Apply resistance for a more natural feel\r\n    const resistance = 0.5;\r\n    const distance = Math.min(diff * resistance, maxPull);\r\n    setPullDistance(distance);\r\n  }, [isPulling, isRefreshing, maxPull]);\r\n\r\n  const handleTouchEnd = useCallback(async () => {\r\n    if (!isPulling) return;\r\n    \r\n    setIsPulling(false);\r\n    \r\n    if (pullDistance >= threshold && !isRefreshing) {\r\n      setIsRefreshing(true);\r\n      setPullDistance(threshold); // Keep at threshold during refresh\r\n      \r\n      try {\r\n        await onRefresh();\r\n      } finally {\r\n        setIsRefreshing(false);\r\n        setPullDistance(0);\r\n      }\r\n    } else {\r\n      setPullDistance(0);\r\n    }\r\n  }, [isPulling, pullDistance, threshold, isRefreshing, onRefresh]);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    // Use passive: false to allow preventDefault\r\n    container.addEventListener('touchstart', handleTouchStart, { passive: true });\r\n    container.addEventListener('touchmove', handleTouchMove, { passive: false });\r\n    container.addEventListener('touchend', handleTouchEnd, { passive: true });\r\n\r\n    return () => {\r\n      container.removeEventListener('touchstart', handleTouchStart);\r\n      container.removeEventListener('touchmove', handleTouchMove);\r\n      container.removeEventListener('touchend', handleTouchEnd);\r\n    };\r\n  }, [handleTouchStart, handleTouchMove, handleTouchEnd]);\r\n\r\n  const progress = Math.min(pullDistance / threshold, 1);\r\n\r\n  return {\r\n    containerRef,\r\n    isPulling,\r\n    isRefreshing,\r\n    pullDistance,\r\n    progress\r\n  };\r\n}\r\n","import { ReactNode } from 'react';\r\nimport { RefreshCw } from 'lucide-react';\r\nimport { usePullToRefresh } from '@/hooks/usePullToRefresh';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface PullToRefreshProps {\r\n  children: ReactNode;\r\n  onRefresh: () => Promise<void>;\r\n  className?: string;\r\n}\r\n\r\nexport function PullToRefresh({ children, onRefresh, className }: PullToRefreshProps) {\r\n  const { containerRef, isRefreshing, pullDistance, progress } = usePullToRefresh({\r\n    onRefresh,\r\n    threshold: 80,\r\n    maxPull: 120\r\n  });\r\n\r\n  return (\r\n    <div ref={containerRef} className={cn(\"relative\", className)}>\r\n      {/* Pull indicator */}\r\n      <div \r\n        className=\"absolute left-1/2 -translate-x-1/2 z-50 flex items-center justify-center transition-opacity duration-200 pointer-events-none\"\r\n        style={{ \r\n          top: Math.max(pullDistance - 50, 8),\r\n          opacity: pullDistance > 20 ? 1 : 0\r\n        }}\r\n      >\r\n        <div className={cn(\r\n          \"w-10 h-10 rounded-full bg-background/90 backdrop-blur-sm shadow-lg flex items-center justify-center border border-border/50\",\r\n          isRefreshing && \"animate-pulse\"\r\n        )}>\r\n          <RefreshCw \r\n            className={cn(\r\n              \"w-5 h-5 text-primary transition-transform duration-200\",\r\n              isRefreshing && \"animate-spin\"\r\n            )}\r\n            style={{ \r\n              transform: isRefreshing \r\n                ? undefined \r\n                : `rotate(${progress * 360}deg)` \r\n            }}\r\n          />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Content with pull transform */}\r\n      <div \r\n        style={{ \r\n          transform: pullDistance > 0 ? `translateY(${pullDistance}px)` : undefined,\r\n          transition: pullDistance === 0 ? 'transform 0.3s ease-out' : undefined\r\n        }}\r\n      >\r\n        {children}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { Button } from \"@/components/ui/button\";\r\nimport { MapPin, Search, Star, Calendar, Store, ArrowRight, ShoppingBag, CalendarCheck, Smartphone, Download, MessageCircle } from \"lucide-react\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { Card } from \"@/components/ui/card\";\r\n// Hero images served from public folder for LCP optimization (discoverable in initial HTML)\r\nconst sushiRamenHero = \"/images/sushi-ramen-hero.jpg\";\r\nconst sushiRamenMobile = \"/images/sushi-ramen-mobile.jpg\";\r\nimport mapIcon from \"@/assets/map-icon.png\";\r\nimport googlePlayBadge from \"@/assets/google-play-badge-new.png\";\r\nimport appStoreBadge from \"@/assets/app-store-badge.svg\";\r\nimport { useState, useEffect, memo, useCallback, useRef } from \"react\";\r\nimport { useActiveHomepageTemplates, HomepageTemplate } from \"@/hooks/useHomepageTemplates\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { usePageView } from \"@/hooks/usePageView\";\r\nimport { HomeSkeleton } from \"@/components/skeletons\";\r\nimport { isIOSWebView, isInWebView, isCapacitorApp, isIOSDevice } from \"@/lib/externalLinks\";\r\nimport AskXiaoxiongDialog from \"@/components/AskXiaoxiongDialog\";\r\nimport { PullToRefresh } from \"@/components/PullToRefresh\";\r\nimport { useQueryClient } from \"@tanstack/react-query\";\r\n// Memoized Stats Display Component\r\nconst StatsDisplay = memo(({ stats, t }: { stats: { order_count: number; reserve_count: number }; t: (key: string) => string }) => (\r\n  <div className=\"absolute top-16 sm:top-20 left-3 z-20\">\r\n    <div className=\"gap-4 w-fit flex-col flex items-start justify-start\">\r\n      <div className=\"flex items-center gap-4\">\r\n        <div className=\"flex items-center gap-2\">\r\n          <ShoppingBag className=\"w-4 h-4 text-primary\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.delivery\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.order_count}</span>\r\n        </div>\r\n        <div className=\"flex items-center gap-2\">\r\n          <CalendarCheck className=\"w-4 h-4 text-accent\" />\r\n          <span className=\"text-sm text-white/90 drop-shadow-md\">{t(\"home.stats.reservation\")}</span>\r\n          <span className=\"font-bold text-white text-sm drop-shadow-md\">{stats.reserve_count}</span>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"flex items-center gap-2\">\r\n        <span className=\"text-xl sm:text-2xl font-bold text-white drop-shadow-md\">\r\n          {t(\"home.hero.brandName\")}\r\n        </span>\r\n        <img \r\n          src={mapIcon} \r\n          alt=\"map icon\" \r\n          width={32}\r\n          height={32}\r\n          loading=\"eager\"\r\n          decoding=\"async\"\r\n          className=\"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0\" \r\n        />\r\n      </div>\r\n    </div>\r\n  </div>\r\n));\r\nStatsDisplay.displayName = \"StatsDisplay\";\r\n\r\n// Memoized Feature Card Component\r\nconst FeatureCard = memo(({ \r\n  to, \r\n  Icon, \r\n  title, \r\n  desc, \r\n  iconBg, \r\n  iconColor, \r\n  hoverBorderColor \r\n}: { \r\n  to: string; \r\n  Icon: any; \r\n  title: string; \r\n  desc: string; \r\n  iconBg: string; \r\n  iconColor: string; \r\n  hoverBorderColor: string; \r\n}) => (\r\n  <Link to={to}>\r\n    <Card className={`group p-6 sm:p-8 border-border/50 ${hoverBorderColor} transition-all hover:shadow-large cursor-pointer h-full`}>\r\n      <div className={`w-14 sm:w-16 h-14 sm:h-16 rounded-2xl ${iconBg} flex items-center justify-center mb-4 sm:mb-6 group-hover:scale-110 transition-transform`}>\r\n        <Icon className={`w-7 sm:w-8 h-7 sm:h-8 ${iconColor}`} />\r\n      </div>\r\n      <h3 className=\"text-xl sm:text-2xl font-semibold mb-2 sm:mb-3 text-card-foreground\">\r\n        {title}\r\n      </h3>\r\n      <p className=\"text-sm sm:text-base text-muted-foreground leading-relaxed flex items-center gap-2\">\r\n        {desc}\r\n        <ArrowRight className=\"w-4 h-4 flex-shrink-0 group-hover:translate-x-1 transition-transform\" />\r\n      </p>\r\n    </Card>\r\n  </Link>\r\n));\r\nFeatureCard.displayName = \"FeatureCard\";\r\n\r\n// Hook to determine if we should use lightweight mode for better performance\r\nconst useLightweightMode = (): boolean => {\r\n  const isMobile = window.innerWidth < 640;\r\n  const isDesktop = window.innerWidth >= 1024;\r\n  const connection = (navigator as any).connection;\r\n  \r\n  // Enhanced detection and logging for iOS debugging\r\n  const cap = (window as any).Capacitor;\r\n  const isCapacitor = isCapacitorApp();\r\n  const isWebView = isInWebView();\r\n  const isIOS = isIOSDevice();\r\n  const ua = navigator.userAgent;\r\n  \r\n  console.log('[LightweightMode] Detection:', {\r\n    isCapacitorApp: isCapacitor,\r\n    isInWebView: isWebView,\r\n    isIOSDevice: isIOS,\r\n    hasCapacitor: !!cap,\r\n    capacitorDetails: cap ? {\r\n      isNativePlatform: cap.isNativePlatform,\r\n      isNative: cap.isNative,\r\n      platform: cap.getPlatform?.()\r\n    } : null,\r\n    userAgent: ua.substring(0, 150),\r\n    hasSafari: /Safari\\//.test(ua),\r\n    hasVersion: /Version\\/[\\d.]+/.test(ua),\r\n    isStandalone: (window.navigator as any).standalone === true\r\n  });\r\n  \r\n  // Desktop: only use lightweight mode if user explicitly enabled data saver\r\n  if (isDesktop) {\r\n    if (connection?.saveData) return true;\r\n    return false; // Desktop always loads video by default\r\n  }\r\n  \r\n  // Mobile/Tablet: WebView environments use lightweight mode\r\n  // But exclude Capacitor native apps (user's own app should play videos)\r\n  if (isWebView && !isCapacitor) {\r\n    console.log('[LightweightMode] WebView detected (not Capacitor), using lightweight mode');\r\n    return true;\r\n  }\r\n  \r\n  // Check for slow network or data saver (mobile/tablet)\r\n  if (connection) {\r\n    if (connection.saveData) return true;\r\n    if (connection.effectiveType === '2g' || connection.effectiveType === 'slow-2g') return true;\r\n  }\r\n  \r\n  // Mobile low memory devices (< 2GB) - reduced threshold\r\n  if (isMobile && (navigator as any).deviceMemory && (navigator as any).deviceMemory < 2) return true;\r\n  \r\n  console.log('[LightweightMode] Normal mode, videos enabled for', isIOS ? 'iOS' : 'non-iOS', 'device');\r\n  return false;\r\n};\r\n\r\n// Hero Slide Component\r\nconst HeroSlide = memo(({ \r\n  template, \r\n  isActive, \r\n  currentLang, \r\n  t,\r\n  onContentReady,\r\n  onAskXiaoxiong\r\n}: { \r\n  template: HomepageTemplate; \r\n  isActive: boolean;\r\n  currentLang: string;\r\n  t: (key: string) => string;\r\n  onContentReady?: () => void;\r\n  onAskXiaoxiong?: () => void;\r\n}) => {\r\n  const [postersLoaded, setPostersLoaded] = useState<Record<string, boolean>>({});\r\n  const [videosReady, setVideosReady] = useState<Record<string, boolean>>({});\r\n  const [videoErrors, setVideoErrors] = useState<Record<string, boolean>>({});\r\n  const [imagesLoaded, setImagesLoaded] = useState<Record<string, boolean>>({\r\n    mobile: true,\r\n    tablet: true, \r\n    desktop: true\r\n  });\r\n  // Control when to start loading videos - only after image is ready\r\n  const [shouldLoadVideo, setShouldLoadVideo] = useState(false);\r\n  const isLightweight = useLightweightMode();\r\n  \r\n  // Video refs for iOS Safari fix\r\n  const mobileVideoRef = useRef<HTMLVideoElement>(null);\r\n  const tabletVideoRef = useRef<HTMLVideoElement>(null);\r\n  const desktopVideoRef = useRef<HTMLVideoElement>(null);\r\n  \r\n  const getLocalizedText = (field: string) => {\r\n    const langSuffix = currentLang === \"zh\" ? \"_zh\" : currentLang === \"pt\" ? \"_pt\" : \"_en\";\r\n    return (template as any)[`${field}${langSuffix}`] || \"\";\r\n  };\r\n\r\n  const getDeviceType = () => {\r\n    if (window.innerWidth < 640) return 'mobile';\r\n    if (window.innerWidth < 1024) return 'tablet';\r\n    return 'desktop';\r\n  };\r\n\r\n  const getOverlayOpacity = () => {\r\n    const deviceType = getDeviceType();\r\n    \r\n    if (deviceType === 'mobile' && template.mobile_overlay_opacity !== null) {\r\n      return template.mobile_overlay_opacity;\r\n    }\r\n    if (deviceType === 'tablet' && template.tablet_overlay_opacity !== null) {\r\n      return template.tablet_overlay_opacity;\r\n    }\r\n    if (deviceType === 'desktop' && template.desktop_overlay_opacity !== null) {\r\n      return template.desktop_overlay_opacity;\r\n    }\r\n    \r\n    return template.overlay_opacity ?? 30;\r\n  };\r\n\r\n  const getOverlayStyle = () => {\r\n    const baseOpacity = getOverlayOpacity();\r\n    const direction = template.overlay_gradient_direction || 'to-b';\r\n    \r\n    const normalizeOpacity = (value: number | null | undefined, defaultValue: number) => {\r\n      if (value === null || value === undefined) return defaultValue / 100;\r\n      return value > 1 ? value / 100 : value;\r\n    };\r\n    \r\n    const normalizedBaseOpacity = baseOpacity > 1 ? baseOpacity / 100 : baseOpacity;\r\n    \r\n    const fromOpacity = normalizeOpacity(template.overlay_gradient_from_opacity, 30) * normalizedBaseOpacity;\r\n    const viaOpacity = normalizeOpacity(template.overlay_gradient_via_opacity, 25) * normalizedBaseOpacity;\r\n    const toOpacity = normalizeOpacity(template.overlay_gradient_to_opacity, 40) * normalizedBaseOpacity;\r\n\r\n    const directionMap: Record<string, string> = {\r\n      'to-t': 'to top',\r\n      'to-b': 'to bottom',\r\n      'to-l': 'to left',\r\n      'to-r': 'to right',\r\n      'to-tl': 'to top left',\r\n      'to-tr': 'to top right',\r\n      'to-bl': 'to bottom left',\r\n      'to-br': 'to bottom right'\r\n    };\r\n\r\n    const cssDirection = directionMap[direction] || 'to bottom';\r\n\r\n    const colorMap: Record<string, string> = {\r\n      'black': '0, 0, 0',\r\n      'white': '255, 255, 255',\r\n      'background': '0, 0, 0',\r\n      'foreground': '255, 255, 255',\r\n      'primary': '1, 100, 80',\r\n      'secondary': '240, 240, 240'\r\n    };\r\n\r\n    const fromColor = colorMap[template.overlay_gradient_from || 'black'] || '0, 0, 0';\r\n    const viaColor = colorMap[template.overlay_gradient_via || 'black'] || '0, 0, 0';\r\n    const toColor = colorMap[template.overlay_gradient_to || 'black'] || '0, 0, 0';\r\n\r\n    return {\r\n      background: `linear-gradient(${cssDirection}, rgba(${fromColor}, ${fromOpacity}), rgba(${viaColor}, ${viaOpacity}), rgba(${toColor}, ${toOpacity}))`\r\n    };\r\n  };\r\n\r\n  const mobileImg = template.mobile_image_url || sushiRamenMobile;\r\n  const tabletImg = template.tablet_image_url || template.desktop_image_url || sushiRamenHero;\r\n  const desktopImg = template.desktop_image_url || sushiRamenHero;\r\n  const blurAmount = template.background_blur || 0;\r\n\r\n  // Per-device media type (fallback to global media_type for backwards compatibility)\r\n  const desktopMediaType = (template as any).desktop_media_type || template.media_type || 'image';\r\n  const tabletMediaType = (template as any).tablet_media_type || template.media_type || 'image';\r\n  const mobileMediaType = (template as any).mobile_media_type || template.media_type || 'image';\r\n\r\n  // In lightweight mode (WebView), always treat as image to avoid video loading overhead\r\n  const isDesktopVideo = desktopMediaType === 'video' && !isLightweight;\r\n  const isTabletVideo = tabletMediaType === 'video' && !isLightweight;\r\n  const isMobileVideo = mobileMediaType === 'video' && !isLightweight;\r\n  \r\n  const mobileVideo = isMobileVideo ? template.mobile_video_url : null;\r\n  const tabletVideo = isTabletVideo ? (template.tablet_video_url || template.desktop_video_url) : null;\r\n  const desktopVideo = isDesktopVideo ? template.desktop_video_url : null;\r\n\r\n  // Preload only current device's poster image to prevent flash\r\n  useEffect(() => {\r\n    const deviceType = getDeviceType();\r\n    const currentImage = deviceType === 'mobile' ? mobileImg \r\n      : deviceType === 'tablet' ? tabletImg : desktopImg;\r\n    \r\n    if (currentImage) {\r\n      const img = new Image();\r\n      img.onload = () => {\r\n        setPostersLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        setImagesLoaded(prev => ({ ...prev, [deviceType]: true }));\r\n        // Image is ready - notify parent and start loading video\r\n        if (isActive) {\r\n          onContentReady?.();\r\n          // Start loading video after image is displayed (with slight delay for smoother UX)\r\n          setTimeout(() => setShouldLoadVideo(true), 100);\r\n        }\r\n      };\r\n      img.src = currentImage;\r\n    }\r\n  }, [mobileImg, tabletImg, desktopImg, isActive, onContentReady]);\r\n\r\n  // Also enable video loading when slide becomes active (for carousel navigation)\r\n  useEffect(() => {\r\n    if (isActive && postersLoaded[getDeviceType()]) {\r\n      setShouldLoadVideo(true);\r\n    }\r\n  }, [isActive, postersLoaded]);\r\n\r\n  const handleVideoCanPlay = (device: string) => {\r\n    setVideosReady(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  const handleVideoError = (device: string, error: any) => {\r\n    console.error(`[HeroSlide] Video error on ${device}:`, error);\r\n    setVideoErrors(prev => ({ ...prev, [device]: true }));\r\n  };\r\n\r\n  // iOS Safari video autoplay fix - programmatically set muted and trigger play\r\n  useEffect(() => {\r\n    if (!shouldLoadVideo || !isActive) return;\r\n    \r\n    const isIOS = isIOSDevice();\r\n    if (!isIOS) return;\r\n\r\n    const deviceType = getDeviceType();\r\n    const videoRef = deviceType === 'mobile' ? mobileVideoRef \r\n      : deviceType === 'tablet' ? tabletVideoRef : desktopVideoRef;\r\n    \r\n    const video = videoRef.current;\r\n    if (!video) return;\r\n\r\n    // For iOS, we need to programmatically ensure muted is set and call play()\r\n    const attemptPlay = async () => {\r\n      try {\r\n        video.muted = true;\r\n        video.playsInline = true;\r\n        // Set webkit-playsinline for older iOS versions\r\n        video.setAttribute('webkit-playsinline', 'true');\r\n        \r\n        await video.play();\r\n        console.log(`[HeroSlide] iOS video play successful on ${deviceType}`);\r\n      } catch (err) {\r\n        console.error(`[HeroSlide] iOS video play failed on ${deviceType}:`, err);\r\n        // Mark as error so we show the fallback image\r\n        setVideoErrors(prev => ({ ...prev, [deviceType]: true }));\r\n      }\r\n    };\r\n\r\n    // Small delay to ensure video element is ready\r\n    const timer = setTimeout(attemptPlay, 150);\r\n    return () => clearTimeout(timer);\r\n  }, [shouldLoadVideo, isActive]);\r\n\r\n  return (\r\n    <div className={cn(\r\n      \"absolute inset-0 w-full h-full transition-opacity duration-1000\",\r\n      isActive ? \"opacity-100 z-10\" : \"opacity-0 z-0\"\r\n    )}>\r\n      {/* 背景媒体 */}\r\n      <div className=\"absolute inset-0 w-full h-full\">\r\n        {/* Mobile: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full sm:hidden\">\r\n          {!imagesLoaded.mobile && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isMobileVideo && mobileVideo ? (\r\n            <>\r\n              <img \r\n                src={mobileImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.mobile && !videoErrors.mobile ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.mobile && (\r\n                <video\r\n                  ref={mobileVideoRef}\r\n                  src={mobileVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('mobile')}\r\n                  onError={(e) => handleVideoError('mobile', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={mobileImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.mobile ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Tablet: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden sm:block lg:hidden\">\r\n          {!imagesLoaded.tablet && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isTabletVideo && tabletVideo ? (\r\n            <>\r\n              <img \r\n                src={tabletImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.tablet && !videoErrors.tablet ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.tablet && (\r\n                <video\r\n                  ref={tabletVideoRef}\r\n                  src={tabletVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('tablet')}\r\n                  onError={(e) => handleVideoError('tablet', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={tabletImg} \r\n              alt=\"Background\" \r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.tablet ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        \r\n        {/* Desktop: Per-device media type */}\r\n        <div className=\"absolute inset-0 w-full h-full hidden lg:block\">\r\n          {!imagesLoaded.desktop && (\r\n            <div className=\"absolute inset-0 w-full h-full bg-muted animate-pulse z-20\" />\r\n          )}\r\n          {isDesktopVideo && desktopVideo ? (\r\n            <>\r\n              <img \r\n                src={desktopImg} \r\n                alt=\"Background\" \r\n                className={cn(\r\n                  \"absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500\",\r\n                  videosReady.desktop && !videoErrors.desktop ? \"opacity-0 pointer-events-none\" : \"opacity-100\"\r\n                )}\r\n                style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n              />\r\n              {shouldLoadVideo && !videoErrors.desktop && (\r\n                <video\r\n                  ref={desktopVideoRef}\r\n                  src={desktopVideo}\r\n                  autoPlay\r\n                  loop\r\n                  muted\r\n                  playsInline\r\n                  // @ts-ignore - webkit-playsinline for iOS Safari\r\n                  webkit-playsinline=\"true\"\r\n                  preload=\"auto\"\r\n                  onCanPlay={() => handleVideoCanPlay('desktop')}\r\n                  onError={(e) => handleVideoError('desktop', e)}\r\n                  className=\"absolute inset-0 w-full h-full object-cover object-center\"\r\n                  style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n                />\r\n              )}\r\n            </>\r\n          ) : (\r\n            <img \r\n              src={desktopImg} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className={cn(\r\n                \"absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500\",\r\n                imagesLoaded.desktop ? \"opacity-100\" : \"opacity-0\"\r\n              )}\r\n              style={{ filter: blurAmount > 0 ? `blur(${blurAmount}px)` : undefined }}\r\n            />\r\n          )}\r\n        </div>\r\n        <div className=\"absolute inset-0 w-full h-full\" style={getOverlayStyle()} />\r\n      </div>\r\n\r\n      {/* 内容 */}\r\n      <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen\">\r\n        <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n          {template.subtitle_button_text_zh && (\r\n            <div className=\"flex justify-center\">\r\n              <button \r\n                onClick={onAskXiaoxiong}\r\n                className=\"group flex items-center gap-3 bg-white/95 backdrop-blur-sm text-muted-foreground px-4 sm:px-6 py-3 sm:py-4 rounded-full shadow-lg hover:shadow-2xl hover:bg-white transition-all duration-300 cursor-text border border-border/20\"\r\n              >\r\n                <MessageCircle className=\"w-5 h-5 text-primary/70 group-hover:text-primary transition-colors\" />\r\n                <span className=\"text-sm sm:text-base text-muted-foreground/80 group-hover:text-muted-foreground transition-colors\">\r\n                  {getLocalizedText(\"subtitle_button_text\") || t(\"home.hero.subtitle\")}\r\n                </span>\r\n                <Search className=\"w-4 h-4 text-muted-foreground/50 ml-2\" />\r\n              </button>\r\n            </div>\r\n          )}\r\n          \r\n          <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n            {getLocalizedText(\"title\") || t(\"home.hero.title\")}\r\n          </h1>\r\n          \r\n          <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n            {getLocalizedText(\"description\") || t(\"home.hero.description\")}\r\n          </p>\r\n          \r\n          <div className=\"flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center pt-2 sm:pt-4 px-4\">\r\n            <Button size=\"lg\" asChild className=\"text-base sm:text-lg shadow-lg hover:shadow-2xl hover:scale-105 transition-all w-full sm:w-auto\">\r\n              <Link to={template.primary_button_link || \"/restaurants\"}>\r\n                <Search className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {getLocalizedText(\"primary_button_text\") || t(\"home.hero.exploreBtn\")}\r\n              </Link>\r\n            </Button>\r\n            <Button size=\"lg\" variant=\"outline\" asChild className=\"text-base sm:text-lg w-full sm:w-auto backdrop-blur-sm hover:border-transparent hover:scale-105 transition-all\">\r\n              <Link to={template.secondary_button_link || \"/activities\"}>\r\n                <Calendar className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {getLocalizedText(\"secondary_button_text\") || t(\"home.hero.activitiesBtn\")}\r\n              </Link>\r\n            </Button>\r\n            <Button size=\"lg\" asChild className=\"text-base sm:text-lg w-full sm:w-auto bg-[#e8f5f0] text-[#3d9970] hover:bg-[#d4ede4] hover:scale-105 transition-all shadow-lg border border-[#3d9970]/30\">\r\n              <Link to={(template as any).map_button_link || \"/map\"}>\r\n                <MapPin className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {getLocalizedText(\"map_button_text\") || t(\"home.hero.mapBtn\")}\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nHeroSlide.displayName = \"HeroSlide\";\r\n\r\nconst Home = () => {\r\n  const { t, i18n } = useTranslation();\r\n  const queryClient = useQueryClient();\r\n  const { data: templates, isLoading: isLoadingTemplates, refetch: refetchTemplates } = useActiveHomepageTemplates();\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [stats, setStats] = useState<{ order_count: number; reserve_count: number } | null>(null);\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [firstSlideReady, setFirstSlideReady] = useState(false);\r\n  const [askDialogOpen, setAskDialogOpen] = useState(false);\r\n  \r\n  // Handler for when the first slide's content is ready\r\n  const handleContentReady = useCallback(() => {\r\n    setFirstSlideReady(true);\r\n  }, []);\r\n\r\n  // Track page view\r\n  usePageView({ pageType: \"home\" });\r\n\r\n  const fetchStats = useCallback(async () => {\r\n    try {\r\n      const response = await fetch(\"https://v.xiaoxiong.pt/api/get_info\");\r\n      const result = await response.json();\r\n      if (result) {\r\n        setStats({\r\n          order_count: result.order_count || 0,\r\n          reserve_count: result.reserve_count || 0\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch stats:\", error);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    fetchStats();\r\n  }, [fetchStats]);\r\n\r\n  // Pull-to-refresh handler\r\n  const handleRefresh = useCallback(async () => {\r\n    await Promise.all([\r\n      refetchTemplates(),\r\n      fetchStats(),\r\n      queryClient.invalidateQueries({ queryKey: ['restaurants'] }),\r\n      queryClient.invalidateQueries({ queryKey: ['activities'] })\r\n    ]);\r\n  }, [refetchTemplates, fetchStats, queryClient]);\r\n\r\n  // Auto-rotate carousel\r\n  useEffect(() => {\r\n    if (!templates || templates.length <= 1) return;\r\n\r\n    const currentTemplate = templates[currentIndex];\r\n    const duration = currentTemplate?.duration || 5000;\r\n\r\n    timerRef.current = setTimeout(() => {\r\n      setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n    }, duration);\r\n\r\n    return () => {\r\n      if (timerRef.current) clearTimeout(timerRef.current);\r\n    };\r\n  }, [templates, currentIndex]);\r\n\r\n  const goToSlide = useCallback((index: number) => {\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex(index);\r\n  }, []);\r\n\r\n  const goToPrev = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev - 1 + templates.length) % templates.length);\r\n  }, [templates]);\r\n\r\n  const goToNext = useCallback(() => {\r\n    if (!templates) return;\r\n    if (timerRef.current) clearTimeout(timerRef.current);\r\n    setCurrentIndex((prev) => (prev + 1) % templates.length);\r\n  }, [templates]);\r\n\r\n  const currentLang = i18n.language;\r\n  const showControls = templates && templates.length > 1;\r\n\r\n  return (\r\n    <PullToRefresh onRefresh={handleRefresh}>\r\n      <div className=\"min-h-screen\">\r\n        {/* Hero Section - Carousel */}\r\n      <section className=\"relative h-screen flex items-start overflow-hidden bg-background\">\r\n        {/* 统计数据显示 - 左上角 */}\r\n        {stats && <StatsDisplay stats={stats} t={t} />}\r\n\r\n        {/* Carousel Slides */}\r\n        <div className={cn(\r\n          \"absolute inset-0 w-full h-full transition-opacity duration-500\",\r\n          firstSlideReady ? \"opacity-100\" : \"opacity-0\"\r\n        )}>\r\n          {templates?.map((template, index) => (\r\n            <HeroSlide\r\n              key={template.id}\r\n              template={template}\r\n              isActive={index === currentIndex}\r\n              currentLang={currentLang}\r\n              t={t}\r\n              onContentReady={index === 0 ? handleContentReady : undefined}\r\n              onAskXiaoxiong={() => setAskDialogOpen(true)}\r\n            />\r\n          ))}\r\n        </div>\r\n\r\n        {/* Loading state - show skeleton until content is actually ready */}\r\n        <div \r\n          className={cn(\r\n            \"absolute inset-0 w-full h-full z-20 transition-opacity duration-500\",\r\n            (isLoadingTemplates || !firstSlideReady) ? \"opacity-100\" : \"opacity-0 pointer-events-none\"\r\n          )}\r\n        >\r\n          <HomeSkeleton />\r\n        </div>\r\n\r\n        {/* Fallback if no templates (only after loading completes) */}\r\n        {!isLoadingTemplates && (!templates || templates.length === 0) && (\r\n          <div className=\"absolute inset-0 w-full h-full\">\r\n            <img \r\n              src={sushiRamenMobile} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className=\"absolute inset-0 w-full h-full object-cover object-center sm:hidden\"\r\n            />\r\n            <img \r\n              src={sushiRamenHero} \r\n              alt=\"Background\" \r\n              fetchPriority=\"high\"\r\n              loading=\"eager\"\r\n              decoding=\"async\"\r\n              className=\"absolute inset-0 w-full h-full object-cover object-center hidden sm:block\"\r\n            />\r\n            <div className=\"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40\" />\r\n            <div className=\"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen\">\r\n              <div className=\"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full\">\r\n                <h1 className=\"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]\">\r\n                  {t(\"home.hero.title\")}\r\n                </h1>\r\n                <p className=\"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]\">\r\n                  {t(\"home.hero.description\")}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Carousel Controls - Dot Indicators Only */}\r\n        {showControls && (\r\n          <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2\">\r\n            {templates.map((_, index) => (\r\n              <button\r\n                key={index}\r\n                onClick={() => goToSlide(index)}\r\n                className={cn(\r\n                  \"w-3 h-3 rounded-full transition-all duration-300\",\r\n                  index === currentIndex \r\n                    ? \"bg-white w-8\" \r\n                    : \"bg-white/50 hover:bg-white/70\"\r\n                )}\r\n                aria-label={`Go to slide ${index + 1}`}\r\n              />\r\n            ))}\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      {/* Features Section */}\r\n      <section className=\"py-16 sm:py-24 px-4 bg-secondary/20\">\r\n        <div className=\"container mx-auto max-w-6xl\">\r\n          <div className=\"text-center mb-12 sm:mb-16\">\r\n            <h2 className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground mb-3 sm:mb-4\">\r\n              {t(\"home.features.title\")}\r\n            </h2>\r\n            <p className=\"text-base sm:text-lg text-muted-foreground max-w-2xl mx-auto px-4\">\r\n              {t(\"home.features.description\")}\r\n            </p>\r\n          </div>\r\n\r\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 sm:gap-8\">\r\n            <FeatureCard\r\n              to=\"/map\"\r\n              Icon={MapPin}\r\n              title={t(\"home.features.map.title\")}\r\n              desc={t(\"home.features.map.desc\")}\r\n              iconBg=\"bg-gradient-to-br from-primary to-primary-light\"\r\n              iconColor=\"text-primary-foreground\"\r\n              hoverBorderColor=\"hover:border-primary/50\"\r\n            />\r\n            \r\n            <FeatureCard\r\n              to=\"/restaurants\"\r\n              Icon={Star}\r\n              title={t(\"home.features.reviews.title\")}\r\n              desc={t(\"home.features.reviews.desc\")}\r\n              iconBg=\"bg-gradient-to-br from-accent to-warning\"\r\n              iconColor=\"text-accent-foreground\"\r\n              hoverBorderColor=\"hover:border-accent/50\"\r\n            />\r\n            \r\n            <div className=\"sm:col-span-2 md:col-span-1\">\r\n              <FeatureCard\r\n                to=\"/activities\"\r\n                Icon={Calendar}\r\n                title={t(\"home.features.events.title\")}\r\n                desc={t(\"home.features.events.desc\")}\r\n                iconBg=\"bg-gradient-to-br from-success to-accent\"\r\n                iconColor=\"text-white\"\r\n                hoverBorderColor=\"hover:border-success/50\"\r\n              />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* App Download Section - Hidden in WebView/Native App */}\r\n      {!isInWebView() && !isCapacitorApp() && (\r\n      <section className=\"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden\">\r\n        {/* Decorative elements */}\r\n        <div className=\"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl\" />\r\n        <div className=\"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2\" />\r\n        <div className=\"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2\" />\r\n        \r\n        <div className=\"container mx-auto max-w-5xl relative z-10\">\r\n          <div className=\"flex flex-col items-center justify-center gap-8\">\r\n            \r\n            {/* Content */}\r\n            <div className=\"text-center max-w-md\">\r\n              <div className=\"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4\">\r\n                <Smartphone className=\"w-4 h-4\" />\r\n                <span>Mobile App</span>\r\n              </div>\r\n              <h3 className=\"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4\">\r\n                {t(\"home.app.title\")}\r\n              </h3>\r\n              <p className=\"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed\">\r\n                {t(\"home.app.description\")}\r\n              </p>\r\n              <div className=\"flex flex-col items-center gap-4\">\r\n                <div className=\"flex flex-col sm:flex-row items-center justify-center gap-4\">\r\n                  {/* App Store */}\r\n                  <a \r\n                    href=\"https://apps.apple.com/cn/app/xiaoxiong/id6755481369\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={appStoreBadge} \r\n                        alt=\"Download on the App Store\" \r\n                        className=\"h-8 sm:h-9\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                  \r\n                  {/* Google Play */}\r\n                  <a \r\n                    href=\"https://play.google.com/store/apps/details?id=com.xiaoxiong.market\" \r\n                    target=\"_blank\" \r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"relative group\"\r\n                  >\r\n                    <div className=\"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity\" />\r\n                    <div className=\"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center\">\r\n                      <img \r\n                        src={googlePlayBadge} \r\n                        alt=\"Get it on Google Play\" \r\n                        className=\"h-12 sm:h-14\"\r\n                      />\r\n                    </div>\r\n                  </a>\r\n                </div>\r\n                \r\n                {/* Download hint */}\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Download className=\"w-4 h-4 animate-bounce\" />\r\n                  <span>{t(\"home.app.downloadNow\")}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </section>\r\n      )}\r\n\r\n      {/* CTA Section */}\r\n      <section className=\"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden\">\r\n        <div className=\"absolute inset-0 bg-grid-pattern opacity-10\" />\r\n        <div className=\"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl\" />\r\n        <div className=\"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl\" />\r\n        \r\n        <div className=\"container mx-auto max-w-4xl text-center relative z-10\">\r\n          <h2 className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4\">\r\n            {t(\"home.cta.title\")}\r\n          </h2>\r\n          <p className=\"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4\">\r\n            {t(\"home.cta.description\")}\r\n          </p>\r\n          <div className=\"flex justify-center\">\r\n            <Button size=\"lg\" variant=\"secondary\" asChild className=\"text-base sm:text-lg shadow-xl hover:shadow-2xl\">\r\n              <Link to=\"/join-us\">\r\n                <Store className=\"mr-2 w-4 sm:w-5 h-4 sm:h-5\" />\r\n                {t(\"home.cta.button\")}\r\n              </Link>\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </section>\r\n\r\n      {/* Ask Xiaoxiong Dialog */}\r\n      <AskXiaoxiongDialog open={askDialogOpen} onOpenChange={setAskDialogOpen} />\r\n      </div>\r\n    </PullToRefresh>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"names":["googlePlayBadge","appStoreBadge","SUPABASE_URL","SUPABASE_ANON_KEY","AskXiaoxiongDialog","open","onOpenChange","i18n","useTranslation","navigate","useNavigate","settings","useSiteSettings","logoUrl","logoFallback","input","setInput","useState","messages","setMessages","isLoading","setIsLoading","userLocation","setUserLocation","abortControllerRef","useRef","scrollAreaRef","messagesEndRef","useEffect","position","error","handleSubmit","userMessage","assistantMessageId","assistantMessage","prev","response","reader","decoder","accumulatedResult","done","value","chunk","cleanResult","msg","finalResult","err","errorMessage","handleKeyDown","e","handleClose","handleLinkClick","href","parseTextWithLinks","text","linkRegex","parts","lastIndex","match","keyIndex","jsx","linkText","removeBoldMarkers","truncateText","maxLength","renderTable","tableLines","key","parseRow","line","cell","headers","rows","jsxs","header","i","row","rowIndex","cellIndex","renderMarkdown","content","lines","elements","part","idx","getTitle","getPlaceholder","getWelcomeMessage","Dialog","DialogContent","DialogHeader","DialogTitle","ScrollArea","MessageCircle","message","cn","User","Fragment","Loader2","Input","Button","Send","usePullToRefresh","onRefresh","threshold","maxPull","isPulling","setIsPulling","isRefreshing","setIsRefreshing","pullDistance","setPullDistance","startY","currentY","containerRef","handleTouchStart","useCallback","handleTouchMove","diff","distance","handleTouchEnd","container","progress","PullToRefresh","children","className","RefreshCw","sushiRamenHero","sushiRamenMobile","StatsDisplay","memo","stats","t","ShoppingBag","CalendarCheck","mapIcon","FeatureCard","to","Icon","title","desc","iconBg","iconColor","hoverBorderColor","Link","Card","ArrowRight","useLightweightMode","isMobile","isDesktop","connection","cap","isCapacitor","isCapacitorApp","isWebView","isInWebView","isIOS","isIOSDevice","ua","HeroSlide","template","isActive","currentLang","onContentReady","onAskXiaoxiong","postersLoaded","setPostersLoaded","videosReady","setVideosReady","videoErrors","setVideoErrors","imagesLoaded","setImagesLoaded","shouldLoadVideo","setShouldLoadVideo","isLightweight","mobileVideoRef","tabletVideoRef","desktopVideoRef","getLocalizedText","field","getDeviceType","getOverlayOpacity","deviceType","getOverlayStyle","baseOpacity","direction","normalizeOpacity","defaultValue","normalizedBaseOpacity","fromOpacity","viaOpacity","toOpacity","cssDirection","colorMap","fromColor","viaColor","toColor","mobileImg","tabletImg","desktopImg","blurAmount","desktopMediaType","tabletMediaType","mobileMediaType","isDesktopVideo","isTabletVideo","isMobileVideo","mobileVideo","tabletVideo","desktopVideo","currentImage","img","handleVideoCanPlay","device","handleVideoError","video","timer","Search","Calendar","MapPin","Home","queryClient","useQueryClient","templates","isLoadingTemplates","refetchTemplates","useActiveHomepageTemplates","currentIndex","setCurrentIndex","setStats","timerRef","firstSlideReady","setFirstSlideReady","askDialogOpen","setAskDialogOpen","handleContentReady","usePageView","fetchStats","result","handleRefresh","duration","goToSlide","index","showControls","HomeSkeleton","_","Star","Smartphone","Download","Store"],"mappings":"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"}