const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-supabase-BoRSXImz.js","assets/vendor-react-uzPisSBl.js","assets/vendor-i18n-AOdgFpXS.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css"])))=>i.map(i=>d[i]);
import{p as V,j as e,b9 as Re,s as qe,u as Pa,r as x,bU as Aa,bV as Da,M as Ea,bW as Fa,ak as na,w as f,bb as ke,bX as Hs,ba as Cs,y as Ia,bz as Oa,bY as Ta,bZ as $a,b_ as Ra,an as Ue,b$ as Ua,c0 as qa,c1 as He,bc as Pe,a_ as ie,L as T,c2 as Ks,b3 as ne,bE as Rs,c3 as za,bP as La,bT as Ha,aM as Ka,c4 as Qa,bK as _s,bL as Va,c5 as Ss,c6 as Fe,c7 as Se,c8 as Qs,a4 as Ba,c9 as Ma,ca as Wa,aw as Ga,cb as Xa,am as Vs,aK as Ie,q as Ya,cc as Bs,aW as Ms,br as Ws}from"./vendor-react-uzPisSBl.js";import{D as fe,c as je,d as ge,e as ve,B as j,u as Ne,s as S,M as la,a5 as ca,a6 as Za,a0 as oa,h as v,Y as ss,V as ks,W as Ps,X as As,I as C,Z as _,a7 as Xe,a8 as Ye,a9 as Ze,aa as Je,ab as es,A as Z,q as J,r as ee,t as se,v as ae,w as te,x as re,y as X,_ as Ja,a3 as da,C as A,m as q,E as L,n as D,a4 as Q,$ as et,ac as st,U as at,ad as tt,S as ws,a1 as rt,a as it,j as nt,b as lt}from"./index-DMJMYAbQ.js";import{T as Oe,a as Te,b as R,c as U}from"./tabs-C5HgA9MN.js";import{C as ct,a as ot,b as Ke}from"./carousel-BgNhvh63.js";import{a as dt}from"./useActivities-CoqYul82.js";import{u as ts}from"./useLocalizedContent-BCXwZ8Rh.js";import{u as mt}from"./useActivityParticipation-BEjNhDN8.js";import{d as xt}from"./useCoupons--tZb0ryI.js";import{u as pt}from"./useCommunityPosts-ByYZQ9S7.js";import{P as Gs}from"./PostGridCard-B5xDZ2Vp.js";import{u as ht,a as ut,b as ft,c as jt,d as gt,P as Xs}from"./PointsHistoryDialog-4lW6p4Wc.js";import{C as vt}from"./checkbox-CBwknHwT.js";import{A as Ys}from"./ActivityTermsAgreement-DCr4qK19.js";import{S as Ds}from"./separator-iH-RFpyW.js";import{D as oe,N as Nt,O as Qe,H as as,p as yt,I as wt,J as bt}from"./vendor-utils-vwQGbBim.js";import{P as Ct}from"./PullToRefresh-B_sYL4et.js";import{C as _t,a as St,b as kt}from"./collapsible-DtPzkxS0.js";import{u as Pt,a as At,b as Dt,c as Et}from"./useInvitationCodes-Do144PM7.js";import{F as Ft,a as Ve,b as Be,c as Me,d as We,e as Ge}from"./form-uN4GOtAG.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-BoRSXImz.js";import"./useLoginRequired-dq5y9iE8.js";import"./EditRecipeDialog-Qe6tA6HJ.js";import"./drawer-CzD_8Roj.js";import"./popover-91qwUUr3.js";import"./useRestaurants-yW4jMGnJ.js";import"./progress-y4EccLw5.js";import"./usePoints-ZqBrb5ox.js";import"./useActivityRules-DuuT4U4r.js";function It({open:s,onOpenChange:a,activity:r}){const{t}=V();return e.jsx(fe,{open:s,onOpenChange:a,children:e.jsxs(je,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsx(ge,{children:e.jsx(ve,{className:"text-lg font-semibold line-clamp-2",children:r.title})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{variant:"secondary",className:"flex items-center gap-1.5 w-fit",children:[e.jsx(Re,{className:"w-3.5 h-3.5 fill-primary text-primary"}),t("profile.activityFavorited")]}),r.image_url&&e.jsx("div",{className:"w-full aspect-video rounded-lg overflow-hidden bg-secondary/30",children:e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover"})}),e.jsx("div",{className:`text-muted-foreground text-sm prose prose-sm max-w-none line-clamp-4\r
              [&_span[style*='color']]:!text-inherit`,dangerouslySetInnerHTML:{__html:r.content}})]})]})})}const Ot=()=>{const{user:s}=Ne();return qe({queryKey:["favorites-restaurants",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:r}=await S.from("favorites").select("restaurant_id").eq("user_id",s.id);if(r)throw console.error("Error fetching favorites:",r),r;if(!a||a.length===0)return[];const t=a.map(o=>o.restaurant_id),{data:d,error:i}=await S.from("restaurants").select("*").in("id",t).eq("visible",!0);if(i)throw console.error("Error fetching favorite restaurants:",i),i;return d||[]},enabled:!!s})},Tt=()=>{const{user:s}=Ne();return qe({queryKey:["user-comments",s?.id],queryFn:async()=>{if(!s)return[];const{data:a,error:r}=await S.from("comments").select("*").eq("user_id",s.id).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;if(!a||a.length===0)return[];const t=a.filter(n=>n.target_type==="restaurant").map(n=>n.target_id),d=a.filter(n=>n.target_type==="activity").map(n=>n.target_id),i=new Map;if(t.length>0){const{data:n}=await S.from("restaurants").select("id, name, name_en, name_pt").in("id",t);n?.forEach(p=>{i.set(p.id,{name:p.name,name_en:p.name_en||void 0,name_pt:p.name_pt||void 0})})}const o=new Map;if(d.length>0){const{data:n}=await S.from("activities").select("id, title_zh, title_en, title_pt").in("id",d);n?.forEach(p=>{o.set(p.id,{title_zh:p.title_zh,title_en:p.title_en,title_pt:p.title_pt})})}return a.map(n=>{if(n.target_type==="restaurant"){const p=i.get(n.target_id);return{...n,target_name:p?.name||"Unknown Restaurant",target_name_en:p?.name_en,target_name_pt:p?.name_pt}}else if(n.target_type==="activity"){const p=o.get(n.target_id);return{...n,target_name:p?.title_zh||"Unknown Activity",target_name_en:p?.title_en,target_name_pt:p?.title_pt}}return n})},enabled:!!s,staleTime:3e4})},$t=()=>{const{user:s}=Ne(),{data:a=[]}=mt();return qe({queryKey:["merchantActivities",s?.id],queryFn:async()=>{if(!s||a.length===0)return[];const r=a.map(l=>l.id),{data:t,error:d}=await S.from("activity_restaurants").select("*").in("restaurant_id",r).order("created_at",{ascending:!1});if(d)throw d;if(!t||t.length===0)return[];const{data:i}=await S.from("restaurants").select("id, name, name_en, name_pt, address").in("id",r),o=[...new Set(t.map(l=>l.activity_id))],{data:n}=await S.from("activities").select("*").in("id",o).eq("status","published");return t.map(l=>{const u=i?.find(E=>E.id===l.restaurant_id),b=n?.find(E=>E.id===l.activity_id);return{activity_id:l.activity_id,restaurant_id:l.restaurant_id,restaurant_name:u?.name||"",restaurant_name_en:u?.name_en||null,restaurant_name_pt:u?.name_pt||null,restaurant_address:u?.address||"",activity:b||null,created_at:l.created_at}}).filter(l=>l.activity!==null)},enabled:!!s&&a.length>0})},ma=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Zs=s=>{if(!s)return{code:"+351",number:""};for(const a of ma)if(s.startsWith(a.code))return{code:a.code,number:s.slice(a.code.length).trim()};return{code:"+351",number:s}},Js=({profile:s})=>{const{t:a}=V(),r=Pa(),{user:t}=Ne(),{isAdmin:d}=la(),[i,o]=x.useState(!1),[n,p]=x.useState(s.display_name),l=Zs(s.phone),[u,b]=x.useState(l.code),[E,O]=x.useState(l.number),[B,y]=x.useState(!1),[H,F]=x.useState(null),[k,de]=x.useState(s.avatar_url||""),[ye,I]=x.useState(!1),[we,z]=x.useState(!1),[$,P]=x.useState(""),[M,be]=x.useState(!1),Ae=x.useRef(!1);x.useEffect(()=>{const c=Ae.current;if(Ae.current=i,i&&!c){p(s.display_name);const h=Zs(s.phone);b(h.code),O(h.number),de(s.avatar_url||""),F(null),y(!1)}},[i,s.display_name,s.phone,s.avatar_url]);const[rs,me]=x.useState(!1),[is,le]=x.useState(!1),[ze,xe]=x.useState(!1),[W,w]=x.useState(""),[Ce,pe]=x.useState(""),[m,g]=x.useState(""),[N,K]=x.useState(!1),[he,Le]=x.useState(!1),[Us,ns]=x.useState(!1),[xa,De]=x.useState(!1),[pa,Ee]=x.useState(!1),[ls,cs]=x.useState(""),[Y,os]=x.useState(""),[ue,ds]=x.useState(""),[qs,ms]=x.useState(!1),[xs,ps]=x.useState(""),[_e,hs]=x.useState(!1),[zs,Ls]=x.useState(!1),[G,us]=x.useState(null),fs=x.useRef(null),js=x.useRef(null),gs=x.useRef(null),vs=ca(),Ns=Za();x.useEffect(()=>{N&&fs.current&&fs.current.focus()},[N]),x.useEffect(()=>{he&&js.current&&js.current.focus()},[he]),x.useEffect(()=>{_e&&gs.current&&gs.current.focus()},[_e]);const ha=c=>{const h=c.target.files?.[0];if(h){if(h.size>2*1024*1024)return;F(h),de(URL.createObjectURL(h))}},ua=async()=>{let c=s.avatar_url;if(H){const ce=await Ns.mutateAsync(H);ce&&(c=ce)}const h=E?`${u} ${E}`:void 0;await vs.mutateAsync({display_name:n,phone:h,avatar_url:c||void 0}),y(!1),o(!1)},fa=async()=>{if(!(!t||$.toLowerCase()!=="delete")){be(!0);try{const{error:c}=await S.functions.invoke("delete-account",{body:{userId:t.id}});if(c){f.error(a("profile.deleteAccountFailed")),console.error(c),be(!1);return}f.success(a("profile.deleteAccountSuccess")),z(!1),I(!1),P(""),await new Promise(h=>setTimeout(h,1500)),await S.auth.signOut(),r("/auth")}catch(c){f.error(c.message||a("profile.deleteAccountFailed")),be(!1)}finally{be(!1)}}},ja=async()=>{if(t?.email)try{const{error:c}=await S.functions.invoke("send-verification-code",{body:{email:t.email}});if(c)throw c;K(!0),f.success(a("profile.codeSentToOldEmail"))}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},ga=async()=>{if(!Ce){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:c,error:h}=await S.functions.invoke("verify-email-code",{body:{email:t?.email,code:Ce}});if(h||!c?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.oldEmailVerified")),me(!1),le(!0)}catch(c){f.error(a("profile.verificationFailed")),console.error(c)}},va=async()=>{if(!W||!W.includes("@")){f.error(a("profile.enterValidEmail"));return}try{const{error:c}=await S.functions.invoke("send-verification-code",{body:{email:W}});if(c)throw c;f.success(a("profile.codeSentToNewEmail")),Le(!0)}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},Na=async()=>{if(!m){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:c,error:h}=await S.functions.invoke("verify-email-code",{body:{email:W,code:m}});if(h||!c?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.newEmailVerified")),le(!1),setTimeout(()=>{xe(!0)},100)}catch(c){f.error(a("toast.verificationFailed")),console.error(c)}},ya=async()=>{ns(!0);try{const{data:{session:c}}=await S.auth.getSession();if(!c||!t){f.error(a("toast.pleaseSignIn")),ns(!1);return}const{data:h,error:ce}=await S.functions.invoke("update-email",{body:{userId:t.id,oldEmail:t.email,oldEmailCode:Ce,newEmail:W,newEmailCode:m},headers:{Authorization:`Bearer ${c.access_token}`}});if(ce||!h?.success)throw new Error(h?.error||"Failed to update email");f.success(a("toast.emailUpdatedSuccess")),xe(!1),o(!1),pe(""),w(""),g(""),K(!1),Le(!1),await new Promise(ys=>setTimeout(ys,1500)),await S.auth.signOut(),r("/auth")}catch(c){f.error(c.message||a("toast.emailUpdateError")),console.error(c)}finally{ns(!1)}},wa=c=>{let h=0;return c.length>=6&&h++,c.length>=8&&h++,/[a-z]/.test(c)&&h++,/[A-Z]/.test(c)&&h++,/[0-9]/.test(c)&&h++,/[^a-zA-Z0-9]/.test(c)&&h++,h<=2?"weak":h<=4?"medium":"strong"},ba=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!ls){f.error(a("profile.enterCurrentPassword"));return}try{const{createClient:h}=await Ja(async()=>{const{createClient:ka}=await import("./vendor-supabase-BoRSXImz.js");return{createClient:ka}},__vite__mapDeps([0,1,2,3,4,5])),ce=h("https://tzdgqhwyzsxkxnncgzap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",{auth:{persistSession:!1,autoRefreshToken:!1}}),{error:ys}=await ce.auth.signInWithPassword({email:t?.email||"",password:ls});if(ys){f.error(a("profile.oldPasswordIncorrect"));return}f.success(a("profile.oldPasswordVerified")),De(!1),Ee(!0)}catch(h){f.error(a("profile.verificationFailed")),console.error(h)}},Ca=async()=>{if(t?.email)try{const{error:c}=await S.functions.invoke("send-verification-code",{body:{email:t.email}});if(c)throw c;hs(!0),f.success(a("profile.codeSentToOldEmail"))}catch(c){f.error(a("profile.sendCodeFailed")),console.error(c)}},_a=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!xs){f.error(a("profile.enterCodePlaceholder"));return}try{const{data:h,error:ce}=await S.functions.invoke("verify-email-code",{body:{email:t?.email,code:xs}});if(ce||!h?.success){f.error(a("profile.codeIncorrect"));return}f.success(a("profile.oldEmailVerified")),De(!1),Ee(!0)}catch(h){f.error(a("profile.verificationFailed")),console.error(h)}},Sa=async c=>{if(c?.preventDefault(),c?.stopPropagation(),!Y||!ue){f.error(a("profile.enterNewPassword"));return}if(Y.length<6){f.error(a("profile.passwordTooShort"));return}if(Y!==ue){f.error(a("profile.passwordsDontMatch"));return}Ls(!0);try{const{error:h}=await S.auth.updateUser({password:Y});if(h)throw h;f.success(a("profile.passwordUpdated")),Ee(!1),o(!1),cs(""),os(""),ds(""),ms(!1),ps(""),hs(!1)}catch(h){f.error(h.message||a("profile.passwordUpdateFailed")),console.error(h)}finally{Ls(!1)}};return e.jsxs(fe,{open:i,onOpenChange:o,children:[e.jsx(oa,{asChild:!0,children:e.jsxs(v,{variant:"outline",children:[e.jsx(Aa,{className:"w-4 h-4 mr-2"}),a("profile.editProfile")]})}),e.jsxs(je,{className:"max-w-[90vw] sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ge,{children:[e.jsx(ve,{children:a("profile.editProfile")}),e.jsx(ss,{children:a("profile.editProfileDescription")})]}),e.jsxs("div",{className:"space-y-3 py-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs(ks,{className:"w-16 h-16 sm:w-24 sm:h-24",children:[e.jsx(Ps,{src:k}),e.jsx(As,{children:n?.charAt(0).toUpperCase()})]}),e.jsxs("div",{children:[e.jsx(C,{type:"file",accept:"image/*",onChange:ha,className:"hidden",id:"avatar-upload"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>document.getElementById("avatar-upload")?.click(),className:"text-xs sm:text-sm",children:[e.jsx(Da,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.uploadAvatar")]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"displayName",className:"text-sm",children:a("profile.displayName")}),e.jsx(C,{id:"displayName",value:n,onChange:c=>p(c.target.value),placeholder:a("profile.displayName"),className:"h-9"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(_,{htmlFor:"phone",className:"text-sm",children:a("profile.phone")}),!s.phone&&!B?e.jsx(v,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"w-full justify-start h-9",children:a("profile.addPhoneNumber")}):B||!s.phone?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Xe,{value:u,onValueChange:b,children:[e.jsx(Ye,{className:"w-[110px] h-9",children:e.jsx(Ze,{placeholder:"+351"})}),e.jsx(Je,{children:ma.map(c=>e.jsx(es,{value:c.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.flag}),e.jsx("span",{children:c.code})]})},c.code))})]}),e.jsx(C,{id:"phone",className:"flex-1 h-9",value:E,onChange:c=>O(c.target.value),placeholder:a("profile.phonePlaceholder")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{value:`${u} ${E}`,disabled:!0,className:"h-9 flex-1"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>y(!0),className:"text-xs whitespace-nowrap",children:a("profile.modifyPhoneNumber")})]})]}),!d&&e.jsxs("div",{className:"space-y-1.5 pt-2 border-t",children:[e.jsx(_,{className:"text-sm",children:a("profile.email")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{value:t?.email||"",disabled:!0,className:"h-9 flex-1"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>me(!0),className:"text-xs",children:[e.jsx(Ea,{className:"w-3 h-3 mr-1"}),a("profile.modify")]})]})]}),e.jsxs("div",{className:`space-y-1.5 ${d?"pt-2 border-t":""}`,children:[e.jsx(_,{className:"text-sm",children:a("profile.changePassword")}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>De(!0),className:"w-full justify-start h-9",children:[e.jsx(Fa,{className:"w-3 h-3 mr-2"}),a("profile.changePassword")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 pt-2 border-t",children:[!d&&e.jsxs(v,{variant:"destructive",size:"sm",onClick:()=>I(!0),className:"w-full sm:w-auto text-xs sm:text-sm",children:[e.jsx(na,{className:"w-3 h-3 sm:w-4 sm:h-4 mr-1 sm:mr-2"}),a("profile.deleteAccount")]}),e.jsxs("div",{className:`flex gap-2 w-full sm:w-auto ${d?"sm:ml-auto":""}`,children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{y(!1),o(!1)},className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:a("common.cancel")}),e.jsx(v,{size:"sm",onClick:ua,disabled:vs.isPending||Ns.isPending,className:"flex-1 sm:flex-none sm:min-w-[80px] text-xs sm:text-sm",children:vs.isPending||Ns.isPending?a("common.loading"):a("common.save")})]})]})]}),e.jsx(Z,{open:ye,onOpenChange:I,children:e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.deleteAccountWarning")}),e.jsx(ae,{children:a("profile.deleteAccountDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{children:a("common.cancel")}),e.jsx(X,{onClick:()=>{I(!1),z(!0)},className:"bg-destructive hover:bg-destructive/90",children:a("common.continue")})]})]})}),e.jsx(Z,{open:we,onOpenChange:z,children:e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.confirmDeleteAccount")}),e.jsxs(ae,{className:"space-y-4",children:[e.jsx("p",{children:a("profile.confirmDeleteDescription")}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"confirm-delete",children:a("profile.typeDeleteToConfirm")}),e.jsx(C,{id:"confirm-delete",value:$,onChange:c=>P(c.target.value),placeholder:"DELETE",className:"uppercase"})]})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>P(""),children:a("common.cancel")}),e.jsx(X,{onClick:fa,disabled:$.toLowerCase()!=="delete"||M,className:"bg-destructive hover:bg-destructive/90",children:a(M?"common.loading":"profile.deleteAccount")})]})]})}),e.jsx(Z,{open:rs,onOpenChange:me,children:e.jsxs(J,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.verifyOldEmail")}),e.jsx(ae,{children:a("profile.oldEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(v,{variant:"outline",size:"sm",onClick:ja,disabled:N,children:a(N?"profile.codeSent":"profile.sendCode")})]})]}),N&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.verificationCode")}),e.jsx(C,{ref:fs,value:Ce,onChange:c=>pe(c.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{me(!1),setTimeout(()=>{pe(""),K(!1)},300)},children:a("common.cancel")}),N&&e.jsx(X,{onClick:ga,children:a("profile.verify")})]})]})}),e.jsx(Z,{open:is,onOpenChange:le,children:e.jsxs(J,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{className:"text-center space-y-3",children:[e.jsx(se,{className:"text-xl",children:a("profile.verifyNewEmail")}),e.jsx(ae,{className:"text-center",children:a("profile.newEmailStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"text-sm font-normal",children:a("profile.newEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{type:"email",value:W,onChange:c=>w(c.target.value),placeholder:a("profile.enterNewEmail"),disabled:he,className:"border-2 focus:border-primary flex-1"}),e.jsx(v,{variant:"outline",size:"sm",onClick:va,disabled:!W||he,className:"text-xs whitespace-nowrap px-3",children:a(he?"profile.codeSent":"profile.sendCode")})]})]}),he&&e.jsxs("div",{className:"space-y-2 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx(_,{className:"text-sm font-normal",children:a("profile.verificationCode")}),e.jsx(C,{ref:js,value:m,onChange:c=>g(c.target.value),placeholder:a("profile.enterCode"),maxLength:4,className:"border-2 focus:border-primary"})]})]}),e.jsxs(te,{className:"flex-col sm:flex-col gap-2",children:[he&&e.jsx(X,{onClick:Na,disabled:!m||m.length!==4,className:"w-full bg-primary hover:bg-primary/90",children:"ç¡®è®¤éªŒè¯ç "}),e.jsx(re,{onClick:()=>{le(!1),setTimeout(()=>{w(""),g(""),Le(!1)},300)},className:"w-full mt-0",children:"å–æ¶ˆ"})]})]})}),e.jsx(Z,{open:ze,onOpenChange:xe,children:e.jsxs(J,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:"ç¡®è®¤ä¿®æ”¹é‚®ç®±"}),e.jsx(ae,{children:"æ­¥éª¤ 3/3: æ‰€æœ‰éªŒè¯å·²å®Œæˆ"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"rounded-lg bg-green-50 dark:bg-green-950 p-4 text-sm",children:[e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:"éªŒè¯å®Œæˆï¼"}),e.jsx("p",{className:"text-green-700 dark:text-green-300 mt-1",children:'æ—§é‚®ç®±å’Œæ–°é‚®ç®±éƒ½å·²éªŒè¯æˆåŠŸï¼Œç‚¹å‡»"ç¡®è®¤ä¿®æ”¹"å®Œæˆé‚®ç®±æ›´æ–°ã€‚'})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"å½“å‰é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"æ–°é‚®ç®±:"}),e.jsx("span",{className:"font-medium",children:W})]})]})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{xe(!1),setTimeout(()=>{pe(""),w(""),g(""),K(!1),Le(!1)},300)},children:"å–æ¶ˆ"}),e.jsx(X,{onClick:ya,disabled:Us,children:Us?"æ›´æ–°ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})}),e.jsx(Z,{open:xa,onOpenChange:De,children:e.jsxs(J,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.verifyOldPassword")}),e.jsx(ae,{children:a("profile.oldPasswordStep")})]}),e.jsx("div",{className:"space-y-4 py-4",children:qs?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.currentEmail")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(C,{value:t?.email||"",disabled:!0,className:"flex-1"}),e.jsx(v,{variant:"outline",size:"sm",onClick:Ca,disabled:_e,children:a(_e?"profile.codeSent":"profile.sendCode")})]})]}),_e&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.verificationCode")}),e.jsx(C,{ref:gs,value:xs,onChange:c=>ps(c.target.value),placeholder:a("profile.enterCode"),maxLength:4})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.currentPassword")}),e.jsx(C,{type:"password",value:ls,onChange:c=>cs(c.target.value),placeholder:a("profile.enterCurrentPassword")})]}),e.jsxs(v,{variant:"link",size:"sm",onClick:()=>ms(!0),className:"text-xs p-0 h-auto",children:[a("profile.forgotPassword")," ",a("profile.useEmailVerification")]})]})}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{De(!1),setTimeout(()=>{cs(""),ms(!1),ps(""),hs(!1)},300)},children:a("common.cancel")}),qs?_e&&e.jsx(X,{onClick:_a,children:a("profile.verify")}):e.jsx(X,{onClick:ba,children:a("profile.verify")})]})]})}),e.jsx(Z,{open:pa,onOpenChange:Ee,children:e.jsxs(J,{className:"max-w-[90vw] sm:max-w-md",children:[e.jsxs(ee,{children:[e.jsx(se,{children:a("profile.setNewPassword")}),e.jsx(ae,{children:a("profile.newPasswordStep")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.newPassword")}),e.jsx(C,{type:"password",value:Y,onChange:c=>{os(c.target.value),c.target.value?us(wa(c.target.value)):us(null)},placeholder:a("profile.enterNewPassword")}),G&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${G==="weak"?"bg-destructive":G==="medium"?"bg-warning":"bg-success"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${G==="medium"||G==="strong"?G==="medium"?"bg-warning":"bg-success":"bg-muted"}`}),e.jsx("div",{className:`h-1.5 flex-1 rounded-full transition-colors ${G==="strong"?"bg-success":"bg-muted"}`})]}),e.jsx("p",{className:`text-xs ${G==="weak"?"text-destructive":G==="medium"?"text-warning":"text-success"}`,children:a(`auth.passwordStrength.${G}`)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{children:a("profile.confirmNewPassword")}),e.jsx(C,{type:"password",value:ue,onChange:c=>ds(c.target.value),placeholder:a("profile.confirmNewPasswordPlaceholder")})]}),Y&&ue&&Y!==ue&&e.jsx("p",{className:"text-sm text-destructive",children:a("profile.passwordsDontMatch")})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:()=>{Ee(!1),setTimeout(()=>{os(""),ds(""),us(null)},300)},children:a("common.cancel")}),e.jsx(X,{onClick:Sa,disabled:!Y||!ue||Y!==ue||zs,children:a(zs?"common.loading":"profile.updatePassword")})]})]})})]})},Es=[{value:"Home",icon:Ta,labelKey:"address.labelHome"},{value:"Work",icon:$a,labelKey:"address.labelWork"},{value:"Office",icon:Ra,labelKey:"address.labelOffice"},{value:"Other",icon:ke,labelKey:"address.labelOther"}],Rt=[{code:"+351",country:"Portugal",flag:"ðŸ‡µðŸ‡¹"},{code:"+34",country:"Spain",flag:"ðŸ‡ªðŸ‡¸"},{code:"+33",country:"France",flag:"ðŸ‡«ðŸ‡·"},{code:"+49",country:"Germany",flag:"ðŸ‡©ðŸ‡ª"},{code:"+39",country:"Italy",flag:"ðŸ‡®ðŸ‡¹"},{code:"+44",country:"UK",flag:"ðŸ‡¬ðŸ‡§"},{code:"+31",country:"Netherlands",flag:"ðŸ‡³ðŸ‡±"},{code:"+32",country:"Belgium",flag:"ðŸ‡§ðŸ‡ª"},{code:"+86",country:"China",flag:"ðŸ‡¨ðŸ‡³"},{code:"+1",country:"USA/Canada",flag:"ðŸ‡ºðŸ‡¸"},{code:"+55",country:"Brazil",flag:"ðŸ‡§ðŸ‡·"}],Ut=["Portugal","Spain","France","Germany","Italy","United Kingdom","Netherlands","Belgium","China","Other"],ea=({initialData:s,onSubmit:a,onCancel:r,isLoading:t,isEdit:d})=>{const{t:i}=V(),[o,n]=x.useState({label:s?.label||"Home",street:s?.street||"",district:s?.district||"",city:s?.city||"",postal_code:s?.postal_code||"",country:s?.country||"Portugal",phone:s?.phone||"",phone_code:s?.phone_code||"+351",is_default:s?.is_default||!1}),p=l=>{l.preventDefault(),a(o)};return e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"label",children:i("address.label")}),e.jsxs(Xe,{value:o.label,onValueChange:l=>n({...o,label:l}),children:[e.jsx(Ye,{children:e.jsx(Ze,{placeholder:i("address.selectLabel")})}),e.jsx(Je,{children:Es.map(l=>e.jsx(es,{value:l.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l.icon,{className:"w-4 h-4"}),i(l.labelKey)]})},l.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"street",children:[i("address.street")," *"]}),e.jsx(C,{id:"street",value:o.street,onChange:l=>n({...o,street:l.target.value}),placeholder:i("address.streetPlaceholder"),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"district",children:i("address.district")}),e.jsx(C,{id:"district",value:o.district,onChange:l=>n({...o,district:l.target.value}),placeholder:i("address.districtPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"city",children:[i("address.city")," *"]}),e.jsx(C,{id:"city",value:o.city,onChange:l=>n({...o,city:l.target.value}),placeholder:i("address.cityPlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"postal_code",children:[i("address.postalCode")," *"]}),e.jsx(C,{id:"postal_code",value:o.postal_code,onChange:l=>n({...o,postal_code:l.target.value}),placeholder:i("address.postalCodePlaceholder"),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"country",children:[i("address.country")," *"]}),e.jsxs(Xe,{value:o.country,onValueChange:l=>n({...o,country:l}),children:[e.jsx(Ye,{children:e.jsx(Ze,{placeholder:i("address.selectCountry")})}),e.jsx(Je,{children:Ut.map(l=>e.jsx(es,{value:l,children:l},l))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{htmlFor:"phone",children:[i("address.phone")," *"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Xe,{value:o.phone_code,onValueChange:l=>n({...o,phone_code:l}),children:[e.jsx(Ye,{className:"w-[130px]",children:e.jsx(Ze,{placeholder:"+351"})}),e.jsx(Je,{children:Rt.map(l=>e.jsx(es,{value:l.code,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:l.flag}),e.jsx("span",{children:l.code})]})},l.code))})]}),e.jsx(C,{id:"phone",className:"flex-1",value:o.phone,onChange:l=>n({...o,phone:l.target.value}),placeholder:i("address.phonePlaceholder"),required:!0})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vt,{id:"is_default",checked:o.is_default,onCheckedChange:l=>n({...o,is_default:l})}),e.jsx(_,{htmlFor:"is_default",className:"text-sm font-normal cursor-pointer",children:i("address.setAsDefault")})]}),e.jsxs(et,{className:"gap-2 sm:gap-0",children:[e.jsx(v,{type:"button",variant:"outline",onClick:r,children:i("common.cancel")}),e.jsx(v,{type:"submit",disabled:t,children:i(t?"common.saving":d?"common.save":"address.add")})]})]})},qt=({address:s,onEdit:a,onDelete:r,onSetDefault:t,isDeleting:d,isSettingDefault:i,canDelete:o=!0})=>{const{t:n}=V(),p=Es.find(u=>u.value===s.label)||Es[3],l=p.icon;return e.jsx("div",{className:`p-4 border rounded-lg hover:shadow-medium transition-shadow relative ${s.is_default?"bg-primary/5 border-primary/20":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`p-2 rounded-full ${s.is_default?"bg-primary/20":"bg-primary/10"}`,children:e.jsx(l,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-foreground",children:n(p.labelKey)}),s.is_default&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:[e.jsx(Cs,{className:"w-3 h-3 mr-1 fill-current"}),n("address.default")]})]}),e.jsxs("p",{className:"text-sm text-foreground",children:[s.street,s.district&&`, ${s.district}`]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:[s.postal_code,s.city,s.country].filter(Boolean).join(", ")}),s.phone&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Ia,{className:"w-3 h-3"}),s.phone_code," ",s.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[!s.is_default&&e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>t(s.id),disabled:i,title:n("address.setAsDefault"),children:e.jsx(Cs,{className:"w-4 h-4"})}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>a(s),title:n("common.edit"),children:e.jsx(Oa,{className:"w-4 h-4"})}),o&&e.jsxs(Z,{children:[e.jsx(st,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",title:n("common.delete"),children:e.jsx(na,{className:"w-4 h-4"})})}),e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:n("address.deleteTitle")}),e.jsx(ae,{children:n("address.deleteDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{children:n("common.cancel")}),e.jsx(X,{onClick:()=>r(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:d,children:n(d?"common.deleting":"common.delete")})]})]})]})]})]})})},sa=()=>{const{t:s}=V(),{data:a,isLoading:r}=ht(),{data:t}=da(),d=ut(),i=ft(),o=ca(),n=jt(),p=gt(),[l,u]=x.useState(!1),[b,E]=x.useState(null),[O,B]=x.useState(null),[y,H]=x.useState(!1),F=!t?.phone,k=P=>{if(F&&P.phone){B(P),H(!0);return}d.mutate(P,{onSuccess:()=>u(!1)})},de=()=>{if(!O)return;const P=`${O.phone_code||"+351"} ${O.phone}`;o.mutate({phone:P}),d.mutate(O,{onSuccess:()=>{u(!1),B(null),H(!1)}})},ye=()=>{B(null),H(!1)},I=P=>{b&&i.mutate({id:b.id,address:P},{onSuccess:()=>E(null)})},we=P=>{n.mutate(P)},z=P=>{p.mutate(P)};if(r)return e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5"}),s("address.myAddresses")]})}),e.jsx(D,{children:e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:s("common.loading")})})]});const $=a&&a.length>0;return e.jsxs(A,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"space-y-1.5 min-w-0 flex-1",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 flex-shrink-0"}),s("address.myAddresses")]}),e.jsx(Q,{className:"text-xs text-primary",children:s("address.manageDescription")})]}),$&&e.jsxs(fe,{open:l,onOpenChange:u,children:[e.jsx(oa,{asChild:!0,children:e.jsxs(v,{size:"sm",className:"w-full sm:w-auto flex-shrink-0",children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:s("address.addNew")})]})}),e.jsxs(je,{className:"sm:max-w-[500px]",children:[e.jsxs(ge,{children:[e.jsx(ve,{children:s("address.addNew")}),e.jsx(ss,{children:s("address.addDescription")})]}),e.jsx(ea,{onSubmit:k,onCancel:()=>u(!1),isLoading:d.isPending})]})]})]})}),e.jsx(D,{children:$?e.jsx("div",{className:"space-y-4",children:a.map(P=>e.jsx(qt,{address:P,onEdit:E,onDelete:we,onSetDefault:z,isDeleting:n.isPending,isSettingDefault:p.isPending,canDelete:a.length>1},P.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto text-muted-foreground/50 mb-4"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:s("address.noAddresses")}),e.jsxs(v,{onClick:()=>u(!0),children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),s("address.addFirst")]})]})}),e.jsx(fe,{open:!!b,onOpenChange:()=>E(null),children:e.jsxs(je,{className:"sm:max-w-[500px]",children:[e.jsxs(ge,{children:[e.jsx(ve,{children:s("address.editAddress")}),e.jsx(ss,{children:s("address.editDescription")})]}),b&&e.jsx(ea,{initialData:b,onSubmit:I,onCancel:()=>E(null),isLoading:i.isPending,isEdit:!0})]})}),e.jsx(Z,{open:y,onOpenChange:H,children:e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:s("address.phoneConfirmTitle")}),e.jsx(ae,{children:s("address.phoneConfirmDescription")})]}),e.jsxs(te,{children:[e.jsx(re,{onClick:ye,children:s("common.cancel")}),e.jsx(X,{onClick:de,disabled:d.isPending||o.isPending,children:d.isPending||o.isPending?s("common.saving"):s("common.confirm")})]})]})})]})},zt=({open:s,onOpenChange:a,coupon:r})=>{const{t}=V(),{getLocalizedField:d}=ts(),[i,o]=x.useState(!1),n=r.coupon_codes?.coupon_templates,p=r.coupon_codes?.code,l=!!r.used_at;return e.jsx(fe,{open:s,onOpenChange:u=>{a(u),u||o(!1)},children:e.jsxs(je,{className:"max-w-lg max-h-[90vh]",children:[e.jsx(ge,{children:e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),t("profile.coupons.details")]})}),e.jsx(at,{className:"max-h-[70vh] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:d(n,"title")}),e.jsx(j,{variant:l?"secondary":"default",children:t(l?"profile.coupons.used":"profile.coupons.available")})]}),n?.description_zh||n?.description_en||n?.description_pt?e.jsx("p",{className:"text-muted-foreground text-sm",children:d(n,"description")}):null]}),e.jsx(Ds,{}),e.jsx("div",{className:"bg-secondary/30 p-4 rounded-lg cursor-pointer hover:bg-secondary/50 transition-colors",onClick:()=>o(!i),children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg",children:e.jsx(Ua,{value:p||"",size:140,level:"M",includeMargin:!1})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t("profile.coupons.tapToHideQr")})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-mono font-bold tracking-wider",children:p}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(qa,{className:"w-4 h-4"}),e.jsx("p",{className:"text-xs",children:t("profile.coupons.tapToShowQr")})]})]})})}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-primary/10 rounded-lg",children:[e.jsx(He,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.discount")}),e.jsx("p",{className:"text-xl font-bold text-primary",children:n?.discount_type==="percentage"?`${n?.discount_value}% OFF`:`â‚¬${n?.discount_value}`})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.claimedAt")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:oe(new Date(r.claimed_at),"yyyy-MM-dd HH:mm")})]})]}),l&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.usedOn")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:oe(new Date(r.used_at),"yyyy-MM-dd HH:mm")})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ie,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.validity")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n?.valid_until?`${oe(new Date(n.valid_from),"yyyy-MM-dd")} - ${oe(new Date(n.valid_until),"yyyy-MM-dd")}`:t("profile.coupons.noExpiry")})]})]}),n?.min_order_amount&&n.min_order_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(He,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.minOrder")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.min_order_amount]})]})]}),n?.max_discount_amount&&n.max_discount_amount>0&&e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(He,{className:"w-5 h-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t("profile.coupons.maxDiscount")}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["â‚¬",n.max_discount_amount]})]})]}),e.jsx(Ds,{}),r.activity_id&&r.source==="share"&&e.jsxs(T,{to:`/activity/${r.activity_id}`,className:"flex items-center justify-center gap-2 p-3 rounded-lg border hover:shadow-md transition-all hover:border-primary",children:[e.jsx(He,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[t("profile.coupons.source"),": ",t("profile.coupons.fromSharing")]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",t("profile.coupons.viewActivity"),")"]})]})]})})]})})},Lt=()=>{const{user:s}=Ne();return qe({queryKey:["bookingRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:r}=await S.from("booking_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("booking_date",{ascending:!1});if(r)throw r;return a},enabled:!!s?.email})},Ht=()=>{const{user:s}=Ne();return qe({queryKey:["deliveryRecords",s?.email],queryFn:async()=>{if(!s?.email)return[];const{data:a,error:r}=await S.from("delivery_records").select(`
          *,
          restaurants (
            name,
            name_en,
            name_pt,
            image_url
          )
        `).order("order_date",{ascending:!1});if(r)throw r;return a},enabled:!!s?.email})},aa=()=>{const{t:s}=V(),{data:a,isLoading:r}=Lt(),{getLocalizedField:t}=ts(),d=i=>{switch(i){case"confirmed":return e.jsx(j,{className:"bg-green-500",children:s("booking.status.confirmed")});case"pending":return e.jsx(j,{variant:"secondary",children:s("booking.status.pending")});case"cancelled":return e.jsx(j,{variant:"destructive",children:s("booking.status.cancelled")});case"completed":return e.jsx(j,{className:"bg-blue-500",children:s("booking.status.completed")});default:return e.jsx(j,{variant:"outline",children:i})}};return e.jsxs(A,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ks,{className:"w-5 h-5"}),s("profile.bookingRecords.title")]}),e.jsx(Q,{className:"text-xs",children:s("profile.bookingRecords.description")})]}),e.jsx(D,{className:"px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(i=>{const o=i.restaurants?t(i.restaurants,"name"):i.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:i.restaurant_id?e.jsxs(T,{to:`/restaurant/${i.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]})}),d(i.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ks,{className:"w-3 h-3"}),oe(new Date(i.booking_date),"yyyy-MM-dd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-3 h-3"}),i.booking_time.slice(0,5)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Rs,{className:"w-3 h-3"}),i.party_size," ",s("booking.people")]})]}),i.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:i.notes})]},i.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.bookingRecords.noRecords")})})]})},ta=()=>{const{t:s}=V(),{data:a,isLoading:r}=Ht(),{getLocalizedField:t}=ts(),d=i=>{switch(i){case"completed":return e.jsx(j,{className:"bg-green-500",children:s("delivery.status.completed")});case"pending":return e.jsx(j,{variant:"secondary",children:s("delivery.status.pending")});case"cancelled":return e.jsx(j,{variant:"destructive",children:s("delivery.status.cancelled")});case"delivering":return e.jsx(j,{className:"bg-blue-500",children:s("delivery.status.delivering")});default:return e.jsx(j,{variant:"outline",children:i})}};return e.jsxs(A,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(za,{className:"w-5 h-5"}),s("profile.deliveryRecords.title")]}),e.jsx(Q,{className:"text-xs",children:s("profile.deliveryRecords.description")})]}),e.jsx(D,{className:"px-3",children:r?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):a&&a.length>0?e.jsx("div",{className:"space-y-3",children:a.map(i=>{const o=i.restaurants?t(i.restaurants,"name"):i.restaurant_name;return e.jsxs("div",{className:"p-3 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsx("div",{className:"flex-1",children:i.restaurant_id?e.jsxs(T,{to:`/restaurant/${i.restaurant_id}`,className:"font-semibold text-sm hover:text-primary transition-colors",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]}):e.jsxs("span",{className:"font-semibold text-sm",children:[e.jsx(ne,{className:"w-4 h-4 inline mr-1"}),o]})}),d(i.status)]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-muted-foreground mb-2",children:[e.jsx("span",{children:oe(new Date(i.order_date),"yyyy-MM-dd HH:mm")}),i.total_amount&&e.jsxs("span",{className:"font-medium text-foreground",children:["â‚¬",i.total_amount.toFixed(2)]})]}),i.delivery_address&&e.jsxs("p",{className:"text-xs text-muted-foreground flex items-start gap-1",children:[e.jsx(ke,{className:"w-3 h-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-1",children:i.delivery_address})]}),i.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:i.notes})]},i.id)})}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.deliveryRecords.noRecords")})})]})},Kt=Nt({full_name:Qe().min(2,"å§“åè‡³å°‘2ä¸ªå­—ç¬¦"),nif:Qe().min(9,"NIFè‡³å°‘9ä½").max(15,"NIFæœ€å¤š15ä½"),contact:Qe().min(5,"è”ç³»æ–¹å¼è‡³å°‘5ä¸ªå­—ç¬¦"),address:Qe().min(5,"åœ°å€è‡³å°‘5ä¸ªå­—ç¬¦")}),bs=({open:s,onOpenChange:a,mode:r,existingData:t})=>{const{t:d}=V(),i=Pt(),o=At(),n=La({resolver:Ha(Kt),defaultValues:{full_name:t?.full_name||"",nif:t?.nif||"",contact:t?.contact||"",address:t?.address||""}});x.useEffect(()=>{s&&t?n.reset({full_name:t.full_name||"",nif:t.nif||"",contact:t.contact||"",address:t.address||""}):s&&!t&&n.reset({full_name:"",nif:"",contact:"",address:""})},[s,t,n]);const p=async u=>{try{const b={full_name:u.full_name,nif:u.nif,contact:u.contact,address:u.address};r==="reapply"&&t?.id?await o.mutateAsync({id:t.id,data:b}):await i.mutateAsync(b),a(!1),n.reset()}catch{}},l=i.isPending||o.isPending;return e.jsx(fe,{open:s,onOpenChange:a,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsxs(ge,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5 text-primary"}),r==="apply"?d("profile.invitationCode.applyTitle","ç”³è¯·é‚€è¯·ç "):d("profile.invitationCode.reapplyTitle","é‡æ–°ç”³è¯·é‚€è¯·ç ")]}),e.jsx(ss,{children:d("profile.invitationCode.applyDesc","è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ä»¥ç”³è¯·ä¸“å±žé‚€è¯·ç ")})]}),e.jsx(Ft,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(p),className:"space-y-4",children:[e.jsx(Ve,{control:n.control,name:"full_name",render:({field:u})=>e.jsxs(Be,{children:[e.jsx(Me,{children:d("profile.invitationCode.fullName","å…¨å")}),e.jsx(We,{children:e.jsx(C,{placeholder:d("profile.invitationCode.fullNamePlaceholder","è¯·è¾“å…¥æ‚¨çš„å…¨å"),...u})}),e.jsx(Ge,{})]})}),e.jsx(Ve,{control:n.control,name:"nif",render:({field:u})=>e.jsxs(Be,{children:[e.jsx(Me,{children:d("profile.invitationCode.nif","NIF (ç¨ŽåŠ¡è¯†åˆ«å·)")}),e.jsx(We,{children:e.jsx(C,{placeholder:d("profile.invitationCode.nifPlaceholder","è¯·è¾“å…¥æ‚¨çš„NIF"),...u})}),e.jsx(Ge,{})]})}),e.jsx(Ve,{control:n.control,name:"contact",render:({field:u})=>e.jsxs(Be,{children:[e.jsx(Me,{children:d("profile.invitationCode.contact","è”ç³»æ–¹å¼")}),e.jsx(We,{children:e.jsx(C,{placeholder:d("profile.invitationCode.contactPlaceholder","è¯·è¾“å…¥æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆç”µè¯/å¾®ä¿¡ç­‰ï¼‰"),...u})}),e.jsx(Ge,{})]})}),e.jsx(Ve,{control:n.control,name:"address",render:({field:u})=>e.jsxs(Be,{children:[e.jsx(Me,{children:d("profile.invitationCode.address","åœ°å€")}),e.jsx(We,{children:e.jsx(tt,{placeholder:d("profile.invitationCode.addressPlaceholder","è¯·è¾“å…¥æ‚¨çš„åœ°å€"),className:"resize-none",rows:3,...u})}),e.jsx(Ge,{})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>a(!1),children:d("common.cancel","å–æ¶ˆ")}),e.jsxs(v,{type:"submit",disabled:l,children:[l&&e.jsx(Ka,{className:"w-4 h-4 mr-2 animate-spin"}),r==="apply"?d("profile.invitationCode.submit","æäº¤ç”³è¯·"):d("profile.invitationCode.resubmit","é‡æ–°æäº¤")]})]})]})})]})})},$e=({open:s,onOpenChange:a})=>{const{t:r}=V();return e.jsx(fe,{open:s,onOpenChange:a,children:e.jsxs(je,{className:"sm:max-w-md",children:[e.jsx(ge,{children:e.jsx(ve,{className:"flex items-center gap-2",children:r("profile.invitationCode.helpTitle","é‚€è¯·ç ä½¿ç”¨è¯´æ˜Ž")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Qa,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpRequirements","ç”³è¯·è¦æ±‚")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpRequirementsDesc","ç”³è¯·é‚€è¯·ç éœ€æä¾›ï¼šå…¨åã€NIFï¼ˆç¨ŽåŠ¡è¯†åˆ«å·ï¼‰ã€è”ç³»æ–¹å¼ã€åœ°å€")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(_s,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpUsage","ä½¿ç”¨æ¡ä»¶")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpUsageDesc",'é‚€è¯·ç åªèƒ½åœ¨"åŠ å…¥æˆ‘ä»¬"ç”³è¯·ä¸­ä½¿ç”¨ï¼Œä¸”ä»…åœ¨å‹¾é€‰"æ‰«ç ç‚¹é¤"åŠŸèƒ½åŽæ‰èƒ½å¡«å†™')})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-primary font-medium",children:[e.jsx(Va,{className:"h-4 w-4"}),e.jsx("span",{children:r("profile.invitationCode.helpBenefit","ç¦åˆ©è¯´æ˜Ž")})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:r("profile.invitationCode.helpBenefitDesc","æˆåŠŸé‚€è¯·å•†å®¶åŽï¼Œè¢«é‚€è¯·äººå¯èŽ·å¾—ä»·å€¼99æ¬§å…ƒçš„é¢å¤–å…è´¹æœˆã€‚é‚€è¯·åŒæ–¹å¯è‡ªç”±åå•†ç¦åˆ©åˆ†é…æ–¹å¼ã€‚")})]}),e.jsx(Ds,{}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:r("profile.invitationCode.copyright","Â© 2026 å°ç†Šå¸‚åœº. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚æœ€ç»ˆè§£é‡Šæƒå½’å°ç†Šå¸‚åœºæ‰€æœ‰ã€‚")})]})]})})},ra=s=>{switch(s){case"zh":return bt;case"pt":return wt;default:return yt}},ia=({isMobile:s})=>{const{t:a,i18n:r}=V(),{data:t,isLoading:d}=Dt(),{data:i=[]}=Et(),[o,n]=x.useState(!1),[p,l]=x.useState(!1),[u,b]=x.useState(!1),[E,O]=x.useState(!1),B=async()=>{t?.code&&(await navigator.clipboard.writeText(t.code),b(!0),rt({title:a("profile.invitationCode.copied","å·²å¤åˆ¶"),description:a("profile.invitationCode.copiedDesc","é‚€è¯·ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿")}),setTimeout(()=>b(!1),2e3))},y=i.filter(k=>!(t?.status==="approved"&&k.id===t.id||k.id===t?.id)),H=(k,de)=>{switch(k){case"pending":return e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]});case"approved":return e.jsxs(j,{variant:"outline",className:"text-primary border-primary",children:[e.jsx(_s,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.approved","å·²é€šè¿‡")]});case"rejected":return e.jsxs(j,{variant:"destructive",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]});case"revoked":return e.jsxs(j,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]});default:return null}},F=()=>y.length===0?null:e.jsxs(_t,{open:E,onOpenChange:O,className:"mt-4",children:[e.jsx(St,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"sm",className:"w-full justify-between text-muted-foreground hover:text-foreground",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Wa,{className:"w-4 h-4"}),a("profile.invitationCode.history","åŽ†å²è®°å½•")," (",y.length,")"]}),e.jsx(Ga,{className:`w-4 h-4 transition-transform ${E?"rotate-180":""}`})]})}),e.jsx(kt,{className:"mt-2 space-y-2",children:y.map(k=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-mono font-medium",children:k.code}),H(k.status)]}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[a("profile.invitationCode.appliedAt","ç”³è¯·æ—¶é—´"),": ",as(new Date(k.created_at),{addSuffix:!0,locale:ra(r.language)})]}),k.reviewed_at&&e.jsxs("p",{children:[a("profile.invitationCode.reviewedAt","å®¡æ ¸æ—¶é—´"),": ",as(new Date(k.reviewed_at),{addSuffix:!0,locale:ra(r.language)})]}),k.rejection_reason&&e.jsxs("p",{className:"text-destructive",children:[a("profile.invitationCode.reason","åŽŸå› "),": ",k.rejection_reason]}),k.status==="approved"&&e.jsxs("p",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",k.usage_count," ",a("profile.invitationCode.people","äºº")]})]})]},k.id))})]});return d?e.jsxs(A,{children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsx(ws,{className:"h-6 w-32"}),e.jsx(ws,{className:"h-4 w-48 mt-2"})]}),e.jsx(D,{className:s?"px-4 pb-4":"",children:e.jsx(ws,{className:"h-20 w-full"})})]}):t?t.status==="pending"?e.jsxs(A,{className:"border-yellow-500/30",children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-5 h-5 text-yellow-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Q,{children:a("profile.invitationCode.pendingDesc","æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­")})]}),e.jsxs(D,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-950/30 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.pending","å®¡æ ¸ä¸­")]})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a("profile.invitationCode.pendingMessage","ç®¡ç†å‘˜æ­£åœ¨å®¡æ ¸æ‚¨çš„ç”³è¯·ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å®¡æ ¸é€šè¿‡åŽæ‚¨å°†æ”¶åˆ°é€šçŸ¥ã€‚")})]}),F()]}),e.jsx($e,{open:p,onOpenChange:l})]}):t.status==="rejected"?e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"border-destructive/30",children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-destructive"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Q,{children:a("profile.invitationCode.rejectedDesc","æ‚¨çš„ç”³è¯·æœªé€šè¿‡å®¡æ ¸")})]}),e.jsxs(D,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-destructive/10 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"destructive",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.rejected","å·²æ‹’ç»")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]})]}),e.jsxs(v,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Qs,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),F()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx($e,{open:p,onOpenChange:l})]}):t.status==="revoked"?e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"border-orange-500/30",children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-orange-500"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Q,{children:a("profile.invitationCode.revokedDesc","æ‚¨çš„é‚€è¯·ç å·²è¢«æ”¶å›ž")})]}),e.jsxs(D,{className:s?"px-4 pb-4":"",children:[e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-950/30 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs(j,{variant:"outline",className:"text-orange-600 border-orange-500 bg-orange-100 dark:bg-orange-900/50",children:[e.jsx(Se,{className:"w-3 h-3 mr-1"}),a("profile.invitationCode.revoked","å·²æ”¶å›ž")]})}),t.rejection_reason&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsxs("span",{className:"font-medium",children:[a("profile.invitationCode.reason","åŽŸå› "),":"]})," ",t.rejection_reason]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a("profile.invitationCode.revokedMessage","æ‚¨çš„é‚€è¯·ç å·²è¢«ç®¡ç†å‘˜æ”¶å›žï¼Œå¦‚éœ€ç»§ç»­ä½¿ç”¨è¯·é‡æ–°ç”³è¯·ã€‚")})]}),e.jsxs(v,{onClick:()=>n(!0),variant:"outline",className:"w-full",children:[e.jsx(Qs,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.reapply","é‡æ–°ç”³è¯·")]}),F()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"reapply",existingData:{id:t.id,full_name:t.full_name,nif:t.nif,contact:t.contact||"",address:t.address}}),e.jsx($e,{open:p,onOpenChange:l})]}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{className:"border-primary/30",children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(_s,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Q,{children:a("profile.invitationCode.approvedDesc","åˆ†äº«æ‚¨çš„é‚€è¯·ç ç»™æ–°å•†å®¶")})]}),e.jsxs(D,{className:s?"px-4 pb-4":"",children:[e.jsx("div",{className:"bg-primary/10 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:a("profile.invitationCode.yourCode","æ‚¨çš„é‚€è¯·ç ")}),e.jsx("p",{className:"text-2xl font-mono font-bold text-primary tracking-wider",children:t.code})]}),e.jsx(v,{variant:"outline",size:"icon",onClick:B,className:"flex-shrink-0",children:u?e.jsx(Ba,{className:"w-4 h-4 text-primary"}):e.jsx(Ma,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Rs,{className:"w-4 h-4"}),e.jsxs("span",{children:[a("profile.invitationCode.usageCount","å·²é‚€è¯·"),": ",t.usage_count," ",a("profile.invitationCode.people","äºº")]})]}),F()]})]}),e.jsx($e,{open:p,onOpenChange:l})]}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsxs(q,{className:s?"p-4":"",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Ss,{className:"w-5 h-5 text-primary"}),a("profile.invitationCode.title","æˆ‘çš„é‚€è¯·ç "),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>l(!0),children:e.jsx(Fe,{className:"w-4 h-4 text-muted-foreground"})})]}),e.jsx(Q,{children:a("profile.invitationCode.noCodeDesc","ç”³è¯·ä¸“å±žé‚€è¯·ç ï¼Œé‚€è¯·æ–°å•†å®¶åŠ å…¥å¹³å°")})]}),e.jsxs(D,{className:s?"px-4 pb-4":"",children:[e.jsxs(v,{onClick:()=>n(!0),className:"w-full",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),a("profile.invitationCode.apply","ç”³è¯·é‚€è¯·ç ")]}),F()]})]}),e.jsx(bs,{open:o,onOpenChange:n,mode:"apply"}),e.jsx($e,{open:p,onOpenChange:l})]})},Fs=x.memo(({comment:s,getLocalizedField:a,t:r})=>{const t=s.moderation_status==="flagged",d=s.moderation_status==="pending",i=()=>{if(!s.risk_reasons||!Array.isArray(s.risk_reasons))return null;const o={spam:r("riskReason.spam"),offensive:r("riskReason.offensive"),harassment:r("riskReason.harassment"),fake_review:r("riskReason.fakeReview"),flooding:r("riskReason.flooding"),irrelevant:r("riskReason.irrelevant"),sensitive_word_detected:r("riskReason.sensitiveWord"),parse_error:r("riskReason.parseError")};return s.risk_reasons.map(n=>o[n]||n).join(", ")};return e.jsxs("div",{className:"block p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsxs(T,{to:`/${s.target_type}/${s.target_id}`,className:"block",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2 gap-2",children:[e.jsx("h3",{className:"font-semibold text-card-foreground text-sm md:text-base line-clamp-1 flex-1",children:a(s,"target_name")}),e.jsx("span",{className:"text-xs md:text-sm text-muted-foreground whitespace-nowrap",children:as(new Date(s.created_at),{addSuffix:!0})})]}),e.jsx("p",{className:"text-muted-foreground line-clamp-2 text-sm md:text-base",children:s.content}),s.image_url&&e.jsx("img",{src:s.image_url,alt:"Comment",className:"mt-2 rounded-lg max-w-full md:max-w-xs",loading:"lazy"})]}),d&&e.jsx("div",{className:"mt-2 flex items-center gap-2",children:e.jsxs(j,{variant:"outline",className:"text-yellow-600 border-yellow-500 bg-yellow-50 dark:bg-yellow-950/30 text-xs",children:[e.jsx(Pe,{className:"w-3 h-3 mr-1"}),r("restaurant.commentPending")]})}),t&&e.jsxs("div",{className:"mt-2 space-y-1.5",children:[e.jsxs(j,{variant:"outline",className:"text-destructive border-destructive bg-destructive/10 text-xs",children:[e.jsx(Xa,{className:"w-3 h-3 mr-1"}),r("restaurant.commentFailed")]}),i()&&e.jsxs("p",{className:"text-xs text-destructive/80 pl-0.5",children:[r("restaurant.failReason"),": ",i()]})]})]})});Fs.displayName="CommentItem";const Is=x.memo(({restaurant:s,getLocalizedField:a,t:r})=>{if(!s||!s.id)return null;const t=a(s,"name")||s.name||"",d=Array.isArray(s.type)?s.type.join(" Â· "):s.type||"";return e.jsxs(T,{to:`/restaurant/${s.id}`,state:{from:"profile"},className:"flex gap-3 md:gap-4 p-3 md:p-4 rounded-lg border hover:shadow-medium transition-shadow",children:[e.jsx("div",{className:"w-20 h-20 md:w-24 md:h-24 rounded-lg overflow-hidden bg-secondary/30 flex-shrink-0",children:e.jsx("img",{src:s.image_url||"https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80",alt:String(t),className:"w-full h-full object-cover",loading:"lazy",onError:i=>{i.currentTarget.src="https://images.unsplash.com/photo-1555939594-58d7cb561ad1?w=400&q=80"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-base md:text-lg text-card-foreground line-clamp-1",children:t}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2 line-clamp-1",children:d}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Cs,{className:`w-4 h-4 ${s.rating?"fill-accent text-accent":"text-muted-foreground"}`}),s.rating?e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)}):e.jsxs("span",{className:"text-xs text-muted-foreground text-center whitespace-nowrap",children:[r("restaurant.noRatingLine1"),e.jsx("br",{}),r("restaurant.noRatingLine2")]})]})]})]})});Is.displayName="FavoriteRestaurantItem";const Os=x.memo(({subscription:s,getLocalizedField:a,t:r,isMobile:t})=>{const[d,i]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:()=>i(!0),className:`block rounded-lg border hover:shadow-medium transition-shadow cursor-pointer ${t?"p-3":"p-4"}`,children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[s.activity?.image_url&&e.jsx("img",{src:s.activity.image_url,alt:String(a(s.activity,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(s.activity,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(s.activity,"content")}}),e.jsxs("p",{className:"text-muted-foreground mt-2 text-xs",children:[r("profile.joinedOn"),":"," ",as(new Date(s.created_at),{addSuffix:!0})]})]}),e.jsx(Re,{className:`text-primary fill-primary flex-shrink-0 ${t?"w-4 h-4":"w-5 h-5"}`})]})}),e.jsx(It,{open:d,onOpenChange:i,activity:{title:String(a(s.activity,"title")),image_url:s.activity?.image_url,content:String(a(s.activity,"content"))}})]})});Os.displayName="ActivitySubscriptionItem";const Ts=x.memo(({activityGroup:s,getLocalizedField:a,t:r,isMobile:t})=>{const d=s.activity,i=s.restaurants;return e.jsxs("div",{className:`rounded-lg border hover:shadow-medium transition-shadow ${t?"p-3":"p-4"}`,children:[e.jsx(T,{to:`/activity/${d.id}`,className:t?"block mb-2":"block mb-3",children:e.jsxs("div",{className:`flex items-start ${t?"gap-3":"gap-4"}`,children:[d.image_url&&e.jsx("img",{src:d.image_url,alt:String(a(d,"title")),className:`rounded-lg object-cover flex-shrink-0 ${t?"w-20 h-20":"w-24 h-24"}`,loading:"lazy"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":""}`,children:a(d,"title")}),e.jsx("div",{className:`text-muted-foreground line-clamp-2 prose max-w-none mb-2 ${t?"text-xs prose-xs":"text-sm prose-sm"}`,dangerouslySetInnerHTML:{__html:a(d,"content")}}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 text-xs text-muted-foreground flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3"}),new Date(d.start_date).toLocaleDateString()]}),d.end_date&&e.jsxs("span",{children:["- ",new Date(d.end_date).toLocaleDateString()]})]})]})]})}),e.jsxs("div",{className:`pt-2 md:pt-3 border-t ${t?"mt-2":"mt-3"}`,children:[e.jsxs("div",{className:`flex items-center gap-2 ${t?"mb-1.5":"mb-2"}`,children:[e.jsx(ne,{className:`text-primary ${t?"w-3.5 h-3.5":"w-4 h-4"}`}),e.jsxs("span",{className:`font-medium text-foreground ${t?"text-xs":"text-sm"}`,children:[r("profile.participatingRestaurants")," (",i.length,")"]})]}),e.jsx("div",{className:`flex flex-wrap ${t?"gap-1.5":"gap-2"}`,children:i.map(o=>e.jsx(j,{variant:"secondary",className:t?"text-xs px-2 py-0.5":"text-xs",children:a(o,"name")},o.id))})]})]})});Ts.displayName="MerchantActivityItem";const $s=x.memo(({coupon:s,getLocalizedField:a,t:r,isMobile:t})=>{const[d,i]=x.useState(!1),o=s.coupon_codes?.coupon_templates,n=s.coupon_codes?.code,p=!!s.used_at;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`rounded-lg border transition-shadow cursor-pointer ${p?"bg-muted/30":"hover:shadow-medium"} ${t?"p-3":"p-4"}`,onClick:()=>i(!0),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-card-foreground mb-1 ${t?"text-sm":"text-base"}`,children:a(o,"title")}),e.jsx("p",{className:`text-muted-foreground line-clamp-2 ${t?"text-xs":"text-sm"}`,children:a(o,"description")})]}),e.jsx(j,{variant:p?"secondary":"default",className:t?"text-xs":"",children:r(p?"profile.coupons.used":"profile.coupons.available")})]}),e.jsxs("div",{className:`flex items-center gap-2 mb-2 ${t?"text-xs":"text-sm"}`,children:[e.jsx("span",{className:"font-mono bg-secondary/50 px-2 py-1 rounded",children:n}),e.jsx("span",{className:"text-muted-foreground",children:o?.discount_type==="percentage"?`${o?.discount_value}%`:`â‚¬${o?.discount_value}`})]}),e.jsx("div",{className:`text-muted-foreground ${t?"text-xs":"text-sm"}`,children:p?e.jsxs("span",{children:[r("profile.coupons.usedOn"),": ",oe(new Date(s.used_at),"yyyy-MM-dd HH:mm")]}):o?.valid_until?e.jsxs("span",{children:[r("profile.coupons.validUntil"),": ",oe(new Date(o.valid_until),"yyyy-MM-dd")]}):e.jsx("span",{children:r("profile.coupons.noExpiry")})})]}),e.jsx(zt,{open:d,onOpenChange:i,coupon:s})]})});$s.displayName="UserCouponItem";const Nr=()=>{const{t:s}=V(),{user:a}=Ne(),r=it();nt();const{data:t,isLoading:d}=da(),{data:i,isLoading:o}=Ot(),{data:n,isLoading:p}=Tt(),{data:l,isLoading:u}=dt(),{data:b,isLoading:E}=$t(),{data:O,isLoading:B}=xt(),{data:y,isLoading:H}=pt({authorId:a?.id}),{role:F,isMerchant:k,isSupervisor:de,isAdmin:ye}=la(),{getLocalizedField:I}=ts(),{settings:we}=lt(),z=k||de,[$,P]=x.useState("profile"),[M,be]=x.useState(),[Ae,rs]=x.useState({}),[me,is]=x.useState(new Set(["profile"])),le=z?[{value:"profile",label:s("profile.profile"),icon:Vs},{value:"favorites",label:s("profile.favorites"),icon:Re},{value:"comments",label:s("profile.comments"),icon:Ie},{value:"activities",label:s("profile.participatedActivities"),icon:ie}]:[{value:"profile",label:s("profile.profile"),icon:Vs},{value:"favorites",label:s("profile.favorites"),icon:Re},{value:"comments",label:s("profile.comments"),icon:Ie}],ze=m=>{rs(g=>({...g,[m]:window.scrollY}))},xe=m=>{if(me.has(m)){const g=Ae[m]||0;requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:g,behavior:"instant"})})})}else requestAnimationFrame(()=>{requestAnimationFrame(()=>{window.scrollTo({top:0,behavior:"instant"})})}),is(g=>new Set([...g,m]))};x.useEffect(()=>{if(!M)return;const m=()=>{const g=M.selectedScrollSnap(),N=le[g].value;N!==$&&(ze($),xe(N),P(N))};return M.on("select",m),()=>{M.off("select",m)}},[M,$,Ae,me]);const W=m=>{if(m===$)return;ze($);const g=le.findIndex(N=>N.value===m);g!==-1&&M&&M.scrollTo(g),xe(m),P(m)},w=Ya(),Ce=x.useCallback(async()=>{w.removeQueries({queryKey:["profile"]}),w.removeQueries({queryKey:["favorites"]}),w.removeQueries({queryKey:["favorites-restaurants"]}),w.removeQueries({queryKey:["user-comments"]}),w.removeQueries({queryKey:["subscriptions"]}),w.removeQueries({queryKey:["user-coupons"]}),w.removeQueries({queryKey:["merchant-activities"]}),w.removeQueries({queryKey:["user-points"]}),w.removeQueries({queryKey:["community-posts"]}),await Promise.all([w.invalidateQueries({queryKey:["profile"]}),w.invalidateQueries({queryKey:["favorites"]}),w.invalidateQueries({queryKey:["favorites-restaurants"]}),w.invalidateQueries({queryKey:["user-comments"]}),w.invalidateQueries({queryKey:["subscriptions"]}),w.invalidateQueries({queryKey:["user-coupons"]}),w.invalidateQueries({queryKey:["merchant-activities"]}),w.invalidateQueries({queryKey:["user-points"]}),w.invalidateQueries({queryKey:["community-posts"]})])},[w]);if(!a||d)return e.jsx("div",{className:"min-h-screen bg-secondary/20 py-8 px-4",children:e.jsx("div",{className:"container mx-auto max-w-6xl",children:e.jsx("div",{className:"text-center",children:s("common.loading")})})});const pe=s(F?`profile.role.${F}`:"profile.role.user");return e.jsx(Ct,{onRefresh:Ce,children:e.jsx("div",{className:`min-h-screen bg-secondary/20 ${r?"pb-20 pt-4":"py-4 md:py-8 px-3 md:px-4"}`,children:e.jsxs("div",{className:`container mx-auto max-w-6xl ${r?"px-3":""}`,children:[!r&&e.jsx(e.Fragment,{children:e.jsx(A,{className:"mb-6 md:mb-8",children:e.jsx(D,{className:"pt-4 md:pt-6 pb-4 md:pb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start gap-4 md:gap-6",children:[e.jsxs(ks,{className:"w-24 h-24",children:[e.jsx(Ps,{src:t?.avatar_url||""}),e.jsx(As,{className:"text-3xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center md:text-left",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:a.email}),t?.phone&&e.jsx("p",{className:"text-muted-foreground mb-2 md:mb-3",children:t.phone}),F&&F!=="user"&&e.jsx(j,{className:"bg-primary capitalize",children:pe}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(Bs,{className:"h-5 w-5 text-amber-500"}),e.jsx("span",{className:"font-semibold text-lg",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground",children:s("profile.points")}),e.jsx(Xs,{}),(we?.shop_enabled!==!1||ye)&&e.jsxs(T,{to:"/shop",className:"ml-2 inline-flex items-center gap-1 text-sm text-primary hover:underline",children:[e.jsx(Ms,{className:"h-4 w-4"}),s("profile.pointsShop")]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-start",children:[t&&e.jsx(Js,{profile:t}),z&&t&&e.jsx(Ys,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})})})}),r?e.jsx(e.Fragment,{children:e.jsx(ct,{setApi:be,opts:{align:"start",loop:!1},className:"w-full",children:e.jsxs(ot,{className:"-ml-0",children:[e.jsx(Ke,{className:"pl-0",children:e.jsxs("div",{className:"pb-4 space-y-4",children:[e.jsx(A,{children:e.jsx(D,{className:"pt-6 pb-6",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs(ks,{className:"w-20 h-20",children:[e.jsx(Ps,{src:t?.avatar_url||""}),e.jsx(As,{className:"text-2xl",children:t?.display_name?.charAt(0).toUpperCase()||"U"})]}),e.jsxs("div",{className:"flex-1 text-center w-full",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2 text-foreground",children:t?.display_name}),e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:a.email}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx(Bs,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"font-semibold",children:t?.points||0}),e.jsx("span",{className:"text-muted-foreground text-sm",children:s("profile.points")}),e.jsx(Xs,{})]}),(we?.shop_enabled!==!1||ye)&&e.jsxs(T,{to:"/shop",className:"inline-flex items-center justify-center gap-1 text-xs text-primary hover:underline mb-2",children:[e.jsx(Ms,{className:"h-3 w-3"}),s("profile.pointsShop")]}),t?.phone&&e.jsx("p",{className:"text-muted-foreground text-sm mb-3",children:t.phone}),F&&F!=="user"&&e.jsx(j,{className:"bg-primary capitalize text-xs mb-4",children:pe}),t&&e.jsxs("div",{className:"mt-4 flex flex-col sm:flex-row gap-2 w-full",children:[e.jsx(Js,{profile:t}),z&&e.jsx(Ys,{isAgreed:t?.activity_terms_agreed||!1,agreedAt:t?.activity_terms_agreed_at||null})]})]})]})})}),e.jsx(ia,{isMobile:!0}),e.jsxs(A,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ue,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(Q,{className:"text-xs",children:s("profile.coupons.description")})]}),e.jsx(D,{className:"px-3",children:B?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):O&&O.length>0?e.jsx("div",{className:"space-y-3",children:O.map(m=>e.jsx($s,{coupon:m,getLocalizedField:I,t:s,isMobile:!0},m.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.coupons.noCoupons")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]}),e.jsx(sa,{}),e.jsx(aa,{}),e.jsx(ta,{})]})}),e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(A,{children:e.jsx(D,{className:"pt-4",children:e.jsxs(Oe,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(R,{value:"restaurants",className:"flex items-center gap-2 text-xs",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),i&&i.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:i.length})]}),e.jsxs(R,{value:"activities",className:"flex items-center gap-2 text-xs",children:[e.jsx(ie,{className:"w-4 h-4"}),s("profile.activityFavorites"),l&&l.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:l.length})]})]}),e.jsx(U,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):i&&i.length>0?e.jsx("div",{className:"grid gap-3 grid-cols-1",children:i.map(m=>e.jsx(Is,{restaurant:m,getLocalizedField:I,t:s},m.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noFavorites")})}),e.jsx(U,{value:"activities",children:u?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):l&&l.length>0?e.jsx("div",{className:"space-y-3",children:l.map(m=>e.jsx(Os,{subscription:m,getLocalizedField:I,t:s,isMobile:!0},m.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noActivityFavorites")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsx(A,{children:e.jsx(D,{className:"pt-4",children:e.jsxs(Oe,{defaultValue:"comments",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-4",children:[e.jsxs(R,{value:"comments",className:"flex items-center gap-2 text-xs",children:[e.jsx(Ie,{className:"w-4 h-4"}),s("profile.myComments"),n&&n.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:n.length})]}),e.jsxs(R,{value:"posts",className:"flex items-center gap-2 text-xs",children:[e.jsx(Ws,{className:"w-4 h-4"}),s("profile.myPosts"),y&&y.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:y.length})]})]}),e.jsx(U,{value:"comments",children:p?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):n&&n.length>0?e.jsx("div",{className:"space-y-3",children:n.map(m=>e.jsx(Fs,{comment:m,getLocalizedField:I,t:s},m.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8 text-sm",children:s("profile.noComments")})}),e.jsx(U,{value:"posts",children:H?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):y&&y.length>0?e.jsx("div",{className:"space-y-3",children:y.map(m=>e.jsx(Gs,{post:m,showAssociations:!0},m.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noPosts")," ",e.jsx(T,{to:"/community",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})})}),z&&e.jsx(Ke,{className:"pl-0",children:e.jsx("div",{className:"pb-4",children:e.jsxs(A,{children:[e.jsxs(q,{className:"pb-3",children:[e.jsxs(L,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(Q,{className:"text-xs",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(D,{className:"px-3",children:e.jsx("div",{className:"space-y-4",children:E?e.jsx("div",{className:"text-center py-8 text-sm",children:s("common.loading")}):b&&b.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-3 flex items-center gap-2 text-base",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:"space-y-3",children:(()=>{const m=b.reduce((g,N)=>{const K=N.activity_id;return g[K]||(g[K]={activity:N.activity,restaurants:[],participationDate:N.created_at}),g[K].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),g},{});return Object.values(m).map(g=>e.jsx(Ts,{activityGroup:g,getLocalizedField:I,t:s,isMobile:!0},g.activity.id))})()})]}):e.jsxs("p",{className:"text-muted-foreground text-center py-8 text-sm",children:[s("profile.noParticipatedActivities")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})})})]})})}):e.jsxs(Oe,{defaultValue:"favorites",className:"space-y-4 md:space-y-6",children:[e.jsxs(Te,{className:`grid w-full ${z?"grid-cols-7":"grid-cols-6"} bg-card border rounded-lg shadow-sm h-auto p-1`,children:[e.jsxs(R,{value:"favorites",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),s("profile.favorites")]}),e.jsxs(R,{value:"coupons",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),s("profile.coupons.title")]}),e.jsxs(R,{value:"comments",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),s("profile.comments")]}),z&&e.jsxs(R,{value:"activities",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),s("profile.participatedActivities")]}),e.jsxs(R,{value:"invitation-code",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),s("profile.invitationCode.title")]}),e.jsxs(R,{value:"addresses",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),s("address.myAddresses")]}),e.jsxs(R,{value:"orders",className:"data-[state=active]:bg-primary data-[state=active]:text-primary-foreground py-2.5 text-sm",children:[e.jsx(Rs,{className:"w-4 h-4 mr-2"}),s("profile.orderRecords")]})]}),e.jsx(U,{value:"favorites",children:e.jsx(A,{children:e.jsx(D,{className:"pt-6",children:e.jsxs(Oe,{defaultValue:"restaurants",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(R,{value:"restaurants",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4"}),s("profile.restaurantFavorites"),i&&i.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:i.length})]}),e.jsxs(R,{value:"activities",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4"}),s("profile.activityFavorites"),l&&l.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:l.length})]})]}),e.jsx(U,{value:"restaurants",children:o?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):i&&i.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:i.map(m=>e.jsx(Is,{restaurant:m,getLocalizedField:I,t:s},m.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noFavorites")})}),e.jsx(U,{value:"activities",children:u?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):l&&l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(m=>e.jsx(Os,{subscription:m,getLocalizedField:I,t:s,isMobile:r},m.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noActivityFavorites")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),e.jsx(U,{value:"comments",children:e.jsx(A,{children:e.jsx(D,{className:"pt-6",children:e.jsxs(Oe,{defaultValue:"comments",className:"w-full",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(R,{value:"comments",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4"}),s("profile.myComments"),n&&n.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:n.length})]}),e.jsxs(R,{value:"posts",className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),s("profile.myPosts"),y&&y.length>0&&e.jsx(j,{variant:"secondary",className:"ml-1 px-1.5 py-0 text-xs min-w-[20px] h-5",children:y.length})]})]}),e.jsx(U,{value:"comments",children:p?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):n&&n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(m=>e.jsx(Fs,{comment:m,getLocalizedField:I,t:s},m.id))}):e.jsx("p",{className:"text-muted-foreground text-center py-8",children:s("profile.noComments")})}),e.jsx(U,{value:"posts",children:H?e.jsx("div",{className:"text-center py-8",children:s("common.loading")}):y&&y.length>0?e.jsx("div",{className:"columns-2 gap-4 md:columns-3",children:y.map(m=>e.jsx("div",{className:"break-inside-avoid mb-4",children:e.jsx(Gs,{post:m})},m.id))}):e.jsxs("p",{className:"text-muted-foreground text-center py-8",children:[s("profile.noPosts")," ",e.jsx(T,{to:"/community",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})]})})})}),z&&e.jsx(U,{value:"activities",children:e.jsxs(A,{children:[e.jsxs(q,{className:r?"pb-3":"",children:[e.jsxs(L,{className:`flex items-center gap-2 ${r?"text-lg":""}`,children:[e.jsx(ie,{className:"w-5 h-5"}),s("profile.participatedActivities")]}),e.jsx(Q,{className:r?"text-xs":"",children:s("profile.participatedActivitiesDesc")})]}),e.jsx(D,{className:r?"px-3":"",children:e.jsx("div",{className:r?"space-y-4":"space-y-6",children:E?e.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:s("common.loading")}):b&&b.length>0?e.jsxs("div",{children:[e.jsxs("h3",{className:`font-semibold mb-3 md:mb-4 flex items-center gap-2 ${r?"text-base":"text-lg"}`,children:[e.jsx(ne,{className:r?"w-4 h-4":"w-5 h-5"}),s("profile.restaurantActivities")]}),e.jsx("div",{className:r?"space-y-3":"space-y-4",children:(()=>{const m=b.reduce((g,N)=>{const K=N.activity_id;return g[K]||(g[K]={activity:N.activity,restaurants:[],participationDate:N.created_at}),g[K].restaurants.push({id:N.restaurant_id,name:N.restaurant_name,name_en:N.restaurant_name_en,name_pt:N.restaurant_name_pt}),g},{});return Object.values(m).map(g=>e.jsx(Ts,{activityGroup:g,getLocalizedField:I,t:s,isMobile:r},g.activity.id))})()})]}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[s("profile.noParticipatedActivities")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.browseActivities")})]})})})]})}),e.jsx(U,{value:"invitation-code",children:e.jsx(ia,{})}),e.jsx(U,{value:"coupons",children:e.jsxs(A,{children:[e.jsxs(q,{className:r?"pb-3":"",children:[e.jsxs(L,{className:`flex items-center gap-2 ${r?"text-lg":""}`,children:[e.jsx(Ue,{className:"w-5 h-5"}),s("profile.coupons.title")]}),e.jsx(Q,{className:r?"text-xs":"",children:s("profile.coupons.description")})]}),e.jsx(D,{className:r?"px-3":"",children:B?e.jsx("div",{className:`text-center py-8 ${r?"text-sm":""}`,children:s("common.loading")}):O&&O.length>0?e.jsx("div",{className:`grid gap-3 md:gap-4 ${r?"grid-cols-1":"md:grid-cols-2"}`,children:O.map(m=>e.jsx($s,{coupon:m,getLocalizedField:I,t:s,isMobile:r},m.id))}):e.jsxs("p",{className:`text-muted-foreground text-center py-8 ${r?"text-sm":""}`,children:[s("profile.coupons.noCoupons")," ",e.jsx(T,{to:"/activities",className:"text-primary hover:underline",children:s("profile.coupons.browseActivities")})]})})]})}),e.jsx(U,{value:"addresses",children:e.jsx(sa,{})}),e.jsx(U,{value:"orders",children:e.jsxs("div",{className:"space-y-4 md:space-y-6",children:[e.jsx(aa,{}),e.jsx(ta,{})]})})]}),r&&e.jsxs("div",{className:"fixed left-4 right-4 z-40 bg-white/20 dark:bg-black/25 backdrop-blur-sm border border-white/40 dark:border-white/30 shadow-[0_2px_20px_rgba(0,0,0,0.08)] rounded-[28px] overflow-hidden",style:{contain:"layout style paint",isolation:"isolate",backfaceVisibility:"hidden",transform:"translateZ(0)",bottom:"max(1rem, calc(env(safe-area-inset-bottom) + 0.25rem))"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/10 via-transparent to-transparent pointer-events-none"}),e.jsx("div",{className:"relative flex justify-around items-center h-16 px-4",children:le.map(m=>{const g=m.icon;return e.jsxs("button",{onClick:()=>W(m.value),className:`relative flex flex-col items-center justify-center flex-1 h-12 py-1.5 px-2 mx-0.5 transition-all duration-200 rounded-2xl ${$===m.value?"text-primary dark:text-white bg-primary/15 dark:bg-white/15":"text-gray-700 dark:text-white/80 active:bg-black/5 dark:active:bg-white/5"}`,children:[e.jsx(g,{className:`h-5 w-5 mb-0.5 transition-all duration-200 ${$===m.value?"scale-110 drop-shadow-[0_0_6px_rgba(34,197,94,0.6)] dark:drop-shadow-[0_0_6px_rgba(255,255,255,0.6)]":""}`}),e.jsx("span",{className:`text-xs text-center leading-tight ${$===m.value?"font-semibold":"font-normal"}`,children:m.label})]},m.value)})})]})]})})})};export{Nr as default};
//# sourceMappingURL=Profile-CUw0S2jo.js.map
