import{j as e}from"./vendor-ui-DmpovMYY.js";import{a as ne,u as je,l as we,D as Ne,b as ke,c as _e,d as Se,S as Ie,M as se,e as S,U as Ce,L as ae,I as Re,B as ie,f as Te,g as le,h as $e,C as De,i as Ae,A as Oe,j as ze,H as Ee,k as Me,m as Pe,n as ce,o as de,p as Be,q as Le,r as Ve,t as We}from"./index-wnyfSufX.js";import{u as ue,r as i,a as Fe,L as me}from"./vendor-react-iAJ0IrSD.js";import{m as He}from"./geolocation-DRm3QMsJ.js";import{u as Xe}from"./useHomepageTemplates-CWcAzfSg.js";import{u as qe}from"./usePageView-rH4KfLFD.js";import{u as he}from"./vendor-i18n-DxKeo2S1.js";import{P as Ue}from"./PullToRefresh-cJ1axbAf.js";import{u as Je}from"./vendor-query-D82cqPtt.js";import{u as Ke}from"./useRestaurants-CHgQR9em.js";import{R as Ge}from"./RestaurantMap-EVmttMGW.js";import"./vendor-charts-Bz7hPIBd.js";import"./vendor-supabase-6pZ9VDFn.js";import"./vendor-map-BaCLwlqt.js";/* empty css                  */const Qe="/assets/google-play-badge-new-BAXiFmDF.png",Ye="/assets/app-store-badge-C-eOGvqu.svg",oe="https://tzdgqhwyzsxkxnncgzap.supabase.co",Y="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Ze=()=>{const t="xiaoxiong_anonymous_user_id";let d=localStorage.getItem(t);return d||(d=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(t,d)),d},et=({open:t,onOpenChange:d,provider:g="ask-xiaoxiong"})=>{const{i18n:x}=he(),c=ue(),{settings:$}=ne(),{user:I}=je(),N=$?.logo_url||we,[w,E]=i.useState(""),[C,y]=i.useState([]),[k,V]=i.useState(!1),[R,M]=i.useState(null),_=i.useRef(null),W=i.useRef(null),P=i.useRef(null),D=()=>I?.id?I.id:Ze();i.useEffect(()=>{t&&!R&&navigator.geolocation?.getCurrentPosition(s=>{M({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[t,R]),i.useEffect(()=>{P.current?.scrollIntoView({behavior:"smooth"})},[C]);const B=async(s,u)=>{const a=await fetch(`${oe}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Y}`,apikey:Y},body:JSON.stringify({text:s.content,stream:!0,lat:R?.lat,lng:R?.lng}),signal:_.current?.signal});if(!a.ok)throw new Error(`Request failed with status: ${a.status}`);if(!a.body)throw new Error("No response body");const l=a.body.getReader(),n=new TextDecoder;let r="";for(;;){const{done:m,value:h}=await l.read();if(m)break;const L=n.decode(h,{stream:!0});r+=L;let j=r;j.startsWith('"')&&(j=j.slice(1)),j.endsWith('"')&&(j=j.slice(0,-1)),j=j.replace(/\\n/g,`
`),y(A=>A.map(T=>T.id===u?{...T,content:j}:T))}let o=r;o.startsWith('"')&&(o=o.slice(1)),o.endsWith('"')&&(o=o.slice(0,-1)),o=o.replace(/\\n/g,`
`),y(m=>m.map(h=>h.id===u?{...h,content:o,isStreaming:!1}:h))},z=async(s,u)=>{const a=D(),l=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const n=await fetch(`${oe}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Y}`,apikey:Y},body:JSON.stringify({message:s.content,userId:a}),signal:_.current?.signal}),r=Date.now()-l;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${r}ms`),!n.ok)throw new Error(`Request failed with status: ${n.status}`);if(!n.body)throw new Error("No response body");const o=n.body.getReader(),m=new TextDecoder;let h="",L=!1,j=0;for(;;){const{done:A,value:T}=await o.read();if(A){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-l}ms, 共 ${j} 个数据块`);break}j++;const Q=m.decode(T,{stream:!0});if(h+=Q,!L){L=!0;const O=Date.now()-l;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${O}ms, 大小: ${Q.length} 字符`)}Fe.flushSync(()=>{y(O=>O.map(X=>X.id===u?{...X,content:h}:X))}),await new Promise(O=>requestAnimationFrame(O))}y(A=>A.map(T=>T.id===u?{...T,isStreaming:!1}:T))},F=async()=>{if(!w.trim()||k)return;const s={id:Date.now().toString(),role:"user",content:w.trim()},u=(Date.now()+1).toString(),a={id:u,role:"assistant",content:"",isStreaming:!0};y(l=>[...l,s,a]),E(""),V(!0),_.current&&_.current.abort(),_.current=new AbortController;try{g==="xiaoxiong-agent"?await z(s,u):await B(s,u)}catch(l){if(l instanceof Error&&l.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",l);const n=x.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":x.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";y(r=>r.map(o=>o.id===u?{...o,content:n,isStreaming:!1}:o))}finally{V(!1)}},H=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),F())},p=()=>{_.current&&_.current.abort(),d(!1)},f=s=>{p(),c(s)},v=s=>{const u=/\[([^\]]+)\]\(([^)]+)\)/g,a=[];let l=0,n,r=0;for(;(n=u.exec(s))!==null;){n.index>l&&a.push(e.jsx("span",{children:s.slice(l,n.index)},r++));const o=n[1],m=n[2];m.startsWith("/")?a.push(e.jsx("button",{onClick:()=>f(m),className:"text-primary hover:underline font-medium cursor-pointer",children:o},r++)):a.push(e.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:o},r++)),l=n.index+n[0].length}return l<s.length&&a.push(e.jsx("span",{children:s.slice(l)},r++)),a.length>0?a:[e.jsx("span",{children:s},"0")]},b=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),U=(s,u=20)=>s.length<=u?s:s.slice(0,u)+"...",ee=(s,u)=>{const a=r=>r.split("|").slice(1,-1).map(o=>b(o.trim())),l=a(s[0]),n=s.slice(2).map(a);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:l.map((r,o)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:r,children:v(U(r,15))},o))})}),e.jsx("tbody",{children:n.map((r,o)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:r.map((m,h)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:m,children:v(U(m,18))},h))},o))})]})},u)},te=s=>{const u=s.split(`
`),a=[];let l=0;for(;l<u.length;){const n=u[l];if(n.trim().startsWith("|")&&n.split("|").length>2){const r=[];for(;l<u.length&&u[l].trim().startsWith("|");)r.push(u[l]),l++;r.length>=2&&a.push(ee(r,a.length));continue}if(n.startsWith("### "))a.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:v(n.slice(4))},a.length));else if(n.startsWith("## "))a.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:v(n.slice(3))},a.length));else if(n.startsWith("# "))a.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:v(n.slice(2))},a.length));else if(n.includes("**")){const r=n.split(/\*\*(.*?)\*\*/g);a.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:r.map((o,m)=>m%2===1?e.jsx("strong",{className:"font-semibold",children:v(o)},m):v(o))},a.length))}else n.startsWith("- ")||n.startsWith("* ")?a.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:v(n.slice(2))},a.length)):/^\d+\.\s/.test(n)?a.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:v(n.replace(/^\d+\.\s/,""))},a.length)):n.match(/^[-*_]{3,}$/)?a.push(e.jsx("hr",{className:"my-3 border-border"},a.length)):n.trim()===""?a.push(e.jsx("div",{className:"h-1"},a.length)):a.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:v(n)},a.length));l++}return a},J=()=>x.language==="zh"?"小熊AI助手":x.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",K=()=>x.language==="zh"?"告诉小熊，你想吃什么...":x.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",G=()=>x.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":x.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(Ne,{open:t,onOpenChange:p,children:e.jsxs(ke,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(_e,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(Se,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:N,alt:"Logo",className:"w-6 h-6 object-contain"})}),J()]})}),e.jsx(Ie,{className:"flex-1 h-0",ref:W,children:e.jsxs("div",{className:"p-4 space-y-4",children:[C.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(se,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:G()})]}),C.map(s=>e.jsxs("div",{className:S("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:S("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(Ce,{className:"h-4 w-4"}):e.jsx(se,{className:"h-4 w-4"})}),e.jsx("div",{className:S("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:te(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ae,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:x.language==="zh"?"思考中...":x.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:P})]})}),e.jsx("div",{className:"p-3 border-t bg-background shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Re,{value:w,onChange:s=>E(s.target.value),onKeyDown:H,placeholder:K(),disabled:k,className:"flex-1 rounded-full bg-muted/50 border-0 focus-visible:ring-1",autoFocus:!0}),e.jsx(ie,{onClick:F,disabled:!w.trim()||k,size:"icon",className:"shrink-0 rounded-full",children:k?e.jsx(ae,{className:"h-4 w-4 animate-spin"}):e.jsx(Te,{className:"h-4 w-4"})})]})})]})})},xe=i.memo(()=>{const[t,d]=i.useState(!1),g=i.useRef(null),x=ue(),{data:c=[],isLoading:$}=Ke();i.useEffect(()=>{const N=new IntersectionObserver(([w])=>{w.isIntersecting&&(d(!0),N.disconnect())},{threshold:.1,rootMargin:"100px"});return g.current&&N.observe(g.current),()=>N.disconnect()},[]);const I=N=>{x(`/restaurant/${N.id}`)};return e.jsx("div",{ref:g,className:"h-[350px] sm:h-[400px] lg:h-[450px] rounded-2xl overflow-hidden shadow-lg",children:t&&!$?e.jsx(Ge,{restaurants:c,onRestaurantClick:I,userLocation:null,radiusFilter:null}):e.jsx("div",{className:"w-full h-full bg-muted animate-pulse flex items-center justify-center",children:e.jsx(le,{className:"w-12 h-12 text-muted-foreground"})})})});xe.displayName="HomeMap";const re="/images/sushi-ramen-hero.jpg",pe="/images/sushi-ramen-mobile.jpg",ge=i.memo(({stats:t,t:d})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:d("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:t.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:d("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:t.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:d("home.hero.brandName")}),e.jsx("img",{src:He,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));ge.displayName="StatsDisplay";const Z=i.memo(({to:t,Icon:d,title:g,desc:x,iconBg:c,iconColor:$,hoverBorderColor:I})=>e.jsx(me,{to:t,children:e.jsx(Ae,{className:`group p-4 sm:p-5 border-border/50 ${I} transition-all hover:shadow-lg cursor-pointer h-full`,children:e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsx("div",{className:`w-10 sm:w-12 h-10 sm:h-12 rounded-xl ${c} flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform`,children:e.jsx(d,{className:`w-5 sm:w-6 h-5 sm:h-6 ${$}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-card-foreground mb-0.5",children:g}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground leading-snug flex items-center gap-1.5",children:[e.jsx("span",{className:"truncate",children:x}),e.jsx(Oe,{className:"w-3.5 h-3.5 flex-shrink-0 group-hover:translate-x-1 transition-transform"})]})]})]})})}));Z.displayName="FeatureCard";const tt=()=>{const t=window.innerWidth<640,d=window.innerWidth>=1024,g=navigator.connection,x=de(),c=ce();return d?!!g?.saveData:!!(c&&!x||g&&(g.saveData||g.effectiveType==="2g"||g.effectiveType==="slow-2g")||t&&navigator.deviceMemory&&navigator.deviceMemory<2)},fe=i.memo(({template:t,isActive:d,currentLang:g,t:x,onContentReady:c,onAskXiaoxiong:$})=>{const[I,N]=i.useState({}),[w,E]=i.useState({}),[C,y]=i.useState({}),[k,V]=i.useState({mobile:!0,tablet:!0,desktop:!0}),[R,M]=i.useState(!1),_=tt(),W=i.useRef(null),P=i.useRef(null),D=i.useRef(null),B=r=>t[`${r}${g==="zh"?"_zh":g==="pt"?"_pt":"_en"}`]||"",z=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",F=()=>{const r=z();return r==="mobile"&&t.mobile_overlay_opacity!==null?t.mobile_overlay_opacity:r==="tablet"&&t.tablet_overlay_opacity!==null?t.tablet_overlay_opacity:r==="desktop"&&t.desktop_overlay_opacity!==null?t.desktop_overlay_opacity:t.overlay_opacity??30},H=()=>{const r=F(),o=t.overlay_gradient_direction||"to-b",m=(q,ve)=>q==null?ve/100:q>1?q/100:q,h=r>1?r/100:r,L=m(t.overlay_gradient_from_opacity,30)*h,j=m(t.overlay_gradient_via_opacity,25)*h,A=m(t.overlay_gradient_to_opacity,40)*h,Q={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[o]||"to bottom",O={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},X=O[t.overlay_gradient_from||"black"]||"0, 0, 0",be=O[t.overlay_gradient_via||"black"]||"0, 0, 0",ye=O[t.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${Q}, rgba(${X}, ${L}), rgba(${be}, ${j}), rgba(${ye}, ${A}))`}},p=t.mobile_image_url||pe,f=t.tablet_image_url||t.desktop_image_url||re,v=t.desktop_image_url||re,b=t.background_blur||0,U=t.desktop_media_type||t.media_type||"image",ee=t.tablet_media_type||t.media_type||"image",te=t.mobile_media_type||t.media_type||"image",J=U==="video"&&!_,K=ee==="video"&&!_,G=te==="video"&&!_,s=G?t.mobile_video_url:null,u=K?t.tablet_video_url||t.desktop_video_url:null,a=J?t.desktop_video_url:null;i.useEffect(()=>{const r=z(),o=r==="mobile"?p:r==="tablet"?f:v;if(o){const m=new Image;m.onload=()=>{N(h=>({...h,[r]:!0})),V(h=>({...h,[r]:!0})),d&&(c?.(),setTimeout(()=>M(!0),100))},m.src=o}},[p,f,v,d,c]),i.useEffect(()=>{d&&I[z()]&&M(!0)},[d,I]);const l=r=>{E(o=>({...o,[r]:!0}))},n=(r,o)=>{console.error(`[HeroSlide] Video error on ${r}:`,o),y(m=>({...m,[r]:!0}))};return i.useEffect(()=>{if(!R||!d||!We())return;const o=z(),h=(o==="mobile"?W:o==="tablet"?P:D).current;if(!h)return;const j=setTimeout(async()=>{try{h.muted=!0,h.playsInline=!0,h.setAttribute("webkit-playsinline","true"),await h.play(),console.log(`[HeroSlide] iOS video play successful on ${o}`)}catch(A){console.error(`[HeroSlide] iOS video play failed on ${o}:`,A),y(T=>({...T,[o]:!0}))}},150);return()=>clearTimeout(j)},[R,d]),e.jsxs("div",{className:S("absolute inset-0 w-full h-full transition-opacity duration-1000",d?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!k.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),G&&s?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:p,alt:"Background",className:S("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",w.mobile&&!C.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:b>0?`blur(${b}px)`:void 0}}),R&&!C.mobile&&e.jsx("video",{ref:W,src:s,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>l("mobile"),onError:r=>n("mobile",r),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:b>0?`blur(${b}px)`:void 0}})]}):e.jsx("img",{src:p,alt:"Background",className:S("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",k.mobile?"opacity-100":"opacity-0"),style:{filter:b>0?`blur(${b}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!k.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),K&&u?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:f,alt:"Background",className:S("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",w.tablet&&!C.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:b>0?`blur(${b}px)`:void 0}}),R&&!C.tablet&&e.jsx("video",{ref:P,src:u,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>l("tablet"),onError:r=>n("tablet",r),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:b>0?`blur(${b}px)`:void 0}})]}):e.jsx("img",{src:f,alt:"Background",className:S("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",k.tablet?"opacity-100":"opacity-0"),style:{filter:b>0?`blur(${b}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!k.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),J&&a?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:v,alt:"Background",className:S("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",w.desktop&&!C.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:b>0?`blur(${b}px)`:void 0}}),R&&!C.desktop&&e.jsx("video",{ref:D,src:a,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>l("desktop"),onError:r=>n("desktop",r),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:b>0?`blur(${b}px)`:void 0}})]}):e.jsx("img",{src:v,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:S("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",k.desktop?"opacity-100":"opacity-0"),style:{filter:b>0?`blur(${b}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:H()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:B("title")||x("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:B("description")||x("home.hero.description")}),t.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:$,className:"group flex items-center gap-3 bg-white/95 backdrop-blur-sm text-muted-foreground px-4 sm:px-6 py-3 sm:py-4 rounded-full shadow-lg hover:shadow-2xl hover:bg-white transition-all duration-300 cursor-text border border-border/20",children:[e.jsx(se,{className:"w-5 h-5 text-primary/70 group-hover:text-primary transition-colors"}),e.jsx("span",{className:"text-sm sm:text-base text-muted-foreground/80 group-hover:text-muted-foreground transition-colors",children:B("subtitle_button_text")||x("home.hero.subtitle")}),e.jsx(ze,{className:"w-4 h-4 text-muted-foreground/50 ml-2"})]})})]})})]})});fe.displayName="HeroSlide";const ft=()=>{const{t,i18n:d}=he(),g=Je(),{settings:x}=ne(),{data:c,isLoading:$,refetch:I}=Xe(),[N,w]=i.useState(0),[E,C]=i.useState(null),y=i.useRef(null),[k,V]=i.useState(!1),[R,M]=i.useState(!1),_=x?.ai_assistant_enabled!==!1,W=x?.ai_provider||"ask-xiaoxiong",P=i.useCallback(()=>{V(!0)},[]);qe({pageType:"home"});const D=i.useCallback(async()=>{try{const f=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();f&&C({order_count:f.order_count||0,reserve_count:f.reserve_count||0})}catch(p){console.error("Failed to fetch stats:",p)}},[]);i.useEffect(()=>{D()},[D]);const B=i.useCallback(async()=>{await Promise.all([I(),D(),g.invalidateQueries({queryKey:["restaurants"]}),g.invalidateQueries({queryKey:["activities"]})])},[I,D,g]);i.useEffect(()=>{if(!c||c.length<=1)return;const f=c[N]?.duration||5e3;return y.current=setTimeout(()=>{w(v=>(v+1)%c.length)},f),()=>{y.current&&clearTimeout(y.current)}},[c,N]);const z=i.useCallback(p=>{y.current&&clearTimeout(y.current),w(p)},[]);i.useCallback(()=>{c&&(y.current&&clearTimeout(y.current),w(p=>(p-1+c.length)%c.length))},[c]),i.useCallback(()=>{c&&(y.current&&clearTimeout(y.current),w(p=>(p+1)%c.length))},[c]);const F=d.language,H=c&&c.length>1;return e.jsx(Ue,{onRefresh:B,children:e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[E&&e.jsx(ge,{stats:E,t}),e.jsx("div",{className:S("absolute inset-0 w-full h-full transition-opacity duration-500",k?"opacity-100":"opacity-0"),children:c?.map((p,f)=>e.jsx(fe,{template:p,isActive:f===N,currentLang:F,t,onContentReady:f===0?P:void 0,onAskXiaoxiong:()=>M(!0)},p.id))}),e.jsx("div",{className:S("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",$||!k?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(Ee,{})}),!$&&(!c||c.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:pe,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:re,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:t("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:t("home.hero.description")})]})})]}),H&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:c.map((p,f)=>e.jsx("button",{onClick:()=>z(f),className:S("w-3 h-3 rounded-full transition-all duration-300",f===N?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${f+1}`},f))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-2 sm:mb-3",children:t("home.features.title")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-xl mx-auto px-4",children:t("home.features.description")})]}),e.jsx(xe,{}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mt-6 sm:mt-8",children:[e.jsx(Z,{to:"/map",Icon:le,title:t("home.features.map.title"),desc:t("home.features.map.desc"),iconBg:"bg-gradient-to-br from-primary to-primary-light",iconColor:"text-primary-foreground",hoverBorderColor:"hover:border-primary/50"}),e.jsx(Z,{to:"/restaurants",Icon:Me,title:t("home.features.reviews.title"),desc:t("home.features.reviews.desc"),iconBg:"bg-gradient-to-br from-accent to-warning",iconColor:"text-accent-foreground",hoverBorderColor:"hover:border-accent/50"}),e.jsx(Z,{to:"/activities",Icon:Pe,title:t("home.features.events.title"),desc:t("home.features.events.desc"),iconBg:"bg-gradient-to-br from-success to-accent",iconColor:"text-white",hoverBorderColor:"hover:border-success/50"})]})]})}),!ce()&&!de()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:t("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:t("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Ye,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Qe,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Le,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:t("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:t("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:t("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(ie,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(me,{to:"/join-us",children:[e.jsx(Ve,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),t("home.cta.button")]})})})]})]}),_&&e.jsx(et,{open:R,onOpenChange:M,provider:W})]})})};export{ft as default};
//# sourceMappingURL=Home-DcoMWhtZ.js.map
