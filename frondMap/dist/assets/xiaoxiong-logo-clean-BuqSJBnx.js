import{j as p}from"./vendor-ui-DAmPMpEA.js";import{r as c}from"./vendor-react-iAJ0IrSD.js";import{m as i}from"./vendor-map-BaCLwlqt.js";/* empty css                  */import{c as C}from"./geolocation-YPf7LJYy.js";import{r as S,a4 as R,aq as z,B as O,j as P,Q as B}from"./index-CWo17YGZ.js";import{m as D}from"./map-icon-DR07RZr_.js";import{u as W}from"./vendor-i18n-DxKeo2S1.js";import{a as q}from"./vendor-query-BlSVl3IQ.js";const Z=({restaurants:g,onRestaurantClick:x,userLocation:t,radiusFilter:m,onMapInit:E,onMarkerClick:v,showViewDetailsButton:b=!1})=>{const{i18n:N,t:u}=W(),y=c.useRef(null),r=c.useRef(null),h=c.useRef([]),[f,k]=c.useState(!1),[M,w]=c.useState(null),s=c.useRef(null);return c.useEffect(()=>{if(!y.current||r.current)return;const n="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!i.supported()){console.warn("[RestaurantMap] WebGL not supported",{isIOSDevice:S(),isIOSWebView:R(),userAgent:navigator.userAgent}),w(u("map.webglNotSupported","Your browser does not support map display"));return}const e=()=>{if(!y.current)return;const o=y.current.getBoundingClientRect();if(console.log("[RestaurantMap] Container dimensions:",o.width,o.height),o.width===0||o.height===0){setTimeout(e,100);return}try{i.accessToken=n;const l=t?[t.lng,t.lat]:[-9.1393,38.7223];r.current=new i.Map({container:y.current,style:"mapbox://styles/mapbox/light-v11",center:l,zoom:13,cooperativeGestures:!0,doubleClickZoom:!1}),r.current.on("error",a=>{console.error("[RestaurantMap] Map error:",a),w(u("map.loadError","Map failed to load"))}),r.current.addControl(new i.NavigationControl({visualizePitch:!0}),"top-right"),r.current.on("load",()=>{k(!0),E&&r.current&&E(r.current)})}catch(l){console.error("[RestaurantMap] Failed to initialize map:",l),w(u("map.loadError","Map failed to load"))}};return e(),()=>{h.current.forEach(o=>o.remove()),h.current=[],s.current&&(s.current.remove(),s.current=null),r.current?.remove(),r.current=null,k(!1)}},[]),c.useEffect(()=>{r.current&&t&&f&&r.current.flyTo({center:[t.lng,t.lat],zoom:14,duration:1500})},[t,f]),c.useEffect(()=>{if(!r.current||!f)return;h.current.forEach(e=>e.remove()),h.current=[],s.current&&(s.current.remove(),s.current=null);let n=g;if(t&&m&&(n=g.filter(e=>C(t.lat,t.lng,e.lat,e.lng)<=m)),n.forEach(e=>{const o=document.createElement("div");o.className="p-3 min-w-[200px]",o.innerHTML=`
        <div class="space-y-2">
          <h3 class="font-bold text-base text-foreground">${e.name}</h3>
          ${e.type&&e.type.length>0?`
            <div class="flex flex-wrap gap-1">
              ${e.type.slice(0,2).map(d=>`<span class="text-xs bg-secondary text-secondary-foreground px-2 py-0.5 rounded">${d}</span>`).join("")}
            </div>
          `:""}
          ${e.rating?`
            <div class="flex items-center gap-1">
              <span style="color: #016450;">‚≠ê</span>
              <span class="font-semibold text-sm">${e.rating.toFixed(1)}</span>
            </div>
          `:""}
          <p class="text-xs text-muted-foreground">${e.address}</p>
          ${b?`
            <button 
              id="view-details-${e.id}" 
              class="w-full mt-2 px-3 py-1.5 text-sm font-medium text-white rounded-md transition-colors"
              style="background-color: #016450;"
              onmouseover="this.style.opacity='0.9'"
              onmouseout="this.style.opacity='1'"
            >
              ${u("restaurants.viewDetails")}
            </button>
          `:""}
        </div>
      `;const l=new i.Popup({offset:25,closeButton:!0,closeOnClick:!1,closeOnMove:!1,maxWidth:"300px"}).setLngLat([e.lng,e.lat]).setDOMContent(o),a=document.createElement("div");a.className="custom-marker",a.style.backgroundImage=`url(${D})`,a.style.width="40px",a.style.height="40px",a.style.backgroundSize="contain",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center",a.style.cursor="pointer";const I=new i.Marker({element:a,draggable:!1}).setLngLat([e.lng,e.lat]).addTo(r.current),j=I.getElement();j.style.cursor="pointer";const T=d=>{d.stopPropagation(),d.preventDefault(),s.current&&s.current!==l&&s.current.remove(),l.addTo(r.current),s.current=l,r.current.easeTo({center:[e.lng,e.lat],zoom:17,duration:800}),v&&v(e)};j.addEventListener("click",T,!0),b&&l.on("open",()=>{const d=document.getElementById(`view-details-${e.id}`);d&&d.addEventListener("click",$=>{$.stopPropagation(),x(e)})}),l.on("close",()=>{s.current===l&&(s.current=null)}),h.current.push(I)}),n.length>0){const e=new i.LngLatBounds;n.forEach(o=>{e.extend([o.lng,o.lat])}),t&&e.extend([t.lng,t.lat]),r.current.fitBounds(e,{padding:50,maxZoom:15})}},[g,m,t,f,x,N.language,b,u,v]),c.useEffect(()=>{if(!r.current||!t||!f)return;const n=document.createElement("div");n.className="user-location-marker",n.style.backgroundColor="#3b82f6",n.style.width="20px",n.style.height="20px",n.style.borderRadius="50%",n.style.border="3px solid white",n.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)";const e=new i.Marker(n).setLngLat([t.lng,t.lat]).addTo(r.current);return()=>{e.remove()}},[t,f]),M?p.jsxs("div",{className:"w-full h-full rounded-lg overflow-hidden bg-muted/50 flex flex-col items-center justify-center p-6 text-center",children:[p.jsx(z,{className:"w-12 h-12 text-muted-foreground mb-4"}),p.jsx("p",{className:"text-muted-foreground mb-2",children:M}),p.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:u("map.viewListInstead","Please view the restaurant list below")}),R()&&p.jsxs(O,{variant:"outline",size:"sm",onClick:()=>window.open(window.location.href,"_blank"),children:[p.jsx(P,{className:"w-4 h-4 mr-2"}),u("map.openInBrowser","Open in Browser")]})]}):p.jsx("div",{ref:y,className:"w-full h-full rounded-lg overflow-hidden"})},K=()=>q({queryKey:["activity-restaurant-counts"],queryFn:async()=>{const{data:g,error:x}=await B.from("activity_restaurants").select("activity_id");if(x)throw x;const t={};return g.forEach(m=>{t[m.activity_id]=(t[m.activity_id]||0)+1}),t}}),V="/assets/xiaoxiong-logo-v3-D4uDr23w.png";export{Z as R,V as l,K as u};
//# sourceMappingURL=xiaoxiong-logo-clean-BuqSJBnx.js.map
