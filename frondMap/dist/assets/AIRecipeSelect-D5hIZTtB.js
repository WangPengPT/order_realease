import{p as R,r as u,w as b,j as e,cw as O,aM as m,a_ as A,et as V,u as I,b8 as E,b0 as L,eu as G,ce as U,aO as J,bT as $,bn as B,c7 as P,a$ as T}from"./vendor-react-DImbKuZP.js";import{u as q}from"./useLoginRequired-DynG1Vvm.js";import{J as M,q as j,u as W}from"./index-_G3CuCzp.js";import{u as X}from"./useRecipeVideo-CWGjMCP6.js";import{u as H}from"./useWatermarkedVideo-V-xLJRQT.js";import{u as Y}from"./useSavedRecipes-BgAf4HJl.js";import{l as F}from"./xiaoxiong-logo-clean-D2n3VLi4.js";import{S as K}from"./SavedRecipeDetailDialog-ClUNiY8T.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CRxszhSs.js";import"./drawer-CK8DetMs.js";import"./separator-8wE-3N0K.js";import"./RecipeCookingMode-B5DymqUo.js";import"./progress-Bi_ViBYA.js";import"./TranslateButton-P5tJRjUf.js";import"./ImagePreviewModal-CyiB2E01.js";const Z="https://tzdgqhwyzsxkxnncgzap.supabase.co",Q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",ee=`${Z}/functions/v1/ai-recipe/lookup-dish`,se=s=>{const r=(s.steps||[]).slice(0,5).map(i=>i.description_en||i.description||"").filter(Boolean).join(". ");return`Step-by-step cooking tutorial video showing the complete preparation process of ${s.recipe_name_en||s.recipe_name}. Show hands chopping ingredients, mixing in a bowl, cooking in a pan with oil sizzling. ${r}. Kitchen counter with fresh ingredients, cutting board, knife, pots and pans visible. Warm natural kitchen lighting, steam rising from the pan, close-up of each cooking step, smooth transitions between steps. --duration 5 --camerafixed true`},ae=({videoTask:s,recipeName:t,recipe:r})=>{const o=s.status==="succeeded"?s.videoUrl:null,{watermarkedUrl:i,isMp4:v}=H(o,F),{t:a}=R(),{user:N}=W(),y=I(),{saveRecipe:w,isSaving:d,savedRecipes:x}=Y(),[p,k]=u.useState(!1),[n,l]=u.useState(!1),c=p||x.some(f=>f.recipe_name===t),h=()=>{const f=i||o;if(!f)return;const z=i?v?"mp4":"webm":"mp4",g=document.createElement("a");g.href=f,g.download=`${t}-xiaoxiong.${z}`,document.body.appendChild(g),g.click(),document.body.removeChild(g),b.success(a("aiRecipe.video.downloadComplete","视频下载完成"))},_=async()=>{if(!N){b.error(a("auth.loginRequired","请先登录")),y("/auth");return}if(!c)try{await w(r),k(!0)}catch{}},S=()=>{l(!0)},C=s.status==="succeeded"&&o&&!i,D=e.jsx(K,{open:n,onOpenChange:l,recipe:r,recipeName:t,initialImageUrl:r.image_url,onSave:c?void 0:f=>_(),isSaving:d,isSaved:c});return s.status==="succeeded"&&o?e.jsxs("div",{className:"space-y-3",children:[C?e.jsx("div",{className:"w-full aspect-video rounded-2xl bg-muted/30 flex items-center justify-center",children:e.jsx(m,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):e.jsx("video",{src:i||o,controls:!0,autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full rounded-2xl shadow-lg"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",className:"gap-1.5 flex-1",onClick:h,children:[e.jsx(E,{className:"h-3.5 w-3.5"}),a("aiRecipe.video.downloadWithWatermark","下载视频")]}),e.jsxs(j,{variant:"outline",size:"sm",className:"gap-1.5 flex-1",onClick:S,children:[e.jsx(L,{className:"h-3.5 w-3.5"}),a("aiRecipe.video.viewRecipe","查看菜谱")]}),e.jsxs(j,{variant:c?"secondary":"outline",size:"sm",className:"gap-1.5 flex-1",onClick:_,disabled:d||c,children:[c?e.jsx(G,{className:"h-3.5 w-3.5"}):e.jsx(U,{className:"h-3.5 w-3.5"}),c?a("aiRecipe.video.saved","已保存"):a("aiRecipe.video.save","保存")]})]}),D]}):s.status==="creating"||s.status==="processing"?e.jsxs("div",{className:"flex items-center justify-center gap-2 p-4",children:[e.jsx(m,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.status==="creating"?a("aiRecipe.video.creating","正在创建视频任务..."):a("aiRecipe.video.processing","AI 视频生成中，请稍候...")})]}):s.status==="failed"?e.jsx("div",{className:"text-xs text-destructive text-center p-4",children:s.error||a("aiRecipe.video.failed","视频生成失败")}):null},ie=()=>{const{t:s,i18n:t}=R(),[r,o]=u.useState(""),[i,v]=u.useState(!1),[a,N]=u.useState(null),{videoTasks:y,generateVideo:w}=X(),d=n=>t.language==="en"&&n.recipe_name_en?n.recipe_name_en:t.language==="pt"&&n.recipe_name_pt?n.recipe_name_pt:n.recipe_name,x=u.useCallback(async(n=!1)=>{v(!0),N(null);try{const l=await fetch(ee,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${Q}`},body:JSON.stringify({dish_name:n?"":r.trim(),language:t.language})});if(!l.ok){const h=await l.json().catch(()=>({}));throw new Error(h.error||`Error ${l.status}`)}const c=await l.json();if(N(c.recipe),b.success(s("aiRecipe.videoGen.found","食谱已找到！")),c.recipe?.image_url){const h=se(c.recipe);w(c.recipe.recipe_name,c.recipe.image_url,h)}}catch(l){console.error("Lookup error:",l),b.error(l.message||s("aiRecipe.videoGen.error","查询失败，请重试"))}finally{v(!1)}},[r,t.language,w,s]),p=a?y[a.recipe_name]:void 0,k=i||!!a;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"text-center space-y-1",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-medium",children:[e.jsx(O,{className:"h-3.5 w-3.5"}),s("aiRecipe.videoGen.title","AI 烹饪视频")]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s("aiRecipe.videoGen.desc","输入菜名生成AI烹饪视频，或随机挑选")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{value:r,onChange:n=>o(n.target.value),placeholder:s("aiRecipe.videoGen.placeholder","输入菜名，如：红烧肉"),className:"text-sm h-10",onKeyDown:n=>{n.key==="Enter"&&!i&&x(!1)},disabled:i}),e.jsx(j,{size:"icon",onClick:()=>x(!1),disabled:i||!r.trim(),className:"h-10 w-10 shrink-0",children:i?e.jsx(m,{className:"h-4 w-4 animate-spin"}):e.jsx(A,{className:"h-4 w-4"})}),e.jsx(j,{size:"icon",variant:"outline",onClick:()=>x(!0),disabled:i,className:"h-10 w-10 shrink-0",title:s("aiRecipe.videoGen.random","随机挑选"),children:i?e.jsx(m,{className:"h-4 w-4 animate-spin"}):e.jsx(V,{className:"h-4 w-4"})})]}),e.jsx("div",{className:`grid transition-all duration-500 ease-out ${k?"grid-rows-[1fr] opacity-100":"grid-rows-[0fr] opacity-0"}`,children:e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"pt-1",children:i?e.jsxs("div",{className:"w-full aspect-video rounded-2xl bg-muted/30 flex flex-col items-center justify-center gap-3",children:[e.jsx(m,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.trim()?s("aiRecipe.videoGen.searching","正在查找食谱..."):s("aiRecipe.videoGen.randomPicking","随机挑选中...")})]}):a?e.jsx("div",{className:"w-full",children:p?e.jsxs(e.Fragment,{children:[p.status!=="succeeded"&&a.image_url&&e.jsxs("div",{className:"relative w-full aspect-video rounded-2xl overflow-hidden mb-3",children:[e.jsx("img",{src:a.image_url,alt:d(a),className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-white space-y-2",children:[e.jsx(m,{className:"h-8 w-8 animate-spin mx-auto"}),e.jsx("p",{className:"text-sm font-medium",children:d(a)}),e.jsx("p",{className:"text-xs opacity-80",children:s("aiRecipe.video.processing","AI 视频生成中，请稍候...")})]})})]}),p.status==="succeeded"&&e.jsx("p",{className:"text-sm font-medium text-center mb-2",children:d(a)}),e.jsx(ae,{videoTask:p,recipeName:a.recipe_name,recipe:a})]}):a.image_url?e.jsxs("div",{className:"relative w-full aspect-video rounded-2xl overflow-hidden",children:[e.jsx("img",{src:a.image_url,alt:d(a),className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-white"})})]}):e.jsx("div",{className:"w-full aspect-video rounded-2xl bg-muted/30 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:s("aiRecipe.videoGen.noImage","此食谱暂无图片，无法生成视频")})})}):null})})})]})},be=()=>{const{t:s}=R(),t=I(),r=J(),{requireLogin:o}=q(),i=r.state?.from||"/";return e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx("div",{className:"px-4 py-3 border-b bg-background shrink-0 sticky top-14 z-10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>t(i,{replace:!0}),className:"p-1 -ml-1 hover:bg-muted rounded-md",children:e.jsx($,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),e.jsx("h2",{className:"font-medium",children:s("aiRecipe.title")})]}),e.jsx("div",{className:"w-6"})]})}),e.jsxs("div",{className:"flex-1 flex flex-col items-center px-4 py-4 sm:p-6 gap-4 sm:gap-6 max-w-md mx-auto w-full",children:[e.jsx(ie,{}),e.jsx("div",{className:"w-full border-t border-border"}),e.jsxs("div",{className:"text-center space-y-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:s("aiRecipe.selectTitle")}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:s("aiRecipe.selectDesc")})]}),e.jsxs("div",{className:"grid gap-3 w-full",children:[e.jsxs("button",{onClick:()=>t("/ai-recipe/what-to-eat",{state:{from:i}}),className:"flex items-start gap-3 p-4 sm:p-5 rounded-2xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group text-left",children:[e.jsx("div",{className:"w-11 h-11 sm:w-14 sm:h-14 rounded-xl bg-primary/10 flex items-center justify-center shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(P,{className:"h-5 w-5 sm:h-7 sm:w-7 text-primary"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:s("aiRecipe.whatToEat")}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:s("aiRecipe.whatToEatDesc")})]})]}),e.jsxs("button",{onClick:()=>{o()&&t("/ai-recipe/how-to-cook",{state:{from:i}})},className:"flex items-start gap-3 p-4 sm:p-5 rounded-2xl border-2 border-border hover:border-primary hover:bg-primary/5 transition-all duration-200 group text-left",children:[e.jsx("div",{className:"w-11 h-11 sm:w-14 sm:h-14 rounded-xl bg-accent flex items-center justify-center shrink-0 group-hover:scale-105 transition-transform",children:e.jsx(T,{className:"h-5 w-5 sm:h-7 sm:w-7 text-accent-foreground"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-base",children:s("aiRecipe.howToCook")}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:s("aiRecipe.howToCookDesc")})]})]})]})]})]})};export{be as default};
//# sourceMappingURL=AIRecipeSelect-D5hIZTtB.js.map
