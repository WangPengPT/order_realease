import{p as P,u as Y,r as f,s as y,j as e,cC as $,cO as G,cQ as J,cP as W,b0 as X,b5 as C,bS as S,aY as _,bc as N}from"./vendor-react-87iFmKFJ.js";import{S as p,a8 as D,a9 as O,aa as F,ab as R,ac as n,i as B,C as m,p as o,n as Z,F as ee,s as k}from"./index-C3xfGQgV.js";import{u as se}from"./useLocalizedContent-CFh79NZC.js";import{f as v,s as T}from"./vendor-utils-vwQGbBim.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-CQWbleDe.js";const de=()=>{const{t:a}=P(),V=Y(),{localizeRestaurant:z}=se(),[g,A]=f.useState("30days"),[w,q]=f.useState("rating"),[x,E]=f.useState("desc"),I=()=>{const s=new Date;switch(g){case"today":return v(s).toISOString();case"7days":return v(T(s,6)).toISOString();case"30days":return v(T(s,29)).toISOString();default:return null}},{data:b,isLoading:L}=y({queryKey:["admin-restaurants-stats-list"],queryFn:async()=>{const{data:s,error:t}=await k.from("restaurants").select("*").order("rating",{ascending:!1});if(t)throw t;return s}}),U=I(),{data:j}=y({queryKey:["admin-all-restaurant-stats-aggregated",g],queryFn:async()=>{const{data:s,error:t}=await k.rpc("get_restaurant_stats_aggregated",{p_date_filter:U??null});if(t)throw t;const r={},u={},h={};return s.forEach(l=>{r[l.restaurant_id]=Number(l.view_count),u[l.restaurant_id]=Number(l.comment_count),h[l.restaurant_id]=Number(l.favorite_count)}),{viewCounts:r,commentCounts:u,favoriteCounts:h}}}),i=j?.viewCounts,c=j?.commentCounts,d=j?.favoriteCounts,K=i?Object.values(i).reduce((s,t)=>s+t,0):0,Q=c?Object.values(c).reduce((s,t)=>s+t,0):0,H=d?Object.values(d).reduce((s,t)=>s+t,0):0,M=b?.slice().sort((s,t)=>{let r=0;switch(w){case"views":r=(i?.[t.id]||0)-(i?.[s.id]||0);break;case"comments":r=(c?.[t.id]||0)-(c?.[s.id]||0);break;case"favorites":r=(d?.[t.id]||0)-(d?.[s.id]||0);break;case"rating":default:r=(t.rating||0)-(s.rating||0)}return x==="desc"?r:-r});return L?e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-8 w-48"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(p,{className:"h-24"},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(s=>e.jsx(p,{className:"h-40"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-6 w-6 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:a("admin.restaurantStatistics","餐厅统计")})]}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(D,{value:w,onValueChange:s=>q(s),children:[e.jsx(O,{className:"w-[140px]",children:e.jsx(F,{})}),e.jsxs(R,{children:[e.jsx(n,{value:"rating",children:a("admin.sortByRating","按评分")}),e.jsx(n,{value:"views",children:a("admin.sortByViews","按浏览量")}),e.jsx(n,{value:"comments",children:a("admin.sortByComments","按评论数")}),e.jsx(n,{value:"favorites",children:a("admin.sortByFavorites","按收藏数")})]})]}),e.jsx(B,{variant:"outline",size:"icon",onClick:()=>E(x==="desc"?"asc":"desc"),title:x==="desc"?a("admin.sortDescending","从大到小"):a("admin.sortAscending","从小到大"),children:x==="desc"?e.jsx(J,{className:"h-4 w-4"}):e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(D,{value:g,onValueChange:s=>A(s),children:[e.jsx(O,{className:"w-[140px]",children:e.jsx(F,{})}),e.jsxs(R,{children:[e.jsx(n,{value:"today",children:a("analytics.today","今日")}),e.jsx(n,{value:"7days",children:a("analytics.last7Days","近7天")}),e.jsx(n,{value:"30days",children:a("analytics.last30Days","近30天")}),e.jsx(n,{value:"all",children:a("analytics.allTime","所有时间")})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(m,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(C,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.totalRestaurants","餐厅总数")}),e.jsx("p",{className:"text-2xl font-bold",children:b?.length||0})]})]})})}),e.jsx(m,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/10 rounded-lg",children:e.jsx(S,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.totalViews","总浏览量")}),e.jsx("p",{className:"text-2xl font-bold",children:K})]})]})})}),e.jsx(m,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-amber-500/10 rounded-lg",children:e.jsx(_,{className:"h-5 w-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.totalComments","总评论数")}),e.jsx("p",{className:"text-2xl font-bold",children:Q})]})]})})}),e.jsx(m,{children:e.jsx(o,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg",children:e.jsx(N,{className:"h-5 w-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:a("admin.totalFavorites","总收藏数")}),e.jsx("p",{className:"text-2xl font-bold",children:H})]})]})})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:a("admin.allRestaurants","所有餐厅")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M?.map(s=>{const t=z(s),r=i?.[s.id]||0,u=c?.[s.id]||0,h=d?.[s.id]||0;return e.jsxs(m,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>V(`/admin/restaurant-stats/${s.id}`),children:[e.jsx(Z,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:t.name,className:"w-12 h-12 rounded-lg object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(C,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ee,{className:"text-base line-clamp-1",children:t.name}),s.rating>0&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(N,{className:"h-3 w-3 fill-amber-400 text-amber-400"}),e.jsx("span",{children:s.rating.toFixed(1)})]})]})]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:r}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("admin.views","浏览")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:u}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("admin.comments","评论")})]}),e.jsxs("div",{className:"flex flex-col items-center p-2 bg-muted/50 rounded-lg",children:[e.jsx(N,{className:"h-4 w-4 text-muted-foreground mb-1"}),e.jsx("span",{className:"font-medium",children:h}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a("admin.favorites","收藏")})]})]}),e.jsx(B,{variant:"outline",size:"sm",className:"w-full mt-4",children:a("admin.viewDetails","查看详情")})]})]},s.id)})})]})]})};export{de as default};
//# sourceMappingURL=AdminRestaurantStatsList-Gc_43_h-.js.map
