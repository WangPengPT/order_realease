import{j as e}from"./vendor-ui-BO6fjm1h.js";import{a as Me,u as He,b as Xe,l as Ue,D as Je,c as Ke,d as Qe,e as Ge,S as Ee,M as Se,f as M,U as Ye,L as Ie,g as Ze,h as et,i as tt,j as st,I as at,B as Z,N as ye,F as rt,k as B,m as nt,n as ot,C as Te,o as $e,p as we,q as De,r as Le,E as it,s as lt,t as ct,v as dt,w as mt,H as ut,x as Oe,y as Fe,z as ht,A as xt,G as pt,J as gt}from"./index-CMe-28It.js";import{u as Pe,r,a as ze,L as ft}from"./vendor-react-CrHRjzzo.js";import{c as bt,g as vt,m as yt}from"./geolocation-DRm3QMsJ.js";import{a as wt,g as jt}from"./app-store-badge-CyCtXXOt.js";import{u as Nt}from"./useHomepageTemplates-CoEutXEv.js";import{u as kt}from"./usePageView-Cfxy2TgD.js";import{L as Be}from"./LocationPermissionDialog-DZsEjQHJ.js";import{u as Ce}from"./vendor-i18n-DWR4v88Y.js";import{P as St}from"./PullToRefresh-DbHw-Ks3.js";import{u as _t}from"./vendor-query-EnOED-MY.js";import{P as Ct,a as Rt,b as It}from"./popover-BvKn0yma.js";import{u as Tt,a as $t}from"./useRestaurants-craWN0mP.js";import{u as Dt,R as Lt,l as zt}from"./xiaoxiong-logo-clean-CV6AvdDY.js";import{u as At}from"./useLocalizedContent-S0TAoDtX.js";import{u as Mt}from"./useActivities-Ckr6UjMY.js";import"./vendor-charts-C50LysBY.js";import"./vendor-supabase-QnE9GqXs.js";import"./vendor-map-hWrxZwzm.js";/* empty css                  */const ke="https://tzdgqhwyzsxkxnncgzap.supabase.co",ge="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6ZGdxaHd5enN4a3hubmNnemFwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTg2ODgsImV4cCI6MjA3OTIzNDY4OH0.D76C4OkjQVWyMxtjjdOofpD8X_hEEoTtrXHqi4XSYUw",Et=["最近","附近","离我","距离","远近","近的","周边","周围","最近的","附近的","nearest","closest","nearby","near me","close to me","distance","around me","mais perto","próximo","perto de mim","distância","mais próximo"],Ot=()=>{const n="xiaoxiong_anonymous_user_id";let i=localStorage.getItem(n);return i||(i=`anon_${Date.now()}_${Math.random().toString(36).substring(2,11)}`,localStorage.setItem(n,i)),i},Ft=({open:n,onOpenChange:i,provider:b="ask-xiaoxiong"})=>{const{i18n:x}=Ce(),m=Pe(),{settings:L}=Me(),{user:V}=He(),T=Xe(),d=L?.logo_url||Ue,[N,_]=r.useState(""),[v,y]=r.useState([]),[j,z]=r.useState(!1),[g,J]=r.useState(null),[K,Q]=r.useState(!1),[C,W]=r.useState(null),[R,H]=r.useState(!1),[q,w]=r.useState(!1),u=r.useRef(null),X=r.useRef(null),p=r.useRef(null),ee=r.useRef(null),fe=()=>{if(!q)return!1;const s=typeof window<"u"?window.innerWidth:1024,l=s>=768&&s<1024,t=s>=1024;return T?L?.voice_input_mobile!==!1:l?L?.voice_input_tablet!==!1:t?L?.voice_input_desktop!==!1:!0},be=()=>V?.id?V.id:Ot();r.useEffect(()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;w(!!s)},[]),r.useEffect(()=>{n&&!g&&navigator.geolocation?.getCurrentPosition(s=>{J({lat:s.coords.latitude,lng:s.coords.longitude})},s=>{console.log("Unable to get user location:",s.message)},{enableHighAccuracy:!1,timeout:5e3,maximumAge:3e5})},[n,g]),r.useEffect(()=>{!n&&p.current&&(p.current.stop(),H(!1))},[n]),r.useEffect(()=>{ee.current?.scrollIntoView({behavior:"smooth"})},[v]);const te=async(s,l)=>{const t=await fetch(`${ke}/functions/v1/ask-xiaoxiong`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ge}`,apikey:ge},body:JSON.stringify({text:s.content,stream:!0,lat:g?.lat,lng:g?.lng}),signal:u.current?.signal});if(!t.ok)throw new Error(`Request failed with status: ${t.status}`);if(!t.body)throw new Error("No response body");const a=t.body.getReader(),o=new TextDecoder;let h="";for(;;){const{done:S,value:$}=await a.read();if(S)break;const he=o.decode($,{stream:!0});h+=he;let D=h;D.startsWith('"')&&(D=D.slice(1)),D.endsWith('"')&&(D=D.slice(0,-1)),D=D.replace(/\\n/g,`
`),y(U=>U.map(F=>F.id===l?{...F,content:D}:F))}let f=h;f.startsWith('"')&&(f=f.slice(1)),f.endsWith('"')&&(f=f.slice(0,-1)),f=f.replace(/\\n/g,`
`),y(S=>S.map($=>$.id===l?{...$,content:f,isStreaming:!1}:$))},se=async(s,l)=>{const t=be(),a=Date.now();console.log(`[前端-Agent] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const o=await fetch(`${ke}/functions/v1/xiaoxiong-agent`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ge}`,apikey:ge},body:JSON.stringify({message:s.content,userId:t}),signal:u.current?.signal}),h=Date.now()-a;if(console.log(`[前端-Agent] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${h}ms`),!o.ok)throw new Error(`Request failed with status: ${o.status}`);if(!o.body)throw new Error("No response body");const f=o.body.getReader(),S=new TextDecoder;let $="",he=!1,D=0;for(;;){const{done:U,value:F}=await f.read();if(U){console.log(`[前端-Agent] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-a}ms, 共 ${D} 个数据块`);break}D++;const P=S.decode(F,{stream:!0});if($+=P,!he){he=!0;const oe=Date.now()-a;console.log(`[前端-Agent] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${oe}ms, 大小: ${P.length} 字符`)}ze.flushSync(()=>{y(oe=>oe.map(ve=>ve.id===l?{...ve,content:$}:ve))}),await new Promise(oe=>requestAnimationFrame(oe))}y(U=>U.map(F=>F.id===l?{...F,isStreaming:!1}:F))},xe=async(s,l)=>{const t=Date.now();console.log(`[前端-LovableAI] ⏱️ 开始发送请求: ${new Date().toISOString()}`);const a=await fetch(`${ke}/functions/v1/lovable-chat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ge}`,apikey:ge},body:JSON.stringify({message:s.content,lat:g?.lat,lng:g?.lng,language:x.language}),signal:u.current?.signal}),o=Date.now()-t;if(console.log(`[前端-LovableAI] ⏱️ 收到响应头: ${new Date().toISOString()}, 耗时: ${o}ms`),!a.ok){const D=await a.json().catch(()=>({}));throw new Error(D.error||`Request failed with status: ${a.status}`)}if(!a.body)throw new Error("No response body");const h=a.body.getReader(),f=new TextDecoder;let S="",$="",he=!1;for(;;){const{done:D,value:U}=await h.read();if(D){console.log(`[前端-LovableAI] ⏱️ 流结束: ${new Date().toISOString()}, 总耗时: ${Date.now()-t}ms`);break}if($+=f.decode(U,{stream:!0}),!he){he=!0;const P=Date.now()-t;console.log(`[前端-LovableAI] ⏱️ 首个数据块 (TTFB): ${new Date().toISOString()}, 耗时: ${P}ms`)}let F;for(;(F=$.indexOf(`
`))!==-1;){let P=$.slice(0,F);if($=$.slice(F+1),P.endsWith("\r")&&(P=P.slice(0,-1)),P.startsWith(":")||P.trim()===""||!P.startsWith("data: "))continue;const oe=P.slice(6).trim();if(oe==="[DONE]")break;try{const Re=JSON.parse(oe).choices?.[0]?.delta?.content;Re&&(S+=Re,ze.flushSync(()=>{y(je=>je.map(Ne=>Ne.id===l?{...Ne,content:S}:Ne))}),await new Promise(je=>requestAnimationFrame(je)))}catch{$=P+`
`+$;break}}}y(D=>D.map(U=>U.id===l?{...U,isStreaming:!1}:U))},ae=s=>{const l=s.toLowerCase();return Et.some(t=>l.includes(t))},Y=async s=>{const l={id:Date.now().toString(),role:"user",content:s},t=(Date.now()+1).toString(),a={id:t,role:"assistant",content:"",isStreaming:!0};y(o=>[...o,l,a]),_(""),z(!0),u.current&&u.current.abort(),u.current=new AbortController;try{b==="lovable-ai"?await xe(l,t):b==="xiaoxiong-agent"?await se(l,t):await te(l,t)}catch(o){if(o instanceof Error&&o.name==="AbortError"){console.log("Request aborted");return}console.error("Ask API error:",o);const h=x.language==="zh"?"抱歉，暂时无法获取结果，请稍后再试":x.language==="pt"?"Desculpe, não foi possível obter resultados. Tente novamente mais tarde.":"Sorry, unable to get results. Please try again later.";y(f=>f.map(S=>S.id===t?{...S,content:h,isStreaming:!1}:S))}finally{z(!1)}},ie=()=>{Q(!1),navigator.geolocation?.getCurrentPosition(s=>{J({lat:s.coords.latitude,lng:s.coords.longitude}),C&&setTimeout(()=>{Y(C),W(null)},100)},s=>{console.log("Location permission denied:",s.message),C&&(Y(C),W(null))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},re=async()=>{if(!N.trim()||j)return;const s=N.trim();if(!g&&ae(s)){W(s),Q(!0),_("");return}await Y(s)},le=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),re())},c=()=>{const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){console.log("Speech recognition not supported");return}p.current&&p.current.stop();const l=new s;p.current=l;const t={zh:"zh-CN",en:"en-US",pt:"pt-BR"};l.lang=t[x.language]||"zh-CN",l.continuous=!1,l.interimResults=!0,l.onstart=()=>{H(!0)},l.onresult=a=>{const o=Array.from(a.results).map(h=>h[0].transcript).join("");_(o)},l.onerror=a=>{console.log("Speech recognition error:",a.error),H(!1)},l.onend=()=>{H(!1)},l.start()},I=()=>{p.current&&(p.current.stop(),H(!1))},E=()=>{R?I():c()},k=()=>{u.current&&u.current.abort(),i(!1)},ce=s=>{k(),m(s)},A=s=>{const l=/\[([^\]]+)\]\(([^)]+)\)/g,t=[];let a=0,o,h=0;for(;(o=l.exec(s))!==null;){o.index>a&&t.push(e.jsx("span",{children:s.slice(a,o.index)},h++));const f=o[1],S=o[2];S.startsWith("/")?t.push(e.jsx("button",{onClick:()=>ce(S),className:"text-primary hover:underline font-medium cursor-pointer",children:f},h++)):t.push(e.jsx("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline font-medium",children:f},h++)),a=o.index+o[0].length}return a<s.length&&t.push(e.jsx("span",{children:s.slice(a)},h++)),t.length>0?t:[e.jsx("span",{children:s},"0")]},de=s=>s.replace(/\*\*(.*?)\*\*/g,"$1"),G=(s,l=20)=>s.length<=l?s:s.slice(0,l)+"...",pe=(s,l)=>{const t=h=>h.split("|").slice(1,-1).map(f=>de(f.trim())),a=t(s[0]),o=s.slice(2).map(t);return e.jsx("div",{className:"overflow-x-auto my-2 max-w-full",children:e.jsxs("table",{className:"w-full text-xs border border-border rounded-md overflow-hidden table-fixed",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsx("tr",{children:a.map((h,f)=>e.jsx("th",{className:"px-2 py-2 text-left font-semibold border-b border-border truncate max-w-[100px]",title:h,children:A(G(h,15))},f))})}),e.jsx("tbody",{children:o.map((h,f)=>e.jsx("tr",{className:"border-b border-border last:border-0 hover:bg-muted/30 transition-colors",children:h.map((S,$)=>e.jsx("td",{className:"px-2 py-2 truncate max-w-[100px]",title:S,children:A(G(S,18))},$))},f))})]})},l)},ne=s=>{const l=s.split(`
`),t=[];let a=0;for(;a<l.length;){const o=l[a];if(o.trim().startsWith("|")&&o.split("|").length>2){const h=[];for(;a<l.length&&l[a].trim().startsWith("|");)h.push(l[a]),a++;h.length>=2&&t.push(pe(h,t.length));continue}if(o.startsWith("### "))t.push(e.jsx("h3",{className:"text-base font-semibold mt-3 mb-1",children:A(o.slice(4))},t.length));else if(o.startsWith("## "))t.push(e.jsx("h2",{className:"text-lg font-bold mt-4 mb-2",children:A(o.slice(3))},t.length));else if(o.startsWith("# "))t.push(e.jsx("h1",{className:"text-xl font-bold mt-4 mb-2",children:A(o.slice(2))},t.length));else if(o.includes("**")){const h=o.split(/\*\*(.*?)\*\*/g);t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:h.map((f,S)=>S%2===1?e.jsx("strong",{className:"font-semibold",children:A(f)},S):A(f))},t.length))}else o.startsWith("- ")||o.startsWith("* ")?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-disc",children:A(o.slice(2))},t.length)):/^\d+\.\s/.test(o)?t.push(e.jsx("li",{className:"ml-4 mb-0.5 list-decimal",children:A(o.replace(/^\d+\.\s/,""))},t.length)):o.match(/^[-*_]{3,}$/)?t.push(e.jsx("hr",{className:"my-3 border-border"},t.length)):o.trim()===""?t.push(e.jsx("div",{className:"h-1"},t.length)):t.push(e.jsx("p",{className:"mb-1 leading-relaxed",children:A(o)},t.length));a++}return t},me=()=>x.language==="zh"?"小熊AI助手":x.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant",O=()=>x.language==="zh"?"告诉小熊，你想吃什么...":x.language==="pt"?"Diga ao Xiaoxiong o que você quer comer...":"Tell Xiaoxiong what you want to eat...",ue=()=>x.language==="zh"?"你好，我是小熊，我来帮你推荐餐厅；比如：「我附近的寿司餐厅」":x.language==="pt"?"Olá, eu sou o Xiaoxiong, vou te ajudar a encontrar restaurantes; por exemplo: 「restaurantes de sushi perto de mim」":`Hi, I'm Xiaoxiong, I'll help you find restaurants; for example: "sushi restaurants near me"`;return e.jsx(Je,{open:n,onOpenChange:k,children:e.jsxs(Ke,{className:"w-full h-full max-w-full max-h-full sm:max-w-lg sm:h-[70vh] sm:max-h-[70vh] sm:rounded-lg rounded-none flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(Qe,{className:"px-4 py-3 border-b shrink-0 bg-primary/5",children:e.jsxs(Ge,{className:"flex items-center gap-2 text-base",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:d,alt:"Logo",className:"w-6 h-6 object-contain"})}),me()]})}),e.jsx(Ee,{className:"flex-1 h-0",ref:X,children:e.jsxs("div",{className:"p-4 space-y-4",children:[v.length===0&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(Se,{className:"w-4 h-4 text-primary"})}),e.jsx("div",{className:"flex-1 bg-muted/50 rounded-2xl rounded-tl-sm px-4 py-3 text-sm",children:ue()})]}),v.map(s=>e.jsxs("div",{className:M("flex gap-3",s.role==="user"&&"flex-row-reverse"),children:[e.jsx("div",{className:M("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s.role==="user"?"bg-primary text-primary-foreground":"bg-primary/10"),children:s.role==="user"?e.jsx(Ye,{className:"h-4 w-4"}):e.jsx(Se,{className:"h-4 w-4"})}),e.jsx("div",{className:M("flex-1 max-w-[85%] rounded-2xl px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground rounded-tr-sm":"bg-muted/50 rounded-tl-sm"),children:s.role==="assistant"?e.jsxs(e.Fragment,{children:[s.content?e.jsx("div",{className:"prose-sm",children:ne(s.content)}):e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ie,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:x.language==="zh"?"思考中...":x.language==="pt"?"Pensando...":"Thinking..."})]}),s.isStreaming&&s.content&&e.jsx("span",{className:"inline-block w-1.5 h-4 bg-primary/50 animate-pulse ml-0.5 align-middle"})]}):s.content})]},s.id)),e.jsx("div",{ref:ee})]})}),e.jsx("div",{className:"p-4 bg-background shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full border border-border/50 bg-muted/20 shadow-sm hover:shadow-md transition-shadow duration-200",children:[fe()&&e.jsx("button",{onClick:E,disabled:j,className:M("shrink-0 p-2 rounded-full transition-all duration-200 hover:bg-muted",R&&"text-destructive animate-pulse"),title:x.language==="zh"?R?"停止录音":"语音输入":x.language==="pt"?R?"Parar gravação":"Entrada de voz":R?"Stop recording":"Voice input",children:R?e.jsx(Ze,{className:"h-5 w-5"}):e.jsx(et,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("input",{value:N,onChange:s=>_(s.target.value),onKeyDown:le,placeholder:R?x.language==="zh"?"正在聆听...":x.language==="pt"?"Ouvindo...":"Listening...":O(),disabled:j,className:"flex-1 bg-transparent border-0 outline-none text-foreground placeholder:text-muted-foreground",autoFocus:!0}),e.jsx("button",{onClick:re,disabled:!N.trim()||j,className:M("shrink-0 p-2 rounded-full transition-all duration-200",N.trim()&&!j?"text-primary hover:bg-primary/10":"text-muted-foreground/50"),children:j?e.jsx(Ie,{className:"h-5 w-5 animate-spin"}):e.jsx(tt,{className:"h-5 w-5"})})]})}),e.jsx(Be,{open:K,onOpenChange:s=>{Q(s),!s&&C&&(Y(C),W(null))},onConfirm:ie})]})})},Ae=({restaurant:n,language:i})=>{const[b,x]=r.useState(999),m=r.useRef(null),L=n.type.slice(0,3).map((d,N)=>({key:`type-${N}`,label:d,variant:"secondary",color:void 0}));r.useEffect(()=>{const d=()=>{if(!m.current)return;const _=m.current,v=Array.from(_.querySelectorAll(".tag-badge"));if(v.length===0){setTimeout(d,50);return}const y=v[0]?.offsetTop;let j=v.length;for(let z=0;z<v.length;z++)if(v[z].offsetTop>y){j=z;break}j<v.length&&(j=Math.max(1,j-1)),x(j)};x(999);const N=setTimeout(d,100);return window.addEventListener("resize",d),()=>{clearTimeout(N),window.removeEventListener("resize",d)}},[L.length,n.id]);const V=L.slice(0,b),T=L.length>b;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{ref:m,className:"flex gap-1.5 flex-wrap flex-1",children:V.map(d=>e.jsx(B,{variant:d.variant,className:"text-xs font-medium whitespace-nowrap tag-badge",style:d.color?{backgroundColor:d.color,color:"white"}:void 0,children:d.label},d.key))}),T&&e.jsxs(Ct,{children:[e.jsx(Rt,{asChild:!0,children:e.jsx(Z,{variant:"ghost",size:"sm",className:"h-6 px-2 text-muted-foreground hover:text-foreground flex-shrink-0",children:e.jsx(it,{className:"h-4 w-4"})})}),e.jsx(It,{className:"w-80",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:L.map(d=>e.jsx(B,{variant:d.variant,className:"text-xs font-medium",style:d.color?{backgroundColor:d.color,color:"white"}:void 0,children:d.label},d.key))})})]})]})},Pt=()=>{const n=Pe(),{t:i,i18n:b}=Ce(),{toast:x}=st(),{localizeRestaurant:m}=At(),[L,V]=r.useState(""),[T,d]=r.useState([]),[N,_]=r.useState(null),[v,y]=r.useState([]),[j,z]=r.useState(null),[g,J]=r.useState(null),[K,Q]=r.useState(!1),[C,W]=r.useState(!1),[R,H]=r.useState(!1),q=r.useRef(null),w=r.useRef(null),u=r.useRef({}),[X,p]=r.useState(null),[ee,fe]=r.useState(!1),[be,te]=r.useState(!1),[se,xe]=r.useState(!1),[ae,Y]=r.useState(!1),ie=4,{data:re,isLoading:le}=Tt(L,T.length>0?T.join(","):void 0),{data:c=[]}=$t(),{data:I=[]}=Mt(),{data:E={}}=Dt(),k=I.filter(t=>(E[t.id]||0)>0),ce=t=>{d(a=>a.includes(t)?a.filter(o=>o!==t):[...a,t])},A=()=>{te(!0)},de=async()=>{te(!1);try{const t=await vt();J({lat:t.coords.latitude,lng:t.coords.longitude}),x({title:i("restaurants.locationEnabled"),description:i("restaurants.sortByDistance")})}catch(t){console.error("Location error:",t)}},G=t=>{z(t),t&&!g&&A()},pe=async t=>{if(N===t)_(null),y([]);else{_(t);const{data:a,error:o}=await lt.from("activity_restaurants").select("restaurant_id").eq("activity_id",t);o?(console.error("Error fetching activity restaurants:",o),y([])):y(a.map(h=>h.restaurant_id))}},ne=re?.map(t=>{const a=m(t);if(g){const o=bt(g.lat,g.lng,t.lat,t.lng);return{...a,distance:o}}return a})||[],me=N?ne.filter(t=>v.includes(t.id)):ne,O=j&&g?me.filter(t=>t.distance&&t.distance<=j).sort((t,a)=>(t.distance||0)-(a.distance||0)):g?me.sort((t,a)=>(t.distance||0)-(a.distance||0)):me.sort((t,a)=>(a.rating||0)-(t.rating||0)),ue=t=>{n(`/restaurant/${t.id}`)},s=t=>{p(t.id);const a=u.current[t.id];a&&a.scrollIntoView({behavior:"smooth",block:"center"})},l=()=>{const t=document.getElementById("home-map-container");if(t)if(K)document.exitFullscreen&&document.exitFullscreen();else{if(q.current){const a=q.current.getCenter(),o=q.current.getZoom();w.current={center:[a.lng,a.lat],zoom:o}}t.requestFullscreen&&t.requestFullscreen()}};return r.useEffect(()=>{const t=()=>{const a=!!document.fullscreenElement;Q(a),!a&&w.current&&q.current&&setTimeout(()=>{q.current?.jumpTo({center:w.current.center,zoom:w.current.zoom})},100)};return document.addEventListener("fullscreenchange",t),()=>{document.removeEventListener("fullscreenchange",t)}},[]),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"text-left mb-8 sm:mb-10",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-primary mb-2 sm:mb-3",children:i("nav.mapView")}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground",children:i("map.subtitle")})]}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-3",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(at,{placeholder:i("restaurants.search"),value:L,onChange:t=>V(t.target.value),className:"h-11 bg-background/60 backdrop-blur-sm border-primary/20 focus:border-primary"})}),e.jsxs("div",{className:"flex gap-2 md:contents",children:[e.jsxs(Z,{variant:g?"default":"outline",onClick:g?void 0:A,className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(ye,{className:`w-4 h-4 ${g?"animate-pulse":""}`}),e.jsx("span",{className:"md:hidden",children:i("restaurants.getLocationMobile")}),e.jsx("span",{className:"hidden md:inline",children:i(g?"restaurants.locationEnabled":"restaurants.getLocation")})]}),e.jsxs(Z,{variant:ee?"default":"outline",onClick:()=>fe(!ee),className:"flex-1 md:flex-initial gap-2 h-11 md:px-6",children:[e.jsx(rt,{className:"w-4 h-4"}),i("restaurants.filter")]})]})]}),ee&&e.jsxs("div",{className:"space-y-3 bg-card/50 backdrop-blur-sm rounded-lg p-4 border border-border/50 animate-fade-in",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("restaurants.restaurantTypes"),":"]}),T.length>0&&e.jsx(B,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>d([]),children:i("common.actions.clearFilter")}),c.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>W(!C),children:i(C?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${C?"animate-expand-height":""}`,children:(C?c:c.slice(0,8)).map((t,a)=>e.jsx(B,{variant:T.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${T.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ce(t),children:t},t))}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:c.map((t,a)=>e.jsx(B,{variant:T.includes(t)?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${T.includes(t)?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>ce(t),children:t},t))}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]}),k.length>0&&e.jsxs("div",{className:"space-y-2 pt-1 border-t border-border/30",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-sm font-semibold text-foreground",children:[i("nav.activities"),":"]}),N&&e.jsx(B,{variant:"outline",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground hover:scale-105 transition-all duration-200 px-2 py-0 text-xs h-5",onClick:()=>{_(null),y([])},children:i("common.actions.clearFilter")}),k.length>8&&e.jsx(Z,{variant:"ghost",size:"sm",className:"h-5 px-2 text-xs text-primary hover:text-primary/80 ml-auto hidden sm:flex transition-all duration-200",onClick:()=>H(!R),children:i(R?"common.showLess":"common.showMore")})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`hidden sm:flex gap-2 flex-wrap transition-all duration-300 ease-out ${R?"animate-expand-height":""}`,children:(R?k:k.slice(0,8)).map((t,a)=>{const o=b.language==="zh"?t.badge_text_zh||t.title_zh:b.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(B,{variant:N===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap hover:scale-105 active:animate-tag-select ${N===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>pe(t.id),children:o},t.id)})}),e.jsxs("div",{className:"sm:hidden relative -mx-1 px-1",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide snap-x snap-mandatory scroll-smooth",children:k.map((t,a)=>{const o=b.language==="zh"?t.badge_text_zh||t.title_zh:b.language==="pt"?t.badge_text_pt||t.title_pt:t.badge_text_en||t.title_en;return e.jsx(B,{variant:N===t.id?"default":"secondary",className:`cursor-pointer transition-all duration-200 px-3 py-1.5 text-xs whitespace-nowrap flex-shrink-0 snap-start hover:scale-105 active:animate-tag-select ${N===t.id?"ring-2 ring-primary/30 shadow-sm":""}`,style:{animationDelay:`${a*30}ms`},onClick:()=>pe(t.id),children:o},t.id)})}),e.jsx("div",{className:"absolute left-0 top-0 bottom-2 w-4 bg-gradient-to-r from-card via-card/60 to-transparent pointer-events-none"}),e.jsx("div",{className:"absolute right-0 top-0 bottom-2 w-4 bg-gradient-to-l from-card via-card/60 to-transparent pointer-events-none"})]})]})]})]}),g&&e.jsxs("div",{className:"flex gap-2 flex-wrap items-center bg-muted/30 backdrop-blur-sm rounded-lg p-3 border border-primary/10",children:[e.jsxs("span",{className:"text-sm font-semibold text-primary",children:[i("restaurants.radius"),":"]}),e.jsx(B,{variant:j===null?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(null),children:i("restaurants.allRestaurants")}),e.jsx(B,{variant:j===5?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(5),children:i("restaurants.radius5km")}),e.jsx(B,{variant:j===10?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(10),children:i("restaurants.radius10km")}),e.jsx(B,{variant:j===20?"default":"secondary",className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>G(20),children:i("restaurants.radius20km")})]})]}),!le&&O&&e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:`w-full lg:flex-1 transition-all duration-300 ease-in-out ${se?"h-0 overflow-hidden lg:h-[500px]":"h-[400px] lg:h-[500px]"}`,children:e.jsxs("div",{id:"home-map-container",className:`${K?"fixed inset-0 z-50 bg-background":"w-full h-full"} rounded-xl overflow-hidden shadow-2xl border border-primary/10 relative group`,children:[e.jsx(Z,{variant:"secondary",size:"icon",className:"absolute bottom-4 right-4 z-10 shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:l,children:K?e.jsx(nt,{className:"w-5 h-5"}):e.jsx(ot,{className:"w-5 h-5"})}),e.jsxs("div",{className:"h-full relative",children:[e.jsx(Lt,{restaurants:O,onRestaurantClick:ue,userLocation:g,radiusFilter:j,onMarkerClick:s,showViewDetailsButton:!0,onMapInit:t=>{q.current=t}}),e.jsxs("div",{className:"absolute bottom-4 left-4 z-10 pointer-events-none flex items-center gap-2 bg-background/80 backdrop-blur-sm px-3 py-2 rounded-full shadow-lg",children:[e.jsx("img",{src:zt,alt:"Xiaoxiong Market Logo",className:"h-6 w-6 object-contain"}),e.jsx("span",{className:"text-sm font-semibold text-foreground whitespace-nowrap",children:b.language==="zh"?"小熊市场":"Xiaoxiong Market"})]})]})]})}),e.jsx(Z,{variant:"outline",size:"sm",className:"lg:hidden flex items-center justify-center gap-2 -mt-3 mb-1",onClick:()=>xe(!se),children:se?e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),i("map.showMap")]}):e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),i("map.hideMap")]})}),e.jsxs("div",{className:"w-full lg:w-[420px] flex flex-col",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(we,{className:"w-6 h-6 text-primary"}),i("restaurants.title"),e.jsx(B,{variant:"secondary",className:"ml-2",children:O.length})]}),g&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-center gap-1.5",children:[e.jsx(ye,{className:"w-4 h-4"}),i("restaurants.sortedByDistance")]})]}),O.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(we,{className:"w-16 h-16 text-muted-foreground/40 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-foreground mb-2",children:i("restaurants.noResults")}),e.jsx("p",{className:"text-muted-foreground max-w-xs",children:i("restaurants.noResultsDesc")})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:hidden space-y-3 pb-4",children:[(ae?O:O.slice(0,ie)).map(t=>e.jsx(De,{ref:a=>u.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${X===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>ue(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(Le,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ae,{restaurant:t,language:b.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id)),O.length>ie&&e.jsx(Z,{variant:"outline",className:"w-full mt-2 gap-2",onClick:()=>Y(!ae),children:ae?e.jsxs(e.Fragment,{children:[e.jsx($e,{className:"w-4 h-4"}),i("map.collapseList")]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),i("map.showAllRestaurants",{count:O.length})]})})]}),e.jsx(Ee,{className:"hidden lg:block h-[420px] pr-4",children:e.jsx("div",{className:"space-y-3 pb-4",children:O.map(t=>e.jsx(De,{ref:a=>u.current[t.id]=a,className:`p-5 cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-[1.02] hover:border-primary/40 border-2 bg-gradient-to-br from-card to-card/50 backdrop-blur-sm ${X===t.id?"border-primary ring-2 ring-primary ring-offset-2":"border-transparent"}`,onClick:()=>ue(t),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{className:"font-bold text-lg text-foreground line-clamp-1 flex-1",children:t.name}),t.distance!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full w-fit",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.distance<1?`${(t.distance*1e3).toFixed(0)} m`:`${t.distance.toFixed(1)} km`})]})]}),t.rating>0&&e.jsxs("div",{className:"flex items-center gap-1.5 bg-primary/10 px-2.5 py-1 rounded-full flex-shrink-0",children:[e.jsx(Le,{className:"w-4 h-4",style:{fill:"#016450",color:"#016450"}}),e.jsx("span",{className:"font-bold text-sm text-primary",children:t.rating})]})]}),t.type&&t.type.length>0&&e.jsx(Ae,{restaurant:t,language:b.language}),e.jsxs("div",{className:"flex items-start gap-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0 text-primary/60"}),e.jsx("span",{className:"line-clamp-2",children:t.address})]})]})},t.id))})})]})]})]}),e.jsx(Be,{open:be,onOpenChange:te,onConfirm:de})]})},_e="/images/sushi-ramen-hero.jpg",Ve="/images/sushi-ramen-mobile.jpg",We=r.memo(({stats:n,t:i})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:n.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:i("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:n.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:i("home.hero.brandName")}),e.jsx("img",{src:yt,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));We.displayName="StatsDisplay";const Bt=()=>{const n=window.innerWidth<640,i=window.innerWidth>=1024,b=navigator.connection,x=Fe(),m=Oe();return i?!!b?.saveData:!!(m&&!x||b&&(b.saveData||b.effectiveType==="2g"||b.effectiveType==="slow-2g")||n&&navigator.deviceMemory&&navigator.deviceMemory<2)},qe=r.memo(({template:n,isActive:i,currentLang:b,t:x,onContentReady:m,onAskXiaoxiong:L})=>{const[V,T]=r.useState({}),[d,N]=r.useState({}),[_,v]=r.useState({}),[y,j]=r.useState({mobile:!0,tablet:!0,desktop:!0}),[z,g]=r.useState(!1),J=Bt(),K=r.useRef(null),Q=r.useRef(null),C=r.useRef(null),W=c=>n[`${c}${b==="zh"?"_zh":b==="pt"?"_pt":"_en"}`]||"",R=()=>window.innerWidth<640?"mobile":window.innerWidth<1024?"tablet":"desktop",H=()=>{const c=R();return c==="mobile"&&n.mobile_overlay_opacity!==null?n.mobile_overlay_opacity:c==="tablet"&&n.tablet_overlay_opacity!==null?n.tablet_overlay_opacity:c==="desktop"&&n.desktop_overlay_opacity!==null?n.desktop_overlay_opacity:n.overlay_opacity??30},q=()=>{const c=H(),I=n.overlay_gradient_direction||"to-b",E=(s,l)=>s==null?l/100:s>1?s/100:s,k=c>1?c/100:c,ce=E(n.overlay_gradient_from_opacity,30)*k,A=E(n.overlay_gradient_via_opacity,25)*k,de=E(n.overlay_gradient_to_opacity,40)*k,pe={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[I]||"to bottom",ne={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},me=ne[n.overlay_gradient_from||"black"]||"0, 0, 0",O=ne[n.overlay_gradient_via||"black"]||"0, 0, 0",ue=ne[n.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${pe}, rgba(${me}, ${ce}), rgba(${O}, ${A}), rgba(${ue}, ${de}))`}},w=n.mobile_image_url||Ve,u=n.tablet_image_url||n.desktop_image_url||_e,X=n.desktop_image_url||_e,p=n.background_blur||0,ee=n.desktop_media_type||n.media_type||"image",fe=n.tablet_media_type||n.media_type||"image",be=n.mobile_media_type||n.media_type||"image",te=ee==="video"&&!J,se=fe==="video"&&!J,xe=be==="video"&&!J,ae=xe?n.mobile_video_url:null,Y=se?n.tablet_video_url||n.desktop_video_url:null,ie=te?n.desktop_video_url:null;r.useEffect(()=>{const c=R(),I=c==="mobile"?w:c==="tablet"?u:X;if(I){const E=new Image;E.onload=()=>{T(k=>({...k,[c]:!0})),j(k=>({...k,[c]:!0})),i&&(m?.(),setTimeout(()=>g(!0),100))},E.src=I}},[w,u,X,i,m]),r.useEffect(()=>{i&&V[R()]&&g(!0)},[i,V]);const re=c=>{N(I=>({...I,[c]:!0}))},le=(c,I)=>{console.error(`[HeroSlide] Video error on ${c}:`,I),v(E=>({...E,[c]:!0}))};return r.useEffect(()=>{if(!z||!i||!gt())return;const I=R(),k=(I==="mobile"?K:I==="tablet"?Q:C).current;if(!k)return;const A=setTimeout(async()=>{try{k.muted=!0,k.playsInline=!0,k.setAttribute("webkit-playsinline","true"),await k.play(),console.log(`[HeroSlide] iOS video play successful on ${I}`)}catch(de){console.error(`[HeroSlide] iOS video play failed on ${I}:`,de),v(G=>({...G,[I]:!0}))}},150);return()=>clearTimeout(A)},[z,i]),e.jsxs("div",{className:M("absolute inset-0 w-full h-full transition-opacity duration-1000",i?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!y.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),xe&&ae?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:w,alt:"Background",className:M("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",d.mobile&&!_.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),z&&!_.mobile&&e.jsx("video",{ref:K,src:ae,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("mobile"),onError:c=>le("mobile",c),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:w,alt:"Background",className:M("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",y.mobile?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!y.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),se&&Y?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:u,alt:"Background",className:M("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",d.tablet&&!_.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),z&&!_.tablet&&e.jsx("video",{ref:Q,src:Y,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("tablet"),onError:c=>le("tablet",c),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:u,alt:"Background",className:M("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",y.tablet?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!y.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),te&&ie?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:X,alt:"Background",className:M("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",d.desktop&&!_.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),z&&!_.desktop&&e.jsx("video",{ref:C,src:ie,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>re("desktop"),onError:c=>le("desktop",c),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:X,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:M("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",y.desktop?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:q()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:W("title")||x("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:W("description")||x("home.hero.description")}),n.subtitle_button_text_zh&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:L,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(Se,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:W("subtitle_button_text")||x("home.hero.subtitle")}),e.jsx(mt,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]})})]})})]})});qe.displayName="HeroSlide";const ls=()=>{const{t:n,i18n:i}=Ce(),b=_t(),{settings:x}=Me(),{data:m,isLoading:L,refetch:V}=Nt(),[T,d]=r.useState(0),[N,_]=r.useState(null),v=r.useRef(null),[y,j]=r.useState(!1),[z,g]=r.useState(!1),J=x?.ai_assistant_enabled!==!1,K=x?.ai_provider||"ask-xiaoxiong",Q=r.useCallback(()=>{j(!0)},[]);kt({pageType:"home"});const C=r.useCallback(async()=>{try{const u=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();u&&_({order_count:u.order_count||0,reserve_count:u.reserve_count||0})}catch(w){console.error("Failed to fetch stats:",w)}},[]);r.useEffect(()=>{C()},[C]);const W=r.useCallback(async()=>{await Promise.all([V(),C(),b.invalidateQueries({queryKey:["restaurants"]}),b.invalidateQueries({queryKey:["activities"]})])},[V,C,b]);r.useEffect(()=>{if(!m||m.length<=1)return;const u=m[T]?.duration||5e3;return v.current=setTimeout(()=>{d(X=>(X+1)%m.length)},u),()=>{v.current&&clearTimeout(v.current)}},[m,T]);const R=r.useCallback(w=>{v.current&&clearTimeout(v.current),d(w)},[]);r.useCallback(()=>{m&&(v.current&&clearTimeout(v.current),d(w=>(w-1+m.length)%m.length))},[m]),r.useCallback(()=>{m&&(v.current&&clearTimeout(v.current),d(w=>(w+1)%m.length))},[m]);const H=i.language,q=m&&m.length>1;return e.jsx(St,{onRefresh:W,children:e.jsxs("div",{className:"min-h-screen",children:[e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[N&&e.jsx(We,{stats:N,t:n}),e.jsx("div",{className:M("absolute inset-0 w-full h-full transition-opacity duration-500",y?"opacity-100":"opacity-0"),children:m?.map((w,u)=>e.jsx(qe,{template:w,isActive:u===T,currentLang:H,t:n,onContentReady:u===0?Q:void 0,onAskXiaoxiong:()=>g(!0)},w.id))}),e.jsx("div",{className:M("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",L||!y?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(ut,{})}),!L&&(!m||m.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:Ve,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:_e,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:n("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:n("home.hero.description")})]})})]}),q&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:m.map((w,u)=>e.jsx("button",{onClick:()=>R(u),className:M("w-3 h-3 rounded-full transition-all duration-300",u===T?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${u+1}`},u))})]}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(Pt,{})})}),!Oe()&&!Fe()&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 bg-gradient-to-br from-primary/5 via-background to-primary/10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-1/4 w-72 h-72 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/2 left-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"absolute top-1/2 right-0 w-32 h-32 bg-primary/20 rounded-full blur-2xl -translate-y-1/2"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(ht,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:n("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:n("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:wt,alt:"Download on the App Store",className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:jt,alt:"Get it on Google Play",className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(xt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:n("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-br from-primary via-primary-glow to-primary-light relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:n("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:n("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(Z,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(ft,{to:"/join-us",children:[e.jsx(pt,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),n("home.cta.button")]})})})]})]}),J&&e.jsx(Ft,{open:z,onOpenChange:g,provider:K})]})})};export{ls as default};
//# sourceMappingURL=Home-BXi8e1bN.js.map
