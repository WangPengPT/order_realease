import{bB as M,u as U,p as E,j as e,bT as P,a$ as V,bX as $,b9 as _,bu as C,cC as k,b6 as F,b1 as y,s as n,L as A,bg as D}from"./vendor-react-DImbKuZP.js";import{u as H,q as N,r as G,t as O,v as Q,B as T,C as z,F as B,s as l}from"./index-_G3CuCzp.js";import{T as X,a as J,b as d,c as m}from"./tabs-Dk5peax5.js";import{u as W}from"./useLocalizedContent-B2SRIfSp.js";import{P as L}from"./PostGridCard--FUMjR5w.js";import"./vendor-i18n-AOdgFpXS.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-utils-vwQGbBim.js";import"./vendor-supabase-CRxszhSs.js";import"./useCommunityPosts-CIwfJkFk.js";import"./useLoginRequired-DynG1Vvm.js";import"./EditRecipeDialog-C_ulThZR.js";import"./drawer-CK8DetMs.js";import"./popover-CLT125d5.js";import"./useActivities-B-dkIh_c.js";import"./useRestaurants-DXIIBXS_.js";import"./progress-Bi_ViBYA.js";import"./collapsible-dyuDlGDF.js";const Y=s=>n({queryKey:["public-profile",s],queryFn:async()=>{const{data:t,error:a}=await l.from("profiles").select("id, display_name, avatar_url, has_published_recipe").eq("id",s).single();if(a)throw a;return t},enabled:!!s}),Z=s=>n({queryKey:["public-user-role",s],queryFn:async()=>{const{data:t}=await l.from("user_roles").select("role").eq("user_id",s).maybeSingle();return t?.role||"user"},enabled:!!s}),I=s=>n({queryKey:["public-favorites",s],queryFn:async()=>{const{data:t}=await l.from("favorites").select("restaurant_id").eq("user_id",s);if(!t||t.length===0)return[];const a=t.map(c=>c.restaurant_id),{data:r}=await l.from("restaurants").select("id, name, name_en, name_pt, type, cover_image_url, address").in("id",a).eq("visible",!0);return r||[]},enabled:!!s}),ee=s=>n({queryKey:["public-subscriptions",s],queryFn:async()=>{const{data:t}=await l.from("subscriptions").select("activity_id").eq("user_id",s);if(!t||t.length===0)return[];const a=t.map(c=>c.activity_id),{data:r}=await l.from("activities").select("id, title_en, title_zh, title_pt, image_url, start_date, status, visible").in("id",a).eq("status","published").eq("visible",!0);return r||[]},enabled:!!s}),se=s=>n({queryKey:["public-posts",s],queryFn:async()=>{const{data:t}=await l.from("community_posts").select(`
          *,
          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),
          activity:activities(id, title_en, title_zh, title_pt),
          restaurant:restaurants(id, name, name_en, name_pt),
          post_restaurants(restaurant:restaurants(id, name, name_en, name_pt))
        `).eq("author_id",s).eq("status","approved").eq("post_type","post").order("created_at",{ascending:!1}).limit(50);return(t||[]).map(a=>({...a,restaurants:a.post_restaurants?.map(r=>r.restaurant).filter(Boolean)||[]}))},enabled:!!s}),ae=s=>n({queryKey:["public-recipes",s],queryFn:async()=>{const{data:t}=await l.from("community_posts").select(`
          *,
          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url),
          activity:activities(id, title_en, title_zh, title_pt),
          restaurant:restaurants(id, name, name_en, name_pt),
          post_restaurants(restaurant:restaurants(id, name, name_en, name_pt))
        `).eq("author_id",s).eq("status","approved").eq("post_type","recipe").order("created_at",{ascending:!1}).limit(50);return(t||[]).map(a=>({...a,restaurants:a.post_restaurants?.map(r=>r.restaurant).filter(Boolean)||[]}))},enabled:!!s}),te=(s,t)=>n({queryKey:["public-managed-restaurants",s],queryFn:async()=>{const{data:a}=await l.from("merchant_restaurants").select("restaurant_id, restaurants:restaurant_id(id, name, name_en, name_pt, cover_image_url, address, type)").eq("user_id",s);return(a||[]).map(r=>r.restaurants).filter(Boolean)},enabled:!!s&&(t==="merchant"||t==="supervisor")});function ye(){const{userId:s}=M(),t=U(),{t:a}=E(),{getLocalizedField:r}=W(),{user:c}=H(),b=!!c,{data:p,isLoading:K}=Y(s),{data:o}=Z(s),{data:x=[]}=I(s),{data:h=[]}=ee(s),{data:f=[]}=se(s),{data:g=[]}=ae(s),{data:j=[]}=te(s,o||"user"),v=o==="merchant"||o==="supervisor";if(K)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!p)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center gap-4",children:[e.jsx("p",{className:"text-muted-foreground",children:a("publicProfile.notFound","用户不存在")}),e.jsxs(N,{variant:"outline",onClick:()=>t(-1),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),a("common.back","返回")]})]});const w=p.display_name||a("publicProfile.anonymousUser","匿名用户"),S=w.charAt(0).toUpperCase(),q=o==="merchant"?a("profile.roles.merchant","商家"):o==="supervisor"?a("profile.roles.supervisor","主管"):null;return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"max-w-3xl mx-auto px-4 py-6",children:[e.jsxs(N,{variant:"ghost",size:"sm",className:"mb-4 -ml-2",onClick:()=>t(-1),children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),a("common.back","返回")]}),e.jsxs("div",{className:"flex flex-col items-center text-center mb-8",children:[e.jsxs(G,{className:"h-24 w-24 mb-4 ring-2 ring-border",children:[e.jsx(O,{src:p.avatar_url||void 0}),e.jsx(Q,{className:"text-2xl font-semibold bg-primary/10 text-primary",children:S})]}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:w}),b&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[q&&e.jsx(T,{className:"bg-primary capitalize",children:q}),p.has_published_recipe&&e.jsxs(T,{className:"gap-1 border font-semibold",style:{background:"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 50%, #a8a8a8 100%)",borderColor:"#b0b0b0",color:"#3a3a3a",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"},children:[e.jsx(V,{className:"w-3 h-3"}),a("profile.recipeExpert","食谱达人")]})]})]}),!b&&e.jsxs("div",{className:"relative mt-2",children:[e.jsxs("div",{className:"pointer-events-none select-none blur-sm opacity-40 overflow-hidden rounded-xl",children:[e.jsx("div",{className:"flex gap-2 mb-4",children:[1,2,3,4].map(i=>e.jsx("div",{className:"flex-1 h-9 rounded-md bg-muted"},i))}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[1,2,3,4,5,6].map(i=>e.jsx("div",{className:"rounded-lg overflow-hidden bg-muted aspect-square"},i))})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-center px-4",children:e.jsxs("div",{className:"bg-background/90 backdrop-blur-md border border-border rounded-2xl px-8 py-8 shadow-lg flex flex-col items-center gap-3 max-w-xs w-full",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-3",children:e.jsx($,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-base mb-1",children:a("publicProfile.loginToView","登录后查看更多信息")}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:a("publicProfile.loginToViewDesc","登录以查看该用户的徽章、帖子、食谱、收藏及活动")})]}),e.jsx(N,{className:"w-full",onClick:()=>t("/auth"),children:a("activities.goToLogin","去登录")})]})})]}),b&&e.jsxs(X,{defaultValue:v?"managed":"posts",children:[e.jsxs(J,{className:"w-full mb-6 flex flex-wrap h-auto gap-1",children:[v&&e.jsxs(d,{value:"managed",className:"flex-1 gap-1.5",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("publicProfile.managedRestaurants","管辖餐厅")}),e.jsx("span",{className:"sm:hidden",children:a("publicProfile.managed","餐厅")}),j.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",j.length,")"]})]}),e.jsxs(d,{value:"posts",className:"flex-1 gap-1.5",children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("publicProfile.posts","帖子")}),f.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",f.length,")"]})]}),e.jsxs(d,{value:"recipes",className:"flex-1 gap-1.5",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("publicProfile.recipes","食谱")}),g.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",g.length,")"]})]}),e.jsxs(d,{value:"favorites",className:"flex-1 gap-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("publicProfile.favorites","收藏餐厅")}),x.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",x.length,")"]})]}),e.jsxs(d,{value:"activities",className:"flex-1 gap-1.5",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:a("publicProfile.activities","活动")}),h.length>0&&e.jsxs("span",{className:"ml-1 text-xs text-muted-foreground",children:["(",h.length,")"]})]})]}),v&&e.jsx(m,{value:"managed",children:j.length===0?e.jsx(u,{icon:e.jsx(_,{className:"h-10 w-10 text-muted-foreground/40"}),text:a("publicProfile.noManagedRestaurants","暂无管辖餐厅")}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:j.map(i=>e.jsx(R,{restaurant:i,getLocalizedField:r,t:a},i.id))})}),e.jsx(m,{value:"posts",children:f.length===0?e.jsx(u,{icon:e.jsx(C,{className:"h-10 w-10 text-muted-foreground/40"}),text:a("publicProfile.noPosts","暂无公开帖子")}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:f.map(i=>e.jsx(L,{post:i},i.id))})}),e.jsx(m,{value:"recipes",children:g.length===0?e.jsx(u,{icon:e.jsx(k,{className:"h-10 w-10 text-muted-foreground/40"}),text:a("publicProfile.noRecipes","暂无公开食谱")}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:g.map(i=>e.jsx(L,{post:i},i.id))})}),e.jsx(m,{value:"favorites",children:x.length===0?e.jsx(u,{icon:e.jsx(F,{className:"h-10 w-10 text-muted-foreground/40"}),text:a("publicProfile.noFavorites","暂无收藏餐厅")}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:x.map(i=>e.jsx(R,{restaurant:i,getLocalizedField:r,t:a},i.id))})}),e.jsx(m,{value:"activities",children:h.length===0?e.jsx(u,{icon:e.jsx(y,{className:"h-10 w-10 text-muted-foreground/40"}),text:a("publicProfile.noActivities","暂无订阅活动")}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:h.map(i=>e.jsx(re,{activity:i,getLocalizedField:r,t:a},i.id))})})]})]})})}function u({icon:s,text:t}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 gap-3 text-center",children:[s,e.jsx("p",{className:"text-muted-foreground text-sm",children:t})]})}function R({restaurant:s,getLocalizedField:t,t:a}){const r=t(s,"name");return e.jsx(A,{to:`/restaurant/${s.id}`,children:e.jsx(z,{className:"hover:shadow-md transition-shadow cursor-pointer group overflow-hidden",children:e.jsxs(B,{className:"p-0",children:[s.cover_image_url?e.jsx("img",{src:s.cover_image_url,alt:r,className:"w-full h-28 object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-28 bg-muted flex items-center justify-center",children:e.jsx(_,{className:"h-8 w-8 text-muted-foreground/40"})}),e.jsxs("div",{className:"p-3",children:[e.jsx("p",{className:"font-semibold text-sm line-clamp-1",children:r}),s.address&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-1 flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3 flex-shrink-0"}),s.address]})]})]})})})}function re({activity:s,getLocalizedField:t,t:a}){const r=t(s,"title");return e.jsx(A,{to:`/activity/${s.id}`,children:e.jsx(z,{className:"hover:shadow-md transition-shadow cursor-pointer group overflow-hidden",children:e.jsxs(B,{className:"p-0",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:r,className:"w-full h-28 object-cover group-hover:scale-105 transition-transform duration-300"}):e.jsx("div",{className:"w-full h-28 bg-muted flex items-center justify-center",children:e.jsx(y,{className:"h-8 w-8 text-muted-foreground/40"})}),e.jsx("div",{className:"p-3",children:e.jsx("p",{className:"font-semibold text-sm line-clamp-2",children:r})})]})})})}export{ye as default};
//# sourceMappingURL=PublicProfile-DKFakQHy.js.map
