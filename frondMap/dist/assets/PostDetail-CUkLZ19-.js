import{p as L,u as P,r as l,j as e,b2 as V,L as h,b7 as Y,b0 as Z,bf as ee,b5 as se,bm as ae,aX as te,X as re,bl as le,W as ie,w as x,bq as ne,aL as ce,bM as _}from"./vendor-react-BSaoOtGi.js";import{u as oe,C as me,v as de,A as ue,h as he,i as xe,P as ge,Q as je,B as i,R as fe,T as ve,w as Ne,k as A,x as pe,y as we,z as ye,E as be,F as Ce,G as ke,J as Se,K as _e,L as Ae}from"./index-BRGVr5Zj.js";import{C as D,a as z,b as T}from"./carousel-OgBSJEsh.js";import{c as De,i as ze,b as Te,j as Le}from"./useCommunityPosts-Dy9oDLSN.js";import{u as Pe}from"./useLocalizedContent-BmCUAvFh.js";import{T as Ee,R as Ie}from"./RestaurantComments-BLRx844W.js";import{H as Fe,p as $e,I as Me,J as He}from"./vendor-utils-Z4kpnli5.js";import"./vendor-i18n-jtdHZIRR.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-supabase-AmDIt6e_.js";import"./ReportDialog-CkK8m8vi.js";import"./input-otp-D84TSOlh.js";import"./useSensitiveWords-DchZvd0t.js";const Re=({post:s,showActions:m=!0,isDetailPage:d=!1})=>{const{t,i18n:g}=L(),{user:n}=oe(),E=P(),{getLocalizedField:N}=Pe(),I=De(),j=ze(),F=Te(),[$,f]=l.useState(!1),[p,w]=l.useState({}),[M,u]=l.useState(!1),[H,y]=l.useState(0),[c,R]=l.useState(),[b,B]=l.useState(),[C,k]=l.useState(0),[q,O]=l.useState(null);l.useState(null),l.useState(!1),l.useState(0),l.useState(!1),l.useEffect(()=>{c&&(k(c.selectedScrollSnap()),c.on("select",()=>{k(c.selectedScrollSnap())}))},[c]);const U=()=>{switch(g.language){case"zh":return He;case"pt":return Me;default:return $e}},J=()=>{n&&I.mutate({postId:s.id,liked:s.user_liked||!1})},W=async()=>{const a=`${window.location.origin}/community/${s.id}`;if(navigator.share)try{await navigator.share({title:t("community.shareTitle","分享帖子"),url:a}),n&&j.mutate(s.id),x.success(t("community.shareSuccess","分享成功"))}catch(r){r?.name!=="AbortError"&&(await navigator.clipboard.writeText(a),x.success(t("community.linkCopied","链接已复制到剪贴板")),n&&j.mutate(s.id))}else try{await navigator.clipboard.writeText(a),x.success(t("community.linkCopied","链接已复制到剪贴板")),n&&j.mutate(s.id)}catch{x.error(t("community.shareFailed","分享失败"))}},X=()=>{F.mutate(s.id),f(!1)},S=a=>{d?(y(a),u(!0)):E(`/community/${s.id}`)},G=n?.id===s.author_id,K=s.activity?N(s.activity,"title"):null,Q=s.restaurant?N(s.restaurant,"name"):null;return e.jsxs(e.Fragment,{children:[e.jsxs(me,{className:"overflow-hidden",children:[e.jsx(de,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ue,{className:"h-10 w-10",children:[e.jsx(he,{src:s.author?.avatar_url||void 0}),e.jsx(xe,{children:s.author?.display_name?.charAt(0)||"?"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.author?.display_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Fe(new Date(s.created_at),{addSuffix:!0,locale:U()})})]})]}),m&&G&&e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsx(fe,{align:"end",children:e.jsx(ve,{onClick:()=>f(!0),className:"text-destructive",children:t("common.delete","删除")})})]})]})}),e.jsxs(Ne,{className:"pt-0 pb-3",children:[(s.activity||s.restaurant)&&e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[s.activity&&e.jsx(h,{to:`/activity/${s.activity.id}`,children:e.jsxs(A,{variant:"secondary",className:"gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),K]})}),s.restaurant&&e.jsx(h,{to:`/restaurant/${s.restaurant.id}`,children:e.jsxs(A,{variant:"secondary",className:"gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),Q]})})]}),e.jsx(h,{to:`/community/${s.id}`,children:e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert",dangerouslySetInnerHTML:{__html:q||s.content}})}),e.jsx(Ee,{text:s.content,onTranslation:O,className:"mt-1"}),(()=>{const a=d&&s.video_url?(s.image_urls||[]).filter(r=>!r.includes("-cover")):s.image_urls;return!a||a.length===0?null:e.jsx("div",{className:"relative mt-3",children:a.length===1?e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>S(0),children:p[a[0]]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:a[0],alt:"",className:"w-full h-full object-cover",onError:()=>w(r=>({...r,[a[0]]:!0}))})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{setApi:R,className:"w-full",opts:{loop:!0},children:e.jsx(z,{className:"-ml-0",children:a.map((r,o)=>e.jsx(T,{className:"pl-0",children:e.jsx("div",{className:"relative aspect-square overflow-hidden rounded-lg cursor-pointer",onClick:()=>S(o),children:p[r]?e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-muted-foreground",children:t("common.imageLoadError","图片加载失败")})}):e.jsx("img",{src:r,alt:"",className:"w-full h-full object-cover",onError:()=>w(v=>({...v,[r]:!0}))})})},o))})}),e.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white text-xs px-2 py-1 rounded-full z-10",children:[C+1,"/",a.length]}),e.jsx("div",{className:"flex justify-center gap-1.5 mt-2",children:a.map((r,o)=>e.jsx("button",{className:`w-1.5 h-1.5 rounded-full transition-colors ${o===C?"bg-primary":"bg-muted-foreground/30"}`,onClick:v=>{v.stopPropagation(),c?.scrollTo(o)}},o))})]})})})(),s.video_url&&e.jsx("div",{className:"mt-3 rounded-lg overflow-hidden bg-gray-900",children:e.jsx("video",{src:s.video_url,...s.image_urls?.length?{poster:s.image_urls[0]}:{},controls:!0,className:"w-full max-h-96",preload:"metadata",playsInline:!0})})]}),e.jsx(pe,{className:"pt-0 border-t",children:e.jsxs("div",{className:"flex items-center gap-4 pt-3 w-full",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:`gap-2 ${s.user_liked?"text-red-500":""}`,onClick:J,disabled:!n,children:[e.jsx(ee,{className:`h-4 w-4 ${s.user_liked?"fill-current":""}`}),e.jsx("span",{children:s.likes_count})]}),e.jsx(h,{to:`/community/${s.id}`,children:e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx("span",{children:s.comments_count})]})}),e.jsxs(i,{variant:"ghost",size:"sm",className:"gap-2",onClick:W,children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{children:s.shares_count})]})]})})]}),e.jsx(we,{open:$,onOpenChange:f,children:e.jsxs(ye,{children:[e.jsxs(be,{children:[e.jsx(Ce,{children:t("common.confirmDelete","确认删除")}),e.jsx(ke,{children:t("community.deleteWarning","删除后无法恢复，确定要删除这篇帖子吗？")})]}),e.jsxs(Se,{children:[e.jsx(_e,{children:t("common.cancel","取消")}),e.jsx(Ae,{onClick:X,children:t("common.delete","删除")})]})]})}),M&&te.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] bg-black overflow-hidden",onClick:a=>{a.target===a.currentTarget&&u(!1)},children:[s.image_urls&&s.image_urls.length>1&&e.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-10 text-white text-sm bg-black/50 px-4 py-1.5 rounded-full",children:[H+1," / ",s.image_urls.length]}),e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10 text-white hover:bg-white/20",onClick:()=>u(!1),children:e.jsx(re,{className:"h-6 w-6"})}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(D,{className:"w-full",opts:{loop:!0},setApi:a=>{B(a),a&&a.on("select",()=>{y(a.selectedScrollSnap())})},children:e.jsx(z,{className:"-ml-0",children:s.image_urls?.map((a,r)=>e.jsx(T,{className:"pl-0 flex items-center justify-center",children:e.jsx("img",{src:a,alt:"",className:"object-contain select-none w-screen h-screen cursor-pointer",draggable:!1,onClick:()=>u(!1)})},r))})})}),s.image_urls&&s.image_urls.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>b?.scrollPrev(),children:e.jsx(le,{className:"h-8 w-8"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 text-white hover:bg-white/20 h-12 w-12 hidden sm:flex",onClick:()=>b?.scrollNext(),children:e.jsx(ie,{className:"h-8 w-8"})})]})]}),document.body)]})},es=()=>{const{id:s}=ne(),{t:m}=L(),d=P(),{data:t,isLoading:g,error:n}=Le(s||"");return g?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4 flex justify-center",children:e.jsx(ce,{className:"h-8 w-8 animate-spin"})}):n||!t?e.jsx("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-muted-foreground",children:m("community.postNotFound","帖子不存在或已被删除")}),e.jsxs(i,{variant:"outline",className:"mt-4",onClick:()=>d("/community"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),m("community.backToList","返回社区")]})]})}):e.jsxs("div",{className:"container max-w-2xl mx-auto py-6 px-4",children:[e.jsxs(i,{variant:"ghost",size:"sm",className:"mb-4",onClick:()=>d("/community"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),m("community.backToList","返回社区")]}),e.jsx(Re,{post:t,showActions:!0,isDetailPage:!0}),e.jsx("div",{className:"mt-6",children:e.jsx(Ie,{targetId:t.id,targetType:"post"})})]})};export{es as default};
//# sourceMappingURL=PostDetail-CUkLZ19-.js.map
