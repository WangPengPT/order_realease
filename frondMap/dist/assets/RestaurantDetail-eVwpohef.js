const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RestaurantComments-5nPjG0Bi.js","assets/vendor-react-BJ_Fufgb.js","assets/vendor-i18n-jtdHZIRR.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-Z4kpnli5.js","assets/vendor-react-CG6K1Se3.css","assets/index-BSqTIOKh.js","assets/vendor-supabase-Dbipw1Nj.js","assets/index-DgIS4wiQ.css","assets/ReportDialog-Cptmkj6v.js","assets/input-otp-CNvgC78B.js","assets/useSensitiveWords-B1pgirp8.js"])))=>i.map(i=>d[i]);
import{t as l,C as _,z as C,E as D,G as be,f as rs,s as ns,b as Ae,B as b,D as ls,c as is,e as os,_ as cs,u as ds,J as ms,K as ze,y as hs,L as us,M as xs,N as gs,O as k,P as Ie,h as xe,A,i as P,j as E,k as F,m as W,n as q,o as G,p as U,r as ge}from"./index-BSqTIOKh.js";import{j as e,p as ie,b2 as je,bi as ps,s as fs,r as n,bj as js,bk as bs,bl as ws,av as K,aq as Ns,X as vs,bm as Pe,W as ys,bn as ks,aN as _s,u as Cs,w as V,L as pe,bg as Ds,bo as B,aV as ne,bp as Ss,bq as Rs,br as zs,aZ as fe,bs as Is,b1 as Ls,y as Ts,bh as Os,b5 as Le,bt as Te,b4 as Ms,aL as le}from"./vendor-react-BJ_Fufgb.js";import{S as Oe}from"./separator-BXg5PdTN.js";import{C as X,a as Y,b as Z}from"./collapsible-TBMNVdKE.js";import{d as $s,b as As,c as Ps}from"./useRestaurants-DmbF1jrQ.js";import{u as Ee,R as Es}from"./ReportDialog-Cptmkj6v.js";import{u as Fs}from"./useLocalizedContent-Bk4lYsHC.js";import{f as Ws}from"./timeUtils-pgRxO0UB.js";import{g as qs,c as Gs,o as Us,m as Vs}from"./geolocation-DRm3QMsJ.js";import{m as H}from"./vendor-map-CvE3ASYw.js";import{u as Bs}from"./usePageView-Ba049OaE.js";import{u as Hs}from"./useActivityParticipation-Bd4X74yo.js";import{u as Ks,R as Xs}from"./RestaurantFormDialog-C0je_fKJ.js";import{C as Ys,a as Zs,b as Js,c as Qs,d as ea}from"./carousel-6nyKC7UJ.js";import"./vendor-utils-Z4kpnli5.js";import"./vendor-supabase-Dbipw1Nj.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-jtdHZIRR.js";import"./input-otp-CNvgC78B.js";import"./checkbox-ChbmaHve.js";import"./switch-BNjp0ZUu.js";import"./tabs-DHusoSbk.js";import"./RichTextEditor-JV7qwlxe.js";const sa=()=>e.jsxs("div",{className:"min-h-screen bg-background pb-8",children:[e.jsxs("div",{className:"relative h-[30vh] sm:h-[35vh] overflow-hidden",children:[e.jsx(l,{className:"w-full h-full rounded-none"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/80 to-transparent"}),e.jsx("div",{className:"absolute top-4 left-4",children:e.jsx(l,{className:"h-10 w-10 rounded-md"})}),e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[e.jsx(l,{className:"h-10 w-10 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]}),e.jsxs("div",{className:"container mx-auto px-4 -mt-16 relative z-10",children:[e.jsxs(_,{className:"shadow-large",children:[e.jsx(C,{children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3 flex flex-wrap gap-2",children:[e.jsx(l,{className:"h-6 w-16 rounded-full"}),e.jsx(l,{className:"h-6 w-20 rounded-full"}),e.jsx(l,{className:"h-6 w-14 rounded-full"})]}),e.jsx(l,{className:"h-9 w-64 mb-3"}),e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx(l,{className:"h-5 w-20"}),e.jsx(l,{className:"h-5 w-24"}),e.jsx(l,{className:"h-5 w-16"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-10 w-28 rounded-md"}),e.jsx(l,{className:"h-10 w-10 rounded-md"})]})]})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-5 w-24"}),e.jsx(l,{className:"h-16 w-full rounded-md"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-5 w-32"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{className:"h-8 w-24 rounded-full"}),e.jsx(l,{className:"h-8 w-28 rounded-full"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(l,{className:"h-5 w-full"}),e.jsx(l,{className:"h-5 w-3/4"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsx(l,{className:"h-5 w-32"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(l,{className:"h-5 w-5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(l,{className:"h-5 w-40"}),e.jsx(l,{className:"h-5 w-48"})]})]})]})]})]}),e.jsxs(_,{className:"mt-6 shadow-large",children:[e.jsx(C,{children:e.jsx(l,{className:"h-6 w-20"})}),e.jsx(D,{children:e.jsx(l,{className:"h-[200px] w-full rounded-lg"})})]}),e.jsxs(_,{className:"mt-6 shadow-large",children:[e.jsx(C,{children:e.jsx(l,{className:"h-6 w-24"})}),e.jsx(D,{children:e.jsx("div",{className:"flex gap-3 overflow-hidden",children:[1,2,3,4].map(o=>e.jsx(l,{className:"h-24 w-24 rounded-lg flex-shrink-0"},o))})})]}),e.jsxs(_,{className:"mt-6 shadow-large",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between",children:[e.jsx(l,{className:"h-6 w-32"}),e.jsx(l,{className:"h-9 w-24 rounded-md"})]}),e.jsx(D,{className:"space-y-4",children:[1,2,3].map(o=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{className:"h-10 w-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"h-4 w-24"}),e.jsx(l,{className:"h-4 w-16"})]}),e.jsx(l,{className:"h-4 w-full"}),e.jsx(l,{className:"h-4 w-3/4"})]})]},o))})]})]})]}),aa=[{value:"0-5",label:"0-5€"},{value:"5-10",label:"5-10€"},{value:"10-15",label:"10-15€"},{value:"15-20",label:"15-20€"},{value:"20-25",label:"20-25€"},{value:"25-30",label:"25-30€"},{value:"30-40",label:"30-40€"},{value:"40-50",label:"40-50€"},{value:"50+",label:"50€+"}],ta=({restaurantId:o})=>{const{t:x}=ie(),{data:s}=Ee(o,"restaurant"),d=s?.filter(i=>i.rating_value)||[],u=d.length?d.reduce((i,h)=>i+(h.rating_value||0),0)/d.length:0,p=[5,4,3,2,1].map(i=>({star:i,count:d.filter(h=>h.rating_value===i).length,percentage:d.length?(d.filter(h=>h.rating_value===i).length/d.length*100).toFixed(0):0})),j=d.reduce((i,h)=>(h.price_range&&(i[h.price_range]=(i[h.price_range]||0)+1),i),{}),N=j&&Object.keys(j).length>0?Object.entries(j).sort((i,h)=>h[1]-i[1])[0]:null;return e.jsxs(_,{children:[e.jsx(C,{children:e.jsx(be,{children:x("restaurant.rating")})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-5xl font-bold",children:u.toFixed(1)}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:[1,2,3,4,5].map(i=>e.jsx(je,{className:rs("w-5 h-5",i<=Math.round(u)?"fill-accent text-accent":"text-muted-foreground")},i))}),e.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:[d.length," ",x("restaurant.ratingsCount")]}),N&&e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2 text-sm",children:[e.jsx(ps,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-foreground",children:aa.find(i=>i.value===N[0])?.label})]})]}),e.jsx("div",{className:"flex-1 space-y-2",children:p.map(({star:i,count:h,percentage:S})=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsxs("span",{className:"w-8",children:[i," ★"]}),e.jsx("div",{className:"flex-1 h-2 bg-secondary rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all",style:{width:`${S}%`}})}),e.jsx("span",{className:"w-12 text-right text-muted-foreground",children:h})]},i))})]}),e.jsx("div",{className:"pt-4 border-t text-center text-sm text-muted-foreground",children:x("restaurant.signInToRate")})]})]})},ra=o=>(ie(),fs({queryKey:["restaurant-activities",o],queryFn:async()=>{const{data:x,error:s}=await ns.from("activity_restaurants").select(`
          activity_id,
          activities (
            id,
            title_zh,
            title_en,
            title_pt,
            intro_zh,
            intro_en,
            intro_pt,
            badge_text_zh,
            badge_text_en,
            badge_text_pt,
            badge_color,
            start_date,
            end_date
          )
        `).eq("restaurant_id",o);if(s)throw s;const d=new Date;return x.filter(p=>{const j=p.activities;if(!j)return!1;const N=new Date(j.start_date),i=j.end_date?new Date(j.end_date):null;return N<=d&&(!i||i>=d)}).map(p=>({activity_id:p.activity_id,title_zh:p.activities.title_zh,title_en:p.activities.title_en,title_pt:p.activities.title_pt,intro_zh:p.activities.intro_zh,intro_en:p.activities.intro_en,intro_pt:p.activities.intro_pt,badge_text_zh:p.activities.badge_text_zh,badge_text_en:p.activities.badge_text_en,badge_text_pt:p.activities.badge_text_pt,badge_color:p.activities.badge_color}))},enabled:!!o})),na=(o,x)=>x==="zh"?o.title_zh:x==="pt"?o.title_pt:o.title_en,Me=(o,x)=>{let s="";return x==="zh"?s=o.badge_text_zh||o.title_zh:x==="pt"?s=o.badge_text_pt||o.title_pt:s=o.badge_text_en||o.title_en,s},la=(o,x)=>x==="zh"?o.intro_zh||"":x==="pt"?o.intro_pt||"":o.intro_en||"",$e="dish-gallery-view-mode";function ia({restaurantId:o,showGallery:x=!0}){const{t:s}=ie(),{data:d=[],isLoading:u}=Ks(o),[p,j]=n.useState(!1),[N,i]=n.useState(0),[h,S]=n.useState(!1),R=Ae(),[v,J]=n.useState(()=>{if(typeof window<"u"){const c=localStorage.getItem($e);return c==="single"||c==="multi"?c:"multi"}return"multi"});n.useEffect(()=>{localStorage.setItem($e,v)},[v]);const y=n.useCallback(c=>{i(c),j(!0)},[]),L=n.useCallback(()=>{j(!1)},[]),z=n.useCallback(()=>{i(c=>c===0?d.length-1:c-1)},[d.length]),T=n.useCallback(()=>{i(c=>c===d.length-1?0:c+1)},[d.length]),O=n.useCallback(c=>{c.key==="ArrowLeft"&&z(),c.key==="ArrowRight"&&T(),c.key==="Escape"&&L()},[z,T,L]);if(u||!x||!d.length)return null;const oe=()=>R&&v==="single"?"pl-2 basis-full":"pl-2 md:pl-4 basis-1/2 md:basis-1/3 lg:basis-1/4";return e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsxs(X,{open:!h,onOpenChange:c=>S(!c),children:[e.jsx(C,{className:"pb-3",children:e.jsx(Y,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(be,{className:"text-lg flex items-center gap-2",children:[e.jsx(js,{className:"w-5 h-5"}),s("restaurant.photoGallery"),e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["(",d.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[R&&e.jsxs("div",{className:"flex items-center gap-1 bg-muted rounded-md p-0.5",onClick:c=>c.stopPropagation(),children:[e.jsx(b,{variant:v==="single"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:c=>{c.stopPropagation(),J("single")},title:s("dishImages.singleView"),children:e.jsx(bs,{className:"h-4 w-4"})}),e.jsx(b,{variant:v==="multi"?"default":"ghost",size:"icon",className:"h-7 w-7",onClick:c=>{c.stopPropagation(),J("multi")},title:s("dishImages.multiView"),children:e.jsx(ws,{className:"h-4 w-4"})})]}),e.jsx(K,{className:`w-5 h-5 text-muted-foreground transition-transform ${h?"":"rotate-180"}`})]})]})})}),e.jsx(Z,{children:e.jsxs(D,{children:[e.jsxs(Ys,{className:"w-full",children:[e.jsx(Zs,{className:"-ml-2 md:-ml-4",children:d.map((c,Q)=>e.jsx(Js,{className:oe(),children:e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>y(Q),children:e.jsx("img",{src:c.image_url,alt:`Dish ${Q+1}`,className:"w-full h-full object-cover",loading:"lazy"})})},c.id))}),d.length>(R&&v==="single"?1:2)&&e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"-left-3 md:-left-4"}),e.jsx(ea,{className:"-right-3 md:-right-4"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:s("dishImages.clickToEnlarge")})]})})]})}),e.jsx(ls,{open:p,onOpenChange:j,children:e.jsxs(is,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",onKeyDown:O,children:[e.jsx(Ns,{children:e.jsx(os,{children:s("restaurants.dishGallery","Dish Gallery")})}),e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center min-h-[50vh]",children:[e.jsx(b,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-50 text-white hover:bg-white/20",onClick:L,children:e.jsx(vs,{className:"w-6 h-6"})}),d.length>1&&e.jsx(b,{variant:"ghost",size:"icon",className:"absolute left-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:z,children:e.jsx(Pe,{className:"w-8 h-8"})}),e.jsx("img",{src:d[N]?.image_url,alt:`Dish ${N+1}`,className:"max-w-full max-h-[85vh] object-contain"}),d.length>1&&e.jsx(b,{variant:"ghost",size:"icon",className:"absolute right-2 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:T,children:e.jsx(ys,{className:"w-8 h-8"})}),e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm",children:[N+1," / ",d.length]})]})]})})]})}const oa=n.lazy(()=>cs(()=>import("./RestaurantComments-5nPjG0Bi.js").then(o=>o.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))),Oa=()=>{const{id:o}=ks(),x=_s(),{t:s,i18n:d}=ie(),{user:u}=ds(),{localizeRestaurant:p,getLocalizedField:j}=Fs(),N=Ae(),i=n.useRef(null),h=n.useRef(null),[S,R]=n.useState(null),[v,J]=n.useState(!1),[y,L]=n.useState(!0),[z,T]=n.useState(!1),[O,oe]=n.useState(!1),[c,Q]=n.useState(!0),[ee,Fe]=n.useState(!0),[We,ca]=n.useState(!1),ce=n.useRef(null),de=n.useRef(null),[qe,me]=n.useState(!1),[Ge,se]=n.useState(!1),[Ue,we]=n.useState(!1),[Ve,Ne]=n.useState(!1),[Be,He]=n.useState(!1),Ke=Cs();Bs({pageType:"restaurant",targetId:o});const ve=x.state?.fromActivity,Xe=x.state?.from==="admin",Ye=x.state?.from==="profile",ye=Xe?"/admin/restaurants":Ye?"/profile":ve?`/activity/${ve}`:"/restaurants",{data:t,isLoading:Ze}=$s(o),{data:Je=[]}=As(),{data:ae}=Ee(o,"restaurant",{enabled:ee}),ke=Ps(),{role:da,isAdmin:_e}=ms(),{data:Qe=[]}=Hs(),{data:he=[]}=ra(o),Ce=t&&Qe.some(a=>a.id===t.id),f=t?p(t):null,es=t?Je.includes(t.id):!1;n.useMemo(()=>[{value:"€",label:"€ (0-10€)"},{value:"€€",label:"€€ (10-20€)"},{value:"€€€",label:"€€€ (20€+)"}],[]);const I=n.useMemo(()=>{const a={};return ae?.forEach(r=>{r.price_range&&(a[r.price_range]||(a[r.price_range]={count:0,latestDate:r.created_at}),a[r.price_range].count+=1,r.created_at>a[r.price_range].latestDate&&(a[r.price_range].latestDate=r.created_at))}),a},[ae]),De=n.useMemo(()=>I?Object.values(I).reduce((a,r)=>a+r.count,0):0,[I]),Se=n.useMemo(()=>!I||De<10?null:Object.entries(I).sort(([,r],[,g])=>g.count!==r.count?g.count-r.count:g.latestDate.localeCompare(r.latestDate))[0]?.[0]||null,[I,De]),{ratingCount:ue,averageRating:ss}=n.useMemo(()=>{const a=ae?.filter(m=>m.rating_value)||[],r=a.length,g=r>0?a.reduce((m,w)=>m+(w.rating_value||0),0)/r:0;return{ratingCount:r,averageRating:g}},[ae]);n.useEffect(()=>{t&&qs().then(a=>{const r=Gs(a.coords.latitude,a.coords.longitude,t.lat,t.lng);R(r)}).catch(()=>{R(null)})},[t]);const as=n.useCallback(()=>{!u||!t||ke.mutate(t.id)},[u,t,ke]),M=n.useCallback(async()=>{try{await navigator.clipboard.writeText(window.location.href),V.success(s("common.linkCopied"))}catch(a){console.error("Error copying link:",a),V.error(s("common.shareError"))}},[s]),Re=n.useCallback(async()=>{if(!t||!f)return;const a={title:f.name,text:`${f.name} - Xiaoxiong Market

${f.description||f.address}`,url:window.location.href};try{navigator.share&&navigator.canShare&&navigator.canShare(a)?(await navigator.share(a),V.success(s("common.shareSuccess"))):M()}catch(r){r.name!=="AbortError"&&(console.error("Error sharing:",r),V.error(s("common.shareError")))}},[t,f,M,s]),$=n.useCallback(a=>{if(!t||!f)return;const r=encodeURIComponent(window.location.href),g=encodeURIComponent(f.name);let m="";switch(a){case"whatsapp":m=`https://wa.me/?text=${g}%20${r}`;break;case"facebook":m=`https://www.facebook.com/sharer/sharer.php?u=${r}`;break;case"twitter":m=`https://twitter.com/intent/tweet?text=${g}&url=${r}`;break;case"telegram":m=`https://t.me/share/url?url=${r}&text=${g}`;break;case"wechat":M(),V.info(s("common.shareVia")+" WeChat");return;default:return}ze()?window.location.href=m:window.open(m,"_blank","width=600,height=400")},[t,f,M,s]);return n.useEffect(()=>{const a=new IntersectionObserver(g=>{g.forEach(m=>{m.isIntersecting&&!c&&Q(!0)})},{rootMargin:"100px"}),r=new IntersectionObserver(g=>{g.forEach(m=>{m.isIntersecting&&!ee&&Fe(!0)})},{rootMargin:"200px"});return ce.current&&a.observe(ce.current),de.current&&r.observe(de.current),()=>{a.disconnect(),r.disconnect()}},[c,ee]),n.useEffect(()=>{if(!i.current||!t||!c||!y||h.current)return;const a="pk.eyJ1IjoieGlhb3hpb25nMTIzIiwiYSI6ImNtNTFjOXliYjF1Y2IyaXM4bnNzMGxvdnkifQ.mPcWqH7ndIrjEqlWIJVk8g";if(!H.supported()){console.warn("[RestaurantDetail Map] WebGL not supported",{isIOSDevice:hs(),isIOSWebView:ze(),userAgent:navigator.userAgent});return}const r=()=>{if(!i.current)return;const g=i.current.getBoundingClientRect();if(g.width===0||g.height===0){setTimeout(r,100);return}try{H.accessToken=a,h.current=new H.Map({container:i.current,style:"mapbox://styles/mapbox/light-v11",center:[t.lng,t.lat],zoom:15,cooperativeGestures:!0}),h.current.on("error",w=>{console.error("[RestaurantDetail Map] Map error:",w)});const m=document.createElement("div");m.style.backgroundImage=`url(${Vs})`,m.style.width="40px",m.style.height="40px",m.style.backgroundSize="contain",m.style.backgroundRepeat="no-repeat",m.style.backgroundPosition="center",m.style.cursor="pointer",new H.Marker({element:m}).setLngLat([t.lng,t.lat]).addTo(h.current),h.current.addControl(new H.NavigationControl)}catch(m){console.error("[RestaurantDetail Map] Failed to initialize map:",m)}};return setTimeout(r,50),()=>{h.current?.remove(),h.current=null}},[t,c,y]),n.useEffect(()=>{if(y&&h.current){const a=setTimeout(()=>{h.current?.resize(),t&&h.current?.setCenter([t.lng,t.lat])},350);return()=>clearTimeout(a)}},[y,t]),Ze?e.jsx(sa,{}):!t||!f?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-muted-foreground",children:s("error.notFound")}),e.jsx(b,{asChild:!0,className:"mt-4",children:e.jsx(pe,{to:ye,children:s("common.back")})})]})}):e.jsxs("div",{className:"min-h-screen bg-secondary/20",children:[e.jsxs("div",{className:"relative h-[33vh] overflow-hidden bg-muted",children:[e.jsx("img",{src:t.cover_image_url||t.image_url||"https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=1200&q=80",alt:f.name,className:"w-full h-full object-cover",loading:"eager"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-background/90 to-transparent"}),e.jsx(b,{asChild:!0,variant:"secondary",size:"icon",className:"absolute top-4 left-4",children:e.jsx(pe,{to:ye,children:e.jsx(Pe,{className:"w-5 h-5"})})}),u&&e.jsx(b,{variant:"secondary",size:"icon",className:"absolute top-4 right-4",onClick:as,children:e.jsx(Ds,{className:`w-5 h-5 ${es?"fill-destructive text-destructive":""}`})}),N&&navigator.share?e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${u?"right-16":"right-4"}`,onClick:()=>{if(!u){se(!0);return}Re()},children:e.jsx(B,{className:"w-5 h-5"})}):e.jsxs(us,{children:[e.jsx(xs,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 shadow-lg ${u?"right-16":"right-4"}`,onClick:a=>{u||(a.preventDefault(),se(!0))},children:e.jsx(B,{className:"w-5 h-5"})})}),e.jsxs(gs,{align:"end",className:"w-48",children:[navigator.share&&e.jsxs(e.Fragment,{children:[e.jsxs(k,{onClick:Re,children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),s("common.moreOptions")]}),e.jsx(Ie,{})]}),e.jsxs(k,{onClick:()=>$("wechat"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"WeChat"]}),e.jsxs(k,{onClick:()=>$("whatsapp"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"WhatsApp"]}),e.jsxs(k,{onClick:()=>$("facebook"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Facebook"]}),e.jsxs(k,{onClick:()=>$("twitter"),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"X (Twitter)"]}),e.jsxs(k,{onClick:()=>$("telegram"),children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Telegram"]}),e.jsx(Ie,{}),e.jsxs(k,{onClick:M,children:[e.jsx(Ss,{className:"w-4 h-4 mr-2"}),s("common.copyLink")]})]})]}),(Ce||_e)&&t&&e.jsx(Xs,{restaurant:t,trigger:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 ${u?"right-28":"right-16"}`,children:e.jsx(Rs,{className:"w-5 h-5"})})}),t&&e.jsx(Es,{targetType:"restaurant",targetId:t.id,onLoginRequired:()=>se(!0),trigger:e.jsx(b,{variant:"secondary",size:"icon",className:`absolute top-4 ${Ce||_e?u?"right-40":"right-28":u?"right-28":"right-16"}`,children:e.jsx(zs,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"container mx-auto max-w-6xl px-4 -mt-20 relative z-10 pb-12",children:e.jsxs(_,{className:"shadow-large",children:[e.jsx(C,{children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 flex flex-wrap gap-2",children:f.type.slice(0,3).map((a,r)=>e.jsx(xe,{variant:"secondary",children:a},r))}),e.jsx(be,{className:"text-3xl mb-2",children:f.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[S!==null&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"font-semibold text-base",children:[S.toFixed(1)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:`w-5 h-5 ${ue>0?"fill-accent text-accent":"text-muted-foreground"}`}),ue>0?e.jsxs("span",{className:"font-semibold text-base",children:[ss.toFixed(1),e.jsxs("span",{className:"text-muted-foreground font-normal text-sm ml-1",children:["(",ue,")"]})]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:s("restaurant.noRatingWithHint")})]}),Se&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Is,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"font-semibold text-base",children:Se})]})]}),f.description&&e.jsx("div",{className:"text-muted-foreground prose prose-sm dark:prose-invert max-w-none [&_*]:!text-inherit [&_a]:!text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:f.description}})]})})}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[he.length>0&&e.jsxs(X,{open:O,onOpenChange:oe,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(je,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("activities.title")}),!O&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-1",children:he.map((a,r)=>e.jsx(xe,{variant:"default",className:"text-white",style:{backgroundColor:a.badge_color||"#9b87f5"},children:Me(a,d.language)},`activity-${r}`))})]}),e.jsx(K,{className:`w-5 h-5 text-muted-foreground transition-transform ${O?"rotate-180":""}`})]})}),e.jsx(Z,{className:"mt-3 space-y-2",children:he.map((a,r)=>{const g=la(a,d.language);return e.jsxs(pe,{to:`/activity/${a.activity_id}`,className:"block p-2 rounded-md hover:bg-muted/80 transition-colors",children:[e.jsx(xe,{variant:"default",className:"text-white mr-2",style:{backgroundColor:a.badge_color||"#9b87f5"},children:Me(a,d.language)}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[g||na(a,d.language)," ... →"]})]},`activity-detail-${r}`)})})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Ls,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.address")}),e.jsx("p",{className:"text-muted-foreground",children:t.address})]})]}),t.phone&&e.jsxs("a",{href:`tel:${t.phone}`,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50 hover:bg-muted/80 transition-colors cursor-pointer",children:[e.jsx(Ts,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.phone")}),e.jsx("p",{className:"text-primary underline",children:t.phone})]})]}),t.opening_hours&&e.jsxs(X,{open:v,onOpenChange:J,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(Os,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.hours")}),!v&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-0.5",children:[s("restaurant.today")," ",Ws(t.opening_hours)]})]}),e.jsx(K,{className:`w-5 h-5 text-muted-foreground transition-transform ${v?"rotate-180":""}`})]})}),e.jsx(Z,{className:"mt-3",children:e.jsx("div",{className:"space-y-2",children:(()=>{const a=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],r={monday:"dayMon",tuesday:"dayTue",wednesday:"dayWed",thursday:"dayThu",friday:"dayFri",saturday:"daySat",sunday:"daySun"},g=a[new Date().getDay()===0?6:new Date().getDay()-1];return a.map(m=>{const w=t.opening_hours[m],te=m===g,ts=s(`restaurant.${r[m]}`);let re="N/A";return w&&(w.closed?re=s("restaurant.closed"):w.splitShift?re=`${w.open} - ${w.close}, ${w.open2} - ${w.close2}`:re=`${w.open} - ${w.close}`),e.jsxs("div",{className:`flex justify-between items-center py-1.5 px-2 rounded ${te?"bg-primary/10 border border-primary/20":""}`,children:[e.jsxs("span",{className:`text-sm font-medium ${te?"text-primary":"text-foreground"}`,children:[ts,te&&e.jsxs("span",{className:"ml-2 text-xs",children:["(",s("restaurant.today"),")"]})]}),e.jsx("span",{className:`text-sm ${te?"text-primary font-semibold":"text-muted-foreground"} ${w?.closed?"italic":""}`,children:re})]},m)})})()})})]})]}),t&&(j(t,"announcement")||t.announcement_zh)&&e.jsxs(X,{open:z,onOpenChange:T,className:"flex items-start gap-3 p-4 rounded-lg bg-muted/50",children:[e.jsx(ne,{className:"w-5 h-5 text-primary mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Y,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-card-foreground",children:s("restaurant.announcement")}),e.jsx(K,{className:`w-5 h-5 text-muted-foreground transition-transform ${z?"rotate-180":""}`})]})}),e.jsx(Z,{className:"mt-3",children:e.jsx("div",{className:"p-3 rounded-md bg-primary/5 border border-primary/10",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:j(t,"announcement")||t.announcement_zh})})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(b,{variant:"secondary",className:"w-full",onClick:()=>me(!0),children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),s("restaurant.getDirections")]}),t.website_url&&(t.show_takeaway_button||t.show_booking_button)&&e.jsxs("div",{className:"flex gap-3",children:[t.show_takeaway_button&&e.jsxs(b,{className:"flex-1",onClick:()=>we(!0),children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),s("restaurant.takeawayOrder")]}),t.show_booking_button&&e.jsxs(b,{className:"flex-1",onClick:()=>Ne(!0),children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),s("restaurant.tableBooking")]})]})]}),e.jsx(A,{open:qe,onOpenChange:me,children:e.jsxs(P,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(E,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-100 to-teal-50 dark:from-emerald-900/40 dark:to-teal-900/30 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(fe,{className:"w-7 h-7 text-emerald-500 dark:text-emerald-400 shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(F,{className:"text-base font-semibold tracking-tight text-foreground",children:s("navigation.confirmTitle")}),e.jsx(W,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("navigation.confirmDescriptionSimple",{destination:f.name})})]})]}),e.jsxs(q,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{Us(t.lat,t.lng,f.name),me(!1)},className:"w-full rounded-xl h-11 bg-emerald-500 hover:bg-emerald-600 dark:bg-emerald-600 dark:hover:bg-emerald-700 text-white font-medium shadow-lg shadow-emerald-500/25 transition-all duration-200",children:s("navigation.openNavigation","获取路线")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/15 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(A,{open:Be,onOpenChange:He,children:e.jsxs(P,{className:"max-w-xs w-[calc(100%-3rem)] mx-auto border-0 bg-white/70 dark:bg-gray-900/70 backdrop-blur-xl shadow-2xl rounded-3xl overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl bg-gradient-to-b from-white/30 via-transparent to-transparent pointer-events-none"}),e.jsxs(E,{className:"relative text-center pb-2",children:[e.jsx("div",{className:"mx-auto mb-4 w-14 h-14 rounded-2xl bg-gradient-to-br from-primary/20 to-primary/10 flex items-center justify-center shadow-inner shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Ms,{className:"w-7 h-7 text-primary shrink-0",strokeWidth:2})}),e.jsx(F,{className:"text-lg font-semibold text-foreground",children:s("restaurant.joinPrivateTitle")}),e.jsx(W,{className:"text-center text-sm text-muted-foreground mt-2 leading-relaxed",children:s("restaurant.joinPrivateDescription")})]}),e.jsxs(q,{className:"relative flex-col gap-2 pt-4",children:[e.jsxs(G,{onClick:()=>{const a=new URL(t.website_url);u&&a.searchParams.set("user_id",u.id);const r=a.toString();ge(r)},className:"w-full rounded-xl py-3 bg-primary hover:bg-primary/90 text-primary-foreground font-medium shadow-lg shadow-primary/20 transition-all duration-200",children:[We?e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}):null,s("restaurant.joinPrivateConfirm")]}),e.jsx(U,{className:"w-full rounded-xl py-3 bg-white/50 dark:bg-white/10 hover:bg-white/70 dark:hover:bg-white/20 border-0 text-muted-foreground font-medium transition-all duration-200",children:s("common.cancel")})]})]})}),e.jsx(A,{open:Ue,onOpenChange:we,children:e.jsxs(P,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(E,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-100 to-amber-50 dark:from-orange-900/40 dark:to-amber-900/30 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Le,{className:"w-7 h-7 text-orange-500 dark:text-orange-400 shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(F,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.takeawayOrderTitle","外卖点餐")}),e.jsx(W,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.takeawayDescription","即将为您打开外卖订餐页面")})]})]}),e.jsxs(q,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{try{const a=new URL(t.website_url);a.pathname="/table",u&&a.searchParams.set("user_id",u.id),ge(a.toString())}catch(a){console.error("Invalid URL:",a)}},className:"w-full rounded-xl h-11 bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-medium shadow-lg shadow-orange-500/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/15 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(A,{open:Ve,onOpenChange:Ne,children:e.jsxs(P,{className:"max-w-[320px] w-[calc(100%-2rem)] mx-auto border-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur-2xl shadow-2xl rounded-[28px] overflow-hidden p-6",children:[e.jsx("div",{className:"absolute inset-0 rounded-[28px] bg-gradient-to-b from-white/40 via-transparent to-transparent pointer-events-none"}),e.jsxs(E,{className:"relative text-center space-y-3",children:[e.jsx("div",{className:"mx-auto w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-100 to-sky-50 dark:from-blue-900/40 dark:to-sky-900/30 flex items-center justify-center shadow-sm shrink-0",style:{transform:"translateZ(0)",willChange:"transform"},children:e.jsx(Te,{className:"w-7 h-7 text-blue-500 dark:text-blue-400 shrink-0",strokeWidth:1.5})}),e.jsxs("div",{className:"space-y-1.5 px-1",children:[e.jsx(F,{className:"text-base font-semibold tracking-tight text-foreground",children:s("restaurant.tableBookingTitle","预约订台")}),e.jsx(W,{className:"text-sm text-muted-foreground/80 leading-relaxed break-words",children:s("restaurant.bookingDescription","即将为您打开餐位预约页面")})]})]}),e.jsxs(q,{className:"relative flex-col gap-2 pt-4 mt-1",children:[e.jsx(G,{onClick:()=>{try{const a=new URL(t.website_url);a.pathname="/reservePage",u&&a.searchParams.set("user_id",u.id),ge(a.toString())}catch(a){console.error("Invalid URL:",a)}},className:"w-full rounded-xl h-11 bg-blue-500 hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700 text-white font-medium shadow-lg shadow-blue-500/25 transition-all duration-200",children:s("common.continue","继续")}),e.jsx(U,{className:"w-full rounded-xl h-11 bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/15 border-0 text-muted-foreground font-medium transition-all duration-200 mt-0",children:s("common.cancel")})]})]})}),e.jsx(ia,{restaurantId:t.id,showGallery:t.show_dish_gallery!==!1}),e.jsx("div",{ref:ce,children:e.jsxs(X,{open:y,onOpenChange:L,className:"p-4 rounded-lg bg-muted/50",children:[e.jsx(Y,{className:"w-full",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:s("restaurant.map")}),e.jsx(K,{className:`w-5 h-5 text-muted-foreground transition-transform ${y?"rotate-180":""}`})]})}),e.jsx(Z,{children:c?e.jsx("div",{ref:i,className:"h-[350px] rounded-lg overflow-hidden bg-muted"}):e.jsx("div",{className:"h-[350px] rounded-lg bg-muted flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 animate-spin text-muted-foreground"})})})]})}),e.jsx(Oe,{}),e.jsx(ta,{restaurantId:t.id}),e.jsx(Oe,{}),e.jsx("div",{ref:de,children:ee?e.jsx(n.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-primary"})}),children:e.jsx(oa,{restaurantId:t.id})}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-muted-foreground"})})})]})]})}),e.jsx(A,{open:Ge,onOpenChange:se,children:e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(F,{children:s("activities.loginRequired")}),e.jsx(W,{children:s("activities.loginRequiredMessage")})]}),e.jsxs(q,{children:[e.jsx(U,{children:s("common.cancel")}),e.jsx(G,{onClick:()=>Ke("/auth"),children:s("activities.goToLogin")})]})]})})]})};export{Oa as default};
//# sourceMappingURL=RestaurantDetail-eVwpohef.js.map
