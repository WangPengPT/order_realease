const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomeMapSection-C6vyNaiv.js","assets/vendor-react-DImbKuZP.js","assets/vendor-i18n-AOdgFpXS.js","assets/vendor-editor-B1vH4T8i.js","assets/vendor-utils-vwQGbBim.js","assets/vendor-react-CG6K1Se3.css","assets/textFormatting-C5ODvpSJ.js","assets/index-_G3CuCzp.js","assets/vendor-supabase-CRxszhSs.js","assets/index-4xJmCnhG.css","assets/popover-CLT125d5.js","assets/useRestaurants-DXIIBXS_.js","assets/geolocation-YPf7LJYy.js","assets/useActivityRestaurantCounts-lIkBRCs4.js","assets/vendor-map-CvE3ASYw.js","assets/vendor-map-BbyR9nQ0.css","assets/map-icon-DR07RZr_.js","assets/useLocalizedContent-B2SRIfSp.js","assets/useActivities-B-dkIh_c.js","assets/xiaoxiong-logo-clean-D2n3VLi4.js","assets/LocationPermissionDialog-BDLW4gbZ.js"])))=>i.map(i=>d[i]);
import{a as pe,u as Be,b as te,D as He,c as qe,d as We,e as Fe,A as Ke,f as Qe,h as Xe,i as Ue,j as Ge,k as Ye,l as Ze,m as Je,n as et,o as tt,C as F,B as J,p as k,S as $,q as H,r as st,t as at,v as ot,s as rt,_ as it,w as nt,x as lt,H as ct,y as dt,z as mt}from"./index-_G3CuCzp.js";import{p as I,u as O,r,j as e,aW as ut,L as fe,al as xt,aX as W,aY as ge,aZ as se,a_ as be,a$ as ae,b0 as ye,b1 as ht,b2 as ue,b3 as ve,b4 as pt,b5 as ft,b6 as gt,s as bt,q as yt,b7 as vt,b8 as wt,b9 as jt}from"./vendor-react-DImbKuZP.js";import{m as we}from"./map-icon-DR07RZr_.js";import{a as Nt,g as _t}from"./app-store-badge-CyCtXXOt.js";import{u as je}from"./useHomepageTemplates-fXErwbLH.js";import{u as kt}from"./usePageView-DuFNa9bb.js";import{u as Ct,X as At}from"./XiaoxiongChatContent-BJj2c5pi.js";import{P as St}from"./PullToRefresh-BimBuYXa.js";import{E as Dt}from"./ExternalLinkConfirmDialog-C_70Xa0h.js";import{u as Lt}from"./useActivities-B-dkIh_c.js";import{a as xe,f as Z,K as Tt,L as he,M as Rt,i as zt}from"./vendor-utils-vwQGbBim.js";import{u as Ne}from"./useLocalizedContent-B2SRIfSp.js";import"./vendor-supabase-CRxszhSs.js";import"./vendor-editor-B1vH4T8i.js";import"./vendor-i18n-AOdgFpXS.js";import"./useAIChatHistory-BHmHvjAH.js";import"./LocationPermissionDialog-BDLW4gbZ.js";const Mt=({open:t,onOpenChange:a})=>{const{i18n:i,t:s}=I(),n=O(),o=pe(),{user:l}=Be(),{settings:u}=te(),d=u?.logo_url,[c,m]=r.useState(!1),f=u?.ai_provider||"xiaoxiong-community",{input:h,setInput:g,messages:N,isLoading:_,isLoadingHistory:C,showLocationDialog:A,setShowLocationDialog:j,pendingMessage:M,setPendingMessage:E,handleSubmit:P,handleKeyDown:T,handleLocationConfirm:V,processMessage:R,abortRequest:z,requestLocation:S,clearChat:D}=Ct(f);r.useEffect(()=>{t&&o&&(a(!1),n("/ask-xiaoxiong"))},[t,o,n,a]),r.useEffect(()=>{t&&!o&&S()},[t,o,S]);const p=()=>{z(),a(!1)},b=()=>i.language==="zh"?"小熊AI助手":i.language==="pt"?"Assistente IA Xiaoxiong":"Xiaoxiong AI Assistant";return o?null:e.jsxs(He,{open:t,onOpenChange:p,children:[e.jsxs(qe,{className:"sm:max-w-2xl sm:h-[90vh] sm:max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden",children:[e.jsx(We,{className:"px-4 py-3 shrink-0 border-b",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Fe,{className:"text-base font-semibold flex items-center gap-2",children:[d&&e.jsx("img",{src:d,alt:"Logo",className:"w-8 h-8 rounded-full object-cover"}),b()]}),N.length>0&&l?.id&&e.jsx("button",{onClick:()=>m(!0),className:"p-1 hover:bg-muted rounded-md text-muted-foreground hover:text-primary transition-colors",title:s("aiRecipe.newChat","新对话"),children:e.jsx(ut,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"flex-1 min-h-0 flex flex-col overflow-hidden",children:e.jsx(At,{messages:N,input:h,setInput:g,isLoading:_,isLoadingHistory:C,showLocationDialog:A,setShowLocationDialog:j,pendingMessage:M,handleSubmit:P,handleKeyDown:T,handleLocationConfirm:V,processMessage:R,setPendingMessage:E,onClose:p,onClearChat:D,showBackButton:!1,showHeader:!1,className:"flex-1"})})]}),e.jsx(Ke,{open:c,onOpenChange:m,children:e.jsxs(Qe,{children:[e.jsxs(Xe,{children:[e.jsx(Ue,{children:s("aiRecipe.newChat","新对话")}),e.jsx(Ge,{children:s("aiRecipe.newChatConfirm","开始新对话将清除当前聊天记录，确定吗？")})]}),e.jsxs(Ye,{children:[e.jsx(Ze,{children:s("common.cancel","取消")}),e.jsx(Je,{onClick:async()=>{await D()},children:s("common.confirm","确定")})]})]})})]})},_e=r.memo(({stats:t,onAskXiaoxiong:a})=>{const i=O(),{t:s,i18n:n}=I(),{data:o}=je(),{buttons:l}=et(),{settings:u}=te(),d=n.language,[c,m]=r.useState(!1),f=u?.about_us_button_mobile!==!1,h=l?.find(j=>j.label_zh==="演示"||j.link?.includes("v.xiaoxiong.pt"));h&&h.enabled!==!1&&h.visible!==!1&&h.show_on_mobile;const g=j=>!o||o.length===0?"":o[0][`${j}${d==="zh"?"_zh":d==="pt"?"_pt":"_en"}`]||"",N=g("title")||s("home.hero.title"),_=g("description")||s("home.hero.description"),C=g("subtitle_button_text")||s("home.hero.subtitle"),A=()=>{h?.link&&tt(h.link),m(!1)};return e.jsxs("section",{className:"min-h-[55vh] flex flex-col bg-secondary/20",children:[e.jsxs("div",{className:"pt-20 px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold text-foreground",children:s("home.hero.brandName")}),e.jsx("img",{src:we,alt:"map icon",width:28,height:28,loading:"eager",decoding:"async",className:"w-7 h-7 object-contain flex-shrink-0"})]}),f&&e.jsxs(fe,{to:"/about-us",className:"flex items-center gap-1 px-2 py-1 text-xs bg-background/80 backdrop-blur-sm rounded-full border border-border/50 shadow-sm hover:bg-background transition-colors whitespace-nowrap flex-shrink-0",children:[e.jsx(xt,{className:"w-3.5 h-3.5 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-foreground/80",children:s("nav.aboutUs","关于我们")})]})]}),t&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(W,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:t.order_count})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(ge,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-foreground text-sm",children:t.reserve_count})]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4 py-8",children:e.jsxs("div",{className:"max-w-md mx-auto text-center space-y-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground leading-tight",children:N}),e.jsx("p",{className:"text-sm sm:text-base text-muted-foreground max-w-sm mx-auto",children:_}),e.jsxs("div",{className:"pt-4 space-y-3",children:[e.jsxs("button",{onClick:a,className:"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 cursor-text border border-border/50 mx-auto",children:[e.jsx(se,{className:"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors"}),e.jsx("span",{className:"text-sm text-muted-foreground group-hover:text-foreground transition-colors",children:C}),e.jsx(be,{className:"w-4 h-4 text-muted-foreground/60 ml-2"})]}),e.jsxs("div",{className:"flex items-center gap-3 px-4",children:[e.jsx("div",{className:"flex-1 h-px bg-border/50"}),e.jsx("span",{className:"text-xs text-muted-foreground/60",children:s("aiRecipe.or","或者")}),e.jsx("div",{className:"flex-1 h-px bg-border/50"})]}),e.jsxs("button",{onClick:()=>i("/ai-recipe"),className:"group flex items-center gap-3 bg-secondary/50 backdrop-blur-sm text-foreground px-5 py-3.5 rounded-full shadow-sm hover:shadow-md hover:bg-secondary/70 transition-all duration-300 border border-border/50 mx-auto",children:[e.jsx(ae,{className:"w-5 h-5 text-primary group-hover:text-primary/80 transition-colors"}),e.jsx("span",{className:"text-sm text-muted-foreground group-hover:text-foreground transition-colors",children:s("aiRecipe.diyCook","自己动手做，Ai菜谱")}),e.jsx(ye,{className:"w-4 h-4 text-muted-foreground/70 group-hover:text-foreground/70 transition-colors"})]})]})]})}),e.jsx(Dt,{open:c,onOpenChange:m,onConfirm:A,url:h?.link})]})});_e.displayName="MobileHeroSection";const Et=t=>!t||!Array.isArray(t)?!1:t.every(a=>typeof a=="object"&&a!==null&&"start"in a&&"end"in a&&typeof a.start=="number"&&typeof a.end=="number"),Pt=(t,a)=>{const i=Z(new Date(t.start_date)),s=t.end_date?Z(new Date(t.end_date)):null,n=Z(a);if(n<i||s&&n>s)return!1;switch(t.repeat_mode||"none"){case"none":return zt(i,n);case"daily":return!0;case"weekly":const l=Rt(n);return t.repeat_weekday===l;case"monthly":const d=he(n),c=t.repeat_month_day;return Et(c)?c.some(N=>d>=N.start&&d<=N.end):!1;case"yearly":const m=Tt(n)+1,f=he(n),h=t.repeat_yearly_month,g=t.repeat_yearly_day;return h===m&&g===f;default:return!1}},q=t=>{switch(t.repeat_mode||"none"){case"none":return 0;case"weekly":return 1;case"monthly":return 2;case"yearly":return 3;case"daily":return 4;default:return 5}},It=()=>{const{data:t,isLoading:a}=Lt(),i=r.useMemo(()=>{if(!t)return{today:[],tomorrow:[],dayAfterTomorrow:[]};const n=new Date,o=xe(n,1),l=xe(n,2),u=d=>t.filter(c=>c.visible&&c.status==="published").filter(c=>Pt(c,d)).sort((c,m)=>{const f=q(c)-q(m);return f!==0?f:c.pinned!==m.pinned?c.pinned?-1:1:(c.sort_order||0)-(m.sort_order||0)});return{today:u(n),tomorrow:u(o),dayAfterTomorrow:u(l)}},[t]),s=r.useMemo(()=>{const n=new Set,o=[];return i.today.forEach(l=>{n.has(l.id)||(n.add(l.id),o.push({...l,dayLabel:"today"}))}),i.tomorrow.forEach(l=>{n.has(l.id)||(n.add(l.id),o.push({...l,dayLabel:"tomorrow"}))}),i.dayAfterTomorrow.forEach(l=>{n.has(l.id)||(n.add(l.id),o.push({...l,dayLabel:"dayAfterTomorrow"}))}),o.sort((l,u)=>{const d=q(l)-q(u);return d!==0?d:l.pinned!==u.pinned?l.pinned?-1:1:(l.sort_order||0)-(u.sort_order||0)})},[i]);return{recentActivities:i,allRecentActivities:s,isLoading:a,hasActivities:s.length>0}},ke=()=>{const[t,a]=r.useState(4);return r.useEffect(()=>{const i=()=>{const s=window.innerWidth;s<640?a(2):s<1024?a(3):a(4)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),t},Ce=r.memo(({activity:t,dayLabel:a})=>{const i=O(),{t:s}=I(),{getLocalizedField:n}=Ne(),o=n(t,"title"),l=r.useMemo(()=>{switch(t.service_type){case"dine_in":return s("activities.serviceType.dine_in");case"takeaway":return s("activities.serviceType.takeaway");case"both":return s("activities.serviceType.both");default:return""}},[t.service_type,s]),u=()=>{i(`/activity/${t.id}`)};return e.jsxs(F,{className:"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card",onClick:u,children:[e.jsxs("div",{className:"relative aspect-[16/10] overflow-hidden bg-muted",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:o,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx(ht,{className:"w-12 h-12 text-primary/40"})}),e.jsx(J,{className:k("absolute top-2 left-2 text-xs font-medium",a===s("home.recentActivities.today")?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground"),children:a}),t.pinned&&e.jsx(J,{className:"absolute top-2 right-2 text-xs bg-accent text-accent-foreground",children:s("activities.pinned")})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("h3",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors",children:o}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[t.service_type==="dine_in"&&e.jsx(ue,{className:"w-3 h-3 flex-shrink-0"}),t.service_type==="takeaway"&&e.jsx(W,{className:"w-3 h-3 flex-shrink-0"}),t.service_type==="both"&&e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-3 h-3 flex-shrink-0"}),e.jsx(W,{className:"w-3 h-3 flex-shrink-0"})]}),e.jsx("span",{className:"truncate",children:l})]})]})]})});Ce.displayName="ActivityCard";const Ae=r.memo(()=>{const t=ke();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:t}).map((a,i)=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsx($,{className:"aspect-[16/10] w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx($,{className:"h-4 w-full"}),e.jsx($,{className:"h-3 w-2/3"})]})]},i))})});Ae.displayName="LoadingSkeleton";const Se=r.memo(()=>{const{t}=I(),{allRecentActivities:a,isLoading:i,hasActivities:s}=It(),n=ke(),[o,l]=r.useState(!1),u=m=>{switch(m){case"today":return t("home.recentActivities.today");case"tomorrow":return t("home.recentActivities.tomorrow");case"dayAfterTomorrow":return t("home.recentActivities.dayAfterTomorrow");default:return""}},d=r.useMemo(()=>o?a:a.slice(0,n),[a,n,o]),c=a.length>n;return!i&&!s?null:e.jsx("section",{className:"py-8 sm:py-12 px-4 bg-secondary/20",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t("home.recentActivities.title")}),c&&!o&&e.jsx(H,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",onClick:()=>l(!0),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("home.recentActivities.viewAll"),e.jsx(ve,{className:"w-4 h-4"})]})}),o&&e.jsx(H,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>l(!1),children:e.jsx("span",{className:"flex items-center gap-1",children:t("home.recentActivities.collapse")})})]}),i?e.jsx(Ae,{}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:d.map(m=>e.jsx(Ce,{activity:m,dayLabel:u(m.dayLabel)},m.id))})]})})});Se.displayName="RecentActivitiesSection";const De=()=>{const[t,a]=r.useState(4);return r.useEffect(()=>{const i=()=>{const s=window.innerWidth;s<640?a(2):s<1024?a(3):a(4)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),t},Le=r.memo(({post:t})=>{const a=O(),{t:i}=I(),{getLocalizedField:s}=Ne(),n=t.post_type==="recipe",o=n?s(t,"recipe_name")||t.recipe_name:null,l=s(t,"content")||t.content,u=o||l,d=t.image_urls?.[0]||null,c=t.author?.display_name||i("community.anonymous","匿名用户"),m=t.author?.avatar_url;return e.jsxs(F,{className:"group cursor-pointer overflow-hidden hover:shadow-lg transition-all duration-300 border-border/50 bg-card",onClick:()=>a(`/community/post/${t.id}`),children:[e.jsxs("div",{className:"relative aspect-[16/10] overflow-hidden bg-muted",children:[d?e.jsx("img",{src:d,alt:u||"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300",loading:"lazy"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:n?e.jsx(ae,{className:"w-12 h-12 text-primary/40"}):e.jsx(pt,{className:"w-12 h-12 text-primary/40"})}),e.jsx(J,{className:"absolute top-2 left-2 text-xs font-medium bg-accent text-accent-foreground",children:i("community.recipe","食谱")}),t.video_url&&e.jsx("div",{className:"absolute top-2 right-2 w-6 h-6 rounded-full bg-black/50 flex items-center justify-center",children:e.jsx(ft,{className:"w-3 h-3 text-white fill-white"})}),!t.video_url&&t.image_urls?.length>1&&e.jsx("div",{className:"absolute top-2 right-2 bg-black/50 text-white text-[10px] px-1.5 py-0.5 rounded-full",children:t.image_urls.length})]}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx("p",{className:"font-medium text-sm leading-tight line-clamp-2 text-foreground group-hover:text-primary transition-colors",children:u}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsxs(st,{className:"w-4 h-4",children:[e.jsx(at,{src:m||void 0}),e.jsx(ot,{className:"text-[8px]",children:c[0]})]}),e.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[60px]",children:c})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(gt,{className:"w-3 h-3"}),t.likes_count||0]}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[e.jsx(se,{className:"w-3 h-3"}),t.comments_count||0]})]})]})]})]})});Le.displayName="RecentPostCard";const Te=r.memo(()=>{const t=De();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:t}).map((a,i)=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsx($,{className:"aspect-[16/10] w-full"}),e.jsxs("div",{className:"p-3 space-y-2",children:[e.jsx($,{className:"h-4 w-full"}),e.jsx($,{className:"h-3 w-2/3"})]})]},i))})});Te.displayName="RecentPostsSkeleton";const Re=r.memo(()=>{const{t}=I();O();const a=De(),[i,s]=r.useState(!1),{data:n=[],isLoading:o}=bt({queryKey:["recent-home-recipes"],queryFn:async()=>{const{data:d,error:c}=await rt.from("community_posts").select(`
          id, content, content_en, content_zh, content_pt,
          image_urls, video_url, post_type,
          recipe_name, recipe_name_en, recipe_name_pt,
          likes_count, comments_count, shares_count, views_count,
          created_at,
          author:profiles!community_posts_author_id_fkey(id, display_name, avatar_url)
        `).eq("status","approved").eq("post_type","recipe").order("created_at",{ascending:!1}).limit(12);if(c)throw c;return(d||[]).map(m=>({...m,author:Array.isArray(m.author)?m.author[0]:m.author}))},staleTime:5*60*1e3}),l=r.useMemo(()=>i?n:n.slice(0,a),[n,a,i]),u=n.length>a;return!o&&n.length===0?null:e.jsx("section",{className:"py-8 sm:py-12 px-4 bg-secondary/20",children:e.jsxs("div",{className:"container mx-auto max-w-7xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-foreground",children:t("home.recentPosts.title","近日食谱")}),u&&!i&&e.jsx(H,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",onClick:()=>s(!0),children:e.jsxs("span",{className:"flex items-center gap-1",children:[t("home.recentPosts.viewAll","查看全部"),e.jsx(ve,{className:"w-4 h-4"})]})}),i&&e.jsx(H,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",onClick:()=>s(!1),children:e.jsx("span",{className:"flex items-center gap-1",children:t("home.recentPosts.collapse","收起")})})]}),o?e.jsx(Te,{}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:l.map(d=>e.jsx(Le,{post:d},d.id))})]})})});Re.displayName="RecentPostsSection";const ee="/images/sushi-ramen-hero.jpg",ze="/images/sushi-ramen-mobile.jpg",$t=r.lazy(()=>it(()=>import("./HomeMapSection-C6vyNaiv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))),Me=r.memo(({stats:t,t:a})=>e.jsx("div",{className:"absolute top-16 sm:top-20 left-3 z-20",children:e.jsxs("div",{className:"gap-4 w-fit flex-col flex items-start justify-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:a("home.stats.delivery")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:t.order_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-accent"}),e.jsx("span",{className:"text-sm text-white/90 drop-shadow-md",children:a("home.stats.reservation")}),e.jsx("span",{className:"font-bold text-white text-sm drop-shadow-md",children:t.reserve_count})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl sm:text-2xl font-bold text-white drop-shadow-md",children:a("home.hero.brandName")}),e.jsx("img",{src:we,alt:"map icon",width:32,height:32,loading:"eager",decoding:"async",className:"w-7 sm:w-8 h-7 sm:h-8 object-contain flex-shrink-0"})]})]})}));Me.displayName="StatsDisplay";const Ot=()=>{const t=()=>{try{return typeof window<"u"?window.innerWidth:1024}catch{return 1024}},a=()=>{try{return typeof navigator<"u"?navigator.connection:null}catch{return null}},i=()=>{try{return typeof navigator<"u"?navigator.deviceMemory:null}catch{return null}},s=t(),n=s<640,o=s>=1024,l=a();let u=!1,d=!1;try{u=dt(),d=mt()}catch(m){console.warn("[useLightweightMode] Environment detection failed:",m)}if(o)return!!l?.saveData;if(d&&!u||l&&(l.saveData||l.effectiveType==="2g"||l.effectiveType==="slow-2g"))return!0;const c=i();return!!(n&&c&&c<2)},Ee=r.memo(({template:t,isActive:a,currentLang:i,t:s,onContentReady:n,onAskXiaoxiong:o,onDIYCook:l})=>{const[u,d]=r.useState({}),[c,m]=r.useState({}),[f,h]=r.useState({}),[g,N]=r.useState({mobile:!0,tablet:!0,desktop:!0}),[_,C]=r.useState(!1),A=Ot(),j=r.useRef(null),M=r.useRef(null),E=r.useRef(null),P=x=>t[`${x}${i==="zh"?"_zh":i==="pt"?"_pt":"_en"}`]||"",T=()=>{try{if(typeof window>"u")return"desktop";const x=window.innerWidth;return x<640?"mobile":x<1024?"tablet":"desktop"}catch{return"desktop"}},V=()=>{const x=T();return x==="mobile"&&t.mobile_overlay_opacity!==null?t.mobile_overlay_opacity:x==="tablet"&&t.tablet_overlay_opacity!==null?t.tablet_overlay_opacity:x==="desktop"&&t.desktop_overlay_opacity!==null?t.desktop_overlay_opacity:t.overlay_opacity??30},R=()=>{const x=V(),v=t.overlay_gradient_direction||"to-b",L=(B,Ve)=>B==null?Ve/100:B>1?B/100:B,w=x>1?x/100:x,de=L(t.overlay_gradient_from_opacity,30)*w,U=L(t.overlay_gradient_via_opacity,25)*w,G=L(t.overlay_gradient_to_opacity,40)*w,Pe={"to-t":"to top","to-b":"to bottom","to-l":"to left","to-r":"to right","to-tl":"to top left","to-tr":"to top right","to-bl":"to bottom left","to-br":"to bottom right"}[v]||"to bottom",Y={black:"0, 0, 0",white:"255, 255, 255",background:"0, 0, 0",foreground:"255, 255, 255",primary:"1, 100, 80",secondary:"240, 240, 240"},Ie=Y[t.overlay_gradient_from||"black"]||"0, 0, 0",$e=Y[t.overlay_gradient_via||"black"]||"0, 0, 0",Oe=Y[t.overlay_gradient_to||"black"]||"0, 0, 0";return{background:`linear-gradient(${Pe}, rgba(${Ie}, ${de}), rgba(${$e}, ${U}), rgba(${Oe}, ${G}))`}},z=t.mobile_image_url||ze,S=t.tablet_image_url||t.desktop_image_url||ee,D=t.desktop_image_url||ee,p=t.background_blur||0,b=t.desktop_media_type||t.media_type||"image",y=t.tablet_media_type||t.media_type||"image",K=t.mobile_media_type||t.media_type||"image",oe=b==="video"&&!A,re=y==="video"&&!A,ie=K==="video"&&!A,ne=ie?t.mobile_video_url:null,le=re?t.tablet_video_url||t.desktop_video_url:null,ce=oe?t.desktop_video_url:null;r.useEffect(()=>{const x=T(),v=x==="mobile"?z:x==="tablet"?S:D;if(v){const L=new Image;L.onload=()=>{d(w=>({...w,[x]:!0})),N(w=>({...w,[x]:!0})),a&&(n?.(),setTimeout(()=>C(!0),100))},L.src=v}},[z,S,D,a,n]),r.useEffect(()=>{a&&u[T()]&&C(!0)},[a,u]);const Q=x=>{m(v=>({...v,[x]:!0}))},X=(x,v)=>{console.error(`[HeroSlide] Video error on ${x}:`,v),h(L=>({...L,[x]:!0}))};return r.useEffect(()=>{if(!_||!a)return;let x=!1;try{x=nt()}catch{}if(!x)return;const v=T(),w=(v==="mobile"?j:v==="tablet"?M:E).current;if(!w)return;const U=setTimeout(async()=>{try{w.muted=!0,w.playsInline=!0,w.setAttribute("webkit-playsinline","true"),await w.play(),console.log(`[HeroSlide] iOS video play successful on ${v}`)}catch(G){console.error(`[HeroSlide] iOS video play failed on ${v}:`,G),h(me=>({...me,[v]:!0}))}},150);return()=>clearTimeout(U)},[_,a]),e.jsxs("div",{className:k("absolute inset-0 w-full h-full transition-opacity duration-1000",a?"opacity-100 z-10":"opacity-0 z-0"),children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsxs("div",{className:"absolute inset-0 w-full h-full sm:hidden",children:[!g.mobile&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),ie&&ne?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:z,alt:"Background",className:k("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.mobile&&!f.mobile?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),_&&!f.mobile&&e.jsx("video",{ref:j,src:ne,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>Q("mobile"),onError:x=>X("mobile",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:z,alt:"Background",className:k("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.mobile?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden sm:block lg:hidden",children:[!g.tablet&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),re&&le?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:S,alt:"Background",className:k("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.tablet&&!f.tablet?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),_&&!f.tablet&&e.jsx("video",{ref:M,src:le,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>Q("tablet"),onError:x=>X("tablet",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:S,alt:"Background",className:k("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.tablet?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsxs("div",{className:"absolute inset-0 w-full h-full hidden lg:block",children:[!g.desktop&&e.jsx("div",{className:"absolute inset-0 w-full h-full bg-muted animate-pulse z-20"}),oe&&ce?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:D,alt:"Background",className:k("absolute inset-0 w-full h-full object-cover object-center z-10 transition-opacity duration-500",c.desktop&&!f.desktop?"opacity-0 pointer-events-none":"opacity-100"),style:{filter:p>0?`blur(${p}px)`:void 0}}),_&&!f.desktop&&e.jsx("video",{ref:E,src:ce,autoPlay:!0,loop:!0,muted:!0,playsInline:!0,"webkit-playsinline":"true",preload:"auto",onCanPlay:()=>Q("desktop"),onError:x=>X("desktop",x),className:"absolute inset-0 w-full h-full object-cover object-center",style:{filter:p>0?`blur(${p}px)`:void 0}})]}):e.jsx("img",{src:D,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:k("absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500",g.desktop?"opacity-100":"opacity-0"),style:{filter:p>0?`blur(${p}px)`:void 0}})]}),e.jsx("div",{className:"absolute inset-0 w-full h-full",style:R()})]}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:P("title")||s("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:P("description")||s("home.hero.description")}),t.subtitle_button_text_zh&&e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsxs("button",{onClick:o,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 cursor-text border border-white/40",children:[e.jsx(se,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:P("subtitle_button_text")||s("home.hero.subtitle")}),e.jsx(be,{className:"w-4 h-4 text-white/60 ml-2 drop-shadow-sm"})]}),e.jsxs("div",{className:"flex items-center gap-3 w-64",children:[e.jsx("div",{className:"flex-1 h-px bg-white/30"}),e.jsx("span",{className:"text-xs text-white/60",children:s("aiRecipe.or","或者")}),e.jsx("div",{className:"flex-1 h-px bg-white/30"})]}),e.jsxs("button",{onClick:l,className:"group flex items-center gap-3 bg-white/20 backdrop-blur-xl text-white px-5 sm:px-7 py-3.5 sm:py-4 rounded-full shadow-[0_8px_32px_rgba(0,0,0,0.12)] hover:shadow-[0_16px_48px_rgba(0,0,0,0.2)] hover:bg-white/30 transition-all duration-300 border border-white/40",children:[e.jsx(ae,{className:"w-5 h-5 text-white/90 group-hover:text-white transition-colors drop-shadow-sm"}),e.jsx("span",{className:"text-sm sm:text-base text-primary group-hover:text-primary/80 transition-colors drop-shadow-sm font-medium",children:s("aiRecipe.diyCook","自己动手做")}),e.jsx(ye,{className:"w-4 h-4 text-white/70 group-hover:text-white/90 transition-colors drop-shadow-sm"})]})]})]})})]})});Ee.displayName="HeroSlide";const as=()=>{const{t,i18n:a}=I(),i=O(),s=yt(),{settings:n}=te(),{data:o,isLoading:l,refetch:u}=je(),[d,c]=r.useState(0),[m,f]=r.useState(null),h=r.useRef(null),[g,N]=r.useState(!1),[_,C]=r.useState(!1),A=pe(),{isWebView:j,isNativeApp:M}=lt(),E=A||j,P=j||M,T=n?.ai_assistant_enabled!==!1,V=r.useCallback(()=>{N(!0)},[]);kt({pageType:"home"});const R=r.useCallback(async()=>{try{const y=await(await fetch("https://v.xiaoxiong.pt/api/get_info")).json();y&&f({order_count:y.order_count||0,reserve_count:y.reserve_count||0})}catch(b){console.error("Failed to fetch stats:",b)}},[]);r.useEffect(()=>{R()},[R]);const z=r.useCallback(async()=>{s.removeQueries({queryKey:["homepage-templates"]}),s.removeQueries({queryKey:["restaurants"]}),s.removeQueries({queryKey:["activities"]}),s.removeQueries({queryKey:["recent-activities"]}),await Promise.all([u(),R(),s.invalidateQueries({queryKey:["restaurants"]}),s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["recent-activities"]})])},[u,R,s]);r.useEffect(()=>{if(!o||o.length<=1)return;const y=o[d]?.duration||5e3;return h.current=setTimeout(()=>{c(K=>(K+1)%o.length)},y),()=>{h.current&&clearTimeout(h.current)}},[o,d]);const S=r.useCallback(b=>{h.current&&clearTimeout(h.current),c(b)},[]);r.useCallback(()=>{o&&(h.current&&clearTimeout(h.current),c(b=>(b-1+o.length)%o.length))},[o]),r.useCallback(()=>{o&&(h.current&&clearTimeout(h.current),c(b=>(b+1)%o.length))},[o]);const D=a.language,p=o&&o.length>1;return e.jsx(St,{onRefresh:z,children:e.jsxs("div",{className:"min-h-screen",children:[E?e.jsx(_e,{stats:m,onAskXiaoxiong:()=>C(!0)}):e.jsxs("section",{className:"relative h-screen flex items-start overflow-hidden bg-background",children:[m&&e.jsx(Me,{stats:m,t}),e.jsx("div",{className:k("absolute inset-0 w-full h-full transition-opacity duration-500",g?"opacity-100":"opacity-0"),children:o?.map((b,y)=>e.jsx(Ee,{template:b,isActive:y===d,currentLang:D,t,onContentReady:y===0?V:void 0,onAskXiaoxiong:()=>C(!0),onDIYCook:()=>i("/ai-recipe")},b.id))}),e.jsx("div",{className:k("absolute inset-0 w-full h-full z-20 transition-opacity duration-500",l||!g?"opacity-100":"opacity-0 pointer-events-none"),children:e.jsx(ct,{})}),!l&&(!o||o.length===0)&&e.jsxs("div",{className:"absolute inset-0 w-full h-full",children:[e.jsx("img",{src:ze,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center sm:hidden"}),e.jsx("img",{src:ee,alt:"Background",fetchPriority:"high",loading:"eager",decoding:"async",className:"absolute inset-0 w-full h-full object-cover object-center hidden sm:block"}),e.jsx("div",{className:"absolute inset-0 w-full h-full bg-gradient-to-b from-black/30 via-black/25 to-black/40"}),e.jsx("div",{className:"relative z-10 container mx-auto px-4 sm:px-6 flex items-center min-h-screen",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center space-y-4 sm:space-y-8 animate-fade-in w-full",children:[e.jsx("h1",{className:"text-3xl sm:text-5xl md:text-7xl font-bold text-white leading-tight px-4 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]",children:t("home.hero.title")}),e.jsx("p",{className:"text-sm sm:text-xl md:text-2xl text-white/95 max-w-2xl mx-auto px-4 drop-shadow-[0_2px_6px_rgba(0,0,0,0.7)]",children:t("home.hero.description")})]})})]}),p&&e.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-2",children:o.map((b,y)=>e.jsx("button",{onClick:()=>S(y),className:k("w-3 h-3 rounded-full transition-all duration-300",y===d?"bg-white w-8":"bg-white/50 hover:bg-white/70"),"aria-label":`Go to slide ${y+1}`},y))})]}),e.jsx(Se,{}),e.jsx(Re,{}),e.jsx("section",{className:"py-12 sm:py-20 px-4 bg-secondary/20",children:e.jsx("div",{className:"container mx-auto max-w-7xl",children:e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"h-[400px] bg-muted/30 rounded-lg animate-pulse"}),children:e.jsx($t,{})})})}),!P&&e.jsxs("section",{className:"py-16 sm:py-24 px-4 relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-primary/3 to-primary/8",style:{maskImage:"radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)",WebkitMaskImage:"radial-gradient(ellipse 80% 70% at 50% 50%, black 40%, transparent 100%)"}}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-72 h-72 bg-primary/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-primary/5 rounded-full blur-3xl"}),e.jsx("div",{className:"container mx-auto max-w-5xl relative z-10",children:e.jsx("div",{className:"flex flex-col items-center justify-center gap-8",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary text-sm font-medium px-4 py-2 rounded-full mb-4",children:[e.jsx(vt,{className:"w-4 h-4"}),e.jsx("span",{children:"Mobile App"})]}),e.jsx("h3",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-foreground mb-4",children:t("home.app.title")}),e.jsx("p",{className:"text-base sm:text-lg text-muted-foreground mb-8 leading-relaxed",children:t("home.app.description")}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs("a",{href:"https://apps.apple.com/cn/app/xiaoxiong/id6755481369",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:Nt,alt:"Download on the App Store",width:108,height:36,className:"h-8 sm:h-9"})})]}),e.jsxs("a",{href:"https://play.google.com/store/apps/details?id=com.xiaoxiong.market",target:"_blank",rel:"noopener noreferrer",className:"relative group",children:[e.jsx("div",{className:"absolute -inset-2 bg-gradient-to-r from-primary via-primary-glow to-primary rounded-2xl blur-lg opacity-40 group-hover:opacity-70 transition-opacity"}),e.jsx("div",{className:"relative bg-black hover:bg-gray-900 h-[52px] sm:h-[56px] w-[160px] sm:w-[180px] rounded-xl transition-all hover:scale-105 shadow-2xl hover:shadow-primary/30 border border-white/10 flex items-center justify-center",children:e.jsx("img",{src:_t,alt:"Get it on Google Play",width:145,height:56,className:"h-12 sm:h-14"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(wt,{className:"w-4 h-4 animate-bounce"}),e.jsx("span",{children:t("home.app.downloadNow")})]})]})]})})})]}),e.jsxs("section",{className:"py-16 sm:py-20 px-4 bg-gradient-to-r from-primary/90 to-primary relative overflow-hidden rounded-3xl mx-4 sm:mx-8 lg:mx-16 mb-8",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("div",{className:"absolute top-0 right-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-64 sm:w-96 h-64 sm:h-96 bg-white/10 rounded-full blur-3xl"}),e.jsxs("div",{className:"container mx-auto max-w-4xl text-center relative z-10",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl font-bold text-primary-foreground mb-4 sm:mb-6 px-4",children:t("home.cta.title")}),e.jsx("p",{className:"text-base sm:text-xl text-primary-foreground/90 mb-6 sm:mb-8 max-w-2xl mx-auto px-4",children:t("home.cta.description")}),e.jsx("div",{className:"flex justify-center",children:e.jsx(H,{size:"lg",variant:"secondary",asChild:!0,className:"text-base sm:text-lg shadow-xl hover:shadow-2xl",children:e.jsxs(fe,{to:"/join-us",children:[e.jsx(jt,{className:"mr-2 w-4 sm:w-5 h-4 sm:h-5"}),t("home.cta.button")]})})})]})]}),T&&e.jsx(Mt,{open:_,onOpenChange:C})]})})};export{as as default};
//# sourceMappingURL=Home-C6gMyIag.js.map
